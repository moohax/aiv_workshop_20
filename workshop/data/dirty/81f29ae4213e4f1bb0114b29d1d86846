PowerView.ps1,54ff256c5a33ba0fce9f6551f1b440fb,Scan result is 32768. IsMalware: 1,I3JlcXVpcmVzIC12ZXJzaW9uIDIKCjwjCgogICAgUG93ZXJTcGxvaXQgRmlsZTogUG93ZXJWaWV3LnBzMQogICAgQXV0aG9yOiBXaWxsIFNjaHJvZWRlciAoQGhhcm1qMHkpCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIFJlcXVpcmVkIERlcGVuZGVuY2llczogTm9uZQogICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBOb25lCgojPgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojIFBTUmVmbGVjdCBjb2RlIGZvciBXaW5kb3dzIEFQSSBhY2Nlc3MKIyBBdXRob3I6IEBtYXR0aWZlc3RhdGlvbgojICAgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL21hdHRpZmVzdGF0aW9uL1BTUmVmbGVjdC9tYXN0ZXIvUFNSZWZsZWN0LnBzbTEKIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZnVuY3Rpb24gTmV3LUluTWVtb3J5TW9kdWxlCnsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBDcmVhdGVzIGFuIGluLW1lbW9yeSBhc3NlbWJseSBhbmQgbW9kdWxlCgogICAgICAgIEF1dGhvcjogTWF0dGhldyBHcmFlYmVyIChAbWF0dGlmZXN0YXRpb24pCiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAgICAgUmVxdWlyZWQgRGVwZW5kZW5jaWVzOiBOb25lCiAgICAgICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBOb25lCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFdoZW4gZGVmaW5pbmcgY3VzdG9tIGVudW1zLCBzdHJ1Y3RzLCBhbmQgdW5tYW5hZ2VkIGZ1bmN0aW9ucywgaXQgaXMKICAgICAgICBuZWNlc3NhcnkgdG8gYXNzb2NpYXRlIHRvIGFuIGFzc2VtYmx5IG1vZHVsZS4gVGhpcyBoZWxwZXIgZnVuY3Rpb24KICAgICAgICBjcmVhdGVzIGFuIGluLW1lbW9yeSBtb2R1bGUgdGhhdCBjYW4gYmUgcGFzc2VkIHRvIHRoZSAnZW51bScsCiAgICAgICAgJ3N0cnVjdCcsIGFuZCBBZGQtV2luMzJUeXBlIGZ1bmN0aW9ucy4KCiAgICAuUEFSQU1FVEVSIE1vZHVsZU5hbWUKCiAgICAgICAgU3BlY2lmaWVzIHRoZSBkZXNpcmVkIG5hbWUgZm9yIHRoZSBpbi1tZW1vcnkgYXNzZW1ibHkgYW5kIG1vZHVsZS4gSWYKICAgICAgICBNb2R1bGVOYW1lIGlzIG5vdCBwcm92aWRlZCwgaXQgd2lsbCBkZWZhdWx0IHRvIGEgR1VJRC4KCiAgICAuRVhBTVBMRQoKICAgICAgICAkTW9kdWxlID0gTmV3LUluTWVtb3J5TW9kdWxlIC1Nb2R1bGVOYW1lIFdpbjMyCiM+CgogICAgUGFyYW0KICAgICgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRNb2R1bGVOYW1lID0gW0d1aWRdOjpOZXdHdWlkKCkuVG9TdHJpbmcoKQogICAgKQoKICAgICRMb2FkZWRBc3NlbWJsaWVzID0gW0FwcERvbWFpbl06OkN1cnJlbnREb21haW4uR2V0QXNzZW1ibGllcygpCgogICAgRm9yRWFjaCAoJEFzc2VtYmx5IGluICRMb2FkZWRBc3NlbWJsaWVzKSB7CiAgICAgICAgaWYgKCRBc3NlbWJseS5GdWxsTmFtZSAtYW5kICgkQXNzZW1ibHkuRnVsbE5hbWUuU3BsaXQoJywnKVswXSAtZXEgJE1vZHVsZU5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybiAkQXNzZW1ibHkKICAgICAgICB9CiAgICB9CgogICAgJER5bkFzc2VtYmx5ID0gTmV3LU9iamVjdCBSZWZsZWN0aW9uLkFzc2VtYmx5TmFtZSgkTW9kdWxlTmFtZSkKICAgICREb21haW4gPSBbQXBwRG9tYWluXTo6Q3VycmVudERvbWFpbgogICAgJEFzc2VtYmx5QnVpbGRlciA9ICREb21haW4uRGVmaW5lRHluYW1pY0Fzc2VtYmx5KCREeW5Bc3NlbWJseSwgJ1J1bicpCiAgICAkTW9kdWxlQnVpbGRlciA9ICRBc3NlbWJseUJ1aWxkZXIuRGVmaW5lRHluYW1pY01vZHVsZSgkTW9kdWxlTmFtZSwgJEZhbHNlKQoKICAgIHJldHVybiAkTW9kdWxlQnVpbGRlcgp9CgoKIyBBIGhlbHBlciBmdW5jdGlvbiB1c2VkIHRvIHJlZHVjZSB0eXBpbmcgd2hpbGUgZGVmaW5pbmcgZnVuY3Rpb24KIyBwcm90b3R5cGVzIGZvciBBZGQtV2luMzJUeXBlLgpmdW5jdGlvbiBmdW5jCnsKICAgIFBhcmFtCiAgICAoCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDAsIE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREbGxOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMSwgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZ1bmN0aW9uTmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDIsIE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbVHlwZV0KICAgICAgICAkUmV0dXJuVHlwZSwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDMpXQogICAgICAgIFtUeXBlW11dCiAgICAgICAgJFBhcmFtZXRlclR5cGVzLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gNCldCiAgICAgICAgW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkNhbGxpbmdDb252ZW50aW9uXQogICAgICAgICROYXRpdmVDYWxsaW5nQ29udmVudGlvbiwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDUpXQogICAgICAgIFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5DaGFyU2V0XQogICAgICAgICRDaGFyc2V0LAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTZXRMYXN0RXJyb3IKICAgICkKCiAgICAkUHJvcGVydGllcyA9IEB7CiAgICAgICAgRGxsTmFtZSA9ICREbGxOYW1lCiAgICAgICAgRnVuY3Rpb25OYW1lID0gJEZ1bmN0aW9uTmFtZQogICAgICAgIFJldHVyblR5cGUgPSAkUmV0dXJuVHlwZQogICAgfQoKICAgIGlmICgkUGFyYW1ldGVyVHlwZXMpIHsgJFByb3BlcnRpZXNbJ1BhcmFtZXRlclR5cGVzJ10gPSAkUGFyYW1ldGVyVHlwZXMgfQogICAgaWYgKCROYXRpdmVDYWxsaW5nQ29udmVudGlvbikgeyAkUHJvcGVydGllc1snTmF0aXZlQ2FsbGluZ0NvbnZlbnRpb24nXSA9ICROYXRpdmVDYWxsaW5nQ29udmVudGlvbiB9CiAgICBpZiAoJENoYXJzZXQpIHsgJFByb3BlcnRpZXNbJ0NoYXJzZXQnXSA9ICRDaGFyc2V0IH0KICAgIGlmICgkU2V0TGFzdEVycm9yKSB7ICRQcm9wZXJ0aWVzWydTZXRMYXN0RXJyb3InXSA9ICRTZXRMYXN0RXJyb3IgfQoKICAgIE5ldy1PYmplY3QgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzCn0KCgpmdW5jdGlvbiBBZGQtV2luMzJUeXBlCnsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBDcmVhdGVzIGEgLk5FVCB0eXBlIGZvciBhbiB1bm1hbmFnZWQgV2luMzIgZnVuY3Rpb24uCgogICAgICAgIEF1dGhvcjogTWF0dGhldyBHcmFlYmVyIChAbWF0dGlmZXN0YXRpb24pCiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAgICAgUmVxdWlyZWQgRGVwZW5kZW5jaWVzOiBOb25lCiAgICAgICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBmdW5jCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIEFkZC1XaW4zMlR5cGUgZW5hYmxlcyB5b3UgdG8gZWFzaWx5IGludGVyYWN0IHdpdGggdW5tYW5hZ2VkIChpLmUuCiAgICAgICAgV2luMzIgdW5tYW5hZ2VkKSBmdW5jdGlvbnMgaW4gUG93ZXJTaGVsbC4gQWZ0ZXIgcHJvdmlkaW5nCiAgICAgICAgQWRkLVdpbjMyVHlwZSB3aXRoIGEgZnVuY3Rpb24gc2lnbmF0dXJlLCBhIC5ORVQgdHlwZSBpcyBjcmVhdGVkCiAgICAgICAgdXNpbmcgcmVmbGVjdGlvbiAoaS5lLiBjc2MuZXhlIGlzIG5ldmVyIGNhbGxlZCBsaWtlIHdpdGggQWRkLVR5cGUpLgoKICAgICAgICBUaGUgJ2Z1bmMnIGhlbHBlciBmdW5jdGlvbiBjYW4gYmUgdXNlZCB0byByZWR1Y2UgdHlwaW5nIHdoZW4gZGVmaW5pbmcKICAgICAgICBtdWx0aXBsZSBmdW5jdGlvbiBkZWZpbml0aW9ucy4KCiAgICAuUEFSQU1FVEVSIERsbE5hbWUKCiAgICAgICAgVGhlIG5hbWUgb2YgdGhlIERMTC4KCiAgICAuUEFSQU1FVEVSIEZ1bmN0aW9uTmFtZQoKICAgICAgICBUaGUgbmFtZSBvZiB0aGUgdGFyZ2V0IGZ1bmN0aW9uLgoKICAgIC5QQVJBTUVURVIgUmV0dXJuVHlwZQoKICAgICAgICBUaGUgcmV0dXJuIHR5cGUgb2YgdGhlIGZ1bmN0aW9uLgoKICAgIC5QQVJBTUVURVIgUGFyYW1ldGVyVHlwZXMKCiAgICAgICAgVGhlIGZ1bmN0aW9uIHBhcmFtZXRlcnMuCgogICAgLlBBUkFNRVRFUiBOYXRpdmVDYWxsaW5nQ29udmVudGlvbgoKICAgICAgICBTcGVjaWZpZXMgdGhlIG5hdGl2ZSBjYWxsaW5nIGNvbnZlbnRpb24gb2YgdGhlIGZ1bmN0aW9uLiBEZWZhdWx0cyB0bwogICAgICAgIHN0ZGNhbGwuCgogICAgLlBBUkFNRVRFUiBDaGFyc2V0CgogICAgICAgIElmIHlvdSBuZWVkIHRvIGV4cGxpY2l0bHkgY2FsbCBhbiAnQScgb3IgJ1cnIFdpbjMyIGZ1bmN0aW9uLCB5b3UgY2FuCiAgICAgICAgc3BlY2lmeSB0aGUgY2hhcmFjdGVyIHNldC4KCiAgICAuUEFSQU1FVEVSIFNldExhc3RFcnJvcgoKICAgICAgICBJbmRpY2F0ZXMgd2hldGhlciB0aGUgY2FsbGVlIGNhbGxzIHRoZSBTZXRMYXN0RXJyb3IgV2luMzIgQVBJCiAgICAgICAgZnVuY3Rpb24gYmVmb3JlIHJldHVybmluZyBmcm9tIHRoZSBhdHRyaWJ1dGVkIG1ldGhvZC4KCiAgICAuUEFSQU1FVEVSIE1vZHVsZQoKICAgICAgICBUaGUgaW4tbWVtb3J5IG1vZHVsZSB0aGF0IHdpbGwgaG9zdCB0aGUgZnVuY3Rpb25zLiBVc2UKICAgICAgICBOZXctSW5NZW1vcnlNb2R1bGUgdG8gZGVmaW5lIGFuIGluLW1lbW9yeSBtb2R1bGUuCgogICAgLlBBUkFNRVRFUiBOYW1lc3BhY2UKCiAgICAgICAgQW4gb3B0aW9uYWwgbmFtZXNwYWNlIHRvIHByZXBlbmQgdG8gdGhlIHR5cGUuIEFkZC1XaW4zMlR5cGUgZGVmYXVsdHMKICAgICAgICB0byBhIG5hbWVzcGFjZSBjb25zaXN0aW5nIG9ubHkgb2YgdGhlIG5hbWUgb2YgdGhlIERMTC4KCiAgICAuRVhBTVBMRQoKICAgICAgICAkTW9kID0gTmV3LUluTWVtb3J5TW9kdWxlIC1Nb2R1bGVOYW1lIFdpbjMyCgogICAgICAgICRGdW5jdGlvbkRlZmluaXRpb25zID0gQCgKICAgICAgICAgIChmdW5jIGtlcm5lbDMyIEdldFByb2NBZGRyZXNzIChbSW50UHRyXSkgQChbSW50UHRyXSwgW1N0cmluZ10pIC1DaGFyc2V0IEFuc2kgLVNldExhc3RFcnJvciksCiAgICAgICAgICAoZnVuYyBrZXJuZWwzMiBHZXRNb2R1bGVIYW5kbGUgKFtJbnRwdHJdKSBAKFtTdHJpbmddKSAtU2V0TGFzdEVycm9yKSwKICAgICAgICAgIChmdW5jIG50ZGxsIFJ0bEdldEN1cnJlbnRQZWIgKFtJbnRQdHJdKSBAKCkpCiAgICAgICAgKQoKICAgICAgICAkVHlwZXMgPSAkRnVuY3Rpb25EZWZpbml0aW9ucyB8IEFkZC1XaW4zMlR5cGUgLU1vZHVsZSAkTW9kIC1OYW1lc3BhY2UgJ1dpbjMyJwogICAgICAgICRLZXJuZWwzMiA9ICRUeXBlc1sna2VybmVsMzInXQogICAgICAgICROdGRsbCA9ICRUeXBlc1snbnRkbGwnXQogICAgICAgICROdGRsbDo6UnRsR2V0Q3VycmVudFBlYigpCiAgICAgICAgJG50ZGxsYmFzZSA9ICRLZXJuZWwzMjo6R2V0TW9kdWxlSGFuZGxlKCdudGRsbCcpCiAgICAgICAgJEtlcm5lbDMyOjpHZXRQcm9jQWRkcmVzcygkbnRkbGxiYXNlLCAnUnRsR2V0Q3VycmVudFBlYicpCgogICAgLk5PVEVTCgogICAgICAgIEluc3BpcmVkIGJ5IExlZSBIb2xtZXMnIEludm9rZS1XaW5kb3dzQXBpIGh0dHA6Ly9wb3NoY29kZS5vcmcvMjE4OQoKICAgICAgICBXaGVuIGRlZmluaW5nIG11bHRpcGxlIGZ1bmN0aW9uIHByb3RvdHlwZXMsIGl0IGlzIGlkZWFsIHRvIHByb3ZpZGUKICAgICAgICBBZGQtV2luMzJUeXBlIHdpdGggYW4gYXJyYXkgb2YgZnVuY3Rpb24gc2lnbmF0dXJlcy4gVGhhdCB3YXksIHRoZXkKICAgICAgICBhcmUgYWxsIGluY29ycG9yYXRlZCBpbnRvIHRoZSBzYW1lIGluLW1lbW9yeSBtb2R1bGUuCiM+CgogICAgW091dHB1dFR5cGUoW0hhc2h0YWJsZV0pXQogICAgUGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREbGxOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZ1bmN0aW9uTmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbVHlwZV0KICAgICAgICAkUmV0dXJuVHlwZSwKCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQogICAgICAgIFtUeXBlW11dCiAgICAgICAgJFBhcmFtZXRlclR5cGVzLAoKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWUgPSAkVHJ1ZSldCiAgICAgICAgW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkNhbGxpbmdDb252ZW50aW9uXQogICAgICAgICROYXRpdmVDYWxsaW5nQ29udmVudGlvbiA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5DYWxsaW5nQ29udmVudGlvbl06OlN0ZENhbGwsCgogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuQ2hhclNldF0KICAgICAgICAkQ2hhcnNldCA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5DaGFyU2V0XTo6QXV0bywKCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNldExhc3RFcnJvciwKCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHsoJF8gLWlzIFtSZWZsZWN0aW9uLkVtaXQuTW9kdWxlQnVpbGRlcl0pIC1vciAoJF8gLWlzIFtSZWZsZWN0aW9uLkFzc2VtYmx5XSl9KV0KICAgICAgICAkTW9kdWxlLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsKCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkTmFtZXNwYWNlID0gJycKICAgICkKCiAgICBCRUdJTgogICAgewogICAgICAgICRUeXBlSGFzaCA9IEB7fQogICAgfQoKICAgIFBST0NFU1MKICAgIHsKICAgICAgICBpZiAoJE1vZHVsZSAtaXMgW1JlZmxlY3Rpb24uQXNzZW1ibHldKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKCROYW1lc3BhY2UpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRUeXBlSGFzaFskRGxsTmFtZV0gPSAkTW9kdWxlLkdldFR5cGUoIiROYW1lc3BhY2UuJERsbE5hbWUiKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJFR5cGVIYXNoWyREbGxOYW1lXSA9ICRNb2R1bGUuR2V0VHlwZSgkRGxsTmFtZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICAjIERlZmluZSBvbmUgdHlwZSBmb3IgZWFjaCBETEwKICAgICAgICAgICAgaWYgKCEkVHlwZUhhc2guQ29udGFpbnNLZXkoJERsbE5hbWUpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoJE5hbWVzcGFjZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkVHlwZUhhc2hbJERsbE5hbWVdID0gJE1vZHVsZS5EZWZpbmVUeXBlKCIkTmFtZXNwYWNlLiREbGxOYW1lIiwgJ1B1YmxpYyxCZWZvcmVGaWVsZEluaXQnKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRUeXBlSGFzaFskRGxsTmFtZV0gPSAkTW9kdWxlLkRlZmluZVR5cGUoJERsbE5hbWUsICdQdWJsaWMsQmVmb3JlRmllbGRJbml0JykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE1ldGhvZCA9ICRUeXBlSGFzaFskRGxsTmFtZV0uRGVmaW5lTWV0aG9kKAogICAgICAgICAgICAgICAgJEZ1bmN0aW9uTmFtZSwKICAgICAgICAgICAgICAgICdQdWJsaWMsU3RhdGljLFBpbnZva2VJbXBsJywKICAgICAgICAgICAgICAgICRSZXR1cm5UeXBlLAogICAgICAgICAgICAgICAgJFBhcmFtZXRlclR5cGVzKQoKICAgICAgICAgICAgIyBNYWtlIGVhY2ggQnlSZWYgcGFyYW1ldGVyIGFuIE91dCBwYXJhbWV0ZXIKICAgICAgICAgICAgJGkgPSAxCiAgICAgICAgICAgIEZvckVhY2goJFBhcmFtZXRlciBpbiAkUGFyYW1ldGVyVHlwZXMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICgkUGFyYW1ldGVyLklzQnlSZWYpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgW3ZvaWRdICRNZXRob2QuRGVmaW5lUGFyYW1ldGVyKCRpLCAnT3V0JywgJE51bGwpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGkrKwogICAgICAgICAgICB9CgogICAgICAgICAgICAkRGxsSW1wb3J0ID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkRsbEltcG9ydEF0dHJpYnV0ZV0KICAgICAgICAgICAgJFNldExhc3RFcnJvckZpZWxkID0gJERsbEltcG9ydC5HZXRGaWVsZCgnU2V0TGFzdEVycm9yJykKICAgICAgICAgICAgJENhbGxpbmdDb252ZW50aW9uRmllbGQgPSAkRGxsSW1wb3J0LkdldEZpZWxkKCdDYWxsaW5nQ29udmVudGlvbicpCiAgICAgICAgICAgICRDaGFyc2V0RmllbGQgPSAkRGxsSW1wb3J0LkdldEZpZWxkKCdDaGFyU2V0JykKICAgICAgICAgICAgaWYgKCRTZXRMYXN0RXJyb3IpIHsgJFNMRVZhbHVlID0gJFRydWUgfSBlbHNlIHsgJFNMRVZhbHVlID0gJEZhbHNlIH0KCiAgICAgICAgICAgICMgRXF1aXZhbGVudCB0byBDIyB2ZXJzaW9uIG9mIFtEbGxJbXBvcnQoRGxsTmFtZSldCiAgICAgICAgICAgICRDb25zdHJ1Y3RvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5EbGxJbXBvcnRBdHRyaWJ1dGVdLkdldENvbnN0cnVjdG9yKFtTdHJpbmddKQogICAgICAgICAgICAkRGxsSW1wb3J0QXR0cmlidXRlID0gTmV3LU9iamVjdCBSZWZsZWN0aW9uLkVtaXQuQ3VzdG9tQXR0cmlidXRlQnVpbGRlcigkQ29uc3RydWN0b3IsCiAgICAgICAgICAgICAgICAkRGxsTmFtZSwgW1JlZmxlY3Rpb24uUHJvcGVydHlJbmZvW11dIEAoKSwgW09iamVjdFtdXSBAKCksCiAgICAgICAgICAgICAgICBbUmVmbGVjdGlvbi5GaWVsZEluZm9bXV0gQCgkU2V0TGFzdEVycm9yRmllbGQsICRDYWxsaW5nQ29udmVudGlvbkZpZWxkLCAkQ2hhcnNldEZpZWxkKSwKICAgICAgICAgICAgICAgIFtPYmplY3RbXV0gQCgkU0xFVmFsdWUsIChbUnVudGltZS5JbnRlcm9wU2VydmljZXMuQ2FsbGluZ0NvbnZlbnRpb25dICROYXRpdmVDYWxsaW5nQ29udmVudGlvbiksIChbUnVudGltZS5JbnRlcm9wU2VydmljZXMuQ2hhclNldF0gJENoYXJzZXQpKSkKCiAgICAgICAgICAgICRNZXRob2QuU2V0Q3VzdG9tQXR0cmlidXRlKCREbGxJbXBvcnRBdHRyaWJ1dGUpCiAgICAgICAgfQogICAgfQoKICAgIEVORAogICAgewogICAgICAgIGlmICgkTW9kdWxlIC1pcyBbUmVmbGVjdGlvbi5Bc3NlbWJseV0pCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gJFR5cGVIYXNoCiAgICAgICAgfQoKICAgICAgICAkUmV0dXJuVHlwZXMgPSBAe30KCiAgICAgICAgRm9yRWFjaCAoJEtleSBpbiAkVHlwZUhhc2guS2V5cykKICAgICAgICB7CiAgICAgICAgICAgICRUeXBlID0gJFR5cGVIYXNoWyRLZXldLkNyZWF0ZVR5cGUoKQoKICAgICAgICAgICAgJFJldHVyblR5cGVzWyRLZXldID0gJFR5cGUKICAgICAgICB9CgogICAgICAgIHJldHVybiAkUmV0dXJuVHlwZXMKICAgIH0KfQoKCmZ1bmN0aW9uIHBzZW51bQp7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQ3JlYXRlcyBhbiBpbi1tZW1vcnkgZW51bWVyYXRpb24gZm9yIHVzZSBpbiB5b3VyIFBvd2VyU2hlbGwgc2Vzc2lvbi4KCiAgICAgICAgQXV0aG9yOiBNYXR0aGV3IEdyYWViZXIgKEBtYXR0aWZlc3RhdGlvbikKICAgICAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgICAgICBSZXF1aXJlZCBEZXBlbmRlbmNpZXM6IE5vbmUKICAgICAgICBPcHRpb25hbCBEZXBlbmRlbmNpZXM6IE5vbmUKICAgICAKICAgIC5ERVNDUklQVElPTgoKICAgICAgICBUaGUgJ3BzZW51bScgZnVuY3Rpb24gZmFjaWxpdGF0ZXMgdGhlIGNyZWF0aW9uIG9mIGVudW1zIGVudGlyZWx5IGluCiAgICAgICAgbWVtb3J5IHVzaW5nIGFzIGNsb3NlIHRvIGEgIkMgc3R5bGUiIGFzIFBvd2VyU2hlbGwgd2lsbCBhbGxvdy4KCiAgICAuUEFSQU1FVEVSIE1vZHVsZQoKICAgICAgICBUaGUgaW4tbWVtb3J5IG1vZHVsZSB0aGF0IHdpbGwgaG9zdCB0aGUgZW51bS4gVXNlCiAgICAgICAgTmV3LUluTWVtb3J5TW9kdWxlIHRvIGRlZmluZSBhbiBpbi1tZW1vcnkgbW9kdWxlLgoKICAgIC5QQVJBTUVURVIgRnVsbE5hbWUKCiAgICAgICAgVGhlIGZ1bGx5LXF1YWxpZmllZCBuYW1lIG9mIHRoZSBlbnVtLgoKICAgIC5QQVJBTUVURVIgVHlwZQoKICAgICAgICBUaGUgdHlwZSBvZiBlYWNoIGVudW0gZWxlbWVudC4KCiAgICAuUEFSQU1FVEVSIEVudW1FbGVtZW50cwoKICAgICAgICBBIGhhc2h0YWJsZSBvZiBlbnVtIGVsZW1lbnRzLgoKICAgIC5QQVJBTUVURVIgQml0ZmllbGQKCiAgICAgICAgU3BlY2lmaWVzIHRoYXQgdGhlIGVudW0gc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYSBiaXRmaWVsZC4KCiAgICAuRVhBTVBMRQoKICAgICAgICAkTW9kID0gTmV3LUluTWVtb3J5TW9kdWxlIC1Nb2R1bGVOYW1lIFdpbjMyCgogICAgICAgICRJbWFnZVN1YnN5c3RlbSA9IHBzZW51bSAkTW9kIFBFLklNQUdFX1NVQlNZU1RFTSBVSW50MTYgQHsKICAgICAgICAgICAgVU5LTk9XTiA9ICAgICAgICAgICAgICAgICAgMAogICAgICAgICAgICBOQVRJVkUgPSAgICAgICAgICAgICAgICAgICAxICMgSW1hZ2UgZG9lc24ndCByZXF1aXJlIGEgc3Vic3lzdGVtLgogICAgICAgICAgICBXSU5ET1dTX0dVSSA9ICAgICAgICAgICAgICAyICMgSW1hZ2UgcnVucyBpbiB0aGUgV2luZG93cyBHVUkgc3Vic3lzdGVtLgogICAgICAgICAgICBXSU5ET1dTX0NVSSA9ICAgICAgICAgICAgICAzICMgSW1hZ2UgcnVucyBpbiB0aGUgV2luZG93cyBjaGFyYWN0ZXIgc3Vic3lzdGVtLgogICAgICAgICAgICBPUzJfQ1VJID0gICAgICAgICAgICAgICAgICA1ICMgSW1hZ2UgcnVucyBpbiB0aGUgT1MvMiBjaGFyYWN0ZXIgc3Vic3lzdGVtLgogICAgICAgICAgICBQT1NJWF9DVUkgPSAgICAgICAgICAgICAgICA3ICMgSW1hZ2UgcnVucyBpbiB0aGUgUG9zaXggY2hhcmFjdGVyIHN1YnN5c3RlbS4KICAgICAgICAgICAgTkFUSVZFX1dJTkRPV1MgPSAgICAgICAgICAgOCAjIEltYWdlIGlzIGEgbmF0aXZlIFdpbjl4IGRyaXZlci4KICAgICAgICAgICAgV0lORE9XU19DRV9HVUkgPSAgICAgICAgICAgOSAjIEltYWdlIHJ1bnMgaW4gdGhlIFdpbmRvd3MgQ0Ugc3Vic3lzdGVtLgogICAgICAgICAgICBFRklfQVBQTElDQVRJT04gPSAgICAgICAgICAxMAogICAgICAgICAgICBFRklfQk9PVF9TRVJWSUNFX0RSSVZFUiA9ICAxMQogICAgICAgICAgICBFRklfUlVOVElNRV9EUklWRVIgPSAgICAgICAxMgogICAgICAgICAgICBFRklfUk9NID0gICAgICAgICAgICAgICAgICAxMwogICAgICAgICAgICBYQk9YID0gICAgICAgICAgICAgICAgICAgICAxNAogICAgICAgICAgICBXSU5ET1dTX0JPT1RfQVBQTElDQVRJT04gPSAxNgogICAgICAgIH0KCiAgICAuTk9URVMKCiAgICAgICAgUG93ZXJTaGVsbCBwdXJpc3RzIG1heSBkaXNhZ3JlZSB3aXRoIHRoZSBuYW1pbmcgb2YgdGhpcyBmdW5jdGlvbiBidXQKICAgICAgICBhZ2FpbiwgdGhpcyB3YXMgZGV2ZWxvcGVkIGluIHN1Y2ggYSB3YXkgc28gYXMgdG8gZW11bGF0ZSBhICJDIHN0eWxlIgogICAgICAgIGRlZmluaXRpb24gYXMgY2xvc2VseSBhcyBwb3NzaWJsZS4gU29ycnksIEknbSBub3QgZ29pbmcgdG8gbmFtZSBpdAogICAgICAgIE5ldy1FbnVtLiA6UAojPgoKICAgIFtPdXRwdXRUeXBlKFtUeXBlXSldCiAgICBQYXJhbQogICAgKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAwLCBNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHsoJF8gLWlzIFtSZWZsZWN0aW9uLkVtaXQuTW9kdWxlQnVpbGRlcl0pIC1vciAoJF8gLWlzIFtSZWZsZWN0aW9uLkFzc2VtYmx5XSl9KV0KICAgICAgICAkTW9kdWxlLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMSwgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRnVsbE5hbWUsCgogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAyLCBNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1R5cGVdCiAgICAgICAgJFR5cGUsCgogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAzLCBNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbSGFzaHRhYmxlXQogICAgICAgICRFbnVtRWxlbWVudHMsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEJpdGZpZWxkCiAgICApCgogICAgaWYgKCRNb2R1bGUgLWlzIFtSZWZsZWN0aW9uLkFzc2VtYmx5XSkKICAgIHsKICAgICAgICByZXR1cm4gKCRNb2R1bGUuR2V0VHlwZSgkRnVsbE5hbWUpKQogICAgfQoKICAgICRFbnVtVHlwZSA9ICRUeXBlIC1hcyBbVHlwZV0KCiAgICAkRW51bUJ1aWxkZXIgPSAkTW9kdWxlLkRlZmluZUVudW0oJEZ1bGxOYW1lLCAnUHVibGljJywgJEVudW1UeXBlKQoKICAgIGlmICgkQml0ZmllbGQpCiAgICB7CiAgICAgICAgJEZsYWdzQ29uc3RydWN0b3IgPSBbRmxhZ3NBdHRyaWJ1dGVdLkdldENvbnN0cnVjdG9yKEAoKSkKICAgICAgICAkRmxhZ3NDdXN0b21BdHRyaWJ1dGUgPSBOZXctT2JqZWN0IFJlZmxlY3Rpb24uRW1pdC5DdXN0b21BdHRyaWJ1dGVCdWlsZGVyKCRGbGFnc0NvbnN0cnVjdG9yLCBAKCkpCiAgICAgICAgJEVudW1CdWlsZGVyLlNldEN1c3RvbUF0dHJpYnV0ZSgkRmxhZ3NDdXN0b21BdHRyaWJ1dGUpCiAgICB9CgogICAgRm9yRWFjaCAoJEtleSBpbiAkRW51bUVsZW1lbnRzLktleXMpCiAgICB7CiAgICAgICAgIyBBcHBseSB0aGUgc3BlY2lmaWVkIGVudW0gdHlwZSB0byBlYWNoIGVsZW1lbnQKICAgICAgICAkTnVsbCA9ICRFbnVtQnVpbGRlci5EZWZpbmVMaXRlcmFsKCRLZXksICRFbnVtRWxlbWVudHNbJEtleV0gLWFzICRFbnVtVHlwZSkKICAgIH0KCiAgICAkRW51bUJ1aWxkZXIuQ3JlYXRlVHlwZSgpCn0KCgojIEEgaGVscGVyIGZ1bmN0aW9uIHVzZWQgdG8gcmVkdWNlIHR5cGluZyB3aGlsZSBkZWZpbmluZyBzdHJ1Y3QKIyBmaWVsZHMuCmZ1bmN0aW9uIGZpZWxkCnsKICAgIFBhcmFtCiAgICAoCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDAsIE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbVUludDE2XQogICAgICAgICRQb3NpdGlvbiwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDEsIE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbVHlwZV0KICAgICAgICAkVHlwZSwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDIpXQogICAgICAgIFtVSW50MTZdCiAgICAgICAgJE9mZnNldCwKCiAgICAgICAgW09iamVjdFtdXQogICAgICAgICRNYXJzaGFsQXMKICAgICkKCiAgICBAewogICAgICAgIFBvc2l0aW9uID0gJFBvc2l0aW9uCiAgICAgICAgVHlwZSA9ICRUeXBlIC1hcyBbVHlwZV0KICAgICAgICBPZmZzZXQgPSAkT2Zmc2V0CiAgICAgICAgTWFyc2hhbEFzID0gJE1hcnNoYWxBcwogICAgfQp9CgoKZnVuY3Rpb24gc3RydWN0CnsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBDcmVhdGVzIGFuIGluLW1lbW9yeSBzdHJ1Y3QgZm9yIHVzZSBpbiB5b3VyIFBvd2VyU2hlbGwgc2Vzc2lvbi4KCiAgICAgICAgQXV0aG9yOiBNYXR0aGV3IEdyYWViZXIgKEBtYXR0aWZlc3RhdGlvbikKICAgICAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgICAgICBSZXF1aXJlZCBEZXBlbmRlbmNpZXM6IE5vbmUKICAgICAgICBPcHRpb25hbCBEZXBlbmRlbmNpZXM6IGZpZWxkCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFRoZSAnc3RydWN0JyBmdW5jdGlvbiBmYWNpbGl0YXRlcyB0aGUgY3JlYXRpb24gb2Ygc3RydWN0cyBlbnRpcmVseSBpbgogICAgICAgIG1lbW9yeSB1c2luZyBhcyBjbG9zZSB0byBhICJDIHN0eWxlIiBhcyBQb3dlclNoZWxsIHdpbGwgYWxsb3cuIFN0cnVjdAogICAgICAgIGZpZWxkcyBhcmUgc3BlY2lmaWVkIHVzaW5nIGEgaGFzaHRhYmxlIHdoZXJlIGVhY2ggZmllbGQgb2YgdGhlIHN0cnVjdAogICAgICAgIGlzIGNvbXByb3NlZCBvZiB0aGUgb3JkZXIgaW4gd2hpY2ggaXQgc2hvdWxkIGJlIGRlZmluZWQsIGl0cyAuTkVUCiAgICAgICAgdHlwZSwgYW5kIG9wdGlvbmFsbHksIGl0cyBvZmZzZXQgYW5kIHNwZWNpYWwgbWFyc2hhbGluZyBhdHRyaWJ1dGVzLgoKICAgICAgICBPbmUgb2YgdGhlIGZlYXR1cmVzIG9mICdzdHJ1Y3QnIGlzIHRoYXQgYWZ0ZXIgeW91ciBzdHJ1Y3QgaXMgZGVmaW5lZCwKICAgICAgICBpdCB3aWxsIGNvbWUgd2l0aCBhIGJ1aWx0LWluIEdldFNpemUgbWV0aG9kIGFzIHdlbGwgYXMgYW4gZXhwbGljaXQKICAgICAgICBjb252ZXJ0ZXIgc28gdGhhdCB5b3UgY2FuIGVhc2lseSBjYXN0IGFuIEludFB0ciB0byB0aGUgc3RydWN0IHdpdGhvdXQKICAgICAgICByZWx5aW5nIHVwb24gY2FsbGluZyBTaXplT2YgYW5kL29yIFB0clRvU3RydWN0dXJlIGluIHRoZSBNYXJzaGFsCiAgICAgICAgY2xhc3MuCgogICAgLlBBUkFNRVRFUiBNb2R1bGUKCiAgICAgICAgVGhlIGluLW1lbW9yeSBtb2R1bGUgdGhhdCB3aWxsIGhvc3QgdGhlIHN0cnVjdC4gVXNlCiAgICAgICAgTmV3LUluTWVtb3J5TW9kdWxlIHRvIGRlZmluZSBhbiBpbi1tZW1vcnkgbW9kdWxlLgoKICAgIC5QQVJBTUVURVIgRnVsbE5hbWUKCiAgICAgICAgVGhlIGZ1bGx5LXF1YWxpZmllZCBuYW1lIG9mIHRoZSBzdHJ1Y3QuCgogICAgLlBBUkFNRVRFUiBTdHJ1Y3RGaWVsZHMKCiAgICAgICAgQSBoYXNodGFibGUgb2YgZmllbGRzLiBVc2UgdGhlICdmaWVsZCcgaGVscGVyIGZ1bmN0aW9uIHRvIGVhc2UKICAgICAgICBkZWZpbmluZyBlYWNoIGZpZWxkLgoKICAgIC5QQVJBTUVURVIgUGFja2luZ1NpemUKCiAgICAgICAgU3BlY2lmaWVzIHRoZSBtZW1vcnkgYWxpZ25tZW50IG9mIGZpZWxkcy4KCiAgICAuUEFSQU1FVEVSIEV4cGxpY2l0TGF5b3V0CgogICAgICAgIEluZGljYXRlcyB0aGF0IGFuIGV4cGxpY2l0IG9mZnNldCBmb3IgZWFjaCBmaWVsZCB3aWxsIGJlIHNwZWNpZmllZC4KCiAgICAuRVhBTVBMRQoKICAgICAgICAkTW9kID0gTmV3LUluTWVtb3J5TW9kdWxlIC1Nb2R1bGVOYW1lIFdpbjMyCgogICAgICAgICRJbWFnZURvc1NpZ25hdHVyZSA9IHBzZW51bSAkTW9kIFBFLklNQUdFX0RPU19TSUdOQVRVUkUgVUludDE2IEB7CiAgICAgICAgICAgIERPU19TSUdOQVRVUkUgPSAgICAweDVBNEQKICAgICAgICAgICAgT1MyX1NJR05BVFVSRSA9ICAgIDB4NDU0RQogICAgICAgICAgICBPUzJfU0lHTkFUVVJFX0xFID0gMHg0NTRDCiAgICAgICAgICAgIFZYRF9TSUdOQVRVUkUgPSAgICAweDQ1NEMKICAgICAgICB9CgogICAgICAgICRJbWFnZURvc0hlYWRlciA9IHN0cnVjdCAkTW9kIFBFLklNQUdFX0RPU19IRUFERVIgQHsKICAgICAgICAgICAgZV9tYWdpYyA9ICAgIGZpZWxkIDAgJEltYWdlRG9zU2lnbmF0dXJlCiAgICAgICAgICAgIGVfY2JscCA9ICAgICBmaWVsZCAxIFVJbnQxNgogICAgICAgICAgICBlX2NwID0gICAgICAgZmllbGQgMiBVSW50MTYKICAgICAgICAgICAgZV9jcmxjID0gICAgIGZpZWxkIDMgVUludDE2CiAgICAgICAgICAgIGVfY3BhcmhkciA9ICBmaWVsZCA0IFVJbnQxNgogICAgICAgICAgICBlX21pbmFsbG9jID0gZmllbGQgNSBVSW50MTYKICAgICAgICAgICAgZV9tYXhhbGxvYyA9IGZpZWxkIDYgVUludDE2CiAgICAgICAgICAgIGVfc3MgPSAgICAgICBmaWVsZCA3IFVJbnQxNgogICAgICAgICAgICBlX3NwID0gICAgICAgZmllbGQgOCBVSW50MTYKICAgICAgICAgICAgZV9jc3VtID0gICAgIGZpZWxkIDkgVUludDE2CiAgICAgICAgICAgIGVfaXAgPSAgICAgICBmaWVsZCAxMCBVSW50MTYKICAgICAgICAgICAgZV9jcyA9ICAgICAgIGZpZWxkIDExIFVJbnQxNgogICAgICAgICAgICBlX2xmYXJsYyA9ICAgZmllbGQgMTIgVUludDE2CiAgICAgICAgICAgIGVfb3ZubyA9ICAgICBmaWVsZCAxMyBVSW50MTYKICAgICAgICAgICAgZV9yZXMgPSAgICAgIGZpZWxkIDE0IFVJbnQxNltdIC1NYXJzaGFsQXMgQCgnQnlWYWxBcnJheScsIDQpCiAgICAgICAgICAgIGVfb2VtaWQgPSAgICBmaWVsZCAxNSBVSW50MTYKICAgICAgICAgICAgZV9vZW1pbmZvID0gIGZpZWxkIDE2IFVJbnQxNgogICAgICAgICAgICBlX3JlczIgPSAgICAgZmllbGQgMTcgVUludDE2W10gLU1hcnNoYWxBcyBAKCdCeVZhbEFycmF5JywgMTApCiAgICAgICAgICAgIGVfbGZhbmV3ID0gICBmaWVsZCAxOCBJbnQzMgogICAgICAgIH0KCiAgICAgICAgIyBFeGFtcGxlIG9mIHVzaW5nIGFuIGV4cGxpY2l0IGxheW91dCBpbiBvcmRlciB0byBjcmVhdGUgYSB1bmlvbi4KICAgICAgICAkVGVzdFVuaW9uID0gc3RydWN0ICRNb2QgVGVzdFVuaW9uIEB7CiAgICAgICAgICAgIGZpZWxkMSA9IGZpZWxkIDAgVUludDMyIDAKICAgICAgICAgICAgZmllbGQyID0gZmllbGQgMSBJbnRQdHIgMAogICAgICAgIH0gLUV4cGxpY2l0TGF5b3V0CgogICAgLk5PVEVTCgogICAgICAgIFBvd2VyU2hlbGwgcHVyaXN0cyBtYXkgZGlzYWdyZWUgd2l0aCB0aGUgbmFtaW5nIG9mIHRoaXMgZnVuY3Rpb24gYnV0CiAgICAgICAgYWdhaW4sIHRoaXMgd2FzIGRldmVsb3BlZCBpbiBzdWNoIGEgd2F5IHNvIGFzIHRvIGVtdWxhdGUgYSAiQyBzdHlsZSIKICAgICAgICBkZWZpbml0aW9uIGFzIGNsb3NlbHkgYXMgcG9zc2libGUuIFNvcnJ5LCBJJ20gbm90IGdvaW5nIHRvIG5hbWUgaXQKICAgICAgICBOZXctU3RydWN0LiA6UAojPgoKICAgIFtPdXRwdXRUeXBlKFtUeXBlXSldCiAgICBQYXJhbQogICAgKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAxLCBNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHsoJF8gLWlzIFtSZWZsZWN0aW9uLkVtaXQuTW9kdWxlQnVpbGRlcl0pIC1vciAoJF8gLWlzIFtSZWZsZWN0aW9uLkFzc2VtYmx5XSl9KV0KICAgICAgICAkTW9kdWxlLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMiwgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRnVsbE5hbWUsCgogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAzLCBNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbSGFzaHRhYmxlXQogICAgICAgICRTdHJ1Y3RGaWVsZHMsCgogICAgICAgIFtSZWZsZWN0aW9uLkVtaXQuUGFja2luZ1NpemVdCiAgICAgICAgJFBhY2tpbmdTaXplID0gW1JlZmxlY3Rpb24uRW1pdC5QYWNraW5nU2l6ZV06OlVuc3BlY2lmaWVkLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRFeHBsaWNpdExheW91dAogICAgKQoKICAgIGlmICgkTW9kdWxlIC1pcyBbUmVmbGVjdGlvbi5Bc3NlbWJseV0pCiAgICB7CiAgICAgICAgcmV0dXJuICgkTW9kdWxlLkdldFR5cGUoJEZ1bGxOYW1lKSkKICAgIH0KCiAgICBbUmVmbGVjdGlvbi5UeXBlQXR0cmlidXRlc10gJFN0cnVjdEF0dHJpYnV0ZXMgPSAnQW5zaUNsYXNzLAogICAgICAgIENsYXNzLAogICAgICAgIFB1YmxpYywKICAgICAgICBTZWFsZWQsCiAgICAgICAgQmVmb3JlRmllbGRJbml0JwoKICAgIGlmICgkRXhwbGljaXRMYXlvdXQpCiAgICB7CiAgICAgICAgJFN0cnVjdEF0dHJpYnV0ZXMgPSAkU3RydWN0QXR0cmlidXRlcyAtYm9yIFtSZWZsZWN0aW9uLlR5cGVBdHRyaWJ1dGVzXTo6RXhwbGljaXRMYXlvdXQKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICAkU3RydWN0QXR0cmlidXRlcyA9ICRTdHJ1Y3RBdHRyaWJ1dGVzIC1ib3IgW1JlZmxlY3Rpb24uVHlwZUF0dHJpYnV0ZXNdOjpTZXF1ZW50aWFsTGF5b3V0CiAgICB9CgogICAgJFN0cnVjdEJ1aWxkZXIgPSAkTW9kdWxlLkRlZmluZVR5cGUoJEZ1bGxOYW1lLCAkU3RydWN0QXR0cmlidXRlcywgW1ZhbHVlVHlwZV0sICRQYWNraW5nU2l6ZSkKICAgICRDb25zdHJ1Y3RvckluZm8gPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbEFzQXR0cmlidXRlXS5HZXRDb25zdHJ1Y3RvcnMoKVswXQogICAgJFNpemVDb25zdCA9IEAoW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxBc0F0dHJpYnV0ZV0uR2V0RmllbGQoJ1NpemVDb25zdCcpKQoKICAgICRGaWVsZHMgPSBOZXctT2JqZWN0IEhhc2h0YWJsZVtdKCRTdHJ1Y3RGaWVsZHMuQ291bnQpCgogICAgIyBTb3J0IGVhY2ggZmllbGQgYWNjb3JkaW5nIHRvIHRoZSBvcmRlcnMgc3BlY2lmaWVkCiAgICAjIFVuZm9ydHVuYXRlbHksIFBTdjIgZG9lc24ndCBoYXZlIHRoZSBsdXh1cnkgb2YgdGhlCiAgICAjIGhhc2h0YWJsZSBbT3JkZXJlZF0gYWNjZWxlcmF0b3IuCiAgICBGb3JFYWNoICgkRmllbGQgaW4gJFN0cnVjdEZpZWxkcy5LZXlzKQogICAgewogICAgICAgICRJbmRleCA9ICRTdHJ1Y3RGaWVsZHNbJEZpZWxkXVsnUG9zaXRpb24nXQogICAgICAgICRGaWVsZHNbJEluZGV4XSA9IEB7RmllbGROYW1lID0gJEZpZWxkOyBQcm9wZXJ0aWVzID0gJFN0cnVjdEZpZWxkc1skRmllbGRdfQogICAgfQoKICAgIEZvckVhY2ggKCRGaWVsZCBpbiAkRmllbGRzKQogICAgewogICAgICAgICRGaWVsZE5hbWUgPSAkRmllbGRbJ0ZpZWxkTmFtZSddCiAgICAgICAgJEZpZWxkUHJvcCA9ICRGaWVsZFsnUHJvcGVydGllcyddCgogICAgICAgICRPZmZzZXQgPSAkRmllbGRQcm9wWydPZmZzZXQnXQogICAgICAgICRUeXBlID0gJEZpZWxkUHJvcFsnVHlwZSddCiAgICAgICAgJE1hcnNoYWxBcyA9ICRGaWVsZFByb3BbJ01hcnNoYWxBcyddCgogICAgICAgICROZXdGaWVsZCA9ICRTdHJ1Y3RCdWlsZGVyLkRlZmluZUZpZWxkKCRGaWVsZE5hbWUsICRUeXBlLCAnUHVibGljJykKCiAgICAgICAgaWYgKCRNYXJzaGFsQXMpCiAgICAgICAgewogICAgICAgICAgICAkVW5tYW5hZ2VkVHlwZSA9ICRNYXJzaGFsQXNbMF0gLWFzIChbUnVudGltZS5JbnRlcm9wU2VydmljZXMuVW5tYW5hZ2VkVHlwZV0pCiAgICAgICAgICAgIGlmICgkTWFyc2hhbEFzWzFdKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkU2l6ZSA9ICRNYXJzaGFsQXNbMV0KICAgICAgICAgICAgICAgICRBdHRyaWJCdWlsZGVyID0gTmV3LU9iamVjdCBSZWZsZWN0aW9uLkVtaXQuQ3VzdG9tQXR0cmlidXRlQnVpbGRlcigkQ29uc3RydWN0b3JJbmZvLAogICAgICAgICAgICAgICAgICAgICRVbm1hbmFnZWRUeXBlLCAkU2l6ZUNvbnN0LCBAKCRTaXplKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRBdHRyaWJCdWlsZGVyID0gTmV3LU9iamVjdCBSZWZsZWN0aW9uLkVtaXQuQ3VzdG9tQXR0cmlidXRlQnVpbGRlcigkQ29uc3RydWN0b3JJbmZvLCBbT2JqZWN0W11dIEAoJFVubWFuYWdlZFR5cGUpKQogICAgICAgICAgICB9CgogICAgICAgICAgICAkTmV3RmllbGQuU2V0Q3VzdG9tQXR0cmlidXRlKCRBdHRyaWJCdWlsZGVyKQogICAgICAgIH0KCiAgICAgICAgaWYgKCRFeHBsaWNpdExheW91dCkgeyAkTmV3RmllbGQuU2V0T2Zmc2V0KCRPZmZzZXQpIH0KICAgIH0KCiAgICAjIE1ha2UgdGhlIHN0cnVjdCBhd2FyZSBvZiBpdHMgb3duIHNpemUuCiAgICAjIE5vIG1vcmUgaGF2aW5nIHRvIGNhbGwgW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpTaXplT2YhCiAgICAkU2l6ZU1ldGhvZCA9ICRTdHJ1Y3RCdWlsZGVyLkRlZmluZU1ldGhvZCgnR2V0U2l6ZScsCiAgICAgICAgJ1B1YmxpYywgU3RhdGljJywKICAgICAgICBbSW50XSwKICAgICAgICBbVHlwZVtdXSBAKCkpCiAgICAkSUxHZW5lcmF0b3IgPSAkU2l6ZU1ldGhvZC5HZXRJTEdlbmVyYXRvcigpCiAgICAjIFRoYW5rcyBmb3IgdGhlIGhlbHAsIEphc29uIFNoaXJrIQogICAgJElMR2VuZXJhdG9yLkVtaXQoW1JlZmxlY3Rpb24uRW1pdC5PcENvZGVzXTo6TGR0b2tlbiwgJFN0cnVjdEJ1aWxkZXIpCiAgICAkSUxHZW5lcmF0b3IuRW1pdChbUmVmbGVjdGlvbi5FbWl0Lk9wQ29kZXNdOjpDYWxsLAogICAgICAgIFtUeXBlXS5HZXRNZXRob2QoJ0dldFR5cGVGcm9tSGFuZGxlJykpCiAgICAkSUxHZW5lcmF0b3IuRW1pdChbUmVmbGVjdGlvbi5FbWl0Lk9wQ29kZXNdOjpDYWxsLAogICAgICAgIFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXS5HZXRNZXRob2QoJ1NpemVPZicsIFtUeXBlW11dIEAoW1R5cGVdKSkpCiAgICAkSUxHZW5lcmF0b3IuRW1pdChbUmVmbGVjdGlvbi5FbWl0Lk9wQ29kZXNdOjpSZXQpCgogICAgIyBBbGxvdyBmb3IgZXhwbGljaXQgY2FzdGluZyBmcm9tIGFuIEludFB0cgogICAgIyBObyBtb3JlIGhhdmluZyB0byBjYWxsIFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UHRyVG9TdHJ1Y3R1cmUhCiAgICAkSW1wbGljaXRDb252ZXJ0ZXIgPSAkU3RydWN0QnVpbGRlci5EZWZpbmVNZXRob2QoJ29wX0ltcGxpY2l0JywKICAgICAgICAnUHJpdmF0ZVNjb3BlLCBQdWJsaWMsIFN0YXRpYywgSGlkZUJ5U2lnLCBTcGVjaWFsTmFtZScsCiAgICAgICAgJFN0cnVjdEJ1aWxkZXIsCiAgICAgICAgW1R5cGVbXV0gQChbSW50UHRyXSkpCiAgICAkSUxHZW5lcmF0b3IyID0gJEltcGxpY2l0Q29udmVydGVyLkdldElMR2VuZXJhdG9yKCkKICAgICRJTEdlbmVyYXRvcjIuRW1pdChbUmVmbGVjdGlvbi5FbWl0Lk9wQ29kZXNdOjpOb3ApCiAgICAkSUxHZW5lcmF0b3IyLkVtaXQoW1JlZmxlY3Rpb24uRW1pdC5PcENvZGVzXTo6TGRhcmdfMCkKICAgICRJTEdlbmVyYXRvcjIuRW1pdChbUmVmbGVjdGlvbi5FbWl0Lk9wQ29kZXNdOjpMZHRva2VuLCAkU3RydWN0QnVpbGRlcikKICAgICRJTEdlbmVyYXRvcjIuRW1pdChbUmVmbGVjdGlvbi5FbWl0Lk9wQ29kZXNdOjpDYWxsLAogICAgICAgIFtUeXBlXS5HZXRNZXRob2QoJ0dldFR5cGVGcm9tSGFuZGxlJykpCiAgICAkSUxHZW5lcmF0b3IyLkVtaXQoW1JlZmxlY3Rpb24uRW1pdC5PcENvZGVzXTo6Q2FsbCwKICAgICAgICBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF0uR2V0TWV0aG9kKCdQdHJUb1N0cnVjdHVyZScsIFtUeXBlW11dIEAoW0ludFB0cl0sIFtUeXBlXSkpKQogICAgJElMR2VuZXJhdG9yMi5FbWl0KFtSZWZsZWN0aW9uLkVtaXQuT3BDb2Rlc106OlVuYm94X0FueSwgJFN0cnVjdEJ1aWxkZXIpCiAgICAkSUxHZW5lcmF0b3IyLkVtaXQoW1JlZmxlY3Rpb24uRW1pdC5PcENvZGVzXTo6UmV0KQoKICAgICRTdHJ1Y3RCdWlsZGVyLkNyZWF0ZVR5cGUoKQp9CgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojIE1pc2MuIGhlbHBlcnMKIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZmlsdGVyIEdldC1JbmlDb250ZW50IHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGhlbHBlciBwYXJzZXMgYW4gLmluaSBmaWxlIGludG8gYSBwcm9wZXIgUG93ZXJTaGVsbCBvYmplY3QuCiAgICAgICAgCiAgICAgICAgQXV0aG9yOiAnVGhlIFNjcmlwdGluZyBHdXlzJwogICAgICAgIExpbms6IGh0dHBzOi8vYmxvZ3MudGVjaG5ldC5taWNyb3NvZnQuY29tL2hleXNjcmlwdGluZ2d1eS8yMDExLzA4LzIwL3VzZS1wb3dlcnNoZWxsLXRvLXdvcmstd2l0aC1hbnktaW5pLWZpbGUvCgogICAgLkxJTksKCiAgICAgICAgaHR0cHM6Ly9ibG9ncy50ZWNobmV0Lm1pY3Jvc29mdC5jb20vaGV5c2NyaXB0aW5nZ3V5LzIwMTEvMDgvMjAvdXNlLXBvd2Vyc2hlbGwtdG8td29yay13aXRoLWFueS1pbmktZmlsZS8KIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JFRydWUpXQogICAgICAgIFtBbGlhcygnRnVsbE5hbWUnKV0KICAgICAgICBbVmFsaWRhdGVTY3JpcHQoeyBUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgICRQYXRoCiAgICApCgogICAgRm9yRWFjaCgkVGFyZ2V0UGF0aCBpbiAkUGF0aCkgewogICAgICAgICRJbmlPYmplY3QgPSBAe30KICAgICAgICBTd2l0Y2ggLVJlZ2V4IC1GaWxlICRUYXJnZXRQYXRoIHsKICAgICAgICAgICAgIl5cWyguKylcXSIgIyBTZWN0aW9uCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRTZWN0aW9uID0gJG1hdGNoZXNbMV0uVHJpbSgpCiAgICAgICAgICAgICAgICAkSW5pT2JqZWN0WyRTZWN0aW9uXSA9IEB7fQogICAgICAgICAgICAgICAgJENvbW1lbnRDb3VudCA9IDAKICAgICAgICAgICAgfQogICAgICAgICAgICAiXig7LiopJCIgIyBDb21tZW50CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRWYWx1ZSA9ICRtYXRjaGVzWzFdLlRyaW0oKQogICAgICAgICAgICAgICAgJENvbW1lbnRDb3VudCA9ICRDb21tZW50Q291bnQgKyAxCiAgICAgICAgICAgICAgICAkTmFtZSA9ICdDb21tZW50JyArICRDb21tZW50Q291bnQKICAgICAgICAgICAgICAgICRJbmlPYmplY3RbJFNlY3Rpb25dWyROYW1lXSA9ICRWYWx1ZQogICAgICAgICAgICB9IAogICAgICAgICAgICAiKC4rPylccyo9KC4qKSIgIyBLZXkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJE5hbWUsICRWYWx1ZSA9ICRtYXRjaGVzWzEuLjJdCiAgICAgICAgICAgICAgICAkTmFtZSA9ICROYW1lLlRyaW0oKQogICAgICAgICAgICAgICAgJFZhbHVlcyA9ICRWYWx1ZS5zcGxpdCgnLCcpIHwgRm9yRWFjaC1PYmplY3QgeyRfLlRyaW0oKX0KICAgICAgICAgICAgICAgIGlmKCRWYWx1ZXMgLWlzbm90IFtTeXN0ZW0uQXJyYXldKSB7JFZhbHVlcyA9IEAoJFZhbHVlcyl9CiAgICAgICAgICAgICAgICAkSW5pT2JqZWN0WyRTZWN0aW9uXVskTmFtZV0gPSAkVmFsdWVzCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJEluaU9iamVjdAogICAgfQp9CgpmaWx0ZXIgRXhwb3J0LVBvd2VyVmlld0NTViB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBoZWxwZXIgZXhwb3J0cyBhbiAtSW5wdXRPYmplY3QgdG8gYSAuY3N2IGluIGEgdGhyZWFkLXNhZmUgbWFubmVyCiAgICAgICAgdXNpbmcgYSBtdXRleC4gVGhpcyBpcyBzbyB0aGUgdmFyaW91cyBtdWx0aS10aHJlYWRlZCBmdW5jdGlvbnMgaW4KICAgICAgICBQb3dlclZpZXcgaGFzIGEgdGhyZWFkLXNhZmUgd2F5IHRvIGV4cG9ydCBvdXRwdXQgdG8gdGhlIHNhbWUgZmlsZS4KICAgICAgICAKICAgICAgICBCYXNlZCBwYXJ0aWFsbHkgb24gRG1pdHJ5IFNvdG5pa292J3MgRXhwb3J0LUNTViBjb2RlCiAgICAgICAgICAgIGF0IGh0dHA6Ly9wb3NoY29kZS5vcmcvMTU5MAoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly9wb3NoY29kZS5vcmcvMTU5MAogICAgICAgIGh0dHA6Ly9kbWl0cnlzb3RuaWtvdi53b3JkcHJlc3MuY29tLzIwMTAvMDEvMTkvRXhwb3J0LUNzdi1hcHBlbmQvCiM+CiAgICBQYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JFRydWUpXQogICAgICAgIFtTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTT2JqZWN0W11dCiAgICAgICAgJElucHV0T2JqZWN0LAoKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgUG9zaXRpb249MCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRPdXRGaWxlCiAgICApCgogICAgJE9iamVjdENTViA9ICRJbnB1dE9iamVjdCB8IENvbnZlcnRUby1Dc3YgLU5vVHlwZUluZm9ybWF0aW9uCgogICAgIyBtdXRleCBzbyB0aHJlYWRlZCBjb2RlIGRvZXNuJ3Qgc3RvbXAgb24gdGhlIG91dHB1dCBmaWxlCiAgICAkTXV0ZXggPSBOZXctT2JqZWN0IFN5c3RlbS5UaHJlYWRpbmcuTXV0ZXggJEZhbHNlLCdDU1ZNdXRleCc7CiAgICAkTnVsbCA9ICRNdXRleC5XYWl0T25lKCkKCiAgICBpZiAoVGVzdC1QYXRoIC1QYXRoICRPdXRGaWxlKSB7CiAgICAgICAgIyBoYWNrIHRvIHNraXAgdGhlIGZpcnN0IGxpbmUgb2Ygb3V0cHV0IGlmIHRoZSBmaWxlIGFscmVhZHkgZXhpc3RzCiAgICAgICAgJE9iamVjdENTViB8IEZvckVhY2gtT2JqZWN0IHsgJFN0YXJ0PSRUcnVlIH17IGlmICgkU3RhcnQpIHskU3RhcnQ9JEZhbHNlfSBlbHNlIHskX30gfSB8IE91dC1GaWxlIC1FbmNvZGluZyAnQVNDSUknIC1BcHBlbmQgLUZpbGVQYXRoICRPdXRGaWxlCiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkT2JqZWN0Q1NWIHwgT3V0LUZpbGUgLUVuY29kaW5nICdBU0NJSScgLUFwcGVuZCAtRmlsZVBhdGggJE91dEZpbGUKICAgIH0KCiAgICAkTXV0ZXguUmVsZWFzZU11dGV4KCkKfQoKCmZpbHRlciBHZXQtSVBBZGRyZXNzIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXNvbHZlcyBhIGdpdmVuIGhvc3RlbmFtZSB0byBpdHMgYXNzb2NpYXRlZCBJUHY0IGFkZHJlc3MuIAogICAgICAgIElmIG5vIGhvc3RuYW1lIGlzIHByb3ZpZGVkLCBpdCBkZWZhdWx0cyB0byByZXR1cm5pbmcKICAgICAgICB0aGUgSVAgYWRkcmVzcyBvZiB0aGUgbG9jYWxob3N0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUlQQWRkcmVzcyAtQ29tcHV0ZXJOYW1lIFNFUlZFUgogICAgICAgIAogICAgICAgIFJldHVybiB0aGUgSVB2NCBhZGRyZXNzIG9mICdTRVJWRVInCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtQ29udGVudCAuXGhvc3RuYW1lcy50eHQgfCBHZXQtSVBBZGRyZXNzCgogICAgICAgIEdldCB0aGUgSVAgYWRkcmVzc2VzIG9mIGFsbCBob3N0bmFtZXMgaW4gYW4gaW5wdXQgZmlsZS4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICRFbnY6Q29tcHV0ZXJOYW1lCiAgICApCgogICAgdHJ5IHsKICAgICAgICAjIGV4dHJhY3QgdGhlIGNvbXB1dGVyIG5hbWUgZnJvbSB3aGF0ZXZlciBvYmplY3Qgd2FzIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICAgICAkQ29tcHV0ZXIgPSAkQ29tcHV0ZXJOYW1lIHwgR2V0LU5hbWVGaWVsZAoKICAgICAgICAjIGdldCB0aGUgSVAgcmVzb2x1dGlvbiBvZiB0aGlzIHNwZWNpZmllZCBob3N0bmFtZQogICAgICAgIEAoKFtOZXQuRG5zXTo6R2V0SG9zdEVudHJ5KCRDb21wdXRlcikpLkFkZHJlc3NMaXN0KSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgaWYgKCRfLkFkZHJlc3NGYW1pbHkgLWVxICdJbnRlck5ldHdvcmsnKSB7CiAgICAgICAgICAgICAgICAkT3V0ID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgogICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJUEFkZHJlc3MnICRfLklQQWRkcmVzc1RvU3RyaW5nCiAgICAgICAgICAgICAgICAkT3V0CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBjYXRjaCB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAnQ291bGQgbm90IHJlc29sdmUgaG9zdCB0byBhbiBJUCBBZGRyZXNzLicKICAgIH0KfQoKCmZpbHRlciBDb252ZXJ0LU5hbWVUb1NpZCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQ29udmVydHMgYSBnaXZlbiB1c2VyL2dyb3VwIG5hbWUgdG8gYSBzZWN1cml0eSBpZGVudGlmaWVyIChTSUQpLgoKICAgIC5QQVJBTUVURVIgT2JqZWN0TmFtZQoKICAgICAgICBUaGUgdXNlci9ncm91cCBuYW1lIHRvIGNvbnZlcnQsIGNhbiBiZSAndXNlcicgb3IgJ0RPTUFJTlx1c2VyJyBmb3JtYXQuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgU3BlY2lmaWMgZG9tYWluIGZvciB0aGUgZ2l2ZW4gdXNlciBhY2NvdW50LCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBDb252ZXJ0LU5hbWVUb1NpZCAnREVWXGRmbScKIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgW0FsaWFzKCdOYW1lJyldCiAgICAgICAgJE9iamVjdE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbgogICAgKQoKICAgICRPYmplY3ROYW1lID0gJE9iamVjdE5hbWUgLVJlcGxhY2UgIi8iLCJcIgogICAgCiAgICBpZigkT2JqZWN0TmFtZS5Db250YWlucygiXCIpKSB7CiAgICAgICAgIyBpZiB3ZSBnZXQgYSBET01BSU5cdXNlciBmb3JtYXQsIGF1dG8gY29udmVydCBpdAogICAgICAgICREb21haW4gPSAkT2JqZWN0TmFtZS5TcGxpdCgiXCIpWzBdCiAgICAgICAgJE9iamVjdE5hbWUgPSAkT2JqZWN0TmFtZS5TcGxpdCgiXCIpWzFdCiAgICB9CiAgICBlbHNlaWYoLW5vdCAkRG9tYWluKSB7CiAgICAgICAgJERvbWFpbiA9IChHZXQtTmV0RG9tYWluKS5OYW1lCiAgICB9CgogICAgdHJ5IHsKICAgICAgICAkT2JqID0gKE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5OVEFjY291bnQoJERvbWFpbiwgJE9iamVjdE5hbWUpKQogICAgICAgICRTSUQgPSAkT2JqLlRyYW5zbGF0ZShbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXJdKS5WYWx1ZQogICAgICAgIAogICAgICAgICRPdXQgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdPYmplY3ROYW1lJyAkT2JqZWN0TmFtZQogICAgICAgICRPdXQgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU0lEJyAkU0lECiAgICAgICAgJE91dAogICAgfQogICAgY2F0Y2ggewogICAgICAgIFdyaXRlLVZlcmJvc2UgIkludmFsaWQgb2JqZWN0L25hbWU6ICREb21haW5cJE9iamVjdE5hbWUiCiAgICAgICAgJE51bGwKICAgIH0KfQoKCmZpbHRlciBDb252ZXJ0LVNpZFRvTmFtZSB7CjwjCiAgICAuU1lOT1BTSVMKICAgIAogICAgICAgIENvbnZlcnRzIGEgc2VjdXJpdHkgaWRlbnRpZmllciAoU0lEKSB0byBhIGdyb3VwL3VzZXIgbmFtZS4KCiAgICAuUEFSQU1FVEVSIFNJRAogICAgCiAgICAgICAgVGhlIFNJRCB0byBjb252ZXJ0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gQ29udmVydC1TaWRUb05hbWUgUy0xLTUtMjEtMjYyMDg5MTgyOS0yNDExMjYxNDk3LTE3NzM4NTMwODgtMTEwNQojPgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVQYXR0ZXJuKCdeUy0xLS4qJyldCiAgICAgICAgJFNJRAogICAgKQoKICAgIHRyeSB7CiAgICAgICAgJFNJRDIgPSAkU0lELnRyaW0oJyonKQoKICAgICAgICAjIHRyeSB0byByZXNvbHZlIGFueSBidWlsdC1pbiBTSURzIGZpcnN0CiAgICAgICAgIyAgIGZyb20gaHR0cHM6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20vZW4tdXMva2IvMjQzMzMwCiAgICAgICAgU3dpdGNoICgkU0lEMikgewogICAgICAgICAgICAnUy0xLTAnICAgICAgICAgeyAnTnVsbCBBdXRob3JpdHknIH0KICAgICAgICAgICAgJ1MtMS0wLTAnICAgICAgIHsgJ05vYm9keScgfQogICAgICAgICAgICAnUy0xLTEnICAgICAgICAgeyAnV29ybGQgQXV0aG9yaXR5JyB9CiAgICAgICAgICAgICdTLTEtMS0wJyAgICAgICB7ICdFdmVyeW9uZScgfQogICAgICAgICAgICAnUy0xLTInICAgICAgICAgeyAnTG9jYWwgQXV0aG9yaXR5JyB9CiAgICAgICAgICAgICdTLTEtMi0wJyAgICAgICB7ICdMb2NhbCcgfQogICAgICAgICAgICAnUy0xLTItMScgICAgICAgeyAnQ29uc29sZSBMb2dvbiAnIH0KICAgICAgICAgICAgJ1MtMS0zJyAgICAgICAgIHsgJ0NyZWF0b3IgQXV0aG9yaXR5JyB9CiAgICAgICAgICAgICdTLTEtMy0wJyAgICAgICB7ICdDcmVhdG9yIE93bmVyJyB9CiAgICAgICAgICAgICdTLTEtMy0xJyAgICAgICB7ICdDcmVhdG9yIEdyb3VwJyB9CiAgICAgICAgICAgICdTLTEtMy0yJyAgICAgICB7ICdDcmVhdG9yIE93bmVyIFNlcnZlcicgfQogICAgICAgICAgICAnUy0xLTMtMycgICAgICAgeyAnQ3JlYXRvciBHcm91cCBTZXJ2ZXInIH0KICAgICAgICAgICAgJ1MtMS0zLTQnICAgICAgIHsgJ093bmVyIFJpZ2h0cycgfQogICAgICAgICAgICAnUy0xLTQnICAgICAgICAgeyAnTm9uLXVuaXF1ZSBBdXRob3JpdHknIH0KICAgICAgICAgICAgJ1MtMS01JyAgICAgICAgIHsgJ05UIEF1dGhvcml0eScgfQogICAgICAgICAgICAnUy0xLTUtMScgICAgICAgeyAnRGlhbHVwJyB9CiAgICAgICAgICAgICdTLTEtNS0yJyAgICAgICB7ICdOZXR3b3JrJyB9CiAgICAgICAgICAgICdTLTEtNS0zJyAgICAgICB7ICdCYXRjaCcgfQogICAgICAgICAgICAnUy0xLTUtNCcgICAgICAgeyAnSW50ZXJhY3RpdmUnIH0KICAgICAgICAgICAgJ1MtMS01LTYnICAgICAgIHsgJ1NlcnZpY2UnIH0KICAgICAgICAgICAgJ1MtMS01LTcnICAgICAgIHsgJ0Fub255bW91cycgfQogICAgICAgICAgICAnUy0xLTUtOCcgICAgICAgeyAnUHJveHknIH0KICAgICAgICAgICAgJ1MtMS01LTknICAgICAgIHsgJ0VudGVycHJpc2UgRG9tYWluIENvbnRyb2xsZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0xMCcgICAgICB7ICdQcmluY2lwYWwgU2VsZicgfQogICAgICAgICAgICAnUy0xLTUtMTEnICAgICAgeyAnQXV0aGVudGljYXRlZCBVc2VycycgfQogICAgICAgICAgICAnUy0xLTUtMTInICAgICAgeyAnUmVzdHJpY3RlZCBDb2RlJyB9CiAgICAgICAgICAgICdTLTEtNS0xMycgICAgICB7ICdUZXJtaW5hbCBTZXJ2ZXIgVXNlcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTE0JyAgICAgIHsgJ1JlbW90ZSBJbnRlcmFjdGl2ZSBMb2dvbicgfQogICAgICAgICAgICAnUy0xLTUtMTUnICAgICAgeyAnVGhpcyBPcmdhbml6YXRpb24gJyB9CiAgICAgICAgICAgICdTLTEtNS0xNycgICAgICB7ICdUaGlzIE9yZ2FuaXphdGlvbiAnIH0KICAgICAgICAgICAgJ1MtMS01LTE4JyAgICAgIHsgJ0xvY2FsIFN5c3RlbScgfQogICAgICAgICAgICAnUy0xLTUtMTknICAgICAgeyAnTlQgQXV0aG9yaXR5JyB9CiAgICAgICAgICAgICdTLTEtNS0yMCcgICAgICB7ICdOVCBBdXRob3JpdHknIH0KICAgICAgICAgICAgJ1MtMS01LTgwLTAnICAgIHsgJ0FsbCBTZXJ2aWNlcyAnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU0NCcgIHsgJ0JVSUxUSU5cQWRtaW5pc3RyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU0NScgIHsgJ0JVSUxUSU5cVXNlcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU0NicgIHsgJ0JVSUxUSU5cR3Vlc3RzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NDcnICB7ICdCVUlMVElOXFBvd2VyIFVzZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NDgnICB7ICdCVUlMVElOXEFjY291bnQgT3BlcmF0b3JzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NDknICB7ICdCVUlMVElOXFNlcnZlciBPcGVyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU1MCcgIHsgJ0JVSUxUSU5cUHJpbnQgT3BlcmF0b3JzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NTEnICB7ICdCVUlMVElOXEJhY2t1cCBPcGVyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU1MicgIHsgJ0JVSUxUSU5cUmVwbGljYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU1NCcgIHsgJ0JVSUxUSU5cUHJlLVdpbmRvd3MgMjAwMCBDb21wYXRpYmxlIEFjY2VzcycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTU1JyAgeyAnQlVJTFRJTlxSZW1vdGUgRGVza3RvcCBVc2VycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTU2JyAgeyAnQlVJTFRJTlxOZXR3b3JrIENvbmZpZ3VyYXRpb24gT3BlcmF0b3JzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NTcnICB7ICdCVUlMVElOXEluY29taW5nIEZvcmVzdCBUcnVzdCBCdWlsZGVycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTU4JyAgeyAnQlVJTFRJTlxQZXJmb3JtYW5jZSBNb25pdG9yIFVzZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NTknICB7ICdCVUlMVElOXFBlcmZvcm1hbmNlIExvZyBVc2VycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTYwJyAgeyAnQlVJTFRJTlxXaW5kb3dzIEF1dGhvcml6YXRpb24gQWNjZXNzIEdyb3VwJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NjEnICB7ICdCVUlMVElOXFRlcm1pbmFsIFNlcnZlciBMaWNlbnNlIFNlcnZlcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU2MicgIHsgJ0JVSUxUSU5cRGlzdHJpYnV0ZWQgQ09NIFVzZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NjknICB7ICdCVUlMVElOXENyeXB0b2dyYXBoaWMgT3BlcmF0b3JzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NzMnICB7ICdCVUlMVElOXEV2ZW50IExvZyBSZWFkZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NzQnICB7ICdCVUlMVElOXENlcnRpZmljYXRlIFNlcnZpY2UgRENPTSBBY2Nlc3MnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU3NScgIHsgJ0JVSUxUSU5cUkRTIFJlbW90ZSBBY2Nlc3MgU2VydmVycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTc2JyAgeyAnQlVJTFRJTlxSRFMgRW5kcG9pbnQgU2VydmVycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTc3JyAgeyAnQlVJTFRJTlxSRFMgTWFuYWdlbWVudCBTZXJ2ZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NzgnICB7ICdCVUlMVElOXEh5cGVyLVYgQWRtaW5pc3RyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU3OScgIHsgJ0JVSUxUSU5cQWNjZXNzIENvbnRyb2wgQXNzaXN0YW5jZSBPcGVyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU4MCcgIHsgJ0JVSUxUSU5cQWNjZXNzIENvbnRyb2wgQXNzaXN0YW5jZSBPcGVyYXRvcnMnIH0KICAgICAgICAgICAgRGVmYXVsdCB7IAogICAgICAgICAgICAgICAgJE9iaiA9IChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyKCRTSUQyKSkKICAgICAgICAgICAgICAgICRPYmouVHJhbnNsYXRlKCBbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5OVEFjY291bnRdKS5WYWx1ZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgY2F0Y2ggewogICAgICAgIFdyaXRlLVZlcmJvc2UgIkludmFsaWQgU0lEOiAkU0lEIgogICAgICAgICRTSUQKICAgIH0KfQoKCmZpbHRlciBDb252ZXJ0LUFETmFtZSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQ29udmVydHMgdXNlci9ncm91cCBuYW1lcyBmcm9tIE5UNCAoRE9NQUlOXHVzZXIpIG9yIGRvbWFpblNpbXBsZSAodXNlckBkb21haW4uY29tKQogICAgICAgIHRvIGNhbm9uaWNhbCBmb3JtYXQgKGRvbWFpbi5jb20vVXNlcnMvdXNlcikgb3IgTlQ0LgoKICAgICAgICBCYXNlZCBvbiBCaWxsIFN0ZXdhcnQncyBjb2RlIGZyb20gdGhpcyBhcnRpY2xlOiAKICAgICAgICAgICAgaHR0cDovL3dpbmRvd3NpdHByby5jb20vYWN0aXZlLWRpcmVjdG9yeS90cmFuc2xhdGluZy1hY3RpdmUtZGlyZWN0b3J5LW9iamVjdC1uYW1lcy1iZXR3ZWVuLWZvcm1hdHMKCiAgICAuUEFSQU1FVEVSIE9iamVjdE5hbWUKCiAgICAgICAgVGhlIHVzZXIvZ3JvdXAgbmFtZSB0byBjb252ZXJ0LgoKICAgIC5QQVJBTUVURVIgSW5wdXRUeXBlCgogICAgICAgIFRoZSBJbnB1dFR5cGUgb2YgdGhlIHVzZXIvZ3JvdXAgbmFtZSAoIk5UNCIsIlNpbXBsZSIsIkNhbm9uaWNhbCIpLgoKICAgIC5QQVJBTUVURVIgT3V0cHV0VHlwZQoKICAgICAgICBUaGUgT3V0cHV0VHlwZSBvZiB0aGUgdXNlci9ncm91cCBuYW1lICgiTlQ0IiwiU2ltcGxlIiwiQ2Fub25pY2FsIikuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBDb252ZXJ0LUFETmFtZSAtT2JqZWN0TmFtZSAiZGV2XGRmbSIKICAgICAgICAKICAgICAgICBSZXR1cm5zICJkZXYudGVzdGxhYi5sb2NhbC9Vc2Vycy9EYXZlIgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gQ29udmVydC1TaWRUb05hbWUgIlMtLi4uIiB8IENvbnZlcnQtQUROYW1lCiAgICAgICAgCiAgICAgICAgUmV0dXJucyB0aGUgY2Fub25pY2FsIG5hbWUgZm9yIHRoZSByZXNvbHZlZCBTSUQuCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL3dpbmRvd3NpdHByby5jb20vYWN0aXZlLWRpcmVjdG9yeS90cmFuc2xhdGluZy1hY3RpdmUtZGlyZWN0b3J5LW9iamVjdC1uYW1lcy1iZXR3ZWVuLWZvcm1hdHMKIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE9iamVjdE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlU2V0KCJOVDQiLCJTaW1wbGUiLCJDYW5vbmljYWwiKV0KICAgICAgICAkSW5wdXRUeXBlLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZVNldCgiTlQ0IiwiU2ltcGxlIiwiQ2Fub25pY2FsIildCiAgICAgICAgJE91dHB1dFR5cGUKICAgICkKCiAgICAkTmFtZVR5cGVzID0gQHsKICAgICAgICAiQ2Fub25pY2FsIiA9IDIKICAgICAgICAiTlQ0IiAgICAgICA9IDMKICAgICAgICAiU2ltcGxlIiAgICA9IDUKICAgIH0KCiAgICBpZighJFBTQm91bmRQYXJhbWV0ZXJzWydJbnB1dFR5cGUnXSkgewogICAgICAgIGlmKCAoJE9iamVjdE5hbWUuc3BsaXQoJy8nKSkuQ291bnQgLWVxIDIgKSB7CiAgICAgICAgICAgICRPYmplY3ROYW1lID0gJE9iamVjdE5hbWUucmVwbGFjZSgnLycsICdcJykKICAgICAgICB9CgogICAgICAgIGlmKCRPYmplY3ROYW1lIC1tYXRjaCAiXltBLVphLXpdK1xcW0EtWmEteiBdKyQiKSB7CiAgICAgICAgICAgICRJbnB1dFR5cGUgPSAnTlQ0JwogICAgICAgIH0KICAgICAgICBlbHNlaWYoJE9iamVjdE5hbWUgLW1hdGNoICJeW0EtWmEteiBdK0BbQS1aYS16XC5dKyIpIHsKICAgICAgICAgICAgJElucHV0VHlwZSA9ICdTaW1wbGUnCiAgICAgICAgfQogICAgICAgIGVsc2VpZigkT2JqZWN0TmFtZSAtbWF0Y2ggIl5bQS1aYS16XC5dKy9bQS1aYS16XSsvW0EtWmEtei8gXSsiKSB7CiAgICAgICAgICAgICRJbnB1dFR5cGUgPSAnQ2Fub25pY2FsJwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiQ2FuIG5vdCBpZGVudGlmeSBJblR5cGUgZm9yICRPYmplY3ROYW1lIgogICAgICAgICAgICByZXR1cm4gJE9iamVjdE5hbWUKICAgICAgICB9CiAgICB9CiAgICBlbHNlaWYoJElucHV0VHlwZSAtZXEgJ05UNCcpIHsKICAgICAgICAkT2JqZWN0TmFtZSA9ICRPYmplY3ROYW1lLnJlcGxhY2UoJy8nLCAnXCcpCiAgICB9CgogICAgaWYoISRQU0JvdW5kUGFyYW1ldGVyc1snT3V0cHV0VHlwZSddKSB7CiAgICAgICAgJE91dHB1dFR5cGUgPSBTd2l0Y2goJElucHV0VHlwZSkgewogICAgICAgICAgICAnTlQ0JyB7J0Nhbm9uaWNhbCd9CiAgICAgICAgICAgICdTaW1wbGUnIHsnTlQ0J30KICAgICAgICAgICAgJ0Nhbm9uaWNhbCcgeydOVDQnfQogICAgICAgIH0KICAgIH0KCiAgICAjIHRyeSB0byBleHRyYWN0IHRoZSBkb21haW4gZnJvbSB0aGUgZ2l2ZW4gZm9ybWF0CiAgICAkRG9tYWluID0gU3dpdGNoKCRJbnB1dFR5cGUpIHsKICAgICAgICAnTlQ0JyB7ICRPYmplY3ROYW1lLnNwbGl0KCJcIilbMF0gfQogICAgICAgICdTaW1wbGUnIHsgJE9iamVjdE5hbWUuc3BsaXQoIkAiKVsxXSB9CiAgICAgICAgJ0Nhbm9uaWNhbCcgeyAkT2JqZWN0TmFtZS5zcGxpdCgiLyIpWzBdIH0KICAgIH0KCiAgICAjIEFjY2Vzc29yIGZ1bmN0aW9ucyB0byBzaW1wbGlmeSBjYWxscyB0byBOYW1lVHJhbnNsYXRlCiAgICBmdW5jdGlvbiBJbnZva2UtTWV0aG9kKFtfX0NvbU9iamVjdF0gJE9iamVjdCwgW1N0cmluZ10gJE1ldGhvZCwgJFBhcmFtZXRlcnMpIHsKICAgICAgICAkT3V0cHV0ID0gJE9iamVjdC5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCRNZXRob2QsICJJbnZva2VNZXRob2QiLCAkTnVsbCwgJE9iamVjdCwgJFBhcmFtZXRlcnMpCiAgICAgICAgaWYgKCAkT3V0cHV0ICkgeyAkT3V0cHV0IH0KICAgIH0KICAgIGZ1bmN0aW9uIFNldC1Qcm9wZXJ0eShbX19Db21PYmplY3RdICRPYmplY3QsIFtTdHJpbmddICRQcm9wZXJ0eSwgJFBhcmFtZXRlcnMpIHsKICAgICAgICBbVm9pZF0gJE9iamVjdC5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCRQcm9wZXJ0eSwgIlNldFByb3BlcnR5IiwgJE51bGwsICRPYmplY3QsICRQYXJhbWV0ZXJzKQogICAgfQoKICAgICRUcmFuc2xhdGUgPSBOZXctT2JqZWN0IC1Db21PYmplY3QgTmFtZVRyYW5zbGF0ZQoKICAgIHRyeSB7CiAgICAgICAgSW52b2tlLU1ldGhvZCAkVHJhbnNsYXRlICJJbml0IiAoMSwgJERvbWFpbikKICAgIH0KICAgIGNhdGNoIFtTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLk1ldGhvZEludm9jYXRpb25FeGNlcHRpb25dIHsgCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3Igd2l0aCB0cmFuc2xhdGUgaW5pdCBpbiBDb252ZXJ0LUFETmFtZTogJF8iCiAgICB9CgogICAgU2V0LVByb3BlcnR5ICRUcmFuc2xhdGUgIkNoYXNlUmVmZXJyYWwiICgweDYwKQoKICAgIHRyeSB7CiAgICAgICAgSW52b2tlLU1ldGhvZCAkVHJhbnNsYXRlICJTZXQiICgkTmFtZVR5cGVzWyRJbnB1dFR5cGVdLCAkT2JqZWN0TmFtZSkKICAgICAgICAoSW52b2tlLU1ldGhvZCAkVHJhbnNsYXRlICJHZXQiICgkTmFtZVR5cGVzWyRPdXRwdXRUeXBlXSkpCiAgICB9CiAgICBjYXRjaCBbU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5NZXRob2RJbnZvY2F0aW9uRXhjZXB0aW9uXSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3Igd2l0aCB0cmFuc2xhdGUgU2V0L0dldCBpbiBDb252ZXJ0LUFETmFtZTogJF8iCiAgICB9Cn0KCgpmdW5jdGlvbiBDb252ZXJ0RnJvbS1VQUNWYWx1ZSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQ29udmVydHMgYSBVQUMgaW50IHZhbHVlIHRvIGh1bWFuIHJlYWRhYmxlIGZvcm0uCgogICAgLlBBUkFNRVRFUiBWYWx1ZQoKICAgICAgICBUaGUgaW50IFVBQyB2YWx1ZSB0byBjb252ZXJ0LgoKICAgIC5QQVJBTUVURVIgU2hvd0FsbAoKICAgICAgICBTaG93IGFsbCBVQUMgdmFsdWVzLCB3aXRoIGEgKyBpbmRpY2F0aW5nIHRoZSB2YWx1ZSBpcyBjdXJyZW50bHkgc2V0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gQ29udmVydEZyb20tVUFDVmFsdWUgLVZhbHVlIDY2MTc2CgogICAgICAgIENvbnZlcnQgdGhlIFVBQyB2YWx1ZSA2NjE3NiB0byBodW1hbiByZWFkYWJsZSBmb3JtYXQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0VXNlciBqYXNvbiB8IHNlbGVjdCB1c2VyYWNjb3VudGNvbnRyb2wgfCBDb252ZXJ0RnJvbS1VQUNWYWx1ZQoKICAgICAgICBDb252ZXJ0IHRoZSBVQUMgdmFsdWUgZm9yICdqYXNvbicgdG8gaHVtYW4gcmVhZGFibGUgZm9ybWF0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldFVzZXIgamFzb24gfCBzZWxlY3QgdXNlcmFjY291bnRjb250cm9sIHwgQ29udmVydEZyb20tVUFDVmFsdWUgLVNob3dBbGwKCiAgICAgICAgQ29udmVydCB0aGUgVUFDIHZhbHVlIGZvciAnamFzb24nIHRvIGh1bWFuIHJlYWRhYmxlIGZvcm1hdCwgc2hvd2luZyBhbGwKICAgICAgICBwb3NzaWJsZSBVQUMgdmFsdWVzLgojPgogICAgCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICAkVmFsdWUsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNob3dBbGwKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgIyB2YWx1ZXMgZnJvbSBodHRwczovL3N1cHBvcnQubWljcm9zb2Z0LmNvbS9lbi11cy9rYi8zMDUxNDQKICAgICAgICAkVUFDVmFsdWVzID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuU3BlY2lhbGl6ZWQuT3JkZXJlZERpY3Rpb25hcnkKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiU0NSSVBUIiwgMSkKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiQUNDT1VOVERJU0FCTEUiLCAyKQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJIT01FRElSX1JFUVVJUkVEIiwgOCkKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiTE9DS09VVCIsIDE2KQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJQQVNTV0RfTk9UUkVRRCIsIDMyKQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJQQVNTV0RfQ0FOVF9DSEFOR0UiLCA2NCkKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiRU5DUllQVEVEX1RFWFRfUFdEX0FMTE9XRUQiLCAxMjgpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIlRFTVBfRFVQTElDQVRFX0FDQ09VTlQiLCAyNTYpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIk5PUk1BTF9BQ0NPVU5UIiwgNTEyKQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJJTlRFUkRPTUFJTl9UUlVTVF9BQ0NPVU5UIiwgMjA0OCkKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiV09SS1NUQVRJT05fVFJVU1RfQUNDT1VOVCIsIDQwOTYpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIlNFUlZFUl9UUlVTVF9BQ0NPVU5UIiwgODE5MikKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiRE9OVF9FWFBJUkVfUEFTU1dPUkQiLCA2NTUzNikKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiTU5TX0xPR09OX0FDQ09VTlQiLCAxMzEwNzIpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIlNNQVJUQ0FSRF9SRVFVSVJFRCIsIDI2MjE0NCkKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiVFJVU1RFRF9GT1JfREVMRUdBVElPTiIsIDUyNDI4OCkKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiTk9UX0RFTEVHQVRFRCIsIDEwNDg1NzYpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIlVTRV9ERVNfS0VZX09OTFkiLCAyMDk3MTUyKQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJET05UX1JFUV9QUkVBVVRIIiwgNDE5NDMwNCkKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiUEFTU1dPUkRfRVhQSVJFRCIsIDgzODg2MDgpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIlRSVVNURURfVE9fQVVUSF9GT1JfREVMRUdBVElPTiIsIDE2Nzc3MjE2KQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJQQVJUSUFMX1NFQ1JFVFNfQUNDT1VOVCIsIDY3MTA4ODY0KQogICAgfQoKICAgIHByb2Nlc3MgewoKICAgICAgICAkUmVzdWx0VUFDVmFsdWVzID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuU3BlY2lhbGl6ZWQuT3JkZXJlZERpY3Rpb25hcnkKCiAgICAgICAgaWYoJFZhbHVlIC1pcyBbSW50XSkgewogICAgICAgICAgICAkSW50VmFsdWUgPSAkVmFsdWUKICAgICAgICB9CiAgICAgICAgZWxzZWlmICgkVmFsdWUgLWlzIFtQU0N1c3RvbU9iamVjdF0pIHsKICAgICAgICAgICAgaWYoJFZhbHVlLnVzZXJhY2NvdW50Y29udHJvbCkgewogICAgICAgICAgICAgICAgJEludFZhbHVlID0gJFZhbHVlLnVzZXJhY2NvdW50Y29udHJvbAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJJbnZhbGlkIG9iamVjdCBpbnB1dCBmb3IgLVZhbHVlIDogJFZhbHVlIgogICAgICAgICAgICByZXR1cm4gJE51bGwgCiAgICAgICAgfQoKICAgICAgICBpZigkU2hvd0FsbCkgewogICAgICAgICAgICBmb3JlYWNoICgkVUFDVmFsdWUgaW4gJFVBQ1ZhbHVlcy5HZXRFbnVtZXJhdG9yKCkpIHsKICAgICAgICAgICAgICAgIGlmKCAoJEludFZhbHVlIC1iYW5kICRVQUNWYWx1ZS5WYWx1ZSkgLWVxICRVQUNWYWx1ZS5WYWx1ZSkgewogICAgICAgICAgICAgICAgICAgICRSZXN1bHRVQUNWYWx1ZXMuQWRkKCRVQUNWYWx1ZS5OYW1lLCAiJCgkVUFDVmFsdWUuVmFsdWUpKyIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0VUFDVmFsdWVzLkFkZCgkVUFDVmFsdWUuTmFtZSwgIiQoJFVBQ1ZhbHVlLlZhbHVlKSIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRVQUNWYWx1ZSBpbiAkVUFDVmFsdWVzLkdldEVudW1lcmF0b3IoKSkgewogICAgICAgICAgICAgICAgaWYoICgkSW50VmFsdWUgLWJhbmQgJFVBQ1ZhbHVlLlZhbHVlKSAtZXEgJFVBQ1ZhbHVlLlZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdFVBQ1ZhbHVlcy5BZGQoJFVBQ1ZhbHVlLk5hbWUsICIkKCRVQUNWYWx1ZS5WYWx1ZSkiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRSZXN1bHRVQUNWYWx1ZXMKICAgIH0KfQoKCmZpbHRlciBHZXQtUHJveHkgewo8IwogICAgLlNZTk9QU0lTCiAgICAKICAgICAgICBFbnVtZXJhdGVzIHRoZSBwcm94eSBzZXJ2ZXIgYW5kIFdQQUQgY29uZW50cyBmb3IgdGhlIGN1cnJlbnQgdXNlci4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBUaGUgY29tcHV0ZXJuYW1lIHRvIGVudW1lcmF0ZSBwcm94eSBzZXR0aW5ncyBvbiwgZGVmYXVsdHMgdG8gbG9jYWwgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Qcm94eSAKICAgICAgICAKICAgICAgICBSZXR1cm5zIHRoZSBjdXJyZW50IHByb3h5IHNldHRpbmdzLgojPgogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlck5hbWUgPSAkRU5WOkNPTVBVVEVSTkFNRQogICAgKQoKICAgIHRyeSB7CiAgICAgICAgJFJlZyA9IFtNaWNyb3NvZnQuV2luMzIuUmVnaXN0cnlLZXldOjpPcGVuUmVtb3RlQmFzZUtleSgnQ3VycmVudFVzZXInLCAkQ29tcHV0ZXJOYW1lKQogICAgICAgICRSZWdLZXkgPSAkUmVnLk9wZW5TdWJrZXkoIlNPRlRXQVJFXFxNaWNyb3NvZnRcXFdpbmRvd3NcXEN1cnJlbnRWZXJzaW9uXFxJbnRlcm5ldCBTZXR0aW5ncyIpCiAgICAgICAgJFByb3h5U2VydmVyID0gJFJlZ0tleS5HZXRWYWx1ZSgnUHJveHlTZXJ2ZXInKQogICAgICAgICRBdXRvQ29uZmlnVVJMID0gJFJlZ0tleS5HZXRWYWx1ZSgnQXV0b0NvbmZpZ1VSTCcpCgogICAgICAgICRXcGFkID0gIiIKICAgICAgICBpZigkQXV0b0NvbmZpZ1VSTCAtYW5kICgkQXV0b0NvbmZpZ1VSTCAtbmUgIiIpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkV3BhZCA9IChOZXctT2JqZWN0IE5ldC5XZWJjbGllbnQpLkRvd25sb2FkU3RyaW5nKCRBdXRvQ29uZmlnVVJMKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkVycm9yIGNvbm5lY3RpbmcgdG8gQXV0b0NvbmZpZ1VSTCA6ICRBdXRvQ29uZmlnVVJMIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmKCRQcm94eVNlcnZlciAtb3IgJEF1dG9Db25maWdVcmwpIHsKCiAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICdQcm94eVNlcnZlcicgPSAkUHJveHlTZXJ2ZXIKICAgICAgICAgICAgICAgICdBdXRvQ29uZmlnVVJMJyA9ICRBdXRvQ29uZmlnVVJMCiAgICAgICAgICAgICAgICAnV3BhZCcgPSAkV3BhZAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAtUHJvcGVydHkgJFByb3BlcnRpZXMKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIk5vIHByb3h5IHNldHRpbmdzIGZvdW5kIGZvciAkQ29tcHV0ZXJOYW1lIgogICAgICAgIH0KICAgIH0KICAgIGNhdGNoIHsKICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBlbnVtZXJhdGluZyBwcm94eSBzZXR0aW5ncyBmb3IgJENvbXB1dGVyTmFtZSA6ICRfIgogICAgfQp9CgoKZnVuY3Rpb24gUmVxdWVzdC1TUE5UaWNrZXQgewo8IwogICAgLlNZTk9QU0lTCiAgICAKICAgICAgICBSZXF1ZXN0IHRoZSBrZXJiZXJvcyB0aWNrZXQgZm9yIGEgc3BlY2lmaWVkIHNlcnZpY2UgcHJpbmNpcGFsIG5hbWUgKFNQTikuCiAgICAKICAgIC5QQVJBTUVURVIgU1BOCgogICAgICAgIFRoZSBzZXJ2aWNlIHByaW5jaXBhbCBuYW1lIHRvIHJlcXVlc3QgdGhlIHRpY2tldCBmb3IuIFJlcXVpcmVkLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gUmVxdWVzdC1TUE5UaWNrZXQgLVNQTiAiSFRUUC93ZWIudGVzdGxhYi5sb2NhbCIKICAgIAogICAgICAgIFJlcXVlc3QgYSBrZXJiZXJvcyBzZXJ2aWNlIHRpY2tldCBmb3IgdGhlIHNwZWNpZmllZCBTUE4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiAiSFRUUC93ZWIxLnRlc3RsYWIubG9jYWwiLCJIVFRQL3dlYjIudGVzdGxhYi5sb2NhbCIgfCBSZXF1ZXN0LVNQTlRpY2tldAoKICAgICAgICBSZXF1ZXN0IGtlcmJlcm9zIHNlcnZpY2UgdGlja2V0cyBmb3IgYWxsIFNQTnMgcGFzc2VkIG9uIHRoZSBwaXBlbGluZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRVc2VyIC1TUE4gfCBSZXF1ZXN0LVNQTlRpY2tldAoKICAgICAgICBSZXF1ZXN0IGtlcmJlcm9zIHNlcnZpY2UgdGlja2V0cyBmb3IgYWxsIHVzZXJzIHdpdGggbm9uLW51bGwgU1BOcy4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQogICAgICAgIFtBbGlhcygnU2VydmljZVByaW5jaXBhbE5hbWUnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJFNQTgogICAgKQoKICAgIGJlZ2luIHsKICAgICAgICBBZGQtVHlwZSAtQXNzZW1ibHlOYW1lIFN5c3RlbS5JZGVudGl0eU1vZGVsCiAgICB9CgogICAgcHJvY2VzcyB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiUmVxdWVzdGluZyB0aWNrZXQgZm9yOiAkU1BOIgogICAgICAgIE5ldy1PYmplY3QgU3lzdGVtLklkZW50aXR5TW9kZWwuVG9rZW5zLktlcmJlcm9zUmVxdWVzdG9yU2VjdXJpdHlUb2tlbiAtQXJndW1lbnRMaXN0ICRTUE4KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1QYXRoQWNsIHsKPCMKICAgIC5TWU5PUFNJUwogICAgCiAgICAgICAgRW51bWVyYXRlcyB0aGUgQUNMIGZvciBhIGdpdmVuIGZpbGUgcGF0aC4KCiAgICAuUEFSQU1FVEVSIFBhdGgKCiAgICAgICAgVGhlIGxvY2FsL3JlbW90ZSBwYXRoIHRvIGVudW1lcmF0ZSB0aGUgQUNMcyBmb3IuCgogICAgLlBBUkFNRVRFUiBSZWN1cnNlCiAgICAgICAgCiAgICAgICAgSWYgYW55IEFDTCByZXN1bHRzIGFyZSBncm91cHMsIHJlY3Vyc2UgYW5kIHJldHJpZXZlIHVzZXIgbWVtYmVyc2hpcC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1QYXRoQWNsICJcXFNFUlZFUlxTaGFyZVwiIAogICAgICAgIAogICAgICAgIFJldHVybnMgQUNMcyBmb3IgdGhlIGdpdmVuIFVOQyBzaGFyZS4KIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFBhdGgsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlY3Vyc2UKICAgICkKCiAgICBiZWdpbiB7CgogICAgICAgIGZ1bmN0aW9uIENvbnZlcnQtRmlsZVJpZ2h0IHsKCiAgICAgICAgICAgICMgRnJvbSBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzI4MDI5ODcyL3JldHJpZXZpbmctc2VjdXJpdHktZGVzY3JpcHRvci1hbmQtZ2V0dGluZy1udW1iZXItZm9yLWZpbGVzeXN0ZW1yaWdodHMKCiAgICAgICAgICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICAgICAgICAgIHBhcmFtKAogICAgICAgICAgICAgICAgW0ludF0KICAgICAgICAgICAgICAgICRGU1IKICAgICAgICAgICAgKQoKICAgICAgICAgICAgJEFjY2Vzc01hc2sgPSBAewogICAgICAgICAgICAgIFt1aW50MzJdJzB4ODAwMDAwMDAnID0gJ0dlbmVyaWNSZWFkJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4NDAwMDAwMDAnID0gJ0dlbmVyaWNXcml0ZScKICAgICAgICAgICAgICBbdWludDMyXScweDIwMDAwMDAwJyA9ICdHZW5lcmljRXhlY3V0ZScKICAgICAgICAgICAgICBbdWludDMyXScweDEwMDAwMDAwJyA9ICdHZW5lcmljQWxsJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDIwMDAwMDAnID0gJ01heGltdW1BbGxvd2VkJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDEwMDAwMDAnID0gJ0FjY2Vzc1N5c3RlbVNlY3VyaXR5JwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAxMDAwMDAnID0gJ1N5bmNocm9uaXplJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwODAwMDAnID0gJ1dyaXRlT3duZXInCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDA0MDAwMCcgPSAnV3JpdGVEQUMnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAyMDAwMCcgPSAnUmVhZENvbnRyb2wnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAxMDAwMCcgPSAnRGVsZXRlJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAxMDAnID0gJ1dyaXRlQXR0cmlidXRlcycKICAgICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDgwJyA9ICdSZWFkQXR0cmlidXRlcycKICAgICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDQwJyA9ICdEZWxldGVDaGlsZCcKICAgICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDIwJyA9ICdFeGVjdXRlL1RyYXZlcnNlJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwMTAnID0gJ1dyaXRlRXh0ZW5kZWRBdHRyaWJ1dGVzJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwMDgnID0gJ1JlYWRFeHRlbmRlZEF0dHJpYnV0ZXMnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDAwNCcgPSAnQXBwZW5kRGF0YS9BZGRTdWJkaXJlY3RvcnknCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDAwMicgPSAnV3JpdGVEYXRhL0FkZEZpbGUnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDAwMScgPSAnUmVhZERhdGEvTGlzdERpcmVjdG9yeScKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJFNpbXBsZVBlcm1pc3Npb25zID0gQHsKICAgICAgICAgICAgICBbdWludDMyXScweDFmMDFmZicgPSAnRnVsbENvbnRyb2wnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMzAxYmYnID0gJ01vZGlmeScKICAgICAgICAgICAgICBbdWludDMyXScweDAyMDBhOScgPSAnUmVhZEFuZEV4ZWN1dGUnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMjAxOWYnID0gJ1JlYWRBbmRXcml0ZScKICAgICAgICAgICAgICBbdWludDMyXScweDAyMDA4OScgPSAnUmVhZCcKICAgICAgICAgICAgICBbdWludDMyXScweDAwMDExNicgPSAnV3JpdGUnCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRQZXJtaXNzaW9ucyA9IEAoKQoKICAgICAgICAgICAgIyBnZXQgc2ltcGxlIHBlcm1pc3Npb24KICAgICAgICAgICAgJFBlcm1pc3Npb25zICs9ICRTaW1wbGVQZXJtaXNzaW9ucy5LZXlzIHwgICUgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCRGU1IgLWJhbmQgJF8pIC1lcSAkXykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTaW1wbGVQZXJtaXNzaW9uc1skX10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRlNSID0gJEZTUiAtYmFuZCAoLW5vdCAkXykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBnZXQgcmVtYWluaW5nIGV4dGVuZGVkIHBlcm1pc3Npb25zCiAgICAgICAgICAgICRQZXJtaXNzaW9ucyArPSAkQWNjZXNzTWFzay5LZXlzIHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgID8geyAkRlNSIC1iYW5kICRfIH0gfAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJSB7ICRBY2Nlc3NNYXNrWyRfXSB9CgogICAgICAgICAgICAoJFBlcm1pc3Npb25zIHwgP3skX30pIC1qb2luICIsIgogICAgICAgIH0KICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJEFDTCA9IEdldC1BY2wgLVBhdGggJFBhdGgKCiAgICAgICAgICAgICRBQ0wuR2V0QWNjZXNzUnVsZXMoJHRydWUsJHRydWUsW1N5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyXSkgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgJE5hbWVzID0gQCgpCiAgICAgICAgICAgICAgICBpZiAoJF8uSWRlbnRpdHlSZWZlcmVuY2UgLW1hdGNoICdeUy0xLTUtMjEtWzAtOV0rLVswLTldKy1bMC05XSstWzAtOV0rJykgewogICAgICAgICAgICAgICAgICAgICRPYmplY3QgPSBHZXQtQURPYmplY3QgLVNJRCAkXy5JZGVudGl0eVJlZmVyZW5jZQogICAgICAgICAgICAgICAgICAgICROYW1lcyA9IEAoKQogICAgICAgICAgICAgICAgICAgICRTSURzID0gQCgkT2JqZWN0Lm9iamVjdHNpZCkKCiAgICAgICAgICAgICAgICAgICAgaWYgKCRSZWN1cnNlIC1hbmQgKEAoJzI2ODQzNTQ1NicsJzI2ODQzNTQ1NycsJzUzNjg3MDkxMicsJzUzNjg3MDkxMycpIC1jb250YWlucyAkT2JqZWN0LnNhbUFjY291bnRUeXBlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkU0lEcyArPSBHZXQtTmV0R3JvdXBNZW1iZXIgLVNJRCAkT2JqZWN0Lm9iamVjdHNpZCB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IE1lbWJlclNpZAogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJFNJRHMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICROYW1lcyArPSAsQCgkXywgKENvbnZlcnQtU2lkVG9OYW1lICRfKSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkTmFtZXMgKz0gLEAoJF8uSWRlbnRpdHlSZWZlcmVuY2UuVmFsdWUsIChDb252ZXJ0LVNpZFRvTmFtZSAkXy5JZGVudGl0eVJlZmVyZW5jZS5WYWx1ZSkpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgRm9yRWFjaCgkTmFtZSBpbiAkTmFtZXMpIHsKICAgICAgICAgICAgICAgICAgICAkT3V0ID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICRPdXQgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUGF0aCcgJFBhdGgKICAgICAgICAgICAgICAgICAgICAkT3V0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0ZpbGVTeXN0ZW1SaWdodHMnIChDb252ZXJ0LUZpbGVSaWdodCAtRlNSICRfLkZpbGVTeXN0ZW1SaWdodHMudmFsdWVfXykKICAgICAgICAgICAgICAgICAgICAkT3V0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lkZW50aXR5UmVmZXJlbmNlJyAkTmFtZVsxXQogICAgICAgICAgICAgICAgICAgICRPdXQgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSWRlbnRpdHlTSUQnICROYW1lWzBdCiAgICAgICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdBY2Nlc3NDb250cm9sVHlwZScgJF8uQWNjZXNzQ29udHJvbFR5cGUKICAgICAgICAgICAgICAgICAgICAkT3V0CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1XYXJuaW5nICRfCiAgICAgICAgfQogICAgfQp9CgoKZmlsdGVyIEdldC1OYW1lRmllbGQgewo8IwogICAgLlNZTk9QU0lTCiAgICAKICAgICAgICBIZWxwZXIgdGhhdCBhdHRlbXB0cyB0byBleHRyYWN0IGFwcHJvcHJpYXRlIGZpZWxkIG5hbWVzIGZyb20KICAgICAgICBwYXNzZWQgY29tcHV0ZXIgb2JqZWN0cy4KCiAgICAuUEFSQU1FVEVSIE9iamVjdAoKICAgICAgICBUaGUgcGFzc2VkIG9iamVjdCB0byBleHRyYWN0IG5hbWUgZmllbGRzIGZyb20uCgogICAgLlBBUkFNRVRFUiBEbnNIb3N0TmFtZQogICAgICAgIAogICAgICAgIEEgRG5zSG9zdE5hbWUgdG8gZXh0cmFjdCB0aHJvdWdoIFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWUuCgogICAgLlBBUkFNRVRFUiBOYW1lCiAgICAgICAgCiAgICAgICAgQSBOYW1lIHRvIGV4dHJhY3QgdGhyb3VnaCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldENvbXB1dGVyIC1GdWxsRGF0YSB8IEdldC1OYW1lRmllbGQKIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lID0gJFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWUgPSAkVHJ1ZSldCiAgICAgICAgW09iamVjdF0KICAgICAgICAkT2JqZWN0LAoKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWUgPSAkVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG5zSG9zdE5hbWUsCgogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICROYW1lCiAgICApCgogICAgaWYoJFBTQm91bmRQYXJhbWV0ZXJzWydEbnNIb3N0TmFtZSddKSB7CiAgICAgICAgJERuc0hvc3ROYW1lCiAgICB9CiAgICBlbHNlaWYoJFBTQm91bmRQYXJhbWV0ZXJzWydOYW1lJ10pIHsKICAgICAgICAkTmFtZQogICAgfQogICAgZWxzZWlmKCRPYmplY3QpIHsKICAgICAgICBpZiAoIFtib29sXSgkT2JqZWN0LlBTb2JqZWN0LlByb3BlcnRpZXMubmFtZSAtbWF0Y2ggImRuc2hvc3RuYW1lIikgKSB7CiAgICAgICAgICAgICMgb2JqZWN0cyBmcm9tIEdldC1OZXRDb21wdXRlcgogICAgICAgICAgICAkT2JqZWN0LmRuc2hvc3RuYW1lCiAgICAgICAgfQogICAgICAgIGVsc2VpZiAoIFtib29sXSgkT2JqZWN0LlBTb2JqZWN0LlByb3BlcnRpZXMubmFtZSAtbWF0Y2ggIm5hbWUiKSApIHsKICAgICAgICAgICAgIyBvYmplY3RzIGZyb20gR2V0LU5ldERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgJE9iamVjdC5uYW1lCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAjIHN0cmluZ3MgYW5kIGNhdGNoIGFsbHMKICAgICAgICAgICAgJE9iamVjdAogICAgICAgIH0KICAgIH0KICAgIGVsc2UgewogICAgICAgIHJldHVybiAkTnVsbAogICAgfQp9CgoKZnVuY3Rpb24gQ29udmVydC1MREFQUHJvcGVydHkgewo8IwogICAgLlNZTk9QU0lTCiAgICAKICAgICAgICBIZWxwZXIgdGhhdCBjb252ZXJ0cyBzcGVjaWZpYyBMREFQIHByb3BlcnR5IHJlc3VsdCBmaWVsZHMuCiAgICAgICAgVXNlZCBieSBzZXZlcmFsIG9mIHRoZSBHZXQtTmV0KiBmdW5jdGlvbi4KCiAgICAuUEFSQU1FVEVSIFByb3BlcnRpZXMKCiAgICAgICAgUHJvcGVydGllcyBvYmplY3QgdG8gZXh0cmFjdCBvdXQgTERBUCBmaWVsZHMgZm9yIGRpc3BsYXkuCiM+CiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJFByb3BlcnRpZXMKICAgICkKCiAgICAkT2JqZWN0UHJvcGVydGllcyA9IEB7fQoKICAgICRQcm9wZXJ0aWVzLlByb3BlcnR5TmFtZXMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgaWYgKCgkXyAtZXEgIm9iamVjdHNpZCIpIC1vciAoJF8gLWVxICJzaWRoaXN0b3J5IikpIHsKICAgICAgICAgICAgIyBjb252ZXJ0IHRoZSBTSUQgdG8gYSBzdHJpbmcKICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gKE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXIoJFByb3BlcnRpZXNbJF9dWzBdLDApKS5WYWx1ZQogICAgICAgIH0KICAgICAgICBlbHNlaWYoJF8gLWVxICJvYmplY3RndWlkIikgewogICAgICAgICAgICAjIGNvbnZlcnQgdGhlIEdVSUQgdG8gYSBzdHJpbmcKICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gKE5ldy1PYmplY3QgR3VpZCAoLCRQcm9wZXJ0aWVzWyRfXVswXSkpLkd1aWQKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCAoJF8gLWVxICJsYXN0bG9nb24iKSAtb3IgKCRfIC1lcSAibGFzdGxvZ29udGltZXN0YW1wIikgLW9yICgkXyAtZXEgInB3ZGxhc3RzZXQiKSAtb3IgKCRfIC1lcSAibGFzdGxvZ29mZiIpIC1vciAoJF8gLWVxICJiYWRQYXNzd29yZFRpbWUiKSApIHsKICAgICAgICAgICAgIyBjb252ZXJ0IHRpbWVzdGFtcHMKICAgICAgICAgICAgaWYgKCRQcm9wZXJ0aWVzWyRfXVswXSAtaXMgW1N5c3RlbS5NYXJzaGFsQnlSZWZPYmplY3RdKSB7CiAgICAgICAgICAgICAgICAjIGlmIHdlIGhhdmUgYSBTeXN0ZW0uX19Db21PYmplY3QKICAgICAgICAgICAgICAgICRUZW1wID0gJFByb3BlcnRpZXNbJF9dWzBdCiAgICAgICAgICAgICAgICBbSW50MzJdJEhpZ2ggPSAkVGVtcC5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCJIaWdoUGFydCIsIFtTeXN0ZW0uUmVmbGVjdGlvbi5CaW5kaW5nRmxhZ3NdOjpHZXRQcm9wZXJ0eSwgJG51bGwsICRUZW1wLCAkbnVsbCkKICAgICAgICAgICAgICAgIFtJbnQzMl0kTG93ICA9ICRUZW1wLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoIkxvd1BhcnQiLCAgW1N5c3RlbS5SZWZsZWN0aW9uLkJpbmRpbmdGbGFnc106OkdldFByb3BlcnR5LCAkbnVsbCwgJFRlbXAsICRudWxsKQogICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gKFtkYXRldGltZV06OkZyb21GaWxlVGltZShbSW50NjRdKCIweHswOng4fXsxOng4fSIgLWYgJEhpZ2gsICRMb3cpKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9IChbZGF0ZXRpbWVdOjpGcm9tRmlsZVRpbWUoKCRQcm9wZXJ0aWVzWyRfXVswXSkpKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2VpZigkUHJvcGVydGllc1skX11bMF0gLWlzIFtTeXN0ZW0uTWFyc2hhbEJ5UmVmT2JqZWN0XSkgewogICAgICAgICAgICAjIHRyeSB0byBjb252ZXJ0IG1pc2MgY29tIG9iamVjdHMKICAgICAgICAgICAgJFByb3AgPSAkUHJvcGVydGllc1skX10KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRUZW1wID0gJFByb3BbJF9dWzBdCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICRfCiAgICAgICAgICAgICAgICBbSW50MzJdJEhpZ2ggPSAkVGVtcC5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCJIaWdoUGFydCIsIFtTeXN0ZW0uUmVmbGVjdGlvbi5CaW5kaW5nRmxhZ3NdOjpHZXRQcm9wZXJ0eSwgJG51bGwsICRUZW1wLCAkbnVsbCkKICAgICAgICAgICAgICAgIFtJbnQzMl0kTG93ICA9ICRUZW1wLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoIkxvd1BhcnQiLCAgW1N5c3RlbS5SZWZsZWN0aW9uLkJpbmRpbmdGbGFnc106OkdldFByb3BlcnR5LCAkbnVsbCwgJFRlbXAsICRudWxsKQogICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gW0ludDY0XSgiMHh7MDp4OH17MTp4OH0iIC1mICRIaWdoLCAkTG93KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9ICRQcm9wWyRfXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2VpZigkUHJvcGVydGllc1skX10uY291bnQgLWVxIDEpIHsKICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gJFByb3BlcnRpZXNbJF9dWzBdCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1skX10gPSAkUHJvcGVydGllc1skX10KICAgICAgICB9CiAgICB9CgogICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5ICRPYmplY3RQcm9wZXJ0aWVzCn0KCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojIERvbWFpbiBpbmZvIGZ1bmN0aW9ucyBiZWxvdy4KIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZmlsdGVyIEdldC1Eb21haW5TZWFyY2hlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgSGVscGVyIHVzZWQgYnkgdmFyaW91cyBmdW5jdGlvbnMgdGhhdCB0YWtlcyBhbiBBRFNwYXRoIGFuZAogICAgICAgIGRvbWFpbiBzcGVjaWZpZXIgYW5kIGJ1aWxkcyB0aGUgY29ycmVjdCBBRFNJIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHVzZSBmb3IgdGhlIHF1ZXJ5LCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCwgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIEFEU3ByZWZpeAoKICAgICAgICBQcmVmaXggdG8gc2V0IGZvciB0aGUgc2VhcmNoZXIgKGxpa2UgIkNOPVNpdGVzLENOPUNvbmZpZ3VyYXRpb24iKQoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiB0ZXN0bGFiLmxvY2FsCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiB0ZXN0bGFiLmxvY2FsIC1Eb21haW5Db250cm9sbGVyIFNFQ09OREFSWS5kZXYudGVzdGxhYi5sb2NhbAojPgoKICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcHJlZml4LAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgaWYoLW5vdCAkQ3JlZGVudGlhbCkgewogICAgICAgIGlmKC1ub3QgJERvbWFpbikgewogICAgICAgICAgICAkRG9tYWluID0gKEdldC1OZXREb21haW4pLm5hbWUKICAgICAgICB9CiAgICAgICAgZWxzZWlmKC1ub3QgJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICMgaWYgdGhlcmUncyBubyAtRG9tYWluQ29udHJvbGxlciBzcGVjaWZpZWQsIHRyeSB0byBwdWxsIHRoZSBwcmltYXJ5IERDIHRvIHJlZmxlY3QgcXVlcmllcyB0aHJvdWdoCiAgICAgICAgICAgICAgICAkRG9tYWluQ29udHJvbGxlciA9ICgoR2V0LU5ldERvbWFpbikuUGRjUm9sZU93bmVyKS5OYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgdGhyb3cgIkdldC1Eb21haW5TZWFyY2hlcjogRXJyb3IgaW4gcmV0cmlldmluZyBQREMgZm9yIGN1cnJlbnQgZG9tYWluIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZWxzZWlmICgtbm90ICREb21haW5Db250cm9sbGVyKSB7CiAgICAgICAgIyBpZiBhIERDIGlzbid0IHNwZWNpZmllZAogICAgICAgIHRyeSB7CiAgICAgICAgICAgICREb21haW5Db250cm9sbGVyID0gKChHZXQtTmV0RG9tYWluIC1DcmVkZW50aWFsICRDcmVkZW50aWFsKS5QZGNSb2xlT3duZXIpLk5hbWUKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICB0aHJvdyAiR2V0LURvbWFpblNlYXJjaGVyOiBFcnJvciBpbiByZXRyaWV2aW5nIFBEQyBmb3IgY3VycmVudCBkb21haW4iCiAgICAgICAgfQoKICAgICAgICBpZighJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgdGhyb3cgIkdldC1Eb21haW5TZWFyY2hlcjogRXJyb3IgaW4gcmV0cmlldmluZyBQREMgZm9yIGN1cnJlbnQgZG9tYWluIgogICAgICAgIH0KICAgIH0KCiAgICAkU2VhcmNoU3RyaW5nID0gIkxEQVA6Ly8iCgogICAgaWYoJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAkU2VhcmNoU3RyaW5nICs9ICREb21haW5Db250cm9sbGVyCiAgICAgICAgaWYoJERvbWFpbil7CiAgICAgICAgICAgICRTZWFyY2hTdHJpbmcgKz0gJy8nCiAgICAgICAgfQogICAgfQoKICAgIGlmKCRBRFNwcmVmaXgpIHsKICAgICAgICAkU2VhcmNoU3RyaW5nICs9ICRBRFNwcmVmaXggKyAnLCcKICAgIH0KCiAgICBpZigkQURTcGF0aCkgewogICAgICAgIGlmKCRBRFNwYXRoIC1NYXRjaCAnXkdDOi8vJykgewogICAgICAgICAgICAjIGlmIHdlJ3JlIHNlYXJjaGluZyB0aGUgZ2xvYmFsIGNhdGFsb2cKICAgICAgICAgICAgJEROID0gJEFkc1BhdGguVG9VcHBlcigpLlRyaW0oJy8nKQogICAgICAgICAgICAkU2VhcmNoU3RyaW5nID0gJycKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCRBRFNwYXRoIC1tYXRjaCAnXkxEQVA6Ly8nKSB7CiAgICAgICAgICAgICAgICBpZigkQURTcGF0aCAtbWF0Y2ggIkxEQVA6Ly8uKy8uKyIpIHsKICAgICAgICAgICAgICAgICAgICAkU2VhcmNoU3RyaW5nID0gJycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRBRFNwYXRoID0gJEFEU3BhdGguU3Vic3RyaW5nKDcpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJEROID0gJEFEU3BhdGgKICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBpZigkRG9tYWluIC1hbmQgKCREb21haW4uVHJpbSgpIC1uZSAiIikpIHsKICAgICAgICAgICAgJEROID0gIkRDPSQoJERvbWFpbi5SZXBsYWNlKCcuJywgJyxEQz0nKSkiCiAgICAgICAgfQogICAgfQoKICAgICRTZWFyY2hTdHJpbmcgKz0gJEROCiAgICBXcml0ZS1WZXJib3NlICJHZXQtRG9tYWluU2VhcmNoZXIgc2VhcmNoIHN0cmluZzogJFNlYXJjaFN0cmluZyIKCiAgICBpZigkQ3JlZGVudGlhbCkgewogICAgICAgIFdyaXRlLVZlcmJvc2UgIlVzaW5nIGFsdGVybmF0ZSBjcmVkZW50aWFscyBmb3IgTERBUCBjb25uZWN0aW9uIgogICAgICAgICREb21haW5PYmplY3QgPSBOZXctT2JqZWN0IERpcmVjdG9yeVNlcnZpY2VzLkRpcmVjdG9yeUVudHJ5KCRTZWFyY2hTdHJpbmcsICRDcmVkZW50aWFsLlVzZXJOYW1lLCAkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLlBhc3N3b3JkKQogICAgICAgICRTZWFyY2hlciA9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkRpcmVjdG9yeVNlYXJjaGVyKCREb21haW5PYmplY3QpCiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkU2VhcmNoZXIgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5EaXJlY3RvcnlTZWFyY2hlcihbQURTSV0kU2VhcmNoU3RyaW5nKQogICAgfQoKICAgICRTZWFyY2hlci5QYWdlU2l6ZSA9ICRQYWdlU2l6ZQogICAgJFNlYXJjaGVyLkNhY2hlUmVzdWx0cyA9ICRGYWxzZQogICAgJFNlYXJjaGVyCn0KCgpmaWx0ZXIgQ29udmVydC1ETlNSZWNvcmQgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgRGVjb2RlcyBhIGJpbmFyeSBETlMgcmVjb3JkLgoKICAgICAgIEFkYXB0ZWQvcG9ydGVkIGZyb20gTWljaGFlbCBCLiBTbWl0aCdzIGNvZGUgYXQgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL21tZXNzYW5vL1Bvd2VyU2hlbGwvbWFzdGVyL2Rucy1kdW1wLnBzMQoKICAgIC5QQVJBTUVURVIgRE5TUmVjb3JkCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHpvbmVzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLkxJTksKCiAgICAgICAgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL21tZXNzYW5vL1Bvd2VyU2hlbGwvbWFzdGVyL2Rucy1kdW1wLnBzMQojPgogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSRUcnVlLCBNYW5kYXRvcnk9JFRydWUpXQogICAgICAgIFtCeXRlW11dCiAgICAgICAgJEROU1JlY29yZAogICAgKQoKICAgIGZ1bmN0aW9uIEdldC1OYW1lIHsKICAgICAgICAjIG1vZGlmaWVkIGRlY29kZU5hbWUgZnJvbSBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vbW1lc3Nhbm8vUG93ZXJTaGVsbC9tYXN0ZXIvZG5zLWR1bXAucHMxCiAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0KICAgICAgICBwYXJhbSgKICAgICAgICAgICAgW0J5dGVbXV0KICAgICAgICAgICAgJFJhdwogICAgICAgICkKCiAgICAgICAgW0ludF0kTGVuZ3RoID0gJFJhd1swXQogICAgICAgIFtJbnRdJFNlZ21lbnRzID0gJFJhd1sxXQogICAgICAgIFtJbnRdJEluZGV4ID0gIDIKICAgICAgICBbU3RyaW5nXSROYW1lICA9ICIiCgogICAgICAgIHdoaWxlICgkU2VnbWVudHMtLSAtZ3QgMCkKICAgICAgICB7CiAgICAgICAgICAgIFtJbnRdJFNlZ21lbnRMZW5ndGggPSAkUmF3WyRJbmRleCsrXQogICAgICAgICAgICB3aGlsZSAoJFNlZ21lbnRMZW5ndGgtLSAtZ3QgMCkgewogICAgICAgICAgICAgICAgJE5hbWUgKz0gW0NoYXJdJFJhd1skSW5kZXgrK10KICAgICAgICAgICAgfQogICAgICAgICAgICAkTmFtZSArPSAiLiIKICAgICAgICB9CiAgICAgICAgJE5hbWUKICAgIH0KCiAgICAkUkRhdGFMZW4gPSBbQml0Q29udmVydGVyXTo6VG9VSW50MTYoJEROU1JlY29yZCwgMCkKICAgICRSRGF0YVR5cGUgPSBbQml0Q29udmVydGVyXTo6VG9VSW50MTYoJEROU1JlY29yZCwgMikKICAgICRVcGRhdGVkQXRTZXJpYWwgPSBbQml0Q29udmVydGVyXTo6VG9VSW50MzIoJEROU1JlY29yZCwgOCkKCiAgICAkVFRMUmF3ID0gJEROU1JlY29yZFsxMi4uMTVdCiAgICAjIHJldmVyc2UgZm9yIGJpZyBlbmRpYW4KICAgICROdWxsID0gW2FycmF5XTo6UmV2ZXJzZSgkVFRMUmF3KQogICAgJFRUTCA9IFtCaXRDb252ZXJ0ZXJdOjpUb1VJbnQzMigkVFRMUmF3LCAwKQoKICAgICRBZ2UgPSBbQml0Q29udmVydGVyXTo6VG9VSW50MzIoJEROU1JlY29yZCwgMjApCiAgICBpZigkQWdlIC1uZSAwKSB7CiAgICAgICAgJFRpbWVTdGFtcCA9ICgoR2V0LURhdGUgLVllYXIgMTYwMSAtTW9udGggMSAtRGF5IDEgLUhvdXIgMCAtTWludXRlIDAgLVNlY29uZCAwKS5BZGRIb3VycygkYWdlKSkuVG9TdHJpbmcoKQogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFRpbWVTdGFtcCA9ICJbc3RhdGljXSIKICAgIH0KCiAgICAkRE5TUmVjb3JkT2JqZWN0ID0gTmV3LU9iamVjdCBQU09iamVjdAoKICAgIGlmKCRSRGF0YVR5cGUgLWVxIDEpIHsKICAgICAgICAkSVAgPSAiezB9LnsxfS57Mn0uezN9IiAtZiAkRE5TUmVjb3JkWzI0XSwgJEROU1JlY29yZFsyNV0sICRETlNSZWNvcmRbMjZdLCAkRE5TUmVjb3JkWzI3XQogICAgICAgICREYXRhID0gJElQCiAgICAgICAgJEROU1JlY29yZE9iamVjdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdSZWNvcmRUeXBlJyAnQScKICAgIH0KCiAgICBlbHNlaWYoJFJEYXRhVHlwZSAtZXEgMikgewogICAgICAgICROU05hbWUgPSBHZXQtTmFtZSAkRE5TUmVjb3JkWzI0Li4kRE5TUmVjb3JkLmxlbmd0aF0KICAgICAgICAkRGF0YSA9ICROU05hbWUKICAgICAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1JlY29yZFR5cGUnICdOUycKICAgIH0KCiAgICBlbHNlaWYoJFJEYXRhVHlwZSAtZXEgNSkgewogICAgICAgICRBbGlhcyA9IEdldC1OYW1lICRETlNSZWNvcmRbMjQuLiRETlNSZWNvcmQubGVuZ3RoXQogICAgICAgICREYXRhID0gJEFsaWFzCiAgICAgICAgJEROU1JlY29yZE9iamVjdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdSZWNvcmRUeXBlJyAnQ05BTUUnCiAgICB9CgogICAgZWxzZWlmKCRSRGF0YVR5cGUgLWVxIDYpIHsKICAgICAgICAjIFRPRE86IGhvdyB0byBpbXBsZW1lbnQgcHJvcGVybHk/IG5lc3RlZCBvYmplY3Q/CiAgICAgICAgJERhdGEgPSAkKFtTeXN0ZW0uQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKCRETlNSZWNvcmRbMjQuLiRETlNSZWNvcmQubGVuZ3RoXSkpCiAgICAgICAgJEROU1JlY29yZE9iamVjdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdSZWNvcmRUeXBlJyAnU09BJwogICAgfQoKICAgIGVsc2VpZigkUkRhdGFUeXBlIC1lcSAxMikgewogICAgICAgICRQdHIgPSBHZXQtTmFtZSAkRE5TUmVjb3JkWzI0Li4kRE5TUmVjb3JkLmxlbmd0aF0KICAgICAgICAkRGF0YSA9ICRQdHIKICAgICAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1JlY29yZFR5cGUnICdQVFInCiAgICB9CgogICAgZWxzZWlmKCRSRGF0YVR5cGUgLWVxIDEzKSB7CiAgICAgICAgIyBUT0RPOiBob3cgdG8gaW1wbGVtZW50IHByb3Blcmx5PyBuZXN0ZWQgb2JqZWN0PwogICAgICAgICREYXRhID0gJChbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkRE5TUmVjb3JkWzI0Li4kRE5TUmVjb3JkLmxlbmd0aF0pKQogICAgICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUmVjb3JkVHlwZScgJ0hJTkZPJwogICAgfQoKICAgIGVsc2VpZigkUkRhdGFUeXBlIC1lcSAxNSkgewogICAgICAgICMgVE9ETzogaG93IHRvIGltcGxlbWVudCBwcm9wZXJseT8gbmVzdGVkIG9iamVjdD8KICAgICAgICAkRGF0YSA9ICQoW1N5c3RlbS5Db252ZXJ0XTo6VG9CYXNlNjRTdHJpbmcoJEROU1JlY29yZFsyNC4uJEROU1JlY29yZC5sZW5ndGhdKSkKICAgICAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1JlY29yZFR5cGUnICdNWCcKICAgIH0KCiAgICBlbHNlaWYoJFJEYXRhVHlwZSAtZXEgMTYpIHsKCiAgICAgICAgW3N0cmluZ10kVFhUICA9ICIiCiAgICAgICAgW2ludF0kU2VnbWVudExlbmd0aCA9ICRETlNSZWNvcmRbMjRdCiAgICAgICAgJEluZGV4ID0gMjUKICAgICAgICB3aGlsZSAoJFNlZ21lbnRMZW5ndGgtLSAtZ3QgMCkgewogICAgICAgICAgICAkVFhUICs9IFtjaGFyXSRETlNSZWNvcmRbJGluZGV4KytdCiAgICAgICAgfQoKICAgICAgICAkRGF0YSA9ICRUWFQKICAgICAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1JlY29yZFR5cGUnICdUWFQnCiAgICB9CgogICAgZWxzZWlmKCRSRGF0YVR5cGUgLWVxIDI4KSB7CiAgICAgICAgIyBUT0RPOiBob3cgdG8gaW1wbGVtZW50IHByb3Blcmx5PyBuZXN0ZWQgb2JqZWN0PwogICAgICAgICREYXRhID0gJChbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkRE5TUmVjb3JkWzI0Li4kRE5TUmVjb3JkLmxlbmd0aF0pKQogICAgICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUmVjb3JkVHlwZScgJ0FBQUEnCiAgICB9CgogICAgZWxzZWlmKCRSRGF0YVR5cGUgLWVxIDMzKSB7CiAgICAgICAgIyBUT0RPOiBob3cgdG8gaW1wbGVtZW50IHByb3Blcmx5PyBuZXN0ZWQgb2JqZWN0PwogICAgICAgICREYXRhID0gJChbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkRE5TUmVjb3JkWzI0Li4kRE5TUmVjb3JkLmxlbmd0aF0pKQogICAgICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUmVjb3JkVHlwZScgJ1NSVicKICAgIH0KCiAgICBlbHNlIHsKICAgICAgICAkRGF0YSA9ICQoW1N5c3RlbS5Db252ZXJ0XTo6VG9CYXNlNjRTdHJpbmcoJEROU1JlY29yZFsyNC4uJEROU1JlY29yZC5sZW5ndGhdKSkKICAgICAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1JlY29yZFR5cGUnICdVTktOT1dOJwogICAgfQoKICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXBkYXRlZEF0U2VyaWFsJyAkVXBkYXRlZEF0U2VyaWFsCiAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RUTCcgJFRUTAogICAgJEROU1JlY29yZE9iamVjdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdBZ2UnICRBZ2UKICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVGltZVN0YW1wJyAkVGltZVN0YW1wCiAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0RhdGEnICREYXRhCiAgICAkRE5TUmVjb3JkT2JqZWN0Cn0KCgpmaWx0ZXIgR2V0LUROU1pvbmUgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgRW51bWVyYXRlcyB0aGUgQWN0aXZlIERpcmVjdG9yeSBETlMgem9uZXMgZm9yIGEgZ2l2ZW4gZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHpvbmVzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIEZ1bGxEYXRhCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIGZ1bGwgY29tcHV0ZXIgb2JqZWN0cyBpbnN0ZWFkIG9mIGp1c3Qgc3lzdGVtIG5hbWVzICh0aGUgZGVmYXVsdCkuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtRE5TWm9uZQoKICAgICAgICBSZXRyaWV2ZXMgdGhlIEROUyB6b25lcyBmb3IgdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUROU1pvbmUgLURvbWFpbiBkZXYudGVzdGxhYi5sb2NhbCAtRG9tYWluQ29udHJvbGxlciBwcmltYXJ5LnRlc3RsYWIubG9jYWwKCiAgICAgICAgUmV0cmlldmVzIHRoZSBETlMgem9uZXMgZm9yIHRoZSBkZXYudGVzdGxhYi5sb2NhbCBkb21haW4sIHJlZmxlY3RpbmcgdGhlIExEQVAgcXVlcmllcwogICAgICAgIHRocm91Z2ggdGhlIHByaW1hcnkudGVzdGxhYi5sb2NhbCBkb21haW4gY29udHJvbGxlci4KIz4KCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsIFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRnVsbERhdGEKICAgICkKCiAgICAkRE5TU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwKICAgICRETlNTZWFyY2hlci5maWx0ZXI9IihvYmplY3RDbGFzcz1kbnNab25lKSIKCiAgICBpZigkRE5TU2VhcmNoZXIpIHsKICAgICAgICAkUmVzdWx0cyA9ICRETlNTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAjIGNvbnZlcnQvcHJvY2VzcyB0aGUgTERBUCBmaWVsZHMgZm9yIGVhY2ggcmVzdWx0CiAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gQ29udmVydC1MREFQUHJvcGVydHkgLVByb3BlcnRpZXMgJF8uUHJvcGVydGllcwogICAgICAgICAgICAkUHJvcGVydGllcyB8IEFkZC1NZW1iZXIgTm90ZVByb3BlcnR5ICdab25lTmFtZScgJFByb3BlcnRpZXMubmFtZQoKICAgICAgICAgICAgaWYgKCRGdWxsRGF0YSkgewogICAgICAgICAgICAgICAgJFByb3BlcnRpZXMKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzIHwgU2VsZWN0LU9iamVjdCBab25lTmFtZSxkaXN0aW5ndWlzaGVkbmFtZSx3aGVuY3JlYXRlZCx3aGVuY2hhbmdlZAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICRETlNTZWFyY2hlci5kaXNwb3NlKCkKICAgIH0KCiAgICAkRE5TU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3ByZWZpeCAiQ049TWljcm9zb2Z0RE5TLERDPURvbWFpbkRuc1pvbmVzIgogICAgJEROU1NlYXJjaGVyLmZpbHRlcj0iKG9iamVjdENsYXNzPWRuc1pvbmUpIgoKICAgIGlmKCRETlNTZWFyY2hlcikgewogICAgICAgICRSZXN1bHRzID0gJEROU1NlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICMgY29udmVydC9wcm9jZXNzIHRoZSBMREFQIGZpZWxkcyBmb3IgZWFjaCByZXN1bHQKICAgICAgICAgICAgJFByb3BlcnRpZXMgPSBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICRQcm9wZXJ0aWVzIHwgQWRkLU1lbWJlciBOb3RlUHJvcGVydHkgJ1pvbmVOYW1lJyAkUHJvcGVydGllcy5uYW1lCgogICAgICAgICAgICBpZiAoJEZ1bGxEYXRhKSB7CiAgICAgICAgICAgICAgICAkUHJvcGVydGllcwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgfCBTZWxlY3QtT2JqZWN0IFpvbmVOYW1lLGRpc3Rpbmd1aXNoZWRuYW1lLHdoZW5jcmVhdGVkLHdoZW5jaGFuZ2VkCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgJEROU1NlYXJjaGVyLmRpc3Bvc2UoKQogICAgfQp9CgoKZmlsdGVyIEdldC1ETlNSZWNvcmQgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgRW51bWVyYXRlcyB0aGUgQWN0aXZlIERpcmVjdG9yeSBETlMgcmVjb3JkcyBmb3IgYSBnaXZlbiB6b25lLgoKICAgIC5QQVJBTUVURVIgWm9uZU5hbWUKCiAgICAgICAgVGhlIHpvbmUgdG8gcXVlcnkgZm9yIHJlY29yZHMgKHdoaWNoIGNhbiBiZSBlbnVtZWFydGVkIHdpdGggR2V0LUROU1pvbmUpLiBSZXF1aXJlZC4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciB6b25lcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtRE5TUmVjb3JkIC1ab25lTmFtZSB0ZXN0bGFiLmxvY2FsCgogICAgICAgIFJldHJpZXZlIGFsbCByZWNvcmRzIGZvciB0aGUgdGVzdGxhYi5sb2NhbCB6b25lLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUROU1pvbmUgfCBHZXQtRE5TUmVjb3JkCgogICAgICAgIFJldHJpZXZlIGFsbCByZWNvcmRzIGZvciBhbGwgem9uZXMgaW4gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUROU1pvbmUgLURvbWFpbiBkZXYudGVzdGxhYi5sb2NhbCB8IEdldC1ETlNSZWNvcmQgLURvbWFpbiBkZXYudGVzdGxhYi5sb2NhbAoKICAgICAgICBSZXRyaWV2ZSBhbGwgcmVjb3JkcyBmb3IgYWxsIHpvbmVzIGluIHRoZSBkZXYudGVzdGxhYi5sb2NhbCBkb21haW4uCiM+CgogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSRUcnVlLCBNYW5kYXRvcnk9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFpvbmVOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgICRETlNTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZSAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcHJlZml4ICJEQz0kKCRab25lTmFtZSksQ049TWljcm9zb2Z0RE5TLERDPURvbWFpbkRuc1pvbmVzIgogICAgJEROU1NlYXJjaGVyLmZpbHRlcj0iKG9iamVjdENsYXNzPWRuc05vZGUpIgoKICAgIGlmKCRETlNTZWFyY2hlcikgewogICAgICAgICRSZXN1bHRzID0gJEROU1NlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAjIGNvbnZlcnQvcHJvY2VzcyB0aGUgTERBUCBmaWVsZHMgZm9yIGVhY2ggcmVzdWx0CiAgICAgICAgICAgICAgICAkUHJvcGVydGllcyA9IENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMgfCBTZWxlY3QtT2JqZWN0IG5hbWUsZGlzdGluZ3Vpc2hlZG5hbWUsZG5zcmVjb3JkLHdoZW5jcmVhdGVkLHdoZW5jaGFuZ2VkCiAgICAgICAgICAgICAgICAkUHJvcGVydGllcyB8IEFkZC1NZW1iZXIgTm90ZVByb3BlcnR5ICdab25lTmFtZScgJFpvbmVOYW1lCgogICAgICAgICAgICAgICAgIyBjb252ZXJ0IHRoZSByZWNvcmQgYW5kIGV4dHJhY3QgdGhlIHByb3BlcnRpZXMKICAgICAgICAgICAgICAgIGlmICgkUHJvcGVydGllcy5kbnNyZWNvcmQgLWlzIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuUmVzdWx0UHJvcGVydHlWYWx1ZUNvbGxlY3Rpb25dKSB7CiAgICAgICAgICAgICAgICAgICAgIyBUT0RPOiBoYW5kbGUgbXVsdGlwbGUgbmVzdGVkIHJlY29yZHMgcHJvcGVybHk/CiAgICAgICAgICAgICAgICAgICAgJFJlY29yZCA9IENvbnZlcnQtRE5TUmVjb3JkIC1ETlNSZWNvcmQgJFByb3BlcnRpZXMuZG5zcmVjb3JkWzBdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkUmVjb3JkID0gQ29udmVydC1ETlNSZWNvcmQgLUROU1JlY29yZCAkUHJvcGVydGllcy5kbnNyZWNvcmQKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigkUmVjb3JkKSB7CiAgICAgICAgICAgICAgICAgICAgJFJlY29yZC5wc29iamVjdC5wcm9wZXJ0aWVzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAkUHJvcGVydGllcyB8IEFkZC1NZW1iZXIgTm90ZVByb3BlcnR5ICRfLk5hbWUgJF8uVmFsdWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJFByb3BlcnRpZXMKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJFUlJPUjogJF8iCiAgICAgICAgICAgICAgICAkUHJvcGVydGllcwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICRETlNTZWFyY2hlci5kaXNwb3NlKCkKICAgIH0KfQoKCmZpbHRlciBHZXQtTmV0RG9tYWluIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXR1cm5zIGEgZ2l2ZW4gZG9tYWluIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIG5hbWUgdG8gcXVlcnkgZm9yLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXREb21haW4gLURvbWFpbiB0ZXN0bGFiLmxvY2FsCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiAidGVzdGxhYi5sb2NhbCIgfCBHZXQtTmV0RG9tYWluCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL3NvY2lhbC50ZWNobmV0Lm1pY3Jvc29mdC5jb20vRm9ydW1zL3NjcmlwdGNlbnRlci9lbi1VUy8wYzViM2Y4My1lNTI4LTRkNDktOTJhNC1kZWUzMWY0YjQ4MWMvZmluZGluZy10aGUtZG4tb2YtdGhlLXRoZS1kb21haW4td2l0aG91dC1hZG1vZHVsZS1pbi1wb3dlcnNoZWxsP2ZvcnVtPUlUQ0cKIz4KCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgaWYoJENyZWRlbnRpYWwpIHsKICAgICAgICAKICAgICAgICBXcml0ZS1WZXJib3NlICJVc2luZyBhbHRlcm5hdGUgY3JlZGVudGlhbHMgZm9yIEdldC1OZXREb21haW4iCgogICAgICAgIGlmKCEkRG9tYWluKSB7CiAgICAgICAgICAgICMgaWYgbm8gZG9tYWluIGlzIHN1cHBsaWVkLCBleHRyYWN0IHRoZSBsb2dvbiBkb21haW4gZnJvbSB0aGUgUFNDcmVkZW50aWFsIHBhc3NlZAogICAgICAgICAgICAkRG9tYWluID0gJENyZWRlbnRpYWwuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5Eb21haW4KICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXh0cmFjdGVkIGRvbWFpbiAnJERvbWFpbicgZnJvbSAtQ3JlZGVudGlhbCIKICAgICAgICB9CiAgIAogICAgICAgICREb21haW5Db250ZXh0ID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5LkRpcmVjdG9yeUNvbnRleHQoJ0RvbWFpbicsICREb21haW4sICRDcmVkZW50aWFsLlVzZXJOYW1lLCAkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLlBhc3N3b3JkKQogICAgICAgIAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5LkRvbWFpbl06OkdldERvbWFpbigkRG9tYWluQ29udGV4dCkKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJUaGUgc3BlY2lmaWVkIGRvbWFpbiBkb2VzICckRG9tYWluJyBub3QgZXhpc3QsIGNvdWxkIG5vdCBiZSBjb250YWN0ZWQsIHRoZXJlIGlzbid0IGFuIGV4aXN0aW5nIHRydXN0LCBvciB0aGUgc3BlY2lmaWVkIGNyZWRlbnRpYWxzIGFyZSBpbnZhbGlkLiIKICAgICAgICAgICAgJE51bGwKICAgICAgICB9CiAgICB9CiAgICBlbHNlaWYoJERvbWFpbikgewogICAgICAgICREb21haW5Db250ZXh0ID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5LkRpcmVjdG9yeUNvbnRleHQoJ0RvbWFpbicsICREb21haW4pCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRG9tYWluXTo6R2V0RG9tYWluKCREb21haW5Db250ZXh0KQogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIlRoZSBzcGVjaWZpZWQgZG9tYWluICckRG9tYWluJyBkb2VzIG5vdCBleGlzdCwgY291bGQgbm90IGJlIGNvbnRhY3RlZCwgb3IgdGhlcmUgaXNuJ3QgYW4gZXhpc3RpbmcgdHJ1c3QuIgogICAgICAgICAgICAkTnVsbAogICAgICAgIH0KICAgIH0KICAgIGVsc2UgewogICAgICAgIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5LkRvbWFpbl06OkdldEN1cnJlbnREb21haW4oKQogICAgfQp9CgoKZmlsdGVyIEdldC1OZXRGb3Jlc3Qgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFJldHVybnMgYSBnaXZlbiBmb3Jlc3Qgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgRm9yZXN0CgogICAgICAgIFRoZSBmb3Jlc3QgbmFtZSB0byBxdWVyeSBmb3IsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCiAgICAKICAgICAgICBQUyBDOlw+IEdldC1OZXRGb3Jlc3QgLUZvcmVzdCBleHRlcm5hbC5kb21haW4KCiAgICAuRVhBTVBMRQogICAgCiAgICAgICAgUFMgQzpcPiAiZXh0ZXJuYWwuZG9tYWluIiB8IEdldC1OZXRGb3Jlc3QKIz4KCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRGb3Jlc3QsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgaWYoJENyZWRlbnRpYWwpIHsKICAgICAgICAKICAgICAgICBXcml0ZS1WZXJib3NlICJVc2luZyBhbHRlcm5hdGUgY3JlZGVudGlhbHMgZm9yIEdldC1OZXRGb3Jlc3QiCgogICAgICAgIGlmKCEkRm9yZXN0KSB7CiAgICAgICAgICAgICMgaWYgbm8gZG9tYWluIGlzIHN1cHBsaWVkLCBleHRyYWN0IHRoZSBsb2dvbiBkb21haW4gZnJvbSB0aGUgUFNDcmVkZW50aWFsIHBhc3NlZAogICAgICAgICAgICAkRm9yZXN0ID0gJENyZWRlbnRpYWwuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5Eb21haW4KICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXh0cmFjdGVkIGRvbWFpbiAnJEZvcmVzdCcgZnJvbSAtQ3JlZGVudGlhbCIKICAgICAgICB9CiAgIAogICAgICAgICRGb3Jlc3RDb250ZXh0ID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5LkRpcmVjdG9yeUNvbnRleHQoJ0ZvcmVzdCcsICRGb3Jlc3QsICRDcmVkZW50aWFsLlVzZXJOYW1lLCAkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLlBhc3N3b3JkKQogICAgICAgIAogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRGb3Jlc3RPYmplY3QgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeS5Gb3Jlc3RdOjpHZXRGb3Jlc3QoJEZvcmVzdENvbnRleHQpCiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiVGhlIHNwZWNpZmllZCBmb3Jlc3QgJyRGb3Jlc3QnIGRvZXMgbm90IGV4aXN0LCBjb3VsZCBub3QgYmUgY29udGFjdGVkLCB0aGVyZSBpc24ndCBhbiBleGlzdGluZyB0cnVzdCwgb3IgdGhlIHNwZWNpZmllZCBjcmVkZW50aWFscyBhcmUgaW52YWxpZC4iCiAgICAgICAgICAgICROdWxsCiAgICAgICAgfQogICAgfQogICAgZWxzZWlmKCRGb3Jlc3QpIHsKICAgICAgICAkRm9yZXN0Q29udGV4dCA9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeS5EaXJlY3RvcnlDb250ZXh0KCdGb3Jlc3QnLCAkRm9yZXN0KQogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRGb3Jlc3RPYmplY3QgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeS5Gb3Jlc3RdOjpHZXRGb3Jlc3QoJEZvcmVzdENvbnRleHQpCiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiVGhlIHNwZWNpZmllZCBmb3Jlc3QgJyRGb3Jlc3QnIGRvZXMgbm90IGV4aXN0LCBjb3VsZCBub3QgYmUgY29udGFjdGVkLCBvciB0aGVyZSBpc24ndCBhbiBleGlzdGluZyB0cnVzdC4iCiAgICAgICAgICAgIHJldHVybiAkTnVsbAogICAgICAgIH0KICAgIH0KICAgIGVsc2UgewogICAgICAgICMgb3RoZXJ3aXNlIHVzZSB0aGUgY3VycmVudCBmb3Jlc3QKICAgICAgICAkRm9yZXN0T2JqZWN0ID0gW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRm9yZXN0XTo6R2V0Q3VycmVudEZvcmVzdCgpCiAgICB9CgogICAgaWYoJEZvcmVzdE9iamVjdCkgewogICAgICAgICMgZ2V0IHRoZSBTSUQgb2YgdGhlIGZvcmVzdCByb290CiAgICAgICAgJEZvcmVzdFNpZCA9IChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuTlRBY2NvdW50KCRGb3Jlc3RPYmplY3QuUm9vdERvbWFpbiwia3JidGd0IikpLlRyYW5zbGF0ZShbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXJdKS5WYWx1ZQogICAgICAgICRQYXJ0cyA9ICRGb3Jlc3RTaWQgLVNwbGl0ICItIgogICAgICAgICRGb3Jlc3RTaWQgPSAkUGFydHNbMC4uJCgkUGFydHMubGVuZ3RoLTIpXSAtam9pbiAiLSIKICAgICAgICAkRm9yZXN0T2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlUHJvcGVydHkgJ1Jvb3REb21haW5TaWQnICRGb3Jlc3RTaWQKICAgICAgICAkRm9yZXN0T2JqZWN0CiAgICB9Cn0KCgpmaWx0ZXIgR2V0LU5ldEZvcmVzdERvbWFpbiB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUmV0dXJuIGFsbCBkb21haW5zIGZvciBhIGdpdmVuIGZvcmVzdC4KCiAgICAuUEFSQU1FVEVSIEZvcmVzdAoKICAgICAgICBUaGUgZm9yZXN0IG5hbWUgdG8gcXVlcnkgZG9tYWluIGZvci4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldEZvcmVzdERvbWFpbgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldEZvcmVzdERvbWFpbiAtRm9yZXN0IGV4dGVybmFsLmxvY2FsCiM+CgogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRm9yZXN0LAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgICRGb3Jlc3RPYmplY3QgPSBHZXQtTmV0Rm9yZXN0IC1Gb3Jlc3QgJEZvcmVzdCAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbAoKICAgIGlmKCRGb3Jlc3RPYmplY3QpIHsKICAgICAgICAkRm9yZXN0T2JqZWN0LkRvbWFpbnMKICAgIH0KfQoKCmZpbHRlciBHZXQtTmV0Rm9yZXN0Q2F0YWxvZyB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUmV0dXJuIGFsbCBnbG9iYWwgY2F0YWxvZ3MgZm9yIGEgZ2l2ZW4gZm9yZXN0LgoKICAgIC5QQVJBTUVURVIgRm9yZXN0CgogICAgICAgIFRoZSBmb3Jlc3QgbmFtZSB0byBxdWVyeSBkb21haW4gZm9yLgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Rm9yZXN0Q2F0YWxvZwojPgogICAgCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRGb3Jlc3QsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgJEZvcmVzdE9iamVjdCA9IEdldC1OZXRGb3Jlc3QgLUZvcmVzdCAkRm9yZXN0IC1DcmVkZW50aWFsICRDcmVkZW50aWFsCgogICAgaWYoJEZvcmVzdE9iamVjdCkgewogICAgICAgICRGb3Jlc3RPYmplY3QuRmluZEFsbEdsb2JhbENhdGFsb2dzKCkKICAgIH0KfQoKCmZpbHRlciBHZXQtTmV0RG9tYWluQ29udHJvbGxlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUmV0dXJuIHRoZSBjdXJyZW50IGRvbWFpbiBjb250cm9sbGVycyBmb3IgdGhlIGFjdGl2ZSBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgZG9tYWluIGNvbnRyb2xsZXJzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBMREFQCgogICAgICAgIFN3aXRjaC4gVXNlIExEQVAgcXVlcmllcyB0byBkZXRlcm1pbmUgdGhlIGRvbWFpbiBjb250cm9sbGVycy4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldERvbWFpbkNvbnRyb2xsZXIgLURvbWFpbiAndGVzdC5sb2NhbCcKICAgICAgICAKICAgICAgICBEZXRlcm1pbmUgdGhlIGRvbWFpbiBjb250cm9sbGVycyBmb3IgJ3Rlc3QubG9jYWwnLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldERvbWFpbkNvbnRyb2xsZXIgLURvbWFpbiAndGVzdC5sb2NhbCcgLUxEQVAKCiAgICAgICAgRGV0ZXJtaW5lIHRoZSBkb21haW4gY29udHJvbGxlcnMgZm9yICd0ZXN0LmxvY2FsJyB1c2luZyBMREFQIHF1ZXJpZXMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiAndGVzdC5sb2NhbCcgfCBHZXQtTmV0RG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEZXRlcm1pbmUgdGhlIGRvbWFpbiBjb250cm9sbGVycyBmb3IgJ3Rlc3QubG9jYWwnLgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJExEQVAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgaWYoJExEQVAgLW9yICREb21haW5Db250cm9sbGVyKSB7CiAgICAgICAgIyBmaWx0ZXIgc3RyaW5nIHRvIHJldHVybiBhbGwgZG9tYWluIGNvbnRyb2xsZXJzCiAgICAgICAgR2V0LU5ldENvbXB1dGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRnVsbERhdGEgLUZpbHRlciAnKHVzZXJBY2NvdW50Q29udHJvbDoxLjIuODQwLjExMzU1Ni4xLjQuODAzOj04MTkyKScKICAgIH0KICAgIGVsc2UgewogICAgICAgICRGb3VuZERvbWFpbiA9IEdldC1OZXREb21haW4gLURvbWFpbiAkRG9tYWluIC1DcmVkZW50aWFsICRDcmVkZW50aWFsCiAgICAgICAgaWYoJEZvdW5kRG9tYWluKSB7CiAgICAgICAgICAgICRGb3VuZGRvbWFpbi5Eb21haW5Db250cm9sbGVycwogICAgICAgIH0KICAgIH0KfQoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMKIyAibmV0ICoiIHJlcGxhY2VtZW50cyBhbmQgb3RoZXIgZnVuIHN0YXJ0IGJlbG93CiMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmZ1bmN0aW9uIEdldC1OZXRVc2VyIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBRdWVyeSBpbmZvcm1hdGlvbiBmb3IgYSBnaXZlbiB1c2VyIG9yIHVzZXJzIGluIHRoZSBkb21haW4KICAgICAgICB1c2luZyBBRFNJIGFuZCBMREFQLiBBbm90aGVyIC1Eb21haW4gY2FuIGJlIHNwZWNpZmllZCB0bwogICAgICAgIHF1ZXJ5IGZvciB1c2VycyBhY3Jvc3MgYSB0cnVzdC4KICAgICAgICBSZXBsYWNlbWVudCBmb3IgIm5ldCB1c2VycyAvZG9tYWluIgoKICAgIC5QQVJBTUVURVIgVXNlck5hbWUKCiAgICAgICAgVXNlcm5hbWUgZmlsdGVyIHN0cmluZywgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHVzZXJzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCwgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIEZpbHRlcgoKICAgICAgICBBIGN1c3RvbWl6ZWQgbGRhcCBmaWx0ZXIgc3RyaW5nIHRvIHVzZSwgZS5nLiAiKGRlc2NyaXB0aW9uPSphZG1pbiopIgoKICAgIC5QQVJBTUVURVIgQWRtaW5Db3VudAoKICAgICAgICBTd2l0Y2guIFJldHVybiB1c2VycyB3aXRoIGFkbWluQ291bnQ9MS4KCiAgICAuUEFSQU1FVEVSIFNQTgoKICAgICAgICBTd2l0Y2guIE9ubHkgcmV0dXJuIHVzZXIgb2JqZWN0cyB3aXRoIG5vbi1udWxsIHNlcnZpY2UgcHJpbmNpcGFsIG5hbWVzLgoKICAgIC5QQVJBTUVURVIgVW5jb25zdHJhaW5lZAoKICAgICAgICBTd2l0Y2guIFJldHVybiB1c2VycyB0aGF0IGhhdmUgdW5jb25zdHJhaW5lZCBkZWxlZ2F0aW9uLgoKICAgIC5QQVJBTUVURVIgQWxsb3dEZWxlZ2F0aW9uCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIHVzZXIgYWNjb3VudHMgdGhhdCBhcmUgbm90IG1hcmtlZCBhcyAnc2Vuc2l0aXZlIGFuZCBub3QgYWxsb3dlZCBmb3IgZGVsZWdhdGlvbicKCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldFVzZXIgLURvbWFpbiB0ZXN0aW5nCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0VXNlciAtQURTcGF0aCAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgojPgoKICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZpbHRlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU1BOLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRBZG1pbkNvdW50LAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRVbmNvbnN0cmFpbmVkLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRBbGxvd0RlbGVnYXRpb24sCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgIyBzbyB0aGlzIGlzbid0IHJlcGVhdGVkIGlmIHVzZXJzIGFyZSBwYXNzZWQgb24gdGhlIHBpcGVsaW5lCiAgICAgICAgJFVzZXJTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLUFEU3BhdGggJEFEU3BhdGggLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZSAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbAogICAgfQoKICAgIHByb2Nlc3MgewogICAgICAgIGlmKCRVc2VyU2VhcmNoZXIpIHsKCiAgICAgICAgICAgICMgaWYgd2UncmUgY2hlY2tpbmcgZm9yIHVuY29uc3RyYWluZWQgZGVsZWdhdGlvbgogICAgICAgICAgICBpZigkVW5jb25zdHJhaW5lZCkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiQ2hlY2tpbmcgZm9yIHVuY29uc3RyYWluZWQgZGVsZWdhdGlvbiIKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIih1c2VyQWNjb3VudENvbnRyb2w6MS4yLjg0MC4xMTM1NTYuMS40LjgwMzo9NTI0Mjg4KSIKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkQWxsb3dEZWxlZ2F0aW9uKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDaGVja2luZyBmb3IgdXNlcnMgd2hvIGNhbiBiZSBkZWxlZ2F0ZWQiCiAgICAgICAgICAgICAgICAjIG5lZ2F0aW9uIG9mICJBY2NvdW50cyB0aGF0IGFyZSBzZW5zaXRpdmUgYW5kIG5vdCB0cnVzdGVkIGZvciBkZWxlZ2F0aW9uIgogICAgICAgICAgICAgICAgJEZpbHRlciArPSAiKCEodXNlckFjY291bnRDb250cm9sOjEuMi44NDAuMTEzNTU2LjEuNC44MDM6PTEwNDg1NzQpKSIKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkQWRtaW5Db3VudCkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiQ2hlY2tpbmcgZm9yIGFkbWluQ291bnQ9MSIKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIihhZG1pbmNvdW50PTEpIgogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGNoZWNrIGlmIHdlJ3JlIHVzaW5nIGEgdXNlcm5hbWUgZmlsdGVyIG9yIG5vdAogICAgICAgICAgICBpZigkVXNlck5hbWUpIHsKICAgICAgICAgICAgICAgICMgc2FtQWNjb3VudFR5cGU9ODA1MzA2MzY4IGluZGljYXRlcyB1c2VyIG9iamVjdHMKICAgICAgICAgICAgICAgICRVc2VyU2VhcmNoZXIuZmlsdGVyPSIoJihzYW1BY2NvdW50VHlwZT04MDUzMDYzNjgpKHNhbUFjY291bnROYW1lPSRVc2VyTmFtZSkkRmlsdGVyKSIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoJFNQTikgewogICAgICAgICAgICAgICAgJFVzZXJTZWFyY2hlci5maWx0ZXI9IigmKHNhbUFjY291bnRUeXBlPTgwNTMwNjM2OCkoc2VydmljZVByaW5jaXBhbE5hbWU9KikkRmlsdGVyKSIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICMgZmlsdGVyIGlzIHNvbWV0aGluZyBsaWtlICIoc2FtQWNjb3VudE5hbWU9KmJsYWgqKSIgaWYgc3BlY2lmaWVkCiAgICAgICAgICAgICAgICAkVXNlclNlYXJjaGVyLmZpbHRlcj0iKCYoc2FtQWNjb3VudFR5cGU9ODA1MzA2MzY4KSRGaWx0ZXIpIgogICAgICAgICAgICB9CgogICAgICAgICAgICAkUmVzdWx0cyA9ICRVc2VyU2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAjIGNvbnZlcnQvcHJvY2VzcyB0aGUgTERBUCBmaWVsZHMgZm9yIGVhY2ggcmVzdWx0CiAgICAgICAgICAgICAgICAkVXNlciA9IENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICRVc2VyLlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5Vc2VyJykKICAgICAgICAgICAgICAgICRVc2VyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICRVc2VyU2VhcmNoZXIuZGlzcG9zZSgpCiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gQWRkLU5ldFVzZXIgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEFkZHMgYSBkb21haW4gdXNlciBvciBhIGxvY2FsIHVzZXIgdG8gdGhlIGN1cnJlbnQgKG9yIHJlbW90ZSkgbWFjaGluZSwKICAgICAgICBpZiBwZXJtaXNzaW9ucyBhbGxvdywgdXRpbGl6aW5nIHRoZSBXaW5OVCBzZXJ2aWNlIHByb3ZpZGVyIGFuZAogICAgICAgIERpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LCByZXNwZWN0aXZlbHkuCiAgICAgICAgCiAgICAgICAgVGhlIGRlZmF1bHQgYmVoYXZpb3IgaXMgdG8gYWRkIGEgdXNlciB0byB0aGUgbG9jYWwgbWFjaGluZS4KICAgICAgICBBbiBvcHRpb25hbCBncm91cCBuYW1lIHRvIGFkZCB0aGUgdXNlciB0byBjYW4gYmUgc3BlY2lmaWVkLgoKICAgIC5QQVJBTUVURVIgVXNlck5hbWUKCiAgICAgICAgVGhlIHVzZXJuYW1lIHRvIGFkZC4gSWYgbm90IGdpdmVuLCBpdCBkZWZhdWx0cyB0byAnYmFja2Rvb3InCgogICAgLlBBUkFNRVRFUiBQYXNzd29yZAoKICAgICAgICBUaGUgcGFzc3dvcmQgdG8gc2V0IGZvciB0aGUgYWRkZWQgdXNlci4gSWYgbm90IGdpdmVuLCBpdCBkZWZhdWx0cyB0byAnUGFzc3dvcmQxMjMhJwoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIEdyb3VwIHRvIG9wdGlvbmFsbHkgYWRkIHRoZSB1c2VyIHRvLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIEhvc3RuYW1lIHRvIGFkZCB0aGUgbG9jYWwgdXNlciB0bywgZGVmYXVsdHMgdG8gJ2xvY2FsaG9zdCcKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBTcGVjaWZpZWQgZG9tYWluIHRvIGFkZCB0aGUgdXNlciB0by4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEFkZC1OZXRVc2VyIC1Vc2VyTmFtZSBqb2huIC1QYXNzd29yZCAnUGFzc3dvcmQxMjMhJwogICAgICAgIAogICAgICAgIEFkZHMgYSBsb2NhbHVzZXIgJ2pvaG4nIHRvIHRoZSBsb2NhbCBtYWNoaW5lIHdpdGggcGFzc3dvcmQgb2YgJ1Bhc3N3b3JkMTIzIScKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEFkZC1OZXRVc2VyIC1Vc2VyTmFtZSBqb2huIC1QYXNzd29yZCAnUGFzc3dvcmQxMjMhJyAtQ29tcHV0ZXJOYW1lIHNlcnZlci50ZXN0bGFiLmxvY2FsCiAgICAgICAgCiAgICAgICAgQWRkcyBhIGxvY2FsdXNlciAnam9obicgd2l0aCBwYXNzd29yZCBvZiAnUGFzc3dvcmQxMjMhJyB0byBzZXJ2ZXIudGVzdGxhYi5sb2NhbCdzIGxvY2FsIEFkbWluaXN0cmF0b3JzIGdyb3VwLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gQWRkLU5ldFVzZXIgLVVzZXJOYW1lIGpvaG4gLVBhc3N3b3JkIHBhc3N3b3JkIC1Hcm91cE5hbWUgIkRvbWFpbiBBZG1pbnMiIC1Eb21haW4gJycKICAgICAgICAKICAgICAgICBBZGRzIHRoZSB1c2VyICJqb2huIiB3aXRoIHBhc3N3b3JkICJwYXNzd29yZCIgdG8gdGhlIGN1cnJlbnQgZG9tYWluIGFuZCBhZGRzCiAgICAgICAgdGhlIHVzZXIgdG8gdGhlIGRvbWFpbiBncm91cCAiRG9tYWluIEFkbWlucyIKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEFkZC1OZXRVc2VyIC1Vc2VyTmFtZSBqb2huIC1QYXNzd29yZCBwYXNzd29yZCAtR3JvdXBOYW1lICJEb21haW4gQWRtaW5zIiAtRG9tYWluICd0ZXN0aW5nJwogICAgICAgIAogICAgICAgIEFkZHMgdGhlIHVzZXIgImpvaG4iIHdpdGggcGFzc3dvcmQgInBhc3N3b3JkIiB0byB0aGUgJ3Rlc3RpbmcnIGRvbWFpbiBhbmQgYWRkcwogICAgICAgIHRoZSB1c2VyIHRvIHRoZSBkb21haW4gZ3JvdXAgIkRvbWFpbiBBZG1pbnMiCgogICAgLkxpbmsKCiAgICAgICAgaHR0cDovL2Jsb2dzLnRlY2huZXQuY29tL2IvaGV5c2NyaXB0aW5nZ3V5L2FyY2hpdmUvMjAxMC8xMS8yMy91c2UtcG93ZXJzaGVsbC10by1jcmVhdGUtbG9jYWwtdXNlci1hY2NvdW50cy5hc3B4CiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJOYW1lID0gJ2JhY2tkb29yJywKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRQYXNzd29yZCA9ICdQYXNzd29yZDEyMyEnLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdyb3VwTmFtZSwKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbQWxpYXMoJ0hvc3ROYW1lJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJ2xvY2FsaG9zdCcsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluCiAgICApCgogICAgaWYgKCREb21haW4pIHsKCiAgICAgICAgJERvbWFpbk9iamVjdCA9IEdldC1OZXREb21haW4gLURvbWFpbiAkRG9tYWluCiAgICAgICAgaWYoLW5vdCAkRG9tYWluT2JqZWN0KSB7CiAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkVycm9yIGluIGdyYWJiaW5nICREb21haW4gb2JqZWN0IgogICAgICAgICAgICByZXR1cm4gJE51bGwKICAgICAgICB9CgogICAgICAgICMgYWRkIHRoZSBhc3NlbWJseSB3ZSBuZWVkCiAgICAgICAgQWRkLVR5cGUgLUFzc2VtYmx5TmFtZSBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQKCiAgICAgICAgIyBodHRwOi8vcmljaGFyZHNwb3dlcnNoZWxsYmxvZy53b3JkcHJlc3MuY29tLzIwMDgvMDUvMjUvc3lzdGVtLWRpcmVjdG9yeXNlcnZpY2VzLWFjY291bnRtYW5hZ2VtZW50LwogICAgICAgICMgZ2V0IHRoZSBkb21haW4gY29udGV4dAogICAgICAgICRDb250ZXh0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LlByaW5jaXBhbENvbnRleHQgLUFyZ3VtZW50TGlzdCAoW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5Db250ZXh0VHlwZV06OkRvbWFpbiksICREb21haW5PYmplY3QKCiAgICAgICAgIyBjcmVhdGUgdGhlIHVzZXIgb2JqZWN0CiAgICAgICAgJFVzZXIgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuVXNlclByaW5jaXBhbCAtQXJndW1lbnRMaXN0ICRDb250ZXh0CgogICAgICAgICMgc2V0IHVzZXIgcHJvcGVydGllcwogICAgICAgICRVc2VyLk5hbWUgPSAkVXNlck5hbWUKICAgICAgICAkVXNlci5TYW1BY2NvdW50TmFtZSA9ICRVc2VyTmFtZQogICAgICAgICRVc2VyLlBhc3N3b3JkTm90UmVxdWlyZWQgPSAkRmFsc2UKICAgICAgICAkVXNlci5TZXRQYXNzd29yZCgkUGFzc3dvcmQpCiAgICAgICAgJFVzZXIuRW5hYmxlZCA9ICRUcnVlCgogICAgICAgIFdyaXRlLVZlcmJvc2UgIkNyZWF0aW5nIHVzZXIgJFVzZXJOYW1lIHRvIHdpdGggcGFzc3dvcmQgJyRQYXNzd29yZCcgaW4gZG9tYWluICREb21haW4iCgogICAgICAgIHRyeSB7CiAgICAgICAgICAgICMgY29tbWl0IHRoZSB1c2VyCiAgICAgICAgICAgICRVc2VyLlNhdmUoKQogICAgICAgICAgICAiWypdIFVzZXIgJFVzZXJOYW1lIHN1Y2Nlc3NmdWxseSBjcmVhdGVkIGluIGRvbWFpbiAkRG9tYWluIgogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgJ1shXSBVc2VyIGFscmVhZHkgZXhpc3RzIScKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiQ3JlYXRpbmcgdXNlciAkVXNlck5hbWUgdG8gd2l0aCBwYXNzd29yZCAnJFBhc3N3b3JkJyBvbiAkQ29tcHV0ZXJOYW1lIgoKICAgICAgICAjIGlmIGl0J3Mgbm90IGEgZG9tYWluIGFkZCwgaXQncyBhIGxvY2FsIG1hY2hpbmUgYWRkCiAgICAgICAgJE9iak91ID0gW0FEU0ldIldpbk5UOi8vJENvbXB1dGVyTmFtZSIKICAgICAgICAkT2JqVXNlciA9ICRPYmpPdS5DcmVhdGUoJ1VzZXInLCAkVXNlck5hbWUpCiAgICAgICAgJE9ialVzZXIuU2V0UGFzc3dvcmQoJFBhc3N3b3JkKQoKICAgICAgICAjIGNvbW1pdCB0aGUgY2hhbmdlcyB0byB0aGUgbG9jYWwgbWFjaGluZQogICAgICAgIHRyeSB7CiAgICAgICAgICAgICROdWxsID0gJE9ialVzZXIuU2V0SW5mbygpCiAgICAgICAgICAgICJbKl0gVXNlciAkVXNlck5hbWUgc3VjY2Vzc2Z1bGx5IGNyZWF0ZWQgb24gaG9zdCAkQ29tcHV0ZXJOYW1lIgogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgJ1shXSBBY2NvdW50IGFscmVhZHkgZXhpc3RzIScKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgfQoKICAgICMgaWYgYSBncm91cCBpcyBzcGVjaWZpZWQsIGludm9rZSBBZGQtTmV0R3JvdXBVc2VyIGFuZCByZXR1cm4gaXRzIHZhbHVlCiAgICBpZiAoJEdyb3VwTmFtZSkgewogICAgICAgICMgaWYgd2UncmUgYWRkaW5nIHRoZSB1c2VyIHRvIGEgZG9tYWluCiAgICAgICAgaWYgKCREb21haW4pIHsKICAgICAgICAgICAgQWRkLU5ldEdyb3VwVXNlciAtVXNlck5hbWUgJFVzZXJOYW1lIC1Hcm91cE5hbWUgJEdyb3VwTmFtZSAtRG9tYWluICREb21haW4KICAgICAgICAgICAgIlsqXSBVc2VyICRVc2VyTmFtZSBzdWNjZXNzZnVsbHkgYWRkZWQgdG8gZ3JvdXAgJEdyb3VwTmFtZSBpbiBkb21haW4gJERvbWFpbiIKICAgICAgICB9CiAgICAgICAgIyBvdGhlcndpc2UsIHdlJ3JlIGFkZGluZyB0byBhIGxvY2FsIGdyb3VwCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIEFkZC1OZXRHcm91cFVzZXIgLVVzZXJOYW1lICRVc2VyTmFtZSAtR3JvdXBOYW1lICRHcm91cE5hbWUgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICJbKl0gVXNlciAkVXNlck5hbWUgc3VjY2Vzc2Z1bGx5IGFkZGVkIHRvIGdyb3VwICRHcm91cE5hbWUgb24gaG9zdCAkQ29tcHV0ZXJOYW1lIgogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEFkZC1OZXRHcm91cFVzZXIgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEFkZHMgYSB1c2VyIHRvIGEgZG9tYWluIGdyb3VwIG9yIGEgbG9jYWwgZ3JvdXAgb24gdGhlIGN1cnJlbnQgKG9yIHJlbW90ZSkgbWFjaGluZSwKICAgICAgICBpZiBwZXJtaXNzaW9ucyBhbGxvdywgdXRpbGl6aW5nIHRoZSBXaW5OVCBzZXJ2aWNlIHByb3ZpZGVyIGFuZAogICAgICAgIERpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LCByZXNwZWN0aXZlbHkuCgogICAgLlBBUkFNRVRFUiBVc2VyTmFtZQoKICAgICAgICBUaGUgZG9tYWluIHVzZXJuYW1lIHRvIHF1ZXJ5IGZvci4KCiAgICAuUEFSQU1FVEVSIEdyb3VwTmFtZQoKICAgICAgICBHcm91cCB0byBhZGQgdGhlIHVzZXIgdG8uCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgSG9zdG5hbWUgdG8gYWRkIHRoZSB1c2VyIHRvLCBkZWZhdWx0cyB0byBsb2NhbGhvc3QuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIHRvIGFkZCB0aGUgdXNlciB0by4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEFkZC1OZXRHcm91cFVzZXIgLVVzZXJOYW1lIGpvaG4gLUdyb3VwTmFtZSBBZG1pbmlzdHJhdG9ycwogICAgICAgIAogICAgICAgIEFkZHMgYSBsb2NhbHVzZXIgImpvaG4iIHRvIHRoZSBsb2NhbCBncm91cCAiQWRtaW5pc3RyYXRvcnMiCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBBZGQtTmV0R3JvdXBVc2VyIC1Vc2VyTmFtZSBqb2huIC1Hcm91cE5hbWUgIkRvbWFpbiBBZG1pbnMiIC1Eb21haW4gZGV2LmxvY2FsCiAgICAgICAgCiAgICAgICAgQWRkcyB0aGUgZXhpc3RpbmcgdXNlciAiam9obiIgdG8gdGhlIGRvbWFpbiBncm91cCAiRG9tYWluIEFkbWlucyIgaW4gImRldi5sb2NhbCIKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyTmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRHcm91cE5hbWUsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluCiAgICApCgogICAgIyBhZGQgdGhlIGFzc2VtYmx5IGlmIHdlIG5lZWQgaXQKICAgIEFkZC1UeXBlIC1Bc3NlbWJseU5hbWUgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50CgogICAgIyBpZiB3ZSdyZSBhZGRpbmcgdG8gYSByZW1vdGUgaG9zdCdzIGxvY2FsIGdyb3VwLCB1c2UgdGhlIFdpbk5UIHByb3ZpZGVyCiAgICBpZigkQ29tcHV0ZXJOYW1lIC1hbmQgKCRDb21wdXRlck5hbWUgLW5lICJsb2NhbGhvc3QiKSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkFkZGluZyB1c2VyICRVc2VyTmFtZSB0byAkR3JvdXBOYW1lIG9uIGhvc3QgJENvbXB1dGVyTmFtZSIKICAgICAgICAgICAgKFtBRFNJXSJXaW5OVDovLyRDb21wdXRlck5hbWUvJEdyb3VwTmFtZSxncm91cCIpLmFkZCgiV2luTlQ6Ly8kQ29tcHV0ZXJOYW1lLyRVc2VyTmFtZSx1c2VyIikKICAgICAgICAgICAgIlsqXSBVc2VyICRVc2VyTmFtZSBzdWNjZXNzZnVsbHkgYWRkZWQgdG8gZ3JvdXAgJEdyb3VwTmFtZSBvbiAkQ29tcHV0ZXJOYW1lIgogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIlshXSBFcnJvciBhZGRpbmcgdXNlciAkVXNlck5hbWUgdG8gZ3JvdXAgJEdyb3VwTmFtZSBvbiAkQ29tcHV0ZXJOYW1lIgogICAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICB9CgogICAgIyBvdGhlcndpc2UgaXQncyBhIGxvY2FsIG1hY2hpbmUgb3IgZG9tYWluIGFkZAogICAgZWxzZSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCREb21haW4pIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkFkZGluZyB1c2VyICRVc2VyTmFtZSB0byAkR3JvdXBOYW1lIG9uIGRvbWFpbiAkRG9tYWluIgogICAgICAgICAgICAgICAgJENUID0gW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5Db250ZXh0VHlwZV06OkRvbWFpbgogICAgICAgICAgICAgICAgJERvbWFpbk9iamVjdCA9IEdldC1OZXREb21haW4gLURvbWFpbiAkRG9tYWluCiAgICAgICAgICAgICAgICBpZigtbm90ICREb21haW5PYmplY3QpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJE51bGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICMgZ2V0IHRoZSBmdWxsIHByaW5jaXBhbCBjb250ZXh0CiAgICAgICAgICAgICAgICAkQ29udGV4dCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5QcmluY2lwYWxDb250ZXh0IC1Bcmd1bWVudExpc3QgJENULCAkRG9tYWluT2JqZWN0ICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSwgZ2V0IHRoZSBsb2NhbCBtYWNoaW5lIGNvbnRleHQKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkFkZGluZyB1c2VyICRVc2VyTmFtZSB0byAkR3JvdXBOYW1lIG9uIGxvY2FsaG9zdCIKICAgICAgICAgICAgICAgICRDb250ZXh0ID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuUHJpbmNpcGFsQ29udGV4dChbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LkNvbnRleHRUeXBlXTo6TWFjaGluZSwgJEVudjpDb21wdXRlck5hbWUpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgZmluZCB0aGUgcGFydGljdWxhciBncm91cAogICAgICAgICAgICAkR3JvdXAgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50Lkdyb3VwUHJpbmNpcGFsXTo6RmluZEJ5SWRlbnRpdHkoJENvbnRleHQsJEdyb3VwTmFtZSkKCiAgICAgICAgICAgICMgYWRkIHRoZSBwYXJ0aWN1bGFyIHVzZXIgdG8gdGhlIGdyb3VwCiAgICAgICAgICAgICRHcm91cC5NZW1iZXJzLmFkZCgkQ29udGV4dCwgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5JZGVudGl0eVR5cGVdOjpTYW1BY2NvdW50TmFtZSwgJFVzZXJOYW1lKQoKICAgICAgICAgICAgIyBjb21taXQgdGhlIGNoYW5nZXMKICAgICAgICAgICAgJEdyb3VwLlNhdmUoKQogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkVycm9yIGFkZGluZyAkVXNlck5hbWUgdG8gJEdyb3VwTmFtZSA6ICRfIgogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1Vc2VyUHJvcGVydHkgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFJldHVybnMgYSBsaXN0IG9mIGFsbCB1c2VyIG9iamVjdCBwcm9wZXJ0aWVzLiBJZiBhIHByb3BlcnR5CiAgICAgICAgbmFtZSBpcyBzcGVjaWZpZWQsIGl0IHJldHVybnMgYWxsIFt1c2VyOnByb3BlcnR5XSB2YWx1ZXMuCgogICAgICAgIFRha2VuIGRpcmVjdGx5IGZyb20gQG9ic2N1cmVzZWMncyBwb3N0OgogICAgICAgICAgICBodHRwOi8vb2JzY3VyZXNlY3VyaXR5LmJsb2dzcG90LmNvbS8yMDE0LzA0L0FEU0lTZWFyY2hlci5odG1sCgogICAgLlBBUkFNRVRFUiBQcm9wZXJ0aWVzCgogICAgICAgIFByb3BlcnR5IG5hbWVzIHRvIGV4dHJhY3QgZm9yIHVzZXJzLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHVzZXIgcHJvcGVydGllcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtVXNlclByb3BlcnR5IC1Eb21haW4gdGVzdGluZwogICAgICAgIAogICAgICAgIFJldHVybnMgYWxsIHVzZXIgcHJvcGVydGllcyBmb3IgdXNlcnMgaW4gdGhlICd0ZXN0aW5nJyBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtVXNlclByb3BlcnR5IC1Qcm9wZXJ0aWVzIHNzbixsYXN0bG9nb24sbG9jYXRpb24KICAgICAgICAKICAgICAgICBSZXR1cm5zIGFsbCBhbiBhcnJheSBvZiB1c2VyL3Nzbi9sYXN0bG9naW4vbG9jYXRpb24gY29tYmluYXRpb25zCiAgICAgICAgZm9yIHVzZXJzIGluIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vb2JzY3VyZXNlY3VyaXR5LmJsb2dzcG90LmNvbS8yMDE0LzA0L0FEU0lTZWFyY2hlci5odG1sCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkUHJvcGVydGllcywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAogICAgICAgIAogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBpZigkUHJvcGVydGllcykgewogICAgICAgICMgZXh0cmFjdCBvdXQgdGhlIHNldCBvZiBhbGwgcHJvcGVydGllcyBmb3IgZWFjaCBvYmplY3QKICAgICAgICAkUHJvcGVydGllcyA9ICwibmFtZSIgKyAkUHJvcGVydGllcwogICAgICAgIEdldC1OZXRVc2VyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIHwgU2VsZWN0LU9iamVjdCAtUHJvcGVydHkgJFByb3BlcnRpZXMKICAgIH0KICAgIGVsc2UgewogICAgICAgICMgZXh0cmFjdCBvdXQganVzdCB0aGUgcHJvcGVydHkgbmFtZXMKICAgICAgICBHZXQtTmV0VXNlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZSAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEgfCBHZXQtTWVtYmVyIC1NZW1iZXJUeXBlICpQcm9wZXJ0eSB8IFNlbGVjdC1PYmplY3QgLVByb3BlcnR5ICdOYW1lJwogICAgfQp9CgoKZmlsdGVyIEZpbmQtVXNlckZpZWxkIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBTZWFyY2hlcyB1c2VyIG9iamVjdCBmaWVsZHMgZm9yIGEgZ2l2ZW4gd29yZCAoZGVmYXVsdCAqcGFzcyopLiBEZWZhdWx0CiAgICAgICAgZmllbGQgYmVpbmcgc2VhcmNoZWQgaXMgJ2Rlc2NyaXB0aW9uJy4KCiAgICAgICAgVGFrZW4gZGlyZWN0bHkgZnJvbSBAb2JzY3VyZXNlYydzIHBvc3Q6CiAgICAgICAgICAgIGh0dHA6Ly9vYnNjdXJlc2VjdXJpdHkuYmxvZ3Nwb3QuY29tLzIwMTQvMDQvQURTSVNlYXJjaGVyLmh0bWwKCiAgICAuUEFSQU1FVEVSIFNlYXJjaFRlcm0KCiAgICAgICAgVGVybSB0byBzZWFyY2ggZm9yLCBkZWZhdWx0IG9mICJwYXNzIi4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaEZpZWxkCgogICAgICAgIFVzZXIgZmllbGQgdG8gc2VhcmNoLCBkZWZhdWx0IG9mICJkZXNjcmlwdGlvbiIuCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCwgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBEb21haW4gdG8gc2VhcmNoIGNvbXB1dGVyIGZpZWxkcyBmb3IsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gRmluZC1Vc2VyRmllbGQgLVNlYXJjaEZpZWxkIGluZm8gLVNlYXJjaFRlcm0gYmFja3VwCgogICAgICAgIEZpbmQgdXNlciBhY2NvdW50cyB3aXRoICJiYWNrdXAiIGluIHRoZSAiaW5mbyIgZmllbGQuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2VhcmNoVGVybSA9ICdwYXNzJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2VhcmNoRmllbGQgPSAnZGVzY3JpcHRpb24nLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKIAogICAgR2V0LU5ldFVzZXIgLUFEU3BhdGggJEFEU3BhdGggLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1GaWx0ZXIgIigkU2VhcmNoRmllbGQ9KiRTZWFyY2hUZXJtKikiIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBTZWxlY3QtT2JqZWN0IHNhbWFjY291bnRuYW1lLCRTZWFyY2hGaWVsZAp9CgoKZmlsdGVyIEdldC1Vc2VyRXZlbnQgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIER1bXAgYW5kIHBhcnNlIHNlY3VyaXR5IGV2ZW50cyByZWxhdGluZyB0byBhbiBhY2NvdW50IGxvZ29uIChJRCA0NjI0KQogICAgICAgIG9yIGEgVEdUIHJlcXVlc3QgZXZlbnQgKElEIDQ3NjgpLiBJbnRlbmRlZCB0byBiZSB1c2VkIGFuZCB0ZXN0ZWQgb24KICAgICAgICBXaW5kb3dzIDIwMDggRG9tYWluIENvbnRyb2xsZXJzLgogICAgICAgIEFkbWluIFJlcWQ/IFlFUwoKICAgICAgICBBdXRob3I6IEBzaXhkdWIKCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBUaGUgY29tcHV0ZXIgdG8gZ2V0IGV2ZW50cyBmcm9tLiBEZWZhdWx0OiBMb2NhbGhvc3QKCiAgICAuUEFSQU1FVEVSIEV2ZW50VHlwZQoKICAgICAgICBFaXRoZXIgJ2xvZ29uJywgJ3RndCcsIG9yICdhbGwnLiBEZWZhdWx0czogJ2xvZ29uJwoKICAgIC5QQVJBTUVURVIgRGF0ZVN0YXJ0CgogICAgICAgIEZpbHRlciBvdXQgYWxsIGV2ZW50cyBiZWZvcmUgdGhpcyBkYXRlLiBEZWZhdWx0OiA1IGRheXMKCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LVVzZXJFdmVudCAtQ29tcHV0ZXJOYW1lIERvbWFpbkNvbnRyb2xsZXIudGVzdGxhYi5sb2NhbAoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly93d3cuc2l4ZHViLm5ldC8yMDE0LzExLzA3L29mZmVuc2l2ZS1ldmVudC1wYXJzaW5nLWJyaW5naW5nLWhvbWUtdHJvcGhpZXMvCiM+CgogICAgUGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJEVudjpDb21wdXRlck5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlU2V0KCJsb2dvbiIsInRndCIsImFsbCIpXQogICAgICAgICRFdmVudFR5cGUgPSAibG9nb24iLAoKICAgICAgICBbRGF0ZVRpbWVdCiAgICAgICAgJERhdGVTdGFydCA9IFtEYXRlVGltZV06OlRvZGF5LkFkZERheXMoLTUpLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIGlmKCRFdmVudFR5cGUuVG9Mb3dlcigpIC1saWtlICJsb2dvbiIpIHsKICAgICAgICBbSW50MzJbXV0kSUQgPSBAKDQ2MjQpCiAgICB9CiAgICBlbHNlaWYoJEV2ZW50VHlwZS5Ub0xvd2VyKCkgLWxpa2UgInRndCIpIHsKICAgICAgICBbSW50MzJbXV0kSUQgPSBAKDQ3NjgpCiAgICB9CiAgICBlbHNlIHsKICAgICAgICBbSW50MzJbXV0kSUQgPSBAKDQ2MjQsIDQ3NjgpCiAgICB9CgogICAgaWYoJENyZWRlbnRpYWwpIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJVc2luZyBhbHRlcm5hdGl2ZSBjcmVkZW50aWFscyIKICAgICAgICAkQXJndW1lbnRzID0gQHsKICAgICAgICAgICAgJ0NvbXB1dGVyTmFtZScgPSAkQ29tcHV0ZXJOYW1lOwogICAgICAgICAgICAnQ3JlZGVudGlhbCcgPSAkQ3JlZGVudGlhbDsKICAgICAgICAgICAgJ0ZpbHRlckhhc2hUYWJsZScgPSBAeyBMb2dOYW1lID0gJ1NlY3VyaXR5JzsgSUQ9JElEOyBTdGFydFRpbWU9JERhdGVTdGFydH07CiAgICAgICAgICAgICdFcnJvckFjdGlvbicgPSAnU2lsZW50bHlDb250aW51ZSc7CiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgJEFyZ3VtZW50cyA9IEB7CiAgICAgICAgICAgICdDb21wdXRlck5hbWUnID0gJENvbXB1dGVyTmFtZTsKICAgICAgICAgICAgJ0ZpbHRlckhhc2hUYWJsZScgPSBAeyBMb2dOYW1lID0gJ1NlY3VyaXR5JzsgSUQ9JElEOyBTdGFydFRpbWU9JERhdGVTdGFydH07CiAgICAgICAgICAgICdFcnJvckFjdGlvbicgPSAnU2lsZW50bHlDb250aW51ZSc7ICAgICAgICAgICAgCiAgICAgICAgfQogICAgfQoKICAgICMgZ3JhYiBhbGwgZXZlbnRzIG1hdGNoaW5nIG91ciBmaWx0ZXIgZm9yIHRoZSBzcGVjaWZpZWQgaG9zdAogICAgR2V0LVdpbkV2ZW50IEBBcmd1bWVudHMgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgIGlmKCRJRCAtY29udGFpbnMgNDYyNCkgeyAgICAKICAgICAgICAgICAgIyBmaXJzdCBwYXJzZSBhbmQgY2hlY2sgdGhlIGxvZ29uIGV2ZW50IHR5cGUuIFRoaXMgY291bGQgYmUgbGF0ZXIgYWRhcHRlZCBhbmQgdGVzdGVkIGZvciBSRFAgbG9nb25zICh0eXBlIDEwKQogICAgICAgICAgICBpZigkXy5tZXNzYWdlIC1tYXRjaCAnKD9zKSg/PD1Mb2dvbiBUeXBlOikuKj8oPz0oSW1wZXJzb25hdGlvbiBMZXZlbDp8TmV3IExvZ29uOikpJykgewogICAgICAgICAgICAgICAgaWYoJE1hdGNoZXMpIHsKICAgICAgICAgICAgICAgICAgICAkTG9nb25UeXBlID0gJE1hdGNoZXNbMF0udHJpbSgpCiAgICAgICAgICAgICAgICAgICAgJE1hdGNoZXMgPSAkTnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJExvZ29uVHlwZSA9ICIiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgaW50ZXJhY3RpdmUgbG9nb25zIG9yIGRvbWFpbiBsb2dvbnMKICAgICAgICAgICAgaWYgKCgkTG9nb25UeXBlIC1lcSAyKSAtb3IgKCRMb2dvblR5cGUgLWVxIDMpKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICMgcGFyc2UgYW5kIHN0b3JlIHRoZSBhY2NvdW50IHVzZWQgYW5kIHRoZSBhZGRyZXNzIHRoZXkgY2FtZSBmcm9tCiAgICAgICAgICAgICAgICAgICAgaWYoJF8ubWVzc2FnZSAtbWF0Y2ggJyg/cykoPzw9TmV3IExvZ29uOikuKj8oPz1Qcm9jZXNzIEluZm9ybWF0aW9uOiknKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRNYXRjaGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVXNlck5hbWUgPSAkTWF0Y2hlc1swXS5zcGxpdCgiYG4iKVsyXS5zcGxpdCgiOiIpWzFdLnRyaW0oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpbiA9ICRNYXRjaGVzWzBdLnNwbGl0KCJgbiIpWzNdLnNwbGl0KCI6IilbMV0udHJpbSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWF0Y2hlcyA9ICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoJF8ubWVzc2FnZSAtbWF0Y2ggJyg/cykoPzw9TmV0d29yayBJbmZvcm1hdGlvbjopLio/KD89U291cmNlIFBvcnQ6KScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJE1hdGNoZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBZGRyZXNzID0gJE1hdGNoZXNbMF0uc3BsaXQoImBuIilbMl0uc3BsaXQoIjoiKVsxXS50cmltKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNYXRjaGVzID0gJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgIyBvbmx5IGFkZCBpZiB0aGVyZSB3YXMgYWNjb3VudCBpbmZvcm1hdGlvbiBub3QgZm9yIGEgbWFjaGluZSBvciBhbm9ueW1vdXMgbG9nb24KICAgICAgICAgICAgICAgICAgICBpZiAoJFVzZXJOYW1lIC1hbmQgKC1ub3QgJFVzZXJOYW1lLmVuZHNXaXRoKCckJykpIC1hbmQgKCRVc2VyTmFtZSAtbmUgJ0FOT05ZTU9VUyBMT0dPTicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRMb2dvbkV2ZW50UHJvcGVydGllcyA9IEB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRG9tYWluJyA9ICREb21haW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb21wdXRlck5hbWUnID0gJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1VzZXJuYW1lJyA9ICRVc2VyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0FkZHJlc3MnID0gJEFkZHJlc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJRCcgPSAnNDYyNCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdMb2dvblR5cGUnID0gJExvZ29uVHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1RpbWUnID0gJF8uVGltZUNyZWF0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAtUHJvcGVydHkgJExvZ29uRXZlbnRQcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIHBhcnNpbmcgZXZlbnQgbG9nczogJF8iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYoJElEIC1jb250YWlucyA0NzY4KSB7CiAgICAgICAgICAgICMgdGhlIFRHVCBldmVudCB0eXBlCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZigkXy5tZXNzYWdlIC1tYXRjaCAnKD9zKSg/PD1BY2NvdW50IEluZm9ybWF0aW9uOikuKj8oPz1TZXJ2aWNlIEluZm9ybWF0aW9uOiknKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoJE1hdGNoZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJuYW1lID0gJE1hdGNoZXNbMF0uc3BsaXQoImBuIilbMV0uc3BsaXQoIjoiKVsxXS50cmltKCkKICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpbiA9ICRNYXRjaGVzWzBdLnNwbGl0KCJgbiIpWzJdLnNwbGl0KCI6IilbMV0udHJpbSgpCiAgICAgICAgICAgICAgICAgICAgICAgICRNYXRjaGVzID0gJE51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoJF8ubWVzc2FnZSAtbWF0Y2ggJyg/cykoPzw9TmV0d29yayBJbmZvcm1hdGlvbjopLio/KD89QWRkaXRpb25hbCBJbmZvcm1hdGlvbjopJykgewogICAgICAgICAgICAgICAgICAgIGlmKCRNYXRjaGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRBZGRyZXNzID0gJE1hdGNoZXNbMF0uc3BsaXQoImBuIilbMV0uc3BsaXQoIjoiKVstMV0udHJpbSgpCiAgICAgICAgICAgICAgICAgICAgICAgICRNYXRjaGVzID0gJE51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJExvZ29uRXZlbnRQcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICAgICAnRG9tYWluJyA9ICREb21haW4KICAgICAgICAgICAgICAgICAgICAnQ29tcHV0ZXJOYW1lJyA9ICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgICAgICAnVXNlcm5hbWUnID0gJFVzZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgJ0FkZHJlc3MnID0gJEFkZHJlc3MKICAgICAgICAgICAgICAgICAgICAnSUQnID0gJzQ3NjgnCiAgICAgICAgICAgICAgICAgICAgJ0xvZ29uVHlwZScgPSAnJwogICAgICAgICAgICAgICAgICAgICdUaW1lJyA9ICRfLlRpbWVDcmVhdGVkCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5ICRMb2dvbkV2ZW50UHJvcGVydGllcwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIHBhcnNpbmcgZXZlbnQgbG9nczogJF8iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtT2JqZWN0QWNsIHsKPCMKICAgIC5TWU5PUFNJUwogICAgICAgIFJldHVybnMgdGhlIEFDTHMgYXNzb2NpYXRlZCB3aXRoIGEgc3BlY2lmaWMgYWN0aXZlIGRpcmVjdG9yeSBvYmplY3QuCgogICAgICAgIFRoYW5rcyBTZWFuIE1ldGNhbGYgKEBweXJvdGVrMykgZm9yIHRoZSBpZGVhIGFuZCBndWlkYW5jZS4KCiAgICAuUEFSQU1FVEVSIFNhbUFjY291bnROYW1lCgogICAgICAgIE9iamVjdCBuYW1lIHRvIGZpbHRlciBmb3IuICAgICAgICAKCiAgICAuUEFSQU1FVEVSIE5hbWUKCiAgICAgICAgT2JqZWN0IG5hbWUgdG8gZmlsdGVyIGZvci4KCiAgICAuUEFSQU1FVEVSIERpc3Rpbmd1aXNoZWROYW1lCgogICAgICAgIE9iamVjdCBkaXN0aW5ndWlzaGVkIG5hbWUgdG8gZmlsdGVyIGZvci4KCiAgICAuUEFSQU1FVEVSIFJlc29sdmVHVUlEcwoKICAgICAgICBTd2l0Y2guIFJlc29sdmUgR1VJRHMgdG8gdGhlaXIgZGlzcGxheSBuYW1lcy4KCiAgICAuUEFSQU1FVEVSIEZpbHRlcgoKICAgICAgICBBIGN1c3RvbWl6ZWQgbGRhcCBmaWx0ZXIgc3RyaW5nIHRvIHVzZSwgZS5nLiAiKGRlc2NyaXB0aW9uPSphZG1pbiopIgogICAgIAogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCwgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIEFEU3ByZWZpeAoKICAgICAgICBQcmVmaXggdG8gc2V0IGZvciB0aGUgc2VhcmNoZXIgKGxpa2UgIkNOPVNpdGVzLENOPUNvbmZpZ3VyYXRpb24iKQoKICAgIC5QQVJBTUVURVIgUmlnaHRzRmlsdGVyCgogICAgICAgIE9ubHkgcmV0dXJuIHJlc3VsdHMgd2l0aCB0aGUgYXNzb2NpYXRlZCByaWdodHMsICJBbGwiLCAiUmVzZXRQYXNzd29yZCIsIldyaXRlTWVtYmVycyIKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHVzZSBmb3IgdGhlIHF1ZXJ5LCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtT2JqZWN0QWNsIC1TYW1BY2NvdW50TmFtZSBtYXR0LmFkbWluIC1kb21haW4gdGVzdGxhYi5sb2NhbAogICAgICAgIAogICAgICAgIEdldCB0aGUgQUNMcyBmb3IgdGhlIG1hdHQuYWRtaW4gdXNlciBpbiB0aGUgdGVzdGxhYi5sb2NhbCBkb21haW4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1PYmplY3RBY2wgLVNhbUFjY291bnROYW1lIG1hdHQuYWRtaW4gLWRvbWFpbiB0ZXN0bGFiLmxvY2FsIC1SZXNvbHZlR1VJRHMKICAgICAgICAKICAgICAgICBHZXQgdGhlIEFDTHMgZm9yIHRoZSBtYXR0LmFkbWluIHVzZXIgaW4gdGhlIHRlc3RsYWIubG9jYWwgZG9tYWluIGFuZAogICAgICAgIHJlc29sdmUgcmVsZXZhbnQgR1VJRHMgdG8gdGhlaXIgZGlzcGxheSBuYW1lcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRPVSAtRnVsbERhdGEgfCBHZXQtT2JqZWN0QWNsIC1SZXNvbHZlR1VJRHMKCiAgICAgICAgRW51bWVyYXRlIHRoZSBBQ0wgcGVybWlzc2lvbnMgZm9yIGFsbCBPVXMgaW4gdGhlIGRvbWFpbi4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2FtQWNjb3VudE5hbWUsCgogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkTmFtZSA9ICIqIiwKCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREaXN0aW5ndWlzaGVkTmFtZSA9ICIqIiwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkUmVzb2x2ZUdVSURzLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3ByZWZpeCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVTZXQoIkFsbCIsIlJlc2V0UGFzc3dvcmQiLCJXcml0ZU1lbWJlcnMiKV0KICAgICAgICAkUmlnaHRzRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMAogICAgKQoKICAgIGJlZ2luIHsKICAgICAgICAkU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1BRFNwYXRoICRBRFNwYXRoIC1BRFNwcmVmaXggJEFEU3ByZWZpeCAtUGFnZVNpemUgJFBhZ2VTaXplIAoKICAgICAgICAjIGdldCBhIEdVSUQgLT4gbmFtZSBtYXBwaW5nCiAgICAgICAgaWYoJFJlc29sdmVHVUlEcykgewogICAgICAgICAgICAkR1VJRHMgPSBHZXQtR1VJRE1hcCAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgICAgIH0KICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgaWYgKCRTZWFyY2hlcikgewoKICAgICAgICAgICAgaWYoJFNhbUFjY291bnROYW1lKSB7CiAgICAgICAgICAgICAgICAkU2VhcmNoZXIuZmlsdGVyPSIoJihzYW1hY2NvdW50bmFtZT0kU2FtQWNjb3VudE5hbWUpKG5hbWU9JE5hbWUpKGRpc3Rpbmd1aXNoZWRuYW1lPSREaXN0aW5ndWlzaGVkTmFtZSkkRmlsdGVyKSIgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFNlYXJjaGVyLmZpbHRlcj0iKCYobmFtZT0kTmFtZSkoZGlzdGluZ3Vpc2hlZG5hbWU9JERpc3Rpbmd1aXNoZWROYW1lKSRGaWx0ZXIpIiAgCiAgICAgICAgICAgIH0KICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJFNlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAkT2JqZWN0ID0gW2Fkc2ldKCRfLnBhdGgpCgogICAgICAgICAgICAgICAgICAgIGlmKCRPYmplY3QuZGlzdGluZ3Vpc2hlZG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEFjY2VzcyA9ICRPYmplY3QuUHNCYXNlLk9iamVjdFNlY3VyaXR5LmFjY2VzcwogICAgICAgICAgICAgICAgICAgICAgICAkQWNjZXNzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJF8gfCBBZGQtTWVtYmVyIE5vdGVQcm9wZXJ0eSAnT2JqZWN0RE4nICRPYmplY3QuZGlzdGluZ3Vpc2hlZG5hbWVbMF0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkT2JqZWN0Lm9iamVjdHNpZFswXSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFMgPSAoTmV3LU9iamVjdCBTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcigkT2JqZWN0Lm9iamVjdHNpZFswXSwwKSkuVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTID0gJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJF8gfCBBZGQtTWVtYmVyIE5vdGVQcm9wZXJ0eSAnT2JqZWN0U0lEJyAkUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJF8KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgaWYoJFJpZ2h0c0ZpbHRlcikgewogICAgICAgICAgICAgICAgICAgICAgICAkR3VpZEZpbHRlciA9IFN3aXRjaCAoJFJpZ2h0c0ZpbHRlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlJlc2V0UGFzc3dvcmQiIHsgIjAwMjk5NTcwLTI0NmQtMTFkMC1hNzY4LTAwYWEwMDZlMDUyOSIgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIldyaXRlTWVtYmVycyIgeyAiYmY5Njc5YzAtMGRlNi0xMWQwLWEyODUtMDBhYTAwMzA0OWUyIiB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IHsgIjAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCJ9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoJF8uT2JqZWN0VHlwZSAtZXEgJEd1aWRGaWx0ZXIpIHsgJF8gfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJF8KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgIGlmKCRHVUlEcykgewogICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIHJlc29sdmluZyBHVUlEcywgbWFwIHRoZW0gdGhlbSB0byB0aGUgcmVzb2x2ZWQgaGFzaCB0YWJsZQogICAgICAgICAgICAgICAgICAgICAgICAkQWNsUHJvcGVydGllcyA9IEB7fQogICAgICAgICAgICAgICAgICAgICAgICAkXy5wc29iamVjdC5wcm9wZXJ0aWVzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoICgkXy5OYW1lIC1lcSAnT2JqZWN0VHlwZScpIC1vciAoJF8uTmFtZSAtZXEgJ0luaGVyaXRlZE9iamVjdFR5cGUnKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQWNsUHJvcGVydGllc1skXy5OYW1lXSA9ICRHVUlEU1skXy5WYWx1ZS50b1N0cmluZygpXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBY2xQcm9wZXJ0aWVzWyRfLk5hbWVdID0gJF8uVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQWNsUHJvcGVydGllc1skXy5OYW1lXSA9ICRfLlZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5ICRBY2xQcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgeyAkXyB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICRTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICRfCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBBZGQtT2JqZWN0QWNsIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBBZGRzIGFuIEFDTCBmb3IgYSBzcGVjaWZpYyBhY3RpdmUgZGlyZWN0b3J5IG9iamVjdC4KICAgICAgICAKICAgICAgICBBZG1pblNESG9sZGVyIEFDTCBhcHByb2FjaCBmcm9tIFNlYW4gTWV0Y2FsZiAoQHB5cm90ZWszKQogICAgICAgICAgICBodHRwczovL2Fkc2VjdXJpdHkub3JnLz9wPTE5MDYKCiAgICAgICAgQUNFIHNldHRpbmcgbWV0aG9kIGFkYXB0ZWQgZnJvbSBodHRwczovL3NvY2lhbC50ZWNobmV0Lm1pY3Jvc29mdC5jb20vRm9ydW1zL3dpbmRvd3NzZXJ2ZXIvZW4tVVMvZGYzYmZkMzMtYzA3MC00YTljLWJlOTgtYzRkYTZlNTkxYTBhL2ZvcnVtLWZhcS11c2luZy1wb3dlcnNoZWxsLXRvLWFzc2lnbi1wZXJtaXNzaW9ucy1vbi1hY3RpdmUtZGlyZWN0b3J5LW9iamVjdHMuCgogICAgICAgICdSZXNldFBhc3N3b3JkJyBkb2Vzbid0IG5lZWQgdG8ga25vdyB0aGUgdXNlcidzIGN1cnJlbnQgcGFzc3dvcmQKICAgICAgICAnV3JpdGVNZW1iZXJzJyBhbGxvd3MgZm9yIHRoZSBtb2RpZmljYXRpb24gb2YgZ3JvdXAgbWVtYmVyc2hpcAoKICAgIC5QQVJBTUVURVIgVGFyZ2V0U2FtQWNjb3VudE5hbWUKCiAgICAgICAgVGFyZ2V0IG9iamVjdCBuYW1lIHRvIGZpbHRlciBmb3IuICAgICAgICAKCiAgICAuUEFSQU1FVEVSIFRhcmdldE5hbWUKCiAgICAgICAgVGFyZ2V0IG9iamVjdCBuYW1lIHRvIGZpbHRlciBmb3IuCgogICAgLlBBUkFNRVRFUiBUYXJnZXREaXN0aW5ndWlzaGVkTmFtZQoKICAgICAgICBUYXJnZXQgb2JqZWN0IGRpc3Rpbmd1aXNoZWQgbmFtZSB0byBmaWx0ZXIgZm9yLgoKICAgIC5QQVJBTUVURVIgVGFyZ2V0RmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlIHRvIGZpbmQgYSB0YXJnZXQsIGUuZy4gIihkZXNjcmlwdGlvbj0qYWRtaW4qKSIKCiAgICAuUEFSQU1FVEVSIFRhcmdldEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIGZvciB0aGUgdGFyZ2V0LCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCgogICAgLlBBUkFNRVRFUiBUYXJnZXRBRFNwcmVmaXgKCiAgICAgICAgUHJlZml4IHRvIHNldCBmb3IgdGhlIHRhcmdldCBzZWFyY2hlciAobGlrZSAiQ049U2l0ZXMsQ049Q29uZmlndXJhdGlvbiIpCgogICAgLlBBUkFNRVRFUiBQcmluY2lwYWxTSUQKCiAgICAgICAgVGhlIFNJRCBvZiB0aGUgcHJpbmNpcGFsIG9iamVjdCB0byBhZGQgZm9yIGFjY2Vzcy4KCiAgICAuUEFSQU1FVEVSIFByaW5jaXBhbE5hbWUKCiAgICAgICAgVGhlIG5hbWUgb2YgdGhlIHByaW5jaXBhbCBvYmplY3QgdG8gYWRkIGZvciBhY2Nlc3MuCgogICAgLlBBUkFNRVRFUiBQcmluY2lwYWxTYW1BY2NvdW50TmFtZQoKICAgICAgICBUaGUgc2FtQWNjb3VudE5hbWUgb2YgdGhlIHByaW5jaXBhbCBvYmplY3QgdG8gYWRkIGZvciBhY2Nlc3MuCgogICAgLlBBUkFNRVRFUiBSaWdodHMKCiAgICAgICAgUmlnaHRzIHRvIGFkZCBmb3IgdGhlIHByaW5jaXBhbCwgIkFsbCIsIlJlc2V0UGFzc3dvcmQiLCJXcml0ZU1lbWJlcnMiLCJEQ1N5bmMiCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byB1c2UgZm9yIHRoZSB0YXJnZXQgcXVlcnksIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBBZGQtT2JqZWN0QWNsIC1UYXJnZXRTYW1BY2NvdW50TmFtZSBtYXR0IC1QcmluY2lwYWxTYW1BY2NvdW50TmFtZSBqb2huCgogICAgICAgIEdyYW50cyAnam9obicgYWxsIGZ1bGwgYWNjZXNzIHJpZ2h0cyB0byB0aGUgJ21hdHQnIGFjY291bnQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgQWRkLU9iamVjdEFjbCAtVGFyZ2V0U2FtQWNjb3VudE5hbWUgbWF0dCAtUHJpbmNpcGFsU2FtQWNjb3VudE5hbWUgam9obiAtUmlnaHRzIFJlc2V0UGFzc3dvcmQKCiAgICAgICAgR3JhbnRzICdqb2huJyB0aGUgcmlnaHQgdG8gcmVzZXQgdGhlIHBhc3N3b3JkIGZvciB0aGUgJ21hdHQnIGFjY291bnQuCgogICAgLkxJTksKCiAgICAgICAgaHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xOTA2CiAgICAgICAgCiAgICAgICAgaHR0cHM6Ly9zb2NpYWwudGVjaG5ldC5taWNyb3NvZnQuY29tL0ZvcnVtcy93aW5kb3dzc2VydmVyL2VuLVVTL2RmM2JmZDMzLWMwNzAtNGE5Yy1iZTk4LWM0ZGE2ZTU5MWEwYS9mb3J1bS1mYXEtdXNpbmctcG93ZXJzaGVsbC10by1hc3NpZ24tcGVybWlzc2lvbnMtb24tYWN0aXZlLWRpcmVjdG9yeS1vYmplY3RzP2ZvcnVtPXdpbnNlcnZlcnBvd2Vyc2hlbGwKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFRhcmdldFNhbUFjY291bnROYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRUYXJnZXROYW1lID0gIioiLAoKICAgICAgICBbQWxpYXMoJ0ROJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGFyZ2V0RGlzdGluZ3Vpc2hlZE5hbWUgPSAiKiIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFRhcmdldEZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGFyZ2V0QURTcGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGFyZ2V0QURTcHJlZml4LAoKICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZVBhdHRlcm4oJ15TLTEtNS0yMS1bMC05XSstWzAtOV0rLVswLTldKy1bMC05XSsnKV0KICAgICAgICAkUHJpbmNpcGFsU0lELAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRQcmluY2lwYWxOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRQcmluY2lwYWxTYW1BY2NvdW50TmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVTZXQoIkFsbCIsIlJlc2V0UGFzc3dvcmQiLCJXcml0ZU1lbWJlcnMiLCJEQ1N5bmMiKV0KICAgICAgICAkUmlnaHRzID0gIkFsbCIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFJpZ2h0c0dVSUQsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwCiAgICApCgogICAgYmVnaW4gewogICAgICAgICRTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUFEU3BhdGggJFRhcmdldEFEU3BhdGggLUFEU3ByZWZpeCAkVGFyZ2V0QURTcHJlZml4IC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgaWYoJFByaW5jaXBhbFNJRCkgewogICAgICAgICAgICAkUmVzb2x2ZWRQcmluY2lwYWxTSUQgPSAkUHJpbmNpcGFsU0lECiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkUHJpbmNpcGFsID0gR2V0LUFET2JqZWN0IC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtTmFtZSAkUHJpbmNpcGFsTmFtZSAtU2FtQWNjb3VudE5hbWUgJFByaW5jaXBhbFNhbUFjY291bnROYW1lIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKCEkUHJpbmNpcGFsKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiRXJyb3IgcmVzb2x2aW5nIHByaW5jaXBhbCIKICAgICAgICAgICAgfQogICAgICAgICAgICAkUmVzb2x2ZWRQcmluY2lwYWxTSUQgPSAkUHJpbmNpcGFsLm9iamVjdHNpZAogICAgICAgIH0KICAgICAgICBpZighJFJlc29sdmVkUHJpbmNpcGFsU0lEKSB7CiAgICAgICAgICAgIHRocm93ICJFcnJvciByZXNvbHZpbmcgcHJpbmNpcGFsIgogICAgICAgIH0KICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgaWYgKCRTZWFyY2hlcikgewoKICAgICAgICAgICAgaWYoJFRhcmdldFNhbUFjY291bnROYW1lKSB7CiAgICAgICAgICAgICAgICAkU2VhcmNoZXIuZmlsdGVyPSIoJihzYW1hY2NvdW50bmFtZT0kVGFyZ2V0U2FtQWNjb3VudE5hbWUpKG5hbWU9JFRhcmdldE5hbWUpKGRpc3Rpbmd1aXNoZWRuYW1lPSRUYXJnZXREaXN0aW5ndWlzaGVkTmFtZSkkVGFyZ2V0RmlsdGVyKSIgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFNlYXJjaGVyLmZpbHRlcj0iKCYobmFtZT0kVGFyZ2V0TmFtZSkoZGlzdGluZ3Vpc2hlZG5hbWU9JFRhcmdldERpc3Rpbmd1aXNoZWROYW1lKSRUYXJnZXRGaWx0ZXIpIiAgCiAgICAgICAgICAgIH0KICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJFNlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICAgICAgICAgIyBhZGFwdGVkIGZyb20gaHR0cHM6Ly9zb2NpYWwudGVjaG5ldC5taWNyb3NvZnQuY29tL0ZvcnVtcy93aW5kb3dzc2VydmVyL2VuLVVTL2RmM2JmZDMzLWMwNzAtNGE5Yy1iZTk4LWM0ZGE2ZTU5MWEwYS9mb3J1bS1mYXEtdXNpbmctcG93ZXJzaGVsbC10by1hc3NpZ24tcGVybWlzc2lvbnMtb24tYWN0aXZlLWRpcmVjdG9yeS1vYmplY3RzCgogICAgICAgICAgICAgICAgICAgICRUYXJnZXRETiA9ICRfLlByb3BlcnRpZXMuZGlzdGluZ3Vpc2hlZG5hbWUKCiAgICAgICAgICAgICAgICAgICAgJElkZW50aXR5ID0gW1N5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuSWRlbnRpdHlSZWZlcmVuY2VdIChbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXJdJFJlc29sdmVkUHJpbmNpcGFsU0lEKQogICAgICAgICAgICAgICAgICAgICRJbmhlcml0YW5jZVR5cGUgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeVNlY3VyaXR5SW5oZXJpdGFuY2VdICJOb25lIgogICAgICAgICAgICAgICAgICAgICRDb250cm9sVHlwZSA9IFtTeXN0ZW0uU2VjdXJpdHkuQWNjZXNzQ29udHJvbC5BY2Nlc3NDb250cm9sVHlwZV0gIkFsbG93IgogICAgICAgICAgICAgICAgICAgICRBQ0VzID0gQCgpCgogICAgICAgICAgICAgICAgICAgIGlmKCRSaWdodHNHVUlEKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRHVUlEcyA9IEAoJFJpZ2h0c0dVSUQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkR1VJRHMgPSBTd2l0Y2ggKCRSaWdodHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUmVzZXRQYXNzd29yZCBkb2Vzbid0IG5lZWQgdG8ga25vdyB0aGUgdXNlcidzIGN1cnJlbnQgcGFzc3dvcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJSZXNldFBhc3N3b3JkIiB7ICIwMDI5OTU3MC0yNDZkLTExZDAtYTc2OC0wMGFhMDA2ZTA1MjkiIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgYWxsb3dzIGZvciB0aGUgbW9kaWZpY2F0aW9uIG9mIGdyb3VwIG1lbWJlcnNoaXAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJXcml0ZU1lbWJlcnMiIHsgImJmOTY3OWMwLTBkZTYtMTFkMC1hMjg1LTAwYWEwMDMwNDllMiIgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAnRFMtUmVwbGljYXRpb24tR2V0LUNoYW5nZXMnID0gMTEzMWY2YWEtOWMwNy0xMWQxLWY3OWYtMDBjMDRmYzJkY2QyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICdEUy1SZXBsaWNhdGlvbi1HZXQtQ2hhbmdlcy1BbGwnID0gMTEzMWY2YWQtOWMwNy0xMWQxLWY3OWYtMDBjMDRmYzJkY2QyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICdEUy1SZXBsaWNhdGlvbi1HZXQtQ2hhbmdlcy1Jbi1GaWx0ZXJlZC1TZXQnID0gODllOTViNzYtNDQ0ZC00YzYyLTk5MWEtMGZhY2JlZGE2NDBjCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgd2hlbiBhcHBsaWVkIHRvIGEgZG9tYWluJ3MgQUNMLCBhbGxvd3MgZm9yIHRoZSB1c2Ugb2YgRENTeW5jCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiRENTeW5jIiB7ICIxMTMxZjZhYS05YzA3LTExZDEtZjc5Zi0wMGMwNGZjMmRjZDIiLCAiMTEzMWY2YWQtOWMwNy0xMWQxLWY3OWYtMDBjMDRmYzJkY2QyIiwgIjg5ZTk1Yjc2LTQ0NGQtNGM2Mi05OTFhLTBmYWNiZWRhNjQwYyJ9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKCRHVUlEcykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRHVUlEIGluICRHVUlEcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE5ld0dVSUQgPSBOZXctT2JqZWN0IEd1aWQgJEdVSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBRFJpZ2h0cyA9IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5UmlnaHRzXSAiRXh0ZW5kZWRSaWdodCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBQ0VzICs9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeUFjY2Vzc1J1bGUgJElkZW50aXR5LCRBRFJpZ2h0cywkQ29udHJvbFR5cGUsJE5ld0dVSUQsJEluaGVyaXRhbmNlVHlwZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAjIGRlYXVsdCB0byBHZW5lcmljQWxsIHJpZ2h0cwogICAgICAgICAgICAgICAgICAgICAgICAkQURSaWdodHMgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeVJpZ2h0c10gIkdlbmVyaWNBbGwiCiAgICAgICAgICAgICAgICAgICAgICAgICRBQ0VzICs9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeUFjY2Vzc1J1bGUgJElkZW50aXR5LCRBRFJpZ2h0cywkQ29udHJvbFR5cGUsJEluaGVyaXRhbmNlVHlwZQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiR3JhbnRpbmcgcHJpbmNpcGFsICRSZXNvbHZlZFByaW5jaXBhbFNJRCAnJFJpZ2h0cycgb24gJCgkXy5Qcm9wZXJ0aWVzLmRpc3Rpbmd1aXNoZWRuYW1lKSIKCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBhZGQgYWxsIHRoZSBuZXcgQUNFcyB0byB0aGUgc3BlY2lmaWVkIG9iamVjdAogICAgICAgICAgICAgICAgICAgICAgICBGb3JFYWNoICgkQUNFIGluICRBQ0VzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJHcmFudGluZyBwcmluY2lwYWwgJFJlc29sdmVkUHJpbmNpcGFsU0lEICckKCRBQ0UuT2JqZWN0VHlwZSknIHJpZ2h0cyBvbiAkKCRfLlByb3BlcnRpZXMuZGlzdGluZ3Vpc2hlZG5hbWUpIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE9iamVjdCA9IFthZHNpXSgkXy5wYXRoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE9iamVjdC5Qc0Jhc2UuT2JqZWN0U2VjdXJpdHkuQWRkQWNjZXNzUnVsZSgkQUNFKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE9iamVjdC5Qc0Jhc2UuY29tbWl0Y2hhbmdlcygpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBncmFudGluZyBwcmluY2lwYWwgJFJlc29sdmVkUHJpbmNpcGFsU0lEICckUmlnaHRzJyBvbiAkVGFyZ2V0RE4gOiAkXyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICRTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvcjogJF8iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBJbnZva2UtQUNMU2Nhbm5lciB7CjwjCiAgICAuU1lOT1BTSVMKICAgICAgICBTZWFyY2hlcyBmb3IgQUNMcyBmb3Igc3BlY2lmYWJsZSBBRCBvYmplY3RzIChkZWZhdWx0IHRvIGFsbCBkb21haW4gb2JqZWN0cykKICAgICAgICB3aXRoIGEgZG9tYWluIHNpZCBvZiA+IC0xMDAwLCBhbmQgaGF2ZSBtb2RpZmlhYmxlIHJpZ2h0cy4KCiAgICAgICAgVGhhbmtzIFNlYW4gTWV0Y2FsZiAoQHB5cm90ZWszKSBmb3IgdGhlIGlkZWEgYW5kIGd1aWRhbmNlLgoKICAgIC5QQVJBTUVURVIgU2FtQWNjb3VudE5hbWUKCiAgICAgICAgT2JqZWN0IG5hbWUgdG8gZmlsdGVyIGZvci4gICAgICAgIAoKICAgIC5QQVJBTUVURVIgTmFtZQoKICAgICAgICBPYmplY3QgbmFtZSB0byBmaWx0ZXIgZm9yLgoKICAgIC5QQVJBTUVURVIgRGlzdGluZ3Vpc2hlZE5hbWUKCiAgICAgICAgT2JqZWN0IGRpc3Rpbmd1aXNoZWQgbmFtZSB0byBmaWx0ZXIgZm9yLgoKICAgIC5QQVJBTUVURVIgRmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlLCBlLmcuICIoZGVzY3JpcHRpb249KmFkbWluKikiCiAgICAgCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgQURTcHJlZml4CgogICAgICAgIFByZWZpeCB0byBzZXQgZm9yIHRoZSBzZWFyY2hlciAobGlrZSAiQ049U2l0ZXMsQ049Q29uZmlndXJhdGlvbiIpCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byB1c2UgZm9yIHRoZSBxdWVyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgUmVzb2x2ZUdVSURzCgogICAgICAgIFN3aXRjaC4gUmVzb2x2ZSBHVUlEcyB0byB0aGVpciBkaXNwbGF5IG5hbWVzLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLUFDTFNjYW5uZXIgLVJlc29sdmVHVUlEcyB8IEV4cG9ydC1DU1YgLU5vVHlwZUluZm9ybWF0aW9uIGFjbHMuY3N2CgogICAgICAgIEVudW1lcmF0ZSBhbGwgbW9kaWZhYmxlIEFDTHMgaW4gdGhlIGN1cnJlbnQgZG9tYWluLCByZXNvbHZpbmcgR1VJRHMgdG8gZGlzcGxheSAKICAgICAgICBuYW1lcywgYW5kIGV4cG9ydCBldmVyeXRoaW5nIHRvIGEgLmNzdgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2FtQWNjb3VudE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE5hbWUgPSAiKiIsCgogICAgICAgIFtBbGlhcygnRE4nKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREaXN0aW5ndWlzaGVkTmFtZSA9ICIqIiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwcmVmaXgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkUmVzb2x2ZUdVSURzLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAKICAgICkKCiAgICAjIEdldCBhbGwgZG9tYWluIEFDTHMgd2l0aCB0aGUgYXBwcm9wcmlhdGUgcGFyYW1ldGVycwogICAgR2V0LU9iamVjdEFDTCBAUFNCb3VuZFBhcmFtZXRlcnMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgIyBhZGQgaW4gdGhlIHRyYW5zbGF0ZWQgU0lEIGZvciB0aGUgb2JqZWN0IGlkZW50aXR5CiAgICAgICAgJF8gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSWRlbnRpdHlTSUQnICgkXy5JZGVudGl0eVJlZmVyZW5jZS5UcmFuc2xhdGUoW1N5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyXSkuVmFsdWUpCiAgICAgICAgJF8KICAgIH0gfCBXaGVyZS1PYmplY3QgewogICAgICAgICMgY2hlY2sgZm9yIGFueSBBQ0xzIHdpdGggU0lEcyA+IC0xMDAwCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgIyBUT0RPOiBjaGFuZ2UgdGhpcyB0byBhIHJlZ2V4IGZvciBzcGVlZHVwPwogICAgICAgICAgICBbaW50XSgkXy5JZGVudGl0eVNpZC5zcGxpdCgiLSIpWy0xXSkgLWdlIDEwMDAKICAgICAgICB9CiAgICAgICAgY2F0Y2gge30KICAgIH0gfCBXaGVyZS1PYmplY3QgewogICAgICAgICMgZmlsdGVyIGZvciBtb2RpZmlhYmxlIHJpZ2h0cwogICAgICAgICgkXy5BY3RpdmVEaXJlY3RvcnlSaWdodHMgLWVxICJHZW5lcmljQWxsIikgLW9yICgkXy5BY3RpdmVEaXJlY3RvcnlSaWdodHMgLW1hdGNoICJXcml0ZSIpIC1vciAoJF8uQWN0aXZlRGlyZWN0b3J5UmlnaHRzIC1tYXRjaCAiQ3JlYXRlIikgLW9yICgkXy5BY3RpdmVEaXJlY3RvcnlSaWdodHMgLW1hdGNoICJEZWxldGUiKSAtb3IgKCgkXy5BY3RpdmVEaXJlY3RvcnlSaWdodHMgLW1hdGNoICJFeHRlbmRlZFJpZ2h0IikgLWFuZCAoJF8uQWNjZXNzQ29udHJvbFR5cGUgLWVxICJBbGxvdyIpKQogICAgfQp9CgoKZmlsdGVyIEdldC1HVUlETWFwIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBIZWxwZXIgdG8gYnVpbGQgYSBoYXNoIHRhYmxlIG9mIFtHVUlEXSAtPiByZXNvbHZlZCBuYW1lcwoKICAgICAgICBIZWF2aWx5IGFkYXB0ZWQgZnJvbSBodHRwOi8vYmxvZ3MudGVjaG5ldC5jb20vYi9hc2hsZXltY2dsb25lL2FyY2hpdmUvMjAxMy8wMy8yNS9hY3RpdmUtZGlyZWN0b3J5LW91LXBlcm1pc3Npb25zLXJlcG9ydC1mcmVlLXBvd2Vyc2hlbGwtc2NyaXB0LWRvd25sb2FkLmFzcHgKCiAgICAuUEFSQU1FVEVSIERvbWFpbgogICAgCiAgICAgICAgVGhlIGRvbWFpbiB0byB1c2UgZm9yIHRoZSBxdWVyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgogICAgCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vYmxvZ3MudGVjaG5ldC5jb20vYi9hc2hsZXltY2dsb25lL2FyY2hpdmUvMjAxMy8wMy8yNS9hY3RpdmUtZGlyZWN0b3J5LW91LXBlcm1pc3Npb25zLXJlcG9ydC1mcmVlLXBvd2Vyc2hlbGwtc2NyaXB0LWRvd25sb2FkLmFzcHgKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwCiAgICApCgogICAgJEdVSURzID0gQHsnMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwJyA9ICdBbGwnfQoKICAgICRTY2hlbWFQYXRoID0gKEdldC1OZXRGb3Jlc3QpLnNjaGVtYS5uYW1lCgogICAgJFNjaGVtYVNlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1BRFNwYXRoICRTY2hlbWFQYXRoIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgIGlmKCRTY2hlbWFTZWFyY2hlcikgewogICAgICAgICRTY2hlbWFTZWFyY2hlci5maWx0ZXIgPSAiKHNjaGVtYUlER1VJRD0qKSIKICAgICAgICB0cnkgewogICAgICAgICAgICAkUmVzdWx0cyA9ICRTY2hlbWFTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICMgY29udmVydCB0aGUgR1VJRAogICAgICAgICAgICAgICAgJEdVSURzWyhOZXctT2JqZWN0IEd1aWQgKCwkXy5wcm9wZXJ0aWVzLnNjaGVtYWlkZ3VpZFswXSkpLkd1aWRdID0gJF8ucHJvcGVydGllcy5uYW1lWzBdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICRTY2hlbWFTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBpbiBidWlsZGluZyBHVUlEIG1hcDogJF8iCiAgICAgICAgfQogICAgfQoKICAgICRSaWdodHNTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtQURTcGF0aCAkU2NoZW1hUGF0aC5yZXBsYWNlKCJTY2hlbWEiLCJFeHRlbmRlZC1SaWdodHMiKSAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIC1DcmVkZW50aWFsICRDcmVkZW50aWFsCiAgICBpZiAoJFJpZ2h0c1NlYXJjaGVyKSB7CiAgICAgICAgJFJpZ2h0c1NlYXJjaGVyLmZpbHRlciA9ICIob2JqZWN0Q2xhc3M9Y29udHJvbEFjY2Vzc1JpZ2h0KSIKICAgICAgICB0cnkgewogICAgICAgICAgICAkUmVzdWx0cyA9ICRSaWdodHNTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICMgY29udmVydCB0aGUgR1VJRAogICAgICAgICAgICAgICAgJEdVSURzWyRfLnByb3BlcnRpZXMucmlnaHRzZ3VpZFswXS50b1N0cmluZygpXSA9ICRfLnByb3BlcnRpZXMubmFtZVswXQogICAgICAgICAgICB9CiAgICAgICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICAgICAkUmlnaHRzU2VhcmNoZXIuZGlzcG9zZSgpCiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgaW4gYnVpbGRpbmcgR1VJRCBtYXA6ICRfIgogICAgICAgIH0KICAgIH0KCiAgICAkR1VJRHMKfQoKCmZ1bmN0aW9uIEdldC1OZXRDb21wdXRlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiB1dGlsaXplcyBhZHNpc2VhcmNoZXIgdG8gcXVlcnkgdGhlIGN1cnJlbnQgQUQgY29udGV4dAogICAgICAgIGZvciBjdXJyZW50IGNvbXB1dGVyIG9iamVjdHMuIEJhc2VkIG9mZiBvZiBDYXJsb3MgUGVyZXoncyBBdWRpdC5wc20xCiAgICAgICAgc2NyaXB0IGluIFBvc2gtU2VjTW9kIChsaW5rIGJlbG93KS4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBSZXR1cm4gY29tcHV0ZXJzIHdpdGggYSBzcGVjaWZpYyBuYW1lLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBTUE4KCiAgICAgICAgUmV0dXJuIGNvbXB1dGVycyB3aXRoIGEgc3BlY2lmaWMgc2VydmljZSBwcmluY2lwYWwgbmFtZSwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgT3BlcmF0aW5nU3lzdGVtCgogICAgICAgIFJldHVybiBjb21wdXRlcnMgd2l0aCBhIHNwZWNpZmljIG9wZXJhdGluZyBzeXN0ZW0sIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIFNlcnZpY2VQYWNrCgogICAgICAgIFJldHVybiBjb21wdXRlcnMgd2l0aCBhIHNwZWNpZmljIHNlcnZpY2UgcGFjaywgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgRmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlLCBlLmcuICIoZGVzY3JpcHRpb249KmFkbWluKikiCgogICAgLlBBUkFNRVRFUiBQcmludGVycwoKICAgICAgICBTd2l0Y2guIFJldHVybiBvbmx5IHByaW50ZXJzLgoKICAgIC5QQVJBTUVURVIgUGluZwoKICAgICAgICBTd2l0Y2guIFBpbmcgZWFjaCBob3N0IHRvIGVuc3VyZSBpdCdzIHVwIGJlZm9yZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIEZ1bGxEYXRhCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIGZ1bGwgY29tcHV0ZXIgb2JqZWN0cyBpbnN0ZWFkIG9mIGp1c3Qgc3lzdGVtIG5hbWVzICh0aGUgZGVmYXVsdCkuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgY29tcHV0ZXJzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCwgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KICAgIAogICAgLlBBUkFNRVRFUiBTaXRlTmFtZQoKICAgICAgICBUaGUgQUQgU2l0ZSBuYW1lIHRvIHNlYXJjaCBmb3IgY29tcHV0ZXJzLgoKICAgIC5QQVJBTUVURVIgVW5jb25zdHJhaW5lZAoKICAgICAgICBTd2l0Y2guIFJldHVybiBjb21wdXRlciBvYmplY3RzIHRoYXQgaGF2ZSB1bmNvbnN0cmFpbmVkIGRlbGVnYXRpb24uCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRDb21wdXRlcgogICAgICAgIAogICAgICAgIFJldHVybnMgdGhlIGN1cnJlbnQgY29tcHV0ZXJzIGluIGN1cnJlbnQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldENvbXB1dGVyIC1TUE4gbXNzcWwqCiAgICAgICAgCiAgICAgICAgUmV0dXJucyBhbGwgTVMgU1FMIHNlcnZlcnMgb24gdGhlIGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRDb21wdXRlciAtRG9tYWluIHRlc3RpbmcKICAgICAgICAKICAgICAgICBSZXR1cm5zIHRoZSBjdXJyZW50IGNvbXB1dGVycyBpbiAndGVzdGluZycgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldENvbXB1dGVyIC1Eb21haW4gdGVzdGluZyAtRnVsbERhdGEKICAgICAgICAKICAgICAgICBSZXR1cm5zIGZ1bGwgY29tcHV0ZXIgb2JqZWN0cyBpbiB0aGUgJ3Rlc3RpbmcnIGRvbWFpbi4KCiAgICAuTElOSwoKICAgICAgICBodHRwczovL2dpdGh1Yi5jb20vZGFya29wZXJhdG9yL1Bvc2gtU2VjTW9kL2Jsb2IvbWFzdGVyL0F1ZGl0L0F1ZGl0LnBzbTEKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnKicsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNQTiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkT3BlcmF0aW5nU3lzdGVtLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRTZXJ2aWNlUGFjaywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRmlsdGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRQcmludGVycywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkUGluZywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRnVsbERhdGEsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2l0ZU5hbWUsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVuY29uc3RyYWluZWQsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgIyBzbyB0aGlzIGlzbid0IHJlcGVhdGVkIGlmIG11bHRpcGxlIGNvbXB1dGVyIG5hbWVzIGFyZSBwYXNzZWQgb24gdGhlIHBpcGVsaW5lCiAgICAgICAgJENvbXBTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUFEU3BhdGggJEFEU3BhdGggLVBhZ2VTaXplICRQYWdlU2l6ZSAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbAogICAgfQoKICAgIHByb2Nlc3MgewoKICAgICAgICBpZiAoJENvbXBTZWFyY2hlcikgewoKICAgICAgICAgICAgIyBpZiB3ZSdyZSBjaGVja2luZyBmb3IgdW5jb25zdHJhaW5lZCBkZWxlZ2F0aW9uCiAgICAgICAgICAgIGlmKCRVbmNvbnN0cmFpbmVkKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJTZWFyY2hpbmcgZm9yIGNvbXB1dGVycyB3aXRoIGZvciB1bmNvbnN0cmFpbmVkIGRlbGVnYXRpb24iCiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICIodXNlckFjY291bnRDb250cm9sOjEuMi44NDAuMTEzNTU2LjEuNC44MDM6PTUyNDI4OCkiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgIyBzZXQgdGhlIGZpbHRlcnMgZm9yIHRoZSBzZXJhY2hlciBpZiBpdCBleGlzdHMKICAgICAgICAgICAgaWYoJFByaW50ZXJzKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJTZWFyY2hpbmcgZm9yIHByaW50ZXJzIgogICAgICAgICAgICAgICAgIyAkQ29tcFNlYXJjaGVyLmZpbHRlcj0iKCYob2JqZWN0Q2F0ZWdvcnk9cHJpbnRRdWV1ZSkkRmlsdGVyKSIKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIihvYmplY3RDYXRlZ29yeT1wcmludFF1ZXVlKSIKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkU1BOKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJTZWFyY2hpbmcgZm9yIGNvbXB1dGVycyB3aXRoIFNQTjogJFNQTiIKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIihzZXJ2aWNlUHJpbmNpcGFsTmFtZT0kU1BOKSIKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkT3BlcmF0aW5nU3lzdGVtKSB7CiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICIob3BlcmF0aW5nc3lzdGVtPSRPcGVyYXRpbmdTeXN0ZW0pIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRTZXJ2aWNlUGFjaykgewogICAgICAgICAgICAgICAgJEZpbHRlciArPSAiKG9wZXJhdGluZ3N5c3RlbXNlcnZpY2VwYWNrPSRTZXJ2aWNlUGFjaykiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJFNpdGVOYW1lKSB7CiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICIoc2VydmVycmVmZXJlbmNlYmw9JFNpdGVOYW1lKSIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJENvbXBGaWx0ZXIgPSAiKCYoc0FNQWNjb3VudFR5cGU9ODA1MzA2MzY5KShkbnNob3N0bmFtZT0kQ29tcHV0ZXJOYW1lKSRGaWx0ZXIpIgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJHZXQtTmV0Q29tcHV0ZXIgZmlsdGVyIDogJyRDb21wRmlsdGVyJyIKICAgICAgICAgICAgJENvbXBTZWFyY2hlci5maWx0ZXIgPSAkQ29tcEZpbHRlcgoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJENvbXBTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgJFVwID0gJFRydWUKICAgICAgICAgICAgICAgICAgICBpZigkUGluZykgewogICAgICAgICAgICAgICAgICAgICAgICAjIFRPRE86IGhvdyBjYW4gdGhlc2UgcmVzdWx0cyBiZSBwaXBlZCB0byBwaW5nIGZvciBhIHNwZWVkdXA/CiAgICAgICAgICAgICAgICAgICAgICAgICRVcCA9IFRlc3QtQ29ubmVjdGlvbiAtQ291bnQgMSAtUXVpZXQgLUNvbXB1dGVyTmFtZSAkXy5wcm9wZXJ0aWVzLmRuc2hvc3RuYW1lCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKCRVcCkgewogICAgICAgICAgICAgICAgICAgICAgICAjIHJldHVybiBmdWxsIGRhdGEgb2JqZWN0cwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJEZ1bGxEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQvcHJvY2VzcyB0aGUgTERBUCBmaWVsZHMgZm9yIGVhY2ggcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQ29tcHV0ZXIgPSBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQ29tcHV0ZXIuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LkNvbXB1dGVyJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDb21wdXRlcgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBvdGhlcndpc2Ugd2UncmUganVzdCByZXR1cm5pbmcgdGhlIEROUyBob3N0IG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfLnByb3BlcnRpZXMuZG5zaG9zdG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICAgICAgICAgJENvbXBTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvcjogJF8iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtQURPYmplY3Qgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFRha2VzIGEgZG9tYWluIFNJRCBhbmQgcmV0dXJucyB0aGUgdXNlciwgZ3JvdXAsIG9yIGNvbXB1dGVyIG9iamVjdAogICAgICAgIGFzc29jaWF0ZWQgd2l0aCBpdC4KCiAgICAuUEFSQU1FVEVSIFNJRAoKICAgICAgICBUaGUgU0lEIG9mIHRoZSBkb21haW4gb2JqZWN0IHlvdSdyZSBxdWVyeWluZyBmb3IuCgogICAgLlBBUkFNRVRFUiBOYW1lCgogICAgICAgIFRoZSBOYW1lIG9mIHRoZSBkb21haW4gb2JqZWN0IHlvdSdyZSBxdWVyeWluZyBmb3IuCgogICAgLlBBUkFNRVRFUiBTYW1BY2NvdW50TmFtZQoKICAgICAgICBUaGUgU2FtQWNjb3VudE5hbWUgb2YgdGhlIGRvbWFpbiBvYmplY3QgeW91J3JlIHF1ZXJ5aW5nIGZvci4gCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3Igb2JqZWN0cywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBGaWx0ZXIKCiAgICAgICAgQWRkaXRpb25hbCBMREFQIGZpbHRlciBzdHJpbmcgZm9yIHRoZSBxdWVyeS4KCiAgICAuUEFSQU1FVEVSIFJldHVyblJhdwoKICAgICAgICBTd2l0Y2guIFJldHVybiB0aGUgcmF3IG9iamVjdCBpbnN0ZWFkIG9mIHRyYW5zbGF0aW5nIGl0cyBwcm9wZXJ0aWVzLgogICAgICAgIFVzZWQgYnkgU2V0LUFET2JqZWN0IHRvIG1vZGlmeSBvYmplY3QgcHJvcGVydGllcy4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUFET2JqZWN0IC1TSUQgIlMtMS01LTIxLTI2MjA4OTE4MjktMjQxMTI2MTQ5Ny0xNzczODUzMDg4LTExMTAiCiAgICAgICAgCiAgICAgICAgR2V0IHRoZSBkb21haW4gb2JqZWN0IGFzc29jaWF0ZWQgd2l0aCB0aGUgc3BlY2lmaWVkIFNJRC4KICAgICAgICAKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUFET2JqZWN0IC1BRFNwYXRoICJDTj1BZG1pblNESG9sZGVyLENOPVN5c3RlbSxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIAogICAgICAgIEdldCB0aGUgQWRtaW5TREhvbGRlciBvYmplY3QgZm9yIHRoZSB0ZXN0bGFiLmxvY2FsIGRvbWFpbi4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNJRCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2FtQWNjb3VudE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRmlsdGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRSZXR1cm5SYXcsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKICAgIHByb2Nlc3MgewogICAgICAgIGlmKCRTSUQpIHsKICAgICAgICAgICAgIyBpZiBhIFNJRCBpcyBwYXNzZWQsIHRyeSB0byByZXNvbHZlIGl0IHRvIGEgcmVhY2hhYmxlIGRvbWFpbiBuYW1lIGZvciB0aGUgc2VhcmNoZXIKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICROYW1lID0gQ29udmVydC1TaWRUb05hbWUgJFNJRAogICAgICAgICAgICAgICAgaWYoJE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAkQ2Fub25pY2FsID0gQ29udmVydC1BRE5hbWUgLU9iamVjdE5hbWUgJE5hbWUgLUlucHV0VHlwZSBOVDQgLU91dHB1dFR5cGUgQ2Fub25pY2FsCiAgICAgICAgICAgICAgICAgICAgaWYoJENhbm9uaWNhbCkgewogICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluID0gJENhbm9uaWNhbC5zcGxpdCgiLyIpWzBdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciByZXNvbHZpbmcgU0lEICckU0lEJyIKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICROdWxsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkVycm9yIHJlc29sdmluZyBTSUQgJyRTSUQnIDogJF8iCiAgICAgICAgICAgICAgICByZXR1cm4gJE51bGwKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJE9iamVjdFNlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcGF0aCAkQURTcGF0aCAtUGFnZVNpemUgJFBhZ2VTaXplCgogICAgICAgIGlmKCRPYmplY3RTZWFyY2hlcikgewogICAgICAgICAgICBpZigkU0lEKSB7CiAgICAgICAgICAgICAgICAkT2JqZWN0U2VhcmNoZXIuZmlsdGVyID0gIigmKG9iamVjdHNpZD0kU0lEKSRGaWx0ZXIpIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZigkTmFtZSkgewogICAgICAgICAgICAgICAgJE9iamVjdFNlYXJjaGVyLmZpbHRlciA9ICIoJihuYW1lPSROYW1lKSRGaWx0ZXIpIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZigkU2FtQWNjb3VudE5hbWUpIHsKICAgICAgICAgICAgICAgICRPYmplY3RTZWFyY2hlci5maWx0ZXIgPSAiKCYoc2FtQWNjb3VudE5hbWU9JFNhbUFjY291bnROYW1lKSRGaWx0ZXIpIgogICAgICAgICAgICB9CgogICAgICAgICAgICAkUmVzdWx0cyA9ICRPYmplY3RTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgIGlmKCRSZXR1cm5SYXcpIHsKICAgICAgICAgICAgICAgICAgICAkXwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0L3Byb2Nlc3MgdGhlIExEQVAgZmllbGRzIGZvciBlYWNoIHJlc3VsdAogICAgICAgICAgICAgICAgICAgIENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgJE9iamVjdFNlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIFNldC1BRE9iamVjdCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGFrZXMgYSBTSUQsIG5hbWUsIG9yIFNhbUFjY291bnROYW1lIHRvIHF1ZXJ5IGZvciBhIHNwZWNpZmllZAogICAgICAgIGRvbWFpbiBvYmplY3QsIGFuZCB0aGVuIHNldHMgYSBzcGVjaWZpZWQgJ1Byb3BlcnR5TmFtZScgdG8gYQogICAgICAgIHNwZWNpZmllZCAnUHJvcGVydHlWYWx1ZScuCgogICAgLlBBUkFNRVRFUiBTSUQKCiAgICAgICAgVGhlIFNJRCBvZiB0aGUgZG9tYWluIG9iamVjdCB5b3UncmUgcXVlcnlpbmcgZm9yLgoKICAgIC5QQVJBTUVURVIgTmFtZQoKICAgICAgICBUaGUgTmFtZSBvZiB0aGUgZG9tYWluIG9iamVjdCB5b3UncmUgcXVlcnlpbmcgZm9yLgoKICAgIC5QQVJBTUVURVIgU2FtQWNjb3VudE5hbWUKCiAgICAgICAgVGhlIFNhbUFjY291bnROYW1lIG9mIHRoZSBkb21haW4gb2JqZWN0IHlvdSdyZSBxdWVyeWluZyBmb3IuIAoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIG9iamVjdHMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEZpbHRlcgoKICAgICAgICBBZGRpdGlvbmFsIExEQVAgZmlsdGVyIHN0cmluZyBmb3IgdGhlIHF1ZXJ5LgoKICAgIC5QQVJBTUVURVIgUHJvcGVydHlOYW1lCgogICAgICAgIFRoZSBwcm9wZXJ0eSBuYW1lIHRvIHNldC4KCiAgICAuUEFSQU1FVEVSIFByb3BlcnR5VmFsdWUKCiAgICAgICAgVGhlIHZhbHVlIHRvIHNldCBmb3IgUHJvcGVydHlOYW1lCgogICAgLlBBUkFNRVRFUiBQcm9wZXJ0eVhvclZhbHVlCgogICAgICAgIEludGVnZXIgdmFsdWUgdG8gYmluYXJ5IHhvciAoLWJ4b3IpIHdpdGggdGhlIGN1cnJlbnQgaW50IHZhbHVlLgoKICAgIC5QQVJBTUVURVIgQ2xlYXJWYWx1ZQoKICAgICAgICBTd2l0Y2guIENsZWFyIHRoZSB2YWx1ZSBvZiBQcm9wZXJ0eU5hbWUKCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gU2V0LUFET2JqZWN0IC1TYW1BY2NvdW50TmFtZSBtYXR0LmFkbWluIC1Qcm9wZXJ0eU5hbWUgY291bnRyeWNvZGUgLVByb3BlcnR5VmFsdWUgMAogICAgICAgIAogICAgICAgIFNldCB0aGUgY291bnRyeWNvZGUgZm9yIG1hdHQuYWRtaW4gdG8gMAoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gU2V0LUFET2JqZWN0IC1TYW1BY2NvdW50TmFtZSBtYXR0LmFkbWluIC1Qcm9wZXJ0eU5hbWUgdXNlcmFjY291bnRjb250cm9sIC1Qcm9wZXJ0eVhvclZhbHVlIDY1NTM2CiAgICAgICAgCiAgICAgICAgU2V0IHRoZSBwYXNzd29yZCBub3QgdG8gZXhwaXJlIG9uIG1hdHQuYWRtaW4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNJRCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2FtQWNjb3VudE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRmlsdGVyLAoKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRQcm9wZXJ0eU5hbWUsCgogICAgICAgICRQcm9wZXJ0eVZhbHVlLAoKICAgICAgICBbSW50XQogICAgICAgICRQcm9wZXJ0eVhvclZhbHVlLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRDbGVhclZhbHVlLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgJEFyZ3VtZW50cyA9IEB7CiAgICAgICAgJ1NJRCcgPSAkU0lECiAgICAgICAgJ05hbWUnID0gJE5hbWUKICAgICAgICAnU2FtQWNjb3VudE5hbWUnID0gJFNhbUFjY291bnROYW1lCiAgICAgICAgJ0RvbWFpbicgPSAkRG9tYWluCiAgICAgICAgJ0RvbWFpbkNvbnRyb2xsZXInID0gJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAnRmlsdGVyJyA9ICRGaWx0ZXIKICAgICAgICAnUGFnZVNpemUnID0gJFBhZ2VTaXplCiAgICAgICAgJ0NyZWRlbnRpYWwnID0gJENyZWRlbnRpYWwKICAgIH0KICAgICMgc3BsYXQgdGhlIGFwcHJvcHJpYXRlIGFyZ3VtZW50cyB0byBHZXQtQURPYmplY3QKICAgICRSYXdPYmplY3QgPSBHZXQtQURPYmplY3QgLVJldHVyblJhdyBAQXJndW1lbnRzCiAgICAKICAgIHRyeSB7CiAgICAgICAgIyBnZXQgdGhlIG1vZGlmaWFibGUgb2JqZWN0IGZvciB0aGlzIHNlYXJjaCByZXN1bHQKICAgICAgICAkRW50cnkgPSAkUmF3T2JqZWN0LkdldERpcmVjdG9yeUVudHJ5KCkKICAgICAgICAKICAgICAgICBpZigkQ2xlYXJWYWx1ZSkgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDbGVhcmluZyB2YWx1ZSIKICAgICAgICAgICAgJEVudHJ5LiRQcm9wZXJ0eU5hbWUuY2xlYXIoKQogICAgICAgICAgICAkRW50cnkuY29tbWl0Y2hhbmdlcygpCiAgICAgICAgfQoKICAgICAgICBlbHNlaWYoJFByb3BlcnR5WG9yVmFsdWUpIHsKICAgICAgICAgICAgJFR5cGVOYW1lID0gJEVudHJ5LiRQcm9wZXJ0eU5hbWVbMF0uR2V0VHlwZSgpLm5hbWUKCiAgICAgICAgICAgICMgVUFDIHZhbHVlIHJlZmVyZW5jZXMtIGh0dHBzOi8vc3VwcG9ydC5taWNyb3NvZnQuY29tL2VuLXVzL2tiLzMwNTE0NAogICAgICAgICAgICAkUHJvcGVydHlWYWx1ZSA9ICQoJEVudHJ5LiRQcm9wZXJ0eU5hbWUpIC1ieG9yICRQcm9wZXJ0eVhvclZhbHVlIAogICAgICAgICAgICAkRW50cnkuJFByb3BlcnR5TmFtZSA9ICRQcm9wZXJ0eVZhbHVlIC1hcyAkVHlwZU5hbWUgICAgICAgCiAgICAgICAgICAgICRFbnRyeS5jb21taXRjaGFuZ2VzKCkgICAgIAogICAgICAgIH0KCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRFbnRyeS5wdXQoJFByb3BlcnR5TmFtZSwgJFByb3BlcnR5VmFsdWUpCiAgICAgICAgICAgICRFbnRyeS5zZXRpbmZvKCkKICAgICAgICB9CiAgICB9CiAgICBjYXRjaCB7CiAgICAgICAgV3JpdGUtV2FybmluZyAiRXJyb3Igc2V0dGluZyBwcm9wZXJ0eSAkUHJvcGVydHlOYW1lIHRvIHZhbHVlICckUHJvcGVydHlWYWx1ZScgZm9yIG9iamVjdCAkKCRSYXdPYmplY3QuUHJvcGVydGllcy5zYW1hY2NvdW50bmFtZSkgOiAkXyIKICAgIH0KfQoKCmZ1bmN0aW9uIEludm9rZS1Eb3duZ3JhZGVBY2NvdW50IHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBTZXQgcmV2ZXJzaWJsZSBlbmNyeXB0aW9uIG9uIGEgZ2l2ZW4gYWNjb3VudCBhbmQgdGhlbiBmb3JjZSB0aGUgcGFzc3dvcmQKICAgICAgICB0byBiZSBzZXQgb24gbmV4dCB1c2VyIGxvZ2luLiBUbyByZXBhaXIgdXNlICItUmVwYWlyIi4KCiAgICAuUEFSQU1FVEVSIFNhbUFjY291bnROYW1lCgogICAgICAgIFRoZSBTYW1BY2NvdW50TmFtZSBvZiB0aGUgZG9tYWluIG9iamVjdCB5b3UncmUgcXVlcnlpbmcgZm9yLiAKCiAgICAuUEFSQU1FVEVSIE5hbWUKCiAgICAgICAgVGhlIE5hbWUgb2YgdGhlIGRvbWFpbiBvYmplY3QgeW91J3JlIHF1ZXJ5aW5nIGZvci4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciBvYmplY3RzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBGaWx0ZXIKCiAgICAgICAgQWRkaXRpb25hbCBMREFQIGZpbHRlciBzdHJpbmcgZm9yIHRoZSBxdWVyeS4KCiAgICAuUEFSQU1FVEVSIFJlcGFpcgoKICAgICAgICBTd2l0Y2guIFVuc2V0IHRoZSByZXZlcnNpYmxlIGVuY3J5cHRpb24gZmxhZyBhbmQgZm9yY2UgcGFzc3dvcmQgcmVzZXQgZmxhZy4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTPiBJbnZva2UtRG93bmdyYWRlQWNjb3VudCAtU2FtQWNjb3VudE5hbWUgamFzb24KCiAgICAgICAgU2V0IHJldmVyc2libGUgZW5jcnlwdGlvbiBvbiB0aGUgJ2phc29uJyBhY2NvdW50IGFuZCBmb3JjZSB0aGUgcGFzc3dvcmQgdG8gYmUgY2hhbmdlZC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUz4gSW52b2tlLURvd25ncmFkZUFjY291bnQgLVNhbUFjY291bnROYW1lIGphc29uIC1SZXBhaXIKCiAgICAgICAgVW5zZXQgcmV2ZXJzaWJsZSBlbmNyeXB0aW9uIG9uIHRoZSAnamFzb24nIGFjY291bnQgYW5kIHJlbW92ZSB0aGUgZm9yY2VkIHBhc3N3b3JkIGNoYW5nZS4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdTYW1BY2NvdW50TmFtZScsIFBvc2l0aW9uPTAsIFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRTYW1BY2NvdW50TmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ05hbWUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICROYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZpbHRlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkUmVwYWlyLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIHByb2Nlc3MgewogICAgICAgICRBcmd1bWVudHMgPSBAewogICAgICAgICAgICAnU2FtQWNjb3VudE5hbWUnID0gJFNhbUFjY291bnROYW1lCiAgICAgICAgICAgICdOYW1lJyA9ICROYW1lCiAgICAgICAgICAgICdEb21haW4nID0gJERvbWFpbgogICAgICAgICAgICAnRG9tYWluQ29udHJvbGxlcicgPSAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAnRmlsdGVyJyA9ICRGaWx0ZXIKICAgICAgICAgICAgJ0NyZWRlbnRpYWwnID0gJENyZWRlbnRpYWwKICAgICAgICB9CgogICAgICAgICMgc3BsYXQgdGhlIGFwcHJvcHJpYXRlIGFyZ3VtZW50cyB0byBHZXQtQURPYmplY3QKICAgICAgICAkVUFDVmFsdWVzID0gR2V0LUFET2JqZWN0IEBBcmd1bWVudHMgfCBzZWxlY3QgdXNlcmFjY291bnRjb250cm9sIHwgQ29udmVydEZyb20tVUFDVmFsdWUKCiAgICAgICAgaWYoJFJlcGFpcikgewoKICAgICAgICAgICAgaWYoJFVBQ1ZhbHVlcy5LZXlzIC1jb250YWlucyAiRU5DUllQVEVEX1RFWFRfUFdEX0FMTE9XRUQiKSB7CiAgICAgICAgICAgICAgICAjIGlmIHJldmVyc2libGUgZW5jcnlwdGlvbiBpcyBzZXQsIHVuc2V0IGl0CiAgICAgICAgICAgICAgICBTZXQtQURPYmplY3QgQEFyZ3VtZW50cyAtUHJvcGVydHlOYW1lIHVzZXJhY2NvdW50Y29udHJvbCAtUHJvcGVydHlYb3JWYWx1ZSAxMjgKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyB1bnNldCB0aGUgZm9yY2VkIHBhc3N3b3JkIGNoYW5nZQogICAgICAgICAgICBTZXQtQURPYmplY3QgQEFyZ3VtZW50cyAtUHJvcGVydHlOYW1lIHB3ZGxhc3RzZXQgLVByb3BlcnR5VmFsdWUgLTEKICAgICAgICB9CgogICAgICAgIGVsc2UgewoKICAgICAgICAgICAgaWYoJFVBQ1ZhbHVlcy5LZXlzIC1jb250YWlucyAiRE9OVF9FWFBJUkVfUEFTU1dPUkQiKSB7CiAgICAgICAgICAgICAgICAjIGlmIHRoZSBwYXNzd29yZCBpcyBzZXQgdG8gbmV2ZXIgZXhwaXJlLCB1bnNldAogICAgICAgICAgICAgICAgU2V0LUFET2JqZWN0IEBBcmd1bWVudHMgLVByb3BlcnR5TmFtZSB1c2VyYWNjb3VudGNvbnRyb2wgLVByb3BlcnR5WG9yVmFsdWUgNjU1MzYKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoJFVBQ1ZhbHVlcy5LZXlzIC1ub3Rjb250YWlucyAiRU5DUllQVEVEX1RFWFRfUFdEX0FMTE9XRUQiKSB7CiAgICAgICAgICAgICAgICAjIGlmIHJldmVyc2libGUgZW5jcnlwdGlvbiBpcyBub3Qgc2V0LCBzZXQgaXQKICAgICAgICAgICAgICAgIFNldC1BRE9iamVjdCBAQXJndW1lbnRzIC1Qcm9wZXJ0eU5hbWUgdXNlcmFjY291bnRjb250cm9sIC1Qcm9wZXJ0eVhvclZhbHVlIDEyOAogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGZvcmNlIHRoZSBwYXNzd29yZCB0byBiZSBjaGFuZ2VkIG9uIG5leHQgbG9naW4KICAgICAgICAgICAgU2V0LUFET2JqZWN0IEBBcmd1bWVudHMgLVByb3BlcnR5TmFtZSBwd2RsYXN0c2V0IC1Qcm9wZXJ0eVZhbHVlIDAKICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtQ29tcHV0ZXJQcm9wZXJ0eSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUmV0dXJucyBhIGxpc3Qgb2YgYWxsIGNvbXB1dGVyIG9iamVjdCBwcm9wZXJ0aWVzLiBJZiBhIHByb3BlcnR5CiAgICAgICAgbmFtZSBpcyBzcGVjaWZpZWQsIGl0IHJldHVybnMgYWxsIFtjb21wdXRlcjpwcm9wZXJ0eV0gdmFsdWVzLgoKICAgICAgICBUYWtlbiBkaXJlY3RseSBmcm9tIEBvYnNjdXJlc2VjJ3MgcG9zdDoKICAgICAgICAgICAgaHR0cDovL29ic2N1cmVzZWN1cml0eS5ibG9nc3BvdC5jb20vMjAxNC8wNC9BRFNJU2VhcmNoZXIuaHRtbAoKICAgIC5QQVJBTUVURVIgUHJvcGVydGllcwoKICAgICAgICBSZXR1cm4gcHJvcGVydHkgbmFtZXMgZm9yIGNvbXB1dGVycy4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciBjb21wdXRlciBwcm9wZXJ0aWVzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Db21wdXRlclByb3BlcnR5IC1Eb21haW4gdGVzdGluZwogICAgICAgIAogICAgICAgIFJldHVybnMgYWxsIHVzZXIgcHJvcGVydGllcyBmb3IgY29tcHV0ZXJzIGluIHRoZSAndGVzdGluZycgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUNvbXB1dGVyUHJvcGVydHkgLVByb3BlcnRpZXMgc3NuLGxhc3Rsb2dvbixsb2NhdGlvbgogICAgICAgIAogICAgICAgIFJldHVybnMgYWxsIGFuIGFycmF5IG9mIGNvbXB1dGVyL3Nzbi9sYXN0bG9naW4vbG9jYXRpb24gY29tYmluYXRpb25zCiAgICAgICAgZm9yIGNvbXB1dGVycyBpbiB0aGUgY3VycmVudCBkb21haW4uCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL29ic2N1cmVzZWN1cml0eS5ibG9nc3BvdC5jb20vMjAxNC8wNC9BRFNJU2VhcmNoZXIuaHRtbAojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJFByb3BlcnRpZXMsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIGlmKCRQcm9wZXJ0aWVzKSB7CiAgICAgICAgIyBleHRyYWN0IG91dCB0aGUgc2V0IG9mIGFsbCBwcm9wZXJ0aWVzIGZvciBlYWNoIG9iamVjdAogICAgICAgICRQcm9wZXJ0aWVzID0gLCJuYW1lIiArICRQcm9wZXJ0aWVzIHwgU29ydC1PYmplY3QgLVVuaXF1ZQogICAgICAgIEdldC1OZXRDb21wdXRlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBTZWxlY3QtT2JqZWN0IC1Qcm9wZXJ0eSAkUHJvcGVydGllcwogICAgfQogICAgZWxzZSB7CiAgICAgICAgIyBleHRyYWN0IG91dCBqdXN0IHRoZSBwcm9wZXJ0eSBuYW1lcwogICAgICAgIEdldC1OZXRDb21wdXRlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBTZWxlY3QtT2JqZWN0IC1maXJzdCAxIHwgR2V0LU1lbWJlciAtTWVtYmVyVHlwZSAqUHJvcGVydHkgfCBTZWxlY3QtT2JqZWN0IC1Qcm9wZXJ0eSAiTmFtZSIKICAgIH0KfQoKCmZ1bmN0aW9uIEZpbmQtQ29tcHV0ZXJGaWVsZCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgU2VhcmNoZXMgY29tcHV0ZXIgb2JqZWN0IGZpZWxkcyBmb3IgYSBnaXZlbiB3b3JkIChkZWZhdWx0ICpwYXNzKikuIERlZmF1bHQKICAgICAgICBmaWVsZCBiZWluZyBzZWFyY2hlZCBpcyAnZGVzY3JpcHRpb24nLgoKICAgICAgICBUYWtlbiBkaXJlY3RseSBmcm9tIEBvYnNjdXJlc2VjJ3MgcG9zdDoKICAgICAgICAgICAgaHR0cDovL29ic2N1cmVzZWN1cml0eS5ibG9nc3BvdC5jb20vMjAxNC8wNC9BRFNJU2VhcmNoZXIuaHRtbAoKICAgIC5QQVJBTUVURVIgU2VhcmNoVGVybQoKICAgICAgICBUZXJtIHRvIHNlYXJjaCBmb3IsIGRlZmF1bHQgb2YgInBhc3MiLgoKICAgIC5QQVJBTUVURVIgU2VhcmNoRmllbGQKCiAgICAgICAgVXNlciBmaWVsZCB0byBzZWFyY2ggaW4sIGRlZmF1bHQgb2YgImRlc2NyaXB0aW9uIi4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIERvbWFpbiB0byBzZWFyY2ggY29tcHV0ZXIgZmllbGRzIGZvciwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUNvbXB1dGVyRmllbGQgLVNlYXJjaFRlcm0gYmFja3VwIC1TZWFyY2hGaWVsZCBpbmZvCgogICAgICAgIEZpbmQgY29tcHV0ZXIgYWNjb3VudHMgd2l0aCAiYmFja3VwIiBpbiB0aGUgImluZm8iIGZpZWxkLgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnVGVybScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNlYXJjaFRlcm0gPSAncGFzcycsCgogICAgICAgIFtBbGlhcygnRmllbGQnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRTZWFyY2hGaWVsZCA9ICdkZXNjcmlwdGlvbicsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIHByb2Nlc3MgewogICAgICAgIEdldC1OZXRDb21wdXRlciAtQURTcGF0aCAkQURTcGF0aCAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUZ1bGxEYXRhIC1GaWx0ZXIgIigkU2VhcmNoRmllbGQ9KiRTZWFyY2hUZXJtKikiIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBTZWxlY3QtT2JqZWN0IHNhbWFjY291bnRuYW1lLCRTZWFyY2hGaWVsZAogICAgfQp9CgoKZnVuY3Rpb24gR2V0LU5ldE9VIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBHZXRzIGEgbGlzdCBvZiBhbGwgY3VycmVudCBPVXMgaW4gYSBkb21haW4uCgogICAgLlBBUkFNRVRFUiBPVU5hbWUKCiAgICAgICAgVGhlIE9VIG5hbWUgdG8gcXVlcnkgZm9yLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBHVUlECgogICAgICAgIE9ubHkgcmV0dXJuIE9VcyB3aXRoIHRoZSBzcGVjaWZpZWQgR1VJRCBpbiB0aGVpciBncGxpbmsgcHJvcGVydHkuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgT1VzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEZ1bGxEYXRhCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIGZ1bGwgT1Ugb2JqZWN0cyBpbnN0ZWFkIG9mIGp1c3Qgb2JqZWN0IG5hbWVzICh0aGUgZGVmYXVsdCkuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRPVQogICAgICAgIAogICAgICAgIFJldHVybnMgdGhlIGN1cnJlbnQgT1VzIGluIHRoZSBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0T1UgLU9VTmFtZSAqYWRtaW4qIC1Eb21haW4gdGVzdGxhYi5sb2NhbAogICAgICAgIAogICAgICAgIFJldHVybnMgYWxsIE9VcyB3aXRoICJhZG1pbiIgaW4gdGhlaXIgbmFtZSBpbiB0aGUgdGVzdGxhYi5sb2NhbCBkb21haW4uCgogICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldE9VIC1HVUlEIDEyMy0uLi4KICAgICAgICAKICAgICAgICBSZXR1cm5zIGFsbCBPVXMgd2l0aCBsaW5rZWQgdG8gdGhlIHNwZWNpZmllZCBncm91cCBwb2xpY3kgb2JqZWN0LgoKICAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+ICIqYWRtaW4qIiwiKnNlcnZlcioiIHwgR2V0LU5ldE9VCgogICAgICAgIEdldCB0aGUgZnVsbCBPVSBuYW1lcyBmb3IgdGhlIGdpdmVuIHNlYXJjaCB0ZXJtcyBwaXBlZCBvbiB0aGUgcGlwZWxpbmUuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRPVU5hbWUgPSAnKicsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdVSUQsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRnVsbERhdGEsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgJE9VU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwYXRoICRBRFNwYXRoIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgIH0KICAgIHByb2Nlc3MgewogICAgICAgIGlmICgkT1VTZWFyY2hlcikgewogICAgICAgICAgICBpZiAoJEdVSUQpIHsKICAgICAgICAgICAgICAgICMgaWYgd2UncmUgZmlsdGVyaW5nIGZvciBhIEdVSUQgaW4gLmdwbGluawogICAgICAgICAgICAgICAgJE9VU2VhcmNoZXIuZmlsdGVyPSIoJihvYmplY3RDYXRlZ29yeT1vcmdhbml6YXRpb25hbFVuaXQpKG5hbWU9JE9VTmFtZSkoZ3BsaW5rPSokR1VJRCopKSIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRPVVNlYXJjaGVyLmZpbHRlcj0iKCYob2JqZWN0Q2F0ZWdvcnk9b3JnYW5pemF0aW9uYWxVbml0KShuYW1lPSRPVU5hbWUpKSIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJE9VU2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgIGlmICgkRnVsbERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0L3Byb2Nlc3MgdGhlIExEQVAgZmllbGRzIGZvciBlYWNoIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICAkT1UgPSBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgICAgICRPVS5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuT1UnKQogICAgICAgICAgICAgICAgICAgICAgICAkT1UKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7IAogICAgICAgICAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSBqdXN0IHJldHVybmluZyB0aGUgQURTIHBhdGhzIG9mIHRoZSBPVXMKICAgICAgICAgICAgICAgICAgICAgICAgJF8ucHJvcGVydGllcy5hZHNwYXRoCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICAgICAkT1VTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICRfCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtTmV0U2l0ZSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgR2V0cyBhIGxpc3Qgb2YgYWxsIGN1cnJlbnQgc2l0ZXMgaW4gYSBkb21haW4uCgogICAgLlBBUkFNRVRFUiBTaXRlTmFtZQoKICAgICAgICBTaXRlIGZpbHRlciBzdHJpbmcsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciBzaXRlcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBHVUlECgogICAgICAgIE9ubHkgcmV0dXJuIHNpdGUgd2l0aCB0aGUgc3BlY2lmaWVkIEdVSUQgaW4gdGhlaXIgZ3BsaW5rIHByb3BlcnR5LgoKICAgIC5QQVJBTUVURVIgRnVsbERhdGEKCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gZnVsbCBzaXRlIG9iamVjdHMgaW5zdGVhZCBvZiBqdXN0IG9iamVjdCBuYW1lcyAodGhlIGRlZmF1bHQpLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0U2l0ZSAtRG9tYWluIHRlc3RsYWIubG9jYWwgLUZ1bGxEYXRhCiAgICAgICAgCiAgICAgICAgUmV0dXJucyB0aGUgZnVsbCBkYXRhIG9iamVjdHMgZm9yIGFsbCBzaXRlcyBpbiB0ZXN0bGFiLmxvY2FsCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRTaXRlTmFtZSA9ICIqIiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRHVUlELAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRGdWxsRGF0YSwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIGJlZ2luIHsKICAgICAgICAkU2l0ZVNlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1BRFNwYXRoICRBRFNwYXRoIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcHJlZml4ICJDTj1TaXRlcyxDTj1Db25maWd1cmF0aW9uIiAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICB9CiAgICBwcm9jZXNzIHsKICAgICAgICBpZigkU2l0ZVNlYXJjaGVyKSB7CgogICAgICAgICAgICBpZiAoJEdVSUQpIHsKICAgICAgICAgICAgICAgICMgaWYgd2UncmUgZmlsdGVyaW5nIGZvciBhIEdVSUQgaW4gLmdwbGluawogICAgICAgICAgICAgICAgJFNpdGVTZWFyY2hlci5maWx0ZXI9IigmKG9iamVjdENhdGVnb3J5PXNpdGUpKG5hbWU9JFNpdGVOYW1lKShncGxpbms9KiRHVUlEKikpIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFNpdGVTZWFyY2hlci5maWx0ZXI9IigmKG9iamVjdENhdGVnb3J5PXNpdGUpKG5hbWU9JFNpdGVOYW1lKSkiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkUmVzdWx0cyA9ICRTaXRlU2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgIGlmICgkRnVsbERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0L3Byb2Nlc3MgdGhlIExEQVAgZmllbGRzIGZvciBlYWNoIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICAkU2l0ZSA9IENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAgICAgJFNpdGUuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LlNpdGUnKQogICAgICAgICAgICAgICAgICAgICAgICAkU2l0ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBvdGhlcndpc2UganVzdCByZXR1cm4gdGhlIHNpdGUgbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkXy5wcm9wZXJ0aWVzLm5hbWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICRTaXRlU2VhcmNoZXIuZGlzcG9zZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAkXwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LU5ldFN1Ym5ldCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgR2V0cyBhIGxpc3Qgb2YgYWxsIGN1cnJlbnQgc3VibmV0cyBpbiBhIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIFNpdGVOYW1lCgogICAgICAgIE9ubHkgcmV0dXJuIHN1Ym5ldHMgZnJvbSB0aGUgc3BlY2lmaWVkIFNpdGVOYW1lLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHN1Ym5ldHMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgRnVsbERhdGEKCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gZnVsbCBzdWJuZXQgb2JqZWN0cyBpbnN0ZWFkIG9mIGp1c3Qgb2JqZWN0IG5hbWVzICh0aGUgZGVmYXVsdCkuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRTdWJuZXQKICAgICAgICAKICAgICAgICBSZXR1cm5zIGFsbCBzdWJuZXQgbmFtZXMgaW4gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldFN1Ym5ldCAtRG9tYWluIHRlc3RsYWIubG9jYWwgLUZ1bGxEYXRhCiAgICAgICAgCiAgICAgICAgUmV0dXJucyB0aGUgZnVsbCBkYXRhIG9iamVjdHMgZm9yIGFsbCBzdWJuZXRzIGluIHRlc3RsYWIubG9jYWwKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNpdGVOYW1lID0gIioiLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEZ1bGxEYXRhLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgYmVnaW4gewogICAgICAgICRTdWJuZXRTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJEFEU3BhdGggLUFEU3ByZWZpeCAiQ049U3VibmV0cyxDTj1TaXRlcyxDTj1Db25maWd1cmF0aW9uIiAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICB9CgogICAgcHJvY2VzcyB7CiAgICAgICAgaWYoJFN1Ym5ldFNlYXJjaGVyKSB7CgogICAgICAgICAgICAkU3VibmV0U2VhcmNoZXIuZmlsdGVyPSIoJihvYmplY3RDYXRlZ29yeT1zdWJuZXQpKSIKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkUmVzdWx0cyA9ICRTdWJuZXRTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRGdWxsRGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQvcHJvY2VzcyB0aGUgTERBUCBmaWVsZHMgZm9yIGVhY2ggcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgIENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMgfCBXaGVyZS1PYmplY3QgeyAkXy5zaXRlb2JqZWN0IC1tYXRjaCAiQ049JFNpdGVOYW1lIiB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSBqdXN0IHJldHVybiB0aGUgc3VibmV0IG5hbWUgYW5kIHNpdGUgbmFtZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICgkU2l0ZU5hbWUgLWFuZCAoJF8ucHJvcGVydGllcy5zaXRlb2JqZWN0IC1tYXRjaCAiQ049JFNpdGVOYW1lLCIpKSAtb3IgKCRTaXRlTmFtZSAtZXEgJyonKSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTdWJuZXRQcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU3VibmV0JyA9ICRfLnByb3BlcnRpZXMubmFtZVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkU3VibmV0UHJvcGVydGllc1snU2l0ZSddID0gKCRfLnByb3BlcnRpZXMuc2l0ZW9iamVjdFswXSkuc3BsaXQoIiwiKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTdWJuZXRQcm9wZXJ0aWVzWydTaXRlJ10gPSAnRXJyb3InCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5ICRTdWJuZXRQcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICRTdWJuZXRTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICRfCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtRG9tYWluU0lEIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBHZXRzIHRoZSBTSUQgZm9yIHRoZSBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5FWEFNUExFCgogICAgICAgIEM6XD4gR2V0LURvbWFpblNJRCAtRG9tYWluIFRFU1QKICAgICAgICAKICAgICAgICBSZXR1cm5zIFNJRCBmb3IgdGhlIGRvbWFpbiAnVEVTVCcKIz4KCiAgICBwYXJhbSgKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIKICAgICkKCiAgICAkRENTSUQgPSBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1GdWxsRGF0YSAtRmlsdGVyICcodXNlckFjY291bnRDb250cm9sOjEuMi44NDAuMTEzNTU2LjEuNC44MDM6PTgxOTIpJyB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEgLUV4cGFuZFByb3BlcnR5IG9iamVjdHNpZAogICAgaWYoJERDU0lEKSB7CiAgICAgICAgJFBhcnRzID0gJERDU0lELnNwbGl0KCItIikKICAgICAgICAkUGFydHNbMC4uKCRQYXJ0cy5sZW5ndGggLTIpXSAtam9pbiAiLSIKICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1OZXRHcm91cCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgR2V0cyBhIGxpc3Qgb2YgYWxsIGN1cnJlbnQgZ3JvdXBzIGluIGEgZG9tYWluLCBvciBhbGwKICAgICAgICB0aGUgZ3JvdXBzIGEgZ2l2ZW4gdXNlci9ncm91cCBvYmplY3QgYmVsb25ncyB0by4KCiAgICAuUEFSQU1FVEVSIEdyb3VwTmFtZQoKICAgICAgICBUaGUgZ3JvdXAgbmFtZSB0byBxdWVyeSBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIFNJRAoKICAgICAgICBUaGUgZ3JvdXAgU0lEIHRvIHF1ZXJ5IGZvci4KCiAgICAuUEFSQU1FVEVSIFVzZXJOYW1lCgogICAgICAgIFRoZSB1c2VyIG5hbWUgKG9yIGdyb3VwIG5hbWUpIHRvIHF1ZXJ5IGZvciBhbGwgZWZmZWN0aXZlCiAgICAgICAgZ3JvdXBzIG9mLgoKICAgIC5QQVJBTUVURVIgRmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlLCBlLmcuICIoZGVzY3JpcHRpb249KmFkbWluKikiCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgZ3JvdXBzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCwgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIEFkbWluQ291bnQKCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gZ3JvdXAgd2l0aCBhZG1pbkNvdW50PTEuCgogICAgLlBBUkFNRVRFUiBGdWxsRGF0YQoKICAgICAgICBTd2l0Y2guIFJldHVybiBmdWxsIGdyb3VwIG9iamVjdHMgaW5zdGVhZCBvZiBqdXN0IG9iamVjdCBuYW1lcyAodGhlIGRlZmF1bHQpLgoKICAgIC5QQVJBTUVURVIgUmF3U2lkcwoKICAgICAgICBTd2l0Y2guIFJldHVybiByYXcgU0lEcyB3aGVuIHVzaW5nICJHZXQtTmV0R3JvdXAgLVVzZXJOYW1lIFgiCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRHcm91cAogICAgICAgIAogICAgICAgIFJldHVybnMgdGhlIGN1cnJlbnQgZ3JvdXBzIGluIHRoZSBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0R3JvdXAgLUdyb3VwTmFtZSAqYWRtaW4qCiAgICAgICAgCiAgICAgICAgUmV0dXJucyBhbGwgZ3JvdXBzIHdpdGggImFkbWluIiBpbiB0aGVpciBncm91cCBuYW1lLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldEdyb3VwIC1Eb21haW4gdGVzdGluZyAtRnVsbERhdGEKICAgICAgICAKICAgICAgICBSZXR1cm5zIGZ1bGwgZ3JvdXAgZGF0YSBvYmplY3RzIGluIHRoZSAndGVzdGluZycgZG9tYWluCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdyb3VwTmFtZSA9ICcqJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU0lELAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCiAgICAgICAgCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKICAgICAgICAKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRBZG1pbkNvdW50LAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRGdWxsRGF0YSwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkUmF3U2lkcywKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIGJlZ2luIHsKICAgICAgICAkR3JvdXBTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJEFEU3BhdGggLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgfQoKICAgIHByb2Nlc3MgewogICAgICAgIGlmKCRHcm91cFNlYXJjaGVyKSB7CgogICAgICAgICAgICBpZigkQWRtaW5Db3VudCkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiQ2hlY2tpbmcgZm9yIGFkbWluQ291bnQ9MSIKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIihhZG1pbmNvdW50PTEpIgogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJFVzZXJOYW1lKSB7CiAgICAgICAgICAgICAgICAjIGdldCB0aGUgcmF3IHVzZXIgb2JqZWN0CiAgICAgICAgICAgICAgICAkVXNlciA9IEdldC1BRE9iamVjdCAtU2FtQWNjb3VudE5hbWUgJFVzZXJOYW1lIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtUmV0dXJuUmF3IC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgICAgICAgICAjIGNvbnZlcnQgdGhlIHVzZXIgdG8gYSBkaXJlY3RvcnkgZW50cnkKICAgICAgICAgICAgICAgICRVc2VyRGlyZWN0b3J5RW50cnkgPSAkVXNlci5HZXREaXJlY3RvcnlFbnRyeSgpCgogICAgICAgICAgICAgICAgIyBjYXVzZSB0aGUgY2FjaGUgdG8gY2FsY3VsYXRlIHRoZSB0b2tlbiBncm91cHMgZm9yIHRoZSB1c2VyCiAgICAgICAgICAgICAgICAkVXNlckRpcmVjdG9yeUVudHJ5LlJlZnJlc2hDYWNoZSgidG9rZW5Hcm91cHMiKQoKICAgICAgICAgICAgICAgICRVc2VyRGlyZWN0b3J5RW50cnkuVG9rZW5Hcm91cHMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0IHRoZSB0b2tlbiBncm91cCBzaWQKICAgICAgICAgICAgICAgICAgICAkR3JvdXBTaWQgPSAoTmV3LU9iamVjdCBTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcigkXywwKSkuVmFsdWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIGlnbm9yZSB0aGUgYnVpbHQgaW4gdXNlcnMgYW5kIGRlZmF1bHQgZG9tYWluIHVzZXIgZ3JvdXAKICAgICAgICAgICAgICAgICAgICBpZighKCRHcm91cFNpZCAtbWF0Y2ggJ15TLTEtNS0zMi01NDV8LTUxMyQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZigkRnVsbERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cCA9IEdldC1BRE9iamVjdCAtU0lEICRHcm91cFNpZCAtUGFnZVNpemUgJFBhZ2VTaXplIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwLlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5Hcm91cCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRSYXdTaWRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwU2lkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb252ZXJ0LVNpZFRvTmFtZSAkR3JvdXBTaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICgkU0lEKSB7CiAgICAgICAgICAgICAgICAgICAgJEdyb3VwU2VhcmNoZXIuZmlsdGVyID0gIigmKG9iamVjdENhdGVnb3J5PWdyb3VwKShvYmplY3RTSUQ9JFNJRCkkRmlsdGVyKSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRHcm91cFNlYXJjaGVyLmZpbHRlciA9ICIoJihvYmplY3RDYXRlZ29yeT1ncm91cCkobmFtZT0kR3JvdXBOYW1lKSRGaWx0ZXIpIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkUmVzdWx0cyA9ICRHcm91cFNlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIHJldHVybmluZyBmdWxsIGRhdGEgb2JqZWN0cwogICAgICAgICAgICAgICAgICAgIGlmICgkRnVsbERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0L3Byb2Nlc3MgdGhlIExEQVAgZmllbGRzIGZvciBlYWNoIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAgPSBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cC5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuR3JvdXAnKQogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgb3RoZXJ3aXNlIHdlJ3JlIGp1c3QgcmV0dXJuaW5nIHRoZSBncm91cCBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRfLnByb3BlcnRpZXMuc2FtYWNjb3VudG5hbWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICRHcm91cFNlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LU5ldEdyb3VwTWVtYmVyIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHVzZXJzIFtBRFNJXSBhbmQgTERBUCB0byBxdWVyeSB0aGUgY3VycmVudCBBRCBjb250ZXh0CiAgICAgICAgb3IgdHJ1c3RlZCBkb21haW4gZm9yIHVzZXJzIGluIGEgc3BlY2lmaWVkIGdyb3VwLiBJZiBubyBHcm91cE5hbWUgaXMKICAgICAgICBzcGVjaWZpZWQsIGl0IGRlZmF1bHRzIHRvIHF1ZXJ5aW5nIHRoZSAiRG9tYWluIEFkbWlucyIgZ3JvdXAuCiAgICAgICAgVGhpcyBpcyBhIHJlcGxhY2VtZW50IGZvciAibmV0IGdyb3VwICduYW1lJyAvZG9tYWluIgoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIFRoZSBncm91cCBuYW1lIHRvIHF1ZXJ5IGZvciB1c2Vycy4KCiAgICAuUEFSQU1FVEVSIFNJRAoKICAgICAgICBUaGUgR3JvdXAgU0lEIHRvIHF1ZXJ5IGZvciB1c2Vycy4gSWYgbm90IGdpdmVuLCBpdCBkZWZhdWx0cyB0byA1MTIgIkRvbWFpbiBBZG1pbnMiCgogICAgLlBBUkFNRVRFUiBGaWx0ZXIKCiAgICAgICAgQSBjdXN0b21pemVkIGxkYXAgZmlsdGVyIHN0cmluZyB0byB1c2UsIGUuZy4gIihkZXNjcmlwdGlvbj0qYWRtaW4qKSIKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciBncm91cCB1c2VycywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBGdWxsRGF0YQoKICAgICAgICBTd2l0Y2guIFJldHVybnMgZnVsbCBkYXRhIG9iamVjdHMgaW5zdGVhZCBvZiBqdXN0IGdyb3VwL3VzZXJzLgoKICAgIC5QQVJBTUVURVIgUmVjdXJzZQoKICAgICAgICBTd2l0Y2guIElmIHRoZSBncm91cCBtZW1iZXIgaXMgYSBncm91cCwgcmVjdXJzaXZlbHkgdHJ5IHRvIHF1ZXJ5IGl0cyBtZW1iZXJzIGFzIHdlbGwuCgogICAgLlBBUkFNRVRFUiBVc2VNYXRjaGluZ1J1bGUKCiAgICAgICAgU3dpdGNoLiBVc2UgTERBUF9NQVRDSElOR19SVUxFX0lOX0NIQUlOIGluIHRoZSBMREFQIHNlYXJjaCBxdWVyeSB3aGVuIC1SZWN1cnNlIGlzIHNwZWNpZmllZC4KICAgICAgICBNdWNoIGZhc3RlciB0aGFuIG1hbnVhbCByZWN1cnNpb24sIGJ1dCBkb2Vzbid0IHJldmVhbCBjcm9zcy1kb21haW4gZ3JvdXBzLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0R3JvdXBNZW1iZXIKICAgICAgICAKICAgICAgICBSZXR1cm5zIHRoZSB1c2VybmFtZXMgdGhhdCBvZiBtZW1iZXJzIG9mIHRoZSAiRG9tYWluIEFkbWlucyIgZG9tYWluIGdyb3VwLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldEdyb3VwTWVtYmVyIC1Eb21haW4gdGVzdGluZyAtR3JvdXBOYW1lICJQb3dlciBVc2VycyIKICAgICAgICAKICAgICAgICBSZXR1cm5zIHRoZSB1c2VybmFtZXMgdGhhdCBvZiBtZW1iZXJzIG9mIHRoZSAiUG93ZXIgVXNlcnMiIGdyb3VwIGluIHRoZSAndGVzdGluZycgZG9tYWluLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly93d3cucG93ZXJzaGVsbG1hZ2F6aW5lLmNvbS8yMDEzLzA1LzIzL3BzdGlwLXJldHJpZXZlLWdyb3VwLW1lbWJlcnNoaXAtb2YtYW4tYWN0aXZlLWRpcmVjdG9yeS1ncm91cC1yZWN1cnNpdmVseS8KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRTSUQsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRnVsbERhdGEsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlY3Vyc2UsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVzZU1hdGNoaW5nUnVsZSwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIGJlZ2luIHsKICAgICAgICBpZigkRG9tYWluQ29udHJvbGxlcikgewogICAgICAgICAgICAkVGFyZ2V0RG9tYWluQ29udHJvbGxlciA9ICREb21haW5Db250cm9sbGVyCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkVGFyZ2V0RG9tYWluQ29udHJvbGxlciA9ICgoR2V0LU5ldERvbWFpbiAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCkuUGRjUm9sZU93bmVyKS5OYW1lCiAgICAgICAgfQoKICAgICAgICBpZigkRG9tYWluKSB7CiAgICAgICAgICAgICRUYXJnZXREb21haW4gPSAkRG9tYWluCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkVGFyZ2V0RG9tYWluID0gR2V0LU5ldERvbWFpbiAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IG5hbWUKICAgICAgICB9CgogICAgICAgICMgc28gdGhpcyBpc24ndCByZXBlYXRlZCBpZiB1c2VycyBhcmUgcGFzc2VkIG9uIHRoZSBwaXBlbGluZQogICAgICAgICRHcm91cFNlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJFRhcmdldERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkVGFyZ2V0RG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcGF0aCAkQURTcGF0aCAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICB9CgogICAgcHJvY2VzcyB7CiAgICAgICAgaWYgKCRHcm91cFNlYXJjaGVyKSB7CiAgICAgICAgICAgIGlmICgkUmVjdXJzZSAtYW5kICRVc2VNYXRjaGluZ1J1bGUpIHsKICAgICAgICAgICAgICAgICMgcmVzb2x2ZSB0aGUgZ3JvdXAgdG8gYSBkaXN0aW5ndWlzaGVkbmFtZQogICAgICAgICAgICAgICAgaWYgKCRHcm91cE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAkR3JvdXAgPSBHZXQtTmV0R3JvdXAgLUdyb3VwTmFtZSAkR3JvdXBOYW1lIC1Eb21haW4gJFRhcmdldERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkVGFyZ2V0RG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRnVsbERhdGEgLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmICgkU0lEKSB7CiAgICAgICAgICAgICAgICAgICAgJEdyb3VwID0gR2V0LU5ldEdyb3VwIC1TSUQgJFNJRCAtRG9tYWluICRUYXJnZXREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJFRhcmdldERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICMgZGVmYXVsdCB0byBkb21haW4gYWRtaW5zCiAgICAgICAgICAgICAgICAgICAgJFNJRCA9IChHZXQtRG9tYWluU0lEIC1Eb21haW4gJFRhcmdldERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkVGFyZ2V0RG9tYWluQ29udHJvbGxlcikgKyAiLTUxMiIKICAgICAgICAgICAgICAgICAgICAkR3JvdXAgPSBHZXQtTmV0R3JvdXAgLVNJRCAkU0lEIC1Eb21haW4gJFRhcmdldERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkVGFyZ2V0RG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRnVsbERhdGEgLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJEdyb3VwRE4gPSAkR3JvdXAuZGlzdGluZ3Vpc2hlZG5hbWUKICAgICAgICAgICAgICAgICRHcm91cEZvdW5kTmFtZSA9ICRHcm91cC5uYW1lCgogICAgICAgICAgICAgICAgaWYgKCRHcm91cEROKSB7CiAgICAgICAgICAgICAgICAgICAgJEdyb3VwU2VhcmNoZXIuZmlsdGVyID0gIigmKHNhbUFjY291bnRUeXBlPTgwNTMwNjM2OCkobWVtYmVyb2Y6MS4yLjg0MC4xMTM1NTYuMS40LjE5NDE6PSRHcm91cEROKSRGaWx0ZXIpIgogICAgICAgICAgICAgICAgICAgICRHcm91cFNlYXJjaGVyLlByb3BlcnRpZXNUb0xvYWQuQWRkUmFuZ2UoKCdkaXN0aW5ndWlzaGVkTmFtZScsJ3NhbWFjY291bnR0eXBlJywnbGFzdGxvZ29uJywnbGFzdGxvZ29udGltZXN0YW1wJywnZHNjb3JlcHJvcGFnYXRpb25kYXRhJywnb2JqZWN0c2lkJywnd2hlbmNyZWF0ZWQnLCdiYWRwYXNzd29yZHRpbWUnLCdhY2NvdW50ZXhwaXJlcycsJ2lzY3JpdGljYWxzeXN0ZW1vYmplY3QnLCduYW1lJywndXNuY2hhbmdlZCcsJ29iamVjdGNhdGVnb3J5JywnZGVzY3JpcHRpb24nLCdjb2RlcGFnZScsJ2luc3RhbmNldHlwZScsJ2NvdW50cnljb2RlJywnZGlzdGluZ3Vpc2hlZG5hbWUnLCdjbicsJ2FkbWluY291bnQnLCdsb2dvbmhvdXJzJywnb2JqZWN0Y2xhc3MnLCdsb2dvbmNvdW50JywndXNuY3JlYXRlZCcsJ3VzZXJhY2NvdW50Y29udHJvbCcsJ29iamVjdGd1aWQnLCdwcmltYXJ5Z3JvdXBpZCcsJ2xhc3Rsb2dvZmYnLCdzYW1hY2NvdW50bmFtZScsJ2JhZHB3ZGNvdW50Jywnd2hlbmNoYW5nZWQnLCdtZW1iZXJvZicsJ3B3ZGxhc3RzZXQnLCdhZHNwYXRoJykpCgogICAgICAgICAgICAgICAgICAgICRNZW1iZXJzID0gJEdyb3VwU2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgICAgICAgICAgICAgJEdyb3VwRm91bmROYW1lID0gJEdyb3VwTmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtRXJyb3IgIlVuYWJsZSB0byBmaW5kIEdyb3VwIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCRHcm91cE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAkR3JvdXBTZWFyY2hlci5maWx0ZXIgPSAiKCYob2JqZWN0Q2F0ZWdvcnk9Z3JvdXApKG5hbWU9JEdyb3VwTmFtZSkkRmlsdGVyKSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2VpZiAoJFNJRCkgewogICAgICAgICAgICAgICAgICAgICRHcm91cFNlYXJjaGVyLmZpbHRlciA9ICIoJihvYmplY3RDYXRlZ29yeT1ncm91cCkob2JqZWN0U0lEPSRTSUQpJEZpbHRlcikiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAjIGRlZmF1bHQgdG8gZG9tYWluIGFkbWlucwogICAgICAgICAgICAgICAgICAgICRTSUQgPSAoR2V0LURvbWFpblNJRCAtRG9tYWluICRUYXJnZXREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJFRhcmdldERvbWFpbkNvbnRyb2xsZXIpICsgIi01MTIiCiAgICAgICAgICAgICAgICAgICAgJEdyb3VwU2VhcmNoZXIuZmlsdGVyID0gIigmKG9iamVjdENhdGVnb3J5PWdyb3VwKShvYmplY3RTSUQ9JFNJRCkkRmlsdGVyKSIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICRSZXN1bHQgPSAkR3JvdXBTZWFyY2hlci5GaW5kT25lKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAkTWVtYmVycyA9IEAoKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRHcm91cEZvdW5kTmFtZSA9ICcnCgogICAgICAgICAgICAgICAgaWYgKCRSZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAkTWVtYmVycyA9ICRSZXN1bHQucHJvcGVydGllcy5pdGVtKCJtZW1iZXIiKQoKICAgICAgICAgICAgICAgICAgICBpZigkTWVtYmVycy5jb3VudCAtZXEgMCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgJEZpbmlzaGVkID0gJEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICRCb3R0b20gPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICRUb3AgPSAwCgogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSghJEZpbmlzaGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVG9wID0gJEJvdHRvbSArIDE0OTkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJSYW5nZT0ibWVtYmVyO3JhbmdlPSRCb3R0b20tJFRvcCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRCb3R0b20gKz0gMTUwMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBTZWFyY2hlci5Qcm9wZXJ0aWVzVG9Mb2FkLkNsZWFyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFt2b2lkXSRHcm91cFNlYXJjaGVyLlByb3BlcnRpZXNUb0xvYWQuQWRkKCIkTWVtYmVyUmFuZ2UiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgW3ZvaWRdJEdyb3VwU2VhcmNoZXIuUHJvcGVydGllc1RvTG9hZC5BZGQoIm5hbWUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0ID0gJEdyb3VwU2VhcmNoZXIuRmluZE9uZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFJhbmdlZFByb3BlcnR5ID0gJFJlc3VsdC5Qcm9wZXJ0aWVzLlByb3BlcnR5TmFtZXMgLWxpa2UgIm1lbWJlcjtyYW5nZT0qIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJzICs9ICRSZXN1bHQuUHJvcGVydGllcy5pdGVtKCRSYW5nZWRQcm9wZXJ0eSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBGb3VuZE5hbWUgPSAkUmVzdWx0LnByb3BlcnRpZXMuaXRlbSgibmFtZSIpWzBdCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkTWVtYmVycy5jb3VudCAtZXEgMCkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZpbmlzaGVkID0gJFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCBbU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5NZXRob2RJbnZvY2F0aW9uRXhjZXB0aW9uXSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZpbmlzaGVkID0gJFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwRm91bmROYW1lID0gJFJlc3VsdC5wcm9wZXJ0aWVzLml0ZW0oIm5hbWUiKVswXQogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVycyArPSAkUmVzdWx0LlByb3BlcnRpZXMuaXRlbSgkUmFuZ2VkUHJvcGVydHkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJEdyb3VwU2VhcmNoZXIuZGlzcG9zZSgpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRNZW1iZXJzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIGRvaW5nIHRoZSBMREFQX01BVENISU5HX1JVTEVfSU5fQ0hBSU4gcmVjdXJzaW9uCiAgICAgICAgICAgICAgICBpZiAoJFJlY3Vyc2UgLWFuZCAkVXNlTWF0Y2hpbmdSdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgPSAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYoJFRhcmdldERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFJlc3VsdCA9IFthZHNpXSJMREFQOi8vJFRhcmdldERvbWFpbkNvbnRyb2xsZXIvJF8iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0ID0gW2Fkc2ldIkxEQVA6Ly8kXyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoJFJlc3VsdCl7CiAgICAgICAgICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gJFJlc3VsdC5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKCRQcm9wZXJ0aWVzKSB7CgogICAgICAgICAgICAgICAgICAgICRJc0dyb3VwID0gQCgnMjY4NDM1NDU2JywnMjY4NDM1NDU3JywnNTM2ODcwOTEyJywnNTM2ODcwOTEzJykgLWNvbnRhaW5zICRQcm9wZXJ0aWVzLnNhbWFjY291bnR0eXBlCgogICAgICAgICAgICAgICAgICAgIGlmICgkRnVsbERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVyID0gQ29udmVydC1MREFQUHJvcGVydHkgLVByb3BlcnRpZXMgJFByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cERvbWFpbicgJFRhcmdldERvbWFpbgogICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cE5hbWUnICRHcm91cEZvdW5kTmFtZQoKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRE4gPSAkUHJvcGVydGllcy5kaXN0aW5ndWlzaGVkbmFtZVswXQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBleHRyYWN0IHRoZSBGUUROIGZyb20gdGhlIERpc3Rpbmd1aXNoZWQgTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRG9tYWluID0gJE1lbWJlckROLnN1YlN0cmluZygkTWVtYmVyRE4uSW5kZXhPZigiREM9IikpIC1yZXBsYWNlICdEQz0nLCcnIC1yZXBsYWNlICcsJywnLicKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRE4gPSAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRG9tYWluID0gJE51bGwKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICgkUHJvcGVydGllcy5zYW1hY2NvdW50bmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAjIGZvcmVzdCB1c2VycyBoYXZlIHRoZSBzYW1BY2NvdW50TmFtZSBzZXQKICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlck5hbWUgPSAkUHJvcGVydGllcy5zYW1hY2NvdW50bmFtZVswXQogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgZXh0ZXJuYWwgdHJ1c3QgdXNlcnMgaGF2ZSBhIFNJRCwgc28gY29udmVydCBpdAogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlck5hbWUgPSBDb252ZXJ0LVNpZFRvTmFtZSAkUHJvcGVydGllcy5jblswXQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgdGhlcmUncyBhIHByb2JsZW0gY29udGFjdGluZyB0aGUgZG9tYWluIHRvIHJlc29sdmUgdGhlIFNJRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlck5hbWUgPSAkUHJvcGVydGllcy5jbgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmKCRQcm9wZXJ0aWVzLm9iamVjdFNpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyU2lkID0gKChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyICRQcm9wZXJ0aWVzLm9iamVjdFNpZFswXSwwKS5WYWx1ZSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJTaWQgPSAkTnVsbAogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlckRvbWFpbicgJE1lbWJlckRvbWFpbgogICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJOYW1lJyAkTWVtYmVyTmFtZQogICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJTaWQnICRNZW1iZXJTaWQKICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSXNHcm91cCcgJElzR3JvdXAKICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyRE4nICRNZW1iZXJETgogICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlci5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuR3JvdXBNZW1iZXInKQogICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlcgoKICAgICAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIGRvaW5nIG1hbnVhbCByZWN1cnNpb24KICAgICAgICAgICAgICAgICAgICBpZiAoJFJlY3Vyc2UgLWFuZCAhJFVzZU1hdGNoaW5nUnVsZSAtYW5kICRJc0dyb3VwIC1hbmQgJE1lbWJlck5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJEZ1bGxEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHZXQtTmV0R3JvdXBNZW1iZXIgLUZ1bGxEYXRhIC1Eb21haW4gJE1lbWJlckRvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkVGFyZ2V0RG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtR3JvdXBOYW1lICRNZW1iZXJOYW1lIC1SZWN1cnNlIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdldC1OZXRHcm91cE1lbWJlciAtRG9tYWluICRNZW1iZXJEb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJFRhcmdldERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUdyb3VwTmFtZSAkTWVtYmVyTmFtZSAtUmVjdXJzZSAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LU5ldEZpbGVTZXJ2ZXIgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFJldHVybnMgYSBsaXN0IG9mIGFsbCBmaWxlIHNlcnZlcnMgZXh0cmFjdGVkIGZyb20gdXNlciAKICAgICAgICBob21lZGlyZWN0b3J5LCBzY3JpcHRwYXRoLCBhbmQgcHJvZmlsZXBhdGggZmllbGRzLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHVzZXIgZmlsZSBzZXJ2ZXJzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBUYXJnZXRVc2VycwoKICAgICAgICBBbiBhcnJheSBvZiB1c2VycyB0byBxdWVyeSBmb3IgZmlsZSBzZXJ2ZXJzLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0RmlsZVNlcnZlcgogICAgICAgIAogICAgICAgIFJldHVybnMgYWN0aXZlIGZpbGUgc2VydmVycy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRGaWxlU2VydmVyIC1Eb21haW4gdGVzdGluZwogICAgICAgIAogICAgICAgIFJldHVybnMgYWN0aXZlIGZpbGUgc2VydmVycyBmb3IgdGhlICd0ZXN0aW5nJyBkb21haW4uCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgICRUYXJnZXRVc2VycywKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIGZ1bmN0aW9uIFNwbGl0UGF0aCB7CiAgICAgICAgIyBzaG9ydCBpbnRlcm5hbCBoZWxwZXIgdG8gc3BsaXQgVU5DIHNlcnZlciBwYXRocwogICAgICAgIHBhcmFtKFtTdHJpbmddJFBhdGgpCgogICAgICAgIGlmICgkUGF0aCAtYW5kICgkUGF0aC5zcGxpdCgiXFwiKS5Db3VudCAtZ2UgMykpIHsKICAgICAgICAgICAgJFRlbXAgPSAkUGF0aC5zcGxpdCgiXFwiKVsyXQogICAgICAgICAgICBpZigkVGVtcCAtYW5kICgkVGVtcCAtbmUgJycpKSB7CiAgICAgICAgICAgICAgICAkVGVtcAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIEdldC1OZXRVc2VyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtUGFnZVNpemUgJFBhZ2VTaXplIHwgV2hlcmUtT2JqZWN0IHskX30gfCBXaGVyZS1PYmplY3QgewogICAgICAgICAgICAjIGZpbHRlciBmb3IgYW55IHRhcmdldCB1c2VycwogICAgICAgICAgICBpZigkVGFyZ2V0VXNlcnMpIHsKICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyAtTWF0Y2ggJF8uc2FtQWNjb3VudE5hbWUKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsgJFRydWUgfSAKICAgICAgICB9IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAjIHNwbGl0IG91dCBldmVyeSBwb3RlbnRpYWwgZmlsZSBzZXJ2ZXIgcGF0aAogICAgICAgICAgICBpZigkXy5ob21lZGlyZWN0b3J5KSB7CiAgICAgICAgICAgICAgICBTcGxpdFBhdGgoJF8uaG9tZWRpcmVjdG9yeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkXy5zY3JpcHRwYXRoKSB7CiAgICAgICAgICAgICAgICBTcGxpdFBhdGgoJF8uc2NyaXB0cGF0aCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkXy5wcm9maWxlcGF0aCkgewogICAgICAgICAgICAgICAgU3BsaXRQYXRoKCRfLnByb2ZpbGVwYXRoKQogICAgICAgICAgICB9CgogICAgICAgIH0gfCBXaGVyZS1PYmplY3QgeyRffSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUKfQoKCmZ1bmN0aW9uIEdldC1ERlNzaGFyZSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUmV0dXJucyBhIGxpc3Qgb2YgYWxsIGZhdWx0LXRvbGVyYW50IGRpc3RyaWJ1dGVkIGZpbGUKICAgICAgICBzeXN0ZW1zIGZvciBhIGdpdmVuIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIFZlcnNpb24KCiAgICAgICAgVGhlIHZlcnNpb24gb2YgREZTIHRvIHF1ZXJ5IGZvciBzZXJ2ZXJzLgogICAgICAgIDEvdjEsIDIvdjIsIG9yIGFsbAoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHVzZXIgREZTIHNoYXJlcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1ERlNzaGFyZQoKICAgICAgICBSZXR1cm5zIGFsbCBkaXN0cmlidXRlZCBmaWxlIHN5c3RlbSBzaGFyZXMgZm9yIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1ERlNzaGFyZSAtRG9tYWluIHRlc3QKCiAgICAgICAgUmV0dXJucyBhbGwgZGlzdHJpYnV0ZWQgZmlsZSBzeXN0ZW0gc2hhcmVzIGZvciB0aGUgJ3Rlc3QnIGRvbWFpbi4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVTZXQoIkFsbCIsIlYxIiwiMSIsIlYyIiwiMiIpXQogICAgICAgICRWZXJzaW9uID0gIkFsbCIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIGZ1bmN0aW9uIFBhcnNlLVBrdCB7CiAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0KICAgICAgICBwYXJhbSgKICAgICAgICAgICAgW2J5dGVbXV0KICAgICAgICAgICAgJFBrdAogICAgICAgICkKCiAgICAgICAgJGJpbiA9ICRQa3QKICAgICAgICAkYmxvYl92ZXJzaW9uID0gW2JpdGNvbnZlcnRlcl06OlRvVUludDMyKCRiaW5bMC4uM10sMCkKICAgICAgICAkYmxvYl9lbGVtZW50X2NvdW50ID0gW2JpdGNvbnZlcnRlcl06OlRvVUludDMyKCRiaW5bNC4uN10sMCkKICAgICAgICAkb2Zmc2V0ID0gOAogICAgICAgICNodHRwczovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2NjMjI3MTQ3LmFzcHgKICAgICAgICAkb2JqZWN0X2xpc3QgPSBAKCkKICAgICAgICBmb3IoJGk9MTsgJGkgLWxlICRibG9iX2VsZW1lbnRfY291bnQ7ICRpKyspewogICAgICAgICAgICAgICAkYmxvYl9uYW1lX3NpemVfc3RhcnQgPSAkb2Zmc2V0CiAgICAgICAgICAgICAgICRibG9iX25hbWVfc2l6ZV9lbmQgPSAkb2Zmc2V0ICsgMQogICAgICAgICAgICAgICAkYmxvYl9uYW1lX3NpemUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MTYoJGJpblskYmxvYl9uYW1lX3NpemVfc3RhcnQuLiRibG9iX25hbWVfc2l6ZV9lbmRdLDApCgogICAgICAgICAgICAgICAkYmxvYl9uYW1lX3N0YXJ0ID0gJGJsb2JfbmFtZV9zaXplX2VuZCArIDEKICAgICAgICAgICAgICAgJGJsb2JfbmFtZV9lbmQgPSAkYmxvYl9uYW1lX3N0YXJ0ICsgJGJsb2JfbmFtZV9zaXplIC0gMQogICAgICAgICAgICAgICAkYmxvYl9uYW1lID0gW1N5c3RlbS5UZXh0LkVuY29kaW5nXTo6VW5pY29kZS5HZXRTdHJpbmcoJGJpblskYmxvYl9uYW1lX3N0YXJ0Li4kYmxvYl9uYW1lX2VuZF0pCgogICAgICAgICAgICAgICAkYmxvYl9kYXRhX3NpemVfc3RhcnQgPSAkYmxvYl9uYW1lX2VuZCArIDEKICAgICAgICAgICAgICAgJGJsb2JfZGF0YV9zaXplX2VuZCA9ICRibG9iX2RhdGFfc2l6ZV9zdGFydCArIDMKICAgICAgICAgICAgICAgJGJsb2JfZGF0YV9zaXplID0gW2JpdGNvbnZlcnRlcl06OlRvVUludDMyKCRiaW5bJGJsb2JfZGF0YV9zaXplX3N0YXJ0Li4kYmxvYl9kYXRhX3NpemVfZW5kXSwwKQoKICAgICAgICAgICAgICAgJGJsb2JfZGF0YV9zdGFydCA9ICRibG9iX2RhdGFfc2l6ZV9lbmQgKyAxCiAgICAgICAgICAgICAgICRibG9iX2RhdGFfZW5kID0gJGJsb2JfZGF0YV9zdGFydCArICRibG9iX2RhdGFfc2l6ZSAtIDEKICAgICAgICAgICAgICAgJGJsb2JfZGF0YSA9ICRiaW5bJGJsb2JfZGF0YV9zdGFydC4uJGJsb2JfZGF0YV9lbmRdCiAgICAgICAgICAgICAgIHN3aXRjaCAtd2lsZGNhcmQgKCRibG9iX25hbWUpIHsKICAgICAgICAgICAgICAgICJcc2l0ZXJvb3QiIHsgIH0KICAgICAgICAgICAgICAgICJcZG9tYWlucm9vdCoiIHsKICAgICAgICAgICAgICAgICAgICAjIFBhcnNlIERGU05hbWVzcGFjZVJvb3RPckxpbmtCbG9iIG9iamVjdC4gU3RhcnRzIHdpdGggdmFyaWFibGUgbGVuZ3RoIERGU1Jvb3RPckxpbmtJREJsb2Igd2hpY2ggd2UgcGFyc2UgZmlyc3QuLi4KICAgICAgICAgICAgICAgICAgICAjIERGU1Jvb3RPckxpbmtJREJsb2IKICAgICAgICAgICAgICAgICAgICAkcm9vdF9vcl9saW5rX2d1aWRfc3RhcnQgPSAwCiAgICAgICAgICAgICAgICAgICAgJHJvb3Rfb3JfbGlua19ndWlkX2VuZCA9IDE1CiAgICAgICAgICAgICAgICAgICAgJHJvb3Rfb3JfbGlua19ndWlkID0gW2J5dGVbXV0kYmxvYl9kYXRhWyRyb290X29yX2xpbmtfZ3VpZF9zdGFydC4uJHJvb3Rfb3JfbGlua19ndWlkX2VuZF0KICAgICAgICAgICAgICAgICAgICAkZ3VpZCA9IE5ldy1PYmplY3QgR3VpZCgsJHJvb3Rfb3JfbGlua19ndWlkKSAjIHNob3VsZCBtYXRjaCAkZ3VpZF9zdHIKICAgICAgICAgICAgICAgICAgICAkcHJlZml4X3NpemVfc3RhcnQgPSAkcm9vdF9vcl9saW5rX2d1aWRfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRwcmVmaXhfc2l6ZV9lbmQgPSAkcHJlZml4X3NpemVfc3RhcnQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHByZWZpeF9zaXplID0gW2JpdGNvbnZlcnRlcl06OlRvVUludDE2KCRibG9iX2RhdGFbJHByZWZpeF9zaXplX3N0YXJ0Li4kcHJlZml4X3NpemVfZW5kXSwwKQogICAgICAgICAgICAgICAgICAgICRwcmVmaXhfc3RhcnQgPSAkcHJlZml4X3NpemVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRwcmVmaXhfZW5kID0gJHByZWZpeF9zdGFydCArICRwcmVmaXhfc2l6ZSAtIDEKICAgICAgICAgICAgICAgICAgICAkcHJlZml4ID0gW1N5c3RlbS5UZXh0LkVuY29kaW5nXTo6VW5pY29kZS5HZXRTdHJpbmcoJGJsb2JfZGF0YVskcHJlZml4X3N0YXJ0Li4kcHJlZml4X2VuZF0pCgogICAgICAgICAgICAgICAgICAgICRzaG9ydF9wcmVmaXhfc2l6ZV9zdGFydCA9ICRwcmVmaXhfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRzaG9ydF9wcmVmaXhfc2l6ZV9lbmQgPSAkc2hvcnRfcHJlZml4X3NpemVfc3RhcnQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHNob3J0X3ByZWZpeF9zaXplID0gW2JpdGNvbnZlcnRlcl06OlRvVUludDE2KCRibG9iX2RhdGFbJHNob3J0X3ByZWZpeF9zaXplX3N0YXJ0Li4kc2hvcnRfcHJlZml4X3NpemVfZW5kXSwwKQogICAgICAgICAgICAgICAgICAgICRzaG9ydF9wcmVmaXhfc3RhcnQgPSAkc2hvcnRfcHJlZml4X3NpemVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRzaG9ydF9wcmVmaXhfZW5kID0gJHNob3J0X3ByZWZpeF9zdGFydCArICRzaG9ydF9wcmVmaXhfc2l6ZSAtIDEKICAgICAgICAgICAgICAgICAgICAkc2hvcnRfcHJlZml4ID0gW1N5c3RlbS5UZXh0LkVuY29kaW5nXTo6VW5pY29kZS5HZXRTdHJpbmcoJGJsb2JfZGF0YVskc2hvcnRfcHJlZml4X3N0YXJ0Li4kc2hvcnRfcHJlZml4X2VuZF0pCgogICAgICAgICAgICAgICAgICAgICR0eXBlX3N0YXJ0ID0gJHNob3J0X3ByZWZpeF9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHR5cGVfZW5kID0gJHR5cGVfc3RhcnQgKyAzCiAgICAgICAgICAgICAgICAgICAgJHR5cGUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGJsb2JfZGF0YVskdHlwZV9zdGFydC4uJHR5cGVfZW5kXSwwKQoKICAgICAgICAgICAgICAgICAgICAkc3RhdGVfc3RhcnQgPSAkdHlwZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHN0YXRlX2VuZCA9ICRzdGF0ZV9zdGFydCArIDMKICAgICAgICAgICAgICAgICAgICAkc3RhdGUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGJsb2JfZGF0YVskc3RhdGVfc3RhcnQuLiRzdGF0ZV9lbmRdLDApCgogICAgICAgICAgICAgICAgICAgICRjb21tZW50X3NpemVfc3RhcnQgPSAkc3RhdGVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRjb21tZW50X3NpemVfZW5kID0gJGNvbW1lbnRfc2l6ZV9zdGFydCArIDEKICAgICAgICAgICAgICAgICAgICAkY29tbWVudF9zaXplID0gW2JpdGNvbnZlcnRlcl06OlRvVUludDE2KCRibG9iX2RhdGFbJGNvbW1lbnRfc2l6ZV9zdGFydC4uJGNvbW1lbnRfc2l6ZV9lbmRdLDApCiAgICAgICAgICAgICAgICAgICAgJGNvbW1lbnRfc3RhcnQgPSAkY29tbWVudF9zaXplX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAkY29tbWVudF9lbmQgPSAkY29tbWVudF9zdGFydCArICRjb21tZW50X3NpemUgLSAxCiAgICAgICAgICAgICAgICAgICAgaWYgKCRjb21tZW50X3NpemUgLWd0IDApICB7CiAgICAgICAgICAgICAgICAgICAgICAgICRjb21tZW50ID0gW1N5c3RlbS5UZXh0LkVuY29kaW5nXTo6VW5pY29kZS5HZXRTdHJpbmcoJGJsb2JfZGF0YVskY29tbWVudF9zdGFydC4uJGNvbW1lbnRfZW5kXSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHByZWZpeF90aW1lc3RhbXBfc3RhcnQgPSAkY29tbWVudF9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHByZWZpeF90aW1lc3RhbXBfZW5kID0gJHByZWZpeF90aW1lc3RhbXBfc3RhcnQgKyA3CiAgICAgICAgICAgICAgICAgICAgIyBodHRwczovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2NjMjMwMzI0LmFzcHggRklMRVRJTUUKICAgICAgICAgICAgICAgICAgICAkcHJlZml4X3RpbWVzdGFtcCA9ICRibG9iX2RhdGFbJHByZWZpeF90aW1lc3RhbXBfc3RhcnQuLiRwcmVmaXhfdGltZXN0YW1wX2VuZF0gI2R3b3JkIGxvd0RhdGVUaW1lICNkd29yZCBoaWdoZGF0ZXRpbWUKICAgICAgICAgICAgICAgICAgICAkc3RhdGVfdGltZXN0YW1wX3N0YXJ0ID0gJHByZWZpeF90aW1lc3RhbXBfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRzdGF0ZV90aW1lc3RhbXBfZW5kID0gJHN0YXRlX3RpbWVzdGFtcF9zdGFydCArIDcKICAgICAgICAgICAgICAgICAgICAkc3RhdGVfdGltZXN0YW1wID0gJGJsb2JfZGF0YVskc3RhdGVfdGltZXN0YW1wX3N0YXJ0Li4kc3RhdGVfdGltZXN0YW1wX2VuZF0KICAgICAgICAgICAgICAgICAgICAkY29tbWVudF90aW1lc3RhbXBfc3RhcnQgPSAkc3RhdGVfdGltZXN0YW1wX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAkY29tbWVudF90aW1lc3RhbXBfZW5kID0gJGNvbW1lbnRfdGltZXN0YW1wX3N0YXJ0ICsgNwogICAgICAgICAgICAgICAgICAgICRjb21tZW50X3RpbWVzdGFtcCA9ICRibG9iX2RhdGFbJGNvbW1lbnRfdGltZXN0YW1wX3N0YXJ0Li4kY29tbWVudF90aW1lc3RhbXBfZW5kXQogICAgICAgICAgICAgICAgICAgICR2ZXJzaW9uX3N0YXJ0ID0gJGNvbW1lbnRfdGltZXN0YW1wX2VuZCAgKyAxCiAgICAgICAgICAgICAgICAgICAgJHZlcnNpb25fZW5kID0gJHZlcnNpb25fc3RhcnQgKyAzCiAgICAgICAgICAgICAgICAgICAgJHZlcnNpb24gPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGJsb2JfZGF0YVskdmVyc2lvbl9zdGFydC4uJHZlcnNpb25fZW5kXSwwKQoKICAgICAgICAgICAgICAgICAgICAjIFBhcnNlIHJlc3Qgb2YgREZTTmFtZXNwYWNlUm9vdE9yTGlua0Jsb2IgaGVyZQogICAgICAgICAgICAgICAgICAgICRkZnNfdGFyZ2V0bGlzdF9ibG9iX3NpemVfc3RhcnQgPSAkdmVyc2lvbl9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJGRmc190YXJnZXRsaXN0X2Jsb2Jfc2l6ZV9lbmQgPSAkZGZzX3RhcmdldGxpc3RfYmxvYl9zaXplX3N0YXJ0ICsgMwogICAgICAgICAgICAgICAgICAgICRkZnNfdGFyZ2V0bGlzdF9ibG9iX3NpemUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGJsb2JfZGF0YVskZGZzX3RhcmdldGxpc3RfYmxvYl9zaXplX3N0YXJ0Li4kZGZzX3RhcmdldGxpc3RfYmxvYl9zaXplX2VuZF0sMCkKCiAgICAgICAgICAgICAgICAgICAgJGRmc190YXJnZXRsaXN0X2Jsb2Jfc3RhcnQgPSAkZGZzX3RhcmdldGxpc3RfYmxvYl9zaXplX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAkZGZzX3RhcmdldGxpc3RfYmxvYl9lbmQgPSAkZGZzX3RhcmdldGxpc3RfYmxvYl9zdGFydCArICRkZnNfdGFyZ2V0bGlzdF9ibG9iX3NpemUgLSAxCiAgICAgICAgICAgICAgICAgICAgJGRmc190YXJnZXRsaXN0X2Jsb2IgPSAkYmxvYl9kYXRhWyRkZnNfdGFyZ2V0bGlzdF9ibG9iX3N0YXJ0Li4kZGZzX3RhcmdldGxpc3RfYmxvYl9lbmRdCiAgICAgICAgICAgICAgICAgICAgJHJlc2VydmVkX2Jsb2Jfc2l6ZV9zdGFydCA9ICRkZnNfdGFyZ2V0bGlzdF9ibG9iX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAkcmVzZXJ2ZWRfYmxvYl9zaXplX2VuZCA9ICRyZXNlcnZlZF9ibG9iX3NpemVfc3RhcnQgKyAzCiAgICAgICAgICAgICAgICAgICAgJHJlc2VydmVkX2Jsb2Jfc2l6ZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkYmxvYl9kYXRhWyRyZXNlcnZlZF9ibG9iX3NpemVfc3RhcnQuLiRyZXNlcnZlZF9ibG9iX3NpemVfZW5kXSwwKQoKICAgICAgICAgICAgICAgICAgICAkcmVzZXJ2ZWRfYmxvYl9zdGFydCA9ICRyZXNlcnZlZF9ibG9iX3NpemVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRyZXNlcnZlZF9ibG9iX2VuZCA9ICRyZXNlcnZlZF9ibG9iX3N0YXJ0ICsgJHJlc2VydmVkX2Jsb2Jfc2l6ZSAtIDEKICAgICAgICAgICAgICAgICAgICAkcmVzZXJ2ZWRfYmxvYiA9ICRibG9iX2RhdGFbJHJlc2VydmVkX2Jsb2Jfc3RhcnQuLiRyZXNlcnZlZF9ibG9iX2VuZF0KICAgICAgICAgICAgICAgICAgICAkcmVmZXJyYWxfdHRsX3N0YXJ0ID0gJHJlc2VydmVkX2Jsb2JfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRyZWZlcnJhbF90dGxfZW5kID0gJHJlZmVycmFsX3R0bF9zdGFydCArIDMKICAgICAgICAgICAgICAgICAgICAkcmVmZXJyYWxfdHRsID0gW2JpdGNvbnZlcnRlcl06OlRvVUludDMyKCRibG9iX2RhdGFbJHJlZmVycmFsX3R0bF9zdGFydC4uJHJlZmVycmFsX3R0bF9lbmRdLDApCgogICAgICAgICAgICAgICAgICAgICNQYXJzZSBERlNUYXJnZXRMaXN0QmxvYgogICAgICAgICAgICAgICAgICAgICR0YXJnZXRfY291bnRfc3RhcnQgPSAwCiAgICAgICAgICAgICAgICAgICAgJHRhcmdldF9jb3VudF9lbmQgPSAkdGFyZ2V0X2NvdW50X3N0YXJ0ICsgMwogICAgICAgICAgICAgICAgICAgICR0YXJnZXRfY291bnQgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGRmc190YXJnZXRsaXN0X2Jsb2JbJHRhcmdldF9jb3VudF9zdGFydC4uJHRhcmdldF9jb3VudF9lbmRdLDApCiAgICAgICAgICAgICAgICAgICAgJHRfb2Zmc2V0ID0gJHRhcmdldF9jb3VudF9lbmQgKyAxCgogICAgICAgICAgICAgICAgICAgIGZvcigkaj0xOyAkaiAtbGUgJHRhcmdldF9jb3VudDsgJGorKyl7CiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfZW50cnlfc2l6ZV9zdGFydCA9ICR0X29mZnNldAogICAgICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0X2VudHJ5X3NpemVfZW5kID0gJHRhcmdldF9lbnRyeV9zaXplX3N0YXJ0ICsgMwogICAgICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0X2VudHJ5X3NpemUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGRmc190YXJnZXRsaXN0X2Jsb2JbJHRhcmdldF9lbnRyeV9zaXplX3N0YXJ0Li4kdGFyZ2V0X2VudHJ5X3NpemVfZW5kXSwwKQogICAgICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0X3RpbWVfc3RhbXBfc3RhcnQgPSAkdGFyZ2V0X2VudHJ5X3NpemVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0X3RpbWVfc3RhbXBfZW5kID0gJHRhcmdldF90aW1lX3N0YW1wX3N0YXJ0ICsgNwogICAgICAgICAgICAgICAgICAgICAgICAjIEZJTEVUSU1FIGFnYWluIG9yIHNwZWNpYWwgaWYgcHJpb3JpdHkgcmFuayBhbmQgcHJpb3JpdHkgY2xhc3MgMAogICAgICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0X3RpbWVfc3RhbXAgPSAkZGZzX3RhcmdldGxpc3RfYmxvYlskdGFyZ2V0X3RpbWVfc3RhbXBfc3RhcnQuLiR0YXJnZXRfdGltZV9zdGFtcF9lbmRdCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfc3RhdGVfc3RhcnQgPSAkdGFyZ2V0X3RpbWVfc3RhbXBfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0X3N0YXRlX2VuZCA9ICR0YXJnZXRfc3RhdGVfc3RhcnQgKyAzCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfc3RhdGUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGRmc190YXJnZXRsaXN0X2Jsb2JbJHRhcmdldF9zdGF0ZV9zdGFydC4uJHRhcmdldF9zdGF0ZV9lbmRdLDApCgogICAgICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0X3R5cGVfc3RhcnQgPSAkdGFyZ2V0X3N0YXRlX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAgICAgJHRhcmdldF90eXBlX2VuZCA9ICR0YXJnZXRfdHlwZV9zdGFydCArIDMKICAgICAgICAgICAgICAgICAgICAgICAgJHRhcmdldF90eXBlID0gW2JpdGNvbnZlcnRlcl06OlRvVUludDMyKCRkZnNfdGFyZ2V0bGlzdF9ibG9iWyR0YXJnZXRfdHlwZV9zdGFydC4uJHRhcmdldF90eXBlX2VuZF0sMCkKCiAgICAgICAgICAgICAgICAgICAgICAgICRzZXJ2ZXJfbmFtZV9zaXplX3N0YXJ0ID0gJHRhcmdldF90eXBlX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAgICAgJHNlcnZlcl9uYW1lX3NpemVfZW5kID0gJHNlcnZlcl9uYW1lX3NpemVfc3RhcnQgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICRzZXJ2ZXJfbmFtZV9zaXplID0gW2JpdGNvbnZlcnRlcl06OlRvVUludDE2KCRkZnNfdGFyZ2V0bGlzdF9ibG9iWyRzZXJ2ZXJfbmFtZV9zaXplX3N0YXJ0Li4kc2VydmVyX25hbWVfc2l6ZV9lbmRdLDApCgogICAgICAgICAgICAgICAgICAgICAgICAkc2VydmVyX25hbWVfc3RhcnQgPSAkc2VydmVyX25hbWVfc2l6ZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICRzZXJ2ZXJfbmFtZV9lbmQgPSAkc2VydmVyX25hbWVfc3RhcnQgKyAkc2VydmVyX25hbWVfc2l6ZSAtIDEKICAgICAgICAgICAgICAgICAgICAgICAgJHNlcnZlcl9uYW1lID0gW1N5c3RlbS5UZXh0LkVuY29kaW5nXTo6VW5pY29kZS5HZXRTdHJpbmcoJGRmc190YXJnZXRsaXN0X2Jsb2JbJHNlcnZlcl9uYW1lX3N0YXJ0Li4kc2VydmVyX25hbWVfZW5kXSkKCiAgICAgICAgICAgICAgICAgICAgICAgICRzaGFyZV9uYW1lX3NpemVfc3RhcnQgPSAkc2VydmVyX25hbWVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICAgICAkc2hhcmVfbmFtZV9zaXplX2VuZCA9ICRzaGFyZV9uYW1lX3NpemVfc3RhcnQgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICRzaGFyZV9uYW1lX3NpemUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MTYoJGRmc190YXJnZXRsaXN0X2Jsb2JbJHNoYXJlX25hbWVfc2l6ZV9zdGFydC4uJHNoYXJlX25hbWVfc2l6ZV9lbmRdLDApCiAgICAgICAgICAgICAgICAgICAgICAgICRzaGFyZV9uYW1lX3N0YXJ0ID0gJHNoYXJlX25hbWVfc2l6ZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICRzaGFyZV9uYW1lX2VuZCA9ICRzaGFyZV9uYW1lX3N0YXJ0ICsgJHNoYXJlX25hbWVfc2l6ZSAtIDEKICAgICAgICAgICAgICAgICAgICAgICAgJHNoYXJlX25hbWUgPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVbmljb2RlLkdldFN0cmluZygkZGZzX3RhcmdldGxpc3RfYmxvYlskc2hhcmVfbmFtZV9zdGFydC4uJHNoYXJlX25hbWVfZW5kXSkKCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfbGlzdCArPSAiXFwkc2VydmVyX25hbWVcJHNoYXJlX25hbWUiCiAgICAgICAgICAgICAgICAgICAgICAgICR0X29mZnNldCA9ICRzaGFyZV9uYW1lX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG9mZnNldCA9ICRibG9iX2RhdGFfZW5kICsgMQogICAgICAgICAgICAkZGZzX3BrdF9wcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICdOYW1lJyA9ICRibG9iX25hbWUKICAgICAgICAgICAgICAgICdQcmVmaXgnID0gJHByZWZpeAogICAgICAgICAgICAgICAgJ1RhcmdldExpc3QnID0gJHRhcmdldF9saXN0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG9iamVjdF9saXN0ICs9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IC1Qcm9wZXJ0eSAkZGZzX3BrdF9wcm9wZXJ0aWVzCiAgICAgICAgICAgICRwcmVmaXggPSAkbnVsbAogICAgICAgICAgICAkYmxvYl9uYW1lID0gJG51bGwKICAgICAgICAgICAgJHRhcmdldF9saXN0ID0gJG51bGwKICAgICAgICB9CgogICAgICAgICRzZXJ2ZXJzID0gQCgpCiAgICAgICAgJG9iamVjdF9saXN0IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICBpZiAoJF8uVGFyZ2V0TGlzdCkgewogICAgICAgICAgICAgICAgJF8uVGFyZ2V0TGlzdCB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAkc2VydmVycyArPSAkXy5zcGxpdCgiXCIpWzJdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRzZXJ2ZXJzCiAgICB9CgogICAgZnVuY3Rpb24gR2V0LURGU3NoYXJlVjEgewogICAgICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICAgICAgcGFyYW0oCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICREb21haW4sCgogICAgICAgICAgICBbU3RyaW5nXQogICAgICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICRBRFNwYXRoLAoKICAgICAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgICAgIFtJbnRdCiAgICAgICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICAgICAkQ3JlZGVudGlhbAogICAgICAgICkKCiAgICAgICAgJERGU3NlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcGF0aCAkQURTcGF0aCAtUGFnZVNpemUgJFBhZ2VTaXplCgogICAgICAgIGlmKCRERlNzZWFyY2hlcikgewogICAgICAgICAgICAkREZTc2hhcmVzID0gQCgpCiAgICAgICAgICAgICRERlNzZWFyY2hlci5maWx0ZXIgPSAiKCYob2JqZWN0Q2xhc3M9ZlREZnMpKSIKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkUmVzdWx0cyA9ICRERlNTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgPSAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgJFJlbW90ZU5hbWVzID0gJFByb3BlcnRpZXMucmVtb3Rlc2VydmVybmFtZQogICAgICAgICAgICAgICAgICAgICRQa3QgPSAkUHJvcGVydGllcy5wa3QKCiAgICAgICAgICAgICAgICAgICAgJERGU3NoYXJlcyArPSAkUmVtb3RlTmFtZXMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRfLkNvbnRhaW5zKCdcJykgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5IEB7J05hbWUnPSRQcm9wZXJ0aWVzLm5hbWVbMF07J1JlbW90ZVNlcnZlck5hbWUnPSRfLnNwbGl0KCJcIilbMl19CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgaW4gcGFyc2luZyBERlMgc2hhcmUgOiAkXyIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICAgICAgICAgJERGU1NlYXJjaGVyLmRpc3Bvc2UoKQoKICAgICAgICAgICAgICAgIGlmKCRwa3QgLWFuZCAkcGt0WzBdKSB7CiAgICAgICAgICAgICAgICAgICAgUGFyc2UtUGt0ICRwa3RbMF0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgSWYgYSBmb2xkZXIgZG9lc24ndCBoYXZlIGEgcmVkaXJlY3Rpb24gaXQgd2lsbAogICAgICAgICAgICAgICAgICAgICAgICAjIGhhdmUgYSB0YXJnZXQgbGlrZQogICAgICAgICAgICAgICAgICAgICAgICAjIFxcbnVsbFxUZXN0TmFtZVNwYWNlXGZvbGRlclwuREZTRm9sZGVyTGluayBzbyB3ZQogICAgICAgICAgICAgICAgICAgICAgICAjIGRvIGFjdHVhbGx5IHdhbnQgdG8gbWF0Y2ggb24gIm51bGwiIHJhdGhlciB0aGFuCiAgICAgICAgICAgICAgICAgICAgICAgICMgJG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRfIC1uZSAibnVsbCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IC1Qcm9wZXJ0eSBAeydOYW1lJz0kUHJvcGVydGllcy5uYW1lWzBdOydSZW1vdGVTZXJ2ZXJOYW1lJz0kX30KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJHZXQtREZTc2hhcmVWMSBlcnJvciA6ICRfIgogICAgICAgICAgICB9CiAgICAgICAgICAgICRERlNzaGFyZXMgfCBTb3J0LU9iamVjdCAtUHJvcGVydHkgIlJlbW90ZVNlcnZlck5hbWUiCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIEdldC1ERlNzaGFyZVYyIHsKICAgICAgICBbQ21kbGV0QmluZGluZygpXQogICAgICAgIHBhcmFtKAogICAgICAgICAgICBbU3RyaW5nXQogICAgICAgICAgICAkRG9tYWluLAoKICAgICAgICAgICAgW1N0cmluZ10KICAgICAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgICAgICBbU3RyaW5nXQogICAgICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICAgICAgW0ludF0KICAgICAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgICAgICRDcmVkZW50aWFsCiAgICAgICAgKQoKICAgICAgICAkREZTc2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwYXRoICRBRFNwYXRoIC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgaWYoJERGU3NlYXJjaGVyKSB7CiAgICAgICAgICAgICRERlNzaGFyZXMgPSBAKCkKICAgICAgICAgICAgJERGU3NlYXJjaGVyLmZpbHRlciA9ICIoJihvYmplY3RDbGFzcz1tc0RGUy1MaW5rdjIpKSIKICAgICAgICAgICAgJERGU1NlYXJjaGVyLlByb3BlcnRpZXNUb0xvYWQuQWRkUmFuZ2UoKCdtc2Rmcy1saW5rcGF0aHYyJywnbXNERlMtVGFyZ2V0TGlzdHYyJykpCgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJFJlc3VsdHMgPSAkREZTU2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gJF8uUHJvcGVydGllcwogICAgICAgICAgICAgICAgICAgICR0YXJnZXRfbGlzdCA9ICRQcm9wZXJ0aWVzLidtc2Rmcy10YXJnZXRsaXN0djInWzBdCiAgICAgICAgICAgICAgICAgICAgJHhtbCA9IFt4bWxdW1N5c3RlbS5UZXh0LkVuY29kaW5nXTo6VW5pY29kZS5HZXRTdHJpbmcoJHRhcmdldF9saXN0WzIuLigkdGFyZ2V0X2xpc3QuTGVuZ3RoLTEpXSkKICAgICAgICAgICAgICAgICAgICAkREZTc2hhcmVzICs9ICR4bWwudGFyZ2V0cy5DaGlsZE5vZGVzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRhcmdldCA9ICRfLklubmVyVGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkVGFyZ2V0LkNvbnRhaW5zKCdcJykgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJERGU3Jvb3QgPSAkVGFyZ2V0LnNwbGl0KCJcIilbM10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkU2hhcmVOYW1lID0gJFByb3BlcnRpZXMuJ21zZGZzLWxpbmtwYXRodjInWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5IEB7J05hbWUnPSIkREZTcm9vdCRTaGFyZU5hbWUiOydSZW1vdGVTZXJ2ZXJOYW1lJz0kVGFyZ2V0LnNwbGl0KCJcIilbMl19CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgaW4gcGFyc2luZyB0YXJnZXQgOiAkXyIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICAgICAgICAgJERGU1NlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkdldC1ERlNzaGFyZVYyIGVycm9yIDogJF8iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJERGU3NoYXJlcyB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgLVByb3BlcnR5ICJSZW1vdGVTZXJ2ZXJOYW1lIgogICAgICAgIH0KICAgIH0KCiAgICAkREZTc2hhcmVzID0gQCgpCgogICAgaWYgKCAoJFZlcnNpb24gLWVxICJhbGwiKSAtb3IgKCRWZXJzaW9uLmVuZHNXaXRoKCIxIikpICkgewogICAgICAgICRERlNzaGFyZXMgKz0gR2V0LURGU3NoYXJlVjEgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwYXRoICRBRFNwYXRoIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgIH0KICAgIGlmICggKCRWZXJzaW9uIC1lcSAiYWxsIikgLW9yICgkVmVyc2lvbi5lbmRzV2l0aCgiMiIpKSApIHsKICAgICAgICAkREZTc2hhcmVzICs9IEdldC1ERlNzaGFyZVYyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcGF0aCAkQURTcGF0aCAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICB9CgogICAgJERGU3NoYXJlcyB8IFNvcnQtT2JqZWN0IC1Qcm9wZXJ0eSAoIlJlbW90ZVNlcnZlck5hbWUiLCJOYW1lIikgLVVuaXF1ZQp9CgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojIEdQTyByZWxhdGVkIGZ1bmN0aW9ucy4KIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZnVuY3Rpb24gR2V0LUdwdFRtcGwgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEhlbHBlciB0byBwYXJzZSBhIEdwdFRtcGwuaW5mIHBvbGljeSBmaWxlIHBhdGggaW50byBhIGN1c3RvbSBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBHcHRUbXBsUGF0aAoKICAgICAgICBUaGUgR3B0VG1wbC5pbmYgZmlsZSBwYXRoIG5hbWUgdG8gcGFyc2UuIAoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IHRoZSB0YXJnZXQgR3B0VG1wbCBmb2xkZXIgcGF0aCBhcyBhIHRlbXBvcmFyeSBQU0RyaXZlLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUdwdFRtcGwgLUdwdFRtcGxQYXRoICJcXGRldi50ZXN0bGFiLmxvY2FsXHN5c3ZvbFxkZXYudGVzdGxhYi5sb2NhbFxQb2xpY2llc1x7MzFCMkYzNDAtMDE2RC0xMUQyLTk0NUYtMDBDMDRGQjk4NEY5fVxNQUNISU5FXE1pY3Jvc29mdFxXaW5kb3dzIE5UXFNlY0VkaXRcR3B0VG1wbC5pbmYiCgogICAgICAgIFBhcnNlIHRoZSBkZWZhdWx0IGRvbWFpbiBwb2xpY3kgLmluZiBmb3IgZGV2LnRlc3RsYWIubG9jYWwKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3B0VG1wbFBhdGgsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVzZVBTRHJpdmUKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgaWYoJFVzZVBTRHJpdmUpIHsKICAgICAgICAgICAgIyBpZiB3ZSdyZSBQU0RyaXZlcywgY3JlYXRlIGEgdGVtcG9yYXJ5IG1vdW50IHBvaW50CiAgICAgICAgICAgICRQYXJ0cyA9ICRHcHRUbXBsUGF0aC5zcGxpdCgnXCcpCiAgICAgICAgICAgICRGb2xkZXJQYXRoID0gJFBhcnRzWzAuLigkUGFydHMubGVuZ3RoLTIpXSAtam9pbiAnXCcKICAgICAgICAgICAgJEZpbGVQYXRoID0gJFBhcnRzWy0xXQogICAgICAgICAgICAkUmFuZERyaXZlID0gKCJhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eiIuVG9DaGFyQXJyYXkoKSB8IEdldC1SYW5kb20gLUNvdW50IDcpIC1qb2luICcnCiAgICAgICAgICAgIAogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJNb3VudGluZyBwYXRoICRHcHRUbXBsUGF0aCB1c2luZyBhIHRlbXAgUFNEcml2ZSBhdCAkUmFuZERyaXZlIgoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICROdWxsID0gTmV3LVBTRHJpdmUgLU5hbWUgJFJhbmREcml2ZSAtUFNQcm92aWRlciBGaWxlU3lzdGVtIC1Sb290ICRGb2xkZXJQYXRoICAtRXJyb3JBY3Rpb24gU3RvcAogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIG1vdW50aW5nIHBhdGggJEdwdFRtcGxQYXRoIDogJF8iCiAgICAgICAgICAgICAgICByZXR1cm4gJE51bGwKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzbyB3ZSBjYW4gY2QvZGlyIHRoZSBuZXcgZHJpdmUKICAgICAgICAgICAgJFRhcmdldEdwdFRtcGxQYXRoID0gJFJhbmREcml2ZSArICI6XCIgKyAkRmlsZVBhdGgKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRUYXJnZXRHcHRUbXBsUGF0aCA9ICRHcHRUbXBsUGF0aAogICAgICAgIH0KICAgICAgICBXcml0ZS1WZXJib3NlICJHcHRUbXBsUGF0aDogJEdwdFRtcGxQYXRoIgogICAgfQoKICAgIHByb2Nlc3MgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlBhcnNpbmcgJFRhcmdldEdwdFRtcGxQYXRoIgogICAgICAgICAgICAkVGFyZ2V0R3B0VG1wbFBhdGggfCBHZXQtSW5pQ29udGVudCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIHBhcnNpbmcgJFRhcmdldEdwdFRtcGxQYXRoIDogJF8iCiAgICAgICAgfQogICAgfQoKICAgIGVuZCB7CiAgICAgICAgaWYoJFVzZVBTRHJpdmUgLWFuZCAkUmFuZERyaXZlKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlJlbW92aW5nIHRlbXAgUFNEcml2ZSAkUmFuZERyaXZlIgogICAgICAgICAgICBHZXQtUFNEcml2ZSAtTmFtZSAkUmFuZERyaXZlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgUmVtb3ZlLVBTRHJpdmUgLUZvcmNlCiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LUdyb3Vwc1hNTCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgSGVscGVyIHRvIHBhcnNlIGEgZ3JvdXBzLnhtbCBmaWxlIHBhdGggaW50byBhIGN1c3RvbSBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBHcm91cHNYTUxwYXRoCgogICAgICAgIFRoZSBncm91cHMueG1sIGZpbGUgcGF0aCBuYW1lIHRvIHBhcnNlLiAKCiAgICAuUEFSQU1FVEVSIFVzZVBTRHJpdmUKCiAgICAgICAgU3dpdGNoLiBNb3VudCB0aGUgdGFyZ2V0IGdyb3Vwcy54bWwgZm9sZGVyIHBhdGggYXMgYSB0ZW1wb3JhcnkgUFNEcml2ZS4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBzWE1MUGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVXNlUFNEcml2ZQogICAgKQoKICAgIGJlZ2luIHsKICAgICAgICBpZigkVXNlUFNEcml2ZSkgewogICAgICAgICAgICAjIGlmIHdlJ3JlIFBTRHJpdmVzLCBjcmVhdGUgYSB0ZW1wb3JhcnkgbW91bnQgcG9pbnQKICAgICAgICAgICAgJFBhcnRzID0gJEdyb3Vwc1hNTFBhdGguc3BsaXQoJ1wnKQogICAgICAgICAgICAkRm9sZGVyUGF0aCA9ICRQYXJ0c1swLi4oJFBhcnRzLmxlbmd0aC0yKV0gLWpvaW4gJ1wnCiAgICAgICAgICAgICRGaWxlUGF0aCA9ICRQYXJ0c1stMV0KICAgICAgICAgICAgJFJhbmREcml2ZSA9ICgiYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoiLlRvQ2hhckFycmF5KCkgfCBHZXQtUmFuZG9tIC1Db3VudCA3KSAtam9pbiAnJwoKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiTW91bnRpbmcgcGF0aCAkR3JvdXBzWE1MUGF0aCB1c2luZyBhIHRlbXAgUFNEcml2ZSBhdCAkUmFuZERyaXZlIgoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICROdWxsID0gTmV3LVBTRHJpdmUgLU5hbWUgJFJhbmREcml2ZSAtUFNQcm92aWRlciBGaWxlU3lzdGVtIC1Sb290ICRGb2xkZXJQYXRoICAtRXJyb3JBY3Rpb24gU3RvcAogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIG1vdW50aW5nIHBhdGggJEdyb3Vwc1hNTFBhdGggOiAkXyIKICAgICAgICAgICAgICAgIHJldHVybiAkTnVsbAogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHNvIHdlIGNhbiBjZC9kaXIgdGhlIG5ldyBkcml2ZQogICAgICAgICAgICAkVGFyZ2V0R3JvdXBzWE1MUGF0aCA9ICRSYW5kRHJpdmUgKyAiOlwiICsgJEZpbGVQYXRoCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkVGFyZ2V0R3JvdXBzWE1MUGF0aCA9ICRHcm91cHNYTUxQYXRoCiAgICAgICAgfQogICAgfQoKICAgIHByb2Nlc3MgewoKICAgICAgICB0cnkgewogICAgICAgICAgICBbWE1MXSRHcm91cHNYTUxjb250ZW50ID0gR2V0LUNvbnRlbnQgJFRhcmdldEdyb3Vwc1hNTFBhdGggLUVycm9yQWN0aW9uIFN0b3AKCiAgICAgICAgICAgICMgcHJvY2VzcyBhbGwgZ3JvdXAgcHJvcGVydGllcyBpbiB0aGUgWE1MCiAgICAgICAgICAgICRHcm91cHNYTUxjb250ZW50IHwgU2VsZWN0LVhtbCAiLy9Hcm91cHMiIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgbm9kZSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICAgICAkR3JvdXBuYW1lID0gJF8uR3JvdXAuUHJvcGVydGllcy5ncm91cE5hbWUKCiAgICAgICAgICAgICAgICAjIGV4dHJhY3QgdGhlIGxvY2FsZ3JvdXAgc2lkIGZvciBtZW1iZXJvZgogICAgICAgICAgICAgICAgJEdyb3VwU0lEID0gJF8uR3JvdXAuUHJvcGVydGllcy5Hcm91cFNpZAogICAgICAgICAgICAgICAgaWYoLW5vdCAkTG9jYWxTaWQpIHsKICAgICAgICAgICAgICAgICAgICBpZigkR3JvdXBuYW1lIC1tYXRjaCAnQWRtaW5pc3RyYXRvcnMnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cFNJRCA9ICdTLTEtNS0zMi01NDQnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2VpZigkR3JvdXBuYW1lIC1tYXRjaCAnUmVtb3RlIERlc2t0b3AnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cFNJRCA9ICdTLTEtNS0zMi01NTUnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2VpZigkR3JvdXBuYW1lIC1tYXRjaCAnR3Vlc3RzJykgewogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBTSUQgPSAnUy0xLTUtMzItNTQ2JwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwU0lEID0gQ29udmVydC1OYW1lVG9TaWQgLU9iamVjdE5hbWUgJEdyb3VwbmFtZSB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IFNJRAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIGV4dHJhY3Qgb3V0IG1lbWJlcnMgYWRkZWQgdG8gdGhpcyBncm91cAogICAgICAgICAgICAgICAgJE1lbWJlcnMgPSAkXy5Hcm91cC5Qcm9wZXJ0aWVzLm1lbWJlcnMgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBNZW1iZXIgfCBXaGVyZS1PYmplY3QgeyAkXy5hY3Rpb24gLW1hdGNoICdBREQnIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgaWYoJF8uc2lkKSB7ICRfLnNpZCB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7ICRfLm5hbWUgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgkTWVtYmVycykgewoKICAgICAgICAgICAgICAgICAgICAjIGV4dHJhY3Qgb3V0IGFueS9hbGwgZmlsdGVycy4uLkkgaGF0ZSB5b3UgR1BQCiAgICAgICAgICAgICAgICAgICAgaWYoJF8uR3JvdXAuZmlsdGVycykgewogICAgICAgICAgICAgICAgICAgICAgICAkRmlsdGVycyA9ICRfLkdyb3VwLmZpbHRlcnMuR2V0RW51bWVyYXRvcigpIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5IEB7J1R5cGUnID0gJF8uTG9jYWxOYW1lOydWYWx1ZScgPSAkXy5uYW1lfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkRmlsdGVycyA9ICROdWxsCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZigkTWVtYmVycyAtaXNub3QgW1N5c3RlbS5BcnJheV0pIHsgJE1lbWJlcnMgPSBAKCRNZW1iZXJzKSB9CgogICAgICAgICAgICAgICAgICAgICRHUE9Hcm91cCA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPUGF0aCcgJFRhcmdldEdyb3Vwc1hNTFBhdGgKICAgICAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRmlsdGVycycgJEZpbHRlcnMKICAgICAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXBOYW1lJyAkR3JvdXBOYW1lCiAgICAgICAgICAgICAgICAgICAgJEdQT0dyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dyb3VwU0lEJyAkR3JvdXBTSUQKICAgICAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXBNZW1iZXJPZicgJE51bGwKICAgICAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXBNZW1iZXJzJyAkTWVtYmVycwogICAgICAgICAgICAgICAgICAgICRHUE9Hcm91cAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgcGFyc2luZyAkVGFyZ2V0R3JvdXBzWE1MUGF0aCA6ICRfIgogICAgICAgIH0KICAgIH0KCiAgICBlbmQgewogICAgICAgIGlmKCRVc2VQU0RyaXZlIC1hbmQgJFJhbmREcml2ZSkgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJSZW1vdmluZyB0ZW1wIFBTRHJpdmUgJFJhbmREcml2ZSIKICAgICAgICAgICAgR2V0LVBTRHJpdmUgLU5hbWUgJFJhbmREcml2ZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IFJlbW92ZS1QU0RyaXZlIC1Gb3JjZQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1OZXRHUE8gewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEdldHMgYSBsaXN0IG9mIGFsbCBjdXJyZW50IEdQT3MgaW4gYSBkb21haW4uCgogICAgLlBBUkFNRVRFUiBHUE9uYW1lCgogICAgICAgIFRoZSBHUE8gbmFtZSB0byBxdWVyeSBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4gICAKCiAgICAuUEFSQU1FVEVSIERpc3BsYXlOYW1lCgogICAgICAgIFRoZSBHUE8gZGlzcGxheSBuYW1lIHRvIHF1ZXJ5IGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLiAgIAoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFJldHVybiBhbGwgR1BPIG9iamVjdHMgYXBwbGllZCB0byBhIGdpdmVuIGNvbXB1dGVyIChGUUROKS4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciBHUE9zLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaAogICAgICAgIGUuZy4gIkxEQVA6Ly9jbj17OEZGNTlEMjgtMTVENy00MjJBLUJDQjctMkFFNDU3MjQxMjVBfSxjbj1wb2xpY2llcyxjbj1zeXN0ZW0sREM9ZGV2LERDPXRlc3RsYWIsREM9bG9jYWwiCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRHUE8gLURvbWFpbiB0ZXN0bGFiLmxvY2FsCiAgICAgICAgCiAgICAgICAgUmV0dXJucyB0aGUgR1BPcyBpbiB0aGUgJ3Rlc3RsYWIubG9jYWwnIGRvbWFpbi4gCiM+CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdQT25hbWUgPSAnKicsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERpc3BsYXlOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlck5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKICAgICAgICAKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgYmVnaW4gewogICAgICAgICRHUE9TZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJEFEU3BhdGggLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgfQoKICAgIHByb2Nlc3MgewogICAgICAgIGlmICgkR1BPU2VhcmNoZXIpIHsKCiAgICAgICAgICAgIGlmKCRDb21wdXRlck5hbWUpIHsKICAgICAgICAgICAgICAgICRHUE9OYW1lcyA9IEAoKQogICAgICAgICAgICAgICAgJENvbXB1dGVycyA9IEdldC1OZXRDb21wdXRlciAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1GdWxsRGF0YSAtUGFnZVNpemUgJFBhZ2VTaXplCgogICAgICAgICAgICAgICAgaWYoISRDb21wdXRlcnMpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyAiQ29tcHV0ZXIgJENvbXB1dGVyTmFtZSBpbiBkb21haW4gJyREb21haW4nIG5vdCBmb3VuZCEgVHJ5IGEgZnVsbHkgcXVhbGlmaWVkIGhvc3QgbmFtZSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBnZXQgdGhlIGdpdmVuIGNvbXB1dGVyJ3MgT1UKICAgICAgICAgICAgICAgICRDb21wdXRlck9VcyA9IEAoKQogICAgICAgICAgICAgICAgRm9yRWFjaCgkQ29tcHV0ZXIgaW4gJENvbXB1dGVycykgewogICAgICAgICAgICAgICAgICAgICMgZXh0cmFjdCBhbGwgT1VzIGEgY29tcHV0ZXIgaXMgYSBwYXJ0IG9mCiAgICAgICAgICAgICAgICAgICAgJEROID0gJENvbXB1dGVyLmRpc3Rpbmd1aXNoZWRuYW1lCgogICAgICAgICAgICAgICAgICAgICRDb21wdXRlck9VcyArPSAkRE4uc3BsaXQoIiwiKSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJF8uc3RhcnRzd2l0aCgiT1U9IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRETi5zdWJzdHJpbmcoJEROLmluZGV4b2YoJF8pKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDb21wdXRlck9VczogJENvbXB1dGVyT1VzIgoKICAgICAgICAgICAgICAgICMgZmluZCBhbGwgdGhlIEdQT3MgbGlua2VkIHRvIHRoZSBjb21wdXRlcidzIE9VCiAgICAgICAgICAgICAgICBGb3JFYWNoKCRDb21wdXRlck9VIGluICRDb21wdXRlck9VcykgewogICAgICAgICAgICAgICAgICAgICRHUE9OYW1lcyArPSBHZXQtTmV0T1UgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1BRFNwYXRoICRDb21wdXRlck9VIC1GdWxsRGF0YSAtUGFnZVNpemUgJFBhZ2VTaXplIHwgRm9yRWFjaC1PYmplY3QgeyAKICAgICAgICAgICAgICAgICAgICAgICAgIyBnZXQgYW55IEdQTyBsaW5rcwogICAgICAgICAgICAgICAgICAgICAgICB3cml0ZS12ZXJib3NlICJibGFoOiAkKCRfLm5hbWUpIgogICAgICAgICAgICAgICAgICAgICAgICAkXy5ncGxpbmsuc3BsaXQoIl1bIikgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF8uc3RhcnRzd2l0aCgiTERBUCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJF8uc3BsaXQoIjsiKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJHUE9OYW1lczogJEdQT05hbWVzIgoKICAgICAgICAgICAgICAgICMgZmluZCBhbnkgR1BPcyBsaW5rZWQgdG8gdGhlIHNpdGUgZm9yIHRoZSBnaXZlbiBjb21wdXRlcgogICAgICAgICAgICAgICAgJENvbXB1dGVyU2l0ZSA9IChHZXQtU2l0ZU5hbWUgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lKS5TaXRlTmFtZQogICAgICAgICAgICAgICAgaWYoJENvbXB1dGVyU2l0ZSAtYW5kICgkQ29tcHV0ZXJTaXRlIC1ub3RsaWtlICdFcnJvcionKSkgewogICAgICAgICAgICAgICAgICAgICRHUE9OYW1lcyArPSBHZXQtTmV0U2l0ZSAtU2l0ZU5hbWUgJENvbXB1dGVyU2l0ZSAtRnVsbERhdGEgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRfLmdwbGluaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJF8uZ3BsaW5rLnNwbGl0KCJdWyIpIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkXy5zdGFydHN3aXRoKCJMREFQIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJF8uc3BsaXQoIjsiKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkR1BPTmFtZXMgfCBXaGVyZS1PYmplY3R7JF8gLWFuZCAoJF8gLW5lICcnKX0gfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgICAgICMgdXNlIHRoZSBncGxpbmsgYXMgYW4gQURTIHBhdGggdG8gZW51bWVyYXRlIGFsbCBHUE9zIGZvciB0aGUgY29tcHV0ZXIKICAgICAgICAgICAgICAgICAgICAkR1BPU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwYXRoICRfIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgICAgICAgICAgICAgICAgICAkR1BPU2VhcmNoZXIuZmlsdGVyPSIoJihvYmplY3RDYXRlZ29yeT1ncm91cFBvbGljeUNvbnRhaW5lcikobmFtZT0kR1BPbmFtZSkpIgoKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0cyA9ICRHUE9TZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRPdXQgPSBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkT3V0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE91dAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICAgICAgICAgICAgICAgICAkR1BPU2VhcmNoZXIuZGlzcG9zZSgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtV2FybmluZyAkXwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZigkRGlzcGxheU5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAkR1BPU2VhcmNoZXIuZmlsdGVyPSIoJihvYmplY3RDYXRlZ29yeT1ncm91cFBvbGljeUNvbnRhaW5lcikoZGlzcGxheW5hbWU9JERpc3BsYXlOYW1lKSkiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkR1BPU2VhcmNoZXIuZmlsdGVyPSIoJihvYmplY3RDYXRlZ29yeT1ncm91cFBvbGljeUNvbnRhaW5lcikobmFtZT0kR1BPbmFtZSkpIgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdHMgPSAkR1BPU2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJEFEU1BhdGggLWFuZCAoJEFEU3BhdGggLU1hdGNoICdeR0M6Ly8nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgPSBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHUE9ETiA9ICRQcm9wZXJ0aWVzLmRpc3Rpbmd1aXNoZWRuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdQT0RvbWFpbiA9ICRHUE9ETi5zdWJTdHJpbmcoJEdQT0ROLkluZGV4T2YoIkRDPSIpKSAtcmVwbGFjZSAnREM9JywnJyAtcmVwbGFjZSAnLCcsJy4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGdwY2ZpbGVzeXNwYXRoID0gIlxcJEdQT0RvbWFpblxTeXNWb2xcJEdQT0RvbWFpblxQb2xpY2llc1wkKCRQcm9wZXJ0aWVzLmNuKSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUHJvcGVydGllcyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdncGNmaWxlc3lzcGF0aCcgJGdwY2ZpbGVzeXNwYXRoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUHJvcGVydGllcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0L3Byb2Nlc3MgdGhlIExEQVAgZmllbGRzIGZvciBlYWNoIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29udmVydC1MREFQUHJvcGVydHkgLVByb3BlcnRpZXMgJF8uUHJvcGVydGllcwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICAgICAgICAgICAgICRHUE9TZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICRfCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBOZXctR1BPSW1tZWRpYXRlVGFzayB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQnVpbGRzIGFuICdJbW1lZGlhdGUnIHNjaHRhc2sgdG8gcHVzaCBvdXQgdGhyb3VnaCBhIHNwZWNpZmllZCBHUE8uCgogICAgLlBBUkFNRVRFUiBUYXNrTmFtZQoKICAgICAgICBOYW1lIGZvciB0aGUgc2NodGFzayB0byByZWNyZWF0ZS4gUmVxdWlyZWQuCgogICAgLlBBUkFNRVRFUiBDb21tYW5kCgogICAgICAgIFRoZSBjb21tYW5kIHRvIGV4ZWN1dGUgd2l0aCB0aGUgdGFzaywgZGVmYXVsdHMgdG8gJ3Bvd2Vyc2hlbGwnCgogICAgLlBBUkFNRVRFUiBDb21tYW5kQXJndW1lbnRzCgogICAgICAgIFRoZSBhcmd1bWVudHMgdG8gc3VwcGx5IHRvIHRoZSAtQ29tbWFuZCBiZWluZyBsYXVuY2hlZC4KCiAgICAuUEFSQU1FVEVSIFRhc2tEZXNjcmlwdGlvbgoKICAgICAgICBBbiBvcHRpb25hbCBkZXNjcmlwdGlvbiBmb3IgdGhlIHRhc2suCgogICAgLlBBUkFNRVRFUiBUYXNrQXV0aG9yCiAgICAgICAgCiAgICAgICAgVGhlIGRpc3BsYXllZCBhdXRob3Igb2YgdGhlIHRhc2ssIGRlZmF1bHRzIHRvICcnTlQgQVVUSE9SSVRZXFN5c3RlbScKCiAgICAuUEFSQU1FVEVSIFRhc2tNb2RpZmllZERhdGUKICAgIAogICAgICAgIFRoZSBkaXNwbGF5ZWQgbW9kaWZpZWQgZGF0ZSBmb3IgdGhlIHRhc2ssIGRlZmF1bHRzIHRvIDMwIGRheXMgYWdvLgoKICAgIC5QQVJBTUVURVIgR1BPbmFtZQoKICAgICAgICBUaGUgR1BPIG5hbWUgdG8gYnVpbGQgdGhlIHRhc2sgZm9yLgoKICAgIC5QQVJBTUVURVIgR1BPRGlzcGxheU5hbWUKCiAgICAgICAgVGhlIEdQTyBkaXNwbGF5IG5hbWUgdG8gYnVpbGQgdGhlIHRhc2sgZm9yLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHRoZSBHUE9zLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaAogICAgICAgIGUuZy4gIkxEQVA6Ly9jbj17OEZGNTlEMjgtMTVENy00MjJBLUJDQjctMkFFNDU3MjQxMjVBfSxjbj1wb2xpY2llcyxjbj1zeXN0ZW0sREM9ZGV2LERDPXRlc3RsYWIsREM9bG9jYWwiCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTPiBOZXctR1BPSW1tZWRpYXRlVGFzayAtVGFza05hbWUgRGVidWdnaW5nIC1HUE9EaXNwbGF5TmFtZSBTZWN1cmVQb2xpY3kgLUNvbW1hbmRBcmd1bWVudHMgJy1jICIxMjMgfCBPdXQtRmlsZSBDOlxUZW1wXGRlYnVnLnR4dCInIC1Gb3JjZQoKICAgICAgICBDcmVhdGUgYW4gaW1tZWRpYXRlIHNjaHRhc2sgdGhhdCBleGVjdXRlcyB0aGUgc3BlY2lmaWVkIFBvd2VyU2hlbGwgYXJndW1lbnRzIGFuZAogICAgICAgIHB1c2ggaXQgb3V0IHRvIHRoZSAnU2VjdXJlUG9saWN5JyBHUE8sIHNraXBwaW5nIHRoZSBjb25maXJtYXRpb24gcHJvbXB0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTPiBOZXctR1BPSW1tZWRpYXRlVGFzayAtR1BPRGlzcGxheU5hbWUgU2VjdXJlUG9saWN5IC1SZW1vdmUgLUZvcmNlCgogICAgICAgIFJlbW92ZSBhbGwgc2NodGFza3MgZnJvbSB0aGUgJ1NlY3VyZVBvbGljeScgR1BPLCBza2lwcGluZyB0aGUgY29uZmlybWF0aW9uIHByb21wdC4KIz4KICAgIFtDbWRsZXRCaW5kaW5nKERlZmF1bHRQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnLCBNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRUYXNrTmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkQ29tbWFuZCA9ICdwb3dlcnNoZWxsJywKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkQ29tbWFuZEFyZ3VtZW50cywKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkVGFza0Rlc2NyaXB0aW9uID0gJycsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJFRhc2tBdXRob3IgPSAnTlQgQVVUSE9SSVRZXFN5c3RlbScsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJFRhc2tNb2RpZmllZERhdGUgPSAoR2V0LURhdGUgKEdldC1EYXRlKS5BZGREYXlzKC0zMCkgLUZvcm1hdCB1KS50cmltKCJaIiksCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnKV0KICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnUmVtb3ZlJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR1BPbmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScpXQogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdSZW1vdmUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRHUE9EaXNwbGF5TmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScpXQogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdSZW1vdmUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnKV0KICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnUmVtb3ZlJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKICAgICAgICAKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQ3JlYXRlJyldCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ1JlbW92ZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnKV0KICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnUmVtb3ZlJyldCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRm9yY2UsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdSZW1vdmUnKV0KICAgICAgICBbU3dpdGNoXQogICAgICAgICRSZW1vdmUsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnKV0KICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnUmVtb3ZlJyldICAgICAgICAKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgICMgYnVpbGQgdGhlIFhNTCBzcGVjIGZvciBvdXIgJ2ltbWVkaWF0ZScgc2NoZWR1bGVkIHRhc2sKICAgICRUYXNrWE1MID0gJzw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9InV0Zi04Ij8+PFNjaGVkdWxlZFRhc2tzIGNsc2lkPSJ7Q0M2M0YyMDAtNzMwOS00YmEwLUIxNTQtQTcxQ0QxMThEQkNDfSI+PEltbWVkaWF0ZVRhc2tWMiBjbHNpZD0iezk3NTZCNTgxLTc2RUMtNDE2OS05QUZDLTBDQThENDNBREI1Rn0iIG5hbWU9IicrJFRhc2tOYW1lKyciIGltYWdlPSIwIiBjaGFuZ2VkPSInKyRUYXNrTW9kaWZpZWREYXRlKyciIHVpZD0ieycrJChbZ3VpZF06Ok5ld0d1aWQoKSkrJ30iIHVzZXJDb250ZXh0PSIwIiByZW1vdmVQb2xpY3k9IjAiPjxQcm9wZXJ0aWVzIGFjdGlvbj0iQyIgbmFtZT0iJyskVGFza05hbWUrJyIgcnVuQXM9Ik5UIEFVVEhPUklUWVxTeXN0ZW0iIGxvZ29uVHlwZT0iUzRVIj48VGFzayB2ZXJzaW9uPSIxLjMiPjxSZWdpc3RyYXRpb25JbmZvPjxBdXRob3I+JyskVGFza0F1dGhvcisnPC9BdXRob3I+PERlc2NyaXB0aW9uPicrJFRhc2tEZXNjcmlwdGlvbisnPC9EZXNjcmlwdGlvbj48L1JlZ2lzdHJhdGlvbkluZm8+PFByaW5jaXBhbHM+PFByaW5jaXBhbCBpZD0iQXV0aG9yIj48VXNlcklkPk5UIEFVVEhPUklUWVxTeXN0ZW08L1VzZXJJZD48UnVuTGV2ZWw+SGlnaGVzdEF2YWlsYWJsZTwvUnVuTGV2ZWw+PExvZ29uVHlwZT5TNFU8L0xvZ29uVHlwZT48L1ByaW5jaXBhbD48L1ByaW5jaXBhbHM+PFNldHRpbmdzPjxJZGxlU2V0dGluZ3M+PER1cmF0aW9uPlBUMTBNPC9EdXJhdGlvbj48V2FpdFRpbWVvdXQ+UFQxSDwvV2FpdFRpbWVvdXQ+PFN0b3BPbklkbGVFbmQ+dHJ1ZTwvU3RvcE9uSWRsZUVuZD48UmVzdGFydE9uSWRsZT5mYWxzZTwvUmVzdGFydE9uSWRsZT48L0lkbGVTZXR0aW5ncz48TXVsdGlwbGVJbnN0YW5jZXNQb2xpY3k+SWdub3JlTmV3PC9NdWx0aXBsZUluc3RhbmNlc1BvbGljeT48RGlzYWxsb3dTdGFydElmT25CYXR0ZXJpZXM+ZmFsc2U8L0Rpc2FsbG93U3RhcnRJZk9uQmF0dGVyaWVzPjxTdG9wSWZHb2luZ09uQmF0dGVyaWVzPnRydWU8L1N0b3BJZkdvaW5nT25CYXR0ZXJpZXM+PEFsbG93SGFyZFRlcm1pbmF0ZT5mYWxzZTwvQWxsb3dIYXJkVGVybWluYXRlPjxTdGFydFdoZW5BdmFpbGFibGU+dHJ1ZTwvU3RhcnRXaGVuQXZhaWxhYmxlPjxBbGxvd1N0YXJ0T25EZW1hbmQ+ZmFsc2U8L0FsbG93U3RhcnRPbkRlbWFuZD48RW5hYmxlZD50cnVlPC9FbmFibGVkPjxIaWRkZW4+dHJ1ZTwvSGlkZGVuPjxFeGVjdXRpb25UaW1lTGltaXQ+UFQwUzwvRXhlY3V0aW9uVGltZUxpbWl0PjxQcmlvcml0eT43PC9Qcmlvcml0eT48RGVsZXRlRXhwaXJlZFRhc2tBZnRlcj5QVDBTPC9EZWxldGVFeHBpcmVkVGFza0FmdGVyPjxSZXN0YXJ0T25GYWlsdXJlPjxJbnRlcnZhbD5QVDE1TTwvSW50ZXJ2YWw+PENvdW50PjM8L0NvdW50PjwvUmVzdGFydE9uRmFpbHVyZT48L1NldHRpbmdzPjxBY3Rpb25zIENvbnRleHQ9IkF1dGhvciI+PEV4ZWM+PENvbW1hbmQ+JyskQ29tbWFuZCsnPC9Db21tYW5kPjxBcmd1bWVudHM+JyskQ29tbWFuZEFyZ3VtZW50cysnPC9Bcmd1bWVudHM+PC9FeGVjPjwvQWN0aW9ucz48VHJpZ2dlcnM+PFRpbWVUcmlnZ2VyPjxTdGFydEJvdW5kYXJ5PiVMb2NhbFRpbWVYbWxFeCU8L1N0YXJ0Qm91bmRhcnk+PEVuZEJvdW5kYXJ5PiVMb2NhbFRpbWVYbWxFeCU8L0VuZEJvdW5kYXJ5PjxFbmFibGVkPnRydWU8L0VuYWJsZWQ+PC9UaW1lVHJpZ2dlcj48L1RyaWdnZXJzPjwvVGFzaz48L1Byb3BlcnRpZXM+PC9JbW1lZGlhdGVUYXNrVjI+PC9TY2hlZHVsZWRUYXNrcz4nCgogICAgaWYgKCEkUFNCb3VuZFBhcmFtZXRlcnNbJ0dQT25hbWUnXSAtYW5kICEkUFNCb3VuZFBhcmFtZXRlcnNbJ0dQT0Rpc3BsYXlOYW1lJ10pIHsKICAgICAgICBXcml0ZS1XYXJuaW5nICdFaXRoZXIgLUdQT05hbWUgb3IgLUdQT0Rpc3BsYXlOYW1lIG11c3QgYmUgc3BlY2lmaWVkJwogICAgICAgIHJldHVybgogICAgfQoKICAgICMgZXVubWVyYXRlIHRoZSBzcGVjaWZpZWQgR1BPKHMpCiAgICAkR1BPcyA9IEdldC1OZXRHUE8gLUdQT25hbWUgJEdQT25hbWUgLURpc3BsYXlOYW1lICRHUE9EaXNwbGF5TmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUFEU3BhdGggJEFEU3BhdGggLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgCiAgICAKICAgIGlmKCEkR1BPcykgewogICAgICAgIFdyaXRlLVdhcm5pbmcgJ05vIEdQTyBmb3VuZC4nCiAgICAgICAgcmV0dXJuCiAgICB9CgogICAgJEdQT3MgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgJFByb2Nlc3NlZEdQT05hbWUgPSAkXy5OYW1lCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVHJ5aW5nIHRvIHdlYXBvbml6ZSBHUE86ICRQcm9jZXNzZWRHUE9OYW1lIgoKICAgICAgICAgICAgIyBtYXAgYSBuZXR3b3JrIGRyaXZlIGFzIE5ldy1QU0RyaXZlL05ldy1JdGVtL2V0Yy4gZG9uJ3QgYWNjZXB0IC1DcmVkZW50aWFsIHByb3Blcmx5IDooCiAgICAgICAgICAgIGlmKCRDcmVkZW50aWFsKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJNYXBwaW5nICckKCRfLmdwY2ZpbGVzeXNwYXRoKScgdG8gbmV0d29yayBkcml2ZSBOOlwiCiAgICAgICAgICAgICAgICAkUGF0aCA9ICRfLmdwY2ZpbGVzeXNwYXRoLlRyaW1FbmQoJ1wnKQogICAgICAgICAgICAgICAgJE5ldCA9IE5ldy1PYmplY3QgLUNvbU9iamVjdCBXU2NyaXB0Lk5ldHdvcmsKICAgICAgICAgICAgICAgICROZXQuTWFwTmV0d29ya0RyaXZlKCJOOiIsICRQYXRoLCAkRmFsc2UsICRDcmVkZW50aWFsLlVzZXJOYW1lLCAkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLlBhc3N3b3JkKQogICAgICAgICAgICAgICAgJFRhc2tQYXRoID0gIk46XE1hY2hpbmVcUHJlZmVyZW5jZXNcU2NoZWR1bGVkVGFza3NcIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFRhc2tQYXRoID0gJF8uZ3BjZmlsZXN5c3BhdGggKyAiXE1hY2hpbmVcUHJlZmVyZW5jZXNcU2NoZWR1bGVkVGFza3NcIgogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkUmVtb3ZlKSB7CiAgICAgICAgICAgICAgICBpZighKFRlc3QtUGF0aCAiJFRhc2tQYXRoXFNjaGVkdWxlZFRhc2tzLnhtbCIpKSB7CiAgICAgICAgICAgICAgICAgICAgVGhyb3cgIlNjaGVkdWxlZCB0YXNrIGRvZXNuJ3QgZXhpc3QgYXQgJFRhc2tQYXRoXFNjaGVkdWxlZFRhc2tzLnhtbCIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoISRGb3JjZSAtYW5kICEkcHNDbWRsZXQuU2hvdWxkQ29udGludWUoJ0RvIHlvdSB3YW50IHRvIGNvbnRpbnVlPycsIlJlbW92aW5nIHNjaHRhc2sgYXQgJFRhc2tQYXRoXFNjaGVkdWxlZFRhc2tzLnhtbCIpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgUmVtb3ZlLUl0ZW0gLVBhdGggIiRUYXNrUGF0aFxTY2hlZHVsZWRUYXNrcy54bWwiIC1Gb3JjZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCEkRm9yY2UgLWFuZCAhJHBzQ21kbGV0LlNob3VsZENvbnRpbnVlKCdEbyB5b3Ugd2FudCB0byBjb250aW51ZT8nLCJDcmVhdGluZyBzY2h0YXNrIGF0ICRUYXNrUGF0aFxTY2hlZHVsZWRUYXNrcy54bWwiKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIGNyZWF0ZSB0aGUgZm9sZGVyIGlmIGl0IGRvZXNuJ3QgZXhpc3QKICAgICAgICAgICAgICAgICROdWxsID0gTmV3LUl0ZW0gLUl0ZW1UeXBlIERpcmVjdG9yeSAtRm9yY2UgLVBhdGggJFRhc2tQYXRoCgogICAgICAgICAgICAgICAgaWYoVGVzdC1QYXRoICIkVGFza1BhdGhcU2NoZWR1bGVkVGFza3MueG1sIikgewogICAgICAgICAgICAgICAgICAgIFRocm93ICJTY2hlZHVsZWQgdGFzayBhbHJlYWR5IGV4aXN0cyBhdCAkVGFza1BhdGhcU2NoZWR1bGVkVGFza3MueG1sICEiCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJFRhc2tYTUwgfCBTZXQtQ29udGVudCAtRW5jb2RpbmcgQVNDSUkgLVBhdGggIiRUYXNrUGF0aFxTY2hlZHVsZWRUYXNrcy54bWwiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCRDcmVkZW50aWFsKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJSZW1vdmluZyBtb3VudGVkIGRyaXZlIGF0IE46XCIKICAgICAgICAgICAgICAgICROZXQgPSBOZXctT2JqZWN0IC1Db21PYmplY3QgV1NjcmlwdC5OZXR3b3JrCiAgICAgICAgICAgICAgICAkTmV0LlJlbW92ZU5ldHdvcmtEcml2ZSgiTjoiKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiRXJyb3IgZm9yIEdQTyAkUHJvY2Vzc2VkR1BPTmFtZSA6ICRfIgogICAgICAgICAgICBpZigkQ3JlZGVudGlhbCkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiUmVtb3ZpbmcgbW91bnRlZCBkcml2ZSBhdCBOOlwiCiAgICAgICAgICAgICAgICAkTmV0ID0gTmV3LU9iamVjdCAtQ29tT2JqZWN0IFdTY3JpcHQuTmV0d29yawogICAgICAgICAgICAgICAgJE5ldC5SZW1vdmVOZXR3b3JrRHJpdmUoIk46IikKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1OZXRHUE9Hcm91cCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUmV0dXJucyBhbGwgR1BPcyBpbiBhIGRvbWFpbiB0aGF0IHNldCAiUmVzdHJpY3RlZCBHcm91cHMiIG9yIHVzZSBncm91cHMueG1sIG9uIG9uIHRhcmdldCBtYWNoaW5lcy4KCiAgICAgICAgQXV0aG9yOiBAaGFybWoweQogICAgICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgICAgIFJlcXVpcmVkIERlcGVuZGVuY2llczogR2V0LU5ldEdQTywgR2V0LUdwdFRtcGwsIEdldC1Hcm91cHNYTUwsIENvbnZlcnQtTmFtZVRvU2lkLCBDb252ZXJ0LVNpZFRvTmFtZQogICAgICAgIE9wdGlvbmFsIERlcGVuZGVuY2llczogTm9uZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICAgICAgRmlyc3QgZW51bWVyYXRlcyBhbGwgR1BPcyBpbiB0aGUgY3VycmVudC90YXJnZXQgZG9tYWluIHVzaW5nIEdldC1OZXRHUE8gd2l0aCBwYXNzZWQKICAgICAgICBhcmd1bWVudHMsIGFuZCBmb3IgZWFjaCBHUE8gY2hlY2tzIGlmICdSZXN0cmljdGVkIEdyb3VwcycgYXJlIHNldCB3aXRoIEdwdFRtcGwuaW5mIG9yCiAgICAgICAgZ3JvdXAgbWVtYmVyc2hpcCBpcyBzZXQgdGhyb3VnaCBHcm91cCBQb2xpY3kgUHJlZmVyZW5jZXMgZ3JvdXBzLnhtbCBmaWxlcy4gRm9yIGFueQogICAgICAgIEdwdFRtcGwuaW5mIGZpbGVzIGZvdW5kLCB0aGUgZmlsZSBpcyBwYXJzZWQgd2l0aCBHZXQtR3B0VG1wbCBhbmQgYW55ICdHcm91cCBNZW1iZXJzaGlwJwogICAgICAgIHNlY3Rpb24gZGF0YSBpcyBwcm9jZXNzZWQgaWYgcHJlc2VudC4gQW55IGZvdW5kIEdyb3Vwcy54bWwgZmlsZXMgYXJlIHBhcnNlZCB3aXRoCiAgICAgICAgR2V0LUdyb3Vwc1hNTCBhbmQgdGhvc2UgbWVtYmVyc2hpcHMgYXJlIHJldHVybmVkIGFzIHdlbGwuCgogICAgLlBBUkFNRVRFUiBHUE9uYW1lCgogICAgICAgIFRoZSBHUE8gbmFtZSB0byBxdWVyeSBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4gICAKCiAgICAuUEFSQU1FVEVSIERpc3BsYXlOYW1lCgogICAgICAgIFRoZSBHUE8gZGlzcGxheSBuYW1lIHRvIHF1ZXJ5IGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLiAgIAoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIEdQT3MsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoIGZvciBHUE9zLgogICAgICAgIGUuZy4gIkxEQVA6Ly9jbj17OEZGNTlEMjgtMTVENy00MjJBLUJDQjctMkFFNDU3MjQxMjVBfSxjbj1wb2xpY2llcyxjbj1zeXN0ZW0sREM9ZGV2LERDPXRlc3RsYWIsREM9bG9jYWwiCgogICAgLlBBUkFNRVRFUiBSZXNvbHZlTWVtYmVyU0lEcwoKICAgICAgICBTd2l0Y2guIFRyeSB0byByZXNvbHZlIHRoZSBTSURzIG9mIGFsbCBmb3VuZCBncm91cCBtZW1iZXJzLgoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IGFueSBmb3VuZCBwb2xpY3kgZmlsZXMgd2l0aCB0ZW1wb3JhcnkgUFNEcml2ZXMuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0R1BPR3JvdXAKCiAgICAgICAgUmV0dXJucyBhbGwgbG9jYWwgZ3JvdXBzIHNldCBieSBHUE8gYWxvbmcgd2l0aCB0aGVpciBtZW1iZXJzIGFuZCBtZW1iZXJvZi4KCiAgICAuTElOSwoKICAgICAgICBodHRwczovL21vcmdhbnNpbW9uc2VuYmxvZy5henVyZXdlYnNpdGVzLm5ldC90YWcvZ3JvdXBzLwojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR1BPbmFtZSA9ICcqJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRGlzcGxheU5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkUmVzb2x2ZU1lbWJlclNJRHMsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVzZVBTRHJpdmUsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMAogICAgKQoKICAgICRPcHRpb24gPSBbU3lzdGVtLlN0cmluZ1NwbGl0T3B0aW9uc106OlJlbW92ZUVtcHR5RW50cmllcwoKICAgICMgZ2V0IGV2ZXJ5IEdQTyBmcm9tIHRoZSBzcGVjaWZpZWQgZG9tYWluIHdpdGggcmVzdHJpY3RlZCBncm91cHMgc2V0CiAgICBHZXQtTmV0R1BPIC1HUE9OYW1lICRHUE9uYW1lIC1EaXNwbGF5TmFtZSAkR1BPbmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUFEU3BhdGggJEFEU3BhdGggLVBhZ2VTaXplICRQYWdlU2l6ZSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgJEdQT2Rpc3BsYXlOYW1lID0gJF8uZGlzcGxheW5hbWUKICAgICAgICAkR1BPbmFtZSA9ICRfLm5hbWUKICAgICAgICAkR1BPUGF0aCA9ICRfLmdwY2ZpbGVzeXNwYXRoCgogICAgICAgICRQYXJzZUFyZ3MgPSAgQHsKICAgICAgICAgICAgJ0dwdFRtcGxQYXRoJyA9ICIkR1BPUGF0aFxNQUNISU5FXE1pY3Jvc29mdFxXaW5kb3dzIE5UXFNlY0VkaXRcR3B0VG1wbC5pbmYiCiAgICAgICAgICAgICdVc2VQU0RyaXZlJyA9ICRVc2VQU0RyaXZlCiAgICAgICAgfQoKICAgICAgICAjIHBhcnNlIHRoZSBHcHRUbXBsLmluZiAnUmVzdHJpY3RlZCBHcm91cHMnIGZpbGUgaWYgaXQgZXhpc3RzCiAgICAgICAgJEluZiA9IEdldC1HcHRUbXBsIEBQYXJzZUFyZ3MKCiAgICAgICAgaWYoJEluZiAtYW5kICgkSW5mLnBzYmFzZS5LZXlzIC1jb250YWlucyAnR3JvdXAgTWVtYmVyc2hpcCcpKSB7CgogICAgICAgICAgICAkTWVtYmVyc2hpcHMgPSBAe30KCiAgICAgICAgICAgICMgZ3JvdXAgdGhlIG1lbWJlcnMvbWVtYmVyb2YgZmllbGRzIGZvciBlYWNoIGVudHJ5CiAgICAgICAgICAgIEZvckVhY2ggKCRNZW1iZXJzaGlwIGluICRJbmYuJ0dyb3VwIE1lbWJlcnNoaXAnLkdldEVudW1lcmF0b3IoKSkgewogICAgICAgICAgICAgICAgJEdyb3VwLCAkUmVsYXRpb24gPSAkTWVtYmVyc2hpcC5LZXkuU3BsaXQoJ19fJywgJE9wdGlvbikgfCBGb3JFYWNoLU9iamVjdCB7JF8uVHJpbSgpfQoKICAgICAgICAgICAgICAgICMgZXh0cmFjdCBvdXQgQUxMIG1lbWJlcnMKICAgICAgICAgICAgICAgICRNZW1iZXJzaGlwVmFsdWUgPSAkTWVtYmVyc2hpcC5WYWx1ZSB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgeyAkXy5UcmltKCcqJykgfSB8IFdoZXJlLU9iamVjdCB7JF99CgogICAgICAgICAgICAgICAgaWYoJFJlc29sdmVNZW1iZXJTSURzKSB7CiAgICAgICAgICAgICAgICAgICAgIyBpZiB0aGUgcmVzdWx0aW5nIG1lbWJlciBpcyB1c2VybmFtZSBhbmQgbm90IGEgU0lELCBhdHRlbXB0IHRvIHJlc29sdmUgaXQKICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXJzID0gQCgpCiAgICAgICAgICAgICAgICAgICAgRm9yRWFjaCgkTWVtYmVyIGluICRNZW1iZXJzaGlwVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJE1lbWJlciAtYW5kICgkTWVtYmVyLlRyaW0oKSAtbmUgJycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkTWVtYmVyIC1ub3RtYXRjaCAnXlMtMS0uKicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyU0lEID0gQ29udmVydC1OYW1lVG9TaWQgLURvbWFpbiAkRG9tYWluIC1PYmplY3ROYW1lICRNZW1iZXIgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBTSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkTWVtYmVyU0lEKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlcnMgKz0gJE1lbWJlclNJRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVycyArPSAkTWVtYmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVycyArPSAkTWVtYmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJE1lbWJlcnNoaXBWYWx1ZSA9ICRHcm91cE1lbWJlcnMKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigtbm90ICRNZW1iZXJzaGlwc1skR3JvdXBdKSB7CiAgICAgICAgICAgICAgICAgICAgJE1lbWJlcnNoaXBzWyRHcm91cF0gPSBAe30KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCRNZW1iZXJzaGlwVmFsdWUgLWlzbm90IFtTeXN0ZW0uQXJyYXldKSB7JE1lbWJlcnNoaXBWYWx1ZSA9IEAoJE1lbWJlcnNoaXBWYWx1ZSl9CiAgICAgICAgICAgICAgICAkTWVtYmVyc2hpcHNbJEdyb3VwXS5BZGQoJFJlbGF0aW9uLCAkTWVtYmVyc2hpcFZhbHVlKQogICAgICAgICAgICB9CgogICAgICAgICAgICBGb3JFYWNoICgkTWVtYmVyc2hpcCBpbiAkTWVtYmVyc2hpcHMuR2V0RW51bWVyYXRvcigpKSB7CiAgICAgICAgICAgICAgICBpZigkTWVtYmVyc2hpcCAtYW5kICRNZW1iZXJzaGlwLktleSAtYW5kICgkTWVtYmVyc2hpcC5LZXkgLW1hdGNoICdeXConKSkgewogICAgICAgICAgICAgICAgICAgICMgaWYgdGhlIFNJRCBpcyBhbHJlYWR5IHJlc29sdmVkIChpLmUuIGJlZ2lucyB3aXRoICopIHRyeSB0byByZXNvbHZlIFNJRCB0byBhIG5hbWUKICAgICAgICAgICAgICAgICAgICAkR3JvdXBTSUQgPSAkTWVtYmVyc2hpcC5LZXkuVHJpbSgnKicpCiAgICAgICAgICAgICAgICAgICAgaWYoJEdyb3VwU0lEIC1hbmQgKCRHcm91cFNJRC5UcmltKCkgLW5lICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBOYW1lID0gQ29udmVydC1TaWRUb05hbWUgLVNJRCAkR3JvdXBTSUQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cE5hbWUgPSAkRmFsc2UKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkR3JvdXBOYW1lID0gJE1lbWJlcnNoaXAuS2V5CgogICAgICAgICAgICAgICAgICAgIGlmKCRHcm91cE5hbWUgLWFuZCAoJEdyb3VwTmFtZS5UcmltKCkgLW5lICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZigkR3JvdXBuYW1lIC1tYXRjaCAnQWRtaW5pc3RyYXRvcnMnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBTSUQgPSAnUy0xLTUtMzItNTQ0JwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZigkR3JvdXBuYW1lIC1tYXRjaCAnUmVtb3RlIERlc2t0b3AnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBTSUQgPSAnUy0xLTUtMzItNTU1JwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZigkR3JvdXBuYW1lIC1tYXRjaCAnR3Vlc3RzJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwU0lEID0gJ1MtMS01LTMyLTU0NicKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYoJEdyb3VwTmFtZS5UcmltKCkgLW5lICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBTSUQgPSBDb252ZXJ0LU5hbWVUb1NpZCAtRG9tYWluICREb21haW4gLU9iamVjdE5hbWUgJEdyb3VwbmFtZSB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IFNJRAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwU0lEID0gJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkR1BPR3JvdXAgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPRGlzcGxheU5hbWUnICRHUE9EaXNwbGF5TmFtZQogICAgICAgICAgICAgICAgJEdQT0dyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT05hbWUnICRHUE9OYW1lCiAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPUGF0aCcgJEdQT1BhdGgKICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9UeXBlJyAnUmVzdHJpY3RlZEdyb3VwcycKICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdGaWx0ZXJzJyAkTnVsbAogICAgICAgICAgICAgICAgJEdQT0dyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dyb3VwTmFtZScgJEdyb3VwTmFtZQogICAgICAgICAgICAgICAgJEdQT0dyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dyb3VwU0lEJyAkR3JvdXBTSUQKICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cE1lbWJlck9mJyAkTWVtYmVyc2hpcC5WYWx1ZS5NZW1iZXJvZgogICAgICAgICAgICAgICAgJEdQT0dyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dyb3VwTWVtYmVycycgJE1lbWJlcnNoaXAuVmFsdWUuTWVtYmVycwogICAgICAgICAgICAgICAgJEdQT0dyb3VwCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRQYXJzZUFyZ3MgPSAgQHsKICAgICAgICAgICAgJ0dyb3Vwc1hNTHBhdGgnID0gIiRHUE9QYXRoXE1BQ0hJTkVcUHJlZmVyZW5jZXNcR3JvdXBzXEdyb3Vwcy54bWwiCiAgICAgICAgICAgICdVc2VQU0RyaXZlJyA9ICRVc2VQU0RyaXZlCiAgICAgICAgfQoKICAgICAgICBHZXQtR3JvdXBzWE1MIEBQYXJzZUFyZ3MgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIGlmKCRSZXNvbHZlTWVtYmVyU0lEcykgewogICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVycyA9IEAoKQogICAgICAgICAgICAgICAgRm9yRWFjaCgkTWVtYmVyIGluICRfLkdyb3VwTWVtYmVycykgewogICAgICAgICAgICAgICAgICAgIGlmKCRNZW1iZXIgLWFuZCAoJE1lbWJlci5UcmltKCkgLW5lICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZigkTWVtYmVyIC1ub3RtYXRjaCAnXlMtMS0uKicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgdGhlIHJlc3VsdGluZyBtZW1iZXIgaXMgdXNlcm5hbWUgYW5kIG5vdCBhIFNJRCwgYXR0ZW1wdCB0byByZXNvbHZlIGl0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyU0lEID0gQ29udmVydC1OYW1lVG9TaWQgLURvbWFpbiAkRG9tYWluIC1PYmplY3ROYW1lICRNZW1iZXIgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBTSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRNZW1iZXJTSUQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXJzICs9ICRNZW1iZXJTSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlcnMgKz0gJE1lbWJlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVycyArPSAkTWVtYmVyCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkXy5Hcm91cE1lbWJlcnMgPSAkR3JvdXBNZW1iZXJzCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRfIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0Rpc3BsYXlOYW1lJyAkR1BPRGlzcGxheU5hbWUKICAgICAgICAgICAgJF8gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPTmFtZScgJEdQT05hbWUKICAgICAgICAgICAgJF8gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPVHlwZScgJ0dyb3VwUG9saWN5UHJlZmVyZW5jZXMnCiAgICAgICAgICAgICRfCiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gRmluZC1HUE9Mb2NhdGlvbiB7CjwjCiAgICAuU1lOT1BTSVMKICAgICAgICAKICAgICAgICBFbnVtZXJhdGVzIHRoZSBtYWNoaW5lcyB3aGVyZSBhIHNwZWNpZmljIHVzZXIvZ3JvdXAgaXMgYSBtZW1iZXIgb2YgYSBzcGVjaWZpYwogICAgICAgIGxvY2FsIGdyb3VwLCBhbGwgdGhyb3VnaCBHUE8gY29ycmVsYXRpb24uIAoKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAgICAgUmVxdWlyZWQgRGVwZW5kZW5jaWVzOiBHZXQtTmV0VXNlciwgR2V0LU5ldEdyb3VwLCBHZXQtTmV0R1BPR3JvdXAsIEdldC1OZXRPVSwgR2V0LU5ldENvbXB1dGVyLCBHZXQtQURPYmplY3QsIEdldC1OZXRTaXRlCiAgICAgICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBOb25lCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFRha2VzIGEgdXNlci9ncm91cCBuYW1lIGFuZCBvcHRpb25hbCBkb21haW4sIGFuZCBkZXRlcm1pbmVzIHRoZSBjb21wdXRlcnMgaW4gdGhlIGRvbWFpbiAKICAgICAgICB0aGUgdXNlci9ncm91cCBoYXMgbG9jYWwgYWRtaW4gKG9yIFJEUCkgcmlnaHRzIHRvLgoKICAgICAgICBJdCBkb2VzIHRoaXMgYnk6CiAgICAgICAgICAgIDEuICByZXNvbHZpbmcgdGhlIHVzZXIvZ3JvdXAgdG8gaXRzIHByb3BlciBTSUQKICAgICAgICAgICAgMi4gIGVudW1lcmF0aW5nIGFsbCBncm91cHMgdGhlIHVzZXIvZ3JvdXAgaXMgYSBjdXJyZW50IHBhcnQgb2YgCiAgICAgICAgICAgICAgICBhbmQgZXh0cmFjdGluZyBhbGwgdGFyZ2V0IFNJRHMgdG8gYnVpbGQgYSB0YXJnZXQgU0lEIGxpc3QKICAgICAgICAgICAgMy4gIHB1bGxpbmcgYWxsIEdQT3MgdGhhdCBzZXQgJ1Jlc3RyaWN0ZWQgR3JvdXBzJyBvciBHcm91cHMueG1sIGJ5IGNhbGxpbmcKICAgICAgICAgICAgICAgIEdldC1OZXRHUE9Hcm91cAogICAgICAgICAgICA0LiAgbWF0Y2hpbmcgdGhlIHRhcmdldCBTSUQgbGlzdCB0byB0aGUgcXVlcmllZCBHUE8gU0lEIGxpc3QKICAgICAgICAgICAgICAgIHRvIGVudW1lcmF0ZSBhbGwgR1BPIHRoZSB1c2VyIGlzIGVmZmVjdGl2ZWx5IGFwcGxpZWQgd2l0aAogICAgICAgICAgICA1LiAgZW51bWVyYXRpbmcgYWxsIE9VcyBhbmQgc2l0ZXMgYW5kIGFwcGxpY2FibGUgR1BPIEdVSXMgYXJlCiAgICAgICAgICAgICAgICBhcHBsaWVkIHRvIHRocm91Z2ggZ3BsaW5rIGVudW1lcmF0aW5nCiAgICAgICAgICAgIDYuICBxdWVyeWluZyBmb3IgYWxsIGNvbXB1dGVycyB1bmRlciB0aGUgZ2l2ZW4gT1VzIG9yIHNpdGVzCiAgICAgICAgCiAgICAgICAgSWYgbm8gdXNlci9ncm91cCBpcyBzcGVjaWZpZWQsIGFsbCB1c2VyL2dyb3VwIC0+IG1hY2hpbmUgbWFwcGluZ3MgZGlzY292ZXJlZCB0aHJvdWdoCiAgICAgICAgR1BPIHJlbGF0aW9uc2hpcHMgYXJlIHJldHVybmVkLgoKICAgIC5QQVJBTUVURVIgVXNlck5hbWUKCiAgICAgICAgQSAoc2luZ2xlKSB1c2VyIG5hbWUgbmFtZSB0byBxdWVyeSBmb3IgYWNjZXNzLgoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIEEgKHNpbmdsZSkgZ3JvdXAgbmFtZSBuYW1lIHRvIHF1ZXJ5IGZvciBhY2Nlc3MuIAoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIE9wdGlvbmFsIGRvbWFpbiB0aGUgdXNlciBleGlzdHMgaW4gZm9yIHF1ZXJ5aW5nLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBMb2NhbEdyb3VwCgogICAgICAgIFRoZSBsb2NhbCBncm91cCB0byBjaGVjayBhY2Nlc3MgYWdhaW5zdC4KICAgICAgICBDYW4gYmUgIkFkbWluaXN0cmF0b3JzIiAoUy0xLTUtMzItNTQ0KSwgIlJEUC9SZW1vdGUgRGVza3RvcCBVc2VycyIgKFMtMS01LTMyLTU1NSksCiAgICAgICAgb3IgYSBjdXN0b20gbG9jYWwgU0lELiBEZWZhdWx0cyB0byBsb2NhbCAnQWRtaW5pc3RyYXRvcnMnLgoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IGFueSBmb3VuZCBwb2xpY3kgZmlsZXMgd2l0aCB0ZW1wb3JhcnkgUFNEcml2ZXMuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUdQT0xvY2F0aW9uCgogICAgICAgIEZpbmQgYWxsIHVzZXIvZ3JvdXAgLT4gbWFjaGluZSByZWxhdGlvbnNoaXBzIHdoZXJlIHRoZSB1c2VyL2dyb3VwIGlzIGEgbWVtYmVyCiAgICAgICAgb2YgdGhlIGxvY2FsIGFkbWluaXN0cmF0b3JzIGdyb3VwIG9uIHRhcmdldCBtYWNoaW5lcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtR1BPTG9jYXRpb24gLVVzZXJOYW1lIGRmbQogICAgICAgIAogICAgICAgIEZpbmQgYWxsIGNvbXB1dGVycyB0aGF0IGRmbSB1c2VyIGhhcyBsb2NhbCBhZG1pbmlzdHJhdG9yIHJpZ2h0cyB0byBpbiAKICAgICAgICB0aGUgY3VycmVudCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUdQT0xvY2F0aW9uIC1Vc2VyTmFtZSBkZm0gLURvbWFpbiBkZXYudGVzdGxhYi5sb2NhbAogICAgICAgIAogICAgICAgIEZpbmQgYWxsIGNvbXB1dGVycyB0aGF0IGRmbSB1c2VyIGhhcyBsb2NhbCBhZG1pbmlzdHJhdG9yIHJpZ2h0cyB0byBpbiAKICAgICAgICB0aGUgZGV2LnRlc3RsYWIubG9jYWwgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gRmluZC1HUE9Mb2NhdGlvbiAtVXNlck5hbWUgamFzb24gLUxvY2FsR3JvdXAgUkRQCiAgICAgICAgCiAgICAgICAgRmluZCBhbGwgY29tcHV0ZXJzIHRoYXQgamFzb24gaGFzIGxvY2FsIFJEUCBhY2Nlc3MgcmlnaHRzIHRvIGluIHRoZSBkb21haW4uCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJExvY2FsR3JvdXAgPSAnQWRtaW5pc3RyYXRvcnMnLAogICAgICAgIAogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVzZVBTRHJpdmUsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMAogICAgKQoKICAgIGlmKCRVc2VyTmFtZSkgewogICAgICAgICMgaWYgYSBncm91cCBuYW1lIGlzIHNwZWNpZmllZCwgZ2V0IHRoYXQgdXNlciBvYmplY3Qgc28gd2UgY2FuIGV4dHJhY3QgdGhlIHRhcmdldCBTSUQKICAgICAgICAkVXNlciA9IEdldC1OZXRVc2VyIC1Vc2VyTmFtZSAkVXNlck5hbWUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxCiAgICAgICAgJFVzZXJTaWQgPSAkVXNlci5vYmplY3RzaWQKCiAgICAgICAgaWYoLW5vdCAkVXNlclNpZCkgeyAgICAKICAgICAgICAgICAgVGhyb3cgIlVzZXIgJyRVc2VyTmFtZScgbm90IGZvdW5kISIKICAgICAgICB9CgogICAgICAgICRUYXJnZXRTSURzID0gQCgkVXNlclNpZCkKICAgICAgICAkT2JqZWN0U2FtQWNjb3VudE5hbWUgPSAkVXNlci5zYW1hY2NvdW50bmFtZQogICAgICAgICRUYXJnZXRPYmplY3QgPSAkVXNlclNpZAogICAgfQogICAgZWxzZWlmKCRHcm91cE5hbWUpIHsKICAgICAgICAjIGlmIGEgZ3JvdXAgbmFtZSBpcyBzcGVjaWZpZWQsIGdldCB0aGF0IGdyb3VwIG9iamVjdCBzbyB3ZSBjYW4gZXh0cmFjdCB0aGUgdGFyZ2V0IFNJRAogICAgICAgICRHcm91cCA9IEdldC1OZXRHcm91cCAtR3JvdXBOYW1lICRHcm91cE5hbWUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1GdWxsRGF0YSAtUGFnZVNpemUgJFBhZ2VTaXplIHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgMQogICAgICAgICRHcm91cFNpZCA9ICRHcm91cC5vYmplY3RzaWQKCiAgICAgICAgaWYoLW5vdCAkR3JvdXBTaWQpIHsgICAgCiAgICAgICAgICAgIFRocm93ICJHcm91cCAnJEdyb3VwTmFtZScgbm90IGZvdW5kISIKICAgICAgICB9CgogICAgICAgICRUYXJnZXRTSURzID0gQCgkR3JvdXBTaWQpCiAgICAgICAgJE9iamVjdFNhbUFjY291bnROYW1lID0gJEdyb3VwLnNhbWFjY291bnRuYW1lCiAgICAgICAgJFRhcmdldE9iamVjdCA9ICRHcm91cFNpZAogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFRhcmdldFNJRHMgPSBAKCcqJykKICAgIH0KCiAgICAjIGZpZ3VyZSBvdXQgd2hhdCB0aGUgU0lEIGlzIG9mIHRoZSB0YXJnZXQgbG9jYWwgZ3JvdXAgd2UncmUgY2hlY2tpbmcgZm9yIG1lbWJlcnNoaXAgaW4KICAgIGlmKCRMb2NhbEdyb3VwIC1saWtlICIqQWRtaW4qIikgewogICAgICAgICRUYXJnZXRMb2NhbFNJRCA9ICdTLTEtNS0zMi01NDQnCiAgICB9CiAgICBlbHNlaWYgKCAoJExvY2FsR3JvdXAgLWxpa2UgIipSRFAqIikgLW9yICgkTG9jYWxHcm91cCAtbGlrZSAiKlJlbW90ZSoiKSApIHsKICAgICAgICAkVGFyZ2V0TG9jYWxTSUQgPSAnUy0xLTUtMzItNTU1JwogICAgfQogICAgZWxzZWlmICgkTG9jYWxHcm91cCAtbGlrZSAiUy0xLTUtKiIpIHsKICAgICAgICAkVGFyZ2V0TG9jYWxTSUQgPSAkTG9jYWxHcm91cAogICAgfQogICAgZWxzZSB7CiAgICAgICAgdGhyb3cgIkxvY2FsR3JvdXAgbXVzdCBiZSAnQWRtaW5pc3RyYXRvcnMnLCAnUkRQJywgb3IgYSAnUy0xLTUtWCcgU0lEIGZvcm1hdC4iCiAgICB9CgogICAgIyBpZiB3ZSdyZSBub3QgbGlzdGluZyBhbGwgcmVsYXRpb25zaGlwcywgdXNlIHRoZSB0b2tlbkdyb3VwcyBhcHByb2FjaCBmcm9tIEdldC1OZXRHcm91cCB0byAKICAgICMgZ2V0IGFsbCBlZmZlY3RpdmUgc2VjdXJpdHkgU0lEcyB0aGlzIG9iamVjdCBpcyBhIHBhcnQgb2YKICAgIGlmKCRUYXJnZXRTSURzWzBdIC1hbmQgKCRUYXJnZXRTSURzWzBdIC1uZSAnKicpKSB7CiAgICAgICAgJFRhcmdldFNJRHMgKz0gR2V0LU5ldEdyb3VwIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIC1Vc2VyTmFtZSAkT2JqZWN0U2FtQWNjb3VudE5hbWUgLVJhd1NpZHMKICAgIH0KCiAgICBpZigtbm90ICRUYXJnZXRTSURzKSB7CiAgICAgICAgdGhyb3cgIk5vIGVmZmVjdGl2ZSB0YXJnZXQgU0lEcyEiCiAgICB9CgogICAgV3JpdGUtVmVyYm9zZSAiVGFyZ2V0TG9jYWxTSUQ6ICRUYXJnZXRMb2NhbFNJRCIKICAgIFdyaXRlLVZlcmJvc2UgIkVmZmVjdGl2ZSB0YXJnZXQgU0lEczogJFRhcmdldFNJRHMiCgogICAgJEdQT0dyb3VwQXJncyA9ICBAewogICAgICAgICdEb21haW4nID0gJERvbWFpbgogICAgICAgICdEb21haW5Db250cm9sbGVyJyA9ICREb21haW5Db250cm9sbGVyCiAgICAgICAgJ1VzZVBTRHJpdmUnID0gJFVzZVBTRHJpdmUKICAgICAgICAnUmVzb2x2ZU1lbWJlclNJRHMnID0gJFRydWUKICAgICAgICAnUGFnZVNpemUnID0gJFBhZ2VTaXplCiAgICB9CgogICAgIyBlbnVtZXJhdGUgYWxsIEdQTyBncm91cCBtYXBwaW5ncyBmb3IgdGhlIHRhcmdldCBkb21haW4KICAgICRHUE9ncm91cHMgPSBHZXQtTmV0R1BPR3JvdXAgQEdQT0dyb3VwQXJncyB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgJEdQT2dyb3VwID0gJF8KCiAgICAgICAgIyBpZiB0aGUgbG9jYWxseSBzZXQgZ3JvdXAgaXMgd2hhdCB3ZSdyZSBsb29raW5nIGZvciBvciB0aGUgbG9jYWxseSBzZXQgZ3JvdXAgaXMgYSAKICAgICAgICAjIG1lbWJlciBvZiB3aGF0IHdlJ3JlIGxvb2tpbmcgZm9yLCBjaGVjayB0aGUgR3JvdXBNZW1iZXJzIGZvciBvdXIgdGFyZ2V0IFNJRAogICAgICAgIGlmKCAoJEdQT2dyb3VwLkdyb3VwU0lEIC1tYXRjaCAkVGFyZ2V0TG9jYWxTSUQpIC1vciAoJEdQT2dyb3VwLkdyb3VwTWVtYmVyT2YgLWNvbnRhaW5zICRUYXJnZXRMb2NhbFNJRCkgKSB7CiAgICAgICAgICAgICRHUE9ncm91cC5Hcm91cE1lbWJlcnMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgIGlmICggKCRUYXJnZXRTSURzWzBdIC1lcSAnKicpIC1vciAoJFRhcmdldFNJRHMgLUNvbnRhaW5zICRfKSApIHsKICAgICAgICAgICAgICAgICAgICAkR1BPZ3JvdXAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gfCBTb3J0LU9iamVjdCAtUHJvcGVydHkgR1BPTmFtZSAtVW5pcXVlCgogICAgJEdQT2dyb3VwcyB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgJEdQT25hbWUgPSAkXy5HUE9EaXNwbGF5TmFtZQogICAgICAgICRHUE9ndWlkID0gJF8uR1BPTmFtZQogICAgICAgICRHUE9QYXRoID0gJF8uR1BPUGF0aAogICAgICAgICRHUE9UeXBlID0gJF8uR1BPVHlwZQogICAgICAgICRHUE9NZW1iZXJzID0gJF8uR3JvdXBNZW1iZXJzCiAgICAgICAgJEZpbHRlcnMgPSAkXy5GaWx0ZXJzCgogICAgICAgIGlmKC1ub3QgJFRhcmdldE9iamVjdCkgewogICAgICAgICAgICAjIGlmIHRoZSAqIHdpbGRjYXJkIHdhcyB1c2VkLCBzZXQgdGhlIE9iamVjdERpc3ROYW1lIGFzIHRoZSBHUE8gbWVtYmVyIFNJRCBzZXQKICAgICAgICAgICAgIyBzbyBhbGwgcmVsYXRpb25zaGlwIG1hcHBpbmdzIGFyZSBvdXRwdXQKICAgICAgICAgICAgJFRhcmdldE9iamVjdFNJRHMgPSAkR1BPTWVtYmVycwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFRhcmdldE9iamVjdFNJRHMgPSAkVGFyZ2V0T2JqZWN0CiAgICAgICAgfQoKICAgICAgICAjIGZpbmQgYW55IE9VcyB0aGF0IGhhdmUgdGhpcyBHVUlEIGFwcGxpZWQgYW5kIHRoZW4gcmV0cmlldmUgYW55IGNvbXB1dGVycyBmcm9tIHRoZSBPVQogICAgICAgIEdldC1OZXRPVSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUdVSUQgJEdQT2d1aWQgLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIGlmKCRGaWx0ZXJzKSB7CiAgICAgICAgICAgICAgICAjIGZpbHRlciBmb3IgY29tcHV0ZXIgbmFtZS9vcmcgdW5pdCBpZiBhIGZpbHRlciBpcyBzcGVjaWZpZWQKICAgICAgICAgICAgICAgICMgICBUT0RPOiBoYW5kbGUgb3RoZXIgZmlsdGVycyAoaS5lLiBPVSBmaWx0ZXJzPykgYWdhaW4sIEkgaGF0ZSB5b3UgR1BQLi4uCiAgICAgICAgICAgICAgICAkT1VDb21wdXRlcnMgPSBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwYXRoICRfLkFEU3BhdGggLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBXaGVyZS1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICRfLmFkc3BhdGggLW1hdGNoICgkRmlsdGVycy5WYWx1ZSkKICAgICAgICAgICAgICAgIH0gfCBGb3JFYWNoLU9iamVjdCB7ICRfLmRuc2hvc3RuYW1lIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRPVUNvbXB1dGVycyA9IEdldC1OZXRDb21wdXRlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJF8uQURTcGF0aCAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCRPVUNvbXB1dGVycyAtaXNub3QgW1N5c3RlbS5BcnJheV0pIHskT1VDb21wdXRlcnMgPSBAKCRPVUNvbXB1dGVycyl9CgogICAgICAgICAgICBGb3JFYWNoICgkVGFyZ2V0U2lkIGluICRUYXJnZXRPYmplY3RTSURzKSB7CiAgICAgICAgICAgICAgICAkT2JqZWN0ID0gR2V0LUFET2JqZWN0IC1TSUQgJFRhcmdldFNpZCAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLVBhZ2VTaXplICRQYWdlU2l6ZQoKICAgICAgICAgICAgICAgICRJc0dyb3VwID0gQCgnMjY4NDM1NDU2JywnMjY4NDM1NDU3JywnNTM2ODcwOTEyJywnNTM2ODcwOTEzJykgLWNvbnRhaW5zICRPYmplY3Quc2FtYWNjb3VudHR5cGUKCiAgICAgICAgICAgICAgICAkR1BPTG9jYXRpb24gPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAkR1BPTG9jYXRpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnT2JqZWN0TmFtZScgJE9iamVjdC5zYW1hY2NvdW50bmFtZQogICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdEROJyAkT2JqZWN0LmRpc3Rpbmd1aXNoZWRuYW1lCiAgICAgICAgICAgICAgICAkR1BPTG9jYXRpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnT2JqZWN0U0lEJyAkT2JqZWN0Lm9iamVjdHNpZAogICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0RvbWFpbicgJERvbWFpbgogICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzR3JvdXAnICRJc0dyb3VwCiAgICAgICAgICAgICAgICAkR1BPTG9jYXRpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPRGlzcGxheU5hbWUnICRHUE9uYW1lCiAgICAgICAgICAgICAgICAkR1BPTG9jYXRpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPR3VpZCcgJEdQT0d1aWQKICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9QYXRoJyAkR1BPUGF0aAogICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT1R5cGUnICRHUE9UeXBlCiAgICAgICAgICAgICAgICAkR1BPTG9jYXRpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29udGFpbmVyTmFtZScgJF8uZGlzdGluZ3Vpc2hlZG5hbWUKICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRPVUNvbXB1dGVycwogICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgZmluZCBhbnkgc2l0ZXMgdGhhdCBoYXZlIHRoaXMgR1VJRCBhcHBsaWVkCiAgICAgICAgR2V0LU5ldFNpdGUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1HVUlEICRHUE9ndWlkIC1QYWdlU2l6ZSAkUGFnZVNpemUgLUZ1bGxEYXRhIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgRm9yRWFjaCAoJFRhcmdldFNpZCBpbiAkVGFyZ2V0T2JqZWN0U0lEcykgewogICAgICAgICAgICAgICAgJE9iamVjdCA9IEdldC1BRE9iamVjdCAtU0lEICRUYXJnZXRTaWQgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgICAgICAgICAkSXNHcm91cCA9IEAoJzI2ODQzNTQ1NicsJzI2ODQzNTQ1NycsJzUzNjg3MDkxMicsJzUzNjg3MDkxMycpIC1jb250YWlucyAkT2JqZWN0LnNhbWFjY291bnR0eXBlCgogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdE5hbWUnICRPYmplY3Quc2FtYWNjb3VudG5hbWUKICAgICAgICAgICAgICAgICRBcHBsaWVkU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdPYmplY3RETicgJE9iamVjdC5kaXN0aW5ndWlzaGVkbmFtZQogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdFNJRCcgJE9iamVjdC5vYmplY3RzaWQKICAgICAgICAgICAgICAgICRBcHBsaWVkU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0dyb3VwJyAkSXNHcm91cAogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0RvbWFpbicgJERvbWFpbgogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0Rpc3BsYXlOYW1lJyAkR1BPbmFtZQogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0d1aWQnICRHUE9HdWlkCiAgICAgICAgICAgICAgICAkQXBwbGllZFNpdGUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPUGF0aCcgJEdQT1BhdGgKICAgICAgICAgICAgICAgICRBcHBsaWVkU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9UeXBlJyAkR1BPVHlwZQogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbnRhaW5lck5hbWUnICRfLmRpc3Rpbmd1aXNoZWRuYW1lCiAgICAgICAgICAgICAgICAkQXBwbGllZFNpdGUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkXy5zaXRlb2JqZWN0YmwKICAgICAgICAgICAgICAgICRBcHBsaWVkU2l0ZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gRmluZC1HUE9Db21wdXRlckFkbWluIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUYWtlcyBhIGNvbXB1dGVyIChvciBHUE8pIG9iamVjdCBhbmQgZGV0ZXJtaW5lcyB3aGF0IHVzZXJzL2dyb3VwcyBhcmUgaW4gdGhlIHNwZWNpZmllZAogICAgICAgIGxvY2FsIGdyb3VwIGZvciB0aGUgbWFjaGluZS4KCiAgICAgICAgQXV0aG9yOiBAaGFybWoweQogICAgICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgICAgIFJlcXVpcmVkIERlcGVuZGVuY2llczogR2V0LU5ldENvbXB1dGVyLCBHZXQtU2l0ZU5hbWUsIEdldC1OZXRTaXRlLCBHZXQtTmV0R1BPR3JvdXAsIEdldC1BRE9iamVjdCwgR2V0LU5ldEdyb3VwTWVtYmVyLCBDb252ZXJ0LVNpZFRvTmFtZQogICAgICAgIE9wdGlvbmFsIERlcGVuZGVuY2llczogTm9uZQoKICAgIC5ERVNDUklQVElPTgogICAgICAgIAogICAgICAgIElmIGEgLUNvbXB1dGVyTmFtZSBpcyBzcGVjaWZpZWQsIHJldHJpZXZlIHRoZSBjb21wbGV0ZSBjb21wdXRlciBvYmplY3QsIGF0dGVtcHQgdG8KICAgICAgICBkZXRlcm1pbmUgdGhlIE9VIHRoZSBjb21wdXRlciBpcyBhIHBhcnQgb2YuIFRoZW4gcmVzb2x2ZSB0aGUgY29tcHV0ZXIncyBzaXRlIG5hbWUgd2l0aAogICAgICAgIEdldC1TaXRlTmFtZSBhbmQgcmV0cmlldmUgYWxsIHNpdGVzIG9iamVjdCBHZXQtTmV0U2l0ZS4gRm9yIHRob3NlIHJlc3VsdHMsIGF0dGVtcHQgdG8KICAgICAgICBlbnVtZXJhdGUgYWxsIGxpbmtlZCBHUE9zIGFuZCBhc3NvY2lhdGVkIGxvY2FsIGdyb3VwIHNldHRpbmdzIHdpdGggR2V0LU5ldEdQT0dyb3VwLiBGb3IKICAgICAgICBlYWNoIHJlc3VsdGluZyBHUE8gZ3JvdXAsIHJlc29sdmUgdGhlIHJlc3VsdGluZyB1c2VyL2dyb3VwIG5hbWUgdG8gYSBmdWxsIEFEIG9iamVjdCBhbmQKICAgICAgICByZXR1cm4gdGhlIHJlc3VsdHMuIFRoaXMgd2lsbCByZXR1cm4gdGhlIGRvbWFpbiBvYmplY3RzIHRoYXQgYXJlIG1lbWJlcnMgb2YgdGhlIHNwZWNpZmllZAogICAgICAgIC1Mb2NhbEdyb3VwIGZvciB0aGUgZ2l2ZW4gY29tcHV0ZXIuCgogICAgICAgIEludmVyc2Ugb2YgRmluZC1HUE9Mb2NhdGlvbi4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBUaGUgY29tcHV0ZXIgdG8gZGV0ZXJtaW5lIGxvY2FsIGFkbWluaXN0cmF0aXZlIGFjY2VzcyB0by4KCiAgICAuUEFSQU1FVEVSIE9VTmFtZQoKICAgICAgICBPVSBuYW1lIHRvIGRldGVybWluZSB3aG8gaGFzIGxvY2FsIGFkbWluaXNydGF0aXZlIGFjZXNzIHRvIGNvbXB1dGVycwogICAgICAgIHdpdGhpbiBpdC4gCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgT3B0aW9uYWwgZG9tYWluIHRoZSBjb21wdXRlci9PVSBleGlzdHMgaW4sIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFJlY3Vyc2UKCiAgICAgICAgU3dpdGNoLiBJZiBhIHJldHVybmVkIG1lbWJlciBpcyBhIGdyb3VwLCByZWN1cnNlIGFuZCBnZXQgYWxsIG1lbWJlcnMuCgogICAgLlBBUkFNRVRFUiBMb2NhbEdyb3VwCgogICAgICAgIFRoZSBsb2NhbCBncm91cCB0byBjaGVjayBhY2Nlc3MgYWdhaW5zdC4KICAgICAgICBDYW4gYmUgIkFkbWluaXN0cmF0b3JzIiAoUy0xLTUtMzItNTQ0KSwgIlJEUC9SZW1vdGUgRGVza3RvcCBVc2VycyIgKFMtMS01LTMyLTU1NSksCiAgICAgICAgb3IgYSBjdXN0b20gbG9jYWwgU0lELgogICAgICAgIERlZmF1bHRzIHRvIGxvY2FsICdBZG1pbmlzdHJhdG9ycycuCgogICAgLlBBUkFNRVRFUiBVc2VQU0RyaXZlCgogICAgICAgIFN3aXRjaC4gTW91bnQgYW55IGZvdW5kIHBvbGljeSBmaWxlcyB3aXRoIHRlbXBvcmFyeSBQU0RyaXZlcy4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtR1BPQ29tcHV0ZXJBZG1pbiAtQ29tcHV0ZXJOYW1lIFdJTkRPV1MzLmRldi50ZXN0bGFiLmxvY2FsCiAgICAgICAgCiAgICAgICAgRmluZHMgdXNlcnMgd2hvIGhhdmUgbG9jYWwgYWRtaW4gcmlnaHRzIG92ZXIgV0lORE9XUzMgdGhyb3VnaCBHUE8gY29ycmVsYXRpb24uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUdQT0NvbXB1dGVyQWRtaW4gLUNvbXB1dGVyTmFtZSBXSU5ET1dTMy5kZXYudGVzdGxhYi5sb2NhbCAtTG9jYWxHcm91cCBSRFAKICAgICAgICAKICAgICAgICBGaW5kcyB1c2VycyB3aG8gaGF2ZSBSRFAgcmlnaHRzIG92ZXIgV0lORE9XUzMgdGhyb3VnaCBHUE8gY29ycmVsYXRpb24uCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlck5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE9VTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRSZWN1cnNlLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRMb2NhbEdyb3VwID0gJ0FkbWluaXN0cmF0b3JzJywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVXNlUFNEcml2ZSwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwCiAgICApCgogICAgcHJvY2VzcyB7CiAgICAKICAgICAgICBpZighJENvbXB1dGVyTmFtZSAtYW5kICEkT1VOYW1lKSB7CiAgICAgICAgICAgIFRocm93ICItQ29tcHV0ZXJOYW1lIG9yIC1PVU5hbWUgbXVzdCBiZSBwcm92aWRlZCIKICAgICAgICB9CgogICAgICAgICRHUE9Hcm91cHMgPSBAKCkKCiAgICAgICAgaWYoJENvbXB1dGVyTmFtZSkgewogICAgICAgICAgICAkQ29tcHV0ZXJzID0gR2V0LU5ldENvbXB1dGVyIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgICAgIGlmKCEkQ29tcHV0ZXJzKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiQ29tcHV0ZXIgJENvbXB1dGVyTmFtZSBpbiBkb21haW4gJyREb21haW4nIG5vdCBmb3VuZCEgVHJ5IGEgZnVsbHkgcXVhbGlmaWVkIGhvc3QgbmFtZSIKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgJFRhcmdldE9VcyA9IEAoKQogICAgICAgICAgICBGb3JFYWNoKCRDb21wdXRlciBpbiAkQ29tcHV0ZXJzKSB7CiAgICAgICAgICAgICAgICAjIGV4dHJhY3QgYWxsIE9VcyBhIGNvbXB1dGVyIGlzIGEgcGFydCBvZgogICAgICAgICAgICAgICAgJEROID0gJENvbXB1dGVyLmRpc3Rpbmd1aXNoZWRuYW1lCgogICAgICAgICAgICAgICAgJFRhcmdldE9VcyArPSAkRE4uc3BsaXQoIiwiKSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICBpZigkXy5zdGFydHN3aXRoKCJPVT0iKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkRE4uc3Vic3RyaW5nKCRETi5pbmRleG9mKCRfKSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgZW51bWVyYXRlIGFueSBsaW5rZWQgR1BPcyBmb3IgdGhlIGNvbXB1dGVyJ3Mgc2l0ZQogICAgICAgICAgICAkQ29tcHV0ZXJTaXRlID0gKEdldC1TaXRlTmFtZSAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUpLlNpdGVOYW1lCiAgICAgICAgICAgIGlmKCRDb21wdXRlclNpdGUgLWFuZCAoJENvbXB1dGVyU2l0ZSAtbm90bGlrZSAnRXJyb3IqJykpIHsKICAgICAgICAgICAgICAgICRHUE9Hcm91cHMgKz0gR2V0LU5ldFNpdGUgLVNpdGVOYW1lICRDb21wdXRlclNpdGUgLUZ1bGxEYXRhIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgIGlmKCRfLmdwbGluaykgewogICAgICAgICAgICAgICAgICAgICAgICAkXy5ncGxpbmsuc3BsaXQoIl1bIikgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF8uc3RhcnRzd2l0aCgiTERBUCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJF8uc3BsaXQoIjsiKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAkR1BPR3JvdXBBcmdzID0gIEB7CiAgICAgICAgICAgICAgICAgICAgICAgICdEb21haW4nID0gJERvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAnRG9tYWluQ29udHJvbGxlcicgPSAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAgICAgICAgICAgICAnUmVzb2x2ZU1lbWJlclNJRHMnID0gJFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgJ1VzZVBTRHJpdmUnID0gJFVzZVBTRHJpdmUKICAgICAgICAgICAgICAgICAgICAgICAgJ1BhZ2VTaXplJyA9ICRQYWdlU2l6ZQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgIyBmb3IgZWFjaCBHUE8gbGluaywgZ2V0IGFueSBsb2NhbGx5IHNldCB1c2VyL2dyb3VwIFNJRHMKICAgICAgICAgICAgICAgICAgICBHZXQtTmV0R1BPR3JvdXAgQEdQT0dyb3VwQXJncwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkVGFyZ2V0T1VzID0gQCgkT1VOYW1lKQogICAgICAgIH0KCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiVGFyZ2V0IE9VczogJFRhcmdldE9VcyIKCiAgICAgICAgJFRhcmdldE9VcyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgIyBmb3IgZWFjaCBPVSB0aGUgY29tcHV0ZXIgaXMgYSBwYXJ0IG9mLCBnZXQgdGhlIGZ1bGwgT1Ugb2JqZWN0CiAgICAgICAgICAgICRHUE9ncm91cHMgKz0gR2V0LU5ldE9VIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQURTcGF0aCAkXyAtRnVsbERhdGEgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IEZvckVhY2gtT2JqZWN0IHsgCiAgICAgICAgICAgICAgICAjIGFuZCB0aGVuIGdldCBhbnkgR1BPIGxpbmtzCiAgICAgICAgICAgICAgICBpZigkXy5ncGxpbmspIHsKICAgICAgICAgICAgICAgICAgICAkXy5ncGxpbmsuc3BsaXQoIl1bIikgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkXy5zdGFydHN3aXRoKCJMREFQIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfLnNwbGl0KCI7IilbMF0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICRHUE9Hcm91cEFyZ3MgPSAgQHsKICAgICAgICAgICAgICAgICAgICAnRG9tYWluJyA9ICREb21haW4KICAgICAgICAgICAgICAgICAgICAnRG9tYWluQ29udHJvbGxlcicgPSAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAgICAgICAgICdVc2VQU0RyaXZlJyA9ICRVc2VQU0RyaXZlCiAgICAgICAgICAgICAgICAgICAgJ1Jlc29sdmVNZW1iZXJTSURzJyA9ICRUcnVlCiAgICAgICAgICAgICAgICAgICAgJ1BhZ2VTaXplJyA9ICRQYWdlU2l6ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIyBmb3IgZWFjaCBHUE8gbGluaywgZ2V0IGFueSBsb2NhbGx5IHNldCB1c2VyL2dyb3VwIFNJRHMKICAgICAgICAgICAgICAgIEdldC1OZXRHUE9Hcm91cCBAR1BPR3JvdXBBcmdzCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgZm9yIGVhY2ggZm91bmQgR1BPIGdyb3VwLCByZXNvbHZlIHRoZSBTSURzIG9mIHRoZSBtZW1iZXJzCiAgICAgICAgJEdQT2dyb3VwcyB8IFNvcnQtT2JqZWN0IC1Qcm9wZXJ0eSBHUE9OYW1lIC1VbmlxdWUgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICRHUE9Hcm91cCA9ICRfCgogICAgICAgICAgICAkR1BPR3JvdXAuR3JvdXBNZW1iZXJzIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICMgcmVzb2x2ZSB0aGlzIFNJRCB0byBhIGRvbWFpbiBvYmplY3QKICAgICAgICAgICAgICAgICRPYmplY3QgPSBHZXQtQURPYmplY3QgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUgLVNJRCAkXwoKICAgICAgICAgICAgICAgICRJc0dyb3VwID0gQCgnMjY4NDM1NDU2JywnMjY4NDM1NDU3JywnNTM2ODcwOTEyJywnNTM2ODcwOTEzJykgLWNvbnRhaW5zICRPYmplY3Quc2FtYWNjb3VudHR5cGUKCiAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnT2JqZWN0TmFtZScgJE9iamVjdC5zYW1hY2NvdW50bmFtZQogICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnT2JqZWN0RE4nICRPYmplY3QuZGlzdGluZ3Vpc2hlZG5hbWUKICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdFNJRCcgJF8KICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzR3JvdXAnICRJc0dyb3VwCiAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9EaXNwbGF5TmFtZScgJEdQT0dyb3VwLkdQT0Rpc3BsYXlOYW1lCiAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9HdWlkJyAkR1BPR3JvdXAuR1BPTmFtZQogICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPUGF0aCcgJEdQT0dyb3VwLkdQT1BhdGgKICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT1R5cGUnICRHUE9UeXBlLkdQT1R5cGUKICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIAoKICAgICAgICAgICAgICAgICMgaWYgd2UncmUgcmVjdXJzaW5nIGFuZCB0aGUgY3VycmVudCByZXN1bHQgb2JqZWN0IGlzIGEgZ3JvdXAKICAgICAgICAgICAgICAgIGlmKCRSZWN1cnNlIC1hbmQgJEdQT0NvbXB1dGVyQWRtaW4uaXNHcm91cCkgewoKICAgICAgICAgICAgICAgICAgICBHZXQtTmV0R3JvdXBNZW1iZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1TSUQgJF8gLUZ1bGxEYXRhIC1SZWN1cnNlIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRE4gPSAkXy5kaXN0aW5ndWlzaGVkTmFtZQoKICAgICAgICAgICAgICAgICAgICAgICAgIyBleHRyYWN0IHRoZSBGUUROIGZyb20gdGhlIERpc3Rpbmd1aXNoZWQgTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRG9tYWluID0gJE1lbWJlckROLnN1YlN0cmluZygkTWVtYmVyRE4uSW5kZXhPZigiREM9IikpIC1yZXBsYWNlICdEQz0nLCcnIC1yZXBsYWNlICcsJywnLicKCiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJJc0dyb3VwID0gQCgnMjY4NDM1NDU2JywnMjY4NDM1NDU3JywnNTM2ODcwOTEyJywnNTM2ODcwOTEzJykgLWNvbnRhaW5zICRfLnNhbWFjY291bnR0eXBlCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF8uc2FtQWNjb3VudE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgZm9yZXN0IHVzZXJzIGhhdmUgdGhlIHNhbUFjY291bnROYW1lIHNldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlck5hbWUgPSAkXy5zYW1BY2NvdW50TmFtZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBleHRlcm5hbCB0cnVzdCB1c2VycyBoYXZlIGEgU0lELCBzbyBjb252ZXJ0IGl0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJOYW1lID0gQ29udmVydC1TaWRUb05hbWUgJF8uY24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHRoZXJlJ3MgYSBwcm9ibGVtIGNvbnRhY3RpbmcgdGhlIGRvbWFpbiB0byByZXNvbHZlIHRoZSBTSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyTmFtZSA9ICRfLmNuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnT2JqZWN0TmFtZScgJE1lbWJlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnT2JqZWN0RE4nICRNZW1iZXJETgogICAgICAgICAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdPYmplY3RTSUQnICRfLm9iamVjdHNpZAogICAgICAgICAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0dyb3VwJyAkTWVtYmVySXNHcm91CiAgICAgICAgICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0Rpc3BsYXlOYW1lJyAkR1BPR3JvdXAuR1BPRGlzcGxheU5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPR3VpZCcgJEdQT0dyb3VwLkdQT05hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPUGF0aCcgJEdQT0dyb3VwLkdQT1BhdGgKICAgICAgICAgICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPVHlwZScgJEdQT1R5cGVwCiAgICAgICAgICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1Eb21haW5Qb2xpY3kgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFJldHVybnMgdGhlIGRlZmF1bHQgZG9tYWluIG9yIERDIHBvbGljeSBmb3IgYSBnaXZlbgogICAgICAgIGRvbWFpbiBvciBkb21haW4gY29udHJvbGxlci4KCiAgICAgICAgVGhhbmtzIFNlYW4gTWV0YWNhbGYgKEBweXJvdGVrMykgZm9yIHRoZSBpZGVhIGFuZCBndWlkYW5jZS4KCiAgICAuUEFSQU1FVEVSIFNvdXJjZQoKICAgICAgICBFeHRyYWN0IERvbWFpbiBvciBEQyAoZG9tYWluIGNvbnRyb2xsZXIpIHBvbGljaWVzLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIGRlZmF1bHQgcG9saWNpZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFJlc29sdmVTaWRzCgogICAgICAgIFN3aXRjaC4gUmVzb2x2ZSBTaWRzIGZyb20gYSBEQyBwb2xpY3kgdG8gb2JqZWN0IG5hbWVzLgoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IGFueSBmb3VuZCBwb2xpY3kgZmlsZXMgd2l0aCB0ZW1wb3JhcnkgUFNEcml2ZXMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtRG9tYWluUG9saWN5CgogICAgICAgIFJldHVybnMgdGhlIGRvbWFpbiBwb2xpY3kgZm9yIHRoZSBjdXJyZW50IGRvbWFpbi4gCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtRG9tYWluUG9saWN5IC1Tb3VyY2UgREMgLURvbWFpbkNvbnRyb2xsZXIgTUFTVEVSLnRlc3RsYWIubG9jYWwKCiAgICAgICAgUmV0dXJucyB0aGUgcG9saWN5IGZvciB0aGUgTUFTVEVSLnRlc3RsYWIubG9jYWwgZG9tYWluIGNvbnRyb2xsZXIuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZVNldCgiRG9tYWluIiwiREMiKV0KICAgICAgICAkU291cmNlID0iRG9tYWluIiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRSZXNvbHZlU2lkcywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVXNlUFNEcml2ZQogICAgKQoKICAgIGlmKCRTb3VyY2UgLWVxICJEb21haW4iKSB7CiAgICAgICAgIyBxdWVyeSB0aGUgZ2l2ZW4gZG9tYWluIGZvciB0aGUgZGVmYXVsdCBkb21haW4gcG9saWN5IG9iamVjdAogICAgICAgICRHUE8gPSBHZXQtTmV0R1BPIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtR1BPbmFtZSAiezMxQjJGMzQwLTAxNkQtMTFEMi05NDVGLTAwQzA0RkI5ODRGOX0iCiAgICAgICAgCiAgICAgICAgaWYoJEdQTykgewogICAgICAgICAgICAjIGdyYWIgdGhlIEdwdFRtcGwuaW5mIGZpbGUgYW5kIHBhcnNlIGl0CiAgICAgICAgICAgICRHcHRUbXBsUGF0aCA9ICRHUE8uZ3BjZmlsZXN5c3BhdGggKyAiXE1BQ0hJTkVcTWljcm9zb2Z0XFdpbmRvd3MgTlRcU2VjRWRpdFxHcHRUbXBsLmluZiIKCiAgICAgICAgICAgICRQYXJzZUFyZ3MgPSAgQHsKICAgICAgICAgICAgICAgICdHcHRUbXBsUGF0aCcgPSAkR3B0VG1wbFBhdGgKICAgICAgICAgICAgICAgICdVc2VQU0RyaXZlJyA9ICRVc2VQU0RyaXZlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgcGFyc2UgdGhlIEdwdFRtcGwuaW5mCiAgICAgICAgICAgIEdldC1HcHRUbXBsIEBQYXJzZUFyZ3MKICAgICAgICB9CgogICAgfQogICAgZWxzZWlmKCRTb3VyY2UgLWVxICJEQyIpIHsKICAgICAgICAjIHF1ZXJ5IHRoZSBnaXZlbiBkb21haW4vZGMgZm9yIHRoZSBkZWZhdWx0IGRvbWFpbiBjb250cm9sbGVyIHBvbGljeSBvYmplY3QKICAgICAgICAkR1BPID0gR2V0LU5ldEdQTyAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUdQT25hbWUgIns2QUMxNzg2Qy0wMTZGLTExRDItOTQ1Ri0wMEMwNEZCOTg0Rjl9IgoKICAgICAgICBpZigkR1BPKSB7CiAgICAgICAgICAgICMgZ3JhYiB0aGUgR3B0VG1wbC5pbmYgZmlsZSBhbmQgcGFyc2UgaXQKICAgICAgICAgICAgJEdwdFRtcGxQYXRoID0gJEdQTy5ncGNmaWxlc3lzcGF0aCArICJcTUFDSElORVxNaWNyb3NvZnRcV2luZG93cyBOVFxTZWNFZGl0XEdwdFRtcGwuaW5mIgoKICAgICAgICAgICAgJFBhcnNlQXJncyA9ICBAewogICAgICAgICAgICAgICAgJ0dwdFRtcGxQYXRoJyA9ICRHcHRUbXBsUGF0aAogICAgICAgICAgICAgICAgJ1VzZVBTRHJpdmUnID0gJFVzZVBTRHJpdmUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBwYXJzZSB0aGUgR3B0VG1wbC5pbmYKICAgICAgICAgICAgR2V0LUdwdFRtcGwgQFBhcnNlQXJncyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgIGlmKCRSZXNvbHZlU2lkcykgewogICAgICAgICAgICAgICAgICAgICMgaWYgd2UncmUgcmVzb2x2aW5nIHNpZHMgaW4gUHJpdmlsZWdlUmlnaHRzIHRvIG5hbWVzCiAgICAgICAgICAgICAgICAgICAgJFBvbGljeSA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAkXy5wc29iamVjdC5wcm9wZXJ0aWVzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICBpZiggJF8uTmFtZSAtZXEgJ1ByaXZpbGVnZVJpZ2h0cycpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUHJpdmlsZWdlUmlnaHRzID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBmb3IgZXZlcnkgbmVzdGVkIFNJRCBtZW1iZXIgb2YgUHJpdmlsZWdlUmlnaHRzLCB0cnkgdG8gdW5wYWNrIGV2ZXJ5dGhpbmcgYW5kIHJlc29sdmUgdGhlIFNJRHMgYXMgYXBwcm9wcmlhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfLlZhbHVlLnBzb2JqZWN0LnByb3BlcnRpZXMgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTaWRzID0gJF8uVmFsdWUgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkXyAtaXNub3QgW1N5c3RlbS5BcnJheV0pIHsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29udmVydC1TaWRUb05hbWUgJF8gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkXyB8IEZvckVhY2gtT2JqZWN0IHsgQ29udmVydC1TaWRUb05hbWUgJF8gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIHJlc29sdmluZyBTSUQgOiAkXyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFByaXZpbGVnZVJpZ2h0cyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICRfLk5hbWUgJFNpZHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUG9saWN5IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1ByaXZpbGVnZVJpZ2h0cycgJFByaXZpbGVnZVJpZ2h0cwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFBvbGljeSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICRfLk5hbWUgJF8uVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkUG9saWN5CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsgJF8gfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMKIyBGdW5jdGlvbnMgdGhhdCBlbnVtZXJhdGUgYSBzaW5nbGUgaG9zdCwgZWl0aGVyIHRocm91Z2gKIyBXaW5OVCwgV01JLCByZW1vdGUgcmVnaXN0cnksIG9yIEFQSSBjYWxscyAKIyAod2l0aCBQU1JlZmxlY3QpLgojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpmdW5jdGlvbiBHZXQtTmV0TG9jYWxHcm91cCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgR2V0cyBhIGxpc3Qgb2YgYWxsIGN1cnJlbnQgdXNlcnMgaW4gYSBzcGVjaWZpZWQgbG9jYWwgZ3JvdXAsCiAgICAgICAgb3IgcmV0dXJucyB0aGUgbmFtZXMgb2YgYWxsIGxvY2FsIGdyb3VwcyB3aXRoIC1MaXN0R3JvdXBzLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBob3N0bmFtZSBvciBJUCB0byBxdWVyeSBmb3IgbG9jYWwgZ3JvdXAgdXNlcnMuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckZpbGUKCiAgICAgICAgRmlsZSBvZiBob3N0bmFtZXMvSVBzIHRvIHF1ZXJ5IGZvciBsb2NhbCBncm91cCB1c2Vycy4KCiAgICAuUEFSQU1FVEVSIEdyb3VwTmFtZQoKICAgICAgICBUaGUgbG9jYWwgZ3JvdXAgbmFtZSB0byBxdWVyeSBmb3IgdXNlcnMuIElmIG5vdCBnaXZlbiwgaXQgZGVmYXVsdHMgdG8gIkFkbWluaXN0cmF0b3JzIgoKICAgIC5QQVJBTUVURVIgTGlzdEdyb3VwcwoKICAgICAgICBTd2l0Y2guIExpc3QgYWxsIHRoZSBsb2NhbCBncm91cHMgaW5zdGVhZCBvZiB0aGVpciBtZW1iZXJzLgogICAgICAgIE9sZCBHZXQtTmV0TG9jYWxHcm91cHMgZnVuY3Rpb25hbGl0eS4KCiAgICAuUEFSQU1FVEVSIFJlY3Vyc2UKCiAgICAgICAgU3dpdGNoLiBJZiB0aGUgbG9jYWwgbWVtYmVyIG1lbWJlciBpcyBhIGRvbWFpbiBncm91cCwgcmVjdXJzaXZlbHkgdHJ5IHRvIHJlc29sdmUgaXRzIG1lbWJlcnMgdG8gZ2V0IGEgbGlzdCBvZiBkb21haW4gdXNlcnMgd2hvIGNhbiBhY2Nlc3MgdGhpcyBtYWNoaW5lLgoKICAgIC5QQVJBTUVURVIgQVBJCgogICAgICAgIFN3aXRjaC4gVXNlIEFQSSBjYWxscyBpbnN0ZWFkIG9mIHRoZSBXaW5OVCBzZXJ2aWNlIHByb3ZpZGVyLiBMZXNzIGluZm9ybWF0aW9uLAogICAgICAgIGJ1dCB0aGUgcmVzdWx0cyBhcmUgZmFzdGVyLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldExvY2FsR3JvdXAKCiAgICAgICAgUmV0dXJucyB0aGUgdXNlcm5hbWVzIHRoYXQgb2YgbWVtYmVycyBvZiBsb2NhbGdyb3VwICJBZG1pbmlzdHJhdG9ycyIgb24gdGhlIGxvY2FsIGhvc3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0TG9jYWxHcm91cCAtQ29tcHV0ZXJOYW1lIFdJTkRPV1NYUAoKICAgICAgICBSZXR1cm5zIGFsbCB0aGUgbG9jYWwgYWRtaW5pc3RyYXRvciBhY2NvdW50cyBmb3IgV0lORE9XU1hQCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0TG9jYWxHcm91cCAtQ29tcHV0ZXJOYW1lIFdJTkRPV1M3IC1SZWN1cnNlIAoKICAgICAgICBSZXR1cm5zIGFsbCBlZmZlY3RpdmUgbG9jYWwvZG9tYWluIHVzZXJzL2dyb3VwcyB0aGF0IGNhbiBhY2Nlc3MgV0lORE9XUzcgd2l0aAogICAgICAgIGxvY2FsIGFkbWluaXN0cmF0aXZlIHByaXZpbGVnZXMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0TG9jYWxHcm91cCAtQ29tcHV0ZXJOYW1lIFdJTkRPV1M3IC1MaXN0R3JvdXBzCgogICAgICAgIFJldHVybnMgYWxsIGxvY2FsIGdyb3VwcyBvbiB0aGUgV0lORE9XUzcgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+ICJXSU5ET1dTNyIsICJXSU5ET1dTU1AiIHwgR2V0LU5ldExvY2FsR3JvdXAgLUFQSQoKICAgICAgICBSZXR1cm5zIGFsbCBsb2NhbCBncm91cHMgb24gdGhlIHRoZSBwYXNzZWQgaG9zdHMgdXNpbmcgQVBJIGNhbGxzIGluc3RlYWQgb2YgdGhlCiAgICAgICAgV2luTlQgc2VydmljZSBwcm92aWRlci4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzIxMjg4MjIwL2dldC1hbGwtbG9jYWwtbWVtYmVycy1hbmQtZ3JvdXBzLWRpc3BsYXllZC10b2dldGhlcgogICAgICAgIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9hYTc3MjIxMShWUy44NSkuYXNweAojPgoKICAgIFtDbWRsZXRCaW5kaW5nKERlZmF1bHRQYXJhbWV0ZXJTZXROYW1lID0gJ1dpbk5UJyldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQVBJJywgUG9zaXRpb249MCwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdXaW5OVCcsIFBvc2l0aW9uPTAsIFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3ROYW1lJyldCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgICRDb21wdXRlck5hbWUgPSAkRW52OkNvbXB1dGVyTmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ1dpbk5UJyldCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0FQSScpXQogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7VGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtBbGlhcygnSG9zdExpc3QnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckZpbGUsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdXaW5OVCcpXQogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdBUEknKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRHcm91cE5hbWUgPSAnQWRtaW5pc3RyYXRvcnMnLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnV2luTlQnKV0KICAgICAgICBbU3dpdGNoXQogICAgICAgICRMaXN0R3JvdXBzLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnV2luTlQnKV0KICAgICAgICBbU3dpdGNoXQogICAgICAgICRSZWN1cnNlLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQVBJJyldCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQVBJCiAgICApCgogICAgcHJvY2VzcyB7CgogICAgICAgICRTZXJ2ZXJzID0gQCgpCgogICAgICAgICMgaWYgd2UgaGF2ZSBhIGhvc3QgbGlzdCBwYXNzZWQsIGdyYWIgaXQKICAgICAgICBpZigkQ29tcHV0ZXJGaWxlKSB7CiAgICAgICAgICAgICRTZXJ2ZXJzID0gR2V0LUNvbnRlbnQgLVBhdGggJENvbXB1dGVyRmlsZQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgIyBvdGhlcndpc2UgYXNzdW1lIGEgc2luZ2xlIGhvc3QgbmFtZQogICAgICAgICAgICAkU2VydmVycyArPSAkQ29tcHV0ZXJOYW1lIHwgR2V0LU5hbWVGaWVsZAogICAgICAgIH0KCiAgICAgICAgIyBxdWVyeSB0aGUgc3BlY2lmaWVkIGdyb3VwIHVzaW5nIHRoZSBXSU5OVCBwcm92aWRlciwgYW5kCiAgICAgICAgIyBleHRyYWN0IGZpZWxkcyBhcyBhcHByb3ByaWF0ZSBmcm9tIHRoZSByZXN1bHRzCiAgICAgICAgRm9yRWFjaCgkU2VydmVyIGluICRTZXJ2ZXJzKSB7CgogICAgICAgICAgICBpZigkQVBJKSB7CiAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIHVzaW5nIHRoZSBOZXRhcGkzMiBOZXRMb2NhbEdyb3VwR2V0TWVtYmVycyBBUEkgY2FsbCB0byBnZXQgdGhlIGxvY2FsIGdyb3VwIGluZm9ybWF0aW9uCgogICAgICAgICAgICAgICAgIyBhcmd1bWVudHMgZm9yIE5ldExvY2FsR3JvdXBHZXRNZW1iZXJzCiAgICAgICAgICAgICAgICAkUXVlcnlMZXZlbCA9IDIKICAgICAgICAgICAgICAgICRQdHJJbmZvID0gW0ludFB0cl06Olplcm8KICAgICAgICAgICAgICAgICRFbnRyaWVzUmVhZCA9IDAKICAgICAgICAgICAgICAgICRUb3RhbFJlYWQgPSAwCiAgICAgICAgICAgICAgICAkUmVzdW1lSGFuZGxlID0gMAoKICAgICAgICAgICAgICAgICMgZ2V0IHRoZSBsb2NhbCB1c2VyIGluZm9ybWF0aW9uCiAgICAgICAgICAgICAgICAkUmVzdWx0ID0gJE5ldGFwaTMyOjpOZXRMb2NhbEdyb3VwR2V0TWVtYmVycygkU2VydmVyLCAkR3JvdXBOYW1lLCAkUXVlcnlMZXZlbCwgW3JlZl0kUHRySW5mbywgLTEsIFtyZWZdJEVudHJpZXNSZWFkLCBbcmVmXSRUb3RhbFJlYWQsIFtyZWZdJFJlc3VtZUhhbmRsZSkKCiAgICAgICAgICAgICAgICAjIExvY2F0ZSB0aGUgb2Zmc2V0IG9mIHRoZSBpbml0aWFsIGludFB0cgogICAgICAgICAgICAgICAgJE9mZnNldCA9ICRQdHJJbmZvLlRvSW50NjQoKQoKICAgICAgICAgICAgICAgICRMb2NhbFVzZXJzID0gQCgpCgogICAgICAgICAgICAgICAgIyAwID0gc3VjY2VzcwogICAgICAgICAgICAgICAgaWYgKCgkUmVzdWx0IC1lcSAwKSAtYW5kICgkT2Zmc2V0IC1ndCAwKSkgewoKICAgICAgICAgICAgICAgICAgICAjIFdvcmsgb3V0IGhvdyBtdXRjaCB0byBpbmNyZW1lbnQgdGhlIHBvaW50ZXIgYnkgZmluZGluZyBvdXQgdGhlIHNpemUgb2YgdGhlIHN0cnVjdHVyZQogICAgICAgICAgICAgICAgICAgICRJbmNyZW1lbnQgPSAkTE9DQUxHUk9VUF9NRU1CRVJTX0lORk9fMjo6R2V0U2l6ZSgpCgogICAgICAgICAgICAgICAgICAgICMgcGFyc2UgYWxsIHRoZSByZXN1bHQgc3RydWN0dXJlcwogICAgICAgICAgICAgICAgICAgIGZvciAoJGkgPSAwOyAoJGkgLWx0ICRFbnRyaWVzUmVhZCk7ICRpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBjcmVhdGUgYSBuZXcgaW50IHB0ciBhdCB0aGUgZ2l2ZW4gb2Zmc2V0IGFuZCBjYXN0IHRoZSBwb2ludGVyIGFzIG91ciByZXN1bHQgc3RydWN0dXJlCiAgICAgICAgICAgICAgICAgICAgICAgICROZXdJbnRQdHIgPSBOZXctT2JqZWN0IFN5c3RlbS5JbnRwdHIgLUFyZ3VtZW50TGlzdCAkT2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICRJbmZvID0gJE5ld0ludFB0ciAtYXMgJExPQ0FMR1JPVVBfTUVNQkVSU19JTkZPXzIKCiAgICAgICAgICAgICAgICAgICAgICAgICRPZmZzZXQgPSAkTmV3SW50UHRyLlRvSW50NjQoKQogICAgICAgICAgICAgICAgICAgICAgICAkT2Zmc2V0ICs9ICRJbmNyZW1lbnQKCiAgICAgICAgICAgICAgICAgICAgICAgICRTaWRTdHJpbmcgPSAiIgogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0MiA9ICRBZHZhcGkzMjo6Q29udmVydFNpZFRvU3RyaW5nU2lkKCRJbmZvLmxncm1pMl9zaWQsIFtyZWZdJFNpZFN0cmluZyk7JExhc3RFcnJvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0TGFzdFdpbjMyRXJyb3IoKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJFJlc3VsdDIgLWVxIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yOiAkKChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpLk1lc3NhZ2UpIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkU2VydmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWxVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0FjY291bnROYW1lJyAkSW5mby5sZ3JtaTJfZG9tYWluYW5kbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTSUQnICRTaWRTdHJpbmcKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSXNHcm91cCA9ICQoJEluZm8ubGdybWkyX3NpZHVzYWdlIC1lcSAnU2lkVHlwZUdyb3VwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSXNHcm91cCcgJElzR3JvdXAKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWxVc2VyLlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5Mb2NhbFVzZXInKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbFVzZXJzICs9ICRMb2NhbFVzZXIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgIyBmcmVlIHVwIHRoZSByZXN1bHQgYnVmZmVyCiAgICAgICAgICAgICAgICAgICAgJE51bGwgPSAkTmV0YXBpMzI6Ok5ldEFwaUJ1ZmZlckZyZWUoJFB0ckluZm8pCgogICAgICAgICAgICAgICAgICAgICMgdHJ5IHRvIGV4dHJhY3Qgb3V0IHRoZSBtYWNoaW5lIFNJRCBieSB1c2luZyB0aGUgLTUwMCBhY2NvdW50IGFzIGEgcmVmZXJlbmNlCiAgICAgICAgICAgICAgICAgICAgJE1hY2hpbmVTaWQgPSAkTG9jYWxVc2VycyB8IFdoZXJlLU9iamVjdCB7JF8uU0lEIC1saWtlICcqLTUwMCd9CiAgICAgICAgICAgICAgICAgICAgJFBhcnRzID0gJE1hY2hpbmVTaWQuU0lELlNwbGl0KCctJykKICAgICAgICAgICAgICAgICAgICAkTWFjaGluZVNpZCA9ICRQYXJ0c1swLi4oJFBhcnRzLkxlbmd0aCAtMildIC1qb2luICctJwoKICAgICAgICAgICAgICAgICAgICAkTG9jYWxVc2VycyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJF8uU0lEIC1tYXRjaCAkTWFjaGluZVNpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJF8gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSXNEb21haW4nICRGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJF8gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSXNEb21haW4nICRUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJExvY2FsVXNlcnMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yOiAkKChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRSZXN1bHQpLk1lc3NhZ2UpIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICMgb3RoZXJ3aXNlIHdlJ3JlIHVzaW5nIHRoZSBXaW5OVCBzZXJ2aWNlIHByb3ZpZGVyCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGlmKCRMaXN0R3JvdXBzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgd2UncmUgbGlzdGluZyB0aGUgZ3JvdXAgbmFtZXMgb24gYSByZW1vdGUgc2VydmVyCiAgICAgICAgICAgICAgICAgICAgICAgICRDb21wdXRlciA9IFtBRFNJXSJXaW5OVDovLyRTZXJ2ZXIsY29tcHV0ZXIiCgogICAgICAgICAgICAgICAgICAgICAgICAkQ29tcHV0ZXIucHNiYXNlLmNoaWxkcmVuIHwgV2hlcmUtT2JqZWN0IHsgJF8ucHNiYXNlLnNjaGVtYUNsYXNzTmFtZSAtZXEgJ2dyb3VwJyB9IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NlcnZlcicgJFNlcnZlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dyb3VwJyAoJF8ubmFtZVswXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTSUQnICgoTmV3LU9iamVjdCBTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllciAkXy5vYmplY3RzaWRbMF0sMCkuVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRGVzY3JpcHRpb24nICgkXy5EZXNjcmlwdGlvblswXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cC5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuTG9jYWxHcm91cCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBvdGhlcndpc2Ugd2UncmUgbGlzdGluZyB0aGUgZ3JvdXAgbWVtYmVycwogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVycyA9IEAoJChbQURTSV0iV2luTlQ6Ly8kU2VydmVyLyRHcm91cE5hbWUsZ3JvdXAiKS5wc2Jhc2UuSW52b2tlKCdNZW1iZXJzJykpCgogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVycyB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRTZXJ2ZXIKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQWRzUGF0aCA9ICgkXy5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCdBZHNwYXRoJywgJ0dldFByb3BlcnR5JywgJE51bGwsICRfLCAkTnVsbCkpLlJlcGxhY2UoJ1dpbk5UOi8vJywgJycpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyB0cnkgdG8gdHJhbnNsYXRlIHRoZSBOVDQgZG9tYWluIHRvIGEgRlFETiBpZiBwb3NzaWJsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE5hbWUgPSBDb252ZXJ0LUFETmFtZSAtT2JqZWN0TmFtZSAkQWRzUGF0aCAtSW5wdXRUeXBlICdOVDQnIC1PdXRwdXRUeXBlICdDYW5vbmljYWwnCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRlFETiA9ICROYW1lLnNwbGl0KCIvIilbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkT2JqTmFtZSA9ICRBZHNQYXRoLnNwbGl0KCIvIilbLTFdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE5hbWUgPSAiJEZRRE4vJE9iak5hbWUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJElzRG9tYWluID0gJFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICROYW1lID0gJEFkc1BhdGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSXNEb21haW4gPSAkRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0FjY291bnROYW1lJyAkTmFtZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRJc0RvbWFpbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgdHJhbnNsYXRlIHRoZSBiaW5hcnkgc2lkIHRvIGEgc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTSUQnICgoTmV3LU9iamVjdCBTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcigkXy5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCdPYmplY3RTSUQnLCAnR2V0UHJvcGVydHknLCAkTnVsbCwgJF8sICROdWxsKSwwKSkuVmFsdWUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRGVzY3JpcHRpb24nICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEaXNhYmxlZCcgJEZhbHNlCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgY2hlY2sgaWYgdGhlIG1lbWJlciBpcyBhIGdyb3VwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJElzR3JvdXAgPSAoJF8uR2V0VHlwZSgpLkludm9rZU1lbWJlcignQ2xhc3MnLCAnR2V0UHJvcGVydHknLCAkTnVsbCwgJF8sICROdWxsKSAtZXEgJ2dyb3VwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzR3JvdXAnICRJc0dyb3VwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0RvbWFpbicgJElzRG9tYWluCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRJc0dyb3VwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTGFzdExvZ2luJyAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTGFzdExvZ2luJyAoICRfLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoJ0xhc3RMb2dpbicsICdHZXRQcm9wZXJ0eScsICROdWxsLCAkXywgJE51bGwpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTGFzdExvZ2luJyAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUHdkTGFzdFNldCcgIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1B3ZEV4cGlyZWQnICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyRmxhZ3MnICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHJlcHVsbCB0aGlzIHVzZXIgb2JqZWN0IHNvIHdlIGNhbiBlbnN1cmUgY29ycmVjdCBpbmZvcm1hdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbFVzZXIgPSAkKFtBRFNJXSAiV2luTlQ6Ly8kQWRzUGF0aCIpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgdHJhbnNsYXRlIHRoZSBiaW5hcnkgc2lkIHRvIGEgc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTSUQnICgoTmV3LU9iamVjdCBTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcigkTG9jYWxVc2VyLm9iamVjdFNpZC52YWx1ZSwwKSkuVmFsdWUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRGVzY3JpcHRpb24nICgkTG9jYWxVc2VyLkRlc2NyaXB0aW9uWzBdKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFVBQyBmbGFncyBvZiAweDIgbWVhbiB0aGUgYWNjb3VudCBpcyBkaXNhYmxlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRGlzYWJsZWQnICQoKCRMb2NhbFVzZXIudXNlckZsYWdzLnZhbHVlIC1iYW5kIDIpIC1lcSAyKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIHRoZSBtZW1iZXIgaXMgYSBncm91cAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSXNHcm91cCcgKCRMb2NhbFVzZXIuU2NoZW1hQ2xhc3NOYW1lIC1saWtlICdncm91cCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0RvbWFpbicgJElzRG9tYWluCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRJc0dyb3VwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTGFzdExvZ2luJyAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTGFzdExvZ2luJyAoICRMb2NhbFVzZXIuTGFzdExvZ2luWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTGFzdExvZ2luJyAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1B3ZExhc3RTZXQnICggKEdldC1EYXRlKS5BZGRTZWNvbmRzKC0kTG9jYWxVc2VyLlBhc3N3b3JkQWdlWzBdKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1B3ZEV4cGlyZWQnICggJExvY2FsVXNlci5QYXNzd29yZEV4cGlyZWRbMF0gLWVxICcxJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJGbGFncycgKCAkTG9jYWxVc2VyLlVzZXJGbGFnc1swXSApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyLlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5Mb2NhbFVzZXInKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlcgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgdGhlIHJlc3VsdCBpcyBhIGdyb3VwIGRvbWFpbiBvYmplY3QgYW5kIHdlJ3JlIHJlY3Vyc2luZywgdHJ5IHRvIHJlc29sdmUgYWxsIHRoZSBncm91cCBtZW1iZXIgcmVzdWx0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJFJlY3Vyc2UgLWFuZCAkSXNEb21haW4gLWFuZCAkSXNHcm91cCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRlFETiA9ICROYW1lLnNwbGl0KCIvIilbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBOYW1lID0gJE5hbWUuc3BsaXQoIi8iKVsxXS50cmltKCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR2V0LU5ldEdyb3VwTWVtYmVyIC1Hcm91cE5hbWUgJEdyb3VwTmFtZSAtRG9tYWluICRGUUROIC1GdWxsRGF0YSAtUmVjdXJzZSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAiJEZRRE4vJCgkXy5Hcm91cE5hbWUpIgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlckROID0gJF8uZGlzdGluZ3Vpc2hlZE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBleHRyYWN0IHRoZSBGUUROIGZyb20gdGhlIERpc3Rpbmd1aXNoZWQgTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRG9tYWluID0gJE1lbWJlckROLnN1YlN0cmluZygkTWVtYmVyRE4uSW5kZXhPZigiREM9IikpIC1yZXBsYWNlICdEQz0nLCcnIC1yZXBsYWNlICcsJywnLicKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJJc0dyb3VwID0gQCgnMjY4NDM1NDU2JywnMjY4NDM1NDU3JywnNTM2ODcwOTEyJywnNTM2ODcwOTEzJykgLWNvbnRhaW5zICRfLnNhbWFjY291bnR0eXBlCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF8uc2FtQWNjb3VudE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgZm9yZXN0IHVzZXJzIGhhdmUgdGhlIHNhbUFjY291bnROYW1lIHNldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlck5hbWUgPSAkXy5zYW1BY2NvdW50TmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGV4dGVybmFsIHRydXN0IHVzZXJzIGhhdmUgYSBTSUQsIHNvIGNvbnZlcnQgaXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyTmFtZSA9IENvbnZlcnQtU2lkVG9OYW1lICRfLmNuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBpZiB0aGVyZSdzIGEgcHJvYmxlbSBjb250YWN0aW5nIHRoZSBkb21haW4gdG8gcmVzb2x2ZSB0aGUgU0lECiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJOYW1lID0gJF8uY24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgcmVzb2x2aW5nIFNJRCA6ICRfIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0FjY291bnROYW1lJyAiJE1lbWJlckRvbWFpbi8kTWVtYmVyTmFtZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTSUQnICRfLm9iamVjdHNpZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0Rlc2NyaXB0aW9uJyAkXy5kZXNjcmlwdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0Rpc2FibGVkJyAkRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0dyb3VwJyAkTWVtYmVySXNHcm91cAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzRG9tYWluJyAkVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0xhc3RMb2dpbicgJycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdQd2RMYXN0U2V0JyAkXy5wd2RMYXN0U2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUHdkRXhwaXJlZCcgJycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyRmxhZ3MnICRfLnVzZXJBY2NvdW50Q29udHJvbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyLlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5Mb2NhbFVzZXInKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIlshXSBFcnJvcjogJF8iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmaWx0ZXIgR2V0LU5ldFNoYXJlIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHdpbGwgZXhlY3V0ZSB0aGUgTmV0U2hhcmVFbnVtIFdpbjMyQVBJIGNhbGwgdG8gcXVlcnkKICAgICAgICBhIGdpdmVuIGhvc3QgZm9yIG9wZW4gc2hhcmVzLiBUaGlzIGlzIGEgcmVwbGFjZW1lbnQgZm9yCiAgICAgICAgIm5ldCBzaGFyZSBcXGhvc3RuYW1lIgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBob3N0bmFtZSB0byBxdWVyeSBmb3Igc2hhcmVzLiBBbHNvIGFjY2VwdHMgSVAgYWRkcmVzc2VzLgoKICAgIC5PVVRQVVRTCgogICAgICAgIFNIQVJFX0lORk9fMSBzdHJ1Y3R1cmUuIEEgcmVwcmVzZW50YXRpb24gb2YgdGhlIFNIQVJFX0lORk9fMQogICAgICAgIHJlc3VsdCBzdHJ1Y3R1cmUgd2hpY2ggaW5jbHVkZXMgdGhlIG5hbWUgYW5kIG5vdGUgZm9yIGVhY2ggc2hhcmUsCiAgICAgICAgd2l0aCB0aGUgQ29tcHV0ZXJOYW1lIGFkZGVkLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldFNoYXJlCgogICAgICAgIFJldHVybnMgYWN0aXZlIHNoYXJlcyBvbiB0aGUgbG9jYWwgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRTaGFyZSAtQ29tcHV0ZXJOYW1lIHNxbHNlcnZlcgoKICAgICAgICBSZXR1cm5zIGFjdGl2ZSBzaGFyZXMgb24gdGhlICdzcWxzZXJ2ZXInIGhvc3QKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRDb21wdXRlciB8IEdldC1OZXRTaGFyZQoKICAgICAgICBSZXR1cm5zIGFsbCBzaGFyZXMgZm9yIGFsbCBjb21wdXRlcnMgaW4gdGhlIGRvbWFpbi4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vd3d3LnBvd2Vyc2hlbGxtYWdhemluZS5jb20vMjAxNC8wOS8yNS9lYXNpbHktZGVmaW5pbmctZW51bXMtc3RydWN0cy1hbmQtd2luMzItZnVuY3Rpb25zLWluLW1lbW9yeS8KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtPYmplY3RbXV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnbG9jYWxob3N0JwogICAgKQoKICAgICMgZXh0cmFjdCB0aGUgY29tcHV0ZXIgbmFtZSBmcm9tIHdoYXRldmVyIG9iamVjdCB3YXMgcGFzc2VkIG9uIHRoZSBwaXBlbGluZQogICAgJENvbXB1dGVyID0gJENvbXB1dGVyTmFtZSB8IEdldC1OYW1lRmllbGQKCiAgICAjIGFyZ3VtZW50cyBmb3IgTmV0U2hhcmVFbnVtCiAgICAkUXVlcnlMZXZlbCA9IDEKICAgICRQdHJJbmZvID0gW0ludFB0cl06Olplcm8KICAgICRFbnRyaWVzUmVhZCA9IDAKICAgICRUb3RhbFJlYWQgPSAwCiAgICAkUmVzdW1lSGFuZGxlID0gMAoKICAgICMgZ2V0IHRoZSBzaGFyZSBpbmZvcm1hdGlvbgogICAgJFJlc3VsdCA9ICROZXRhcGkzMjo6TmV0U2hhcmVFbnVtKCRDb21wdXRlciwgJFF1ZXJ5TGV2ZWwsIFtyZWZdJFB0ckluZm8sIC0xLCBbcmVmXSRFbnRyaWVzUmVhZCwgW3JlZl0kVG90YWxSZWFkLCBbcmVmXSRSZXN1bWVIYW5kbGUpCgogICAgIyBMb2NhdGUgdGhlIG9mZnNldCBvZiB0aGUgaW5pdGlhbCBpbnRQdHIKICAgICRPZmZzZXQgPSAkUHRySW5mby5Ub0ludDY0KCkKCiAgICAjIDAgPSBzdWNjZXNzCiAgICBpZiAoKCRSZXN1bHQgLWVxIDApIC1hbmQgKCRPZmZzZXQgLWd0IDApKSB7CgogICAgICAgICMgV29yayBvdXQgaG93IG11dGNoIHRvIGluY3JlbWVudCB0aGUgcG9pbnRlciBieSBmaW5kaW5nIG91dCB0aGUgc2l6ZSBvZiB0aGUgc3RydWN0dXJlCiAgICAgICAgJEluY3JlbWVudCA9ICRTSEFSRV9JTkZPXzE6OkdldFNpemUoKQoKICAgICAgICAjIHBhcnNlIGFsbCB0aGUgcmVzdWx0IHN0cnVjdHVyZXMKICAgICAgICBmb3IgKCRpID0gMDsgKCRpIC1sdCAkRW50cmllc1JlYWQpOyAkaSsrKSB7CiAgICAgICAgICAgICMgY3JlYXRlIGEgbmV3IGludCBwdHIgYXQgdGhlIGdpdmVuIG9mZnNldCBhbmQgY2FzdCB0aGUgcG9pbnRlciBhcyBvdXIgcmVzdWx0IHN0cnVjdHVyZQogICAgICAgICAgICAkTmV3SW50UHRyID0gTmV3LU9iamVjdCBTeXN0ZW0uSW50cHRyIC1Bcmd1bWVudExpc3QgJE9mZnNldAogICAgICAgICAgICAkSW5mbyA9ICROZXdJbnRQdHIgLWFzICRTSEFSRV9JTkZPXzEKCiAgICAgICAgICAgICMgcmV0dXJuIGFsbCB0aGUgc2VjdGlvbnMgb2YgdGhlIHN0cnVjdHVyZQogICAgICAgICAgICAkU2hhcmVzID0gJEluZm8gfCBTZWxlY3QtT2JqZWN0ICoKICAgICAgICAgICAgJFNoYXJlcyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgogICAgICAgICAgICAkT2Zmc2V0ID0gJE5ld0ludFB0ci5Ub0ludDY0KCkKICAgICAgICAgICAgJE9mZnNldCArPSAkSW5jcmVtZW50CiAgICAgICAgICAgICRTaGFyZXMKICAgICAgICB9CgogICAgICAgICMgZnJlZSB1cCB0aGUgcmVzdWx0IGJ1ZmZlcgogICAgICAgICROdWxsID0gJE5ldGFwaTMyOjpOZXRBcGlCdWZmZXJGcmVlKCRQdHJJbmZvKQogICAgfQogICAgZWxzZSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3I6ICQoKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJFJlc3VsdCkuTWVzc2FnZSkiCiAgICB9Cn0KCgpmaWx0ZXIgR2V0LU5ldExvZ2dlZG9uIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHdpbGwgZXhlY3V0ZSB0aGUgTmV0V2tzdGFVc2VyRW51bSBXaW4zMkFQSSBjYWxsIHRvIHF1ZXJ5CiAgICAgICAgYSBnaXZlbiBob3N0IGZvciBhY3RpdmVseSBsb2dnZWQgb24gdXNlcnMuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGhvc3RuYW1lIHRvIHF1ZXJ5IGZvciBsb2dnZWQgb24gdXNlcnMuCgogICAgLk9VVFBVVFMKCiAgICAgICAgV0tTVEFfVVNFUl9JTkZPXzEgc3RydWN0dXJlLiBBIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBXS1NUQV9VU0VSX0lORk9fMQogICAgICAgIHJlc3VsdCBzdHJ1Y3R1cmUgd2hpY2ggaW5jbHVkZXMgdGhlIHVzZXJuYW1lIGFuZCBkb21haW4gb2YgbG9nZ2VkIG9uIHVzZXJzLAogICAgICAgIHdpdGggdGhlIENvbXB1dGVyTmFtZSBhZGRlZC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRMb2dnZWRvbgoKICAgICAgICBSZXR1cm5zIHVzZXJzIGFjdGl2ZWx5IGxvZ2dlZCBvbnRvIHRoZSBsb2NhbCBob3N0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldExvZ2dlZG9uIC1Db21wdXRlck5hbWUgc3Fsc2VydmVyCgogICAgICAgIFJldHVybnMgdXNlcnMgYWN0aXZlbHkgbG9nZ2VkIG9udG8gdGhlICdzcWxzZXJ2ZXInIGhvc3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Q29tcHV0ZXIgfCBHZXQtTmV0TG9nZ2Vkb24KCiAgICAgICAgUmV0dXJucyBhbGwgbG9nZ2VkIG9uIHVzZXJzZSBmb3IgYWxsIGNvbXB1dGVycyBpbiB0aGUgZG9tYWluLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly93d3cucG93ZXJzaGVsbG1hZ2F6aW5lLmNvbS8yMDE0LzA5LzI1L2Vhc2lseS1kZWZpbmluZy1lbnVtcy1zdHJ1Y3RzLWFuZC13aW4zMi1mdW5jdGlvbnMtaW4tbWVtb3J5LwojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3ROYW1lJyldCiAgICAgICAgW09iamVjdFtdXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICdsb2NhbGhvc3QnCiAgICApCgogICAgIyBleHRyYWN0IHRoZSBjb21wdXRlciBuYW1lIGZyb20gd2hhdGV2ZXIgb2JqZWN0IHdhcyBwYXNzZWQgb24gdGhlIHBpcGVsaW5lCiAgICAkQ29tcHV0ZXIgPSAkQ29tcHV0ZXJOYW1lIHwgR2V0LU5hbWVGaWVsZAoKICAgICMgRGVjbGFyZSB0aGUgcmVmZXJlbmNlIHZhcmlhYmxlcwogICAgJFF1ZXJ5TGV2ZWwgPSAxCiAgICAkUHRySW5mbyA9IFtJbnRQdHJdOjpaZXJvCiAgICAkRW50cmllc1JlYWQgPSAwCiAgICAkVG90YWxSZWFkID0gMAogICAgJFJlc3VtZUhhbmRsZSA9IDAKCiAgICAjIGdldCBsb2dnZWQgb24gdXNlciBpbmZvcm1hdGlvbgogICAgJFJlc3VsdCA9ICROZXRhcGkzMjo6TmV0V2tzdGFVc2VyRW51bSgkQ29tcHV0ZXIsICRRdWVyeUxldmVsLCBbcmVmXSRQdHJJbmZvLCAtMSwgW3JlZl0kRW50cmllc1JlYWQsIFtyZWZdJFRvdGFsUmVhZCwgW3JlZl0kUmVzdW1lSGFuZGxlKQoKICAgICMgTG9jYXRlIHRoZSBvZmZzZXQgb2YgdGhlIGluaXRpYWwgaW50UHRyCiAgICAkT2Zmc2V0ID0gJFB0ckluZm8uVG9JbnQ2NCgpCgogICAgIyAwID0gc3VjY2VzcwogICAgaWYgKCgkUmVzdWx0IC1lcSAwKSAtYW5kICgkT2Zmc2V0IC1ndCAwKSkgewoKICAgICAgICAjIFdvcmsgb3V0IGhvdyBtdXRjaCB0byBpbmNyZW1lbnQgdGhlIHBvaW50ZXIgYnkgZmluZGluZyBvdXQgdGhlIHNpemUgb2YgdGhlIHN0cnVjdHVyZQogICAgICAgICRJbmNyZW1lbnQgPSAkV0tTVEFfVVNFUl9JTkZPXzE6OkdldFNpemUoKQoKICAgICAgICAjIHBhcnNlIGFsbCB0aGUgcmVzdWx0IHN0cnVjdHVyZXMKICAgICAgICBmb3IgKCRpID0gMDsgKCRpIC1sdCAkRW50cmllc1JlYWQpOyAkaSsrKSB7CiAgICAgICAgICAgICMgY3JlYXRlIGEgbmV3IGludCBwdHIgYXQgdGhlIGdpdmVuIG9mZnNldCBhbmQgY2FzdCB0aGUgcG9pbnRlciBhcyBvdXIgcmVzdWx0IHN0cnVjdHVyZQogICAgICAgICAgICAkTmV3SW50UHRyID0gTmV3LU9iamVjdCBTeXN0ZW0uSW50cHRyIC1Bcmd1bWVudExpc3QgJE9mZnNldAogICAgICAgICAgICAkSW5mbyA9ICROZXdJbnRQdHIgLWFzICRXS1NUQV9VU0VSX0lORk9fMQoKICAgICAgICAgICAgIyByZXR1cm4gYWxsIHRoZSBzZWN0aW9ucyBvZiB0aGUgc3RydWN0dXJlCiAgICAgICAgICAgICRMb2dnZWRPbiA9ICRJbmZvIHwgU2VsZWN0LU9iamVjdCAqCiAgICAgICAgICAgICRMb2dnZWRPbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgogICAgICAgICAgICAkT2Zmc2V0ID0gJE5ld0ludFB0ci5Ub0ludDY0KCkKICAgICAgICAgICAgJE9mZnNldCArPSAkSW5jcmVtZW50CiAgICAgICAgICAgICRMb2dnZWRPbgogICAgICAgIH0KCiAgICAgICAgIyBmcmVlIHVwIHRoZSByZXN1bHQgYnVmZmVyCiAgICAgICAgJE51bGwgPSAkTmV0YXBpMzI6Ok5ldEFwaUJ1ZmZlckZyZWUoJFB0ckluZm8pCiAgICB9CiAgICBlbHNlIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvcjogJCgoW0NvbXBvbmVudE1vZGVsLldpbjMyRXhjZXB0aW9uXSAkUmVzdWx0KS5NZXNzYWdlKSIKICAgIH0KfQoKCmZpbHRlciBHZXQtTmV0U2Vzc2lvbiB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiB3aWxsIGV4ZWN1dGUgdGhlIE5ldFNlc3Npb25FbnVtIFdpbjMyQVBJIGNhbGwgdG8gcXVlcnkKICAgICAgICBhIGdpdmVuIGhvc3QgZm9yIGFjdGl2ZSBzZXNzaW9ucyBvbiB0aGUgaG9zdC4KICAgICAgICBIZWF2aWx5IGFkYXB0ZWQgZnJvbSBkdW5lZGluaXRlJ3MgcG9zdCBvbiBzdGFja292ZXJmbG93IChzZWUgTElOSyBiZWxvdykKCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBUaGUgQ29tcHV0ZXJOYW1lIHRvIHF1ZXJ5IGZvciBhY3RpdmUgc2Vzc2lvbnMuCgogICAgLlBBUkFNRVRFUiBVc2VyTmFtZQoKICAgICAgICBUaGUgdXNlciBuYW1lIHRvIGZpbHRlciBmb3IgYWN0aXZlIHNlc3Npb25zLgoKICAgIC5PVVRQVVRTCgogICAgICAgIFNFU1NJT05fSU5GT18xMCBzdHJ1Y3R1cmUuIEEgcmVwcmVzZW50YXRpb24gb2YgdGhlIFNFU1NJT05fSU5GT18xMAogICAgICAgIHJlc3VsdCBzdHJ1Y3R1cmUgd2hpY2ggaW5jbHVkZXMgdGhlIGhvc3QgYW5kIHVzZXJuYW1lIGFzc29jaWF0ZWQKICAgICAgICB3aXRoIGFjdGl2ZSBzZXNzaW9ucywgd2l0aCB0aGUgQ29tcHV0ZXJOYW1lIGFkZGVkLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldFNlc3Npb24KCiAgICAgICAgUmV0dXJucyBhY3RpdmUgc2Vzc2lvbnMgb24gdGhlIGxvY2FsIGhvc3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0U2Vzc2lvbiAtQ29tcHV0ZXJOYW1lIHNxbHNlcnZlcgoKICAgICAgICBSZXR1cm5zIGFjdGl2ZSBzZXNzaW9ucyBvbiB0aGUgJ3NxbHNlcnZlcicgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXREb21haW5Db250cm9sbGVyIHwgR2V0LU5ldFNlc3Npb24KCiAgICAgICAgUmV0dXJucyBhY3RpdmUgc2Vzc2lvbnMgb24gYWxsIGRvbWFpbiBjb250cm9sbGVycy4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vd3d3LnBvd2Vyc2hlbGxtYWdhemluZS5jb20vMjAxNC8wOS8yNS9lYXNpbHktZGVmaW5pbmctZW51bXMtc3RydWN0cy1hbmQtd2luMzItZnVuY3Rpb25zLWluLW1lbW9yeS8KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtPYmplY3RbXV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnbG9jYWxob3N0JywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlck5hbWUgPSAnJwogICAgKQoKICAgICMgZXh0cmFjdCB0aGUgY29tcHV0ZXIgbmFtZSBmcm9tIHdoYXRldmVyIG9iamVjdCB3YXMgcGFzc2VkIG9uIHRoZSBwaXBlbGluZQogICAgJENvbXB1dGVyID0gJENvbXB1dGVyTmFtZSB8IEdldC1OYW1lRmllbGQKCiAgICAjIGFyZ3VtZW50cyBmb3IgTmV0U2Vzc2lvbkVudW0KICAgICRRdWVyeUxldmVsID0gMTAKICAgICRQdHJJbmZvID0gW0ludFB0cl06Olplcm8KICAgICRFbnRyaWVzUmVhZCA9IDAKICAgICRUb3RhbFJlYWQgPSAwCiAgICAkUmVzdW1lSGFuZGxlID0gMAoKICAgICMgZ2V0IHNlc3Npb24gaW5mb3JtYXRpb24KICAgICRSZXN1bHQgPSAkTmV0YXBpMzI6Ok5ldFNlc3Npb25FbnVtKCRDb21wdXRlciwgJycsICRVc2VyTmFtZSwgJFF1ZXJ5TGV2ZWwsIFtyZWZdJFB0ckluZm8sIC0xLCBbcmVmXSRFbnRyaWVzUmVhZCwgW3JlZl0kVG90YWxSZWFkLCBbcmVmXSRSZXN1bWVIYW5kbGUpCgogICAgIyBMb2NhdGUgdGhlIG9mZnNldCBvZiB0aGUgaW5pdGlhbCBpbnRQdHIKICAgICRPZmZzZXQgPSAkUHRySW5mby5Ub0ludDY0KCkKCiAgICAjIDAgPSBzdWNjZXNzCiAgICBpZiAoKCRSZXN1bHQgLWVxIDApIC1hbmQgKCRPZmZzZXQgLWd0IDApKSB7CgogICAgICAgICMgV29yayBvdXQgaG93IG11dGNoIHRvIGluY3JlbWVudCB0aGUgcG9pbnRlciBieSBmaW5kaW5nIG91dCB0aGUgc2l6ZSBvZiB0aGUgc3RydWN0dXJlCiAgICAgICAgJEluY3JlbWVudCA9ICRTRVNTSU9OX0lORk9fMTA6OkdldFNpemUoKQoKICAgICAgICAjIHBhcnNlIGFsbCB0aGUgcmVzdWx0IHN0cnVjdHVyZXMKICAgICAgICBmb3IgKCRpID0gMDsgKCRpIC1sdCAkRW50cmllc1JlYWQpOyAkaSsrKSB7CiAgICAgICAgICAgICMgY3JlYXRlIGEgbmV3IGludCBwdHIgYXQgdGhlIGdpdmVuIG9mZnNldCBhbmQgY2FzdCB0aGUgcG9pbnRlciBhcyBvdXIgcmVzdWx0IHN0cnVjdHVyZQogICAgICAgICAgICAkTmV3SW50UHRyID0gTmV3LU9iamVjdCBTeXN0ZW0uSW50cHRyIC1Bcmd1bWVudExpc3QgJE9mZnNldAogICAgICAgICAgICAkSW5mbyA9ICROZXdJbnRQdHIgLWFzICRTRVNTSU9OX0lORk9fMTAKCiAgICAgICAgICAgICMgcmV0dXJuIGFsbCB0aGUgc2VjdGlvbnMgb2YgdGhlIHN0cnVjdHVyZQogICAgICAgICAgICAkU2Vzc2lvbnMgPSAkSW5mbyB8IFNlbGVjdC1PYmplY3QgKgogICAgICAgICAgICAkU2Vzc2lvbnMgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXIKICAgICAgICAgICAgJE9mZnNldCA9ICROZXdJbnRQdHIuVG9JbnQ2NCgpCiAgICAgICAgICAgICRPZmZzZXQgKz0gJEluY3JlbWVudAogICAgICAgICAgICAkU2Vzc2lvbnMKICAgICAgICB9CiAgICAgICAgIyBmcmVlIHVwIHRoZSByZXN1bHQgYnVmZmVyCiAgICAgICAgJE51bGwgPSAkTmV0YXBpMzI6Ok5ldEFwaUJ1ZmZlckZyZWUoJFB0ckluZm8pCiAgICB9CiAgICBlbHNlIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvcjogJCgoW0NvbXBvbmVudE1vZGVsLldpbjMyRXhjZXB0aW9uXSAkUmVzdWx0KS5NZXNzYWdlKSIKICAgIH0KfQoKCmZpbHRlciBHZXQtTG9nZ2VkT25Mb2NhbCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiB3aWxsIHF1ZXJ5IHRoZSBIS1UgcmVnaXN0cnkgdmFsdWVzIHRvIHJldHJpZXZlIHRoZSBsb2NhbAogICAgICAgIGxvZ2dlZCBvbiB1c2VycyBTSUQgYW5kIHRoZW4gYXR0ZW1wdCBhbmQgcmV2ZXJzZSBpdC4KICAgICAgICBBZGFwdGVkIHRlY2huaXF1ZSBmcm9tIFN5c2ludGVybmFsJ3MgUFNMb2dnZWRPbiBzY3JpcHQuIEJlbmVmaXQgb3ZlcgogICAgICAgIHVzaW5nIHRoZSBOZXRXa3N0YVVzZXJFbnVtIEFQSSAoR2V0LU5ldExvZ2dlZG9uKSBvZiBsZXNzIHVzZXIgcHJpdmlsZWdlcwogICAgICAgIHJlcXVpcmVkIChOZXRXa3N0YVVzZXJFbnVtIHJlcXVpcmVzIHJlbW90ZSBhZG1pbiBhY2Nlc3MpLgoKICAgICAgICBOb3RlOiBUaGlzIGZ1bmN0aW9uIHJlcXVpcmVzIG9ubHkgZG9tYWluIHVzZXIgcmlnaHRzIG9uIHRoZQogICAgICAgIG1hY2hpbmUgeW91J3JlIGVudW1lcmF0aW5nLCBidXQgcmVtb3RlIHJlZ2lzdHJ5IG11c3QgYmUgZW5hYmxlZC4KCiAgICAgICAgRnVuY3Rpb246IEdldC1Mb2dnZWRPbkxvY2FsCiAgICAgICAgQXV0aG9yOiBNYXR0IEtlbGx5LCBAQnJlYWtlcnNBbGwKCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBUaGUgQ29tcHV0ZXJOYW1lIHRvIHF1ZXJ5IGZvciBhY3RpdmUgc2Vzc2lvbnMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTG9nZ2VkT25Mb2NhbAoKICAgICAgICBSZXR1cm5zIGFjdGl2ZSBzZXNzaW9ucyBvbiB0aGUgbG9jYWwgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Mb2dnZWRPbkxvY2FsIC1Db21wdXRlck5hbWUgc3Fsc2VydmVyCgogICAgICAgIFJldHVybnMgYWN0aXZlIHNlc3Npb25zIG9uIHRoZSAnc3Fsc2VydmVyJyBob3N0LgoKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtPYmplY3RbXV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnbG9jYWxob3N0JwogICAgKQoKICAgICMgcHJvY2VzcyBtdWx0aXBsZSBob3N0IG9iamVjdCB0eXBlcyBmcm9tIHRoZSBwaXBlbGluZQogICAgJENvbXB1dGVyTmFtZSA9IEdldC1OYW1lRmllbGQgLU9iamVjdCAkQ29tcHV0ZXJOYW1lCgogICAgdHJ5IHsKICAgICAgICAjIHJldHJpZXZlIEhLVSByZW1vdGUgcmVnaXN0cnkgdmFsdWVzCiAgICAgICAgJFJlZyA9IFtNaWNyb3NvZnQuV2luMzIuUmVnaXN0cnlLZXldOjpPcGVuUmVtb3RlQmFzZUtleSgnVXNlcnMnLCAiJENvbXB1dGVyTmFtZSIpCgogICAgICAgICMgc29ydCBvdXQgYm9ndXMgc2lkJ3MgbGlrZSBfY2xhc3MKICAgICAgICAkUmVnLkdldFN1YktleU5hbWVzKCkgfCBXaGVyZS1PYmplY3QgeyAkXyAtbWF0Y2ggJ1MtMS01LTIxLVswLTldKy1bMC05XSstWzAtOV0rLVswLTldKyQnIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICRVc2VyTmFtZSA9IENvbnZlcnQtU2lkVG9OYW1lICRfCgogICAgICAgICAgICAkUGFydHMgPSAkVXNlck5hbWUuU3BsaXQoJ1wnKQogICAgICAgICAgICAkVXNlckRvbWFpbiA9ICROdWxsCiAgICAgICAgICAgICRVc2VyTmFtZSA9ICRQYXJ0c1stMV0KICAgICAgICAgICAgaWYgKCRQYXJ0cy5MZW5ndGggLWVxIDIpIHsKICAgICAgICAgICAgICAgICRVc2VyRG9tYWluID0gJFBhcnRzWzBdCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRMb2NhbExvZ2dlZE9uVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgJExvY2FsTG9nZ2VkT25Vc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgIiRDb21wdXRlck5hbWUiCiAgICAgICAgICAgICRMb2NhbExvZ2dlZE9uVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyRG9tYWluJyAkVXNlckRvbWFpbgogICAgICAgICAgICAkTG9jYWxMb2dnZWRPblVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlck5hbWUnICRVc2VyTmFtZQogICAgICAgICAgICAkTG9jYWxMb2dnZWRPblVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlclNJRCcgJF8KICAgICAgICAgICAgJExvY2FsTG9nZ2VkT25Vc2VyCiAgICAgICAgfQogICAgfQogICAgY2F0Y2ggewogICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIG9wZW5pbmcgcmVtb3RlIHJlZ2lzdHJ5IG9uICckQ29tcHV0ZXJOYW1lJyIKICAgIH0KfQoKCmZpbHRlciBHZXQtTmV0UkRQU2Vzc2lvbiB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiB3aWxsIGV4ZWN1dGUgdGhlIFdUU0VudW1lcmF0ZVNlc3Npb25zRXggYW5kIAogICAgICAgIFdUU1F1ZXJ5U2Vzc2lvbkluZm9ybWF0aW9uIFdpbjMyQVBJIGNhbGxzIHRvIHF1ZXJ5IGEgZ2l2ZW4KICAgICAgICBSRFAgcmVtb3RlIHNlcnZpY2UgZm9yIGFjdGl2ZSBzZXNzaW9ucyBhbmQgb3JpZ2luYXRpbmcgSVBzLgogICAgICAgIFRoaXMgaXMgYSByZXBsYWNlbWVudCBmb3IgcXdpbnN0YS4KCiAgICAgICAgTm90ZTogb25seSBtZW1iZXJzIG9mIHRoZSBBZG1pbmlzdHJhdG9ycyBvciBBY2NvdW50IE9wZXJhdG9ycyBsb2NhbCBncm91cAogICAgICAgIGNhbiBzdWNjZXNzZnVsbHkgZXhlY3V0ZSB0aGlzIGZ1bmN0aW9uYWxpdHkgb24gYSByZW1vdGUgdGFyZ2V0LgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBob3N0bmFtZSB0byBxdWVyeSBmb3IgYWN0aXZlIFJEUCBzZXNzaW9ucy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRSRFBTZXNzaW9uCgogICAgICAgIFJldHVybnMgYWN0aXZlIFJEUC90ZXJtaW5hbCBzZXNzaW9ucyBvbiB0aGUgbG9jYWwgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRSRFBTZXNzaW9uIC1Db21wdXRlck5hbWUgInNxbHNlcnZlciIKCiAgICAgICAgUmV0dXJucyBhY3RpdmUgUkRQL3Rlcm1pbmFsIHNlc3Npb25zIG9uIHRoZSAnc3Fsc2VydmVyJyBob3N0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldERvbWFpbkNvbnRyb2xsZXIgfCBHZXQtTmV0UkRQU2Vzc2lvbgoKICAgICAgICBSZXR1cm5zIGFjdGl2ZSBSRFAvdGVybWluYWwgc2Vzc2lvbnMgb24gYWxsIGRvbWFpbiBjb250cm9sbGVycy4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtPYmplY3RbXV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnbG9jYWxob3N0JwogICAgKQoKICAgICMgZXh0cmFjdCB0aGUgY29tcHV0ZXIgbmFtZSBmcm9tIHdoYXRldmVyIG9iamVjdCB3YXMgcGFzc2VkIG9uIHRoZSBwaXBlbGluZQogICAgJENvbXB1dGVyID0gJENvbXB1dGVyTmFtZSB8IEdldC1OYW1lRmllbGQKCiAgICAjIG9wZW4gdXAgYSBoYW5kbGUgdG8gdGhlIFJlbW90ZSBEZXNrdG9wIFNlc3Npb24gaG9zdAogICAgJEhhbmRsZSA9ICRXdHNhcGkzMjo6V1RTT3BlblNlcnZlckV4KCRDb21wdXRlcikKCiAgICAjIGlmIHdlIGdldCBhIG5vbi16ZXJvIGhhbmRsZSBiYWNrLCBldmVyeXRoaW5nIHdhcyBzdWNjZXNzZnVsCiAgICBpZiAoJEhhbmRsZSAtbmUgMCkgewoKICAgICAgICAjIGFyZ3VtZW50cyBmb3IgV1RTRW51bWVyYXRlU2Vzc2lvbnNFeAogICAgICAgICRwcFNlc3Npb25JbmZvID0gW0ludFB0cl06Olplcm8KICAgICAgICAkcENvdW50ID0gMAogICAgICAgIAogICAgICAgICMgZ2V0IGluZm9ybWF0aW9uIG9uIGFsbCBjdXJyZW50IHNlc3Npb25zCiAgICAgICAgJFJlc3VsdCA9ICRXdHNhcGkzMjo6V1RTRW51bWVyYXRlU2Vzc2lvbnNFeCgkSGFuZGxlLCBbcmVmXTEsIDAsIFtyZWZdJHBwU2Vzc2lvbkluZm8sIFtyZWZdJHBDb3VudCk7JExhc3RFcnJvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0TGFzdFdpbjMyRXJyb3IoKQoKICAgICAgICAjIExvY2F0ZSB0aGUgb2Zmc2V0IG9mIHRoZSBpbml0aWFsIGludFB0cgogICAgICAgICRPZmZzZXQgPSAkcHBTZXNzaW9uSW5mby5Ub0ludDY0KCkKCiAgICAgICAgaWYgKCgkUmVzdWx0IC1uZSAwKSAtYW5kICgkT2Zmc2V0IC1ndCAwKSkgewoKICAgICAgICAgICAgIyBXb3JrIG91dCBob3cgbXV0Y2ggdG8gaW5jcmVtZW50IHRoZSBwb2ludGVyIGJ5IGZpbmRpbmcgb3V0IHRoZSBzaXplIG9mIHRoZSBzdHJ1Y3R1cmUKICAgICAgICAgICAgJEluY3JlbWVudCA9ICRXVFNfU0VTU0lPTl9JTkZPXzE6OkdldFNpemUoKQoKICAgICAgICAgICAgIyBwYXJzZSBhbGwgdGhlIHJlc3VsdCBzdHJ1Y3R1cmVzCiAgICAgICAgICAgIGZvciAoJGkgPSAwOyAoJGkgLWx0ICRwQ291bnQpOyAkaSsrKSB7CiAKICAgICAgICAgICAgICAgICMgY3JlYXRlIGEgbmV3IGludCBwdHIgYXQgdGhlIGdpdmVuIG9mZnNldCBhbmQgY2FzdCB0aGUgcG9pbnRlciBhcyBvdXIgcmVzdWx0IHN0cnVjdHVyZQogICAgICAgICAgICAgICAgJE5ld0ludFB0ciA9IE5ldy1PYmplY3QgU3lzdGVtLkludHB0ciAtQXJndW1lbnRMaXN0ICRPZmZzZXQKICAgICAgICAgICAgICAgICRJbmZvID0gJE5ld0ludFB0ciAtYXMgJFdUU19TRVNTSU9OX0lORk9fMQoKICAgICAgICAgICAgICAgICRSRFBTZXNzaW9uID0gTmV3LU9iamVjdCBQU09iamVjdAoKICAgICAgICAgICAgICAgIGlmICgkSW5mby5wSG9zdE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAkUkRQU2Vzc2lvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRJbmZvLnBIb3N0TmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgIyBpZiBubyBob3N0bmFtZSByZXR1cm5lZCwgdXNlIHRoZSBzcGVjaWZpZWQgaG9zdG5hbWUKICAgICAgICAgICAgICAgICAgICAkUkRQU2Vzc2lvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRSRFBTZXNzaW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1Nlc3Npb25OYW1lJyAkSW5mby5wU2Vzc2lvbk5hbWUKCiAgICAgICAgICAgICAgICBpZiAoJCgtbm90ICRJbmZvLnBEb21haW5OYW1lKSAtb3IgKCRJbmZvLnBEb21haW5OYW1lIC1lcSAnJykpIHsKICAgICAgICAgICAgICAgICAgICAjIGlmIGEgZG9tYWluIGlzbid0IHJldHVybmVkIGp1c3QgdXNlIHRoZSB1c2VybmFtZQogICAgICAgICAgICAgICAgICAgICRSRFBTZXNzaW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJOYW1lJyAiJCgkSW5mby5wVXNlck5hbWUpIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJFJEUFNlc3Npb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlck5hbWUnICIkKCRJbmZvLnBEb21haW5OYW1lKVwkKCRJbmZvLnBVc2VyTmFtZSkiCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJFJEUFNlc3Npb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSUQnICRJbmZvLlNlc3Npb25JRAogICAgICAgICAgICAgICAgJFJEUFNlc3Npb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU3RhdGUnICRJbmZvLlN0YXRlCgogICAgICAgICAgICAgICAgJHBwQnVmZmVyID0gW0ludFB0cl06Olplcm8KICAgICAgICAgICAgICAgICRwQnl0ZXNSZXR1cm5lZCA9IDAKCiAgICAgICAgICAgICAgICAjIHF1ZXJ5IGZvciB0aGUgc291cmNlIGNsaWVudCBJUCB3aXRoIFdUU1F1ZXJ5U2Vzc2lvbkluZm9ybWF0aW9uCiAgICAgICAgICAgICAgICAjICAgaHR0cHM6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9hYTM4Mzg2MSh2PXZzLjg1KS5hc3B4CiAgICAgICAgICAgICAgICAkUmVzdWx0MiA9ICRXdHNhcGkzMjo6V1RTUXVlcnlTZXNzaW9uSW5mb3JtYXRpb24oJEhhbmRsZSwgJEluZm8uU2Vzc2lvbklELCAxNCwgW3JlZl0kcHBCdWZmZXIsIFtyZWZdJHBCeXRlc1JldHVybmVkKTskTGFzdEVycm9yMiA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0TGFzdFdpbjMyRXJyb3IoKQoKICAgICAgICAgICAgICAgIGlmKCRSZXN1bHQgLWVxIDApIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvcjogJCgoW0NvbXBvbmVudE1vZGVsLldpbjMyRXhjZXB0aW9uXSAkTGFzdEVycm9yMikuTWVzc2FnZSkiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkT2Zmc2V0MiA9ICRwcEJ1ZmZlci5Ub0ludDY0KCkKICAgICAgICAgICAgICAgICAgICAkTmV3SW50UHRyMiA9IE5ldy1PYmplY3QgU3lzdGVtLkludHB0ciAtQXJndW1lbnRMaXN0ICRPZmZzZXQyCiAgICAgICAgICAgICAgICAgICAgJEluZm8yID0gJE5ld0ludFB0cjIgLWFzICRXVFNfQ0xJRU5UX0FERFJFU1MKCiAgICAgICAgICAgICAgICAgICAgJFNvdXJjZUlQID0gJEluZm8yLkFkZHJlc3MgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYoJFNvdXJjZUlQWzJdIC1uZSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRTb3VyY2VJUCA9IFtTdHJpbmddJFNvdXJjZUlQWzJdKyIuIitbU3RyaW5nXSRTb3VyY2VJUFszXSsiLiIrW1N0cmluZ10kU291cmNlSVBbNF0rIi4iK1tTdHJpbmddJFNvdXJjZUlQWzVdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkU291cmNlSVAgPSAkTnVsbAogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJFJEUFNlc3Npb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU291cmNlSVAnICRTb3VyY2VJUAogICAgICAgICAgICAgICAgICAgICRSRFBTZXNzaW9uCgogICAgICAgICAgICAgICAgICAgICMgZnJlZSB1cCB0aGUgbWVtb3J5IGJ1ZmZlcgogICAgICAgICAgICAgICAgICAgICROdWxsID0gJFd0c2FwaTMyOjpXVFNGcmVlTWVtb3J5KCRwcEJ1ZmZlcikKCiAgICAgICAgICAgICAgICAgICAgJE9mZnNldCArPSAkSW5jcmVtZW50CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgIyBmcmVlIHVwIHRoZSBtZW1vcnkgcmVzdWx0IGJ1ZmZlcgogICAgICAgICAgICAkTnVsbCA9ICRXdHNhcGkzMjo6V1RTRnJlZU1lbW9yeUV4KDIsICRwcFNlc3Npb25JbmZvLCAkcENvdW50KQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3I6ICQoKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJExhc3RFcnJvcikuTWVzc2FnZSkiCiAgICAgICAgfQogICAgICAgICMgQ2xvc2Ugb2ZmIHRoZSBzZXJ2aWNlIGhhbmRsZQogICAgICAgICROdWxsID0gJFd0c2FwaTMyOjpXVFNDbG9zZVNlcnZlcigkSGFuZGxlKQogICAgfQogICAgZWxzZSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3Igb3BlbmluZyB0aGUgUmVtb3RlIERlc2t0b3AgU2Vzc2lvbiBIb3N0IChSRCBTZXNzaW9uIEhvc3QpIHNlcnZlciBmb3I6ICRDb21wdXRlck5hbWUiCiAgICB9Cn0KCgpmaWx0ZXIgSW52b2tlLUNoZWNrTG9jYWxBZG1pbkFjY2VzcyB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiB3aWxsIHVzZSB0aGUgT3BlblNDTWFuYWdlclcgV2luMzJBUEkgY2FsbCB0byBlc3RhYmxpc2gKICAgICAgICBhIGhhbmRsZSB0byB0aGUgcmVtb3RlIGhvc3QuIElmIHRoaXMgc3VjY2VlZHMsIHRoZSBjdXJyZW50IHVzZXIgY29udGV4dAogICAgICAgIGhhcyBsb2NhbCBhZG1pbmlzdHJhdG9yIGFjZXNzIHRvIHRoZSB0YXJnZXQuCgogICAgICAgIElkZWEgc3RvbGVuIGZyb20gdGhlIGxvY2FsX2FkbWluX3NlYXJjaF9lbnVtIHBvc3QgbW9kdWxlIGluIE1ldGFzcGxvaXQgd3JpdHRlbiBieToKICAgICAgICAgICAgJ0JyYW5kb24gTWNDYW5uICJ6ZWtub3giIDxibWNjYW5uW2F0XWFjY3V2YW50LmNvbT4nCiAgICAgICAgICAgICdUaG9tYXMgTWNDYXJ0aHkgInNtaWxpbmdyYWNjb29uIiA8c21pbGluZ3JhY2Nvb25bYXRdZ21haWwuY29tPicKICAgICAgICAgICAgJ1JveWNlIERhdmlzICJyM2R5IiA8cmRhdmlzW2F0XWFjY3V2YW50LmNvbT4nCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGhvc3RuYW1lIHRvIHF1ZXJ5IGZvciBhY3RpdmUgc2Vzc2lvbnMuCgogICAgLk9VVFBVVFMKCiAgICAgICAgJFRydWUgaWYgdGhlIGN1cnJlbnQgdXNlciBoYXMgbG9jYWwgYWRtaW4gYWNjZXNzIHRvIHRoZSBob3N0bmFtZSwgJEZhbHNlIG90aGVyd2lzZQoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLUNoZWNrTG9jYWxBZG1pbkFjY2VzcyAtQ29tcHV0ZXJOYW1lIHNxbHNlcnZlcgoKICAgICAgICBSZXR1cm5zIGFjdGl2ZSBzZXNzaW9ucyBvbiB0aGUgbG9jYWwgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRDb21wdXRlciB8IEludm9rZS1DaGVja0xvY2FsQWRtaW5BY2Nlc3MKCiAgICAgICAgU2VlcyB3aGF0IG1hY2hpbmVzIGluIHRoZSBkb21haW4gdGhlIGN1cnJlbnQgdXNlciBoYXMgYWNjZXNzIHRvLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9yYXBpZDcvbWV0YXNwbG9pdC1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvbW9kdWxlcy9wb3N0L3dpbmRvd3MvZ2F0aGVyL2xvY2FsX2FkbWluX3NlYXJjaF9lbnVtLnJiCiAgICAgICAgaHR0cDovL3d3dy5wb3dlcnNoZWxsbWFnYXppbmUuY29tLzIwMTQvMDkvMjUvZWFzaWx5LWRlZmluaW5nLWVudW1zLXN0cnVjdHMtYW5kLXdpbjMyLWZ1bmN0aW9ucy1pbi1tZW1vcnkvCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbT2JqZWN0W11dCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJ2xvY2FsaG9zdCcKICAgICkKCiAgICAjIGV4dHJhY3QgdGhlIGNvbXB1dGVyIG5hbWUgZnJvbSB3aGF0ZXZlciBvYmplY3Qgd2FzIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICRDb21wdXRlciA9ICRDb21wdXRlck5hbWUgfCBHZXQtTmFtZUZpZWxkCgogICAgIyAweEYwMDNGIC0gU0NfTUFOQUdFUl9BTExfQUNDRVNTCiAgICAjICAgaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L3dpbmRvd3MvZGVza3RvcC9tczY4NTk4MSh2PXZzLjg1KS5hc3B4CiAgICAkSGFuZGxlID0gJEFkdmFwaTMyOjpPcGVuU0NNYW5hZ2VyVygiXFwkQ29tcHV0ZXIiLCAnU2VydmljZXNBY3RpdmUnLCAweEYwMDNGKTskTGFzdEVycm9yID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXRMYXN0V2luMzJFcnJvcigpCgogICAgV3JpdGUtVmVyYm9zZSAiSW52b2tlLUNoZWNrTG9jYWxBZG1pbkFjY2VzcyBoYW5kbGU6ICRIYW5kbGUiCgogICAgJElzQWRtaW4gPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAkSXNBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgoKICAgICMgaWYgd2UgZ2V0IGEgbm9uLXplcm8gaGFuZGxlIGJhY2ssIGV2ZXJ5dGhpbmcgd2FzIHN1Y2Nlc3NmdWwKICAgIGlmICgkSGFuZGxlIC1uZSAwKSB7CiAgICAgICAgJE51bGwgPSAkQWR2YXBpMzI6OkNsb3NlU2VydmljZUhhbmRsZSgkSGFuZGxlKQogICAgICAgICRJc0FkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzQWRtaW4nICRUcnVlCiAgICB9CiAgICBlbHNlIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvcjogJCgoW0NvbXBvbmVudE1vZGVsLldpbjMyRXhjZXB0aW9uXSAkTGFzdEVycm9yKS5NZXNzYWdlKSIKICAgICAgICAkSXNBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0FkbWluJyAkRmFsc2UKICAgIH0KCiAgICAkSXNBZG1pbgp9CgoKZmlsdGVyIEdldC1TaXRlTmFtZSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiB3aWxsIHVzZSB0aGUgRHNHZXRTaXRlTmFtZSBXaW4zMkFQSSBjYWxsIHRvIGxvb2sgdXAgdGhlCiAgICAgICAgbmFtZSBvZiB0aGUgc2l0ZSB3aGVyZSBhIHNwZWNpZmllZCBjb21wdXRlciByZXNpZGVzLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBob3N0bmFtZSB0byBsb29rIHRoZSBzaXRlIHVwIGZvciwgZGVmYXVsdCB0byBsb2NhbGhvc3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtU2l0ZU5hbWUgLUNvbXB1dGVyTmFtZSBXSU5ET1dTMQoKICAgICAgICBSZXR1cm5zIHRoZSBzaXRlIGZvciBXSU5ET1dTMS50ZXN0bGFiLmxvY2FsLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldENvbXB1dGVyIHwgSW52b2tlLUNoZWNrTG9jYWxBZG1pbkFjY2VzcwoKICAgICAgICBSZXR1cm5zIHRoZSBzaXRlcyBmb3IgZXZlcnkgbWFjaGluZSBpbiBBRC4KIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3ROYW1lJyldCiAgICAgICAgW09iamVjdFtdXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICRFbnY6Q29tcHV0ZXJOYW1lCiAgICApCgogICAgIyBleHRyYWN0IHRoZSBjb21wdXRlciBuYW1lIGZyb20gd2hhdGV2ZXIgb2JqZWN0IHdhcyBwYXNzZWQgb24gdGhlIHBpcGVsaW5lCiAgICAkQ29tcHV0ZXIgPSAkQ29tcHV0ZXJOYW1lIHwgR2V0LU5hbWVGaWVsZAoKICAgICMgaWYgd2UgZ2V0IGFuIElQIGFkZHJlc3MsIHRyeSB0byByZXNvbHZlIHRoZSBJUCB0byBhIGhvc3RuYW1lCiAgICBpZigkQ29tcHV0ZXIgLW1hdGNoICdeKD86WzAtOV17MSwzfVwuKXszfVswLTldezEsM30kJykgewogICAgICAgICRJUEFkZHJlc3MgPSAkQ29tcHV0ZXIKICAgICAgICAkQ29tcHV0ZXIgPSBbU3lzdGVtLk5ldC5EbnNdOjpHZXRIb3N0QnlBZGRyZXNzKCRDb21wdXRlcikKICAgIH0KICAgIGVsc2UgewogICAgICAgICRJUEFkZHJlc3MgPSBAKEdldC1JUEFkZHJlc3MgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXIpWzBdLklQQWRkcmVzcwogICAgfQoKICAgICRQdHJJbmZvID0gW0ludFB0cl06Olplcm8KCiAgICAkUmVzdWx0ID0gJE5ldGFwaTMyOjpEc0dldFNpdGVOYW1lKCRDb21wdXRlciwgW3JlZl0kUHRySW5mbykKCiAgICAkQ29tcHV0ZXJTaXRlID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgJENvbXB1dGVyU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgogICAgJENvbXB1dGVyU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJUEFkZHJlc3MnICRJUEFkZHJlc3MKCiAgICBpZiAoJFJlc3VsdCAtZXEgMCkgewogICAgICAgICRTaXRlbmFtZSA9IFtTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlB0clRvU3RyaW5nQXV0bygkUHRySW5mbykKICAgICAgICAkQ29tcHV0ZXJTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NpdGVOYW1lJyAkU2l0ZW5hbWUKICAgIH0KICAgIGVsc2UgewogICAgICAgICRFcnJvck1lc3NhZ2UgPSAiRXJyb3I6ICQoKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJFJlc3VsdCkuTWVzc2FnZSkiCiAgICAgICAgJENvbXB1dGVyU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTaXRlTmFtZScgJEVycm9yTWVzc2FnZQogICAgfQoKICAgICROdWxsID0gJE5ldGFwaTMyOjpOZXRBcGlCdWZmZXJGcmVlKCRQdHJJbmZvKQoKICAgICRDb21wdXRlclNpdGUKfQoKCmZpbHRlciBHZXQtTGFzdExvZ2dlZE9uIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHVzZXMgcmVtb3RlIHJlZ2lzdHJ5IGZ1bmN0aW9uYWxpdHkgdG8gcmV0dXJuCiAgICAgICAgdGhlIGxhc3QgdXNlciBsb2dnZWQgb250byBhIHRhcmdldCBtYWNoaW5lLgoKICAgICAgICBOb3RlOiBUaGlzIGZ1bmN0aW9uIHJlcXVpcmVzIGFkbWluaXN0cmF0aXZlIHJpZ2h0cyBvbiB0aGUKICAgICAgICBtYWNoaW5lIHlvdSdyZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBUaGUgaG9zdG5hbWUgdG8gcXVlcnkgZm9yIHRoZSBsYXN0IGxvZ2dlZCBvbiB1c2VyLgogICAgICAgIERlZmF1bHRzIHRvIHRoZSBsb2NhbGhvc3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBmb3IgdGhlIHJlbW90ZSBjb25uZWN0aW9uLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUxhc3RMb2dnZWRPbgoKICAgICAgICBSZXR1cm5zIHRoZSBsYXN0IHVzZXIgbG9nZ2VkIG9udG8gdGhlIGxvY2FsIG1hY2hpbmUuCgogICAgLkVYQU1QTEUKICAgICAgICAKICAgICAgICBQUyBDOlw+IEdldC1MYXN0TG9nZ2VkT24gLUNvbXB1dGVyTmFtZSBXSU5ET1dTMQoKICAgICAgICBSZXR1cm5zIHRoZSBsYXN0IHVzZXIgbG9nZ2VkIG9udG8gV0lORE9XUzEKCiAgICAuRVhBTVBMRQogICAgICAgIAogICAgICAgIFBTIEM6XD4gR2V0LU5ldENvbXB1dGVyIHwgR2V0LUxhc3RMb2dnZWRPbgoKICAgICAgICBSZXR1cm5zIHRoZSBsYXN0IHVzZXIgbG9nZ2VkIG9udG8gYWxsIG1hY2hpbmVzIGluIHRoZSBkb21haW4uCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbT2JqZWN0W11dCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJ2xvY2FsaG9zdCcsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgIyBleHRyYWN0IHRoZSBjb21wdXRlciBuYW1lIGZyb20gd2hhdGV2ZXIgb2JqZWN0IHdhcyBwYXNzZWQgb24gdGhlIHBpcGVsaW5lCiAgICAkQ29tcHV0ZXIgPSAkQ29tcHV0ZXJOYW1lIHwgR2V0LU5hbWVGaWVsZAoKICAgICMgSEtFWV9MT0NBTF9NQUNISU5FCiAgICAkSEtMTSA9IDIxNDc0ODM2NTAKCiAgICAjIHRyeSB0byBvcGVuIHVwIHRoZSByZW1vdGUgcmVnaXN0cnkga2V5IHRvIGdyYWIgdGhlIGxhc3QgbG9nZ2VkIG9uIHVzZXIKICAgIHRyeSB7CgogICAgICAgIGlmKCRDcmVkZW50aWFsKSB7CiAgICAgICAgICAgICRSZWcgPSBHZXQtV21pT2JqZWN0IC1MaXN0ICdTdGRSZWdQcm92JyAtTmFtZXNwYWNlIHJvb3RcZGVmYXVsdCAtQ29tcHV0ZXJuYW1lICRDb21wdXRlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFJlZyA9IEdldC1XbWlPYmplY3QgLUxpc3QgJ1N0ZFJlZ1Byb3YnIC1OYW1lc3BhY2Ugcm9vdFxkZWZhdWx0IC1Db21wdXRlcm5hbWUgJENvbXB1dGVyIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgfQoKICAgICAgICAkS2V5ID0gIlNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXEF1dGhlbnRpY2F0aW9uXExvZ29uVUkiCiAgICAgICAgJFZhbHVlID0gIkxhc3RMb2dnZWRPblVzZXIiCiAgICAgICAgJExhc3RVc2VyID0gJFJlZy5HZXRTdHJpbmdWYWx1ZSgkSEtMTSwgJEtleSwgJFZhbHVlKS5zVmFsdWUKCiAgICAgICAgJExhc3RMb2dnZWRPbiA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAkTGFzdExvZ2dlZE9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyCiAgICAgICAgJExhc3RMb2dnZWRPbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdMYXN0TG9nZ2VkT24nICRMYXN0VXNlcgogICAgICAgICRMYXN0TG9nZ2VkT24KICAgIH0KICAgIGNhdGNoIHsKICAgICAgICBXcml0ZS1XYXJuaW5nICJbIV0gRXJyb3Igb3BlbmluZyByZW1vdGUgcmVnaXN0cnkgb24gJENvbXB1dGVyLiBSZW1vdGUgcmVnaXN0cnkgbGlrZWx5IG5vdCBlbmFibGVkLiIKICAgIH0KfQoKCmZpbHRlciBHZXQtQ2FjaGVkUkRQQ29ubmVjdGlvbiB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVXNlcyByZW1vdGUgcmVnaXN0cnkgZnVuY3Rpb25hbGl0eSB0byBxdWVyeSBhbGwgZW50cmllcyBmb3IgdGhlCiAgICAgICAgIldpbmRvd3MgUmVtb3RlIERlc2t0b3AgQ29ubmVjdGlvbiBDbGllbnQiIG9uIGEgbWFjaGluZSwgc2VwYXJhdGVkIGJ5CiAgICAgICAgdXNlciBhbmQgdGFyZ2V0IHNlcnZlci4KCiAgICAgICAgTm90ZTogVGhpcyBmdW5jdGlvbiByZXF1aXJlcyBhZG1pbmlzdHJhdGl2ZSByaWdodHMgb24gdGhlCiAgICAgICAgbWFjaGluZSB5b3UncmUgZW51bWVyYXRpbmcuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGhvc3RuYW1lIHRvIHF1ZXJ5IGZvciBSRFAgY2xpZW50IGluZm9ybWF0aW9uLgogICAgICAgIERlZmF1bHRzIHRvIGxvY2FsaG9zdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IGZvciB0aGUgcmVtb3RlIGNvbm5lY3Rpb24uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtQ2FjaGVkUkRQQ29ubmVjdGlvbgoKICAgICAgICBSZXR1cm5zIHRoZSBSRFAgY29ubmVjdGlvbiBjbGllbnQgaW5mb3JtYXRpb24gZm9yIHRoZSBsb2NhbCBtYWNoaW5lLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUNhY2hlZFJEUENvbm5lY3Rpb24gLUNvbXB1dGVyTmFtZSBXSU5ET1dTMi50ZXN0bGFiLmxvY2FsCgogICAgICAgIFJldHVybnMgdGhlIFJEUCBjb25uZWN0aW9uIGNsaWVudCBpbmZvcm1hdGlvbiBmb3IgdGhlIFdJTkRPV1MyLnRlc3RsYWIubG9jYWwgbWFjaGluZQoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUNhY2hlZFJEUENvbm5lY3Rpb24gLUNvbXB1dGVyTmFtZSBXSU5ET1dTMi50ZXN0bGFiLmxvY2FsIC1DcmVkZW50aWFsICRDcmVkCgogICAgICAgIFJldHVybnMgdGhlIFJEUCBjb25uZWN0aW9uIGNsaWVudCBpbmZvcm1hdGlvbiBmb3IgdGhlIFdJTkRPV1MyLnRlc3RsYWIubG9jYWwgbWFjaGluZSB1c2luZyBhbHRlcm5hdGUgY3JlZGVudGlhbHMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Q29tcHV0ZXIgfCBHZXQtQ2FjaGVkUkRQQ29ubmVjdGlvbgoKICAgICAgICBHZXQgY2FjaGVkIFJEUCBpbmZvcm1hdGlvbiBmb3IgYWxsIG1hY2hpbmVzIGluIHRoZSBkb21haW4uCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbT2JqZWN0W11dCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJ2xvY2FsaG9zdCcsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgIyBleHRyYWN0IHRoZSBjb21wdXRlciBuYW1lIGZyb20gd2hhdGV2ZXIgb2JqZWN0IHdhcyBwYXNzZWQgb24gdGhlIHBpcGVsaW5lCiAgICAkQ29tcHV0ZXIgPSAkQ29tcHV0ZXJOYW1lIHwgR2V0LU5hbWVGaWVsZAoKICAgICMgSEtFWV9VU0VSUwogICAgJEhLVSA9IDIxNDc0ODM2NTEKCiAgICB0cnkgewogICAgICAgIGlmKCRDcmVkZW50aWFsKSB7CiAgICAgICAgICAgICRSZWcgPSBHZXQtV21pT2JqZWN0IC1MaXN0ICdTdGRSZWdQcm92JyAtTmFtZXNwYWNlIHJvb3RcZGVmYXVsdCAtQ29tcHV0ZXJuYW1lICRDb21wdXRlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFJlZyA9IEdldC1XbWlPYmplY3QgLUxpc3QgJ1N0ZFJlZ1Byb3YnIC1OYW1lc3BhY2Ugcm9vdFxkZWZhdWx0IC1Db21wdXRlcm5hbWUgJENvbXB1dGVyIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgfQoKICAgICAgICAjIGV4dHJhY3Qgb3V0IHRoZSBTSURzIG9mIGRvbWFpbiB1c2VycyBpbiB0aGlzIGhpdmUKICAgICAgICAkVXNlclNJRHMgPSAoJFJlZy5FbnVtS2V5KCRIS1UsICIiKSkuc05hbWVzIHwgPyB7ICRfIC1tYXRjaCAnUy0xLTUtMjEtWzAtOV0rLVswLTldKy1bMC05XSstWzAtOV0rJCcgfQoKICAgICAgICBmb3JlYWNoICgkVXNlclNJRCBpbiAkVXNlclNJRHMpIHsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkVXNlck5hbWUgPSBDb252ZXJ0LVNpZFRvTmFtZSAkVXNlclNJRAoKICAgICAgICAgICAgICAgICMgcHVsbCBvdXQgYWxsIHRoZSBjYWNoZWQgUkRQIGNvbm5lY3Rpb25zCiAgICAgICAgICAgICAgICAkQ29ubmVjdGlvbktleXMgPSAkUmVnLkVudW1WYWx1ZXMoJEhLVSwiJFVzZXJTSURcU29mdHdhcmVcTWljcm9zb2Z0XFRlcm1pbmFsIFNlcnZlciBDbGllbnRcRGVmYXVsdCIpLnNOYW1lcwoKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRDb25uZWN0aW9uIGluICRDb25uZWN0aW9uS2V5cykgewogICAgICAgICAgICAgICAgICAgICMgbWFrZSBzdXJlIHRoaXMga2V5IGlzIGEgY2FjaGVkIGNvbm5lY3Rpb24KICAgICAgICAgICAgICAgICAgICBpZigkQ29ubmVjdGlvbiAtbWF0Y2ggJ01SVS4qJykgewogICAgICAgICAgICAgICAgICAgICAgICAkVGFyZ2V0U2VydmVyID0gJFJlZy5HZXRTdHJpbmdWYWx1ZSgkSEtVLCAiJFVzZXJTSURcU29mdHdhcmVcTWljcm9zb2Z0XFRlcm1pbmFsIFNlcnZlciBDbGllbnRcRGVmYXVsdCIsICRDb25uZWN0aW9uKS5zVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kQ29ubmVjdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyTmFtZScgJFVzZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlclNJRCcgJFVzZXJTSUQKICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kQ29ubmVjdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUYXJnZXRTZXJ2ZXInICRUYXJnZXRTZXJ2ZXIKICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kQ29ubmVjdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VybmFtZUhpbnQnICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBwdWxsIG91dCBhbGwgdGhlIGNhY2hlZCBzZXJ2ZXIgaW5mbyB3aXRoIHVzZXJuYW1lIGhpbnRzCiAgICAgICAgICAgICAgICAkU2VydmVyS2V5cyA9ICRSZWcuRW51bUtleSgkSEtVLCIkVXNlclNJRFxTb2Z0d2FyZVxNaWNyb3NvZnRcVGVybWluYWwgU2VydmVyIENsaWVudFxTZXJ2ZXJzIikuc05hbWVzCgogICAgICAgICAgICAgICAgZm9yZWFjaCAoJFNlcnZlciBpbiAkU2VydmVyS2V5cykgewoKICAgICAgICAgICAgICAgICAgICAkVXNlcm5hbWVIaW50ID0gJFJlZy5HZXRTdHJpbmdWYWx1ZSgkSEtVLCAiJFVzZXJTSURcU29mdHdhcmVcTWljcm9zb2Z0XFRlcm1pbmFsIFNlcnZlciBDbGllbnRcU2VydmVyc1wkU2VydmVyIiwgJ1VzZXJuYW1lSGludCcpLnNWYWx1ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgJEZvdW5kQ29ubmVjdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgogICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlck5hbWUnICRVc2VyTmFtZQogICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlclNJRCcgJFVzZXJTSUQKICAgICAgICAgICAgICAgICAgICAkRm91bmRDb25uZWN0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RhcmdldFNlcnZlcicgJFNlcnZlcgogICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlcm5hbWVIaW50JyAkVXNlcm5hbWVIaW50CiAgICAgICAgICAgICAgICAgICAgJEZvdW5kQ29ubmVjdGlvbiAgIAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvcjogJF8iCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQogICAgY2F0Y2ggewogICAgICAgIFdyaXRlLVdhcm5pbmcgIkVycm9yIGFjY2Vzc2luZyAkQ29tcHV0ZXIsIGxpa2VseSBpbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMgb3IgZmlyZXdhbGwgcnVsZXMgb24gaG9zdDogJF8iCiAgICB9Cn0KCgpmaWx0ZXIgR2V0LVJlZ2lzdHJ5TW91bnRlZERyaXZlIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBVc2VzIHJlbW90ZSByZWdpc3RyeSBmdW5jdGlvbmFsaXR5IHRvIHF1ZXJ5IGFsbCBlbnRyaWVzIGZvciB0aGUKICAgICAgICB0aGUgc2F2ZWQgbmV0d29yayBtb3VudGVkIGRyaXZlIG9uIGEgbWFjaGluZSwgc2VwYXJhdGVkIGJ5CiAgICAgICAgdXNlciBhbmQgdGFyZ2V0IHNlcnZlci4KCiAgICAgICAgTm90ZTogVGhpcyBmdW5jdGlvbiByZXF1aXJlcyBhZG1pbmlzdHJhdGl2ZSByaWdodHMgb24gdGhlCiAgICAgICAgbWFjaGluZSB5b3UncmUgZW51bWVyYXRpbmcuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGhvc3RuYW1lIHRvIHF1ZXJ5IGZvciBSRFAgY2xpZW50IGluZm9ybWF0aW9uLgogICAgICAgIERlZmF1bHRzIHRvIGxvY2FsaG9zdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IGZvciB0aGUgcmVtb3RlIGNvbm5lY3Rpb24uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtUmVnaXN0cnlNb3VudGVkRHJpdmUKCiAgICAgICAgUmV0dXJucyB0aGUgc2F2ZWQgbmV0d29yayBtb3VudGVkIGRyaXZlcyBmb3IgdGhlIGxvY2FsIG1hY2hpbmUuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtUmVnaXN0cnlNb3VudGVkRHJpdmUgLUNvbXB1dGVyTmFtZSBXSU5ET1dTMi50ZXN0bGFiLmxvY2FsCgogICAgICAgIFJldHVybnMgdGhlIHNhdmVkIG5ldHdvcmsgbW91bnRlZCBkcml2ZXMgZm9yIHRoZSBXSU5ET1dTMi50ZXN0bGFiLmxvY2FsIG1hY2hpbmUKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1SZWdpc3RyeU1vdW50ZWREcml2ZSAtQ29tcHV0ZXJOYW1lIFdJTkRPV1MyLnRlc3RsYWIubG9jYWwgLUNyZWRlbnRpYWwgJENyZWQKCiAgICAgICAgUmV0dXJucyB0aGUgc2F2ZWQgbmV0d29yayBtb3VudGVkIGRyaXZlcyBmb3IgdGhlIFdJTkRPV1MyLnRlc3RsYWIubG9jYWwgbWFjaGluZSB1c2luZyBhbHRlcm5hdGUgY3JlZGVudGlhbHMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Q29tcHV0ZXIgfCBHZXQtUmVnaXN0cnlNb3VudGVkRHJpdmUKCiAgICAgICAgR2V0IHRoZSBzYXZlZCBuZXR3b3JrIG1vdW50ZWQgZHJpdmVzIGZvciBhbGwgbWFjaGluZXMgaW4gdGhlIGRvbWFpbi4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtPYmplY3RbXV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnbG9jYWxob3N0JywKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICAjIGV4dHJhY3QgdGhlIGNvbXB1dGVyIG5hbWUgZnJvbSB3aGF0ZXZlciBvYmplY3Qgd2FzIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICRDb21wdXRlciA9ICRDb21wdXRlck5hbWUgfCBHZXQtTmFtZUZpZWxkCgogICAgIyBIS0VZX1VTRVJTCiAgICAkSEtVID0gMjE0NzQ4MzY1MQoKICAgIHRyeSB7CiAgICAgICAgaWYoJENyZWRlbnRpYWwpIHsKICAgICAgICAgICAgJFJlZyA9IEdldC1XbWlPYmplY3QgLUxpc3QgJ1N0ZFJlZ1Byb3YnIC1OYW1lc3BhY2Ugcm9vdFxkZWZhdWx0IC1Db21wdXRlcm5hbWUgJENvbXB1dGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkUmVnID0gR2V0LVdtaU9iamVjdCAtTGlzdCAnU3RkUmVnUHJvdicgLU5hbWVzcGFjZSByb290XGRlZmF1bHQgLUNvbXB1dGVybmFtZSAkQ29tcHV0ZXIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICB9CgogICAgICAgICMgZXh0cmFjdCBvdXQgdGhlIFNJRHMgb2YgZG9tYWluIHVzZXJzIGluIHRoaXMgaGl2ZQogICAgICAgICRVc2VyU0lEcyA9ICgkUmVnLkVudW1LZXkoJEhLVSwgIiIpKS5zTmFtZXMgfCA/IHsgJF8gLW1hdGNoICdTLTEtNS0yMS1bMC05XSstWzAtOV0rLVswLTldKy1bMC05XSskJyB9CgogICAgICAgIGZvcmVhY2ggKCRVc2VyU0lEIGluICRVc2VyU0lEcykgewoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRVc2VyTmFtZSA9IENvbnZlcnQtU2lkVG9OYW1lICRVc2VyU0lECgogICAgICAgICAgICAgICAgJERyaXZlTGV0dGVycyA9ICgkUmVnLkVudW1LZXkoJEhLVSwgIiRVc2VyU0lEXE5ldHdvcmsiKSkuc05hbWVzCgogICAgICAgICAgICAgICAgRm9yRWFjaCgkRHJpdmVMZXR0ZXIgaW4gJERyaXZlTGV0dGVycykgewogICAgICAgICAgICAgICAgICAgICRQcm92aWRlck5hbWUgPSAkUmVnLkdldFN0cmluZ1ZhbHVlKCRIS1UsICIkVXNlclNJRFxOZXR3b3JrXCREcml2ZUxldHRlciIsICdQcm92aWRlck5hbWUnKS5zVmFsdWUKICAgICAgICAgICAgICAgICAgICAkUmVtb3RlUGF0aCA9ICRSZWcuR2V0U3RyaW5nVmFsdWUoJEhLVSwgIiRVc2VyU0lEXE5ldHdvcmtcJERyaXZlTGV0dGVyIiwgJ1JlbW90ZVBhdGgnKS5zVmFsdWUKICAgICAgICAgICAgICAgICAgICAkRHJpdmVVc2VyTmFtZSA9ICRSZWcuR2V0U3RyaW5nVmFsdWUoJEhLVSwgIiRVc2VyU0lEXE5ldHdvcmtcJERyaXZlTGV0dGVyIiwgJ1VzZXJOYW1lJykuc1ZhbHVlCiAgICAgICAgICAgICAgICAgICAgaWYoLW5vdCAkVXNlck5hbWUpIHsgJFVzZXJOYW1lID0gJycgfQoKICAgICAgICAgICAgICAgICAgICBpZigkUmVtb3RlUGF0aCAtYW5kICgkUmVtb3RlUGF0aCAtbmUgJycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRNb3VudGVkRHJpdmUgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICRNb3VudGVkRHJpdmUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgJE1vdW50ZWREcml2ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyTmFtZScgJFVzZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRNb3VudGVkRHJpdmUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlclNJRCcgJFVzZXJTSUQKICAgICAgICAgICAgICAgICAgICAgICAgJE1vdW50ZWREcml2ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEcml2ZUxldHRlcicgJERyaXZlTGV0dGVyCiAgICAgICAgICAgICAgICAgICAgICAgICRNb3VudGVkRHJpdmUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUHJvdmlkZXJOYW1lJyAkUHJvdmlkZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRNb3VudGVkRHJpdmUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUmVtb3RlUGF0aCcgJFJlbW90ZVBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgJE1vdW50ZWREcml2ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEcml2ZVVzZXJOYW1lJyAkRHJpdmVVc2VyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkTW91bnRlZERyaXZlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yOiAkXyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGNhdGNoIHsKICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBhY2Nlc3NpbmcgJENvbXB1dGVyLCBsaWtlbHkgaW5zdWZmaWNpZW50IHBlcm1pc3Npb25zIG9yIGZpcmV3YWxsIHJ1bGVzIG9uIGhvc3Q6ICRfIgogICAgfQp9CgoKZmlsdGVyIEdldC1OZXRQcm9jZXNzIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBHZXRzIGEgbGlzdCBvZiBwcm9jZXNzZXMvb3duZXJzIG9uIGEgcmVtb3RlIG1hY2hpbmUuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGhvc3RuYW1lIHRvIHF1ZXJ5IHByb2Nlc3Nlcy4gRGVmYXVsdHMgdG8gdGhlIGxvY2FsIGhvc3QgbmFtZS4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IGZvciB0aGUgcmVtb3RlIGNvbm5lY3Rpb24uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0UHJvY2VzcyAtQ29tcHV0ZXJOYW1lIFdJTkRPV1MxCiAgICAKICAgICAgICBSZXR1cm5zIHRoZSBjdXJyZW50IHByb2Nlc3NlcyBmb3IgV0lORE9XUzEKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtPYmplY3RbXV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21wdXRlck5hbWUgPSBbU3lzdGVtLk5ldC5EbnNdOjpHZXRIb3N0TmFtZSgpLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgICMgZXh0cmFjdCB0aGUgY29tcHV0ZXIgbmFtZSBmcm9tIHdoYXRldmVyIG9iamVjdCB3YXMgcGFzc2VkIG9uIHRoZSBwaXBlbGluZQogICAgJENvbXB1dGVyID0gJENvbXB1dGVyTmFtZSB8IEdldC1OYW1lRmllbGQKCiAgICB0cnkgewogICAgICAgIGlmKCRDcmVkZW50aWFsKSB7CiAgICAgICAgICAgICRQcm9jZXNzZXMgPSBHZXQtV01Jb2JqZWN0IC1DbGFzcyBXaW4zMl9wcm9jZXNzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbAogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFByb2Nlc3NlcyA9IEdldC1XTUlvYmplY3QgLUNsYXNzIFdpbjMyX3Byb2Nlc3MgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgfQoKICAgICAgICAkUHJvY2Vzc2VzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAkT3duZXIgPSAkXy5nZXRvd25lcigpOwogICAgICAgICAgICAkUHJvY2VzcyA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgJFByb2Nlc3MgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXIKICAgICAgICAgICAgJFByb2Nlc3MgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUHJvY2Vzc05hbWUnICRfLlByb2Nlc3NOYW1lCiAgICAgICAgICAgICRQcm9jZXNzIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1Byb2Nlc3NJRCcgJF8uUHJvY2Vzc0lECiAgICAgICAgICAgICRQcm9jZXNzIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0RvbWFpbicgJE93bmVyLkRvbWFpbgogICAgICAgICAgICAkUHJvY2VzcyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyJyAkT3duZXIuVXNlcgogICAgICAgICAgICAkUHJvY2VzcyAgICAgICAgICAgICAgICAKICAgICAgICB9CiAgICB9CiAgICBjYXRjaCB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiWyFdIEVycm9yIGVudW1lcmF0aW5nIHJlbW90ZSBwcm9jZXNzZXMgb24gJENvbXB1dGVyLCBhY2Nlc3MgbGlrZWx5IGRlbmllZDogJF8iCiAgICB9Cn0KCgpmdW5jdGlvbiBGaW5kLUludGVyZXN0aW5nRmlsZSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiByZWN1cnNpdmVseSBzZWFyY2hlcyBhIGdpdmVuIFVOQyBwYXRoIGZvciBmaWxlcyB3aXRoCiAgICAgICAgc3BlY2lmaWMga2V5d29yZHMgaW4gdGhlIG5hbWUgKGRlZmF1bHQgb2YgcGFzcywgc2Vuc2l0aXZlLCBzZWNyZXQsIGFkbWluLAogICAgICAgIGxvZ2luIGFuZCB1bmF0dGVuZCoueG1sKS4gVGhlIG91dHB1dCBjYW4gYmUgcGlwZWQgb3V0IHRvIGEgY3N2IHdpdGggdGhlCiAgICAgICAgLU91dEZpbGUgZmxhZy4gQnkgZGVmYXVsdCwgaGlkZGVuIGZpbGVzL2ZvbGRlcnMgYXJlIGluY2x1ZGVkIGluIHNlYXJjaCByZXN1bHRzLgoKICAgIC5QQVJBTUVURVIgUGF0aAoKICAgICAgICBVTkMvbG9jYWwgcGF0aCB0byByZWN1cnNpdmVseSBzZWFyY2guCgogICAgLlBBUkFNRVRFUiBUZXJtcwoKICAgICAgICBUZXJtcyB0byBzZWFyY2ggZm9yLgoKICAgIC5QQVJBTUVURVIgT2ZmaWNlRG9jcwoKICAgICAgICBTd2l0Y2guIFNlYXJjaCBmb3Igb2ZmaWNlIGRvY3VtZW50cyAoKi5kb2MqLCAqLnhscyosICoucHB0KikKCiAgICAuUEFSQU1FVEVSIEZyZXNoRVhFcwoKICAgICAgICBTd2l0Y2guIEZpbmQgLkVYRXMgYWNjZXNzZWQgd2l0aGluIHRoZSBsYXN0IHdlZWsuCgogICAgLlBBUkFNRVRFUiBMYXN0QWNjZXNzVGltZQoKICAgICAgICBPbmx5IHJldHVybiBmaWxlcyB3aXRoIGEgTGFzdEFjY2Vzc1RpbWUgZ3JlYXRlciB0aGFuIHRoaXMgZGF0ZSB2YWx1ZS4KCiAgICAuUEFSQU1FVEVSIExhc3RXcml0ZVRpbWUKCiAgICAgICAgT25seSByZXR1cm4gZmlsZXMgd2l0aCBhIExhc3RXcml0ZVRpbWUgZ3JlYXRlciB0aGFuIHRoaXMgZGF0ZSB2YWx1ZS4KCiAgICAuUEFSQU1FVEVSIENyZWF0aW9uVGltZQoKICAgICAgICBPbmx5IHJldHVybiBmaWxlcyB3aXRoIGEgQ3JlYXRpb25UaW1lIGdyZWF0ZXIgdGhhbiB0aGlzIGRhdGUgdmFsdWUuCgogICAgLlBBUkFNRVRFUiBFeGNsdWRlRm9sZGVycwoKICAgICAgICBTd2l0Y2guIEV4Y2x1ZGUgZm9sZGVycyBmcm9tIHRoZSBzZWFyY2ggcmVzdWx0cy4KCiAgICAuUEFSQU1FVEVSIEV4Y2x1ZGVIaWRkZW4KCiAgICAgICAgU3dpdGNoLiBFeGNsdWRlIGhpZGRlbiBmaWxlcyBhbmQgZm9sZGVycyBmcm9tIHRoZSBzZWFyY2ggcmVzdWx0cy4KCiAgICAuUEFSQU1FVEVSIENoZWNrV3JpdGVBY2Nlc3MKCiAgICAgICAgU3dpdGNoLiBPbmx5IHJldHVybnMgZmlsZXMgdGhlIGN1cnJlbnQgdXNlciBoYXMgd3JpdGUgYWNjZXNzIHRvLgoKICAgIC5QQVJBTUVURVIgT3V0RmlsZQoKICAgICAgICBPdXRwdXQgcmVzdWx0cyB0byBhIHNwZWNpZmllZCBjc3Ygb3V0cHV0IGZpbGUuCgogICAgLlBBUkFNRVRFUiBVc2VQU0RyaXZlCgogICAgICAgIFN3aXRjaC4gTW91bnQgdGFyZ2V0IHJlbW90ZSBwYXRoIHdpdGggdGVtcG9yYXJ5IFBTRHJpdmVzLgoKICAgIC5PVVRQVVRTCgogICAgICAgIFRoZSBmdWxsIHBhdGgsIG93bmVyLCBsYXN0YWNjZXNzIHRpbWUsIGxhc3R3cml0ZSB0aW1lLCBhbmQgc2l6ZSBmb3IgZWFjaCBmb3VuZCBmaWxlLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gRmluZC1JbnRlcmVzdGluZ0ZpbGUgLVBhdGggQzpcQmFja3VwXAogICAgICAgIAogICAgICAgIFJldHVybnMgYW55IGZpbGVzIG9uIHRoZSBsb2NhbCBwYXRoIEM6XEJhY2t1cFwgdGhhdCBoYXZlIHRoZSBkZWZhdWx0CiAgICAgICAgc2VhcmNoIHRlcm0gc2V0IGluIHRoZSB0aXRsZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtSW50ZXJlc3RpbmdGaWxlIC1QYXRoIFxcV0lORE9XUzdcVXNlcnNcIC1UZXJtcyBzYWxhcmllcyxlbWFpbCAtT3V0RmlsZSBvdXQuY3N2CiAgICAgICAgCiAgICAgICAgUmV0dXJucyBhbnkgZmlsZXMgb24gdGhlIHJlbW90ZSBwYXRoIFxcV0lORE9XUzdcVXNlcnNcIHRoYXQgaGF2ZSAnc2FsYXJpZXMnCiAgICAgICAgb3IgJ2VtYWlsJyBpbiB0aGUgdGl0bGUsIGFuZCB3cml0ZXMgdGhlIHJlc3VsdHMgb3V0IHRvIGEgY3N2IGZpbGUKICAgICAgICBuYW1lZCAnb3V0LmNzdicKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtSW50ZXJlc3RpbmdGaWxlIC1QYXRoIFxcV0lORE9XUzdcVXNlcnNcIC1MYXN0QWNjZXNzVGltZSAoR2V0LURhdGUpLkFkZERheXMoLTcpCgogICAgICAgIFJldHVybnMgYW55IGZpbGVzIG9uIHRoZSByZW1vdGUgcGF0aCBcXFdJTkRPV1M3XFVzZXJzXCB0aGF0IGhhdmUgdGhlIGRlZmF1bHQKICAgICAgICBzZWFyY2ggdGVybSBzZXQgaW4gdGhlIHRpdGxlIGFuZCB3ZXJlIGFjY2Vzc2VkIHdpdGhpbiB0aGUgbGFzdCB3ZWVrLgoKICAgIC5MSU5LCiAgICAgICAgCiAgICAgICAgaHR0cDovL3d3dy5oYXJtajB5Lm5ldC9ibG9nL3JlZHRlYW1pbmcvZmlsZS1zZXJ2ZXItdHJpYWdlLW9uLXJlZC10ZWFtLWVuZ2FnZW1lbnRzLwojPgogICAgCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRQYXRoID0gJy5cJywKCiAgICAgICAgW0FsaWFzKCdUZXJtcycpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkU2VhcmNoVGVybXMgPSBAKCdwYXNzJywgJ3NlbnNpdGl2ZScsICdhZG1pbicsICdsb2dpbicsICdzZWNyZXQnLCAndW5hdHRlbmQqLnhtbCcsICcudm1kaycsICdjcmVkcycsICdjcmVkZW50aWFsJywgJy5jb25maWcnKSwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkT2ZmaWNlRG9jcywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRnJlc2hFWEVzLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRMYXN0QWNjZXNzVGltZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkTGFzdFdyaXRlVGltZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ3JlYXRpb25UaW1lLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRFeGNsdWRlRm9sZGVycywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRXhjbHVkZUhpZGRlbiwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQ2hlY2tXcml0ZUFjY2VzcywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkT3V0RmlsZSwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVXNlUFNEcml2ZQogICAgKQoKICAgIGJlZ2luIHsKCiAgICAgICAgJFBhdGggKz0gaWYoISRQYXRoLkVuZHNXaXRoKCdcJykpIHsiXCJ9CgogICAgICAgIGlmICgkQ3JlZGVudGlhbCkgewogICAgICAgICAgICAkVXNlUFNEcml2ZSA9ICRUcnVlCiAgICAgICAgfQoKICAgICAgICAjIGFwcGVuZCB3aWxkY2FyZHMgdG8gdGhlIGZyb250IGFuZCBiYWNrIG9mIGFsbCBzZWFyY2ggdGVybXMKICAgICAgICAkU2VhcmNoVGVybXMgPSAkU2VhcmNoVGVybXMgfCBGb3JFYWNoLU9iamVjdCB7IGlmKCRfIC1ub3RtYXRjaCAnXlwqLipcKiQnKSB7IiokKCRfKSoifSBlbHNleyRffSB9CgogICAgICAgICMgc2VhcmNoIGp1c3QgZm9yIG9mZmljZSBkb2N1bWVudHMgaWYgc3BlY2lmaWVkCiAgICAgICAgaWYgKCRPZmZpY2VEb2NzKSB7CiAgICAgICAgICAgICRTZWFyY2hUZXJtcyA9IEAoJyouZG9jJywgJyouZG9jeCcsICcqLnhscycsICcqLnhsc3gnLCAnKi5wcHQnLCAnKi5wcHR4JykKICAgICAgICB9CgogICAgICAgICMgZmluZCAuZXhlJ3MgYWNjZXNzZWQgd2l0aGluIHRoZSBsYXN0IDcgZGF5cwogICAgICAgIGlmKCRGcmVzaEVYRXMpIHsKICAgICAgICAgICAgIyBnZXQgYW4gYWNjZXNzIHRpbWUgbGltaXQgb2YgNyBkYXlzIGFnbwogICAgICAgICAgICAkTGFzdEFjY2Vzc1RpbWUgPSAoR2V0LURhdGUpLkFkZERheXMoLTcpLlRvU3RyaW5nKCdNTS9kZC95eXl5JykKICAgICAgICAgICAgJFNlYXJjaFRlcm1zID0gJyouZXhlJwogICAgICAgIH0KCiAgICAgICAgaWYoJFVzZVBTRHJpdmUpIHsKICAgICAgICAgICAgIyBpZiB3ZSdyZSBQU0RyaXZlcywgY3JlYXRlIGEgdGVtcG9yYXJ5IG1vdW50IHBvaW50CgogICAgICAgICAgICAkUGFydHMgPSAkUGF0aC5zcGxpdCgnXCcpCiAgICAgICAgICAgICRGb2xkZXJQYXRoID0gJFBhcnRzWzAuLigkUGFydHMubGVuZ3RoLTIpXSAtam9pbiAnXCcKICAgICAgICAgICAgJEZpbGVQYXRoID0gJFBhcnRzWy0xXQoKICAgICAgICAgICAgJFJhbmREcml2ZSA9ICgiYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoiLlRvQ2hhckFycmF5KCkgfCBHZXQtUmFuZG9tIC1Db3VudCA3KSAtam9pbiAnJwogICAgICAgICAgICAKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiTW91bnRpbmcgcGF0aCAnJFBhdGgnIHVzaW5nIGEgdGVtcCBQU0RyaXZlIGF0ICRSYW5kRHJpdmUiCgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJE51bGwgPSBOZXctUFNEcml2ZSAtTmFtZSAkUmFuZERyaXZlIC1QU1Byb3ZpZGVyIEZpbGVTeXN0ZW0gLVJvb3QgJEZvbGRlclBhdGggLUVycm9yQWN0aW9uIFN0b3AKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBtb3VudGluZyBwYXRoICckUGF0aCcgOiAkXyIKICAgICAgICAgICAgICAgIHJldHVybiAkTnVsbAogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHNvIHdlIGNhbiBjZC9kaXIgdGhlIG5ldyBkcml2ZQogICAgICAgICAgICAkUGF0aCA9ICIke1JhbmREcml2ZX06XCR7RmlsZVBhdGh9IgogICAgICAgIH0KICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFNlYXJjaCBwYXRoICRQYXRoIgoKICAgICAgICBmdW5jdGlvbiBJbnZva2UtQ2hlY2tXcml0ZSB7CiAgICAgICAgICAgICMgc2hvcnQgaGVscGVyIHRvIGNoZWNrIGlzIHRoZSBjdXJyZW50IHVzZXIgY2FuIHdyaXRlIHRvIGEgZmlsZQogICAgICAgICAgICBbQ21kbGV0QmluZGluZygpXXBhcmFtKFtTdHJpbmddJFBhdGgpCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkRmlsZXRlc3QgPSBbSU8uRklMRV06Ok9wZW5Xcml0ZSgkUGF0aCkKICAgICAgICAgICAgICAgICRGaWxldGVzdC5DbG9zZSgpCiAgICAgICAgICAgICAgICAkVHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgJEVycm9yWzBdCiAgICAgICAgICAgICAgICAkRmFsc2UKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJFNlYXJjaEFyZ3MgPSAgQHsKICAgICAgICAgICAgJ1BhdGgnID0gJFBhdGgKICAgICAgICAgICAgJ1JlY3Vyc2UnID0gJFRydWUKICAgICAgICAgICAgJ0ZvcmNlJyA9ICQoLW5vdCAkRXhjbHVkZUhpZGRlbikKICAgICAgICAgICAgJ0luY2x1ZGUnID0gJFNlYXJjaFRlcm1zCiAgICAgICAgICAgICdFcnJvckFjdGlvbicgPSAnU2lsZW50bHlDb250aW51ZScKICAgICAgICB9CgogICAgICAgIEdldC1DaGlsZEl0ZW0gQFNlYXJjaEFyZ3MgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgJF8KICAgICAgICAgICAgIyBjaGVjayBpZiB3ZSdyZSBleGNsdWRpbmcgZm9sZGVycwogICAgICAgICAgICBpZighJEV4Y2x1ZGVGb2xkZXJzIC1vciAhJF8uUFNJc0NvbnRhaW5lcikgeyRffQogICAgICAgIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIGlmKCRMYXN0QWNjZXNzVGltZSAtb3IgJExhc3RXcml0ZVRpbWUgLW9yICRDcmVhdGlvblRpbWUpIHsKICAgICAgICAgICAgICAgIGlmKCRMYXN0QWNjZXNzVGltZSAtYW5kICgkXy5MYXN0QWNjZXNzVGltZSAtZ3QgJExhc3RBY2Nlc3NUaW1lKSkgeyRffQogICAgICAgICAgICAgICAgZWxzZWlmKCRMYXN0V3JpdGVUaW1lIC1hbmQgKCRfLkxhc3RXcml0ZVRpbWUgLWd0ICRMYXN0V3JpdGVUaW1lKSkgeyRffQogICAgICAgICAgICAgICAgZWxzZWlmKCRDcmVhdGlvblRpbWUgLWFuZCAoJF8uQ3JlYXRpb25UaW1lIC1ndCAkQ3JlYXRpb25UaW1lKSkgeyRffQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgeyRffQogICAgICAgIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICMgZmlsdGVyIGZvciB3cml0ZSBhY2Nlc3MgKGlmIGFwcGxpY2FibGUpCiAgICAgICAgICAgIGlmKCgtbm90ICRDaGVja1dyaXRlQWNjZXNzKSAtb3IgKEludm9rZS1DaGVja1dyaXRlIC1QYXRoICRfLkZ1bGxOYW1lKSkgeyRffQogICAgICAgIH0gfCBTZWxlY3QtT2JqZWN0IEZ1bGxOYW1lLEB7TmFtZT0nT3duZXInO0V4cHJlc3Npb249eyhHZXQtQWNsICRfLkZ1bGxOYW1lKS5Pd25lcn19LExhc3RBY2Nlc3NUaW1lLExhc3RXcml0ZVRpbWUsQ3JlYXRpb25UaW1lLExlbmd0aCB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgIyBjaGVjayBpZiB3ZSdyZSBvdXRwdXR0aW5nIHRvIHRoZSBwaXBlbGluZSBvciBhbiBvdXRwdXQgZmlsZQogICAgICAgICAgICBpZigkT3V0RmlsZSkge0V4cG9ydC1Qb3dlclZpZXdDU1YgLUlucHV0T2JqZWN0ICRfIC1PdXRGaWxlICRPdXRGaWxlfQogICAgICAgICAgICBlbHNlIHskX30KICAgICAgICB9CiAgICB9CgogICAgZW5kIHsKICAgICAgICBpZigkVXNlUFNEcml2ZSAtYW5kICRSYW5kRHJpdmUpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiUmVtb3ZpbmcgdGVtcCBQU0RyaXZlICRSYW5kRHJpdmUiCiAgICAgICAgICAgIEdldC1QU0RyaXZlIC1OYW1lICRSYW5kRHJpdmUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgfCBSZW1vdmUtUFNEcml2ZSAtRm9yY2UKICAgICAgICB9CiAgICB9Cn0KCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojCiMgJ01ldGEnLWZ1bmN0aW9ucyBzdGFydCBiZWxvdwojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpmdW5jdGlvbiBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiB7CiAgICAjIEhlbHBlciB1c2VkIGJ5IGFueSB0aHJlYWRlZCBob3N0IGVudW1lcmF0aW9uIGZ1bmN0aW9ucwogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxNYW5kYXRvcnk9JFRydWUpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkQ29tcHV0ZXJOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTEsTWFuZGF0b3J5PSRUcnVlKV0KICAgICAgICBbU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5TY3JpcHRCbG9ja10KICAgICAgICAkU2NyaXB0QmxvY2ssCgogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MildCiAgICAgICAgW0hhc2h0YWJsZV0KICAgICAgICAkU2NyaXB0UGFyYW1ldGVycywKCiAgICAgICAgW0ludF0KICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMCldIAogICAgICAgICRUaHJlYWRzID0gMjAsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJE5vSW1wb3J0cwogICAgKQoKICAgIGJlZ2luIHsKCiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snRGVidWcnXSkgewogICAgICAgICAgICAkRGVidWdQcmVmZXJlbmNlID0gJ0NvbnRpbnVlJwogICAgICAgIH0KCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFRvdGFsIG51bWJlciBvZiBob3N0czogJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSIKCiAgICAgICAgIyBBZGFwdGVkIGZyb206CiAgICAgICAgIyAgIGh0dHA6Ly9wb3dlcnNoZWxsLm9yZy93cC9mb3J1bXMvdG9waWMvaW52cGtlLXBhcmFsbGVsLW5lZWQtaGVscC10by1jbG9uZS10aGUtY3VycmVudC1ydW5zcGFjZS8KICAgICAgICAkU2Vzc2lvblN0YXRlID0gW1N5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUnVuc3BhY2VzLkluaXRpYWxTZXNzaW9uU3RhdGVdOjpDcmVhdGVEZWZhdWx0KCkKICAgICAgICAkU2Vzc2lvblN0YXRlLkFwYXJ0bWVudFN0YXRlID0gW1N5c3RlbS5UaHJlYWRpbmcuVGhyZWFkXTo6Q3VycmVudFRocmVhZC5HZXRBcGFydG1lbnRTdGF0ZSgpCgogICAgICAgICMgaW1wb3J0IHRoZSBjdXJyZW50IHNlc3Npb24gc3RhdGUncyB2YXJpYWJsZXMgYW5kIGZ1bmN0aW9ucyBzbyB0aGUgY2hhaW5lZCBQb3dlclZpZXcKICAgICAgICAjICAgZnVuY3Rpb25hbGl0eSBjYW4gYmUgdXNlZCBieSB0aGUgdGhyZWFkZWQgYmxvY2tzCiAgICAgICAgaWYoISROb0ltcG9ydHMpIHsKCiAgICAgICAgICAgICMgZ3JhYiBhbGwgdGhlIGN1cnJlbnQgdmFyaWFibGVzIGZvciB0aGlzIHJ1bnNwYWNlCiAgICAgICAgICAgICRNeVZhcnMgPSBHZXQtVmFyaWFibGUgLVNjb3BlIDIKCiAgICAgICAgICAgICMgdGhlc2UgVmFyaWFibGVzIGFyZSBhZGRlZCBieSBSdW5zcGFjZS5PcGVuKCkgTWV0aG9kIGFuZCBwcm9kdWNlIFN0b3AgZXJyb3JzIGlmIHlvdSBhZGQgdGhlbSB0d2ljZQogICAgICAgICAgICAkVm9yYmlkZGVuVmFycyA9IEAoIj8iLCJhcmdzIiwiQ29uc29sZUZpbGVOYW1lIiwiRXJyb3IiLCJFeGVjdXRpb25Db250ZXh0IiwiZmFsc2UiLCJIT01FIiwiSG9zdCIsImlucHV0IiwiSW5wdXRPYmplY3QiLCJNYXhpbXVtQWxpYXNDb3VudCIsIk1heGltdW1Ecml2ZUNvdW50IiwiTWF4aW11bUVycm9yQ291bnQiLCJNYXhpbXVtRnVuY3Rpb25Db3VudCIsIk1heGltdW1IaXN0b3J5Q291bnQiLCJNYXhpbXVtVmFyaWFibGVDb3VudCIsIk15SW52b2NhdGlvbiIsIm51bGwiLCJQSUQiLCJQU0JvdW5kUGFyYW1ldGVycyIsIlBTQ29tbWFuZFBhdGgiLCJQU0N1bHR1cmUiLCJQU0RlZmF1bHRQYXJhbWV0ZXJWYWx1ZXMiLCJQU0hPTUUiLCJQU1NjcmlwdFJvb3QiLCJQU1VJQ3VsdHVyZSIsIlBTVmVyc2lvblRhYmxlIiwiUFdEIiwiU2hlbGxJZCIsIlN5bmNocm9uaXplZEhhc2giLCJ0cnVlIikKCiAgICAgICAgICAgICMgQWRkIFZhcmlhYmxlcyBmcm9tIFBhcmVudCBTY29wZSAoY3VycmVudCBydW5zcGFjZSkgaW50byB0aGUgSW5pdGlhbFNlc3Npb25TdGF0ZQogICAgICAgICAgICBGb3JFYWNoKCRWYXIgaW4gJE15VmFycykgewogICAgICAgICAgICAgICAgaWYoJFZvcmJpZGRlblZhcnMgLU5vdENvbnRhaW5zICRWYXIuTmFtZSkgewogICAgICAgICAgICAgICAgJFNlc3Npb25TdGF0ZS5WYXJpYWJsZXMuQWRkKChOZXctT2JqZWN0IC1UeXBlTmFtZSBTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlJ1bnNwYWNlcy5TZXNzaW9uU3RhdGVWYXJpYWJsZUVudHJ5IC1Bcmd1bWVudExpc3QgJFZhci5uYW1lLCRWYXIuVmFsdWUsJFZhci5kZXNjcmlwdGlvbiwkVmFyLm9wdGlvbnMsJFZhci5hdHRyaWJ1dGVzKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBBZGQgRnVuY3Rpb25zIGZyb20gY3VycmVudCBydW5zcGFjZSB0byB0aGUgSW5pdGlhbFNlc3Npb25TdGF0ZQogICAgICAgICAgICBGb3JFYWNoKCRGdW5jdGlvbiBpbiAoR2V0LUNoaWxkSXRlbSBGdW5jdGlvbjopKSB7CiAgICAgICAgICAgICAgICAkU2Vzc2lvblN0YXRlLkNvbW1hbmRzLkFkZCgoTmV3LU9iamVjdCAtVHlwZU5hbWUgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5SdW5zcGFjZXMuU2Vzc2lvblN0YXRlRnVuY3Rpb25FbnRyeSAtQXJndW1lbnRMaXN0ICRGdW5jdGlvbi5OYW1lLCAkRnVuY3Rpb24uRGVmaW5pdGlvbikpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgdGhyZWFkaW5nIGFkYXB0ZWQgZnJvbQogICAgICAgICMgaHR0cHM6Ly9naXRodWIuY29tL2RhcmtvcGVyYXRvci9Qb3NoLVNlY01vZC9ibG9iL21hc3Rlci9EaXNjb3ZlcnkvRGlzY292ZXJ5LnBzbTEjTDQwNwogICAgICAgICMgICBUaGFua3MgQ2FybG9zIQoKICAgICAgICAjIGNyZWF0ZSBhIHBvb2wgb2YgbWF4VGhyZWFkIHJ1bnNwYWNlcwogICAgICAgICRQb29sID0gW3J1bnNwYWNlZmFjdG9yeV06OkNyZWF0ZVJ1bnNwYWNlUG9vbCgxLCAkVGhyZWFkcywgJFNlc3Npb25TdGF0ZSwgJEhvc3QpCiAgICAgICAgJFBvb2wuT3BlbigpCgogICAgICAgICRKb2JzID0gQCgpCiAgICAgICAgJFBTID0gQCgpCiAgICAgICAgJFdhaXQgPSBAKCkKCiAgICAgICAgJENvdW50ZXIgPSAwCiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIEZvckVhY2ggKCRDb21wdXRlciBpbiAkQ29tcHV0ZXJOYW1lKSB7CgogICAgICAgICAgICAjIG1ha2Ugc3VyZSB3ZSBnZXQgYSBzZXJ2ZXIgbmFtZQogICAgICAgICAgICBpZiAoJENvbXB1dGVyIC1uZSAnJykgewogICAgICAgICAgICAgICAgIyBXcml0ZS1WZXJib3NlICJbKl0gRW51bWVyYXRpbmcgc2VydmVyICRDb21wdXRlciAoJCgkQ291bnRlcisxKSBvZiAkKCRDb21wdXRlck5hbWUuY291bnQpKSIKCiAgICAgICAgICAgICAgICBXaGlsZSAoJCgkUG9vbC5HZXRBdmFpbGFibGVSdW5zcGFjZXMoKSkgLWxlIDApIHsKICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAtTWlsbGlTZWNvbmRzIDUwMAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgY3JlYXRlIGEgInBvd2Vyc2hlbGwgcGlwZWxpbmUgcnVubmVyIgogICAgICAgICAgICAgICAgJFBTICs9IFtwb3dlcnNoZWxsXTo6Y3JlYXRlKCkKCiAgICAgICAgICAgICAgICAkUFNbJENvdW50ZXJdLnJ1bnNwYWNlcG9vbCA9ICRQb29sCgogICAgICAgICAgICAgICAgIyBhZGQgdGhlIHNjcmlwdCBibG9jayArIGFyZ3VtZW50cwogICAgICAgICAgICAgICAgJE51bGwgPSAkUFNbJENvdW50ZXJdLkFkZFNjcmlwdCgkU2NyaXB0QmxvY2spLkFkZFBhcmFtZXRlcignQ29tcHV0ZXJOYW1lJywgJENvbXB1dGVyKQogICAgICAgICAgICAgICAgaWYoJFNjcmlwdFBhcmFtZXRlcnMpIHsKICAgICAgICAgICAgICAgICAgICBGb3JFYWNoICgkUGFyYW0gaW4gJFNjcmlwdFBhcmFtZXRlcnMuR2V0RW51bWVyYXRvcigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICROdWxsID0gJFBTWyRDb3VudGVyXS5BZGRQYXJhbWV0ZXIoJFBhcmFtLk5hbWUsICRQYXJhbS5WYWx1ZSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBzdGFydCBqb2IKICAgICAgICAgICAgICAgICRKb2JzICs9ICRQU1skQ291bnRlcl0uQmVnaW5JbnZva2UoKTsKCiAgICAgICAgICAgICAgICAjIHN0b3JlIHdhaXQgaGFuZGxlcyBmb3IgV2FpdEZvckFsbCBjYWxsCiAgICAgICAgICAgICAgICAkV2FpdCArPSAkSm9ic1skQ291bnRlcl0uQXN5bmNXYWl0SGFuZGxlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJENvdW50ZXIgPSAkQ291bnRlciArIDEKICAgICAgICB9CiAgICB9CgogICAgZW5kIHsKCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiV2FpdGluZyBmb3Igc2Nhbm5pbmcgdGhyZWFkcyB0byBmaW5pc2guLi4iCgogICAgICAgICRXYWl0VGltZW91dCA9IEdldC1EYXRlCgogICAgICAgICMgc2V0IGEgNjAgc2Vjb25kIHRpbWVvdXQgZm9yIHRoZSBzY2FubmluZyB0aHJlYWRzCiAgICAgICAgd2hpbGUgKCQoJEpvYnMgfCBXaGVyZS1PYmplY3QgeyRfLklzQ29tcGxldGVkIC1lcSAkRmFsc2V9KS5jb3VudCAtZ3QgMCAtb3IgJCgkKCQoR2V0LURhdGUpIC0gJFdhaXRUaW1lb3V0KS50b3RhbFNlY29uZHMpIC1ndCA2MCkgewogICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLU1pbGxpU2Vjb25kcyA1MDAKICAgICAgICAgICAgfQoKICAgICAgICAjIGVuZCBhc3luYyBjYWxsCiAgICAgICAgZm9yICgkeSA9IDA7ICR5IC1sdCAkQ291bnRlcjsgJHkrKykgewoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICMgY29tcGxldGUgYXN5bmMgam9iCiAgICAgICAgICAgICAgICAkUFNbJHldLkVuZEludm9rZSgkSm9ic1skeV0pCgogICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgImVycm9yOiAkXyIKICAgICAgICAgICAgfQogICAgICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICRQU1skeV0uRGlzcG9zZSgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgJFBvb2wuRGlzcG9zZSgpCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiQWxsIHRocmVhZHMgY29tcGxldGVkISIKICAgIH0KfQoKCmZ1bmN0aW9uIEludm9rZS1Vc2VySHVudGVyIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBGaW5kcyB3aGljaCBtYWNoaW5lcyB1c2VycyBvZiBhIHNwZWNpZmllZCBncm91cCBhcmUgbG9nZ2VkIGludG8uCgogICAgICAgIEF1dGhvcjogQGhhcm1qMHkKICAgICAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKCiAgICAuREVTQ1JJUFRJT04KCiAgICAgICAgVGhpcyBmdW5jdGlvbiBmaW5kcyB0aGUgbG9jYWwgZG9tYWluIG5hbWUgZm9yIGEgaG9zdCB1c2luZyBHZXQtTmV0RG9tYWluLAogICAgICAgIHF1ZXJpZXMgdGhlIGRvbWFpbiBmb3IgdXNlcnMgb2YgYSBzcGVjaWZpZWQgZ3JvdXAgKGRlZmF1bHQgImRvbWFpbiBhZG1pbnMiKQogICAgICAgIHdpdGggR2V0LU5ldEdyb3VwTWVtYmVyIG9yIHJlYWRzIGluIGEgdGFyZ2V0IHVzZXIgbGlzdCwgcXVlcmllcyB0aGUgZG9tYWluIGZvciBhbGwKICAgICAgICBhY3RpdmUgbWFjaGluZXMgd2l0aCBHZXQtTmV0Q29tcHV0ZXIgb3IgcmVhZHMgaW4gYSBwcmUtcG9wdWxhdGVkIGhvc3QgbGlzdCwKICAgICAgICByYW5kb21seSBzaHVmZmxlcyB0aGUgdGFyZ2V0IGxpc3QsIHRoZW4gZm9yIGVhY2ggc2VydmVyIGl0IGdldHMgYSBsaXN0IG9mCiAgICAgICAgYWN0aXZlIHVzZXJzIHdpdGggR2V0LU5ldFNlc3Npb24vR2V0LU5ldExvZ2dlZG9uLiBUaGUgZm91bmQgdXNlciBsaXN0IGlzIGNvbXBhcmVkCiAgICAgICAgYWdhaW5zdCB0aGUgdGFyZ2V0IGxpc3QsIGFuZCBhIHN0YXR1cyBtZXNzYWdlIGlzIGRpc3BsYXllZCBmb3IgYW55IGhpdHMuCiAgICAgICAgVGhlIGZsYWcgLUNoZWNrQWNjZXNzIHdpbGwgY2hlY2sgZWFjaCBwb3NpdGl2ZSBob3N0IHRvIHNlZSBpZiB0aGUgY3VycmVudAogICAgICAgIHVzZXIgaGFzIGxvY2FsIGFkbWluIGFjY2VzcyB0byB0aGUgbWFjaGluZS4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBIb3N0IGFycmF5IHRvIGVudW1lcmF0ZSwgcGFzc2FibGUgb24gdGhlIHBpcGVsaW5lLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJGaWxlCgogICAgICAgIEZpbGUgb2YgaG9zdG5hbWVzL0lQcyB0byBzZWFyY2guCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckZpbHRlcgoKICAgICAgICBIb3N0IGZpbHRlciBuYW1lIHRvIHF1ZXJ5IEFEIGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCBmb3IgaG9zdHMsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBVbmNvbnN0cmFpbmVkCgogICAgICAgIFN3aXRjaC4gT25seSBlbnVtZXJhdGUgY29tcHV0ZXJzIHRoYXQgaGF2ZSB1bmNvbnN0cmFpbmVkIGRlbGVnYXRpb24uCgogICAgLlBBUkFNRVRFUiBHcm91cE5hbWUKCiAgICAgICAgR3JvdXAgbmFtZSB0byBxdWVyeSBmb3IgdGFyZ2V0IHVzZXJzLgoKICAgIC5QQVJBTUVURVIgVGFyZ2V0U2VydmVyCgogICAgICAgIEh1bnQgZm9yIHVzZXJzIHdobyBhcmUgZWZmZWN0aXZlIGxvY2FsIGFkbWlucyBvbiBhIHRhcmdldCBzZXJ2ZXIuCgogICAgLlBBUkFNRVRFUiBVc2VyTmFtZQoKICAgICAgICBTcGVjaWZpYyB1c2VybmFtZSB0byBzZWFyY2ggZm9yLgoKICAgIC5QQVJBTUVURVIgVXNlckZpbHRlcgoKICAgICAgICBBIGN1c3RvbWl6ZWQgbGRhcCBmaWx0ZXIgc3RyaW5nIHRvIHVzZSBmb3IgdXNlciBlbnVtZXJhdGlvbiwgZS5nLiAiKGRlc2NyaXB0aW9uPSphZG1pbiopIgoKICAgIC5QQVJBTUVURVIgVXNlckFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoIGZvciB1c2VycywgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIFVzZXJGaWxlCgogICAgICAgIEZpbGUgb2YgdXNlcm5hbWVzIHRvIHNlYXJjaCBmb3IuCgogICAgLlBBUkFNRVRFUiBBZG1pbkNvdW50CgogICAgICAgIFN3aXRjaC4gSHVudCBmb3IgdXNlcnMgd2l0aCBhZG1pbkNvdW50PTEuCgogICAgLlBBUkFNRVRFUiBBbGxvd0RlbGVnYXRpb24KCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gdXNlciBhY2NvdW50cyB0aGF0IGFyZSBub3QgbWFya2VkIGFzICdzZW5zaXRpdmUgYW5kIG5vdCBhbGxvd2VkIGZvciBkZWxlZ2F0aW9uJwoKICAgIC5QQVJBTUVURVIgU3RvcE9uU3VjY2VzcwoKICAgICAgICBTd2l0Y2guIFN0b3AgaHVudGluZyBhZnRlciBmaW5kaW5nIGFmdGVyIGZpbmRpbmcgYSB0YXJnZXQgdXNlci4KCiAgICAuUEFSQU1FVEVSIE5vUGluZwoKICAgICAgICBEb24ndCBwaW5nIGVhY2ggaG9zdCB0byBlbnN1cmUgaXQncyB1cCBiZWZvcmUgZW51bWVyYXRpbmcuCgogICAgLlBBUkFNRVRFUiBDaGVja0FjY2VzcwoKICAgICAgICBTd2l0Y2guIENoZWNrIGlmIHRoZSBjdXJyZW50IHVzZXIgaGFzIGxvY2FsIGFkbWluIGFjY2VzcyB0byBmb3VuZCBtYWNoaW5lcy4KCiAgICAuUEFSQU1FVEVSIERlbGF5CgogICAgICAgIERlbGF5IGJldHdlZW4gZW51bWVyYXRpbmcgaG9zdHMsIGRlZmF1bHRzIHRvIDAKCiAgICAuUEFSQU1FVEVSIEppdHRlcgoKICAgICAgICBKaXR0ZXIgZm9yIHRoZSBob3N0IGRlbGF5LCBkZWZhdWx0cyB0byArLy0gMC4zCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIGZvciBxdWVyeSBmb3IgbWFjaGluZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFNob3dBbGwKCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gYWxsIHVzZXIgbG9jYXRpb24gcmVzdWx0cywgaS5lLiBJbnZva2UtVXNlclZpZXcgZnVuY3Rpb25hbGl0eS4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaEZvcmVzdAoKICAgICAgICBTd2l0Y2guIFNlYXJjaCBhbGwgZG9tYWlucyBpbiB0aGUgZm9yZXN0IGZvciB0YXJnZXQgdXNlcnMgaW5zdGVhZCBvZiBqdXN0CiAgICAgICAgYSBzaW5nbGUgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgU3RlYWx0aAoKICAgICAgICBTd2l0Y2guIE9ubHkgZW51bWVyYXRlIHNlc3Npb25zIGZyb20gY29ubm9ubHkgdXNlZCB0YXJnZXQgc2VydmVycy4KCiAgICAuUEFSQU1FVEVSIFN0ZWFsdGhTb3VyY2UKCiAgICAgICAgVGhlIHNvdXJjZSBvZiB0YXJnZXQgc2VydmVycyB0byB1c2UsICdERlMnIChkaXN0cmlidXRlZCBmaWxlIHNlcnZlcnMpLAogICAgICAgICdEQycgKGRvbWFpbiBjb250cm9sbGVycyksICdGaWxlJyAoZmlsZSBzZXJ2ZXJzKSwgb3IgJ0FsbCcKCiAgICAuUEFSQU1FVEVSIEZvcmVpZ25Vc2VycwoKICAgICAgICBTd2l0Y2guIE9ubHkgcmV0dXJuIHJlc3VsdHMgdGhhdCBhcmUgbm90IHBhcnQgb2Ygc2VhcmNoZWQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgVGhyZWFkcwoKICAgICAgICBUaGUgbWF4aW11bSBjb25jdXJyZW50IHRocmVhZHMgdG8gZXhlY3V0ZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1Vc2VySHVudGVyIC1DaGVja0FjY2VzcwoKICAgICAgICBGaW5kcyBtYWNoaW5lcyBvbiB0aGUgbG9jYWwgZG9tYWluIHdoZXJlIGRvbWFpbiBhZG1pbnMgYXJlIGxvZ2dlZCBpbnRvCiAgICAgICAgYW5kIGNoZWNrcyBpZiB0aGUgY3VycmVudCB1c2VyIGhhcyBsb2NhbCBhZG1pbmlzdHJhdG9yIGFjY2Vzcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1Vc2VySHVudGVyIC1Eb21haW4gJ3Rlc3RpbmcnCgogICAgICAgIEZpbmRzIG1hY2hpbmVzIG9uIHRoZSAndGVzdGluZycgZG9tYWluIHdoZXJlIGRvbWFpbiBhZG1pbnMgYXJlIGxvZ2dlZCBpbnRvLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVVzZXJIdW50ZXIgLVRocmVhZHMgMjAKCiAgICAgICAgTXVsdGktdGhyZWFkZWQgdXNlciBodW50aW5nLCByZXBsYWNlcyBJbnZva2UtVXNlckh1bnRlclRocmVhZGVkLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVVzZXJIdW50ZXIgLVVzZXJGaWxlIHVzZXJzLnR4dCAtQ29tcHV0ZXJGaWxlIGhvc3RzLnR4dAoKICAgICAgICBGaW5kcyBtYWNoaW5lcyBpbiBob3N0cy50eHQgd2hlcmUgYW55IG1lbWJlcnMgb2YgdXNlcnMudHh0IGFyZSBsb2dnZWQgaW4KICAgICAgICBvciBoYXZlIHNlc3Npb25zLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVVzZXJIdW50ZXIgLUdyb3VwTmFtZSAiUG93ZXIgVXNlcnMiIC1EZWxheSA2MAoKICAgICAgICBGaW5kIG1hY2hpbmVzIG9uIHRoZSBkb21haW4gd2hlcmUgbWVtYmVycyBvZiB0aGUgIlBvd2VyIFVzZXJzIiBncm91cHMgYXJlCiAgICAgICAgbG9nZ2VkIGludG8gd2l0aCBhIDYwIHNlY29uZCAoKy8tICouMykgcmFuZG9taXplZCBkZWxheSBiZXR3ZWVuCiAgICAgICAgdG91Y2hpbmcgZWFjaCBob3N0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVVzZXJIdW50ZXIgLVRhcmdldFNlcnZlciBGSUxFU0VSVkVSCgogICAgICAgIFF1ZXJ5IEZJTEVTRVJWRVIgZm9yIHVzZXJlcyB3aG8gYXJlIGVmZmVjdGl2ZSBsb2NhbCBhZG1pbmlzdHJhdG9ycyB1c2luZwogICAgICAgIEdldC1OZXRMb2NhbEdyb3VwIC1SZWN1cnNlLCBhbmQgaHVudCBmb3IgdGhhdCB1c2VyIHNldCBvbiB0aGUgbmV0d29yay4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1Vc2VySHVudGVyIC1TZWFyY2hGb3Jlc3QKCiAgICAgICAgRmluZCBhbGwgbWFjaGluZXMgaW4gdGhlIGN1cnJlbnQgZm9yZXN0IHdoZXJlIGRvbWFpbiBhZG1pbnMgYXJlIGxvZ2dlZCBpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1Vc2VySHVudGVyIC1TdGVhbHRoCgogICAgICAgIEV4ZWN1dGVzIG9sZCBJbnZva2UtU3RlYWx0aFVzZXJIdW50ZXIgZnVuY3Rpb25hbGl0eSwgZW51bWVyYXRpbmcgY29tbW9ubHkKICAgICAgICB1c2VkIHNlcnZlcnMgYW5kIGNoZWNraW5nIGp1c3Qgc2Vzc2lvbnMgZm9yIGVhY2guCgogICAgLkxJTksKICAgICAgICBodHRwOi8vYmxvZy5oYXJtajB5Lm5ldAojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdHMnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW0FsaWFzKCdIb3N0TGlzdCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyQURTcGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVW5jb25zdHJhaW5lZCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lID0gJ0RvbWFpbiBBZG1pbnMnLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRUYXJnZXRTZXJ2ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyQURTcGF0aCwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckZpbGUsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEFkbWluQ291bnQsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEFsbG93RGVsZWdhdGlvbiwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQ2hlY2tBY2Nlc3MsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFN0b3BPblN1Y2Nlc3MsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJE5vUGluZywKCiAgICAgICAgW1VJbnQzMl0KICAgICAgICAkRGVsYXkgPSAwLAoKICAgICAgICBbRG91YmxlXQogICAgICAgICRKaXR0ZXIgPSAuMywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTaG93QWxsLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTZWFyY2hGb3Jlc3QsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFN0ZWFsdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlU2V0KCJERlMiLCJEQyIsIkZpbGUiLCJBbGwiKV0KICAgICAgICAkU3RlYWx0aFNvdXJjZSA9IkFsbCIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEZvcmVpZ25Vc2VycywKCiAgICAgICAgW0ludF0KICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMCldCiAgICAgICAgJFRocmVhZHMKICAgICkKCiAgICBiZWdpbiB7CgogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0RlYnVnJ10pIHsKICAgICAgICAgICAgJERlYnVnUHJlZmVyZW5jZSA9ICdDb250aW51ZScKICAgICAgICB9CgogICAgICAgICMgcmFuZG9tIG9iamVjdCBmb3IgZGVsYXkKICAgICAgICAkUmFuZE5vID0gTmV3LU9iamVjdCBTeXN0ZW0uUmFuZG9tCgogICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBSdW5uaW5nIEludm9rZS1Vc2VySHVudGVyIHdpdGggZGVsYXkgb2YgJERlbGF5IgoKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgICAgICMKICAgICAgICAjIEZpcnN0IHdlIGJ1aWxkIHRoZSBob3N0IHRhcmdldCBzZXQKICAgICAgICAjCiAgICAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiAgICAgICAgaWYoJENvbXB1dGVyRmlsZSkgewogICAgICAgICAgICAjIGlmIHdlJ3JlIHVzaW5nIGEgaG9zdCBsaXN0LCByZWFkIHRoZSB0YXJnZXRzIGluIGFuZCBhZGQgdGhlbSB0byB0aGUgdGFyZ2V0IGxpc3QKICAgICAgICAgICAgJENvbXB1dGVyTmFtZSA9IEdldC1Db250ZW50IC1QYXRoICRDb21wdXRlckZpbGUKICAgICAgICB9CgogICAgICAgIGlmKCEkQ29tcHV0ZXJOYW1lKSB7IAogICAgICAgICAgICBbQXJyYXldJENvbXB1dGVyTmFtZSA9IEAoKQoKICAgICAgICAgICAgaWYoJERvbWFpbikgewogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCREb21haW4pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRTZWFyY2hGb3Jlc3QpIHsKICAgICAgICAgICAgICAgICMgZ2V0IEFMTCB0aGUgZG9tYWlucyBpbiB0aGUgZm9yZXN0IHRvIHNlYXJjaAogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBHZXQtTmV0Rm9yZXN0RG9tYWluIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5OYW1lIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICMgdXNlIHRoZSBsb2NhbCBkb21haW4KICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gQCggKEdldC1OZXREb21haW4pLm5hbWUgKQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZigkU3RlYWx0aCkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiU3RlYWx0aCBtb2RlISBFbnVtZXJhdGluZyBjb21tb25seSB1c2VkIHNlcnZlcnMiCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJTdGVhbHRoIHNvdXJjZTogJFN0ZWFsdGhTb3VyY2UiCgogICAgICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgICAgIGlmICgoJFN0ZWFsdGhTb3VyY2UgLWVxICJGaWxlIikgLW9yICgkU3RlYWx0aFNvdXJjZSAtZXEgIkFsbCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBRdWVyeWluZyBkb21haW4gJERvbWFpbiBmb3IgRmlsZSBTZXJ2ZXJzLi4uIgogICAgICAgICAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lICs9IEdldC1OZXRGaWxlU2VydmVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoKCRTdGVhbHRoU291cmNlIC1lcSAiREZTIikgLW9yICgkU3RlYWx0aFNvdXJjZSAtZXEgIkFsbCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBRdWVyeWluZyBkb21haW4gJERvbWFpbiBmb3IgREZTIFNlcnZlcnMuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgKz0gR2V0LURGU3NoYXJlIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciB8IEZvckVhY2gtT2JqZWN0IHskXy5SZW1vdGVTZXJ2ZXJOYW1lfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoKCRTdGVhbHRoU291cmNlIC1lcSAiREMiKSAtb3IgKCRTdGVhbHRoU291cmNlIC1lcSAiQWxsIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciBEb21haW4gQ29udHJvbGxlcnMuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgKz0gR2V0LU5ldERvbWFpbkNvbnRyb2xsZXIgLUxEQVAgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5kbnNob3N0bmFtZX0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBGb3JFYWNoICgkRG9tYWluIGluICRUYXJnZXREb21haW5zKSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciBob3N0cyIKCiAgICAgICAgICAgICAgICAgICAgJEFyZ3VtZW50cyA9IEB7CiAgICAgICAgICAgICAgICAgICAgICAgICdEb21haW4nID0gJERvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAnRG9tYWluQ29udHJvbGxlcicgPSAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAgICAgICAgICAgICAnQURTcGF0aCcgPSAkQURTcGF0aAogICAgICAgICAgICAgICAgICAgICAgICAnRmlsdGVyJyA9ICRDb21wdXRlckZpbHRlcgogICAgICAgICAgICAgICAgICAgICAgICAnVW5jb25zdHJhaW5lZCcgPSAkVW5jb25zdHJhaW5lZAogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSArPSBHZXQtTmV0Q29tcHV0ZXIgQEFyZ3VtZW50cwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHJlbW92ZSBhbnkgbnVsbCB0YXJnZXQgaG9zdHMsIHVuaXF1aWZ5IHRoZSBsaXN0IGFuZCBzaHVmZmxlIGl0CiAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHsgJF8gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgfCBTb3J0LU9iamVjdCB7IEdldC1SYW5kb20gfQogICAgICAgICAgICBpZigkKCRDb21wdXRlck5hbWUuQ291bnQpIC1lcSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiTm8gaG9zdHMgZm91bmQhIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgICAgICMKICAgICAgICAjIE5vdyB3ZSBidWlsZCB0aGUgdXNlciB0YXJnZXQgc2V0CiAgICAgICAgIwogICAgICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgogICAgICAgICMgdXNlcnMgd2UncmUgZ29pbmcgdG8gYmUgc2VhcmNoaW5nIGZvcgogICAgICAgICRUYXJnZXRVc2VycyA9IEAoKQoKICAgICAgICAjIGdldCB0aGUgY3VycmVudCB1c2VyIHNvIHdlIGNhbiBpZ25vcmUgaXQgaW4gdGhlIHJlc3VsdHMKICAgICAgICAkQ3VycmVudFVzZXIgPSAoW0Vudmlyb25tZW50XTo6VXNlck5hbWUpLnRvTG93ZXIoKQoKICAgICAgICAjIGlmIHdlJ3JlIHNob3dpbmcgYWxsIHJlc3VsdHMsIHNraXAgdXNlcm5hbWUgZW51bWVyYXRpb24KICAgICAgICBpZigkU2hvd0FsbCAtb3IgJEZvcmVpZ25Vc2VycykgewogICAgICAgICAgICAkVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyRG9tYWluJyAkTnVsbAogICAgICAgICAgICAkVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJOYW1lJyAnKicKICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gQCgkVXNlcikKCiAgICAgICAgICAgIGlmKCRGb3JlaWduVXNlcnMpIHsKICAgICAgICAgICAgICAgICMgaWYgd2UncmUgc2VhcmNoaW5nIGZvciB1c2VyIHJlc3VsdHMgbm90IGluIHRoZSBwcmltYXJ5IGRvbWFpbgogICAgICAgICAgICAgICAgJGtyYnRndE5hbWUgPSBDb252ZXJ0LUFETmFtZSAtT2JqZWN0TmFtZSAia3JidGd0QCQoJERvbWFpbikiIC1JbnB1dFR5cGUgU2ltcGxlIC1PdXRwdXRUeXBlIE5UNAogICAgICAgICAgICAgICAgJERvbWFpblNob3J0TmFtZSA9ICRrcmJ0Z3ROYW1lLnNwbGl0KCJcIilbMF0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAjIGlmIHdlIHdhbnQgdG8gaHVudCBmb3IgdGhlIGVmZmVjdGl2ZSBkb21haW4gdXNlcnMgd2hvIGNhbiBhY2Nlc3MgYSB0YXJnZXQgc2VydmVyCiAgICAgICAgZWxzZWlmKCRUYXJnZXRTZXJ2ZXIpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiUXVlcnlpbmcgdGFyZ2V0IHNlcnZlciAnJFRhcmdldFNlcnZlcicgZm9yIGxvY2FsIHVzZXJzIgogICAgICAgICAgICAkVGFyZ2V0VXNlcnMgPSBHZXQtTmV0TG9jYWxHcm91cCAkVGFyZ2V0U2VydmVyIC1SZWN1cnNlIHwgV2hlcmUtT2JqZWN0IHsoLW5vdCAkXy5Jc0dyb3VwKSAtYW5kICRfLklzRG9tYWluIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAkVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlckRvbWFpbicgKCRfLkFjY291bnROYW1lKS5zcGxpdCgiLyIpWzBdLnRvTG93ZXIoKSAKICAgICAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlck5hbWUnICgkXy5BY2NvdW50TmFtZSkuc3BsaXQoIi8iKVsxXS50b0xvd2VyKCkgCiAgICAgICAgICAgICAgICAkVXNlcgogICAgICAgICAgICB9ICB8IFdoZXJlLU9iamVjdCB7JF99CiAgICAgICAgfQogICAgICAgICMgaWYgd2UgZ2V0IGEgc3BlY2lmaWMgdXNlcm5hbWUsIG9ubHkgdXNlIHRoYXQKICAgICAgICBlbHNlaWYoJFVzZXJOYW1lKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBVc2luZyB0YXJnZXQgdXNlciAnJFVzZXJOYW1lJy4uLiIKICAgICAgICAgICAgJFVzZXIgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgIGlmKCRUYXJnZXREb21haW5zKSB7CiAgICAgICAgICAgICAgICAkVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJEb21haW4nICRUYXJnZXREb21haW5zWzBdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJEb21haW4nICROdWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyTmFtZScgJFVzZXJOYW1lLlRvTG93ZXIoKQogICAgICAgICAgICAkVGFyZ2V0VXNlcnMgPSBAKCRVc2VyKQogICAgICAgIH0KICAgICAgICAjIHJlYWQgaW4gYSB0YXJnZXQgdXNlciBsaXN0IGlmIHdlIGhhdmUgb25lCiAgICAgICAgZWxzZWlmKCRVc2VyRmlsZSkgewogICAgICAgICAgICAkVGFyZ2V0VXNlcnMgPSBHZXQtQ29udGVudCAtUGF0aCAkVXNlckZpbGUgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAkVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgIGlmKCRUYXJnZXREb21haW5zKSB7CiAgICAgICAgICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyRG9tYWluJyAkVGFyZ2V0RG9tYWluc1swXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyRG9tYWluJyAkTnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyTmFtZScgJF8KICAgICAgICAgICAgICAgICRVc2VyCiAgICAgICAgICAgIH0gIHwgV2hlcmUtT2JqZWN0IHskX30KICAgICAgICB9CiAgICAgICAgZWxzZWlmKCRVc2VyQURTcGF0aCAtb3IgJFVzZXJGaWx0ZXIgLW9yICRBZG1pbkNvdW50KSB7CiAgICAgICAgICAgIEZvckVhY2ggKCREb21haW4gaW4gJFRhcmdldERvbWFpbnMpIHsKCiAgICAgICAgICAgICAgICAkQXJndW1lbnRzID0gQHsKICAgICAgICAgICAgICAgICAgICAnRG9tYWluJyA9ICREb21haW4KICAgICAgICAgICAgICAgICAgICAnRG9tYWluQ29udHJvbGxlcicgPSAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAgICAgICAgICdBRFNwYXRoJyA9ICRVc2VyQURTcGF0aAogICAgICAgICAgICAgICAgICAgICdGaWx0ZXInID0gJFVzZXJGaWx0ZXIKICAgICAgICAgICAgICAgICAgICAnQWRtaW5Db3VudCcgPSAkQWRtaW5Db3VudAogICAgICAgICAgICAgICAgICAgICdBbGxvd0RlbGVnYXRpb24nID0gJEFsbG93RGVsZWdhdGlvbgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBRdWVyeWluZyBkb21haW4gJERvbWFpbiBmb3IgdXNlcnMiCiAgICAgICAgICAgICAgICAkVGFyZ2V0VXNlcnMgKz0gR2V0LU5ldFVzZXIgQEFyZ3VtZW50cyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAkVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAkVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJEb21haW4nICREb21haW4KICAgICAgICAgICAgICAgICAgICAkVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJOYW1lJyAkXy5zYW1hY2NvdW50bmFtZQogICAgICAgICAgICAgICAgICAgICRVc2VyCiAgICAgICAgICAgICAgICB9ICB8IFdoZXJlLU9iamVjdCB7JF99CgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBGb3JFYWNoICgkRG9tYWluIGluICRUYXJnZXREb21haW5zKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIHVzZXJzIG9mIGdyb3VwICckR3JvdXBOYW1lJyIKICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyArPSBHZXQtTmV0R3JvdXBNZW1iZXIgLUdyb3VwTmFtZSAkR3JvdXBOYW1lIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoKCAoLW5vdCAkU2hvd0FsbCkgLWFuZCAoLW5vdCAkRm9yZWlnblVzZXJzKSApIC1hbmQgKCghJFRhcmdldFVzZXJzKSAtb3IgKCRUYXJnZXRVc2Vycy5Db3VudCAtZXEgMCkpKSB7CiAgICAgICAgICAgIHRocm93ICJbIV0gTm8gdXNlcnMgZm91bmQgdG8gc2VhcmNoIGZvciEiCiAgICAgICAgfQoKICAgICAgICAjIHNjcmlwdCBibG9jayB0aGF0IGVudW1lcmF0ZXMgYSBzZXJ2ZXIKICAgICAgICAkSG9zdEVudW1CbG9jayA9IHsKICAgICAgICAgICAgcGFyYW0oJENvbXB1dGVyTmFtZSwgJFBpbmcsICRUYXJnZXRVc2VycywgJEN1cnJlbnRVc2VyLCAkU3RlYWx0aCwgJERvbWFpblNob3J0TmFtZSkKCiAgICAgICAgICAgICMgb3B0aW9uYWxseSBjaGVjayBpZiB0aGUgc2VydmVyIGlzIHVwIGZpcnN0CiAgICAgICAgICAgICRVcCA9ICRUcnVlCiAgICAgICAgICAgIGlmKCRQaW5nKSB7CiAgICAgICAgICAgICAgICAkVXAgPSBUZXN0LUNvbm5lY3Rpb24gLUNvdW50IDEgLVF1aWV0IC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRVcCkgewogICAgICAgICAgICAgICAgaWYoISREb21haW5TaG9ydE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIG5vdCBzZWFyY2hpbmcgZm9yIGZvcmVpZ24gdXNlcnMsIGNoZWNrIHNlc3Npb24gaW5mb3JtYXRpb24KICAgICAgICAgICAgICAgICAgICAkU2Vzc2lvbnMgPSBHZXQtTmV0U2Vzc2lvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgICAgICBGb3JFYWNoICgkU2Vzc2lvbiBpbiAkU2Vzc2lvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJOYW1lID0gJFNlc3Npb24uc2VzaTEwX3VzZXJuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRDTmFtZSA9ICRTZXNzaW9uLnNlc2kxMF9jbmFtZQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJENOYW1lIC1hbmQgJENOYW1lLlN0YXJ0c1dpdGgoIlxcIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDTmFtZSA9ICRDTmFtZS5UcmltU3RhcnQoIlwiKQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAjIG1ha2Ugc3VyZSB3ZSBoYXZlIGEgcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJFVzZXJOYW1lKSAtYW5kICgkVXNlck5hbWUudHJpbSgpIC1uZSAnJykgLWFuZCAoISgkVXNlck5hbWUgLW1hdGNoICRDdXJyZW50VXNlcikpKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRhcmdldFVzZXJzIHwgV2hlcmUtT2JqZWN0IHskVXNlck5hbWUgLWxpa2UgJF8uTWVtYmVyTmFtZX0gfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRJUEFkZHJlc3MgPSBAKEdldC1JUEFkZHJlc3MgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lKVswXS5JUEFkZHJlc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlckRvbWFpbicgJF8uTWVtYmVyRG9tYWluCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyTmFtZScgJFVzZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lQQWRkcmVzcycgJElQQWRkcmVzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU2Vzc2lvbkZyb20nICRDTmFtZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFRyeSB0byByZXNvbHZlIHRoZSBETlMgaG9zdG5hbWUgb2YgJENuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRDbmFtZSAtbWF0Y2ggJ1thLXpBLVpdJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJENOYW1lRE5TTmFtZSA9IFtTeXN0ZW0uTmV0LkRuc106OkdldEhvc3RCeU5hbWUoJENOYW1lKS5Ib3N0bmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDTmFtZUROU05hbWUgPSAkQ25hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlUHJvcGVydHkgJ1Nlc3Npb25Gcm9tTmFtZScgJENuYW1lRE5TTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDTmFtZUROU05hbWUgPSBbU3lzdGVtLk5ldC5EbnNdOjpSZXNvbHZlKCRDbmFtZSkuSG9zdE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQ05hbWVETlNOYW1lID0gJENuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZVByb3BlcnR5ICdTZXNzaW9uRnJvbU5hbWUnICRDbmFtZUROU05hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgc2VlIGlmIHdlJ3JlIGNoZWNraW5nIHRvIHNlZSBpZiB3ZSBoYXZlIGxvY2FsIGFkbWluIGFjY2VzcyBvbiB0aGlzIG1hY2hpbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJENoZWNrQWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBZG1pbiA9IEludm9rZS1DaGVja0xvY2FsQWRtaW5BY2Nlc3MgLUNvbXB1dGVyTmFtZSAkQ05hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdMb2NhbEFkbWluJyAkQWRtaW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTG9jYWxBZG1pbicgJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlci5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuVXNlclNlc3Npb24nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCEkU3RlYWx0aCkgewogICAgICAgICAgICAgICAgICAgICMgaWYgd2UncmUgbm90ICdzdGVhbHRoeScsIGVudW1lcmF0ZSBsb2dnZWRvbiB1c2VycyBhcyB3ZWxsCiAgICAgICAgICAgICAgICAgICAgJExvZ2dlZE9uID0gR2V0LU5ldExvZ2dlZG9uIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgICAgIEZvckVhY2ggKCRVc2VyIGluICRMb2dnZWRPbikgewogICAgICAgICAgICAgICAgICAgICAgICAkVXNlck5hbWUgPSAkVXNlci53a3VpMV91c2VybmFtZQogICAgICAgICAgICAgICAgICAgICAgICAjIFRPRE86IHRyYW5zbGF0ZSBkb21haW4gdG8gYXV0aG9yYXRhdGl2ZSBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICMgICB0aGVuIG1hdGNoIGRvbWFpbiBuYW1lID8KICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJEb21haW4gPSAkVXNlci53a3VpMV9sb2dvbl9kb21haW4KCiAgICAgICAgICAgICAgICAgICAgICAgICMgbWFrZSBzdXJlIHdldCBoYXZlIGEgcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJFVzZXJOYW1lKSAtYW5kICgkVXNlck5hbWUudHJpbSgpIC1uZSAnJykpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGFyZ2V0VXNlcnMgfCBXaGVyZS1PYmplY3QgeyRVc2VyTmFtZSAtbGlrZSAkXy5NZW1iZXJOYW1lfSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFByb2NlZWQgPSAkVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCREb21haW5TaG9ydE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCREb21haW5TaG9ydE5hbWUuVG9Mb3dlcigpIC1uZSAkVXNlckRvbWFpbi5Ub0xvd2VyKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcm9jZWVkID0gJFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcm9jZWVkID0gJEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJFByb2NlZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJElQQWRkcmVzcyA9IEAoR2V0LUlQQWRkcmVzcyAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUpWzBdLklQQWRkcmVzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJEb21haW4nICRVc2VyRG9tYWluCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlck5hbWUnICRVc2VyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lQQWRkcmVzcycgJElQQWRkcmVzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1Nlc3Npb25Gcm9tJyAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1Nlc3Npb25Gcm9tTmFtZScgJE51bGwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgc2VlIGlmIHdlJ3JlIGNoZWNraW5nIHRvIHNlZSBpZiB3ZSBoYXZlIGxvY2FsIGFkbWluIGFjY2VzcyBvbiB0aGlzIG1hY2hpbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRDaGVja0FjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEFkbWluID0gSW52b2tlLUNoZWNrTG9jYWxBZG1pbkFjY2VzcyAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTG9jYWxBZG1pbicgJEFkbWluCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0xvY2FsQWRtaW4nICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlci5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuVXNlclNlc3Npb24nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgaWYoJFRocmVhZHMpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVXNpbmcgdGhyZWFkaW5nIHdpdGggdGhyZWFkcyA9ICRUaHJlYWRzIgoKICAgICAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyB0aHJlYWRpbmcsIGtpY2sgb2ZmIHRoZSBzY3JpcHQgYmxvY2sgd2l0aCBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbgogICAgICAgICAgICAkU2NyaXB0UGFyYW1zID0gQHsKICAgICAgICAgICAgICAgICdQaW5nJyA9ICQoLW5vdCAkTm9QaW5nKQogICAgICAgICAgICAgICAgJ1RhcmdldFVzZXJzJyA9ICRUYXJnZXRVc2VycwogICAgICAgICAgICAgICAgJ0N1cnJlbnRVc2VyJyA9ICRDdXJyZW50VXNlcgogICAgICAgICAgICAgICAgJ1N0ZWFsdGgnID0gJFN0ZWFsdGgKICAgICAgICAgICAgICAgICdEb21haW5TaG9ydE5hbWUnID0gJERvbWFpblNob3J0TmFtZQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGtpY2sgb2ZmIHRoZSB0aHJlYWRlZCBzY3JpcHQgYmxvY2sgKyBhcmd1bWVudHMgCiAgICAgICAgICAgIEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtU2NyaXB0QmxvY2sgJEhvc3RFbnVtQmxvY2sgLVNjcmlwdFBhcmFtZXRlcnMgJFNjcmlwdFBhcmFtcyAtVGhyZWFkcyAkVGhyZWFkcwogICAgICAgIH0KCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKC1ub3QgJE5vUGluZyAtYW5kICgkQ29tcHV0ZXJOYW1lLmNvdW50IC1uZSAxKSkgewogICAgICAgICAgICAgICAgIyBwaW5nIGFsbCBob3N0cyBpbiBwYXJhbGxlbAogICAgICAgICAgICAgICAgJFBpbmcgPSB7cGFyYW0oJENvbXB1dGVyTmFtZSkgaWYoVGVzdC1Db25uZWN0aW9uIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtQ291bnQgMSAtUXVpZXQgLUVycm9yQWN0aW9uIFN0b3ApeyRDb21wdXRlck5hbWV9fQogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSA9IEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uIC1Ob0ltcG9ydHMgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1TY3JpcHRCbG9jayAkUGluZyAtVGhyZWFkcyAxMDAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFRvdGFsIG51bWJlciBvZiBhY3RpdmUgaG9zdHM6ICQoJENvbXB1dGVyTmFtZS5jb3VudCkiCiAgICAgICAgICAgICRDb3VudGVyID0gMAoKICAgICAgICAgICAgRm9yRWFjaCAoJENvbXB1dGVyIGluICRDb21wdXRlck5hbWUpIHsKCiAgICAgICAgICAgICAgICAkQ291bnRlciA9ICRDb3VudGVyICsgMQoKICAgICAgICAgICAgICAgICMgc2xlZXAgZm9yIG91ciBzZW1pLXJhbmRvbWl6ZWQgaW50ZXJ2YWwKICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzICRSYW5kTm8uTmV4dCgoMS0kSml0dGVyKSokRGVsYXksICgxKyRKaXR0ZXIpKiREZWxheSkKCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gRW51bWVyYXRpbmcgc2VydmVyICRDb21wdXRlciAoJENvdW50ZXIgb2YgJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSkiCiAgICAgICAgICAgICAgICAkUmVzdWx0ID0gSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1Bcmd1bWVudExpc3QgJENvbXB1dGVyLCAkRmFsc2UsICRUYXJnZXRVc2VycywgJEN1cnJlbnRVc2VyLCAkU3RlYWx0aCwgJERvbWFpblNob3J0TmFtZQogICAgICAgICAgICAgICAgJFJlc3VsdAoKICAgICAgICAgICAgICAgIGlmKCRSZXN1bHQgLWFuZCAkU3RvcE9uU3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBUYXJnZXQgdXNlciBmb3VuZCwgcmV0dXJuaW5nIGVhcmx5IgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KfQoKCmZ1bmN0aW9uIEludm9rZS1TdGVhbHRoVXNlckh1bnRlciB7CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3RzJyldCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgICRDb21wdXRlck5hbWUsCgogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7VGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtBbGlhcygnSG9zdExpc3QnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckZpbGUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdyb3VwTmFtZSA9ICdEb21haW4gQWRtaW5zJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGFyZ2V0U2VydmVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckFEU3BhdGgsCgogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7VGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJGaWxlLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRDaGVja0FjY2VzcywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU3RvcE9uU3VjY2VzcywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTm9QaW5nLAoKICAgICAgICBbVUludDMyXQogICAgICAgICREZWxheSA9IDAsCgogICAgICAgIFtEb3VibGVdCiAgICAgICAgJEppdHRlciA9IC4zLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNob3dBbGwsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNlYXJjaEZvcmVzdCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVTZXQoIkRGUyIsIkRDIiwiRmlsZSIsIkFsbCIpXQogICAgICAgICRTdGVhbHRoU291cmNlID0iQWxsIgogICAgKQogICAgIyBraWNrIG9mZiBJbnZva2UtVXNlckh1bnRlciB3aXRoIHN0ZWFsdGggb3B0aW9ucwogICAgSW52b2tlLVVzZXJIdW50ZXIgLVN0ZWFsdGggQFBTQm91bmRQYXJhbWV0ZXJzCn0KCgpmdW5jdGlvbiBJbnZva2UtUHJvY2Vzc0h1bnRlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUXVlcnkgdGhlIHByb2Nlc3MgbGlzdHMgb2YgcmVtb3RlIG1hY2hpbmVzLCBzZWFyY2hpbmcgZm9yCiAgICAgICAgcHJvY2Vzc2VzIHdpdGggYSBzcGVjaWZpYyBuYW1lIG9yIG93bmVkIGJ5IGEgc3BlY2lmaWMgdXNlci4KICAgICAgICBUaGFua3MgdG8gQHBhdWxicmFuZGF1IGZvciB0aGUgYXBwcm9hY2ggaWRlYS4KICAgICAgICAKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgSG9zdCBhcnJheSB0byBlbnVtZXJhdGUsIHBhc3NhYmxlIG9uIHRoZSBwaXBlbGluZS4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsZQoKICAgICAgICBGaWxlIG9mIGhvc3RuYW1lcy9JUHMgdG8gc2VhcmNoLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJGaWx0ZXIKCiAgICAgICAgSG9zdCBmaWx0ZXIgbmFtZSB0byBxdWVyeSBBRCBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIGhvc3RzLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgUHJvY2Vzc05hbWUKCiAgICAgICAgVGhlIG5hbWUgb2YgdGhlIHByb2Nlc3MgdG8gaHVudCwgb3IgYSBjb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBuYW1lcy4KCiAgICAuUEFSQU1FVEVSIEdyb3VwTmFtZQoKICAgICAgICBHcm91cCBuYW1lIHRvIHF1ZXJ5IGZvciB0YXJnZXQgdXNlcnMuCgogICAgLlBBUkFNRVRFUiBUYXJnZXRTZXJ2ZXIKCiAgICAgICAgSHVudCBmb3IgdXNlcnMgd2hvIGFyZSBlZmZlY3RpdmUgbG9jYWwgYWRtaW5zIG9uIGEgdGFyZ2V0IHNlcnZlci4KCiAgICAuUEFSQU1FVEVSIFVzZXJOYW1lCgogICAgICAgIFNwZWNpZmljIHVzZXJuYW1lIHRvIHNlYXJjaCBmb3IuCgogICAgLlBBUkFNRVRFUiBVc2VyRmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlIGZvciB1c2VyIGVudW1lcmF0aW9uLCBlLmcuICIoZGVzY3JpcHRpb249KmFkbWluKikiCgogICAgLlBBUkFNRVRFUiBVc2VyQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIHVzZXJzLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgVXNlckZpbGUKCiAgICAgICAgRmlsZSBvZiB1c2VybmFtZXMgdG8gc2VhcmNoIGZvci4KCiAgICAuUEFSQU1FVEVSIFN0b3BPblN1Y2Nlc3MKCiAgICAgICAgU3dpdGNoLiBTdG9wIGh1bnRpbmcgYWZ0ZXIgZmluZGluZyBhZnRlciBmaW5kaW5nIGEgdGFyZ2V0IHVzZXIvcHJvY2Vzcy4KCiAgICAuUEFSQU1FVEVSIE5vUGluZwoKICAgICAgICBTd2l0Y2guIERvbid0IHBpbmcgZWFjaCBob3N0IHRvIGVuc3VyZSBpdCdzIHVwIGJlZm9yZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIERlbGF5CgogICAgICAgIERlbGF5IGJldHdlZW4gZW51bWVyYXRpbmcgaG9zdHMsIGRlZmF1bHRzIHRvIDAKCiAgICAuUEFSQU1FVEVSIEppdHRlcgoKICAgICAgICBKaXR0ZXIgZm9yIHRoZSBob3N0IGRlbGF5LCBkZWZhdWx0cyB0byArLy0gMC4zCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIGZvciBxdWVyeSBmb3IgbWFjaGluZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFNob3dBbGwKCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gYWxsIHVzZXIgbG9jYXRpb24gcmVzdWx0cy4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaEZvcmVzdAoKICAgICAgICBTd2l0Y2guIFNlYXJjaCBhbGwgZG9tYWlucyBpbiB0aGUgZm9yZXN0IGZvciB0YXJnZXQgdXNlcnMgaW5zdGVhZCBvZiBqdXN0CiAgICAgICAgYSBzaW5nbGUgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgVGhyZWFkcwoKICAgICAgICBUaGUgbWF4aW11bSBjb25jdXJyZW50IHRocmVhZHMgdG8gZXhlY3V0ZS4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgbWFjaGluZS9kb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtUHJvY2Vzc0h1bnRlciAtRG9tYWluICd0ZXN0aW5nJwogICAgICAgIAogICAgICAgIEZpbmRzIG1hY2hpbmVzIG9uIHRoZSAndGVzdGluZycgZG9tYWluIHdoZXJlIGRvbWFpbiBhZG1pbnMgaGF2ZSBhCiAgICAgICAgcnVubmluZyBwcm9jZXNzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVByb2Nlc3NIdW50ZXIgLVRocmVhZHMgMjAKCiAgICAgICAgTXVsdGktdGhyZWFkZWQgcHJvY2VzcyBodW50aW5nLCByZXBsYWNlcyBJbnZva2UtUHJvY2Vzc0h1bnRlclRocmVhZGVkLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVByb2Nlc3NIdW50ZXIgLVVzZXJGaWxlIHVzZXJzLnR4dCAtQ29tcHV0ZXJGaWxlIGhvc3RzLnR4dAogICAgICAgIAogICAgICAgIEZpbmRzIG1hY2hpbmVzIGluIGhvc3RzLnR4dCB3aGVyZSBhbnkgbWVtYmVycyBvZiB1c2Vycy50eHQgaGF2ZSBydW5uaW5nCiAgICAgICAgcHJvY2Vzc2VzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVByb2Nlc3NIdW50ZXIgLUdyb3VwTmFtZSAiUG93ZXIgVXNlcnMiIC1EZWxheSA2MAogICAgICAgIAogICAgICAgIEZpbmQgbWFjaGluZXMgb24gdGhlIGRvbWFpbiB3aGVyZSBtZW1iZXJzIG9mIHRoZSAiUG93ZXIgVXNlcnMiIGdyb3VwcyBoYXZlCiAgICAgICAgcnVubmluZyBwcm9jZXNzZXMgd2l0aCBhIDYwIHNlY29uZCAoKy8tICouMykgcmFuZG9taXplZCBkZWxheSBiZXR3ZWVuCiAgICAgICAgdG91Y2hpbmcgZWFjaCBob3N0LgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly9ibG9nLmhhcm1qMHkubmV0CiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0cycpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkQ29tcHV0ZXJOYW1lLAoKICAgICAgICBbVmFsaWRhdGVTY3JpcHQoe1Rlc3QtUGF0aCAtUGF0aCAkXyB9KV0KICAgICAgICBbQWxpYXMoJ0hvc3RMaXN0JyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWxlLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJBRFNwYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRQcm9jZXNzTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lID0gJ0RvbWFpbiBBZG1pbnMnLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRUYXJnZXRTZXJ2ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyQURTcGF0aCwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckZpbGUsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFN0b3BPblN1Y2Nlc3MsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJE5vUGluZywKCiAgICAgICAgW1VJbnQzMl0KICAgICAgICAkRGVsYXkgPSAwLAoKICAgICAgICBbRG91YmxlXQogICAgICAgICRKaXR0ZXIgPSAuMywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTaG93QWxsLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTZWFyY2hGb3Jlc3QsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkVGhyZWFkcywKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBiZWdpbiB7CgogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0RlYnVnJ10pIHsKICAgICAgICAgICAgJERlYnVnUHJlZmVyZW5jZSA9ICdDb250aW51ZScKICAgICAgICB9CgogICAgICAgICMgcmFuZG9tIG9iamVjdCBmb3IgZGVsYXkKICAgICAgICAkUmFuZE5vID0gTmV3LU9iamVjdCBTeXN0ZW0uUmFuZG9tCgogICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBSdW5uaW5nIEludm9rZS1Qcm9jZXNzSHVudGVyIHdpdGggZGVsYXkgb2YgJERlbGF5IgoKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgICAgICMKICAgICAgICAjIEZpcnN0IHdlIGJ1aWxkIHRoZSBob3N0IHRhcmdldCBzZXQKICAgICAgICAjCiAgICAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyBhIGhvc3QgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgaWYoJENvbXB1dGVyRmlsZSkgewogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gR2V0LUNvbnRlbnQgLVBhdGggJENvbXB1dGVyRmlsZQogICAgICAgIH0KCiAgICAgICAgaWYoISRDb21wdXRlck5hbWUpIHsgCiAgICAgICAgICAgIFthcnJheV0kQ29tcHV0ZXJOYW1lID0gQCgpCgogICAgICAgICAgICBpZigkRG9tYWluKSB7CiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoJERvbWFpbikKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoJFNlYXJjaEZvcmVzdCkgewogICAgICAgICAgICAgICAgIyBnZXQgQUxMIHRoZSBkb21haW5zIGluIHRoZSBmb3Jlc3QgdG8gc2VhcmNoCiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEdldC1OZXRGb3Jlc3REb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgfCBGb3JFYWNoLU9iamVjdCB7ICRfLk5hbWUgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgIyB1c2UgdGhlIGxvY2FsIGRvbWFpbgogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCAoR2V0LU5ldERvbWFpbiAtRG9tYWluICREb21haW4gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwpLm5hbWUgKQogICAgICAgICAgICB9CgogICAgICAgICAgICBGb3JFYWNoICgkRG9tYWluIGluICRUYXJnZXREb21haW5zKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIGhvc3RzIgogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSArPSBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1GaWx0ZXIgJENvbXB1dGVyRmlsdGVyIC1BRFNwYXRoICRDb21wdXRlckFEU3BhdGgKICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgICAgICAjIHJlbW92ZSBhbnkgbnVsbCB0YXJnZXQgaG9zdHMsIHVuaXF1aWZ5IHRoZSBsaXN0IGFuZCBzaHVmZmxlIGl0CiAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHsgJF8gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgfCBTb3J0LU9iamVjdCB7IEdldC1SYW5kb20gfQogICAgICAgICAgICBpZigkKCRDb21wdXRlck5hbWUuQ291bnQpIC1lcSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiTm8gaG9zdHMgZm91bmQhIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgICAgICMKICAgICAgICAjIE5vdyB3ZSBidWlsZCB0aGUgdXNlciB0YXJnZXQgc2V0CiAgICAgICAgIwogICAgICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgogICAgICAgIGlmKCEkUHJvY2Vzc05hbWUpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiTm8gcHJvY2VzcyBuYW1lIHNwZWNpZmllZCwgYnVpbGRpbmcgYSB0YXJnZXQgdXNlciBzZXQiCgogICAgICAgICAgICAjIHVzZXJzIHdlJ3JlIGdvaW5nIHRvIGJlIHNlYXJjaGluZyBmb3IKICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gQCgpCgogICAgICAgICAgICAjIGlmIHdlIHdhbnQgdG8gaHVudCBmb3IgdGhlIGVmZmVjdGl2ZSBkb21haW4gdXNlcnMgd2hvIGNhbiBhY2Nlc3MgYSB0YXJnZXQgc2VydmVyCiAgICAgICAgICAgIGlmKCRUYXJnZXRTZXJ2ZXIpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlF1ZXJ5aW5nIHRhcmdldCBzZXJ2ZXIgJyRUYXJnZXRTZXJ2ZXInIGZvciBsb2NhbCB1c2VycyIKICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyA9IEdldC1OZXRMb2NhbEdyb3VwICRUYXJnZXRTZXJ2ZXIgLVJlY3Vyc2UgfCBXaGVyZS1PYmplY3Qgeygtbm90ICRfLklzR3JvdXApIC1hbmQgJF8uSXNEb21haW4gfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAoJF8uQWNjb3VudE5hbWUpLnNwbGl0KCIvIilbMV0udG9Mb3dlcigpCiAgICAgICAgICAgICAgICB9ICB8IFdoZXJlLU9iamVjdCB7JF99CiAgICAgICAgICAgIH0KICAgICAgICAgICAgIyBpZiB3ZSBnZXQgYSBzcGVjaWZpYyB1c2VybmFtZSwgb25seSB1c2UgdGhhdAogICAgICAgICAgICBlbHNlaWYoJFVzZXJOYW1lKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gVXNpbmcgdGFyZ2V0IHVzZXIgJyRVc2VyTmFtZScuLi4iCiAgICAgICAgICAgICAgICAkVGFyZ2V0VXNlcnMgPSBAKCAkVXNlck5hbWUuVG9Mb3dlcigpICkKICAgICAgICAgICAgfQogICAgICAgICAgICAjIHJlYWQgaW4gYSB0YXJnZXQgdXNlciBsaXN0IGlmIHdlIGhhdmUgb25lCiAgICAgICAgICAgIGVsc2VpZigkVXNlckZpbGUpIHsKICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyA9IEdldC1Db250ZW50IC1QYXRoICRVc2VyRmlsZSB8IFdoZXJlLU9iamVjdCB7JF99CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRVc2VyQURTcGF0aCAtb3IgJFVzZXJGaWx0ZXIpIHsKICAgICAgICAgICAgICAgIEZvckVhY2ggKCREb21haW4gaW4gJFRhcmdldERvbWFpbnMpIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIHVzZXJzIgogICAgICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyArPSBHZXQtTmV0VXNlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJFVzZXJBRFNwYXRoIC1GaWx0ZXIgJFVzZXJGaWx0ZXIgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICRfLnNhbWFjY291bnRuYW1lCiAgICAgICAgICAgICAgICAgICAgfSAgfCBXaGVyZS1PYmplY3QgeyRffQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBRdWVyeWluZyBkb21haW4gJERvbWFpbiBmb3IgdXNlcnMgb2YgZ3JvdXAgJyRHcm91cE5hbWUnIgogICAgICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyArPSBHZXQtTmV0R3JvdXBNZW1iZXIgLUdyb3VwTmFtZSAkR3JvdXBOYW1lIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAkXy5NZW1iZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoKC1ub3QgJFNob3dBbGwpIC1hbmQgKCghJFRhcmdldFVzZXJzKSAtb3IgKCRUYXJnZXRVc2Vycy5Db3VudCAtZXEgMCkpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiWyFdIE5vIHVzZXJzIGZvdW5kIHRvIHNlYXJjaCBmb3IhIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHNjcmlwdCBibG9jayB0aGF0IGVudW1lcmF0ZXMgYSBzZXJ2ZXIKICAgICAgICAkSG9zdEVudW1CbG9jayA9IHsKICAgICAgICAgICAgcGFyYW0oJENvbXB1dGVyTmFtZSwgJFBpbmcsICRQcm9jZXNzTmFtZSwgJFRhcmdldFVzZXJzLCAkQ3JlZGVudGlhbCkKCiAgICAgICAgICAgICMgb3B0aW9uYWxseSBjaGVjayBpZiB0aGUgc2VydmVyIGlzIHVwIGZpcnN0CiAgICAgICAgICAgICRVcCA9ICRUcnVlCiAgICAgICAgICAgIGlmKCRQaW5nKSB7CiAgICAgICAgICAgICAgICAkVXAgPSBUZXN0LUNvbm5lY3Rpb24gLUNvdW50IDEgLVF1aWV0IC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRVcCkgewogICAgICAgICAgICAgICAgIyB0cnkgdG8gZW51bWVyYXRlIGFsbCBhY3RpdmUgcHJvY2Vzc2VzIG9uIHRoZSByZW1vdGUgaG9zdAogICAgICAgICAgICAgICAgIyBhbmQgc2VhcmNoIGZvciBhIHNwZWNpZmljIHByb2Nlc3MgbmFtZQogICAgICAgICAgICAgICAgJFByb2Nlc3NlcyA9IEdldC1OZXRQcm9jZXNzIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQoKICAgICAgICAgICAgICAgIEZvckVhY2ggKCRQcm9jZXNzIGluICRQcm9jZXNzZXMpIHsKICAgICAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIGh1bnRpbmcgZm9yIGEgcHJvY2VzcyBuYW1lIG9yIGNvbW1hLXNlcGFyYXRlZCBuYW1lcwogICAgICAgICAgICAgICAgICAgIGlmKCRQcm9jZXNzTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAkUHJvY2Vzc05hbWUuc3BsaXQoIiwiKSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkUHJvY2Vzcy5Qcm9jZXNzTmFtZSAtbWF0Y2ggJF8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUHJvY2VzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICMgaWYgdGhlIHNlc3Npb24gdXNlciBpcyBpbiB0aGUgdGFyZ2V0IGxpc3QsIGRpc3BsYXkgc29tZSBvdXRwdXQKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKCRUYXJnZXRVc2VycyAtY29udGFpbnMgJFByb2Nlc3MuVXNlcikgewogICAgICAgICAgICAgICAgICAgICAgICAkUHJvY2VzcwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIGlmKCRUaHJlYWRzKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlVzaW5nIHRocmVhZGluZyB3aXRoIHRocmVhZHMgPSAkVGhyZWFkcyIKCiAgICAgICAgICAgICMgaWYgd2UncmUgdXNpbmcgdGhyZWFkaW5nLCBraWNrIG9mZiB0aGUgc2NyaXB0IGJsb2NrIHdpdGggSW52b2tlLVRocmVhZGVkRnVuY3Rpb24KICAgICAgICAgICAgJFNjcmlwdFBhcmFtcyA9IEB7CiAgICAgICAgICAgICAgICAnUGluZycgPSAkKC1ub3QgJE5vUGluZykKICAgICAgICAgICAgICAgICdQcm9jZXNzTmFtZScgPSAkUHJvY2Vzc05hbWUKICAgICAgICAgICAgICAgICdUYXJnZXRVc2VycycgPSAkVGFyZ2V0VXNlcnMKICAgICAgICAgICAgICAgICdDcmVkZW50aWFsJyA9ICRDcmVkZW50aWFsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMga2ljayBvZmYgdGhlIHRocmVhZGVkIHNjcmlwdCBibG9jayArIGFyZ3VtZW50cyAKICAgICAgICAgICAgSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1TY3JpcHRCbG9jayAkSG9zdEVudW1CbG9jayAtU2NyaXB0UGFyYW1ldGVycyAkU2NyaXB0UGFyYW1zIC1UaHJlYWRzICRUaHJlYWRzCiAgICAgICAgfQoKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYoLW5vdCAkTm9QaW5nIC1hbmQgKCRDb21wdXRlck5hbWUuY291bnQgLW5lIDEpKSB7CiAgICAgICAgICAgICAgICAjIHBpbmcgYWxsIGhvc3RzIGluIHBhcmFsbGVsCiAgICAgICAgICAgICAgICAkUGluZyA9IHtwYXJhbSgkQ29tcHV0ZXJOYW1lKSBpZihUZXN0LUNvbm5lY3Rpb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1Db3VudCAxIC1RdWlldCAtRXJyb3JBY3Rpb24gU3RvcCl7JENvbXB1dGVyTmFtZX19CiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLU5vSW1wb3J0cyAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRQaW5nIC1UaHJlYWRzIDEwMAogICAgICAgICAgICB9CgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gVG90YWwgbnVtYmVyIG9mIGFjdGl2ZSBob3N0czogJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSIKICAgICAgICAgICAgJENvdW50ZXIgPSAwCgogICAgICAgICAgICBGb3JFYWNoICgkQ29tcHV0ZXIgaW4gJENvbXB1dGVyTmFtZSkgewoKICAgICAgICAgICAgICAgICRDb3VudGVyID0gJENvdW50ZXIgKyAxCgogICAgICAgICAgICAgICAgIyBzbGVlcCBmb3Igb3VyIHNlbWktcmFuZG9taXplZCBpbnRlcnZhbAogICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgJFJhbmROby5OZXh0KCgxLSRKaXR0ZXIpKiREZWxheSwgKDErJEppdHRlcikqJERlbGF5KQoKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBFbnVtZXJhdGluZyBzZXJ2ZXIgJENvbXB1dGVyICgkQ291bnRlciBvZiAkKCRDb21wdXRlck5hbWUuY291bnQpKSIKICAgICAgICAgICAgICAgICRSZXN1bHQgPSBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgJEhvc3RFbnVtQmxvY2sgLUFyZ3VtZW50TGlzdCAkQ29tcHV0ZXIsICRGYWxzZSwgJFByb2Nlc3NOYW1lLCAkVGFyZ2V0VXNlcnMsICRDcmVkZW50aWFsCiAgICAgICAgICAgICAgICAkUmVzdWx0CgogICAgICAgICAgICAgICAgaWYoJFJlc3VsdCAtYW5kICRTdG9wT25TdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFRhcmdldCB1c2VyL3Byb2Nlc3MgZm91bmQsIHJldHVybmluZyBlYXJseSIKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEludm9rZS1FdmVudEh1bnRlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUXVlcmllcyBhbGwgZG9tYWluIGNvbnRyb2xsZXJzIG9uIHRoZSBuZXR3b3JrIGZvciBhY2NvdW50CiAgICAgICAgbG9nb24gZXZlbnRzIChJRCA0NjI0KSBhbmQgVEdUIHJlcXVlc3QgZXZlbnRzIChJRCA0NzY4KSwKICAgICAgICBzZWFyY2hpbmcgZm9yIHRhcmdldCB1c2Vycy4KCiAgICAgICAgTm90ZTogRG9tYWluIEFkbWluIChvciBlcXVpdikgcmlnaHRzIGFyZSBuZWVkZWQgdG8gcXVlcnkKICAgICAgICB0aGlzIGluZm9ybWF0aW9uIGZyb20gdGhlIERDcy4KCiAgICAgICAgQXV0aG9yOiBAc2l4ZHViLCBAaGFybWoweQogICAgICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIEhvc3QgYXJyYXkgdG8gZW51bWVyYXRlLCBwYXNzYWJsZSBvbiB0aGUgcGlwZWxpbmUuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckZpbGUKCiAgICAgICAgRmlsZSBvZiBob3N0bmFtZXMvSVBzIHRvIHNlYXJjaC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsdGVyCgogICAgICAgIEhvc3QgZmlsdGVyIG5hbWUgdG8gcXVlcnkgQUQgZm9yLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoIGZvciBob3N0cywgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIEdyb3VwTmFtZQoKICAgICAgICBHcm91cCBuYW1lIHRvIHF1ZXJ5IGZvciB0YXJnZXQgdXNlcnMuCgogICAgLlBBUkFNRVRFUiBUYXJnZXRTZXJ2ZXIKCiAgICAgICAgSHVudCBmb3IgdXNlcnMgd2hvIGFyZSBlZmZlY3RpdmUgbG9jYWwgYWRtaW5zIG9uIGEgdGFyZ2V0IHNlcnZlci4KCiAgICAuUEFSQU1FVEVSIFVzZXJOYW1lCgogICAgICAgIFNwZWNpZmljIHVzZXJuYW1lIHRvIHNlYXJjaCBmb3IuCgogICAgLlBBUkFNRVRFUiBVc2VyRmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlIGZvciB1c2VyIGVudW1lcmF0aW9uLCBlLmcuICIoZGVzY3JpcHRpb249KmFkbWluKikiCgogICAgLlBBUkFNRVRFUiBVc2VyQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIHVzZXJzLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgVXNlckZpbGUKCiAgICAgICAgRmlsZSBvZiB1c2VybmFtZXMgdG8gc2VhcmNoIGZvci4KCiAgICAuUEFSQU1FVEVSIE5vUGluZwoKICAgICAgICBEb24ndCBwaW5nIGVhY2ggaG9zdCB0byBlbnN1cmUgaXQncyB1cCBiZWZvcmUgZW51bWVyYXRpbmcuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIGZvciBxdWVyeSBmb3IgbWFjaGluZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaERheXMKCiAgICAgICAgTnVtYmVyIG9mIGRheXMgYmFjayB0byBzZWFyY2ggbG9ncyBmb3IuIERlZmF1bHQgMy4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaEZvcmVzdAoKICAgICAgICBTd2l0Y2guIFNlYXJjaCBhbGwgZG9tYWlucyBpbiB0aGUgZm9yZXN0IGZvciB0YXJnZXQgdXNlcnMgaW5zdGVhZCBvZiBqdXN0CiAgICAgICAgYSBzaW5nbGUgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgVGhyZWFkcwoKICAgICAgICBUaGUgbWF4aW11bSBjb25jdXJyZW50IHRocmVhZHMgdG8gZXhlY3V0ZS4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLUV2ZW50SHVudGVyCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL2Jsb2cuaGFybWoweS5uZXQKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3RzJyldCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgICRDb21wdXRlck5hbWUsCgogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7VGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtBbGlhcygnSG9zdExpc3QnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckZpbGUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdyb3VwTmFtZSA9ICdEb21haW4gQWRtaW5zJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGFyZ2V0U2VydmVyLAoKICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJFVzZXJOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyQURTcGF0aCwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckZpbGUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW0ludDMyXQogICAgICAgICRTZWFyY2hEYXlzID0gMywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2VhcmNoRm9yZXN0LAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFRocmVhZHMsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgYmVnaW4gewoKICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydEZWJ1ZyddKSB7CiAgICAgICAgICAgICREZWJ1Z1ByZWZlcmVuY2UgPSAnQ29udGludWUnCiAgICAgICAgfQoKICAgICAgICAjIHJhbmRvbSBvYmplY3QgZm9yIGRlbGF5CiAgICAgICAgJFJhbmRObyA9IE5ldy1PYmplY3QgU3lzdGVtLlJhbmRvbQoKICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUnVubmluZyBJbnZva2UtRXZlbnRIdW50ZXIiCgogICAgICAgIGlmKCREb21haW4pIHsKICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCREb21haW4pCiAgICAgICAgfQogICAgICAgIGVsc2VpZigkU2VhcmNoRm9yZXN0KSB7CiAgICAgICAgICAgICMgZ2V0IEFMTCB0aGUgZG9tYWlucyBpbiB0aGUgZm9yZXN0IHRvIHNlYXJjaAogICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEdldC1OZXRGb3Jlc3REb21haW4gfCBGb3JFYWNoLU9iamVjdCB7ICRfLk5hbWUgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgIyB1c2UgdGhlIGxvY2FsIGRvbWFpbgogICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoIChHZXQtTmV0RG9tYWluIC1DcmVkZW50aWFsICRDcmVkZW50aWFsKS5uYW1lICkKICAgICAgICB9CgogICAgICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAgICAgIwogICAgICAgICMgRmlyc3Qgd2UgYnVpbGQgdGhlIGhvc3QgdGFyZ2V0IHNldAogICAgICAgICMKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKICAgICAgICBpZighJENvbXB1dGVyTmFtZSkgeyAKICAgICAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyBhIGhvc3QgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgICAgIGlmKCRDb21wdXRlckZpbGUpIHsKICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSBHZXQtQ29udGVudCAtUGF0aCAkQ29tcHV0ZXJGaWxlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRDb21wdXRlckZpbHRlciAtb3IgJENvbXB1dGVyQURTcGF0aCkgewogICAgICAgICAgICAgICAgW2FycmF5XSRDb21wdXRlck5hbWUgPSBAKCkKICAgICAgICAgICAgICAgIEZvckVhY2ggKCREb21haW4gaW4gJFRhcmdldERvbWFpbnMpIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIGhvc3RzIgogICAgICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgKz0gR2V0LU5ldENvbXB1dGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRmlsdGVyICRDb21wdXRlckZpbHRlciAtQURTcGF0aCAkQ29tcHV0ZXJBRFNwYXRoCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAjIGlmIGEgY29tcHV0ZXIgc3BlY2lmaWVyIGlzbid0IGdpdmVuLCB0cnkgdG8gZW51bWVyYXRlIGFsbCBkb21haW4gY29udHJvbGxlcnMKICAgICAgICAgICAgICAgIFthcnJheV0kQ29tcHV0ZXJOYW1lID0gQCgpCiAgICAgICAgICAgICAgICBGb3JFYWNoICgkRG9tYWluIGluICRUYXJnZXREb21haW5zKSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciBkb21haW4gY29udHJvbGxlcnMiCiAgICAgICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSArPSBHZXQtTmV0RG9tYWluQ29udHJvbGxlciAtTERBUCAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgfCBGb3JFYWNoLU9iamVjdCB7ICRfLmRuc2hvc3RuYW1lfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHJlbW92ZSBhbnkgbnVsbCB0YXJnZXQgaG9zdHMsIHVuaXF1aWZ5IHRoZSBsaXN0IGFuZCBzaHVmZmxlIGl0CiAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHsgJF8gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgfCBTb3J0LU9iamVjdCB7IEdldC1SYW5kb20gfQogICAgICAgICAgICBpZigkKCRDb21wdXRlck5hbWUuQ291bnQpIC1lcSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiTm8gaG9zdHMgZm91bmQhIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgICAgICMKICAgICAgICAjIE5vdyB3ZSBidWlsZCB0aGUgdXNlciB0YXJnZXQgc2V0CiAgICAgICAgIwogICAgICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgogICAgICAgICMgdXNlcnMgd2UncmUgZ29pbmcgdG8gYmUgc2VhcmNoaW5nIGZvcgogICAgICAgICRUYXJnZXRVc2VycyA9IEAoKQoKICAgICAgICAjIGlmIHdlIHdhbnQgdG8gaHVudCBmb3IgdGhlIGVmZmVjdGl2ZSBkb21haW4gdXNlcnMgd2hvIGNhbiBhY2Nlc3MgYSB0YXJnZXQgc2VydmVyCiAgICAgICAgaWYoJFRhcmdldFNlcnZlcikgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJRdWVyeWluZyB0YXJnZXQgc2VydmVyICckVGFyZ2V0U2VydmVyJyBmb3IgbG9jYWwgdXNlcnMiCiAgICAgICAgICAgICRUYXJnZXRVc2VycyA9IEdldC1OZXRMb2NhbEdyb3VwICRUYXJnZXRTZXJ2ZXIgLVJlY3Vyc2UgfCBXaGVyZS1PYmplY3Qgeygtbm90ICRfLklzR3JvdXApIC1hbmQgJF8uSXNEb21haW4gfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICgkXy5BY2NvdW50TmFtZSkuc3BsaXQoIi8iKVsxXS50b0xvd2VyKCkKICAgICAgICAgICAgfSAgfCBXaGVyZS1PYmplY3QgeyRffQogICAgICAgIH0KICAgICAgICAjIGlmIHdlIGdldCBhIHNwZWNpZmljIHVzZXJuYW1lLCBvbmx5IHVzZSB0aGF0CiAgICAgICAgZWxzZWlmKCRVc2VyTmFtZSkgewogICAgICAgICAgICAjIFdyaXRlLVZlcmJvc2UgIlsqXSBVc2luZyB0YXJnZXQgdXNlciAnJFVzZXJOYW1lJy4uLiIKICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gJFVzZXJOYW1lIHwgRm9yRWFjaC1PYmplY3QgeyRfLlRvTG93ZXIoKX0KICAgICAgICAgICAgaWYoJFRhcmdldFVzZXJzIC1pc25vdCBbU3lzdGVtLkFycmF5XSkgewogICAgICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gQCgkVGFyZ2V0VXNlcnMpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgIyByZWFkIGluIGEgdGFyZ2V0IHVzZXIgbGlzdCBpZiB3ZSBoYXZlIG9uZQogICAgICAgIGVsc2VpZigkVXNlckZpbGUpIHsKICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gR2V0LUNvbnRlbnQgLVBhdGggJFVzZXJGaWxlIHwgV2hlcmUtT2JqZWN0IHskX30KICAgICAgICB9CiAgICAgICAgZWxzZWlmKCRVc2VyQURTcGF0aCAtb3IgJFVzZXJGaWx0ZXIpIHsKICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciB1c2VycyIKICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyArPSBHZXQtTmV0VXNlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJFVzZXJBRFNwYXRoIC1GaWx0ZXIgJFVzZXJGaWx0ZXIgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgJF8uc2FtYWNjb3VudG5hbWUKICAgICAgICAgICAgICAgIH0gIHwgV2hlcmUtT2JqZWN0IHskX30KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciB1c2VycyBvZiBncm91cCAnJEdyb3VwTmFtZSciCiAgICAgICAgICAgICAgICAkVGFyZ2V0VXNlcnMgKz0gR2V0LU5ldEdyb3VwTWVtYmVyIC1Hcm91cE5hbWUgJEdyb3VwTmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgJF8uTWVtYmVyTmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoKCghJFRhcmdldFVzZXJzKSAtb3IgKCRUYXJnZXRVc2Vycy5Db3VudCAtZXEgMCkpKSB7CiAgICAgICAgICAgIHRocm93ICJbIV0gTm8gdXNlcnMgZm91bmQgdG8gc2VhcmNoIGZvciEiCiAgICAgICAgfQoKICAgICAgICAjIHNjcmlwdCBibG9jayB0aGF0IGVudW1lcmF0ZXMgYSBzZXJ2ZXIKICAgICAgICAkSG9zdEVudW1CbG9jayA9IHsKICAgICAgICAgICAgcGFyYW0oJENvbXB1dGVyTmFtZSwgJFBpbmcsICRUYXJnZXRVc2VycywgJFNlYXJjaERheXMsICRDcmVkZW50aWFsKQoKICAgICAgICAgICAgIyBvcHRpb25hbGx5IGNoZWNrIGlmIHRoZSBzZXJ2ZXIgaXMgdXAgZmlyc3QKICAgICAgICAgICAgJFVwID0gJFRydWUKICAgICAgICAgICAgaWYoJFBpbmcpIHsKICAgICAgICAgICAgICAgICRVcCA9IFRlc3QtQ29ubmVjdGlvbiAtQ291bnQgMSAtUXVpZXQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJFVwKSB7CiAgICAgICAgICAgICAgICAjIHRyeSB0byBlbnVtZXJhdGUKICAgICAgICAgICAgICAgIGlmKCRDcmVkZW50aWFsKSB7CiAgICAgICAgICAgICAgICAgICAgR2V0LVVzZXJFdmVudCAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUV2ZW50VHlwZSAnYWxsJyAtRGF0ZVN0YXJ0IChbRGF0ZVRpbWVdOjpUb2RheS5BZGREYXlzKC0kU2VhcmNoRGF5cykpIHwgV2hlcmUtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBmaWx0ZXIgZm9yIHRoZSB0YXJnZXQgdXNlciBzZXQKICAgICAgICAgICAgICAgICAgICAgICAgJFRhcmdldFVzZXJzIC1jb250YWlucyAkXy5Vc2VyTmFtZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIEdldC1Vc2VyRXZlbnQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1FdmVudFR5cGUgJ2FsbCcgLURhdGVTdGFydCAoW0RhdGVUaW1lXTo6VG9kYXkuQWRkRGF5cygtJFNlYXJjaERheXMpKSB8IFdoZXJlLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgZmlsdGVyIGZvciB0aGUgdGFyZ2V0IHVzZXIgc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyAtY29udGFpbnMgJF8uVXNlck5hbWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQoKICAgIHByb2Nlc3MgewoKICAgICAgICBpZigkVGhyZWFkcykgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJVc2luZyB0aHJlYWRpbmcgd2l0aCB0aHJlYWRzID0gJFRocmVhZHMiCgogICAgICAgICAgICAjIGlmIHdlJ3JlIHVzaW5nIHRocmVhZGluZywga2ljayBvZmYgdGhlIHNjcmlwdCBibG9jayB3aXRoIEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uCiAgICAgICAgICAgICRTY3JpcHRQYXJhbXMgPSBAewogICAgICAgICAgICAgICAgJ1BpbmcnID0gJCgtbm90ICROb1BpbmcpCiAgICAgICAgICAgICAgICAnVGFyZ2V0VXNlcnMnID0gJFRhcmdldFVzZXJzCiAgICAgICAgICAgICAgICAnU2VhcmNoRGF5cycgPSAkU2VhcmNoRGF5cwogICAgICAgICAgICAgICAgJ0NyZWRlbnRpYWwnID0gJENyZWRlbnRpYWwKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBraWNrIG9mZiB0aGUgdGhyZWFkZWQgc2NyaXB0IGJsb2NrICsgYXJndW1lbnRzIAogICAgICAgICAgICBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1TY3JpcHRQYXJhbWV0ZXJzICRTY3JpcHRQYXJhbXMgLVRocmVhZHMgJFRocmVhZHMKICAgICAgICB9CgogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZigtbm90ICROb1BpbmcgLWFuZCAoJENvbXB1dGVyTmFtZS5jb3VudCAtbmUgMSkpIHsKICAgICAgICAgICAgICAgICMgcGluZyBhbGwgaG9zdHMgaW4gcGFyYWxsZWwKICAgICAgICAgICAgICAgICRQaW5nID0ge3BhcmFtKCRDb21wdXRlck5hbWUpIGlmKFRlc3QtQ29ubmVjdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLUNvdW50IDEgLVF1aWV0IC1FcnJvckFjdGlvbiBTdG9wKXskQ29tcHV0ZXJOYW1lfX0KICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtTm9JbXBvcnRzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtU2NyaXB0QmxvY2sgJFBpbmcgLVRocmVhZHMgMTAwCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBUb3RhbCBudW1iZXIgb2YgYWN0aXZlIGhvc3RzOiAkKCRDb21wdXRlck5hbWUuY291bnQpIgogICAgICAgICAgICAkQ291bnRlciA9IDAKCiAgICAgICAgICAgIEZvckVhY2ggKCRDb21wdXRlciBpbiAkQ29tcHV0ZXJOYW1lKSB7CgogICAgICAgICAgICAgICAgJENvdW50ZXIgPSAkQ291bnRlciArIDEKCiAgICAgICAgICAgICAgICAjIHNsZWVwIGZvciBvdXIgc2VtaS1yYW5kb21pemVkIGludGVydmFsCiAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAtU2Vjb25kcyAkUmFuZE5vLk5leHQoKDEtJEppdHRlcikqJERlbGF5LCAoMSskSml0dGVyKSokRGVsYXkpCgogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIEVudW1lcmF0aW5nIHNlcnZlciAkQ29tcHV0ZXIgKCRDb3VudGVyIG9mICQoJENvbXB1dGVyTmFtZS5jb3VudCkpIgogICAgICAgICAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1Bcmd1bWVudExpc3QgJENvbXB1dGVyLCAkKC1ub3QgJE5vUGluZyksICRUYXJnZXRVc2VycywgJFNlYXJjaERheXMsICRDcmVkZW50aWFsCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQp9CgoKZnVuY3Rpb24gSW52b2tlLVNoYXJlRmluZGVyIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIGZpbmRzIHRoZSBsb2NhbCBkb21haW4gbmFtZSBmb3IgYSBob3N0IHVzaW5nIEdldC1OZXREb21haW4sCiAgICAgICAgcXVlcmllcyB0aGUgZG9tYWluIGZvciBhbGwgYWN0aXZlIG1hY2hpbmVzIHdpdGggR2V0LU5ldENvbXB1dGVyLCB0aGVuIGZvcgogICAgICAgIGVhY2ggc2VydmVyIGl0IGxpc3RzIG9mIGFjdGl2ZSBzaGFyZXMgd2l0aCBHZXQtTmV0U2hhcmUuIE5vbi1zdGFuZGFyZCBzaGFyZXMKICAgICAgICBjYW4gYmUgZmlsdGVyZWQgb3V0IHdpdGggLUV4Y2x1ZGUqIGZsYWdzLgoKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgSG9zdCBhcnJheSB0byBlbnVtZXJhdGUsIHBhc3NhYmxlIG9uIHRoZSBwaXBlbGluZS4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsZQoKICAgICAgICBGaWxlIG9mIGhvc3RuYW1lcy9JUHMgdG8gc2VhcmNoLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJGaWx0ZXIKCiAgICAgICAgSG9zdCBmaWx0ZXIgbmFtZSB0byBxdWVyeSBBRCBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIGhvc3RzLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgRXhjbHVkZVN0YW5kYXJkCgogICAgICAgIFN3aXRjaC4gRXhjbHVkZSBzdGFuZGFyZCBzaGFyZXMgZnJvbSBkaXNwbGF5IChDJCwgSVBDJCwgcHJpbnQkIGV0Yy4pCgogICAgLlBBUkFNRVRFUiBFeGNsdWRlUHJpbnQKCiAgICAgICAgU3dpdGNoLiBFeGNsdWRlIHRoZSBwcmludCQgc2hhcmUuCgogICAgLlBBUkFNRVRFUiBFeGNsdWRlSVBDCgogICAgICAgIFN3aXRjaC4gRXhjbHVkZSB0aGUgSVBDJCBzaGFyZS4KCiAgICAuUEFSQU1FVEVSIENoZWNrU2hhcmVBY2Nlc3MKCiAgICAgICAgU3dpdGNoLiBPbmx5IGRpc3BsYXkgZm91bmQgc2hhcmVzIHRoYXQgdGhlIGxvY2FsIHVzZXIgaGFzIGFjY2VzcyB0by4KCiAgICAuUEFSQU1FVEVSIENoZWNrQWRtaW4KCiAgICAgICAgU3dpdGNoLiBPbmx5IGRpc3BsYXkgQURNSU4kIHNoYXJlcyB0aGUgbG9jYWwgdXNlciBoYXMgYWNjZXNzIHRvLgoKICAgIC5QQVJBTUVURVIgTm9QaW5nCgogICAgICAgIFN3aXRjaC4gRG9uJ3QgcGluZyBlYWNoIGhvc3QgdG8gZW5zdXJlIGl0J3MgdXAgYmVmb3JlIGVudW1lcmF0aW5nLgoKICAgIC5QQVJBTUVURVIgRGVsYXkKCiAgICAgICAgRGVsYXkgYmV0d2VlbiBlbnVtZXJhdGluZyBob3N0cywgZGVmYXVsdHMgdG8gMC4KCiAgICAuUEFSQU1FVEVSIEppdHRlcgoKICAgICAgICBKaXR0ZXIgZm9yIHRoZSBob3N0IGRlbGF5LCBkZWZhdWx0cyB0byArLy0gMC4zLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIERvbWFpbiB0byBxdWVyeSBmb3IgbWFjaGluZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaEZvcmVzdAoKICAgICAgICBTd2l0Y2guIFNlYXJjaCBhbGwgZG9tYWlucyBpbiB0aGUgZm9yZXN0IGZvciB0YXJnZXQgdXNlcnMgaW5zdGVhZCBvZiBqdXN0CiAgICAgICAgYSBzaW5nbGUgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgVGhyZWFkcwoKICAgICAgICBUaGUgbWF4aW11bSBjb25jdXJyZW50IHRocmVhZHMgdG8gZXhlY3V0ZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1TaGFyZUZpbmRlciAtRXhjbHVkZVN0YW5kYXJkCgogICAgICAgIEZpbmQgbm9uLXN0YW5kYXJkIHNoYXJlcyBvbiB0aGUgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVNoYXJlRmluZGVyIC1UaHJlYWRzIDIwCgogICAgICAgIE11bHRpLXRocmVhZGVkIHNoYXJlIGZpbmRpbmcsIHJlcGxhY2VzIEludm9rZS1TaGFyZUZpbmRlclRocmVhZGVkLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVNoYXJlRmluZGVyIC1EZWxheSA2MAoKICAgICAgICBGaW5kIHNoYXJlcyBvbiB0aGUgZG9tYWluIHdpdGggYSA2MCBzZWNvbmQgKCsvLSAqLjMpCiAgICAgICAgcmFuZG9taXplZCBkZWxheSBiZXR3ZWVuIHRvdWNoaW5nIGVhY2ggaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1TaGFyZUZpbmRlciAtQ29tcHV0ZXJGaWxlIGhvc3RzLnR4dAoKICAgICAgICBGaW5kIHNoYXJlcyBmb3IgbWFjaGluZXMgaW4gdGhlIHNwZWNpZmllZCBob3N0cyBmaWxlLgoKICAgIC5MSU5LCiAgICBodHRwOi8vYmxvZy5oYXJtajB5Lm5ldAojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdHMnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW0FsaWFzKCdIb3N0TGlzdCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyQURTcGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRXhjbHVkZVN0YW5kYXJkLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRFeGNsdWRlUHJpbnQsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEV4Y2x1ZGVJUEMsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJE5vUGluZywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQ2hlY2tTaGFyZUFjY2VzcywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQ2hlY2tBZG1pbiwKCiAgICAgICAgW1VJbnQzMl0KICAgICAgICAkRGVsYXkgPSAwLAoKICAgICAgICBbRG91YmxlXQogICAgICAgICRKaXR0ZXIgPSAuMywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAogCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2VhcmNoRm9yZXN0LAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFRocmVhZHMKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snRGVidWcnXSkgewogICAgICAgICAgICAkRGVidWdQcmVmZXJlbmNlID0gJ0NvbnRpbnVlJwogICAgICAgIH0KCiAgICAgICAgIyByYW5kb20gb2JqZWN0IGZvciBkZWxheQogICAgICAgICRSYW5kTm8gPSBOZXctT2JqZWN0IFN5c3RlbS5SYW5kb20KCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFJ1bm5pbmcgSW52b2tlLVNoYXJlRmluZGVyIHdpdGggZGVsYXkgb2YgJERlbGF5IgoKICAgICAgICAjIGZpZ3VyZSBvdXQgdGhlIHNoYXJlcyB3ZSB3YW50IHRvIGlnbm9yZQogICAgICAgIFtTdHJpbmdbXV0gJEV4Y2x1ZGVkU2hhcmVzID0gQCgnJykKCiAgICAgICAgaWYgKCRFeGNsdWRlUHJpbnQpIHsKICAgICAgICAgICAgJEV4Y2x1ZGVkU2hhcmVzID0gJEV4Y2x1ZGVkU2hhcmVzICsgIlBSSU5UJCIKICAgICAgICB9CiAgICAgICAgaWYgKCRFeGNsdWRlSVBDKSB7CiAgICAgICAgICAgICRFeGNsdWRlZFNoYXJlcyA9ICRFeGNsdWRlZFNoYXJlcyArICJJUEMkIgogICAgICAgIH0KICAgICAgICBpZiAoJEV4Y2x1ZGVTdGFuZGFyZCkgewogICAgICAgICAgICAkRXhjbHVkZWRTaGFyZXMgPSBAKCcnLCAiQURNSU4kIiwgIklQQyQiLCAiQyQiLCAiUFJJTlQkIikKICAgICAgICB9CgogICAgICAgICMgaWYgd2UncmUgdXNpbmcgYSBob3N0IGZpbGUgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgaWYoJENvbXB1dGVyRmlsZSkgewogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gR2V0LUNvbnRlbnQgLVBhdGggJENvbXB1dGVyRmlsZQogICAgICAgIH0KCiAgICAgICAgaWYoISRDb21wdXRlck5hbWUpIHsgCiAgICAgICAgICAgIFthcnJheV0kQ29tcHV0ZXJOYW1lID0gQCgpCgogICAgICAgICAgICBpZigkRG9tYWluKSB7CiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoJERvbWFpbikKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoJFNlYXJjaEZvcmVzdCkgewogICAgICAgICAgICAgICAgIyBnZXQgQUxMIHRoZSBkb21haW5zIGluIHRoZSBmb3Jlc3QgdG8gc2VhcmNoCiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEdldC1OZXRGb3Jlc3REb21haW4gfCBGb3JFYWNoLU9iamVjdCB7ICRfLk5hbWUgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgIyB1c2UgdGhlIGxvY2FsIGRvbWFpbgogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCAoR2V0LU5ldERvbWFpbikubmFtZSApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICBGb3JFYWNoICgkRG9tYWluIGluICRUYXJnZXREb21haW5zKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIGhvc3RzIgogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSArPSBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1GaWx0ZXIgJENvbXB1dGVyRmlsdGVyIC1BRFNwYXRoICRDb21wdXRlckFEU3BhdGgKICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgICAgICAjIHJlbW92ZSBhbnkgbnVsbCB0YXJnZXQgaG9zdHMsIHVuaXF1aWZ5IHRoZSBsaXN0IGFuZCBzaHVmZmxlIGl0CiAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHsgJF8gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgfCBTb3J0LU9iamVjdCB7IEdldC1SYW5kb20gfQogICAgICAgICAgICBpZigkKCRDb21wdXRlck5hbWUuY291bnQpIC1lcSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiTm8gaG9zdHMgZm91bmQhIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHNjcmlwdCBibG9jayB0aGF0IGVudW1lcmF0ZXMgYSBzZXJ2ZXIKICAgICAgICAkSG9zdEVudW1CbG9jayA9IHsKICAgICAgICAgICAgcGFyYW0oJENvbXB1dGVyTmFtZSwgJFBpbmcsICRDaGVja1NoYXJlQWNjZXNzLCAkRXhjbHVkZWRTaGFyZXMsICRDaGVja0FkbWluKQoKICAgICAgICAgICAgIyBvcHRpb25hbGx5IGNoZWNrIGlmIHRoZSBzZXJ2ZXIgaXMgdXAgZmlyc3QKICAgICAgICAgICAgJFVwID0gJFRydWUKICAgICAgICAgICAgaWYoJFBpbmcpIHsKICAgICAgICAgICAgICAgICRVcCA9IFRlc3QtQ29ubmVjdGlvbiAtQ291bnQgMSAtUXVpZXQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJFVwKSB7CiAgICAgICAgICAgICAgICAjIGdldCB0aGUgc2hhcmVzIGZvciB0aGlzIGhvc3QgYW5kIGNoZWNrIHdoYXQgd2UgZmluZAogICAgICAgICAgICAgICAgJFNoYXJlcyA9IEdldC1OZXRTaGFyZSAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgIEZvckVhY2ggKCRTaGFyZSBpbiAkU2hhcmVzKSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFNlcnZlciBzaGFyZTogJFNoYXJlIgogICAgICAgICAgICAgICAgICAgICROZXROYW1lID0gJFNoYXJlLnNoaTFfbmV0bmFtZQogICAgICAgICAgICAgICAgICAgICRSZW1hcmsgPSAkU2hhcmUuc2hpMV9yZW1hcmsKICAgICAgICAgICAgICAgICAgICAkUGF0aCA9ICdcXCcrJENvbXB1dGVyTmFtZSsnXCcrJE5ldE5hbWUKCiAgICAgICAgICAgICAgICAgICAgIyBtYWtlIHN1cmUgd2UgZ2V0IGEgcmVhbCBzaGFyZSBuYW1lIGJhY2sKICAgICAgICAgICAgICAgICAgICBpZiAoKCROZXROYW1lKSAtYW5kICgkTmV0TmFtZS50cmltKCkgLW5lICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIGp1c3QgY2hlY2tpbmcgZm9yIGFjY2VzcyB0byBBRE1JTiQKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJENoZWNrQWRtaW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCROZXROYW1lLlRvVXBwZXIoKSAtZXEgIkFETUlOJCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTnVsbCA9IFtJTy5EaXJlY3RvcnldOjpHZXRGaWxlcygkUGF0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlxcJENvbXB1dGVyTmFtZVwkTmV0TmFtZSBgdC0gJFJlbWFyayIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBhY2Nlc3NpbmcgcGF0aCAkUGF0aCA6ICRfIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAjIHNraXAgdGhpcyBzaGFyZSBpZiBpdCdzIGluIHRoZSBleGNsdWRlIGxpc3QKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmICgkRXhjbHVkZWRTaGFyZXMgLU5vdENvbnRhaW5zICROZXROYW1lLlRvVXBwZXIoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBzZWUgaWYgd2Ugd2FudCB0byBjaGVjayBhY2Nlc3MgdG8gdGhpcyBzaGFyZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJENoZWNrU2hhcmVBY2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIHRoZSB1c2VyIGhhcyBhY2Nlc3MgdG8gdGhpcyBwYXRoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE51bGwgPSBbSU8uRGlyZWN0b3J5XTo6R2V0RmlsZXMoJFBhdGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJcXCRDb21wdXRlck5hbWVcJE5ldE5hbWUgYHQtICRSZW1hcmsiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgYWNjZXNzaW5nIHBhdGggJFBhdGggOiAkXyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiXFwkQ29tcHV0ZXJOYW1lXCROZXROYW1lIGB0LSAkUmVtYXJrIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgaWYoJFRocmVhZHMpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVXNpbmcgdGhyZWFkaW5nIHdpdGggdGhyZWFkcyA9ICRUaHJlYWRzIgoKICAgICAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyB0aHJlYWRpbmcsIGtpY2sgb2ZmIHRoZSBzY3JpcHQgYmxvY2sgd2l0aCBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbgogICAgICAgICAgICAkU2NyaXB0UGFyYW1zID0gQHsKICAgICAgICAgICAgICAgICdQaW5nJyA9ICQoLW5vdCAkTm9QaW5nKQogICAgICAgICAgICAgICAgJ0NoZWNrU2hhcmVBY2Nlc3MnID0gJENoZWNrU2hhcmVBY2Nlc3MKICAgICAgICAgICAgICAgICdFeGNsdWRlZFNoYXJlcycgPSAkRXhjbHVkZWRTaGFyZXMKICAgICAgICAgICAgICAgICdDaGVja0FkbWluJyA9ICRDaGVja0FkbWluCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMga2ljayBvZmYgdGhlIHRocmVhZGVkIHNjcmlwdCBibG9jayArIGFyZ3VtZW50cyAKICAgICAgICAgICAgSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1TY3JpcHRCbG9jayAkSG9zdEVudW1CbG9jayAtU2NyaXB0UGFyYW1ldGVycyAkU2NyaXB0UGFyYW1zIC1UaHJlYWRzICRUaHJlYWRzCiAgICAgICAgfQoKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYoLW5vdCAkTm9QaW5nIC1hbmQgKCRDb21wdXRlck5hbWUuY291bnQgLW5lIDEpKSB7CiAgICAgICAgICAgICAgICAjIHBpbmcgYWxsIGhvc3RzIGluIHBhcmFsbGVsCiAgICAgICAgICAgICAgICAkUGluZyA9IHtwYXJhbSgkQ29tcHV0ZXJOYW1lKSBpZihUZXN0LUNvbm5lY3Rpb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1Db3VudCAxIC1RdWlldCAtRXJyb3JBY3Rpb24gU3RvcCl7JENvbXB1dGVyTmFtZX19CiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLU5vSW1wb3J0cyAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRQaW5nIC1UaHJlYWRzIDEwMAogICAgICAgICAgICB9CgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gVG90YWwgbnVtYmVyIG9mIGFjdGl2ZSBob3N0czogJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSIKICAgICAgICAgICAgJENvdW50ZXIgPSAwCgogICAgICAgICAgICBGb3JFYWNoICgkQ29tcHV0ZXIgaW4gJENvbXB1dGVyTmFtZSkgewoKICAgICAgICAgICAgICAgICRDb3VudGVyID0gJENvdW50ZXIgKyAxCgogICAgICAgICAgICAgICAgIyBzbGVlcCBmb3Igb3VyIHNlbWktcmFuZG9taXplZCBpbnRlcnZhbAogICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgJFJhbmROby5OZXh0KCgxLSRKaXR0ZXIpKiREZWxheSwgKDErJEppdHRlcikqJERlbGF5KQoKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBFbnVtZXJhdGluZyBzZXJ2ZXIgJENvbXB1dGVyICgkQ291bnRlciBvZiAkKCRDb21wdXRlck5hbWUuY291bnQpKSIKICAgICAgICAgICAgICAgIEludm9rZS1Db21tYW5kIC1TY3JpcHRCbG9jayAkSG9zdEVudW1CbG9jayAtQXJndW1lbnRMaXN0ICRDb21wdXRlciwgJEZhbHNlLCAkQ2hlY2tTaGFyZUFjY2VzcywgJEV4Y2x1ZGVkU2hhcmVzLCAkQ2hlY2tBZG1pbgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgfQp9CgoKZnVuY3Rpb24gSW52b2tlLUZpbGVGaW5kZXIgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEZpbmRzIHNlbnNpdGl2ZSBmaWxlcyBvbiB0aGUgZG9tYWluLgoKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFRoaXMgZnVuY3Rpb24gZmluZHMgdGhlIGxvY2FsIGRvbWFpbiBuYW1lIGZvciBhIGhvc3QgdXNpbmcgR2V0LU5ldERvbWFpbiwKICAgICAgICBxdWVyaWVzIHRoZSBkb21haW4gZm9yIGFsbCBhY3RpdmUgbWFjaGluZXMgd2l0aCBHZXQtTmV0Q29tcHV0ZXIsIGdyYWJzCiAgICAgICAgdGhlIHJlYWRhYmxlIHNoYXJlcyBmb3IgZWFjaCBzZXJ2ZXIsIGFuZCByZWN1cnNpdmVseSBzZWFyY2hlcyBldmVyeQogICAgICAgIHNoYXJlIGZvciBmaWxlcyB3aXRoIHNwZWNpZmljIGtleXdvcmRzIGluIHRoZSBuYW1lLgogICAgICAgIElmIGEgc2hhcmUgbGlzdCBpcyBwYXNzZWQsIEVWRVJZIHNoYXJlIGlzIGVudW1lcmF0ZWQgcmVnYXJkbGVzcyBvZgogICAgICAgIG90aGVyIG9wdGlvbnMuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgSG9zdCBhcnJheSB0byBlbnVtZXJhdGUsIHBhc3NhYmxlIG9uIHRoZSBwaXBlbGluZS4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsZQoKICAgICAgICBGaWxlIG9mIGhvc3RuYW1lcy9JUHMgdG8gc2VhcmNoLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJGaWx0ZXIKCiAgICAgICAgSG9zdCBmaWx0ZXIgbmFtZSB0byBxdWVyeSBBRCBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIGhvc3RzLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgU2hhcmVMaXN0CgogICAgICAgIExpc3QgaWYgXFxIT1NUXHNoYXJlcyB0byBzZWFyY2ggdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFRlcm1zCgogICAgICAgIFRlcm1zIHRvIHNlYXJjaCBmb3IuCgogICAgLlBBUkFNRVRFUiBPZmZpY2VEb2NzCgogICAgICAgIFN3aXRjaC4gU2VhcmNoIGZvciBvZmZpY2UgZG9jdW1lbnRzICgqLmRvYyosICoueGxzKiwgKi5wcHQqKQoKICAgIC5QQVJBTUVURVIgRnJlc2hFWEVzCgogICAgICAgIFN3aXRjaC4gRmluZCAuRVhFcyBhY2Nlc3NlZCB3aXRoaW4gdGhlIGxhc3Qgd2Vlay4KCiAgICAuUEFSQU1FVEVSIExhc3RBY2Nlc3NUaW1lCgogICAgICAgIE9ubHkgcmV0dXJuIGZpbGVzIHdpdGggYSBMYXN0QWNjZXNzVGltZSBncmVhdGVyIHRoYW4gdGhpcyBkYXRlIHZhbHVlLgoKICAgIC5QQVJBTUVURVIgTGFzdFdyaXRlVGltZQoKICAgICAgICBPbmx5IHJldHVybiBmaWxlcyB3aXRoIGEgTGFzdFdyaXRlVGltZSBncmVhdGVyIHRoYW4gdGhpcyBkYXRlIHZhbHVlLgoKICAgIC5QQVJBTUVURVIgQ3JlYXRpb25UaW1lCgogICAgICAgIE9ubHkgcmV0dXJuIGZpbGVzIHdpdGggYSBDcmVhdGlvbkRhdGUgZ3JlYXRlciB0aGFuIHRoaXMgZGF0ZSB2YWx1ZS4KCiAgICAuUEFSQU1FVEVSIEluY2x1ZGVDCgogICAgICAgIFN3aXRjaC4gSW5jbHVkZSBhbnkgQyQgc2hhcmVzIGluIHJlY3Vyc2l2ZSBzZWFyY2hpbmcgKGRlZmF1bHQgaWdub3JlKS4KCiAgICAuUEFSQU1FVEVSIEluY2x1ZGVBZG1pbgoKICAgICAgICBTd2l0Y2guIEluY2x1ZGUgYW55IEFETUlOJCBzaGFyZXMgaW4gcmVjdXJzaXZlIHNlYXJjaGluZyAoZGVmYXVsdCBpZ25vcmUpLgoKICAgIC5QQVJBTUVURVIgRXhjbHVkZUZvbGRlcnMKCiAgICAgICAgU3dpdGNoLiBFeGNsdWRlIGZvbGRlcnMgZnJvbSB0aGUgc2VhcmNoIHJlc3VsdHMuCgogICAgLlBBUkFNRVRFUiBFeGNsdWRlSGlkZGVuCgogICAgICAgIFN3aXRjaC4gRXhjbHVkZSBoaWRkZW4gZmlsZXMgYW5kIGZvbGRlcnMgZnJvbSB0aGUgc2VhcmNoIHJlc3VsdHMuCgogICAgLlBBUkFNRVRFUiBDaGVja1dyaXRlQWNjZXNzCgogICAgICAgIFN3aXRjaC4gT25seSByZXR1cm5zIGZpbGVzIHRoZSBjdXJyZW50IHVzZXIgaGFzIHdyaXRlIGFjY2VzcyB0by4KCiAgICAuUEFSQU1FVEVSIE91dEZpbGUKCiAgICAgICAgT3V0cHV0IHJlc3VsdHMgdG8gYSBzcGVjaWZpZWQgY3N2IG91dHB1dCBmaWxlLgoKICAgIC5QQVJBTUVURVIgTm9DbG9iYmVyCgogICAgICAgIFN3aXRjaC4gRG9uJ3Qgb3ZlcndyaXRlIGFueSBleGlzdGluZyBvdXRwdXQgZmlsZS4KCiAgICAuUEFSQU1FVEVSIE5vUGluZwoKICAgICAgICBTd2l0Y2guIERvbid0IHBpbmcgZWFjaCBob3N0IHRvIGVuc3VyZSBpdCdzIHVwIGJlZm9yZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIERlbGF5CgogICAgICAgIERlbGF5IGJldHdlZW4gZW51bWVyYXRpbmcgaG9zdHMsIGRlZmF1bHRzIHRvIDAKCiAgICAuUEFSQU1FVEVSIEppdHRlcgoKICAgICAgICBKaXR0ZXIgZm9yIHRoZSBob3N0IGRlbGF5LCBkZWZhdWx0cyB0byArLy0gMC4zCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIHRvIHF1ZXJ5IGZvciBtYWNoaW5lcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgU2VhcmNoRm9yZXN0CgogICAgICAgIFNlYXJjaCBhbGwgZG9tYWlucyBpbiB0aGUgZm9yZXN0IGZvciB0YXJnZXQgdXNlcnMgaW5zdGVhZCBvZiBqdXN0CiAgICAgICAgYSBzaW5nbGUgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgU2VhcmNoU1lTVk9MCgogICAgICAgIFN3aXRjaC4gU2VhcmNoIGZvciBsb2dpbiBzY3JpcHRzIG9uIHRoZSBTWVNWT0wgb2YgdGhlIHByaW1hcnkgRENzIGZvciBlYWNoIHNwZWNpZmllZCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBUaHJlYWRzCgogICAgICAgIFRoZSBtYXhpbXVtIGNvbmN1cnJlbnQgdGhyZWFkcyB0byBleGVjdXRlLgoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IHRhcmdldCByZW1vdGUgcGF0aCB3aXRoIHRlbXBvcmFyeSBQU0RyaXZlcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1GaWxlRmluZGVyCgogICAgICAgIEZpbmQgcmVhZGFibGUgZmlsZXMgb24gdGhlIGRvbWFpbiB3aXRoICdwYXNzJywgJ3NlbnNpdGl2ZScsCiAgICAgICAgJ3NlY3JldCcsICdhZG1pbicsICdsb2dpbicsIG9yICd1bmF0dGVuZCoueG1sJyBpbiB0aGUgbmFtZSwKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1GaWxlRmluZGVyIC1Eb21haW4gdGVzdGluZwoKICAgICAgICBGaW5kIHJlYWRhYmxlIGZpbGVzIG9uIHRoZSAndGVzdGluZycgZG9tYWluIHdpdGggJ3Bhc3MnLCAnc2Vuc2l0aXZlJywKICAgICAgICAnc2VjcmV0JywgJ2FkbWluJywgJ2xvZ2luJywgb3IgJ3VuYXR0ZW5kKi54bWwnIGluIHRoZSBuYW1lLAoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLUZpbGVGaW5kZXIgLUluY2x1ZGVDCgogICAgICAgIEZpbmQgcmVhZGFibGUgZmlsZXMgb24gdGhlIGRvbWFpbiB3aXRoICdwYXNzJywgJ3NlbnNpdGl2ZScsCiAgICAgICAgJ3NlY3JldCcsICdhZG1pbicsICdsb2dpbicgb3IgJ3VuYXR0ZW5kKi54bWwnIGluIHRoZSBuYW1lLAogICAgICAgIGluY2x1ZGluZyBDJCBzaGFyZXMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtRmlsZUZpbmRlciAtU2hhcmVMaXN0IHNoYXJlcy50eHQgLVRlcm1zIGFjY291bnRzLHNzbiAtT3V0RmlsZSBvdXQuY3N2CgogICAgICAgIEVudW1lcmF0ZSBhIHNwZWNpZmllZCBzaGFyZSBsaXN0IGZvciBmaWxlcyB3aXRoICdhY2NvdW50cycgb3IKICAgICAgICAnc3NuJyBpbiB0aGUgbmFtZSwgYW5kIHdyaXRlIGV2ZXJ5dGhpbmcgdG8gIm91dC5jc3YiCgogICAgLkxJTksKICAgICAgICBodHRwOi8vd3d3Lmhhcm1qMHkubmV0L2Jsb2cvcmVkdGVhbWluZy9maWxlLXNlcnZlci10cmlhZ2Utb24tcmVkLXRlYW0tZW5nYWdlbWVudHMvCgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdHMnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW0FsaWFzKCdIb3N0TGlzdCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyQURTcGF0aCwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2hhcmVMaXN0LAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRPZmZpY2VEb2NzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRGcmVzaEVYRXMsCgogICAgICAgIFtBbGlhcygnVGVybXMnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJFNlYXJjaFRlcm1zLCAKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGVybUxpc3QsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJExhc3RBY2Nlc3NUaW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRMYXN0V3JpdGVUaW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDcmVhdGlvblRpbWUsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEluY2x1ZGVDLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRJbmNsdWRlQWRtaW4sCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEV4Y2x1ZGVGb2xkZXJzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRFeGNsdWRlSGlkZGVuLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRDaGVja1dyaXRlQWNjZXNzLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRPdXRGaWxlLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICROb0Nsb2JiZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJE5vUGluZywKCiAgICAgICAgW1VJbnQzMl0KICAgICAgICAkRGVsYXkgPSAwLAoKICAgICAgICBbRG91YmxlXQogICAgICAgICRKaXR0ZXIgPSAuMywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAogICAgICAgIAogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNlYXJjaEZvcmVzdCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2VhcmNoU1lTVk9MLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFRocmVhZHMsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVzZVBTRHJpdmUKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snRGVidWcnXSkgewogICAgICAgICAgICAkRGVidWdQcmVmZXJlbmNlID0gJ0NvbnRpbnVlJwogICAgICAgIH0KCiAgICAgICAgIyByYW5kb20gb2JqZWN0IGZvciBkZWxheQogICAgICAgICRSYW5kTm8gPSBOZXctT2JqZWN0IFN5c3RlbS5SYW5kb20KCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFJ1bm5pbmcgSW52b2tlLUZpbGVGaW5kZXIgd2l0aCBkZWxheSBvZiAkRGVsYXkiCgogICAgICAgICRTaGFyZXMgPSBAKCkKCiAgICAgICAgIyBmaWd1cmUgb3V0IHRoZSBzaGFyZXMgd2Ugd2FudCB0byBpZ25vcmUKICAgICAgICBbU3RyaW5nW11dICRFeGNsdWRlZFNoYXJlcyA9IEAoIkMkIiwgIkFETUlOJCIpCgogICAgICAgICMgc2VlIGlmIHdlJ3JlIHNwZWNpZmljYWxseSBpbmNsdWRpbmcgYW55IG9mIHRoZSBub3JtYWxseSBleGNsdWRlZCBzZXRzCiAgICAgICAgaWYgKCRJbmNsdWRlQykgewogICAgICAgICAgICBpZiAoJEluY2x1ZGVBZG1pbikgewogICAgICAgICAgICAgICAgJEV4Y2x1ZGVkU2hhcmVzID0gQCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkRXhjbHVkZWRTaGFyZXMgPSBAKCJBRE1JTiQiKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoJEluY2x1ZGVBZG1pbikgewogICAgICAgICAgICBpZiAoJEluY2x1ZGVDKSB7CiAgICAgICAgICAgICAgICAkRXhjbHVkZWRTaGFyZXMgPSBAKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRFeGNsdWRlZFNoYXJlcyA9IEAoIkMkIikKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBkZWxldGUgYW55IGV4aXN0aW5nIG91dHB1dCBmaWxlIGlmIGl0IGFscmVhZHkgZXhpc3RzCiAgICAgICAgaWYoISROb0Nsb2JiZXIpIHsKICAgICAgICAgICAgaWYgKCRPdXRGaWxlIC1hbmQgKFRlc3QtUGF0aCAtUGF0aCAkT3V0RmlsZSkpIHsgUmVtb3ZlLUl0ZW0gLVBhdGggJE91dEZpbGUgfQogICAgICAgIH0KCiAgICAgICAgIyBpZiB0aGVyZSdzIGEgc2V0IG9mIHRlcm1zIHNwZWNpZmllZCB0byBzZWFyY2ggZm9yCiAgICAgICAgaWYgKCRUZXJtTGlzdCkgewogICAgICAgICAgICBGb3JFYWNoICgkVGVybSBpbiBHZXQtQ29udGVudCAtUGF0aCAkVGVybUxpc3QpIHsKICAgICAgICAgICAgICAgIGlmICgoJFRlcm0gLW5lICROdWxsKSAtYW5kICgkVGVybS50cmltKCkgLW5lICcnKSkgewogICAgICAgICAgICAgICAgICAgICRTZWFyY2hUZXJtcyArPSAkVGVybQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGlmIHdlJ3JlIGhhcmQtcGFzc2VkIGEgc2V0IG9mIHNoYXJlcwogICAgICAgIGlmKCRTaGFyZUxpc3QpIHsKICAgICAgICAgICAgRm9yRWFjaCAoJEl0ZW0gaW4gR2V0LUNvbnRlbnQgLVBhdGggJFNoYXJlTGlzdCkgewogICAgICAgICAgICAgICAgaWYgKCgkSXRlbSAtbmUgJE51bGwpIC1hbmQgKCRJdGVtLnRyaW0oKSAtbmUgJycpKSB7CiAgICAgICAgICAgICAgICAgICAgIyBleGNsdWRlIGFueSAiW3RhYl0tIGNvbW1hbnRzIiwgaS5lLiB0aGUgb3V0cHV0IGZyb20gSW52b2tlLVNoYXJlRmluZGVyCiAgICAgICAgICAgICAgICAgICAgJFNoYXJlID0gJEl0ZW0uU3BsaXQoImB0IilbMF0KICAgICAgICAgICAgICAgICAgICAkU2hhcmVzICs9ICRTaGFyZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAjIGlmIHdlJ3JlIHVzaW5nIGEgaG9zdCBmaWxlIGxpc3QsIHJlYWQgdGhlIHRhcmdldHMgaW4gYW5kIGFkZCB0aGVtIHRvIHRoZSB0YXJnZXQgbGlzdAogICAgICAgICAgICBpZigkQ29tcHV0ZXJGaWxlKSB7CiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gR2V0LUNvbnRlbnQgLVBhdGggJENvbXB1dGVyRmlsZQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZighJENvbXB1dGVyTmFtZSkgewoKICAgICAgICAgICAgICAgIGlmKCREb21haW4pIHsKICAgICAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoJERvbWFpbikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2VpZigkU2VhcmNoRm9yZXN0KSB7CiAgICAgICAgICAgICAgICAgICAgIyBnZXQgQUxMIHRoZSBkb21haW5zIGluIHRoZSBmb3Jlc3QgdG8gc2VhcmNoCiAgICAgICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBHZXQtTmV0Rm9yZXN0RG9tYWluIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5OYW1lIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICMgdXNlIHRoZSBsb2NhbCBkb21haW4KICAgICAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoIChHZXQtTmV0RG9tYWluKS5uYW1lICkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigkU2VhcmNoU1lTVk9MKSB7CiAgICAgICAgICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgICAgICAgICAkRENTZWFyY2hQYXRoID0gIlxcJERvbWFpblxTWVNWT0xcIgogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gQWRkaW5nIHNoYXJlIHNlYXJjaCBwYXRoICREQ1NlYXJjaFBhdGgiCiAgICAgICAgICAgICAgICAgICAgICAgICRTaGFyZXMgKz0gJERDU2VhcmNoUGF0aAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZighJFNlYXJjaFRlcm1zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgc2VhcmNoIGZvciBpbnRlcmVzdGluZyBzY3JpcHRzIG9uIFNZU1ZPTAogICAgICAgICAgICAgICAgICAgICAgICAkU2VhcmNoVGVybXMgPSBAKCcudmJzJywgJy5iYXQnLCAnLnBzMScpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgW2FycmF5XSRDb21wdXRlck5hbWUgPSBAKCkKCiAgICAgICAgICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIGhvc3RzIgogICAgICAgICAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lICs9IEdldC1OZXRDb21wdXRlciAtRmlsdGVyICRDb21wdXRlckZpbHRlciAtQURTcGF0aCAkQ29tcHV0ZXJBRFNwYXRoIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgIyByZW1vdmUgYW55IG51bGwgdGFyZ2V0IGhvc3RzLCB1bmlxdWlmeSB0aGUgbGlzdCBhbmQgc2h1ZmZsZSBpdAogICAgICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHsgJF8gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgfCBTb3J0LU9iamVjdCB7IEdldC1SYW5kb20gfQogICAgICAgICAgICAgICAgICAgIGlmKCQoJENvbXB1dGVyTmFtZS5Db3VudCkgLWVxIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgIk5vIGhvc3RzIGZvdW5kISIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgc2NyaXB0IGJsb2NrIHRoYXQgZW51bWVyYXRlcyBzaGFyZXMgYW5kIGZpbGVzIG9uIGEgc2VydmVyCiAgICAgICAgJEhvc3RFbnVtQmxvY2sgPSB7CiAgICAgICAgICAgIHBhcmFtKCRDb21wdXRlck5hbWUsICRQaW5nLCAkRXhjbHVkZWRTaGFyZXMsICRTZWFyY2hUZXJtcywgJEV4Y2x1ZGVGb2xkZXJzLCAkT2ZmaWNlRG9jcywgJEV4Y2x1ZGVIaWRkZW4sICRGcmVzaEVYRXMsICRDaGVja1dyaXRlQWNjZXNzLCAkT3V0RmlsZSwgJFVzZVBTRHJpdmUpCgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDb21wdXRlck5hbWU6ICRDb21wdXRlck5hbWUiCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkV4Y2x1ZGVkU2hhcmVzOiAkRXhjbHVkZWRTaGFyZXMiCiAgICAgICAgICAgICRTZWFyY2hTaGFyZXMgPSBAKCkKCiAgICAgICAgICAgIGlmKCRDb21wdXRlck5hbWUuU3RhcnRzV2l0aCgiXFwiKSkgewogICAgICAgICAgICAgICAgIyBpZiBhIHNoYXJlIGlzIHBhc3NlZCBhcyB0aGUgc2VydmVyCiAgICAgICAgICAgICAgICAkU2VhcmNoU2hhcmVzICs9ICRDb21wdXRlck5hbWUKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICMgaWYgd2UncmUgZW51bWVyYXRpbmcgdGhlIHNoYXJlcyBvbiB0aGUgdGFyZ2V0IHNlcnZlciBmaXJzdAogICAgICAgICAgICAgICAgJFVwID0gJFRydWUKICAgICAgICAgICAgICAgIGlmKCRQaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgJFVwID0gVGVzdC1Db25uZWN0aW9uIC1Db3VudCAxIC1RdWlldCAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCRVcCkgewogICAgICAgICAgICAgICAgICAgICMgZ2V0IHRoZSBzaGFyZXMgZm9yIHRoaXMgaG9zdCBhbmQgZGlzcGxheSB3aGF0IHdlIGZpbmQKICAgICAgICAgICAgICAgICAgICAkU2hhcmVzID0gR2V0LU5ldFNoYXJlIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgICAgIEZvckVhY2ggKCRTaGFyZSBpbiAkU2hhcmVzKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAkTmV0TmFtZSA9ICRTaGFyZS5zaGkxX25ldG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJFBhdGggPSAnXFwnKyRDb21wdXRlck5hbWUrJ1wnKyROZXROYW1lCgogICAgICAgICAgICAgICAgICAgICAgICAjIG1ha2Ugc3VyZSB3ZSBnZXQgYSByZWFsIHNoYXJlIG5hbWUgYmFjawogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCROZXROYW1lKSAtYW5kICgkTmV0TmFtZS50cmltKCkgLW5lICcnKSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgc2tpcCB0aGlzIHNoYXJlIGlmIGl0J3MgaW4gdGhlIGV4Y2x1ZGUgbGlzdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRFeGNsdWRlZFNoYXJlcyAtTm90Q29udGFpbnMgJE5ldE5hbWUuVG9VcHBlcigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBjaGVjayBpZiB0aGUgdXNlciBoYXMgYWNjZXNzIHRvIHRoaXMgcGF0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICROdWxsID0gW0lPLkRpcmVjdG9yeV06OkdldEZpbGVzKCRQYXRoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkU2VhcmNoU2hhcmVzICs9ICRQYXRoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWyFdIE5vIGFjY2VzcyB0byAkUGF0aCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEZvckVhY2goJFNoYXJlIGluICRTZWFyY2hTaGFyZXMpIHsKICAgICAgICAgICAgICAgICRTZWFyY2hBcmdzID0gIEB7CiAgICAgICAgICAgICAgICAgICAgJ1BhdGgnID0gJFNoYXJlCiAgICAgICAgICAgICAgICAgICAgJ1NlYXJjaFRlcm1zJyA9ICRTZWFyY2hUZXJtcwogICAgICAgICAgICAgICAgICAgICdPZmZpY2VEb2NzJyA9ICRPZmZpY2VEb2NzCiAgICAgICAgICAgICAgICAgICAgJ0ZyZXNoRVhFcycgPSAkRnJlc2hFWEVzCiAgICAgICAgICAgICAgICAgICAgJ0xhc3RBY2Nlc3NUaW1lJyA9ICRMYXN0QWNjZXNzVGltZQogICAgICAgICAgICAgICAgICAgICdMYXN0V3JpdGVUaW1lJyA9ICRMYXN0V3JpdGVUaW1lCiAgICAgICAgICAgICAgICAgICAgJ0NyZWF0aW9uVGltZScgPSAkQ3JlYXRpb25UaW1lCiAgICAgICAgICAgICAgICAgICAgJ0V4Y2x1ZGVGb2xkZXJzJyA9ICRFeGNsdWRlRm9sZGVycwogICAgICAgICAgICAgICAgICAgICdFeGNsdWRlSGlkZGVuJyA9ICRFeGNsdWRlSGlkZGVuCiAgICAgICAgICAgICAgICAgICAgJ0NoZWNrV3JpdGVBY2Nlc3MnID0gJENoZWNrV3JpdGVBY2Nlc3MKICAgICAgICAgICAgICAgICAgICAnT3V0RmlsZScgPSAkT3V0RmlsZQogICAgICAgICAgICAgICAgICAgICdVc2VQU0RyaXZlJyA9ICRVc2VQU0RyaXZlCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgRmluZC1JbnRlcmVzdGluZ0ZpbGUgQFNlYXJjaEFyZ3MKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgaWYoJFRocmVhZHMpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVXNpbmcgdGhyZWFkaW5nIHdpdGggdGhyZWFkcyA9ICRUaHJlYWRzIgoKICAgICAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyB0aHJlYWRpbmcsIGtpY2sgb2ZmIHRoZSBzY3JpcHQgYmxvY2sgd2l0aCBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbgogICAgICAgICAgICAkU2NyaXB0UGFyYW1zID0gQHsKICAgICAgICAgICAgICAgICdQaW5nJyA9ICQoLW5vdCAkTm9QaW5nKQogICAgICAgICAgICAgICAgJ0V4Y2x1ZGVkU2hhcmVzJyA9ICRFeGNsdWRlZFNoYXJlcwogICAgICAgICAgICAgICAgJ1NlYXJjaFRlcm1zJyA9ICRTZWFyY2hUZXJtcwogICAgICAgICAgICAgICAgJ0V4Y2x1ZGVGb2xkZXJzJyA9ICRFeGNsdWRlRm9sZGVycwogICAgICAgICAgICAgICAgJ09mZmljZURvY3MnID0gJE9mZmljZURvY3MKICAgICAgICAgICAgICAgICdFeGNsdWRlSGlkZGVuJyA9ICRFeGNsdWRlSGlkZGVuCiAgICAgICAgICAgICAgICAnRnJlc2hFWEVzJyA9ICRGcmVzaEVYRXMKICAgICAgICAgICAgICAgICdDaGVja1dyaXRlQWNjZXNzJyA9ICRDaGVja1dyaXRlQWNjZXNzCiAgICAgICAgICAgICAgICAnT3V0RmlsZScgPSAkT3V0RmlsZQogICAgICAgICAgICAgICAgJ1VzZVBTRHJpdmUnID0gJFVzZVBTRHJpdmUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBraWNrIG9mZiB0aGUgdGhyZWFkZWQgc2NyaXB0IGJsb2NrICsgYXJndW1lbnRzIAogICAgICAgICAgICBpZigkU2hhcmVzKSB7CiAgICAgICAgICAgICAgICAjIHBhc3MgdGhlIHNoYXJlcyBhcyB0aGUgaG9zdHMgc28gdGhlIHRocmVhZGVkIGZ1bmN0aW9uIGNvZGUgZG9lc24ndCBoYXZlIHRvIGJlIGhhY2tlZCB1cAogICAgICAgICAgICAgICAgSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLUNvbXB1dGVyTmFtZSAkU2hhcmVzIC1TY3JpcHRCbG9jayAkSG9zdEVudW1CbG9jayAtU2NyaXB0UGFyYW1ldGVycyAkU2NyaXB0UGFyYW1zIC1UaHJlYWRzICRUaHJlYWRzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1TY3JpcHRQYXJhbWV0ZXJzICRTY3JpcHRQYXJhbXMgLVRocmVhZHMgJFRocmVhZHMKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCRTaGFyZXMpewogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSA9ICRTaGFyZXMKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoLW5vdCAkTm9QaW5nIC1hbmQgKCRDb21wdXRlck5hbWUuY291bnQgLWd0IDEpKSB7CiAgICAgICAgICAgICAgICAjIHBpbmcgYWxsIGhvc3RzIGluIHBhcmFsbGVsCiAgICAgICAgICAgICAgICAkUGluZyA9IHtwYXJhbSgkQ29tcHV0ZXJOYW1lKSBpZihUZXN0LUNvbm5lY3Rpb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1Db3VudCAxIC1RdWlldCAtRXJyb3JBY3Rpb24gU3RvcCl7JENvbXB1dGVyTmFtZX19CiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLU5vSW1wb3J0cyAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRQaW5nIC1UaHJlYWRzIDEwMAogICAgICAgICAgICB9CgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gVG90YWwgbnVtYmVyIG9mIGFjdGl2ZSBob3N0czogJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSIKICAgICAgICAgICAgJENvdW50ZXIgPSAwCgogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDb21wdXRlcjogJF8iCiAgICAgICAgICAgICAgICAkQ291bnRlciA9ICRDb3VudGVyICsgMQoKICAgICAgICAgICAgICAgICMgc2xlZXAgZm9yIG91ciBzZW1pLXJhbmRvbWl6ZWQgaW50ZXJ2YWwKICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzICRSYW5kTm8uTmV4dCgoMS0kSml0dGVyKSokRGVsYXksICgxKyRKaXR0ZXIpKiREZWxheSkKCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gRW51bWVyYXRpbmcgc2VydmVyICRfICgkQ291bnRlciBvZiAkKCRDb21wdXRlck5hbWUuY291bnQpKSIKCiAgICAgICAgICAgICAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgJEhvc3RFbnVtQmxvY2sgLUFyZ3VtZW50TGlzdCAkXywgJEZhbHNlLCAkRXhjbHVkZWRTaGFyZXMsICRTZWFyY2hUZXJtcywgJEV4Y2x1ZGVGb2xkZXJzLCAkT2ZmaWNlRG9jcywgJEV4Y2x1ZGVIaWRkZW4sICRGcmVzaEVYRXMsICRDaGVja1dyaXRlQWNjZXNzLCAkT3V0RmlsZSwgJFVzZVBTRHJpdmUgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBGaW5kLUxvY2FsQWRtaW5BY2Nlc3Mgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEZpbmRzIG1hY2hpbmVzIG9uIHRoZSBsb2NhbCBkb21haW4gd2hlcmUgdGhlIGN1cnJlbnQgdXNlciBoYXMKICAgICAgICBsb2NhbCBhZG1pbmlzdHJhdG9yIGFjY2Vzcy4gVXNlcyBtdWx0aXRocmVhZGluZyB0bwogICAgICAgIHNwZWVkIHVwIGVudW1lcmF0aW9uLgoKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFRoaXMgZnVuY3Rpb24gZmluZHMgdGhlIGxvY2FsIGRvbWFpbiBuYW1lIGZvciBhIGhvc3QgdXNpbmcgR2V0LU5ldERvbWFpbiwKICAgICAgICBxdWVyaWVzIHRoZSBkb21haW4gZm9yIGFsbCBhY3RpdmUgbWFjaGluZXMgd2l0aCBHZXQtTmV0Q29tcHV0ZXIsIHRoZW4gZm9yCiAgICAgICAgZWFjaCBzZXJ2ZXIgaXQgY2hlY2tzIGlmIHRoZSBjdXJyZW50IHVzZXIgaGFzIGxvY2FsIGFkbWluaXN0cmF0b3IKICAgICAgICBhY2Nlc3MgdXNpbmcgSW52b2tlLUNoZWNrTG9jYWxBZG1pbkFjY2Vzcy4KCiAgICAgICAgSWRlYSBzdG9sZW4gZnJvbSB0aGUgbG9jYWxfYWRtaW5fc2VhcmNoX2VudW0gcG9zdCBtb2R1bGUgaW4KICAgICAgICBNZXRhc3Bsb2l0IHdyaXR0ZW4gYnk6CiAgICAgICAgICAgICdCcmFuZG9uIE1jQ2FubiAiemVrbm94IiA8Ym1jY2FublthdF1hY2N1dmFudC5jb20+JwogICAgICAgICAgICAnVGhvbWFzIE1jQ2FydGh5ICJzbWlsaW5ncmFjY29vbiIgPHNtaWxpbmdyYWNjb29uW2F0XWdtYWlsLmNvbT4nCiAgICAgICAgICAgICdSb3ljZSBEYXZpcyAicjNkeSIgPHJkYXZpc1thdF1hY2N1dmFudC5jb20+JwoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIEhvc3QgYXJyYXkgdG8gZW51bWVyYXRlLCBwYXNzYWJsZSBvbiB0aGUgcGlwZWxpbmUuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckZpbGUKCiAgICAgICAgRmlsZSBvZiBob3N0bmFtZXMvSVBzIHRvIHNlYXJjaC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsdGVyCgogICAgICAgIEhvc3QgZmlsdGVyIG5hbWUgdG8gcXVlcnkgQUQgZm9yLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoIGZvciBob3N0cywgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIE5vUGluZwoKICAgICAgICBTd2l0Y2guIERvbid0IHBpbmcgZWFjaCBob3N0IHRvIGVuc3VyZSBpdCdzIHVwIGJlZm9yZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIERlbGF5CgogICAgICAgIERlbGF5IGJldHdlZW4gZW51bWVyYXRpbmcgaG9zdHMsIGRlZmF1bHRzIHRvIDAKCiAgICAuUEFSQU1FVEVSIEppdHRlcgoKICAgICAgICBKaXR0ZXIgZm9yIHRoZSBob3N0IGRlbGF5LCBkZWZhdWx0cyB0byArLy0gMC4zCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIHRvIHF1ZXJ5IGZvciBtYWNoaW5lcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgogICAgCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaEZvcmVzdAoKICAgICAgICBTd2l0Y2guIFNlYXJjaCBhbGwgZG9tYWlucyBpbiB0aGUgZm9yZXN0IGZvciB0YXJnZXQgdXNlcnMgaW5zdGVhZCBvZiBqdXN0CiAgICAgICAgYSBzaW5nbGUgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgVGhyZWFkcwoKICAgICAgICBUaGUgbWF4aW11bSBjb25jdXJyZW50IHRocmVhZHMgdG8gZXhlY3V0ZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtTG9jYWxBZG1pbkFjY2VzcwoKICAgICAgICBGaW5kIG1hY2hpbmVzIG9uIHRoZSBsb2NhbCBkb21haW4gd2hlcmUgdGhlIGN1cnJlbnQgdXNlciBoYXMgbG9jYWwKICAgICAgICBhZG1pbmlzdHJhdG9yIGFjY2Vzcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtTG9jYWxBZG1pbkFjY2VzcyAtVGhyZWFkcyAxMAoKICAgICAgICBNdWx0aS10aHJlYWRlZCBhY2Nlc3MgaHVudGluZywgcmVwbGFjZXMgRmluZC1Mb2NhbEFkbWluQWNjZXNzVGhyZWFkZWQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUxvY2FsQWRtaW5BY2Nlc3MgLURvbWFpbiB0ZXN0aW5nCgogICAgICAgIEZpbmQgbWFjaGluZXMgb24gdGhlICd0ZXN0aW5nJyBkb21haW4gd2hlcmUgdGhlIGN1cnJlbnQgdXNlciBoYXMKICAgICAgICBsb2NhbCBhZG1pbmlzdHJhdG9yIGFjY2Vzcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtTG9jYWxBZG1pbkFjY2VzcyAtQ29tcHV0ZXJGaWxlIGhvc3RzLnR4dAoKICAgICAgICBGaW5kIHdoaWNoIG1hY2hpbmVzIGluIHRoZSBob3N0IGxpc3QgdGhlIGN1cnJlbnQgdXNlciBoYXMgbG9jYWwKICAgICAgICBhZG1pbmlzdHJhdG9yIGFjY2Vzcy4KCiAgICAuTElOSwoKICAgICAgICBodHRwczovL2dpdGh1Yi5jb20vcmFwaWQ3L21ldGFzcGxvaXQtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL21vZHVsZXMvcG9zdC93aW5kb3dzL2dhdGhlci9sb2NhbF9hZG1pbl9zZWFyY2hfZW51bS5yYgogICAgICAgIGh0dHA6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9wZW5ldGVzdGluZy9maW5kaW5nLWxvY2FsLWFkbWluLXdpdGgtdGhlLXZlaWwtZnJhbWV3b3JrLwojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdHMnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW0FsaWFzKCdIb3N0TGlzdCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyQURTcGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTm9QaW5nLAoKICAgICAgICBbVUludDMyXQogICAgICAgICREZWxheSA9IDAsCgogICAgICAgIFtEb3VibGVdCiAgICAgICAgJEppdHRlciA9IC4zLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNlYXJjaEZvcmVzdCwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRUaHJlYWRzCiAgICApCgogICAgYmVnaW4gewogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0RlYnVnJ10pIHsKICAgICAgICAgICAgJERlYnVnUHJlZmVyZW5jZSA9ICdDb250aW51ZScKICAgICAgICB9CgogICAgICAgICMgcmFuZG9tIG9iamVjdCBmb3IgZGVsYXkKICAgICAgICAkUmFuZE5vID0gTmV3LU9iamVjdCBTeXN0ZW0uUmFuZG9tCgogICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBSdW5uaW5nIEZpbmQtTG9jYWxBZG1pbkFjY2VzcyB3aXRoIGRlbGF5IG9mICREZWxheSIKCiAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyBhIGhvc3QgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgaWYoJENvbXB1dGVyRmlsZSkgewogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gR2V0LUNvbnRlbnQgLVBhdGggJENvbXB1dGVyRmlsZQogICAgICAgIH0KCiAgICAgICAgaWYoISRDb21wdXRlck5hbWUpIHsKICAgICAgICAgICAgW2FycmF5XSRDb21wdXRlck5hbWUgPSBAKCkKCiAgICAgICAgICAgIGlmKCREb21haW4pIHsKICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gQCgkRG9tYWluKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZigkU2VhcmNoRm9yZXN0KSB7CiAgICAgICAgICAgICAgICAjIGdldCBBTEwgdGhlIGRvbWFpbnMgaW4gdGhlIGZvcmVzdCB0byBzZWFyY2gKICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gR2V0LU5ldEZvcmVzdERvbWFpbiB8IEZvckVhY2gtT2JqZWN0IHsgJF8uTmFtZSB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAjIHVzZSB0aGUgbG9jYWwgZG9tYWluCiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoIChHZXQtTmV0RG9tYWluKS5uYW1lICkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciBob3N0cyIKICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgKz0gR2V0LU5ldENvbXB1dGVyIC1GaWx0ZXIgJENvbXB1dGVyRmlsdGVyIC1BRFNwYXRoICRDb21wdXRlckFEU3BhdGggLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyCiAgICAgICAgICAgIH0KICAgICAgICAKICAgICAgICAgICAgIyByZW1vdmUgYW55IG51bGwgdGFyZ2V0IGhvc3RzLCB1bmlxdWlmeSB0aGUgbGlzdCBhbmQgc2h1ZmZsZSBpdAogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJENvbXB1dGVyTmFtZSB8IFdoZXJlLU9iamVjdCB7ICRfIH0gfCBTb3J0LU9iamVjdCAtVW5pcXVlIHwgU29ydC1PYmplY3QgeyBHZXQtUmFuZG9tIH0KICAgICAgICAgICAgaWYoJCgkQ29tcHV0ZXJOYW1lLkNvdW50KSAtZXEgMCkgewogICAgICAgICAgICAgICAgdGhyb3cgIk5vIGhvc3RzIGZvdW5kISIKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBzY3JpcHQgYmxvY2sgdGhhdCBlbnVtZXJhdGVzIGEgc2VydmVyCiAgICAgICAgJEhvc3RFbnVtQmxvY2sgPSB7CiAgICAgICAgICAgIHBhcmFtKCRDb21wdXRlck5hbWUsICRQaW5nKQoKICAgICAgICAgICAgJFVwID0gJFRydWUKICAgICAgICAgICAgaWYoJFBpbmcpIHsKICAgICAgICAgICAgICAgICRVcCA9IFRlc3QtQ29ubmVjdGlvbiAtQ291bnQgMSAtUXVpZXQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJFVwKSB7CiAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIHRoZSBjdXJyZW50IHVzZXIgaGFzIGxvY2FsIGFkbWluIGFjY2VzcyB0byB0aGlzIHNlcnZlcgogICAgICAgICAgICAgICAgJEFjY2VzcyA9IEludm9rZS1DaGVja0xvY2FsQWRtaW5BY2Nlc3MgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICBpZiAoJEFjY2VzcykgewogICAgICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIGlmKCRUaHJlYWRzKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlVzaW5nIHRocmVhZGluZyB3aXRoIHRocmVhZHMgPSAkVGhyZWFkcyIKCiAgICAgICAgICAgICMgaWYgd2UncmUgdXNpbmcgdGhyZWFkaW5nLCBraWNrIG9mZiB0aGUgc2NyaXB0IGJsb2NrIHdpdGggSW52b2tlLVRocmVhZGVkRnVuY3Rpb24KICAgICAgICAgICAgJFNjcmlwdFBhcmFtcyA9IEB7CiAgICAgICAgICAgICAgICAnUGluZycgPSAkKC1ub3QgJE5vUGluZykKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBraWNrIG9mZiB0aGUgdGhyZWFkZWQgc2NyaXB0IGJsb2NrICsgYXJndW1lbnRzIAogICAgICAgICAgICBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1TY3JpcHRQYXJhbWV0ZXJzICRTY3JpcHRQYXJhbXMgLVRocmVhZHMgJFRocmVhZHMKICAgICAgICB9CgogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZigtbm90ICROb1BpbmcgLWFuZCAoJENvbXB1dGVyTmFtZS5jb3VudCAtbmUgMSkpIHsKICAgICAgICAgICAgICAgICMgcGluZyBhbGwgaG9zdHMgaW4gcGFyYWxsZWwKICAgICAgICAgICAgICAgICRQaW5nID0ge3BhcmFtKCRDb21wdXRlck5hbWUpIGlmKFRlc3QtQ29ubmVjdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLUNvdW50IDEgLVF1aWV0IC1FcnJvckFjdGlvbiBTdG9wKXskQ29tcHV0ZXJOYW1lfX0KICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtTm9JbXBvcnRzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtU2NyaXB0QmxvY2sgJFBpbmcgLVRocmVhZHMgMTAwCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBUb3RhbCBudW1iZXIgb2YgYWN0aXZlIGhvc3RzOiAkKCRDb21wdXRlck5hbWUuY291bnQpIgogICAgICAgICAgICAkQ291bnRlciA9IDAKCiAgICAgICAgICAgIEZvckVhY2ggKCRDb21wdXRlciBpbiAkQ29tcHV0ZXJOYW1lKSB7CgogICAgICAgICAgICAgICAgJENvdW50ZXIgPSAkQ291bnRlciArIDEKCiAgICAgICAgICAgICAgICAjIHNsZWVwIGZvciBvdXIgc2VtaS1yYW5kb21pemVkIGludGVydmFsCiAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAtU2Vjb25kcyAkUmFuZE5vLk5leHQoKDEtJEppdHRlcikqJERlbGF5LCAoMSskSml0dGVyKSokRGVsYXkpCgogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIEVudW1lcmF0aW5nIHNlcnZlciAkQ29tcHV0ZXIgKCRDb3VudGVyIG9mICQoJENvbXB1dGVyTmFtZS5jb3VudCkpIgogICAgICAgICAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1Bcmd1bWVudExpc3QgJENvbXB1dGVyLCAkRmFsc2UKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1FeHBsb2l0YWJsZVN5c3RlbSB7CjwjCiAgICAuU3lub3BzaXMKCiAgICAgICAgVGhpcyBtb2R1bGUgd2lsbCBxdWVyeSBBY3RpdmUgRGlyZWN0b3J5IGZvciB0aGUgaG9zdG5hbWUsIE9TIHZlcnNpb24sIGFuZCBzZXJ2aWNlIHBhY2sgbGV2ZWwgIAogICAgICAgIGZvciBlYWNoIGNvbXB1dGVyIGFjY291bnQuICBUaGF0IGluZm9ybWF0aW9uIGlzIHRoZW4gY3Jvc3MtcmVmZXJlbmNlZCBhZ2FpbnN0IGEgbGlzdCBvZiBjb21tb24KICAgICAgICBNZXRhc3Bsb2l0IGV4cGxvaXRzIHRoYXQgY2FuIGJlIHVzZWQgZHVyaW5nIHBlbmV0cmF0aW9uIHRlc3RpbmcuCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFRoaXMgbW9kdWxlIHdpbGwgcXVlcnkgQWN0aXZlIERpcmVjdG9yeSBmb3IgdGhlIGhvc3RuYW1lLCBPUyB2ZXJzaW9uLCBhbmQgc2VydmljZSBwYWNrIGxldmVsICAKICAgICAgICBmb3IgZWFjaCBjb21wdXRlciBhY2NvdW50LiAgVGhhdCBpbmZvcm1hdGlvbiBpcyB0aGVuIGNyb3NzLXJlZmVyZW5jZWQgYWdhaW5zdCBhIGxpc3Qgb2YgY29tbW9uCiAgICAgICAgTWV0YXNwbG9pdCBleHBsb2l0cyB0aGF0IGNhbiBiZSB1c2VkIGR1cmluZyBwZW5ldHJhdGlvbiB0ZXN0aW5nLiAgVGhlIHNjcmlwdCBmaWx0ZXJzIG91dCBkaXNhYmxlZAogICAgICAgIGRvbWFpbiBjb21wdXRlcnMgYW5kIHByb3ZpZGVzIHRoZSBjb21wdXRlcidzIGxhc3QgbG9nb24gdGltZSB0byBoZWxwIGRldGVybWluZSBpZiBpdCdzIGJlZW4gCiAgICAgICAgZGVjb21taXNzaW9uZWQuICBBbHNvLCBzaW5jZSB0aGUgc2NyaXB0IHVzZXMgZGF0YSB0YWJsZXMgdG8gb3V0cHV0IGFmZmVjdGVkIHN5c3RlbXMgdGhlIHJlc3VsdHMKICAgICAgICBjYW4gYmUgZWFzaWx5IHBpcGVkIHRvIG90aGVyIGNvbW1hbmRzIHN1Y2ggYXMgdGVzdC1jb25uZWN0aW9uIG9yIGEgRXhwb3J0LUNzdi4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBSZXR1cm4gY29tcHV0ZXJzIHdpdGggYSBzcGVjaWZpYyBuYW1lLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBTUE4KCiAgICAgICAgUmV0dXJuIGNvbXB1dGVycyB3aXRoIGEgc3BlY2lmaWMgc2VydmljZSBwcmluY2lwYWwgbmFtZSwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgT3BlcmF0aW5nU3lzdGVtCgogICAgICAgIFJldHVybiBjb21wdXRlcnMgd2l0aCBhIHNwZWNpZmljIG9wZXJhdGluZyBzeXN0ZW0sIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIFNlcnZpY2VQYWNrCgogICAgICAgIFJldHVybiBjb21wdXRlcnMgd2l0aCBhIHNwZWNpZmljIHNlcnZpY2UgcGFjaywgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgRmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlLCBlLmcuICIoZGVzY3JpcHRpb249KmFkbWluKikiCgogICAgLlBBUkFNRVRFUiBQaW5nCgogICAgICAgIFN3aXRjaC4gUGluZyBlYWNoIGhvc3QgdG8gZW5zdXJlIGl0J3MgdXAgYmVmb3JlIGVudW1lcmF0aW5nLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIGNvbXB1dGVycywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBVbmNvbnN0cmFpbmVkCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIGNvbXB1dGVyIG9iamVjdHMgdGhhdCBoYXZlIHVuY29uc3RyYWluZWQgZGVsZWdhdGlvbi4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCiAgICAgICAKICAgICAgICBUaGUgZXhhbXBsZSBiZWxvdyBzaG93cyB0aGUgc3RhbmRhcmQgY29tbWFuZCB1c2FnZS4gIERpc2FibGVkIHN5c3RlbSBhcmUgZXhjbHVkZWQgYnkgZGVmYXVsdCwgYnV0CiAgICAgICAgdGhlICJMYXN0TGdvbiIgY29sdW1uIGNhbiBiZSB1c2VkIHRvIGRldGVybWluZSB3aGljaCBzeXN0ZW1zIGFyZSBsaXZlLiAgVXN1YWxseSwgaWYgYSBzeXN0ZW0gaGFzbid0IAogICAgICAgIGxvZ2dlZCBvbiBmb3IgdHdvIG9yIG1vcmUgd2Vla3MgaXQncyBiZWVuIGRlY29tbWlzc2lvbmVkLiAgICAgIAogICAgICAgIFBTIEM6XD4gR2V0LUV4cGxvaXRhYmxlU3lzdGVtIC1Eb21haW5Db250cm9sbGVyIDE5Mi4xNjguMS4xIC1DcmVkZW50aWFsIGRlbW8uY29tXHVzZXIgfCBGb3JtYXQtVGFibGUgLUF1dG9TaXplCiAgICAgICAgWypdIEdyYWJiaW5nIGNvbXB1dGVyIGFjY291bnRzIGZyb20gQWN0aXZlIERpcmVjdG9yeS4uLgogICAgICAgIFsqXSBMb2FkaW5nIGV4cGxvaXQgbGlzdCBmb3IgY3JpdGljYWwgbWlzc2luZyBwYXRjaGVzLi4uCiAgICAgICAgWypdIENoZWNraW5nIGNvbXB1dGVycyBmb3IgdnVsbmVyYWJsZSBPUyBhbmQgU1AgbGV2ZWxzLi4uCiAgICAgICAgWytdIEZvdW5kIDUgcG90ZW50aWFsbHkgdnVsbmVyYWJsZSBzeXN0ZW1zIQogICAgICAgIENvbXB1dGVyTmFtZSAgICAgICAgICBPcGVyYXRpbmdTeXN0ZW0gICAgICAgICBTZXJ2aWNlUGFjayAgICBMYXN0TG9nb24gICAgICAgICAgICBNc2ZNb2R1bGUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENWRSAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAtLS0tLS0tLS0tLS0gICAgICAgICAgLS0tLS0tLS0tLS0tLS0tICAgICAgICAgLS0tLS0tLS0tLS0gICAgLS0tLS0tLS0tICAgICAgICAgICAgLS0tLS0tLS0tICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLS0gICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgQURTLmRlbW8uY29tICAgICAgICAgIFdpbmRvd3MgU2VydmVyIDIwMDMgICAgIFNlcnZpY2UgUGFjayAyIDQvOC8yMDE1IDU6NDY6NTIgUE0gIGV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwN18wMjlfbXNkbnNfem9uZW5hbWUgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLgogICAgICAgIEFEUy5kZW1vLmNvbSAgICAgICAgICBXaW5kb3dzIFNlcnZlciAyMDAzICAgICBTZXJ2aWNlIFBhY2sgMiA0LzgvMjAxNSA1OjQ2OjUyIFBNICBleHBsb2l0L3dpbmRvd3Mvc21iL21zMDhfMDY3X25ldGFwaSAgICAgICAgICAgIGh0dHA6Ly93d3cuY3ZlZGV0YWlscy4uLi4KICAgICAgICBBRFMuZGVtby5jb20gICAgICAgICAgV2luZG93cyBTZXJ2ZXIgMjAwMyAgICAgU2VydmljZSBQYWNrIDIgNC84LzIwMTUgNTo0Njo1MiBQTSAgZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzICAgICAgICAgICBodHRwOi8vd3d3LmN2ZWRldGFpbHMuLi4uCiAgICAgICAgTFZBLmRlbW8uY29tICAgICAgICAgIFdpbmRvd3MgU2VydmVyIDIwMDMgICAgIFNlcnZpY2UgUGFjayAyIDQvOC8yMDE1IDE6NDQ6NDYgUE0gIGV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwN18wMjlfbXNkbnNfem9uZW5hbWUgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLgogICAgICAgIExWQS5kZW1vLmNvbSAgICAgICAgICBXaW5kb3dzIFNlcnZlciAyMDAzICAgICBTZXJ2aWNlIFBhY2sgMiA0LzgvMjAxNSAxOjQ0OjQ2IFBNICBleHBsb2l0L3dpbmRvd3Mvc21iL21zMDhfMDY3X25ldGFwaSAgICAgICAgICAgIGh0dHA6Ly93d3cuY3ZlZGV0YWlscy4uLi4KICAgICAgICBMVkEuZGVtby5jb20gICAgICAgICAgV2luZG93cyBTZXJ2ZXIgMjAwMyAgICAgU2VydmljZSBQYWNrIDIgNC84LzIwMTUgMTo0NDo0NiBQTSAgZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzICAgICAgICAgICBodHRwOi8vd3d3LmN2ZWRldGFpbHMuLi4uCiAgICAgICAgYXNzZXNzLXhwcHJvLmRlbW8uY29tIFdpbmRvd3MgWFAgUHJvZmVzc2lvbmFsIFNlcnZpY2UgUGFjayAzIDQvMS8yMDE0IDExOjExOjU0IEFNIGV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpICAgICAgICAgICAgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLgogICAgICAgIGFzc2Vzcy14cHByby5kZW1vLmNvbSBXaW5kb3dzIFhQIFByb2Zlc3Npb25hbCBTZXJ2aWNlIFBhY2sgMyA0LzEvMjAxNCAxMToxMTo1NCBBTSBleHBsb2l0L3dpbmRvd3Mvc21iL21zMTBfMDYxX3Nwb29sc3MgICAgICAgICAgIGh0dHA6Ly93d3cuY3ZlZGV0YWlscy4uLi4KICAgICAgICBIVkEuZGVtby5jb20gICAgICAgICAgV2luZG93cyBTZXJ2ZXIgMjAwMyAgICAgU2VydmljZSBQYWNrIDIgMTEvNS8yMDEzIDk6MTY6MzEgUE0gZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA3XzAyOV9tc2Ruc196b25lbmFtZSBodHRwOi8vd3d3LmN2ZWRldGFpbHMuLi4uCiAgICAgICAgSFZBLmRlbW8uY29tICAgICAgICAgIFdpbmRvd3MgU2VydmVyIDIwMDMgICAgIFNlcnZpY2UgUGFjayAyIDExLzUvMjAxMyA5OjE2OjMxIFBNIGV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpICAgICAgICAgICAgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLgogICAgICAgIEhWQS5kZW1vLmNvbSAgICAgICAgICBXaW5kb3dzIFNlcnZlciAyMDAzICAgICBTZXJ2aWNlIFBhY2sgMiAxMS81LzIwMTMgOToxNjozMSBQTSBleHBsb2l0L3dpbmRvd3Mvc21iL21zMTBfMDYxX3Nwb29sc3MgICAgICAgICAgIGh0dHA6Ly93d3cuY3ZlZGV0YWlscy4uLi4KICAgICAgICBEQjEuZGVtby5jb20gICAgICAgICAgV2luZG93cyBTZXJ2ZXIgMjAwMyAgICAgU2VydmljZSBQYWNrIDIgMy8yMi8yMDEyIDU6MDU6MzQgUE0gZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA3XzAyOV9tc2Ruc196b25lbmFtZSBodHRwOi8vd3d3LmN2ZWRldGFpbHMuLi4uCiAgICAgICAgREIxLmRlbW8uY29tICAgICAgICAgIFdpbmRvd3MgU2VydmVyIDIwMDMgICAgIFNlcnZpY2UgUGFjayAyIDMvMjIvMjAxMiA1OjA1OjM0IFBNIGV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpICAgICAgICAgICAgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLgogICAgICAgIERCMS5kZW1vLmNvbSAgICAgICAgICBXaW5kb3dzIFNlcnZlciAyMDAzICAgICBTZXJ2aWNlIFBhY2sgMiAzLzIyLzIwMTIgNTowNTozNCBQTSBleHBsb2l0L3dpbmRvd3Mvc21iL21zMTBfMDYxX3Nwb29sc3MgICAgICAgICAgIGh0dHA6Ly93d3cuY3ZlZGV0YWlscy4uLi4gICAgICAgICAgICAgICAgICAgICAKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1FeHBsb2l0YWJsZVN5c3RlbSB8IEV4cG9ydC1Dc3YgYzpcdGVtcFxvdXRwdXQuY3N2IC1Ob1R5cGVJbmZvcm1hdGlvbgoKICAgICAgICBIb3cgdG8gd3JpdGUgdGhlIG91dHB1dCB0byBhIGNzdiBmaWxlLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUV4cGxvaXRhYmxlU3lzdGVtIC1Eb21haW4gdGVzdGxhYi5sb2NhbCAtUGluZwoKICAgICAgICBSZXR1cm4gYSBzZXQgb2YgbGl2ZSBob3N0cyBmcm9tIHRoZSB0ZXN0bGFiLmxvY2FsIGRvbWFpbgoKICAgICAuTElOSwogICAgICAgCiAgICAgICBodHRwOi8vd3d3Lm5ldHNwaS5jb20KICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9udWxsYmluZC9Qb3dlcnNoZWxsZXJ5L2Jsb2IvbWFzdGVyL1N0YWJsZS1pc2gvQURTL0dldC1FeHBsb2l0YWJsZVN5c3RlbXMucHNtMQogICAgICAgCiAgICAgLk5PVEVTCiAgICAgICAKICAgICAgIEF1dGhvcjogIFNjb3R0IFN1dGhlcmxhbmQgLSAyMDE1LCBOZXRTUEkKICAgICAgICAgICAgICAgIE1vZGlmaWNhdGlvbnMgdG8gaW50ZWdyYXRlIGludG8gUG93ZXJWaWV3IGJ5IEBoYXJtajB5CiAgICAgICBWZXJzaW9uOiBHZXQtRXhwbG9pdGFibGVTeXN0ZW0ucHNtMSB2MS4xCiAgICAgICBDb21tZW50czogVGhlIHRlY2huaXF1ZSB1c2VkIHRvIHF1ZXJ5IExEQVAgd2FzIGJhc2VkIG9uIHRoZSAiR2V0LUF1ZGl0RFNDb21wdXRlckFjY291bnQiIAogICAgICAgZnVuY3Rpb24gZm91bmQgaW4gQ2Fyb2xzIFBlcmV6J3MgUG9zaFNlYy1Nb2QgcHJvamVjdC4gIFRoZSBnZW5lcmFsIGlkZWEgaXMgYmFzZWQgb2ZmIG9mICAKICAgICAgIFdpbGwgU2Nocm9lZGVyJ3MgIkludm9rZS1GaW5kVnVsblN5c3RlbXMiIGZ1bmN0aW9uIGZyb20gdGhlIFBvd2VyVmlldyB0b29sa2l0LgojPgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnKicsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNQTiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkT3BlcmF0aW5nU3lzdGVtID0gJyonLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRTZXJ2aWNlUGFjayA9ICcqJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRmlsdGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRQaW5nLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVuY29uc3RyYWluZWQsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBXcml0ZS1WZXJib3NlICJbKl0gR3JhYmJpbmcgY29tcHV0ZXIgYWNjb3VudHMgZnJvbSBBY3RpdmUgRGlyZWN0b3J5Li4uIgoKICAgICMgQ3JlYXRlIGRhdGEgdGFibGUgZm9yIGhvc3RuYW1lcywgb3MsIGFuZCBzZXJ2aWNlIHBhY2tzIGZyb20gTERBUAogICAgJFRhYmxlQWRzQ29tcHV0ZXJzID0gTmV3LU9iamVjdCBTeXN0ZW0uRGF0YS5EYXRhVGFibGUgCiAgICAkTnVsbCA9ICRUYWJsZUFkc0NvbXB1dGVycy5Db2x1bW5zLkFkZCgnSG9zdG5hbWUnKSAgICAgICAKICAgICROdWxsID0gJFRhYmxlQWRzQ29tcHV0ZXJzLkNvbHVtbnMuQWRkKCdPcGVyYXRpbmdTeXN0ZW0nKQogICAgJE51bGwgPSAkVGFibGVBZHNDb21wdXRlcnMuQ29sdW1ucy5BZGQoJ1NlcnZpY2VQYWNrJykKICAgICROdWxsID0gJFRhYmxlQWRzQ29tcHV0ZXJzLkNvbHVtbnMuQWRkKCdMYXN0TG9nb24nKQoKICAgIEdldC1OZXRDb21wdXRlciAtRnVsbERhdGEgQFBTQm91bmRQYXJhbWV0ZXJzIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAkQ3VycmVudEhvc3QgPSAkXy5kbnNob3N0bmFtZQogICAgICAgICRDdXJyZW50T3MgPSAkXy5vcGVyYXRpbmdzeXN0ZW0KICAgICAgICAkQ3VycmVudFNwID0gJF8ub3BlcmF0aW5nc3lzdGVtc2VydmljZXBhY2sKICAgICAgICAkQ3VycmVudExhc3QgPSAkXy5sYXN0bG9nb24KICAgICAgICAkQ3VycmVudFVhYyA9ICRfLnVzZXJhY2NvdW50Y29udHJvbAoKICAgICAgICAkQ3VycmVudFVhY0JpbiA9IFtjb252ZXJ0XTo6VG9TdHJpbmcoJF8udXNlcmFjY291bnRjb250cm9sLDIpCgogICAgICAgICMgQ2hlY2sgdGhlIDJuZCB0byBsYXN0IHZhbHVlIHRvIGRldGVybWluZSBpZiBpdHMgZGlzYWJsZWQKICAgICAgICAkRGlzYWJsZU9mZnNldCA9ICRDdXJyZW50VWFjQmluLkxlbmd0aCAtIDIKICAgICAgICAkQ3VycmVudERpc2FibGVkID0gJEN1cnJlbnRVYWNCaW4uU3Vic3RyaW5nKCREaXNhYmxlT2Zmc2V0LDEpCgogICAgICAgICMgQWRkIGNvbXB1dGVyIHRvIGxpc3QgaWYgaXQncyBlbmFibGVkCiAgICAgICAgaWYgKCRDdXJyZW50RGlzYWJsZWQgIC1lcSAwKSB7CiAgICAgICAgICAgICMgQWRkIGRvbWFpbiBjb21wdXRlciB0byBkYXRhIHRhYmxlCiAgICAgICAgICAgICROdWxsID0gJFRhYmxlQWRzQ29tcHV0ZXJzLlJvd3MuQWRkKCRDdXJyZW50SG9zdCwkQ3VycmVudE9TLCRDdXJyZW50U1AsJEN1cnJlbnRMYXN0KQogICAgICAgIH0KICAgIH0KCiAgICAjIFN0YXR1cyB1c2VyICAgICAgICAKICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBMb2FkaW5nIGV4cGxvaXQgbGlzdCBmb3IgY3JpdGljYWwgbWlzc2luZyBwYXRjaGVzLi4uIgoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgIyBTZXR1cCBkYXRhIHRhYmxlIGZvciBsaXN0IG9mIG1zZiBleHBsb2l0cwogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgIyBDcmVhdGUgZGF0YSB0YWJsZSBmb3IgbGlzdCBvZiBwYXRjaGVzIGxldmVscyB3aXRoIGEgTVNGIGV4cGxvaXQKICAgICRUYWJsZUV4cGxvaXRzID0gTmV3LU9iamVjdCBTeXN0ZW0uRGF0YS5EYXRhVGFibGUgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLkNvbHVtbnMuQWRkKCdPcGVyYXRpbmdTeXN0ZW0nKSAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuQ29sdW1ucy5BZGQoJ1NlcnZpY2VQYWNrJykKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuQ29sdW1ucy5BZGQoJ01zZk1vZHVsZScpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuQ29sdW1ucy5BZGQoJ0NWRScpCiAgICAKICAgICMgQWRkIGV4cGxvaXRzIHRvIGRhdGEgdGFibGUKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgNyIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMxMF8wNjFfc3Bvb2xzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMTAtMjcyOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczAzXzAyNl9kY29tIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMzUyLyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA1XzAxN19tc21xIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNS0wMDU5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3MvaWlzL21zMDNfMDA3X250ZGxsX3dlYmRhdiIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDMtMDEwOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL3dpbnMvbXMwNF8wNDVfd2lucyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDQtMTA4MC8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDNfMDI2X2Rjb20iLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTAzNTIvIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA1XzAxN19tc21xIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNS0wMDU5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL2lpcy9tczAzXzAwN19udGRsbF93ZWJkYXYiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTAxMDkiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDRfMDExX2xzYXNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wNTMzLyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy93aW5zL21zMDRfMDQ1X3dpbnMiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA0LTEwODAvIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayAzIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczAzXzAyNl9kY29tIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMzUyLyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2aWNlIFBhY2sgMyIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwNV8wMTdfbXNtcSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDUtMDA1OSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2aWNlIFBhY2sgMyIsImV4cGxvaXQvd2luZG93cy9paXMvbXMwM18wMDdfbnRkbGxfd2ViZGF2IiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMTA5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayAzIiwiZXhwbG9pdC93aW5kb3dzL3dpbnMvbXMwNF8wNDVfd2lucyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDQtMTA4MC8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDQiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDNfMDI2X2Rjb20iLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTAzNTIvIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayA0IiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA1XzAxN19tc21xIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNS0wMDU5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayA0IiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA3XzAyOV9tc2Ruc196b25lbmFtZSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDctMTc0OCIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2aWNlIFBhY2sgNCIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNF8wMTFfbHNhc3MiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTA1MzMvIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayA0IiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA2XzA0MF9uZXRhcGkiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA2LTM0MzkiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDQiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDY2X253YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi00Njg4IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayA0IiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA2XzA3MF93a3NzdmMiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA2LTQ2OTEiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDQiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDhfMDY3X25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDgtNDI1MCIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2aWNlIFBhY2sgNCIsImV4cGxvaXQvd2luZG93cy93aW5zL21zMDRfMDQ1X3dpbnMiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA0LTEwODAvIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIiIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwM18wMjZfZGNvbSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDMtMDM1Mi8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA1XzAxN19tc21xIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNS0wMDU5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIiIsImV4cGxvaXQvd2luZG93cy9paXMvbXMwM18wMDdfbnRkbGxfd2ViZGF2IiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMTA5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNV8wMzlfcG5wIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNS0xOTgzIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIiIsImV4cGxvaXQvd2luZG93cy93aW5zL21zMDRfMDQ1X3dpbnMiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA0LTEwODAvIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDdfMDI5X21zZG5zX3pvbmVuYW1lIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNy0xNzQ4IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDQwX25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDYtMzQzOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA2XzA2Nl9ud2FwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDYtNDY4OCIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA4XzA2N19uZXRhcGkiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA4LTQyNTAiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIiwiU2VydmVyIFBhY2sgMSIsImV4cGxvaXQvd2luZG93cy93aW5zL21zMDRfMDQ1X3dpbnMiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA0LTEwODAvIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA3XzAyOV9tc2Ruc196b25lbmFtZSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDctMTc0OCIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOC00MjUwIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAxMC0yNzI5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyIsIiIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwM18wMjZfZGNvbSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDMtMDM1Mi8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIiwiIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA2XzA0MF9uZXRhcGkiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA2LTM0MzkiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIiwiIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA4XzA2N19uZXRhcGkiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA4LTQyNTAiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIiwiIiwiZXhwbG9pdC93aW5kb3dzL3dpbnMvbXMwNF8wNDVfd2lucyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDQtMTA4MC8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIFIyIiwiIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczAzXzAyNl9kY29tIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMzUyLyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMgUjIiLCIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDRfMDExX2xzYXNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wNTMzLyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMgUjIiLCIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDQwX25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDYtMzQzOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMgUjIiLCIiLCJleHBsb2l0L3dpbmRvd3Mvd2lucy9tczA0XzA0NV93aW5zIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNC0xMDgwLyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDgiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOV8wNTBfc21iMl9uZWdvdGlhdGVfZnVuY19pbmRleCIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDktMzEwMyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDgiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMxMF8wNjFfc3Bvb2xzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMTAtMjcyOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDgiLCIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDhfMDY3X25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDgtNDI1MCIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDgiLCIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDlfMDUwX3NtYjJfbmVnb3RpYXRlX2Z1bmNfaW5kZXgiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA5LTMxMDMiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDA4IiwiIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAxMC0yNzI5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwOCBSMiIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMxMF8wNjFfc3Bvb2xzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMTAtMjcyOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgVmlzdGEiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA4XzA2N19uZXRhcGkiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA4LTQyNTAiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFZpc3RhIiwiU2VydmVyIFBhY2sgMSIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOV8wNTBfc21iMl9uZWdvdGlhdGVfZnVuY19pbmRleCIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDktMzEwMyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgVmlzdGEiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAxMC0yNzI5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBWaXN0YSIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA5XzA1MF9zbWIyX25lZ290aWF0ZV9mdW5jX2luZGV4IiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOS0zMTAzIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBWaXN0YSIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAxMC0yNzI5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBWaXN0YSIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOC00MjUwIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBWaXN0YSIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOV8wNTBfc21iMl9uZWdvdGlhdGVfZnVuY19pbmRleCIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDktMzEwMyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczAzXzAyNl9kY29tIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMzUyLyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA1XzAxN19tc21xIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNS0wMDU5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDRfMDExX2xzYXNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wNTMzLyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA1XzAzOV9wbnAiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA1LTE5ODMiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiU2VydmVyIFBhY2sgMSIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNl8wNDBfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi0zNDM5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA1XzAxN19tc21xIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNS0wMDU5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA2XzA0MF9uZXRhcGkiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA2LTM0MzkiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDY2X253YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi00Njg4IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA2XzA3MF93a3NzdmMiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA2LTQ2OTEiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDhfMDY3X25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDgtNDI1MCIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMxMF8wNjFfc3Bvb2xzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMTAtMjcyOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2aWNlIFBhY2sgMyIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOC00MjUwIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIlNlcnZpY2UgUGFjayAzIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAxMC0yNzI5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIiIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwM18wMjZfZGNvbSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDMtMDM1Mi8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA1XzAxN19tc21xIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNS0wMDU5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNl8wNDBfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi0zNDM5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOC00MjUwIikgIAoKICAgICMgU3RhdHVzIHVzZXIgICAgICAgIAogICAgV3JpdGUtVmVyYm9zZSAiWypdIENoZWNraW5nIGNvbXB1dGVycyBmb3IgdnVsbmVyYWJsZSBPUyBhbmQgU1AgbGV2ZWxzLi4uIgoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgIyBTZXR1cCBkYXRhIHRhYmxlIHRvIHN0b3JlIHZ1bG5lcmFibGUgc3lzdGVtcwogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgIyBDcmVhdGUgZGF0YSB0YWJsZSB0byBob3VzZSB2dWxuZXJhYmxlIHNlcnZlciBsaXN0CiAgICAkVGFibGVWdWxuQ29tcHV0ZXJzID0gTmV3LU9iamVjdCBTeXN0ZW0uRGF0YS5EYXRhVGFibGUgCiAgICAkTnVsbCA9ICRUYWJsZVZ1bG5Db21wdXRlcnMuQ29sdW1ucy5BZGQoJ0NvbXB1dGVyTmFtZScpCiAgICAkTnVsbCA9ICRUYWJsZVZ1bG5Db21wdXRlcnMuQ29sdW1ucy5BZGQoJ09wZXJhdGluZ1N5c3RlbScpCiAgICAkTnVsbCA9ICRUYWJsZVZ1bG5Db21wdXRlcnMuQ29sdW1ucy5BZGQoJ1NlcnZpY2VQYWNrJykKICAgICROdWxsID0gJFRhYmxlVnVsbkNvbXB1dGVycy5Db2x1bW5zLkFkZCgnTGFzdExvZ29uJykKICAgICROdWxsID0gJFRhYmxlVnVsbkNvbXB1dGVycy5Db2x1bW5zLkFkZCgnTXNmTW9kdWxlJykKICAgICROdWxsID0gJFRhYmxlVnVsbkNvbXB1dGVycy5Db2x1bW5zLkFkZCgnQ1ZFJykKCiAgICAjIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIGV4cGxvaXQKICAgICRUYWJsZUV4cGxvaXRzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgIAogICAgICAgICRFeHBsb2l0T1MgPSAkXy5PcGVyYXRpbmdTeXN0ZW0KICAgICAgICAkRXhwbG9pdFNQID0gJF8uU2VydmljZVBhY2sKICAgICAgICAkRXhwbG9pdE1zZiA9ICRfLk1zZk1vZHVsZQogICAgICAgICRFeHBsb2l0Q1ZFID0gJF8uQ1ZFCgogICAgICAgICMgSXRlcmF0ZSB0aHJvdWdoIGVhY2ggQURTIGNvbXB1dGVyCiAgICAgICAgJFRhYmxlQWRzQ29tcHV0ZXJzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAKICAgICAgICAgICAgJEFkc0hvc3RuYW1lID0gJF8uSG9zdG5hbWUKICAgICAgICAgICAgJEFkc09TID0gJF8uT3BlcmF0aW5nU3lzdGVtCiAgICAgICAgICAgICRBZHNTUCA9ICRfLlNlcnZpY2VQYWNrICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgJEFkc0xhc3QgPSAkXy5MYXN0TG9nb24KICAgICAgICAgICAgCiAgICAgICAgICAgICMgQWRkIGV4cGxvaXRhYmxlIHN5c3RlbXMgdG8gdnVsIGNvbXB1dGVycyBkYXRhIHRhYmxlCiAgICAgICAgICAgIGlmICgkQWRzT1MgLWxpa2UgIiRFeHBsb2l0T1MqIiAtYW5kICRBZHNTUCAtbGlrZSAiJEV4cGxvaXRTUCIgKSB7ICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQWRkIGRvbWFpbiBjb21wdXRlciB0byBkYXRhIHRhYmxlICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICROdWxsID0gJFRhYmxlVnVsbkNvbXB1dGVycy5Sb3dzLkFkZCgkQWRzSG9zdG5hbWUsJEFkc09TLCRBZHNTUCwkQWRzTGFzdCwkRXhwbG9pdE1zZiwkRXhwbG9pdENWRSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgIyBEaXNwbGF5IHJlc3VsdHMKICAgICRWdWxuQ29tcHV0ZXIgPSAkVGFibGVWdWxuQ29tcHV0ZXJzIHwgU2VsZWN0LU9iamVjdCBDb21wdXRlck5hbWUgLVVuaXF1ZSB8IE1lYXN1cmUtT2JqZWN0CiAgICAkVnVsbkNvbXB1dGVyQ291bnQgPSAkVnVsbkNvbXB1dGVyLkNvdW50CgogICAgaWYgKCRWdWxuQ29tcHV0ZXIuQ291bnQgLWd0IDApIHsKICAgICAgICAjIFJldHVybiB2dWxuZXJhYmxlIHNlcnZlciBsaXN0IG9yZGVyIHdpdGggc29tZSBoYWNrIGRhdGUgY2FzdGluZwogICAgICAgIFdyaXRlLVZlcmJvc2UgIlsrXSBGb3VuZCAkVnVsbkNvbXB1dGVyQ291bnQgcG90ZW50aWFsbHkgdnVsbmVyYWJsZSBzeXN0ZW1zISIKICAgICAgICAkVGFibGVWdWxuQ29tcHV0ZXJzIHwgU29ydC1PYmplY3QgeyAkXy5sYXN0bG9nb24gLWFzIFtkYXRldGltZV19IC1EZXNjZW5kaW5nCiAgICB9CiAgICBlbHNlIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJbLV0gTm8gdnVsbmVyYWJsZSBzeXN0ZW1zIHdlcmUgZm91bmQuIgogICAgfQp9CgoKZnVuY3Rpb24gSW52b2tlLUVudW1lcmF0ZUxvY2FsQWRtaW4gewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFRoaXMgZnVuY3Rpb24gcXVlcmllcyB0aGUgZG9tYWluIGZvciBhbGwgYWN0aXZlIG1hY2hpbmVzIHdpdGgKICAgICAgICBHZXQtTmV0Q29tcHV0ZXIsIHRoZW4gZm9yIGVhY2ggc2VydmVyIGl0IHF1ZXJpZXMgdGhlIGxvY2FsCiAgICAgICAgQWRtaW5pc3RyYXRvcnMgd2l0aCBHZXQtTmV0TG9jYWxHcm91cC4KCiAgICAgICAgQXV0aG9yOiBAaGFybWoweQogICAgICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIEhvc3QgYXJyYXkgdG8gZW51bWVyYXRlLCBwYXNzYWJsZSBvbiB0aGUgcGlwZWxpbmUuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckZpbGUKCiAgICAgICAgRmlsZSBvZiBob3N0bmFtZXMvSVBzIHRvIHNlYXJjaC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsdGVyCgogICAgICAgIEhvc3QgZmlsdGVyIG5hbWUgdG8gcXVlcnkgQUQgZm9yLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoIGZvciBob3N0cywgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIE5vUGluZwoKICAgICAgICBTd2l0Y2guIERvbid0IHBpbmcgZWFjaCBob3N0IHRvIGVuc3VyZSBpdCdzIHVwIGJlZm9yZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIERlbGF5CgogICAgICAgIERlbGF5IGJldHdlZW4gZW51bWVyYXRpbmcgaG9zdHMsIGRlZmF1bHRzIHRvIDAKCiAgICAuUEFSQU1FVEVSIEppdHRlcgoKICAgICAgICBKaXR0ZXIgZm9yIHRoZSBob3N0IGRlbGF5LCBkZWZhdWx0cyB0byArLy0gMC4zCgogICAgLlBBUkFNRVRFUiBPdXRGaWxlCgogICAgICAgIE91dHB1dCByZXN1bHRzIHRvIGEgc3BlY2lmaWVkIGNzdiBvdXRwdXQgZmlsZS4KCiAgICAuUEFSQU1FVEVSIE5vQ2xvYmJlcgoKICAgICAgICBTd2l0Y2guIERvbid0IG92ZXJ3cml0ZSBhbnkgZXhpc3Rpbmcgb3V0cHV0IGZpbGUuCgogICAgLlBBUkFNRVRFUiBUcnVzdEdyb3VwcwoKICAgICAgICBTd2l0Y2guIE9ubHkgcmV0dXJuIHJlc3VsdHMgdGhhdCBhcmUgbm90IHBhcnQgb2YgdGhlIGxvY2FsIG1hY2hpbmUKICAgICAgICBvciB0aGUgbWFjaGluZSdzIGRvbWFpbi4gT2xkIEludm9rZS1FbnVtZXJhdGVMb2NhbFRydXN0R3JvdXAKICAgICAgICBmdW5jdGlvbmFsaXR5LgogICAgCiAgICAuUEFSQU1FVEVSIERvbWFpbk9ubHkKCiAgICAgICAgU3dpdGNoLiBPbmx5IHJldHVybiBkb21haW4gKG5vbi1sb2NhbCkgcmVzdWx0cyAgCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIHRvIHF1ZXJ5IGZvciBtYWNoaW5lcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgogICAgCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaEZvcmVzdAoKICAgICAgICBTd2l0Y2guIFNlYXJjaCBhbGwgZG9tYWlucyBpbiB0aGUgZm9yZXN0IGZvciB0YXJnZXQgdXNlcnMgaW5zdGVhZCBvZiBqdXN0CiAgICAgICAgYSBzaW5nbGUgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgQVBJCgogICAgICAgIFN3aXRjaC4gVXNlIEFQSSBjYWxscyBpbnN0ZWFkIG9mIHRoZSBXaW5OVCBzZXJ2aWNlIHByb3ZpZGVyLiBMZXNzIGluZm9ybWF0aW9uLAogICAgICAgIGJ1dCB0aGUgcmVzdWx0cyBhcmUgZmFzdGVyLgoKICAgIC5QQVJBTUVURVIgVGhyZWFkcwoKICAgICAgICBUaGUgbWF4aW11bSBjb25jdXJyZW50IHRocmVhZHMgdG8gZXhlY3V0ZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1FbnVtZXJhdGVMb2NhbEFkbWluCgogICAgICAgIEVudW1lcmF0ZXMgdGhlIG1lbWJlcnMgb2YgbG9jYWwgYWRtaW5pc3RyYXRvcnMgZm9yIGFsbCBtYWNoaW5lcwogICAgICAgIGluIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1FbnVtZXJhdGVMb2NhbEFkbWluIC1UaHJlYWRzIDEwCgogICAgICAgIFRocmVhZGVkIGxvY2FsIGFkbWluIGVudW1lcmF0aW9uLCByZXBsYWNlcyBJbnZva2UtRW51bWVyYXRlTG9jYWxBZG1pblRocmVhZGVkCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL2Jsb2cuaGFybWoweS5uZXQvCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0cycpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkQ29tcHV0ZXJOYW1lLAoKICAgICAgICBbVmFsaWRhdGVTY3JpcHQoe1Rlc3QtUGF0aCAtUGF0aCAkXyB9KV0KICAgICAgICBbQWxpYXMoJ0hvc3RMaXN0JyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWxlLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJBRFNwYXRoLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICROb1BpbmcsCgogICAgICAgIFtVSW50MzJdCiAgICAgICAgJERlbGF5ID0gMCwKCiAgICAgICAgW0RvdWJsZV0KICAgICAgICAkSml0dGVyID0gLjMsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE91dEZpbGUsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJE5vQ2xvYmJlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVHJ1c3RHcm91cHMsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJERvbWFpbk9ubHksCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2VhcmNoRm9yZXN0LAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFRocmVhZHMsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEFQSQogICAgKQoKICAgIGJlZ2luIHsKICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydEZWJ1ZyddKSB7CiAgICAgICAgICAgICREZWJ1Z1ByZWZlcmVuY2UgPSAnQ29udGludWUnCiAgICAgICAgfQoKICAgICAgICAjIHJhbmRvbSBvYmplY3QgZm9yIGRlbGF5CiAgICAgICAgJFJhbmRObyA9IE5ldy1PYmplY3QgU3lzdGVtLlJhbmRvbQoKICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUnVubmluZyBJbnZva2UtRW51bWVyYXRlTG9jYWxBZG1pbiB3aXRoIGRlbGF5IG9mICREZWxheSIKCiAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyBhIGhvc3QgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgaWYoJENvbXB1dGVyRmlsZSkgewogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gR2V0LUNvbnRlbnQgLVBhdGggJENvbXB1dGVyRmlsZQogICAgICAgIH0KCiAgICAgICAgaWYoISRDb21wdXRlck5hbWUpIHsgCiAgICAgICAgICAgIFthcnJheV0kQ29tcHV0ZXJOYW1lID0gQCgpCgogICAgICAgICAgICBpZigkRG9tYWluKSB7CiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoJERvbWFpbikKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoJFNlYXJjaEZvcmVzdCkgewogICAgICAgICAgICAgICAgIyBnZXQgQUxMIHRoZSBkb21haW5zIGluIHRoZSBmb3Jlc3QgdG8gc2VhcmNoCiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEdldC1OZXRGb3Jlc3REb21haW4gfCBGb3JFYWNoLU9iamVjdCB7ICRfLk5hbWUgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgIyB1c2UgdGhlIGxvY2FsIGRvbWFpbgogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCAoR2V0LU5ldERvbWFpbikubmFtZSApCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEZvckVhY2ggKCREb21haW4gaW4gJFRhcmdldERvbWFpbnMpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBRdWVyeWluZyBkb21haW4gJERvbWFpbiBmb3IgaG9zdHMiCiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lICs9IEdldC1OZXRDb21wdXRlciAtRmlsdGVyICRDb21wdXRlckZpbHRlciAtQURTcGF0aCAkQ29tcHV0ZXJBRFNwYXRoIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIHJlbW92ZSBhbnkgbnVsbCB0YXJnZXQgaG9zdHMsIHVuaXF1aWZ5IHRoZSBsaXN0IGFuZCBzaHVmZmxlIGl0CiAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHsgJF8gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgfCBTb3J0LU9iamVjdCB7IEdldC1SYW5kb20gfQogICAgICAgICAgICBpZigkKCRDb21wdXRlck5hbWUuQ291bnQpIC1lcSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiTm8gaG9zdHMgZm91bmQhIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGRlbGV0ZSBhbnkgZXhpc3Rpbmcgb3V0cHV0IGZpbGUgaWYgaXQgYWxyZWFkeSBleGlzdHMKICAgICAgICBpZighJE5vQ2xvYmJlcikgewogICAgICAgICAgICBpZiAoJE91dEZpbGUgLWFuZCAoVGVzdC1QYXRoIC1QYXRoICRPdXRGaWxlKSkgeyBSZW1vdmUtSXRlbSAtUGF0aCAkT3V0RmlsZSB9CiAgICAgICAgfQoKICAgICAgICBpZigkVHJ1c3RHcm91cHMpIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkRldGVybWluaW5nIGRvbWFpbiB0cnVzdCBncm91cHMiCgogICAgICAgICAgICAjIGZpbmQgYWxsIGdyb3VwIG5hbWVzIHRoYXQgaGF2ZSBvbmUgb3IgbW9yZSB1c2VycyBpbiBhbm90aGVyIGRvbWFpbgogICAgICAgICAgICAkVHJ1c3RHcm91cE5hbWVzID0gRmluZC1Gb3JlaWduR3JvdXAgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5Hcm91cE5hbWUgfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUKCiAgICAgICAgICAgICRUcnVzdEdyb3Vwc1NJRHMgPSAkVHJ1c3RHcm91cE5hbWVzIHwgRm9yRWFjaC1PYmplY3QgeyAKICAgICAgICAgICAgICAgICMgaWdub3JlIHRoZSBidWlsdGluIGFkbWluaXN0cmF0b3JzIGdyb3VwIGZvciBhIERDIChTLTEtNS0zMi01NDQpCiAgICAgICAgICAgICAgICAjIFRPRE86IGlnbm9yZSBhbGwgZGVmYXVsdCBidWlsdCBpbiBzaWRzPwogICAgICAgICAgICAgICAgR2V0LU5ldEdyb3VwIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtR3JvdXBOYW1lICRfIC1GdWxsRGF0YSB8IFdoZXJlLU9iamVjdCB7ICRfLm9iamVjdHNpZCAtbm90bWF0Y2ggIlMtMS01LTMyLTU0NCIgfSB8IEZvckVhY2gtT2JqZWN0IHsgJF8ub2JqZWN0c2lkIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBxdWVyeSBmb3IgdGhlIHByaW1hcnkgZG9tYWluIGNvbnRyb2xsZXIgc28gd2UgY2FuIGV4dHJhY3QgdGhlIGRvbWFpbiBTSUQgZm9yIGZpbHRlcmluZwogICAgICAgICAgICAkRG9tYWluU0lEID0gR2V0LURvbWFpblNJRCAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICB9CgogICAgICAgICMgc2NyaXB0IGJsb2NrIHRoYXQgZW51bWVyYXRlcyBhIHNlcnZlcgogICAgICAgICRIb3N0RW51bUJsb2NrID0gewogICAgICAgICAgICBwYXJhbSgkQ29tcHV0ZXJOYW1lLCAkUGluZywgJE91dEZpbGUsICREb21haW5TSUQsICRUcnVzdEdyb3Vwc1NJRHMsICRBUEksICREb21haW5Pbmx5KQoKICAgICAgICAgICAgIyBvcHRpb25hbGx5IGNoZWNrIGlmIHRoZSBzZXJ2ZXIgaXMgdXAgZmlyc3QKICAgICAgICAgICAgJFVwID0gJFRydWUKICAgICAgICAgICAgaWYoJFBpbmcpIHsKICAgICAgICAgICAgICAgICRVcCA9IFRlc3QtQ29ubmVjdGlvbiAtQ291bnQgMSAtUXVpZXQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJFVwKSB7CiAgICAgICAgICAgICAgICAjIGdyYWIgdGhlIHVzZXJzIGZvciB0aGUgbG9jYWwgYWRtaW5zIG9uIHRoaXMgc2VydmVyCiAgICAgICAgICAgICAgICBpZigkQVBJKSB7CiAgICAgICAgICAgICAgICAgICAgJExvY2FsQWRtaW5zID0gR2V0LU5ldExvY2FsR3JvdXAgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1BUEkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRMb2NhbEFkbWlucyA9IEdldC1OZXRMb2NhbEdyb3VwIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgaWYgd2UganVzdCB3YW50IHRvIHJldHVybiBjcm9zcy10cnVzdCB1c2VycwogICAgICAgICAgICAgICAgaWYoJERvbWFpblNJRCkgewogICAgICAgICAgICAgICAgICAgICMgZ2V0IHRoZSBsb2NhbCBtYWNoaW5lIFNJRAogICAgICAgICAgICAgICAgICAgICRMb2NhbFNJRCA9ICgkTG9jYWxBZG1pbnMgfCBXaGVyZS1PYmplY3QgeyAkXy5TSUQgLW1hdGNoICcuKi01MDAkJyB9KS5TSUQgLXJlcGxhY2UgIi01MDAkIgogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkxvY2FsU2lkIGZvciAkQ29tcHV0ZXJOYW1lIDogJExvY2FsU0lEIgogICAgICAgICAgICAgICAgICAgICMgZmlsdGVyIG91dCBhY2NvdW50cyB0aGF0IGJlZ2luIHdpdGggdGhlIG1hY2hpbmUgU0lEIGFuZCBkb21haW4gU0lECiAgICAgICAgICAgICAgICAgICAgIyAgIGJ1dCBwcmVzZXJ2ZSBhbnkgZ3JvdXBzIHRoYXQgaGF2ZSB1c2VycyBhY3Jvc3MgYSB0cnVzdCAoJFRydXN0R3JvdXBTSURTKQogICAgICAgICAgICAgICAgICAgICRMb2NhbEFkbWlucyA9ICRMb2NhbEFkbWlucyB8IFdoZXJlLU9iamVjdCB7ICgkVHJ1c3RHcm91cHNTSURzIC1jb250YWlucyAkXy5TSUQpIC1vciAoKC1ub3QgJF8uU0lELnN0YXJ0c1dpdGgoJExvY2FsU0lEKSkgLWFuZCAoLW5vdCAkXy5TSUQuc3RhcnRzV2l0aCgkRG9tYWluU0lEKSkpIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigkRG9tYWluT25seSkgewogICAgICAgICAgICAgICAgICAgICRMb2NhbEFkbWlucyA9ICRMb2NhbEFkbWlucyB8IFdoZXJlLU9iamVjdCB7JF8uSXNEb21haW59CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoJExvY2FsQWRtaW5zIC1hbmQgKCRMb2NhbEFkbWlucy5MZW5ndGggLW5lIDApKSB7CiAgICAgICAgICAgICAgICAgICAgIyBvdXRwdXQgdGhlIHJlc3VsdHMgdG8gYSBjc3YgaWYgc3BlY2lmaWVkCiAgICAgICAgICAgICAgICAgICAgaWYoJE91dEZpbGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsQWRtaW5zIHwgRXhwb3J0LVBvd2VyVmlld0NTViAtT3V0RmlsZSAkT3V0RmlsZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBvdGhlcndpc2UgcmV0dXJuIHRoZSB1c2VyIG9iamVjdHMKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsQWRtaW5zCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWyFdIE5vIHVzZXJzIHJldHVybmVkIGZyb20gJENvbXB1dGVyTmFtZSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgaWYoJFRocmVhZHMpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVXNpbmcgdGhyZWFkaW5nIHdpdGggdGhyZWFkcyA9ICRUaHJlYWRzIgoKICAgICAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyB0aHJlYWRpbmcsIGtpY2sgb2ZmIHRoZSBzY3JpcHQgYmxvY2sgd2l0aCBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbgogICAgICAgICAgICAkU2NyaXB0UGFyYW1zID0gQHsKICAgICAgICAgICAgICAgICdQaW5nJyA9ICQoLW5vdCAkTm9QaW5nKQogICAgICAgICAgICAgICAgJ091dEZpbGUnID0gJE91dEZpbGUKICAgICAgICAgICAgICAgICdEb21haW5TSUQnID0gJERvbWFpblNJRAogICAgICAgICAgICAgICAgJ1RydXN0R3JvdXBzU0lEcycgPSAkVHJ1c3RHcm91cHNTSURzCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMga2ljayBvZmYgdGhlIHRocmVhZGVkIHNjcmlwdCBibG9jayArIGFyZ3VtZW50cwogICAgICAgICAgICBpZigkQVBJKSB7CiAgICAgICAgICAgICAgICAkU2NyaXB0UGFyYW1zWydBUEknXSA9ICRUcnVlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCREb21haW5Pbmx5KSB7CiAgICAgICAgICAgICAgICAkU2NyaXB0UGFyYW1zWydEb21haW5Pbmx5J10gPSAkVHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgIAogICAgICAgICAgICBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1TY3JpcHRQYXJhbWV0ZXJzICRTY3JpcHRQYXJhbXMgLVRocmVhZHMgJFRocmVhZHMKICAgICAgICB9CgogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZigtbm90ICROb1BpbmcgLWFuZCAoJENvbXB1dGVyTmFtZS5jb3VudCAtbmUgMSkpIHsKICAgICAgICAgICAgICAgICMgcGluZyBhbGwgaG9zdHMgaW4gcGFyYWxsZWwKICAgICAgICAgICAgICAgICRQaW5nID0ge3BhcmFtKCRDb21wdXRlck5hbWUpIGlmKFRlc3QtQ29ubmVjdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLUNvdW50IDEgLVF1aWV0IC1FcnJvckFjdGlvbiBTdG9wKXskQ29tcHV0ZXJOYW1lfX0KICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtTm9JbXBvcnRzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtU2NyaXB0QmxvY2sgJFBpbmcgLVRocmVhZHMgMTAwCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBUb3RhbCBudW1iZXIgb2YgYWN0aXZlIGhvc3RzOiAkKCRDb21wdXRlck5hbWUuY291bnQpIgogICAgICAgICAgICAkQ291bnRlciA9IDAKCiAgICAgICAgICAgIEZvckVhY2ggKCRDb21wdXRlciBpbiAkQ29tcHV0ZXJOYW1lKSB7CgogICAgICAgICAgICAgICAgJENvdW50ZXIgPSAkQ291bnRlciArIDEKCiAgICAgICAgICAgICAgICAjIHNsZWVwIGZvciBvdXIgc2VtaS1yYW5kb21pemVkIGludGVydmFsCiAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAtU2Vjb25kcyAkUmFuZE5vLk5leHQoKDEtJEppdHRlcikqJERlbGF5LCAoMSskSml0dGVyKSokRGVsYXkpCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gRW51bWVyYXRpbmcgc2VydmVyICRDb21wdXRlciAoJENvdW50ZXIgb2YgJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSkiCgogICAgICAgICAgICAgICAgJFNjcmlwdEFyZ3MgPSBAKCRDb21wdXRlciwgJEZhbHNlLCAkT3V0RmlsZSwgJERvbWFpblNJRCwgJFRydXN0R3JvdXBzU0lEcywgJEFQSSwgJERvbWFpbk9ubHkpCgogICAgICAgICAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1Bcmd1bWVudExpc3QgJFNjcmlwdEFyZ3MKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMKIyBEb21haW4gdHJ1c3QgZnVuY3Rpb25zIGJlbG93LgojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpmdW5jdGlvbiBHZXQtTmV0RG9tYWluVHJ1c3Qgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFJldHVybiBhbGwgZG9tYWluIHRydXN0cyBmb3IgdGhlIGN1cnJlbnQgZG9tYWluIG9yCiAgICAgICAgYSBzcGVjaWZpZWQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gd2hvc2UgdHJ1c3RzIHRvIGVudW1lcmF0ZSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9EQz10ZXN0bGFiLERDPWxvY2FsIi4KICAgICAgICBVc2VmdWwgZm9yIGdsb2JhbCBjYXRhbG9nIHF1ZXJpZXMgOykKCiAgICAuUEFSQU1FVEVSIEFQSQoKICAgICAgICBVc2UgYW4gQVBJIGNhbGwgKERzRW51bWVyYXRlRG9tYWluVHJ1c3RzKSB0byBlbnVtZXJhdGUgdGhlIHRydXN0cy4KCiAgICAuUEFSQU1FVEVSIExEQVAKCiAgICAgICAgU3dpdGNoLiBVc2UgTERBUCBxdWVyaWVzIHRvIGVudW1lcmF0ZSB0aGUgdHJ1c3RzIGluc3RlYWQgb2YgZGlyZWN0IGRvbWFpbiBjb25uZWN0aW9ucy4gCiAgICAgICAgTW9yZSBsaWtlbHkgdG8gZ2V0IGFyb3VuZCBuZXR3b3JrIHNlZ21lbnRhdGlvbiwgYnV0IG5vdCBhcyBhY2N1cmF0ZS4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXREb21haW5UcnVzdAoKICAgICAgICBSZXR1cm4gZG9tYWluIHRydXN0cyBmb3IgdGhlIGN1cnJlbnQgZG9tYWluIHVzaW5nIGJ1aWx0IGluIC5ORVQgbWV0aG9kcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXREb21haW5UcnVzdCAtRG9tYWluICJwcm9kLnRlc3RsYWIubG9jYWwiCgogICAgICAgIFJldHVybiBkb21haW4gdHJ1c3RzIGZvciB0aGUgInByb2QudGVzdGxhYi5sb2NhbCIgZG9tYWluIHVzaW5nIC5ORVQgbWV0aG9kcwoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldERvbWFpblRydXN0IC1MREFQIC1Eb21haW4gInByb2QudGVzdGxhYi5sb2NhbCIgLURvbWFpbkNvbnRyb2xsZXIgIlBSSU1BUlkudGVzdGxhYi5sb2NhbCIKCiAgICAgICAgUmV0dXJuIGRvbWFpbiB0cnVzdHMgZm9yIHRoZSAicHJvZC50ZXN0bGFiLmxvY2FsIiBkb21haW4gZW51bWVyYXRlZCB0aHJvdWdoIExEQVAKICAgICAgICBxdWVyaWVzLCByZWZsZWN0aW5nIHF1ZXJpZXMgdGhyb3VnaCB0aGUgIlByaW1hcnkudGVzdGxhYi5sb2NhbCIgZG9tYWluIGNvbnRyb2xsZXIsCiAgICAgICAgdXNpbmcgLk5FVCBtZXRob2RzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldERvbWFpblRydXN0IC1BUEkgLURvbWFpbiAicHJvZC50ZXN0bGFiLmxvY2FsIgoKICAgICAgICBSZXR1cm4gZG9tYWluIHRydXN0cyBmb3IgdGhlICJwcm9kLnRlc3RsYWIubG9jYWwiIGRvbWFpbiBlbnVtZXJhdGVkIHRocm91Z2ggQVBJIGNhbGxzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldERvbWFpblRydXN0IC1BUEkgLURvbWFpbkNvbnRyb2xsZXIgV0lORE9XUzIudGVzdGxhYi5sb2NhbAoKICAgICAgICBSZXR1cm4gZG9tYWluIHRydXN0cyByZWFjaGFibGUgZnJvbSB0aGUgV0lORE9XUzIgbWFjaGluZSB0aHJvdWdoIEFQSSBjYWxscy4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRBUEksCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJExEQVAsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBwcm9jZXNzIHsKCiAgICAgICAgaWYoLW5vdCAkRG9tYWluKSB7CiAgICAgICAgICAgICMgaWYgbm90IGRvbWFpbiBpcyBzcGVjaWZpZWQgZ3JhYiB0aGUgY3VycmVudCBkb21haW4KICAgICAgICAgICAgJFNvdXJjZURvbWFpbiA9IChHZXQtTmV0RG9tYWluIC1DcmVkZW50aWFsICRDcmVkZW50aWFsKS5OYW1lCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkU291cmNlRG9tYWluID0gJERvbWFpbgogICAgICAgIH0KCiAgICAgICAgaWYoJExEQVAgLW9yICRBRFNQYXRoKSB7CgogICAgICAgICAgICAkVHJ1c3RTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICRTb3VyY2VEb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLVBhZ2VTaXplICRQYWdlU2l6ZSAtQURTcGF0aCAkQURTcGF0aAoKICAgICAgICAgICAgJFNvdXJjZVNJRCA9IEdldC1Eb21haW5TSUQgLURvbWFpbiAkU291cmNlRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyCgogICAgICAgICAgICBpZigkVHJ1c3RTZWFyY2hlcikgewoKICAgICAgICAgICAgICAgICRUcnVzdFNlYXJjaGVyLmZpbHRlciA9ICcoJihvYmplY3RDbGFzcz10cnVzdGVkRG9tYWluKSknCgogICAgICAgICAgICAgICAgJFJlc3VsdHMgPSAkVHJ1c3RTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgJFByb3BzID0gJF8uUHJvcGVydGllcwogICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAkVHJ1c3RBdHRyaWIgPSBTd2l0Y2ggKCRQcm9wcy50cnVzdGF0dHJpYnV0ZXMpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAweDAwMSB7ICJub25fdHJhbnNpdGl2ZSIgfQogICAgICAgICAgICAgICAgICAgICAgICAweDAwMiB7ICJ1cGxldmVsX29ubHkiIH0KICAgICAgICAgICAgICAgICAgICAgICAgMHgwMDQgeyAicXVhcmFudGluZWRfZG9tYWluIiB9CiAgICAgICAgICAgICAgICAgICAgICAgIDB4MDA4IHsgImZvcmVzdF90cmFuc2l0aXZlIiB9CiAgICAgICAgICAgICAgICAgICAgICAgIDB4MDEwIHsgImNyb3NzX29yZ2FuaXphdGlvbiIgfQogICAgICAgICAgICAgICAgICAgICAgICAweDAyMCB7ICJ3aXRoaW5fZm9yZXN0IiB9CiAgICAgICAgICAgICAgICAgICAgICAgIDB4MDQwIHsgInRyZWF0X2FzX2V4dGVybmFsIiB9CiAgICAgICAgICAgICAgICAgICAgICAgIDB4MDgwIHsgInRydXN0X3VzZXNfcmM0X2VuY3J5cHRpb24iIH0KICAgICAgICAgICAgICAgICAgICAgICAgMHgxMDAgeyAidHJ1c3RfdXNlc19hZXNfa2V5cyIgfQogICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IHsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJVbmtub3duIHRydXN0IGF0dHJpYnV0ZTogJCgkUHJvcHMudHJ1c3RhdHRyaWJ1dGVzKSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJCgkUHJvcHMudHJ1c3RhdHRyaWJ1dGVzKSI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJERpcmVjdGlvbiA9IFN3aXRjaCAoJFByb3BzLnRydXN0ZGlyZWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIDAgeyAiRGlzYWJsZWQiIH0KICAgICAgICAgICAgICAgICAgICAgICAgMSB7ICJJbmJvdW5kIiB9CiAgICAgICAgICAgICAgICAgICAgICAgIDIgeyAiT3V0Ym91bmQiIH0KICAgICAgICAgICAgICAgICAgICAgICAgMyB7ICJCaWRpcmVjdGlvbmFsIiB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRPYmplY3RHdWlkID0gTmV3LU9iamVjdCBHdWlkIEAoLCRQcm9wcy5vYmplY3RndWlkWzBdKQogICAgICAgICAgICAgICAgICAgICRUYXJnZXRTSUQgPSAoTmV3LU9iamVjdCBTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcigkUHJvcHMuc2VjdXJpdHlpZGVudGlmaWVyWzBdLDApKS5WYWx1ZQogICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTb3VyY2VOYW1lJyAkU291cmNlRG9tYWluCiAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NvdXJjZVNJRCcgJFNvdXJjZVNJRAogICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUYXJnZXROYW1lJyAkUHJvcHMubmFtZVswXQogICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUYXJnZXRTSUQnICRUYXJnZXRTSUQKICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnT2JqZWN0R3VpZCcgInskT2JqZWN0R3VpZH0iCiAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RydXN0VHlwZScgIiRUcnVzdEF0dHJpYiIKICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVHJ1c3REaXJlY3Rpb24nICIkRGlyZWN0aW9uIgogICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICAgICAkVHJ1c3RTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYoJEFQSSkgewogICAgICAgICAgICBpZigtbm90ICREb21haW5Db250cm9sbGVyKSB7CiAgICAgICAgICAgICAgICAkRG9tYWluQ29udHJvbGxlciA9IEdldC1OZXREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1Eb21haW4gJFNvdXJjZURvbWFpbiB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBOYW1lCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCREb21haW5Db250cm9sbGVyKSB7CiAgICAgICAgICAgICAgICAjIGFyZ3VtZW50cyBmb3IgRHNFbnVtZXJhdGVEb21haW5UcnVzdHMKICAgICAgICAgICAgICAgICRQdHJJbmZvID0gW0ludFB0cl06Olplcm8KCiAgICAgICAgICAgICAgICAjIDYzID0gRFNfRE9NQUlOX0lOX0ZPUkVTVCArIERTX0RPTUFJTl9ESVJFQ1RfT1VUQk9VTkQgKyBEU19ET01BSU5fVFJFRV9ST09UICsgRFNfRE9NQUlOX1BSSU1BUlkgKyBEU19ET01BSU5fTkFUSVZFX01PREUgKyBEU19ET01BSU5fRElSRUNUX0lOQk9VTkQKICAgICAgICAgICAgICAgICRGbGFncyA9IDYzCiAgICAgICAgICAgICAgICAkRG9tYWluQ291bnQgPSAwCgogICAgICAgICAgICAgICAgIyBnZXQgdGhlIHRydXN0IGluZm9ybWF0aW9uIGZyb20gdGhlIHRhcmdldCBzZXJ2ZXIKICAgICAgICAgICAgICAgICRSZXN1bHQgPSAkTmV0YXBpMzI6OkRzRW51bWVyYXRlRG9tYWluVHJ1c3RzKCREb21haW5Db250cm9sbGVyLCAkRmxhZ3MsIFtyZWZdJFB0ckluZm8sIFtyZWZdJERvbWFpbkNvdW50KQoKICAgICAgICAgICAgICAgICMgTG9jYXRlIHRoZSBvZmZzZXQgb2YgdGhlIGluaXRpYWwgaW50UHRyCiAgICAgICAgICAgICAgICAkT2Zmc2V0ID0gJFB0ckluZm8uVG9JbnQ2NCgpCgogICAgICAgICAgICAgICAgIyAwID0gc3VjY2VzcwogICAgICAgICAgICAgICAgaWYgKCgkUmVzdWx0IC1lcSAwKSAtYW5kICgkT2Zmc2V0IC1ndCAwKSkgewoKICAgICAgICAgICAgICAgICAgICAjIFdvcmsgb3V0IGhvdyBtdXRjaCB0byBpbmNyZW1lbnQgdGhlIHBvaW50ZXIgYnkgZmluZGluZyBvdXQgdGhlIHNpemUgb2YgdGhlIHN0cnVjdHVyZQogICAgICAgICAgICAgICAgICAgICRJbmNyZW1lbnQgPSAkRFNfRE9NQUlOX1RSVVNUUzo6R2V0U2l6ZSgpCgogICAgICAgICAgICAgICAgICAgICMgcGFyc2UgYWxsIHRoZSByZXN1bHQgc3RydWN0dXJlcwogICAgICAgICAgICAgICAgICAgIGZvciAoJGkgPSAwOyAoJGkgLWx0ICREb21haW5Db3VudCk7ICRpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBjcmVhdGUgYSBuZXcgaW50IHB0ciBhdCB0aGUgZ2l2ZW4gb2Zmc2V0IGFuZCBjYXN0IHRoZSBwb2ludGVyIGFzIG91ciByZXN1bHQgc3RydWN0dXJlCiAgICAgICAgICAgICAgICAgICAgICAgICROZXdJbnRQdHIgPSBOZXctT2JqZWN0IFN5c3RlbS5JbnRwdHIgLUFyZ3VtZW50TGlzdCAkT2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICRJbmZvID0gJE5ld0ludFB0ciAtYXMgJERTX0RPTUFJTl9UUlVTVFMKCiAgICAgICAgICAgICAgICAgICAgICAgICRPZmZzZXQgPSAkTmV3SW50UHRyLlRvSW50NjQoKQogICAgICAgICAgICAgICAgICAgICAgICAkT2Zmc2V0ICs9ICRJbmNyZW1lbnQKCiAgICAgICAgICAgICAgICAgICAgICAgICRTaWRTdHJpbmcgPSAiIgogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0ID0gJEFkdmFwaTMyOjpDb252ZXJ0U2lkVG9TdHJpbmdTaWQoJEluZm8uRG9tYWluU2lkLCBbcmVmXSRTaWRTdHJpbmcpOyRMYXN0RXJyb3IgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkdldExhc3RXaW4zMkVycm9yKCkKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRSZXN1bHQgLWVxIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yOiAkKChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpLk1lc3NhZ2UpIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0ID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NvdXJjZURvbWFpbicgJFNvdXJjZURvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NvdXJjZURvbWFpbkNvbnRyb2xsZXInICREb21haW5Db250cm9sbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTmV0Ymlvc0RvbWFpbk5hbWUnICRJbmZvLk5ldGJpb3NEb21haW5OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRG5zRG9tYWluTmFtZScgJEluZm8uRG5zRG9tYWluTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0ZsYWdzJyAkSW5mby5GbGFncwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1BhcmVudEluZGV4JyAkSW5mby5QYXJlbnRJbmRleAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RydXN0VHlwZScgJEluZm8uVHJ1c3RUeXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVHJ1c3RBdHRyaWJ1dGVzJyAkSW5mby5UcnVzdEF0dHJpYnV0ZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEb21haW5TaWQnICRTaWRTdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEb21haW5HdWlkJyAkSW5mby5Eb21haW5HdWlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LkFQSURvbWFpblRydXN0JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICMgZnJlZSB1cCB0aGUgcmVzdWx0IGJ1ZmZlcgogICAgICAgICAgICAgICAgICAgICROdWxsID0gJE5ldGFwaTMyOjpOZXRBcGlCdWZmZXJGcmVlKCRQdHJJbmZvKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3I6ICQoKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJFJlc3VsdCkuTWVzc2FnZSkiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBXcml0ZS1FcnJvciAiQ291bGQgbm90IHJldHJpZXZlIGRvbWFpbiBjb250cm9sbGVyIGZvciAkRG9tYWluIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAjIGlmIHdlJ3JlIHVzaW5nIGRpcmVjdCBkb21haW4gY29ubmVjdGlvbnMgdGhyb3VnaCAuTkVUCiAgICAgICAgICAgICRGb3VuZERvbWFpbiA9IEdldC1OZXREb21haW4gLURvbWFpbiAkRG9tYWluIC1DcmVkZW50aWFsICRDcmVkZW50aWFsCiAgICAgICAgICAgIGlmKCRGb3VuZERvbWFpbikgewogICAgICAgICAgICAgICAgJEZvdW5kRG9tYWluLkdldEFsbFRydXN0UmVsYXRpb25zaGlwcygpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtTmV0Rm9yZXN0VHJ1c3Qgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFJldHVybiBhbGwgdHJ1c3RzIGZvciB0aGUgY3VycmVudCBmb3Jlc3QuCgogICAgLlBBUkFNRVRFUiBGb3Jlc3QKCiAgICAgICAgUmV0dXJuIHRydXN0cyBmb3IgdGhlIHNwZWNpZmllZCBmb3Jlc3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRGb3Jlc3RUcnVzdAoKICAgICAgICBSZXR1cm4gY3VycmVudCBmb3Jlc3QgdHJ1c3RzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldEZvcmVzdFRydXN0IC1Gb3Jlc3QgInRlc3QiCgogICAgICAgIFJldHVybiB0cnVzdHMgZm9yIHRoZSAidGVzdCIgZm9yZXN0LgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZvcmVzdCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBwcm9jZXNzIHsKICAgICAgICAkRm91bmRGb3Jlc3QgPSBHZXQtTmV0Rm9yZXN0IC1Gb3Jlc3QgJEZvcmVzdCAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbAoKICAgICAgICBpZigkRm91bmRGb3Jlc3QpIHsKICAgICAgICAgICAgJEZvdW5kRm9yZXN0LkdldEFsbFRydXN0UmVsYXRpb25zaGlwcygpCiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gRmluZC1Gb3JlaWduVXNlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgRW51bWVyYXRlcyB1c2VycyB3aG8gYXJlIGluIGdyb3VwcyBvdXRzaWRlIG9mIHRoZWlyCiAgICAgICAgcHJpbmNpcGFsIGRvbWFpbi4gVGhlIC1SZWN1cnNlIG9wdGlvbiB3aWxsIHRyeSB0byBtYXAgYWxsIAogICAgICAgIHRyYW5zaXRpdmUgZG9tYWluIHRydXN0IHJlbGF0aW9uc2hpcHMgYW5kIGVudW1lcmF0ZSBhbGwgCiAgICAgICAgdXNlcnMgd2hvIGFyZSBpbiBncm91cHMgb3V0c2lkZSBvZiB0aGVpciBwcmluY2lwYWwgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgVXNlck5hbWUKCiAgICAgICAgVXNlcm5hbWUgdG8gZmlsdGVyIHJlc3VsdHMgZm9yLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIHRvIHF1ZXJ5IGZvciB1c2VycywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgTERBUAoKICAgICAgICBTd2l0Y2guIFVzZSBMREFQIHF1ZXJpZXMgdG8gZW51bWVyYXRlIHRoZSB0cnVzdHMgaW5zdGVhZCBvZiBkaXJlY3QgZG9tYWluIGNvbm5lY3Rpb25zLgogICAgICAgIE1vcmUgbGlrZWx5IHRvIGdldCBhcm91bmQgbmV0d29yayBzZWdtZW50YXRpb24sIGJ1dCBub3QgYXMgYWNjdXJhdGUuCgogICAgLlBBUkFNRVRFUiBSZWN1cnNlCgogICAgICAgIFN3aXRjaC4gRW51bWVyYXRlIGFsbCB1c2VyIHRydXN0IGdyb3VwcyBmcm9tIGFsbCByZWFjaGFibGUgZG9tYWlucyByZWN1cnNpdmVseS4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vYmxvZy5oYXJtajB5Lm5ldC8KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlck5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTERBUCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkUmVjdXJzZSwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwCiAgICApCgogICAgZnVuY3Rpb24gR2V0LUZvcmVpZ25Vc2VyIHsKICAgICAgICAjIGhlbHBlciB1c2VkIHRvIGVudW1lcmF0ZSB1c2VycyB3aG8gYXJlIGluIGdyb3VwcyBvdXRzaWRlIG9mIHRoZWlyIHByaW5jaXBhbCBkb21haW4KICAgICAgICBwYXJhbSgKICAgICAgICAgICAgW1N0cmluZ10KICAgICAgICAgICAgJFVzZXJOYW1lLAoKICAgICAgICAgICAgW1N0cmluZ10KICAgICAgICAgICAgJERvbWFpbiwKCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgICAgICBbSW50XQogICAgICAgICAgICAkUGFnZVNpemUgPSAyMDAKICAgICAgICApCgogICAgICAgIGlmICgkRG9tYWluKSB7CiAgICAgICAgICAgICMgZ2V0IHRoZSBkb21haW4gbmFtZSBpbnRvIGRpc3Rpbmd1aXNoZWQgZm9ybQogICAgICAgICAgICAkRGlzdGluZ3Vpc2hlZERvbWFpbk5hbWUgPSAiREM9IiArICREb21haW4gLXJlcGxhY2UgJ1wuJywnLERDPScKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICREaXN0aW5ndWlzaGVkRG9tYWluTmFtZSA9IFtTdHJpbmddIChbYWRzaV0nJykuZGlzdGluZ3Vpc2hlZG5hbWUKICAgICAgICAgICAgJERvbWFpbiA9ICREaXN0aW5ndWlzaGVkRG9tYWluTmFtZSAtcmVwbGFjZSAnREM9JywnJyAtcmVwbGFjZSAnLCcsJy4nCiAgICAgICAgfQoKICAgICAgICBHZXQtTmV0VXNlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVVzZXJOYW1lICRVc2VyTmFtZSAtUGFnZVNpemUgJFBhZ2VTaXplIHwgV2hlcmUtT2JqZWN0IHskXy5tZW1iZXJvZn0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIEZvckVhY2ggKCRNZW1iZXJzaGlwIGluICRfLm1lbWJlcm9mKSB7CiAgICAgICAgICAgICAgICAkSW5kZXggPSAkTWVtYmVyc2hpcC5JbmRleE9mKCJEQz0iKQogICAgICAgICAgICAgICAgaWYoJEluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgJEdyb3VwRG9tYWluID0gJCgkTWVtYmVyc2hpcC5zdWJzdHJpbmcoJEluZGV4KSkgLXJlcGxhY2UgJ0RDPScsJycgLXJlcGxhY2UgJywnLCcuJwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICgkR3JvdXBEb21haW4uQ29tcGFyZVRvKCREb21haW4pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgdGhlIGdyb3VwIGRvbWFpbiBkb2Vzbid0IG1hdGNoIHRoZSB1c2VyIGRvbWFpbiwgb3V0cHV0CiAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cE5hbWUgPSAkTWVtYmVyc2hpcC5zcGxpdCgiLCIpWzBdLnNwbGl0KCI9IilbMV0KICAgICAgICAgICAgICAgICAgICAgICAgJEZvcmVpZ25Vc2VyID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnblVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlckRvbWFpbicgJERvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnblVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlck5hbWUnICRfLnNhbWFjY291bnRuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3JlaWduVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cERvbWFpbicgJEdyb3VwRG9tYWluCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3JlaWduVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cE5hbWUnICRHcm91cE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJEZvcmVpZ25Vc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dyb3VwRE4nICRNZW1iZXJzaGlwCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3JlaWduVXNlcgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAoJFJlY3Vyc2UpIHsKICAgICAgICAjIGdldCBhbGwgcmVjaGFibGUgZG9tYWlucyBpbiB0aGUgdHJ1c3QgbWVzaCBhbmQgdW5pcXVpZnkgdGhlbQogICAgICAgIGlmKCRMREFQIC1vciAkRG9tYWluQ29udHJvbGxlcikgewogICAgICAgICAgICAkRG9tYWluVHJ1c3RzID0gSW52b2tlLU1hcERvbWFpblRydXN0IC1MREFQIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBGb3JFYWNoLU9iamVjdCB7ICRfLlNvdXJjZURvbWFpbiB9IHwgU29ydC1PYmplY3QgLVVuaXF1ZQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJERvbWFpblRydXN0cyA9IEludm9rZS1NYXBEb21haW5UcnVzdCAtUGFnZVNpemUgJFBhZ2VTaXplIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5Tb3VyY2VEb21haW4gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUKICAgICAgICB9CgogICAgICAgIEZvckVhY2goJERvbWFpblRydXN0IGluICREb21haW5UcnVzdHMpIHsKICAgICAgICAgICAgIyBnZXQgdGhlIHRydXN0IGdyb3VwcyBmb3IgZWFjaCBkb21haW4gaW4gdGhlIHRydXN0IG1lc2gKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRW51bWVyYXRpbmcgdHJ1c3QgZ3JvdXBzIGluIGRvbWFpbiAkRG9tYWluVHJ1c3QiCiAgICAgICAgICAgIEdldC1Gb3JlaWduVXNlciAtRG9tYWluICREb21haW5UcnVzdCAtVXNlck5hbWUgJFVzZXJOYW1lIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBHZXQtRm9yZWlnblVzZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1Vc2VyTmFtZSAkVXNlck5hbWUgLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgfQp9CgoKZnVuY3Rpb24gRmluZC1Gb3JlaWduR3JvdXAgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEVudW1lcmF0ZXMgYWxsIHRoZSBtZW1iZXJzIG9mIGEgZ2l2ZW4gZG9tYWluJ3MgZ3JvdXBzCiAgICAgICAgYW5kIGZpbmRzIHVzZXJzIHRoYXQgYXJlIG5vdCBpbiB0aGUgcXVlcmllZCBkb21haW4uCiAgICAgICAgVGhlIC1SZWN1cnNlIGZsYWcgd2lsbCBwZXJmb3JtIHRoaXMgZW51bWVyYXRpb24gZm9yIGFsbAogICAgICAgIGVhY2hhYmxlIGRvbWFpbiB0cnVzdHMuCgogICAgLlBBUkFNRVRFUiBHcm91cE5hbWUKCiAgICAgICAgR3JvdXBuYW1lIHRvIGZpbHRlciByZXN1bHRzIGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIERvbWFpbiB0byBxdWVyeSBmb3IgZ3JvdXBzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBMREFQCgogICAgICAgIFN3aXRjaC4gVXNlIExEQVAgcXVlcmllcyB0byBlbnVtZXJhdGUgdGhlIHRydXN0cyBpbnN0ZWFkIG9mIGRpcmVjdCBkb21haW4gY29ubmVjdGlvbnMuCiAgICAgICAgTW9yZSBsaWtlbHkgdG8gZ2V0IGFyb3VuZCBuZXR3b3JrIHNlZ21lbnRhdGlvbiwgYnV0IG5vdCBhcyBhY2N1cmF0ZS4KCiAgICAuUEFSQU1FVEVSIFJlY3Vyc2UKCiAgICAgICAgU3dpdGNoLiBFbnVtZXJhdGUgYWxsIGdyb3VwIHRydXN0IHVzZXJzIGZyb20gYWxsIHJlYWNoYWJsZSBkb21haW5zIHJlY3Vyc2l2ZWx5LgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly9ibG9nLmhhcm1qMHkubmV0LwojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbU3RyaW5nXQogICAgICAgICRHcm91cE5hbWUgPSAnKicsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTERBUCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkUmVjdXJzZSwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwCiAgICApCgogICAgZnVuY3Rpb24gR2V0LUZvcmVpZ25Hcm91cCB7CiAgICAgICAgcGFyYW0oCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICRHcm91cE5hbWUgPSAnKicsCgogICAgICAgICAgICBbU3RyaW5nXQogICAgICAgICAgICAkRG9tYWluLAoKICAgICAgICAgICAgW1N0cmluZ10KICAgICAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgICAgIFtJbnRdCiAgICAgICAgICAgICRQYWdlU2l6ZSA9IDIwMAogICAgICAgICkKCiAgICAgICAgaWYoLW5vdCAkRG9tYWluKSB7CiAgICAgICAgICAgICREb21haW4gPSAoR2V0LU5ldERvbWFpbikuTmFtZQogICAgICAgIH0KCiAgICAgICAgJERvbWFpbkROID0gIkRDPSQoJERvbWFpbi5SZXBsYWNlKCcuJywgJyxEQz0nKSkiCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiRG9tYWluRE46ICREb21haW5ETiIKCiAgICAgICAgIyBzdGFuZGFyZCBncm91cCBuYW1lcyB0byBpZ25vcmUKICAgICAgICAkRXhjbHVkZUdyb3VwcyA9IEAoIlVzZXJzIiwgIkRvbWFpbiBVc2VycyIsICJHdWVzdHMiKQoKICAgICAgICAjIGdldCBhbGwgdGhlIGdyb3VwbmFtZXMgZm9yIHRoZSBnaXZlbiBkb21haW4KICAgICAgICBHZXQtTmV0R3JvdXAgLUdyb3VwTmFtZSAkR3JvdXBOYW1lIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtRnVsbERhdGEgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IFdoZXJlLU9iamVjdCB7JF8ubWVtYmVyfSB8IFdoZXJlLU9iamVjdCB7CiAgICAgICAgICAgICMgZXhjbHVkZSBjb21tb24gbGFyZ2UgZ3JvdXBzCiAgICAgICAgICAgIC1ub3QgKCRFeGNsdWRlR3JvdXBzIC1jb250YWlucyAkXy5zYW1hY2NvdW50bmFtZSkgfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJEdyb3VwTmFtZSA9ICRfLnNhbUFjY291bnROYW1lCgogICAgICAgICAgICAgICAgJF8ubWVtYmVyIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICMgZmlsdGVyIGZvciBmb3JlaWduIFNJRHMgaW4gdGhlIGNuIGZpZWxkIGZvciB1c2VycyBpbiBhbm90aGVyIGRvbWFpbiwKICAgICAgICAgICAgICAgICAgICAjICAgb3IgaWYgdGhlIEROIGRvZXNuJ3QgZW5kIHdpdGggdGhlIHByb3BlciBETiBmb3IgdGhlIHF1ZXJpZWQgZG9tYWluICAKICAgICAgICAgICAgICAgICAgICBpZiAoKCRfIC1tYXRjaCAnQ049Uy0xLTUtMjEuKi0uKicpIC1vciAoJERvbWFpbkROIC1uZSAoJF8uc3Vic3RyaW5nKCRfLkluZGV4T2YoIkRDPSIpKSkpKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAkVXNlckRvbWFpbiA9ICRfLnN1YlN0cmluZygkXy5JbmRleE9mKCJEQz0iKSkgLXJlcGxhY2UgJ0RDPScsJycgLXJlcGxhY2UgJywnLCcuJwogICAgICAgICAgICAgICAgICAgICAgICAkVXNlck5hbWUgPSAkXy5zcGxpdCgiLCIpWzBdLnNwbGl0KCI9IilbMV0KCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3JlaWduR3JvdXBVc2VyID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnbkdyb3VwVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cERvbWFpbicgJERvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnbkdyb3VwVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cE5hbWUnICRHcm91cE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJEZvcmVpZ25Hcm91cFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlckRvbWFpbicgJFVzZXJEb21haW4KICAgICAgICAgICAgICAgICAgICAgICAgJEZvcmVpZ25Hcm91cFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlck5hbWUnICRVc2VyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnbkdyb3VwVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyRE4nICRfCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3JlaWduR3JvdXBVc2VyCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAoJFJlY3Vyc2UpIHsKICAgICAgICAjIGdldCBhbGwgcmVjaGFibGUgZG9tYWlucyBpbiB0aGUgdHJ1c3QgbWVzaCBhbmQgdW5pcXVpZnkgdGhlbQogICAgICAgIGlmKCRMREFQIC1vciAkRG9tYWluQ29udHJvbGxlcikgewogICAgICAgICAgICAkRG9tYWluVHJ1c3RzID0gSW52b2tlLU1hcERvbWFpblRydXN0IC1MREFQIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBGb3JFYWNoLU9iamVjdCB7ICRfLlNvdXJjZURvbWFpbiB9IHwgU29ydC1PYmplY3QgLVVuaXF1ZQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJERvbWFpblRydXN0cyA9IEludm9rZS1NYXBEb21haW5UcnVzdCAtUGFnZVNpemUgJFBhZ2VTaXplIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5Tb3VyY2VEb21haW4gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUKICAgICAgICB9CgogICAgICAgIEZvckVhY2goJERvbWFpblRydXN0IGluICREb21haW5UcnVzdHMpIHsKICAgICAgICAgICAgIyBnZXQgdGhlIHRydXN0IGdyb3VwcyBmb3IgZWFjaCBkb21haW4gaW4gdGhlIHRydXN0IG1lc2gKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRW51bWVyYXRpbmcgdHJ1c3QgZ3JvdXBzIGluIGRvbWFpbiAkRG9tYWluVHJ1c3QiCiAgICAgICAgICAgIEdldC1Gb3JlaWduR3JvdXAgLUdyb3VwTmFtZSAkR3JvdXBOYW1lIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgR2V0LUZvcmVpZ25Hcm91cCAtR3JvdXBOYW1lICRHcm91cE5hbWUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgIH0KfQoKCmZ1bmN0aW9uIEZpbmQtTWFuYWdlZFNlY3VyaXR5R3JvdXBzIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHJldHJpZXZlcyBhbGwgc2VjdXJpdHkgZ3JvdXBzIGluIHRoZSBkb21haW4gYW5kIGlkZW50aWZpZXMgb25lcyB0aGF0CiAgICAgICAgaGF2ZSBhIG1hbmFnZXIgc2V0LiBJdCBhbHNvIGRldGVybWluZXMgd2hldGhlciB0aGUgbWFuYWdlciBoYXMgdGhlIGFiaWxpdHkgdG8gYWRkCiAgICAgICAgb3IgcmVtb3ZlIG1lbWJlcnMgZnJvbSB0aGUgZ3JvdXAuCgogICAgICAgIEF1dGhvcjogU3R1YXJ0IE1vcmdhbiAoQHVrc3R1ZnVzKSA8c3R1YXJ0Lm1vcmdhbkBtd3JpbmZvc2VjdXJpdHkuY29tPgogICAgICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gRmluZC1NYW5hZ2VkU2VjdXJpdHlHcm91cHMgfCBFeHBvcnQtUG93ZXJWaWV3Q1NWIC1Ob1R5cGVJbmZvcm1hdGlvbiBncm91cC1tYW5hZ2Vycy5jc3YKCiAgICAgICAgU3RvcmUgYSBsaXN0IG9mIGFsbCBzZWN1cml0eSBncm91cHMgd2l0aCBtYW5hZ2VycyBpbiBncm91cC1tYW5hZ2Vycy5jc3YKCiAgICAuREVTQ1JJUFRJT04KCiAgICAgICAgQXV0aG9yaXR5IHRvIG1hbmlwdWxhdGUgdGhlIGdyb3VwIG1lbWJlcnNoaXAgb2YgQUQgc2VjdXJpdHkgZ3JvdXBzIGFuZCBkaXN0cmlidXRpb24gZ3JvdXBzIAogICAgICAgIGNhbiBiZSBkZWxlZ2F0ZWQgdG8gbm9uLWFkbWluaXN0cmF0b3JzIGJ5IHNldHRpbmcgdGhlICdtYW5hZ2VkQnknIGF0dHJpYnV0ZS4gVGhpcyBpcyB0eXBpY2FsbHkKICAgICAgICB1c2VkIHRvIGRlbGVnYXRlIG1hbmFnZW1lbnQgYXV0aG9yaXR5IHRvIGRpc3RyaWJ1dGlvbiBncm91cHMsIGJ1dCBXaW5kb3dzIHN1cHBvcnRzIHNlY3VyaXR5IGdyb3VwcwogICAgICAgIGJlaW5nIG1hbmFnZWQgaW4gdGhlIHNhbWUgd2F5LgoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHNlYXJjaGVzIGZvciBBRCBncm91cHMgd2hpY2ggaGF2ZSBhIGdyb3VwIG1hbmFnZXIgc2V0LCBhbmQgZGV0ZXJtaW5lcyB3aGV0aGVyIHRoYXQKICAgICAgICB1c2VyIGNhbiBtYW5pcHVsYXRlIGdyb3VwIG1lbWJlcnNoaXAuIFRoaXMgY291bGQgYmUgYSB1c2VmdWwgbWV0aG9kIG9mIGhvcml6b250YWwgcHJpdmlsZWdlCiAgICAgICAgZXNjYWxhdGlvbiwgZXNwZWNpYWxseSBpZiB0aGUgbWFuYWdlciBjYW4gbWFuaXB1bGF0ZSB0aGUgbWVtYmVyc2hpcCBvZiBhIHByaXZpbGVnZWQgZ3JvdXAuCgogICAgLkxJTksKCiAgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL1Bvd2VyU2hlbGxFbXBpcmUvRW1waXJlL3B1bGwvMTE5CgojPgoKICAgICMgR28gdGhyb3VnaCB0aGUgbGlzdCBvZiBzZWN1cml0eSBncm91cHMgb24gdGhlIGRvbWFpbiBhbmQgaWRlbnRpZnkgdGhvc2Ugd2hvIGhhdmUgYSBtYW5hZ2VyCiAgICBHZXQtTmV0R3JvdXAgLUZ1bGxEYXRhIC1GaWx0ZXIgJygmKG1hbmFnZWRCeT0qKShncm91cFR5cGU6MS4yLjg0MC4xMTM1NTYuMS40LjgwMzo9MjE0NzQ4MzY0OCkpJyB8IFNlbGVjdC1PYmplY3QgLVVuaXF1ZSBkaXN0aW5ndWlzaGVkTmFtZSxtYW5hZ2VkQnksY24gfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICMgUmV0cmlldmUgdGhlIG9iamVjdCB0aGF0IHRoZSBtYW5hZ2VkQnkgRE4gcmVmZXJzIHRvCiAgICAgICAgJGdyb3VwX21hbmFnZXIgPSBHZXQtQURPYmplY3QgLUFEU1BhdGggJF8ubWFuYWdlZEJ5IHwgU2VsZWN0LU9iamVjdCBjbixkaXN0aW5ndWlzaGVkbmFtZSxuYW1lLHNhbWFjY291bnR0eXBlLHNhbWFjY291bnRuYW1lCgogICAgICAgICMgQ3JlYXRlIGEgcmVzdWx0cyBvYmplY3QgdG8gc3RvcmUgb3VyIGZpbmRpbmdzCiAgICAgICAgJHJlc3VsdHNfb2JqZWN0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5IEB7CiAgICAgICAgICAgICdHcm91cENOJyA9ICRfLmNuCiAgICAgICAgICAgICdHcm91cEROJyA9ICRfLmRpc3Rpbmd1aXNoZWRuYW1lCiAgICAgICAgICAgICdNYW5hZ2VyQ04nID0gJGdyb3VwX21hbmFnZXIuY24KICAgICAgICAgICAgJ01hbmFnZXJETicgPSAkZ3JvdXBfbWFuYWdlci5kaXN0aW5ndWlzaGVkTmFtZQogICAgICAgICAgICAnTWFuYWdlclNBTicgPSAkZ3JvdXBfbWFuYWdlci5zYW1hY2NvdW50bmFtZQogICAgICAgICAgICAnTWFuYWdlclR5cGUnID0gJycKICAgICAgICAgICAgJ0Nhbk1hbmFnZXJXcml0ZScgPSAkRkFMU0UKICAgICAgICB9CgogICAgICAgICMgRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIG1hbmFnZXIgaXMgYSB1c2VyIG9yIGEgZ3JvdXAKICAgICAgICBpZiAoJGdyb3VwX21hbmFnZXIuc2FtYWNjb3VudHR5cGUgLWVxIDB4MTAwMDAwMDApIHsKICAgICAgICAgICAgJHJlc3VsdHNfb2JqZWN0Lk1hbmFnZXJUeXBlID0gJ0dyb3VwJwogICAgICAgIH0gZWxzZWlmICgkZ3JvdXBfbWFuYWdlci5zYW1hY2NvdW50dHlwZSAtZXEgMHgzMDAwMDAwMCkgewogICAgICAgICAgICAkcmVzdWx0c19vYmplY3QuTWFuYWdlclR5cGUgPSAnVXNlcicKICAgICAgICB9CgogICAgICAgICMgRmluZCB0aGUgQUNMcyB0aGF0IHJlbGF0ZSB0byB0aGUgYWJpbGl0eSB0byB3cml0ZSB0byB0aGUgZ3JvdXAKICAgICAgICAkeGFjbCA9IEdldC1PYmplY3RBY2wgLUFEU1BhdGggJF8uZGlzdGluZ3Vpc2hlZG5hbWUgLVJpZ2h0cyBXcml0ZU1lbWJlcnMKCiAgICAgICAgIyBEb3VibGUtY2hlY2sgdGhhdCB0aGUgbWFuYWdlcgogICAgICAgIGlmICgkeGFjbC5PYmplY3RUeXBlIC1lcSAnYmY5Njc5YzAtMGRlNi0xMWQwLWEyODUtMDBhYTAwMzA0OWUyJyAtYW5kICR4YWNsLkFjY2Vzc0NvbnRyb2xUeXBlIC1lcSAnQWxsb3cnIC1hbmQgJHhhY2wuSWRlbnRpdHlSZWZlcmVuY2UuVmFsdWUuQ29udGFpbnMoJGdyb3VwX21hbmFnZXIuc2FtYWNjb3VudG5hbWUpKSB7CiAgICAgICAgICAgICRyZXN1bHRzX29iamVjdC5DYW5NYW5hZ2VyV3JpdGUgPSAkVFJVRQogICAgICAgIH0KICAgICAgICAkcmVzdWx0c19vYmplY3QKICAgIH0KfQoKCmZ1bmN0aW9uIEludm9rZS1NYXBEb21haW5UcnVzdCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiBnZXRzIGFsbCB0cnVzdHMgZm9yIHRoZSBjdXJyZW50IGRvbWFpbiwKICAgICAgICBhbmQgdHJpZXMgdG8gZ2V0IGFsbCB0cnVzdHMgZm9yIGVhY2ggZG9tYWluIGl0IGZpbmRzLgoKICAgIC5QQVJBTUVURVIgTERBUAoKICAgICAgICBTd2l0Y2guIFVzZSBMREFQIHF1ZXJpZXMgdG8gZW51bWVyYXRlIHRoZSB0cnVzdHMgaW5zdGVhZCBvZiBkaXJlY3QgZG9tYWluIGNvbm5lY3Rpb25zLgogICAgICAgIE1vcmUgbGlrZWx5IHRvIGdldCBhcm91bmQgbmV0d29yayBzZWdtZW50YXRpb24sIGJ1dCBub3QgYXMgYWNjdXJhdGUuCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1NYXBEb21haW5UcnVzdCB8IEV4cG9ydC1DU1YgLU5vVHlwZUluZm9ybWF0aW9uIHRydXN0cy5jc3YKICAgICAgICAKICAgICAgICBNYXAgYWxsIHJlYWNoYWJsZSBkb21haW4gdHJ1c3RzIGFuZCBvdXRwdXQgZXZlcnl0aGluZyB0byBhIC5jc3YgZmlsZS4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vYmxvZy5oYXJtajB5Lm5ldC8KIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbU3dpdGNoXQogICAgICAgICRMREFQLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgIyBrZWVwIHRyYWNrIG9mIGRvbWFpbnMgc2VlbiBzbyB3ZSBkb24ndCBoaXQgaW5maW5pdGUgcmVjdXJzaW9uCiAgICAkU2VlbkRvbWFpbnMgPSBAe30KCiAgICAjIG91ciBkb21haW4gc3RhdHVzIHRyYWNrZXIKICAgICREb21haW5zID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuU3RhY2sKCiAgICAjIGdldCB0aGUgY3VycmVudCBkb21haW4gYW5kIHB1c2ggaXQgb250byB0aGUgc3RhY2sKICAgICRDdXJyZW50RG9tYWluID0gKEdldC1OZXREb21haW4gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwpLk5hbWUKICAgICREb21haW5zLnB1c2goJEN1cnJlbnREb21haW4pCgogICAgd2hpbGUoJERvbWFpbnMuQ291bnQgLW5lIDApIHsKCiAgICAgICAgJERvbWFpbiA9ICREb21haW5zLlBvcCgpCgogICAgICAgICMgaWYgd2UgaGF2ZW4ndCBzZWVuIHRoaXMgZG9tYWluIGJlZm9yZQogICAgICAgIGlmICgkRG9tYWluIC1hbmQgKCREb21haW4uVHJpbSgpIC1uZSAiIikgLWFuZCAoLW5vdCAkU2VlbkRvbWFpbnMuQ29udGFpbnNLZXkoJERvbWFpbikpKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFbnVtZXJhdGluZyB0cnVzdHMgZm9yIGRvbWFpbiAnJERvbWFpbiciCgogICAgICAgICAgICAjIG1hcmsgaXQgYXMgc2VlbiBpbiBvdXIgbGlzdAogICAgICAgICAgICAkTnVsbCA9ICRTZWVuRG9tYWlucy5hZGQoJERvbWFpbiwgIiIpCgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgIyBnZXQgYWxsIHRoZSB0cnVzdHMgZm9yIHRoaXMgZG9tYWluCiAgICAgICAgICAgICAgICBpZigkTERBUCAtb3IgJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgICAgICAgICAkVHJ1c3RzID0gR2V0LU5ldERvbWFpblRydXN0IC1Eb21haW4gJERvbWFpbiAtTERBUCAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIC1DcmVkZW50aWFsICRDcmVkZW50aWFsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkVHJ1c3RzID0gR2V0LU5ldERvbWFpblRydXN0IC1Eb21haW4gJERvbWFpbiAtUGFnZVNpemUgJFBhZ2VTaXplIC1DcmVkZW50aWFsICRDcmVkZW50aWFsCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoJFRydXN0cyAtaXNub3QgW1N5c3RlbS5BcnJheV0pIHsKICAgICAgICAgICAgICAgICAgICAkVHJ1c3RzID0gQCgkVHJ1c3RzKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgZ2V0IGFueSBmb3Jlc3QgdHJ1c3RzLCBpZiB0aGV5IGV4aXN0CiAgICAgICAgICAgICAgICAkVHJ1c3RzICs9IEdldC1OZXRGb3Jlc3RUcnVzdCAtRm9yZXN0ICREb21haW4gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwKCiAgICAgICAgICAgICAgICBpZiAoJFRydXN0cykgewoKICAgICAgICAgICAgICAgICAgICAjIGVudW1lcmF0ZSBlYWNoIHRydXN0IGZvdW5kCiAgICAgICAgICAgICAgICAgICAgRm9yRWFjaCAoJFRydXN0IGluICRUcnVzdHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFNvdXJjZURvbWFpbiA9ICRUcnVzdC5Tb3VyY2VOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRUYXJnZXREb21haW4gPSAkVHJ1c3QuVGFyZ2V0TmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkVHJ1c3RUeXBlID0gJFRydXN0LlRydXN0VHlwZQogICAgICAgICAgICAgICAgICAgICAgICAkVHJ1c3REaXJlY3Rpb24gPSAkVHJ1c3QuVHJ1c3REaXJlY3Rpb24KCiAgICAgICAgICAgICAgICAgICAgICAgICMgbWFrZSBzdXJlIHdlIHByb2Nlc3MgdGhlIHRhcmdldAogICAgICAgICAgICAgICAgICAgICAgICAkTnVsbCA9ICREb21haW5zLnB1c2goJFRhcmdldERvbWFpbikKCiAgICAgICAgICAgICAgICAgICAgICAgICMgYnVpbGQgdGhlIG5pY2VseS1wYXJzYWJsZSBjdXN0b20gb3V0cHV0IG9iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTb3VyY2VEb21haW4nICIkU291cmNlRG9tYWluIgogICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU291cmNlU0lEJyAkVHJ1c3QuU291cmNlU0lECiAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUYXJnZXREb21haW4nICIkVGFyZ2V0RG9tYWluIgogICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVGFyZ2V0U0lEJyAkVHJ1c3QuVGFyZ2V0U0lECiAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUcnVzdFR5cGUnICIkVHJ1c3RUeXBlIgogICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVHJ1c3REaXJlY3Rpb24nICIkVHJ1c3REaXJlY3Rpb24iCiAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJbIV0gRXJyb3I6ICRfIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojIEV4cG9zZSB0aGUgV2luMzJBUEkgZnVuY3Rpb25zIGFuZCBkYXRhc3RydWN0dXJlcyBiZWxvdwojIHVzaW5nIFBTUmVmbGVjdC4gCiMgV2FybmluZzogT25jZSB0aGVzZSBhcmUgZXhlY3V0ZWQsIHRoZXkgYXJlIGJha2VkIGluIAojIGFuZCBjYW4ndCBiZSBjaGFuZ2VkIHdoaWxlIHRoZSBzY3JpcHQgaXMgcnVubmluZyEKIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKJE1vZCA9IE5ldy1Jbk1lbW9yeU1vZHVsZSAtTW9kdWxlTmFtZSBXaW4zMgoKIyBhbGwgb2YgdGhlIFdpbjMyIEFQSSBmdW5jdGlvbnMgd2UgbmVlZAokRnVuY3Rpb25EZWZpbml0aW9ucyA9IEAoCiAgICAoZnVuYyBuZXRhcGkzMiBOZXRTaGFyZUVudW0gKFtJbnRdKSBAKFtTdHJpbmddLCBbSW50XSwgW0ludFB0cl0uTWFrZUJ5UmVmVHlwZSgpLCBbSW50XSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpLCBbSW50MzJdLk1ha2VCeVJlZlR5cGUoKSkpLAogICAgKGZ1bmMgbmV0YXBpMzIgTmV0V2tzdGFVc2VyRW51bSAoW0ludF0pIEAoW1N0cmluZ10sIFtJbnRdLCBbSW50UHRyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnRdLCBbSW50MzJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpKSksCiAgICAoZnVuYyBuZXRhcGkzMiBOZXRTZXNzaW9uRW51bSAoW0ludF0pIEAoW1N0cmluZ10sIFtTdHJpbmddLCBbU3RyaW5nXSwgW0ludF0sIFtJbnRQdHJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludF0sIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpLCBbSW50MzJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCkpKSwKICAgIChmdW5jIG5ldGFwaTMyIE5ldExvY2FsR3JvdXBHZXRNZW1iZXJzIChbSW50XSkgQChbU3RyaW5nXSwgW1N0cmluZ10sIFtJbnRdLCBbSW50UHRyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnRdLCBbSW50MzJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpKSksCiAgICAoZnVuYyBuZXRhcGkzMiBEc0dldFNpdGVOYW1lIChbSW50XSkgQChbU3RyaW5nXSwgW0ludFB0cl0uTWFrZUJ5UmVmVHlwZSgpKSksCiAgICAoZnVuYyBuZXRhcGkzMiBEc0VudW1lcmF0ZURvbWFpblRydXN0cyAoW0ludF0pIEAoW1N0cmluZ10sIFtVSW50MzJdLCBbSW50UHRyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnRQdHJdLk1ha2VCeVJlZlR5cGUoKSkpLAogICAgKGZ1bmMgbmV0YXBpMzIgTmV0QXBpQnVmZmVyRnJlZSAoW0ludF0pIEAoW0ludFB0cl0pKSwKICAgIChmdW5jIGFkdmFwaTMyIENvbnZlcnRTaWRUb1N0cmluZ1NpZCAoW0ludF0pIEAoW0ludFB0cl0sIFtTdHJpbmddLk1ha2VCeVJlZlR5cGUoKSkgLVNldExhc3RFcnJvciksCiAgICAoZnVuYyBhZHZhcGkzMiBPcGVuU0NNYW5hZ2VyVyAoW0ludFB0cl0pIEAoW1N0cmluZ10sIFtTdHJpbmddLCBbSW50XSkgLVNldExhc3RFcnJvciksCiAgICAoZnVuYyBhZHZhcGkzMiBDbG9zZVNlcnZpY2VIYW5kbGUgKFtJbnRdKSBAKFtJbnRQdHJdKSksCiAgICAoZnVuYyB3dHNhcGkzMiBXVFNPcGVuU2VydmVyRXggKFtJbnRQdHJdKSBAKFtTdHJpbmddKSksCiAgICAoZnVuYyB3dHNhcGkzMiBXVFNFbnVtZXJhdGVTZXNzaW9uc0V4IChbSW50XSkgQChbSW50UHRyXSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnRdLCBbSW50UHRyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpKSAtU2V0TGFzdEVycm9yKSwKICAgIChmdW5jIHd0c2FwaTMyIFdUU1F1ZXJ5U2Vzc2lvbkluZm9ybWF0aW9uIChbSW50XSkgQChbSW50UHRyXSwgW0ludF0sIFtJbnRdLCBbSW50UHRyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpKSAtU2V0TGFzdEVycm9yKSwKICAgIChmdW5jIHd0c2FwaTMyIFdUU0ZyZWVNZW1vcnlFeCAoW0ludF0pIEAoW0ludDMyXSwgW0ludFB0cl0sIFtJbnQzMl0pKSwKICAgIChmdW5jIHd0c2FwaTMyIFdUU0ZyZWVNZW1vcnkgKFtJbnRdKSBAKFtJbnRQdHJdKSksCiAgICAoZnVuYyB3dHNhcGkzMiBXVFNDbG9zZVNlcnZlciAoW0ludF0pIEAoW0ludFB0cl0pKQopCgojIGVudW0gdXNlZCBieSAkV1RTX1NFU1NJT05fSU5GT18xIGJlbG93CiRXVFNDb25uZWN0U3RhdGUgPSBwc2VudW0gJE1vZCBXVFNfQ09OTkVDVFNUQVRFX0NMQVNTIFVJbnQxNiBAewogICAgQWN0aXZlICAgICAgID0gICAgMAogICAgQ29ubmVjdGVkICAgID0gICAgMQogICAgQ29ubmVjdFF1ZXJ5ID0gICAgMgogICAgU2hhZG93ICAgICAgID0gICAgMwogICAgRGlzY29ubmVjdGVkID0gICAgNAogICAgSWRsZSAgICAgICAgID0gICAgNQogICAgTGlzdGVuICAgICAgID0gICAgNgogICAgUmVzZXQgICAgICAgID0gICAgNwogICAgRG93biAgICAgICAgID0gICAgOAogICAgSW5pdCAgICAgICAgID0gICAgOQp9CgojIHRoZSBXVFNFbnVtZXJhdGVTZXNzaW9uc0V4IHJlc3VsdCBzdHJ1Y3R1cmUKJFdUU19TRVNTSU9OX0lORk9fMSA9IHN0cnVjdCAkTW9kIFdUU19TRVNTSU9OX0lORk9fMSBAewogICAgRXhlY0VudklkID0gZmllbGQgMCBVSW50MzIKICAgIFN0YXRlID0gZmllbGQgMSAkV1RTQ29ubmVjdFN0YXRlCiAgICBTZXNzaW9uSWQgPSBmaWVsZCAyIFVJbnQzMgogICAgcFNlc3Npb25OYW1lID0gZmllbGQgMyBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgcEhvc3ROYW1lID0gZmllbGQgNCBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgcFVzZXJOYW1lID0gZmllbGQgNSBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgcERvbWFpbk5hbWUgPSBmaWVsZCA2IFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICBwRmFybU5hbWUgPSBmaWVsZCA3IFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCn0KCiMgdGhlIHBhcnRpY3VsYXIgV1RTUXVlcnlTZXNzaW9uSW5mb3JtYXRpb24gcmVzdWx0IHN0cnVjdHVyZQokV1RTX0NMSUVOVF9BRERSRVNTID0gc3RydWN0ICRtb2QgV1RTX0NMSUVOVF9BRERSRVNTIEB7CiAgICBBZGRyZXNzRmFtaWx5ID0gZmllbGQgMCBVSW50MzIKICAgIEFkZHJlc3MgPSBmaWVsZCAxIEJ5dGVbXSAtTWFyc2hhbEFzIEAoJ0J5VmFsQXJyYXknLCAyMCkKfQoKIyB0aGUgTmV0U2hhcmVFbnVtIHJlc3VsdCBzdHJ1Y3R1cmUKJFNIQVJFX0lORk9fMSA9IHN0cnVjdCAkTW9kIFNIQVJFX0lORk9fMSBAewogICAgc2hpMV9uZXRuYW1lID0gZmllbGQgMCBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgc2hpMV90eXBlID0gZmllbGQgMSBVSW50MzIKICAgIHNoaTFfcmVtYXJrID0gZmllbGQgMiBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQp9CgojIHRoZSBOZXRXa3N0YVVzZXJFbnVtIHJlc3VsdCBzdHJ1Y3R1cmUKJFdLU1RBX1VTRVJfSU5GT18xID0gc3RydWN0ICRNb2QgV0tTVEFfVVNFUl9JTkZPXzEgQHsKICAgIHdrdWkxX3VzZXJuYW1lID0gZmllbGQgMCBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgd2t1aTFfbG9nb25fZG9tYWluID0gZmllbGQgMSBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgd2t1aTFfb3RoX2RvbWFpbnMgPSBmaWVsZCAyIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICB3a3VpMV9sb2dvbl9zZXJ2ZXIgPSBmaWVsZCAzIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCn0KCiMgdGhlIE5ldFNlc3Npb25FbnVtIHJlc3VsdCBzdHJ1Y3R1cmUKJFNFU1NJT05fSU5GT18xMCA9IHN0cnVjdCAkTW9kIFNFU1NJT05fSU5GT18xMCBAewogICAgc2VzaTEwX2NuYW1lID0gZmllbGQgMCBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgc2VzaTEwX3VzZXJuYW1lID0gZmllbGQgMSBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgc2VzaTEwX3RpbWUgPSBmaWVsZCAyIFVJbnQzMgogICAgc2VzaTEwX2lkbGVfdGltZSA9IGZpZWxkIDMgVUludDMyCn0KCiMgZW51bSB1c2VkIGJ5ICRMT0NBTEdST1VQX01FTUJFUlNfSU5GT18yIGJlbG93CiRTSURfTkFNRV9VU0UgPSBwc2VudW0gJE1vZCBTSURfTkFNRV9VU0UgVUludDE2IEB7CiAgICBTaWRUeXBlVXNlciAgICAgICAgICAgICA9IDEKICAgIFNpZFR5cGVHcm91cCAgICAgICAgICAgID0gMgogICAgU2lkVHlwZURvbWFpbiAgICAgICAgICAgPSAzCiAgICBTaWRUeXBlQWxpYXMgICAgICAgICAgICA9IDQKICAgIFNpZFR5cGVXZWxsS25vd25Hcm91cCAgID0gNQogICAgU2lkVHlwZURlbGV0ZWRBY2NvdW50ICAgPSA2CiAgICBTaWRUeXBlSW52YWxpZCAgICAgICAgICA9IDcKICAgIFNpZFR5cGVVbmtub3duICAgICAgICAgID0gOAogICAgU2lkVHlwZUNvbXB1dGVyICAgICAgICAgPSA5Cn0KCiMgdGhlIE5ldExvY2FsR3JvdXBHZXRNZW1iZXJzIHJlc3VsdCBzdHJ1Y3R1cmUKJExPQ0FMR1JPVVBfTUVNQkVSU19JTkZPXzIgPSBzdHJ1Y3QgJE1vZCBMT0NBTEdST1VQX01FTUJFUlNfSU5GT18yIEB7CiAgICBsZ3JtaTJfc2lkID0gZmllbGQgMCBJbnRQdHIKICAgIGxncm1pMl9zaWR1c2FnZSA9IGZpZWxkIDEgJFNJRF9OQU1FX1VTRQogICAgbGdybWkyX2RvbWFpbmFuZG5hbWUgPSBmaWVsZCAyIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCn0KCiMgZW51bXMgdXNlZCBpbiBEU19ET01BSU5fVFJVU1RTCiREc0RvbWFpbkZsYWcgPSBwc2VudW0gJE1vZCBEc0RvbWFpbi5GbGFncyBVSW50MzIgQHsKICAgIElOX0ZPUkVTVCAgICAgICA9IDEKICAgIERJUkVDVF9PVVRCT1VORCA9IDIKICAgIFRSRUVfUk9PVCAgICAgICA9IDQKICAgIFBSSU1BUlkgICAgICAgICA9IDgKICAgIE5BVElWRV9NT0RFICAgICA9IDE2CiAgICBESVJFQ1RfSU5CT1VORCAgPSAzMgp9IC1CaXRmaWVsZAokRHNEb21haW5UcnVzdFR5cGUgPSBwc2VudW0gJE1vZCBEc0RvbWFpbi5UcnVzdFR5cGUgVUludDMyIEB7CiAgICBET1dOTEVWRUwgICA9IDEKICAgIFVQTEVWRUwgICAgID0gMgogICAgTUlUICAgICAgICAgPSAzCiAgICBEQ0UgICAgICAgICA9IDQKfQokRHNEb21haW5UcnVzdEF0dHJpYnV0ZXMgPSBwc2VudW0gJE1vZCBEc0RvbWFpbi5UcnVzdEF0dHJpYnV0ZXMgVUludDMyIEB7CiAgICBOT05fVFJBTlNJVElWRSAgICAgID0gMQogICAgVVBMRVZFTF9PTkxZICAgICAgICA9IDIKICAgIEZJTFRFUl9TSURTICAgICAgICAgPSA0CiAgICBGT1JFU1RfVFJBTlNJVElWRSAgID0gOAogICAgQ1JPU1NfT1JHQU5JWkFUSU9OICA9IDE2CiAgICBXSVRISU5fRk9SRVNUICAgICAgID0gMzIKICAgIFRSRUFUX0FTX0VYVEVSTkFMICAgPSA2NAp9CgojIHRoZSBEc0VudW1lcmF0ZURvbWFpblRydXN0cyByZXN1bHQgc3RydWN0dXJlCiREU19ET01BSU5fVFJVU1RTID0gc3RydWN0ICRNb2QgRFNfRE9NQUlOX1RSVVNUUyBAewogICAgTmV0Ymlvc0RvbWFpbk5hbWUgPSBmaWVsZCAwIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICBEbnNEb21haW5OYW1lID0gZmllbGQgMSBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgRmxhZ3MgPSBmaWVsZCAyICREc0RvbWFpbkZsYWcKICAgIFBhcmVudEluZGV4ID0gZmllbGQgMyBVSW50MzIKICAgIFRydXN0VHlwZSA9IGZpZWxkIDQgJERzRG9tYWluVHJ1c3RUeXBlCiAgICBUcnVzdEF0dHJpYnV0ZXMgPSBmaWVsZCA1ICREc0RvbWFpblRydXN0QXR0cmlidXRlcwogICAgRG9tYWluU2lkID0gZmllbGQgNiBJbnRQdHIKICAgIERvbWFpbkd1aWQgPSBmaWVsZCA3IEd1aWQKfQoKJFR5cGVzID0gJEZ1bmN0aW9uRGVmaW5pdGlvbnMgfCBBZGQtV2luMzJUeXBlIC1Nb2R1bGUgJE1vZCAtTmFtZXNwYWNlICdXaW4zMicKJE5ldGFwaTMyID0gJFR5cGVzWyduZXRhcGkzMiddCiRBZHZhcGkzMiA9ICRUeXBlc1snYWR2YXBpMzInXQokV3RzYXBpMzIgPSAkVHlwZXNbJ3d0c2FwaTMyJ10K
