PowerView.ps1,07fa43e5d7c6e1cdf8540263ba62fd4c,Scan result is 32768. IsMalware: 1,I3JlcXVpcmVzIC12ZXJzaW9uIDIKCjwjCgogICAgUG93ZXJTcGxvaXQgRmlsZTogUG93ZXJWaWV3LnBzMQogICAgQXV0aG9yOiBXaWxsIFNjaHJvZWRlciAoQGhhcm1qMHkpCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIFJlcXVpcmVkIERlcGVuZGVuY2llczogTm9uZQogICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBOb25lCgojPgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojIFBTUmVmbGVjdCBjb2RlIGZvciBXaW5kb3dzIEFQSSBhY2Nlc3MKIyBBdXRob3I6IEBtYXR0aWZlc3RhdGlvbgojICAgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL21hdHRpZmVzdGF0aW9uL1BTUmVmbGVjdC9tYXN0ZXIvUFNSZWZsZWN0LnBzbTEKIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZnVuY3Rpb24gTmV3LUluTWVtb3J5TW9kdWxlCnsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBDcmVhdGVzIGFuIGluLW1lbW9yeSBhc3NlbWJseSBhbmQgbW9kdWxlCgogICAgICAgIEF1dGhvcjogTWF0dGhldyBHcmFlYmVyIChAbWF0dGlmZXN0YXRpb24pCiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAgICAgUmVxdWlyZWQgRGVwZW5kZW5jaWVzOiBOb25lCiAgICAgICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBOb25lCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFdoZW4gZGVmaW5pbmcgY3VzdG9tIGVudW1zLCBzdHJ1Y3RzLCBhbmQgdW5tYW5hZ2VkIGZ1bmN0aW9ucywgaXQgaXMKICAgICAgICBuZWNlc3NhcnkgdG8gYXNzb2NpYXRlIHRvIGFuIGFzc2VtYmx5IG1vZHVsZS4gVGhpcyBoZWxwZXIgZnVuY3Rpb24KICAgICAgICBjcmVhdGVzIGFuIGluLW1lbW9yeSBtb2R1bGUgdGhhdCBjYW4gYmUgcGFzc2VkIHRvIHRoZSAnZW51bScsCiAgICAgICAgJ3N0cnVjdCcsIGFuZCBBZGQtV2luMzJUeXBlIGZ1bmN0aW9ucy4KCiAgICAuUEFSQU1FVEVSIE1vZHVsZU5hbWUKCiAgICAgICAgU3BlY2lmaWVzIHRoZSBkZXNpcmVkIG5hbWUgZm9yIHRoZSBpbi1tZW1vcnkgYXNzZW1ibHkgYW5kIG1vZHVsZS4gSWYKICAgICAgICBNb2R1bGVOYW1lIGlzIG5vdCBwcm92aWRlZCwgaXQgd2lsbCBkZWZhdWx0IHRvIGEgR1VJRC4KCiAgICAuRVhBTVBMRQoKICAgICAgICAkTW9kdWxlID0gTmV3LUluTWVtb3J5TW9kdWxlIC1Nb2R1bGVOYW1lIFdpbjMyCiM+CgogICAgUGFyYW0KICAgICgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRNb2R1bGVOYW1lID0gW0d1aWRdOjpOZXdHdWlkKCkuVG9TdHJpbmcoKQogICAgKQoKICAgICRMb2FkZWRBc3NlbWJsaWVzID0gW0FwcERvbWFpbl06OkN1cnJlbnREb21haW4uR2V0QXNzZW1ibGllcygpCgogICAgRm9yRWFjaCAoJEFzc2VtYmx5IGluICRMb2FkZWRBc3NlbWJsaWVzKSB7CiAgICAgICAgaWYgKCRBc3NlbWJseS5GdWxsTmFtZSAtYW5kICgkQXNzZW1ibHkuRnVsbE5hbWUuU3BsaXQoJywnKVswXSAtZXEgJE1vZHVsZU5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybiAkQXNzZW1ibHkKICAgICAgICB9CiAgICB9CgogICAgJER5bkFzc2VtYmx5ID0gTmV3LU9iamVjdCBSZWZsZWN0aW9uLkFzc2VtYmx5TmFtZSgkTW9kdWxlTmFtZSkKICAgICREb21haW4gPSBbQXBwRG9tYWluXTo6Q3VycmVudERvbWFpbgogICAgJEFzc2VtYmx5QnVpbGRlciA9ICREb21haW4uRGVmaW5lRHluYW1pY0Fzc2VtYmx5KCREeW5Bc3NlbWJseSwgJ1J1bicpCiAgICAkTW9kdWxlQnVpbGRlciA9ICRBc3NlbWJseUJ1aWxkZXIuRGVmaW5lRHluYW1pY01vZHVsZSgkTW9kdWxlTmFtZSwgJEZhbHNlKQoKICAgIHJldHVybiAkTW9kdWxlQnVpbGRlcgp9CgoKIyBBIGhlbHBlciBmdW5jdGlvbiB1c2VkIHRvIHJlZHVjZSB0eXBpbmcgd2hpbGUgZGVmaW5pbmcgZnVuY3Rpb24KIyBwcm90b3R5cGVzIGZvciBBZGQtV2luMzJUeXBlLgpmdW5jdGlvbiBmdW5jCnsKICAgIFBhcmFtCiAgICAoCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDAsIE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREbGxOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMSwgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZ1bmN0aW9uTmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDIsIE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbVHlwZV0KICAgICAgICAkUmV0dXJuVHlwZSwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDMpXQogICAgICAgIFtUeXBlW11dCiAgICAgICAgJFBhcmFtZXRlclR5cGVzLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gNCldCiAgICAgICAgW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkNhbGxpbmdDb252ZW50aW9uXQogICAgICAgICROYXRpdmVDYWxsaW5nQ29udmVudGlvbiwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDUpXQogICAgICAgIFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5DaGFyU2V0XQogICAgICAgICRDaGFyc2V0LAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTZXRMYXN0RXJyb3IKICAgICkKCiAgICAkUHJvcGVydGllcyA9IEB7CiAgICAgICAgRGxsTmFtZSA9ICREbGxOYW1lCiAgICAgICAgRnVuY3Rpb25OYW1lID0gJEZ1bmN0aW9uTmFtZQogICAgICAgIFJldHVyblR5cGUgPSAkUmV0dXJuVHlwZQogICAgfQoKICAgIGlmICgkUGFyYW1ldGVyVHlwZXMpIHsgJFByb3BlcnRpZXNbJ1BhcmFtZXRlclR5cGVzJ10gPSAkUGFyYW1ldGVyVHlwZXMgfQogICAgaWYgKCROYXRpdmVDYWxsaW5nQ29udmVudGlvbikgeyAkUHJvcGVydGllc1snTmF0aXZlQ2FsbGluZ0NvbnZlbnRpb24nXSA9ICROYXRpdmVDYWxsaW5nQ29udmVudGlvbiB9CiAgICBpZiAoJENoYXJzZXQpIHsgJFByb3BlcnRpZXNbJ0NoYXJzZXQnXSA9ICRDaGFyc2V0IH0KICAgIGlmICgkU2V0TGFzdEVycm9yKSB7ICRQcm9wZXJ0aWVzWydTZXRMYXN0RXJyb3InXSA9ICRTZXRMYXN0RXJyb3IgfQoKICAgIE5ldy1PYmplY3QgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzCn0KCgpmdW5jdGlvbiBBZGQtV2luMzJUeXBlCnsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBDcmVhdGVzIGEgLk5FVCB0eXBlIGZvciBhbiB1bm1hbmFnZWQgV2luMzIgZnVuY3Rpb24uCgogICAgICAgIEF1dGhvcjogTWF0dGhldyBHcmFlYmVyIChAbWF0dGlmZXN0YXRpb24pCiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAgICAgUmVxdWlyZWQgRGVwZW5kZW5jaWVzOiBOb25lCiAgICAgICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBmdW5jCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIEFkZC1XaW4zMlR5cGUgZW5hYmxlcyB5b3UgdG8gZWFzaWx5IGludGVyYWN0IHdpdGggdW5tYW5hZ2VkIChpLmUuCiAgICAgICAgV2luMzIgdW5tYW5hZ2VkKSBmdW5jdGlvbnMgaW4gUG93ZXJTaGVsbC4gQWZ0ZXIgcHJvdmlkaW5nCiAgICAgICAgQWRkLVdpbjMyVHlwZSB3aXRoIGEgZnVuY3Rpb24gc2lnbmF0dXJlLCBhIC5ORVQgdHlwZSBpcyBjcmVhdGVkCiAgICAgICAgdXNpbmcgcmVmbGVjdGlvbiAoaS5lLiBjc2MuZXhlIGlzIG5ldmVyIGNhbGxlZCBsaWtlIHdpdGggQWRkLVR5cGUpLgoKICAgICAgICBUaGUgJ2Z1bmMnIGhlbHBlciBmdW5jdGlvbiBjYW4gYmUgdXNlZCB0byByZWR1Y2UgdHlwaW5nIHdoZW4gZGVmaW5pbmcKICAgICAgICBtdWx0aXBsZSBmdW5jdGlvbiBkZWZpbml0aW9ucy4KCiAgICAuUEFSQU1FVEVSIERsbE5hbWUKCiAgICAgICAgVGhlIG5hbWUgb2YgdGhlIERMTC4KCiAgICAuUEFSQU1FVEVSIEZ1bmN0aW9uTmFtZQoKICAgICAgICBUaGUgbmFtZSBvZiB0aGUgdGFyZ2V0IGZ1bmN0aW9uLgoKICAgIC5QQVJBTUVURVIgUmV0dXJuVHlwZQoKICAgICAgICBUaGUgcmV0dXJuIHR5cGUgb2YgdGhlIGZ1bmN0aW9uLgoKICAgIC5QQVJBTUVURVIgUGFyYW1ldGVyVHlwZXMKCiAgICAgICAgVGhlIGZ1bmN0aW9uIHBhcmFtZXRlcnMuCgogICAgLlBBUkFNRVRFUiBOYXRpdmVDYWxsaW5nQ29udmVudGlvbgoKICAgICAgICBTcGVjaWZpZXMgdGhlIG5hdGl2ZSBjYWxsaW5nIGNvbnZlbnRpb24gb2YgdGhlIGZ1bmN0aW9uLiBEZWZhdWx0cyB0bwogICAgICAgIHN0ZGNhbGwuCgogICAgLlBBUkFNRVRFUiBDaGFyc2V0CgogICAgICAgIElmIHlvdSBuZWVkIHRvIGV4cGxpY2l0bHkgY2FsbCBhbiAnQScgb3IgJ1cnIFdpbjMyIGZ1bmN0aW9uLCB5b3UgY2FuCiAgICAgICAgc3BlY2lmeSB0aGUgY2hhcmFjdGVyIHNldC4KCiAgICAuUEFSQU1FVEVSIFNldExhc3RFcnJvcgoKICAgICAgICBJbmRpY2F0ZXMgd2hldGhlciB0aGUgY2FsbGVlIGNhbGxzIHRoZSBTZXRMYXN0RXJyb3IgV2luMzIgQVBJCiAgICAgICAgZnVuY3Rpb24gYmVmb3JlIHJldHVybmluZyBmcm9tIHRoZSBhdHRyaWJ1dGVkIG1ldGhvZC4KCiAgICAuUEFSQU1FVEVSIE1vZHVsZQoKICAgICAgICBUaGUgaW4tbWVtb3J5IG1vZHVsZSB0aGF0IHdpbGwgaG9zdCB0aGUgZnVuY3Rpb25zLiBVc2UKICAgICAgICBOZXctSW5NZW1vcnlNb2R1bGUgdG8gZGVmaW5lIGFuIGluLW1lbW9yeSBtb2R1bGUuCgogICAgLlBBUkFNRVRFUiBOYW1lc3BhY2UKCiAgICAgICAgQW4gb3B0aW9uYWwgbmFtZXNwYWNlIHRvIHByZXBlbmQgdG8gdGhlIHR5cGUuIEFkZC1XaW4zMlR5cGUgZGVmYXVsdHMKICAgICAgICB0byBhIG5hbWVzcGFjZSBjb25zaXN0aW5nIG9ubHkgb2YgdGhlIG5hbWUgb2YgdGhlIERMTC4KCiAgICAuRVhBTVBMRQoKICAgICAgICAkTW9kID0gTmV3LUluTWVtb3J5TW9kdWxlIC1Nb2R1bGVOYW1lIFdpbjMyCgogICAgICAgICRGdW5jdGlvbkRlZmluaXRpb25zID0gQCgKICAgICAgICAgIChmdW5jIGtlcm5lbDMyIEdldFByb2NBZGRyZXNzIChbSW50UHRyXSkgQChbSW50UHRyXSwgW1N0cmluZ10pIC1DaGFyc2V0IEFuc2kgLVNldExhc3RFcnJvciksCiAgICAgICAgICAoZnVuYyBrZXJuZWwzMiBHZXRNb2R1bGVIYW5kbGUgKFtJbnRwdHJdKSBAKFtTdHJpbmddKSAtU2V0TGFzdEVycm9yKSwKICAgICAgICAgIChmdW5jIG50ZGxsIFJ0bEdldEN1cnJlbnRQZWIgKFtJbnRQdHJdKSBAKCkpCiAgICAgICAgKQoKICAgICAgICAkVHlwZXMgPSAkRnVuY3Rpb25EZWZpbml0aW9ucyB8IEFkZC1XaW4zMlR5cGUgLU1vZHVsZSAkTW9kIC1OYW1lc3BhY2UgJ1dpbjMyJwogICAgICAgICRLZXJuZWwzMiA9ICRUeXBlc1sna2VybmVsMzInXQogICAgICAgICROdGRsbCA9ICRUeXBlc1snbnRkbGwnXQogICAgICAgICROdGRsbDo6UnRsR2V0Q3VycmVudFBlYigpCiAgICAgICAgJG50ZGxsYmFzZSA9ICRLZXJuZWwzMjo6R2V0TW9kdWxlSGFuZGxlKCdudGRsbCcpCiAgICAgICAgJEtlcm5lbDMyOjpHZXRQcm9jQWRkcmVzcygkbnRkbGxiYXNlLCAnUnRsR2V0Q3VycmVudFBlYicpCgogICAgLk5PVEVTCgogICAgICAgIEluc3BpcmVkIGJ5IExlZSBIb2xtZXMnIEludm9rZS1XaW5kb3dzQXBpIGh0dHA6Ly9wb3NoY29kZS5vcmcvMjE4OQoKICAgICAgICBXaGVuIGRlZmluaW5nIG11bHRpcGxlIGZ1bmN0aW9uIHByb3RvdHlwZXMsIGl0IGlzIGlkZWFsIHRvIHByb3ZpZGUKICAgICAgICBBZGQtV2luMzJUeXBlIHdpdGggYW4gYXJyYXkgb2YgZnVuY3Rpb24gc2lnbmF0dXJlcy4gVGhhdCB3YXksIHRoZXkKICAgICAgICBhcmUgYWxsIGluY29ycG9yYXRlZCBpbnRvIHRoZSBzYW1lIGluLW1lbW9yeSBtb2R1bGUuCiM+CgogICAgW091dHB1dFR5cGUoW0hhc2h0YWJsZV0pXQogICAgUGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREbGxOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZ1bmN0aW9uTmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbVHlwZV0KICAgICAgICAkUmV0dXJuVHlwZSwKCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQogICAgICAgIFtUeXBlW11dCiAgICAgICAgJFBhcmFtZXRlclR5cGVzLAoKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWUgPSAkVHJ1ZSldCiAgICAgICAgW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkNhbGxpbmdDb252ZW50aW9uXQogICAgICAgICROYXRpdmVDYWxsaW5nQ29udmVudGlvbiA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5DYWxsaW5nQ29udmVudGlvbl06OlN0ZENhbGwsCgogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuQ2hhclNldF0KICAgICAgICAkQ2hhcnNldCA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5DaGFyU2V0XTo6QXV0bywKCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNldExhc3RFcnJvciwKCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHsoJF8gLWlzIFtSZWZsZWN0aW9uLkVtaXQuTW9kdWxlQnVpbGRlcl0pIC1vciAoJF8gLWlzIFtSZWZsZWN0aW9uLkFzc2VtYmx5XSl9KV0KICAgICAgICAkTW9kdWxlLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsKCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkTmFtZXNwYWNlID0gJycKICAgICkKCiAgICBCRUdJTgogICAgewogICAgICAgICRUeXBlSGFzaCA9IEB7fQogICAgfQoKICAgIFBST0NFU1MKICAgIHsKICAgICAgICBpZiAoJE1vZHVsZSAtaXMgW1JlZmxlY3Rpb24uQXNzZW1ibHldKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKCROYW1lc3BhY2UpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRUeXBlSGFzaFskRGxsTmFtZV0gPSAkTW9kdWxlLkdldFR5cGUoIiROYW1lc3BhY2UuJERsbE5hbWUiKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJFR5cGVIYXNoWyREbGxOYW1lXSA9ICRNb2R1bGUuR2V0VHlwZSgkRGxsTmFtZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICAjIERlZmluZSBvbmUgdHlwZSBmb3IgZWFjaCBETEwKICAgICAgICAgICAgaWYgKCEkVHlwZUhhc2guQ29udGFpbnNLZXkoJERsbE5hbWUpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoJE5hbWVzcGFjZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkVHlwZUhhc2hbJERsbE5hbWVdID0gJE1vZHVsZS5EZWZpbmVUeXBlKCIkTmFtZXNwYWNlLiREbGxOYW1lIiwgJ1B1YmxpYyxCZWZvcmVGaWVsZEluaXQnKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRUeXBlSGFzaFskRGxsTmFtZV0gPSAkTW9kdWxlLkRlZmluZVR5cGUoJERsbE5hbWUsICdQdWJsaWMsQmVmb3JlRmllbGRJbml0JykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE1ldGhvZCA9ICRUeXBlSGFzaFskRGxsTmFtZV0uRGVmaW5lTWV0aG9kKAogICAgICAgICAgICAgICAgJEZ1bmN0aW9uTmFtZSwKICAgICAgICAgICAgICAgICdQdWJsaWMsU3RhdGljLFBpbnZva2VJbXBsJywKICAgICAgICAgICAgICAgICRSZXR1cm5UeXBlLAogICAgICAgICAgICAgICAgJFBhcmFtZXRlclR5cGVzKQoKICAgICAgICAgICAgIyBNYWtlIGVhY2ggQnlSZWYgcGFyYW1ldGVyIGFuIE91dCBwYXJhbWV0ZXIKICAgICAgICAgICAgJGkgPSAxCiAgICAgICAgICAgIEZvckVhY2goJFBhcmFtZXRlciBpbiAkUGFyYW1ldGVyVHlwZXMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICgkUGFyYW1ldGVyLklzQnlSZWYpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgW3ZvaWRdICRNZXRob2QuRGVmaW5lUGFyYW1ldGVyKCRpLCAnT3V0JywgJE51bGwpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGkrKwogICAgICAgICAgICB9CgogICAgICAgICAgICAkRGxsSW1wb3J0ID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkRsbEltcG9ydEF0dHJpYnV0ZV0KICAgICAgICAgICAgJFNldExhc3RFcnJvckZpZWxkID0gJERsbEltcG9ydC5HZXRGaWVsZCgnU2V0TGFzdEVycm9yJykKICAgICAgICAgICAgJENhbGxpbmdDb252ZW50aW9uRmllbGQgPSAkRGxsSW1wb3J0LkdldEZpZWxkKCdDYWxsaW5nQ29udmVudGlvbicpCiAgICAgICAgICAgICRDaGFyc2V0RmllbGQgPSAkRGxsSW1wb3J0LkdldEZpZWxkKCdDaGFyU2V0JykKICAgICAgICAgICAgaWYgKCRTZXRMYXN0RXJyb3IpIHsgJFNMRVZhbHVlID0gJFRydWUgfSBlbHNlIHsgJFNMRVZhbHVlID0gJEZhbHNlIH0KCiAgICAgICAgICAgICMgRXF1aXZhbGVudCB0byBDIyB2ZXJzaW9uIG9mIFtEbGxJbXBvcnQoRGxsTmFtZSldCiAgICAgICAgICAgICRDb25zdHJ1Y3RvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5EbGxJbXBvcnRBdHRyaWJ1dGVdLkdldENvbnN0cnVjdG9yKFtTdHJpbmddKQogICAgICAgICAgICAkRGxsSW1wb3J0QXR0cmlidXRlID0gTmV3LU9iamVjdCBSZWZsZWN0aW9uLkVtaXQuQ3VzdG9tQXR0cmlidXRlQnVpbGRlcigkQ29uc3RydWN0b3IsCiAgICAgICAgICAgICAgICAkRGxsTmFtZSwgW1JlZmxlY3Rpb24uUHJvcGVydHlJbmZvW11dIEAoKSwgW09iamVjdFtdXSBAKCksCiAgICAgICAgICAgICAgICBbUmVmbGVjdGlvbi5GaWVsZEluZm9bXV0gQCgkU2V0TGFzdEVycm9yRmllbGQsICRDYWxsaW5nQ29udmVudGlvbkZpZWxkLCAkQ2hhcnNldEZpZWxkKSwKICAgICAgICAgICAgICAgIFtPYmplY3RbXV0gQCgkU0xFVmFsdWUsIChbUnVudGltZS5JbnRlcm9wU2VydmljZXMuQ2FsbGluZ0NvbnZlbnRpb25dICROYXRpdmVDYWxsaW5nQ29udmVudGlvbiksIChbUnVudGltZS5JbnRlcm9wU2VydmljZXMuQ2hhclNldF0gJENoYXJzZXQpKSkKCiAgICAgICAgICAgICRNZXRob2QuU2V0Q3VzdG9tQXR0cmlidXRlKCREbGxJbXBvcnRBdHRyaWJ1dGUpCiAgICAgICAgfQogICAgfQoKICAgIEVORAogICAgewogICAgICAgIGlmICgkTW9kdWxlIC1pcyBbUmVmbGVjdGlvbi5Bc3NlbWJseV0pCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gJFR5cGVIYXNoCiAgICAgICAgfQoKICAgICAgICAkUmV0dXJuVHlwZXMgPSBAe30KCiAgICAgICAgRm9yRWFjaCAoJEtleSBpbiAkVHlwZUhhc2guS2V5cykKICAgICAgICB7CiAgICAgICAgICAgICRUeXBlID0gJFR5cGVIYXNoWyRLZXldLkNyZWF0ZVR5cGUoKQoKICAgICAgICAgICAgJFJldHVyblR5cGVzWyRLZXldID0gJFR5cGUKICAgICAgICB9CgogICAgICAgIHJldHVybiAkUmV0dXJuVHlwZXMKICAgIH0KfQoKCmZ1bmN0aW9uIHBzZW51bQp7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQ3JlYXRlcyBhbiBpbi1tZW1vcnkgZW51bWVyYXRpb24gZm9yIHVzZSBpbiB5b3VyIFBvd2VyU2hlbGwgc2Vzc2lvbi4KCiAgICAgICAgQXV0aG9yOiBNYXR0aGV3IEdyYWViZXIgKEBtYXR0aWZlc3RhdGlvbikKICAgICAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgICAgICBSZXF1aXJlZCBEZXBlbmRlbmNpZXM6IE5vbmUKICAgICAgICBPcHRpb25hbCBEZXBlbmRlbmNpZXM6IE5vbmUKICAgICAKICAgIC5ERVNDUklQVElPTgoKICAgICAgICBUaGUgJ3BzZW51bScgZnVuY3Rpb24gZmFjaWxpdGF0ZXMgdGhlIGNyZWF0aW9uIG9mIGVudW1zIGVudGlyZWx5IGluCiAgICAgICAgbWVtb3J5IHVzaW5nIGFzIGNsb3NlIHRvIGEgIkMgc3R5bGUiIGFzIFBvd2VyU2hlbGwgd2lsbCBhbGxvdy4KCiAgICAuUEFSQU1FVEVSIE1vZHVsZQoKICAgICAgICBUaGUgaW4tbWVtb3J5IG1vZHVsZSB0aGF0IHdpbGwgaG9zdCB0aGUgZW51bS4gVXNlCiAgICAgICAgTmV3LUluTWVtb3J5TW9kdWxlIHRvIGRlZmluZSBhbiBpbi1tZW1vcnkgbW9kdWxlLgoKICAgIC5QQVJBTUVURVIgRnVsbE5hbWUKCiAgICAgICAgVGhlIGZ1bGx5LXF1YWxpZmllZCBuYW1lIG9mIHRoZSBlbnVtLgoKICAgIC5QQVJBTUVURVIgVHlwZQoKICAgICAgICBUaGUgdHlwZSBvZiBlYWNoIGVudW0gZWxlbWVudC4KCiAgICAuUEFSQU1FVEVSIEVudW1FbGVtZW50cwoKICAgICAgICBBIGhhc2h0YWJsZSBvZiBlbnVtIGVsZW1lbnRzLgoKICAgIC5QQVJBTUVURVIgQml0ZmllbGQKCiAgICAgICAgU3BlY2lmaWVzIHRoYXQgdGhlIGVudW0gc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYSBiaXRmaWVsZC4KCiAgICAuRVhBTVBMRQoKICAgICAgICAkTW9kID0gTmV3LUluTWVtb3J5TW9kdWxlIC1Nb2R1bGVOYW1lIFdpbjMyCgogICAgICAgICRJbWFnZVN1YnN5c3RlbSA9IHBzZW51bSAkTW9kIFBFLklNQUdFX1NVQlNZU1RFTSBVSW50MTYgQHsKICAgICAgICAgICAgVU5LTk9XTiA9ICAgICAgICAgICAgICAgICAgMAogICAgICAgICAgICBOQVRJVkUgPSAgICAgICAgICAgICAgICAgICAxICMgSW1hZ2UgZG9lc24ndCByZXF1aXJlIGEgc3Vic3lzdGVtLgogICAgICAgICAgICBXSU5ET1dTX0dVSSA9ICAgICAgICAgICAgICAyICMgSW1hZ2UgcnVucyBpbiB0aGUgV2luZG93cyBHVUkgc3Vic3lzdGVtLgogICAgICAgICAgICBXSU5ET1dTX0NVSSA9ICAgICAgICAgICAgICAzICMgSW1hZ2UgcnVucyBpbiB0aGUgV2luZG93cyBjaGFyYWN0ZXIgc3Vic3lzdGVtLgogICAgICAgICAgICBPUzJfQ1VJID0gICAgICAgICAgICAgICAgICA1ICMgSW1hZ2UgcnVucyBpbiB0aGUgT1MvMiBjaGFyYWN0ZXIgc3Vic3lzdGVtLgogICAgICAgICAgICBQT1NJWF9DVUkgPSAgICAgICAgICAgICAgICA3ICMgSW1hZ2UgcnVucyBpbiB0aGUgUG9zaXggY2hhcmFjdGVyIHN1YnN5c3RlbS4KICAgICAgICAgICAgTkFUSVZFX1dJTkRPV1MgPSAgICAgICAgICAgOCAjIEltYWdlIGlzIGEgbmF0aXZlIFdpbjl4IGRyaXZlci4KICAgICAgICAgICAgV0lORE9XU19DRV9HVUkgPSAgICAgICAgICAgOSAjIEltYWdlIHJ1bnMgaW4gdGhlIFdpbmRvd3MgQ0Ugc3Vic3lzdGVtLgogICAgICAgICAgICBFRklfQVBQTElDQVRJT04gPSAgICAgICAgICAxMAogICAgICAgICAgICBFRklfQk9PVF9TRVJWSUNFX0RSSVZFUiA9ICAxMQogICAgICAgICAgICBFRklfUlVOVElNRV9EUklWRVIgPSAgICAgICAxMgogICAgICAgICAgICBFRklfUk9NID0gICAgICAgICAgICAgICAgICAxMwogICAgICAgICAgICBYQk9YID0gICAgICAgICAgICAgICAgICAgICAxNAogICAgICAgICAgICBXSU5ET1dTX0JPT1RfQVBQTElDQVRJT04gPSAxNgogICAgICAgIH0KCiAgICAuTk9URVMKCiAgICAgICAgUG93ZXJTaGVsbCBwdXJpc3RzIG1heSBkaXNhZ3JlZSB3aXRoIHRoZSBuYW1pbmcgb2YgdGhpcyBmdW5jdGlvbiBidXQKICAgICAgICBhZ2FpbiwgdGhpcyB3YXMgZGV2ZWxvcGVkIGluIHN1Y2ggYSB3YXkgc28gYXMgdG8gZW11bGF0ZSBhICJDIHN0eWxlIgogICAgICAgIGRlZmluaXRpb24gYXMgY2xvc2VseSBhcyBwb3NzaWJsZS4gU29ycnksIEknbSBub3QgZ29pbmcgdG8gbmFtZSBpdAogICAgICAgIE5ldy1FbnVtLiA6UAojPgoKICAgIFtPdXRwdXRUeXBlKFtUeXBlXSldCiAgICBQYXJhbQogICAgKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAwLCBNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHsoJF8gLWlzIFtSZWZsZWN0aW9uLkVtaXQuTW9kdWxlQnVpbGRlcl0pIC1vciAoJF8gLWlzIFtSZWZsZWN0aW9uLkFzc2VtYmx5XSl9KV0KICAgICAgICAkTW9kdWxlLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMSwgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRnVsbE5hbWUsCgogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAyLCBNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1R5cGVdCiAgICAgICAgJFR5cGUsCgogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAzLCBNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbSGFzaHRhYmxlXQogICAgICAgICRFbnVtRWxlbWVudHMsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEJpdGZpZWxkCiAgICApCgogICAgaWYgKCRNb2R1bGUgLWlzIFtSZWZsZWN0aW9uLkFzc2VtYmx5XSkKICAgIHsKICAgICAgICByZXR1cm4gKCRNb2R1bGUuR2V0VHlwZSgkRnVsbE5hbWUpKQogICAgfQoKICAgICRFbnVtVHlwZSA9ICRUeXBlIC1hcyBbVHlwZV0KCiAgICAkRW51bUJ1aWxkZXIgPSAkTW9kdWxlLkRlZmluZUVudW0oJEZ1bGxOYW1lLCAnUHVibGljJywgJEVudW1UeXBlKQoKICAgIGlmICgkQml0ZmllbGQpCiAgICB7CiAgICAgICAgJEZsYWdzQ29uc3RydWN0b3IgPSBbRmxhZ3NBdHRyaWJ1dGVdLkdldENvbnN0cnVjdG9yKEAoKSkKICAgICAgICAkRmxhZ3NDdXN0b21BdHRyaWJ1dGUgPSBOZXctT2JqZWN0IFJlZmxlY3Rpb24uRW1pdC5DdXN0b21BdHRyaWJ1dGVCdWlsZGVyKCRGbGFnc0NvbnN0cnVjdG9yLCBAKCkpCiAgICAgICAgJEVudW1CdWlsZGVyLlNldEN1c3RvbUF0dHJpYnV0ZSgkRmxhZ3NDdXN0b21BdHRyaWJ1dGUpCiAgICB9CgogICAgRm9yRWFjaCAoJEtleSBpbiAkRW51bUVsZW1lbnRzLktleXMpCiAgICB7CiAgICAgICAgIyBBcHBseSB0aGUgc3BlY2lmaWVkIGVudW0gdHlwZSB0byBlYWNoIGVsZW1lbnQKICAgICAgICAkTnVsbCA9ICRFbnVtQnVpbGRlci5EZWZpbmVMaXRlcmFsKCRLZXksICRFbnVtRWxlbWVudHNbJEtleV0gLWFzICRFbnVtVHlwZSkKICAgIH0KCiAgICAkRW51bUJ1aWxkZXIuQ3JlYXRlVHlwZSgpCn0KCgojIEEgaGVscGVyIGZ1bmN0aW9uIHVzZWQgdG8gcmVkdWNlIHR5cGluZyB3aGlsZSBkZWZpbmluZyBzdHJ1Y3QKIyBmaWVsZHMuCmZ1bmN0aW9uIGZpZWxkCnsKICAgIFBhcmFtCiAgICAoCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDAsIE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbVUludDE2XQogICAgICAgICRQb3NpdGlvbiwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDEsIE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbVHlwZV0KICAgICAgICAkVHlwZSwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDIpXQogICAgICAgIFtVSW50MTZdCiAgICAgICAgJE9mZnNldCwKCiAgICAgICAgW09iamVjdFtdXQogICAgICAgICRNYXJzaGFsQXMKICAgICkKCiAgICBAewogICAgICAgIFBvc2l0aW9uID0gJFBvc2l0aW9uCiAgICAgICAgVHlwZSA9ICRUeXBlIC1hcyBbVHlwZV0KICAgICAgICBPZmZzZXQgPSAkT2Zmc2V0CiAgICAgICAgTWFyc2hhbEFzID0gJE1hcnNoYWxBcwogICAgfQp9CgoKZnVuY3Rpb24gc3RydWN0CnsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBDcmVhdGVzIGFuIGluLW1lbW9yeSBzdHJ1Y3QgZm9yIHVzZSBpbiB5b3VyIFBvd2VyU2hlbGwgc2Vzc2lvbi4KCiAgICAgICAgQXV0aG9yOiBNYXR0aGV3IEdyYWViZXIgKEBtYXR0aWZlc3RhdGlvbikKICAgICAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgICAgICBSZXF1aXJlZCBEZXBlbmRlbmNpZXM6IE5vbmUKICAgICAgICBPcHRpb25hbCBEZXBlbmRlbmNpZXM6IGZpZWxkCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFRoZSAnc3RydWN0JyBmdW5jdGlvbiBmYWNpbGl0YXRlcyB0aGUgY3JlYXRpb24gb2Ygc3RydWN0cyBlbnRpcmVseSBpbgogICAgICAgIG1lbW9yeSB1c2luZyBhcyBjbG9zZSB0byBhICJDIHN0eWxlIiBhcyBQb3dlclNoZWxsIHdpbGwgYWxsb3cuIFN0cnVjdAogICAgICAgIGZpZWxkcyBhcmUgc3BlY2lmaWVkIHVzaW5nIGEgaGFzaHRhYmxlIHdoZXJlIGVhY2ggZmllbGQgb2YgdGhlIHN0cnVjdAogICAgICAgIGlzIGNvbXByb3NlZCBvZiB0aGUgb3JkZXIgaW4gd2hpY2ggaXQgc2hvdWxkIGJlIGRlZmluZWQsIGl0cyAuTkVUCiAgICAgICAgdHlwZSwgYW5kIG9wdGlvbmFsbHksIGl0cyBvZmZzZXQgYW5kIHNwZWNpYWwgbWFyc2hhbGluZyBhdHRyaWJ1dGVzLgoKICAgICAgICBPbmUgb2YgdGhlIGZlYXR1cmVzIG9mICdzdHJ1Y3QnIGlzIHRoYXQgYWZ0ZXIgeW91ciBzdHJ1Y3QgaXMgZGVmaW5lZCwKICAgICAgICBpdCB3aWxsIGNvbWUgd2l0aCBhIGJ1aWx0LWluIEdldFNpemUgbWV0aG9kIGFzIHdlbGwgYXMgYW4gZXhwbGljaXQKICAgICAgICBjb252ZXJ0ZXIgc28gdGhhdCB5b3UgY2FuIGVhc2lseSBjYXN0IGFuIEludFB0ciB0byB0aGUgc3RydWN0IHdpdGhvdXQKICAgICAgICByZWx5aW5nIHVwb24gY2FsbGluZyBTaXplT2YgYW5kL29yIFB0clRvU3RydWN0dXJlIGluIHRoZSBNYXJzaGFsCiAgICAgICAgY2xhc3MuCgogICAgLlBBUkFNRVRFUiBNb2R1bGUKCiAgICAgICAgVGhlIGluLW1lbW9yeSBtb2R1bGUgdGhhdCB3aWxsIGhvc3QgdGhlIHN0cnVjdC4gVXNlCiAgICAgICAgTmV3LUluTWVtb3J5TW9kdWxlIHRvIGRlZmluZSBhbiBpbi1tZW1vcnkgbW9kdWxlLgoKICAgIC5QQVJBTUVURVIgRnVsbE5hbWUKCiAgICAgICAgVGhlIGZ1bGx5LXF1YWxpZmllZCBuYW1lIG9mIHRoZSBzdHJ1Y3QuCgogICAgLlBBUkFNRVRFUiBTdHJ1Y3RGaWVsZHMKCiAgICAgICAgQSBoYXNodGFibGUgb2YgZmllbGRzLiBVc2UgdGhlICdmaWVsZCcgaGVscGVyIGZ1bmN0aW9uIHRvIGVhc2UKICAgICAgICBkZWZpbmluZyBlYWNoIGZpZWxkLgoKICAgIC5QQVJBTUVURVIgUGFja2luZ1NpemUKCiAgICAgICAgU3BlY2lmaWVzIHRoZSBtZW1vcnkgYWxpZ25tZW50IG9mIGZpZWxkcy4KCiAgICAuUEFSQU1FVEVSIEV4cGxpY2l0TGF5b3V0CgogICAgICAgIEluZGljYXRlcyB0aGF0IGFuIGV4cGxpY2l0IG9mZnNldCBmb3IgZWFjaCBmaWVsZCB3aWxsIGJlIHNwZWNpZmllZC4KCiAgICAuRVhBTVBMRQoKICAgICAgICAkTW9kID0gTmV3LUluTWVtb3J5TW9kdWxlIC1Nb2R1bGVOYW1lIFdpbjMyCgogICAgICAgICRJbWFnZURvc1NpZ25hdHVyZSA9IHBzZW51bSAkTW9kIFBFLklNQUdFX0RPU19TSUdOQVRVUkUgVUludDE2IEB7CiAgICAgICAgICAgIERPU19TSUdOQVRVUkUgPSAgICAweDVBNEQKICAgICAgICAgICAgT1MyX1NJR05BVFVSRSA9ICAgIDB4NDU0RQogICAgICAgICAgICBPUzJfU0lHTkFUVVJFX0xFID0gMHg0NTRDCiAgICAgICAgICAgIFZYRF9TSUdOQVRVUkUgPSAgICAweDQ1NEMKICAgICAgICB9CgogICAgICAgICRJbWFnZURvc0hlYWRlciA9IHN0cnVjdCAkTW9kIFBFLklNQUdFX0RPU19IRUFERVIgQHsKICAgICAgICAgICAgZV9tYWdpYyA9ICAgIGZpZWxkIDAgJEltYWdlRG9zU2lnbmF0dXJlCiAgICAgICAgICAgIGVfY2JscCA9ICAgICBmaWVsZCAxIFVJbnQxNgogICAgICAgICAgICBlX2NwID0gICAgICAgZmllbGQgMiBVSW50MTYKICAgICAgICAgICAgZV9jcmxjID0gICAgIGZpZWxkIDMgVUludDE2CiAgICAgICAgICAgIGVfY3BhcmhkciA9ICBmaWVsZCA0IFVJbnQxNgogICAgICAgICAgICBlX21pbmFsbG9jID0gZmllbGQgNSBVSW50MTYKICAgICAgICAgICAgZV9tYXhhbGxvYyA9IGZpZWxkIDYgVUludDE2CiAgICAgICAgICAgIGVfc3MgPSAgICAgICBmaWVsZCA3IFVJbnQxNgogICAgICAgICAgICBlX3NwID0gICAgICAgZmllbGQgOCBVSW50MTYKICAgICAgICAgICAgZV9jc3VtID0gICAgIGZpZWxkIDkgVUludDE2CiAgICAgICAgICAgIGVfaXAgPSAgICAgICBmaWVsZCAxMCBVSW50MTYKICAgICAgICAgICAgZV9jcyA9ICAgICAgIGZpZWxkIDExIFVJbnQxNgogICAgICAgICAgICBlX2xmYXJsYyA9ICAgZmllbGQgMTIgVUludDE2CiAgICAgICAgICAgIGVfb3ZubyA9ICAgICBmaWVsZCAxMyBVSW50MTYKICAgICAgICAgICAgZV9yZXMgPSAgICAgIGZpZWxkIDE0IFVJbnQxNltdIC1NYXJzaGFsQXMgQCgnQnlWYWxBcnJheScsIDQpCiAgICAgICAgICAgIGVfb2VtaWQgPSAgICBmaWVsZCAxNSBVSW50MTYKICAgICAgICAgICAgZV9vZW1pbmZvID0gIGZpZWxkIDE2IFVJbnQxNgogICAgICAgICAgICBlX3JlczIgPSAgICAgZmllbGQgMTcgVUludDE2W10gLU1hcnNoYWxBcyBAKCdCeVZhbEFycmF5JywgMTApCiAgICAgICAgICAgIGVfbGZhbmV3ID0gICBmaWVsZCAxOCBJbnQzMgogICAgICAgIH0KCiAgICAgICAgIyBFeGFtcGxlIG9mIHVzaW5nIGFuIGV4cGxpY2l0IGxheW91dCBpbiBvcmRlciB0byBjcmVhdGUgYSB1bmlvbi4KICAgICAgICAkVGVzdFVuaW9uID0gc3RydWN0ICRNb2QgVGVzdFVuaW9uIEB7CiAgICAgICAgICAgIGZpZWxkMSA9IGZpZWxkIDAgVUludDMyIDAKICAgICAgICAgICAgZmllbGQyID0gZmllbGQgMSBJbnRQdHIgMAogICAgICAgIH0gLUV4cGxpY2l0TGF5b3V0CgogICAgLk5PVEVTCgogICAgICAgIFBvd2VyU2hlbGwgcHVyaXN0cyBtYXkgZGlzYWdyZWUgd2l0aCB0aGUgbmFtaW5nIG9mIHRoaXMgZnVuY3Rpb24gYnV0CiAgICAgICAgYWdhaW4sIHRoaXMgd2FzIGRldmVsb3BlZCBpbiBzdWNoIGEgd2F5IHNvIGFzIHRvIGVtdWxhdGUgYSAiQyBzdHlsZSIKICAgICAgICBkZWZpbml0aW9uIGFzIGNsb3NlbHkgYXMgcG9zc2libGUuIFNvcnJ5LCBJJ20gbm90IGdvaW5nIHRvIG5hbWUgaXQKICAgICAgICBOZXctU3RydWN0LiA6UAojPgoKICAgIFtPdXRwdXRUeXBlKFtUeXBlXSldCiAgICBQYXJhbQogICAgKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAxLCBNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHsoJF8gLWlzIFtSZWZsZWN0aW9uLkVtaXQuTW9kdWxlQnVpbGRlcl0pIC1vciAoJF8gLWlzIFtSZWZsZWN0aW9uLkFzc2VtYmx5XSl9KV0KICAgICAgICAkTW9kdWxlLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMiwgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRnVsbE5hbWUsCgogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAzLCBNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbSGFzaHRhYmxlXQogICAgICAgICRTdHJ1Y3RGaWVsZHMsCgogICAgICAgIFtSZWZsZWN0aW9uLkVtaXQuUGFja2luZ1NpemVdCiAgICAgICAgJFBhY2tpbmdTaXplID0gW1JlZmxlY3Rpb24uRW1pdC5QYWNraW5nU2l6ZV06OlVuc3BlY2lmaWVkLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRFeHBsaWNpdExheW91dAogICAgKQoKICAgIGlmICgkTW9kdWxlIC1pcyBbUmVmbGVjdGlvbi5Bc3NlbWJseV0pCiAgICB7CiAgICAgICAgcmV0dXJuICgkTW9kdWxlLkdldFR5cGUoJEZ1bGxOYW1lKSkKICAgIH0KCiAgICBbUmVmbGVjdGlvbi5UeXBlQXR0cmlidXRlc10gJFN0cnVjdEF0dHJpYnV0ZXMgPSAnQW5zaUNsYXNzLAogICAgICAgIENsYXNzLAogICAgICAgIFB1YmxpYywKICAgICAgICBTZWFsZWQsCiAgICAgICAgQmVmb3JlRmllbGRJbml0JwoKICAgIGlmICgkRXhwbGljaXRMYXlvdXQpCiAgICB7CiAgICAgICAgJFN0cnVjdEF0dHJpYnV0ZXMgPSAkU3RydWN0QXR0cmlidXRlcyAtYm9yIFtSZWZsZWN0aW9uLlR5cGVBdHRyaWJ1dGVzXTo6RXhwbGljaXRMYXlvdXQKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICAkU3RydWN0QXR0cmlidXRlcyA9ICRTdHJ1Y3RBdHRyaWJ1dGVzIC1ib3IgW1JlZmxlY3Rpb24uVHlwZUF0dHJpYnV0ZXNdOjpTZXF1ZW50aWFsTGF5b3V0CiAgICB9CgogICAgJFN0cnVjdEJ1aWxkZXIgPSAkTW9kdWxlLkRlZmluZVR5cGUoJEZ1bGxOYW1lLCAkU3RydWN0QXR0cmlidXRlcywgW1ZhbHVlVHlwZV0sICRQYWNraW5nU2l6ZSkKICAgICRDb25zdHJ1Y3RvckluZm8gPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbEFzQXR0cmlidXRlXS5HZXRDb25zdHJ1Y3RvcnMoKVswXQogICAgJFNpemVDb25zdCA9IEAoW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxBc0F0dHJpYnV0ZV0uR2V0RmllbGQoJ1NpemVDb25zdCcpKQoKICAgICRGaWVsZHMgPSBOZXctT2JqZWN0IEhhc2h0YWJsZVtdKCRTdHJ1Y3RGaWVsZHMuQ291bnQpCgogICAgIyBTb3J0IGVhY2ggZmllbGQgYWNjb3JkaW5nIHRvIHRoZSBvcmRlcnMgc3BlY2lmaWVkCiAgICAjIFVuZm9ydHVuYXRlbHksIFBTdjIgZG9lc24ndCBoYXZlIHRoZSBsdXh1cnkgb2YgdGhlCiAgICAjIGhhc2h0YWJsZSBbT3JkZXJlZF0gYWNjZWxlcmF0b3IuCiAgICBGb3JFYWNoICgkRmllbGQgaW4gJFN0cnVjdEZpZWxkcy5LZXlzKQogICAgewogICAgICAgICRJbmRleCA9ICRTdHJ1Y3RGaWVsZHNbJEZpZWxkXVsnUG9zaXRpb24nXQogICAgICAgICRGaWVsZHNbJEluZGV4XSA9IEB7RmllbGROYW1lID0gJEZpZWxkOyBQcm9wZXJ0aWVzID0gJFN0cnVjdEZpZWxkc1skRmllbGRdfQogICAgfQoKICAgIEZvckVhY2ggKCRGaWVsZCBpbiAkRmllbGRzKQogICAgewogICAgICAgICRGaWVsZE5hbWUgPSAkRmllbGRbJ0ZpZWxkTmFtZSddCiAgICAgICAgJEZpZWxkUHJvcCA9ICRGaWVsZFsnUHJvcGVydGllcyddCgogICAgICAgICRPZmZzZXQgPSAkRmllbGRQcm9wWydPZmZzZXQnXQogICAgICAgICRUeXBlID0gJEZpZWxkUHJvcFsnVHlwZSddCiAgICAgICAgJE1hcnNoYWxBcyA9ICRGaWVsZFByb3BbJ01hcnNoYWxBcyddCgogICAgICAgICROZXdGaWVsZCA9ICRTdHJ1Y3RCdWlsZGVyLkRlZmluZUZpZWxkKCRGaWVsZE5hbWUsICRUeXBlLCAnUHVibGljJykKCiAgICAgICAgaWYgKCRNYXJzaGFsQXMpCiAgICAgICAgewogICAgICAgICAgICAkVW5tYW5hZ2VkVHlwZSA9ICRNYXJzaGFsQXNbMF0gLWFzIChbUnVudGltZS5JbnRlcm9wU2VydmljZXMuVW5tYW5hZ2VkVHlwZV0pCiAgICAgICAgICAgIGlmICgkTWFyc2hhbEFzWzFdKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkU2l6ZSA9ICRNYXJzaGFsQXNbMV0KICAgICAgICAgICAgICAgICRBdHRyaWJCdWlsZGVyID0gTmV3LU9iamVjdCBSZWZsZWN0aW9uLkVtaXQuQ3VzdG9tQXR0cmlidXRlQnVpbGRlcigkQ29uc3RydWN0b3JJbmZvLAogICAgICAgICAgICAgICAgICAgICRVbm1hbmFnZWRUeXBlLCAkU2l6ZUNvbnN0LCBAKCRTaXplKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRBdHRyaWJCdWlsZGVyID0gTmV3LU9iamVjdCBSZWZsZWN0aW9uLkVtaXQuQ3VzdG9tQXR0cmlidXRlQnVpbGRlcigkQ29uc3RydWN0b3JJbmZvLCBbT2JqZWN0W11dIEAoJFVubWFuYWdlZFR5cGUpKQogICAgICAgICAgICB9CgogICAgICAgICAgICAkTmV3RmllbGQuU2V0Q3VzdG9tQXR0cmlidXRlKCRBdHRyaWJCdWlsZGVyKQogICAgICAgIH0KCiAgICAgICAgaWYgKCRFeHBsaWNpdExheW91dCkgeyAkTmV3RmllbGQuU2V0T2Zmc2V0KCRPZmZzZXQpIH0KICAgIH0KCiAgICAjIE1ha2UgdGhlIHN0cnVjdCBhd2FyZSBvZiBpdHMgb3duIHNpemUuCiAgICAjIE5vIG1vcmUgaGF2aW5nIHRvIGNhbGwgW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpTaXplT2YhCiAgICAkU2l6ZU1ldGhvZCA9ICRTdHJ1Y3RCdWlsZGVyLkRlZmluZU1ldGhvZCgnR2V0U2l6ZScsCiAgICAgICAgJ1B1YmxpYywgU3RhdGljJywKICAgICAgICBbSW50XSwKICAgICAgICBbVHlwZVtdXSBAKCkpCiAgICAkSUxHZW5lcmF0b3IgPSAkU2l6ZU1ldGhvZC5HZXRJTEdlbmVyYXRvcigpCiAgICAjIFRoYW5rcyBmb3IgdGhlIGhlbHAsIEphc29uIFNoaXJrIQogICAgJElMR2VuZXJhdG9yLkVtaXQoW1JlZmxlY3Rpb24uRW1pdC5PcENvZGVzXTo6TGR0b2tlbiwgJFN0cnVjdEJ1aWxkZXIpCiAgICAkSUxHZW5lcmF0b3IuRW1pdChbUmVmbGVjdGlvbi5FbWl0Lk9wQ29kZXNdOjpDYWxsLAogICAgICAgIFtUeXBlXS5HZXRNZXRob2QoJ0dldFR5cGVGcm9tSGFuZGxlJykpCiAgICAkSUxHZW5lcmF0b3IuRW1pdChbUmVmbGVjdGlvbi5FbWl0Lk9wQ29kZXNdOjpDYWxsLAogICAgICAgIFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXS5HZXRNZXRob2QoJ1NpemVPZicsIFtUeXBlW11dIEAoW1R5cGVdKSkpCiAgICAkSUxHZW5lcmF0b3IuRW1pdChbUmVmbGVjdGlvbi5FbWl0Lk9wQ29kZXNdOjpSZXQpCgogICAgIyBBbGxvdyBmb3IgZXhwbGljaXQgY2FzdGluZyBmcm9tIGFuIEludFB0cgogICAgIyBObyBtb3JlIGhhdmluZyB0byBjYWxsIFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UHRyVG9TdHJ1Y3R1cmUhCiAgICAkSW1wbGljaXRDb252ZXJ0ZXIgPSAkU3RydWN0QnVpbGRlci5EZWZpbmVNZXRob2QoJ29wX0ltcGxpY2l0JywKICAgICAgICAnUHJpdmF0ZVNjb3BlLCBQdWJsaWMsIFN0YXRpYywgSGlkZUJ5U2lnLCBTcGVjaWFsTmFtZScsCiAgICAgICAgJFN0cnVjdEJ1aWxkZXIsCiAgICAgICAgW1R5cGVbXV0gQChbSW50UHRyXSkpCiAgICAkSUxHZW5lcmF0b3IyID0gJEltcGxpY2l0Q29udmVydGVyLkdldElMR2VuZXJhdG9yKCkKICAgICRJTEdlbmVyYXRvcjIuRW1pdChbUmVmbGVjdGlvbi5FbWl0Lk9wQ29kZXNdOjpOb3ApCiAgICAkSUxHZW5lcmF0b3IyLkVtaXQoW1JlZmxlY3Rpb24uRW1pdC5PcENvZGVzXTo6TGRhcmdfMCkKICAgICRJTEdlbmVyYXRvcjIuRW1pdChbUmVmbGVjdGlvbi5FbWl0Lk9wQ29kZXNdOjpMZHRva2VuLCAkU3RydWN0QnVpbGRlcikKICAgICRJTEdlbmVyYXRvcjIuRW1pdChbUmVmbGVjdGlvbi5FbWl0Lk9wQ29kZXNdOjpDYWxsLAogICAgICAgIFtUeXBlXS5HZXRNZXRob2QoJ0dldFR5cGVGcm9tSGFuZGxlJykpCiAgICAkSUxHZW5lcmF0b3IyLkVtaXQoW1JlZmxlY3Rpb24uRW1pdC5PcENvZGVzXTo6Q2FsbCwKICAgICAgICBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF0uR2V0TWV0aG9kKCdQdHJUb1N0cnVjdHVyZScsIFtUeXBlW11dIEAoW0ludFB0cl0sIFtUeXBlXSkpKQogICAgJElMR2VuZXJhdG9yMi5FbWl0KFtSZWZsZWN0aW9uLkVtaXQuT3BDb2Rlc106OlVuYm94X0FueSwgJFN0cnVjdEJ1aWxkZXIpCiAgICAkSUxHZW5lcmF0b3IyLkVtaXQoW1JlZmxlY3Rpb24uRW1pdC5PcENvZGVzXTo6UmV0KQoKICAgICRTdHJ1Y3RCdWlsZGVyLkNyZWF0ZVR5cGUoKQp9CgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojIE1pc2MuIGhlbHBlcnMKIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZmlsdGVyIEdldC1JbmlDb250ZW50IHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGhlbHBlciBwYXJzZXMgYW4gLmluaSBmaWxlIGludG8gYSBwcm9wZXIgUG93ZXJTaGVsbCBvYmplY3QuCiAgICAgICAgCiAgICAgICAgQXV0aG9yOiAnVGhlIFNjcmlwdGluZyBHdXlzJwogICAgICAgIExpbms6IGh0dHBzOi8vYmxvZ3MudGVjaG5ldC5taWNyb3NvZnQuY29tL2hleXNjcmlwdGluZ2d1eS8yMDExLzA4LzIwL3VzZS1wb3dlcnNoZWxsLXRvLXdvcmstd2l0aC1hbnktaW5pLWZpbGUvCgogICAgLkxJTksKCiAgICAgICAgaHR0cHM6Ly9ibG9ncy50ZWNobmV0Lm1pY3Jvc29mdC5jb20vaGV5c2NyaXB0aW5nZ3V5LzIwMTEvMDgvMjAvdXNlLXBvd2Vyc2hlbGwtdG8td29yay13aXRoLWFueS1pbmktZmlsZS8KIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JFRydWUpXQogICAgICAgIFtBbGlhcygnRnVsbE5hbWUnKV0KICAgICAgICBbVmFsaWRhdGVTY3JpcHQoeyBUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgICRQYXRoCiAgICApCgogICAgRm9yRWFjaCgkVGFyZ2V0UGF0aCBpbiAkUGF0aCkgewogICAgICAgICRJbmlPYmplY3QgPSBAe30KICAgICAgICBTd2l0Y2ggLVJlZ2V4IC1GaWxlICRUYXJnZXRQYXRoIHsKICAgICAgICAgICAgIl5cWyguKylcXSIgIyBTZWN0aW9uCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRTZWN0aW9uID0gJG1hdGNoZXNbMV0uVHJpbSgpCiAgICAgICAgICAgICAgICAkSW5pT2JqZWN0WyRTZWN0aW9uXSA9IEB7fQogICAgICAgICAgICAgICAgJENvbW1lbnRDb3VudCA9IDAKICAgICAgICAgICAgfQogICAgICAgICAgICAiXig7LiopJCIgIyBDb21tZW50CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRWYWx1ZSA9ICRtYXRjaGVzWzFdLlRyaW0oKQogICAgICAgICAgICAgICAgJENvbW1lbnRDb3VudCA9ICRDb21tZW50Q291bnQgKyAxCiAgICAgICAgICAgICAgICAkTmFtZSA9ICdDb21tZW50JyArICRDb21tZW50Q291bnQKICAgICAgICAgICAgICAgICRJbmlPYmplY3RbJFNlY3Rpb25dWyROYW1lXSA9ICRWYWx1ZQogICAgICAgICAgICB9IAogICAgICAgICAgICAiKC4rPylccyo9KC4qKSIgIyBLZXkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJE5hbWUsICRWYWx1ZSA9ICRtYXRjaGVzWzEuLjJdCiAgICAgICAgICAgICAgICAkTmFtZSA9ICROYW1lLlRyaW0oKQogICAgICAgICAgICAgICAgJFZhbHVlcyA9ICRWYWx1ZS5zcGxpdCgnLCcpIHwgRm9yRWFjaC1PYmplY3QgeyRfLlRyaW0oKX0KICAgICAgICAgICAgICAgIGlmKCRWYWx1ZXMgLWlzbm90IFtTeXN0ZW0uQXJyYXldKSB7JFZhbHVlcyA9IEAoJFZhbHVlcyl9CiAgICAgICAgICAgICAgICAkSW5pT2JqZWN0WyRTZWN0aW9uXVskTmFtZV0gPSAkVmFsdWVzCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJEluaU9iamVjdAogICAgfQp9CgpmaWx0ZXIgRXhwb3J0LVBvd2VyVmlld0NTViB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBoZWxwZXIgZXhwb3J0cyBhbiAtSW5wdXRPYmplY3QgdG8gYSAuY3N2IGluIGEgdGhyZWFkLXNhZmUgbWFubmVyCiAgICAgICAgdXNpbmcgYSBtdXRleC4gVGhpcyBpcyBzbyB0aGUgdmFyaW91cyBtdWx0aS10aHJlYWRlZCBmdW5jdGlvbnMgaW4KICAgICAgICBQb3dlclZpZXcgaGFzIGEgdGhyZWFkLXNhZmUgd2F5IHRvIGV4cG9ydCBvdXRwdXQgdG8gdGhlIHNhbWUgZmlsZS4KICAgICAgICAKICAgICAgICBCYXNlZCBwYXJ0aWFsbHkgb24gRG1pdHJ5IFNvdG5pa292J3MgRXhwb3J0LUNTViBjb2RlCiAgICAgICAgICAgIGF0IGh0dHA6Ly9wb3NoY29kZS5vcmcvMTU5MAoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly9wb3NoY29kZS5vcmcvMTU5MAogICAgICAgIGh0dHA6Ly9kbWl0cnlzb3RuaWtvdi53b3JkcHJlc3MuY29tLzIwMTAvMDEvMTkvRXhwb3J0LUNzdi1hcHBlbmQvCiM+CiAgICBQYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JFRydWUpXQogICAgICAgIFtTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTT2JqZWN0W11dCiAgICAgICAgJElucHV0T2JqZWN0LAoKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgUG9zaXRpb249MCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRPdXRGaWxlCiAgICApCgogICAgJE9iamVjdENTViA9ICRJbnB1dE9iamVjdCB8IENvbnZlcnRUby1Dc3YgLU5vVHlwZUluZm9ybWF0aW9uCgogICAgIyBtdXRleCBzbyB0aHJlYWRlZCBjb2RlIGRvZXNuJ3Qgc3RvbXAgb24gdGhlIG91dHB1dCBmaWxlCiAgICAkTXV0ZXggPSBOZXctT2JqZWN0IFN5c3RlbS5UaHJlYWRpbmcuTXV0ZXggJEZhbHNlLCdDU1ZNdXRleCc7CiAgICAkTnVsbCA9ICRNdXRleC5XYWl0T25lKCkKCiAgICBpZiAoVGVzdC1QYXRoIC1QYXRoICRPdXRGaWxlKSB7CiAgICAgICAgIyBoYWNrIHRvIHNraXAgdGhlIGZpcnN0IGxpbmUgb2Ygb3V0cHV0IGlmIHRoZSBmaWxlIGFscmVhZHkgZXhpc3RzCiAgICAgICAgJE9iamVjdENTViB8IEZvckVhY2gtT2JqZWN0IHsgJFN0YXJ0PSRUcnVlIH17IGlmICgkU3RhcnQpIHskU3RhcnQ9JEZhbHNlfSBlbHNlIHskX30gfSB8IE91dC1GaWxlIC1FbmNvZGluZyAnQVNDSUknIC1BcHBlbmQgLUZpbGVQYXRoICRPdXRGaWxlCiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkT2JqZWN0Q1NWIHwgT3V0LUZpbGUgLUVuY29kaW5nICdBU0NJSScgLUFwcGVuZCAtRmlsZVBhdGggJE91dEZpbGUKICAgIH0KCiAgICAkTXV0ZXguUmVsZWFzZU11dGV4KCkKfQoKCmZpbHRlciBHZXQtSVBBZGRyZXNzIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXNvbHZlcyBhIGdpdmVuIGhvc3RlbmFtZSB0byBpdHMgYXNzb2NpYXRlZCBJUHY0IGFkZHJlc3MuIAogICAgICAgIElmIG5vIGhvc3RuYW1lIGlzIHByb3ZpZGVkLCBpdCBkZWZhdWx0cyB0byByZXR1cm5pbmcKICAgICAgICB0aGUgSVAgYWRkcmVzcyBvZiB0aGUgbG9jYWxob3N0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUlQQWRkcmVzcyAtQ29tcHV0ZXJOYW1lIFNFUlZFUgogICAgICAgIAogICAgICAgIFJldHVybiB0aGUgSVB2NCBhZGRyZXNzIG9mICdTRVJWRVInCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtQ29udGVudCAuXGhvc3RuYW1lcy50eHQgfCBHZXQtSVBBZGRyZXNzCgogICAgICAgIEdldCB0aGUgSVAgYWRkcmVzc2VzIG9mIGFsbCBob3N0bmFtZXMgaW4gYW4gaW5wdXQgZmlsZS4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICRFbnY6Q29tcHV0ZXJOYW1lCiAgICApCgogICAgdHJ5IHsKICAgICAgICAjIGV4dHJhY3QgdGhlIGNvbXB1dGVyIG5hbWUgZnJvbSB3aGF0ZXZlciBvYmplY3Qgd2FzIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICAgICAkQ29tcHV0ZXIgPSAkQ29tcHV0ZXJOYW1lIHwgR2V0LU5hbWVGaWVsZAoKICAgICAgICAjIGdldCB0aGUgSVAgcmVzb2x1dGlvbiBvZiB0aGlzIHNwZWNpZmllZCBob3N0bmFtZQogICAgICAgIEAoKFtOZXQuRG5zXTo6R2V0SG9zdEVudHJ5KCRDb21wdXRlcikpLkFkZHJlc3NMaXN0KSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgaWYgKCRfLkFkZHJlc3NGYW1pbHkgLWVxICdJbnRlck5ldHdvcmsnKSB7CiAgICAgICAgICAgICAgICAkT3V0ID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgogICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJUEFkZHJlc3MnICRfLklQQWRkcmVzc1RvU3RyaW5nCiAgICAgICAgICAgICAgICAkT3V0CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBjYXRjaCB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAnQ291bGQgbm90IHJlc29sdmUgaG9zdCB0byBhbiBJUCBBZGRyZXNzLicKICAgIH0KfQoKCmZpbHRlciBDb252ZXJ0LU5hbWVUb1NpZCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQ29udmVydHMgYSBnaXZlbiB1c2VyL2dyb3VwIG5hbWUgdG8gYSBzZWN1cml0eSBpZGVudGlmaWVyIChTSUQpLgoKICAgIC5QQVJBTUVURVIgT2JqZWN0TmFtZQoKICAgICAgICBUaGUgdXNlci9ncm91cCBuYW1lIHRvIGNvbnZlcnQsIGNhbiBiZSAndXNlcicgb3IgJ0RPTUFJTlx1c2VyJyBmb3JtYXQuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgU3BlY2lmaWMgZG9tYWluIGZvciB0aGUgZ2l2ZW4gdXNlciBhY2NvdW50LCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBDb252ZXJ0LU5hbWVUb1NpZCAnREVWXGRmbScKIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgW0FsaWFzKCdOYW1lJyldCiAgICAgICAgJE9iamVjdE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbgogICAgKQoKICAgICRPYmplY3ROYW1lID0gJE9iamVjdE5hbWUgLVJlcGxhY2UgIi8iLCJcIgogICAgCiAgICBpZigkT2JqZWN0TmFtZS5Db250YWlucygiXCIpKSB7CiAgICAgICAgIyBpZiB3ZSBnZXQgYSBET01BSU5cdXNlciBmb3JtYXQsIGF1dG8gY29udmVydCBpdAogICAgICAgICREb21haW4gPSAkT2JqZWN0TmFtZS5TcGxpdCgiXCIpWzBdCiAgICAgICAgJE9iamVjdE5hbWUgPSAkT2JqZWN0TmFtZS5TcGxpdCgiXCIpWzFdCiAgICB9CiAgICBlbHNlaWYoLW5vdCAkRG9tYWluKSB7CiAgICAgICAgJERvbWFpbiA9IChHZXQtTmV0RG9tYWluKS5OYW1lCiAgICB9CgogICAgdHJ5IHsKICAgICAgICAkT2JqID0gKE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5OVEFjY291bnQoJERvbWFpbiwgJE9iamVjdE5hbWUpKQogICAgICAgICRTSUQgPSAkT2JqLlRyYW5zbGF0ZShbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXJdKS5WYWx1ZQogICAgICAgIAogICAgICAgICRPdXQgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdPYmplY3ROYW1lJyAkT2JqZWN0TmFtZQogICAgICAgICRPdXQgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU0lEJyAkU0lECiAgICAgICAgJE91dAogICAgfQogICAgY2F0Y2ggewogICAgICAgIFdyaXRlLVZlcmJvc2UgIkludmFsaWQgb2JqZWN0L25hbWU6ICREb21haW5cJE9iamVjdE5hbWUiCiAgICAgICAgJE51bGwKICAgIH0KfQoKCmZpbHRlciBDb252ZXJ0LVNpZFRvTmFtZSB7CjwjCiAgICAuU1lOT1BTSVMKICAgIAogICAgICAgIENvbnZlcnRzIGEgc2VjdXJpdHkgaWRlbnRpZmllciAoU0lEKSB0byBhIGdyb3VwL3VzZXIgbmFtZS4KCiAgICAuUEFSQU1FVEVSIFNJRAogICAgCiAgICAgICAgVGhlIFNJRCB0byBjb252ZXJ0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gQ29udmVydC1TaWRUb05hbWUgUy0xLTUtMjEtMjYyMDg5MTgyOS0yNDExMjYxNDk3LTE3NzM4NTMwODgtMTEwNQojPgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVQYXR0ZXJuKCdeUy0xLS4qJyldCiAgICAgICAgJFNJRAogICAgKQoKICAgIHRyeSB7CiAgICAgICAgJFNJRDIgPSAkU0lELnRyaW0oJyonKQoKICAgICAgICAjIHRyeSB0byByZXNvbHZlIGFueSBidWlsdC1pbiBTSURzIGZpcnN0CiAgICAgICAgIyAgIGZyb20gaHR0cHM6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20vZW4tdXMva2IvMjQzMzMwCiAgICAgICAgU3dpdGNoICgkU0lEMikgewogICAgICAgICAgICAnUy0xLTAnICAgICAgICAgeyAnTnVsbCBBdXRob3JpdHknIH0KICAgICAgICAgICAgJ1MtMS0wLTAnICAgICAgIHsgJ05vYm9keScgfQogICAgICAgICAgICAnUy0xLTEnICAgICAgICAgeyAnV29ybGQgQXV0aG9yaXR5JyB9CiAgICAgICAgICAgICdTLTEtMS0wJyAgICAgICB7ICdFdmVyeW9uZScgfQogICAgICAgICAgICAnUy0xLTInICAgICAgICAgeyAnTG9jYWwgQXV0aG9yaXR5JyB9CiAgICAgICAgICAgICdTLTEtMi0wJyAgICAgICB7ICdMb2NhbCcgfQogICAgICAgICAgICAnUy0xLTItMScgICAgICAgeyAnQ29uc29sZSBMb2dvbiAnIH0KICAgICAgICAgICAgJ1MtMS0zJyAgICAgICAgIHsgJ0NyZWF0b3IgQXV0aG9yaXR5JyB9CiAgICAgICAgICAgICdTLTEtMy0wJyAgICAgICB7ICdDcmVhdG9yIE93bmVyJyB9CiAgICAgICAgICAgICdTLTEtMy0xJyAgICAgICB7ICdDcmVhdG9yIEdyb3VwJyB9CiAgICAgICAgICAgICdTLTEtMy0yJyAgICAgICB7ICdDcmVhdG9yIE93bmVyIFNlcnZlcicgfQogICAgICAgICAgICAnUy0xLTMtMycgICAgICAgeyAnQ3JlYXRvciBHcm91cCBTZXJ2ZXInIH0KICAgICAgICAgICAgJ1MtMS0zLTQnICAgICAgIHsgJ093bmVyIFJpZ2h0cycgfQogICAgICAgICAgICAnUy0xLTQnICAgICAgICAgeyAnTm9uLXVuaXF1ZSBBdXRob3JpdHknIH0KICAgICAgICAgICAgJ1MtMS01JyAgICAgICAgIHsgJ05UIEF1dGhvcml0eScgfQogICAgICAgICAgICAnUy0xLTUtMScgICAgICAgeyAnRGlhbHVwJyB9CiAgICAgICAgICAgICdTLTEtNS0yJyAgICAgICB7ICdOZXR3b3JrJyB9CiAgICAgICAgICAgICdTLTEtNS0zJyAgICAgICB7ICdCYXRjaCcgfQogICAgICAgICAgICAnUy0xLTUtNCcgICAgICAgeyAnSW50ZXJhY3RpdmUnIH0KICAgICAgICAgICAgJ1MtMS01LTYnICAgICAgIHsgJ1NlcnZpY2UnIH0KICAgICAgICAgICAgJ1MtMS01LTcnICAgICAgIHsgJ0Fub255bW91cycgfQogICAgICAgICAgICAnUy0xLTUtOCcgICAgICAgeyAnUHJveHknIH0KICAgICAgICAgICAgJ1MtMS01LTknICAgICAgIHsgJ0VudGVycHJpc2UgRG9tYWluIENvbnRyb2xsZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0xMCcgICAgICB7ICdQcmluY2lwYWwgU2VsZicgfQogICAgICAgICAgICAnUy0xLTUtMTEnICAgICAgeyAnQXV0aGVudGljYXRlZCBVc2VycycgfQogICAgICAgICAgICAnUy0xLTUtMTInICAgICAgeyAnUmVzdHJpY3RlZCBDb2RlJyB9CiAgICAgICAgICAgICdTLTEtNS0xMycgICAgICB7ICdUZXJtaW5hbCBTZXJ2ZXIgVXNlcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTE0JyAgICAgIHsgJ1JlbW90ZSBJbnRlcmFjdGl2ZSBMb2dvbicgfQogICAgICAgICAgICAnUy0xLTUtMTUnICAgICAgeyAnVGhpcyBPcmdhbml6YXRpb24gJyB9CiAgICAgICAgICAgICdTLTEtNS0xNycgICAgICB7ICdUaGlzIE9yZ2FuaXphdGlvbiAnIH0KICAgICAgICAgICAgJ1MtMS01LTE4JyAgICAgIHsgJ0xvY2FsIFN5c3RlbScgfQogICAgICAgICAgICAnUy0xLTUtMTknICAgICAgeyAnTlQgQXV0aG9yaXR5JyB9CiAgICAgICAgICAgICdTLTEtNS0yMCcgICAgICB7ICdOVCBBdXRob3JpdHknIH0KICAgICAgICAgICAgJ1MtMS01LTgwLTAnICAgIHsgJ0FsbCBTZXJ2aWNlcyAnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU0NCcgIHsgJ0JVSUxUSU5cQWRtaW5pc3RyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU0NScgIHsgJ0JVSUxUSU5cVXNlcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU0NicgIHsgJ0JVSUxUSU5cR3Vlc3RzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NDcnICB7ICdCVUlMVElOXFBvd2VyIFVzZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NDgnICB7ICdCVUlMVElOXEFjY291bnQgT3BlcmF0b3JzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NDknICB7ICdCVUlMVElOXFNlcnZlciBPcGVyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU1MCcgIHsgJ0JVSUxUSU5cUHJpbnQgT3BlcmF0b3JzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NTEnICB7ICdCVUlMVElOXEJhY2t1cCBPcGVyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU1MicgIHsgJ0JVSUxUSU5cUmVwbGljYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU1NCcgIHsgJ0JVSUxUSU5cUHJlLVdpbmRvd3MgMjAwMCBDb21wYXRpYmxlIEFjY2VzcycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTU1JyAgeyAnQlVJTFRJTlxSZW1vdGUgRGVza3RvcCBVc2VycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTU2JyAgeyAnQlVJTFRJTlxOZXR3b3JrIENvbmZpZ3VyYXRpb24gT3BlcmF0b3JzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NTcnICB7ICdCVUlMVElOXEluY29taW5nIEZvcmVzdCBUcnVzdCBCdWlsZGVycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTU4JyAgeyAnQlVJTFRJTlxQZXJmb3JtYW5jZSBNb25pdG9yIFVzZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NTknICB7ICdCVUlMVElOXFBlcmZvcm1hbmNlIExvZyBVc2VycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTYwJyAgeyAnQlVJTFRJTlxXaW5kb3dzIEF1dGhvcml6YXRpb24gQWNjZXNzIEdyb3VwJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NjEnICB7ICdCVUlMVElOXFRlcm1pbmFsIFNlcnZlciBMaWNlbnNlIFNlcnZlcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU2MicgIHsgJ0JVSUxUSU5cRGlzdHJpYnV0ZWQgQ09NIFVzZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NjknICB7ICdCVUlMVElOXENyeXB0b2dyYXBoaWMgT3BlcmF0b3JzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NzMnICB7ICdCVUlMVElOXEV2ZW50IExvZyBSZWFkZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NzQnICB7ICdCVUlMVElOXENlcnRpZmljYXRlIFNlcnZpY2UgRENPTSBBY2Nlc3MnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU3NScgIHsgJ0JVSUxUSU5cUkRTIFJlbW90ZSBBY2Nlc3MgU2VydmVycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTc2JyAgeyAnQlVJTFRJTlxSRFMgRW5kcG9pbnQgU2VydmVycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTc3JyAgeyAnQlVJTFRJTlxSRFMgTWFuYWdlbWVudCBTZXJ2ZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NzgnICB7ICdCVUlMVElOXEh5cGVyLVYgQWRtaW5pc3RyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU3OScgIHsgJ0JVSUxUSU5cQWNjZXNzIENvbnRyb2wgQXNzaXN0YW5jZSBPcGVyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU4MCcgIHsgJ0JVSUxUSU5cQWNjZXNzIENvbnRyb2wgQXNzaXN0YW5jZSBPcGVyYXRvcnMnIH0KICAgICAgICAgICAgRGVmYXVsdCB7IAogICAgICAgICAgICAgICAgJE9iaiA9IChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyKCRTSUQyKSkKICAgICAgICAgICAgICAgICRPYmouVHJhbnNsYXRlKCBbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5OVEFjY291bnRdKS5WYWx1ZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgY2F0Y2ggewogICAgICAgIFdyaXRlLVZlcmJvc2UgIkludmFsaWQgU0lEOiAkU0lEIgogICAgICAgICRTSUQKICAgIH0KfQoKCmZpbHRlciBDb252ZXJ0LUFETmFtZSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQ29udmVydHMgdXNlci9ncm91cCBuYW1lcyBmcm9tIE5UNCAoRE9NQUlOXHVzZXIpIG9yIGRvbWFpblNpbXBsZSAodXNlckBkb21haW4uY29tKQogICAgICAgIHRvIGNhbm9uaWNhbCBmb3JtYXQgKGRvbWFpbi5jb20vVXNlcnMvdXNlcikgb3IgTlQ0LgoKICAgICAgICBCYXNlZCBvbiBCaWxsIFN0ZXdhcnQncyBjb2RlIGZyb20gdGhpcyBhcnRpY2xlOiAKICAgICAgICAgICAgaHR0cDovL3dpbmRvd3NpdHByby5jb20vYWN0aXZlLWRpcmVjdG9yeS90cmFuc2xhdGluZy1hY3RpdmUtZGlyZWN0b3J5LW9iamVjdC1uYW1lcy1iZXR3ZWVuLWZvcm1hdHMKCiAgICAuUEFSQU1FVEVSIE9iamVjdE5hbWUKCiAgICAgICAgVGhlIHVzZXIvZ3JvdXAgbmFtZSB0byBjb252ZXJ0LgoKICAgIC5QQVJBTUVURVIgSW5wdXRUeXBlCgogICAgICAgIFRoZSBJbnB1dFR5cGUgb2YgdGhlIHVzZXIvZ3JvdXAgbmFtZSAoIk5UNCIsIlNpbXBsZSIsIkNhbm9uaWNhbCIpLgoKICAgIC5QQVJBTUVURVIgT3V0cHV0VHlwZQoKICAgICAgICBUaGUgT3V0cHV0VHlwZSBvZiB0aGUgdXNlci9ncm91cCBuYW1lICgiTlQ0IiwiU2ltcGxlIiwiQ2Fub25pY2FsIikuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBDb252ZXJ0LUFETmFtZSAtT2JqZWN0TmFtZSAiZGV2XGRmbSIKICAgICAgICAKICAgICAgICBSZXR1cm5zICJkZXYudGVzdGxhYi5sb2NhbC9Vc2Vycy9EYXZlIgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gQ29udmVydC1TaWRUb05hbWUgIlMtLi4uIiB8IENvbnZlcnQtQUROYW1lCiAgICAgICAgCiAgICAgICAgUmV0dXJucyB0aGUgY2Fub25pY2FsIG5hbWUgZm9yIHRoZSByZXNvbHZlZCBTSUQuCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL3dpbmRvd3NpdHByby5jb20vYWN0aXZlLWRpcmVjdG9yeS90cmFuc2xhdGluZy1hY3RpdmUtZGlyZWN0b3J5LW9iamVjdC1uYW1lcy1iZXR3ZWVuLWZvcm1hdHMKIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE9iamVjdE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlU2V0KCJOVDQiLCJTaW1wbGUiLCJDYW5vbmljYWwiKV0KICAgICAgICAkSW5wdXRUeXBlLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZVNldCgiTlQ0IiwiU2ltcGxlIiwiQ2Fub25pY2FsIildCiAgICAgICAgJE91dHB1dFR5cGUKICAgICkKCiAgICAkTmFtZVR5cGVzID0gQHsKICAgICAgICAnQ2Fub25pY2FsJyA9IDIKICAgICAgICAnTlQ0JyAgICAgICA9IDMKICAgICAgICAnU2ltcGxlJyAgICA9IDUKICAgIH0KCiAgICBpZigtbm90ICRQU0JvdW5kUGFyYW1ldGVyc1snSW5wdXRUeXBlJ10pIHsKICAgICAgICBpZiggKCRPYmplY3ROYW1lLnNwbGl0KCcvJykpLkNvdW50IC1lcSAyICkgewogICAgICAgICAgICAkT2JqZWN0TmFtZSA9ICRPYmplY3ROYW1lLnJlcGxhY2UoJy8nLCAnXCcpCiAgICAgICAgfQoKICAgICAgICBpZigkT2JqZWN0TmFtZSAtbWF0Y2ggIl5bQS1aYS16XStcXFtBLVphLXogXSsiKSB7CiAgICAgICAgICAgICRJbnB1dFR5cGUgPSAnTlQ0JwogICAgICAgIH0KICAgICAgICBlbHNlaWYoJE9iamVjdE5hbWUgLW1hdGNoICJeW0EtWmEteiBdK0BbQS1aYS16XC5dKyIpIHsKICAgICAgICAgICAgJElucHV0VHlwZSA9ICdTaW1wbGUnCiAgICAgICAgfQogICAgICAgIGVsc2VpZigkT2JqZWN0TmFtZSAtbWF0Y2ggIl5bQS1aYS16XC5dKy9bQS1aYS16XSsvW0EtWmEtei8gXSsiKSB7CiAgICAgICAgICAgICRJbnB1dFR5cGUgPSAnQ2Fub25pY2FsJwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiQ2FuIG5vdCBpZGVudGlmeSBJblR5cGUgZm9yICRPYmplY3ROYW1lIgogICAgICAgICAgICByZXR1cm4gJE9iamVjdE5hbWUKICAgICAgICB9CiAgICB9CiAgICBlbHNlaWYoJElucHV0VHlwZSAtZXEgJ05UNCcpIHsKICAgICAgICAkT2JqZWN0TmFtZSA9ICRPYmplY3ROYW1lLnJlcGxhY2UoJy8nLCAnXCcpCiAgICB9CgogICAgaWYoLW5vdCAkUFNCb3VuZFBhcmFtZXRlcnNbJ091dHB1dFR5cGUnXSkgewogICAgICAgICRPdXRwdXRUeXBlID0gU3dpdGNoKCRJbnB1dFR5cGUpIHsKICAgICAgICAgICAgJ05UNCcgeydDYW5vbmljYWwnfQogICAgICAgICAgICAnU2ltcGxlJyB7J05UNCd9CiAgICAgICAgICAgICdDYW5vbmljYWwnIHsnTlQ0J30KICAgICAgICB9CiAgICB9CgogICAgIyB0cnkgdG8gZXh0cmFjdCB0aGUgZG9tYWluIGZyb20gdGhlIGdpdmVuIGZvcm1hdAogICAgJERvbWFpbiA9IFN3aXRjaCgkSW5wdXRUeXBlKSB7CiAgICAgICAgJ05UNCcgeyAkT2JqZWN0TmFtZS5zcGxpdCgiXCIpWzBdIH0KICAgICAgICAnU2ltcGxlJyB7ICRPYmplY3ROYW1lLnNwbGl0KCJAIilbMV0gfQogICAgICAgICdDYW5vbmljYWwnIHsgJE9iamVjdE5hbWUuc3BsaXQoIi8iKVswXSB9CiAgICB9CgogICAgIyBBY2Nlc3NvciBmdW5jdGlvbnMgdG8gc2ltcGxpZnkgY2FsbHMgdG8gTmFtZVRyYW5zbGF0ZQogICAgZnVuY3Rpb24gSW52b2tlLU1ldGhvZChbX19Db21PYmplY3RdICRPYmplY3QsIFtTdHJpbmddICRNZXRob2QsICRQYXJhbWV0ZXJzKSB7CiAgICAgICAgJE91dHB1dCA9ICRPYmplY3QuR2V0VHlwZSgpLkludm9rZU1lbWJlcigkTWV0aG9kLCAiSW52b2tlTWV0aG9kIiwgJE51bGwsICRPYmplY3QsICRQYXJhbWV0ZXJzKQogICAgICAgIGlmICggJE91dHB1dCApIHsgJE91dHB1dCB9CiAgICB9CiAgICBmdW5jdGlvbiBTZXQtUHJvcGVydHkoW19fQ29tT2JqZWN0XSAkT2JqZWN0LCBbU3RyaW5nXSAkUHJvcGVydHksICRQYXJhbWV0ZXJzKSB7CiAgICAgICAgW1ZvaWRdICRPYmplY3QuR2V0VHlwZSgpLkludm9rZU1lbWJlcigkUHJvcGVydHksICJTZXRQcm9wZXJ0eSIsICROdWxsLCAkT2JqZWN0LCAkUGFyYW1ldGVycykKICAgIH0KCiAgICAkVHJhbnNsYXRlID0gTmV3LU9iamVjdCAtQ29tT2JqZWN0IE5hbWVUcmFuc2xhdGUKCiAgICB0cnkgewogICAgICAgIEludm9rZS1NZXRob2QgJFRyYW5zbGF0ZSAiSW5pdCIgKDEsICREb21haW4pCiAgICB9CiAgICBjYXRjaCBbU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5NZXRob2RJbnZvY2F0aW9uRXhjZXB0aW9uXSB7IAogICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIHdpdGggdHJhbnNsYXRlIGluaXQgaW4gQ29udmVydC1BRE5hbWU6ICRfIgogICAgfQoKICAgIFNldC1Qcm9wZXJ0eSAkVHJhbnNsYXRlICJDaGFzZVJlZmVycmFsIiAoMHg2MCkKCiAgICB0cnkgewogICAgICAgIEludm9rZS1NZXRob2QgJFRyYW5zbGF0ZSAiU2V0IiAoJE5hbWVUeXBlc1skSW5wdXRUeXBlXSwgJE9iamVjdE5hbWUpCiAgICAgICAgKEludm9rZS1NZXRob2QgJFRyYW5zbGF0ZSAiR2V0IiAoJE5hbWVUeXBlc1skT3V0cHV0VHlwZV0pKQogICAgfQogICAgY2F0Y2ggW1N5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uTWV0aG9kSW52b2NhdGlvbkV4Y2VwdGlvbl0gewogICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIHdpdGggdHJhbnNsYXRlIFNldC9HZXQgaW4gQ29udmVydC1BRE5hbWU6ICRfIgogICAgfQp9CgoKZnVuY3Rpb24gQ29udmVydEZyb20tVUFDVmFsdWUgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIENvbnZlcnRzIGEgVUFDIGludCB2YWx1ZSB0byBodW1hbiByZWFkYWJsZSBmb3JtLgoKICAgIC5QQVJBTUVURVIgVmFsdWUKCiAgICAgICAgVGhlIGludCBVQUMgdmFsdWUgdG8gY29udmVydC4KCiAgICAuUEFSQU1FVEVSIFNob3dBbGwKCiAgICAgICAgU2hvdyBhbGwgVUFDIHZhbHVlcywgd2l0aCBhICsgaW5kaWNhdGluZyB0aGUgdmFsdWUgaXMgY3VycmVudGx5IHNldC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IENvbnZlcnRGcm9tLVVBQ1ZhbHVlIC1WYWx1ZSA2NjE3NgoKICAgICAgICBDb252ZXJ0IHRoZSBVQUMgdmFsdWUgNjYxNzYgdG8gaHVtYW4gcmVhZGFibGUgZm9ybWF0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldFVzZXIgamFzb24gfCBzZWxlY3QgdXNlcmFjY291bnRjb250cm9sIHwgQ29udmVydEZyb20tVUFDVmFsdWUKCiAgICAgICAgQ29udmVydCB0aGUgVUFDIHZhbHVlIGZvciAnamFzb24nIHRvIGh1bWFuIHJlYWRhYmxlIGZvcm1hdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRVc2VyIGphc29uIHwgc2VsZWN0IHVzZXJhY2NvdW50Y29udHJvbCB8IENvbnZlcnRGcm9tLVVBQ1ZhbHVlIC1TaG93QWxsCgogICAgICAgIENvbnZlcnQgdGhlIFVBQyB2YWx1ZSBmb3IgJ2phc29uJyB0byBodW1hbiByZWFkYWJsZSBmb3JtYXQsIHNob3dpbmcgYWxsCiAgICAgICAgcG9zc2libGUgVUFDIHZhbHVlcy4KIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgJFZhbHVlLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTaG93QWxsCiAgICApCgogICAgYmVnaW4gewogICAgICAgICMgdmFsdWVzIGZyb20gaHR0cHM6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20vZW4tdXMva2IvMzA1MTQ0CiAgICAgICAgJFVBQ1ZhbHVlcyA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLlNwZWNpYWxpemVkLk9yZGVyZWREaWN0aW9uYXJ5CiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIlNDUklQVCIsIDEpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIkFDQ09VTlRESVNBQkxFIiwgMikKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiSE9NRURJUl9SRVFVSVJFRCIsIDgpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIkxPQ0tPVVQiLCAxNikKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiUEFTU1dEX05PVFJFUUQiLCAzMikKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiUEFTU1dEX0NBTlRfQ0hBTkdFIiwgNjQpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIkVOQ1JZUFRFRF9URVhUX1BXRF9BTExPV0VEIiwgMTI4KQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJURU1QX0RVUExJQ0FURV9BQ0NPVU5UIiwgMjU2KQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJOT1JNQUxfQUNDT1VOVCIsIDUxMikKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiSU5URVJET01BSU5fVFJVU1RfQUNDT1VOVCIsIDIwNDgpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIldPUktTVEFUSU9OX1RSVVNUX0FDQ09VTlQiLCA0MDk2KQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJTRVJWRVJfVFJVU1RfQUNDT1VOVCIsIDgxOTIpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIkRPTlRfRVhQSVJFX1BBU1NXT1JEIiwgNjU1MzYpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIk1OU19MT0dPTl9BQ0NPVU5UIiwgMTMxMDcyKQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJTTUFSVENBUkRfUkVRVUlSRUQiLCAyNjIxNDQpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIlRSVVNURURfRk9SX0RFTEVHQVRJT04iLCA1MjQyODgpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIk5PVF9ERUxFR0FURUQiLCAxMDQ4NTc2KQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJVU0VfREVTX0tFWV9PTkxZIiwgMjA5NzE1MikKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiRE9OVF9SRVFfUFJFQVVUSCIsIDQxOTQzMDQpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIlBBU1NXT1JEX0VYUElSRUQiLCA4Mzg4NjA4KQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJUUlVTVEVEX1RPX0FVVEhfRk9SX0RFTEVHQVRJT04iLCAxNjc3NzIxNikKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiUEFSVElBTF9TRUNSRVRTX0FDQ09VTlQiLCA2NzEwODg2NCkKICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgJFJlc3VsdFVBQ1ZhbHVlcyA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLlNwZWNpYWxpemVkLk9yZGVyZWREaWN0aW9uYXJ5CgogICAgICAgIGlmKCRWYWx1ZSAtaXMgW0ludF0pIHsKICAgICAgICAgICAgJEludFZhbHVlID0gJFZhbHVlCiAgICAgICAgfQogICAgICAgIGVsc2VpZiAoJFZhbHVlIC1pcyBbUFNDdXN0b21PYmplY3RdKSB7CiAgICAgICAgICAgIGlmKCRWYWx1ZS51c2VyYWNjb3VudGNvbnRyb2wpIHsKICAgICAgICAgICAgICAgICRJbnRWYWx1ZSA9ICRWYWx1ZS51c2VyYWNjb3VudGNvbnRyb2wKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiSW52YWxpZCBvYmplY3QgaW5wdXQgZm9yIC1WYWx1ZSA6ICRWYWx1ZSIKICAgICAgICAgICAgcmV0dXJuICROdWxsIAogICAgICAgIH0KCiAgICAgICAgaWYoJFNob3dBbGwpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJFVBQ1ZhbHVlIGluICRVQUNWYWx1ZXMuR2V0RW51bWVyYXRvcigpKSB7CiAgICAgICAgICAgICAgICBpZiggKCRJbnRWYWx1ZSAtYmFuZCAkVUFDVmFsdWUuVmFsdWUpIC1lcSAkVUFDVmFsdWUuVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0VUFDVmFsdWVzLkFkZCgkVUFDVmFsdWUuTmFtZSwgIiQoJFVBQ1ZhbHVlLlZhbHVlKSsiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdFVBQ1ZhbHVlcy5BZGQoJFVBQ1ZhbHVlLk5hbWUsICIkKCRVQUNWYWx1ZS5WYWx1ZSkiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBmb3JlYWNoICgkVUFDVmFsdWUgaW4gJFVBQ1ZhbHVlcy5HZXRFbnVtZXJhdG9yKCkpIHsKICAgICAgICAgICAgICAgIGlmKCAoJEludFZhbHVlIC1iYW5kICRVQUNWYWx1ZS5WYWx1ZSkgLWVxICRVQUNWYWx1ZS5WYWx1ZSkgewogICAgICAgICAgICAgICAgICAgICRSZXN1bHRVQUNWYWx1ZXMuQWRkKCRVQUNWYWx1ZS5OYW1lLCAiJCgkVUFDVmFsdWUuVmFsdWUpIikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkUmVzdWx0VUFDVmFsdWVzCiAgICB9Cn0KCgpmaWx0ZXIgR2V0LVByb3h5IHsKPCMKICAgIC5TWU5PUFNJUwogICAgCiAgICAgICAgRW51bWVyYXRlcyB0aGUgcHJveHkgc2VydmVyIGFuZCBXUEFEIGNvbmVudHMgZm9yIHRoZSBjdXJyZW50IHVzZXIuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGNvbXB1dGVybmFtZSB0byBlbnVtZXJhdGUgcHJveHkgc2V0dGluZ3Mgb24sIGRlZmF1bHRzIHRvIGxvY2FsIGhvc3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtUHJveHkgCiAgICAgICAgCiAgICAgICAgUmV0dXJucyB0aGUgY3VycmVudCBwcm94eSBzZXR0aW5ncy4KIz4KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJEVOVjpDT01QVVRFUk5BTUUKICAgICkKCiAgICB0cnkgewogICAgICAgICRSZWcgPSBbTWljcm9zb2Z0LldpbjMyLlJlZ2lzdHJ5S2V5XTo6T3BlblJlbW90ZUJhc2VLZXkoJ0N1cnJlbnRVc2VyJywgJENvbXB1dGVyTmFtZSkKICAgICAgICAkUmVnS2V5ID0gJFJlZy5PcGVuU3Via2V5KCJTT0ZUV0FSRVxcTWljcm9zb2Z0XFxXaW5kb3dzXFxDdXJyZW50VmVyc2lvblxcSW50ZXJuZXQgU2V0dGluZ3MiKQogICAgICAgICRQcm94eVNlcnZlciA9ICRSZWdLZXkuR2V0VmFsdWUoJ1Byb3h5U2VydmVyJykKICAgICAgICAkQXV0b0NvbmZpZ1VSTCA9ICRSZWdLZXkuR2V0VmFsdWUoJ0F1dG9Db25maWdVUkwnKQoKICAgICAgICAkV3BhZCA9ICIiCiAgICAgICAgaWYoJEF1dG9Db25maWdVUkwgLWFuZCAoJEF1dG9Db25maWdVUkwgLW5lICIiKSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJFdwYWQgPSAoTmV3LU9iamVjdCBOZXQuV2ViY2xpZW50KS5Eb3dubG9hZFN0cmluZygkQXV0b0NvbmZpZ1VSTCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBjb25uZWN0aW5nIHRvIEF1dG9Db25maWdVUkwgOiAkQXV0b0NvbmZpZ1VSTCIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZigkUHJveHlTZXJ2ZXIgLW9yICRBdXRvQ29uZmlnVXJsKSB7CgogICAgICAgICAgICAkUHJvcGVydGllcyA9IEB7CiAgICAgICAgICAgICAgICAnUHJveHlTZXJ2ZXInID0gJFByb3h5U2VydmVyCiAgICAgICAgICAgICAgICAnQXV0b0NvbmZpZ1VSTCcgPSAkQXV0b0NvbmZpZ1VSTAogICAgICAgICAgICAgICAgJ1dwYWQnID0gJFdwYWQKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJObyBwcm94eSBzZXR0aW5ncyBmb3VuZCBmb3IgJENvbXB1dGVyTmFtZSIKICAgICAgICB9CiAgICB9CiAgICBjYXRjaCB7CiAgICAgICAgV3JpdGUtV2FybmluZyAiRXJyb3IgZW51bWVyYXRpbmcgcHJveHkgc2V0dGluZ3MgZm9yICRDb21wdXRlck5hbWUgOiAkXyIKICAgIH0KfQoKCmZ1bmN0aW9uIFJlcXVlc3QtU1BOVGlja2V0IHsKPCMKICAgIC5TWU5PUFNJUwogICAgCiAgICAgICAgUmVxdWVzdCB0aGUga2VyYmVyb3MgdGlja2V0IGZvciBhIHNwZWNpZmllZCBzZXJ2aWNlIHByaW5jaXBhbCBuYW1lIChTUE4pLgogICAgCiAgICAuUEFSQU1FVEVSIFNQTgoKICAgICAgICBUaGUgc2VydmljZSBwcmluY2lwYWwgbmFtZSB0byByZXF1ZXN0IHRoZSB0aWNrZXQgZm9yLiBSZXF1aXJlZC4KICAgICAgICAKICAgIC5QQVJBTUVURVIgRW5jUGFydAogICAgICAgIAogICAgICAgIFN3aXRjaC4gUmV0dXJuIHRoZSBlbmNyeXB0ZWQgcG9ydGlvbiBvZiB0aGUgdGlja2V0IChjaXBoZXIpLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gUmVxdWVzdC1TUE5UaWNrZXQgLVNQTiAiSFRUUC93ZWIudGVzdGxhYi5sb2NhbCIKICAgIAogICAgICAgIFJlcXVlc3QgYSBrZXJiZXJvcyBzZXJ2aWNlIHRpY2tldCBmb3IgdGhlIHNwZWNpZmllZCBTUE4uCiAgICAgICAgCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IFJlcXVlc3QtU1BOVGlja2V0IC1TUE4gIkhUVFAvd2ViLnRlc3RsYWIubG9jYWwiIC1FbmNQYXJ0CiAgICAKICAgICAgICBSZXF1ZXN0IGEga2VyYmVyb3Mgc2VydmljZSB0aWNrZXQgZm9yIHRoZSBzcGVjaWZpZWQgU1BOIGFuZCByZXR1cm4gdGhlIGVuY3J5cHRlZCBwb3J0aW9uIG9mIHRoZSB0aWNrZXQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiAiSFRUUC93ZWIxLnRlc3RsYWIubG9jYWwiLCJIVFRQL3dlYjIudGVzdGxhYi5sb2NhbCIgfCBSZXF1ZXN0LVNQTlRpY2tldAoKICAgICAgICBSZXF1ZXN0IGtlcmJlcm9zIHNlcnZpY2UgdGlja2V0cyBmb3IgYWxsIFNQTnMgcGFzc2VkIG9uIHRoZSBwaXBlbGluZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRVc2VyIC1TUE4gfCBSZXF1ZXN0LVNQTlRpY2tldAoKICAgICAgICBSZXF1ZXN0IGtlcmJlcm9zIHNlcnZpY2UgdGlja2V0cyBmb3IgYWxsIHVzZXJzIHdpdGggbm9uLW51bGwgU1BOcy4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQogICAgICAgIFtBbGlhcygnU2VydmljZVByaW5jaXBhbE5hbWUnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJFNQTiwKICAgICAgICAKICAgICAgICBbQWxpYXMoJ0VuY3J5cHRlZFBhcnQnKV0KICAgICAgICBbU3dpdGNoXQogICAgICAgICRFbmNQYXJ0CiAgICApCgogICAgYmVnaW4gewogICAgICAgIEFkZC1UeXBlIC1Bc3NlbWJseU5hbWUgU3lzdGVtLklkZW50aXR5TW9kZWwKICAgIH0KCiAgICBwcm9jZXNzIHsKICAgICAgICBGb3JFYWNoKCRVc2VyU1BOIGluICRTUE4pIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiUmVxdWVzdGluZyB0aWNrZXQgZm9yOiAkVXNlclNQTiIKICAgICAgICAgICAgaWYgKCEkRW5jUGFydCkgewogICAgICAgICAgICAgICAgTmV3LU9iamVjdCBTeXN0ZW0uSWRlbnRpdHlNb2RlbC5Ub2tlbnMuS2VyYmVyb3NSZXF1ZXN0b3JTZWN1cml0eVRva2VuIC1Bcmd1bWVudExpc3QgJFVzZXJTUE4KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRUaWNrZXQgPSBOZXctT2JqZWN0IFN5c3RlbS5JZGVudGl0eU1vZGVsLlRva2Vucy5LZXJiZXJvc1JlcXVlc3RvclNlY3VyaXR5VG9rZW4gLUFyZ3VtZW50TGlzdCAkVXNlclNQTgogICAgICAgICAgICAgICAgJFRpY2tldEJ5dGVTdHJlYW0gPSAkVGlja2V0LkdldFJlcXVlc3QoKQogICAgICAgICAgICAgICAgaWYgKCRUaWNrZXRCeXRlU3RyZWFtKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRUaWNrZXRIZXhTdHJlYW0gPSBbU3lzdGVtLkJpdENvbnZlcnRlcl06OlRvU3RyaW5nKCRUaWNrZXRCeXRlU3RyZWFtKSAtcmVwbGFjZSAiLSIKICAgICAgICAgICAgICAgICAgICBbU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdF0kUGFydHMgPSAoJFRpY2tldEhleFN0cmVhbSAtcmVwbGFjZSAnXiguKj8pMDQ4MjAuLi4oLiopJywnJDInKSAtU3BsaXQgIkE0ODIwMSIKICAgICAgICAgICAgICAgICAgICAkUGFydHMuUmVtb3ZlQXQoJFBhcnRzLkNvdW50IC0gMSkKICAgICAgICAgICAgICAgICAgICAkUGFydHMgLWpvaW4gIkE0ODIwMSIKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LVBhdGhBY2wgewo8IwogICAgLlNZTk9QU0lTCiAgICAKICAgICAgICBFbnVtZXJhdGVzIHRoZSBBQ0wgZm9yIGEgZ2l2ZW4gZmlsZSBwYXRoLgoKICAgIC5QQVJBTUVURVIgUGF0aAoKICAgICAgICBUaGUgbG9jYWwvcmVtb3RlIHBhdGggdG8gZW51bWVyYXRlIHRoZSBBQ0xzIGZvci4KCiAgICAuUEFSQU1FVEVSIFJlY3Vyc2UKICAgICAgICAKICAgICAgICBJZiBhbnkgQUNMIHJlc3VsdHMgYXJlIGdyb3VwcywgcmVjdXJzZSBhbmQgcmV0cmlldmUgdXNlciBtZW1iZXJzaGlwLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LVBhdGhBY2wgIlxcU0VSVkVSXFNoYXJlXCIgCiAgICAgICAgCiAgICAgICAgUmV0dXJucyBBQ0xzIGZvciB0aGUgZ2l2ZW4gVU5DIHNoYXJlLgojPgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkUGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkUmVjdXJzZQogICAgKQoKICAgIGJlZ2luIHsKCiAgICAgICAgZnVuY3Rpb24gQ29udmVydC1GaWxlUmlnaHQgewoKICAgICAgICAgICAgIyBGcm9tIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjgwMjk4NzIvcmV0cmlldmluZy1zZWN1cml0eS1kZXNjcmlwdG9yLWFuZC1nZXR0aW5nLW51bWJlci1mb3ItZmlsZXN5c3RlbXJpZ2h0cwoKICAgICAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0KICAgICAgICAgICAgcGFyYW0oCiAgICAgICAgICAgICAgICBbSW50XQogICAgICAgICAgICAgICAgJEZTUgogICAgICAgICAgICApCgogICAgICAgICAgICAkQWNjZXNzTWFzayA9IEB7CiAgICAgICAgICAgICAgW3VpbnQzMl0nMHg4MDAwMDAwMCcgPSAnR2VuZXJpY1JlYWQnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHg0MDAwMDAwMCcgPSAnR2VuZXJpY1dyaXRlJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MjAwMDAwMDAnID0gJ0dlbmVyaWNFeGVjdXRlJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MTAwMDAwMDAnID0gJ0dlbmVyaWNBbGwnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMjAwMDAwMCcgPSAnTWF4aW11bUFsbG93ZWQnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMTAwMDAwMCcgPSAnQWNjZXNzU3lzdGVtU2VjdXJpdHknCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDEwMDAwMCcgPSAnU3luY2hyb25pemUnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDA4MDAwMCcgPSAnV3JpdGVPd25lcicKICAgICAgICAgICAgICBbdWludDMyXScweDAwMDQwMDAwJyA9ICdXcml0ZURBQycKICAgICAgICAgICAgICBbdWludDMyXScweDAwMDIwMDAwJyA9ICdSZWFkQ29udHJvbCcKICAgICAgICAgICAgICBbdWludDMyXScweDAwMDEwMDAwJyA9ICdEZWxldGUnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDEwMCcgPSAnV3JpdGVBdHRyaWJ1dGVzJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwODAnID0gJ1JlYWRBdHRyaWJ1dGVzJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwNDAnID0gJ0RlbGV0ZUNoaWxkJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwMjAnID0gJ0V4ZWN1dGUvVHJhdmVyc2UnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDAxMCcgPSAnV3JpdGVFeHRlbmRlZEF0dHJpYnV0ZXMnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDAwOCcgPSAnUmVhZEV4dGVuZGVkQXR0cmlidXRlcycKICAgICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDA0JyA9ICdBcHBlbmREYXRhL0FkZFN1YmRpcmVjdG9yeScKICAgICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDAyJyA9ICdXcml0ZURhdGEvQWRkRmlsZScKICAgICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDAxJyA9ICdSZWFkRGF0YS9MaXN0RGlyZWN0b3J5JwogICAgICAgICAgICB9CgogICAgICAgICAgICAkU2ltcGxlUGVybWlzc2lvbnMgPSBAewogICAgICAgICAgICAgIFt1aW50MzJdJzB4MWYwMWZmJyA9ICdGdWxsQ29udHJvbCcKICAgICAgICAgICAgICBbdWludDMyXScweDAzMDFiZicgPSAnTW9kaWZ5JwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDIwMGE5JyA9ICdSZWFkQW5kRXhlY3V0ZScKICAgICAgICAgICAgICBbdWludDMyXScweDAyMDE5ZicgPSAnUmVhZEFuZFdyaXRlJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDIwMDg5JyA9ICdSZWFkJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMTE2JyA9ICdXcml0ZScKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJFBlcm1pc3Npb25zID0gQCgpCgogICAgICAgICAgICAjIGdldCBzaW1wbGUgcGVybWlzc2lvbgogICAgICAgICAgICAkUGVybWlzc2lvbnMgKz0gJFNpbXBsZVBlcm1pc3Npb25zLktleXMgfCAgJSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJEZTUiAtYmFuZCAkXykgLWVxICRfKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFNpbXBsZVBlcm1pc3Npb25zWyRfXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGU1IgPSAkRlNSIC1iYW5kICgtbm90ICRfKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAjIGdldCByZW1haW5pbmcgZXh0ZW5kZWQgcGVybWlzc2lvbnMKICAgICAgICAgICAgJFBlcm1pc3Npb25zICs9ICRBY2Nlc3NNYXNrLktleXMgfAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB7ICRGU1IgLWJhbmQgJF8gfSB8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAlIHsgJEFjY2Vzc01hc2tbJF9dIH0KCiAgICAgICAgICAgICgkUGVybWlzc2lvbnMgfCA/eyRffSkgLWpvaW4gIiwiCiAgICAgICAgfQogICAgfQoKICAgIHByb2Nlc3MgewoKICAgICAgICB0cnkgewogICAgICAgICAgICAkQUNMID0gR2V0LUFjbCAtUGF0aCAkUGF0aAoKICAgICAgICAgICAgJEFDTC5HZXRBY2Nlc3NSdWxlcygkdHJ1ZSwkdHJ1ZSxbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXJdKSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICAgICAkTmFtZXMgPSBAKCkKICAgICAgICAgICAgICAgIGlmICgkXy5JZGVudGl0eVJlZmVyZW5jZSAtbWF0Y2ggJ15TLTEtNS0yMS1bMC05XSstWzAtOV0rLVswLTldKy1bMC05XSsnKSB7CiAgICAgICAgICAgICAgICAgICAgJE9iamVjdCA9IEdldC1BRE9iamVjdCAtU0lEICRfLklkZW50aXR5UmVmZXJlbmNlCiAgICAgICAgICAgICAgICAgICAgJE5hbWVzID0gQCgpCiAgICAgICAgICAgICAgICAgICAgJFNJRHMgPSBAKCRPYmplY3Qub2JqZWN0c2lkKQoKICAgICAgICAgICAgICAgICAgICBpZiAoJFJlY3Vyc2UgLWFuZCAoQCgnMjY4NDM1NDU2JywnMjY4NDM1NDU3JywnNTM2ODcwOTEyJywnNTM2ODcwOTEzJykgLWNvbnRhaW5zICRPYmplY3Quc2FtQWNjb3VudFR5cGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRTSURzICs9IEdldC1OZXRHcm91cE1lbWJlciAtU0lEICRPYmplY3Qub2JqZWN0c2lkIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgTWVtYmVyU2lkCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkU0lEcyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgJE5hbWVzICs9ICxAKCRfLCAoQ29udmVydC1TaWRUb05hbWUgJF8pKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICROYW1lcyArPSAsQCgkXy5JZGVudGl0eVJlZmVyZW5jZS5WYWx1ZSwgKENvbnZlcnQtU2lkVG9OYW1lICRfLklkZW50aXR5UmVmZXJlbmNlLlZhbHVlKSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBGb3JFYWNoKCROYW1lIGluICROYW1lcykgewogICAgICAgICAgICAgICAgICAgICRPdXQgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdQYXRoJyAkUGF0aAogICAgICAgICAgICAgICAgICAgICRPdXQgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRmlsZVN5c3RlbVJpZ2h0cycgKENvbnZlcnQtRmlsZVJpZ2h0IC1GU1IgJF8uRmlsZVN5c3RlbVJpZ2h0cy52YWx1ZV9fKQogICAgICAgICAgICAgICAgICAgICRPdXQgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSWRlbnRpdHlSZWZlcmVuY2UnICROYW1lWzFdCiAgICAgICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJZGVudGl0eVNJRCcgJE5hbWVbMF0KICAgICAgICAgICAgICAgICAgICAkT3V0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0FjY2Vzc0NvbnRyb2xUeXBlJyAkXy5BY2Nlc3NDb250cm9sVHlwZQogICAgICAgICAgICAgICAgICAgICRPdXQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgJF8KICAgICAgICB9CiAgICB9Cn0KCgpmaWx0ZXIgR2V0LU5hbWVGaWVsZCB7CjwjCiAgICAuU1lOT1BTSVMKICAgIAogICAgICAgIEhlbHBlciB0aGF0IGF0dGVtcHRzIHRvIGV4dHJhY3QgYXBwcm9wcmlhdGUgZmllbGQgbmFtZXMgZnJvbQogICAgICAgIHBhc3NlZCBjb21wdXRlciBvYmplY3RzLgoKICAgIC5QQVJBTUVURVIgT2JqZWN0CgogICAgICAgIFRoZSBwYXNzZWQgb2JqZWN0IHRvIGV4dHJhY3QgbmFtZSBmaWVsZHMgZnJvbS4KCiAgICAuUEFSQU1FVEVSIERuc0hvc3ROYW1lCiAgICAgICAgCiAgICAgICAgQSBEbnNIb3N0TmFtZSB0byBleHRyYWN0IHRocm91Z2ggVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZS4KCiAgICAuUEFSQU1FVEVSIE5hbWUKICAgICAgICAKICAgICAgICBBIE5hbWUgdG8gZXh0cmFjdCB0aHJvdWdoIFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWUuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Q29tcHV0ZXIgLUZ1bGxEYXRhIHwgR2V0LU5hbWVGaWVsZAojPgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmUgPSAkVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbT2JqZWN0XQogICAgICAgICRPYmplY3QsCgogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREbnNIb3N0TmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE5hbWUKICAgICkKCiAgICBpZigkUFNCb3VuZFBhcmFtZXRlcnNbJ0Ruc0hvc3ROYW1lJ10pIHsKICAgICAgICAkRG5zSG9zdE5hbWUKICAgIH0KICAgIGVsc2VpZigkUFNCb3VuZFBhcmFtZXRlcnNbJ05hbWUnXSkgewogICAgICAgICROYW1lCiAgICB9CiAgICBlbHNlaWYoJE9iamVjdCkgewogICAgICAgIGlmICggW2Jvb2xdKCRPYmplY3QuUFNvYmplY3QuUHJvcGVydGllcy5uYW1lIC1tYXRjaCAiZG5zaG9zdG5hbWUiKSApIHsKICAgICAgICAgICAgIyBvYmplY3RzIGZyb20gR2V0LU5ldENvbXB1dGVyCiAgICAgICAgICAgICRPYmplY3QuZG5zaG9zdG5hbWUKICAgICAgICB9CiAgICAgICAgZWxzZWlmICggW2Jvb2xdKCRPYmplY3QuUFNvYmplY3QuUHJvcGVydGllcy5uYW1lIC1tYXRjaCAibmFtZSIpICkgewogICAgICAgICAgICAjIG9iamVjdHMgZnJvbSBHZXQtTmV0RG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAkT2JqZWN0Lm5hbWUKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICMgc3RyaW5ncyBhbmQgY2F0Y2ggYWxscwogICAgICAgICAgICAkT2JqZWN0CiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgcmV0dXJuICROdWxsCiAgICB9Cn0KCgpmdW5jdGlvbiBDb252ZXJ0LUxEQVBQcm9wZXJ0eSB7CjwjCiAgICAuU1lOT1BTSVMKICAgIAogICAgICAgIEhlbHBlciB0aGF0IGNvbnZlcnRzIHNwZWNpZmljIExEQVAgcHJvcGVydHkgcmVzdWx0IGZpZWxkcy4KICAgICAgICBVc2VkIGJ5IHNldmVyYWwgb2YgdGhlIEdldC1OZXQqIGZ1bmN0aW9uLgoKICAgIC5QQVJBTUVURVIgUHJvcGVydGllcwoKICAgICAgICBQcm9wZXJ0aWVzIG9iamVjdCB0byBleHRyYWN0IG91dCBMREFQIGZpZWxkcyBmb3IgZGlzcGxheS4KIz4KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkUHJvcGVydGllcwogICAgKQoKICAgICRPYmplY3RQcm9wZXJ0aWVzID0gQHt9CgogICAgJFByb3BlcnRpZXMuUHJvcGVydHlOYW1lcyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICBpZiAoKCRfIC1lcSAib2JqZWN0c2lkIikgLW9yICgkXyAtZXEgInNpZGhpc3RvcnkiKSkgewogICAgICAgICAgICAjIGNvbnZlcnQgdGhlIFNJRCB0byBhIHN0cmluZwogICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1skX10gPSAoTmV3LU9iamVjdCBTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcigkUHJvcGVydGllc1skX11bMF0sMCkpLlZhbHVlCiAgICAgICAgfQogICAgICAgIGVsc2VpZigkXyAtZXEgIm9iamVjdGd1aWQiKSB7CiAgICAgICAgICAgICMgY29udmVydCB0aGUgR1VJRCB0byBhIHN0cmluZwogICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1skX10gPSAoTmV3LU9iamVjdCBHdWlkICgsJFByb3BlcnRpZXNbJF9dWzBdKSkuR3VpZAogICAgICAgIH0KICAgICAgICBlbHNlaWYoICgkXyAtZXEgImxhc3Rsb2dvbiIpIC1vciAoJF8gLWVxICJsYXN0bG9nb250aW1lc3RhbXAiKSAtb3IgKCRfIC1lcSAicHdkbGFzdHNldCIpIC1vciAoJF8gLWVxICJsYXN0bG9nb2ZmIikgLW9yICgkXyAtZXEgImJhZFBhc3N3b3JkVGltZSIpICkgewogICAgICAgICAgICAjIGNvbnZlcnQgdGltZXN0YW1wcwogICAgICAgICAgICBpZiAoJFByb3BlcnRpZXNbJF9dWzBdIC1pcyBbU3lzdGVtLk1hcnNoYWxCeVJlZk9iamVjdF0pIHsKICAgICAgICAgICAgICAgICMgaWYgd2UgaGF2ZSBhIFN5c3RlbS5fX0NvbU9iamVjdAogICAgICAgICAgICAgICAgJFRlbXAgPSAkUHJvcGVydGllc1skX11bMF0KICAgICAgICAgICAgICAgIFtJbnQzMl0kSGlnaCA9ICRUZW1wLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoIkhpZ2hQYXJ0IiwgW1N5c3RlbS5SZWZsZWN0aW9uLkJpbmRpbmdGbGFnc106OkdldFByb3BlcnR5LCAkbnVsbCwgJFRlbXAsICRudWxsKQogICAgICAgICAgICAgICAgW0ludDMyXSRMb3cgID0gJFRlbXAuR2V0VHlwZSgpLkludm9rZU1lbWJlcigiTG93UGFydCIsICBbU3lzdGVtLlJlZmxlY3Rpb24uQmluZGluZ0ZsYWdzXTo6R2V0UHJvcGVydHksICRudWxsLCAkVGVtcCwgJG51bGwpCiAgICAgICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1skX10gPSAoW2RhdGV0aW1lXTo6RnJvbUZpbGVUaW1lKFtJbnQ2NF0oIjB4ezA6eDh9ezE6eDh9IiAtZiAkSGlnaCwgJExvdykpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gKFtkYXRldGltZV06OkZyb21GaWxlVGltZSgoJFByb3BlcnRpZXNbJF9dWzBdKSkpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZWlmKCRQcm9wZXJ0aWVzWyRfXVswXSAtaXMgW1N5c3RlbS5NYXJzaGFsQnlSZWZPYmplY3RdKSB7CiAgICAgICAgICAgICMgdHJ5IHRvIGNvbnZlcnQgbWlzYyBjb20gb2JqZWN0cwogICAgICAgICAgICAkUHJvcCA9ICRQcm9wZXJ0aWVzWyRfXQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJFRlbXAgPSAkUHJvcFskX11bMF0KICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgJF8KICAgICAgICAgICAgICAgIFtJbnQzMl0kSGlnaCA9ICRUZW1wLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoIkhpZ2hQYXJ0IiwgW1N5c3RlbS5SZWZsZWN0aW9uLkJpbmRpbmdGbGFnc106OkdldFByb3BlcnR5LCAkbnVsbCwgJFRlbXAsICRudWxsKQogICAgICAgICAgICAgICAgW0ludDMyXSRMb3cgID0gJFRlbXAuR2V0VHlwZSgpLkludm9rZU1lbWJlcigiTG93UGFydCIsICBbU3lzdGVtLlJlZmxlY3Rpb24uQmluZGluZ0ZsYWdzXTo6R2V0UHJvcGVydHksICRudWxsLCAkVGVtcCwgJG51bGwpCiAgICAgICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1skX10gPSBbSW50NjRdKCIweHswOng4fXsxOng4fSIgLWYgJEhpZ2gsICRMb3cpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gJFByb3BbJF9dCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZWlmKCRQcm9wZXJ0aWVzWyRfXS5jb3VudCAtZXEgMSkgewogICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1skX10gPSAkUHJvcGVydGllc1skX11bMF0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9ICRQcm9wZXJ0aWVzWyRfXQogICAgICAgIH0KICAgIH0KCiAgICBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAtUHJvcGVydHkgJE9iamVjdFByb3BlcnRpZXMKfQoKCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojCiMgRG9tYWluIGluZm8gZnVuY3Rpb25zIGJlbG93LgojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpmaWx0ZXIgR2V0LURvbWFpblNlYXJjaGVyIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBIZWxwZXIgdXNlZCBieSB2YXJpb3VzIGZ1bmN0aW9ucyB0aGF0IHRha2VzIGFuIEFEU3BhdGggYW5kCiAgICAgICAgZG9tYWluIHNwZWNpZmllciBhbmQgYnVpbGRzIHRoZSBjb3JyZWN0IEFEU0kgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gdXNlIGZvciB0aGUgcXVlcnksIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgQURTcHJlZml4CgogICAgICAgIFByZWZpeCB0byBzZXQgZm9yIHRoZSBzZWFyY2hlciAobGlrZSAiQ049U2l0ZXMsQ049Q29uZmlndXJhdGlvbiIpCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluIHRlc3RsYWIubG9jYWwKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluIHRlc3RsYWIubG9jYWwgLURvbWFpbkNvbnRyb2xsZXIgU0VDT05EQVJZLmRldi50ZXN0bGFiLmxvY2FsCiM+CgogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwcmVmaXgsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBpZigtbm90ICRDcmVkZW50aWFsKSB7CiAgICAgICAgaWYoLW5vdCAkRG9tYWluKSB7CiAgICAgICAgICAgICREb21haW4gPSAoR2V0LU5ldERvbWFpbikubmFtZQogICAgICAgIH0KICAgICAgICBlbHNlaWYoLW5vdCAkRG9tYWluQ29udHJvbGxlcikgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgIyBpZiB0aGVyZSdzIG5vIC1Eb21haW5Db250cm9sbGVyIHNwZWNpZmllZCwgdHJ5IHRvIHB1bGwgdGhlIHByaW1hcnkgREMgdG8gcmVmbGVjdCBxdWVyaWVzIHRocm91Z2gKICAgICAgICAgICAgICAgICREb21haW5Db250cm9sbGVyID0gKChHZXQtTmV0RG9tYWluKS5QZGNSb2xlT3duZXIpLk5hbWUKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICB0aHJvdyAiR2V0LURvbWFpblNlYXJjaGVyOiBFcnJvciBpbiByZXRyaWV2aW5nIFBEQyBmb3IgY3VycmVudCBkb21haW4iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBlbHNlaWYgKC1ub3QgJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAjIGlmIGEgREMgaXNuJ3Qgc3BlY2lmaWVkCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIgPSAoKEdldC1OZXREb21haW4gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwpLlBkY1JvbGVPd25lcikuTmFtZQogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIHRocm93ICJHZXQtRG9tYWluU2VhcmNoZXI6IEVycm9yIGluIHJldHJpZXZpbmcgUERDIGZvciBjdXJyZW50IGRvbWFpbiIKICAgICAgICB9CgogICAgICAgIGlmKCEkRG9tYWluQ29udHJvbGxlcikgewogICAgICAgICAgICB0aHJvdyAiR2V0LURvbWFpblNlYXJjaGVyOiBFcnJvciBpbiByZXRyaWV2aW5nIFBEQyBmb3IgY3VycmVudCBkb21haW4iCiAgICAgICAgfQogICAgfQoKICAgICRTZWFyY2hTdHJpbmcgPSAiTERBUDovLyIKCiAgICBpZigkRG9tYWluQ29udHJvbGxlcikgewogICAgICAgICRTZWFyY2hTdHJpbmcgKz0gJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICBpZigkRG9tYWluKXsKICAgICAgICAgICAgJFNlYXJjaFN0cmluZyArPSAnLycKICAgICAgICB9CiAgICB9CgogICAgaWYoJEFEU3ByZWZpeCkgewogICAgICAgICRTZWFyY2hTdHJpbmcgKz0gJEFEU3ByZWZpeCArICcsJwogICAgfQoKICAgIGlmKCRBRFNwYXRoKSB7CiAgICAgICAgaWYoJEFEU3BhdGggLU1hdGNoICdeR0M6Ly8nKSB7CiAgICAgICAgICAgICMgaWYgd2UncmUgc2VhcmNoaW5nIHRoZSBnbG9iYWwgY2F0YWxvZwogICAgICAgICAgICAkRE4gPSAkQWRzUGF0aC5Ub1VwcGVyKCkuVHJpbSgnLycpCiAgICAgICAgICAgICRTZWFyY2hTdHJpbmcgPSAnJwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYoJEFEU3BhdGggLW1hdGNoICdeTERBUDovLycpIHsKICAgICAgICAgICAgICAgIGlmKCRBRFNwYXRoIC1tYXRjaCAiTERBUDovLy4rLy4rIikgewogICAgICAgICAgICAgICAgICAgICRTZWFyY2hTdHJpbmcgPSAnJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJEFEU3BhdGggPSAkQURTcGF0aC5TdWJzdHJpbmcoNykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkRE4gPSAkQURTcGF0aAogICAgICAgIH0KICAgIH0KICAgIGVsc2UgewogICAgICAgIGlmKCREb21haW4gLWFuZCAoJERvbWFpbi5UcmltKCkgLW5lICIiKSkgewogICAgICAgICAgICAkRE4gPSAiREM9JCgkRG9tYWluLlJlcGxhY2UoJy4nLCAnLERDPScpKSIKICAgICAgICB9CiAgICB9CgogICAgJFNlYXJjaFN0cmluZyArPSAkRE4KICAgIFdyaXRlLVZlcmJvc2UgIkdldC1Eb21haW5TZWFyY2hlciBzZWFyY2ggc3RyaW5nOiAkU2VhcmNoU3RyaW5nIgoKICAgIGlmKCRDcmVkZW50aWFsKSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiVXNpbmcgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzIGZvciBMREFQIGNvbm5lY3Rpb24iCiAgICAgICAgJERvbWFpbk9iamVjdCA9IE5ldy1PYmplY3QgRGlyZWN0b3J5U2VydmljZXMuRGlyZWN0b3J5RW50cnkoJFNlYXJjaFN0cmluZywgJENyZWRlbnRpYWwuVXNlck5hbWUsICRDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuUGFzc3dvcmQpCiAgICAgICAgJFNlYXJjaGVyID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuRGlyZWN0b3J5U2VhcmNoZXIoJERvbWFpbk9iamVjdCkKICAgIH0KICAgIGVsc2UgewogICAgICAgICRTZWFyY2hlciA9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkRpcmVjdG9yeVNlYXJjaGVyKFtBRFNJXSRTZWFyY2hTdHJpbmcpCiAgICB9CgogICAgJFNlYXJjaGVyLlBhZ2VTaXplID0gJFBhZ2VTaXplCiAgICAkU2VhcmNoZXIuQ2FjaGVSZXN1bHRzID0gJEZhbHNlCiAgICAkU2VhcmNoZXIKfQoKCmZpbHRlciBDb252ZXJ0LUROU1JlY29yZCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICBEZWNvZGVzIGEgYmluYXJ5IEROUyByZWNvcmQuCgogICAgICAgQWRhcHRlZC9wb3J0ZWQgZnJvbSBNaWNoYWVsIEIuIFNtaXRoJ3MgY29kZSBhdCBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vbW1lc3Nhbm8vUG93ZXJTaGVsbC9tYXN0ZXIvZG5zLWR1bXAucHMxCgogICAgLlBBUkFNRVRFUiBETlNSZWNvcmQKCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3Igem9uZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuTElOSwoKICAgICAgICBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vbW1lc3Nhbm8vUG93ZXJTaGVsbC9tYXN0ZXIvZG5zLWR1bXAucHMxCiM+CiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsIFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JFRydWUsIE1hbmRhdG9yeT0kVHJ1ZSldCiAgICAgICAgW0J5dGVbXV0KICAgICAgICAkRE5TUmVjb3JkCiAgICApCgogICAgZnVuY3Rpb24gR2V0LU5hbWUgewogICAgICAgICMgbW9kaWZpZWQgZGVjb2RlTmFtZSBmcm9tIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9tbWVzc2Fuby9Qb3dlclNoZWxsL21hc3Rlci9kbnMtZHVtcC5wczEKICAgICAgICBbQ21kbGV0QmluZGluZygpXQogICAgICAgIHBhcmFtKAogICAgICAgICAgICBbQnl0ZVtdXQogICAgICAgICAgICAkUmF3CiAgICAgICAgKQoKICAgICAgICBbSW50XSRMZW5ndGggPSAkUmF3WzBdCiAgICAgICAgW0ludF0kU2VnbWVudHMgPSAkUmF3WzFdCiAgICAgICAgW0ludF0kSW5kZXggPSAgMgogICAgICAgIFtTdHJpbmddJE5hbWUgID0gIiIKCiAgICAgICAgd2hpbGUgKCRTZWdtZW50cy0tIC1ndCAwKQogICAgICAgIHsKICAgICAgICAgICAgW0ludF0kU2VnbWVudExlbmd0aCA9ICRSYXdbJEluZGV4KytdCiAgICAgICAgICAgIHdoaWxlICgkU2VnbWVudExlbmd0aC0tIC1ndCAwKSB7CiAgICAgICAgICAgICAgICAkTmFtZSArPSBbQ2hhcl0kUmF3WyRJbmRleCsrXQogICAgICAgICAgICB9CiAgICAgICAgICAgICROYW1lICs9ICIuIgogICAgICAgIH0KICAgICAgICAkTmFtZQogICAgfQoKICAgICRSRGF0YUxlbiA9IFtCaXRDb252ZXJ0ZXJdOjpUb1VJbnQxNigkRE5TUmVjb3JkLCAwKQogICAgJFJEYXRhVHlwZSA9IFtCaXRDb252ZXJ0ZXJdOjpUb1VJbnQxNigkRE5TUmVjb3JkLCAyKQogICAgJFVwZGF0ZWRBdFNlcmlhbCA9IFtCaXRDb252ZXJ0ZXJdOjpUb1VJbnQzMigkRE5TUmVjb3JkLCA4KQoKICAgICRUVExSYXcgPSAkRE5TUmVjb3JkWzEyLi4xNV0KICAgICMgcmV2ZXJzZSBmb3IgYmlnIGVuZGlhbgogICAgJE51bGwgPSBbYXJyYXldOjpSZXZlcnNlKCRUVExSYXcpCiAgICAkVFRMID0gW0JpdENvbnZlcnRlcl06OlRvVUludDMyKCRUVExSYXcsIDApCgogICAgJEFnZSA9IFtCaXRDb252ZXJ0ZXJdOjpUb1VJbnQzMigkRE5TUmVjb3JkLCAyMCkKICAgIGlmKCRBZ2UgLW5lIDApIHsKICAgICAgICAkVGltZVN0YW1wID0gKChHZXQtRGF0ZSAtWWVhciAxNjAxIC1Nb250aCAxIC1EYXkgMSAtSG91ciAwIC1NaW51dGUgMCAtU2Vjb25kIDApLkFkZEhvdXJzKCRhZ2UpKS5Ub1N0cmluZygpCiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkVGltZVN0YW1wID0gIltzdGF0aWNdIgogICAgfQoKICAgICRETlNSZWNvcmRPYmplY3QgPSBOZXctT2JqZWN0IFBTT2JqZWN0CgogICAgaWYoJFJEYXRhVHlwZSAtZXEgMSkgewogICAgICAgICRJUCA9ICJ7MH0uezF9LnsyfS57M30iIC1mICRETlNSZWNvcmRbMjRdLCAkRE5TUmVjb3JkWzI1XSwgJEROU1JlY29yZFsyNl0sICRETlNSZWNvcmRbMjddCiAgICAgICAgJERhdGEgPSAkSVAKICAgICAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1JlY29yZFR5cGUnICdBJwogICAgfQoKICAgIGVsc2VpZigkUkRhdGFUeXBlIC1lcSAyKSB7CiAgICAgICAgJE5TTmFtZSA9IEdldC1OYW1lICRETlNSZWNvcmRbMjQuLiRETlNSZWNvcmQubGVuZ3RoXQogICAgICAgICREYXRhID0gJE5TTmFtZQogICAgICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUmVjb3JkVHlwZScgJ05TJwogICAgfQoKICAgIGVsc2VpZigkUkRhdGFUeXBlIC1lcSA1KSB7CiAgICAgICAgJEFsaWFzID0gR2V0LU5hbWUgJEROU1JlY29yZFsyNC4uJEROU1JlY29yZC5sZW5ndGhdCiAgICAgICAgJERhdGEgPSAkQWxpYXMKICAgICAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1JlY29yZFR5cGUnICdDTkFNRScKICAgIH0KCiAgICBlbHNlaWYoJFJEYXRhVHlwZSAtZXEgNikgewogICAgICAgICMgVE9ETzogaG93IHRvIGltcGxlbWVudCBwcm9wZXJseT8gbmVzdGVkIG9iamVjdD8KICAgICAgICAkRGF0YSA9ICQoW1N5c3RlbS5Db252ZXJ0XTo6VG9CYXNlNjRTdHJpbmcoJEROU1JlY29yZFsyNC4uJEROU1JlY29yZC5sZW5ndGhdKSkKICAgICAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1JlY29yZFR5cGUnICdTT0EnCiAgICB9CgogICAgZWxzZWlmKCRSRGF0YVR5cGUgLWVxIDEyKSB7CiAgICAgICAgJFB0ciA9IEdldC1OYW1lICRETlNSZWNvcmRbMjQuLiRETlNSZWNvcmQubGVuZ3RoXQogICAgICAgICREYXRhID0gJFB0cgogICAgICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUmVjb3JkVHlwZScgJ1BUUicKICAgIH0KCiAgICBlbHNlaWYoJFJEYXRhVHlwZSAtZXEgMTMpIHsKICAgICAgICAjIFRPRE86IGhvdyB0byBpbXBsZW1lbnQgcHJvcGVybHk/IG5lc3RlZCBvYmplY3Q/CiAgICAgICAgJERhdGEgPSAkKFtTeXN0ZW0uQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKCRETlNSZWNvcmRbMjQuLiRETlNSZWNvcmQubGVuZ3RoXSkpCiAgICAgICAgJEROU1JlY29yZE9iamVjdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdSZWNvcmRUeXBlJyAnSElORk8nCiAgICB9CgogICAgZWxzZWlmKCRSRGF0YVR5cGUgLWVxIDE1KSB7CiAgICAgICAgIyBUT0RPOiBob3cgdG8gaW1wbGVtZW50IHByb3Blcmx5PyBuZXN0ZWQgb2JqZWN0PwogICAgICAgICREYXRhID0gJChbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkRE5TUmVjb3JkWzI0Li4kRE5TUmVjb3JkLmxlbmd0aF0pKQogICAgICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUmVjb3JkVHlwZScgJ01YJwogICAgfQoKICAgIGVsc2VpZigkUkRhdGFUeXBlIC1lcSAxNikgewoKICAgICAgICBbc3RyaW5nXSRUWFQgID0gIiIKICAgICAgICBbaW50XSRTZWdtZW50TGVuZ3RoID0gJEROU1JlY29yZFsyNF0KICAgICAgICAkSW5kZXggPSAyNQogICAgICAgIHdoaWxlICgkU2VnbWVudExlbmd0aC0tIC1ndCAwKSB7CiAgICAgICAgICAgICRUWFQgKz0gW2NoYXJdJEROU1JlY29yZFskaW5kZXgrK10KICAgICAgICB9CgogICAgICAgICREYXRhID0gJFRYVAogICAgICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUmVjb3JkVHlwZScgJ1RYVCcKICAgIH0KCiAgICBlbHNlaWYoJFJEYXRhVHlwZSAtZXEgMjgpIHsKICAgICAgICAjIFRPRE86IGhvdyB0byBpbXBsZW1lbnQgcHJvcGVybHk/IG5lc3RlZCBvYmplY3Q/CiAgICAgICAgJERhdGEgPSAkKFtTeXN0ZW0uQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKCRETlNSZWNvcmRbMjQuLiRETlNSZWNvcmQubGVuZ3RoXSkpCiAgICAgICAgJEROU1JlY29yZE9iamVjdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdSZWNvcmRUeXBlJyAnQUFBQScKICAgIH0KCiAgICBlbHNlaWYoJFJEYXRhVHlwZSAtZXEgMzMpIHsKICAgICAgICAjIFRPRE86IGhvdyB0byBpbXBsZW1lbnQgcHJvcGVybHk/IG5lc3RlZCBvYmplY3Q/CiAgICAgICAgJERhdGEgPSAkKFtTeXN0ZW0uQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKCRETlNSZWNvcmRbMjQuLiRETlNSZWNvcmQubGVuZ3RoXSkpCiAgICAgICAgJEROU1JlY29yZE9iamVjdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdSZWNvcmRUeXBlJyAnU1JWJwogICAgfQoKICAgIGVsc2UgewogICAgICAgICREYXRhID0gJChbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkRE5TUmVjb3JkWzI0Li4kRE5TUmVjb3JkLmxlbmd0aF0pKQogICAgICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUmVjb3JkVHlwZScgJ1VOS05PV04nCiAgICB9CgogICAgJEROU1JlY29yZE9iamVjdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVcGRhdGVkQXRTZXJpYWwnICRVcGRhdGVkQXRTZXJpYWwKICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVFRMJyAkVFRMCiAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0FnZScgJEFnZQogICAgJEROU1JlY29yZE9iamVjdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUaW1lU3RhbXAnICRUaW1lU3RhbXAKICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRGF0YScgJERhdGEKICAgICRETlNSZWNvcmRPYmplY3QKfQoKCmZpbHRlciBHZXQtRE5TWm9uZSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICBFbnVtZXJhdGVzIHRoZSBBY3RpdmUgRGlyZWN0b3J5IEROUyB6b25lcyBmb3IgYSBnaXZlbiBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3Igem9uZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRnVsbERhdGEKCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gZnVsbCBjb21wdXRlciBvYmplY3RzIGluc3RlYWQgb2YganVzdCBzeXN0ZW0gbmFtZXMgKHRoZSBkZWZhdWx0KS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1ETlNab25lCgogICAgICAgIFJldHJpZXZlcyB0aGUgRE5TIHpvbmVzIGZvciB0aGUgY3VycmVudCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtRE5TWm9uZSAtRG9tYWluIGRldi50ZXN0bGFiLmxvY2FsIC1Eb21haW5Db250cm9sbGVyIHByaW1hcnkudGVzdGxhYi5sb2NhbAoKICAgICAgICBSZXRyaWV2ZXMgdGhlIEROUyB6b25lcyBmb3IgdGhlIGRldi50ZXN0bGFiLmxvY2FsIGRvbWFpbiwgcmVmbGVjdGluZyB0aGUgTERBUCBxdWVyaWVzCiAgICAgICAgdGhyb3VnaCB0aGUgcHJpbWFyeS50ZXN0bGFiLmxvY2FsIGRvbWFpbiBjb250cm9sbGVyLgojPgoKICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRGdWxsRGF0YQogICAgKQoKICAgICRETlNTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZSAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbAogICAgJEROU1NlYXJjaGVyLmZpbHRlcj0iKG9iamVjdENsYXNzPWRuc1pvbmUpIgoKICAgIGlmKCRETlNTZWFyY2hlcikgewogICAgICAgICRSZXN1bHRzID0gJEROU1NlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICMgY29udmVydC9wcm9jZXNzIHRoZSBMREFQIGZpZWxkcyBmb3IgZWFjaCByZXN1bHQKICAgICAgICAgICAgJFByb3BlcnRpZXMgPSBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICRQcm9wZXJ0aWVzIHwgQWRkLU1lbWJlciBOb3RlUHJvcGVydHkgJ1pvbmVOYW1lJyAkUHJvcGVydGllcy5uYW1lCgogICAgICAgICAgICBpZiAoJEZ1bGxEYXRhKSB7CiAgICAgICAgICAgICAgICAkUHJvcGVydGllcwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgfCBTZWxlY3QtT2JqZWN0IFpvbmVOYW1lLGRpc3Rpbmd1aXNoZWRuYW1lLHdoZW5jcmVhdGVkLHdoZW5jaGFuZ2VkCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgJEROU1NlYXJjaGVyLmRpc3Bvc2UoKQogICAgfQoKICAgICRETlNTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZSAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcHJlZml4ICJDTj1NaWNyb3NvZnRETlMsREM9RG9tYWluRG5zWm9uZXMiCiAgICAkRE5TU2VhcmNoZXIuZmlsdGVyPSIob2JqZWN0Q2xhc3M9ZG5zWm9uZSkiCgogICAgaWYoJEROU1NlYXJjaGVyKSB7CiAgICAgICAgJFJlc3VsdHMgPSAkRE5TU2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgIyBjb252ZXJ0L3Byb2Nlc3MgdGhlIExEQVAgZmllbGRzIGZvciBlYWNoIHJlc3VsdAogICAgICAgICAgICAkUHJvcGVydGllcyA9IENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgJFByb3BlcnRpZXMgfCBBZGQtTWVtYmVyIE5vdGVQcm9wZXJ0eSAnWm9uZU5hbWUnICRQcm9wZXJ0aWVzLm5hbWUKCiAgICAgICAgICAgIGlmICgkRnVsbERhdGEpIHsKICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkUHJvcGVydGllcyB8IFNlbGVjdC1PYmplY3QgWm9uZU5hbWUsZGlzdGluZ3Vpc2hlZG5hbWUsd2hlbmNyZWF0ZWQsd2hlbmNoYW5nZWQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAkRE5TU2VhcmNoZXIuZGlzcG9zZSgpCiAgICB9Cn0KCgpmaWx0ZXIgR2V0LUROU1JlY29yZCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICBFbnVtZXJhdGVzIHRoZSBBY3RpdmUgRGlyZWN0b3J5IEROUyByZWNvcmRzIGZvciBhIGdpdmVuIHpvbmUuCgogICAgLlBBUkFNRVRFUiBab25lTmFtZQoKICAgICAgICBUaGUgem9uZSB0byBxdWVyeSBmb3IgcmVjb3JkcyAod2hpY2ggY2FuIGJlIGVudW1lYXJ0ZWQgd2l0aCBHZXQtRE5TWm9uZSkuIFJlcXVpcmVkLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHpvbmVzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1ETlNSZWNvcmQgLVpvbmVOYW1lIHRlc3RsYWIubG9jYWwKCiAgICAgICAgUmV0cmlldmUgYWxsIHJlY29yZHMgZm9yIHRoZSB0ZXN0bGFiLmxvY2FsIHpvbmUuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtRE5TWm9uZSB8IEdldC1ETlNSZWNvcmQKCiAgICAgICAgUmV0cmlldmUgYWxsIHJlY29yZHMgZm9yIGFsbCB6b25lcyBpbiB0aGUgY3VycmVudCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtRE5TWm9uZSAtRG9tYWluIGRldi50ZXN0bGFiLmxvY2FsIHwgR2V0LUROU1JlY29yZCAtRG9tYWluIGRldi50ZXN0bGFiLmxvY2FsCgogICAgICAgIFJldHJpZXZlIGFsbCByZWNvcmRzIGZvciBhbGwgem9uZXMgaW4gdGhlIGRldi50ZXN0bGFiLmxvY2FsIGRvbWFpbi4KIz4KCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsIFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JFRydWUsIE1hbmRhdG9yeT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkWm9uZU5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgJEROU1NlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwcmVmaXggIkRDPSQoJFpvbmVOYW1lKSxDTj1NaWNyb3NvZnRETlMsREM9RG9tYWluRG5zWm9uZXMiCiAgICAkRE5TU2VhcmNoZXIuZmlsdGVyPSIob2JqZWN0Q2xhc3M9ZG5zTm9kZSkiCgogICAgaWYoJEROU1NlYXJjaGVyKSB7CiAgICAgICAgJFJlc3VsdHMgPSAkRE5TU2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICMgY29udmVydC9wcm9jZXNzIHRoZSBMREFQIGZpZWxkcyBmb3IgZWFjaCByZXN1bHQKICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gQ29udmVydC1MREFQUHJvcGVydHkgLVByb3BlcnRpZXMgJF8uUHJvcGVydGllcyB8IFNlbGVjdC1PYmplY3QgbmFtZSxkaXN0aW5ndWlzaGVkbmFtZSxkbnNyZWNvcmQsd2hlbmNyZWF0ZWQsd2hlbmNoYW5nZWQKICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzIHwgQWRkLU1lbWJlciBOb3RlUHJvcGVydHkgJ1pvbmVOYW1lJyAkWm9uZU5hbWUKCiAgICAgICAgICAgICAgICAjIGNvbnZlcnQgdGhlIHJlY29yZCBhbmQgZXh0cmFjdCB0aGUgcHJvcGVydGllcwogICAgICAgICAgICAgICAgaWYgKCRQcm9wZXJ0aWVzLmRuc3JlY29yZCAtaXMgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5SZXN1bHRQcm9wZXJ0eVZhbHVlQ29sbGVjdGlvbl0pIHsKICAgICAgICAgICAgICAgICAgICAjIFRPRE86IGhhbmRsZSBtdWx0aXBsZSBuZXN0ZWQgcmVjb3JkcyBwcm9wZXJseT8KICAgICAgICAgICAgICAgICAgICAkUmVjb3JkID0gQ29udmVydC1ETlNSZWNvcmQgLUROU1JlY29yZCAkUHJvcGVydGllcy5kbnNyZWNvcmRbMF0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRSZWNvcmQgPSBDb252ZXJ0LUROU1JlY29yZCAtRE5TUmVjb3JkICRQcm9wZXJ0aWVzLmRuc3JlY29yZAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKCRSZWNvcmQpIHsKICAgICAgICAgICAgICAgICAgICAkUmVjb3JkLnBzb2JqZWN0LnByb3BlcnRpZXMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzIHwgQWRkLU1lbWJlciBOb3RlUHJvcGVydHkgJF8uTmFtZSAkXy5WYWx1ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkUHJvcGVydGllcwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkVSUk9SOiAkXyIKICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgJEROU1NlYXJjaGVyLmRpc3Bvc2UoKQogICAgfQp9CgoKZmlsdGVyIEdldC1OZXREb21haW4gewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFJldHVybnMgYSBnaXZlbiBkb21haW4gb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gbmFtZSB0byBxdWVyeSBmb3IsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldERvbWFpbiAtRG9tYWluIHRlc3RsYWIubG9jYWwKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+ICJ0ZXN0bGFiLmxvY2FsIiB8IEdldC1OZXREb21haW4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vc29jaWFsLnRlY2huZXQubWljcm9zb2Z0LmNvbS9Gb3J1bXMvc2NyaXB0Y2VudGVyL2VuLVVTLzBjNWIzZjgzLWU1MjgtNGQ0OS05MmE0LWRlZTMxZjRiNDgxYy9maW5kaW5nLXRoZS1kbi1vZi10aGUtdGhlLWRvbWFpbi13aXRob3V0LWFkbW9kdWxlLWluLXBvd2Vyc2hlbGw/Zm9ydW09SVRDRwojPgoKICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBpZigkQ3JlZGVudGlhbCkgewogICAgICAgIAogICAgICAgIFdyaXRlLVZlcmJvc2UgIlVzaW5nIGFsdGVybmF0ZSBjcmVkZW50aWFscyBmb3IgR2V0LU5ldERvbWFpbiIKCiAgICAgICAgaWYoISREb21haW4pIHsKICAgICAgICAgICAgIyBpZiBubyBkb21haW4gaXMgc3VwcGxpZWQsIGV4dHJhY3QgdGhlIGxvZ29uIGRvbWFpbiBmcm9tIHRoZSBQU0NyZWRlbnRpYWwgcGFzc2VkCiAgICAgICAgICAgICREb21haW4gPSAkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLkRvbWFpbgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFeHRyYWN0ZWQgZG9tYWluICckRG9tYWluJyBmcm9tIC1DcmVkZW50aWFsIgogICAgICAgIH0KICAgCiAgICAgICAgJERvbWFpbkNvbnRleHQgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRGlyZWN0b3J5Q29udGV4dCgnRG9tYWluJywgJERvbWFpbiwgJENyZWRlbnRpYWwuVXNlck5hbWUsICRDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuUGFzc3dvcmQpCiAgICAgICAgCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRG9tYWluXTo6R2V0RG9tYWluKCREb21haW5Db250ZXh0KQogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlRoZSBzcGVjaWZpZWQgZG9tYWluIGRvZXMgJyREb21haW4nIG5vdCBleGlzdCwgY291bGQgbm90IGJlIGNvbnRhY3RlZCwgdGhlcmUgaXNuJ3QgYW4gZXhpc3RpbmcgdHJ1c3QsIG9yIHRoZSBzcGVjaWZpZWQgY3JlZGVudGlhbHMgYXJlIGludmFsaWQuIgogICAgICAgICAgICAkTnVsbAogICAgICAgIH0KICAgIH0KICAgIGVsc2VpZigkRG9tYWluKSB7CiAgICAgICAgJERvbWFpbkNvbnRleHQgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRGlyZWN0b3J5Q29udGV4dCgnRG9tYWluJywgJERvbWFpbikKICAgICAgICB0cnkgewogICAgICAgICAgICBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeS5Eb21haW5dOjpHZXREb21haW4oJERvbWFpbkNvbnRleHQpCiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVGhlIHNwZWNpZmllZCBkb21haW4gJyREb21haW4nIGRvZXMgbm90IGV4aXN0LCBjb3VsZCBub3QgYmUgY29udGFjdGVkLCBvciB0aGVyZSBpc24ndCBhbiBleGlzdGluZyB0cnVzdC4iCiAgICAgICAgICAgICROdWxsCiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRG9tYWluXTo6R2V0Q3VycmVudERvbWFpbigpCiAgICB9Cn0KCgpmaWx0ZXIgR2V0LU5ldEZvcmVzdCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUmV0dXJucyBhIGdpdmVuIGZvcmVzdCBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBGb3Jlc3QKCiAgICAgICAgVGhlIGZvcmVzdCBuYW1lIHRvIHF1ZXJ5IGZvciwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKICAgIAogICAgICAgIFBTIEM6XD4gR2V0LU5ldEZvcmVzdCAtRm9yZXN0IGV4dGVybmFsLmRvbWFpbgoKICAgIC5FWEFNUExFCiAgICAKICAgICAgICBQUyBDOlw+ICJleHRlcm5hbC5kb21haW4iIHwgR2V0LU5ldEZvcmVzdAojPgoKICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZvcmVzdCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBpZigkQ3JlZGVudGlhbCkgewogICAgICAgIAogICAgICAgIFdyaXRlLVZlcmJvc2UgIlVzaW5nIGFsdGVybmF0ZSBjcmVkZW50aWFscyBmb3IgR2V0LU5ldEZvcmVzdCIKCiAgICAgICAgaWYoISRGb3Jlc3QpIHsKICAgICAgICAgICAgIyBpZiBubyBkb21haW4gaXMgc3VwcGxpZWQsIGV4dHJhY3QgdGhlIGxvZ29uIGRvbWFpbiBmcm9tIHRoZSBQU0NyZWRlbnRpYWwgcGFzc2VkCiAgICAgICAgICAgICRGb3Jlc3QgPSAkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLkRvbWFpbgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFeHRyYWN0ZWQgZG9tYWluICckRm9yZXN0JyBmcm9tIC1DcmVkZW50aWFsIgogICAgICAgIH0KICAgCiAgICAgICAgJEZvcmVzdENvbnRleHQgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRGlyZWN0b3J5Q29udGV4dCgnRm9yZXN0JywgJEZvcmVzdCwgJENyZWRlbnRpYWwuVXNlck5hbWUsICRDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuUGFzc3dvcmQpCiAgICAgICAgCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJEZvcmVzdE9iamVjdCA9IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5LkZvcmVzdF06OkdldEZvcmVzdCgkRm9yZXN0Q29udGV4dCkKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJUaGUgc3BlY2lmaWVkIGZvcmVzdCAnJEZvcmVzdCcgZG9lcyBub3QgZXhpc3QsIGNvdWxkIG5vdCBiZSBjb250YWN0ZWQsIHRoZXJlIGlzbid0IGFuIGV4aXN0aW5nIHRydXN0LCBvciB0aGUgc3BlY2lmaWVkIGNyZWRlbnRpYWxzIGFyZSBpbnZhbGlkLiIKICAgICAgICAgICAgJE51bGwKICAgICAgICB9CiAgICB9CiAgICBlbHNlaWYoJEZvcmVzdCkgewogICAgICAgICRGb3Jlc3RDb250ZXh0ID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5LkRpcmVjdG9yeUNvbnRleHQoJ0ZvcmVzdCcsICRGb3Jlc3QpCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJEZvcmVzdE9iamVjdCA9IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5LkZvcmVzdF06OkdldEZvcmVzdCgkRm9yZXN0Q29udGV4dCkKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJUaGUgc3BlY2lmaWVkIGZvcmVzdCAnJEZvcmVzdCcgZG9lcyBub3QgZXhpc3QsIGNvdWxkIG5vdCBiZSBjb250YWN0ZWQsIG9yIHRoZXJlIGlzbid0IGFuIGV4aXN0aW5nIHRydXN0LiIKICAgICAgICAgICAgcmV0dXJuICROdWxsCiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgIyBvdGhlcndpc2UgdXNlIHRoZSBjdXJyZW50IGZvcmVzdAogICAgICAgICRGb3Jlc3RPYmplY3QgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeS5Gb3Jlc3RdOjpHZXRDdXJyZW50Rm9yZXN0KCkKICAgIH0KCiAgICBpZigkRm9yZXN0T2JqZWN0KSB7CiAgICAgICAgIyBnZXQgdGhlIFNJRCBvZiB0aGUgZm9yZXN0IHJvb3QKICAgICAgICAkRm9yZXN0U2lkID0gKE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5OVEFjY291bnQoJEZvcmVzdE9iamVjdC5Sb290RG9tYWluLCJrcmJ0Z3QiKSkuVHJhbnNsYXRlKFtTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcl0pLlZhbHVlCiAgICAgICAgJFBhcnRzID0gJEZvcmVzdFNpZCAtU3BsaXQgIi0iCiAgICAgICAgJEZvcmVzdFNpZCA9ICRQYXJ0c1swLi4kKCRQYXJ0cy5sZW5ndGgtMildIC1qb2luICItIgogICAgICAgICRGb3Jlc3RPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVQcm9wZXJ0eSAnUm9vdERvbWFpblNpZCcgJEZvcmVzdFNpZAogICAgICAgICRGb3Jlc3RPYmplY3QKICAgIH0KfQoKCmZpbHRlciBHZXQtTmV0Rm9yZXN0RG9tYWluIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXR1cm4gYWxsIGRvbWFpbnMgZm9yIGEgZ2l2ZW4gZm9yZXN0LgoKICAgIC5QQVJBTUVURVIgRm9yZXN0CgogICAgICAgIFRoZSBmb3Jlc3QgbmFtZSB0byBxdWVyeSBkb21haW4gZm9yLgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Rm9yZXN0RG9tYWluCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Rm9yZXN0RG9tYWluIC1Gb3Jlc3QgZXh0ZXJuYWwubG9jYWwKIz4KCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRGb3Jlc3QsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgJEZvcmVzdE9iamVjdCA9IEdldC1OZXRGb3Jlc3QgLUZvcmVzdCAkRm9yZXN0IC1DcmVkZW50aWFsICRDcmVkZW50aWFsCgogICAgaWYoJEZvcmVzdE9iamVjdCkgewogICAgICAgICRGb3Jlc3RPYmplY3QuRG9tYWlucwogICAgfQp9CgoKZmlsdGVyIEdldC1OZXRGb3Jlc3RDYXRhbG9nIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXR1cm4gYWxsIGdsb2JhbCBjYXRhbG9ncyBmb3IgYSBnaXZlbiBmb3Jlc3QuCgogICAgLlBBUkFNRVRFUiBGb3Jlc3QKCiAgICAgICAgVGhlIGZvcmVzdCBuYW1lIHRvIHF1ZXJ5IGRvbWFpbiBmb3IuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRGb3Jlc3RDYXRhbG9nCiM+CiAgICAKICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZvcmVzdCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICAkRm9yZXN0T2JqZWN0ID0gR2V0LU5ldEZvcmVzdCAtRm9yZXN0ICRGb3Jlc3QgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwKCiAgICBpZigkRm9yZXN0T2JqZWN0KSB7CiAgICAgICAgJEZvcmVzdE9iamVjdC5GaW5kQWxsR2xvYmFsQ2F0YWxvZ3MoKQogICAgfQp9CgoKZmlsdGVyIEdldC1OZXREb21haW5Db250cm9sbGVyIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXR1cm4gdGhlIGN1cnJlbnQgZG9tYWluIGNvbnRyb2xsZXJzIGZvciB0aGUgYWN0aXZlIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciBkb21haW4gY29udHJvbGxlcnMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIExEQVAKCiAgICAgICAgU3dpdGNoLiBVc2UgTERBUCBxdWVyaWVzIHRvIGRldGVybWluZSB0aGUgZG9tYWluIGNvbnRyb2xsZXJzLgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0RG9tYWluQ29udHJvbGxlciAtRG9tYWluICd0ZXN0LmxvY2FsJwogICAgICAgIAogICAgICAgIERldGVybWluZSB0aGUgZG9tYWluIGNvbnRyb2xsZXJzIGZvciAndGVzdC5sb2NhbCcuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0RG9tYWluQ29udHJvbGxlciAtRG9tYWluICd0ZXN0LmxvY2FsJyAtTERBUAoKICAgICAgICBEZXRlcm1pbmUgdGhlIGRvbWFpbiBjb250cm9sbGVycyBmb3IgJ3Rlc3QubG9jYWwnIHVzaW5nIExEQVAgcXVlcmllcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+ICd0ZXN0LmxvY2FsJyB8IEdldC1OZXREb21haW5Db250cm9sbGVyCgogICAgICAgIERldGVybWluZSB0aGUgZG9tYWluIGNvbnRyb2xsZXJzIGZvciAndGVzdC5sb2NhbCcuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTERBUCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBpZigkTERBUCAtb3IgJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAjIGZpbHRlciBzdHJpbmcgdG8gcmV0dXJuIGFsbCBkb21haW4gY29udHJvbGxlcnMKICAgICAgICBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1GdWxsRGF0YSAtRmlsdGVyICcodXNlckFjY291bnRDb250cm9sOjEuMi44NDAuMTEzNTU2LjEuNC44MDM6PTgxOTIpJwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJEZvdW5kRG9tYWluID0gR2V0LU5ldERvbWFpbiAtRG9tYWluICREb21haW4gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwKICAgICAgICBpZigkRm91bmREb21haW4pIHsKICAgICAgICAgICAgJEZvdW5kZG9tYWluLkRvbWFpbkNvbnRyb2xsZXJzCiAgICAgICAgfQogICAgfQp9CgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojICJuZXQgKiIgcmVwbGFjZW1lbnRzIGFuZCBvdGhlciBmdW4gc3RhcnQgYmVsb3cKIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZnVuY3Rpb24gR2V0LU5ldFVzZXIgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFF1ZXJ5IGluZm9ybWF0aW9uIGZvciBhIGdpdmVuIHVzZXIgb3IgdXNlcnMgaW4gdGhlIGRvbWFpbgogICAgICAgIHVzaW5nIEFEU0kgYW5kIExEQVAuIEFub3RoZXIgLURvbWFpbiBjYW4gYmUgc3BlY2lmaWVkIHRvCiAgICAgICAgcXVlcnkgZm9yIHVzZXJzIGFjcm9zcyBhIHRydXN0LgogICAgICAgIFJlcGxhY2VtZW50IGZvciAibmV0IHVzZXJzIC9kb21haW4iCgogICAgLlBBUkFNRVRFUiBVc2VyTmFtZQoKICAgICAgICBVc2VybmFtZSBmaWx0ZXIgc3RyaW5nLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgdXNlcnMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgRmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlLCBlLmcuICIoZGVzY3JpcHRpb249KmFkbWluKikiCgogICAgLlBBUkFNRVRFUiBBZG1pbkNvdW50CgogICAgICAgIFN3aXRjaC4gUmV0dXJuIHVzZXJzIHdpdGggYWRtaW5Db3VudD0xLgoKICAgIC5QQVJBTUVURVIgU1BOCgogICAgICAgIFN3aXRjaC4gT25seSByZXR1cm4gdXNlciBvYmplY3RzIHdpdGggbm9uLW51bGwgc2VydmljZSBwcmluY2lwYWwgbmFtZXMuCgogICAgLlBBUkFNRVRFUiBVbmNvbnN0cmFpbmVkCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIHVzZXJzIHRoYXQgaGF2ZSB1bmNvbnN0cmFpbmVkIGRlbGVnYXRpb24uCgogICAgLlBBUkFNRVRFUiBBbGxvd0RlbGVnYXRpb24KCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gdXNlciBhY2NvdW50cyB0aGF0IGFyZSBub3QgbWFya2VkIGFzICdzZW5zaXRpdmUgYW5kIG5vdCBhbGxvd2VkIGZvciBkZWxlZ2F0aW9uJwoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0VXNlciAtRG9tYWluIHRlc3RpbmcKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRVc2VyIC1BRFNwYXRoICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiM+CgogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlck5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRmlsdGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTUE4sCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEFkbWluQ291bnQsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVuY29uc3RyYWluZWQsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEFsbG93RGVsZWdhdGlvbiwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIGJlZ2luIHsKICAgICAgICAjIHNvIHRoaXMgaXNuJ3QgcmVwZWF0ZWQgaWYgdXNlcnMgYXJlIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICAgICAkVXNlclNlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJERvbWFpbiAtQURTcGF0aCAkQURTcGF0aCAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIC1DcmVkZW50aWFsICRDcmVkZW50aWFsCiAgICB9CgogICAgcHJvY2VzcyB7CiAgICAgICAgaWYoJFVzZXJTZWFyY2hlcikgewoKICAgICAgICAgICAgIyBpZiB3ZSdyZSBjaGVja2luZyBmb3IgdW5jb25zdHJhaW5lZCBkZWxlZ2F0aW9uCiAgICAgICAgICAgIGlmKCRVbmNvbnN0cmFpbmVkKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDaGVja2luZyBmb3IgdW5jb25zdHJhaW5lZCBkZWxlZ2F0aW9uIgogICAgICAgICAgICAgICAgJEZpbHRlciArPSAiKHVzZXJBY2NvdW50Q29udHJvbDoxLjIuODQwLjExMzU1Ni4xLjQuODAzOj01MjQyODgpIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRBbGxvd0RlbGVnYXRpb24pIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkNoZWNraW5nIGZvciB1c2VycyB3aG8gY2FuIGJlIGRlbGVnYXRlZCIKICAgICAgICAgICAgICAgICMgbmVnYXRpb24gb2YgIkFjY291bnRzIHRoYXQgYXJlIHNlbnNpdGl2ZSBhbmQgbm90IHRydXN0ZWQgZm9yIGRlbGVnYXRpb24iCiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICIoISh1c2VyQWNjb3VudENvbnRyb2w6MS4yLjg0MC4xMTM1NTYuMS40LjgwMzo9MTA0ODU3NCkpIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRBZG1pbkNvdW50KSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDaGVja2luZyBmb3IgYWRtaW5Db3VudD0xIgogICAgICAgICAgICAgICAgJEZpbHRlciArPSAiKGFkbWluY291bnQ9MSkiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgY2hlY2sgaWYgd2UncmUgdXNpbmcgYSB1c2VybmFtZSBmaWx0ZXIgb3Igbm90CiAgICAgICAgICAgIGlmKCRVc2VyTmFtZSkgewogICAgICAgICAgICAgICAgIyBzYW1BY2NvdW50VHlwZT04MDUzMDYzNjggaW5kaWNhdGVzIHVzZXIgb2JqZWN0cwogICAgICAgICAgICAgICAgJFVzZXJTZWFyY2hlci5maWx0ZXI9IigmKHNhbUFjY291bnRUeXBlPTgwNTMwNjM2OCkoc2FtQWNjb3VudE5hbWU9JFVzZXJOYW1lKSRGaWx0ZXIpIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZigkU1BOKSB7CiAgICAgICAgICAgICAgICAkVXNlclNlYXJjaGVyLmZpbHRlcj0iKCYoc2FtQWNjb3VudFR5cGU9ODA1MzA2MzY4KShzZXJ2aWNlUHJpbmNpcGFsTmFtZT0qKSRGaWx0ZXIpIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgIyBmaWx0ZXIgaXMgc29tZXRoaW5nIGxpa2UgIihzYW1BY2NvdW50TmFtZT0qYmxhaCopIiBpZiBzcGVjaWZpZWQKICAgICAgICAgICAgICAgICRVc2VyU2VhcmNoZXIuZmlsdGVyPSIoJihzYW1BY2NvdW50VHlwZT04MDUzMDYzNjgpJEZpbHRlcikiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRSZXN1bHRzID0gJFVzZXJTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICMgY29udmVydC9wcm9jZXNzIHRoZSBMREFQIGZpZWxkcyBmb3IgZWFjaCByZXN1bHQKICAgICAgICAgICAgICAgICRVc2VyID0gQ29udmVydC1MREFQUHJvcGVydHkgLVByb3BlcnRpZXMgJF8uUHJvcGVydGllcwogICAgICAgICAgICAgICAgJFVzZXIuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LlVzZXInKQogICAgICAgICAgICAgICAgJFVzZXIKICAgICAgICAgICAgfQogICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgJFVzZXJTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBBZGQtTmV0VXNlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQWRkcyBhIGRvbWFpbiB1c2VyIG9yIGEgbG9jYWwgdXNlciB0byB0aGUgY3VycmVudCAob3IgcmVtb3RlKSBtYWNoaW5lLAogICAgICAgIGlmIHBlcm1pc3Npb25zIGFsbG93LCB1dGlsaXppbmcgdGhlIFdpbk5UIHNlcnZpY2UgcHJvdmlkZXIgYW5kCiAgICAgICAgRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQsIHJlc3BlY3RpdmVseS4KICAgICAgICAKICAgICAgICBUaGUgZGVmYXVsdCBiZWhhdmlvciBpcyB0byBhZGQgYSB1c2VyIHRvIHRoZSBsb2NhbCBtYWNoaW5lLgogICAgICAgIEFuIG9wdGlvbmFsIGdyb3VwIG5hbWUgdG8gYWRkIHRoZSB1c2VyIHRvIGNhbiBiZSBzcGVjaWZpZWQuCgogICAgLlBBUkFNRVRFUiBVc2VyTmFtZQoKICAgICAgICBUaGUgdXNlcm5hbWUgdG8gYWRkLiBJZiBub3QgZ2l2ZW4sIGl0IGRlZmF1bHRzIHRvICdiYWNrZG9vcicKCiAgICAuUEFSQU1FVEVSIFBhc3N3b3JkCgogICAgICAgIFRoZSBwYXNzd29yZCB0byBzZXQgZm9yIHRoZSBhZGRlZCB1c2VyLiBJZiBub3QgZ2l2ZW4sIGl0IGRlZmF1bHRzIHRvICdQYXNzd29yZDEyMyEnCgogICAgLlBBUkFNRVRFUiBHcm91cE5hbWUKCiAgICAgICAgR3JvdXAgdG8gb3B0aW9uYWxseSBhZGQgdGhlIHVzZXIgdG8uCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgSG9zdG5hbWUgdG8gYWRkIHRoZSBsb2NhbCB1c2VyIHRvLCBkZWZhdWx0cyB0byAnbG9jYWxob3N0JwoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFNwZWNpZmllZCBkb21haW4gdG8gYWRkIHRoZSB1c2VyIHRvLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gQWRkLU5ldFVzZXIgLVVzZXJOYW1lIGpvaG4gLVBhc3N3b3JkICdQYXNzd29yZDEyMyEnCiAgICAgICAgCiAgICAgICAgQWRkcyBhIGxvY2FsdXNlciAnam9obicgdG8gdGhlIGxvY2FsIG1hY2hpbmUgd2l0aCBwYXNzd29yZCBvZiAnUGFzc3dvcmQxMjMhJwoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gQWRkLU5ldFVzZXIgLVVzZXJOYW1lIGpvaG4gLVBhc3N3b3JkICdQYXNzd29yZDEyMyEnIC1Db21wdXRlck5hbWUgc2VydmVyLnRlc3RsYWIubG9jYWwKICAgICAgICAKICAgICAgICBBZGRzIGEgbG9jYWx1c2VyICdqb2huJyB3aXRoIHBhc3N3b3JkIG9mICdQYXNzd29yZDEyMyEnIHRvIHNlcnZlci50ZXN0bGFiLmxvY2FsJ3MgbG9jYWwgQWRtaW5pc3RyYXRvcnMgZ3JvdXAuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBBZGQtTmV0VXNlciAtVXNlck5hbWUgam9obiAtUGFzc3dvcmQgcGFzc3dvcmQgLUdyb3VwTmFtZSAiRG9tYWluIEFkbWlucyIgLURvbWFpbiAnJwogICAgICAgIAogICAgICAgIEFkZHMgdGhlIHVzZXIgImpvaG4iIHdpdGggcGFzc3dvcmQgInBhc3N3b3JkIiB0byB0aGUgY3VycmVudCBkb21haW4gYW5kIGFkZHMKICAgICAgICB0aGUgdXNlciB0byB0aGUgZG9tYWluIGdyb3VwICJEb21haW4gQWRtaW5zIgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gQWRkLU5ldFVzZXIgLVVzZXJOYW1lIGpvaG4gLVBhc3N3b3JkIHBhc3N3b3JkIC1Hcm91cE5hbWUgIkRvbWFpbiBBZG1pbnMiIC1Eb21haW4gJ3Rlc3RpbmcnCiAgICAgICAgCiAgICAgICAgQWRkcyB0aGUgdXNlciAiam9obiIgd2l0aCBwYXNzd29yZCAicGFzc3dvcmQiIHRvIHRoZSAndGVzdGluZycgZG9tYWluIGFuZCBhZGRzCiAgICAgICAgdGhlIHVzZXIgdG8gdGhlIGRvbWFpbiBncm91cCAiRG9tYWluIEFkbWlucyIKCiAgICAuTGluawoKICAgICAgICBodHRwOi8vYmxvZ3MudGVjaG5ldC5jb20vYi9oZXlzY3JpcHRpbmdndXkvYXJjaGl2ZS8yMDEwLzExLzIzL3VzZS1wb3dlcnNoZWxsLXRvLWNyZWF0ZS1sb2NhbC11c2VyLWFjY291bnRzLmFzcHgKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlck5hbWUgPSAnYmFja2Rvb3InLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFBhc3N3b3JkID0gJ1Bhc3N3b3JkMTIzIScsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnbG9jYWxob3N0JywKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4KICAgICkKCiAgICBpZiAoJERvbWFpbikgewoKICAgICAgICAkRG9tYWluT2JqZWN0ID0gR2V0LU5ldERvbWFpbiAtRG9tYWluICREb21haW4KICAgICAgICBpZigtbm90ICREb21haW5PYmplY3QpIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiRXJyb3IgaW4gZ3JhYmJpbmcgJERvbWFpbiBvYmplY3QiCiAgICAgICAgICAgIHJldHVybiAkTnVsbAogICAgICAgIH0KCiAgICAgICAgIyBhZGQgdGhlIGFzc2VtYmx5IHdlIG5lZWQKICAgICAgICBBZGQtVHlwZSAtQXNzZW1ibHlOYW1lIFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudAoKICAgICAgICAjIGh0dHA6Ly9yaWNoYXJkc3Bvd2Vyc2hlbGxibG9nLndvcmRwcmVzcy5jb20vMjAwOC8wNS8yNS9zeXN0ZW0tZGlyZWN0b3J5c2VydmljZXMtYWNjb3VudG1hbmFnZW1lbnQvCiAgICAgICAgIyBnZXQgdGhlIGRvbWFpbiBjb250ZXh0CiAgICAgICAgJENvbnRleHQgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuUHJpbmNpcGFsQ29udGV4dCAtQXJndW1lbnRMaXN0IChbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LkNvbnRleHRUeXBlXTo6RG9tYWluKSwgJERvbWFpbk9iamVjdAoKICAgICAgICAjIGNyZWF0ZSB0aGUgdXNlciBvYmplY3QKICAgICAgICAkVXNlciA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5Vc2VyUHJpbmNpcGFsIC1Bcmd1bWVudExpc3QgJENvbnRleHQKCiAgICAgICAgIyBzZXQgdXNlciBwcm9wZXJ0aWVzCiAgICAgICAgJFVzZXIuTmFtZSA9ICRVc2VyTmFtZQogICAgICAgICRVc2VyLlNhbUFjY291bnROYW1lID0gJFVzZXJOYW1lCiAgICAgICAgJFVzZXIuUGFzc3dvcmROb3RSZXF1aXJlZCA9ICRGYWxzZQogICAgICAgICRVc2VyLlNldFBhc3N3b3JkKCRQYXNzd29yZCkKICAgICAgICAkVXNlci5FbmFibGVkID0gJFRydWUKCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiQ3JlYXRpbmcgdXNlciAkVXNlck5hbWUgdG8gd2l0aCBwYXNzd29yZCAnJFBhc3N3b3JkJyBpbiBkb21haW4gJERvbWFpbiIKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgIyBjb21taXQgdGhlIHVzZXIKICAgICAgICAgICAgJFVzZXIuU2F2ZSgpCiAgICAgICAgICAgICJbKl0gVXNlciAkVXNlck5hbWUgc3VjY2Vzc2Z1bGx5IGNyZWF0ZWQgaW4gZG9tYWluICREb21haW4iCiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAnWyFdIFVzZXIgYWxyZWFkeSBleGlzdHMhJwogICAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAKICAgICAgICBXcml0ZS1WZXJib3NlICJDcmVhdGluZyB1c2VyICRVc2VyTmFtZSB0byB3aXRoIHBhc3N3b3JkICckUGFzc3dvcmQnIG9uICRDb21wdXRlck5hbWUiCgogICAgICAgICMgaWYgaXQncyBub3QgYSBkb21haW4gYWRkLCBpdCdzIGEgbG9jYWwgbWFjaGluZSBhZGQKICAgICAgICAkT2JqT3UgPSBbQURTSV0iV2luTlQ6Ly8kQ29tcHV0ZXJOYW1lIgogICAgICAgICRPYmpVc2VyID0gJE9iak91LkNyZWF0ZSgnVXNlcicsICRVc2VyTmFtZSkKICAgICAgICAkT2JqVXNlci5TZXRQYXNzd29yZCgkUGFzc3dvcmQpCgogICAgICAgICMgY29tbWl0IHRoZSBjaGFuZ2VzIHRvIHRoZSBsb2NhbCBtYWNoaW5lCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJE51bGwgPSAkT2JqVXNlci5TZXRJbmZvKCkKICAgICAgICAgICAgIlsqXSBVc2VyICRVc2VyTmFtZSBzdWNjZXNzZnVsbHkgY3JlYXRlZCBvbiBob3N0ICRDb21wdXRlck5hbWUiCiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAnWyFdIEFjY291bnQgYWxyZWFkeSBleGlzdHMhJwogICAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICB9CgogICAgIyBpZiBhIGdyb3VwIGlzIHNwZWNpZmllZCwgaW52b2tlIEFkZC1OZXRHcm91cFVzZXIgYW5kIHJldHVybiBpdHMgdmFsdWUKICAgIGlmICgkR3JvdXBOYW1lKSB7CiAgICAgICAgIyBpZiB3ZSdyZSBhZGRpbmcgdGhlIHVzZXIgdG8gYSBkb21haW4KICAgICAgICBpZiAoJERvbWFpbikgewogICAgICAgICAgICBBZGQtTmV0R3JvdXBVc2VyIC1Vc2VyTmFtZSAkVXNlck5hbWUgLUdyb3VwTmFtZSAkR3JvdXBOYW1lIC1Eb21haW4gJERvbWFpbgogICAgICAgICAgICAiWypdIFVzZXIgJFVzZXJOYW1lIHN1Y2Nlc3NmdWxseSBhZGRlZCB0byBncm91cCAkR3JvdXBOYW1lIGluIGRvbWFpbiAkRG9tYWluIgogICAgICAgIH0KICAgICAgICAjIG90aGVyd2lzZSwgd2UncmUgYWRkaW5nIHRvIGEgbG9jYWwgZ3JvdXAKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgQWRkLU5ldEdyb3VwVXNlciAtVXNlck5hbWUgJFVzZXJOYW1lIC1Hcm91cE5hbWUgJEdyb3VwTmFtZSAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICAgICAgIlsqXSBVc2VyICRVc2VyTmFtZSBzdWNjZXNzZnVsbHkgYWRkZWQgdG8gZ3JvdXAgJEdyb3VwTmFtZSBvbiBob3N0ICRDb21wdXRlck5hbWUiCiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gQWRkLU5ldEdyb3VwVXNlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQWRkcyBhIHVzZXIgdG8gYSBkb21haW4gZ3JvdXAgb3IgYSBsb2NhbCBncm91cCBvbiB0aGUgY3VycmVudCAob3IgcmVtb3RlKSBtYWNoaW5lLAogICAgICAgIGlmIHBlcm1pc3Npb25zIGFsbG93LCB1dGlsaXppbmcgdGhlIFdpbk5UIHNlcnZpY2UgcHJvdmlkZXIgYW5kCiAgICAgICAgRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQsIHJlc3BlY3RpdmVseS4KCiAgICAuUEFSQU1FVEVSIFVzZXJOYW1lCgogICAgICAgIFRoZSBkb21haW4gdXNlcm5hbWUgdG8gcXVlcnkgZm9yLgoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIEdyb3VwIHRvIGFkZCB0aGUgdXNlciB0by4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBIb3N0bmFtZSB0byBhZGQgdGhlIHVzZXIgdG8sIGRlZmF1bHRzIHRvIGxvY2FsaG9zdC4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBEb21haW4gdG8gYWRkIHRoZSB1c2VyIHRvLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gQWRkLU5ldEdyb3VwVXNlciAtVXNlck5hbWUgam9obiAtR3JvdXBOYW1lIEFkbWluaXN0cmF0b3JzCiAgICAgICAgCiAgICAgICAgQWRkcyBhIGxvY2FsdXNlciAiam9obiIgdG8gdGhlIGxvY2FsIGdyb3VwICJBZG1pbmlzdHJhdG9ycyIKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEFkZC1OZXRHcm91cFVzZXIgLVVzZXJOYW1lIGpvaG4gLUdyb3VwTmFtZSAiRG9tYWluIEFkbWlucyIgLURvbWFpbiBkZXYubG9jYWwKICAgICAgICAKICAgICAgICBBZGRzIHRoZSBleGlzdGluZyB1c2VyICJqb2huIiB0byB0aGUgZG9tYWluIGdyb3VwICJEb21haW4gQWRtaW5zIiBpbiAiZGV2LmxvY2FsIgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdyb3VwTmFtZSwKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbQWxpYXMoJ0hvc3ROYW1lJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4KICAgICkKCiAgICAjIGFkZCB0aGUgYXNzZW1ibHkgaWYgd2UgbmVlZCBpdAogICAgQWRkLVR5cGUgLUFzc2VtYmx5TmFtZSBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQKCiAgICAjIGlmIHdlJ3JlIGFkZGluZyB0byBhIHJlbW90ZSBob3N0J3MgbG9jYWwgZ3JvdXAsIHVzZSB0aGUgV2luTlQgcHJvdmlkZXIKICAgIGlmKCRDb21wdXRlck5hbWUgLWFuZCAoJENvbXB1dGVyTmFtZSAtbmUgImxvY2FsaG9zdCIpKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiQWRkaW5nIHVzZXIgJFVzZXJOYW1lIHRvICRHcm91cE5hbWUgb24gaG9zdCAkQ29tcHV0ZXJOYW1lIgogICAgICAgICAgICAoW0FEU0ldIldpbk5UOi8vJENvbXB1dGVyTmFtZS8kR3JvdXBOYW1lLGdyb3VwIikuYWRkKCJXaW5OVDovLyRDb21wdXRlck5hbWUvJFVzZXJOYW1lLHVzZXIiKQogICAgICAgICAgICAiWypdIFVzZXIgJFVzZXJOYW1lIHN1Y2Nlc3NmdWxseSBhZGRlZCB0byBncm91cCAkR3JvdXBOYW1lIG9uICRDb21wdXRlck5hbWUiCiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiWyFdIEVycm9yIGFkZGluZyB1c2VyICRVc2VyTmFtZSB0byBncm91cCAkR3JvdXBOYW1lIG9uICRDb21wdXRlck5hbWUiCiAgICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgIH0KCiAgICAjIG90aGVyd2lzZSBpdCdzIGEgbG9jYWwgbWFjaGluZSBvciBkb21haW4gYWRkCiAgICBlbHNlIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoJERvbWFpbikgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiQWRkaW5nIHVzZXIgJFVzZXJOYW1lIHRvICRHcm91cE5hbWUgb24gZG9tYWluICREb21haW4iCiAgICAgICAgICAgICAgICAkQ1QgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LkNvbnRleHRUeXBlXTo6RG9tYWluCiAgICAgICAgICAgICAgICAkRG9tYWluT2JqZWN0ID0gR2V0LU5ldERvbWFpbiAtRG9tYWluICREb21haW4KICAgICAgICAgICAgICAgIGlmKC1ub3QgJERvbWFpbk9iamVjdCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkTnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIyBnZXQgdGhlIGZ1bGwgcHJpbmNpcGFsIGNvbnRleHQKICAgICAgICAgICAgICAgICRDb250ZXh0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LlByaW5jaXBhbENvbnRleHQgLUFyZ3VtZW50TGlzdCAkQ1QsICREb21haW5PYmplY3QgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICMgb3RoZXJ3aXNlLCBnZXQgdGhlIGxvY2FsIG1hY2hpbmUgY29udGV4dAogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiQWRkaW5nIHVzZXIgJFVzZXJOYW1lIHRvICRHcm91cE5hbWUgb24gbG9jYWxob3N0IgogICAgICAgICAgICAgICAgJENvbnRleHQgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5QcmluY2lwYWxDb250ZXh0KFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuQ29udGV4dFR5cGVdOjpNYWNoaW5lLCAkRW52OkNvbXB1dGVyTmFtZSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBmaW5kIHRoZSBwYXJ0aWN1bGFyIGdyb3VwCiAgICAgICAgICAgICRHcm91cCA9IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuR3JvdXBQcmluY2lwYWxdOjpGaW5kQnlJZGVudGl0eSgkQ29udGV4dCwkR3JvdXBOYW1lKQoKICAgICAgICAgICAgIyBhZGQgdGhlIHBhcnRpY3VsYXIgdXNlciB0byB0aGUgZ3JvdXAKICAgICAgICAgICAgJEdyb3VwLk1lbWJlcnMuYWRkKCRDb250ZXh0LCBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LklkZW50aXR5VHlwZV06OlNhbUFjY291bnROYW1lLCAkVXNlck5hbWUpCgogICAgICAgICAgICAjIGNvbW1pdCB0aGUgY2hhbmdlcwogICAgICAgICAgICAkR3JvdXAuU2F2ZSgpCiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiRXJyb3IgYWRkaW5nICRVc2VyTmFtZSB0byAkR3JvdXBOYW1lIDogJF8iCiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LVVzZXJQcm9wZXJ0eSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUmV0dXJucyBhIGxpc3Qgb2YgYWxsIHVzZXIgb2JqZWN0IHByb3BlcnRpZXMuIElmIGEgcHJvcGVydHkKICAgICAgICBuYW1lIGlzIHNwZWNpZmllZCwgaXQgcmV0dXJucyBhbGwgW3VzZXI6cHJvcGVydHldIHZhbHVlcy4KCiAgICAgICAgVGFrZW4gZGlyZWN0bHkgZnJvbSBAb2JzY3VyZXNlYydzIHBvc3Q6CiAgICAgICAgICAgIGh0dHA6Ly9vYnNjdXJlc2VjdXJpdHkuYmxvZ3Nwb3QuY29tLzIwMTQvMDQvQURTSVNlYXJjaGVyLmh0bWwKCiAgICAuUEFSQU1FVEVSIFByb3BlcnRpZXMKCiAgICAgICAgUHJvcGVydHkgbmFtZXMgdG8gZXh0cmFjdCBmb3IgdXNlcnMuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgdXNlciBwcm9wZXJ0aWVzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Vc2VyUHJvcGVydHkgLURvbWFpbiB0ZXN0aW5nCiAgICAgICAgCiAgICAgICAgUmV0dXJucyBhbGwgdXNlciBwcm9wZXJ0aWVzIGZvciB1c2VycyBpbiB0aGUgJ3Rlc3RpbmcnIGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Vc2VyUHJvcGVydHkgLVByb3BlcnRpZXMgc3NuLGxhc3Rsb2dvbixsb2NhdGlvbgogICAgICAgIAogICAgICAgIFJldHVybnMgYWxsIGFuIGFycmF5IG9mIHVzZXIvc3NuL2xhc3Rsb2dpbi9sb2NhdGlvbiBjb21iaW5hdGlvbnMKICAgICAgICBmb3IgdXNlcnMgaW4gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly9vYnNjdXJlc2VjdXJpdHkuYmxvZ3Nwb3QuY29tLzIwMTQvMDQvQURTSVNlYXJjaGVyLmh0bWwKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgICRQcm9wZXJ0aWVzLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCiAgICAgICAgCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIGlmKCRQcm9wZXJ0aWVzKSB7CiAgICAgICAgIyBleHRyYWN0IG91dCB0aGUgc2V0IG9mIGFsbCBwcm9wZXJ0aWVzIGZvciBlYWNoIG9iamVjdAogICAgICAgICRQcm9wZXJ0aWVzID0gLCJuYW1lIiArICRQcm9wZXJ0aWVzCiAgICAgICAgR2V0LU5ldFVzZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgfCBTZWxlY3QtT2JqZWN0IC1Qcm9wZXJ0eSAkUHJvcGVydGllcwogICAgfQogICAgZWxzZSB7CiAgICAgICAgIyBleHRyYWN0IG91dCBqdXN0IHRoZSBwcm9wZXJ0eSBuYW1lcwogICAgICAgIEdldC1OZXRVc2VyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgMSB8IEdldC1NZW1iZXIgLU1lbWJlclR5cGUgKlByb3BlcnR5IHwgU2VsZWN0LU9iamVjdCAtUHJvcGVydHkgJ05hbWUnCiAgICB9Cn0KCgpmaWx0ZXIgRmluZC1Vc2VyRmllbGQgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFNlYXJjaGVzIHVzZXIgb2JqZWN0IGZpZWxkcyBmb3IgYSBnaXZlbiB3b3JkIChkZWZhdWx0ICpwYXNzKikuIERlZmF1bHQKICAgICAgICBmaWVsZCBiZWluZyBzZWFyY2hlZCBpcyAnZGVzY3JpcHRpb24nLgoKICAgICAgICBUYWtlbiBkaXJlY3RseSBmcm9tIEBvYnNjdXJlc2VjJ3MgcG9zdDoKICAgICAgICAgICAgaHR0cDovL29ic2N1cmVzZWN1cml0eS5ibG9nc3BvdC5jb20vMjAxNC8wNC9BRFNJU2VhcmNoZXIuaHRtbAoKICAgIC5QQVJBTUVURVIgU2VhcmNoVGVybQoKICAgICAgICBUZXJtIHRvIHNlYXJjaCBmb3IsIGRlZmF1bHQgb2YgInBhc3MiLgoKICAgIC5QQVJBTUVURVIgU2VhcmNoRmllbGQKCiAgICAgICAgVXNlciBmaWVsZCB0byBzZWFyY2gsIGRlZmF1bHQgb2YgImRlc2NyaXB0aW9uIi4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIERvbWFpbiB0byBzZWFyY2ggY29tcHV0ZXIgZmllbGRzIGZvciwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLVVzZXJGaWVsZCAtU2VhcmNoRmllbGQgaW5mbyAtU2VhcmNoVGVybSBiYWNrdXAKCiAgICAgICAgRmluZCB1c2VyIGFjY291bnRzIHdpdGggImJhY2t1cCIgaW4gdGhlICJpbmZvIiBmaWVsZC4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRTZWFyY2hUZXJtID0gJ3Bhc3MnLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRTZWFyY2hGaWVsZCA9ICdkZXNjcmlwdGlvbicsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQogCiAgICBHZXQtTmV0VXNlciAtQURTcGF0aCAkQURTcGF0aCAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUZpbHRlciAiKCRTZWFyY2hGaWVsZD0qJFNlYXJjaFRlcm0qKSIgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IFNlbGVjdC1PYmplY3Qgc2FtYWNjb3VudG5hbWUsJFNlYXJjaEZpZWxkCn0KCgpmaWx0ZXIgR2V0LVVzZXJFdmVudCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgRHVtcCBhbmQgcGFyc2Ugc2VjdXJpdHkgZXZlbnRzIHJlbGF0aW5nIHRvIGFuIGFjY291bnQgbG9nb24gKElEIDQ2MjQpCiAgICAgICAgb3IgYSBUR1QgcmVxdWVzdCBldmVudCAoSUQgNDc2OCkuIEludGVuZGVkIHRvIGJlIHVzZWQgYW5kIHRlc3RlZCBvbgogICAgICAgIFdpbmRvd3MgMjAwOCBEb21haW4gQ29udHJvbGxlcnMuCiAgICAgICAgQWRtaW4gUmVxZD8gWUVTCgogICAgICAgIEF1dGhvcjogQHNpeGR1YgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBjb21wdXRlciB0byBnZXQgZXZlbnRzIGZyb20uIERlZmF1bHQ6IExvY2FsaG9zdAoKICAgIC5QQVJBTUVURVIgRXZlbnRUeXBlCgogICAgICAgIEVpdGhlciAnbG9nb24nLCAndGd0Jywgb3IgJ2FsbCcuIERlZmF1bHRzOiAnbG9nb24nCgogICAgLlBBUkFNRVRFUiBEYXRlU3RhcnQKCiAgICAgICAgRmlsdGVyIG91dCBhbGwgZXZlbnRzIGJlZm9yZSB0aGlzIGRhdGUuIERlZmF1bHQ6IDUgZGF5cwoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtVXNlckV2ZW50IC1Db21wdXRlck5hbWUgRG9tYWluQ29udHJvbGxlci50ZXN0bGFiLmxvY2FsCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL3d3dy5zaXhkdWIubmV0LzIwMTQvMTEvMDcvb2ZmZW5zaXZlLWV2ZW50LXBhcnNpbmctYnJpbmdpbmctaG9tZS10cm9waGllcy8KIz4KCiAgICBQYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlck5hbWUgPSAkRW52OkNvbXB1dGVyTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVTZXQoImxvZ29uIiwidGd0IiwiYWxsIildCiAgICAgICAgJEV2ZW50VHlwZSA9ICJsb2dvbiIsCgogICAgICAgIFtEYXRlVGltZV0KICAgICAgICAkRGF0ZVN0YXJ0ID0gW0RhdGVUaW1lXTo6VG9kYXkuQWRkRGF5cygtNSksCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgaWYoJEV2ZW50VHlwZS5Ub0xvd2VyKCkgLWxpa2UgImxvZ29uIikgewogICAgICAgIFtJbnQzMltdXSRJRCA9IEAoNDYyNCkKICAgIH0KICAgIGVsc2VpZigkRXZlbnRUeXBlLlRvTG93ZXIoKSAtbGlrZSAidGd0IikgewogICAgICAgIFtJbnQzMltdXSRJRCA9IEAoNDc2OCkKICAgIH0KICAgIGVsc2UgewogICAgICAgIFtJbnQzMltdXSRJRCA9IEAoNDYyNCwgNDc2OCkKICAgIH0KCiAgICBpZigkQ3JlZGVudGlhbCkgewogICAgICAgIFdyaXRlLVZlcmJvc2UgIlVzaW5nIGFsdGVybmF0aXZlIGNyZWRlbnRpYWxzIgogICAgICAgICRBcmd1bWVudHMgPSBAewogICAgICAgICAgICAnQ29tcHV0ZXJOYW1lJyA9ICRDb21wdXRlck5hbWU7CiAgICAgICAgICAgICdDcmVkZW50aWFsJyA9ICRDcmVkZW50aWFsOwogICAgICAgICAgICAnRmlsdGVySGFzaFRhYmxlJyA9IEB7IExvZ05hbWUgPSAnU2VjdXJpdHknOyBJRD0kSUQ7IFN0YXJ0VGltZT0kRGF0ZVN0YXJ0fTsKICAgICAgICAgICAgJ0Vycm9yQWN0aW9uJyA9ICdTaWxlbnRseUNvbnRpbnVlJzsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkQXJndW1lbnRzID0gQHsKICAgICAgICAgICAgJ0NvbXB1dGVyTmFtZScgPSAkQ29tcHV0ZXJOYW1lOwogICAgICAgICAgICAnRmlsdGVySGFzaFRhYmxlJyA9IEB7IExvZ05hbWUgPSAnU2VjdXJpdHknOyBJRD0kSUQ7IFN0YXJ0VGltZT0kRGF0ZVN0YXJ0fTsKICAgICAgICAgICAgJ0Vycm9yQWN0aW9uJyA9ICdTaWxlbnRseUNvbnRpbnVlJzsgICAgICAgICAgICAKICAgICAgICB9CiAgICB9CgogICAgIyBncmFiIGFsbCBldmVudHMgbWF0Y2hpbmcgb3VyIGZpbHRlciBmb3IgdGhlIHNwZWNpZmllZCBob3N0CiAgICBHZXQtV2luRXZlbnQgQEFyZ3VtZW50cyB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgaWYoJElEIC1jb250YWlucyA0NjI0KSB7ICAgIAogICAgICAgICAgICAjIGZpcnN0IHBhcnNlIGFuZCBjaGVjayB0aGUgbG9nb24gZXZlbnQgdHlwZS4gVGhpcyBjb3VsZCBiZSBsYXRlciBhZGFwdGVkIGFuZCB0ZXN0ZWQgZm9yIFJEUCBsb2dvbnMgKHR5cGUgMTApCiAgICAgICAgICAgIGlmKCRfLm1lc3NhZ2UgLW1hdGNoICcoP3MpKD88PUxvZ29uIFR5cGU6KS4qPyg/PShJbXBlcnNvbmF0aW9uIExldmVsOnxOZXcgTG9nb246KSknKSB7CiAgICAgICAgICAgICAgICBpZigkTWF0Y2hlcykgewogICAgICAgICAgICAgICAgICAgICRMb2dvblR5cGUgPSAkTWF0Y2hlc1swXS50cmltKCkKICAgICAgICAgICAgICAgICAgICAkTWF0Y2hlcyA9ICROdWxsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkTG9nb25UeXBlID0gIiIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBpbnRlcmFjdGl2ZSBsb2dvbnMgb3IgZG9tYWluIGxvZ29ucwogICAgICAgICAgICBpZiAoKCRMb2dvblR5cGUgLWVxIDIpIC1vciAoJExvZ29uVHlwZSAtZXEgMykpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgIyBwYXJzZSBhbmQgc3RvcmUgdGhlIGFjY291bnQgdXNlZCBhbmQgdGhlIGFkZHJlc3MgdGhleSBjYW1lIGZyb20KICAgICAgICAgICAgICAgICAgICBpZigkXy5tZXNzYWdlIC1tYXRjaCAnKD9zKSg/PD1OZXcgTG9nb246KS4qPyg/PVByb2Nlc3MgSW5mb3JtYXRpb246KScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJE1hdGNoZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyTmFtZSA9ICRNYXRjaGVzWzBdLnNwbGl0KCJgbiIpWzJdLnNwbGl0KCI6IilbMV0udHJpbSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluID0gJE1hdGNoZXNbMF0uc3BsaXQoImBuIilbM10uc3BsaXQoIjoiKVsxXS50cmltKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNYXRjaGVzID0gJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZigkXy5tZXNzYWdlIC1tYXRjaCAnKD9zKSg/PD1OZXR3b3JrIEluZm9ybWF0aW9uOikuKj8oPz1Tb3VyY2UgUG9ydDopJykgewogICAgICAgICAgICAgICAgICAgICAgICBpZigkTWF0Y2hlcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEFkZHJlc3MgPSAkTWF0Y2hlc1swXS5zcGxpdCgiYG4iKVsyXS5zcGxpdCgiOiIpWzFdLnRyaW0oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1hdGNoZXMgPSAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAjIG9ubHkgYWRkIGlmIHRoZXJlIHdhcyBhY2NvdW50IGluZm9ybWF0aW9uIG5vdCBmb3IgYSBtYWNoaW5lIG9yIGFub255bW91cyBsb2dvbgogICAgICAgICAgICAgICAgICAgIGlmICgkVXNlck5hbWUgLWFuZCAoLW5vdCAkVXNlck5hbWUuZW5kc1dpdGgoJyQnKSkgLWFuZCAoJFVzZXJOYW1lIC1uZSAnQU5PTllNT1VTIExPR09OJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJExvZ29uRXZlbnRQcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdEb21haW4nID0gJERvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbXB1dGVyTmFtZScgPSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnVXNlcm5hbWUnID0gJFVzZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQWRkcmVzcycgPSAkQWRkcmVzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0lEJyA9ICc0NjI0JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0xvZ29uVHlwZScgPSAkTG9nb25UeXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnVGltZScgPSAkXy5UaW1lQ3JlYXRlZAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IC1Qcm9wZXJ0eSAkTG9nb25FdmVudFByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgcGFyc2luZyBldmVudCBsb2dzOiAkXyIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZigkSUQgLWNvbnRhaW5zIDQ3NjgpIHsKICAgICAgICAgICAgIyB0aGUgVEdUIGV2ZW50IHR5cGUKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmKCRfLm1lc3NhZ2UgLW1hdGNoICcoP3MpKD88PUFjY291bnQgSW5mb3JtYXRpb246KS4qPyg/PVNlcnZpY2UgSW5mb3JtYXRpb246KScpIHsKICAgICAgICAgICAgICAgICAgICBpZigkTWF0Y2hlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkVXNlcm5hbWUgPSAkTWF0Y2hlc1swXS5zcGxpdCgiYG4iKVsxXS5zcGxpdCgiOiIpWzFdLnRyaW0oKQogICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluID0gJE1hdGNoZXNbMF0uc3BsaXQoImBuIilbMl0uc3BsaXQoIjoiKVsxXS50cmltKCkKICAgICAgICAgICAgICAgICAgICAgICAgJE1hdGNoZXMgPSAkTnVsbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigkXy5tZXNzYWdlIC1tYXRjaCAnKD9zKSg/PD1OZXR3b3JrIEluZm9ybWF0aW9uOikuKj8oPz1BZGRpdGlvbmFsIEluZm9ybWF0aW9uOiknKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoJE1hdGNoZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEFkZHJlc3MgPSAkTWF0Y2hlc1swXS5zcGxpdCgiYG4iKVsxXS5zcGxpdCgiOiIpWy0xXS50cmltKCkKICAgICAgICAgICAgICAgICAgICAgICAgJE1hdGNoZXMgPSAkTnVsbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkTG9nb25FdmVudFByb3BlcnRpZXMgPSBAewogICAgICAgICAgICAgICAgICAgICdEb21haW4nID0gJERvbWFpbgogICAgICAgICAgICAgICAgICAgICdDb21wdXRlck5hbWUnID0gJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgICAgICdVc2VybmFtZScgPSAkVXNlck5hbWUKICAgICAgICAgICAgICAgICAgICAnQWRkcmVzcycgPSAkQWRkcmVzcwogICAgICAgICAgICAgICAgICAgICdJRCcgPSAnNDc2OCcKICAgICAgICAgICAgICAgICAgICAnTG9nb25UeXBlJyA9ICcnCiAgICAgICAgICAgICAgICAgICAgJ1RpbWUnID0gJF8uVGltZUNyZWF0ZWQKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAtUHJvcGVydHkgJExvZ29uRXZlbnRQcm9wZXJ0aWVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgcGFyc2luZyBldmVudCBsb2dzOiAkXyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1PYmplY3RBY2wgewo8IwogICAgLlNZTk9QU0lTCiAgICAgICAgUmV0dXJucyB0aGUgQUNMcyBhc3NvY2lhdGVkIHdpdGggYSBzcGVjaWZpYyBhY3RpdmUgZGlyZWN0b3J5IG9iamVjdC4KCiAgICAgICAgVGhhbmtzIFNlYW4gTWV0Y2FsZiAoQHB5cm90ZWszKSBmb3IgdGhlIGlkZWEgYW5kIGd1aWRhbmNlLgoKICAgIC5QQVJBTUVURVIgU2FtQWNjb3VudE5hbWUKCiAgICAgICAgT2JqZWN0IG5hbWUgdG8gZmlsdGVyIGZvci4gICAgICAgIAoKICAgIC5QQVJBTUVURVIgTmFtZQoKICAgICAgICBPYmplY3QgbmFtZSB0byBmaWx0ZXIgZm9yLgoKICAgIC5QQVJBTUVURVIgRGlzdGluZ3Vpc2hlZE5hbWUKCiAgICAgICAgT2JqZWN0IGRpc3Rpbmd1aXNoZWQgbmFtZSB0byBmaWx0ZXIgZm9yLgoKICAgIC5QQVJBTUVURVIgUmVzb2x2ZUdVSURzCgogICAgICAgIFN3aXRjaC4gUmVzb2x2ZSBHVUlEcyB0byB0aGVpciBkaXNwbGF5IG5hbWVzLgoKICAgIC5QQVJBTUVURVIgRmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlLCBlLmcuICIoZGVzY3JpcHRpb249KmFkbWluKikiCiAgICAgCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgQURTcHJlZml4CgogICAgICAgIFByZWZpeCB0byBzZXQgZm9yIHRoZSBzZWFyY2hlciAobGlrZSAiQ049U2l0ZXMsQ049Q29uZmlndXJhdGlvbiIpCgogICAgLlBBUkFNRVRFUiBSaWdodHNGaWx0ZXIKCiAgICAgICAgT25seSByZXR1cm4gcmVzdWx0cyB3aXRoIHRoZSBhc3NvY2lhdGVkIHJpZ2h0cywgIkFsbCIsICJSZXNldFBhc3N3b3JkIiwiV3JpdGVNZW1iZXJzIgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gdXNlIGZvciB0aGUgcXVlcnksIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1PYmplY3RBY2wgLVNhbUFjY291bnROYW1lIG1hdHQuYWRtaW4gLWRvbWFpbiB0ZXN0bGFiLmxvY2FsCiAgICAgICAgCiAgICAgICAgR2V0IHRoZSBBQ0xzIGZvciB0aGUgbWF0dC5hZG1pbiB1c2VyIGluIHRoZSB0ZXN0bGFiLmxvY2FsIGRvbWFpbgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU9iamVjdEFjbCAtU2FtQWNjb3VudE5hbWUgbWF0dC5hZG1pbiAtZG9tYWluIHRlc3RsYWIubG9jYWwgLVJlc29sdmVHVUlEcwogICAgICAgIAogICAgICAgIEdldCB0aGUgQUNMcyBmb3IgdGhlIG1hdHQuYWRtaW4gdXNlciBpbiB0aGUgdGVzdGxhYi5sb2NhbCBkb21haW4gYW5kCiAgICAgICAgcmVzb2x2ZSByZWxldmFudCBHVUlEcyB0byB0aGVpciBkaXNwbGF5IG5hbWVzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldE9VIC1GdWxsRGF0YSB8IEdldC1PYmplY3RBY2wgLVJlc29sdmVHVUlEcwoKICAgICAgICBFbnVtZXJhdGUgdGhlIEFDTCBwZXJtaXNzaW9ucyBmb3IgYWxsIE9VcyBpbiB0aGUgZG9tYWluLgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRTYW1BY2NvdW50TmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICROYW1lID0gIioiLAoKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERpc3Rpbmd1aXNoZWROYW1lID0gIioiLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRSZXNvbHZlR1VJRHMsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcHJlZml4LAoKICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZVNldCgiQWxsIiwiUmVzZXRQYXNzd29yZCIsIldyaXRlTWVtYmVycyIpXQogICAgICAgICRSaWdodHNGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwCiAgICApCgogICAgYmVnaW4gewogICAgICAgICRTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUFEU3BhdGggJEFEU3BhdGggLUFEU3ByZWZpeCAkQURTcHJlZml4IC1QYWdlU2l6ZSAkUGFnZVNpemUgCgogICAgICAgICMgZ2V0IGEgR1VJRCAtPiBuYW1lIG1hcHBpbmcKICAgICAgICBpZigkUmVzb2x2ZUdVSURzKSB7CiAgICAgICAgICAgICRHVUlEcyA9IEdldC1HVUlETWFwIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICAgICAgfQogICAgfQoKICAgIHByb2Nlc3MgewoKICAgICAgICBpZiAoJFNlYXJjaGVyKSB7CgogICAgICAgICAgICBpZigkU2FtQWNjb3VudE5hbWUpIHsKICAgICAgICAgICAgICAgICRTZWFyY2hlci5maWx0ZXI9IigmKHNhbWFjY291bnRuYW1lPSRTYW1BY2NvdW50TmFtZSkobmFtZT0kTmFtZSkoZGlzdGluZ3Vpc2hlZG5hbWU9JERpc3Rpbmd1aXNoZWROYW1lKSRGaWx0ZXIpIiAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkU2VhcmNoZXIuZmlsdGVyPSIoJihuYW1lPSROYW1lKShkaXN0aW5ndWlzaGVkbmFtZT0kRGlzdGluZ3Vpc2hlZE5hbWUpJEZpbHRlcikiICAKICAgICAgICAgICAgfQogIAogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJFJlc3VsdHMgPSAkU2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICRPYmplY3QgPSBbYWRzaV0oJF8ucGF0aCkKCiAgICAgICAgICAgICAgICAgICAgaWYoJE9iamVjdC5kaXN0aW5ndWlzaGVkbmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAkQWNjZXNzID0gJE9iamVjdC5Qc0Jhc2UuT2JqZWN0U2VjdXJpdHkuYWNjZXNzCiAgICAgICAgICAgICAgICAgICAgICAgICRBY2Nlc3MgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkXyB8IEFkZC1NZW1iZXIgTm90ZVByb3BlcnR5ICdPYmplY3RETicgJE9iamVjdC5kaXN0aW5ndWlzaGVkbmFtZVswXQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRPYmplY3Qub2JqZWN0c2lkWzBdKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUyA9IChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyKCRPYmplY3Qub2JqZWN0c2lkWzBdLDApKS5WYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFMgPSAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkXyB8IEFkZC1NZW1iZXIgTm90ZVByb3BlcnR5ICdPYmplY3RTSUQnICRTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkXwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICBpZigkUmlnaHRzRmlsdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRHdWlkRmlsdGVyID0gU3dpdGNoICgkUmlnaHRzRmlsdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiUmVzZXRQYXNzd29yZCIgeyAiMDAyOTk1NzAtMjQ2ZC0xMWQwLWE3NjgtMDBhYTAwNmUwNTI5IiB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiV3JpdGVNZW1iZXJzIiB7ICJiZjk2NzljMC0wZGU2LTExZDAtYTI4NS0wMGFhMDAzMDQ5ZTIiIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgeyAiMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwIn0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZigkXy5PYmplY3RUeXBlIC1lcSAkR3VpZEZpbHRlcikgeyAkXyB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkXwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgaWYoJEdVSURzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgd2UncmUgcmVzb2x2aW5nIEdVSURzLCBtYXAgdGhlbSB0aGVtIHRvIHRoZSByZXNvbHZlZCBoYXNoIHRhYmxlCiAgICAgICAgICAgICAgICAgICAgICAgICRBY2xQcm9wZXJ0aWVzID0gQHt9CiAgICAgICAgICAgICAgICAgICAgICAgICRfLnBzb2JqZWN0LnByb3BlcnRpZXMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiggKCRfLk5hbWUgLWVxICdPYmplY3RUeXBlJykgLW9yICgkXy5OYW1lIC1lcSAnSW5oZXJpdGVkT2JqZWN0VHlwZScpICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBY2xQcm9wZXJ0aWVzWyRfLk5hbWVdID0gJEdVSURTWyRfLlZhbHVlLnRvU3RyaW5nKCldCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEFjbFByb3BlcnRpZXNbJF8uTmFtZV0gPSAkXy5WYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBY2xQcm9wZXJ0aWVzWyRfLk5hbWVdID0gJF8uVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAtUHJvcGVydHkgJEFjbFByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7ICRfIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICAgICAgICAgJFNlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgJF8KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEFkZC1PYmplY3RBY2wgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEFkZHMgYW4gQUNMIGZvciBhIHNwZWNpZmljIGFjdGl2ZSBkaXJlY3Rvcnkgb2JqZWN0LgogICAgICAgIAogICAgICAgIEFkbWluU0RIb2xkZXIgQUNMIGFwcHJvYWNoIGZyb20gU2VhbiBNZXRjYWxmIChAcHlyb3RlazMpCiAgICAgICAgICAgIGh0dHBzOi8vYWRzZWN1cml0eS5vcmcvP3A9MTkwNgoKICAgICAgICBBQ0Ugc2V0dGluZyBtZXRob2QgYWRhcHRlZCBmcm9tIGh0dHBzOi8vc29jaWFsLnRlY2huZXQubWljcm9zb2Z0LmNvbS9Gb3J1bXMvd2luZG93c3NlcnZlci9lbi1VUy9kZjNiZmQzMy1jMDcwLTRhOWMtYmU5OC1jNGRhNmU1OTFhMGEvZm9ydW0tZmFxLXVzaW5nLXBvd2Vyc2hlbGwtdG8tYXNzaWduLXBlcm1pc3Npb25zLW9uLWFjdGl2ZS1kaXJlY3Rvcnktb2JqZWN0cy4KCiAgICAgICAgJ1Jlc2V0UGFzc3dvcmQnIGRvZXNuJ3QgbmVlZCB0byBrbm93IHRoZSB1c2VyJ3MgY3VycmVudCBwYXNzd29yZAogICAgICAgICdXcml0ZU1lbWJlcnMnIGFsbG93cyBmb3IgdGhlIG1vZGlmaWNhdGlvbiBvZiBncm91cCBtZW1iZXJzaGlwCgogICAgLlBBUkFNRVRFUiBUYXJnZXRTYW1BY2NvdW50TmFtZQoKICAgICAgICBUYXJnZXQgb2JqZWN0IG5hbWUgdG8gZmlsdGVyIGZvci4gICAgICAgIAoKICAgIC5QQVJBTUVURVIgVGFyZ2V0TmFtZQoKICAgICAgICBUYXJnZXQgb2JqZWN0IG5hbWUgdG8gZmlsdGVyIGZvci4KCiAgICAuUEFSQU1FVEVSIFRhcmdldERpc3Rpbmd1aXNoZWROYW1lCgogICAgICAgIFRhcmdldCBvYmplY3QgZGlzdGluZ3Vpc2hlZCBuYW1lIHRvIGZpbHRlciBmb3IuCgogICAgLlBBUkFNRVRFUiBUYXJnZXRGaWx0ZXIKCiAgICAgICAgQSBjdXN0b21pemVkIGxkYXAgZmlsdGVyIHN0cmluZyB0byB1c2UgdG8gZmluZCBhIHRhcmdldCwgZS5nLiAiKGRlc2NyaXB0aW9uPSphZG1pbiopIgoKICAgIC5QQVJBTUVURVIgVGFyZ2V0QURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgZm9yIHRoZSB0YXJnZXQsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKCiAgICAuUEFSQU1FVEVSIFRhcmdldEFEU3ByZWZpeAoKICAgICAgICBQcmVmaXggdG8gc2V0IGZvciB0aGUgdGFyZ2V0IHNlYXJjaGVyIChsaWtlICJDTj1TaXRlcyxDTj1Db25maWd1cmF0aW9uIikKCiAgICAuUEFSQU1FVEVSIFByaW5jaXBhbFNJRAoKICAgICAgICBUaGUgU0lEIG9mIHRoZSBwcmluY2lwYWwgb2JqZWN0IHRvIGFkZCBmb3IgYWNjZXNzLgoKICAgIC5QQVJBTUVURVIgUHJpbmNpcGFsTmFtZQoKICAgICAgICBUaGUgbmFtZSBvZiB0aGUgcHJpbmNpcGFsIG9iamVjdCB0byBhZGQgZm9yIGFjY2Vzcy4KCiAgICAuUEFSQU1FVEVSIFByaW5jaXBhbFNhbUFjY291bnROYW1lCgogICAgICAgIFRoZSBzYW1BY2NvdW50TmFtZSBvZiB0aGUgcHJpbmNpcGFsIG9iamVjdCB0byBhZGQgZm9yIGFjY2Vzcy4KCiAgICAuUEFSQU1FVEVSIFJpZ2h0cwoKICAgICAgICBSaWdodHMgdG8gYWRkIGZvciB0aGUgcHJpbmNpcGFsLCAiQWxsIiwiUmVzZXRQYXNzd29yZCIsIldyaXRlTWVtYmVycyIsIkRDU3luYyIKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHVzZSBmb3IgdGhlIHRhcmdldCBxdWVyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5FWEFNUExFCgogICAgICAgIEFkZC1PYmplY3RBY2wgLVRhcmdldFNhbUFjY291bnROYW1lIG1hdHQgLVByaW5jaXBhbFNhbUFjY291bnROYW1lIGpvaG4KCiAgICAgICAgR3JhbnRzICdqb2huJyBhbGwgZnVsbCBhY2Nlc3MgcmlnaHRzIHRvIHRoZSAnbWF0dCcgYWNjb3VudC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBBZGQtT2JqZWN0QWNsIC1UYXJnZXRTYW1BY2NvdW50TmFtZSBtYXR0IC1QcmluY2lwYWxTYW1BY2NvdW50TmFtZSBqb2huIC1SaWdodHMgUmVzZXRQYXNzd29yZAoKICAgICAgICBHcmFudHMgJ2pvaG4nIHRoZSByaWdodCB0byByZXNldCB0aGUgcGFzc3dvcmQgZm9yIHRoZSAnbWF0dCcgYWNjb3VudC4KCiAgICAuTElOSwoKICAgICAgICBodHRwczovL2Fkc2VjdXJpdHkub3JnLz9wPTE5MDYKICAgICAgICAKICAgICAgICBodHRwczovL3NvY2lhbC50ZWNobmV0Lm1pY3Jvc29mdC5jb20vRm9ydW1zL3dpbmRvd3NzZXJ2ZXIvZW4tVVMvZGYzYmZkMzMtYzA3MC00YTljLWJlOTgtYzRkYTZlNTkxYTBhL2ZvcnVtLWZhcS11c2luZy1wb3dlcnNoZWxsLXRvLWFzc2lnbi1wZXJtaXNzaW9ucy1vbi1hY3RpdmUtZGlyZWN0b3J5LW9iamVjdHM/Zm9ydW09d2luc2VydmVycG93ZXJzaGVsbAojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGFyZ2V0U2FtQWNjb3VudE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFRhcmdldE5hbWUgPSAiKiIsCgogICAgICAgIFtBbGlhcygnRE4nKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRUYXJnZXREaXN0aW5ndWlzaGVkTmFtZSA9ICIqIiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGFyZ2V0RmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRUYXJnZXRBRFNwYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRUYXJnZXRBRFNwcmVmaXgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlUGF0dGVybignXlMtMS01LTIxLVswLTldKy1bMC05XSstWzAtOV0rLVswLTldKycpXQogICAgICAgICRQcmluY2lwYWxTSUQsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFByaW5jaXBhbE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFByaW5jaXBhbFNhbUFjY291bnROYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZVNldCgiQWxsIiwiUmVzZXRQYXNzd29yZCIsIldyaXRlTWVtYmVycyIsIkRDU3luYyIpXQogICAgICAgICRSaWdodHMgPSAiQWxsIiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkUmlnaHRzR1VJRCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgJFNlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQURTcGF0aCAkVGFyZ2V0QURTcGF0aCAtQURTcHJlZml4ICRUYXJnZXRBRFNwcmVmaXggLVBhZ2VTaXplICRQYWdlU2l6ZQoKICAgICAgICBpZigkUHJpbmNpcGFsU0lEKSB7CiAgICAgICAgICAgICRSZXNvbHZlZFByaW5jaXBhbFNJRCA9ICRQcmluY2lwYWxTSUQKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRQcmluY2lwYWwgPSBHZXQtQURPYmplY3QgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1OYW1lICRQcmluY2lwYWxOYW1lIC1TYW1BY2NvdW50TmFtZSAkUHJpbmNpcGFsU2FtQWNjb3VudE5hbWUgLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgICAgICAgICAKICAgICAgICAgICAgaWYoISRQcmluY2lwYWwpIHsKICAgICAgICAgICAgICAgIHRocm93ICJFcnJvciByZXNvbHZpbmcgcHJpbmNpcGFsIgogICAgICAgICAgICB9CiAgICAgICAgICAgICRSZXNvbHZlZFByaW5jaXBhbFNJRCA9ICRQcmluY2lwYWwub2JqZWN0c2lkCiAgICAgICAgfQogICAgICAgIGlmKCEkUmVzb2x2ZWRQcmluY2lwYWxTSUQpIHsKICAgICAgICAgICAgdGhyb3cgIkVycm9yIHJlc29sdmluZyBwcmluY2lwYWwiCiAgICAgICAgfQogICAgfQoKICAgIHByb2Nlc3MgewoKICAgICAgICBpZiAoJFNlYXJjaGVyKSB7CgogICAgICAgICAgICBpZigkVGFyZ2V0U2FtQWNjb3VudE5hbWUpIHsKICAgICAgICAgICAgICAgICRTZWFyY2hlci5maWx0ZXI9IigmKHNhbWFjY291bnRuYW1lPSRUYXJnZXRTYW1BY2NvdW50TmFtZSkobmFtZT0kVGFyZ2V0TmFtZSkoZGlzdGluZ3Vpc2hlZG5hbWU9JFRhcmdldERpc3Rpbmd1aXNoZWROYW1lKSRUYXJnZXRGaWx0ZXIpIiAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkU2VhcmNoZXIuZmlsdGVyPSIoJihuYW1lPSRUYXJnZXROYW1lKShkaXN0aW5ndWlzaGVkbmFtZT0kVGFyZ2V0RGlzdGluZ3Vpc2hlZE5hbWUpJFRhcmdldEZpbHRlcikiICAKICAgICAgICAgICAgfQogIAogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJFJlc3VsdHMgPSAkU2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICAgICAjIGFkYXB0ZWQgZnJvbSBodHRwczovL3NvY2lhbC50ZWNobmV0Lm1pY3Jvc29mdC5jb20vRm9ydW1zL3dpbmRvd3NzZXJ2ZXIvZW4tVVMvZGYzYmZkMzMtYzA3MC00YTljLWJlOTgtYzRkYTZlNTkxYTBhL2ZvcnVtLWZhcS11c2luZy1wb3dlcnNoZWxsLXRvLWFzc2lnbi1wZXJtaXNzaW9ucy1vbi1hY3RpdmUtZGlyZWN0b3J5LW9iamVjdHMKCiAgICAgICAgICAgICAgICAgICAgJFRhcmdldEROID0gJF8uUHJvcGVydGllcy5kaXN0aW5ndWlzaGVkbmFtZQoKICAgICAgICAgICAgICAgICAgICAkSWRlbnRpdHkgPSBbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5JZGVudGl0eVJlZmVyZW5jZV0gKFtTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcl0kUmVzb2x2ZWRQcmluY2lwYWxTSUQpCiAgICAgICAgICAgICAgICAgICAgJEluaGVyaXRhbmNlVHlwZSA9IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5U2VjdXJpdHlJbmhlcml0YW5jZV0gIk5vbmUiCiAgICAgICAgICAgICAgICAgICAgJENvbnRyb2xUeXBlID0gW1N5c3RlbS5TZWN1cml0eS5BY2Nlc3NDb250cm9sLkFjY2Vzc0NvbnRyb2xUeXBlXSAiQWxsb3ciCiAgICAgICAgICAgICAgICAgICAgJEFDRXMgPSBAKCkKCiAgICAgICAgICAgICAgICAgICAgaWYoJFJpZ2h0c0dVSUQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEdVSURzID0gQCgkUmlnaHRzR1VJRCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRHVUlEcyA9IFN3aXRjaCAoJFJpZ2h0cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBSZXNldFBhc3N3b3JkIGRvZXNuJ3QgbmVlZCB0byBrbm93IHRoZSB1c2VyJ3MgY3VycmVudCBwYXNzd29yZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlJlc2V0UGFzc3dvcmQiIHsgIjAwMjk5NTcwLTI0NmQtMTFkMC1hNzY4LTAwYWEwMDZlMDUyOSIgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBhbGxvd3MgZm9yIHRoZSBtb2RpZmljYXRpb24gb2YgZ3JvdXAgbWVtYmVyc2hpcAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIldyaXRlTWVtYmVycyIgeyAiYmY5Njc5YzAtMGRlNi0xMWQwLWEyODUtMDBhYTAwMzA0OWUyIiB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICdEUy1SZXBsaWNhdGlvbi1HZXQtQ2hhbmdlcycgPSAxMTMxZjZhYS05YzA3LTExZDEtZjc5Zi0wMGMwNGZjMmRjZDIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgJ0RTLVJlcGxpY2F0aW9uLUdldC1DaGFuZ2VzLUFsbCcgPSAxMTMxZjZhZC05YzA3LTExZDEtZjc5Zi0wMGMwNGZjMmRjZDIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgJ0RTLVJlcGxpY2F0aW9uLUdldC1DaGFuZ2VzLUluLUZpbHRlcmVkLVNldCcgPSA4OWU5NWI3Ni00NDRkLTRjNjItOTkxYS0wZmFjYmVkYTY0MGMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICB3aGVuIGFwcGxpZWQgdG8gYSBkb21haW4ncyBBQ0wsIGFsbG93cyBmb3IgdGhlIHVzZSBvZiBEQ1N5bmMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJEQ1N5bmMiIHsgIjExMzFmNmFhLTljMDctMTFkMS1mNzlmLTAwYzA0ZmMyZGNkMiIsICIxMTMxZjZhZC05YzA3LTExZDEtZjc5Zi0wMGMwNGZjMmRjZDIiLCAiODllOTViNzYtNDQ0ZC00YzYyLTk5MWEtMGZhY2JlZGE2NDBjIn0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYoJEdVSURzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJEdVSUQgaW4gJEdVSURzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTmV3R1VJRCA9IE5ldy1PYmplY3QgR3VpZCAkR1VJRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEFEUmlnaHRzID0gW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnlSaWdodHNdICJFeHRlbmRlZFJpZ2h0IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEFDRXMgKz0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5QWNjZXNzUnVsZSAkSWRlbnRpdHksJEFEUmlnaHRzLCRDb250cm9sVHlwZSwkTmV3R1VJRCwkSW5oZXJpdGFuY2VUeXBlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgZGVhdWx0IHRvIEdlbmVyaWNBbGwgcmlnaHRzCiAgICAgICAgICAgICAgICAgICAgICAgICRBRFJpZ2h0cyA9IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5UmlnaHRzXSAiR2VuZXJpY0FsbCIKICAgICAgICAgICAgICAgICAgICAgICAgJEFDRXMgKz0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5QWNjZXNzUnVsZSAkSWRlbnRpdHksJEFEUmlnaHRzLCRDb250cm9sVHlwZSwkSW5oZXJpdGFuY2VUeXBlCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJHcmFudGluZyBwcmluY2lwYWwgJFJlc29sdmVkUHJpbmNpcGFsU0lEICckUmlnaHRzJyBvbiAkKCRfLlByb3BlcnRpZXMuZGlzdGluZ3Vpc2hlZG5hbWUpIgoKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAjIGFkZCBhbGwgdGhlIG5ldyBBQ0VzIHRvIHRoZSBzcGVjaWZpZWQgb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIEZvckVhY2ggKCRBQ0UgaW4gJEFDRXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkdyYW50aW5nIHByaW5jaXBhbCAkUmVzb2x2ZWRQcmluY2lwYWxTSUQgJyQoJEFDRS5PYmplY3RUeXBlKScgcmlnaHRzIG9uICQoJF8uUHJvcGVydGllcy5kaXN0aW5ndWlzaGVkbmFtZSkiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkT2JqZWN0ID0gW2Fkc2ldKCRfLnBhdGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkT2JqZWN0LlBzQmFzZS5PYmplY3RTZWN1cml0eS5BZGRBY2Nlc3NSdWxlKCRBQ0UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkT2JqZWN0LlBzQmFzZS5jb21taXRjaGFuZ2VzKCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkVycm9yIGdyYW50aW5nIHByaW5jaXBhbCAkUmVzb2x2ZWRQcmluY2lwYWxTSUQgJyRSaWdodHMnIG9uICRUYXJnZXRETiA6ICRfIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICAgICAgICAgJFNlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkVycm9yOiAkXyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEludm9rZS1BQ0xTY2FubmVyIHsKPCMKICAgIC5TWU5PUFNJUwogICAgICAgIFNlYXJjaGVzIGZvciBBQ0xzIGZvciBzcGVjaWZhYmxlIEFEIG9iamVjdHMgKGRlZmF1bHQgdG8gYWxsIGRvbWFpbiBvYmplY3RzKQogICAgICAgIHdpdGggYSBkb21haW4gc2lkIG9mID4gLTEwMDAsIGFuZCBoYXZlIG1vZGlmaWFibGUgcmlnaHRzLgoKICAgICAgICBUaGFua3MgU2VhbiBNZXRjYWxmIChAcHlyb3RlazMpIGZvciB0aGUgaWRlYSBhbmQgZ3VpZGFuY2UuCgogICAgLlBBUkFNRVRFUiBTYW1BY2NvdW50TmFtZQoKICAgICAgICBPYmplY3QgbmFtZSB0byBmaWx0ZXIgZm9yLiAgICAgICAgCgogICAgLlBBUkFNRVRFUiBOYW1lCgogICAgICAgIE9iamVjdCBuYW1lIHRvIGZpbHRlciBmb3IuCgogICAgLlBBUkFNRVRFUiBEaXN0aW5ndWlzaGVkTmFtZQoKICAgICAgICBPYmplY3QgZGlzdGluZ3Vpc2hlZCBuYW1lIHRvIGZpbHRlciBmb3IuCgogICAgLlBBUkFNRVRFUiBGaWx0ZXIKCiAgICAgICAgQSBjdXN0b21pemVkIGxkYXAgZmlsdGVyIHN0cmluZyB0byB1c2UsIGUuZy4gIihkZXNjcmlwdGlvbj0qYWRtaW4qKSIKICAgICAKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBBRFNwcmVmaXgKCiAgICAgICAgUHJlZml4IHRvIHNldCBmb3IgdGhlIHNlYXJjaGVyIChsaWtlICJDTj1TaXRlcyxDTj1Db25maWd1cmF0aW9uIikKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHVzZSBmb3IgdGhlIHF1ZXJ5LCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBSZXNvbHZlR1VJRHMKCiAgICAgICAgU3dpdGNoLiBSZXNvbHZlIEdVSURzIHRvIHRoZWlyIGRpc3BsYXkgbmFtZXMuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtQUNMU2Nhbm5lciAtUmVzb2x2ZUdVSURzIHwgRXhwb3J0LUNTViAtTm9UeXBlSW5mb3JtYXRpb24gYWNscy5jc3YKCiAgICAgICAgRW51bWVyYXRlIGFsbCBtb2RpZmFibGUgQUNMcyBpbiB0aGUgY3VycmVudCBkb21haW4sIHJlc29sdmluZyBHVUlEcyB0byBkaXNwbGF5IAogICAgICAgIG5hbWVzLCBhbmQgZXhwb3J0IGV2ZXJ5dGhpbmcgdG8gYSAuY3N2CiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRTYW1BY2NvdW50TmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkTmFtZSA9ICIqIiwKCiAgICAgICAgW0FsaWFzKCdETicpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERpc3Rpbmd1aXNoZWROYW1lID0gIioiLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3ByZWZpeCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRSZXNvbHZlR1VJRHMsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMAogICAgKQoKICAgICMgR2V0IGFsbCBkb21haW4gQUNMcyB3aXRoIHRoZSBhcHByb3ByaWF0ZSBwYXJhbWV0ZXJzCiAgICBHZXQtT2JqZWN0QUNMIEBQU0JvdW5kUGFyYW1ldGVycyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAjIGFkZCBpbiB0aGUgdHJhbnNsYXRlZCBTSUQgZm9yIHRoZSBvYmplY3QgaWRlbnRpdHkKICAgICAgICAkXyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJZGVudGl0eVNJRCcgKCRfLklkZW50aXR5UmVmZXJlbmNlLlRyYW5zbGF0ZShbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXJdKS5WYWx1ZSkKICAgICAgICAkXwogICAgfSB8IFdoZXJlLU9iamVjdCB7CiAgICAgICAgIyBjaGVjayBmb3IgYW55IEFDTHMgd2l0aCBTSURzID4gLTEwMDAKICAgICAgICB0cnkgewogICAgICAgICAgICAjIFRPRE86IGNoYW5nZSB0aGlzIHRvIGEgcmVnZXggZm9yIHNwZWVkdXA/CiAgICAgICAgICAgIFtpbnRdKCRfLklkZW50aXR5U2lkLnNwbGl0KCItIilbLTFdKSAtZ2UgMTAwMAogICAgICAgIH0KICAgICAgICBjYXRjaCB7fQogICAgfSB8IFdoZXJlLU9iamVjdCB7CiAgICAgICAgIyBmaWx0ZXIgZm9yIG1vZGlmaWFibGUgcmlnaHRzCiAgICAgICAgKCRfLkFjdGl2ZURpcmVjdG9yeVJpZ2h0cyAtZXEgIkdlbmVyaWNBbGwiKSAtb3IgKCRfLkFjdGl2ZURpcmVjdG9yeVJpZ2h0cyAtbWF0Y2ggIldyaXRlIikgLW9yICgkXy5BY3RpdmVEaXJlY3RvcnlSaWdodHMgLW1hdGNoICJDcmVhdGUiKSAtb3IgKCRfLkFjdGl2ZURpcmVjdG9yeVJpZ2h0cyAtbWF0Y2ggIkRlbGV0ZSIpIC1vciAoKCRfLkFjdGl2ZURpcmVjdG9yeVJpZ2h0cyAtbWF0Y2ggIkV4dGVuZGVkUmlnaHQiKSAtYW5kICgkXy5BY2Nlc3NDb250cm9sVHlwZSAtZXEgIkFsbG93IikpCiAgICB9Cn0KCgpmaWx0ZXIgR2V0LUdVSURNYXAgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEhlbHBlciB0byBidWlsZCBhIGhhc2ggdGFibGUgb2YgW0dVSURdIC0+IHJlc29sdmVkIG5hbWVzCgogICAgICAgIEhlYXZpbHkgYWRhcHRlZCBmcm9tIGh0dHA6Ly9ibG9ncy50ZWNobmV0LmNvbS9iL2FzaGxleW1jZ2xvbmUvYXJjaGl2ZS8yMDEzLzAzLzI1L2FjdGl2ZS1kaXJlY3Rvcnktb3UtcGVybWlzc2lvbnMtcmVwb3J0LWZyZWUtcG93ZXJzaGVsbC1zY3JpcHQtZG93bmxvYWQuYXNweAoKICAgIC5QQVJBTUVURVIgRG9tYWluCiAgICAKICAgICAgICBUaGUgZG9tYWluIHRvIHVzZSBmb3IgdGhlIHF1ZXJ5LCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCiAgICAKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly9ibG9ncy50ZWNobmV0LmNvbS9iL2FzaGxleW1jZ2xvbmUvYXJjaGl2ZS8yMDEzLzAzLzI1L2FjdGl2ZS1kaXJlY3Rvcnktb3UtcGVybWlzc2lvbnMtcmVwb3J0LWZyZWUtcG93ZXJzaGVsbC1zY3JpcHQtZG93bmxvYWQuYXNweAojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAKICAgICkKCiAgICAkR1VJRHMgPSBAeycwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDAnID0gJ0FsbCd9CgogICAgJFNjaGVtYVBhdGggPSAoR2V0LU5ldEZvcmVzdCkuc2NoZW1hLm5hbWUKCiAgICAkU2NoZW1hU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLUFEU3BhdGggJFNjaGVtYVBhdGggLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgaWYoJFNjaGVtYVNlYXJjaGVyKSB7CiAgICAgICAgJFNjaGVtYVNlYXJjaGVyLmZpbHRlciA9ICIoc2NoZW1hSURHVUlEPSopIgogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRSZXN1bHRzID0gJFNjaGVtYVNlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgIyBjb252ZXJ0IHRoZSBHVUlECiAgICAgICAgICAgICAgICAkR1VJRHNbKE5ldy1PYmplY3QgR3VpZCAoLCRfLnByb3BlcnRpZXMuc2NoZW1haWRndWlkWzBdKSkuR3VpZF0gPSAkXy5wcm9wZXJ0aWVzLm5hbWVbMF0KICAgICAgICAgICAgfQogICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgJFNjaGVtYVNlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIGluIGJ1aWxkaW5nIEdVSUQgbWFwOiAkXyIKICAgICAgICB9CiAgICB9CgogICAgJFJpZ2h0c1NlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1BRFNwYXRoICRTY2hlbWFQYXRoLnJlcGxhY2UoIlNjaGVtYSIsIkV4dGVuZGVkLVJpZ2h0cyIpIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwKICAgIGlmICgkUmlnaHRzU2VhcmNoZXIpIHsKICAgICAgICAkUmlnaHRzU2VhcmNoZXIuZmlsdGVyID0gIihvYmplY3RDbGFzcz1jb250cm9sQWNjZXNzUmlnaHQpIgogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRSZXN1bHRzID0gJFJpZ2h0c1NlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgIyBjb252ZXJ0IHRoZSBHVUlECiAgICAgICAgICAgICAgICAkR1VJRHNbJF8ucHJvcGVydGllcy5yaWdodHNndWlkWzBdLnRvU3RyaW5nKCldID0gJF8ucHJvcGVydGllcy5uYW1lWzBdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICRSaWdodHNTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBpbiBidWlsZGluZyBHVUlEIG1hcDogJF8iCiAgICAgICAgfQogICAgfQoKICAgICRHVUlEcwp9CgoKZnVuY3Rpb24gR2V0LU5ldENvbXB1dGVyIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHV0aWxpemVzIGFkc2lzZWFyY2hlciB0byBxdWVyeSB0aGUgY3VycmVudCBBRCBjb250ZXh0CiAgICAgICAgZm9yIGN1cnJlbnQgY29tcHV0ZXIgb2JqZWN0cy4gQmFzZWQgb2ZmIG9mIENhcmxvcyBQZXJleidzIEF1ZGl0LnBzbTEKICAgICAgICBzY3JpcHQgaW4gUG9zaC1TZWNNb2QgKGxpbmsgYmVsb3cpLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFJldHVybiBjb21wdXRlcnMgd2l0aCBhIHNwZWNpZmljIG5hbWUsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIFNQTgoKICAgICAgICBSZXR1cm4gY29tcHV0ZXJzIHdpdGggYSBzcGVjaWZpYyBzZXJ2aWNlIHByaW5jaXBhbCBuYW1lLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBPcGVyYXRpbmdTeXN0ZW0KCiAgICAgICAgUmV0dXJuIGNvbXB1dGVycyB3aXRoIGEgc3BlY2lmaWMgb3BlcmF0aW5nIHN5c3RlbSwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgU2VydmljZVBhY2sKCiAgICAgICAgUmV0dXJuIGNvbXB1dGVycyB3aXRoIGEgc3BlY2lmaWMgc2VydmljZSBwYWNrLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBGaWx0ZXIKCiAgICAgICAgQSBjdXN0b21pemVkIGxkYXAgZmlsdGVyIHN0cmluZyB0byB1c2UsIGUuZy4gIihkZXNjcmlwdGlvbj0qYWRtaW4qKSIKCiAgICAuUEFSQU1FVEVSIFByaW50ZXJzCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIG9ubHkgcHJpbnRlcnMuCgogICAgLlBBUkFNRVRFUiBQaW5nCgogICAgICAgIFN3aXRjaC4gUGluZyBlYWNoIGhvc3QgdG8gZW5zdXJlIGl0J3MgdXAgYmVmb3JlIGVudW1lcmF0aW5nLgoKICAgIC5QQVJBTUVURVIgRnVsbERhdGEKCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gZnVsbCBjb21wdXRlciBvYmplY3RzIGluc3RlYWQgb2YganVzdCBzeXN0ZW0gbmFtZXMgKHRoZSBkZWZhdWx0KS4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciBjb21wdXRlcnMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgogICAgCiAgICAuUEFSQU1FVEVSIFNpdGVOYW1lCgogICAgICAgIFRoZSBBRCBTaXRlIG5hbWUgdG8gc2VhcmNoIGZvciBjb21wdXRlcnMuCgogICAgLlBBUkFNRVRFUiBVbmNvbnN0cmFpbmVkCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIGNvbXB1dGVyIG9iamVjdHMgdGhhdCBoYXZlIHVuY29uc3RyYWluZWQgZGVsZWdhdGlvbi4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldENvbXB1dGVyCiAgICAgICAgCiAgICAgICAgUmV0dXJucyB0aGUgY3VycmVudCBjb21wdXRlcnMgaW4gY3VycmVudCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Q29tcHV0ZXIgLVNQTiBtc3NxbCoKICAgICAgICAKICAgICAgICBSZXR1cm5zIGFsbCBNUyBTUUwgc2VydmVycyBvbiB0aGUgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldENvbXB1dGVyIC1Eb21haW4gdGVzdGluZwogICAgICAgIAogICAgICAgIFJldHVybnMgdGhlIGN1cnJlbnQgY29tcHV0ZXJzIGluICd0ZXN0aW5nJyBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiB0ZXN0aW5nIC1GdWxsRGF0YQogICAgICAgIAogICAgICAgIFJldHVybnMgZnVsbCBjb21wdXRlciBvYmplY3RzIGluIHRoZSAndGVzdGluZycgZG9tYWluLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9kYXJrb3BlcmF0b3IvUG9zaC1TZWNNb2QvYmxvYi9tYXN0ZXIvQXVkaXQvQXVkaXQucHNtMQojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICcqJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU1BOLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRPcGVyYXRpbmdTeXN0ZW0sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNlcnZpY2VQYWNrLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRGaWx0ZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFByaW50ZXJzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRQaW5nLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRGdWxsRGF0YSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRTaXRlTmFtZSwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVW5jb25zdHJhaW5lZCwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIGJlZ2luIHsKICAgICAgICAjIHNvIHRoaXMgaXNuJ3QgcmVwZWF0ZWQgaWYgbXVsdGlwbGUgY29tcHV0ZXIgbmFtZXMgYXJlIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICAgICAkQ29tcFNlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQURTcGF0aCAkQURTcGF0aCAtUGFnZVNpemUgJFBhZ2VTaXplIC1DcmVkZW50aWFsICRDcmVkZW50aWFsCiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIGlmICgkQ29tcFNlYXJjaGVyKSB7CgogICAgICAgICAgICAjIGlmIHdlJ3JlIGNoZWNraW5nIGZvciB1bmNvbnN0cmFpbmVkIGRlbGVnYXRpb24KICAgICAgICAgICAgaWYoJFVuY29uc3RyYWluZWQpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlNlYXJjaGluZyBmb3IgY29tcHV0ZXJzIHdpdGggZm9yIHVuY29uc3RyYWluZWQgZGVsZWdhdGlvbiIKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIih1c2VyQWNjb3VudENvbnRyb2w6MS4yLjg0MC4xMTM1NTYuMS40LjgwMzo9NTI0Mjg4KSIKICAgICAgICAgICAgfQogICAgICAgICAgICAjIHNldCB0aGUgZmlsdGVycyBmb3IgdGhlIHNlcmFjaGVyIGlmIGl0IGV4aXN0cwogICAgICAgICAgICBpZigkUHJpbnRlcnMpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlNlYXJjaGluZyBmb3IgcHJpbnRlcnMiCiAgICAgICAgICAgICAgICAjICRDb21wU2VhcmNoZXIuZmlsdGVyPSIoJihvYmplY3RDYXRlZ29yeT1wcmludFF1ZXVlKSRGaWx0ZXIpIgogICAgICAgICAgICAgICAgJEZpbHRlciArPSAiKG9iamVjdENhdGVnb3J5PXByaW50UXVldWUpIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRTUE4pIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlNlYXJjaGluZyBmb3IgY29tcHV0ZXJzIHdpdGggU1BOOiAkU1BOIgogICAgICAgICAgICAgICAgJEZpbHRlciArPSAiKHNlcnZpY2VQcmluY2lwYWxOYW1lPSRTUE4pIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRPcGVyYXRpbmdTeXN0ZW0pIHsKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIihvcGVyYXRpbmdzeXN0ZW09JE9wZXJhdGluZ1N5c3RlbSkiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJFNlcnZpY2VQYWNrKSB7CiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICIob3BlcmF0aW5nc3lzdGVtc2VydmljZXBhY2s9JFNlcnZpY2VQYWNrKSIKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkU2l0ZU5hbWUpIHsKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIihzZXJ2ZXJyZWZlcmVuY2VibD0kU2l0ZU5hbWUpIgogICAgICAgICAgICB9CgogICAgICAgICAgICAkQ29tcEZpbHRlciA9ICIoJihzQU1BY2NvdW50VHlwZT04MDUzMDYzNjkpKGRuc2hvc3RuYW1lPSRDb21wdXRlck5hbWUpJEZpbHRlcikiCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkdldC1OZXRDb21wdXRlciBmaWx0ZXIgOiAnJENvbXBGaWx0ZXInIgogICAgICAgICAgICAkQ29tcFNlYXJjaGVyLmZpbHRlciA9ICRDb21wRmlsdGVyCgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJFJlc3VsdHMgPSAkQ29tcFNlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAkVXAgPSAkVHJ1ZQogICAgICAgICAgICAgICAgICAgIGlmKCRQaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgVE9ETzogaG93IGNhbiB0aGVzZSByZXN1bHRzIGJlIHBpcGVkIHRvIHBpbmcgZm9yIGEgc3BlZWR1cD8KICAgICAgICAgICAgICAgICAgICAgICAgJFVwID0gVGVzdC1Db25uZWN0aW9uIC1Db3VudCAxIC1RdWlldCAtQ29tcHV0ZXJOYW1lICRfLnByb3BlcnRpZXMuZG5zaG9zdG5hbWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoJFVwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgcmV0dXJuIGZ1bGwgZGF0YSBvYmplY3RzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkRnVsbERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgY29udmVydC9wcm9jZXNzIHRoZSBMREFQIGZpZWxkcyBmb3IgZWFjaCByZXN1bHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDb21wdXRlciA9IENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDb21wdXRlci5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuQ29tcHV0ZXInKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJENvbXB1dGVyCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSB3ZSdyZSBqdXN0IHJldHVybmluZyB0aGUgRE5TIGhvc3QgbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJF8ucHJvcGVydGllcy5kbnNob3N0bmFtZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICAgICAkQ29tcFNlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkVycm9yOiAkXyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1BRE9iamVjdCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGFrZXMgYSBkb21haW4gU0lEIGFuZCByZXR1cm5zIHRoZSB1c2VyLCBncm91cCwgb3IgY29tcHV0ZXIgb2JqZWN0CiAgICAgICAgYXNzb2NpYXRlZCB3aXRoIGl0LgoKICAgIC5QQVJBTUVURVIgU0lECgogICAgICAgIFRoZSBTSUQgb2YgdGhlIGRvbWFpbiBvYmplY3QgeW91J3JlIHF1ZXJ5aW5nIGZvci4KCiAgICAuUEFSQU1FVEVSIE5hbWUKCiAgICAgICAgVGhlIE5hbWUgb2YgdGhlIGRvbWFpbiBvYmplY3QgeW91J3JlIHF1ZXJ5aW5nIGZvci4KCiAgICAuUEFSQU1FVEVSIFNhbUFjY291bnROYW1lCgogICAgICAgIFRoZSBTYW1BY2NvdW50TmFtZSBvZiB0aGUgZG9tYWluIG9iamVjdCB5b3UncmUgcXVlcnlpbmcgZm9yLiAKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciBvYmplY3RzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCwgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIEZpbHRlcgoKICAgICAgICBBZGRpdGlvbmFsIExEQVAgZmlsdGVyIHN0cmluZyBmb3IgdGhlIHF1ZXJ5LgoKICAgIC5QQVJBTUVURVIgUmV0dXJuUmF3CgogICAgICAgIFN3aXRjaC4gUmV0dXJuIHRoZSByYXcgb2JqZWN0IGluc3RlYWQgb2YgdHJhbnNsYXRpbmcgaXRzIHByb3BlcnRpZXMuCiAgICAgICAgVXNlZCBieSBTZXQtQURPYmplY3QgdG8gbW9kaWZ5IG9iamVjdCBwcm9wZXJ0aWVzLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtQURPYmplY3QgLVNJRCAiUy0xLTUtMjEtMjYyMDg5MTgyOS0yNDExMjYxNDk3LTE3NzM4NTMwODgtMTExMCIKICAgICAgICAKICAgICAgICBHZXQgdGhlIGRvbWFpbiBvYmplY3QgYXNzb2NpYXRlZCB3aXRoIHRoZSBzcGVjaWZpZWQgU0lELgogICAgICAgIAogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtQURPYmplY3QgLUFEU3BhdGggIkNOPUFkbWluU0RIb2xkZXIsQ049U3lzdGVtLERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgCiAgICAgICAgR2V0IHRoZSBBZG1pblNESG9sZGVyIG9iamVjdCBmb3IgdGhlIHRlc3RsYWIubG9jYWwgZG9tYWluLgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU0lELAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICROYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRTYW1BY2NvdW50TmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRGaWx0ZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJldHVyblJhdywKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQogICAgcHJvY2VzcyB7CiAgICAgICAgaWYoJFNJRCkgewogICAgICAgICAgICAjIGlmIGEgU0lEIGlzIHBhc3NlZCwgdHJ5IHRvIHJlc29sdmUgaXQgdG8gYSByZWFjaGFibGUgZG9tYWluIG5hbWUgZm9yIHRoZSBzZWFyY2hlcgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJE5hbWUgPSBDb252ZXJ0LVNpZFRvTmFtZSAkU0lECiAgICAgICAgICAgICAgICBpZigkTmFtZSkgewogICAgICAgICAgICAgICAgICAgICRDYW5vbmljYWwgPSBDb252ZXJ0LUFETmFtZSAtT2JqZWN0TmFtZSAkTmFtZSAtSW5wdXRUeXBlIE5UNCAtT3V0cHV0VHlwZSBDYW5vbmljYWwKICAgICAgICAgICAgICAgICAgICBpZigkQ2Fub25pY2FsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICREb21haW4gPSAkQ2Fub25pY2FsLnNwbGl0KCIvIilbMF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkVycm9yIHJlc29sdmluZyBTSUQgJyRTSUQnIgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJE51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiRXJyb3IgcmVzb2x2aW5nIFNJRCAnJFNJRCcgOiAkXyIKICAgICAgICAgICAgICAgIHJldHVybiAkTnVsbAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkT2JqZWN0U2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwYXRoICRBRFNwYXRoIC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgaWYoJE9iamVjdFNlYXJjaGVyKSB7CiAgICAgICAgICAgIGlmKCRTSUQpIHsKICAgICAgICAgICAgICAgICRPYmplY3RTZWFyY2hlci5maWx0ZXIgPSAiKCYob2JqZWN0c2lkPSRTSUQpJEZpbHRlcikiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCROYW1lKSB7CiAgICAgICAgICAgICAgICAkT2JqZWN0U2VhcmNoZXIuZmlsdGVyID0gIigmKG5hbWU9JE5hbWUpJEZpbHRlcikiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRTYW1BY2NvdW50TmFtZSkgewogICAgICAgICAgICAgICAgJE9iamVjdFNlYXJjaGVyLmZpbHRlciA9ICIoJihzYW1BY2NvdW50TmFtZT0kU2FtQWNjb3VudE5hbWUpJEZpbHRlcikiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRSZXN1bHRzID0gJE9iamVjdFNlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgaWYoJFJldHVyblJhdykgewogICAgICAgICAgICAgICAgICAgICRfCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQvcHJvY2VzcyB0aGUgTERBUCBmaWVsZHMgZm9yIGVhY2ggcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgQ29udmVydC1MREFQUHJvcGVydHkgLVByb3BlcnRpZXMgJF8uUHJvcGVydGllcwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICAgICAkT2JqZWN0U2VhcmNoZXIuZGlzcG9zZSgpCiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gU2V0LUFET2JqZWN0IHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUYWtlcyBhIFNJRCwgbmFtZSwgb3IgU2FtQWNjb3VudE5hbWUgdG8gcXVlcnkgZm9yIGEgc3BlY2lmaWVkCiAgICAgICAgZG9tYWluIG9iamVjdCwgYW5kIHRoZW4gc2V0cyBhIHNwZWNpZmllZCAnUHJvcGVydHlOYW1lJyB0byBhCiAgICAgICAgc3BlY2lmaWVkICdQcm9wZXJ0eVZhbHVlJy4KCiAgICAuUEFSQU1FVEVSIFNJRAoKICAgICAgICBUaGUgU0lEIG9mIHRoZSBkb21haW4gb2JqZWN0IHlvdSdyZSBxdWVyeWluZyBmb3IuCgogICAgLlBBUkFNRVRFUiBOYW1lCgogICAgICAgIFRoZSBOYW1lIG9mIHRoZSBkb21haW4gb2JqZWN0IHlvdSdyZSBxdWVyeWluZyBmb3IuCgogICAgLlBBUkFNRVRFUiBTYW1BY2NvdW50TmFtZQoKICAgICAgICBUaGUgU2FtQWNjb3VudE5hbWUgb2YgdGhlIGRvbWFpbiBvYmplY3QgeW91J3JlIHF1ZXJ5aW5nIGZvci4gCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3Igb2JqZWN0cywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgRmlsdGVyCgogICAgICAgIEFkZGl0aW9uYWwgTERBUCBmaWx0ZXIgc3RyaW5nIGZvciB0aGUgcXVlcnkuCgogICAgLlBBUkFNRVRFUiBQcm9wZXJ0eU5hbWUKCiAgICAgICAgVGhlIHByb3BlcnR5IG5hbWUgdG8gc2V0LgoKICAgIC5QQVJBTUVURVIgUHJvcGVydHlWYWx1ZQoKICAgICAgICBUaGUgdmFsdWUgdG8gc2V0IGZvciBQcm9wZXJ0eU5hbWUKCiAgICAuUEFSQU1FVEVSIFByb3BlcnR5WG9yVmFsdWUKCiAgICAgICAgSW50ZWdlciB2YWx1ZSB0byBiaW5hcnkgeG9yICgtYnhvcikgd2l0aCB0aGUgY3VycmVudCBpbnQgdmFsdWUuCgogICAgLlBBUkFNRVRFUiBDbGVhclZhbHVlCgogICAgICAgIFN3aXRjaC4gQ2xlYXIgdGhlIHZhbHVlIG9mIFByb3BlcnR5TmFtZQoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBTZXQtQURPYmplY3QgLVNhbUFjY291bnROYW1lIG1hdHQuYWRtaW4gLVByb3BlcnR5TmFtZSBjb3VudHJ5Y29kZSAtUHJvcGVydHlWYWx1ZSAwCiAgICAgICAgCiAgICAgICAgU2V0IHRoZSBjb3VudHJ5Y29kZSBmb3IgbWF0dC5hZG1pbiB0byAwCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBTZXQtQURPYmplY3QgLVNhbUFjY291bnROYW1lIG1hdHQuYWRtaW4gLVByb3BlcnR5TmFtZSB1c2VyYWNjb3VudGNvbnRyb2wgLVByb3BlcnR5WG9yVmFsdWUgNjU1MzYKICAgICAgICAKICAgICAgICBTZXQgdGhlIHBhc3N3b3JkIG5vdCB0byBleHBpcmUgb24gbWF0dC5hZG1pbgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU0lELAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICROYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRTYW1BY2NvdW50TmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRGaWx0ZXIsCgogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFByb3BlcnR5TmFtZSwKCiAgICAgICAgJFByb3BlcnR5VmFsdWUsCgogICAgICAgIFtJbnRdCiAgICAgICAgJFByb3BlcnR5WG9yVmFsdWUsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJENsZWFyVmFsdWUsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICAkQXJndW1lbnRzID0gQHsKICAgICAgICAnU0lEJyA9ICRTSUQKICAgICAgICAnTmFtZScgPSAkTmFtZQogICAgICAgICdTYW1BY2NvdW50TmFtZScgPSAkU2FtQWNjb3VudE5hbWUKICAgICAgICAnRG9tYWluJyA9ICREb21haW4KICAgICAgICAnRG9tYWluQ29udHJvbGxlcicgPSAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICdGaWx0ZXInID0gJEZpbHRlcgogICAgICAgICdQYWdlU2l6ZScgPSAkUGFnZVNpemUKICAgICAgICAnQ3JlZGVudGlhbCcgPSAkQ3JlZGVudGlhbAogICAgfQogICAgIyBzcGxhdCB0aGUgYXBwcm9wcmlhdGUgYXJndW1lbnRzIHRvIEdldC1BRE9iamVjdAogICAgJFJhd09iamVjdCA9IEdldC1BRE9iamVjdCAtUmV0dXJuUmF3IEBBcmd1bWVudHMKICAgIAogICAgdHJ5IHsKICAgICAgICAjIGdldCB0aGUgbW9kaWZpYWJsZSBvYmplY3QgZm9yIHRoaXMgc2VhcmNoIHJlc3VsdAogICAgICAgICRFbnRyeSA9ICRSYXdPYmplY3QuR2V0RGlyZWN0b3J5RW50cnkoKQogICAgICAgIAogICAgICAgIGlmKCRDbGVhclZhbHVlKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkNsZWFyaW5nIHZhbHVlIgogICAgICAgICAgICAkRW50cnkuJFByb3BlcnR5TmFtZS5jbGVhcigpCiAgICAgICAgICAgICRFbnRyeS5jb21taXRjaGFuZ2VzKCkKICAgICAgICB9CgogICAgICAgIGVsc2VpZigkUHJvcGVydHlYb3JWYWx1ZSkgewogICAgICAgICAgICAkVHlwZU5hbWUgPSAkRW50cnkuJFByb3BlcnR5TmFtZVswXS5HZXRUeXBlKCkubmFtZQoKICAgICAgICAgICAgIyBVQUMgdmFsdWUgcmVmZXJlbmNlcy0gaHR0cHM6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20vZW4tdXMva2IvMzA1MTQ0CiAgICAgICAgICAgICRQcm9wZXJ0eVZhbHVlID0gJCgkRW50cnkuJFByb3BlcnR5TmFtZSkgLWJ4b3IgJFByb3BlcnR5WG9yVmFsdWUgCiAgICAgICAgICAgICRFbnRyeS4kUHJvcGVydHlOYW1lID0gJFByb3BlcnR5VmFsdWUgLWFzICRUeXBlTmFtZSAgICAgICAKICAgICAgICAgICAgJEVudHJ5LmNvbW1pdGNoYW5nZXMoKSAgICAgCiAgICAgICAgfQoKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJEVudHJ5LnB1dCgkUHJvcGVydHlOYW1lLCAkUHJvcGVydHlWYWx1ZSkKICAgICAgICAgICAgJEVudHJ5LnNldGluZm8oKQogICAgICAgIH0KICAgIH0KICAgIGNhdGNoIHsKICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBzZXR0aW5nIHByb3BlcnR5ICRQcm9wZXJ0eU5hbWUgdG8gdmFsdWUgJyRQcm9wZXJ0eVZhbHVlJyBmb3Igb2JqZWN0ICQoJFJhd09iamVjdC5Qcm9wZXJ0aWVzLnNhbWFjY291bnRuYW1lKSA6ICRfIgogICAgfQp9CgoKZnVuY3Rpb24gSW52b2tlLURvd25ncmFkZUFjY291bnQgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFNldCByZXZlcnNpYmxlIGVuY3J5cHRpb24gb24gYSBnaXZlbiBhY2NvdW50IGFuZCB0aGVuIGZvcmNlIHRoZSBwYXNzd29yZAogICAgICAgIHRvIGJlIHNldCBvbiBuZXh0IHVzZXIgbG9naW4uIFRvIHJlcGFpciB1c2UgIi1SZXBhaXIiLgoKICAgIC5QQVJBTUVURVIgU2FtQWNjb3VudE5hbWUKCiAgICAgICAgVGhlIFNhbUFjY291bnROYW1lIG9mIHRoZSBkb21haW4gb2JqZWN0IHlvdSdyZSBxdWVyeWluZyBmb3IuIAoKICAgIC5QQVJBTUVURVIgTmFtZQoKICAgICAgICBUaGUgTmFtZSBvZiB0aGUgZG9tYWluIG9iamVjdCB5b3UncmUgcXVlcnlpbmcgZm9yLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIG9iamVjdHMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEZpbHRlcgoKICAgICAgICBBZGRpdGlvbmFsIExEQVAgZmlsdGVyIHN0cmluZyBmb3IgdGhlIHF1ZXJ5LgoKICAgIC5QQVJBTUVURVIgUmVwYWlyCgogICAgICAgIFN3aXRjaC4gVW5zZXQgdGhlIHJldmVyc2libGUgZW5jcnlwdGlvbiBmbGFnIGFuZCBmb3JjZSBwYXNzd29yZCByZXNldCBmbGFnLgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFM+IEludm9rZS1Eb3duZ3JhZGVBY2NvdW50IC1TYW1BY2NvdW50TmFtZSBqYXNvbgoKICAgICAgICBTZXQgcmV2ZXJzaWJsZSBlbmNyeXB0aW9uIG9uIHRoZSAnamFzb24nIGFjY291bnQgYW5kIGZvcmNlIHRoZSBwYXNzd29yZCB0byBiZSBjaGFuZ2VkLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTPiBJbnZva2UtRG93bmdyYWRlQWNjb3VudCAtU2FtQWNjb3VudE5hbWUgamFzb24gLVJlcGFpcgoKICAgICAgICBVbnNldCByZXZlcnNpYmxlIGVuY3J5cHRpb24gb24gdGhlICdqYXNvbicgYWNjb3VudCBhbmQgcmVtb3ZlIHRoZSBmb3JjZWQgcGFzc3dvcmQgY2hhbmdlLgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ1NhbUFjY291bnROYW1lJywgUG9zaXRpb249MCwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNhbUFjY291bnROYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnTmFtZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRmlsdGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRSZXBhaXIsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgcHJvY2VzcyB7CiAgICAgICAgJEFyZ3VtZW50cyA9IEB7CiAgICAgICAgICAgICdTYW1BY2NvdW50TmFtZScgPSAkU2FtQWNjb3VudE5hbWUKICAgICAgICAgICAgJ05hbWUnID0gJE5hbWUKICAgICAgICAgICAgJ0RvbWFpbicgPSAkRG9tYWluCiAgICAgICAgICAgICdEb21haW5Db250cm9sbGVyJyA9ICREb21haW5Db250cm9sbGVyCiAgICAgICAgICAgICdGaWx0ZXInID0gJEZpbHRlcgogICAgICAgICAgICAnQ3JlZGVudGlhbCcgPSAkQ3JlZGVudGlhbAogICAgICAgIH0KCiAgICAgICAgIyBzcGxhdCB0aGUgYXBwcm9wcmlhdGUgYXJndW1lbnRzIHRvIEdldC1BRE9iamVjdAogICAgICAgICRVQUNWYWx1ZXMgPSBHZXQtQURPYmplY3QgQEFyZ3VtZW50cyB8IHNlbGVjdCB1c2VyYWNjb3VudGNvbnRyb2wgfCBDb252ZXJ0RnJvbS1VQUNWYWx1ZQoKICAgICAgICBpZigkUmVwYWlyKSB7CgogICAgICAgICAgICBpZigkVUFDVmFsdWVzLktleXMgLWNvbnRhaW5zICJFTkNSWVBURURfVEVYVF9QV0RfQUxMT1dFRCIpIHsKICAgICAgICAgICAgICAgICMgaWYgcmV2ZXJzaWJsZSBlbmNyeXB0aW9uIGlzIHNldCwgdW5zZXQgaXQKICAgICAgICAgICAgICAgIFNldC1BRE9iamVjdCBAQXJndW1lbnRzIC1Qcm9wZXJ0eU5hbWUgdXNlcmFjY291bnRjb250cm9sIC1Qcm9wZXJ0eVhvclZhbHVlIDEyOAogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHVuc2V0IHRoZSBmb3JjZWQgcGFzc3dvcmQgY2hhbmdlCiAgICAgICAgICAgIFNldC1BRE9iamVjdCBAQXJndW1lbnRzIC1Qcm9wZXJ0eU5hbWUgcHdkbGFzdHNldCAtUHJvcGVydHlWYWx1ZSAtMQogICAgICAgIH0KCiAgICAgICAgZWxzZSB7CgogICAgICAgICAgICBpZigkVUFDVmFsdWVzLktleXMgLWNvbnRhaW5zICJET05UX0VYUElSRV9QQVNTV09SRCIpIHsKICAgICAgICAgICAgICAgICMgaWYgdGhlIHBhc3N3b3JkIGlzIHNldCB0byBuZXZlciBleHBpcmUsIHVuc2V0CiAgICAgICAgICAgICAgICBTZXQtQURPYmplY3QgQEFyZ3VtZW50cyAtUHJvcGVydHlOYW1lIHVzZXJhY2NvdW50Y29udHJvbCAtUHJvcGVydHlYb3JWYWx1ZSA2NTUzNgogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkVUFDVmFsdWVzLktleXMgLW5vdGNvbnRhaW5zICJFTkNSWVBURURfVEVYVF9QV0RfQUxMT1dFRCIpIHsKICAgICAgICAgICAgICAgICMgaWYgcmV2ZXJzaWJsZSBlbmNyeXB0aW9uIGlzIG5vdCBzZXQsIHNldCBpdAogICAgICAgICAgICAgICAgU2V0LUFET2JqZWN0IEBBcmd1bWVudHMgLVByb3BlcnR5TmFtZSB1c2VyYWNjb3VudGNvbnRyb2wgLVByb3BlcnR5WG9yVmFsdWUgMTI4CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgZm9yY2UgdGhlIHBhc3N3b3JkIHRvIGJlIGNoYW5nZWQgb24gbmV4dCBsb2dpbgogICAgICAgICAgICBTZXQtQURPYmplY3QgQEFyZ3VtZW50cyAtUHJvcGVydHlOYW1lIHB3ZGxhc3RzZXQgLVByb3BlcnR5VmFsdWUgMAogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1Db21wdXRlclByb3BlcnR5IHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXR1cm5zIGEgbGlzdCBvZiBhbGwgY29tcHV0ZXIgb2JqZWN0IHByb3BlcnRpZXMuIElmIGEgcHJvcGVydHkKICAgICAgICBuYW1lIGlzIHNwZWNpZmllZCwgaXQgcmV0dXJucyBhbGwgW2NvbXB1dGVyOnByb3BlcnR5XSB2YWx1ZXMuCgogICAgICAgIFRha2VuIGRpcmVjdGx5IGZyb20gQG9ic2N1cmVzZWMncyBwb3N0OgogICAgICAgICAgICBodHRwOi8vb2JzY3VyZXNlY3VyaXR5LmJsb2dzcG90LmNvbS8yMDE0LzA0L0FEU0lTZWFyY2hlci5odG1sCgogICAgLlBBUkFNRVRFUiBQcm9wZXJ0aWVzCgogICAgICAgIFJldHVybiBwcm9wZXJ0eSBuYW1lcyBmb3IgY29tcHV0ZXJzLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIGNvbXB1dGVyIHByb3BlcnRpZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUNvbXB1dGVyUHJvcGVydHkgLURvbWFpbiB0ZXN0aW5nCiAgICAgICAgCiAgICAgICAgUmV0dXJucyBhbGwgdXNlciBwcm9wZXJ0aWVzIGZvciBjb21wdXRlcnMgaW4gdGhlICd0ZXN0aW5nJyBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtQ29tcHV0ZXJQcm9wZXJ0eSAtUHJvcGVydGllcyBzc24sbGFzdGxvZ29uLGxvY2F0aW9uCiAgICAgICAgCiAgICAgICAgUmV0dXJucyBhbGwgYW4gYXJyYXkgb2YgY29tcHV0ZXIvc3NuL2xhc3Rsb2dpbi9sb2NhdGlvbiBjb21iaW5hdGlvbnMKICAgICAgICBmb3IgY29tcHV0ZXJzIGluIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vb2JzY3VyZXNlY3VyaXR5LmJsb2dzcG90LmNvbS8yMDE0LzA0L0FEU0lTZWFyY2hlci5odG1sCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkUHJvcGVydGllcywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgaWYoJFByb3BlcnRpZXMpIHsKICAgICAgICAjIGV4dHJhY3Qgb3V0IHRoZSBzZXQgb2YgYWxsIHByb3BlcnRpZXMgZm9yIGVhY2ggb2JqZWN0CiAgICAgICAgJFByb3BlcnRpZXMgPSAsIm5hbWUiICsgJFByb3BlcnRpZXMgfCBTb3J0LU9iamVjdCAtVW5pcXVlCiAgICAgICAgR2V0LU5ldENvbXB1dGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRnVsbERhdGEgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IFNlbGVjdC1PYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzCiAgICB9CiAgICBlbHNlIHsKICAgICAgICAjIGV4dHJhY3Qgb3V0IGp1c3QgdGhlIHByb3BlcnR5IG5hbWVzCiAgICAgICAgR2V0LU5ldENvbXB1dGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRnVsbERhdGEgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IFNlbGVjdC1PYmplY3QgLWZpcnN0IDEgfCBHZXQtTWVtYmVyIC1NZW1iZXJUeXBlICpQcm9wZXJ0eSB8IFNlbGVjdC1PYmplY3QgLVByb3BlcnR5ICJOYW1lIgogICAgfQp9CgoKZnVuY3Rpb24gRmluZC1Db21wdXRlckZpZWxkIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBTZWFyY2hlcyBjb21wdXRlciBvYmplY3QgZmllbGRzIGZvciBhIGdpdmVuIHdvcmQgKGRlZmF1bHQgKnBhc3MqKS4gRGVmYXVsdAogICAgICAgIGZpZWxkIGJlaW5nIHNlYXJjaGVkIGlzICdkZXNjcmlwdGlvbicuCgogICAgICAgIFRha2VuIGRpcmVjdGx5IGZyb20gQG9ic2N1cmVzZWMncyBwb3N0OgogICAgICAgICAgICBodHRwOi8vb2JzY3VyZXNlY3VyaXR5LmJsb2dzcG90LmNvbS8yMDE0LzA0L0FEU0lTZWFyY2hlci5odG1sCgogICAgLlBBUkFNRVRFUiBTZWFyY2hUZXJtCgogICAgICAgIFRlcm0gdG8gc2VhcmNoIGZvciwgZGVmYXVsdCBvZiAicGFzcyIuCgogICAgLlBBUkFNRVRFUiBTZWFyY2hGaWVsZAoKICAgICAgICBVc2VyIGZpZWxkIHRvIHNlYXJjaCBpbiwgZGVmYXVsdCBvZiAiZGVzY3JpcHRpb24iLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIHRvIHNlYXJjaCBjb21wdXRlciBmaWVsZHMgZm9yLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtQ29tcHV0ZXJGaWVsZCAtU2VhcmNoVGVybSBiYWNrdXAgLVNlYXJjaEZpZWxkIGluZm8KCiAgICAgICAgRmluZCBjb21wdXRlciBhY2NvdW50cyB3aXRoICJiYWNrdXAiIGluIHRoZSAiaW5mbyIgZmllbGQuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdUZXJtJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2VhcmNoVGVybSA9ICdwYXNzJywKCiAgICAgICAgW0FsaWFzKCdGaWVsZCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNlYXJjaEZpZWxkID0gJ2Rlc2NyaXB0aW9uJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgcHJvY2VzcyB7CiAgICAgICAgR2V0LU5ldENvbXB1dGVyIC1BRFNwYXRoICRBRFNwYXRoIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRnVsbERhdGEgLUZpbHRlciAiKCRTZWFyY2hGaWVsZD0qJFNlYXJjaFRlcm0qKSIgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IFNlbGVjdC1PYmplY3Qgc2FtYWNjb3VudG5hbWUsJFNlYXJjaEZpZWxkCiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtTmV0T1Ugewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEdldHMgYSBsaXN0IG9mIGFsbCBjdXJyZW50IE9VcyBpbiBhIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIE9VTmFtZQoKICAgICAgICBUaGUgT1UgbmFtZSB0byBxdWVyeSBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIEdVSUQKCiAgICAgICAgT25seSByZXR1cm4gT1VzIHdpdGggdGhlIHNwZWNpZmllZCBHVUlEIGluIHRoZWlyIGdwbGluayBwcm9wZXJ0eS4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciBPVXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgRnVsbERhdGEKCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gZnVsbCBPVSBvYmplY3RzIGluc3RlYWQgb2YganVzdCBvYmplY3QgbmFtZXMgKHRoZSBkZWZhdWx0KS4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldE9VCiAgICAgICAgCiAgICAgICAgUmV0dXJucyB0aGUgY3VycmVudCBPVXMgaW4gdGhlIGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRPVSAtT1VOYW1lICphZG1pbiogLURvbWFpbiB0ZXN0bGFiLmxvY2FsCiAgICAgICAgCiAgICAgICAgUmV0dXJucyBhbGwgT1VzIHdpdGggImFkbWluIiBpbiB0aGVpciBuYW1lIGluIHRoZSB0ZXN0bGFiLmxvY2FsIGRvbWFpbi4KCiAgICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0T1UgLUdVSUQgMTIzLS4uLgogICAgICAgIAogICAgICAgIFJldHVybnMgYWxsIE9VcyB3aXRoIGxpbmtlZCB0byB0aGUgc3BlY2lmaWVkIGdyb3VwIHBvbGljeSBvYmplY3QuCgogICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gIiphZG1pbioiLCIqc2VydmVyKiIgfCBHZXQtTmV0T1UKCiAgICAgICAgR2V0IHRoZSBmdWxsIE9VIG5hbWVzIGZvciB0aGUgZ2l2ZW4gc2VhcmNoIHRlcm1zIHBpcGVkIG9uIHRoZSBwaXBlbGluZS4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE9VTmFtZSA9ICcqJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR1VJRCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRGdWxsRGF0YSwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIGJlZ2luIHsKICAgICAgICAkT1VTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJEFEU3BhdGggLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgfQogICAgcHJvY2VzcyB7CiAgICAgICAgaWYgKCRPVVNlYXJjaGVyKSB7CiAgICAgICAgICAgIGlmICgkR1VJRCkgewogICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSBmaWx0ZXJpbmcgZm9yIGEgR1VJRCBpbiAuZ3BsaW5rCiAgICAgICAgICAgICAgICAkT1VTZWFyY2hlci5maWx0ZXI9IigmKG9iamVjdENhdGVnb3J5PW9yZ2FuaXphdGlvbmFsVW5pdCkobmFtZT0kT1VOYW1lKShncGxpbms9KiRHVUlEKikpIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJE9VU2VhcmNoZXIuZmlsdGVyPSIoJihvYmplY3RDYXRlZ29yeT1vcmdhbml6YXRpb25hbFVuaXQpKG5hbWU9JE9VTmFtZSkpIgogICAgICAgICAgICB9CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJFJlc3VsdHMgPSAkT1VTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRGdWxsRGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQvcHJvY2VzcyB0aGUgTERBUCBmaWVsZHMgZm9yIGVhY2ggcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICRPVSA9IENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAgICAgJE9VLlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5PVScpCiAgICAgICAgICAgICAgICAgICAgICAgICRPVQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsgCiAgICAgICAgICAgICAgICAgICAgICAgICMgb3RoZXJ3aXNlIGp1c3QgcmV0dXJuaW5nIHRoZSBBRFMgcGF0aHMgb2YgdGhlIE9VcwogICAgICAgICAgICAgICAgICAgICAgICAkXy5wcm9wZXJ0aWVzLmFkc3BhdGgKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICRPVVNlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgJF8KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1OZXRTaXRlIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBHZXRzIGEgbGlzdCBvZiBhbGwgY3VycmVudCBzaXRlcyBpbiBhIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIFNpdGVOYW1lCgogICAgICAgIFNpdGUgZmlsdGVyIHN0cmluZywgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHNpdGVzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEdVSUQKCiAgICAgICAgT25seSByZXR1cm4gc2l0ZSB3aXRoIHRoZSBzcGVjaWZpZWQgR1VJRCBpbiB0aGVpciBncGxpbmsgcHJvcGVydHkuCgogICAgLlBBUkFNRVRFUiBGdWxsRGF0YQoKICAgICAgICBTd2l0Y2guIFJldHVybiBmdWxsIHNpdGUgb2JqZWN0cyBpbnN0ZWFkIG9mIGp1c3Qgb2JqZWN0IG5hbWVzICh0aGUgZGVmYXVsdCkuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRTaXRlIC1Eb21haW4gdGVzdGxhYi5sb2NhbCAtRnVsbERhdGEKICAgICAgICAKICAgICAgICBSZXR1cm5zIHRoZSBmdWxsIGRhdGEgb2JqZWN0cyBmb3IgYWxsIHNpdGVzIGluIHRlc3RsYWIubG9jYWwKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNpdGVOYW1lID0gIioiLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdVSUQsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEZ1bGxEYXRhLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgYmVnaW4gewogICAgICAgICRTaXRlU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLUFEU3BhdGggJEFEU3BhdGggLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwcmVmaXggIkNOPVNpdGVzLENOPUNvbmZpZ3VyYXRpb24iIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgIH0KICAgIHByb2Nlc3MgewogICAgICAgIGlmKCRTaXRlU2VhcmNoZXIpIHsKCiAgICAgICAgICAgIGlmICgkR1VJRCkgewogICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSBmaWx0ZXJpbmcgZm9yIGEgR1VJRCBpbiAuZ3BsaW5rCiAgICAgICAgICAgICAgICAkU2l0ZVNlYXJjaGVyLmZpbHRlcj0iKCYob2JqZWN0Q2F0ZWdvcnk9c2l0ZSkobmFtZT0kU2l0ZU5hbWUpKGdwbGluaz0qJEdVSUQqKSkiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkU2l0ZVNlYXJjaGVyLmZpbHRlcj0iKCYob2JqZWN0Q2F0ZWdvcnk9c2l0ZSkobmFtZT0kU2l0ZU5hbWUpKSIKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJFNpdGVTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRGdWxsRGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQvcHJvY2VzcyB0aGUgTERBUCBmaWVsZHMgZm9yIGVhY2ggcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICRTaXRlID0gQ29udmVydC1MREFQUHJvcGVydHkgLVByb3BlcnRpZXMgJF8uUHJvcGVydGllcwogICAgICAgICAgICAgICAgICAgICAgICAkU2l0ZS5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuU2l0ZScpCiAgICAgICAgICAgICAgICAgICAgICAgICRTaXRlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSBqdXN0IHJldHVybiB0aGUgc2l0ZSBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRfLnByb3BlcnRpZXMubmFtZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICAgICAgICAgJFNpdGVTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICRfCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtTmV0U3VibmV0IHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBHZXRzIGEgbGlzdCBvZiBhbGwgY3VycmVudCBzdWJuZXRzIGluIGEgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgU2l0ZU5hbWUKCiAgICAgICAgT25seSByZXR1cm4gc3VibmV0cyBmcm9tIHRoZSBzcGVjaWZpZWQgU2l0ZU5hbWUuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3Igc3VibmV0cywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBGdWxsRGF0YQoKICAgICAgICBTd2l0Y2guIFJldHVybiBmdWxsIHN1Ym5ldCBvYmplY3RzIGluc3RlYWQgb2YganVzdCBvYmplY3QgbmFtZXMgKHRoZSBkZWZhdWx0KS4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldFN1Ym5ldAogICAgICAgIAogICAgICAgIFJldHVybnMgYWxsIHN1Ym5ldCBuYW1lcyBpbiB0aGUgY3VycmVudCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0U3VibmV0IC1Eb21haW4gdGVzdGxhYi5sb2NhbCAtRnVsbERhdGEKICAgICAgICAKICAgICAgICBSZXR1cm5zIHRoZSBmdWxsIGRhdGEgb2JqZWN0cyBmb3IgYWxsIHN1Ym5ldHMgaW4gdGVzdGxhYi5sb2NhbAojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2l0ZU5hbWUgPSAiKiIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRnVsbERhdGEsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgJFN1Ym5ldFNlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcGF0aCAkQURTcGF0aCAtQURTcHJlZml4ICJDTj1TdWJuZXRzLENOPVNpdGVzLENOPUNvbmZpZ3VyYXRpb24iIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgIH0KCiAgICBwcm9jZXNzIHsKICAgICAgICBpZigkU3VibmV0U2VhcmNoZXIpIHsKCiAgICAgICAgICAgICRTdWJuZXRTZWFyY2hlci5maWx0ZXI9IigmKG9iamVjdENhdGVnb3J5PXN1Ym5ldCkpIgoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJFN1Ym5ldFNlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICBpZiAoJEZ1bGxEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgY29udmVydC9wcm9jZXNzIHRoZSBMREFQIGZpZWxkcyBmb3IgZWFjaCByZXN1bHQKICAgICAgICAgICAgICAgICAgICAgICAgQ29udmVydC1MREFQUHJvcGVydHkgLVByb3BlcnRpZXMgJF8uUHJvcGVydGllcyB8IFdoZXJlLU9iamVjdCB7ICRfLnNpdGVvYmplY3QgLW1hdGNoICJDTj0kU2l0ZU5hbWUiIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgb3RoZXJ3aXNlIGp1c3QgcmV0dXJuIHRoZSBzdWJuZXQgbmFtZSBhbmQgc2l0ZSBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggKCRTaXRlTmFtZSAtYW5kICgkXy5wcm9wZXJ0aWVzLnNpdGVvYmplY3QgLW1hdGNoICJDTj0kU2l0ZU5hbWUsIikpIC1vciAoJFNpdGVOYW1lIC1lcSAnKicpKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFN1Ym5ldFByb3BlcnRpZXMgPSBAewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTdWJuZXQnID0gJF8ucHJvcGVydGllcy5uYW1lWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTdWJuZXRQcm9wZXJ0aWVzWydTaXRlJ10gPSAoJF8ucHJvcGVydGllcy5zaXRlb2JqZWN0WzBdKS5zcGxpdCgiLCIpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFN1Ym5ldFByb3BlcnRpZXNbJ1NpdGUnXSA9ICdFcnJvcicKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAtUHJvcGVydHkgJFN1Ym5ldFByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICAgICAgICAgJFN1Ym5ldFNlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgJF8KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1Eb21haW5TSUQgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEdldHMgdGhlIFNJRCBmb3IgdGhlIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5LCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLkVYQU1QTEUKCiAgICAgICAgQzpcPiBHZXQtRG9tYWluU0lEIC1Eb21haW4gVEVTVAogICAgICAgIAogICAgICAgIFJldHVybnMgU0lEIGZvciB0aGUgZG9tYWluICdURVNUJwojPgoKICAgIHBhcmFtKAogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlcgogICAgKQoKICAgICREQ1NJRCA9IEdldC1OZXRDb21wdXRlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUZ1bGxEYXRhIC1GaWx0ZXIgJyh1c2VyQWNjb3VudENvbnRyb2w6MS4yLjg0MC4xMTM1NTYuMS40LjgwMzo9ODE5MiknIHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgMSAtRXhwYW5kUHJvcGVydHkgb2JqZWN0c2lkCiAgICBpZigkRENTSUQpIHsKICAgICAgICAkRENTSUQuU3Vic3RyaW5nKDAsICREQ1NJRC5MYXN0SW5kZXhPZignLScpKQogICAgfQogICAgZWxzZSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgZXh0cmFjdGluZyBkb21haW4gU0lEIGZvciAkRG9tYWluIgogICAgfQp9CgoKZnVuY3Rpb24gR2V0LU5ldEdyb3VwIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBHZXRzIGEgbGlzdCBvZiBhbGwgY3VycmVudCBncm91cHMgaW4gYSBkb21haW4sIG9yIGFsbAogICAgICAgIHRoZSBncm91cHMgYSBnaXZlbiB1c2VyL2dyb3VwIG9iamVjdCBiZWxvbmdzIHRvLgoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIFRoZSBncm91cCBuYW1lIHRvIHF1ZXJ5IGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgU0lECgogICAgICAgIFRoZSBncm91cCBTSUQgdG8gcXVlcnkgZm9yLgoKICAgIC5QQVJBTUVURVIgVXNlck5hbWUKCiAgICAgICAgVGhlIHVzZXIgbmFtZSAob3IgZ3JvdXAgbmFtZSkgdG8gcXVlcnkgZm9yIGFsbCBlZmZlY3RpdmUKICAgICAgICBncm91cHMgb2YuCgogICAgLlBBUkFNRVRFUiBGaWx0ZXIKCiAgICAgICAgQSBjdXN0b21pemVkIGxkYXAgZmlsdGVyIHN0cmluZyB0byB1c2UsIGUuZy4gIihkZXNjcmlwdGlvbj0qYWRtaW4qKSIKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciBncm91cHMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgQWRtaW5Db3VudAoKICAgICAgICBTd2l0Y2guIFJldHVybiBncm91cCB3aXRoIGFkbWluQ291bnQ9MS4KCiAgICAuUEFSQU1FVEVSIEZ1bGxEYXRhCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIGZ1bGwgZ3JvdXAgb2JqZWN0cyBpbnN0ZWFkIG9mIGp1c3Qgb2JqZWN0IG5hbWVzICh0aGUgZGVmYXVsdCkuCgogICAgLlBBUkFNRVRFUiBSYXdTaWRzCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIHJhdyBTSURzIHdoZW4gdXNpbmcgIkdldC1OZXRHcm91cCAtVXNlck5hbWUgWCIKCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgQWxsVHlwZXMKCiAgICAgICAgQnkgZGVmYXVsdCB3ZSB3aWxsIHJldHJpZXZlIG9ubHkgU2VjdXJpdHksIG5vdCBEaXN0cmlidXRpb24gR3JvdXBzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldEdyb3VwCgogICAgICAgIFJldHVybnMgdGhlIGN1cnJlbnQgc2VjdXJpdHkgZ3JvdXBzIGluIHRoZSBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0R3JvdXAgLUdyb3VwTmFtZSAqYWRtaW4qCgogICAgICAgIFJldHVybnMgYWxsIGdyb3VwcyB3aXRoICJhZG1pbiIgaW4gdGhlaXIgZ3JvdXAgbmFtZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRHcm91cCAtRG9tYWluIHRlc3RpbmcgLUZ1bGxEYXRhCgogICAgICAgIFJldHVybnMgZnVsbCBncm91cCBkYXRhIG9iamVjdHMgaW4gdGhlICd0ZXN0aW5nJyBkb21haW4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lID0gJyonLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRTSUQsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQWRtaW5Db3VudCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRnVsbERhdGEsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJhd1NpZHMsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEFsbFR5cGVzLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0KICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgJEdyb3VwU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwYXRoICRBRFNwYXRoIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgICAgICBpZiAoISRBbGxUeXBlcykKICAgICAgICB7CiAgICAgICAgICAkRmlsdGVyICs9ICIoZ3JvdXBUeXBlOjEuMi44NDAuMTEzNTU2LjEuNC44MDM6PTIxNDc0ODM2NDgpIgogICAgICAgIH0KICAgIH0KCiAgICBwcm9jZXNzIHsKICAgICAgICBpZigkR3JvdXBTZWFyY2hlcikgewoKICAgICAgICAgICAgaWYoJEFkbWluQ291bnQpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkNoZWNraW5nIGZvciBhZG1pbkNvdW50PTEiCiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICIoYWRtaW5jb3VudD0xKSIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCRVc2VyTmFtZSkgewogICAgICAgICAgICAgICAgIyBnZXQgdGhlIHJhdyB1c2VyIG9iamVjdAogICAgICAgICAgICAgICAgJFVzZXIgPSBHZXQtQURPYmplY3QgLVNhbUFjY291bnROYW1lICRVc2VyTmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLVJldHVyblJhdyAtUGFnZVNpemUgJFBhZ2VTaXplIHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgMQoKICAgICAgICAgICAgICAgIGlmKCRVc2VyKSB7CiAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0IHRoZSB1c2VyIHRvIGEgZGlyZWN0b3J5IGVudHJ5CiAgICAgICAgICAgICAgICAgICAgJFVzZXJEaXJlY3RvcnlFbnRyeSA9ICRVc2VyLkdldERpcmVjdG9yeUVudHJ5KCkKCiAgICAgICAgICAgICAgICAgICAgIyBjYXVzZSB0aGUgY2FjaGUgdG8gY2FsY3VsYXRlIHRoZSB0b2tlbiBncm91cHMgZm9yIHRoZSB1c2VyCiAgICAgICAgICAgICAgICAgICAgJFVzZXJEaXJlY3RvcnlFbnRyeS5SZWZyZXNoQ2FjaGUoInRva2VuR3JvdXBzIikKCiAgICAgICAgICAgICAgICAgICAgJFVzZXJEaXJlY3RvcnlFbnRyeS5Ub2tlbkdyb3VwcyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0IHRoZSB0b2tlbiBncm91cCBzaWQKICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwU2lkID0gKE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXIoJF8sMCkpLlZhbHVlCgogICAgICAgICAgICAgICAgICAgICAgICAjIGlnbm9yZSB0aGUgYnVpbHQgaW4gZ3JvdXBzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRHcm91cFNpZCAtbm90bWF0Y2ggJ15TLTEtNS0zMi0uKicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRGdWxsRGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cCA9IEdldC1BRE9iamVjdCAtU0lEICRHcm91cFNpZCAtUGFnZVNpemUgJFBhZ2VTaXplIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cC5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuR3JvdXAnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJFJhd1NpZHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwU2lkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb252ZXJ0LVNpZFRvTmFtZSAtU0lEICRHcm91cFNpZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIlVzZXJOYW1lICckVXNlck5hbWUnIGZhaWxlZCB0byByZXNvbHZlLiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICgkU0lEKSB7CiAgICAgICAgICAgICAgICAgICAgJEdyb3VwU2VhcmNoZXIuZmlsdGVyID0gIigmKG9iamVjdENhdGVnb3J5PWdyb3VwKShvYmplY3RTSUQ9JFNJRCkkRmlsdGVyKSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRHcm91cFNlYXJjaGVyLmZpbHRlciA9ICIoJihvYmplY3RDYXRlZ29yeT1ncm91cCkoc2FtYWNjb3VudG5hbWU9JEdyb3VwTmFtZSkkRmlsdGVyKSIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkUmVzdWx0cyA9ICRHcm91cFNlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIHJldHVybmluZyBmdWxsIGRhdGEgb2JqZWN0cwogICAgICAgICAgICAgICAgICAgIGlmICgkRnVsbERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0L3Byb2Nlc3MgdGhlIExEQVAgZmllbGRzIGZvciBlYWNoIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAgPSBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cC5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuR3JvdXAnKQogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgb3RoZXJ3aXNlIHdlJ3JlIGp1c3QgcmV0dXJuaW5nIHRoZSBncm91cCBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRfLnByb3BlcnRpZXMuc2FtYWNjb3VudG5hbWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICRHcm91cFNlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LU5ldEdyb3VwTWVtYmVyIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHVzZXJzIFtBRFNJXSBhbmQgTERBUCB0byBxdWVyeSB0aGUgY3VycmVudCBBRCBjb250ZXh0CiAgICAgICAgb3IgdHJ1c3RlZCBkb21haW4gZm9yIHVzZXJzIGluIGEgc3BlY2lmaWVkIGdyb3VwLiBJZiBubyBHcm91cE5hbWUgaXMKICAgICAgICBzcGVjaWZpZWQsIGl0IGRlZmF1bHRzIHRvIHF1ZXJ5aW5nIHRoZSAiRG9tYWluIEFkbWlucyIgZ3JvdXAuCiAgICAgICAgVGhpcyBpcyBhIHJlcGxhY2VtZW50IGZvciAibmV0IGdyb3VwICduYW1lJyAvZG9tYWluIgoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIFRoZSBncm91cCBuYW1lIHRvIHF1ZXJ5IGZvciB1c2Vycy4KCiAgICAuUEFSQU1FVEVSIFNJRAoKICAgICAgICBUaGUgR3JvdXAgU0lEIHRvIHF1ZXJ5IGZvciB1c2Vycy4gSWYgbm90IGdpdmVuLCBpdCBkZWZhdWx0cyB0byA1MTIgIkRvbWFpbiBBZG1pbnMiCgogICAgLlBBUkFNRVRFUiBGaWx0ZXIKCiAgICAgICAgQSBjdXN0b21pemVkIGxkYXAgZmlsdGVyIHN0cmluZyB0byB1c2UsIGUuZy4gIihkZXNjcmlwdGlvbj0qYWRtaW4qKSIKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciBncm91cCB1c2VycywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBGdWxsRGF0YQoKICAgICAgICBTd2l0Y2guIFJldHVybnMgZnVsbCBkYXRhIG9iamVjdHMgaW5zdGVhZCBvZiBqdXN0IGdyb3VwL3VzZXJzLgoKICAgIC5QQVJBTUVURVIgUmVjdXJzZQoKICAgICAgICBTd2l0Y2guIElmIHRoZSBncm91cCBtZW1iZXIgaXMgYSBncm91cCwgcmVjdXJzaXZlbHkgdHJ5IHRvIHF1ZXJ5IGl0cyBtZW1iZXJzIGFzIHdlbGwuCgogICAgLlBBUkFNRVRFUiBVc2VNYXRjaGluZ1J1bGUKCiAgICAgICAgU3dpdGNoLiBVc2UgTERBUF9NQVRDSElOR19SVUxFX0lOX0NIQUlOIGluIHRoZSBMREFQIHNlYXJjaCBxdWVyeSB3aGVuIC1SZWN1cnNlIGlzIHNwZWNpZmllZC4KICAgICAgICBNdWNoIGZhc3RlciB0aGFuIG1hbnVhbCByZWN1cnNpb24sIGJ1dCBkb2Vzbid0IHJldmVhbCBjcm9zcy1kb21haW4gZ3JvdXBzLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0R3JvdXBNZW1iZXIKICAgICAgICAKICAgICAgICBSZXR1cm5zIHRoZSB1c2VybmFtZXMgdGhhdCBvZiBtZW1iZXJzIG9mIHRoZSAiRG9tYWluIEFkbWlucyIgZG9tYWluIGdyb3VwLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldEdyb3VwTWVtYmVyIC1Eb21haW4gdGVzdGluZyAtR3JvdXBOYW1lICJQb3dlciBVc2VycyIKICAgICAgICAKICAgICAgICBSZXR1cm5zIHRoZSB1c2VybmFtZXMgdGhhdCBvZiBtZW1iZXJzIG9mIHRoZSAiUG93ZXIgVXNlcnMiIGdyb3VwIGluIHRoZSAndGVzdGluZycgZG9tYWluLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly93d3cucG93ZXJzaGVsbG1hZ2F6aW5lLmNvbS8yMDEzLzA1LzIzL3BzdGlwLXJldHJpZXZlLWdyb3VwLW1lbWJlcnNoaXAtb2YtYW4tYWN0aXZlLWRpcmVjdG9yeS1ncm91cC1yZWN1cnNpdmVseS8KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRTSUQsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRnVsbERhdGEsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlY3Vyc2UsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVzZU1hdGNoaW5nUnVsZSwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIGJlZ2luIHsKICAgICAgICBpZigkRG9tYWluQ29udHJvbGxlcikgewogICAgICAgICAgICAkVGFyZ2V0RG9tYWluQ29udHJvbGxlciA9ICREb21haW5Db250cm9sbGVyCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkVGFyZ2V0RG9tYWluQ29udHJvbGxlciA9ICgoR2V0LU5ldERvbWFpbiAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCkuUGRjUm9sZU93bmVyKS5OYW1lCiAgICAgICAgfQoKICAgICAgICBpZigkRG9tYWluKSB7CiAgICAgICAgICAgICRUYXJnZXREb21haW4gPSAkRG9tYWluCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkVGFyZ2V0RG9tYWluID0gR2V0LU5ldERvbWFpbiAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IG5hbWUKICAgICAgICB9CgogICAgICAgICMgc28gdGhpcyBpc24ndCByZXBlYXRlZCBpZiB1c2VycyBhcmUgcGFzc2VkIG9uIHRoZSBwaXBlbGluZQogICAgICAgICRHcm91cFNlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJFRhcmdldERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkVGFyZ2V0RG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcGF0aCAkQURTcGF0aCAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICB9CgogICAgcHJvY2VzcyB7CiAgICAgICAgaWYgKCRHcm91cFNlYXJjaGVyKSB7CiAgICAgICAgICAgIGlmICgkUmVjdXJzZSAtYW5kICRVc2VNYXRjaGluZ1J1bGUpIHsKICAgICAgICAgICAgICAgICMgcmVzb2x2ZSB0aGUgZ3JvdXAgdG8gYSBkaXN0aW5ndWlzaGVkbmFtZQogICAgICAgICAgICAgICAgaWYgKCRHcm91cE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAkR3JvdXAgPSBHZXQtTmV0R3JvdXAgLUFsbFR5cGVzIC1Hcm91cE5hbWUgJEdyb3VwTmFtZSAtRG9tYWluICRUYXJnZXREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJFRhcmdldERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2VpZiAoJFNJRCkgewogICAgICAgICAgICAgICAgICAgICRHcm91cCA9IEdldC1OZXRHcm91cCAtQWxsVHlwZXMgLVNJRCAkU0lEIC1Eb21haW4gJFRhcmdldERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkVGFyZ2V0RG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRnVsbERhdGEgLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgIyBkZWZhdWx0IHRvIGRvbWFpbiBhZG1pbnMKICAgICAgICAgICAgICAgICAgICAkU0lEID0gKEdldC1Eb21haW5TSUQgLURvbWFpbiAkVGFyZ2V0RG9tYWluIC1Eb21haW5Db250cm9sbGVyICRUYXJnZXREb21haW5Db250cm9sbGVyKSArICItNTEyIgogICAgICAgICAgICAgICAgICAgICRHcm91cCA9IEdldC1OZXRHcm91cCAtQWxsVHlwZXMgLVNJRCAkU0lEIC1Eb21haW4gJFRhcmdldERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkVGFyZ2V0RG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRnVsbERhdGEgLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJEdyb3VwRE4gPSAkR3JvdXAuZGlzdGluZ3Vpc2hlZG5hbWUKICAgICAgICAgICAgICAgICRHcm91cEZvdW5kTmFtZSA9ICRHcm91cC5zYW1hY2NvdW50bmFtZQoKICAgICAgICAgICAgICAgIGlmICgkR3JvdXBETikgewogICAgICAgICAgICAgICAgICAgICRHcm91cFNlYXJjaGVyLmZpbHRlciA9ICIoJihzYW1BY2NvdW50VHlwZT04MDUzMDYzNjgpKG1lbWJlcm9mOjEuMi44NDAuMTEzNTU2LjEuNC4xOTQxOj0kR3JvdXBETikkRmlsdGVyKSIKICAgICAgICAgICAgICAgICAgICAkR3JvdXBTZWFyY2hlci5Qcm9wZXJ0aWVzVG9Mb2FkLkFkZFJhbmdlKCgnZGlzdGluZ3Vpc2hlZE5hbWUnLCdzYW1hY2NvdW50dHlwZScsJ2xhc3Rsb2dvbicsJ2xhc3Rsb2dvbnRpbWVzdGFtcCcsJ2RzY29yZXByb3BhZ2F0aW9uZGF0YScsJ29iamVjdHNpZCcsJ3doZW5jcmVhdGVkJywnYmFkcGFzc3dvcmR0aW1lJywnYWNjb3VudGV4cGlyZXMnLCdpc2NyaXRpY2Fsc3lzdGVtb2JqZWN0JywnbmFtZScsJ3VzbmNoYW5nZWQnLCdvYmplY3RjYXRlZ29yeScsJ2Rlc2NyaXB0aW9uJywnY29kZXBhZ2UnLCdpbnN0YW5jZXR5cGUnLCdjb3VudHJ5Y29kZScsJ2Rpc3Rpbmd1aXNoZWRuYW1lJywnY24nLCdhZG1pbmNvdW50JywnbG9nb25ob3VycycsJ29iamVjdGNsYXNzJywnbG9nb25jb3VudCcsJ3VzbmNyZWF0ZWQnLCd1c2VyYWNjb3VudGNvbnRyb2wnLCdvYmplY3RndWlkJywncHJpbWFyeWdyb3VwaWQnLCdsYXN0bG9nb2ZmJywnc2FtYWNjb3VudG5hbWUnLCdiYWRwd2Rjb3VudCcsJ3doZW5jaGFuZ2VkJywnbWVtYmVyb2YnLCdwd2RsYXN0c2V0JywnYWRzcGF0aCcpKQoKICAgICAgICAgICAgICAgICAgICAkTWVtYmVycyA9ICRHcm91cFNlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgICAgICRHcm91cEZvdW5kTmFtZSA9ICRHcm91cE5hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLUVycm9yICJVbmFibGUgdG8gZmluZCBHcm91cCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICgkR3JvdXBOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgJEdyb3VwU2VhcmNoZXIuZmlsdGVyID0gIigmKG9iamVjdENhdGVnb3J5PWdyb3VwKShzYW1hY2NvdW50bmFtZT0kR3JvdXBOYW1lKSRGaWx0ZXIpIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmICgkU0lEKSB7CiAgICAgICAgICAgICAgICAgICAgJEdyb3VwU2VhcmNoZXIuZmlsdGVyID0gIigmKG9iamVjdENhdGVnb3J5PWdyb3VwKShvYmplY3RTSUQ9JFNJRCkkRmlsdGVyKSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICMgZGVmYXVsdCB0byBkb21haW4gYWRtaW5zCiAgICAgICAgICAgICAgICAgICAgJFNJRCA9IChHZXQtRG9tYWluU0lEIC1Eb21haW4gJFRhcmdldERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkVGFyZ2V0RG9tYWluQ29udHJvbGxlcikgKyAiLTUxMiIKICAgICAgICAgICAgICAgICAgICAkR3JvdXBTZWFyY2hlci5maWx0ZXIgPSAiKCYob2JqZWN0Q2F0ZWdvcnk9Z3JvdXApKG9iamVjdFNJRD0kU0lEKSRGaWx0ZXIpIgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdCA9ICRHcm91cFNlYXJjaGVyLkZpbmRPbmUoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICRNZW1iZXJzID0gQCgpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJEdyb3VwRm91bmROYW1lID0gJycKCiAgICAgICAgICAgICAgICBpZiAoJFJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICRNZW1iZXJzID0gJFJlc3VsdC5wcm9wZXJ0aWVzLml0ZW0oIm1lbWJlciIpCgogICAgICAgICAgICAgICAgICAgIGlmKCRNZW1iZXJzLmNvdW50IC1lcSAwKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAkRmluaXNoZWQgPSAkRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgJEJvdHRvbSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgJFRvcCA9IDAKCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlKCEkRmluaXNoZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUb3AgPSAkQm90dG9tICsgMTQ5OQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlclJhbmdlPSJtZW1iZXI7cmFuZ2U9JEJvdHRvbS0kVG9wIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEJvdHRvbSArPSAxNTAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cFNlYXJjaGVyLlByb3BlcnRpZXNUb0xvYWQuQ2xlYXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgW3ZvaWRdJEdyb3VwU2VhcmNoZXIuUHJvcGVydGllc1RvTG9hZC5BZGQoIiRNZW1iZXJSYW5nZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbdm9pZF0kR3JvdXBTZWFyY2hlci5Qcm9wZXJ0aWVzVG9Mb2FkLkFkZCgic2FtYWNjb3VudG5hbWUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0ID0gJEdyb3VwU2VhcmNoZXIuRmluZE9uZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFJhbmdlZFByb3BlcnR5ID0gJFJlc3VsdC5Qcm9wZXJ0aWVzLlByb3BlcnR5TmFtZXMgLWxpa2UgIm1lbWJlcjtyYW5nZT0qIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJzICs9ICRSZXN1bHQuUHJvcGVydGllcy5pdGVtKCRSYW5nZWRQcm9wZXJ0eSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBGb3VuZE5hbWUgPSAkUmVzdWx0LnByb3BlcnRpZXMuaXRlbSgic2FtYWNjb3VudG5hbWUiKVswXQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJE1lbWJlcnMuY291bnQgLWVxIDApIHsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGaW5pc2hlZCA9ICRUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggW1N5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uTWV0aG9kSW52b2NhdGlvbkV4Y2VwdGlvbl0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGaW5pc2hlZCA9ICRUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cEZvdW5kTmFtZSA9ICRSZXN1bHQucHJvcGVydGllcy5pdGVtKCJzYW1hY2NvdW50bmFtZSIpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJzICs9ICRSZXN1bHQuUHJvcGVydGllcy5pdGVtKCRSYW5nZWRQcm9wZXJ0eSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkR3JvdXBTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE1lbWJlcnMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICMgaWYgd2UncmUgZG9pbmcgdGhlIExEQVBfTUFUQ0hJTkdfUlVMRV9JTl9DSEFJTiByZWN1cnNpb24KICAgICAgICAgICAgICAgIGlmICgkUmVjdXJzZSAtYW5kICRVc2VNYXRjaGluZ1J1bGUpIHsKICAgICAgICAgICAgICAgICAgICAkUHJvcGVydGllcyA9ICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZigkVGFyZ2V0RG9tYWluQ29udHJvbGxlcikgewogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0ID0gW2Fkc2ldIkxEQVA6Ly8kVGFyZ2V0RG9tYWluQ29udHJvbGxlci8kXyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRSZXN1bHQgPSBbYWRzaV0iTERBUDovLyRfIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZigkUmVzdWx0KXsKICAgICAgICAgICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgPSAkUmVzdWx0LlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoJFByb3BlcnRpZXMpIHsKCiAgICAgICAgICAgICAgICAgICAgJElzR3JvdXAgPSBAKCcyNjg0MzU0NTYnLCcyNjg0MzU0NTcnLCc1MzY4NzA5MTInLCc1MzY4NzA5MTMnKSAtY29udGFpbnMgJFByb3BlcnRpZXMuc2FtYWNjb3VudHR5cGUKCiAgICAgICAgICAgICAgICAgICAgaWYgKCRGdWxsRGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXIgPSBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkUHJvcGVydGllcwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVyID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dyb3VwRG9tYWluJyAkVGFyZ2V0RG9tYWluCiAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dyb3VwTmFtZScgJEdyb3VwRm91bmROYW1lCgogICAgICAgICAgICAgICAgICAgIGlmKCRQcm9wZXJ0aWVzLm9iamVjdFNpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyU0lEID0gKChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyICRQcm9wZXJ0aWVzLm9iamVjdFNpZFswXSwwKS5WYWx1ZSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJTSUQgPSAkTnVsbAogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlckROID0gJFByb3BlcnRpZXMuZGlzdGluZ3Vpc2hlZG5hbWVbMF0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJE1lbWJlckROIC1tYXRjaCAnRm9yZWlnblNlY3VyaXR5UHJpbmNpcGFscycpIC1hbmQgKCRNZW1iZXJETiAtbWF0Y2ggJ1MtMS01LTIxJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoLW5vdCAkTWVtYmVyU0lEKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJTSUQgPSAkUHJvcGVydGllcy5jblswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyU2ltcGxlTmFtZSA9IENvbnZlcnQtU2lkVG9OYW1lIC1TSUQgJE1lbWJlclNJRCB8IENvbnZlcnQtQUROYW1lIC1JbnB1dFR5cGUgJ05UNCcgLU91dHB1dFR5cGUgJ1NpbXBsZScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkTWVtYmVyU2ltcGxlTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRG9tYWluID0gJE1lbWJlclNpbXBsZU5hbWUuU3BsaXQoJ0AnKVsxXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiRXJyb3IgY29udmVydGluZyAkTWVtYmVyRE4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJEb21haW4gPSAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBjb252ZXJ0aW5nICRNZW1iZXJETiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRG9tYWluID0gJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgZXh0cmFjdCB0aGUgRlFETiBmcm9tIHRoZSBEaXN0aW5ndWlzaGVkIE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJEb21haW4gPSAkTWVtYmVyRE4uc3ViU3RyaW5nKCRNZW1iZXJETi5JbmRleE9mKCJEQz0iKSkgLXJlcGxhY2UgJ0RDPScsJycgLXJlcGxhY2UgJywnLCcuJwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlckROID0gJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlckRvbWFpbiA9ICROdWxsCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoJFByb3BlcnRpZXMuc2FtYWNjb3VudG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBmb3Jlc3QgdXNlcnMgaGF2ZSB0aGUgc2FtQWNjb3VudE5hbWUgc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJOYW1lID0gJFByb3BlcnRpZXMuc2FtYWNjb3VudG5hbWVbMF0KICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAjIGV4dGVybmFsIHRydXN0IHVzZXJzIGhhdmUgYSBTSUQsIHNvIGNvbnZlcnQgaXQKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJOYW1lID0gQ29udmVydC1TaWRUb05hbWUgJFByb3BlcnRpZXMuY25bMF0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHRoZXJlJ3MgYSBwcm9ibGVtIGNvbnRhY3RpbmcgdGhlIGRvbWFpbiB0byByZXNvbHZlIHRoZSBTSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJOYW1lID0gJFByb3BlcnRpZXMuY24KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlckRvbWFpbicgJE1lbWJlckRvbWFpbgogICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJOYW1lJyAkTWVtYmVyTmFtZQogICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJTSUQnICRNZW1iZXJTSUQKICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSXNHcm91cCcgJElzR3JvdXAKICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyRE4nICRNZW1iZXJETgogICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlci5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuR3JvdXBNZW1iZXInKQogICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlcgoKICAgICAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIGRvaW5nIG1hbnVhbCByZWN1cnNpb24KICAgICAgICAgICAgICAgICAgICBpZiAoJFJlY3Vyc2UgLWFuZCAhJFVzZU1hdGNoaW5nUnVsZSAtYW5kICRJc0dyb3VwIC1hbmQgJE1lbWJlck5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJEZ1bGxEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHZXQtTmV0R3JvdXBNZW1iZXIgLUZ1bGxEYXRhIC1Eb21haW4gJE1lbWJlckRvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkVGFyZ2V0RG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtR3JvdXBOYW1lICRNZW1iZXJOYW1lIC1SZWN1cnNlIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdldC1OZXRHcm91cE1lbWJlciAtRG9tYWluICRNZW1iZXJEb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJFRhcmdldERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUdyb3VwTmFtZSAkTWVtYmVyTmFtZSAtUmVjdXJzZSAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtTmV0RmlsZVNlcnZlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUmV0dXJucyBhIGxpc3Qgb2YgYWxsIGZpbGUgc2VydmVycyBleHRyYWN0ZWQgZnJvbSB1c2VyIAogICAgICAgIGhvbWVkaXJlY3RvcnksIHNjcmlwdHBhdGgsIGFuZCBwcm9maWxlcGF0aCBmaWVsZHMuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgdXNlciBmaWxlIHNlcnZlcnMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFRhcmdldFVzZXJzCgogICAgICAgIEFuIGFycmF5IG9mIHVzZXJzIHRvIHF1ZXJ5IGZvciBmaWxlIHNlcnZlcnMuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRGaWxlU2VydmVyCiAgICAgICAgCiAgICAgICAgUmV0dXJucyBhY3RpdmUgZmlsZSBzZXJ2ZXJzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldEZpbGVTZXJ2ZXIgLURvbWFpbiB0ZXN0aW5nCiAgICAgICAgCiAgICAgICAgUmV0dXJucyBhY3RpdmUgZmlsZSBzZXJ2ZXJzIGZvciB0aGUgJ3Rlc3RpbmcnIGRvbWFpbi4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJFRhcmdldFVzZXJzLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgZnVuY3Rpb24gU3BsaXRQYXRoIHsKICAgICAgICAjIHNob3J0IGludGVybmFsIGhlbHBlciB0byBzcGxpdCBVTkMgc2VydmVyIHBhdGhzCiAgICAgICAgcGFyYW0oW1N0cmluZ10kUGF0aCkKCiAgICAgICAgaWYgKCRQYXRoIC1hbmQgKCRQYXRoLnNwbGl0KCJcXCIpLkNvdW50IC1nZSAzKSkgewogICAgICAgICAgICAkVGVtcCA9ICRQYXRoLnNwbGl0KCJcXCIpWzJdCiAgICAgICAgICAgIGlmKCRUZW1wIC1hbmQgKCRUZW1wIC1uZSAnJykpIHsKICAgICAgICAgICAgICAgICRUZW1wCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAkZmlsdGVyID0gIighKHVzZXJBY2NvdW50Q29udHJvbDoxLjIuODQwLjExMzU1Ni4xLjQuODAzOj0yKSkofChzY3JpcHRwYXRoPSopKGhvbWVkaXJlY3Rvcnk9KikocHJvZmlsZXBhdGg9KikpIgogICAgR2V0LU5ldFVzZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1QYWdlU2l6ZSAkUGFnZVNpemUgLUZpbHRlciAkZmlsdGVyIHwgV2hlcmUtT2JqZWN0IHskX30gfCBXaGVyZS1PYmplY3QgewogICAgICAgICAgICAjIGZpbHRlciBmb3IgYW55IHRhcmdldCB1c2VycwogICAgICAgICAgICBpZigkVGFyZ2V0VXNlcnMpIHsKICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyAtTWF0Y2ggJF8uc2FtQWNjb3VudE5hbWUKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsgJFRydWUgfQogICAgICAgIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICMgc3BsaXQgb3V0IGV2ZXJ5IHBvdGVudGlhbCBmaWxlIHNlcnZlciBwYXRoCiAgICAgICAgICAgIGlmKCRfLmhvbWVkaXJlY3RvcnkpIHsKICAgICAgICAgICAgICAgIFNwbGl0UGF0aCgkXy5ob21lZGlyZWN0b3J5KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRfLnNjcmlwdHBhdGgpIHsKICAgICAgICAgICAgICAgIFNwbGl0UGF0aCgkXy5zY3JpcHRwYXRoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRfLnByb2ZpbGVwYXRoKSB7CiAgICAgICAgICAgICAgICBTcGxpdFBhdGgoJF8ucHJvZmlsZXBhdGgpCiAgICAgICAgICAgIH0KCiAgICAgICAgfSB8IFdoZXJlLU9iamVjdCB7JF99IHwgU29ydC1PYmplY3QgLVVuaXF1ZQp9CgoKZnVuY3Rpb24gR2V0LURGU3NoYXJlIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXR1cm5zIGEgbGlzdCBvZiBhbGwgZmF1bHQtdG9sZXJhbnQgZGlzdHJpYnV0ZWQgZmlsZQogICAgICAgIHN5c3RlbXMgZm9yIGEgZ2l2ZW4gZG9tYWluLgoKICAgIC5QQVJBTUVURVIgVmVyc2lvbgoKICAgICAgICBUaGUgdmVyc2lvbiBvZiBERlMgdG8gcXVlcnkgZm9yIHNlcnZlcnMuCiAgICAgICAgMS92MSwgMi92Miwgb3IgYWxsCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgdXNlciBERlMgc2hhcmVzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCwgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LURGU3NoYXJlCgogICAgICAgIFJldHVybnMgYWxsIGRpc3RyaWJ1dGVkIGZpbGUgc3lzdGVtIHNoYXJlcyBmb3IgdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LURGU3NoYXJlIC1Eb21haW4gdGVzdAoKICAgICAgICBSZXR1cm5zIGFsbCBkaXN0cmlidXRlZCBmaWxlIHN5c3RlbSBzaGFyZXMgZm9yIHRoZSAndGVzdCcgZG9tYWluLgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZVNldCgiQWxsIiwiVjEiLCIxIiwiVjIiLCIyIildCiAgICAgICAgJFZlcnNpb24gPSAiQWxsIiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgZnVuY3Rpb24gUGFyc2UtUGt0IHsKICAgICAgICBbQ21kbGV0QmluZGluZygpXQogICAgICAgIHBhcmFtKAogICAgICAgICAgICBbYnl0ZVtdXQogICAgICAgICAgICAkUGt0CiAgICAgICAgKQoKICAgICAgICAkYmluID0gJFBrdAogICAgICAgICRibG9iX3ZlcnNpb24gPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGJpblswLi4zXSwwKQogICAgICAgICRibG9iX2VsZW1lbnRfY291bnQgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGJpbls0Li43XSwwKQogICAgICAgICRvZmZzZXQgPSA4CiAgICAgICAgI2h0dHBzOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvY2MyMjcxNDcuYXNweAogICAgICAgICRvYmplY3RfbGlzdCA9IEAoKQogICAgICAgIGZvcigkaT0xOyAkaSAtbGUgJGJsb2JfZWxlbWVudF9jb3VudDsgJGkrKyl7CiAgICAgICAgICAgICAgICRibG9iX25hbWVfc2l6ZV9zdGFydCA9ICRvZmZzZXQKICAgICAgICAgICAgICAgJGJsb2JfbmFtZV9zaXplX2VuZCA9ICRvZmZzZXQgKyAxCiAgICAgICAgICAgICAgICRibG9iX25hbWVfc2l6ZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQxNigkYmluWyRibG9iX25hbWVfc2l6ZV9zdGFydC4uJGJsb2JfbmFtZV9zaXplX2VuZF0sMCkKCiAgICAgICAgICAgICAgICRibG9iX25hbWVfc3RhcnQgPSAkYmxvYl9uYW1lX3NpemVfZW5kICsgMQogICAgICAgICAgICAgICAkYmxvYl9uYW1lX2VuZCA9ICRibG9iX25hbWVfc3RhcnQgKyAkYmxvYl9uYW1lX3NpemUgLSAxCiAgICAgICAgICAgICAgICRibG9iX25hbWUgPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVbmljb2RlLkdldFN0cmluZygkYmluWyRibG9iX25hbWVfc3RhcnQuLiRibG9iX25hbWVfZW5kXSkKCiAgICAgICAgICAgICAgICRibG9iX2RhdGFfc2l6ZV9zdGFydCA9ICRibG9iX25hbWVfZW5kICsgMQogICAgICAgICAgICAgICAkYmxvYl9kYXRhX3NpemVfZW5kID0gJGJsb2JfZGF0YV9zaXplX3N0YXJ0ICsgMwogICAgICAgICAgICAgICAkYmxvYl9kYXRhX3NpemUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGJpblskYmxvYl9kYXRhX3NpemVfc3RhcnQuLiRibG9iX2RhdGFfc2l6ZV9lbmRdLDApCgogICAgICAgICAgICAgICAkYmxvYl9kYXRhX3N0YXJ0ID0gJGJsb2JfZGF0YV9zaXplX2VuZCArIDEKICAgICAgICAgICAgICAgJGJsb2JfZGF0YV9lbmQgPSAkYmxvYl9kYXRhX3N0YXJ0ICsgJGJsb2JfZGF0YV9zaXplIC0gMQogICAgICAgICAgICAgICAkYmxvYl9kYXRhID0gJGJpblskYmxvYl9kYXRhX3N0YXJ0Li4kYmxvYl9kYXRhX2VuZF0KICAgICAgICAgICAgICAgc3dpdGNoIC13aWxkY2FyZCAoJGJsb2JfbmFtZSkgewogICAgICAgICAgICAgICAgIlxzaXRlcm9vdCIgeyAgfQogICAgICAgICAgICAgICAgIlxkb21haW5yb290KiIgewogICAgICAgICAgICAgICAgICAgICMgUGFyc2UgREZTTmFtZXNwYWNlUm9vdE9yTGlua0Jsb2Igb2JqZWN0LiBTdGFydHMgd2l0aCB2YXJpYWJsZSBsZW5ndGggREZTUm9vdE9yTGlua0lEQmxvYiB3aGljaCB3ZSBwYXJzZSBmaXJzdC4uLgogICAgICAgICAgICAgICAgICAgICMgREZTUm9vdE9yTGlua0lEQmxvYgogICAgICAgICAgICAgICAgICAgICRyb290X29yX2xpbmtfZ3VpZF9zdGFydCA9IDAKICAgICAgICAgICAgICAgICAgICAkcm9vdF9vcl9saW5rX2d1aWRfZW5kID0gMTUKICAgICAgICAgICAgICAgICAgICAkcm9vdF9vcl9saW5rX2d1aWQgPSBbYnl0ZVtdXSRibG9iX2RhdGFbJHJvb3Rfb3JfbGlua19ndWlkX3N0YXJ0Li4kcm9vdF9vcl9saW5rX2d1aWRfZW5kXQogICAgICAgICAgICAgICAgICAgICRndWlkID0gTmV3LU9iamVjdCBHdWlkKCwkcm9vdF9vcl9saW5rX2d1aWQpICMgc2hvdWxkIG1hdGNoICRndWlkX3N0cgogICAgICAgICAgICAgICAgICAgICRwcmVmaXhfc2l6ZV9zdGFydCA9ICRyb290X29yX2xpbmtfZ3VpZF9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHByZWZpeF9zaXplX2VuZCA9ICRwcmVmaXhfc2l6ZV9zdGFydCArIDEKICAgICAgICAgICAgICAgICAgICAkcHJlZml4X3NpemUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MTYoJGJsb2JfZGF0YVskcHJlZml4X3NpemVfc3RhcnQuLiRwcmVmaXhfc2l6ZV9lbmRdLDApCiAgICAgICAgICAgICAgICAgICAgJHByZWZpeF9zdGFydCA9ICRwcmVmaXhfc2l6ZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHByZWZpeF9lbmQgPSAkcHJlZml4X3N0YXJ0ICsgJHByZWZpeF9zaXplIC0gMQogICAgICAgICAgICAgICAgICAgICRwcmVmaXggPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVbmljb2RlLkdldFN0cmluZygkYmxvYl9kYXRhWyRwcmVmaXhfc3RhcnQuLiRwcmVmaXhfZW5kXSkKCiAgICAgICAgICAgICAgICAgICAgJHNob3J0X3ByZWZpeF9zaXplX3N0YXJ0ID0gJHByZWZpeF9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHNob3J0X3ByZWZpeF9zaXplX2VuZCA9ICRzaG9ydF9wcmVmaXhfc2l6ZV9zdGFydCArIDEKICAgICAgICAgICAgICAgICAgICAkc2hvcnRfcHJlZml4X3NpemUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MTYoJGJsb2JfZGF0YVskc2hvcnRfcHJlZml4X3NpemVfc3RhcnQuLiRzaG9ydF9wcmVmaXhfc2l6ZV9lbmRdLDApCiAgICAgICAgICAgICAgICAgICAgJHNob3J0X3ByZWZpeF9zdGFydCA9ICRzaG9ydF9wcmVmaXhfc2l6ZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHNob3J0X3ByZWZpeF9lbmQgPSAkc2hvcnRfcHJlZml4X3N0YXJ0ICsgJHNob3J0X3ByZWZpeF9zaXplIC0gMQogICAgICAgICAgICAgICAgICAgICRzaG9ydF9wcmVmaXggPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVbmljb2RlLkdldFN0cmluZygkYmxvYl9kYXRhWyRzaG9ydF9wcmVmaXhfc3RhcnQuLiRzaG9ydF9wcmVmaXhfZW5kXSkKCiAgICAgICAgICAgICAgICAgICAgJHR5cGVfc3RhcnQgPSAkc2hvcnRfcHJlZml4X2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAkdHlwZV9lbmQgPSAkdHlwZV9zdGFydCArIDMKICAgICAgICAgICAgICAgICAgICAkdHlwZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkYmxvYl9kYXRhWyR0eXBlX3N0YXJ0Li4kdHlwZV9lbmRdLDApCgogICAgICAgICAgICAgICAgICAgICRzdGF0ZV9zdGFydCA9ICR0eXBlX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAkc3RhdGVfZW5kID0gJHN0YXRlX3N0YXJ0ICsgMwogICAgICAgICAgICAgICAgICAgICRzdGF0ZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkYmxvYl9kYXRhWyRzdGF0ZV9zdGFydC4uJHN0YXRlX2VuZF0sMCkKCiAgICAgICAgICAgICAgICAgICAgJGNvbW1lbnRfc2l6ZV9zdGFydCA9ICRzdGF0ZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJGNvbW1lbnRfc2l6ZV9lbmQgPSAkY29tbWVudF9zaXplX3N0YXJ0ICsgMQogICAgICAgICAgICAgICAgICAgICRjb21tZW50X3NpemUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MTYoJGJsb2JfZGF0YVskY29tbWVudF9zaXplX3N0YXJ0Li4kY29tbWVudF9zaXplX2VuZF0sMCkKICAgICAgICAgICAgICAgICAgICAkY29tbWVudF9zdGFydCA9ICRjb21tZW50X3NpemVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRjb21tZW50X2VuZCA9ICRjb21tZW50X3N0YXJ0ICsgJGNvbW1lbnRfc2l6ZSAtIDEKICAgICAgICAgICAgICAgICAgICBpZiAoJGNvbW1lbnRfc2l6ZSAtZ3QgMCkgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGNvbW1lbnQgPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVbmljb2RlLkdldFN0cmluZygkYmxvYl9kYXRhWyRjb21tZW50X3N0YXJ0Li4kY29tbWVudF9lbmRdKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkcHJlZml4X3RpbWVzdGFtcF9zdGFydCA9ICRjb21tZW50X2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAkcHJlZml4X3RpbWVzdGFtcF9lbmQgPSAkcHJlZml4X3RpbWVzdGFtcF9zdGFydCArIDcKICAgICAgICAgICAgICAgICAgICAjIGh0dHBzOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvY2MyMzAzMjQuYXNweCBGSUxFVElNRQogICAgICAgICAgICAgICAgICAgICRwcmVmaXhfdGltZXN0YW1wID0gJGJsb2JfZGF0YVskcHJlZml4X3RpbWVzdGFtcF9zdGFydC4uJHByZWZpeF90aW1lc3RhbXBfZW5kXSAjZHdvcmQgbG93RGF0ZVRpbWUgI2R3b3JkIGhpZ2hkYXRldGltZQogICAgICAgICAgICAgICAgICAgICRzdGF0ZV90aW1lc3RhbXBfc3RhcnQgPSAkcHJlZml4X3RpbWVzdGFtcF9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHN0YXRlX3RpbWVzdGFtcF9lbmQgPSAkc3RhdGVfdGltZXN0YW1wX3N0YXJ0ICsgNwogICAgICAgICAgICAgICAgICAgICRzdGF0ZV90aW1lc3RhbXAgPSAkYmxvYl9kYXRhWyRzdGF0ZV90aW1lc3RhbXBfc3RhcnQuLiRzdGF0ZV90aW1lc3RhbXBfZW5kXQogICAgICAgICAgICAgICAgICAgICRjb21tZW50X3RpbWVzdGFtcF9zdGFydCA9ICRzdGF0ZV90aW1lc3RhbXBfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRjb21tZW50X3RpbWVzdGFtcF9lbmQgPSAkY29tbWVudF90aW1lc3RhbXBfc3RhcnQgKyA3CiAgICAgICAgICAgICAgICAgICAgJGNvbW1lbnRfdGltZXN0YW1wID0gJGJsb2JfZGF0YVskY29tbWVudF90aW1lc3RhbXBfc3RhcnQuLiRjb21tZW50X3RpbWVzdGFtcF9lbmRdCiAgICAgICAgICAgICAgICAgICAgJHZlcnNpb25fc3RhcnQgPSAkY29tbWVudF90aW1lc3RhbXBfZW5kICArIDEKICAgICAgICAgICAgICAgICAgICAkdmVyc2lvbl9lbmQgPSAkdmVyc2lvbl9zdGFydCArIDMKICAgICAgICAgICAgICAgICAgICAkdmVyc2lvbiA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkYmxvYl9kYXRhWyR2ZXJzaW9uX3N0YXJ0Li4kdmVyc2lvbl9lbmRdLDApCgogICAgICAgICAgICAgICAgICAgICMgUGFyc2UgcmVzdCBvZiBERlNOYW1lc3BhY2VSb290T3JMaW5rQmxvYiBoZXJlCiAgICAgICAgICAgICAgICAgICAgJGRmc190YXJnZXRsaXN0X2Jsb2Jfc2l6ZV9zdGFydCA9ICR2ZXJzaW9uX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAkZGZzX3RhcmdldGxpc3RfYmxvYl9zaXplX2VuZCA9ICRkZnNfdGFyZ2V0bGlzdF9ibG9iX3NpemVfc3RhcnQgKyAzCiAgICAgICAgICAgICAgICAgICAgJGRmc190YXJnZXRsaXN0X2Jsb2Jfc2l6ZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkYmxvYl9kYXRhWyRkZnNfdGFyZ2V0bGlzdF9ibG9iX3NpemVfc3RhcnQuLiRkZnNfdGFyZ2V0bGlzdF9ibG9iX3NpemVfZW5kXSwwKQoKICAgICAgICAgICAgICAgICAgICAkZGZzX3RhcmdldGxpc3RfYmxvYl9zdGFydCA9ICRkZnNfdGFyZ2V0bGlzdF9ibG9iX3NpemVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRkZnNfdGFyZ2V0bGlzdF9ibG9iX2VuZCA9ICRkZnNfdGFyZ2V0bGlzdF9ibG9iX3N0YXJ0ICsgJGRmc190YXJnZXRsaXN0X2Jsb2Jfc2l6ZSAtIDEKICAgICAgICAgICAgICAgICAgICAkZGZzX3RhcmdldGxpc3RfYmxvYiA9ICRibG9iX2RhdGFbJGRmc190YXJnZXRsaXN0X2Jsb2Jfc3RhcnQuLiRkZnNfdGFyZ2V0bGlzdF9ibG9iX2VuZF0KICAgICAgICAgICAgICAgICAgICAkcmVzZXJ2ZWRfYmxvYl9zaXplX3N0YXJ0ID0gJGRmc190YXJnZXRsaXN0X2Jsb2JfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRyZXNlcnZlZF9ibG9iX3NpemVfZW5kID0gJHJlc2VydmVkX2Jsb2Jfc2l6ZV9zdGFydCArIDMKICAgICAgICAgICAgICAgICAgICAkcmVzZXJ2ZWRfYmxvYl9zaXplID0gW2JpdGNvbnZlcnRlcl06OlRvVUludDMyKCRibG9iX2RhdGFbJHJlc2VydmVkX2Jsb2Jfc2l6ZV9zdGFydC4uJHJlc2VydmVkX2Jsb2Jfc2l6ZV9lbmRdLDApCgogICAgICAgICAgICAgICAgICAgICRyZXNlcnZlZF9ibG9iX3N0YXJ0ID0gJHJlc2VydmVkX2Jsb2Jfc2l6ZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHJlc2VydmVkX2Jsb2JfZW5kID0gJHJlc2VydmVkX2Jsb2Jfc3RhcnQgKyAkcmVzZXJ2ZWRfYmxvYl9zaXplIC0gMQogICAgICAgICAgICAgICAgICAgICRyZXNlcnZlZF9ibG9iID0gJGJsb2JfZGF0YVskcmVzZXJ2ZWRfYmxvYl9zdGFydC4uJHJlc2VydmVkX2Jsb2JfZW5kXQogICAgICAgICAgICAgICAgICAgICRyZWZlcnJhbF90dGxfc3RhcnQgPSAkcmVzZXJ2ZWRfYmxvYl9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHJlZmVycmFsX3R0bF9lbmQgPSAkcmVmZXJyYWxfdHRsX3N0YXJ0ICsgMwogICAgICAgICAgICAgICAgICAgICRyZWZlcnJhbF90dGwgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGJsb2JfZGF0YVskcmVmZXJyYWxfdHRsX3N0YXJ0Li4kcmVmZXJyYWxfdHRsX2VuZF0sMCkKCiAgICAgICAgICAgICAgICAgICAgI1BhcnNlIERGU1RhcmdldExpc3RCbG9iCiAgICAgICAgICAgICAgICAgICAgJHRhcmdldF9jb3VudF9zdGFydCA9IDAKICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0X2NvdW50X2VuZCA9ICR0YXJnZXRfY291bnRfc3RhcnQgKyAzCiAgICAgICAgICAgICAgICAgICAgJHRhcmdldF9jb3VudCA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkZGZzX3RhcmdldGxpc3RfYmxvYlskdGFyZ2V0X2NvdW50X3N0YXJ0Li4kdGFyZ2V0X2NvdW50X2VuZF0sMCkKICAgICAgICAgICAgICAgICAgICAkdF9vZmZzZXQgPSAkdGFyZ2V0X2NvdW50X2VuZCArIDEKCiAgICAgICAgICAgICAgICAgICAgZm9yKCRqPTE7ICRqIC1sZSAkdGFyZ2V0X2NvdW50OyAkaisrKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHRhcmdldF9lbnRyeV9zaXplX3N0YXJ0ID0gJHRfb2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfZW50cnlfc2l6ZV9lbmQgPSAkdGFyZ2V0X2VudHJ5X3NpemVfc3RhcnQgKyAzCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfZW50cnlfc2l6ZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkZGZzX3RhcmdldGxpc3RfYmxvYlskdGFyZ2V0X2VudHJ5X3NpemVfc3RhcnQuLiR0YXJnZXRfZW50cnlfc2l6ZV9lbmRdLDApCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfdGltZV9zdGFtcF9zdGFydCA9ICR0YXJnZXRfZW50cnlfc2l6ZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfdGltZV9zdGFtcF9lbmQgPSAkdGFyZ2V0X3RpbWVfc3RhbXBfc3RhcnQgKyA3CiAgICAgICAgICAgICAgICAgICAgICAgICMgRklMRVRJTUUgYWdhaW4gb3Igc3BlY2lhbCBpZiBwcmlvcml0eSByYW5rIGFuZCBwcmlvcml0eSBjbGFzcyAwCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfdGltZV9zdGFtcCA9ICRkZnNfdGFyZ2V0bGlzdF9ibG9iWyR0YXJnZXRfdGltZV9zdGFtcF9zdGFydC4uJHRhcmdldF90aW1lX3N0YW1wX2VuZF0KICAgICAgICAgICAgICAgICAgICAgICAgJHRhcmdldF9zdGF0ZV9zdGFydCA9ICR0YXJnZXRfdGltZV9zdGFtcF9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfc3RhdGVfZW5kID0gJHRhcmdldF9zdGF0ZV9zdGFydCArIDMKICAgICAgICAgICAgICAgICAgICAgICAgJHRhcmdldF9zdGF0ZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkZGZzX3RhcmdldGxpc3RfYmxvYlskdGFyZ2V0X3N0YXRlX3N0YXJ0Li4kdGFyZ2V0X3N0YXRlX2VuZF0sMCkKCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfdHlwZV9zdGFydCA9ICR0YXJnZXRfc3RhdGVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0X3R5cGVfZW5kID0gJHRhcmdldF90eXBlX3N0YXJ0ICsgMwogICAgICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0X3R5cGUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGRmc190YXJnZXRsaXN0X2Jsb2JbJHRhcmdldF90eXBlX3N0YXJ0Li4kdGFyZ2V0X3R5cGVfZW5kXSwwKQoKICAgICAgICAgICAgICAgICAgICAgICAgJHNlcnZlcl9uYW1lX3NpemVfc3RhcnQgPSAkdGFyZ2V0X3R5cGVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICAgICAkc2VydmVyX25hbWVfc2l6ZV9lbmQgPSAkc2VydmVyX25hbWVfc2l6ZV9zdGFydCArIDEKICAgICAgICAgICAgICAgICAgICAgICAgJHNlcnZlcl9uYW1lX3NpemUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MTYoJGRmc190YXJnZXRsaXN0X2Jsb2JbJHNlcnZlcl9uYW1lX3NpemVfc3RhcnQuLiRzZXJ2ZXJfbmFtZV9zaXplX2VuZF0sMCkKCiAgICAgICAgICAgICAgICAgICAgICAgICRzZXJ2ZXJfbmFtZV9zdGFydCA9ICRzZXJ2ZXJfbmFtZV9zaXplX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAgICAgJHNlcnZlcl9uYW1lX2VuZCA9ICRzZXJ2ZXJfbmFtZV9zdGFydCArICRzZXJ2ZXJfbmFtZV9zaXplIC0gMQogICAgICAgICAgICAgICAgICAgICAgICAkc2VydmVyX25hbWUgPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVbmljb2RlLkdldFN0cmluZygkZGZzX3RhcmdldGxpc3RfYmxvYlskc2VydmVyX25hbWVfc3RhcnQuLiRzZXJ2ZXJfbmFtZV9lbmRdKQoKICAgICAgICAgICAgICAgICAgICAgICAgJHNoYXJlX25hbWVfc2l6ZV9zdGFydCA9ICRzZXJ2ZXJfbmFtZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICRzaGFyZV9uYW1lX3NpemVfZW5kID0gJHNoYXJlX25hbWVfc2l6ZV9zdGFydCArIDEKICAgICAgICAgICAgICAgICAgICAgICAgJHNoYXJlX25hbWVfc2l6ZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQxNigkZGZzX3RhcmdldGxpc3RfYmxvYlskc2hhcmVfbmFtZV9zaXplX3N0YXJ0Li4kc2hhcmVfbmFtZV9zaXplX2VuZF0sMCkKICAgICAgICAgICAgICAgICAgICAgICAgJHNoYXJlX25hbWVfc3RhcnQgPSAkc2hhcmVfbmFtZV9zaXplX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAgICAgJHNoYXJlX25hbWVfZW5kID0gJHNoYXJlX25hbWVfc3RhcnQgKyAkc2hhcmVfbmFtZV9zaXplIC0gMQogICAgICAgICAgICAgICAgICAgICAgICAkc2hhcmVfbmFtZSA9IFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OlVuaWNvZGUuR2V0U3RyaW5nKCRkZnNfdGFyZ2V0bGlzdF9ibG9iWyRzaGFyZV9uYW1lX3N0YXJ0Li4kc2hhcmVfbmFtZV9lbmRdKQoKICAgICAgICAgICAgICAgICAgICAgICAgJHRhcmdldF9saXN0ICs9ICJcXCRzZXJ2ZXJfbmFtZVwkc2hhcmVfbmFtZSIKICAgICAgICAgICAgICAgICAgICAgICAgJHRfb2Zmc2V0ID0gJHNoYXJlX25hbWVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkb2Zmc2V0ID0gJGJsb2JfZGF0YV9lbmQgKyAxCiAgICAgICAgICAgICRkZnNfcGt0X3Byb3BlcnRpZXMgPSBAewogICAgICAgICAgICAgICAgJ05hbWUnID0gJGJsb2JfbmFtZQogICAgICAgICAgICAgICAgJ1ByZWZpeCcgPSAkcHJlZml4CiAgICAgICAgICAgICAgICAnVGFyZ2V0TGlzdCcgPSAkdGFyZ2V0X2xpc3QKICAgICAgICAgICAgfQogICAgICAgICAgICAkb2JqZWN0X2xpc3QgKz0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5ICRkZnNfcGt0X3Byb3BlcnRpZXMKICAgICAgICAgICAgJHByZWZpeCA9ICRudWxsCiAgICAgICAgICAgICRibG9iX25hbWUgPSAkbnVsbAogICAgICAgICAgICAkdGFyZ2V0X2xpc3QgPSAkbnVsbAogICAgICAgIH0KCiAgICAgICAgJHNlcnZlcnMgPSBAKCkKICAgICAgICAkb2JqZWN0X2xpc3QgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIGlmICgkXy5UYXJnZXRMaXN0KSB7CiAgICAgICAgICAgICAgICAkXy5UYXJnZXRMaXN0IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICRzZXJ2ZXJzICs9ICRfLnNwbGl0KCJcIilbMl0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJHNlcnZlcnMKICAgIH0KCiAgICBmdW5jdGlvbiBHZXQtREZTc2hhcmVWMSB7CiAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0KICAgICAgICBwYXJhbSgKICAgICAgICAgICAgW1N0cmluZ10KICAgICAgICAgICAgJERvbWFpbiwKCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICAgICAgW1N0cmluZ10KICAgICAgICAgICAgJEFEU3BhdGgsCgogICAgICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0KICAgICAgICAgICAgW0ludF0KICAgICAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgICAgICRDcmVkZW50aWFsCiAgICAgICAgKQoKICAgICAgICAkREZTc2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwYXRoICRBRFNwYXRoIC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgaWYoJERGU3NlYXJjaGVyKSB7CiAgICAgICAgICAgICRERlNzaGFyZXMgPSBAKCkKICAgICAgICAgICAgJERGU3NlYXJjaGVyLmZpbHRlciA9ICIoJihvYmplY3RDbGFzcz1mVERmcykpIgoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJERGU1NlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAkUHJvcGVydGllcyA9ICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAkUmVtb3RlTmFtZXMgPSAkUHJvcGVydGllcy5yZW1vdGVzZXJ2ZXJuYW1lCiAgICAgICAgICAgICAgICAgICAgJFBrdCA9ICRQcm9wZXJ0aWVzLnBrdAoKICAgICAgICAgICAgICAgICAgICAkREZTc2hhcmVzICs9ICRSZW1vdGVOYW1lcyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJF8uQ29udGFpbnMoJ1wnKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAtUHJvcGVydHkgQHsnTmFtZSc9JFByb3BlcnRpZXMubmFtZVswXTsnUmVtb3RlU2VydmVyTmFtZSc9JF8uc3BsaXQoIlwiKVsyXX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBpbiBwYXJzaW5nIERGUyBzaGFyZSA6ICRfIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICAgICAkREZTU2VhcmNoZXIuZGlzcG9zZSgpCgogICAgICAgICAgICAgICAgaWYoJHBrdCAtYW5kICRwa3RbMF0pIHsKICAgICAgICAgICAgICAgICAgICBQYXJzZS1Qa3QgJHBrdFswXSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBJZiBhIGZvbGRlciBkb2Vzbid0IGhhdmUgYSByZWRpcmVjdGlvbiBpdCB3aWxsCiAgICAgICAgICAgICAgICAgICAgICAgICMgaGF2ZSBhIHRhcmdldCBsaWtlCiAgICAgICAgICAgICAgICAgICAgICAgICMgXFxudWxsXFRlc3ROYW1lU3BhY2VcZm9sZGVyXC5ERlNGb2xkZXJMaW5rIHNvIHdlCiAgICAgICAgICAgICAgICAgICAgICAgICMgZG8gYWN0dWFsbHkgd2FudCB0byBtYXRjaCBvbiAibnVsbCIgcmF0aGVyIHRoYW4KICAgICAgICAgICAgICAgICAgICAgICAgIyAkbnVsbAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF8gLW5lICJudWxsIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5IEB7J05hbWUnPSRQcm9wZXJ0aWVzLm5hbWVbMF07J1JlbW90ZVNlcnZlck5hbWUnPSRffQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkdldC1ERlNzaGFyZVYxIGVycm9yIDogJF8iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJERGU3NoYXJlcyB8IFNvcnQtT2JqZWN0IC1Qcm9wZXJ0eSAiUmVtb3RlU2VydmVyTmFtZSIKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gR2V0LURGU3NoYXJlVjIgewogICAgICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICAgICAgcGFyYW0oCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICREb21haW4sCgogICAgICAgICAgICBbU3RyaW5nXQogICAgICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICRBRFNwYXRoLAoKICAgICAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgICAgICBbSW50XQogICAgICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAgICAgJENyZWRlbnRpYWwKICAgICAgICApCgogICAgICAgICRERlNzZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJEFEU3BhdGggLVBhZ2VTaXplICRQYWdlU2l6ZQoKICAgICAgICBpZigkREZTc2VhcmNoZXIpIHsKICAgICAgICAgICAgJERGU3NoYXJlcyA9IEAoKQogICAgICAgICAgICAkREZTc2VhcmNoZXIuZmlsdGVyID0gIigmKG9iamVjdENsYXNzPW1zREZTLUxpbmt2MikpIgogICAgICAgICAgICAkREZTU2VhcmNoZXIuUHJvcGVydGllc1RvTG9hZC5BZGRSYW5nZSgoJ21zZGZzLWxpbmtwYXRodjInLCdtc0RGUy1UYXJnZXRMaXN0djInKSkKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkUmVzdWx0cyA9ICRERlNTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgPSAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgJHRhcmdldF9saXN0ID0gJFByb3BlcnRpZXMuJ21zZGZzLXRhcmdldGxpc3R2MidbMF0KICAgICAgICAgICAgICAgICAgICAkeG1sID0gW3htbF1bU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVbmljb2RlLkdldFN0cmluZygkdGFyZ2V0X2xpc3RbMi4uKCR0YXJnZXRfbGlzdC5MZW5ndGgtMSldKQogICAgICAgICAgICAgICAgICAgICRERlNzaGFyZXMgKz0gJHhtbC50YXJnZXRzLkNoaWxkTm9kZXMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGFyZ2V0ID0gJF8uSW5uZXJUZXh0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRUYXJnZXQuQ29udGFpbnMoJ1wnKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkREZTcm9vdCA9ICRUYXJnZXQuc3BsaXQoIlwiKVszXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTaGFyZU5hbWUgPSAkUHJvcGVydGllcy4nbXNkZnMtbGlua3BhdGh2MidbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAtUHJvcGVydHkgQHsnTmFtZSc9IiRERlNyb290JFNoYXJlTmFtZSI7J1JlbW90ZVNlcnZlck5hbWUnPSRUYXJnZXQuc3BsaXQoIlwiKVsyXX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBpbiBwYXJzaW5nIHRhcmdldCA6ICRfIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICAgICAkREZTU2VhcmNoZXIuZGlzcG9zZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiR2V0LURGU3NoYXJlVjIgZXJyb3IgOiAkXyIKICAgICAgICAgICAgfQogICAgICAgICAgICAkREZTc2hhcmVzIHwgU29ydC1PYmplY3QgLVVuaXF1ZSAtUHJvcGVydHkgIlJlbW90ZVNlcnZlck5hbWUiCiAgICAgICAgfQogICAgfQoKICAgICRERlNzaGFyZXMgPSBAKCkKCiAgICBpZiAoICgkVmVyc2lvbiAtZXEgImFsbCIpIC1vciAoJFZlcnNpb24uZW5kc1dpdGgoIjEiKSkgKSB7CiAgICAgICAgJERGU3NoYXJlcyArPSBHZXQtREZTc2hhcmVWMSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJEFEU3BhdGggLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgfQogICAgaWYgKCAoJFZlcnNpb24gLWVxICJhbGwiKSAtb3IgKCRWZXJzaW9uLmVuZHNXaXRoKCIyIikpICkgewogICAgICAgICRERlNzaGFyZXMgKz0gR2V0LURGU3NoYXJlVjIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwYXRoICRBRFNwYXRoIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgIH0KCiAgICAkREZTc2hhcmVzIHwgU29ydC1PYmplY3QgLVByb3BlcnR5ICgiUmVtb3RlU2VydmVyTmFtZSIsIk5hbWUiKSAtVW5pcXVlCn0KCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojCiMgR1BPIHJlbGF0ZWQgZnVuY3Rpb25zLgojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgoKZmlsdGVyIEdldC1HcHRUbXBsIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBIZWxwZXIgdG8gcGFyc2UgYSBHcHRUbXBsLmluZiBwb2xpY3kgZmlsZSBwYXRoIGludG8gYSBjdXN0b20gb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgR3B0VG1wbFBhdGgKCiAgICAgICAgVGhlIEdwdFRtcGwuaW5mIGZpbGUgcGF0aCBuYW1lIHRvIHBhcnNlLiAKCiAgICAuUEFSQU1FVEVSIFVzZVBTRHJpdmUKCiAgICAgICAgU3dpdGNoLiBNb3VudCB0aGUgdGFyZ2V0IEdwdFRtcGwgZm9sZGVyIHBhdGggYXMgYSB0ZW1wb3JhcnkgUFNEcml2ZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1HcHRUbXBsIC1HcHRUbXBsUGF0aCAiXFxkZXYudGVzdGxhYi5sb2NhbFxzeXN2b2xcZGV2LnRlc3RsYWIubG9jYWxcUG9saWNpZXNcezMxQjJGMzQwLTAxNkQtMTFEMi05NDVGLTAwQzA0RkI5ODRGOX1cTUFDSElORVxNaWNyb3NvZnRcV2luZG93cyBOVFxTZWNFZGl0XEdwdFRtcGwuaW5mIgoKICAgICAgICBQYXJzZSB0aGUgZGVmYXVsdCBkb21haW4gcG9saWN5IC5pbmYgZm9yIGRldi50ZXN0bGFiLmxvY2FsCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdwdFRtcGxQYXRoLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRVc2VQU0RyaXZlCiAgICApCgogICAgaWYoJFVzZVBTRHJpdmUpIHsKICAgICAgICAjIGlmIHdlJ3JlIFBTRHJpdmVzLCBjcmVhdGUgYSB0ZW1wb3JhcnkgbW91bnQgcG9pbnQKICAgICAgICAkUGFydHMgPSAkR3B0VG1wbFBhdGguc3BsaXQoJ1wnKQogICAgICAgICRGb2xkZXJQYXRoID0gJFBhcnRzWzAuLigkUGFydHMubGVuZ3RoLTIpXSAtam9pbiAnXCcKICAgICAgICAkRmlsZVBhdGggPSAkUGFydHNbLTFdCiAgICAgICAgJFJhbmREcml2ZSA9ICgiYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoiLlRvQ2hhckFycmF5KCkgfCBHZXQtUmFuZG9tIC1Db3VudCA3KSAtam9pbiAnJwoKICAgICAgICBXcml0ZS1WZXJib3NlICJNb3VudGluZyBwYXRoICRHcHRUbXBsUGF0aCB1c2luZyBhIHRlbXAgUFNEcml2ZSBhdCAkUmFuZERyaXZlIgoKICAgICAgICB0cnkgewogICAgICAgICAgICAkTnVsbCA9IE5ldy1QU0RyaXZlIC1OYW1lICRSYW5kRHJpdmUgLVBTUHJvdmlkZXIgRmlsZVN5c3RlbSAtUm9vdCAkRm9sZGVyUGF0aCAgLUVycm9yQWN0aW9uIFN0b3AKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBtb3VudGluZyBwYXRoICRHcHRUbXBsUGF0aCA6ICRfIgogICAgICAgICAgICByZXR1cm4gJE51bGwKICAgICAgICB9CgogICAgICAgICMgc28gd2UgY2FuIGNkL2RpciB0aGUgbmV3IGRyaXZlCiAgICAgICAgJFRhcmdldEdwdFRtcGxQYXRoID0gJFJhbmREcml2ZSArICI6XCIgKyAkRmlsZVBhdGgKICAgIH0KICAgIGVsc2UgewogICAgICAgICRUYXJnZXRHcHRUbXBsUGF0aCA9ICRHcHRUbXBsUGF0aAogICAgfQoKICAgIFdyaXRlLVZlcmJvc2UgIkdwdFRtcGxQYXRoOiAkR3B0VG1wbFBhdGgiCgogICAgdHJ5IHsKICAgICAgICBXcml0ZS1WZXJib3NlICJQYXJzaW5nICRUYXJnZXRHcHRUbXBsUGF0aCIKICAgICAgICAkVGFyZ2V0R3B0VG1wbFBhdGggfCBHZXQtSW5pQ29udGVudCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgfQogICAgY2F0Y2ggewogICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIHBhcnNpbmcgJFRhcmdldEdwdFRtcGxQYXRoIDogJF8iCiAgICB9CgogICAgaWYoJFVzZVBTRHJpdmUgLWFuZCAkUmFuZERyaXZlKSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiUmVtb3ZpbmcgdGVtcCBQU0RyaXZlICRSYW5kRHJpdmUiCiAgICAgICAgR2V0LVBTRHJpdmUgLU5hbWUgJFJhbmREcml2ZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IFJlbW92ZS1QU0RyaXZlIC1Gb3JjZQogICAgfQp9CgoKZmlsdGVyIEdldC1Hcm91cHNYTUwgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEhlbHBlciB0byBwYXJzZSBhIGdyb3Vwcy54bWwgZmlsZSBwYXRoIGludG8gYSBjdXN0b20gb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgR3JvdXBzWE1McGF0aAoKICAgICAgICBUaGUgZ3JvdXBzLnhtbCBmaWxlIHBhdGggbmFtZSB0byBwYXJzZS4gCgogICAgLlBBUkFNRVRFUiBVc2VQU0RyaXZlCgogICAgICAgIFN3aXRjaC4gTW91bnQgdGhlIHRhcmdldCBncm91cHMueG1sIGZvbGRlciBwYXRoIGFzIGEgdGVtcG9yYXJ5IFBTRHJpdmUuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdyb3Vwc1hNTFBhdGgsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVzZVBTRHJpdmUKICAgICkKCiAgICBpZigkVXNlUFNEcml2ZSkgewogICAgICAgICMgaWYgd2UncmUgUFNEcml2ZXMsIGNyZWF0ZSBhIHRlbXBvcmFyeSBtb3VudCBwb2ludAogICAgICAgICRQYXJ0cyA9ICRHcm91cHNYTUxQYXRoLnNwbGl0KCdcJykKICAgICAgICAkRm9sZGVyUGF0aCA9ICRQYXJ0c1swLi4oJFBhcnRzLmxlbmd0aC0yKV0gLWpvaW4gJ1wnCiAgICAgICAgJEZpbGVQYXRoID0gJFBhcnRzWy0xXQogICAgICAgICRSYW5kRHJpdmUgPSAoImFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6Ii5Ub0NoYXJBcnJheSgpIHwgR2V0LVJhbmRvbSAtQ291bnQgNykgLWpvaW4gJycKCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiTW91bnRpbmcgcGF0aCAkR3JvdXBzWE1MUGF0aCB1c2luZyBhIHRlbXAgUFNEcml2ZSBhdCAkUmFuZERyaXZlIgoKICAgICAgICB0cnkgewogICAgICAgICAgICAkTnVsbCA9IE5ldy1QU0RyaXZlIC1OYW1lICRSYW5kRHJpdmUgLVBTUHJvdmlkZXIgRmlsZVN5c3RlbSAtUm9vdCAkRm9sZGVyUGF0aCAgLUVycm9yQWN0aW9uIFN0b3AKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBtb3VudGluZyBwYXRoICRHcm91cHNYTUxQYXRoIDogJF8iCiAgICAgICAgICAgIHJldHVybiAkTnVsbAogICAgICAgIH0KCiAgICAgICAgIyBzbyB3ZSBjYW4gY2QvZGlyIHRoZSBuZXcgZHJpdmUKICAgICAgICAkVGFyZ2V0R3JvdXBzWE1MUGF0aCA9ICRSYW5kRHJpdmUgKyAiOlwiICsgJEZpbGVQYXRoCiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkVGFyZ2V0R3JvdXBzWE1MUGF0aCA9ICRHcm91cHNYTUxQYXRoCiAgICB9CgogICAgdHJ5IHsKICAgICAgICBbWE1MXSRHcm91cHNYTUxjb250ZW50ID0gR2V0LUNvbnRlbnQgJFRhcmdldEdyb3Vwc1hNTFBhdGggLUVycm9yQWN0aW9uIFN0b3AKCiAgICAgICAgIyBwcm9jZXNzIGFsbCBncm91cCBwcm9wZXJ0aWVzIGluIHRoZSBYTUwKICAgICAgICAkR3JvdXBzWE1MY29udGVudCB8IFNlbGVjdC1YbWwgIi9Hcm91cHMvR3JvdXAiIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgbm9kZSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICRHcm91cG5hbWUgPSAkXy5Qcm9wZXJ0aWVzLmdyb3VwTmFtZQoKICAgICAgICAgICAgIyBleHRyYWN0IHRoZSBsb2NhbGdyb3VwIHNpZCBmb3IgbWVtYmVyb2YKICAgICAgICAgICAgJEdyb3VwU0lEID0gJF8uUHJvcGVydGllcy5ncm91cFNpZAogICAgICAgICAgICBpZigtbm90ICRHcm91cFNJRCkgewogICAgICAgICAgICAgICAgaWYoJEdyb3VwbmFtZSAtbWF0Y2ggJ0FkbWluaXN0cmF0b3JzJykgewogICAgICAgICAgICAgICAgICAgICRHcm91cFNJRCA9ICdTLTEtNS0zMi01NDQnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYoJEdyb3VwbmFtZSAtbWF0Y2ggJ1JlbW90ZSBEZXNrdG9wJykgewogICAgICAgICAgICAgICAgICAgICRHcm91cFNJRCA9ICdTLTEtNS0zMi01NTUnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYoJEdyb3VwbmFtZSAtbWF0Y2ggJ0d1ZXN0cycpIHsKICAgICAgICAgICAgICAgICAgICAkR3JvdXBTSUQgPSAnUy0xLTUtMzItNTQ2JwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJEdyb3VwU0lEID0gQ29udmVydC1OYW1lVG9TaWQgLU9iamVjdE5hbWUgJEdyb3VwbmFtZSB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IFNJRAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGV4dHJhY3Qgb3V0IG1lbWJlcnMgYWRkZWQgdG8gdGhpcyBncm91cAogICAgICAgICAgICAkTWVtYmVycyA9ICRfLlByb3BlcnRpZXMubWVtYmVycyB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IE1lbWJlciB8IFdoZXJlLU9iamVjdCB7ICRfLmFjdGlvbiAtbWF0Y2ggJ0FERCcgfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgIGlmKCRfLnNpZCkgeyAkXy5zaWQgfQogICAgICAgICAgICAgICAgZWxzZSB7ICRfLm5hbWUgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJE1lbWJlcnMpIHsKCiAgICAgICAgICAgICAgICAjIGV4dHJhY3Qgb3V0IGFueS9hbGwgZmlsdGVycy4uLkkgaGF0ZSB5b3UgR1BQCiAgICAgICAgICAgICAgICBpZigkXy5maWx0ZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgJEZpbHRlcnMgPSAkXy5maWx0ZXJzLkdldEVudW1lcmF0b3IoKSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5IEB7J1R5cGUnID0gJF8uTG9jYWxOYW1lOydWYWx1ZScgPSAkXy5uYW1lfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRGaWx0ZXJzID0gJE51bGwKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigkTWVtYmVycyAtaXNub3QgW1N5c3RlbS5BcnJheV0pIHsgJE1lbWJlcnMgPSBAKCRNZW1iZXJzKSB9CgogICAgICAgICAgICAgICAgJEdQT0dyb3VwID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgJEdQT0dyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT1BhdGgnICRUYXJnZXRHcm91cHNYTUxQYXRoCiAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRmlsdGVycycgJEZpbHRlcnMKICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cE5hbWUnICRHcm91cE5hbWUKICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cFNJRCcgJEdyb3VwU0lECiAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXBNZW1iZXJPZicgJE51bGwKICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cE1lbWJlcnMnICRNZW1iZXJzCiAgICAgICAgICAgICAgICAkR1BPR3JvdXAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGNhdGNoIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBwYXJzaW5nICRUYXJnZXRHcm91cHNYTUxQYXRoIDogJF8iCiAgICB9CgogICAgaWYoJFVzZVBTRHJpdmUgLWFuZCAkUmFuZERyaXZlKSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiUmVtb3ZpbmcgdGVtcCBQU0RyaXZlICRSYW5kRHJpdmUiCiAgICAgICAgR2V0LVBTRHJpdmUgLU5hbWUgJFJhbmREcml2ZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IFJlbW92ZS1QU0RyaXZlIC1Gb3JjZQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LU5ldEdQTyB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgR2V0cyBhIGxpc3Qgb2YgYWxsIGN1cnJlbnQgR1BPcyBpbiBhIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIEdQT25hbWUKCiAgICAgICAgVGhlIEdQTyBuYW1lIHRvIHF1ZXJ5IGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLiAgIAoKICAgIC5QQVJBTUVURVIgRGlzcGxheU5hbWUKCiAgICAgICAgVGhlIEdQTyBkaXNwbGF5IG5hbWUgdG8gcXVlcnkgZm9yLCB3aWxkY2FyZHMgYWNjZXB0ZWQuICAgCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgUmV0dXJuIGFsbCBHUE8gb2JqZWN0cyBhcHBsaWVkIHRvIGEgZ2l2ZW4gY29tcHV0ZXIgKEZRRE4pLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIEdQT3MsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoCiAgICAgICAgZS5nLiAiTERBUDovL2NuPXs4RkY1OUQyOC0xNUQ3LTQyMkEtQkNCNy0yQUU0NTcyNDEyNUF9LGNuPXBvbGljaWVzLGNuPXN5c3RlbSxEQz1kZXYsREM9dGVzdGxhYixEQz1sb2NhbCIKCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldEdQTyAtRG9tYWluIHRlc3RsYWIubG9jYWwKICAgICAgICAKICAgICAgICBSZXR1cm5zIHRoZSBHUE9zIGluIHRoZSAndGVzdGxhYi5sb2NhbCcgZG9tYWluLiAKIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR1BPbmFtZSA9ICcqJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRGlzcGxheU5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAogICAgICAgIAogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgJEdQT1NlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcGF0aCAkQURTcGF0aCAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICB9CgogICAgcHJvY2VzcyB7CiAgICAgICAgaWYgKCRHUE9TZWFyY2hlcikgewoKICAgICAgICAgICAgaWYoJENvbXB1dGVyTmFtZSkgewogICAgICAgICAgICAgICAgJEdQT05hbWVzID0gQCgpCiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJzID0gR2V0LU5ldENvbXB1dGVyIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgICAgICAgICBpZighJENvbXB1dGVycykgewogICAgICAgICAgICAgICAgICAgIHRocm93ICJDb21wdXRlciAkQ29tcHV0ZXJOYW1lIGluIGRvbWFpbiAnJERvbWFpbicgbm90IGZvdW5kISBUcnkgYSBmdWxseSBxdWFsaWZpZWQgaG9zdCBuYW1lIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIGdldCB0aGUgZ2l2ZW4gY29tcHV0ZXIncyBPVQogICAgICAgICAgICAgICAgJENvbXB1dGVyT1VzID0gQCgpCiAgICAgICAgICAgICAgICBGb3JFYWNoKCRDb21wdXRlciBpbiAkQ29tcHV0ZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgIyBleHRyYWN0IGFsbCBPVXMgYSBjb21wdXRlciBpcyBhIHBhcnQgb2YKICAgICAgICAgICAgICAgICAgICAkRE4gPSAkQ29tcHV0ZXIuZGlzdGluZ3Vpc2hlZG5hbWUKCiAgICAgICAgICAgICAgICAgICAgJENvbXB1dGVyT1VzICs9ICRETi5zcGxpdCgiLCIpIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICBpZigkXy5zdGFydHN3aXRoKCJPVT0iKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEROLnN1YnN0cmluZygkRE4uaW5kZXhvZigkXykpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkNvbXB1dGVyT1VzOiAkQ29tcHV0ZXJPVXMiCgogICAgICAgICAgICAgICAgIyBmaW5kIGFsbCB0aGUgR1BPcyBsaW5rZWQgdG8gdGhlIGNvbXB1dGVyJ3MgT1UKICAgICAgICAgICAgICAgIEZvckVhY2goJENvbXB1dGVyT1UgaW4gJENvbXB1dGVyT1VzKSB7CiAgICAgICAgICAgICAgICAgICAgJEdQT05hbWVzICs9IEdldC1OZXRPVSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUFEU3BhdGggJENvbXB1dGVyT1UgLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBGb3JFYWNoLU9iamVjdCB7IAogICAgICAgICAgICAgICAgICAgICAgICAjIGdldCBhbnkgR1BPIGxpbmtzCiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlLXZlcmJvc2UgImJsYWg6ICQoJF8ubmFtZSkiCiAgICAgICAgICAgICAgICAgICAgICAgICRfLmdwbGluay5zcGxpdCgiXVsiKSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkXy5zdGFydHN3aXRoKCJMREFQIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkXy5zcGxpdCgiOyIpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkdQT05hbWVzOiAkR1BPTmFtZXMiCgogICAgICAgICAgICAgICAgIyBmaW5kIGFueSBHUE9zIGxpbmtlZCB0byB0aGUgc2l0ZSBmb3IgdGhlIGdpdmVuIGNvbXB1dGVyCiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJTaXRlID0gKEdldC1TaXRlTmFtZSAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUpLlNpdGVOYW1lCiAgICAgICAgICAgICAgICBpZigkQ29tcHV0ZXJTaXRlIC1hbmQgKCRDb21wdXRlclNpdGUgLW5vdGxpa2UgJ0Vycm9yKicpKSB7CiAgICAgICAgICAgICAgICAgICAgJEdQT05hbWVzICs9IEdldC1OZXRTaXRlIC1TaXRlTmFtZSAkQ29tcHV0ZXJTaXRlIC1GdWxsRGF0YSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJF8uZ3BsaW5rKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkXy5ncGxpbmsuc3BsaXQoIl1bIikgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRfLnN0YXJ0c3dpdGgoIkxEQVAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkXy5zcGxpdCgiOyIpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRHUE9OYW1lcyB8IFdoZXJlLU9iamVjdHskXyAtYW5kICgkXyAtbmUgJycpfSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICAgICAgICAgIyB1c2UgdGhlIGdwbGluayBhcyBhbiBBRFMgcGF0aCB0byBlbnVtZXJhdGUgYWxsIEdQT3MgZm9yIHRoZSBjb21wdXRlcgogICAgICAgICAgICAgICAgICAgICRHUE9TZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJF8gLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgICAgICAgICAgICAgICAgICRHUE9TZWFyY2hlci5maWx0ZXI9IigmKG9iamVjdENhdGVnb3J5PWdyb3VwUG9saWN5Q29udGFpbmVyKShuYW1lPSRHUE9uYW1lKSkiCgogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJEdQT1NlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE91dCA9IENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRPdXQgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkT3V0CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICRHUE9TZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICRfCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmKCREaXNwbGF5TmFtZSkgewogICAgICAgICAgICAgICAgICAgICRHUE9TZWFyY2hlci5maWx0ZXI9IigmKG9iamVjdENhdGVnb3J5PWdyb3VwUG9saWN5Q29udGFpbmVyKShkaXNwbGF5bmFtZT0kRGlzcGxheU5hbWUpKSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRHUE9TZWFyY2hlci5maWx0ZXI9IigmKG9iamVjdENhdGVnb3J5PWdyb3VwUG9saWN5Q29udGFpbmVyKShuYW1lPSRHUE9uYW1lKSkiCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0cyA9ICRHUE9TZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICBpZigkQURTUGF0aCAtYW5kICgkQURTcGF0aCAtTWF0Y2ggJ15HQzovLycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUHJvcGVydGllcyA9IENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdQT0ROID0gJFByb3BlcnRpZXMuZGlzdGluZ3Vpc2hlZG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR1BPRG9tYWluID0gJEdQT0ROLnN1YlN0cmluZygkR1BPRE4uSW5kZXhPZigiREM9IikpIC1yZXBsYWNlICdEQz0nLCcnIC1yZXBsYWNlICcsJywnLicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZ3BjZmlsZXN5c3BhdGggPSAiXFwkR1BPRG9tYWluXFN5c1ZvbFwkR1BPRG9tYWluXFBvbGljaWVzXCQoJFByb3BlcnRpZXMuY24pIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ2dwY2ZpbGVzeXNwYXRoJyAkZ3BjZmlsZXN5c3BhdGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUHJvcGVydGllcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQvcHJvY2VzcyB0aGUgTERBUCBmaWVsZHMgZm9yIGVhY2ggcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICAgICAgICAgJEdQT1NlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgJF8KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIE5ldy1HUE9JbW1lZGlhdGVUYXNrIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBCdWlsZHMgYW4gJ0ltbWVkaWF0ZScgc2NodGFzayB0byBwdXNoIG91dCB0aHJvdWdoIGEgc3BlY2lmaWVkIEdQTy4KCiAgICAuUEFSQU1FVEVSIFRhc2tOYW1lCgogICAgICAgIE5hbWUgZm9yIHRoZSBzY2h0YXNrIHRvIHJlY3JlYXRlLiBSZXF1aXJlZC4KCiAgICAuUEFSQU1FVEVSIENvbW1hbmQKCiAgICAgICAgVGhlIGNvbW1hbmQgdG8gZXhlY3V0ZSB3aXRoIHRoZSB0YXNrLCBkZWZhdWx0cyB0byAncG93ZXJzaGVsbCcKCiAgICAuUEFSQU1FVEVSIENvbW1hbmRBcmd1bWVudHMKCiAgICAgICAgVGhlIGFyZ3VtZW50cyB0byBzdXBwbHkgdG8gdGhlIC1Db21tYW5kIGJlaW5nIGxhdW5jaGVkLgoKICAgIC5QQVJBTUVURVIgVGFza0Rlc2NyaXB0aW9uCgogICAgICAgIEFuIG9wdGlvbmFsIGRlc2NyaXB0aW9uIGZvciB0aGUgdGFzay4KCiAgICAuUEFSQU1FVEVSIFRhc2tBdXRob3IKICAgICAgICAKICAgICAgICBUaGUgZGlzcGxheWVkIGF1dGhvciBvZiB0aGUgdGFzaywgZGVmYXVsdHMgdG8gJydOVCBBVVRIT1JJVFlcU3lzdGVtJwoKICAgIC5QQVJBTUVURVIgVGFza01vZGlmaWVkRGF0ZQogICAgCiAgICAgICAgVGhlIGRpc3BsYXllZCBtb2RpZmllZCBkYXRlIGZvciB0aGUgdGFzaywgZGVmYXVsdHMgdG8gMzAgZGF5cyBhZ28uCgogICAgLlBBUkFNRVRFUiBHUE9uYW1lCgogICAgICAgIFRoZSBHUE8gbmFtZSB0byBidWlsZCB0aGUgdGFzayBmb3IuCgogICAgLlBBUkFNRVRFUiBHUE9EaXNwbGF5TmFtZQoKICAgICAgICBUaGUgR1BPIGRpc3BsYXkgbmFtZSB0byBidWlsZCB0aGUgdGFzayBmb3IuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgdGhlIEdQT3MsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoCiAgICAgICAgZS5nLiAiTERBUDovL2NuPXs4RkY1OUQyOC0xNUQ3LTQyMkEtQkNCNy0yQUU0NTcyNDEyNUF9LGNuPXBvbGljaWVzLGNuPXN5c3RlbSxEQz1kZXYsREM9dGVzdGxhYixEQz1sb2NhbCIKCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFM+IE5ldy1HUE9JbW1lZGlhdGVUYXNrIC1UYXNrTmFtZSBEZWJ1Z2dpbmcgLUdQT0Rpc3BsYXlOYW1lIFNlY3VyZVBvbGljeSAtQ29tbWFuZEFyZ3VtZW50cyAnLWMgIjEyMyB8IE91dC1GaWxlIEM6XFRlbXBcZGVidWcudHh0IicgLUZvcmNlCgogICAgICAgIENyZWF0ZSBhbiBpbW1lZGlhdGUgc2NodGFzayB0aGF0IGV4ZWN1dGVzIHRoZSBzcGVjaWZpZWQgUG93ZXJTaGVsbCBhcmd1bWVudHMgYW5kCiAgICAgICAgcHVzaCBpdCBvdXQgdG8gdGhlICdTZWN1cmVQb2xpY3knIEdQTywgc2tpcHBpbmcgdGhlIGNvbmZpcm1hdGlvbiBwcm9tcHQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFM+IE5ldy1HUE9JbW1lZGlhdGVUYXNrIC1HUE9EaXNwbGF5TmFtZSBTZWN1cmVQb2xpY3kgLVJlbW92ZSAtRm9yY2UKCiAgICAgICAgUmVtb3ZlIGFsbCBzY2h0YXNrcyBmcm9tIHRoZSAnU2VjdXJlUG9saWN5JyBHUE8sIHNraXBwaW5nIHRoZSBjb25maXJtYXRpb24gcHJvbXB0LgojPgogICAgW0NtZGxldEJpbmRpbmcoRGVmYXVsdFBhcmFtZXRlclNldE5hbWUgPSAnQ3JlYXRlJyldCiAgICBQYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScsIE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJFRhc2tOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQ3JlYXRlJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21tYW5kID0gJ3Bvd2Vyc2hlbGwnLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQ3JlYXRlJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21tYW5kQXJndW1lbnRzLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQ3JlYXRlJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRUYXNrRGVzY3JpcHRpb24gPSAnJywKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkVGFza0F1dGhvciA9ICdOVCBBVVRIT1JJVFlcU3lzdGVtJywKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkVGFza01vZGlmaWVkRGF0ZSA9IChHZXQtRGF0ZSAoR2V0LURhdGUpLkFkZERheXMoLTMwKSAtRm9ybWF0IHUpLnRyaW0oIloiKSwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScpXQogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdSZW1vdmUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRHUE9uYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQ3JlYXRlJyldCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ1JlbW92ZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdQT0Rpc3BsYXlOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQ3JlYXRlJyldCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ1JlbW92ZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScpXQogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdSZW1vdmUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAogICAgICAgIAogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnKV0KICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnUmVtb3ZlJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScpXQogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdSZW1vdmUnKV0KICAgICAgICBbU3dpdGNoXQogICAgICAgICRGb3JjZSwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ1JlbW92ZScpXQogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlbW92ZSwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScpXQogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdSZW1vdmUnKV0gICAgICAgIAogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgIyBidWlsZCB0aGUgWE1MIHNwZWMgZm9yIG91ciAnaW1tZWRpYXRlJyBzY2hlZHVsZWQgdGFzawogICAgJFRhc2tYTUwgPSAnPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48U2NoZWR1bGVkVGFza3MgY2xzaWQ9IntDQzYzRjIwMC03MzA5LTRiYTAtQjE1NC1BNzFDRDExOERCQ0N9Ij48SW1tZWRpYXRlVGFza1YyIGNsc2lkPSJ7OTc1NkI1ODEtNzZFQy00MTY5LTlBRkMtMENBOEQ0M0FEQjVGfSIgbmFtZT0iJyskVGFza05hbWUrJyIgaW1hZ2U9IjAiIGNoYW5nZWQ9IicrJFRhc2tNb2RpZmllZERhdGUrJyIgdWlkPSJ7JyskKFtndWlkXTo6TmV3R3VpZCgpKSsnfSIgdXNlckNvbnRleHQ9IjAiIHJlbW92ZVBvbGljeT0iMCI+PFByb3BlcnRpZXMgYWN0aW9uPSJDIiBuYW1lPSInKyRUYXNrTmFtZSsnIiBydW5Bcz0iTlQgQVVUSE9SSVRZXFN5c3RlbSIgbG9nb25UeXBlPSJTNFUiPjxUYXNrIHZlcnNpb249IjEuMyI+PFJlZ2lzdHJhdGlvbkluZm8+PEF1dGhvcj4nKyRUYXNrQXV0aG9yKyc8L0F1dGhvcj48RGVzY3JpcHRpb24+JyskVGFza0Rlc2NyaXB0aW9uKyc8L0Rlc2NyaXB0aW9uPjwvUmVnaXN0cmF0aW9uSW5mbz48UHJpbmNpcGFscz48UHJpbmNpcGFsIGlkPSJBdXRob3IiPjxVc2VySWQ+TlQgQVVUSE9SSVRZXFN5c3RlbTwvVXNlcklkPjxSdW5MZXZlbD5IaWdoZXN0QXZhaWxhYmxlPC9SdW5MZXZlbD48TG9nb25UeXBlPlM0VTwvTG9nb25UeXBlPjwvUHJpbmNpcGFsPjwvUHJpbmNpcGFscz48U2V0dGluZ3M+PElkbGVTZXR0aW5ncz48RHVyYXRpb24+UFQxME08L0R1cmF0aW9uPjxXYWl0VGltZW91dD5QVDFIPC9XYWl0VGltZW91dD48U3RvcE9uSWRsZUVuZD50cnVlPC9TdG9wT25JZGxlRW5kPjxSZXN0YXJ0T25JZGxlPmZhbHNlPC9SZXN0YXJ0T25JZGxlPjwvSWRsZVNldHRpbmdzPjxNdWx0aXBsZUluc3RhbmNlc1BvbGljeT5JZ25vcmVOZXc8L011bHRpcGxlSW5zdGFuY2VzUG9saWN5PjxEaXNhbGxvd1N0YXJ0SWZPbkJhdHRlcmllcz5mYWxzZTwvRGlzYWxsb3dTdGFydElmT25CYXR0ZXJpZXM+PFN0b3BJZkdvaW5nT25CYXR0ZXJpZXM+dHJ1ZTwvU3RvcElmR29pbmdPbkJhdHRlcmllcz48QWxsb3dIYXJkVGVybWluYXRlPmZhbHNlPC9BbGxvd0hhcmRUZXJtaW5hdGU+PFN0YXJ0V2hlbkF2YWlsYWJsZT50cnVlPC9TdGFydFdoZW5BdmFpbGFibGU+PEFsbG93U3RhcnRPbkRlbWFuZD5mYWxzZTwvQWxsb3dTdGFydE9uRGVtYW5kPjxFbmFibGVkPnRydWU8L0VuYWJsZWQ+PEhpZGRlbj50cnVlPC9IaWRkZW4+PEV4ZWN1dGlvblRpbWVMaW1pdD5QVDBTPC9FeGVjdXRpb25UaW1lTGltaXQ+PFByaW9yaXR5Pjc8L1ByaW9yaXR5PjxEZWxldGVFeHBpcmVkVGFza0FmdGVyPlBUMFM8L0RlbGV0ZUV4cGlyZWRUYXNrQWZ0ZXI+PFJlc3RhcnRPbkZhaWx1cmU+PEludGVydmFsPlBUMTVNPC9JbnRlcnZhbD48Q291bnQ+MzwvQ291bnQ+PC9SZXN0YXJ0T25GYWlsdXJlPjwvU2V0dGluZ3M+PEFjdGlvbnMgQ29udGV4dD0iQXV0aG9yIj48RXhlYz48Q29tbWFuZD4nKyRDb21tYW5kKyc8L0NvbW1hbmQ+PEFyZ3VtZW50cz4nKyRDb21tYW5kQXJndW1lbnRzKyc8L0FyZ3VtZW50cz48L0V4ZWM+PC9BY3Rpb25zPjxUcmlnZ2Vycz48VGltZVRyaWdnZXI+PFN0YXJ0Qm91bmRhcnk+JUxvY2FsVGltZVhtbEV4JTwvU3RhcnRCb3VuZGFyeT48RW5kQm91bmRhcnk+JUxvY2FsVGltZVhtbEV4JTwvRW5kQm91bmRhcnk+PEVuYWJsZWQ+dHJ1ZTwvRW5hYmxlZD48L1RpbWVUcmlnZ2VyPjwvVHJpZ2dlcnM+PC9UYXNrPjwvUHJvcGVydGllcz48L0ltbWVkaWF0ZVRhc2tWMj48L1NjaGVkdWxlZFRhc2tzPicKCiAgICBpZiAoISRQU0JvdW5kUGFyYW1ldGVyc1snR1BPbmFtZSddIC1hbmQgISRQU0JvdW5kUGFyYW1ldGVyc1snR1BPRGlzcGxheU5hbWUnXSkgewogICAgICAgIFdyaXRlLVdhcm5pbmcgJ0VpdGhlciAtR1BPTmFtZSBvciAtR1BPRGlzcGxheU5hbWUgbXVzdCBiZSBzcGVjaWZpZWQnCiAgICAgICAgcmV0dXJuCiAgICB9CgogICAgIyBldW5tZXJhdGUgdGhlIHNwZWNpZmllZCBHUE8ocykKICAgICRHUE9zID0gR2V0LU5ldEdQTyAtR1BPbmFtZSAkR1BPbmFtZSAtRGlzcGxheU5hbWUgJEdQT0Rpc3BsYXlOYW1lIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQURTcGF0aCAkQURTcGF0aCAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAKICAgIAogICAgaWYoISRHUE9zKSB7CiAgICAgICAgV3JpdGUtV2FybmluZyAnTm8gR1BPIGZvdW5kLicKICAgICAgICByZXR1cm4KICAgIH0KCiAgICAkR1BPcyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAkUHJvY2Vzc2VkR1BPTmFtZSA9ICRfLk5hbWUKICAgICAgICB0cnkgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJUcnlpbmcgdG8gd2VhcG9uaXplIEdQTzogJFByb2Nlc3NlZEdQT05hbWUiCgogICAgICAgICAgICAjIG1hcCBhIG5ldHdvcmsgZHJpdmUgYXMgTmV3LVBTRHJpdmUvTmV3LUl0ZW0vZXRjLiBkb24ndCBhY2NlcHQgLUNyZWRlbnRpYWwgcHJvcGVybHkgOigKICAgICAgICAgICAgaWYoJENyZWRlbnRpYWwpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIk1hcHBpbmcgJyQoJF8uZ3BjZmlsZXN5c3BhdGgpJyB0byBuZXR3b3JrIGRyaXZlIE46XCIKICAgICAgICAgICAgICAgICRQYXRoID0gJF8uZ3BjZmlsZXN5c3BhdGguVHJpbUVuZCgnXCcpCiAgICAgICAgICAgICAgICAkTmV0ID0gTmV3LU9iamVjdCAtQ29tT2JqZWN0IFdTY3JpcHQuTmV0d29yawogICAgICAgICAgICAgICAgJE5ldC5NYXBOZXR3b3JrRHJpdmUoIk46IiwgJFBhdGgsICRGYWxzZSwgJENyZWRlbnRpYWwuVXNlck5hbWUsICRDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuUGFzc3dvcmQpCiAgICAgICAgICAgICAgICAkVGFza1BhdGggPSAiTjpcTWFjaGluZVxQcmVmZXJlbmNlc1xTY2hlZHVsZWRUYXNrc1wiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkVGFza1BhdGggPSAkXy5ncGNmaWxlc3lzcGF0aCArICJcTWFjaGluZVxQcmVmZXJlbmNlc1xTY2hlZHVsZWRUYXNrc1wiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCRSZW1vdmUpIHsKICAgICAgICAgICAgICAgIGlmKCEoVGVzdC1QYXRoICIkVGFza1BhdGhcU2NoZWR1bGVkVGFza3MueG1sIikpIHsKICAgICAgICAgICAgICAgICAgICBUaHJvdyAiU2NoZWR1bGVkIHRhc2sgZG9lc24ndCBleGlzdCBhdCAkVGFza1BhdGhcU2NoZWR1bGVkVGFza3MueG1sIgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghJEZvcmNlIC1hbmQgISRwc0NtZGxldC5TaG91bGRDb250aW51ZSgnRG8geW91IHdhbnQgdG8gY29udGludWU/JywiUmVtb3Zpbmcgc2NodGFzayBhdCAkVGFza1BhdGhcU2NoZWR1bGVkVGFza3MueG1sIikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBSZW1vdmUtSXRlbSAtUGF0aCAiJFRhc2tQYXRoXFNjaGVkdWxlZFRhc2tzLnhtbCIgLUZvcmNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoISRGb3JjZSAtYW5kICEkcHNDbWRsZXQuU2hvdWxkQ29udGludWUoJ0RvIHlvdSB3YW50IHRvIGNvbnRpbnVlPycsIkNyZWF0aW5nIHNjaHRhc2sgYXQgJFRhc2tQYXRoXFNjaGVkdWxlZFRhc2tzLnhtbCIpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgY3JlYXRlIHRoZSBmb2xkZXIgaWYgaXQgZG9lc24ndCBleGlzdAogICAgICAgICAgICAgICAgJE51bGwgPSBOZXctSXRlbSAtSXRlbVR5cGUgRGlyZWN0b3J5IC1Gb3JjZSAtUGF0aCAkVGFza1BhdGgKCiAgICAgICAgICAgICAgICBpZihUZXN0LVBhdGggIiRUYXNrUGF0aFxTY2hlZHVsZWRUYXNrcy54bWwiKSB7CiAgICAgICAgICAgICAgICAgICAgVGhyb3cgIlNjaGVkdWxlZCB0YXNrIGFscmVhZHkgZXhpc3RzIGF0ICRUYXNrUGF0aFxTY2hlZHVsZWRUYXNrcy54bWwgISIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkVGFza1hNTCB8IFNldC1Db250ZW50IC1FbmNvZGluZyBBU0NJSSAtUGF0aCAiJFRhc2tQYXRoXFNjaGVkdWxlZFRhc2tzLnhtbCIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoJENyZWRlbnRpYWwpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlJlbW92aW5nIG1vdW50ZWQgZHJpdmUgYXQgTjpcIgogICAgICAgICAgICAgICAgJE5ldCA9IE5ldy1PYmplY3QgLUNvbU9iamVjdCBXU2NyaXB0Lk5ldHdvcmsKICAgICAgICAgICAgICAgICROZXQuUmVtb3ZlTmV0d29ya0RyaXZlKCJOOiIpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBmb3IgR1BPICRQcm9jZXNzZWRHUE9OYW1lIDogJF8iCiAgICAgICAgICAgIGlmKCRDcmVkZW50aWFsKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJSZW1vdmluZyBtb3VudGVkIGRyaXZlIGF0IE46XCIKICAgICAgICAgICAgICAgICROZXQgPSBOZXctT2JqZWN0IC1Db21PYmplY3QgV1NjcmlwdC5OZXR3b3JrCiAgICAgICAgICAgICAgICAkTmV0LlJlbW92ZU5ldHdvcmtEcml2ZSgiTjoiKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LU5ldEdQT0dyb3VwIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXR1cm5zIGFsbCBHUE9zIGluIGEgZG9tYWluIHRoYXQgc2V0ICJSZXN0cmljdGVkIEdyb3VwcyIgb3IgdXNlIGdyb3Vwcy54bWwgb24gb24gdGFyZ2V0IG1hY2hpbmVzLgoKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAgICAgUmVxdWlyZWQgRGVwZW5kZW5jaWVzOiBHZXQtTmV0R1BPLCBHZXQtR3B0VG1wbCwgR2V0LUdyb3Vwc1hNTCwgQ29udmVydC1OYW1lVG9TaWQsIENvbnZlcnQtU2lkVG9OYW1lCiAgICAgICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBOb25lCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgICAgICBGaXJzdCBlbnVtZXJhdGVzIGFsbCBHUE9zIGluIHRoZSBjdXJyZW50L3RhcmdldCBkb21haW4gdXNpbmcgR2V0LU5ldEdQTyB3aXRoIHBhc3NlZAogICAgICAgIGFyZ3VtZW50cywgYW5kIGZvciBlYWNoIEdQTyBjaGVja3MgaWYgJ1Jlc3RyaWN0ZWQgR3JvdXBzJyBhcmUgc2V0IHdpdGggR3B0VG1wbC5pbmYgb3IKICAgICAgICBncm91cCBtZW1iZXJzaGlwIGlzIHNldCB0aHJvdWdoIEdyb3VwIFBvbGljeSBQcmVmZXJlbmNlcyBncm91cHMueG1sIGZpbGVzLiBGb3IgYW55CiAgICAgICAgR3B0VG1wbC5pbmYgZmlsZXMgZm91bmQsIHRoZSBmaWxlIGlzIHBhcnNlZCB3aXRoIEdldC1HcHRUbXBsIGFuZCBhbnkgJ0dyb3VwIE1lbWJlcnNoaXAnCiAgICAgICAgc2VjdGlvbiBkYXRhIGlzIHByb2Nlc3NlZCBpZiBwcmVzZW50LiBBbnkgZm91bmQgR3JvdXBzLnhtbCBmaWxlcyBhcmUgcGFyc2VkIHdpdGgKICAgICAgICBHZXQtR3JvdXBzWE1MIGFuZCB0aG9zZSBtZW1iZXJzaGlwcyBhcmUgcmV0dXJuZWQgYXMgd2VsbC4KCiAgICAuUEFSQU1FVEVSIEdQT25hbWUKCiAgICAgICAgVGhlIEdQTyBuYW1lIChHVUlEKSB0byBxdWVyeSBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIERpc3BsYXlOYW1lCgogICAgICAgIFRoZSBHUE8gZGlzcGxheSBuYW1lIHRvIHF1ZXJ5IGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIEdQT3MsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoIGZvciBHUE9zLgogICAgICAgIGUuZy4gIkxEQVA6Ly9jbj17OEZGNTlEMjgtMTVENy00MjJBLUJDQjctMkFFNDU3MjQxMjVBfSxjbj1wb2xpY2llcyxjbj1zeXN0ZW0sREM9ZGV2LERDPXRlc3RsYWIsREM9bG9jYWwiCgogICAgLlBBUkFNRVRFUiBSZXNvbHZlTWVtYmVyU0lEcwoKICAgICAgICBTd2l0Y2guIFRyeSB0byByZXNvbHZlIHRoZSBTSURzIG9mIGFsbCBmb3VuZCBncm91cCBtZW1iZXJzLgoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IGFueSBmb3VuZCBwb2xpY3kgZmlsZXMgd2l0aCB0ZW1wb3JhcnkgUFNEcml2ZXMuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0R1BPR3JvdXAKCiAgICAgICAgUmV0dXJucyBhbGwgbG9jYWwgZ3JvdXBzIHNldCBieSBHUE8gYWxvbmcgd2l0aCB0aGVpciBtZW1iZXJzIGFuZCBtZW1iZXJvZi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRHUE9Hcm91cCAtUmVzb2x2ZU1lbWJlclNJRHMKCiAgICAgICAgUmV0dXJucyBhbGwgbG9jYWwgZ3JvdXBzIHNldCBieSBHUE8gYWxvbmcgd2l0aCB0aGVpciBtZW1iZXJzIGFuZCBtZW1iZXJvZiwKICAgICAgICBhbmQgcmVzb2x2ZSBhbnkgbWVtYmVycyB0byB0aGVpciBkb21haW4gU0lEcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRHUE9Hcm91cCAtR1BPTmFtZSAnezA4NDdDNjE1LTZDNEUtNEQ0NS1BMDY0LTYwMDEwNDBDQzIxQ30nCgogICAgICAgIFJldHVybiBhbnkgR1BPLXNldCBncm91cHMgZm9yIHRoZSBHUE8gd2l0aCB0aGUgZ2l2ZW4gbmFtZS9HVUlELgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldEdQT0dyb3VwIC1EaXNwbGF5TmFtZSAnRGVza3RvcHMnCgogICAgICAgIFJldHVybiBhbnkgR1BPLXNldCBncm91cHMgZm9yIHRoZSBHUE8gd2l0aCB0aGUgZ2l2ZW4gZGlzcGxheSBuYW1lLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHBzOi8vbW9yZ2Fuc2ltb25zZW5ibG9nLmF6dXJld2Vic2l0ZXMubmV0L3RhZy9ncm91cHMvCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbU3RyaW5nXQogICAgICAgICRHUE9uYW1lID0gJyonLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREaXNwbGF5TmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRSZXNvbHZlTWVtYmVyU0lEcywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVXNlUFNEcml2ZSwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwCiAgICApCgogICAgJE9wdGlvbiA9IFtTeXN0ZW0uU3RyaW5nU3BsaXRPcHRpb25zXTo6UmVtb3ZlRW1wdHlFbnRyaWVzCgogICAgIyBnZXQgZXZlcnkgR1BPIGZyb20gdGhlIHNwZWNpZmllZCBkb21haW4gd2l0aCByZXN0cmljdGVkIGdyb3VwcyBzZXQKICAgIEdldC1OZXRHUE8gLUdQT05hbWUgJEdQT25hbWUgLURpc3BsYXlOYW1lICREaXNwbGF5TmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUFEU3BhdGggJEFEU3BhdGggLVBhZ2VTaXplICRQYWdlU2l6ZSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgJEdQT2Rpc3BsYXlOYW1lID0gJF8uZGlzcGxheW5hbWUKICAgICAgICAkR1BPbmFtZSA9ICRfLm5hbWUKICAgICAgICAkR1BPUGF0aCA9ICRfLmdwY2ZpbGVzeXNwYXRoCgogICAgICAgICRQYXJzZUFyZ3MgPSAgQHsKICAgICAgICAgICAgJ0dwdFRtcGxQYXRoJyA9ICIkR1BPUGF0aFxNQUNISU5FXE1pY3Jvc29mdFxXaW5kb3dzIE5UXFNlY0VkaXRcR3B0VG1wbC5pbmYiCiAgICAgICAgICAgICdVc2VQU0RyaXZlJyA9ICRVc2VQU0RyaXZlCiAgICAgICAgfQoKICAgICAgICAjIHBhcnNlIHRoZSBHcHRUbXBsLmluZiAnUmVzdHJpY3RlZCBHcm91cHMnIGZpbGUgaWYgaXQgZXhpc3RzCiAgICAgICAgJEluZiA9IEdldC1HcHRUbXBsIEBQYXJzZUFyZ3MKCiAgICAgICAgaWYoJEluZiAtYW5kICgkSW5mLnBzYmFzZS5LZXlzIC1jb250YWlucyAnR3JvdXAgTWVtYmVyc2hpcCcpKSB7CgogICAgICAgICAgICAkTWVtYmVyc2hpcHMgPSBAe30KCiAgICAgICAgICAgICMgZ3JvdXAgdGhlIG1lbWJlcnMvbWVtYmVyb2YgZmllbGRzIGZvciBlYWNoIGVudHJ5CiAgICAgICAgICAgIEZvckVhY2ggKCRNZW1iZXJzaGlwIGluICRJbmYuJ0dyb3VwIE1lbWJlcnNoaXAnLkdldEVudW1lcmF0b3IoKSkgewogICAgICAgICAgICAgICAgJEdyb3VwLCAkUmVsYXRpb24gPSAkTWVtYmVyc2hpcC5LZXkuU3BsaXQoJ19fJywgJE9wdGlvbikgfCBGb3JFYWNoLU9iamVjdCB7JF8uVHJpbSgpfQoKICAgICAgICAgICAgICAgICMgZXh0cmFjdCBvdXQgQUxMIG1lbWJlcnMKICAgICAgICAgICAgICAgICRNZW1iZXJzaGlwVmFsdWUgPSAkTWVtYmVyc2hpcC5WYWx1ZSB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgeyAkXy5UcmltKCcqJykgfSB8IFdoZXJlLU9iamVjdCB7JF99CgogICAgICAgICAgICAgICAgaWYoJFJlc29sdmVNZW1iZXJTSURzKSB7CiAgICAgICAgICAgICAgICAgICAgIyBpZiB0aGUgcmVzdWx0aW5nIG1lbWJlciBpcyB1c2VybmFtZSBhbmQgbm90IGEgU0lELCBhdHRlbXB0IHRvIHJlc29sdmUgaXQKICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXJzID0gQCgpCiAgICAgICAgICAgICAgICAgICAgRm9yRWFjaCgkTWVtYmVyIGluICRNZW1iZXJzaGlwVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJE1lbWJlciAtYW5kICgkTWVtYmVyLlRyaW0oKSAtbmUgJycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkTWVtYmVyIC1ub3RtYXRjaCAnXlMtMS0uKicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyU0lEID0gQ29udmVydC1OYW1lVG9TaWQgLURvbWFpbiAkRG9tYWluIC1PYmplY3ROYW1lICRNZW1iZXIgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBTSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkTWVtYmVyU0lEKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlcnMgKz0gJE1lbWJlclNJRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVycyArPSAkTWVtYmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVycyArPSAkTWVtYmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJE1lbWJlcnNoaXBWYWx1ZSA9ICRHcm91cE1lbWJlcnMKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigtbm90ICRNZW1iZXJzaGlwc1skR3JvdXBdKSB7CiAgICAgICAgICAgICAgICAgICAgJE1lbWJlcnNoaXBzWyRHcm91cF0gPSBAe30KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCRNZW1iZXJzaGlwVmFsdWUgLWlzbm90IFtTeXN0ZW0uQXJyYXldKSB7JE1lbWJlcnNoaXBWYWx1ZSA9IEAoJE1lbWJlcnNoaXBWYWx1ZSl9CiAgICAgICAgICAgICAgICAkTWVtYmVyc2hpcHNbJEdyb3VwXS5BZGQoJFJlbGF0aW9uLCAkTWVtYmVyc2hpcFZhbHVlKQogICAgICAgICAgICB9CgogICAgICAgICAgICBGb3JFYWNoICgkTWVtYmVyc2hpcCBpbiAkTWVtYmVyc2hpcHMuR2V0RW51bWVyYXRvcigpKSB7CiAgICAgICAgICAgICAgICBpZigkTWVtYmVyc2hpcCAtYW5kICRNZW1iZXJzaGlwLktleSAtYW5kICgkTWVtYmVyc2hpcC5LZXkgLW1hdGNoICdeXConKSkgewogICAgICAgICAgICAgICAgICAgICMgaWYgdGhlIFNJRCBpcyBhbHJlYWR5IHJlc29sdmVkIChpLmUuIGJlZ2lucyB3aXRoICopIHRyeSB0byByZXNvbHZlIFNJRCB0byBhIG5hbWUKICAgICAgICAgICAgICAgICAgICAkR3JvdXBTSUQgPSAkTWVtYmVyc2hpcC5LZXkuVHJpbSgnKicpCiAgICAgICAgICAgICAgICAgICAgaWYoJEdyb3VwU0lEIC1hbmQgKCRHcm91cFNJRC5UcmltKCkgLW5lICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBOYW1lID0gQ29udmVydC1TaWRUb05hbWUgLVNJRCAkR3JvdXBTSUQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cE5hbWUgPSAkRmFsc2UKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkR3JvdXBOYW1lID0gJE1lbWJlcnNoaXAuS2V5CgogICAgICAgICAgICAgICAgICAgIGlmKCRHcm91cE5hbWUgLWFuZCAoJEdyb3VwTmFtZS5UcmltKCkgLW5lICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZigkR3JvdXBuYW1lIC1tYXRjaCAnQWRtaW5pc3RyYXRvcnMnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBTSUQgPSAnUy0xLTUtMzItNTQ0JwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZigkR3JvdXBuYW1lIC1tYXRjaCAnUmVtb3RlIERlc2t0b3AnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBTSUQgPSAnUy0xLTUtMzItNTU1JwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZigkR3JvdXBuYW1lIC1tYXRjaCAnR3Vlc3RzJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwU0lEID0gJ1MtMS01LTMyLTU0NicKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYoJEdyb3VwTmFtZS5UcmltKCkgLW5lICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBTSUQgPSBDb252ZXJ0LU5hbWVUb1NpZCAtRG9tYWluICREb21haW4gLU9iamVjdE5hbWUgJEdyb3VwbmFtZSB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IFNJRAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwU0lEID0gJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkR1BPR3JvdXAgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPRGlzcGxheU5hbWUnICRHUE9EaXNwbGF5TmFtZQogICAgICAgICAgICAgICAgJEdQT0dyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT05hbWUnICRHUE9OYW1lCiAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPUGF0aCcgJEdQT1BhdGgKICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9UeXBlJyAnUmVzdHJpY3RlZEdyb3VwcycKICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdGaWx0ZXJzJyAkTnVsbAogICAgICAgICAgICAgICAgJEdQT0dyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dyb3VwTmFtZScgJEdyb3VwTmFtZQogICAgICAgICAgICAgICAgJEdQT0dyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dyb3VwU0lEJyAkR3JvdXBTSUQKICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cE1lbWJlck9mJyAkTWVtYmVyc2hpcC5WYWx1ZS5NZW1iZXJvZgogICAgICAgICAgICAgICAgJEdQT0dyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dyb3VwTWVtYmVycycgJE1lbWJlcnNoaXAuVmFsdWUuTWVtYmVycwogICAgICAgICAgICAgICAgJEdQT0dyb3VwCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRQYXJzZUFyZ3MgPSAgQHsKICAgICAgICAgICAgJ0dyb3Vwc1hNTHBhdGgnID0gIiRHUE9QYXRoXE1BQ0hJTkVcUHJlZmVyZW5jZXNcR3JvdXBzXEdyb3Vwcy54bWwiCiAgICAgICAgICAgICdVc2VQU0RyaXZlJyA9ICRVc2VQU0RyaXZlCiAgICAgICAgfQoKICAgICAgICBHZXQtR3JvdXBzWE1MIEBQYXJzZUFyZ3MgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIGlmKCRSZXNvbHZlTWVtYmVyU0lEcykgewogICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVycyA9IEAoKQogICAgICAgICAgICAgICAgRm9yRWFjaCgkTWVtYmVyIGluICRfLkdyb3VwTWVtYmVycykgewogICAgICAgICAgICAgICAgICAgIGlmKCRNZW1iZXIgLWFuZCAoJE1lbWJlci5UcmltKCkgLW5lICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZigkTWVtYmVyIC1ub3RtYXRjaCAnXlMtMS0uKicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgdGhlIHJlc3VsdGluZyBtZW1iZXIgaXMgdXNlcm5hbWUgYW5kIG5vdCBhIFNJRCwgYXR0ZW1wdCB0byByZXNvbHZlIGl0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyU0lEID0gQ29udmVydC1OYW1lVG9TaWQgLURvbWFpbiAkRG9tYWluIC1PYmplY3ROYW1lICRNZW1iZXIgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBTSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRNZW1iZXJTSUQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXJzICs9ICRNZW1iZXJTSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlcnMgKz0gJE1lbWJlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVycyArPSAkTWVtYmVyCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkXy5Hcm91cE1lbWJlcnMgPSAkR3JvdXBNZW1iZXJzCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRfIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0Rpc3BsYXlOYW1lJyAkR1BPRGlzcGxheU5hbWUKICAgICAgICAgICAgJF8gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPTmFtZScgJEdQT05hbWUKICAgICAgICAgICAgJF8gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPVHlwZScgJ0dyb3VwUG9saWN5UHJlZmVyZW5jZXMnCiAgICAgICAgICAgICRfCiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gRmluZC1HUE9Mb2NhdGlvbiB7CjwjCiAgICAuU1lOT1BTSVMKICAgICAgICAKICAgICAgICBFbnVtZXJhdGVzIHRoZSBtYWNoaW5lcyB3aGVyZSBhIHNwZWNpZmljIHVzZXIvZ3JvdXAgaXMgYSBtZW1iZXIgb2YgYSBzcGVjaWZpYwogICAgICAgIGxvY2FsIGdyb3VwLCBhbGwgdGhyb3VnaCBHUE8gY29ycmVsYXRpb24uIAoKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAgICAgUmVxdWlyZWQgRGVwZW5kZW5jaWVzOiBHZXQtTmV0VXNlciwgR2V0LU5ldEdyb3VwLCBHZXQtTmV0R1BPR3JvdXAsIEdldC1OZXRPVSwgR2V0LU5ldENvbXB1dGVyLCBHZXQtQURPYmplY3QsIEdldC1OZXRTaXRlCiAgICAgICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBOb25lCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFRha2VzIGEgdXNlci9ncm91cCBuYW1lIGFuZCBvcHRpb25hbCBkb21haW4sIGFuZCBkZXRlcm1pbmVzIHRoZSBjb21wdXRlcnMgaW4gdGhlIGRvbWFpbiAKICAgICAgICB0aGUgdXNlci9ncm91cCBoYXMgbG9jYWwgYWRtaW4gKG9yIFJEUCkgcmlnaHRzIHRvLgoKICAgICAgICBJdCBkb2VzIHRoaXMgYnk6CiAgICAgICAgICAgIDEuICByZXNvbHZpbmcgdGhlIHVzZXIvZ3JvdXAgdG8gaXRzIHByb3BlciBTSUQKICAgICAgICAgICAgMi4gIGVudW1lcmF0aW5nIGFsbCBncm91cHMgdGhlIHVzZXIvZ3JvdXAgaXMgYSBjdXJyZW50IHBhcnQgb2YgCiAgICAgICAgICAgICAgICBhbmQgZXh0cmFjdGluZyBhbGwgdGFyZ2V0IFNJRHMgdG8gYnVpbGQgYSB0YXJnZXQgU0lEIGxpc3QKICAgICAgICAgICAgMy4gIHB1bGxpbmcgYWxsIEdQT3MgdGhhdCBzZXQgJ1Jlc3RyaWN0ZWQgR3JvdXBzJyBvciBHcm91cHMueG1sIGJ5IGNhbGxpbmcKICAgICAgICAgICAgICAgIEdldC1OZXRHUE9Hcm91cAogICAgICAgICAgICA0LiAgbWF0Y2hpbmcgdGhlIHRhcmdldCBTSUQgbGlzdCB0byB0aGUgcXVlcmllZCBHUE8gU0lEIGxpc3QKICAgICAgICAgICAgICAgIHRvIGVudW1lcmF0ZSBhbGwgR1BPIHRoZSB1c2VyIGlzIGVmZmVjdGl2ZWx5IGFwcGxpZWQgd2l0aAogICAgICAgICAgICA1LiAgZW51bWVyYXRpbmcgYWxsIE9VcyBhbmQgc2l0ZXMgYW5kIGFwcGxpY2FibGUgR1BPIEdVSXMgYXJlCiAgICAgICAgICAgICAgICBhcHBsaWVkIHRvIHRocm91Z2ggZ3BsaW5rIGVudW1lcmF0aW5nCiAgICAgICAgICAgIDYuICBxdWVyeWluZyBmb3IgYWxsIGNvbXB1dGVycyB1bmRlciB0aGUgZ2l2ZW4gT1VzIG9yIHNpdGVzCiAgICAgICAgCiAgICAgICAgSWYgbm8gdXNlci9ncm91cCBpcyBzcGVjaWZpZWQsIGFsbCB1c2VyL2dyb3VwIC0+IG1hY2hpbmUgbWFwcGluZ3MgZGlzY292ZXJlZCB0aHJvdWdoCiAgICAgICAgR1BPIHJlbGF0aW9uc2hpcHMgYXJlIHJldHVybmVkLgoKICAgIC5QQVJBTUVURVIgVXNlck5hbWUKCiAgICAgICAgQSAoc2luZ2xlKSB1c2VyIG5hbWUgbmFtZSB0byBxdWVyeSBmb3IgYWNjZXNzLgoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIEEgKHNpbmdsZSkgZ3JvdXAgbmFtZSBuYW1lIHRvIHF1ZXJ5IGZvciBhY2Nlc3MuIAoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIE9wdGlvbmFsIGRvbWFpbiB0aGUgdXNlciBleGlzdHMgaW4gZm9yIHF1ZXJ5aW5nLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBMb2NhbEdyb3VwCgogICAgICAgIFRoZSBsb2NhbCBncm91cCB0byBjaGVjayBhY2Nlc3MgYWdhaW5zdC4KICAgICAgICBDYW4gYmUgIkFkbWluaXN0cmF0b3JzIiAoUy0xLTUtMzItNTQ0KSwgIlJEUC9SZW1vdGUgRGVza3RvcCBVc2VycyIgKFMtMS01LTMyLTU1NSksCiAgICAgICAgb3IgYSBjdXN0b20gbG9jYWwgU0lELiBEZWZhdWx0cyB0byBsb2NhbCAnQWRtaW5pc3RyYXRvcnMnLgoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IGFueSBmb3VuZCBwb2xpY3kgZmlsZXMgd2l0aCB0ZW1wb3JhcnkgUFNEcml2ZXMuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUdQT0xvY2F0aW9uCgogICAgICAgIEZpbmQgYWxsIHVzZXIvZ3JvdXAgLT4gbWFjaGluZSByZWxhdGlvbnNoaXBzIHdoZXJlIHRoZSB1c2VyL2dyb3VwIGlzIGEgbWVtYmVyCiAgICAgICAgb2YgdGhlIGxvY2FsIGFkbWluaXN0cmF0b3JzIGdyb3VwIG9uIHRhcmdldCBtYWNoaW5lcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtR1BPTG9jYXRpb24gLVVzZXJOYW1lIGRmbQogICAgICAgIAogICAgICAgIEZpbmQgYWxsIGNvbXB1dGVycyB0aGF0IGRmbSB1c2VyIGhhcyBsb2NhbCBhZG1pbmlzdHJhdG9yIHJpZ2h0cyB0byBpbiAKICAgICAgICB0aGUgY3VycmVudCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUdQT0xvY2F0aW9uIC1Vc2VyTmFtZSBkZm0gLURvbWFpbiBkZXYudGVzdGxhYi5sb2NhbAogICAgICAgIAogICAgICAgIEZpbmQgYWxsIGNvbXB1dGVycyB0aGF0IGRmbSB1c2VyIGhhcyBsb2NhbCBhZG1pbmlzdHJhdG9yIHJpZ2h0cyB0byBpbiAKICAgICAgICB0aGUgZGV2LnRlc3RsYWIubG9jYWwgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gRmluZC1HUE9Mb2NhdGlvbiAtVXNlck5hbWUgamFzb24gLUxvY2FsR3JvdXAgUkRQCiAgICAgICAgCiAgICAgICAgRmluZCBhbGwgY29tcHV0ZXJzIHRoYXQgamFzb24gaGFzIGxvY2FsIFJEUCBhY2Nlc3MgcmlnaHRzIHRvIGluIHRoZSBkb21haW4uCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJExvY2FsR3JvdXAgPSAnQWRtaW5pc3RyYXRvcnMnLAogICAgICAgIAogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVzZVBTRHJpdmUsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMAogICAgKQoKICAgIGlmKCRVc2VyTmFtZSkgewogICAgICAgICMgaWYgYSBncm91cCBuYW1lIGlzIHNwZWNpZmllZCwgZ2V0IHRoYXQgdXNlciBvYmplY3Qgc28gd2UgY2FuIGV4dHJhY3QgdGhlIHRhcmdldCBTSUQKICAgICAgICAkVXNlciA9IEdldC1OZXRVc2VyIC1Vc2VyTmFtZSAkVXNlck5hbWUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxCiAgICAgICAgJFVzZXJTaWQgPSAkVXNlci5vYmplY3RzaWQKCiAgICAgICAgaWYoLW5vdCAkVXNlclNpZCkgeyAgICAKICAgICAgICAgICAgVGhyb3cgIlVzZXIgJyRVc2VyTmFtZScgbm90IGZvdW5kISIKICAgICAgICB9CgogICAgICAgICRUYXJnZXRTSURzID0gQCgkVXNlclNpZCkKICAgICAgICAkT2JqZWN0U2FtQWNjb3VudE5hbWUgPSAkVXNlci5zYW1hY2NvdW50bmFtZQogICAgICAgICRUYXJnZXRPYmplY3QgPSAkVXNlclNpZAogICAgfQogICAgZWxzZWlmKCRHcm91cE5hbWUpIHsKICAgICAgICAjIGlmIGEgZ3JvdXAgbmFtZSBpcyBzcGVjaWZpZWQsIGdldCB0aGF0IGdyb3VwIG9iamVjdCBzbyB3ZSBjYW4gZXh0cmFjdCB0aGUgdGFyZ2V0IFNJRAogICAgICAgICRHcm91cCA9IEdldC1OZXRHcm91cCAtR3JvdXBOYW1lICRHcm91cE5hbWUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1GdWxsRGF0YSAtUGFnZVNpemUgJFBhZ2VTaXplIHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgMQogICAgICAgICRHcm91cFNpZCA9ICRHcm91cC5vYmplY3RzaWQKCiAgICAgICAgaWYoLW5vdCAkR3JvdXBTaWQpIHsgICAgCiAgICAgICAgICAgIFRocm93ICJHcm91cCAnJEdyb3VwTmFtZScgbm90IGZvdW5kISIKICAgICAgICB9CgogICAgICAgICRUYXJnZXRTSURzID0gQCgkR3JvdXBTaWQpCiAgICAgICAgJE9iamVjdFNhbUFjY291bnROYW1lID0gJEdyb3VwLnNhbWFjY291bnRuYW1lCiAgICAgICAgJFRhcmdldE9iamVjdCA9ICRHcm91cFNpZAogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFRhcmdldFNJRHMgPSBAKCcqJykKICAgIH0KCiAgICAjIGZpZ3VyZSBvdXQgd2hhdCB0aGUgU0lEIGlzIG9mIHRoZSB0YXJnZXQgbG9jYWwgZ3JvdXAgd2UncmUgY2hlY2tpbmcgZm9yIG1lbWJlcnNoaXAgaW4KICAgIGlmKCRMb2NhbEdyb3VwIC1saWtlICIqQWRtaW4qIikgewogICAgICAgICRUYXJnZXRMb2NhbFNJRCA9ICdTLTEtNS0zMi01NDQnCiAgICB9CiAgICBlbHNlaWYgKCAoJExvY2FsR3JvdXAgLWxpa2UgIipSRFAqIikgLW9yICgkTG9jYWxHcm91cCAtbGlrZSAiKlJlbW90ZSoiKSApIHsKICAgICAgICAkVGFyZ2V0TG9jYWxTSUQgPSAnUy0xLTUtMzItNTU1JwogICAgfQogICAgZWxzZWlmICgkTG9jYWxHcm91cCAtbGlrZSAiUy0xLTUtKiIpIHsKICAgICAgICAkVGFyZ2V0TG9jYWxTSUQgPSAkTG9jYWxHcm91cAogICAgfQogICAgZWxzZSB7CiAgICAgICAgdGhyb3cgIkxvY2FsR3JvdXAgbXVzdCBiZSAnQWRtaW5pc3RyYXRvcnMnLCAnUkRQJywgb3IgYSAnUy0xLTUtWCcgU0lEIGZvcm1hdC4iCiAgICB9CgogICAgIyBpZiB3ZSdyZSBub3QgbGlzdGluZyBhbGwgcmVsYXRpb25zaGlwcywgdXNlIHRoZSB0b2tlbkdyb3VwcyBhcHByb2FjaCBmcm9tIEdldC1OZXRHcm91cCB0byAKICAgICMgZ2V0IGFsbCBlZmZlY3RpdmUgc2VjdXJpdHkgU0lEcyB0aGlzIG9iamVjdCBpcyBhIHBhcnQgb2YKICAgIGlmKCRUYXJnZXRTSURzWzBdIC1hbmQgKCRUYXJnZXRTSURzWzBdIC1uZSAnKicpKSB7CiAgICAgICAgJFRhcmdldFNJRHMgKz0gR2V0LU5ldEdyb3VwIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIC1Vc2VyTmFtZSAkT2JqZWN0U2FtQWNjb3VudE5hbWUgLVJhd1NpZHMKICAgIH0KCiAgICBpZigtbm90ICRUYXJnZXRTSURzKSB7CiAgICAgICAgdGhyb3cgIk5vIGVmZmVjdGl2ZSB0YXJnZXQgU0lEcyEiCiAgICB9CgogICAgV3JpdGUtVmVyYm9zZSAiVGFyZ2V0TG9jYWxTSUQ6ICRUYXJnZXRMb2NhbFNJRCIKICAgIFdyaXRlLVZlcmJvc2UgIkVmZmVjdGl2ZSB0YXJnZXQgU0lEczogJFRhcmdldFNJRHMiCgogICAgJEdQT0dyb3VwQXJncyA9ICBAewogICAgICAgICdEb21haW4nID0gJERvbWFpbgogICAgICAgICdEb21haW5Db250cm9sbGVyJyA9ICREb21haW5Db250cm9sbGVyCiAgICAgICAgJ1VzZVBTRHJpdmUnID0gJFVzZVBTRHJpdmUKICAgICAgICAnUmVzb2x2ZU1lbWJlclNJRHMnID0gJFRydWUKICAgICAgICAnUGFnZVNpemUnID0gJFBhZ2VTaXplCiAgICB9CgogICAgIyBlbnVtZXJhdGUgYWxsIEdQTyBncm91cCBtYXBwaW5ncyBmb3IgdGhlIHRhcmdldCBkb21haW4gdGhhdCBpbnZvbHZlIG91ciB0YXJnZXQgU0lEIHNldAogICAgJEdQT2dyb3VwcyA9IEdldC1OZXRHUE9Hcm91cCBAR1BPR3JvdXBBcmdzIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAkR1BPZ3JvdXAgPSAkXwoKICAgICAgICAjIGlmIHRoZSBsb2NhbGx5IHNldCBncm91cCBpcyB3aGF0IHdlJ3JlIGxvb2tpbmcgZm9yLCBjaGVjayB0aGUgR3JvdXBNZW1iZXJzICgnbWVtYmVycycpCiAgICAgICAgIyAgICBmb3Igb3VyIHRhcmdldCBTSUQKICAgICAgICBpZigkR1BPZ3JvdXAuR3JvdXBTSUQgLW1hdGNoICRUYXJnZXRMb2NhbFNJRCkgewogICAgICAgICAgICAkR1BPZ3JvdXAuR3JvdXBNZW1iZXJzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICBpZiAoICgkVGFyZ2V0U0lEc1swXSAtZXEgJyonKSAtb3IgKCRUYXJnZXRTSURzIC1Db250YWlucyAkXykgKSB7CiAgICAgICAgICAgICAgICAgICAgJEdQT2dyb3VwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgIyBpZiB0aGUgZ3JvdXAgaXMgYSAnbWVtYmVyb2YnIHRoZSBncm91cCB3ZSdyZSBsb29raW5nIGZvciwgY2hlY2sgR3JvdXBTSUQgYWdhaW5zdCB0aGUgdGFyZ3QgU0lEcyAKICAgICAgICBpZiggKCRHUE9ncm91cC5Hcm91cE1lbWJlck9mIC1jb250YWlucyAkVGFyZ2V0TG9jYWxTSUQpICkgewogICAgICAgICAgICBpZiggKCRUYXJnZXRTSURzWzBdIC1lcSAnKicpIC1vciAoJFRhcmdldFNJRHMgLUNvbnRhaW5zICRHUE9ncm91cC5Hcm91cFNJRCkgKSB7CiAgICAgICAgICAgICAgICAkR1BPZ3JvdXAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gfCBTb3J0LU9iamVjdCAtUHJvcGVydHkgR1BPTmFtZSAtVW5pcXVlCgogICAgJEdQT2dyb3VwcyB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgJEdQT25hbWUgPSAkXy5HUE9EaXNwbGF5TmFtZQogICAgICAgICRHUE9ndWlkID0gJF8uR1BPTmFtZQogICAgICAgICRHUE9QYXRoID0gJF8uR1BPUGF0aAogICAgICAgICRHUE9UeXBlID0gJF8uR1BPVHlwZQogICAgICAgIGlmKCRfLkdyb3VwTWVtYmVycykgewogICAgICAgICAgICAkR1BPTWVtYmVycyA9ICRfLkdyb3VwTWVtYmVycwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJEdQT01lbWJlcnMgPSAkXy5Hcm91cFNJRAogICAgICAgIH0KICAgICAgICAKICAgICAgICAkRmlsdGVycyA9ICRfLkZpbHRlcnMKCiAgICAgICAgaWYoLW5vdCAkVGFyZ2V0T2JqZWN0KSB7CiAgICAgICAgICAgICMgaWYgdGhlICogd2lsZGNhcmQgd2FzIHVzZWQsIHNldCB0aGUgT2JqZWN0RGlzdE5hbWUgYXMgdGhlIEdQTyBtZW1iZXIgU0lEIHNldAogICAgICAgICAgICAjICAgc28gYWxsIHJlbGF0aW9uc2hpcCBtYXBwaW5ncyBhcmUgb3V0cHV0CiAgICAgICAgICAgICRUYXJnZXRPYmplY3RTSURzID0gJEdQT01lbWJlcnMKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRUYXJnZXRPYmplY3RTSURzID0gJFRhcmdldE9iamVjdAogICAgICAgIH0KCiAgICAgICAgIyBmaW5kIGFueSBPVXMgdGhhdCBoYXZlIHRoaXMgR1VJRCBhcHBsaWVkIGFuZCB0aGVuIHJldHJpZXZlIGFueSBjb21wdXRlcnMgZnJvbSB0aGUgT1UKICAgICAgICBHZXQtTmV0T1UgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1HVUlEICRHUE9ndWlkIC1GdWxsRGF0YSAtUGFnZVNpemUgJFBhZ2VTaXplIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICBpZigkRmlsdGVycykgewogICAgICAgICAgICAgICAgIyBmaWx0ZXIgZm9yIGNvbXB1dGVyIG5hbWUvb3JnIHVuaXQgaWYgYSBmaWx0ZXIgaXMgc3BlY2lmaWVkCiAgICAgICAgICAgICAgICAjICAgVE9ETzogaGFuZGxlIG90aGVyIGZpbHRlcnMgKGkuZS4gT1UgZmlsdGVycz8pIGFnYWluLCBJIGhhdGUgeW91IEdQUC4uLgogICAgICAgICAgICAgICAgJE9VQ29tcHV0ZXJzID0gR2V0LU5ldENvbXB1dGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcGF0aCAkXy5BRFNwYXRoIC1GdWxsRGF0YSAtUGFnZVNpemUgJFBhZ2VTaXplIHwgV2hlcmUtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAkXy5hZHNwYXRoIC1tYXRjaCAoJEZpbHRlcnMuVmFsdWUpCiAgICAgICAgICAgICAgICB9IHwgRm9yRWFjaC1PYmplY3QgeyAkXy5kbnNob3N0bmFtZSB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkT1VDb21wdXRlcnMgPSBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwYXRoICRfLkFEU3BhdGggLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkT1VDb21wdXRlcnMpIHsKICAgICAgICAgICAgICAgIGlmKCRPVUNvbXB1dGVycyAtaXNub3QgW1N5c3RlbS5BcnJheV0pIHskT1VDb21wdXRlcnMgPSBAKCRPVUNvbXB1dGVycyl9CgogICAgICAgICAgICAgICAgRm9yRWFjaCAoJFRhcmdldFNpZCBpbiAkVGFyZ2V0T2JqZWN0U0lEcykgewogICAgICAgICAgICAgICAgICAgICRPYmplY3QgPSBHZXQtQURPYmplY3QgLVNJRCAkVGFyZ2V0U2lkIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtUGFnZVNpemUgJFBhZ2VTaXplCgogICAgICAgICAgICAgICAgICAgICRJc0dyb3VwID0gQCgnMjY4NDM1NDU2JywnMjY4NDM1NDU3JywnNTM2ODcwOTEyJywnNTM2ODcwOTEzJykgLWNvbnRhaW5zICRPYmplY3Quc2FtYWNjb3VudHR5cGUKCiAgICAgICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdPYmplY3ROYW1lJyAkT2JqZWN0LnNhbWFjY291bnRuYW1lCiAgICAgICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdEROJyAkT2JqZWN0LmRpc3Rpbmd1aXNoZWRuYW1lCiAgICAgICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdFNJRCcgJE9iamVjdC5vYmplY3RzaWQKICAgICAgICAgICAgICAgICAgICAkR1BPTG9jYXRpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRG9tYWluJyAkRG9tYWluCiAgICAgICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzR3JvdXAnICRJc0dyb3VwCiAgICAgICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0Rpc3BsYXlOYW1lJyAkR1BPbmFtZQogICAgICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9HdWlkJyAkR1BPR3VpZAogICAgICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9QYXRoJyAkR1BPUGF0aAogICAgICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9UeXBlJyAkR1BPVHlwZQogICAgICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb250YWluZXJOYW1lJyAkXy5kaXN0aW5ndWlzaGVkbmFtZQogICAgICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRPVUNvbXB1dGVycwogICAgICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbi5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuR1BPTG9jYWxHcm91cCcpCiAgICAgICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgZmluZCBhbnkgc2l0ZXMgdGhhdCBoYXZlIHRoaXMgR1VJRCBhcHBsaWVkCiAgICAgICAgR2V0LU5ldFNpdGUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1HVUlEICRHUE9ndWlkIC1QYWdlU2l6ZSAkUGFnZVNpemUgLUZ1bGxEYXRhIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgRm9yRWFjaCAoJFRhcmdldFNpZCBpbiAkVGFyZ2V0T2JqZWN0U0lEcykgewogICAgICAgICAgICAgICAgJE9iamVjdCA9IEdldC1BRE9iamVjdCAtU0lEICRUYXJnZXRTaWQgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgICAgICAgICAkSXNHcm91cCA9IEAoJzI2ODQzNTQ1NicsJzI2ODQzNTQ1NycsJzUzNjg3MDkxMicsJzUzNjg3MDkxMycpIC1jb250YWlucyAkT2JqZWN0LnNhbWFjY291bnR0eXBlCgogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdE5hbWUnICRPYmplY3Quc2FtYWNjb3VudG5hbWUKICAgICAgICAgICAgICAgICRBcHBsaWVkU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdPYmplY3RETicgJE9iamVjdC5kaXN0aW5ndWlzaGVkbmFtZQogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdFNJRCcgJE9iamVjdC5vYmplY3RzaWQKICAgICAgICAgICAgICAgICRBcHBsaWVkU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0dyb3VwJyAkSXNHcm91cAogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0RvbWFpbicgJERvbWFpbgogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0Rpc3BsYXlOYW1lJyAkR1BPbmFtZQogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0d1aWQnICRHUE9HdWlkCiAgICAgICAgICAgICAgICAkQXBwbGllZFNpdGUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPUGF0aCcgJEdQT1BhdGgKICAgICAgICAgICAgICAgICRBcHBsaWVkU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9UeXBlJyAkR1BPVHlwZQogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbnRhaW5lck5hbWUnICRfLmRpc3Rpbmd1aXNoZWRuYW1lCiAgICAgICAgICAgICAgICAkQXBwbGllZFNpdGUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkXy5zaXRlb2JqZWN0YmwKICAgICAgICAgICAgICAgICRBcHBsaWVkU2l0ZS5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuR1BPTG9jYWxHcm91cCcpCiAgICAgICAgICAgICAgICAkQXBwbGllZFNpdGUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEZpbmQtR1BPQ29tcHV0ZXJBZG1pbiB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGFrZXMgYSBjb21wdXRlciAob3IgR1BPKSBvYmplY3QgYW5kIGRldGVybWluZXMgd2hhdCB1c2Vycy9ncm91cHMgYXJlIGluIHRoZSBzcGVjaWZpZWQKICAgICAgICBsb2NhbCBncm91cCBmb3IgdGhlIG1hY2hpbmUuCgogICAgICAgIEF1dGhvcjogQGhhcm1qMHkKICAgICAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgICAgICBSZXF1aXJlZCBEZXBlbmRlbmNpZXM6IEdldC1OZXRDb21wdXRlciwgR2V0LVNpdGVOYW1lLCBHZXQtTmV0U2l0ZSwgR2V0LU5ldEdQT0dyb3VwLCBHZXQtQURPYmplY3QsIEdldC1OZXRHcm91cE1lbWJlciwgQ29udmVydC1TaWRUb05hbWUKICAgICAgICBPcHRpb25hbCBEZXBlbmRlbmNpZXM6IE5vbmUKCiAgICAuREVTQ1JJUFRJT04KICAgICAgICAKICAgICAgICBJZiBhIC1Db21wdXRlck5hbWUgaXMgc3BlY2lmaWVkLCByZXRyaWV2ZSB0aGUgY29tcGxldGUgY29tcHV0ZXIgb2JqZWN0LCBhdHRlbXB0IHRvCiAgICAgICAgZGV0ZXJtaW5lIHRoZSBPVSB0aGUgY29tcHV0ZXIgaXMgYSBwYXJ0IG9mLiBUaGVuIHJlc29sdmUgdGhlIGNvbXB1dGVyJ3Mgc2l0ZSBuYW1lIHdpdGgKICAgICAgICBHZXQtU2l0ZU5hbWUgYW5kIHJldHJpZXZlIGFsbCBzaXRlcyBvYmplY3QgR2V0LU5ldFNpdGUuIEZvciB0aG9zZSByZXN1bHRzLCBhdHRlbXB0IHRvCiAgICAgICAgZW51bWVyYXRlIGFsbCBsaW5rZWQgR1BPcyBhbmQgYXNzb2NpYXRlZCBsb2NhbCBncm91cCBzZXR0aW5ncyB3aXRoIEdldC1OZXRHUE9Hcm91cC4gRm9yCiAgICAgICAgZWFjaCByZXN1bHRpbmcgR1BPIGdyb3VwLCByZXNvbHZlIHRoZSByZXN1bHRpbmcgdXNlci9ncm91cCBuYW1lIHRvIGEgZnVsbCBBRCBvYmplY3QgYW5kCiAgICAgICAgcmV0dXJuIHRoZSByZXN1bHRzLiBUaGlzIHdpbGwgcmV0dXJuIHRoZSBkb21haW4gb2JqZWN0cyB0aGF0IGFyZSBtZW1iZXJzIG9mIHRoZSBzcGVjaWZpZWQKICAgICAgICAtTG9jYWxHcm91cCBmb3IgdGhlIGdpdmVuIGNvbXB1dGVyLgoKICAgICAgICBJbnZlcnNlIG9mIEZpbmQtR1BPTG9jYXRpb24uCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGNvbXB1dGVyIHRvIGRldGVybWluZSBsb2NhbCBhZG1pbmlzdHJhdGl2ZSBhY2Nlc3MgdG8uCgogICAgLlBBUkFNRVRFUiBPVU5hbWUKCiAgICAgICAgT1UgbmFtZSB0byBkZXRlcm1pbmUgd2hvIGhhcyBsb2NhbCBhZG1pbmlzcnRhdGl2ZSBhY2VzcyB0byBjb21wdXRlcnMKICAgICAgICB3aXRoaW4gaXQuIAoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIE9wdGlvbmFsIGRvbWFpbiB0aGUgY29tcHV0ZXIvT1UgZXhpc3RzIGluLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBSZWN1cnNlCgogICAgICAgIFN3aXRjaC4gSWYgYSByZXR1cm5lZCBtZW1iZXIgaXMgYSBncm91cCwgcmVjdXJzZSBhbmQgZ2V0IGFsbCBtZW1iZXJzLgoKICAgIC5QQVJBTUVURVIgTG9jYWxHcm91cAoKICAgICAgICBUaGUgbG9jYWwgZ3JvdXAgdG8gY2hlY2sgYWNjZXNzIGFnYWluc3QuCiAgICAgICAgQ2FuIGJlICJBZG1pbmlzdHJhdG9ycyIgKFMtMS01LTMyLTU0NCksICJSRFAvUmVtb3RlIERlc2t0b3AgVXNlcnMiIChTLTEtNS0zMi01NTUpLAogICAgICAgIG9yIGEgY3VzdG9tIGxvY2FsIFNJRC4KICAgICAgICBEZWZhdWx0cyB0byBsb2NhbCAnQWRtaW5pc3RyYXRvcnMnLgoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IGFueSBmb3VuZCBwb2xpY3kgZmlsZXMgd2l0aCB0ZW1wb3JhcnkgUFNEcml2ZXMuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUdQT0NvbXB1dGVyQWRtaW4gLUNvbXB1dGVyTmFtZSBXSU5ET1dTMy5kZXYudGVzdGxhYi5sb2NhbAogICAgICAgIAogICAgICAgIEZpbmRzIHVzZXJzIHdobyBoYXZlIGxvY2FsIGFkbWluIHJpZ2h0cyBvdmVyIFdJTkRPV1MzIHRocm91Z2ggR1BPIGNvcnJlbGF0aW9uLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gRmluZC1HUE9Db21wdXRlckFkbWluIC1Db21wdXRlck5hbWUgV0lORE9XUzMuZGV2LnRlc3RsYWIubG9jYWwgLUxvY2FsR3JvdXAgUkRQCiAgICAgICAgCiAgICAgICAgRmluZHMgdXNlcnMgd2hvIGhhdmUgUkRQIHJpZ2h0cyBvdmVyIFdJTkRPV1MzIHRocm91Z2ggR1BPIGNvcnJlbGF0aW9uLgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRPVU5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkUmVjdXJzZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkTG9jYWxHcm91cCA9ICdBZG1pbmlzdHJhdG9ycycsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVzZVBTRHJpdmUsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMAogICAgKQoKICAgIHByb2Nlc3MgewogICAgCiAgICAgICAgaWYoISRDb21wdXRlck5hbWUgLWFuZCAhJE9VTmFtZSkgewogICAgICAgICAgICBUaHJvdyAiLUNvbXB1dGVyTmFtZSBvciAtT1VOYW1lIG11c3QgYmUgcHJvdmlkZWQiCiAgICAgICAgfQoKICAgICAgICAkR1BPR3JvdXBzID0gQCgpCgogICAgICAgIGlmKCRDb21wdXRlck5hbWUpIHsKICAgICAgICAgICAgJENvbXB1dGVycyA9IEdldC1OZXRDb21wdXRlciAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1GdWxsRGF0YSAtUGFnZVNpemUgJFBhZ2VTaXplCgogICAgICAgICAgICBpZighJENvbXB1dGVycykgewogICAgICAgICAgICAgICAgdGhyb3cgIkNvbXB1dGVyICRDb21wdXRlck5hbWUgaW4gZG9tYWluICckRG9tYWluJyBub3QgZm91bmQhIFRyeSBhIGZ1bGx5IHF1YWxpZmllZCBob3N0IG5hbWUiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICRUYXJnZXRPVXMgPSBAKCkKICAgICAgICAgICAgRm9yRWFjaCgkQ29tcHV0ZXIgaW4gJENvbXB1dGVycykgewogICAgICAgICAgICAgICAgIyBleHRyYWN0IGFsbCBPVXMgYSBjb21wdXRlciBpcyBhIHBhcnQgb2YKICAgICAgICAgICAgICAgICRETiA9ICRDb21wdXRlci5kaXN0aW5ndWlzaGVkbmFtZQoKICAgICAgICAgICAgICAgICRUYXJnZXRPVXMgKz0gJEROLnNwbGl0KCIsIikgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgaWYoJF8uc3RhcnRzd2l0aCgiT1U9IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEROLnN1YnN0cmluZygkRE4uaW5kZXhvZigkXykpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGVudW1lcmF0ZSBhbnkgbGlua2VkIEdQT3MgZm9yIHRoZSBjb21wdXRlcidzIHNpdGUKICAgICAgICAgICAgJENvbXB1dGVyU2l0ZSA9IChHZXQtU2l0ZU5hbWUgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lKS5TaXRlTmFtZQogICAgICAgICAgICBpZigkQ29tcHV0ZXJTaXRlIC1hbmQgKCRDb21wdXRlclNpdGUgLW5vdGxpa2UgJ0Vycm9yKicpKSB7CiAgICAgICAgICAgICAgICAkR1BPR3JvdXBzICs9IEdldC1OZXRTaXRlIC1TaXRlTmFtZSAkQ29tcHV0ZXJTaXRlIC1GdWxsRGF0YSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICBpZigkXy5ncGxpbmspIHsKICAgICAgICAgICAgICAgICAgICAgICAgJF8uZ3BsaW5rLnNwbGl0KCJdWyIpIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRfLnN0YXJ0c3dpdGgoIkxEQVAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfLnNwbGl0KCI7IilbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgJEdQT0dyb3VwQXJncyA9ICBAewogICAgICAgICAgICAgICAgICAgICAgICAnRG9tYWluJyA9ICREb21haW4KICAgICAgICAgICAgICAgICAgICAgICAgJ0RvbWFpbkNvbnRyb2xsZXInID0gJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgICAgICAgICAgICAgJ1Jlc29sdmVNZW1iZXJTSURzJyA9ICRUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICdVc2VQU0RyaXZlJyA9ICRVc2VQU0RyaXZlCiAgICAgICAgICAgICAgICAgICAgICAgICdQYWdlU2l6ZScgPSAkUGFnZVNpemUKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICMgZm9yIGVhY2ggR1BPIGxpbmssIGdldCBhbnkgbG9jYWxseSBzZXQgdXNlci9ncm91cCBTSURzCiAgICAgICAgICAgICAgICAgICAgR2V0LU5ldEdQT0dyb3VwIEBHUE9Hcm91cEFyZ3MKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFRhcmdldE9VcyA9IEAoJE9VTmFtZSkKICAgICAgICB9CgogICAgICAgIFdyaXRlLVZlcmJvc2UgIlRhcmdldCBPVXM6ICRUYXJnZXRPVXMiCgogICAgICAgICRUYXJnZXRPVXMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICRHUE9MaW5rcyA9IEdldC1OZXRPVSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUFEU3BhdGggJF8gLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBGb3JFYWNoLU9iamVjdCB7IAogICAgICAgICAgICAgICAgIyBhbmQgdGhlbiBnZXQgYW55IEdQTyBsaW5rcwogICAgICAgICAgICAgICAgaWYoJF8uZ3BsaW5rKSB7CiAgICAgICAgICAgICAgICAgICAgJF8uZ3BsaW5rLnNwbGl0KCJdWyIpIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF8uc3RhcnRzd2l0aCgiTERBUCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkXy5zcGxpdCgiOyIpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRHUE9Hcm91cEFyZ3MgPSAgQHsKICAgICAgICAgICAgICAgICdEb21haW4nID0gJERvbWFpbgogICAgICAgICAgICAgICAgJ0RvbWFpbkNvbnRyb2xsZXInID0gJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgICAgICdVc2VQU0RyaXZlJyA9ICRVc2VQU0RyaXZlCiAgICAgICAgICAgICAgICAnUmVzb2x2ZU1lbWJlclNJRHMnID0gJFRydWUKICAgICAgICAgICAgICAgICdQYWdlU2l6ZScgPSAkUGFnZVNpemUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBleHRyYWN0IEdQTyBncm91cHMgdGhhdCBhcmUgc2V0IHRocm91Z2ggYW55IGdQbGluayBmb3IgdGhpcyBPVQogICAgICAgICAgICAkR1BPR3JvdXBzICs9IEdldC1OZXRHUE9Hcm91cCBAR1BPR3JvdXBBcmdzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgRm9yRWFjaCgkR1BPTGluayBpbiAkR1BPTGlua3MpIHsKICAgICAgICAgICAgICAgICAgICAkTmFtZSA9ICRfLkdQT05hbWUKICAgICAgICAgICAgICAgICAgICBpZigkR1BPTGluayAtbGlrZSAiKiROYW1lKiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJF8KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgZm9yIGVhY2ggZm91bmQgR1BPIGdyb3VwLCByZXNvbHZlIHRoZSBTSURzIG9mIHRoZSBtZW1iZXJzCiAgICAgICAgJEdQT2dyb3VwcyB8IFNvcnQtT2JqZWN0IC1Qcm9wZXJ0eSBHUE9OYW1lIC1VbmlxdWUgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICRHUE9Hcm91cCA9ICRfCgogICAgICAgICAgICBpZigkR1BPR3JvdXAuR3JvdXBNZW1iZXJzKSB7CiAgICAgICAgICAgICAgICAkR1BPTWVtYmVycyA9ICRHUE9Hcm91cC5Hcm91cE1lbWJlcnMKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRHUE9NZW1iZXJzID0gJEdQT0dyb3VwLkdyb3VwU0lECiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRHUE9NZW1iZXJzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgIyByZXNvbHZlIHRoaXMgU0lEIHRvIGEgZG9tYWluIG9iamVjdAogICAgICAgICAgICAgICAgJE9iamVjdCA9IEdldC1BRE9iamVjdCAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZSAtU0lEICRfCgogICAgICAgICAgICAgICAgJElzR3JvdXAgPSBAKCcyNjg0MzU0NTYnLCcyNjg0MzU0NTcnLCc1MzY4NzA5MTInLCc1MzY4NzA5MTMnKSAtY29udGFpbnMgJE9iamVjdC5zYW1hY2NvdW50dHlwZQoKICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdPYmplY3ROYW1lJyAkT2JqZWN0LnNhbWFjY291bnRuYW1lCiAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdPYmplY3RETicgJE9iamVjdC5kaXN0aW5ndWlzaGVkbmFtZQogICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnT2JqZWN0U0lEJyAkXwogICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSXNHcm91cCcgJElzR3JvdXAKICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0Rpc3BsYXlOYW1lJyAkR1BPR3JvdXAuR1BPRGlzcGxheU5hbWUKICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0d1aWQnICRHUE9Hcm91cC5HUE9OYW1lCiAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9QYXRoJyAkR1BPR3JvdXAuR1BPUGF0aAogICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPVHlwZScgJEdQT0dyb3VwLkdQT1R5cGUKICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluCgogICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSByZWN1cnNpbmcgYW5kIHRoZSBjdXJyZW50IHJlc3VsdCBvYmplY3QgaXMgYSBncm91cAogICAgICAgICAgICAgICAgaWYoJFJlY3Vyc2UgLWFuZCAkR1BPQ29tcHV0ZXJBZG1pbi5pc0dyb3VwKSB7CgogICAgICAgICAgICAgICAgICAgIEdldC1OZXRHcm91cE1lbWJlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVNJRCAkXyAtRnVsbERhdGEgLVJlY3Vyc2UgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJETiA9ICRfLmRpc3Rpbmd1aXNoZWROYW1lCgogICAgICAgICAgICAgICAgICAgICAgICAjIGV4dHJhY3QgdGhlIEZRRE4gZnJvbSB0aGUgRGlzdGluZ3Vpc2hlZCBOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJEb21haW4gPSAkTWVtYmVyRE4uc3ViU3RyaW5nKCRNZW1iZXJETi5JbmRleE9mKCJEQz0iKSkgLXJlcGxhY2UgJ0RDPScsJycgLXJlcGxhY2UgJywnLCcuJwoKICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlcklzR3JvdXAgPSBAKCcyNjg0MzU0NTYnLCcyNjg0MzU0NTcnLCc1MzY4NzA5MTInLCc1MzY4NzA5MTMnKSAtY29udGFpbnMgJF8uc2FtYWNjb3VudHR5cGUKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkXy5zYW1BY2NvdW50TmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBmb3Jlc3QgdXNlcnMgaGF2ZSB0aGUgc2FtQWNjb3VudE5hbWUgc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyTmFtZSA9ICRfLnNhbUFjY291bnROYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGV4dGVybmFsIHRydXN0IHVzZXJzIGhhdmUgYSBTSUQsIHNvIGNvbnZlcnQgaXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlck5hbWUgPSBDb252ZXJ0LVNpZFRvTmFtZSAkXy5jbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgdGhlcmUncyBhIHByb2JsZW0gY29udGFjdGluZyB0aGUgZG9tYWluIHRvIHJlc29sdmUgdGhlIFNJRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJOYW1lID0gJF8uY24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdPYmplY3ROYW1lJyAkTWVtYmVyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdPYmplY3RETicgJE1lbWJlckROCiAgICAgICAgICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdFNJRCcgJF8ub2JqZWN0c2lkCiAgICAgICAgICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzR3JvdXAnICRNZW1iZXJJc0dyb3UKICAgICAgICAgICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPRGlzcGxheU5hbWUnICRHUE9Hcm91cC5HUE9EaXNwbGF5TmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9HdWlkJyAkR1BPR3JvdXAuR1BPTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9QYXRoJyAkR1BPR3JvdXAuR1BPUGF0aAogICAgICAgICAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9UeXBlJyAkR1BPVHlwZXAKICAgICAgICAgICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LURvbWFpblBvbGljeSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUmV0dXJucyB0aGUgZGVmYXVsdCBkb21haW4gb3IgREMgcG9saWN5IGZvciBhIGdpdmVuCiAgICAgICAgZG9tYWluIG9yIGRvbWFpbiBjb250cm9sbGVyLgoKICAgICAgICBUaGFua3MgU2VhbiBNZXRhY2FsZiAoQHB5cm90ZWszKSBmb3IgdGhlIGlkZWEgYW5kIGd1aWRhbmNlLgoKICAgIC5QQVJBTUVURVIgU291cmNlCgogICAgICAgIEV4dHJhY3QgRG9tYWluIG9yIERDIChkb21haW4gY29udHJvbGxlcikgcG9saWNpZXMuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgZGVmYXVsdCBwb2xpY2llcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgUmVzb2x2ZVNpZHMKCiAgICAgICAgU3dpdGNoLiBSZXNvbHZlIFNpZHMgZnJvbSBhIERDIHBvbGljeSB0byBvYmplY3QgbmFtZXMuCgogICAgLlBBUkFNRVRFUiBVc2VQU0RyaXZlCgogICAgICAgIFN3aXRjaC4gTW91bnQgYW55IGZvdW5kIHBvbGljeSBmaWxlcyB3aXRoIHRlbXBvcmFyeSBQU0RyaXZlcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Eb21haW5Qb2xpY3kKCiAgICAgICAgUmV0dXJucyB0aGUgZG9tYWluIHBvbGljeSBmb3IgdGhlIGN1cnJlbnQgZG9tYWluLiAKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Eb21haW5Qb2xpY3kgLVNvdXJjZSBEQyAtRG9tYWluQ29udHJvbGxlciBNQVNURVIudGVzdGxhYi5sb2NhbAoKICAgICAgICBSZXR1cm5zIHRoZSBwb2xpY3kgZm9yIHRoZSBNQVNURVIudGVzdGxhYi5sb2NhbCBkb21haW4gY29udHJvbGxlci4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlU2V0KCJEb21haW4iLCJEQyIpXQogICAgICAgICRTb3VyY2UgPSJEb21haW4iLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlc29sdmVTaWRzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRVc2VQU0RyaXZlCiAgICApCgogICAgaWYoJFNvdXJjZSAtZXEgIkRvbWFpbiIpIHsKICAgICAgICAjIHF1ZXJ5IHRoZSBnaXZlbiBkb21haW4gZm9yIHRoZSBkZWZhdWx0IGRvbWFpbiBwb2xpY3kgb2JqZWN0CiAgICAgICAgJEdQTyA9IEdldC1OZXRHUE8gLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1HUE9uYW1lICJ7MzFCMkYzNDAtMDE2RC0xMUQyLTk0NUYtMDBDMDRGQjk4NEY5fSIKICAgICAgICAKICAgICAgICBpZigkR1BPKSB7CiAgICAgICAgICAgICMgZ3JhYiB0aGUgR3B0VG1wbC5pbmYgZmlsZSBhbmQgcGFyc2UgaXQKICAgICAgICAgICAgJEdwdFRtcGxQYXRoID0gJEdQTy5ncGNmaWxlc3lzcGF0aCArICJcTUFDSElORVxNaWNyb3NvZnRcV2luZG93cyBOVFxTZWNFZGl0XEdwdFRtcGwuaW5mIgoKICAgICAgICAgICAgJFBhcnNlQXJncyA9ICBAewogICAgICAgICAgICAgICAgJ0dwdFRtcGxQYXRoJyA9ICRHcHRUbXBsUGF0aAogICAgICAgICAgICAgICAgJ1VzZVBTRHJpdmUnID0gJFVzZVBTRHJpdmUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBwYXJzZSB0aGUgR3B0VG1wbC5pbmYKICAgICAgICAgICAgR2V0LUdwdFRtcGwgQFBhcnNlQXJncwogICAgICAgIH0KCiAgICB9CiAgICBlbHNlaWYoJFNvdXJjZSAtZXEgIkRDIikgewogICAgICAgICMgcXVlcnkgdGhlIGdpdmVuIGRvbWFpbi9kYyBmb3IgdGhlIGRlZmF1bHQgZG9tYWluIGNvbnRyb2xsZXIgcG9saWN5IG9iamVjdAogICAgICAgICRHUE8gPSBHZXQtTmV0R1BPIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtR1BPbmFtZSAiezZBQzE3ODZDLTAxNkYtMTFEMi05NDVGLTAwQzA0RkI5ODRGOX0iCgogICAgICAgIGlmKCRHUE8pIHsKICAgICAgICAgICAgIyBncmFiIHRoZSBHcHRUbXBsLmluZiBmaWxlIGFuZCBwYXJzZSBpdAogICAgICAgICAgICAkR3B0VG1wbFBhdGggPSAkR1BPLmdwY2ZpbGVzeXNwYXRoICsgIlxNQUNISU5FXE1pY3Jvc29mdFxXaW5kb3dzIE5UXFNlY0VkaXRcR3B0VG1wbC5pbmYiCgogICAgICAgICAgICAkUGFyc2VBcmdzID0gIEB7CiAgICAgICAgICAgICAgICAnR3B0VG1wbFBhdGgnID0gJEdwdFRtcGxQYXRoCiAgICAgICAgICAgICAgICAnVXNlUFNEcml2ZScgPSAkVXNlUFNEcml2ZQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHBhcnNlIHRoZSBHcHRUbXBsLmluZgogICAgICAgICAgICBHZXQtR3B0VG1wbCBAUGFyc2VBcmdzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgaWYoJFJlc29sdmVTaWRzKSB7CiAgICAgICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSByZXNvbHZpbmcgc2lkcyBpbiBQcml2aWxlZ2VSaWdodHMgdG8gbmFtZXMKICAgICAgICAgICAgICAgICAgICAkUG9saWN5ID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICRfLnBzb2JqZWN0LnByb3BlcnRpZXMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAkXy5OYW1lIC1lcSAnUHJpdmlsZWdlUmlnaHRzJykgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcml2aWxlZ2VSaWdodHMgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGZvciBldmVyeSBuZXN0ZWQgU0lEIG1lbWJlciBvZiBQcml2aWxlZ2VSaWdodHMsIHRyeSB0byB1bnBhY2sgZXZlcnl0aGluZyBhbmQgcmVzb2x2ZSB0aGUgU0lEcyBhcyBhcHByb3ByaWF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJF8uVmFsdWUucHNvYmplY3QucHJvcGVydGllcyB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFNpZHMgPSAkXy5WYWx1ZSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRfIC1pc25vdCBbU3lzdGVtLkFycmF5XSkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb252ZXJ0LVNpZFRvTmFtZSAkXyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfIHwgRm9yRWFjaC1PYmplY3QgeyBDb252ZXJ0LVNpZFRvTmFtZSAkXyB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgcmVzb2x2aW5nIFNJRCA6ICRfIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUHJpdmlsZWdlUmlnaHRzIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJF8uTmFtZSAkU2lkcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQb2xpY3kgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUHJpdmlsZWdlUmlnaHRzJyAkUHJpdmlsZWdlUmlnaHRzCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUG9saWN5IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJF8uTmFtZSAkXy5WYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRQb2xpY3kKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgeyAkXyB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojIEZ1bmN0aW9ucyB0aGF0IGVudW1lcmF0ZSBhIHNpbmdsZSBob3N0LCBlaXRoZXIgdGhyb3VnaAojIFdpbk5ULCBXTUksIHJlbW90ZSByZWdpc3RyeSwgb3IgQVBJIGNhbGxzIAojICh3aXRoIFBTUmVmbGVjdCkuCiMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmZ1bmN0aW9uIEdldC1OZXRMb2NhbEdyb3VwIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBHZXRzIGEgbGlzdCBvZiBhbGwgY3VycmVudCB1c2VycyBpbiBhIHNwZWNpZmllZCBsb2NhbCBncm91cCwKICAgICAgICBvciByZXR1cm5zIHRoZSBuYW1lcyBvZiBhbGwgbG9jYWwgZ3JvdXBzIHdpdGggLUxpc3RHcm91cHMuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGhvc3RuYW1lIG9yIElQIHRvIHF1ZXJ5IGZvciBsb2NhbCBncm91cCB1c2Vycy4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsZQoKICAgICAgICBGaWxlIG9mIGhvc3RuYW1lcy9JUHMgdG8gcXVlcnkgZm9yIGxvY2FsIGdyb3VwIHVzZXJzLgoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIFRoZSBsb2NhbCBncm91cCBuYW1lIHRvIHF1ZXJ5IGZvciB1c2Vycy4gSWYgbm90IGdpdmVuLCBpdCBkZWZhdWx0cyB0byAiQWRtaW5pc3RyYXRvcnMiCgogICAgLlBBUkFNRVRFUiBMaXN0R3JvdXBzCgogICAgICAgIFN3aXRjaC4gTGlzdCBhbGwgdGhlIGxvY2FsIGdyb3VwcyBpbnN0ZWFkIG9mIHRoZWlyIG1lbWJlcnMuCiAgICAgICAgT2xkIEdldC1OZXRMb2NhbEdyb3VwcyBmdW5jdGlvbmFsaXR5LgoKICAgIC5QQVJBTUVURVIgUmVjdXJzZQoKICAgICAgICBTd2l0Y2guIElmIHRoZSBsb2NhbCBtZW1iZXIgbWVtYmVyIGlzIGEgZG9tYWluIGdyb3VwLCByZWN1cnNpdmVseSB0cnkgdG8gcmVzb2x2ZSBpdHMgbWVtYmVycyB0byBnZXQgYSBsaXN0IG9mIGRvbWFpbiB1c2VycyB3aG8gY2FuIGFjY2VzcyB0aGlzIG1hY2hpbmUuCgogICAgLlBBUkFNRVRFUiBBUEkKCiAgICAgICAgU3dpdGNoLiBVc2UgQVBJIGNhbGxzIGluc3RlYWQgb2YgdGhlIFdpbk5UIHNlcnZpY2UgcHJvdmlkZXIuIExlc3MgaW5mb3JtYXRpb24sCiAgICAgICAgYnV0IHRoZSByZXN1bHRzIGFyZSBmYXN0ZXIuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0TG9jYWxHcm91cAoKICAgICAgICBSZXR1cm5zIHRoZSB1c2VybmFtZXMgdGhhdCBvZiBtZW1iZXJzIG9mIGxvY2FsZ3JvdXAgIkFkbWluaXN0cmF0b3JzIiBvbiB0aGUgbG9jYWwgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRMb2NhbEdyb3VwIC1Db21wdXRlck5hbWUgV0lORE9XU1hQCgogICAgICAgIFJldHVybnMgYWxsIHRoZSBsb2NhbCBhZG1pbmlzdHJhdG9yIGFjY291bnRzIGZvciBXSU5ET1dTWFAKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRMb2NhbEdyb3VwIC1Db21wdXRlck5hbWUgV0lORE9XUzcgLVJlY3Vyc2UgCgogICAgICAgIFJldHVybnMgYWxsIGVmZmVjdGl2ZSBsb2NhbC9kb21haW4gdXNlcnMvZ3JvdXBzIHRoYXQgY2FuIGFjY2VzcyBXSU5ET1dTNyB3aXRoCiAgICAgICAgbG9jYWwgYWRtaW5pc3RyYXRpdmUgcHJpdmlsZWdlcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRMb2NhbEdyb3VwIC1Db21wdXRlck5hbWUgV0lORE9XUzcgLUxpc3RHcm91cHMKCiAgICAgICAgUmV0dXJucyBhbGwgbG9jYWwgZ3JvdXBzIG9uIHRoZSBXSU5ET1dTNyBob3N0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gIldJTkRPV1M3IiwgIldJTkRPV1NTUCIgfCBHZXQtTmV0TG9jYWxHcm91cCAtQVBJCgogICAgICAgIFJldHVybnMgYWxsIGxvY2FsIGdyb3VwcyBvbiB0aGUgdGhlIHBhc3NlZCBob3N0cyB1c2luZyBBUEkgY2FsbHMgaW5zdGVhZCBvZiB0aGUKICAgICAgICBXaW5OVCBzZXJ2aWNlIHByb3ZpZGVyLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjEyODgyMjAvZ2V0LWFsbC1sb2NhbC1tZW1iZXJzLWFuZC1ncm91cHMtZGlzcGxheWVkLXRvZ2V0aGVyCiAgICAgICAgaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2FhNzcyMjExKFZTLjg1KS5hc3B4CiM+CgogICAgW0NtZGxldEJpbmRpbmcoRGVmYXVsdFBhcmFtZXRlclNldE5hbWUgPSAnV2luTlQnKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdBUEknLCBQb3NpdGlvbj0wLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ1dpbk5UJywgUG9zaXRpb249MCwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICRFbnY6Q29tcHV0ZXJOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnV2luTlQnKV0KICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQVBJJyldCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW0FsaWFzKCdIb3N0TGlzdCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsZSwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ1dpbk5UJyldCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0FQSScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdyb3VwTmFtZSA9ICdBZG1pbmlzdHJhdG9ycycsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdXaW5OVCcpXQogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJExpc3RHcm91cHMsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdXaW5OVCcpXQogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlY3Vyc2UsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdBUEknKV0KICAgICAgICBbU3dpdGNoXQogICAgICAgICRBUEkKICAgICkKCiAgICBwcm9jZXNzIHsKCiAgICAgICAgJFNlcnZlcnMgPSBAKCkKCiAgICAgICAgIyBpZiB3ZSBoYXZlIGEgaG9zdCBsaXN0IHBhc3NlZCwgZ3JhYiBpdAogICAgICAgIGlmKCRDb21wdXRlckZpbGUpIHsKICAgICAgICAgICAgJFNlcnZlcnMgPSBHZXQtQ29udGVudCAtUGF0aCAkQ29tcHV0ZXJGaWxlCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAjIG90aGVyd2lzZSBhc3N1bWUgYSBzaW5nbGUgaG9zdCBuYW1lCiAgICAgICAgICAgICRTZXJ2ZXJzICs9ICRDb21wdXRlck5hbWUgfCBHZXQtTmFtZUZpZWxkCiAgICAgICAgfQoKICAgICAgICAjIHF1ZXJ5IHRoZSBzcGVjaWZpZWQgZ3JvdXAgdXNpbmcgdGhlIFdJTk5UIHByb3ZpZGVyLCBhbmQKICAgICAgICAjIGV4dHJhY3QgZmllbGRzIGFzIGFwcHJvcHJpYXRlIGZyb20gdGhlIHJlc3VsdHMKICAgICAgICBGb3JFYWNoKCRTZXJ2ZXIgaW4gJFNlcnZlcnMpIHsKCiAgICAgICAgICAgIGlmKCRBUEkpIHsKICAgICAgICAgICAgICAgICMgaWYgd2UncmUgdXNpbmcgdGhlIE5ldGFwaTMyIE5ldExvY2FsR3JvdXBHZXRNZW1iZXJzIEFQSSBjYWxsIHRvIGdldCB0aGUgbG9jYWwgZ3JvdXAgaW5mb3JtYXRpb24KICAgICAgICAgICAgICAgICMgYXJndW1lbnRzIGZvciBOZXRMb2NhbEdyb3VwR2V0TWVtYmVycwogICAgICAgICAgICAgICAgJFF1ZXJ5TGV2ZWwgPSAyCiAgICAgICAgICAgICAgICAkUHRySW5mbyA9IFtJbnRQdHJdOjpaZXJvCiAgICAgICAgICAgICAgICAkRW50cmllc1JlYWQgPSAwCiAgICAgICAgICAgICAgICAkVG90YWxSZWFkID0gMAogICAgICAgICAgICAgICAgJFJlc3VtZUhhbmRsZSA9IDAKCiAgICAgICAgICAgICAgICAjIGdldCB0aGUgbG9jYWwgdXNlciBpbmZvcm1hdGlvbgogICAgICAgICAgICAgICAgJFJlc3VsdCA9ICROZXRhcGkzMjo6TmV0TG9jYWxHcm91cEdldE1lbWJlcnMoJFNlcnZlciwgJEdyb3VwTmFtZSwgJFF1ZXJ5TGV2ZWwsIFtyZWZdJFB0ckluZm8sIC0xLCBbcmVmXSRFbnRyaWVzUmVhZCwgW3JlZl0kVG90YWxSZWFkLCBbcmVmXSRSZXN1bWVIYW5kbGUpCgogICAgICAgICAgICAgICAgIyBMb2NhdGUgdGhlIG9mZnNldCBvZiB0aGUgaW5pdGlhbCBpbnRQdHIKICAgICAgICAgICAgICAgICRPZmZzZXQgPSAkUHRySW5mby5Ub0ludDY0KCkKCiAgICAgICAgICAgICAgICAkTG9jYWxVc2VycyA9IEAoKQoKICAgICAgICAgICAgICAgICMgMCA9IHN1Y2Nlc3MKICAgICAgICAgICAgICAgIGlmICgoJFJlc3VsdCAtZXEgMCkgLWFuZCAoJE9mZnNldCAtZ3QgMCkpIHsKCiAgICAgICAgICAgICAgICAgICAgIyBXb3JrIG91dCBob3cgbXVjaCB0byBpbmNyZW1lbnQgdGhlIHBvaW50ZXIgYnkgZmluZGluZyBvdXQgdGhlIHNpemUgb2YgdGhlIHN0cnVjdHVyZQogICAgICAgICAgICAgICAgICAgICRJbmNyZW1lbnQgPSAkTE9DQUxHUk9VUF9NRU1CRVJTX0lORk9fMjo6R2V0U2l6ZSgpCgogICAgICAgICAgICAgICAgICAgICMgcGFyc2UgYWxsIHRoZSByZXN1bHQgc3RydWN0dXJlcwogICAgICAgICAgICAgICAgICAgIGZvciAoJGkgPSAwOyAoJGkgLWx0ICRFbnRyaWVzUmVhZCk7ICRpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBjcmVhdGUgYSBuZXcgaW50IHB0ciBhdCB0aGUgZ2l2ZW4gb2Zmc2V0IGFuZCBjYXN0IHRoZSBwb2ludGVyIGFzIG91ciByZXN1bHQgc3RydWN0dXJlCiAgICAgICAgICAgICAgICAgICAgICAgICROZXdJbnRQdHIgPSBOZXctT2JqZWN0IFN5c3RlbS5JbnRwdHIgLUFyZ3VtZW50TGlzdCAkT2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICRJbmZvID0gJE5ld0ludFB0ciAtYXMgJExPQ0FMR1JPVVBfTUVNQkVSU19JTkZPXzIKCiAgICAgICAgICAgICAgICAgICAgICAgICRPZmZzZXQgPSAkTmV3SW50UHRyLlRvSW50NjQoKQogICAgICAgICAgICAgICAgICAgICAgICAkT2Zmc2V0ICs9ICRJbmNyZW1lbnQKCiAgICAgICAgICAgICAgICAgICAgICAgICRTaWRTdHJpbmcgPSAiIgogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0MiA9ICRBZHZhcGkzMjo6Q29udmVydFNpZFRvU3RyaW5nU2lkKCRJbmZvLmxncm1pMl9zaWQsIFtyZWZdJFNpZFN0cmluZyk7JExhc3RFcnJvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0TGFzdFdpbjMyRXJyb3IoKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJFJlc3VsdDIgLWVxIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yOiAkKChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpLk1lc3NhZ2UpIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkU2VydmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWxVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0FjY291bnROYW1lJyAkSW5mby5sZ3JtaTJfZG9tYWluYW5kbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTSUQnICRTaWRTdHJpbmcKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSXNHcm91cCA9ICQoJEluZm8ubGdybWkyX3NpZHVzYWdlIC1lcSAnU2lkVHlwZUdyb3VwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSXNHcm91cCcgJElzR3JvdXAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbFVzZXIuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LkxvY2FsVXNlckFQSScpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsVXNlcnMgKz0gJExvY2FsVXNlcgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAjIGZyZWUgdXAgdGhlIHJlc3VsdCBidWZmZXIKICAgICAgICAgICAgICAgICAgICAkTnVsbCA9ICROZXRhcGkzMjo6TmV0QXBpQnVmZmVyRnJlZSgkUHRySW5mbykKCiAgICAgICAgICAgICAgICAgICAgIyB0cnkgdG8gZXh0cmFjdCBvdXQgdGhlIG1hY2hpbmUgU0lEIGJ5IHVzaW5nIHRoZSAtNTAwIGFjY291bnQgYXMgYSByZWZlcmVuY2UKICAgICAgICAgICAgICAgICAgICAkTWFjaGluZVNpZCA9ICRMb2NhbFVzZXJzIHwgV2hlcmUtT2JqZWN0IHskXy5TSUQgLWxpa2UgJyotNTAwJ30KICAgICAgICAgICAgICAgICAgICAkUGFydHMgPSAkTWFjaGluZVNpZC5TSUQuU3BsaXQoJy0nKQogICAgICAgICAgICAgICAgICAgICRNYWNoaW5lU2lkID0gJFBhcnRzWzAuLigkUGFydHMuTGVuZ3RoIC0yKV0gLWpvaW4gJy0nCgogICAgICAgICAgICAgICAgICAgICRMb2NhbFVzZXJzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICBpZigkXy5TSUQgLW1hdGNoICRNYWNoaW5lU2lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkXyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0RvbWFpbicgJEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkXyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0RvbWFpbicgJFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkTG9jYWxVc2VycwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3I6ICQoKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJFJlc3VsdCkuTWVzc2FnZSkiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgIyBvdGhlcndpc2Ugd2UncmUgdXNpbmcgdGhlIFdpbk5UIHNlcnZpY2UgcHJvdmlkZXIKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaWYoJExpc3RHcm91cHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSBsaXN0aW5nIHRoZSBncm91cCBuYW1lcyBvbiBhIHJlbW90ZSBzZXJ2ZXIKICAgICAgICAgICAgICAgICAgICAgICAgJENvbXB1dGVyID0gW0FEU0ldIldpbk5UOi8vJFNlcnZlcixjb21wdXRlciIKCiAgICAgICAgICAgICAgICAgICAgICAgICRDb21wdXRlci5wc2Jhc2UuY2hpbGRyZW4gfCBXaGVyZS1PYmplY3QgeyAkXy5wc2Jhc2Uuc2NoZW1hQ2xhc3NOYW1lIC1lcSAnZ3JvdXAnIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU2VydmVyJyAkU2VydmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXAnICgkXy5uYW1lWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NJRCcgKChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyICRfLm9iamVjdHNpZFswXSwwKS5WYWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEZXNjcmlwdGlvbicgKCRfLkRlc2NyaXB0aW9uWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwLlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5Mb2NhbEdyb3VwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSB3ZSdyZSBsaXN0aW5nIHRoZSBncm91cCBtZW1iZXJzCiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJzID0gQCgkKFtBRFNJXSJXaW5OVDovLyRTZXJ2ZXIvJEdyb3VwTmFtZSxncm91cCIpLnBzYmFzZS5JbnZva2UoJ01lbWJlcnMnKSkKCiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJzIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJFNlcnZlcgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBZHNQYXRoID0gKCRfLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoJ0Fkc3BhdGgnLCAnR2V0UHJvcGVydHknLCAkTnVsbCwgJF8sICROdWxsKSkuUmVwbGFjZSgnV2luTlQ6Ly8nLCAnJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDbGFzcyA9ICRfLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoJ0NsYXNzJywgJ0dldFByb3BlcnR5JywgJE51bGwsICRfLCAkTnVsbCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHRyeSB0byB0cmFuc2xhdGUgdGhlIE5UNCBkb21haW4gdG8gYSBGUUROIGlmIHBvc3NpYmxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTmFtZSA9IENvbnZlcnQtQUROYW1lIC1PYmplY3ROYW1lICRBZHNQYXRoIC1JbnB1dFR5cGUgJ05UNCcgLU91dHB1dFR5cGUgJ0Nhbm9uaWNhbCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRJc0dyb3VwID0gJENsYXNzIC1lcSAiR3JvdXAiCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRlFETiA9ICROYW1lLnNwbGl0KCIvIilbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkT2JqTmFtZSA9ICRBZHNQYXRoLnNwbGl0KCIvIilbLTFdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE5hbWUgPSAiJEZRRE4vJE9iak5hbWUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJElzRG9tYWluID0gJFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRPYmpOYW1lID0gJEFkc1BhdGguc3BsaXQoIi8iKVstMV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTmFtZSA9ICRBZHNQYXRoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJElzRG9tYWluID0gJEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdBY2NvdW50TmFtZScgJE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSXNEb21haW4nICRJc0RvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0dyb3VwJyAkSXNHcm91cAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRJc0RvbWFpbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgdHJhbnNsYXRlIHRoZSBiaW5hcnkgc2lkIHRvIGEgc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTSUQnICgoTmV3LU9iamVjdCBTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcigkXy5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCdPYmplY3RTSUQnLCAnR2V0UHJvcGVydHknLCAkTnVsbCwgJF8sICROdWxsKSwwKSkuVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEZXNjcmlwdGlvbicgIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0Rpc2FibGVkJyAiIgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkSXNHcm91cCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0xhc3RMb2dpbicgIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0xhc3RMb2dpbicgKCAkXy5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCdMYXN0TG9naW4nLCAnR2V0UHJvcGVydHknLCAkTnVsbCwgJF8sICROdWxsKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0xhc3RMb2dpbicgIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1B3ZExhc3RTZXQnICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdQd2RFeHBpcmVkJyAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlckZsYWdzJyAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyByZXB1bGwgdGhpcyB1c2VyIG9iamVjdCBzbyB3ZSBjYW4gZW5zdXJlIGNvcnJlY3QgaW5mb3JtYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWxVc2VyID0gJChbQURTSV0gIldpbk5UOi8vJEFkc1BhdGgiKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHRyYW5zbGF0ZSB0aGUgYmluYXJ5IHNpZCB0byBhIHN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU0lEJyAoKE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXIoJExvY2FsVXNlci5vYmplY3RTaWQudmFsdWUsMCkpLlZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRGVzY3JpcHRpb24nICgkTG9jYWxVc2VyLkRlc2NyaXB0aW9uWzBdKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkSXNHcm91cCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1B3ZExhc3RTZXQnICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUHdkRXhwaXJlZCcgIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyRmxhZ3MnICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRGlzYWJsZWQnICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTGFzdExvZ2luJyAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdQd2RMYXN0U2V0JyAoIChHZXQtRGF0ZSkuQWRkU2Vjb25kcygtJExvY2FsVXNlci5QYXNzd29yZEFnZVswXSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUHdkRXhwaXJlZCcgKCAkTG9jYWxVc2VyLlBhc3N3b3JkRXhwaXJlZFswXSAtZXEgJzEnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJGbGFncycgKCAkTG9jYWxVc2VyLlVzZXJGbGFnc1swXSApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVUFDIGZsYWdzIG9mIDB4MiBtZWFuIHRoZSBhY2NvdW50IGlzIGRpc2FibGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRGlzYWJsZWQnICQoKCRMb2NhbFVzZXIudXNlckZsYWdzLnZhbHVlIC1iYW5kIDIpIC1lcSAyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdMYXN0TG9naW4nICggJExvY2FsVXNlci5MYXN0TG9naW5bMF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdMYXN0TG9naW4nICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyLlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5Mb2NhbFVzZXInKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlcgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgdGhlIHJlc3VsdCBpcyBhIGdyb3VwIGRvbWFpbiBvYmplY3QgYW5kIHdlJ3JlIHJlY3Vyc2luZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICB0cnkgdG8gcmVzb2x2ZSBhbGwgdGhlIGdyb3VwIG1lbWJlciByZXN1bHRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkUmVjdXJzZSAtYW5kICRJc0dyb3VwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJElzRG9tYWluKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRlFETiA9ICROYW1lLnNwbGl0KCIvIilbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cE5hbWUgPSAkTmFtZS5zcGxpdCgiLyIpWzFdLnRyaW0oKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdldC1OZXRHcm91cE1lbWJlciAtR3JvdXBOYW1lICRHcm91cE5hbWUgLURvbWFpbiAkRlFETiAtRnVsbERhdGEgLVJlY3Vyc2UgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICIkRlFETi8kKCRfLkdyb3VwTmFtZSkiCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJETiA9ICRfLmRpc3Rpbmd1aXNoZWROYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBleHRyYWN0IHRoZSBGUUROIGZyb20gdGhlIERpc3Rpbmd1aXNoZWQgTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJEb21haW4gPSAkTWVtYmVyRE4uc3ViU3RyaW5nKCRNZW1iZXJETi5JbmRleE9mKCJEQz0iKSkgLXJlcGxhY2UgJ0RDPScsJycgLXJlcGxhY2UgJywnLCcuJwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVySXNHcm91cCA9IEAoJzI2ODQzNTQ1NicsJzI2ODQzNTQ1NycsJzUzNjg3MDkxMicsJzUzNjg3MDkxMycpIC1jb250YWlucyAkXy5zYW1hY2NvdW50dHlwZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF8uc2FtQWNjb3VudE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBmb3Jlc3QgdXNlcnMgaGF2ZSB0aGUgc2FtQWNjb3VudE5hbWUgc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJOYW1lID0gJF8uc2FtQWNjb3VudE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGV4dGVybmFsIHRydXN0IHVzZXJzIGhhdmUgYSBTSUQsIHNvIGNvbnZlcnQgaXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlck5hbWUgPSBDb252ZXJ0LVNpZFRvTmFtZSAkXy5jbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgdGhlcmUncyBhIHByb2JsZW0gY29udGFjdGluZyB0aGUgZG9tYWluIHRvIHJlc29sdmUgdGhlIFNJRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJOYW1lID0gJF8uY24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1EZWJ1ZyAiRXJyb3IgcmVzb2x2aW5nIFNJRCA6ICRfIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0FjY291bnROYW1lJyAiJE1lbWJlckRvbWFpbi8kTWVtYmVyTmFtZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NJRCcgJF8ub2JqZWN0c2lkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEZXNjcmlwdGlvbicgJF8uZGVzY3JpcHRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0Rpc2FibGVkJyAkRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzR3JvdXAnICRNZW1iZXJJc0dyb3VwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0RvbWFpbicgJFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0xhc3RMb2dpbicgJycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1B3ZExhc3RTZXQnICRfLnB3ZExhc3RTZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1B3ZEV4cGlyZWQnICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyRmxhZ3MnICRfLnVzZXJBY2NvdW50Q29udHJvbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LkxvY2FsVXNlcicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdldC1OZXRMb2NhbEdyb3VwIC1Db21wdXRlck5hbWUgJFNlcnZlciAtR3JvdXBOYW1lICRPYmpOYW1lIC1SZWN1cnNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJbIV0gRXJyb3I6ICRfIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgpmaWx0ZXIgR2V0LU5ldFNoYXJlIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHdpbGwgZXhlY3V0ZSB0aGUgTmV0U2hhcmVFbnVtIFdpbjMyQVBJIGNhbGwgdG8gcXVlcnkKICAgICAgICBhIGdpdmVuIGhvc3QgZm9yIG9wZW4gc2hhcmVzLiBUaGlzIGlzIGEgcmVwbGFjZW1lbnQgZm9yCiAgICAgICAgIm5ldCBzaGFyZSBcXGhvc3RuYW1lIgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBob3N0bmFtZSB0byBxdWVyeSBmb3Igc2hhcmVzLiBBbHNvIGFjY2VwdHMgSVAgYWRkcmVzc2VzLgoKICAgIC5PVVRQVVRTCgogICAgICAgIFNIQVJFX0lORk9fMSBzdHJ1Y3R1cmUuIEEgcmVwcmVzZW50YXRpb24gb2YgdGhlIFNIQVJFX0lORk9fMQogICAgICAgIHJlc3VsdCBzdHJ1Y3R1cmUgd2hpY2ggaW5jbHVkZXMgdGhlIG5hbWUgYW5kIG5vdGUgZm9yIGVhY2ggc2hhcmUsCiAgICAgICAgd2l0aCB0aGUgQ29tcHV0ZXJOYW1lIGFkZGVkLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldFNoYXJlCgogICAgICAgIFJldHVybnMgYWN0aXZlIHNoYXJlcyBvbiB0aGUgbG9jYWwgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRTaGFyZSAtQ29tcHV0ZXJOYW1lIHNxbHNlcnZlcgoKICAgICAgICBSZXR1cm5zIGFjdGl2ZSBzaGFyZXMgb24gdGhlICdzcWxzZXJ2ZXInIGhvc3QKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRDb21wdXRlciB8IEdldC1OZXRTaGFyZQoKICAgICAgICBSZXR1cm5zIGFsbCBzaGFyZXMgZm9yIGFsbCBjb21wdXRlcnMgaW4gdGhlIGRvbWFpbi4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vd3d3LnBvd2Vyc2hlbGxtYWdhemluZS5jb20vMjAxNC8wOS8yNS9lYXNpbHktZGVmaW5pbmctZW51bXMtc3RydWN0cy1hbmQtd2luMzItZnVuY3Rpb25zLWluLW1lbW9yeS8KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtPYmplY3RbXV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnbG9jYWxob3N0JwogICAgKQoKICAgICMgZXh0cmFjdCB0aGUgY29tcHV0ZXIgbmFtZSBmcm9tIHdoYXRldmVyIG9iamVjdCB3YXMgcGFzc2VkIG9uIHRoZSBwaXBlbGluZQogICAgJENvbXB1dGVyID0gJENvbXB1dGVyTmFtZSB8IEdldC1OYW1lRmllbGQKCiAgICAjIGFyZ3VtZW50cyBmb3IgTmV0U2hhcmVFbnVtCiAgICAkUXVlcnlMZXZlbCA9IDEKICAgICRQdHJJbmZvID0gW0ludFB0cl06Olplcm8KICAgICRFbnRyaWVzUmVhZCA9IDAKICAgICRUb3RhbFJlYWQgPSAwCiAgICAkUmVzdW1lSGFuZGxlID0gMAoKICAgICMgZ2V0IHRoZSBzaGFyZSBpbmZvcm1hdGlvbgogICAgJFJlc3VsdCA9ICROZXRhcGkzMjo6TmV0U2hhcmVFbnVtKCRDb21wdXRlciwgJFF1ZXJ5TGV2ZWwsIFtyZWZdJFB0ckluZm8sIC0xLCBbcmVmXSRFbnRyaWVzUmVhZCwgW3JlZl0kVG90YWxSZWFkLCBbcmVmXSRSZXN1bWVIYW5kbGUpCgogICAgIyBMb2NhdGUgdGhlIG9mZnNldCBvZiB0aGUgaW5pdGlhbCBpbnRQdHIKICAgICRPZmZzZXQgPSAkUHRySW5mby5Ub0ludDY0KCkKCiAgICAjIDAgPSBzdWNjZXNzCiAgICBpZiAoKCRSZXN1bHQgLWVxIDApIC1hbmQgKCRPZmZzZXQgLWd0IDApKSB7CgogICAgICAgICMgV29yayBvdXQgaG93IG11Y2ggdG8gaW5jcmVtZW50IHRoZSBwb2ludGVyIGJ5IGZpbmRpbmcgb3V0IHRoZSBzaXplIG9mIHRoZSBzdHJ1Y3R1cmUKICAgICAgICAkSW5jcmVtZW50ID0gJFNIQVJFX0lORk9fMTo6R2V0U2l6ZSgpCgogICAgICAgICMgcGFyc2UgYWxsIHRoZSByZXN1bHQgc3RydWN0dXJlcwogICAgICAgIGZvciAoJGkgPSAwOyAoJGkgLWx0ICRFbnRyaWVzUmVhZCk7ICRpKyspIHsKICAgICAgICAgICAgIyBjcmVhdGUgYSBuZXcgaW50IHB0ciBhdCB0aGUgZ2l2ZW4gb2Zmc2V0IGFuZCBjYXN0IHRoZSBwb2ludGVyIGFzIG91ciByZXN1bHQgc3RydWN0dXJlCiAgICAgICAgICAgICROZXdJbnRQdHIgPSBOZXctT2JqZWN0IFN5c3RlbS5JbnRwdHIgLUFyZ3VtZW50TGlzdCAkT2Zmc2V0CiAgICAgICAgICAgICRJbmZvID0gJE5ld0ludFB0ciAtYXMgJFNIQVJFX0lORk9fMQoKICAgICAgICAgICAgIyByZXR1cm4gYWxsIHRoZSBzZWN0aW9ucyBvZiB0aGUgc3RydWN0dXJlCiAgICAgICAgICAgICRTaGFyZXMgPSAkSW5mbyB8IFNlbGVjdC1PYmplY3QgKgogICAgICAgICAgICAkU2hhcmVzIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyCiAgICAgICAgICAgICRPZmZzZXQgPSAkTmV3SW50UHRyLlRvSW50NjQoKQogICAgICAgICAgICAkT2Zmc2V0ICs9ICRJbmNyZW1lbnQKICAgICAgICAgICAgJFNoYXJlcwogICAgICAgIH0KCiAgICAgICAgIyBmcmVlIHVwIHRoZSByZXN1bHQgYnVmZmVyCiAgICAgICAgJE51bGwgPSAkTmV0YXBpMzI6Ok5ldEFwaUJ1ZmZlckZyZWUoJFB0ckluZm8pCiAgICB9CiAgICBlbHNlIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvcjogJCgoW0NvbXBvbmVudE1vZGVsLldpbjMyRXhjZXB0aW9uXSAkUmVzdWx0KS5NZXNzYWdlKSIKICAgIH0KfQoKCmZpbHRlciBHZXQtTmV0TG9nZ2Vkb24gewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFRoaXMgZnVuY3Rpb24gd2lsbCBleGVjdXRlIHRoZSBOZXRXa3N0YVVzZXJFbnVtIFdpbjMyQVBJIGNhbGwgdG8gcXVlcnkKICAgICAgICBhIGdpdmVuIGhvc3QgZm9yIGFjdGl2ZWx5IGxvZ2dlZCBvbiB1c2Vycy4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBUaGUgaG9zdG5hbWUgdG8gcXVlcnkgZm9yIGxvZ2dlZCBvbiB1c2Vycy4KCiAgICAuT1VUUFVUUwoKICAgICAgICBXS1NUQV9VU0VSX0lORk9fMSBzdHJ1Y3R1cmUuIEEgcmVwcmVzZW50YXRpb24gb2YgdGhlIFdLU1RBX1VTRVJfSU5GT18xCiAgICAgICAgcmVzdWx0IHN0cnVjdHVyZSB3aGljaCBpbmNsdWRlcyB0aGUgdXNlcm5hbWUgYW5kIGRvbWFpbiBvZiBsb2dnZWQgb24gdXNlcnMsCiAgICAgICAgd2l0aCB0aGUgQ29tcHV0ZXJOYW1lIGFkZGVkLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldExvZ2dlZG9uCgogICAgICAgIFJldHVybnMgdXNlcnMgYWN0aXZlbHkgbG9nZ2VkIG9udG8gdGhlIGxvY2FsIGhvc3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0TG9nZ2Vkb24gLUNvbXB1dGVyTmFtZSBzcWxzZXJ2ZXIKCiAgICAgICAgUmV0dXJucyB1c2VycyBhY3RpdmVseSBsb2dnZWQgb250byB0aGUgJ3NxbHNlcnZlcicgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRDb21wdXRlciB8IEdldC1OZXRMb2dnZWRvbgoKICAgICAgICBSZXR1cm5zIGFsbCBsb2dnZWQgb24gdXNlcnNlIGZvciBhbGwgY29tcHV0ZXJzIGluIHRoZSBkb21haW4uCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL3d3dy5wb3dlcnNoZWxsbWFnYXppbmUuY29tLzIwMTQvMDkvMjUvZWFzaWx5LWRlZmluaW5nLWVudW1zLXN0cnVjdHMtYW5kLXdpbjMyLWZ1bmN0aW9ucy1pbi1tZW1vcnkvCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbT2JqZWN0W11dCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJ2xvY2FsaG9zdCcKICAgICkKCiAgICAjIGV4dHJhY3QgdGhlIGNvbXB1dGVyIG5hbWUgZnJvbSB3aGF0ZXZlciBvYmplY3Qgd2FzIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICRDb21wdXRlciA9ICRDb21wdXRlck5hbWUgfCBHZXQtTmFtZUZpZWxkCgogICAgIyBEZWNsYXJlIHRoZSByZWZlcmVuY2UgdmFyaWFibGVzCiAgICAkUXVlcnlMZXZlbCA9IDEKICAgICRQdHJJbmZvID0gW0ludFB0cl06Olplcm8KICAgICRFbnRyaWVzUmVhZCA9IDAKICAgICRUb3RhbFJlYWQgPSAwCiAgICAkUmVzdW1lSGFuZGxlID0gMAoKICAgICMgZ2V0IGxvZ2dlZCBvbiB1c2VyIGluZm9ybWF0aW9uCiAgICAkUmVzdWx0ID0gJE5ldGFwaTMyOjpOZXRXa3N0YVVzZXJFbnVtKCRDb21wdXRlciwgJFF1ZXJ5TGV2ZWwsIFtyZWZdJFB0ckluZm8sIC0xLCBbcmVmXSRFbnRyaWVzUmVhZCwgW3JlZl0kVG90YWxSZWFkLCBbcmVmXSRSZXN1bWVIYW5kbGUpCgogICAgIyBMb2NhdGUgdGhlIG9mZnNldCBvZiB0aGUgaW5pdGlhbCBpbnRQdHIKICAgICRPZmZzZXQgPSAkUHRySW5mby5Ub0ludDY0KCkKCiAgICAjIDAgPSBzdWNjZXNzCiAgICBpZiAoKCRSZXN1bHQgLWVxIDApIC1hbmQgKCRPZmZzZXQgLWd0IDApKSB7CgogICAgICAgICMgV29yayBvdXQgaG93IG11Y2ggdG8gaW5jcmVtZW50IHRoZSBwb2ludGVyIGJ5IGZpbmRpbmcgb3V0IHRoZSBzaXplIG9mIHRoZSBzdHJ1Y3R1cmUKICAgICAgICAkSW5jcmVtZW50ID0gJFdLU1RBX1VTRVJfSU5GT18xOjpHZXRTaXplKCkKCiAgICAgICAgIyBwYXJzZSBhbGwgdGhlIHJlc3VsdCBzdHJ1Y3R1cmVzCiAgICAgICAgZm9yICgkaSA9IDA7ICgkaSAtbHQgJEVudHJpZXNSZWFkKTsgJGkrKykgewogICAgICAgICAgICAjIGNyZWF0ZSBhIG5ldyBpbnQgcHRyIGF0IHRoZSBnaXZlbiBvZmZzZXQgYW5kIGNhc3QgdGhlIHBvaW50ZXIgYXMgb3VyIHJlc3VsdCBzdHJ1Y3R1cmUKICAgICAgICAgICAgJE5ld0ludFB0ciA9IE5ldy1PYmplY3QgU3lzdGVtLkludHB0ciAtQXJndW1lbnRMaXN0ICRPZmZzZXQKICAgICAgICAgICAgJEluZm8gPSAkTmV3SW50UHRyIC1hcyAkV0tTVEFfVVNFUl9JTkZPXzEKCiAgICAgICAgICAgICMgcmV0dXJuIGFsbCB0aGUgc2VjdGlvbnMgb2YgdGhlIHN0cnVjdHVyZQogICAgICAgICAgICAkTG9nZ2VkT24gPSAkSW5mbyB8IFNlbGVjdC1PYmplY3QgKgogICAgICAgICAgICAkTG9nZ2VkT24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXIKICAgICAgICAgICAgJE9mZnNldCA9ICROZXdJbnRQdHIuVG9JbnQ2NCgpCiAgICAgICAgICAgICRPZmZzZXQgKz0gJEluY3JlbWVudAogICAgICAgICAgICAkTG9nZ2VkT24KICAgICAgICB9CgogICAgICAgICMgZnJlZSB1cCB0aGUgcmVzdWx0IGJ1ZmZlcgogICAgICAgICROdWxsID0gJE5ldGFwaTMyOjpOZXRBcGlCdWZmZXJGcmVlKCRQdHJJbmZvKQogICAgfQogICAgZWxzZSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3I6ICQoKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJFJlc3VsdCkuTWVzc2FnZSkiCiAgICB9Cn0KCgpmaWx0ZXIgR2V0LU5ldFNlc3Npb24gewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFRoaXMgZnVuY3Rpb24gd2lsbCBleGVjdXRlIHRoZSBOZXRTZXNzaW9uRW51bSBXaW4zMkFQSSBjYWxsIHRvIHF1ZXJ5CiAgICAgICAgYSBnaXZlbiBob3N0IGZvciBhY3RpdmUgc2Vzc2lvbnMgb24gdGhlIGhvc3QuCiAgICAgICAgSGVhdmlseSBhZGFwdGVkIGZyb20gZHVuZWRpbml0ZSdzIHBvc3Qgb24gc3RhY2tvdmVyZmxvdyAoc2VlIExJTksgYmVsb3cpCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIENvbXB1dGVyTmFtZSB0byBxdWVyeSBmb3IgYWN0aXZlIHNlc3Npb25zLgoKICAgIC5QQVJBTUVURVIgVXNlck5hbWUKCiAgICAgICAgVGhlIHVzZXIgbmFtZSB0byBmaWx0ZXIgZm9yIGFjdGl2ZSBzZXNzaW9ucy4KCiAgICAuT1VUUFVUUwoKICAgICAgICBTRVNTSU9OX0lORk9fMTAgc3RydWN0dXJlLiBBIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBTRVNTSU9OX0lORk9fMTAKICAgICAgICByZXN1bHQgc3RydWN0dXJlIHdoaWNoIGluY2x1ZGVzIHRoZSBob3N0IGFuZCB1c2VybmFtZSBhc3NvY2lhdGVkCiAgICAgICAgd2l0aCBhY3RpdmUgc2Vzc2lvbnMsIHdpdGggdGhlIENvbXB1dGVyTmFtZSBhZGRlZC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRTZXNzaW9uCgogICAgICAgIFJldHVybnMgYWN0aXZlIHNlc3Npb25zIG9uIHRoZSBsb2NhbCBob3N0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldFNlc3Npb24gLUNvbXB1dGVyTmFtZSBzcWxzZXJ2ZXIKCiAgICAgICAgUmV0dXJucyBhY3RpdmUgc2Vzc2lvbnMgb24gdGhlICdzcWxzZXJ2ZXInIGhvc3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0RG9tYWluQ29udHJvbGxlciB8IEdldC1OZXRTZXNzaW9uCgogICAgICAgIFJldHVybnMgYWN0aXZlIHNlc3Npb25zIG9uIGFsbCBkb21haW4gY29udHJvbGxlcnMuCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL3d3dy5wb3dlcnNoZWxsbWFnYXppbmUuY29tLzIwMTQvMDkvMjUvZWFzaWx5LWRlZmluaW5nLWVudW1zLXN0cnVjdHMtYW5kLXdpbjMyLWZ1bmN0aW9ucy1pbi1tZW1vcnkvCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbT2JqZWN0W11dCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJ2xvY2FsaG9zdCcsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJOYW1lID0gJycKICAgICkKCiAgICAjIGV4dHJhY3QgdGhlIGNvbXB1dGVyIG5hbWUgZnJvbSB3aGF0ZXZlciBvYmplY3Qgd2FzIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICRDb21wdXRlciA9ICRDb21wdXRlck5hbWUgfCBHZXQtTmFtZUZpZWxkCgogICAgIyBhcmd1bWVudHMgZm9yIE5ldFNlc3Npb25FbnVtCiAgICAkUXVlcnlMZXZlbCA9IDEwCiAgICAkUHRySW5mbyA9IFtJbnRQdHJdOjpaZXJvCiAgICAkRW50cmllc1JlYWQgPSAwCiAgICAkVG90YWxSZWFkID0gMAogICAgJFJlc3VtZUhhbmRsZSA9IDAKCiAgICAjIGdldCBzZXNzaW9uIGluZm9ybWF0aW9uCiAgICAkUmVzdWx0ID0gJE5ldGFwaTMyOjpOZXRTZXNzaW9uRW51bSgkQ29tcHV0ZXIsICcnLCAkVXNlck5hbWUsICRRdWVyeUxldmVsLCBbcmVmXSRQdHJJbmZvLCAtMSwgW3JlZl0kRW50cmllc1JlYWQsIFtyZWZdJFRvdGFsUmVhZCwgW3JlZl0kUmVzdW1lSGFuZGxlKQoKICAgICMgTG9jYXRlIHRoZSBvZmZzZXQgb2YgdGhlIGluaXRpYWwgaW50UHRyCiAgICAkT2Zmc2V0ID0gJFB0ckluZm8uVG9JbnQ2NCgpCgogICAgIyAwID0gc3VjY2VzcwogICAgaWYgKCgkUmVzdWx0IC1lcSAwKSAtYW5kICgkT2Zmc2V0IC1ndCAwKSkgewoKICAgICAgICAjIFdvcmsgb3V0IGhvdyBtdWNoIHRvIGluY3JlbWVudCB0aGUgcG9pbnRlciBieSBmaW5kaW5nIG91dCB0aGUgc2l6ZSBvZiB0aGUgc3RydWN0dXJlCiAgICAgICAgJEluY3JlbWVudCA9ICRTRVNTSU9OX0lORk9fMTA6OkdldFNpemUoKQoKICAgICAgICAjIHBhcnNlIGFsbCB0aGUgcmVzdWx0IHN0cnVjdHVyZXMKICAgICAgICBmb3IgKCRpID0gMDsgKCRpIC1sdCAkRW50cmllc1JlYWQpOyAkaSsrKSB7CiAgICAgICAgICAgICMgY3JlYXRlIGEgbmV3IGludCBwdHIgYXQgdGhlIGdpdmVuIG9mZnNldCBhbmQgY2FzdCB0aGUgcG9pbnRlciBhcyBvdXIgcmVzdWx0IHN0cnVjdHVyZQogICAgICAgICAgICAkTmV3SW50UHRyID0gTmV3LU9iamVjdCBTeXN0ZW0uSW50cHRyIC1Bcmd1bWVudExpc3QgJE9mZnNldAogICAgICAgICAgICAkSW5mbyA9ICROZXdJbnRQdHIgLWFzICRTRVNTSU9OX0lORk9fMTAKCiAgICAgICAgICAgICMgcmV0dXJuIGFsbCB0aGUgc2VjdGlvbnMgb2YgdGhlIHN0cnVjdHVyZQogICAgICAgICAgICAkU2Vzc2lvbnMgPSAkSW5mbyB8IFNlbGVjdC1PYmplY3QgKgogICAgICAgICAgICAkU2Vzc2lvbnMgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXIKICAgICAgICAgICAgJE9mZnNldCA9ICROZXdJbnRQdHIuVG9JbnQ2NCgpCiAgICAgICAgICAgICRPZmZzZXQgKz0gJEluY3JlbWVudAogICAgICAgICAgICAkU2Vzc2lvbnMKICAgICAgICB9CiAgICAgICAgIyBmcmVlIHVwIHRoZSByZXN1bHQgYnVmZmVyCiAgICAgICAgJE51bGwgPSAkTmV0YXBpMzI6Ok5ldEFwaUJ1ZmZlckZyZWUoJFB0ckluZm8pCiAgICB9CiAgICBlbHNlIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvcjogJCgoW0NvbXBvbmVudE1vZGVsLldpbjMyRXhjZXB0aW9uXSAkUmVzdWx0KS5NZXNzYWdlKSIKICAgIH0KfQoKCmZpbHRlciBHZXQtTG9nZ2VkT25Mb2NhbCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiB3aWxsIHF1ZXJ5IHRoZSBIS1UgcmVnaXN0cnkgdmFsdWVzIHRvIHJldHJpZXZlIHRoZSBsb2NhbAogICAgICAgIGxvZ2dlZCBvbiB1c2VycyBTSUQgYW5kIHRoZW4gYXR0ZW1wdCBhbmQgcmV2ZXJzZSBpdC4KICAgICAgICBBZGFwdGVkIHRlY2huaXF1ZSBmcm9tIFN5c2ludGVybmFsJ3MgUFNMb2dnZWRPbiBzY3JpcHQuIEJlbmVmaXQgb3ZlcgogICAgICAgIHVzaW5nIHRoZSBOZXRXa3N0YVVzZXJFbnVtIEFQSSAoR2V0LU5ldExvZ2dlZG9uKSBvZiBsZXNzIHVzZXIgcHJpdmlsZWdlcwogICAgICAgIHJlcXVpcmVkIChOZXRXa3N0YVVzZXJFbnVtIHJlcXVpcmVzIHJlbW90ZSBhZG1pbiBhY2Nlc3MpLgoKICAgICAgICBOb3RlOiBUaGlzIGZ1bmN0aW9uIHJlcXVpcmVzIG9ubHkgZG9tYWluIHVzZXIgcmlnaHRzIG9uIHRoZQogICAgICAgIG1hY2hpbmUgeW91J3JlIGVudW1lcmF0aW5nLCBidXQgcmVtb3RlIHJlZ2lzdHJ5IG11c3QgYmUgZW5hYmxlZC4KCiAgICAgICAgRnVuY3Rpb246IEdldC1Mb2dnZWRPbkxvY2FsCiAgICAgICAgQXV0aG9yOiBNYXR0IEtlbGx5LCBAQnJlYWtlcnNBbGwKCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBUaGUgQ29tcHV0ZXJOYW1lIHRvIHF1ZXJ5IGZvciBhY3RpdmUgc2Vzc2lvbnMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTG9nZ2VkT25Mb2NhbAoKICAgICAgICBSZXR1cm5zIGFjdGl2ZSBzZXNzaW9ucyBvbiB0aGUgbG9jYWwgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Mb2dnZWRPbkxvY2FsIC1Db21wdXRlck5hbWUgc3Fsc2VydmVyCgogICAgICAgIFJldHVybnMgYWN0aXZlIHNlc3Npb25zIG9uIHRoZSAnc3Fsc2VydmVyJyBob3N0LgoKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtPYmplY3RbXV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnbG9jYWxob3N0JwogICAgKQoKICAgICMgcHJvY2VzcyBtdWx0aXBsZSBob3N0IG9iamVjdCB0eXBlcyBmcm9tIHRoZSBwaXBlbGluZQogICAgJENvbXB1dGVyTmFtZSA9IEdldC1OYW1lRmllbGQgLU9iamVjdCAkQ29tcHV0ZXJOYW1lCgogICAgdHJ5IHsKICAgICAgICAjIHJldHJpZXZlIEhLVSByZW1vdGUgcmVnaXN0cnkgdmFsdWVzCiAgICAgICAgJFJlZyA9IFtNaWNyb3NvZnQuV2luMzIuUmVnaXN0cnlLZXldOjpPcGVuUmVtb3RlQmFzZUtleSgnVXNlcnMnLCAiJENvbXB1dGVyTmFtZSIpCgogICAgICAgICMgc29ydCBvdXQgYm9ndXMgc2lkJ3MgbGlrZSBfY2xhc3MKICAgICAgICAkUmVnLkdldFN1YktleU5hbWVzKCkgfCBXaGVyZS1PYmplY3QgeyAkXyAtbWF0Y2ggJ1MtMS01LTIxLVswLTldKy1bMC05XSstWzAtOV0rLVswLTldKyQnIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICRVc2VyTmFtZSA9IENvbnZlcnQtU2lkVG9OYW1lICRfCgogICAgICAgICAgICAkUGFydHMgPSAkVXNlck5hbWUuU3BsaXQoJ1wnKQogICAgICAgICAgICAkVXNlckRvbWFpbiA9ICROdWxsCiAgICAgICAgICAgICRVc2VyTmFtZSA9ICRQYXJ0c1stMV0KICAgICAgICAgICAgaWYgKCRQYXJ0cy5MZW5ndGggLWVxIDIpIHsKICAgICAgICAgICAgICAgICRVc2VyRG9tYWluID0gJFBhcnRzWzBdCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRMb2NhbExvZ2dlZE9uVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgJExvY2FsTG9nZ2VkT25Vc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgIiRDb21wdXRlck5hbWUiCiAgICAgICAgICAgICRMb2NhbExvZ2dlZE9uVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyRG9tYWluJyAkVXNlckRvbWFpbgogICAgICAgICAgICAkTG9jYWxMb2dnZWRPblVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlck5hbWUnICRVc2VyTmFtZQogICAgICAgICAgICAkTG9jYWxMb2dnZWRPblVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlclNJRCcgJF8KICAgICAgICAgICAgJExvY2FsTG9nZ2VkT25Vc2VyCiAgICAgICAgfQogICAgfQogICAgY2F0Y2ggewogICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIG9wZW5pbmcgcmVtb3RlIHJlZ2lzdHJ5IG9uICckQ29tcHV0ZXJOYW1lJyIKICAgIH0KfQoKCmZpbHRlciBHZXQtTmV0UkRQU2Vzc2lvbiB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiB3aWxsIGV4ZWN1dGUgdGhlIFdUU0VudW1lcmF0ZVNlc3Npb25zRXggYW5kIAogICAgICAgIFdUU1F1ZXJ5U2Vzc2lvbkluZm9ybWF0aW9uIFdpbjMyQVBJIGNhbGxzIHRvIHF1ZXJ5IGEgZ2l2ZW4KICAgICAgICBSRFAgcmVtb3RlIHNlcnZpY2UgZm9yIGFjdGl2ZSBzZXNzaW9ucyBhbmQgb3JpZ2luYXRpbmcgSVBzLgogICAgICAgIFRoaXMgaXMgYSByZXBsYWNlbWVudCBmb3IgcXdpbnN0YS4KCiAgICAgICAgTm90ZTogb25seSBtZW1iZXJzIG9mIHRoZSBBZG1pbmlzdHJhdG9ycyBvciBBY2NvdW50IE9wZXJhdG9ycyBsb2NhbCBncm91cAogICAgICAgIGNhbiBzdWNjZXNzZnVsbHkgZXhlY3V0ZSB0aGlzIGZ1bmN0aW9uYWxpdHkgb24gYSByZW1vdGUgdGFyZ2V0LgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBob3N0bmFtZSB0byBxdWVyeSBmb3IgYWN0aXZlIFJEUCBzZXNzaW9ucy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRSRFBTZXNzaW9uCgogICAgICAgIFJldHVybnMgYWN0aXZlIFJEUC90ZXJtaW5hbCBzZXNzaW9ucyBvbiB0aGUgbG9jYWwgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRSRFBTZXNzaW9uIC1Db21wdXRlck5hbWUgInNxbHNlcnZlciIKCiAgICAgICAgUmV0dXJucyBhY3RpdmUgUkRQL3Rlcm1pbmFsIHNlc3Npb25zIG9uIHRoZSAnc3Fsc2VydmVyJyBob3N0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldERvbWFpbkNvbnRyb2xsZXIgfCBHZXQtTmV0UkRQU2Vzc2lvbgoKICAgICAgICBSZXR1cm5zIGFjdGl2ZSBSRFAvdGVybWluYWwgc2Vzc2lvbnMgb24gYWxsIGRvbWFpbiBjb250cm9sbGVycy4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtPYmplY3RbXV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnbG9jYWxob3N0JwogICAgKQoKICAgICMgZXh0cmFjdCB0aGUgY29tcHV0ZXIgbmFtZSBmcm9tIHdoYXRldmVyIG9iamVjdCB3YXMgcGFzc2VkIG9uIHRoZSBwaXBlbGluZQogICAgJENvbXB1dGVyID0gJENvbXB1dGVyTmFtZSB8IEdldC1OYW1lRmllbGQKCiAgICAjIG9wZW4gdXAgYSBoYW5kbGUgdG8gdGhlIFJlbW90ZSBEZXNrdG9wIFNlc3Npb24gaG9zdAogICAgJEhhbmRsZSA9ICRXdHNhcGkzMjo6V1RTT3BlblNlcnZlckV4KCRDb21wdXRlcikKCiAgICAjIGlmIHdlIGdldCBhIG5vbi16ZXJvIGhhbmRsZSBiYWNrLCBldmVyeXRoaW5nIHdhcyBzdWNjZXNzZnVsCiAgICBpZiAoJEhhbmRsZSAtbmUgMCkgewoKICAgICAgICAjIGFyZ3VtZW50cyBmb3IgV1RTRW51bWVyYXRlU2Vzc2lvbnNFeAogICAgICAgICRwcFNlc3Npb25JbmZvID0gW0ludFB0cl06Olplcm8KICAgICAgICAkcENvdW50ID0gMAogICAgICAgIAogICAgICAgICMgZ2V0IGluZm9ybWF0aW9uIG9uIGFsbCBjdXJyZW50IHNlc3Npb25zCiAgICAgICAgJFJlc3VsdCA9ICRXdHNhcGkzMjo6V1RTRW51bWVyYXRlU2Vzc2lvbnNFeCgkSGFuZGxlLCBbcmVmXTEsIDAsIFtyZWZdJHBwU2Vzc2lvbkluZm8sIFtyZWZdJHBDb3VudCk7JExhc3RFcnJvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0TGFzdFdpbjMyRXJyb3IoKQoKICAgICAgICAjIExvY2F0ZSB0aGUgb2Zmc2V0IG9mIHRoZSBpbml0aWFsIGludFB0cgogICAgICAgICRPZmZzZXQgPSAkcHBTZXNzaW9uSW5mby5Ub0ludDY0KCkKCiAgICAgICAgaWYgKCgkUmVzdWx0IC1uZSAwKSAtYW5kICgkT2Zmc2V0IC1ndCAwKSkgewoKICAgICAgICAgICAgIyBXb3JrIG91dCBob3cgbXVjaCB0byBpbmNyZW1lbnQgdGhlIHBvaW50ZXIgYnkgZmluZGluZyBvdXQgdGhlIHNpemUgb2YgdGhlIHN0cnVjdHVyZQogICAgICAgICAgICAkSW5jcmVtZW50ID0gJFdUU19TRVNTSU9OX0lORk9fMTo6R2V0U2l6ZSgpCgogICAgICAgICAgICAjIHBhcnNlIGFsbCB0aGUgcmVzdWx0IHN0cnVjdHVyZXMKICAgICAgICAgICAgZm9yICgkaSA9IDA7ICgkaSAtbHQgJHBDb3VudCk7ICRpKyspIHsKIAogICAgICAgICAgICAgICAgIyBjcmVhdGUgYSBuZXcgaW50IHB0ciBhdCB0aGUgZ2l2ZW4gb2Zmc2V0IGFuZCBjYXN0IHRoZSBwb2ludGVyIGFzIG91ciByZXN1bHQgc3RydWN0dXJlCiAgICAgICAgICAgICAgICAkTmV3SW50UHRyID0gTmV3LU9iamVjdCBTeXN0ZW0uSW50cHRyIC1Bcmd1bWVudExpc3QgJE9mZnNldAogICAgICAgICAgICAgICAgJEluZm8gPSAkTmV3SW50UHRyIC1hcyAkV1RTX1NFU1NJT05fSU5GT18xCgogICAgICAgICAgICAgICAgJFJEUFNlc3Npb24gPSBOZXctT2JqZWN0IFBTT2JqZWN0CgogICAgICAgICAgICAgICAgaWYgKCRJbmZvLnBIb3N0TmFtZSkgewogICAgICAgICAgICAgICAgICAgICRSRFBTZXNzaW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJEluZm8ucEhvc3ROYW1lCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAjIGlmIG5vIGhvc3RuYW1lIHJldHVybmVkLCB1c2UgdGhlIHNwZWNpZmllZCBob3N0bmFtZQogICAgICAgICAgICAgICAgICAgICRSRFBTZXNzaW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJFJEUFNlc3Npb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU2Vzc2lvbk5hbWUnICRJbmZvLnBTZXNzaW9uTmFtZQoKICAgICAgICAgICAgICAgIGlmICgkKC1ub3QgJEluZm8ucERvbWFpbk5hbWUpIC1vciAoJEluZm8ucERvbWFpbk5hbWUgLWVxICcnKSkgewogICAgICAgICAgICAgICAgICAgICMgaWYgYSBkb21haW4gaXNuJ3QgcmV0dXJuZWQganVzdCB1c2UgdGhlIHVzZXJuYW1lCiAgICAgICAgICAgICAgICAgICAgJFJEUFNlc3Npb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlck5hbWUnICIkKCRJbmZvLnBVc2VyTmFtZSkiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkUkRQU2Vzc2lvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyTmFtZScgIiQoJEluZm8ucERvbWFpbk5hbWUpXCQoJEluZm8ucFVzZXJOYW1lKSIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkUkRQU2Vzc2lvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJRCcgJEluZm8uU2Vzc2lvbklECiAgICAgICAgICAgICAgICAkUkRQU2Vzc2lvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTdGF0ZScgJEluZm8uU3RhdGUKCiAgICAgICAgICAgICAgICAkcHBCdWZmZXIgPSBbSW50UHRyXTo6WmVybwogICAgICAgICAgICAgICAgJHBCeXRlc1JldHVybmVkID0gMAoKICAgICAgICAgICAgICAgICMgcXVlcnkgZm9yIHRoZSBzb3VyY2UgY2xpZW50IElQIHdpdGggV1RTUXVlcnlTZXNzaW9uSW5mb3JtYXRpb24KICAgICAgICAgICAgICAgICMgICBodHRwczovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2FhMzgzODYxKHY9dnMuODUpLmFzcHgKICAgICAgICAgICAgICAgICRSZXN1bHQyID0gJFd0c2FwaTMyOjpXVFNRdWVyeVNlc3Npb25JbmZvcm1hdGlvbigkSGFuZGxlLCAkSW5mby5TZXNzaW9uSUQsIDE0LCBbcmVmXSRwcEJ1ZmZlciwgW3JlZl0kcEJ5dGVzUmV0dXJuZWQpOyRMYXN0RXJyb3IyID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXRMYXN0V2luMzJFcnJvcigpCgogICAgICAgICAgICAgICAgaWYoJFJlc3VsdCAtZXEgMCkgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yOiAkKChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IyKS5NZXNzYWdlKSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRPZmZzZXQyID0gJHBwQnVmZmVyLlRvSW50NjQoKQogICAgICAgICAgICAgICAgICAgICROZXdJbnRQdHIyID0gTmV3LU9iamVjdCBTeXN0ZW0uSW50cHRyIC1Bcmd1bWVudExpc3QgJE9mZnNldDIKICAgICAgICAgICAgICAgICAgICAkSW5mbzIgPSAkTmV3SW50UHRyMiAtYXMgJFdUU19DTElFTlRfQUREUkVTUwoKICAgICAgICAgICAgICAgICAgICAkU291cmNlSVAgPSAkSW5mbzIuQWRkcmVzcyAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZigkU291cmNlSVBbMl0gLW5lIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFNvdXJjZUlQID0gW1N0cmluZ10kU291cmNlSVBbMl0rIi4iK1tTdHJpbmddJFNvdXJjZUlQWzNdKyIuIitbU3RyaW5nXSRTb3VyY2VJUFs0XSsiLiIrW1N0cmluZ10kU291cmNlSVBbNV0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRTb3VyY2VJUCA9ICROdWxsCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkUkRQU2Vzc2lvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTb3VyY2VJUCcgJFNvdXJjZUlQCiAgICAgICAgICAgICAgICAgICAgJFJEUFNlc3Npb24KCiAgICAgICAgICAgICAgICAgICAgIyBmcmVlIHVwIHRoZSBtZW1vcnkgYnVmZmVyCiAgICAgICAgICAgICAgICAgICAgJE51bGwgPSAkV3RzYXBpMzI6OldUU0ZyZWVNZW1vcnkoJHBwQnVmZmVyKQoKICAgICAgICAgICAgICAgICAgICAkT2Zmc2V0ICs9ICRJbmNyZW1lbnQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAjIGZyZWUgdXAgdGhlIG1lbW9yeSByZXN1bHQgYnVmZmVyCiAgICAgICAgICAgICROdWxsID0gJFd0c2FwaTMyOjpXVFNGcmVlTWVtb3J5RXgoMiwgJHBwU2Vzc2lvbkluZm8sICRwQ291bnQpCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvcjogJCgoW0NvbXBvbmVudE1vZGVsLldpbjMyRXhjZXB0aW9uXSAkTGFzdEVycm9yKS5NZXNzYWdlKSIKICAgICAgICB9CiAgICAgICAgIyBDbG9zZSBvZmYgdGhlIHNlcnZpY2UgaGFuZGxlCiAgICAgICAgJE51bGwgPSAkV3RzYXBpMzI6OldUU0Nsb3NlU2VydmVyKCRIYW5kbGUpCiAgICB9CiAgICBlbHNlIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBvcGVuaW5nIHRoZSBSZW1vdGUgRGVza3RvcCBTZXNzaW9uIEhvc3QgKFJEIFNlc3Npb24gSG9zdCkgc2VydmVyIGZvcjogJENvbXB1dGVyTmFtZSIKICAgIH0KfQoKCmZpbHRlciBJbnZva2UtQ2hlY2tMb2NhbEFkbWluQWNjZXNzIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHdpbGwgdXNlIHRoZSBPcGVuU0NNYW5hZ2VyVyBXaW4zMkFQSSBjYWxsIHRvIGVzdGFibGlzaAogICAgICAgIGEgaGFuZGxlIHRvIHRoZSByZW1vdGUgaG9zdC4gSWYgdGhpcyBzdWNjZWVkcywgdGhlIGN1cnJlbnQgdXNlciBjb250ZXh0CiAgICAgICAgaGFzIGxvY2FsIGFkbWluaXN0cmF0b3IgYWNlc3MgdG8gdGhlIHRhcmdldC4KCiAgICAgICAgSWRlYSBzdG9sZW4gZnJvbSB0aGUgbG9jYWxfYWRtaW5fc2VhcmNoX2VudW0gcG9zdCBtb2R1bGUgaW4gTWV0YXNwbG9pdCB3cml0dGVuIGJ5OgogICAgICAgICAgICAnQnJhbmRvbiBNY0Nhbm4gInpla25veCIgPGJtY2Nhbm5bYXRdYWNjdXZhbnQuY29tPicKICAgICAgICAgICAgJ1Rob21hcyBNY0NhcnRoeSAic21pbGluZ3JhY2Nvb24iIDxzbWlsaW5ncmFjY29vblthdF1nbWFpbC5jb20+JwogICAgICAgICAgICAnUm95Y2UgRGF2aXMgInIzZHkiIDxyZGF2aXNbYXRdYWNjdXZhbnQuY29tPicKCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBUaGUgaG9zdG5hbWUgdG8gcXVlcnkgZm9yIGFjdGl2ZSBzZXNzaW9ucy4KCiAgICAuT1VUUFVUUwoKICAgICAgICAkVHJ1ZSBpZiB0aGUgY3VycmVudCB1c2VyIGhhcyBsb2NhbCBhZG1pbiBhY2Nlc3MgdG8gdGhlIGhvc3RuYW1lLCAkRmFsc2Ugb3RoZXJ3aXNlCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtQ2hlY2tMb2NhbEFkbWluQWNjZXNzIC1Db21wdXRlck5hbWUgc3Fsc2VydmVyCgogICAgICAgIFJldHVybnMgYWN0aXZlIHNlc3Npb25zIG9uIHRoZSBsb2NhbCBob3N0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldENvbXB1dGVyIHwgSW52b2tlLUNoZWNrTG9jYWxBZG1pbkFjY2VzcwoKICAgICAgICBTZWVzIHdoYXQgbWFjaGluZXMgaW4gdGhlIGRvbWFpbiB0aGUgY3VycmVudCB1c2VyIGhhcyBhY2Nlc3MgdG8uCgogICAgLkxJTksKCiAgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL3JhcGlkNy9tZXRhc3Bsb2l0LWZyYW1ld29yay9ibG9iL21hc3Rlci9tb2R1bGVzL3Bvc3Qvd2luZG93cy9nYXRoZXIvbG9jYWxfYWRtaW5fc2VhcmNoX2VudW0ucmIKICAgICAgICBodHRwOi8vd3d3LnBvd2Vyc2hlbGxtYWdhemluZS5jb20vMjAxNC8wOS8yNS9lYXNpbHktZGVmaW5pbmctZW51bXMtc3RydWN0cy1hbmQtd2luMzItZnVuY3Rpb25zLWluLW1lbW9yeS8KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtPYmplY3RbXV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnbG9jYWxob3N0JwogICAgKQoKICAgICMgZXh0cmFjdCB0aGUgY29tcHV0ZXIgbmFtZSBmcm9tIHdoYXRldmVyIG9iamVjdCB3YXMgcGFzc2VkIG9uIHRoZSBwaXBlbGluZQogICAgJENvbXB1dGVyID0gJENvbXB1dGVyTmFtZSB8IEdldC1OYW1lRmllbGQKCiAgICAjIDB4RjAwM0YgLSBTQ19NQU5BR0VSX0FMTF9BQ0NFU1MKICAgICMgICBodHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvd2luZG93cy9kZXNrdG9wL21zNjg1OTgxKHY9dnMuODUpLmFzcHgKICAgICRIYW5kbGUgPSAkQWR2YXBpMzI6Ok9wZW5TQ01hbmFnZXJXKCJcXCRDb21wdXRlciIsICdTZXJ2aWNlc0FjdGl2ZScsIDB4RjAwM0YpOyRMYXN0RXJyb3IgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkdldExhc3RXaW4zMkVycm9yKCkKCiAgICBXcml0ZS1WZXJib3NlICJJbnZva2UtQ2hlY2tMb2NhbEFkbWluQWNjZXNzIGhhbmRsZTogJEhhbmRsZSIKCiAgICAkSXNBZG1pbiA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICRJc0FkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyCgogICAgIyBpZiB3ZSBnZXQgYSBub24temVybyBoYW5kbGUgYmFjaywgZXZlcnl0aGluZyB3YXMgc3VjY2Vzc2Z1bAogICAgaWYgKCRIYW5kbGUgLW5lIDApIHsKICAgICAgICAkTnVsbCA9ICRBZHZhcGkzMjo6Q2xvc2VTZXJ2aWNlSGFuZGxlKCRIYW5kbGUpCiAgICAgICAgJElzQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSXNBZG1pbicgJFRydWUKICAgIH0KICAgIGVsc2UgewogICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yOiAkKChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpLk1lc3NhZ2UpIgogICAgICAgICRJc0FkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzQWRtaW4nICRGYWxzZQogICAgfQoKICAgICRJc0FkbWluCn0KCgpmaWx0ZXIgR2V0LVNpdGVOYW1lIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHdpbGwgdXNlIHRoZSBEc0dldFNpdGVOYW1lIFdpbjMyQVBJIGNhbGwgdG8gbG9vayB1cCB0aGUKICAgICAgICBuYW1lIG9mIHRoZSBzaXRlIHdoZXJlIGEgc3BlY2lmaWVkIGNvbXB1dGVyIHJlc2lkZXMuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGhvc3RuYW1lIHRvIGxvb2sgdGhlIHNpdGUgdXAgZm9yLCBkZWZhdWx0IHRvIGxvY2FsaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1TaXRlTmFtZSAtQ29tcHV0ZXJOYW1lIFdJTkRPV1MxCgogICAgICAgIFJldHVybnMgdGhlIHNpdGUgZm9yIFdJTkRPV1MxLnRlc3RsYWIubG9jYWwuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Q29tcHV0ZXIgfCBHZXQtU2l0ZU5hbWUKCiAgICAgICAgUmV0dXJucyB0aGUgc2l0ZXMgZm9yIGV2ZXJ5IG1hY2hpbmUgaW4gQUQuCiM+CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtPYmplY3RbXV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21wdXRlck5hbWUgPSAkRW52OkNvbXB1dGVyTmFtZQogICAgKQoKICAgICMgZXh0cmFjdCB0aGUgY29tcHV0ZXIgbmFtZSBmcm9tIHdoYXRldmVyIG9iamVjdCB3YXMgcGFzc2VkIG9uIHRoZSBwaXBlbGluZQogICAgJENvbXB1dGVyID0gJENvbXB1dGVyTmFtZSB8IEdldC1OYW1lRmllbGQKCiAgICAjIGlmIHdlIGdldCBhbiBJUCBhZGRyZXNzLCB0cnkgdG8gcmVzb2x2ZSB0aGUgSVAgdG8gYSBob3N0bmFtZQogICAgaWYoJENvbXB1dGVyIC1tYXRjaCAnXig/OlswLTldezEsM31cLil7M31bMC05XXsxLDN9JCcpIHsKICAgICAgICAkSVBBZGRyZXNzID0gJENvbXB1dGVyCiAgICAgICAgJENvbXB1dGVyID0gW1N5c3RlbS5OZXQuRG5zXTo6R2V0SG9zdEJ5QWRkcmVzcygkQ29tcHV0ZXIpCiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkSVBBZGRyZXNzID0gQChHZXQtSVBBZGRyZXNzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyKVswXS5JUEFkZHJlc3MKICAgIH0KCiAgICAkUHRySW5mbyA9IFtJbnRQdHJdOjpaZXJvCgogICAgJFJlc3VsdCA9ICROZXRhcGkzMjo6RHNHZXRTaXRlTmFtZSgkQ29tcHV0ZXIsIFtyZWZdJFB0ckluZm8pCgogICAgJENvbXB1dGVyU2l0ZSA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICRDb21wdXRlclNpdGUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXIKICAgICRDb21wdXRlclNpdGUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSVBBZGRyZXNzJyAkSVBBZGRyZXNzCgogICAgaWYgKCRSZXN1bHQgLWVxIDApIHsKICAgICAgICAkU2l0ZW5hbWUgPSBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpQdHJUb1N0cmluZ0F1dG8oJFB0ckluZm8pCiAgICAgICAgJENvbXB1dGVyU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTaXRlTmFtZScgJFNpdGVuYW1lCiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkRXJyb3JNZXNzYWdlID0gIkVycm9yOiAkKChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRSZXN1bHQpLk1lc3NhZ2UpIgogICAgICAgICRDb21wdXRlclNpdGUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU2l0ZU5hbWUnICRFcnJvck1lc3NhZ2UKICAgIH0KCiAgICAkTnVsbCA9ICROZXRhcGkzMjo6TmV0QXBpQnVmZmVyRnJlZSgkUHRySW5mbykKCiAgICAkQ29tcHV0ZXJTaXRlCn0KCgpmaWx0ZXIgR2V0LUxhc3RMb2dnZWRPbiB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiB1c2VzIHJlbW90ZSByZWdpc3RyeSBmdW5jdGlvbmFsaXR5IHRvIHJldHVybgogICAgICAgIHRoZSBsYXN0IHVzZXIgbG9nZ2VkIG9udG8gYSB0YXJnZXQgbWFjaGluZS4KCiAgICAgICAgTm90ZTogVGhpcyBmdW5jdGlvbiByZXF1aXJlcyBhZG1pbmlzdHJhdGl2ZSByaWdodHMgb24gdGhlCiAgICAgICAgbWFjaGluZSB5b3UncmUgZW51bWVyYXRpbmcuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGhvc3RuYW1lIHRvIHF1ZXJ5IGZvciB0aGUgbGFzdCBsb2dnZWQgb24gdXNlci4KICAgICAgICBEZWZhdWx0cyB0byB0aGUgbG9jYWxob3N0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3QgZm9yIHRoZSByZW1vdGUgY29ubmVjdGlvbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1MYXN0TG9nZ2VkT24KCiAgICAgICAgUmV0dXJucyB0aGUgbGFzdCB1c2VyIGxvZ2dlZCBvbnRvIHRoZSBsb2NhbCBtYWNoaW5lLgoKICAgIC5FWEFNUExFCiAgICAgICAgCiAgICAgICAgUFMgQzpcPiBHZXQtTGFzdExvZ2dlZE9uIC1Db21wdXRlck5hbWUgV0lORE9XUzEKCiAgICAgICAgUmV0dXJucyB0aGUgbGFzdCB1c2VyIGxvZ2dlZCBvbnRvIFdJTkRPV1MxCgogICAgLkVYQU1QTEUKICAgICAgICAKICAgICAgICBQUyBDOlw+IEdldC1OZXRDb21wdXRlciB8IEdldC1MYXN0TG9nZ2VkT24KCiAgICAgICAgUmV0dXJucyB0aGUgbGFzdCB1c2VyIGxvZ2dlZCBvbnRvIGFsbCBtYWNoaW5lcyBpbiB0aGUgZG9tYWluLgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3ROYW1lJyldCiAgICAgICAgW09iamVjdFtdXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICdsb2NhbGhvc3QnLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgICMgZXh0cmFjdCB0aGUgY29tcHV0ZXIgbmFtZSBmcm9tIHdoYXRldmVyIG9iamVjdCB3YXMgcGFzc2VkIG9uIHRoZSBwaXBlbGluZQogICAgJENvbXB1dGVyID0gJENvbXB1dGVyTmFtZSB8IEdldC1OYW1lRmllbGQKCiAgICAjIEhLRVlfTE9DQUxfTUFDSElORQogICAgJEhLTE0gPSAyMTQ3NDgzNjUwCgogICAgIyB0cnkgdG8gb3BlbiB1cCB0aGUgcmVtb3RlIHJlZ2lzdHJ5IGtleSB0byBncmFiIHRoZSBsYXN0IGxvZ2dlZCBvbiB1c2VyCiAgICB0cnkgewoKICAgICAgICBpZigkQ3JlZGVudGlhbCkgewogICAgICAgICAgICAkUmVnID0gR2V0LVdtaU9iamVjdCAtTGlzdCAnU3RkUmVnUHJvdicgLU5hbWVzcGFjZSByb290XGRlZmF1bHQgLUNvbXB1dGVybmFtZSAkQ29tcHV0ZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRSZWcgPSBHZXQtV21pT2JqZWN0IC1MaXN0ICdTdGRSZWdQcm92JyAtTmFtZXNwYWNlIHJvb3RcZGVmYXVsdCAtQ29tcHV0ZXJuYW1lICRDb21wdXRlciAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIH0KCiAgICAgICAgJEtleSA9ICJTT0ZUV0FSRVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxBdXRoZW50aWNhdGlvblxMb2dvblVJIgogICAgICAgICRWYWx1ZSA9ICJMYXN0TG9nZ2VkT25Vc2VyIgogICAgICAgICRMYXN0VXNlciA9ICRSZWcuR2V0U3RyaW5nVmFsdWUoJEhLTE0sICRLZXksICRWYWx1ZSkuc1ZhbHVlCgogICAgICAgICRMYXN0TG9nZ2VkT24gPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgJExhc3RMb2dnZWRPbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgogICAgICAgICRMYXN0TG9nZ2VkT24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTGFzdExvZ2dlZE9uJyAkTGFzdFVzZXIKICAgICAgICAkTGFzdExvZ2dlZE9uCiAgICB9CiAgICBjYXRjaCB7CiAgICAgICAgV3JpdGUtV2FybmluZyAiWyFdIEVycm9yIG9wZW5pbmcgcmVtb3RlIHJlZ2lzdHJ5IG9uICRDb21wdXRlci4gUmVtb3RlIHJlZ2lzdHJ5IGxpa2VseSBub3QgZW5hYmxlZC4iCiAgICB9Cn0KCgpmaWx0ZXIgR2V0LUNhY2hlZFJEUENvbm5lY3Rpb24gewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFVzZXMgcmVtb3RlIHJlZ2lzdHJ5IGZ1bmN0aW9uYWxpdHkgdG8gcXVlcnkgYWxsIGVudHJpZXMgZm9yIHRoZQogICAgICAgICJXaW5kb3dzIFJlbW90ZSBEZXNrdG9wIENvbm5lY3Rpb24gQ2xpZW50IiBvbiBhIG1hY2hpbmUsIHNlcGFyYXRlZCBieQogICAgICAgIHVzZXIgYW5kIHRhcmdldCBzZXJ2ZXIuCgogICAgICAgIE5vdGU6IFRoaXMgZnVuY3Rpb24gcmVxdWlyZXMgYWRtaW5pc3RyYXRpdmUgcmlnaHRzIG9uIHRoZQogICAgICAgIG1hY2hpbmUgeW91J3JlIGVudW1lcmF0aW5nLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBob3N0bmFtZSB0byBxdWVyeSBmb3IgUkRQIGNsaWVudCBpbmZvcm1hdGlvbi4KICAgICAgICBEZWZhdWx0cyB0byBsb2NhbGhvc3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBmb3IgdGhlIHJlbW90ZSBjb25uZWN0aW9uLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUNhY2hlZFJEUENvbm5lY3Rpb24KCiAgICAgICAgUmV0dXJucyB0aGUgUkRQIGNvbm5lY3Rpb24gY2xpZW50IGluZm9ybWF0aW9uIGZvciB0aGUgbG9jYWwgbWFjaGluZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1DYWNoZWRSRFBDb25uZWN0aW9uIC1Db21wdXRlck5hbWUgV0lORE9XUzIudGVzdGxhYi5sb2NhbAoKICAgICAgICBSZXR1cm5zIHRoZSBSRFAgY29ubmVjdGlvbiBjbGllbnQgaW5mb3JtYXRpb24gZm9yIHRoZSBXSU5ET1dTMi50ZXN0bGFiLmxvY2FsIG1hY2hpbmUKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1DYWNoZWRSRFBDb25uZWN0aW9uIC1Db21wdXRlck5hbWUgV0lORE9XUzIudGVzdGxhYi5sb2NhbCAtQ3JlZGVudGlhbCAkQ3JlZAoKICAgICAgICBSZXR1cm5zIHRoZSBSRFAgY29ubmVjdGlvbiBjbGllbnQgaW5mb3JtYXRpb24gZm9yIHRoZSBXSU5ET1dTMi50ZXN0bGFiLmxvY2FsIG1hY2hpbmUgdXNpbmcgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldENvbXB1dGVyIHwgR2V0LUNhY2hlZFJEUENvbm5lY3Rpb24KCiAgICAgICAgR2V0IGNhY2hlZCBSRFAgaW5mb3JtYXRpb24gZm9yIGFsbCBtYWNoaW5lcyBpbiB0aGUgZG9tYWluLgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3ROYW1lJyldCiAgICAgICAgW09iamVjdFtdXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICdsb2NhbGhvc3QnLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgICMgZXh0cmFjdCB0aGUgY29tcHV0ZXIgbmFtZSBmcm9tIHdoYXRldmVyIG9iamVjdCB3YXMgcGFzc2VkIG9uIHRoZSBwaXBlbGluZQogICAgJENvbXB1dGVyID0gJENvbXB1dGVyTmFtZSB8IEdldC1OYW1lRmllbGQKCiAgICAjIEhLRVlfVVNFUlMKICAgICRIS1UgPSAyMTQ3NDgzNjUxCgogICAgdHJ5IHsKICAgICAgICBpZigkQ3JlZGVudGlhbCkgewogICAgICAgICAgICAkUmVnID0gR2V0LVdtaU9iamVjdCAtTGlzdCAnU3RkUmVnUHJvdicgLU5hbWVzcGFjZSByb290XGRlZmF1bHQgLUNvbXB1dGVybmFtZSAkQ29tcHV0ZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRSZWcgPSBHZXQtV21pT2JqZWN0IC1MaXN0ICdTdGRSZWdQcm92JyAtTmFtZXNwYWNlIHJvb3RcZGVmYXVsdCAtQ29tcHV0ZXJuYW1lICRDb21wdXRlciAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIH0KCiAgICAgICAgIyBleHRyYWN0IG91dCB0aGUgU0lEcyBvZiBkb21haW4gdXNlcnMgaW4gdGhpcyBoaXZlCiAgICAgICAgJFVzZXJTSURzID0gKCRSZWcuRW51bUtleSgkSEtVLCAiIikpLnNOYW1lcyB8ID8geyAkXyAtbWF0Y2ggJ1MtMS01LTIxLVswLTldKy1bMC05XSstWzAtOV0rLVswLTldKyQnIH0KCiAgICAgICAgZm9yZWFjaCAoJFVzZXJTSUQgaW4gJFVzZXJTSURzKSB7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJFVzZXJOYW1lID0gQ29udmVydC1TaWRUb05hbWUgJFVzZXJTSUQKCiAgICAgICAgICAgICAgICAjIHB1bGwgb3V0IGFsbCB0aGUgY2FjaGVkIFJEUCBjb25uZWN0aW9ucwogICAgICAgICAgICAgICAgJENvbm5lY3Rpb25LZXlzID0gJFJlZy5FbnVtVmFsdWVzKCRIS1UsIiRVc2VyU0lEXFNvZnR3YXJlXE1pY3Jvc29mdFxUZXJtaW5hbCBTZXJ2ZXIgQ2xpZW50XERlZmF1bHQiKS5zTmFtZXMKCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkQ29ubmVjdGlvbiBpbiAkQ29ubmVjdGlvbktleXMpIHsKICAgICAgICAgICAgICAgICAgICAjIG1ha2Ugc3VyZSB0aGlzIGtleSBpcyBhIGNhY2hlZCBjb25uZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgaWYoJENvbm5lY3Rpb24gLW1hdGNoICdNUlUuKicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFRhcmdldFNlcnZlciA9ICRSZWcuR2V0U3RyaW5nVmFsdWUoJEhLVSwgIiRVc2VyU0lEXFNvZnR3YXJlXE1pY3Jvc29mdFxUZXJtaW5hbCBTZXJ2ZXIgQ2xpZW50XERlZmF1bHQiLCAkQ29ubmVjdGlvbikuc1ZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRDb25uZWN0aW9uID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRDb25uZWN0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlck5hbWUnICRVc2VyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRDb25uZWN0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJTSUQnICRVc2VyU0lECiAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVGFyZ2V0U2VydmVyJyAkVGFyZ2V0U2VydmVyCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlcm5hbWVIaW50JyAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRDb25uZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgcHVsbCBvdXQgYWxsIHRoZSBjYWNoZWQgc2VydmVyIGluZm8gd2l0aCB1c2VybmFtZSBoaW50cwogICAgICAgICAgICAgICAgJFNlcnZlcktleXMgPSAkUmVnLkVudW1LZXkoJEhLVSwiJFVzZXJTSURcU29mdHdhcmVcTWljcm9zb2Z0XFRlcm1pbmFsIFNlcnZlciBDbGllbnRcU2VydmVycyIpLnNOYW1lcwoKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRTZXJ2ZXIgaW4gJFNlcnZlcktleXMpIHsKCiAgICAgICAgICAgICAgICAgICAgJFVzZXJuYW1lSGludCA9ICRSZWcuR2V0U3RyaW5nVmFsdWUoJEhLVSwgIiRVc2VyU0lEXFNvZnR3YXJlXE1pY3Jvc29mdFxUZXJtaW5hbCBTZXJ2ZXIgQ2xpZW50XFNlcnZlcnNcJFNlcnZlciIsICdVc2VybmFtZUhpbnQnKS5zVmFsdWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAkRm91bmRDb25uZWN0aW9uID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXIKICAgICAgICAgICAgICAgICAgICAkRm91bmRDb25uZWN0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJOYW1lJyAkVXNlck5hbWUKICAgICAgICAgICAgICAgICAgICAkRm91bmRDb25uZWN0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJTSUQnICRVc2VyU0lECiAgICAgICAgICAgICAgICAgICAgJEZvdW5kQ29ubmVjdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUYXJnZXRTZXJ2ZXInICRTZXJ2ZXIKICAgICAgICAgICAgICAgICAgICAkRm91bmRDb25uZWN0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJuYW1lSGludCcgJFVzZXJuYW1lSGludAogICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gICAKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3I6ICRfIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KICAgIGNhdGNoIHsKICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBhY2Nlc3NpbmcgJENvbXB1dGVyLCBsaWtlbHkgaW5zdWZmaWNpZW50IHBlcm1pc3Npb25zIG9yIGZpcmV3YWxsIHJ1bGVzIG9uIGhvc3Q6ICRfIgogICAgfQp9CgoKZmlsdGVyIEdldC1SZWdpc3RyeU1vdW50ZWREcml2ZSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVXNlcyByZW1vdGUgcmVnaXN0cnkgZnVuY3Rpb25hbGl0eSB0byBxdWVyeSBhbGwgZW50cmllcyBmb3IgdGhlCiAgICAgICAgdGhlIHNhdmVkIG5ldHdvcmsgbW91bnRlZCBkcml2ZSBvbiBhIG1hY2hpbmUsIHNlcGFyYXRlZCBieQogICAgICAgIHVzZXIgYW5kIHRhcmdldCBzZXJ2ZXIuCgogICAgICAgIE5vdGU6IFRoaXMgZnVuY3Rpb24gcmVxdWlyZXMgYWRtaW5pc3RyYXRpdmUgcmlnaHRzIG9uIHRoZQogICAgICAgIG1hY2hpbmUgeW91J3JlIGVudW1lcmF0aW5nLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBob3N0bmFtZSB0byBxdWVyeSBmb3IgUkRQIGNsaWVudCBpbmZvcm1hdGlvbi4KICAgICAgICBEZWZhdWx0cyB0byBsb2NhbGhvc3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBmb3IgdGhlIHJlbW90ZSBjb25uZWN0aW9uLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LVJlZ2lzdHJ5TW91bnRlZERyaXZlCgogICAgICAgIFJldHVybnMgdGhlIHNhdmVkIG5ldHdvcmsgbW91bnRlZCBkcml2ZXMgZm9yIHRoZSBsb2NhbCBtYWNoaW5lLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LVJlZ2lzdHJ5TW91bnRlZERyaXZlIC1Db21wdXRlck5hbWUgV0lORE9XUzIudGVzdGxhYi5sb2NhbAoKICAgICAgICBSZXR1cm5zIHRoZSBzYXZlZCBuZXR3b3JrIG1vdW50ZWQgZHJpdmVzIGZvciB0aGUgV0lORE9XUzIudGVzdGxhYi5sb2NhbCBtYWNoaW5lCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtUmVnaXN0cnlNb3VudGVkRHJpdmUgLUNvbXB1dGVyTmFtZSBXSU5ET1dTMi50ZXN0bGFiLmxvY2FsIC1DcmVkZW50aWFsICRDcmVkCgogICAgICAgIFJldHVybnMgdGhlIHNhdmVkIG5ldHdvcmsgbW91bnRlZCBkcml2ZXMgZm9yIHRoZSBXSU5ET1dTMi50ZXN0bGFiLmxvY2FsIG1hY2hpbmUgdXNpbmcgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldENvbXB1dGVyIHwgR2V0LVJlZ2lzdHJ5TW91bnRlZERyaXZlCgogICAgICAgIEdldCB0aGUgc2F2ZWQgbmV0d29yayBtb3VudGVkIGRyaXZlcyBmb3IgYWxsIG1hY2hpbmVzIGluIHRoZSBkb21haW4uCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbT2JqZWN0W11dCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJ2xvY2FsaG9zdCcsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgIyBleHRyYWN0IHRoZSBjb21wdXRlciBuYW1lIGZyb20gd2hhdGV2ZXIgb2JqZWN0IHdhcyBwYXNzZWQgb24gdGhlIHBpcGVsaW5lCiAgICAkQ29tcHV0ZXIgPSAkQ29tcHV0ZXJOYW1lIHwgR2V0LU5hbWVGaWVsZAoKICAgICMgSEtFWV9VU0VSUwogICAgJEhLVSA9IDIxNDc0ODM2NTEKCiAgICB0cnkgewogICAgICAgIGlmKCRDcmVkZW50aWFsKSB7CiAgICAgICAgICAgICRSZWcgPSBHZXQtV21pT2JqZWN0IC1MaXN0ICdTdGRSZWdQcm92JyAtTmFtZXNwYWNlIHJvb3RcZGVmYXVsdCAtQ29tcHV0ZXJuYW1lICRDb21wdXRlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFJlZyA9IEdldC1XbWlPYmplY3QgLUxpc3QgJ1N0ZFJlZ1Byb3YnIC1OYW1lc3BhY2Ugcm9vdFxkZWZhdWx0IC1Db21wdXRlcm5hbWUgJENvbXB1dGVyIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgfQoKICAgICAgICAjIGV4dHJhY3Qgb3V0IHRoZSBTSURzIG9mIGRvbWFpbiB1c2VycyBpbiB0aGlzIGhpdmUKICAgICAgICAkVXNlclNJRHMgPSAoJFJlZy5FbnVtS2V5KCRIS1UsICIiKSkuc05hbWVzIHwgPyB7ICRfIC1tYXRjaCAnUy0xLTUtMjEtWzAtOV0rLVswLTldKy1bMC05XSstWzAtOV0rJCcgfQoKICAgICAgICBmb3JlYWNoICgkVXNlclNJRCBpbiAkVXNlclNJRHMpIHsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkVXNlck5hbWUgPSBDb252ZXJ0LVNpZFRvTmFtZSAkVXNlclNJRAoKICAgICAgICAgICAgICAgICREcml2ZUxldHRlcnMgPSAoJFJlZy5FbnVtS2V5KCRIS1UsICIkVXNlclNJRFxOZXR3b3JrIikpLnNOYW1lcwoKICAgICAgICAgICAgICAgIEZvckVhY2goJERyaXZlTGV0dGVyIGluICREcml2ZUxldHRlcnMpIHsKICAgICAgICAgICAgICAgICAgICAkUHJvdmlkZXJOYW1lID0gJFJlZy5HZXRTdHJpbmdWYWx1ZSgkSEtVLCAiJFVzZXJTSURcTmV0d29ya1wkRHJpdmVMZXR0ZXIiLCAnUHJvdmlkZXJOYW1lJykuc1ZhbHVlCiAgICAgICAgICAgICAgICAgICAgJFJlbW90ZVBhdGggPSAkUmVnLkdldFN0cmluZ1ZhbHVlKCRIS1UsICIkVXNlclNJRFxOZXR3b3JrXCREcml2ZUxldHRlciIsICdSZW1vdGVQYXRoJykuc1ZhbHVlCiAgICAgICAgICAgICAgICAgICAgJERyaXZlVXNlck5hbWUgPSAkUmVnLkdldFN0cmluZ1ZhbHVlKCRIS1UsICIkVXNlclNJRFxOZXR3b3JrXCREcml2ZUxldHRlciIsICdVc2VyTmFtZScpLnNWYWx1ZQogICAgICAgICAgICAgICAgICAgIGlmKC1ub3QgJFVzZXJOYW1lKSB7ICRVc2VyTmFtZSA9ICcnIH0KCiAgICAgICAgICAgICAgICAgICAgaWYoJFJlbW90ZVBhdGggLWFuZCAoJFJlbW90ZVBhdGggLW5lICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkTW91bnRlZERyaXZlID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAkTW91bnRlZERyaXZlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyCiAgICAgICAgICAgICAgICAgICAgICAgICRNb3VudGVkRHJpdmUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlck5hbWUnICRVc2VyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkTW91bnRlZERyaXZlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJTSUQnICRVc2VyU0lECiAgICAgICAgICAgICAgICAgICAgICAgICRNb3VudGVkRHJpdmUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRHJpdmVMZXR0ZXInICREcml2ZUxldHRlcgogICAgICAgICAgICAgICAgICAgICAgICAkTW91bnRlZERyaXZlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1Byb3ZpZGVyTmFtZScgJFByb3ZpZGVyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkTW91bnRlZERyaXZlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1JlbW90ZVBhdGgnICRSZW1vdGVQYXRoCiAgICAgICAgICAgICAgICAgICAgICAgICRNb3VudGVkRHJpdmUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRHJpdmVVc2VyTmFtZScgJERyaXZlVXNlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJE1vdW50ZWREcml2ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvcjogJF8iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBjYXRjaCB7CiAgICAgICAgV3JpdGUtV2FybmluZyAiRXJyb3IgYWNjZXNzaW5nICRDb21wdXRlciwgbGlrZWx5IGluc3VmZmljaWVudCBwZXJtaXNzaW9ucyBvciBmaXJld2FsbCBydWxlcyBvbiBob3N0OiAkXyIKICAgIH0KfQoKCmZpbHRlciBHZXQtTmV0UHJvY2VzcyB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgR2V0cyBhIGxpc3Qgb2YgcHJvY2Vzc2VzL293bmVycyBvbiBhIHJlbW90ZSBtYWNoaW5lLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBob3N0bmFtZSB0byBxdWVyeSBwcm9jZXNzZXMuIERlZmF1bHRzIHRvIHRoZSBsb2NhbCBob3N0IG5hbWUuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBmb3IgdGhlIHJlbW90ZSBjb25uZWN0aW9uLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldFByb2Nlc3MgLUNvbXB1dGVyTmFtZSBXSU5ET1dTMQogICAgCiAgICAgICAgUmV0dXJucyB0aGUgY3VycmVudCBwcm9jZXNzZXMgZm9yIFdJTkRPV1MxCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbT2JqZWN0W11dCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkQ29tcHV0ZXJOYW1lID0gW1N5c3RlbS5OZXQuRG5zXTo6R2V0SG9zdE5hbWUoKSwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICAjIGV4dHJhY3QgdGhlIGNvbXB1dGVyIG5hbWUgZnJvbSB3aGF0ZXZlciBvYmplY3Qgd2FzIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICRDb21wdXRlciA9ICRDb21wdXRlck5hbWUgfCBHZXQtTmFtZUZpZWxkCgogICAgdHJ5IHsKICAgICAgICBpZigkQ3JlZGVudGlhbCkgewogICAgICAgICAgICAkUHJvY2Vzc2VzID0gR2V0LVdNSW9iamVjdCAtQ2xhc3MgV2luMzJfcHJvY2VzcyAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRQcm9jZXNzZXMgPSBHZXQtV01Jb2JqZWN0IC1DbGFzcyBXaW4zMl9wcm9jZXNzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgIH0KCiAgICAgICAgJFByb2Nlc3NlcyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgJE93bmVyID0gJF8uZ2V0b3duZXIoKTsKICAgICAgICAgICAgJFByb2Nlc3MgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICRQcm9jZXNzIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyCiAgICAgICAgICAgICRQcm9jZXNzIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1Byb2Nlc3NOYW1lJyAkXy5Qcm9jZXNzTmFtZQogICAgICAgICAgICAkUHJvY2VzcyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdQcm9jZXNzSUQnICRfLlByb2Nlc3NJRAogICAgICAgICAgICAkUHJvY2VzcyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEb21haW4nICRPd25lci5Eb21haW4KICAgICAgICAgICAgJFByb2Nlc3MgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlcicgJE93bmVyLlVzZXIKICAgICAgICAgICAgJFByb2Nlc3MgICAgICAgICAgICAgICAgCiAgICAgICAgfQogICAgfQogICAgY2F0Y2ggewogICAgICAgIFdyaXRlLVZlcmJvc2UgIlshXSBFcnJvciBlbnVtZXJhdGluZyByZW1vdGUgcHJvY2Vzc2VzIG9uICRDb21wdXRlciwgYWNjZXNzIGxpa2VseSBkZW5pZWQ6ICRfIgogICAgfQp9CgoKZnVuY3Rpb24gRmluZC1JbnRlcmVzdGluZ0ZpbGUgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFRoaXMgZnVuY3Rpb24gcmVjdXJzaXZlbHkgc2VhcmNoZXMgYSBnaXZlbiBVTkMgcGF0aCBmb3IgZmlsZXMgd2l0aAogICAgICAgIHNwZWNpZmljIGtleXdvcmRzIGluIHRoZSBuYW1lIChkZWZhdWx0IG9mIHBhc3MsIHNlbnNpdGl2ZSwgc2VjcmV0LCBhZG1pbiwKICAgICAgICBsb2dpbiBhbmQgdW5hdHRlbmQqLnhtbCkuIFRoZSBvdXRwdXQgY2FuIGJlIHBpcGVkIG91dCB0byBhIGNzdiB3aXRoIHRoZQogICAgICAgIC1PdXRGaWxlIGZsYWcuIEJ5IGRlZmF1bHQsIGhpZGRlbiBmaWxlcy9mb2xkZXJzIGFyZSBpbmNsdWRlZCBpbiBzZWFyY2ggcmVzdWx0cy4KCiAgICAuUEFSQU1FVEVSIFBhdGgKCiAgICAgICAgVU5DL2xvY2FsIHBhdGggdG8gcmVjdXJzaXZlbHkgc2VhcmNoLgoKICAgIC5QQVJBTUVURVIgVGVybXMKCiAgICAgICAgVGVybXMgdG8gc2VhcmNoIGZvci4KCiAgICAuUEFSQU1FVEVSIE9mZmljZURvY3MKCiAgICAgICAgU3dpdGNoLiBTZWFyY2ggZm9yIG9mZmljZSBkb2N1bWVudHMgKCouZG9jKiwgKi54bHMqLCAqLnBwdCopCgogICAgLlBBUkFNRVRFUiBGcmVzaEVYRXMKCiAgICAgICAgU3dpdGNoLiBGaW5kIC5FWEVzIGFjY2Vzc2VkIHdpdGhpbiB0aGUgbGFzdCB3ZWVrLgoKICAgIC5QQVJBTUVURVIgTGFzdEFjY2Vzc1RpbWUKCiAgICAgICAgT25seSByZXR1cm4gZmlsZXMgd2l0aCBhIExhc3RBY2Nlc3NUaW1lIGdyZWF0ZXIgdGhhbiB0aGlzIGRhdGUgdmFsdWUuCgogICAgLlBBUkFNRVRFUiBMYXN0V3JpdGVUaW1lCgogICAgICAgIE9ubHkgcmV0dXJuIGZpbGVzIHdpdGggYSBMYXN0V3JpdGVUaW1lIGdyZWF0ZXIgdGhhbiB0aGlzIGRhdGUgdmFsdWUuCgogICAgLlBBUkFNRVRFUiBDcmVhdGlvblRpbWUKCiAgICAgICAgT25seSByZXR1cm4gZmlsZXMgd2l0aCBhIENyZWF0aW9uVGltZSBncmVhdGVyIHRoYW4gdGhpcyBkYXRlIHZhbHVlLgoKICAgIC5QQVJBTUVURVIgRXhjbHVkZUZvbGRlcnMKCiAgICAgICAgU3dpdGNoLiBFeGNsdWRlIGZvbGRlcnMgZnJvbSB0aGUgc2VhcmNoIHJlc3VsdHMuCgogICAgLlBBUkFNRVRFUiBFeGNsdWRlSGlkZGVuCgogICAgICAgIFN3aXRjaC4gRXhjbHVkZSBoaWRkZW4gZmlsZXMgYW5kIGZvbGRlcnMgZnJvbSB0aGUgc2VhcmNoIHJlc3VsdHMuCgogICAgLlBBUkFNRVRFUiBDaGVja1dyaXRlQWNjZXNzCgogICAgICAgIFN3aXRjaC4gT25seSByZXR1cm5zIGZpbGVzIHRoZSBjdXJyZW50IHVzZXIgaGFzIHdyaXRlIGFjY2VzcyB0by4KCiAgICAuUEFSQU1FVEVSIE91dEZpbGUKCiAgICAgICAgT3V0cHV0IHJlc3VsdHMgdG8gYSBzcGVjaWZpZWQgY3N2IG91dHB1dCBmaWxlLgoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IHRhcmdldCByZW1vdGUgcGF0aCB3aXRoIHRlbXBvcmFyeSBQU0RyaXZlcy4KCiAgICAuT1VUUFVUUwoKICAgICAgICBUaGUgZnVsbCBwYXRoLCBvd25lciwgbGFzdGFjY2VzcyB0aW1lLCBsYXN0d3JpdGUgdGltZSwgYW5kIHNpemUgZm9yIGVhY2ggZm91bmQgZmlsZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtSW50ZXJlc3RpbmdGaWxlIC1QYXRoIEM6XEJhY2t1cFwKICAgICAgICAKICAgICAgICBSZXR1cm5zIGFueSBmaWxlcyBvbiB0aGUgbG9jYWwgcGF0aCBDOlxCYWNrdXBcIHRoYXQgaGF2ZSB0aGUgZGVmYXVsdAogICAgICAgIHNlYXJjaCB0ZXJtIHNldCBpbiB0aGUgdGl0bGUuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUludGVyZXN0aW5nRmlsZSAtUGF0aCBcXFdJTkRPV1M3XFVzZXJzXCAtVGVybXMgc2FsYXJpZXMsZW1haWwgLU91dEZpbGUgb3V0LmNzdgogICAgICAgIAogICAgICAgIFJldHVybnMgYW55IGZpbGVzIG9uIHRoZSByZW1vdGUgcGF0aCBcXFdJTkRPV1M3XFVzZXJzXCB0aGF0IGhhdmUgJ3NhbGFyaWVzJwogICAgICAgIG9yICdlbWFpbCcgaW4gdGhlIHRpdGxlLCBhbmQgd3JpdGVzIHRoZSByZXN1bHRzIG91dCB0byBhIGNzdiBmaWxlCiAgICAgICAgbmFtZWQgJ291dC5jc3YnCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUludGVyZXN0aW5nRmlsZSAtUGF0aCBcXFdJTkRPV1M3XFVzZXJzXCAtTGFzdEFjY2Vzc1RpbWUgKEdldC1EYXRlKS5BZGREYXlzKC03KQoKICAgICAgICBSZXR1cm5zIGFueSBmaWxlcyBvbiB0aGUgcmVtb3RlIHBhdGggXFxXSU5ET1dTN1xVc2Vyc1wgdGhhdCBoYXZlIHRoZSBkZWZhdWx0CiAgICAgICAgc2VhcmNoIHRlcm0gc2V0IGluIHRoZSB0aXRsZSBhbmQgd2VyZSBhY2Nlc3NlZCB3aXRoaW4gdGhlIGxhc3Qgd2Vlay4KCiAgICAuTElOSwogICAgICAgIAogICAgICAgIGh0dHA6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9yZWR0ZWFtaW5nL2ZpbGUtc2VydmVyLXRyaWFnZS1vbi1yZWQtdGVhbS1lbmdhZ2VtZW50cy8KIz4KICAgIAogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkUGF0aCA9ICcuXCcsCgogICAgICAgIFtBbGlhcygnVGVybXMnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJFNlYXJjaFRlcm1zID0gQCgncGFzcycsICdzZW5zaXRpdmUnLCAnYWRtaW4nLCAnbG9naW4nLCAnc2VjcmV0JywgJ3VuYXR0ZW5kKi54bWwnLCAnLnZtZGsnLCAnY3JlZHMnLCAnY3JlZGVudGlhbCcsICcuY29uZmlnJyksCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJE9mZmljZURvY3MsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEZyZXNoRVhFcywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkTGFzdEFjY2Vzc1RpbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJExhc3RXcml0ZVRpbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENyZWF0aW9uVGltZSwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRXhjbHVkZUZvbGRlcnMsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEV4Y2x1ZGVIaWRkZW4sCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJENoZWNrV3JpdGVBY2Nlc3MsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE91dEZpbGUsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVzZVBTRHJpdmUKICAgICkKCiAgICBiZWdpbiB7CgogICAgICAgICRQYXRoICs9IGlmKCEkUGF0aC5FbmRzV2l0aCgnXCcpKSB7IlwifQoKICAgICAgICBpZiAoJENyZWRlbnRpYWwpIHsKICAgICAgICAgICAgJFVzZVBTRHJpdmUgPSAkVHJ1ZQogICAgICAgIH0KCiAgICAgICAgIyBhcHBlbmQgd2lsZGNhcmRzIHRvIHRoZSBmcm9udCBhbmQgYmFjayBvZiBhbGwgc2VhcmNoIHRlcm1zCiAgICAgICAgJFNlYXJjaFRlcm1zID0gJFNlYXJjaFRlcm1zIHwgRm9yRWFjaC1PYmplY3QgeyBpZigkXyAtbm90bWF0Y2ggJ15cKi4qXCokJykgeyIqJCgkXykqIn0gZWxzZXskX30gfQoKICAgICAgICAjIHNlYXJjaCBqdXN0IGZvciBvZmZpY2UgZG9jdW1lbnRzIGlmIHNwZWNpZmllZAogICAgICAgIGlmICgkT2ZmaWNlRG9jcykgewogICAgICAgICAgICAkU2VhcmNoVGVybXMgPSBAKCcqLmRvYycsICcqLmRvY3gnLCAnKi54bHMnLCAnKi54bHN4JywgJyoucHB0JywgJyoucHB0eCcpCiAgICAgICAgfQoKICAgICAgICAjIGZpbmQgLmV4ZSdzIGFjY2Vzc2VkIHdpdGhpbiB0aGUgbGFzdCA3IGRheXMKICAgICAgICBpZigkRnJlc2hFWEVzKSB7CiAgICAgICAgICAgICMgZ2V0IGFuIGFjY2VzcyB0aW1lIGxpbWl0IG9mIDcgZGF5cyBhZ28KICAgICAgICAgICAgJExhc3RBY2Nlc3NUaW1lID0gKEdldC1EYXRlKS5BZGREYXlzKC03KS5Ub1N0cmluZygnTU0vZGQveXl5eScpCiAgICAgICAgICAgICRTZWFyY2hUZXJtcyA9ICcqLmV4ZScKICAgICAgICB9CgogICAgICAgIGlmKCRVc2VQU0RyaXZlKSB7CiAgICAgICAgICAgICMgaWYgd2UncmUgUFNEcml2ZXMsIGNyZWF0ZSBhIHRlbXBvcmFyeSBtb3VudCBwb2ludAoKICAgICAgICAgICAgJFBhcnRzID0gJFBhdGguc3BsaXQoJ1wnKQogICAgICAgICAgICAkRm9sZGVyUGF0aCA9ICRQYXJ0c1swLi4oJFBhcnRzLmxlbmd0aC0yKV0gLWpvaW4gJ1wnCiAgICAgICAgICAgICRGaWxlUGF0aCA9ICRQYXJ0c1stMV0KCiAgICAgICAgICAgICRSYW5kRHJpdmUgPSAoImFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6Ii5Ub0NoYXJBcnJheSgpIHwgR2V0LVJhbmRvbSAtQ291bnQgNykgLWpvaW4gJycKICAgICAgICAgICAgCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIk1vdW50aW5nIHBhdGggJyRQYXRoJyB1c2luZyBhIHRlbXAgUFNEcml2ZSBhdCAkUmFuZERyaXZlIgoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICROdWxsID0gTmV3LVBTRHJpdmUgLU5hbWUgJFJhbmREcml2ZSAtUFNQcm92aWRlciBGaWxlU3lzdGVtIC1Sb290ICRGb2xkZXJQYXRoIC1FcnJvckFjdGlvbiBTdG9wCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgbW91bnRpbmcgcGF0aCAnJFBhdGgnIDogJF8iCiAgICAgICAgICAgICAgICByZXR1cm4gJE51bGwKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzbyB3ZSBjYW4gY2QvZGlyIHRoZSBuZXcgZHJpdmUKICAgICAgICAgICAgJFBhdGggPSAiJHtSYW5kRHJpdmV9Olwke0ZpbGVQYXRofSIKICAgICAgICB9CiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBTZWFyY2ggcGF0aCAkUGF0aCIKCiAgICAgICAgZnVuY3Rpb24gSW52b2tlLUNoZWNrV3JpdGUgewogICAgICAgICAgICAjIHNob3J0IGhlbHBlciB0byBjaGVjayBpcyB0aGUgY3VycmVudCB1c2VyIGNhbiB3cml0ZSB0byBhIGZpbGUKICAgICAgICAgICAgW0NtZGxldEJpbmRpbmcoKV1wYXJhbShbU3RyaW5nXSRQYXRoKQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJEZpbGV0ZXN0ID0gW0lPLkZJTEVdOjpPcGVuV3JpdGUoJFBhdGgpCiAgICAgICAgICAgICAgICAkRmlsZXRlc3QuQ2xvc2UoKQogICAgICAgICAgICAgICAgJFRydWUKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICRFcnJvclswXQogICAgICAgICAgICAgICAgJEZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRTZWFyY2hBcmdzID0gIEB7CiAgICAgICAgICAgICdQYXRoJyA9ICRQYXRoCiAgICAgICAgICAgICdSZWN1cnNlJyA9ICRUcnVlCiAgICAgICAgICAgICdGb3JjZScgPSAkKC1ub3QgJEV4Y2x1ZGVIaWRkZW4pCiAgICAgICAgICAgICdJbmNsdWRlJyA9ICRTZWFyY2hUZXJtcwogICAgICAgICAgICAnRXJyb3JBY3Rpb24nID0gJ1NpbGVudGx5Q29udGludWUnCiAgICAgICAgfQoKICAgICAgICBHZXQtQ2hpbGRJdGVtIEBTZWFyY2hBcmdzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICRfCiAgICAgICAgICAgICMgY2hlY2sgaWYgd2UncmUgZXhjbHVkaW5nIGZvbGRlcnMKICAgICAgICAgICAgaWYoISRFeGNsdWRlRm9sZGVycyAtb3IgISRfLlBTSXNDb250YWluZXIpIHskX30KICAgICAgICB9IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICBpZigkTGFzdEFjY2Vzc1RpbWUgLW9yICRMYXN0V3JpdGVUaW1lIC1vciAkQ3JlYXRpb25UaW1lKSB7CiAgICAgICAgICAgICAgICBpZigkTGFzdEFjY2Vzc1RpbWUgLWFuZCAoJF8uTGFzdEFjY2Vzc1RpbWUgLWd0ICRMYXN0QWNjZXNzVGltZSkpIHskX30KICAgICAgICAgICAgICAgIGVsc2VpZigkTGFzdFdyaXRlVGltZSAtYW5kICgkXy5MYXN0V3JpdGVUaW1lIC1ndCAkTGFzdFdyaXRlVGltZSkpIHskX30KICAgICAgICAgICAgICAgIGVsc2VpZigkQ3JlYXRpb25UaW1lIC1hbmQgKCRfLkNyZWF0aW9uVGltZSAtZ3QgJENyZWF0aW9uVGltZSkpIHskX30KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHskX30KICAgICAgICB9IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAjIGZpbHRlciBmb3Igd3JpdGUgYWNjZXNzIChpZiBhcHBsaWNhYmxlKQogICAgICAgICAgICBpZigoLW5vdCAkQ2hlY2tXcml0ZUFjY2VzcykgLW9yIChJbnZva2UtQ2hlY2tXcml0ZSAtUGF0aCAkXy5GdWxsTmFtZSkpIHskX30KICAgICAgICB9IHwgU2VsZWN0LU9iamVjdCBGdWxsTmFtZSxAe05hbWU9J093bmVyJztFeHByZXNzaW9uPXsoR2V0LUFjbCAkXy5GdWxsTmFtZSkuT3duZXJ9fSxMYXN0QWNjZXNzVGltZSxMYXN0V3JpdGVUaW1lLENyZWF0aW9uVGltZSxMZW5ndGggfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICMgY2hlY2sgaWYgd2UncmUgb3V0cHV0dGluZyB0byB0aGUgcGlwZWxpbmUgb3IgYW4gb3V0cHV0IGZpbGUKICAgICAgICAgICAgaWYoJE91dEZpbGUpIHtFeHBvcnQtUG93ZXJWaWV3Q1NWIC1JbnB1dE9iamVjdCAkXyAtT3V0RmlsZSAkT3V0RmlsZX0KICAgICAgICAgICAgZWxzZSB7JF99CiAgICAgICAgfQogICAgfQoKICAgIGVuZCB7CiAgICAgICAgaWYoJFVzZVBTRHJpdmUgLWFuZCAkUmFuZERyaXZlKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlJlbW92aW5nIHRlbXAgUFNEcml2ZSAkUmFuZERyaXZlIgogICAgICAgICAgICBHZXQtUFNEcml2ZSAtTmFtZSAkUmFuZERyaXZlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgUmVtb3ZlLVBTRHJpdmUgLUZvcmNlCiAgICAgICAgfQogICAgfQp9CgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojICdNZXRhJy1mdW5jdGlvbnMgc3RhcnQgYmVsb3cKIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZnVuY3Rpb24gSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gewogICAgIyBIZWxwZXIgdXNlZCBieSBhbnkgdGhyZWFkZWQgaG9zdCBlbnVtZXJhdGlvbiBmdW5jdGlvbnMKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsTWFuZGF0b3J5PSRUcnVlKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0xLE1hbmRhdG9yeT0kVHJ1ZSldCiAgICAgICAgW1N5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uU2NyaXB0QmxvY2tdCiAgICAgICAgJFNjcmlwdEJsb2NrLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTIpXQogICAgICAgIFtIYXNodGFibGVdCiAgICAgICAgJFNjcmlwdFBhcmFtZXRlcnMsCgogICAgICAgIFtJbnRdCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDApXSAKICAgICAgICAkVGhyZWFkcyA9IDIwLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICROb0ltcG9ydHMKICAgICkKCiAgICBiZWdpbiB7CgogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0RlYnVnJ10pIHsKICAgICAgICAgICAgJERlYnVnUHJlZmVyZW5jZSA9ICdDb250aW51ZScKICAgICAgICB9CgogICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBUb3RhbCBudW1iZXIgb2YgaG9zdHM6ICQoJENvbXB1dGVyTmFtZS5jb3VudCkiCgogICAgICAgICMgQWRhcHRlZCBmcm9tOgogICAgICAgICMgICBodHRwOi8vcG93ZXJzaGVsbC5vcmcvd3AvZm9ydW1zL3RvcGljL2ludnBrZS1wYXJhbGxlbC1uZWVkLWhlbHAtdG8tY2xvbmUtdGhlLWN1cnJlbnQtcnVuc3BhY2UvCiAgICAgICAgJFNlc3Npb25TdGF0ZSA9IFtTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlJ1bnNwYWNlcy5Jbml0aWFsU2Vzc2lvblN0YXRlXTo6Q3JlYXRlRGVmYXVsdCgpCiAgICAgICAgJFNlc3Npb25TdGF0ZS5BcGFydG1lbnRTdGF0ZSA9IFtTeXN0ZW0uVGhyZWFkaW5nLlRocmVhZF06OkN1cnJlbnRUaHJlYWQuR2V0QXBhcnRtZW50U3RhdGUoKQoKICAgICAgICAjIGltcG9ydCB0aGUgY3VycmVudCBzZXNzaW9uIHN0YXRlJ3MgdmFyaWFibGVzIGFuZCBmdW5jdGlvbnMgc28gdGhlIGNoYWluZWQgUG93ZXJWaWV3CiAgICAgICAgIyAgIGZ1bmN0aW9uYWxpdHkgY2FuIGJlIHVzZWQgYnkgdGhlIHRocmVhZGVkIGJsb2NrcwogICAgICAgIGlmKCEkTm9JbXBvcnRzKSB7CgogICAgICAgICAgICAjIGdyYWIgYWxsIHRoZSBjdXJyZW50IHZhcmlhYmxlcyBmb3IgdGhpcyBydW5zcGFjZQogICAgICAgICAgICAkTXlWYXJzID0gR2V0LVZhcmlhYmxlIC1TY29wZSAyCgogICAgICAgICAgICAjIHRoZXNlIFZhcmlhYmxlcyBhcmUgYWRkZWQgYnkgUnVuc3BhY2UuT3BlbigpIE1ldGhvZCBhbmQgcHJvZHVjZSBTdG9wIGVycm9ycyBpZiB5b3UgYWRkIHRoZW0gdHdpY2UKICAgICAgICAgICAgJFZvcmJpZGRlblZhcnMgPSBAKCI/IiwiYXJncyIsIkNvbnNvbGVGaWxlTmFtZSIsIkVycm9yIiwiRXhlY3V0aW9uQ29udGV4dCIsImZhbHNlIiwiSE9NRSIsIkhvc3QiLCJpbnB1dCIsIklucHV0T2JqZWN0IiwiTWF4aW11bUFsaWFzQ291bnQiLCJNYXhpbXVtRHJpdmVDb3VudCIsIk1heGltdW1FcnJvckNvdW50IiwiTWF4aW11bUZ1bmN0aW9uQ291bnQiLCJNYXhpbXVtSGlzdG9yeUNvdW50IiwiTWF4aW11bVZhcmlhYmxlQ291bnQiLCJNeUludm9jYXRpb24iLCJudWxsIiwiUElEIiwiUFNCb3VuZFBhcmFtZXRlcnMiLCJQU0NvbW1hbmRQYXRoIiwiUFNDdWx0dXJlIiwiUFNEZWZhdWx0UGFyYW1ldGVyVmFsdWVzIiwiUFNIT01FIiwiUFNTY3JpcHRSb290IiwiUFNVSUN1bHR1cmUiLCJQU1ZlcnNpb25UYWJsZSIsIlBXRCIsIlNoZWxsSWQiLCJTeW5jaHJvbml6ZWRIYXNoIiwidHJ1ZSIpCgogICAgICAgICAgICAjIEFkZCBWYXJpYWJsZXMgZnJvbSBQYXJlbnQgU2NvcGUgKGN1cnJlbnQgcnVuc3BhY2UpIGludG8gdGhlIEluaXRpYWxTZXNzaW9uU3RhdGUKICAgICAgICAgICAgRm9yRWFjaCgkVmFyIGluICRNeVZhcnMpIHsKICAgICAgICAgICAgICAgIGlmKCRWb3JiaWRkZW5WYXJzIC1Ob3RDb250YWlucyAkVmFyLk5hbWUpIHsKICAgICAgICAgICAgICAgICRTZXNzaW9uU3RhdGUuVmFyaWFibGVzLkFkZCgoTmV3LU9iamVjdCAtVHlwZU5hbWUgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5SdW5zcGFjZXMuU2Vzc2lvblN0YXRlVmFyaWFibGVFbnRyeSAtQXJndW1lbnRMaXN0ICRWYXIubmFtZSwkVmFyLlZhbHVlLCRWYXIuZGVzY3JpcHRpb24sJFZhci5vcHRpb25zLCRWYXIuYXR0cmlidXRlcykpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgQWRkIEZ1bmN0aW9ucyBmcm9tIGN1cnJlbnQgcnVuc3BhY2UgdG8gdGhlIEluaXRpYWxTZXNzaW9uU3RhdGUKICAgICAgICAgICAgRm9yRWFjaCgkRnVuY3Rpb24gaW4gKEdldC1DaGlsZEl0ZW0gRnVuY3Rpb246KSkgewogICAgICAgICAgICAgICAgJFNlc3Npb25TdGF0ZS5Db21tYW5kcy5BZGQoKE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUnVuc3BhY2VzLlNlc3Npb25TdGF0ZUZ1bmN0aW9uRW50cnkgLUFyZ3VtZW50TGlzdCAkRnVuY3Rpb24uTmFtZSwgJEZ1bmN0aW9uLkRlZmluaXRpb24pKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHRocmVhZGluZyBhZGFwdGVkIGZyb20KICAgICAgICAjIGh0dHBzOi8vZ2l0aHViLmNvbS9kYXJrb3BlcmF0b3IvUG9zaC1TZWNNb2QvYmxvYi9tYXN0ZXIvRGlzY292ZXJ5L0Rpc2NvdmVyeS5wc20xI0w0MDcKICAgICAgICAjICAgVGhhbmtzIENhcmxvcyEKCiAgICAgICAgIyBjcmVhdGUgYSBwb29sIG9mIG1heFRocmVhZCBydW5zcGFjZXMKICAgICAgICAkUG9vbCA9IFtydW5zcGFjZWZhY3RvcnldOjpDcmVhdGVSdW5zcGFjZVBvb2woMSwgJFRocmVhZHMsICRTZXNzaW9uU3RhdGUsICRIb3N0KQogICAgICAgICRQb29sLk9wZW4oKQoKICAgICAgICAkbWV0aG9kID0gJG51bGwKICAgICAgICBGb3JFYWNoICgkbSBpbiBbUG93ZXJTaGVsbF0uR2V0TWV0aG9kcygpIHwgV2hlcmUtT2JqZWN0IHsgJF8uTmFtZSAtZXEgIkJlZ2luSW52b2tlIiB9KSB7CiAgICAgICAgICAgICRtZXRob2RQYXJhbWV0ZXJzID0gJG0uR2V0UGFyYW1ldGVycygpCiAgICAgICAgICAgIGlmICgoJG1ldGhvZFBhcmFtZXRlcnMuQ291bnQgLWVxIDIpIC1hbmQgJG1ldGhvZFBhcmFtZXRlcnNbMF0uTmFtZSAtZXEgImlucHV0IiAtYW5kICRtZXRob2RQYXJhbWV0ZXJzWzFdLk5hbWUgLWVxICJvdXRwdXQiKSB7CiAgICAgICAgICAgICAgICAkbWV0aG9kID0gJG0uTWFrZUdlbmVyaWNNZXRob2QoW09iamVjdF0sIFtPYmplY3RdKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJEpvYnMgPSBAKCkKICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgRm9yRWFjaCAoJENvbXB1dGVyIGluICRDb21wdXRlck5hbWUpIHsKCiAgICAgICAgICAgICMgbWFrZSBzdXJlIHdlIGdldCBhIHNlcnZlciBuYW1lCiAgICAgICAgICAgIGlmICgkQ29tcHV0ZXIgLW5lICcnKSB7CiAgICAgICAgICAgICAgICAjIFdyaXRlLVZlcmJvc2UgIlsqXSBFbnVtZXJhdGluZyBzZXJ2ZXIgJENvbXB1dGVyICgkKCRDb3VudGVyKzEpIG9mICQoJENvbXB1dGVyTmFtZS5jb3VudCkpIgoKICAgICAgICAgICAgICAgIFdoaWxlICgkKCRQb29sLkdldEF2YWlsYWJsZVJ1bnNwYWNlcygpKSAtbGUgMCkgewogICAgICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1NaWxsaVNlY29uZHMgNTAwCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBjcmVhdGUgYSAicG93ZXJzaGVsbCBwaXBlbGluZSBydW5uZXIiCiAgICAgICAgICAgICAgICAkcCA9IFtwb3dlcnNoZWxsXTo6Y3JlYXRlKCkKCiAgICAgICAgICAgICAgICAkcC5ydW5zcGFjZXBvb2wgPSAkUG9vbAoKICAgICAgICAgICAgICAgICMgYWRkIHRoZSBzY3JpcHQgYmxvY2sgKyBhcmd1bWVudHMKICAgICAgICAgICAgICAgICROdWxsID0gJHAuQWRkU2NyaXB0KCRTY3JpcHRCbG9jaykuQWRkUGFyYW1ldGVyKCdDb21wdXRlck5hbWUnLCAkQ29tcHV0ZXIpCiAgICAgICAgICAgICAgICBpZigkU2NyaXB0UGFyYW1ldGVycykgewogICAgICAgICAgICAgICAgICAgIEZvckVhY2ggKCRQYXJhbSBpbiAkU2NyaXB0UGFyYW1ldGVycy5HZXRFbnVtZXJhdG9yKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE51bGwgPSAkcC5BZGRQYXJhbWV0ZXIoJFBhcmFtLk5hbWUsICRQYXJhbS5WYWx1ZSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJG8gPSBOZXctT2JqZWN0IE1hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0RhdGFDb2xsZWN0aW9uW09iamVjdF0KCiAgICAgICAgICAgICAgICAkSm9icyArPSBAewogICAgICAgICAgICAgICAgICAgIFBTID0gJHAKICAgICAgICAgICAgICAgICAgICBPdXRwdXQgPSAkbwogICAgICAgICAgICAgICAgICAgIFJlc3VsdCA9ICRtZXRob2QuSW52b2tlKCRwLCBAKCRudWxsLCBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTRGF0YUNvbGxlY3Rpb25bT2JqZWN0XV0kbykpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZW5kIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJXYWl0aW5nIGZvciB0aHJlYWRzIHRvIGZpbmlzaC4uLiIKCiAgICAgICAgRG8gewogICAgICAgICAgICBGb3JFYWNoICgkSm9iIGluICRKb2JzKSB7CiAgICAgICAgICAgICAgICAkSm9iLk91dHB1dC5SZWFkQWxsKCkKICAgICAgICAgICAgfQogICAgICAgIH0gV2hpbGUgKCgkSm9icyB8IFdoZXJlLU9iamVjdCB7ICEgJF8uUmVzdWx0LklzQ29tcGxldGVkIH0pLkNvdW50IC1ndCAwKQoKICAgICAgICBGb3JFYWNoICgkSm9iIGluICRKb2JzKSB7CiAgICAgICAgICAgICRKb2IuUFMuRGlzcG9zZSgpCiAgICAgICAgfQoKICAgICAgICAkUG9vbC5EaXNwb3NlKCkKICAgICAgICBXcml0ZS1WZXJib3NlICJBbGwgdGhyZWFkcyBjb21wbGV0ZWQhIgogICAgfQp9CgoKZnVuY3Rpb24gSW52b2tlLVVzZXJIdW50ZXIgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEZpbmRzIHdoaWNoIG1hY2hpbmVzIHVzZXJzIG9mIGEgc3BlY2lmaWVkIGdyb3VwIGFyZSBsb2dnZWQgaW50by4KCiAgICAgICAgQXV0aG9yOiBAaGFybWoweQogICAgICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQoKICAgIC5ERVNDUklQVElPTgoKICAgICAgICBUaGlzIGZ1bmN0aW9uIGZpbmRzIHRoZSBsb2NhbCBkb21haW4gbmFtZSBmb3IgYSBob3N0IHVzaW5nIEdldC1OZXREb21haW4sCiAgICAgICAgcXVlcmllcyB0aGUgZG9tYWluIGZvciB1c2VycyBvZiBhIHNwZWNpZmllZCBncm91cCAoZGVmYXVsdCAiZG9tYWluIGFkbWlucyIpCiAgICAgICAgd2l0aCBHZXQtTmV0R3JvdXBNZW1iZXIgb3IgcmVhZHMgaW4gYSB0YXJnZXQgdXNlciBsaXN0LCBxdWVyaWVzIHRoZSBkb21haW4gZm9yIGFsbAogICAgICAgIGFjdGl2ZSBtYWNoaW5lcyB3aXRoIEdldC1OZXRDb21wdXRlciBvciByZWFkcyBpbiBhIHByZS1wb3B1bGF0ZWQgaG9zdCBsaXN0LAogICAgICAgIHJhbmRvbWx5IHNodWZmbGVzIHRoZSB0YXJnZXQgbGlzdCwgdGhlbiBmb3IgZWFjaCBzZXJ2ZXIgaXQgZ2V0cyBhIGxpc3Qgb2YKICAgICAgICBhY3RpdmUgdXNlcnMgd2l0aCBHZXQtTmV0U2Vzc2lvbi9HZXQtTmV0TG9nZ2Vkb24uIFRoZSBmb3VuZCB1c2VyIGxpc3QgaXMgY29tcGFyZWQKICAgICAgICBhZ2FpbnN0IHRoZSB0YXJnZXQgbGlzdCwgYW5kIGEgc3RhdHVzIG1lc3NhZ2UgaXMgZGlzcGxheWVkIGZvciBhbnkgaGl0cy4KICAgICAgICBUaGUgZmxhZyAtQ2hlY2tBY2Nlc3Mgd2lsbCBjaGVjayBlYWNoIHBvc2l0aXZlIGhvc3QgdG8gc2VlIGlmIHRoZSBjdXJyZW50CiAgICAgICAgdXNlciBoYXMgbG9jYWwgYWRtaW4gYWNjZXNzIHRvIHRoZSBtYWNoaW5lLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIEhvc3QgYXJyYXkgdG8gZW51bWVyYXRlLCBwYXNzYWJsZSBvbiB0aGUgcGlwZWxpbmUuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckZpbGUKCiAgICAgICAgRmlsZSBvZiBob3N0bmFtZXMvSVBzIHRvIHNlYXJjaC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsdGVyCgogICAgICAgIEhvc3QgZmlsdGVyIG5hbWUgdG8gcXVlcnkgQUQgZm9yLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoIGZvciBob3N0cywgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIFVuY29uc3RyYWluZWQKCiAgICAgICAgU3dpdGNoLiBPbmx5IGVudW1lcmF0ZSBjb21wdXRlcnMgdGhhdCBoYXZlIHVuY29uc3RyYWluZWQgZGVsZWdhdGlvbi4KCiAgICAuUEFSQU1FVEVSIEdyb3VwTmFtZQoKICAgICAgICBHcm91cCBuYW1lIHRvIHF1ZXJ5IGZvciB0YXJnZXQgdXNlcnMuCgogICAgLlBBUkFNRVRFUiBUYXJnZXRTZXJ2ZXIKCiAgICAgICAgSHVudCBmb3IgdXNlcnMgd2hvIGFyZSBlZmZlY3RpdmUgbG9jYWwgYWRtaW5zIG9uIGEgdGFyZ2V0IHNlcnZlci4KCiAgICAuUEFSQU1FVEVSIFVzZXJOYW1lCgogICAgICAgIFNwZWNpZmljIHVzZXJuYW1lIHRvIHNlYXJjaCBmb3IuCgogICAgLlBBUkFNRVRFUiBVc2VyRmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlIGZvciB1c2VyIGVudW1lcmF0aW9uLCBlLmcuICIoZGVzY3JpcHRpb249KmFkbWluKikiCgogICAgLlBBUkFNRVRFUiBVc2VyQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIHVzZXJzLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgVXNlckZpbGUKCiAgICAgICAgRmlsZSBvZiB1c2VybmFtZXMgdG8gc2VhcmNoIGZvci4KCiAgICAuUEFSQU1FVEVSIEFkbWluQ291bnQKCiAgICAgICAgU3dpdGNoLiBIdW50IGZvciB1c2VycyB3aXRoIGFkbWluQ291bnQ9MS4KCiAgICAuUEFSQU1FVEVSIEFsbG93RGVsZWdhdGlvbgoKICAgICAgICBTd2l0Y2guIFJldHVybiB1c2VyIGFjY291bnRzIHRoYXQgYXJlIG5vdCBtYXJrZWQgYXMgJ3NlbnNpdGl2ZSBhbmQgbm90IGFsbG93ZWQgZm9yIGRlbGVnYXRpb24nCgogICAgLlBBUkFNRVRFUiBTdG9wT25TdWNjZXNzCgogICAgICAgIFN3aXRjaC4gU3RvcCBodW50aW5nIGFmdGVyIGZpbmRpbmcgYWZ0ZXIgZmluZGluZyBhIHRhcmdldCB1c2VyLgoKICAgIC5QQVJBTUVURVIgTm9QaW5nCgogICAgICAgIERvbid0IHBpbmcgZWFjaCBob3N0IHRvIGVuc3VyZSBpdCdzIHVwIGJlZm9yZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIENoZWNrQWNjZXNzCgogICAgICAgIFN3aXRjaC4gQ2hlY2sgaWYgdGhlIGN1cnJlbnQgdXNlciBoYXMgbG9jYWwgYWRtaW4gYWNjZXNzIHRvIGZvdW5kIG1hY2hpbmVzLgoKICAgIC5QQVJBTUVURVIgRGVsYXkKCiAgICAgICAgRGVsYXkgYmV0d2VlbiBlbnVtZXJhdGluZyBob3N0cywgZGVmYXVsdHMgdG8gMAoKICAgIC5QQVJBTUVURVIgSml0dGVyCgogICAgICAgIEppdHRlciBmb3IgdGhlIGhvc3QgZGVsYXksIGRlZmF1bHRzIHRvICsvLSAwLjMKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBEb21haW4gZm9yIHF1ZXJ5IGZvciBtYWNoaW5lcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgU2hvd0FsbAoKICAgICAgICBTd2l0Y2guIFJldHVybiBhbGwgdXNlciBsb2NhdGlvbiByZXN1bHRzLCBpLmUuIEludm9rZS1Vc2VyVmlldyBmdW5jdGlvbmFsaXR5LgoKICAgIC5QQVJBTUVURVIgU2VhcmNoRm9yZXN0CgogICAgICAgIFN3aXRjaC4gU2VhcmNoIGFsbCBkb21haW5zIGluIHRoZSBmb3Jlc3QgZm9yIHRhcmdldCB1c2VycyBpbnN0ZWFkIG9mIGp1c3QKICAgICAgICBhIHNpbmdsZSBkb21haW4uCgogICAgLlBBUkFNRVRFUiBTdGVhbHRoCgogICAgICAgIFN3aXRjaC4gT25seSBlbnVtZXJhdGUgc2Vzc2lvbnMgZnJvbSBjb25ub25seSB1c2VkIHRhcmdldCBzZXJ2ZXJzLgoKICAgIC5QQVJBTUVURVIgU3RlYWx0aFNvdXJjZQoKICAgICAgICBUaGUgc291cmNlIG9mIHRhcmdldCBzZXJ2ZXJzIHRvIHVzZSwgJ0RGUycgKGRpc3RyaWJ1dGVkIGZpbGUgc2VydmVycyksCiAgICAgICAgJ0RDJyAoZG9tYWluIGNvbnRyb2xsZXJzKSwgJ0ZpbGUnIChmaWxlIHNlcnZlcnMpLCBvciAnQWxsJwoKICAgIC5QQVJBTUVURVIgRm9yZWlnblVzZXJzCgogICAgICAgIFN3aXRjaC4gT25seSByZXR1cm4gcmVzdWx0cyB0aGF0IGFyZSBub3QgcGFydCBvZiBzZWFyY2hlZCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBUaHJlYWRzCgogICAgICAgIFRoZSBtYXhpbXVtIGNvbmN1cnJlbnQgdGhyZWFkcyB0byBleGVjdXRlLgoKICAgIC5QQVJBTUVURVIgUG9sbAoKICAgICAgICBDb250aW51b3VzbHkgcG9sbCBmb3Igc2Vzc2lvbnMgZm9yIHRoZSBnaXZlbiBkdXJhdGlvbi4gQXV0b21hdGljYWxseQogICAgICAgIHNldHMgVGhyZWFkcyB0byB0aGUgbnVtYmVyIG9mIGNvbXB1dGVycyBiZWluZyBwb2xsZWQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtVXNlckh1bnRlciAtQ2hlY2tBY2Nlc3MKCiAgICAgICAgRmluZHMgbWFjaGluZXMgb24gdGhlIGxvY2FsIGRvbWFpbiB3aGVyZSBkb21haW4gYWRtaW5zIGFyZSBsb2dnZWQgaW50bwogICAgICAgIGFuZCBjaGVja3MgaWYgdGhlIGN1cnJlbnQgdXNlciBoYXMgbG9jYWwgYWRtaW5pc3RyYXRvciBhY2Nlc3MuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtVXNlckh1bnRlciAtRG9tYWluICd0ZXN0aW5nJwoKICAgICAgICBGaW5kcyBtYWNoaW5lcyBvbiB0aGUgJ3Rlc3RpbmcnIGRvbWFpbiB3aGVyZSBkb21haW4gYWRtaW5zIGFyZSBsb2dnZWQgaW50by4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1Vc2VySHVudGVyIC1UaHJlYWRzIDIwCgogICAgICAgIE11bHRpLXRocmVhZGVkIHVzZXIgaHVudGluZywgcmVwbGFjZXMgSW52b2tlLVVzZXJIdW50ZXJUaHJlYWRlZC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1Vc2VySHVudGVyIC1Vc2VyRmlsZSB1c2Vycy50eHQgLUNvbXB1dGVyRmlsZSBob3N0cy50eHQKCiAgICAgICAgRmluZHMgbWFjaGluZXMgaW4gaG9zdHMudHh0IHdoZXJlIGFueSBtZW1iZXJzIG9mIHVzZXJzLnR4dCBhcmUgbG9nZ2VkIGluCiAgICAgICAgb3IgaGF2ZSBzZXNzaW9ucy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1Vc2VySHVudGVyIC1Hcm91cE5hbWUgIlBvd2VyIFVzZXJzIiAtRGVsYXkgNjAKCiAgICAgICAgRmluZCBtYWNoaW5lcyBvbiB0aGUgZG9tYWluIHdoZXJlIG1lbWJlcnMgb2YgdGhlICJQb3dlciBVc2VycyIgZ3JvdXBzIGFyZQogICAgICAgIGxvZ2dlZCBpbnRvIHdpdGggYSA2MCBzZWNvbmQgKCsvLSAqLjMpIHJhbmRvbWl6ZWQgZGVsYXkgYmV0d2VlbgogICAgICAgIHRvdWNoaW5nIGVhY2ggaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1Vc2VySHVudGVyIC1UYXJnZXRTZXJ2ZXIgRklMRVNFUlZFUgoKICAgICAgICBRdWVyeSBGSUxFU0VSVkVSIGZvciB1c2VyZXMgd2hvIGFyZSBlZmZlY3RpdmUgbG9jYWwgYWRtaW5pc3RyYXRvcnMgdXNpbmcKICAgICAgICBHZXQtTmV0TG9jYWxHcm91cCAtUmVjdXJzZSwgYW5kIGh1bnQgZm9yIHRoYXQgdXNlciBzZXQgb24gdGhlIG5ldHdvcmsuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtVXNlckh1bnRlciAtU2VhcmNoRm9yZXN0CgogICAgICAgIEZpbmQgYWxsIG1hY2hpbmVzIGluIHRoZSBjdXJyZW50IGZvcmVzdCB3aGVyZSBkb21haW4gYWRtaW5zIGFyZSBsb2dnZWQgaW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtVXNlckh1bnRlciAtU3RlYWx0aAoKICAgICAgICBFeGVjdXRlcyBvbGQgSW52b2tlLVN0ZWFsdGhVc2VySHVudGVyIGZ1bmN0aW9uYWxpdHksIGVudW1lcmF0aW5nIGNvbW1vbmx5CiAgICAgICAgdXNlZCBzZXJ2ZXJzIGFuZCBjaGVja2luZyBqdXN0IHNlc3Npb25zIGZvciBlYWNoLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVVzZXJIdW50ZXIgLVN0ZWFsdGggLVN0ZWFsdGhTb3VyY2UgREMgLVBvbGwgMzYwMCAtRGVsYXkgNSAtU2hvd0FsbCB8ID8geyAhICRfLlVzZXJOYW1lLkVuZHNXaXRoKCckJykgfQoKICAgICAgICBQb2xsIERvbWFpbiBDb250cm9sbGVycyBpbiBwYXJhbGxlbCBmb3Igc2Vzc2lvbnMgZm9yIGFuIGhvdXIsIHdhaXRpbmcgZml2ZQogICAgICAgIHNlY29uZHMgYmVmb3JlIHF1ZXJ5aW5nIGVhY2ggREMgYWdhaW4gYW5kIGZpbHRlcmluZyBvdXQgY29tcHV0ZXIgYWNjb3VudHMuCgogICAgLkxJTksKICAgICAgICBodHRwOi8vYmxvZy5oYXJtajB5Lm5ldAojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdHMnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW0FsaWFzKCdIb3N0TGlzdCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyQURTcGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVW5jb25zdHJhaW5lZCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lID0gJ0RvbWFpbiBBZG1pbnMnLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRUYXJnZXRTZXJ2ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyQURTcGF0aCwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckZpbGUsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEFkbWluQ291bnQsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEFsbG93RGVsZWdhdGlvbiwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQ2hlY2tBY2Nlc3MsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFN0b3BPblN1Y2Nlc3MsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJE5vUGluZywKCiAgICAgICAgW1VJbnQzMl0KICAgICAgICAkRGVsYXkgPSAwLAoKICAgICAgICBbRG91YmxlXQogICAgICAgICRKaXR0ZXIgPSAuMywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTaG93QWxsLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTZWFyY2hGb3Jlc3QsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFN0ZWFsdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlU2V0KCJERlMiLCJEQyIsIkZpbGUiLCJBbGwiKV0KICAgICAgICAkU3RlYWx0aFNvdXJjZSA9IkFsbCIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEZvcmVpZ25Vc2VycywKCiAgICAgICAgW0ludF0KICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMCldCiAgICAgICAgJFRocmVhZHMsCgogICAgICAgIFtVSW50MzJdCiAgICAgICAgJFBvbGwgPSAwCiAgICApCgogICAgYmVnaW4gewoKICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydEZWJ1ZyddKSB7CiAgICAgICAgICAgICREZWJ1Z1ByZWZlcmVuY2UgPSAnQ29udGludWUnCiAgICAgICAgfQoKICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUnVubmluZyBJbnZva2UtVXNlckh1bnRlciB3aXRoIGRlbGF5IG9mICREZWxheSIKCiAgICAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgICAgICAjCiAgICAgICAgIyBGaXJzdCB3ZSBidWlsZCB0aGUgaG9zdCB0YXJnZXQgc2V0CiAgICAgICAgIwogICAgICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgogICAgICAgIGlmKCRDb21wdXRlckZpbGUpIHsKICAgICAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyBhIGhvc3QgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSBHZXQtQ29udGVudCAtUGF0aCAkQ29tcHV0ZXJGaWxlCiAgICAgICAgfQoKICAgICAgICBpZighJENvbXB1dGVyTmFtZSkgeyAKICAgICAgICAgICAgW0FycmF5XSRDb21wdXRlck5hbWUgPSBAKCkKCiAgICAgICAgICAgIGlmKCREb21haW4pIHsKICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gQCgkRG9tYWluKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZigkU2VhcmNoRm9yZXN0KSB7CiAgICAgICAgICAgICAgICAjIGdldCBBTEwgdGhlIGRvbWFpbnMgaW4gdGhlIGZvcmVzdCB0byBzZWFyY2gKICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gR2V0LU5ldEZvcmVzdERvbWFpbiB8IEZvckVhY2gtT2JqZWN0IHsgJF8uTmFtZSB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAjIHVzZSB0aGUgbG9jYWwgZG9tYWluCiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoIChHZXQtTmV0RG9tYWluKS5uYW1lICkKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYoJFN0ZWFsdGgpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlN0ZWFsdGggbW9kZSEgRW51bWVyYXRpbmcgY29tbW9ubHkgdXNlZCBzZXJ2ZXJzIgogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiU3RlYWx0aCBzb3VyY2U6ICRTdGVhbHRoU291cmNlIgoKICAgICAgICAgICAgICAgIEZvckVhY2ggKCREb21haW4gaW4gJFRhcmdldERvbWFpbnMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKCRTdGVhbHRoU291cmNlIC1lcSAiRmlsZSIpIC1vciAoJFN0ZWFsdGhTb3VyY2UgLWVxICJBbGwiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIEZpbGUgU2VydmVycy4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSArPSBHZXQtTmV0RmlsZVNlcnZlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCgkU3RlYWx0aFNvdXJjZSAtZXEgIkRGUyIpIC1vciAoJFN0ZWFsdGhTb3VyY2UgLWVxICJBbGwiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIERGUyBTZXJ2ZXJzLi4uIgogICAgICAgICAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lICs9IEdldC1ERlNzaGFyZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgfCBGb3JFYWNoLU9iamVjdCB7JF8uUmVtb3RlU2VydmVyTmFtZX0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCgkU3RlYWx0aFNvdXJjZSAtZXEgIkRDIikgLW9yICgkU3RlYWx0aFNvdXJjZSAtZXEgIkFsbCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBRdWVyeWluZyBkb21haW4gJERvbWFpbiBmb3IgRG9tYWluIENvbnRyb2xsZXJzLi4uIgogICAgICAgICAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lICs9IEdldC1OZXREb21haW5Db250cm9sbGVyIC1MREFQIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciB8IEZvckVhY2gtT2JqZWN0IHsgJF8uZG5zaG9zdG5hbWV9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBRdWVyeWluZyBkb21haW4gJERvbWFpbiBmb3IgaG9zdHMiCgogICAgICAgICAgICAgICAgICAgICRBcmd1bWVudHMgPSBAewogICAgICAgICAgICAgICAgICAgICAgICAnRG9tYWluJyA9ICREb21haW4KICAgICAgICAgICAgICAgICAgICAgICAgJ0RvbWFpbkNvbnRyb2xsZXInID0gJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgICAgICAgICAgICAgJ0FEU3BhdGgnID0gJEFEU3BhdGgKICAgICAgICAgICAgICAgICAgICAgICAgJ0ZpbHRlcicgPSAkQ29tcHV0ZXJGaWx0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgJ1VuY29uc3RyYWluZWQnID0gJFVuY29uc3RyYWluZWQKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgKz0gR2V0LU5ldENvbXB1dGVyIEBBcmd1bWVudHMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyByZW1vdmUgYW55IG51bGwgdGFyZ2V0IGhvc3RzLCB1bmlxdWlmeSB0aGUgbGlzdCBhbmQgc2h1ZmZsZSBpdAogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJENvbXB1dGVyTmFtZSB8IFdoZXJlLU9iamVjdCB7ICRfIH0gfCBTb3J0LU9iamVjdCAtVW5pcXVlIHwgU29ydC1PYmplY3QgeyBHZXQtUmFuZG9tIH0KICAgICAgICAgICAgaWYoJCgkQ29tcHV0ZXJOYW1lLkNvdW50KSAtZXEgMCkgewogICAgICAgICAgICAgICAgdGhyb3cgIk5vIGhvc3RzIGZvdW5kISIKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCRQb2xsIC1ndCAwKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBQb2xsaW5nIGZvciAkUG9sbCBzZWNvbmRzLiBBdXRvbWF0aWNhbGx5IGVuYWJsaW5nIHRocmVhZGVkIG1vZGUuIgogICAgICAgICAgICBpZiAoJENvbXB1dGVyTmFtZS5Db3VudCAtZ3QgMTAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiVG9vIG1hbnkgaG9zdHMgdG8gcG9sbCEgVHJ5IGZld2VyIHRoYW4gMTAwLiIKICAgICAgICAgICAgfQogICAgICAgICAgICAkVGhyZWFkcyA9ICRDb21wdXRlck5hbWUuQ291bnQKICAgICAgICB9CgogICAgICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAgICAgIwogICAgICAgICMgTm93IHdlIGJ1aWxkIHRoZSB1c2VyIHRhcmdldCBzZXQKICAgICAgICAjCiAgICAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiAgICAgICAgIyB1c2VycyB3ZSdyZSBnb2luZyB0byBiZSBzZWFyY2hpbmcgZm9yCiAgICAgICAgJFRhcmdldFVzZXJzID0gQCgpCgogICAgICAgICMgZ2V0IHRoZSBjdXJyZW50IHVzZXIgc28gd2UgY2FuIGlnbm9yZSBpdCBpbiB0aGUgcmVzdWx0cwogICAgICAgICRDdXJyZW50VXNlciA9IChbRW52aXJvbm1lbnRdOjpVc2VyTmFtZSkudG9Mb3dlcigpCgogICAgICAgICMgaWYgd2UncmUgc2hvd2luZyBhbGwgcmVzdWx0cywgc2tpcCB1c2VybmFtZSBlbnVtZXJhdGlvbgogICAgICAgIGlmKCRTaG93QWxsIC1vciAkRm9yZWlnblVzZXJzKSB7CiAgICAgICAgICAgICRVc2VyID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAkVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJEb21haW4nICROdWxsCiAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlck5hbWUnICcqJwogICAgICAgICAgICAkVGFyZ2V0VXNlcnMgPSBAKCRVc2VyKQoKICAgICAgICAgICAgaWYoJEZvcmVpZ25Vc2VycykgewogICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSBzZWFyY2hpbmcgZm9yIHVzZXIgcmVzdWx0cyBub3QgaW4gdGhlIHByaW1hcnkgZG9tYWluCiAgICAgICAgICAgICAgICAka3JidGd0TmFtZSA9IENvbnZlcnQtQUROYW1lIC1PYmplY3ROYW1lICJrcmJ0Z3RAJCgkRG9tYWluKSIgLUlucHV0VHlwZSBTaW1wbGUgLU91dHB1dFR5cGUgTlQ0CiAgICAgICAgICAgICAgICAkRG9tYWluU2hvcnROYW1lID0gJGtyYnRndE5hbWUuc3BsaXQoIlwiKVswXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICMgaWYgd2Ugd2FudCB0byBodW50IGZvciB0aGUgZWZmZWN0aXZlIGRvbWFpbiB1c2VycyB3aG8gY2FuIGFjY2VzcyBhIHRhcmdldCBzZXJ2ZXIKICAgICAgICBlbHNlaWYoJFRhcmdldFNlcnZlcikgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJRdWVyeWluZyB0YXJnZXQgc2VydmVyICckVGFyZ2V0U2VydmVyJyBmb3IgbG9jYWwgdXNlcnMiCiAgICAgICAgICAgICRUYXJnZXRVc2VycyA9IEdldC1OZXRMb2NhbEdyb3VwICRUYXJnZXRTZXJ2ZXIgLVJlY3Vyc2UgfCBXaGVyZS1PYmplY3Qgeygtbm90ICRfLklzR3JvdXApIC1hbmQgJF8uSXNEb21haW4gfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICRVc2VyID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyRG9tYWluJyAoJF8uQWNjb3VudE5hbWUpLnNwbGl0KCIvIilbMF0udG9Mb3dlcigpIAogICAgICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyTmFtZScgKCRfLkFjY291bnROYW1lKS5zcGxpdCgiLyIpWzFdLnRvTG93ZXIoKSAKICAgICAgICAgICAgICAgICRVc2VyCiAgICAgICAgICAgIH0gIHwgV2hlcmUtT2JqZWN0IHskX30KICAgICAgICB9CiAgICAgICAgIyBpZiB3ZSBnZXQgYSBzcGVjaWZpYyB1c2VybmFtZSwgb25seSB1c2UgdGhhdAogICAgICAgIGVsc2VpZigkVXNlck5hbWUpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFVzaW5nIHRhcmdldCB1c2VyICckVXNlck5hbWUnLi4uIgogICAgICAgICAgICAkVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgaWYoJFRhcmdldERvbWFpbnMpIHsKICAgICAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlckRvbWFpbicgJFRhcmdldERvbWFpbnNbMF0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlckRvbWFpbicgJE51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICAkVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJOYW1lJyAkVXNlck5hbWUuVG9Mb3dlcigpCiAgICAgICAgICAgICRUYXJnZXRVc2VycyA9IEAoJFVzZXIpCiAgICAgICAgfQogICAgICAgICMgcmVhZCBpbiBhIHRhcmdldCB1c2VyIGxpc3QgaWYgd2UgaGF2ZSBvbmUKICAgICAgICBlbHNlaWYoJFVzZXJGaWxlKSB7CiAgICAgICAgICAgICRUYXJnZXRVc2VycyA9IEdldC1Db250ZW50IC1QYXRoICRVc2VyRmlsZSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICRVc2VyID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgaWYoJFRhcmdldERvbWFpbnMpIHsKICAgICAgICAgICAgICAgICAgICAkVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJEb21haW4nICRUYXJnZXREb21haW5zWzBdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJEb21haW4nICROdWxsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJOYW1lJyAkXwogICAgICAgICAgICAgICAgJFVzZXIKICAgICAgICAgICAgfSAgfCBXaGVyZS1PYmplY3QgeyRffQogICAgICAgIH0KICAgICAgICBlbHNlaWYoJFVzZXJBRFNwYXRoIC1vciAkVXNlckZpbHRlciAtb3IgJEFkbWluQ291bnQpIHsKICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewoKICAgICAgICAgICAgICAgICRBcmd1bWVudHMgPSBAewogICAgICAgICAgICAgICAgICAgICdEb21haW4nID0gJERvbWFpbgogICAgICAgICAgICAgICAgICAgICdEb21haW5Db250cm9sbGVyJyA9ICREb21haW5Db250cm9sbGVyCiAgICAgICAgICAgICAgICAgICAgJ0FEU3BhdGgnID0gJFVzZXJBRFNwYXRoCiAgICAgICAgICAgICAgICAgICAgJ0ZpbHRlcicgPSAkVXNlckZpbHRlcgogICAgICAgICAgICAgICAgICAgICdBZG1pbkNvdW50JyA9ICRBZG1pbkNvdW50CiAgICAgICAgICAgICAgICAgICAgJ0FsbG93RGVsZWdhdGlvbicgPSAkQWxsb3dEZWxlZ2F0aW9uCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciB1c2VycyIKICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyArPSBHZXQtTmV0VXNlciBAQXJndW1lbnRzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICRVc2VyID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlckRvbWFpbicgJERvbWFpbgogICAgICAgICAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlck5hbWUnICRfLnNhbWFjY291bnRuYW1lCiAgICAgICAgICAgICAgICAgICAgJFVzZXIKICAgICAgICAgICAgICAgIH0gIHwgV2hlcmUtT2JqZWN0IHskX30KCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIEZvckVhY2ggKCREb21haW4gaW4gJFRhcmdldERvbWFpbnMpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBRdWVyeWluZyBkb21haW4gJERvbWFpbiBmb3IgdXNlcnMgb2YgZ3JvdXAgJyRHcm91cE5hbWUnIgogICAgICAgICAgICAgICAgJFRhcmdldFVzZXJzICs9IEdldC1OZXRHcm91cE1lbWJlciAtR3JvdXBOYW1lICRHcm91cE5hbWUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgoICgtbm90ICRTaG93QWxsKSAtYW5kICgtbm90ICRGb3JlaWduVXNlcnMpICkgLWFuZCAoKCEkVGFyZ2V0VXNlcnMpIC1vciAoJFRhcmdldFVzZXJzLkNvdW50IC1lcSAwKSkpIHsKICAgICAgICAgICAgdGhyb3cgIlshXSBObyB1c2VycyBmb3VuZCB0byBzZWFyY2ggZm9yISIKICAgICAgICB9CgogICAgICAgICMgc2NyaXB0IGJsb2NrIHRoYXQgZW51bWVyYXRlcyBhIHNlcnZlcgogICAgICAgICRIb3N0RW51bUJsb2NrID0gewogICAgICAgICAgICBwYXJhbSgkQ29tcHV0ZXJOYW1lLCAkUGluZywgJFRhcmdldFVzZXJzLCAkQ3VycmVudFVzZXIsICRTdGVhbHRoLCAkRG9tYWluU2hvcnROYW1lLCAkUG9sbCwgJERlbGF5LCAkSml0dGVyKQoKICAgICAgICAgICAgIyBvcHRpb25hbGx5IGNoZWNrIGlmIHRoZSBzZXJ2ZXIgaXMgdXAgZmlyc3QKICAgICAgICAgICAgJFVwID0gJFRydWUKICAgICAgICAgICAgaWYoJFBpbmcpIHsKICAgICAgICAgICAgICAgICRVcCA9IFRlc3QtQ29ubmVjdGlvbiAtQ291bnQgMSAtUXVpZXQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJFVwKSB7CiAgICAgICAgICAgICAgICAkVGltZXIgPSBbU3lzdGVtLkRpYWdub3N0aWNzLlN0b3B3YXRjaF06OlN0YXJ0TmV3KCkKICAgICAgICAgICAgICAgICRSYW5kTm8gPSBOZXctT2JqZWN0IFN5c3RlbS5SYW5kb20KCiAgICAgICAgICAgICAgICBEbyB7CiAgICAgICAgICAgICAgICAgICAgaWYoISREb21haW5TaG9ydE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSBub3Qgc2VhcmNoaW5nIGZvciBmb3JlaWduIHVzZXJzLCBjaGVjayBzZXNzaW9uIGluZm9ybWF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICRTZXNzaW9ucyA9IEdldC1OZXRTZXNzaW9uIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICBGb3JFYWNoICgkU2Vzc2lvbiBpbiAkU2Vzc2lvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyTmFtZSA9ICRTZXNzaW9uLnNlc2kxMF91c2VybmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJENOYW1lID0gJFNlc3Npb24uc2VzaTEwX2NuYW1lCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJENOYW1lIC1hbmQgJENOYW1lLlN0YXJ0c1dpdGgoIlxcIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQ05hbWUgPSAkQ05hbWUuVHJpbVN0YXJ0KCJcIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIG1ha2Ugc3VyZSB3ZSBoYXZlIGEgcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCRVc2VyTmFtZSkgLWFuZCAoJFVzZXJOYW1lLnRyaW0oKSAtbmUgJycpIC1hbmQgKCEoJFVzZXJOYW1lIC1tYXRjaCAkQ3VycmVudFVzZXIpKSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGFyZ2V0VXNlcnMgfCBXaGVyZS1PYmplY3QgeyRVc2VyTmFtZSAtbGlrZSAkXy5NZW1iZXJOYW1lfSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRJUEFkZHJlc3MgPSBAKEdldC1JUEFkZHJlc3MgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lKVswXS5JUEFkZHJlc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyRG9tYWluJyAkXy5NZW1iZXJEb21haW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyTmFtZScgJFVzZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSVBBZGRyZXNzJyAkSVBBZGRyZXNzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU2Vzc2lvbkZyb20nICRDTmFtZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUcnkgdG8gcmVzb2x2ZSB0aGUgRE5TIGhvc3RuYW1lIG9mICRDbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJENOYW1lRE5TTmFtZSA9IFtTeXN0ZW0uTmV0LkRuc106OkdldEhvc3RFbnRyeSgkQ05hbWUpIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgSG9zdE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVQcm9wZXJ0eSAnU2Vzc2lvbkZyb21OYW1lJyAkQ25hbWVETlNOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZVByb3BlcnR5ICdTZXNzaW9uRnJvbU5hbWUnICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgc2VlIGlmIHdlJ3JlIGNoZWNraW5nIHRvIHNlZSBpZiB3ZSBoYXZlIGxvY2FsIGFkbWluIGFjY2VzcyBvbiB0aGlzIG1hY2hpbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRDaGVja0FjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEFkbWluID0gSW52b2tlLUNoZWNrTG9jYWxBZG1pbkFjY2VzcyAtQ29tcHV0ZXJOYW1lICRDTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdMb2NhbEFkbWluJyAkQWRtaW4uSXNBZG1pbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdMb2NhbEFkbWluJyAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LlVzZXJTZXNzaW9uJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZighJFN0ZWFsdGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSBub3QgJ3N0ZWFsdGh5JywgZW51bWVyYXRlIGxvZ2dlZG9uIHVzZXJzIGFzIHdlbGwKICAgICAgICAgICAgICAgICAgICAgICAgJExvZ2dlZE9uID0gR2V0LU5ldExvZ2dlZG9uIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICBGb3JFYWNoICgkVXNlciBpbiAkTG9nZ2VkT24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyTmFtZSA9ICRVc2VyLndrdWkxX3VzZXJuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFRPRE86IHRyYW5zbGF0ZSBkb21haW4gdG8gYXV0aG9yYXRhdGl2ZSBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgdGhlbiBtYXRjaCBkb21haW4gbmFtZSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVXNlckRvbWFpbiA9ICRVc2VyLndrdWkxX2xvZ29uX2RvbWFpbgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgbWFrZSBzdXJlIHdldCBoYXZlIGEgcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCRVc2VyTmFtZSkgLWFuZCAoJFVzZXJOYW1lLnRyaW0oKSAtbmUgJycpKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyB8IFdoZXJlLU9iamVjdCB7JFVzZXJOYW1lIC1saWtlICRfLk1lbWJlck5hbWV9IHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFByb2NlZWQgPSAkVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkRG9tYWluU2hvcnROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJERvbWFpblNob3J0TmFtZS5Ub0xvd2VyKCkgLW5lICRVc2VyRG9tYWluLlRvTG93ZXIoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcm9jZWVkID0gJFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcm9jZWVkID0gJEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJFByb2NlZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRJUEFkZHJlc3MgPSBAKEdldC1JUEFkZHJlc3MgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lKVswXS5JUEFkZHJlc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJEb21haW4nICRVc2VyRG9tYWluCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJOYW1lJyAkVXNlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lQQWRkcmVzcycgJElQQWRkcmVzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTZXNzaW9uRnJvbScgJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU2Vzc2lvbkZyb21OYW1lJyAkTnVsbAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgc2VlIGlmIHdlJ3JlIGNoZWNraW5nIHRvIHNlZSBpZiB3ZSBoYXZlIGxvY2FsIGFkbWluIGFjY2VzcyBvbiB0aGlzIG1hY2hpbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkQ2hlY2tBY2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQWRtaW4gPSBJbnZva2UtQ2hlY2tMb2NhbEFkbWluQWNjZXNzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTG9jYWxBZG1pbicgJEFkbWluLklzQWRtaW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTG9jYWxBZG1pbicgJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LlVzZXJTZXNzaW9uJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCRQb2xsIC1ndCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzICRSYW5kTm8uTmV4dCgoMS0kSml0dGVyKSokRGVsYXksICgxKyRKaXR0ZXIpKiREZWxheSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IFdoaWxlICgkUG9sbCAtZ3QgMCAtYW5kICRUaW1lci5FbGFwc2VkLlRvdGFsU2Vjb25kcyAtbHQgJFBvbGwpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIGlmKCRUaHJlYWRzKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlVzaW5nIHRocmVhZGluZyB3aXRoIHRocmVhZHMgPSAkVGhyZWFkcyIKCiAgICAgICAgICAgICMgaWYgd2UncmUgdXNpbmcgdGhyZWFkaW5nLCBraWNrIG9mZiB0aGUgc2NyaXB0IGJsb2NrIHdpdGggSW52b2tlLVRocmVhZGVkRnVuY3Rpb24KICAgICAgICAgICAgJFNjcmlwdFBhcmFtcyA9IEB7CiAgICAgICAgICAgICAgICAnUGluZycgPSAkKC1ub3QgJE5vUGluZykKICAgICAgICAgICAgICAgICdUYXJnZXRVc2VycycgPSAkVGFyZ2V0VXNlcnMKICAgICAgICAgICAgICAgICdDdXJyZW50VXNlcicgPSAkQ3VycmVudFVzZXIKICAgICAgICAgICAgICAgICdTdGVhbHRoJyA9ICRTdGVhbHRoCiAgICAgICAgICAgICAgICAnRG9tYWluU2hvcnROYW1lJyA9ICREb21haW5TaG9ydE5hbWUKICAgICAgICAgICAgICAgICdQb2xsJyA9ICRQb2xsCiAgICAgICAgICAgICAgICAnRGVsYXknID0gJERlbGF5CiAgICAgICAgICAgICAgICAnSml0dGVyJyA9ICRKaXR0ZXIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBraWNrIG9mZiB0aGUgdGhyZWFkZWQgc2NyaXB0IGJsb2NrICsgYXJndW1lbnRzIAogICAgICAgICAgICBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1TY3JpcHRQYXJhbWV0ZXJzICRTY3JpcHRQYXJhbXMgLVRocmVhZHMgJFRocmVhZHMKICAgICAgICB9CgogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZigtbm90ICROb1BpbmcgLWFuZCAoJENvbXB1dGVyTmFtZS5jb3VudCAtbmUgMSkpIHsKICAgICAgICAgICAgICAgICMgcGluZyBhbGwgaG9zdHMgaW4gcGFyYWxsZWwKICAgICAgICAgICAgICAgICRQaW5nID0ge3BhcmFtKCRDb21wdXRlck5hbWUpIGlmKFRlc3QtQ29ubmVjdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLUNvdW50IDEgLVF1aWV0IC1FcnJvckFjdGlvbiBTdG9wKXskQ29tcHV0ZXJOYW1lfX0KICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtTm9JbXBvcnRzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtU2NyaXB0QmxvY2sgJFBpbmcgLVRocmVhZHMgMTAwCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBUb3RhbCBudW1iZXIgb2YgYWN0aXZlIGhvc3RzOiAkKCRDb21wdXRlck5hbWUuY291bnQpIgogICAgICAgICAgICAkQ291bnRlciA9IDAKICAgICAgICAgICAgJFJhbmRObyA9IE5ldy1PYmplY3QgU3lzdGVtLlJhbmRvbQoKICAgICAgICAgICAgRm9yRWFjaCAoJENvbXB1dGVyIGluICRDb21wdXRlck5hbWUpIHsKCiAgICAgICAgICAgICAgICAkQ291bnRlciA9ICRDb3VudGVyICsgMQoKICAgICAgICAgICAgICAgICMgc2xlZXAgZm9yIG91ciBzZW1pLXJhbmRvbWl6ZWQgaW50ZXJ2YWwKICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzICRSYW5kTm8uTmV4dCgoMS0kSml0dGVyKSokRGVsYXksICgxKyRKaXR0ZXIpKiREZWxheSkKCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gRW51bWVyYXRpbmcgc2VydmVyICRDb21wdXRlciAoJENvdW50ZXIgb2YgJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSkiCiAgICAgICAgICAgICAgICAkUmVzdWx0ID0gSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1Bcmd1bWVudExpc3QgJENvbXB1dGVyLCAkRmFsc2UsICRUYXJnZXRVc2VycywgJEN1cnJlbnRVc2VyLCAkU3RlYWx0aCwgJERvbWFpblNob3J0TmFtZSwgMCwgMCwgMAogICAgICAgICAgICAgICAgJFJlc3VsdAoKICAgICAgICAgICAgICAgIGlmKCRSZXN1bHQgLWFuZCAkU3RvcE9uU3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBUYXJnZXQgdXNlciBmb3VuZCwgcmV0dXJuaW5nIGVhcmx5IgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KfQoKCmZ1bmN0aW9uIEludm9rZS1TdGVhbHRoVXNlckh1bnRlciB7CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3RzJyldCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgICRDb21wdXRlck5hbWUsCgogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7VGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtBbGlhcygnSG9zdExpc3QnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckZpbGUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdyb3VwTmFtZSA9ICdEb21haW4gQWRtaW5zJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGFyZ2V0U2VydmVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckFEU3BhdGgsCgogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7VGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJGaWxlLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRDaGVja0FjY2VzcywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU3RvcE9uU3VjY2VzcywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTm9QaW5nLAoKICAgICAgICBbVUludDMyXQogICAgICAgICREZWxheSA9IDAsCgogICAgICAgIFtEb3VibGVdCiAgICAgICAgJEppdHRlciA9IC4zLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNob3dBbGwsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNlYXJjaEZvcmVzdCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVTZXQoIkRGUyIsIkRDIiwiRmlsZSIsIkFsbCIpXQogICAgICAgICRTdGVhbHRoU291cmNlID0iQWxsIgogICAgKQogICAgIyBraWNrIG9mZiBJbnZva2UtVXNlckh1bnRlciB3aXRoIHN0ZWFsdGggb3B0aW9ucwogICAgSW52b2tlLVVzZXJIdW50ZXIgLVN0ZWFsdGggQFBTQm91bmRQYXJhbWV0ZXJzCn0KCgpmdW5jdGlvbiBJbnZva2UtUHJvY2Vzc0h1bnRlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUXVlcnkgdGhlIHByb2Nlc3MgbGlzdHMgb2YgcmVtb3RlIG1hY2hpbmVzLCBzZWFyY2hpbmcgZm9yCiAgICAgICAgcHJvY2Vzc2VzIHdpdGggYSBzcGVjaWZpYyBuYW1lIG9yIG93bmVkIGJ5IGEgc3BlY2lmaWMgdXNlci4KICAgICAgICBUaGFua3MgdG8gQHBhdWxicmFuZGF1IGZvciB0aGUgYXBwcm9hY2ggaWRlYS4KICAgICAgICAKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgSG9zdCBhcnJheSB0byBlbnVtZXJhdGUsIHBhc3NhYmxlIG9uIHRoZSBwaXBlbGluZS4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsZQoKICAgICAgICBGaWxlIG9mIGhvc3RuYW1lcy9JUHMgdG8gc2VhcmNoLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJGaWx0ZXIKCiAgICAgICAgSG9zdCBmaWx0ZXIgbmFtZSB0byBxdWVyeSBBRCBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIGhvc3RzLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgUHJvY2Vzc05hbWUKCiAgICAgICAgVGhlIG5hbWUgb2YgdGhlIHByb2Nlc3MgdG8gaHVudCwgb3IgYSBjb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBuYW1lcy4KCiAgICAuUEFSQU1FVEVSIEdyb3VwTmFtZQoKICAgICAgICBHcm91cCBuYW1lIHRvIHF1ZXJ5IGZvciB0YXJnZXQgdXNlcnMuCgogICAgLlBBUkFNRVRFUiBUYXJnZXRTZXJ2ZXIKCiAgICAgICAgSHVudCBmb3IgdXNlcnMgd2hvIGFyZSBlZmZlY3RpdmUgbG9jYWwgYWRtaW5zIG9uIGEgdGFyZ2V0IHNlcnZlci4KCiAgICAuUEFSQU1FVEVSIFVzZXJOYW1lCgogICAgICAgIFNwZWNpZmljIHVzZXJuYW1lIHRvIHNlYXJjaCBmb3IuCgogICAgLlBBUkFNRVRFUiBVc2VyRmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlIGZvciB1c2VyIGVudW1lcmF0aW9uLCBlLmcuICIoZGVzY3JpcHRpb249KmFkbWluKikiCgogICAgLlBBUkFNRVRFUiBVc2VyQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIHVzZXJzLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgVXNlckZpbGUKCiAgICAgICAgRmlsZSBvZiB1c2VybmFtZXMgdG8gc2VhcmNoIGZvci4KCiAgICAuUEFSQU1FVEVSIFN0b3BPblN1Y2Nlc3MKCiAgICAgICAgU3dpdGNoLiBTdG9wIGh1bnRpbmcgYWZ0ZXIgZmluZGluZyBhZnRlciBmaW5kaW5nIGEgdGFyZ2V0IHVzZXIvcHJvY2Vzcy4KCiAgICAuUEFSQU1FVEVSIE5vUGluZwoKICAgICAgICBTd2l0Y2guIERvbid0IHBpbmcgZWFjaCBob3N0IHRvIGVuc3VyZSBpdCdzIHVwIGJlZm9yZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIERlbGF5CgogICAgICAgIERlbGF5IGJldHdlZW4gZW51bWVyYXRpbmcgaG9zdHMsIGRlZmF1bHRzIHRvIDAKCiAgICAuUEFSQU1FVEVSIEppdHRlcgoKICAgICAgICBKaXR0ZXIgZm9yIHRoZSBob3N0IGRlbGF5LCBkZWZhdWx0cyB0byArLy0gMC4zCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIGZvciBxdWVyeSBmb3IgbWFjaGluZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFNob3dBbGwKCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gYWxsIHVzZXIgbG9jYXRpb24gcmVzdWx0cy4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaEZvcmVzdAoKICAgICAgICBTd2l0Y2guIFNlYXJjaCBhbGwgZG9tYWlucyBpbiB0aGUgZm9yZXN0IGZvciB0YXJnZXQgdXNlcnMgaW5zdGVhZCBvZiBqdXN0CiAgICAgICAgYSBzaW5nbGUgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgVGhyZWFkcwoKICAgICAgICBUaGUgbWF4aW11bSBjb25jdXJyZW50IHRocmVhZHMgdG8gZXhlY3V0ZS4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgbWFjaGluZS9kb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtUHJvY2Vzc0h1bnRlciAtRG9tYWluICd0ZXN0aW5nJwogICAgICAgIAogICAgICAgIEZpbmRzIG1hY2hpbmVzIG9uIHRoZSAndGVzdGluZycgZG9tYWluIHdoZXJlIGRvbWFpbiBhZG1pbnMgaGF2ZSBhCiAgICAgICAgcnVubmluZyBwcm9jZXNzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVByb2Nlc3NIdW50ZXIgLVRocmVhZHMgMjAKCiAgICAgICAgTXVsdGktdGhyZWFkZWQgcHJvY2VzcyBodW50aW5nLCByZXBsYWNlcyBJbnZva2UtUHJvY2Vzc0h1bnRlclRocmVhZGVkLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVByb2Nlc3NIdW50ZXIgLVVzZXJGaWxlIHVzZXJzLnR4dCAtQ29tcHV0ZXJGaWxlIGhvc3RzLnR4dAogICAgICAgIAogICAgICAgIEZpbmRzIG1hY2hpbmVzIGluIGhvc3RzLnR4dCB3aGVyZSBhbnkgbWVtYmVycyBvZiB1c2Vycy50eHQgaGF2ZSBydW5uaW5nCiAgICAgICAgcHJvY2Vzc2VzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVByb2Nlc3NIdW50ZXIgLUdyb3VwTmFtZSAiUG93ZXIgVXNlcnMiIC1EZWxheSA2MAogICAgICAgIAogICAgICAgIEZpbmQgbWFjaGluZXMgb24gdGhlIGRvbWFpbiB3aGVyZSBtZW1iZXJzIG9mIHRoZSAiUG93ZXIgVXNlcnMiIGdyb3VwcyBoYXZlCiAgICAgICAgcnVubmluZyBwcm9jZXNzZXMgd2l0aCBhIDYwIHNlY29uZCAoKy8tICouMykgcmFuZG9taXplZCBkZWxheSBiZXR3ZWVuCiAgICAgICAgdG91Y2hpbmcgZWFjaCBob3N0LgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly9ibG9nLmhhcm1qMHkubmV0CiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0cycpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkQ29tcHV0ZXJOYW1lLAoKICAgICAgICBbVmFsaWRhdGVTY3JpcHQoe1Rlc3QtUGF0aCAtUGF0aCAkXyB9KV0KICAgICAgICBbQWxpYXMoJ0hvc3RMaXN0JyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWxlLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJBRFNwYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRQcm9jZXNzTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lID0gJ0RvbWFpbiBBZG1pbnMnLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRUYXJnZXRTZXJ2ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyQURTcGF0aCwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckZpbGUsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFN0b3BPblN1Y2Nlc3MsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJE5vUGluZywKCiAgICAgICAgW1VJbnQzMl0KICAgICAgICAkRGVsYXkgPSAwLAoKICAgICAgICBbRG91YmxlXQogICAgICAgICRKaXR0ZXIgPSAuMywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTaG93QWxsLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTZWFyY2hGb3Jlc3QsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkVGhyZWFkcywKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBiZWdpbiB7CgogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0RlYnVnJ10pIHsKICAgICAgICAgICAgJERlYnVnUHJlZmVyZW5jZSA9ICdDb250aW51ZScKICAgICAgICB9CgogICAgICAgICMgcmFuZG9tIG9iamVjdCBmb3IgZGVsYXkKICAgICAgICAkUmFuZE5vID0gTmV3LU9iamVjdCBTeXN0ZW0uUmFuZG9tCgogICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBSdW5uaW5nIEludm9rZS1Qcm9jZXNzSHVudGVyIHdpdGggZGVsYXkgb2YgJERlbGF5IgoKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgICAgICMKICAgICAgICAjIEZpcnN0IHdlIGJ1aWxkIHRoZSBob3N0IHRhcmdldCBzZXQKICAgICAgICAjCiAgICAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyBhIGhvc3QgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgaWYoJENvbXB1dGVyRmlsZSkgewogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gR2V0LUNvbnRlbnQgLVBhdGggJENvbXB1dGVyRmlsZQogICAgICAgIH0KCiAgICAgICAgaWYoISRDb21wdXRlck5hbWUpIHsgCiAgICAgICAgICAgIFthcnJheV0kQ29tcHV0ZXJOYW1lID0gQCgpCgogICAgICAgICAgICBpZigkRG9tYWluKSB7CiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoJERvbWFpbikKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoJFNlYXJjaEZvcmVzdCkgewogICAgICAgICAgICAgICAgIyBnZXQgQUxMIHRoZSBkb21haW5zIGluIHRoZSBmb3Jlc3QgdG8gc2VhcmNoCiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEdldC1OZXRGb3Jlc3REb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgfCBGb3JFYWNoLU9iamVjdCB7ICRfLk5hbWUgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgIyB1c2UgdGhlIGxvY2FsIGRvbWFpbgogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCAoR2V0LU5ldERvbWFpbiAtRG9tYWluICREb21haW4gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwpLm5hbWUgKQogICAgICAgICAgICB9CgogICAgICAgICAgICBGb3JFYWNoICgkRG9tYWluIGluICRUYXJnZXREb21haW5zKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIGhvc3RzIgogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSArPSBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1GaWx0ZXIgJENvbXB1dGVyRmlsdGVyIC1BRFNwYXRoICRDb21wdXRlckFEU3BhdGgKICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgICAgICAjIHJlbW92ZSBhbnkgbnVsbCB0YXJnZXQgaG9zdHMsIHVuaXF1aWZ5IHRoZSBsaXN0IGFuZCBzaHVmZmxlIGl0CiAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHsgJF8gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgfCBTb3J0LU9iamVjdCB7IEdldC1SYW5kb20gfQogICAgICAgICAgICBpZigkKCRDb21wdXRlck5hbWUuQ291bnQpIC1lcSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiTm8gaG9zdHMgZm91bmQhIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgICAgICMKICAgICAgICAjIE5vdyB3ZSBidWlsZCB0aGUgdXNlciB0YXJnZXQgc2V0CiAgICAgICAgIwogICAgICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgogICAgICAgIGlmKCEkUHJvY2Vzc05hbWUpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiTm8gcHJvY2VzcyBuYW1lIHNwZWNpZmllZCwgYnVpbGRpbmcgYSB0YXJnZXQgdXNlciBzZXQiCgogICAgICAgICAgICAjIHVzZXJzIHdlJ3JlIGdvaW5nIHRvIGJlIHNlYXJjaGluZyBmb3IKICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gQCgpCgogICAgICAgICAgICAjIGlmIHdlIHdhbnQgdG8gaHVudCBmb3IgdGhlIGVmZmVjdGl2ZSBkb21haW4gdXNlcnMgd2hvIGNhbiBhY2Nlc3MgYSB0YXJnZXQgc2VydmVyCiAgICAgICAgICAgIGlmKCRUYXJnZXRTZXJ2ZXIpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlF1ZXJ5aW5nIHRhcmdldCBzZXJ2ZXIgJyRUYXJnZXRTZXJ2ZXInIGZvciBsb2NhbCB1c2VycyIKICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyA9IEdldC1OZXRMb2NhbEdyb3VwICRUYXJnZXRTZXJ2ZXIgLVJlY3Vyc2UgfCBXaGVyZS1PYmplY3Qgeygtbm90ICRfLklzR3JvdXApIC1hbmQgJF8uSXNEb21haW4gfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAoJF8uQWNjb3VudE5hbWUpLnNwbGl0KCIvIilbMV0udG9Mb3dlcigpCiAgICAgICAgICAgICAgICB9ICB8IFdoZXJlLU9iamVjdCB7JF99CiAgICAgICAgICAgIH0KICAgICAgICAgICAgIyBpZiB3ZSBnZXQgYSBzcGVjaWZpYyB1c2VybmFtZSwgb25seSB1c2UgdGhhdAogICAgICAgICAgICBlbHNlaWYoJFVzZXJOYW1lKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gVXNpbmcgdGFyZ2V0IHVzZXIgJyRVc2VyTmFtZScuLi4iCiAgICAgICAgICAgICAgICAkVGFyZ2V0VXNlcnMgPSBAKCAkVXNlck5hbWUuVG9Mb3dlcigpICkKICAgICAgICAgICAgfQogICAgICAgICAgICAjIHJlYWQgaW4gYSB0YXJnZXQgdXNlciBsaXN0IGlmIHdlIGhhdmUgb25lCiAgICAgICAgICAgIGVsc2VpZigkVXNlckZpbGUpIHsKICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyA9IEdldC1Db250ZW50IC1QYXRoICRVc2VyRmlsZSB8IFdoZXJlLU9iamVjdCB7JF99CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRVc2VyQURTcGF0aCAtb3IgJFVzZXJGaWx0ZXIpIHsKICAgICAgICAgICAgICAgIEZvckVhY2ggKCREb21haW4gaW4gJFRhcmdldERvbWFpbnMpIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIHVzZXJzIgogICAgICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyArPSBHZXQtTmV0VXNlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJFVzZXJBRFNwYXRoIC1GaWx0ZXIgJFVzZXJGaWx0ZXIgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICRfLnNhbWFjY291bnRuYW1lCiAgICAgICAgICAgICAgICAgICAgfSAgfCBXaGVyZS1PYmplY3QgeyRffQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBRdWVyeWluZyBkb21haW4gJERvbWFpbiBmb3IgdXNlcnMgb2YgZ3JvdXAgJyRHcm91cE5hbWUnIgogICAgICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyArPSBHZXQtTmV0R3JvdXBNZW1iZXIgLUdyb3VwTmFtZSAkR3JvdXBOYW1lIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAkXy5NZW1iZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoKC1ub3QgJFNob3dBbGwpIC1hbmQgKCghJFRhcmdldFVzZXJzKSAtb3IgKCRUYXJnZXRVc2Vycy5Db3VudCAtZXEgMCkpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiWyFdIE5vIHVzZXJzIGZvdW5kIHRvIHNlYXJjaCBmb3IhIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHNjcmlwdCBibG9jayB0aGF0IGVudW1lcmF0ZXMgYSBzZXJ2ZXIKICAgICAgICAkSG9zdEVudW1CbG9jayA9IHsKICAgICAgICAgICAgcGFyYW0oJENvbXB1dGVyTmFtZSwgJFBpbmcsICRQcm9jZXNzTmFtZSwgJFRhcmdldFVzZXJzLCAkQ3JlZGVudGlhbCkKCiAgICAgICAgICAgICMgb3B0aW9uYWxseSBjaGVjayBpZiB0aGUgc2VydmVyIGlzIHVwIGZpcnN0CiAgICAgICAgICAgICRVcCA9ICRUcnVlCiAgICAgICAgICAgIGlmKCRQaW5nKSB7CiAgICAgICAgICAgICAgICAkVXAgPSBUZXN0LUNvbm5lY3Rpb24gLUNvdW50IDEgLVF1aWV0IC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRVcCkgewogICAgICAgICAgICAgICAgIyB0cnkgdG8gZW51bWVyYXRlIGFsbCBhY3RpdmUgcHJvY2Vzc2VzIG9uIHRoZSByZW1vdGUgaG9zdAogICAgICAgICAgICAgICAgIyBhbmQgc2VhcmNoIGZvciBhIHNwZWNpZmljIHByb2Nlc3MgbmFtZQogICAgICAgICAgICAgICAgJFByb2Nlc3NlcyA9IEdldC1OZXRQcm9jZXNzIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQoKICAgICAgICAgICAgICAgIEZvckVhY2ggKCRQcm9jZXNzIGluICRQcm9jZXNzZXMpIHsKICAgICAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIGh1bnRpbmcgZm9yIGEgcHJvY2VzcyBuYW1lIG9yIGNvbW1hLXNlcGFyYXRlZCBuYW1lcwogICAgICAgICAgICAgICAgICAgIGlmKCRQcm9jZXNzTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAkUHJvY2Vzc05hbWUuc3BsaXQoIiwiKSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkUHJvY2Vzcy5Qcm9jZXNzTmFtZSAtbWF0Y2ggJF8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUHJvY2VzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICMgaWYgdGhlIHNlc3Npb24gdXNlciBpcyBpbiB0aGUgdGFyZ2V0IGxpc3QsIGRpc3BsYXkgc29tZSBvdXRwdXQKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKCRUYXJnZXRVc2VycyAtY29udGFpbnMgJFByb2Nlc3MuVXNlcikgewogICAgICAgICAgICAgICAgICAgICAgICAkUHJvY2VzcwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIGlmKCRUaHJlYWRzKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlVzaW5nIHRocmVhZGluZyB3aXRoIHRocmVhZHMgPSAkVGhyZWFkcyIKCiAgICAgICAgICAgICMgaWYgd2UncmUgdXNpbmcgdGhyZWFkaW5nLCBraWNrIG9mZiB0aGUgc2NyaXB0IGJsb2NrIHdpdGggSW52b2tlLVRocmVhZGVkRnVuY3Rpb24KICAgICAgICAgICAgJFNjcmlwdFBhcmFtcyA9IEB7CiAgICAgICAgICAgICAgICAnUGluZycgPSAkKC1ub3QgJE5vUGluZykKICAgICAgICAgICAgICAgICdQcm9jZXNzTmFtZScgPSAkUHJvY2Vzc05hbWUKICAgICAgICAgICAgICAgICdUYXJnZXRVc2VycycgPSAkVGFyZ2V0VXNlcnMKICAgICAgICAgICAgICAgICdDcmVkZW50aWFsJyA9ICRDcmVkZW50aWFsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMga2ljayBvZmYgdGhlIHRocmVhZGVkIHNjcmlwdCBibG9jayArIGFyZ3VtZW50cyAKICAgICAgICAgICAgSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1TY3JpcHRCbG9jayAkSG9zdEVudW1CbG9jayAtU2NyaXB0UGFyYW1ldGVycyAkU2NyaXB0UGFyYW1zIC1UaHJlYWRzICRUaHJlYWRzCiAgICAgICAgfQoKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYoLW5vdCAkTm9QaW5nIC1hbmQgKCRDb21wdXRlck5hbWUuY291bnQgLW5lIDEpKSB7CiAgICAgICAgICAgICAgICAjIHBpbmcgYWxsIGhvc3RzIGluIHBhcmFsbGVsCiAgICAgICAgICAgICAgICAkUGluZyA9IHtwYXJhbSgkQ29tcHV0ZXJOYW1lKSBpZihUZXN0LUNvbm5lY3Rpb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1Db3VudCAxIC1RdWlldCAtRXJyb3JBY3Rpb24gU3RvcCl7JENvbXB1dGVyTmFtZX19CiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLU5vSW1wb3J0cyAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRQaW5nIC1UaHJlYWRzIDEwMAogICAgICAgICAgICB9CgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gVG90YWwgbnVtYmVyIG9mIGFjdGl2ZSBob3N0czogJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSIKICAgICAgICAgICAgJENvdW50ZXIgPSAwCgogICAgICAgICAgICBGb3JFYWNoICgkQ29tcHV0ZXIgaW4gJENvbXB1dGVyTmFtZSkgewoKICAgICAgICAgICAgICAgICRDb3VudGVyID0gJENvdW50ZXIgKyAxCgogICAgICAgICAgICAgICAgIyBzbGVlcCBmb3Igb3VyIHNlbWktcmFuZG9taXplZCBpbnRlcnZhbAogICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgJFJhbmROby5OZXh0KCgxLSRKaXR0ZXIpKiREZWxheSwgKDErJEppdHRlcikqJERlbGF5KQoKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBFbnVtZXJhdGluZyBzZXJ2ZXIgJENvbXB1dGVyICgkQ291bnRlciBvZiAkKCRDb21wdXRlck5hbWUuY291bnQpKSIKICAgICAgICAgICAgICAgICRSZXN1bHQgPSBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgJEhvc3RFbnVtQmxvY2sgLUFyZ3VtZW50TGlzdCAkQ29tcHV0ZXIsICRGYWxzZSwgJFByb2Nlc3NOYW1lLCAkVGFyZ2V0VXNlcnMsICRDcmVkZW50aWFsCiAgICAgICAgICAgICAgICAkUmVzdWx0CgogICAgICAgICAgICAgICAgaWYoJFJlc3VsdCAtYW5kICRTdG9wT25TdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFRhcmdldCB1c2VyL3Byb2Nlc3MgZm91bmQsIHJldHVybmluZyBlYXJseSIKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEludm9rZS1FdmVudEh1bnRlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUXVlcmllcyBhbGwgZG9tYWluIGNvbnRyb2xsZXJzIG9uIHRoZSBuZXR3b3JrIGZvciBhY2NvdW50CiAgICAgICAgbG9nb24gZXZlbnRzIChJRCA0NjI0KSBhbmQgVEdUIHJlcXVlc3QgZXZlbnRzIChJRCA0NzY4KSwKICAgICAgICBzZWFyY2hpbmcgZm9yIHRhcmdldCB1c2Vycy4KCiAgICAgICAgTm90ZTogRG9tYWluIEFkbWluIChvciBlcXVpdikgcmlnaHRzIGFyZSBuZWVkZWQgdG8gcXVlcnkKICAgICAgICB0aGlzIGluZm9ybWF0aW9uIGZyb20gdGhlIERDcy4KCiAgICAgICAgQXV0aG9yOiBAc2l4ZHViLCBAaGFybWoweQogICAgICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIEhvc3QgYXJyYXkgdG8gZW51bWVyYXRlLCBwYXNzYWJsZSBvbiB0aGUgcGlwZWxpbmUuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckZpbGUKCiAgICAgICAgRmlsZSBvZiBob3N0bmFtZXMvSVBzIHRvIHNlYXJjaC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsdGVyCgogICAgICAgIEhvc3QgZmlsdGVyIG5hbWUgdG8gcXVlcnkgQUQgZm9yLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoIGZvciBob3N0cywgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIEdyb3VwTmFtZQoKICAgICAgICBHcm91cCBuYW1lIHRvIHF1ZXJ5IGZvciB0YXJnZXQgdXNlcnMuCgogICAgLlBBUkFNRVRFUiBUYXJnZXRTZXJ2ZXIKCiAgICAgICAgSHVudCBmb3IgdXNlcnMgd2hvIGFyZSBlZmZlY3RpdmUgbG9jYWwgYWRtaW5zIG9uIGEgdGFyZ2V0IHNlcnZlci4KCiAgICAuUEFSQU1FVEVSIFVzZXJOYW1lCgogICAgICAgIFNwZWNpZmljIHVzZXJuYW1lIHRvIHNlYXJjaCBmb3IuCgogICAgLlBBUkFNRVRFUiBVc2VyRmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlIGZvciB1c2VyIGVudW1lcmF0aW9uLCBlLmcuICIoZGVzY3JpcHRpb249KmFkbWluKikiCgogICAgLlBBUkFNRVRFUiBVc2VyQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIHVzZXJzLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgVXNlckZpbGUKCiAgICAgICAgRmlsZSBvZiB1c2VybmFtZXMgdG8gc2VhcmNoIGZvci4KCiAgICAuUEFSQU1FVEVSIE5vUGluZwoKICAgICAgICBEb24ndCBwaW5nIGVhY2ggaG9zdCB0byBlbnN1cmUgaXQncyB1cCBiZWZvcmUgZW51bWVyYXRpbmcuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIGZvciBxdWVyeSBmb3IgbWFjaGluZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaERheXMKCiAgICAgICAgTnVtYmVyIG9mIGRheXMgYmFjayB0byBzZWFyY2ggbG9ncyBmb3IuIERlZmF1bHQgMy4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaEZvcmVzdAoKICAgICAgICBTd2l0Y2guIFNlYXJjaCBhbGwgZG9tYWlucyBpbiB0aGUgZm9yZXN0IGZvciB0YXJnZXQgdXNlcnMgaW5zdGVhZCBvZiBqdXN0CiAgICAgICAgYSBzaW5nbGUgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgVGhyZWFkcwoKICAgICAgICBUaGUgbWF4aW11bSBjb25jdXJyZW50IHRocmVhZHMgdG8gZXhlY3V0ZS4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLUV2ZW50SHVudGVyCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL2Jsb2cuaGFybWoweS5uZXQKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3RzJyldCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgICRDb21wdXRlck5hbWUsCgogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7VGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtBbGlhcygnSG9zdExpc3QnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckZpbGUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdyb3VwTmFtZSA9ICdEb21haW4gQWRtaW5zJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGFyZ2V0U2VydmVyLAoKICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJFVzZXJOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyQURTcGF0aCwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckZpbGUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW0ludDMyXQogICAgICAgICRTZWFyY2hEYXlzID0gMywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2VhcmNoRm9yZXN0LAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFRocmVhZHMsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgYmVnaW4gewoKICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydEZWJ1ZyddKSB7CiAgICAgICAgICAgICREZWJ1Z1ByZWZlcmVuY2UgPSAnQ29udGludWUnCiAgICAgICAgfQoKICAgICAgICAjIHJhbmRvbSBvYmplY3QgZm9yIGRlbGF5CiAgICAgICAgJFJhbmRObyA9IE5ldy1PYmplY3QgU3lzdGVtLlJhbmRvbQoKICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUnVubmluZyBJbnZva2UtRXZlbnRIdW50ZXIiCgogICAgICAgIGlmKCREb21haW4pIHsKICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCREb21haW4pCiAgICAgICAgfQogICAgICAgIGVsc2VpZigkU2VhcmNoRm9yZXN0KSB7CiAgICAgICAgICAgICMgZ2V0IEFMTCB0aGUgZG9tYWlucyBpbiB0aGUgZm9yZXN0IHRvIHNlYXJjaAogICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEdldC1OZXRGb3Jlc3REb21haW4gfCBGb3JFYWNoLU9iamVjdCB7ICRfLk5hbWUgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgIyB1c2UgdGhlIGxvY2FsIGRvbWFpbgogICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoIChHZXQtTmV0RG9tYWluIC1DcmVkZW50aWFsICRDcmVkZW50aWFsKS5uYW1lICkKICAgICAgICB9CgogICAgICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICAgICAgIwogICAgICAgICMgRmlyc3Qgd2UgYnVpbGQgdGhlIGhvc3QgdGFyZ2V0IHNldAogICAgICAgICMKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKICAgICAgICBpZighJENvbXB1dGVyTmFtZSkgeyAKICAgICAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyBhIGhvc3QgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgICAgIGlmKCRDb21wdXRlckZpbGUpIHsKICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSBHZXQtQ29udGVudCAtUGF0aCAkQ29tcHV0ZXJGaWxlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRDb21wdXRlckZpbHRlciAtb3IgJENvbXB1dGVyQURTcGF0aCkgewogICAgICAgICAgICAgICAgW2FycmF5XSRDb21wdXRlck5hbWUgPSBAKCkKICAgICAgICAgICAgICAgIEZvckVhY2ggKCREb21haW4gaW4gJFRhcmdldERvbWFpbnMpIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIGhvc3RzIgogICAgICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgKz0gR2V0LU5ldENvbXB1dGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRmlsdGVyICRDb21wdXRlckZpbHRlciAtQURTcGF0aCAkQ29tcHV0ZXJBRFNwYXRoCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAjIGlmIGEgY29tcHV0ZXIgc3BlY2lmaWVyIGlzbid0IGdpdmVuLCB0cnkgdG8gZW51bWVyYXRlIGFsbCBkb21haW4gY29udHJvbGxlcnMKICAgICAgICAgICAgICAgIFthcnJheV0kQ29tcHV0ZXJOYW1lID0gQCgpCiAgICAgICAgICAgICAgICBGb3JFYWNoICgkRG9tYWluIGluICRUYXJnZXREb21haW5zKSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciBkb21haW4gY29udHJvbGxlcnMiCiAgICAgICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSArPSBHZXQtTmV0RG9tYWluQ29udHJvbGxlciAtTERBUCAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgfCBGb3JFYWNoLU9iamVjdCB7ICRfLmRuc2hvc3RuYW1lfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHJlbW92ZSBhbnkgbnVsbCB0YXJnZXQgaG9zdHMsIHVuaXF1aWZ5IHRoZSBsaXN0IGFuZCBzaHVmZmxlIGl0CiAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHsgJF8gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgfCBTb3J0LU9iamVjdCB7IEdldC1SYW5kb20gfQogICAgICAgICAgICBpZigkKCRDb21wdXRlck5hbWUuQ291bnQpIC1lcSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiTm8gaG9zdHMgZm91bmQhIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgICAgICMKICAgICAgICAjIE5vdyB3ZSBidWlsZCB0aGUgdXNlciB0YXJnZXQgc2V0CiAgICAgICAgIwogICAgICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgogICAgICAgICMgdXNlcnMgd2UncmUgZ29pbmcgdG8gYmUgc2VhcmNoaW5nIGZvcgogICAgICAgICRUYXJnZXRVc2VycyA9IEAoKQoKICAgICAgICAjIGlmIHdlIHdhbnQgdG8gaHVudCBmb3IgdGhlIGVmZmVjdGl2ZSBkb21haW4gdXNlcnMgd2hvIGNhbiBhY2Nlc3MgYSB0YXJnZXQgc2VydmVyCiAgICAgICAgaWYoJFRhcmdldFNlcnZlcikgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJRdWVyeWluZyB0YXJnZXQgc2VydmVyICckVGFyZ2V0U2VydmVyJyBmb3IgbG9jYWwgdXNlcnMiCiAgICAgICAgICAgICRUYXJnZXRVc2VycyA9IEdldC1OZXRMb2NhbEdyb3VwICRUYXJnZXRTZXJ2ZXIgLVJlY3Vyc2UgfCBXaGVyZS1PYmplY3Qgeygtbm90ICRfLklzR3JvdXApIC1hbmQgJF8uSXNEb21haW4gfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICgkXy5BY2NvdW50TmFtZSkuc3BsaXQoIi8iKVsxXS50b0xvd2VyKCkKICAgICAgICAgICAgfSAgfCBXaGVyZS1PYmplY3QgeyRffQogICAgICAgIH0KICAgICAgICAjIGlmIHdlIGdldCBhIHNwZWNpZmljIHVzZXJuYW1lLCBvbmx5IHVzZSB0aGF0CiAgICAgICAgZWxzZWlmKCRVc2VyTmFtZSkgewogICAgICAgICAgICAjIFdyaXRlLVZlcmJvc2UgIlsqXSBVc2luZyB0YXJnZXQgdXNlciAnJFVzZXJOYW1lJy4uLiIKICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gJFVzZXJOYW1lIHwgRm9yRWFjaC1PYmplY3QgeyRfLlRvTG93ZXIoKX0KICAgICAgICAgICAgaWYoJFRhcmdldFVzZXJzIC1pc25vdCBbU3lzdGVtLkFycmF5XSkgewogICAgICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gQCgkVGFyZ2V0VXNlcnMpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgIyByZWFkIGluIGEgdGFyZ2V0IHVzZXIgbGlzdCBpZiB3ZSBoYXZlIG9uZQogICAgICAgIGVsc2VpZigkVXNlckZpbGUpIHsKICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gR2V0LUNvbnRlbnQgLVBhdGggJFVzZXJGaWxlIHwgV2hlcmUtT2JqZWN0IHskX30KICAgICAgICB9CiAgICAgICAgZWxzZWlmKCRVc2VyQURTcGF0aCAtb3IgJFVzZXJGaWx0ZXIpIHsKICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciB1c2VycyIKICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyArPSBHZXQtTmV0VXNlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJFVzZXJBRFNwYXRoIC1GaWx0ZXIgJFVzZXJGaWx0ZXIgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgJF8uc2FtYWNjb3VudG5hbWUKICAgICAgICAgICAgICAgIH0gIHwgV2hlcmUtT2JqZWN0IHskX30KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciB1c2VycyBvZiBncm91cCAnJEdyb3VwTmFtZSciCiAgICAgICAgICAgICAgICAkVGFyZ2V0VXNlcnMgKz0gR2V0LU5ldEdyb3VwTWVtYmVyIC1Hcm91cE5hbWUgJEdyb3VwTmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgJF8uTWVtYmVyTmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoKCghJFRhcmdldFVzZXJzKSAtb3IgKCRUYXJnZXRVc2Vycy5Db3VudCAtZXEgMCkpKSB7CiAgICAgICAgICAgIHRocm93ICJbIV0gTm8gdXNlcnMgZm91bmQgdG8gc2VhcmNoIGZvciEiCiAgICAgICAgfQoKICAgICAgICAjIHNjcmlwdCBibG9jayB0aGF0IGVudW1lcmF0ZXMgYSBzZXJ2ZXIKICAgICAgICAkSG9zdEVudW1CbG9jayA9IHsKICAgICAgICAgICAgcGFyYW0oJENvbXB1dGVyTmFtZSwgJFBpbmcsICRUYXJnZXRVc2VycywgJFNlYXJjaERheXMsICRDcmVkZW50aWFsKQoKICAgICAgICAgICAgIyBvcHRpb25hbGx5IGNoZWNrIGlmIHRoZSBzZXJ2ZXIgaXMgdXAgZmlyc3QKICAgICAgICAgICAgJFVwID0gJFRydWUKICAgICAgICAgICAgaWYoJFBpbmcpIHsKICAgICAgICAgICAgICAgICRVcCA9IFRlc3QtQ29ubmVjdGlvbiAtQ291bnQgMSAtUXVpZXQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJFVwKSB7CiAgICAgICAgICAgICAgICAjIHRyeSB0byBlbnVtZXJhdGUKICAgICAgICAgICAgICAgIGlmKCRDcmVkZW50aWFsKSB7CiAgICAgICAgICAgICAgICAgICAgR2V0LVVzZXJFdmVudCAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUV2ZW50VHlwZSAnYWxsJyAtRGF0ZVN0YXJ0IChbRGF0ZVRpbWVdOjpUb2RheS5BZGREYXlzKC0kU2VhcmNoRGF5cykpIHwgV2hlcmUtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBmaWx0ZXIgZm9yIHRoZSB0YXJnZXQgdXNlciBzZXQKICAgICAgICAgICAgICAgICAgICAgICAgJFRhcmdldFVzZXJzIC1jb250YWlucyAkXy5Vc2VyTmFtZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIEdldC1Vc2VyRXZlbnQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1FdmVudFR5cGUgJ2FsbCcgLURhdGVTdGFydCAoW0RhdGVUaW1lXTo6VG9kYXkuQWRkRGF5cygtJFNlYXJjaERheXMpKSB8IFdoZXJlLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgZmlsdGVyIGZvciB0aGUgdGFyZ2V0IHVzZXIgc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyAtY29udGFpbnMgJF8uVXNlck5hbWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQoKICAgIHByb2Nlc3MgewoKICAgICAgICBpZigkVGhyZWFkcykgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJVc2luZyB0aHJlYWRpbmcgd2l0aCB0aHJlYWRzID0gJFRocmVhZHMiCgogICAgICAgICAgICAjIGlmIHdlJ3JlIHVzaW5nIHRocmVhZGluZywga2ljayBvZmYgdGhlIHNjcmlwdCBibG9jayB3aXRoIEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uCiAgICAgICAgICAgICRTY3JpcHRQYXJhbXMgPSBAewogICAgICAgICAgICAgICAgJ1BpbmcnID0gJCgtbm90ICROb1BpbmcpCiAgICAgICAgICAgICAgICAnVGFyZ2V0VXNlcnMnID0gJFRhcmdldFVzZXJzCiAgICAgICAgICAgICAgICAnU2VhcmNoRGF5cycgPSAkU2VhcmNoRGF5cwogICAgICAgICAgICAgICAgJ0NyZWRlbnRpYWwnID0gJENyZWRlbnRpYWwKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBraWNrIG9mZiB0aGUgdGhyZWFkZWQgc2NyaXB0IGJsb2NrICsgYXJndW1lbnRzIAogICAgICAgICAgICBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1TY3JpcHRQYXJhbWV0ZXJzICRTY3JpcHRQYXJhbXMgLVRocmVhZHMgJFRocmVhZHMKICAgICAgICB9CgogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZigtbm90ICROb1BpbmcgLWFuZCAoJENvbXB1dGVyTmFtZS5jb3VudCAtbmUgMSkpIHsKICAgICAgICAgICAgICAgICMgcGluZyBhbGwgaG9zdHMgaW4gcGFyYWxsZWwKICAgICAgICAgICAgICAgICRQaW5nID0ge3BhcmFtKCRDb21wdXRlck5hbWUpIGlmKFRlc3QtQ29ubmVjdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLUNvdW50IDEgLVF1aWV0IC1FcnJvckFjdGlvbiBTdG9wKXskQ29tcHV0ZXJOYW1lfX0KICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtTm9JbXBvcnRzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtU2NyaXB0QmxvY2sgJFBpbmcgLVRocmVhZHMgMTAwCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBUb3RhbCBudW1iZXIgb2YgYWN0aXZlIGhvc3RzOiAkKCRDb21wdXRlck5hbWUuY291bnQpIgogICAgICAgICAgICAkQ291bnRlciA9IDAKCiAgICAgICAgICAgIEZvckVhY2ggKCRDb21wdXRlciBpbiAkQ29tcHV0ZXJOYW1lKSB7CgogICAgICAgICAgICAgICAgJENvdW50ZXIgPSAkQ291bnRlciArIDEKCiAgICAgICAgICAgICAgICAjIHNsZWVwIGZvciBvdXIgc2VtaS1yYW5kb21pemVkIGludGVydmFsCiAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAtU2Vjb25kcyAkUmFuZE5vLk5leHQoKDEtJEppdHRlcikqJERlbGF5LCAoMSskSml0dGVyKSokRGVsYXkpCgogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIEVudW1lcmF0aW5nIHNlcnZlciAkQ29tcHV0ZXIgKCRDb3VudGVyIG9mICQoJENvbXB1dGVyTmFtZS5jb3VudCkpIgogICAgICAgICAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1Bcmd1bWVudExpc3QgJENvbXB1dGVyLCAkKC1ub3QgJE5vUGluZyksICRUYXJnZXRVc2VycywgJFNlYXJjaERheXMsICRDcmVkZW50aWFsCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQp9CgoKZnVuY3Rpb24gSW52b2tlLVNoYXJlRmluZGVyIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIGZpbmRzIHRoZSBsb2NhbCBkb21haW4gbmFtZSBmb3IgYSBob3N0IHVzaW5nIEdldC1OZXREb21haW4sCiAgICAgICAgcXVlcmllcyB0aGUgZG9tYWluIGZvciBhbGwgYWN0aXZlIG1hY2hpbmVzIHdpdGggR2V0LU5ldENvbXB1dGVyLCB0aGVuIGZvcgogICAgICAgIGVhY2ggc2VydmVyIGl0IGxpc3RzIG9mIGFjdGl2ZSBzaGFyZXMgd2l0aCBHZXQtTmV0U2hhcmUuIE5vbi1zdGFuZGFyZCBzaGFyZXMKICAgICAgICBjYW4gYmUgZmlsdGVyZWQgb3V0IHdpdGggLUV4Y2x1ZGUqIGZsYWdzLgoKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgSG9zdCBhcnJheSB0byBlbnVtZXJhdGUsIHBhc3NhYmxlIG9uIHRoZSBwaXBlbGluZS4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsZQoKICAgICAgICBGaWxlIG9mIGhvc3RuYW1lcy9JUHMgdG8gc2VhcmNoLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJGaWx0ZXIKCiAgICAgICAgSG9zdCBmaWx0ZXIgbmFtZSB0byBxdWVyeSBBRCBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIGhvc3RzLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgRXhjbHVkZVN0YW5kYXJkCgogICAgICAgIFN3aXRjaC4gRXhjbHVkZSBzdGFuZGFyZCBzaGFyZXMgZnJvbSBkaXNwbGF5IChDJCwgSVBDJCwgcHJpbnQkIGV0Yy4pCgogICAgLlBBUkFNRVRFUiBFeGNsdWRlUHJpbnQKCiAgICAgICAgU3dpdGNoLiBFeGNsdWRlIHRoZSBwcmludCQgc2hhcmUuCgogICAgLlBBUkFNRVRFUiBFeGNsdWRlSVBDCgogICAgICAgIFN3aXRjaC4gRXhjbHVkZSB0aGUgSVBDJCBzaGFyZS4KCiAgICAuUEFSQU1FVEVSIENoZWNrU2hhcmVBY2Nlc3MKCiAgICAgICAgU3dpdGNoLiBPbmx5IGRpc3BsYXkgZm91bmQgc2hhcmVzIHRoYXQgdGhlIGxvY2FsIHVzZXIgaGFzIGFjY2VzcyB0by4KCiAgICAuUEFSQU1FVEVSIENoZWNrQWRtaW4KCiAgICAgICAgU3dpdGNoLiBPbmx5IGRpc3BsYXkgQURNSU4kIHNoYXJlcyB0aGUgbG9jYWwgdXNlciBoYXMgYWNjZXNzIHRvLgoKICAgIC5QQVJBTUVURVIgTm9QaW5nCgogICAgICAgIFN3aXRjaC4gRG9uJ3QgcGluZyBlYWNoIGhvc3QgdG8gZW5zdXJlIGl0J3MgdXAgYmVmb3JlIGVudW1lcmF0aW5nLgoKICAgIC5QQVJBTUVURVIgRGVsYXkKCiAgICAgICAgRGVsYXkgYmV0d2VlbiBlbnVtZXJhdGluZyBob3N0cywgZGVmYXVsdHMgdG8gMC4KCiAgICAuUEFSQU1FVEVSIEppdHRlcgoKICAgICAgICBKaXR0ZXIgZm9yIHRoZSBob3N0IGRlbGF5LCBkZWZhdWx0cyB0byArLy0gMC4zLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIERvbWFpbiB0byBxdWVyeSBmb3IgbWFjaGluZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaEZvcmVzdAoKICAgICAgICBTd2l0Y2guIFNlYXJjaCBhbGwgZG9tYWlucyBpbiB0aGUgZm9yZXN0IGZvciB0YXJnZXQgdXNlcnMgaW5zdGVhZCBvZiBqdXN0CiAgICAgICAgYSBzaW5nbGUgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgVGhyZWFkcwoKICAgICAgICBUaGUgbWF4aW11bSBjb25jdXJyZW50IHRocmVhZHMgdG8gZXhlY3V0ZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1TaGFyZUZpbmRlciAtRXhjbHVkZVN0YW5kYXJkCgogICAgICAgIEZpbmQgbm9uLXN0YW5kYXJkIHNoYXJlcyBvbiB0aGUgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVNoYXJlRmluZGVyIC1UaHJlYWRzIDIwCgogICAgICAgIE11bHRpLXRocmVhZGVkIHNoYXJlIGZpbmRpbmcsIHJlcGxhY2VzIEludm9rZS1TaGFyZUZpbmRlclRocmVhZGVkLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVNoYXJlRmluZGVyIC1EZWxheSA2MAoKICAgICAgICBGaW5kIHNoYXJlcyBvbiB0aGUgZG9tYWluIHdpdGggYSA2MCBzZWNvbmQgKCsvLSAqLjMpCiAgICAgICAgcmFuZG9taXplZCBkZWxheSBiZXR3ZWVuIHRvdWNoaW5nIGVhY2ggaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1TaGFyZUZpbmRlciAtQ29tcHV0ZXJGaWxlIGhvc3RzLnR4dAoKICAgICAgICBGaW5kIHNoYXJlcyBmb3IgbWFjaGluZXMgaW4gdGhlIHNwZWNpZmllZCBob3N0cyBmaWxlLgoKICAgIC5MSU5LCiAgICBodHRwOi8vYmxvZy5oYXJtajB5Lm5ldAojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdHMnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW0FsaWFzKCdIb3N0TGlzdCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyQURTcGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRXhjbHVkZVN0YW5kYXJkLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRFeGNsdWRlUHJpbnQsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEV4Y2x1ZGVJUEMsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJE5vUGluZywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQ2hlY2tTaGFyZUFjY2VzcywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQ2hlY2tBZG1pbiwKCiAgICAgICAgW1VJbnQzMl0KICAgICAgICAkRGVsYXkgPSAwLAoKICAgICAgICBbRG91YmxlXQogICAgICAgICRKaXR0ZXIgPSAuMywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAogCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2VhcmNoRm9yZXN0LAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFRocmVhZHMKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snRGVidWcnXSkgewogICAgICAgICAgICAkRGVidWdQcmVmZXJlbmNlID0gJ0NvbnRpbnVlJwogICAgICAgIH0KCiAgICAgICAgIyByYW5kb20gb2JqZWN0IGZvciBkZWxheQogICAgICAgICRSYW5kTm8gPSBOZXctT2JqZWN0IFN5c3RlbS5SYW5kb20KCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFJ1bm5pbmcgSW52b2tlLVNoYXJlRmluZGVyIHdpdGggZGVsYXkgb2YgJERlbGF5IgoKICAgICAgICAjIGZpZ3VyZSBvdXQgdGhlIHNoYXJlcyB3ZSB3YW50IHRvIGlnbm9yZQogICAgICAgIFtTdHJpbmdbXV0gJEV4Y2x1ZGVkU2hhcmVzID0gQCgnJykKCiAgICAgICAgaWYgKCRFeGNsdWRlUHJpbnQpIHsKICAgICAgICAgICAgJEV4Y2x1ZGVkU2hhcmVzID0gJEV4Y2x1ZGVkU2hhcmVzICsgIlBSSU5UJCIKICAgICAgICB9CiAgICAgICAgaWYgKCRFeGNsdWRlSVBDKSB7CiAgICAgICAgICAgICRFeGNsdWRlZFNoYXJlcyA9ICRFeGNsdWRlZFNoYXJlcyArICJJUEMkIgogICAgICAgIH0KICAgICAgICBpZiAoJEV4Y2x1ZGVTdGFuZGFyZCkgewogICAgICAgICAgICAkRXhjbHVkZWRTaGFyZXMgPSBAKCcnLCAiQURNSU4kIiwgIklQQyQiLCAiQyQiLCAiUFJJTlQkIikKICAgICAgICB9CgogICAgICAgICMgaWYgd2UncmUgdXNpbmcgYSBob3N0IGZpbGUgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgaWYoJENvbXB1dGVyRmlsZSkgewogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gR2V0LUNvbnRlbnQgLVBhdGggJENvbXB1dGVyRmlsZQogICAgICAgIH0KCiAgICAgICAgaWYoISRDb21wdXRlck5hbWUpIHsgCiAgICAgICAgICAgIFthcnJheV0kQ29tcHV0ZXJOYW1lID0gQCgpCgogICAgICAgICAgICBpZigkRG9tYWluKSB7CiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoJERvbWFpbikKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoJFNlYXJjaEZvcmVzdCkgewogICAgICAgICAgICAgICAgIyBnZXQgQUxMIHRoZSBkb21haW5zIGluIHRoZSBmb3Jlc3QgdG8gc2VhcmNoCiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEdldC1OZXRGb3Jlc3REb21haW4gfCBGb3JFYWNoLU9iamVjdCB7ICRfLk5hbWUgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgIyB1c2UgdGhlIGxvY2FsIGRvbWFpbgogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCAoR2V0LU5ldERvbWFpbikubmFtZSApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICBGb3JFYWNoICgkRG9tYWluIGluICRUYXJnZXREb21haW5zKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIGhvc3RzIgogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSArPSBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1GaWx0ZXIgJENvbXB1dGVyRmlsdGVyIC1BRFNwYXRoICRDb21wdXRlckFEU3BhdGgKICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgICAgICAjIHJlbW92ZSBhbnkgbnVsbCB0YXJnZXQgaG9zdHMsIHVuaXF1aWZ5IHRoZSBsaXN0IGFuZCBzaHVmZmxlIGl0CiAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHsgJF8gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgfCBTb3J0LU9iamVjdCB7IEdldC1SYW5kb20gfQogICAgICAgICAgICBpZigkKCRDb21wdXRlck5hbWUuY291bnQpIC1lcSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiTm8gaG9zdHMgZm91bmQhIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHNjcmlwdCBibG9jayB0aGF0IGVudW1lcmF0ZXMgYSBzZXJ2ZXIKICAgICAgICAkSG9zdEVudW1CbG9jayA9IHsKICAgICAgICAgICAgcGFyYW0oJENvbXB1dGVyTmFtZSwgJFBpbmcsICRDaGVja1NoYXJlQWNjZXNzLCAkRXhjbHVkZWRTaGFyZXMsICRDaGVja0FkbWluKQoKICAgICAgICAgICAgIyBvcHRpb25hbGx5IGNoZWNrIGlmIHRoZSBzZXJ2ZXIgaXMgdXAgZmlyc3QKICAgICAgICAgICAgJFVwID0gJFRydWUKICAgICAgICAgICAgaWYoJFBpbmcpIHsKICAgICAgICAgICAgICAgICRVcCA9IFRlc3QtQ29ubmVjdGlvbiAtQ291bnQgMSAtUXVpZXQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJFVwKSB7CiAgICAgICAgICAgICAgICAjIGdldCB0aGUgc2hhcmVzIGZvciB0aGlzIGhvc3QgYW5kIGNoZWNrIHdoYXQgd2UgZmluZAogICAgICAgICAgICAgICAgJFNoYXJlcyA9IEdldC1OZXRTaGFyZSAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgIEZvckVhY2ggKCRTaGFyZSBpbiAkU2hhcmVzKSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFNlcnZlciBzaGFyZTogJFNoYXJlIgogICAgICAgICAgICAgICAgICAgICROZXROYW1lID0gJFNoYXJlLnNoaTFfbmV0bmFtZQogICAgICAgICAgICAgICAgICAgICRSZW1hcmsgPSAkU2hhcmUuc2hpMV9yZW1hcmsKICAgICAgICAgICAgICAgICAgICAkUGF0aCA9ICdcXCcrJENvbXB1dGVyTmFtZSsnXCcrJE5ldE5hbWUKCiAgICAgICAgICAgICAgICAgICAgIyBtYWtlIHN1cmUgd2UgZ2V0IGEgcmVhbCBzaGFyZSBuYW1lIGJhY2sKICAgICAgICAgICAgICAgICAgICBpZiAoKCROZXROYW1lKSAtYW5kICgkTmV0TmFtZS50cmltKCkgLW5lICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIGp1c3QgY2hlY2tpbmcgZm9yIGFjY2VzcyB0byBBRE1JTiQKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJENoZWNrQWRtaW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCROZXROYW1lLlRvVXBwZXIoKSAtZXEgIkFETUlOJCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTnVsbCA9IFtJTy5EaXJlY3RvcnldOjpHZXRGaWxlcygkUGF0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlxcJENvbXB1dGVyTmFtZVwkTmV0TmFtZSBgdC0gJFJlbWFyayIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBhY2Nlc3NpbmcgcGF0aCAkUGF0aCA6ICRfIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAjIHNraXAgdGhpcyBzaGFyZSBpZiBpdCdzIGluIHRoZSBleGNsdWRlIGxpc3QKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmICgkRXhjbHVkZWRTaGFyZXMgLU5vdENvbnRhaW5zICROZXROYW1lLlRvVXBwZXIoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBzZWUgaWYgd2Ugd2FudCB0byBjaGVjayBhY2Nlc3MgdG8gdGhpcyBzaGFyZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJENoZWNrU2hhcmVBY2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIHRoZSB1c2VyIGhhcyBhY2Nlc3MgdG8gdGhpcyBwYXRoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE51bGwgPSBbSU8uRGlyZWN0b3J5XTo6R2V0RmlsZXMoJFBhdGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJcXCRDb21wdXRlck5hbWVcJE5ldE5hbWUgYHQtICRSZW1hcmsiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgYWNjZXNzaW5nIHBhdGggJFBhdGggOiAkXyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiXFwkQ29tcHV0ZXJOYW1lXCROZXROYW1lIGB0LSAkUmVtYXJrIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgaWYoJFRocmVhZHMpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVXNpbmcgdGhyZWFkaW5nIHdpdGggdGhyZWFkcyA9ICRUaHJlYWRzIgoKICAgICAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyB0aHJlYWRpbmcsIGtpY2sgb2ZmIHRoZSBzY3JpcHQgYmxvY2sgd2l0aCBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbgogICAgICAgICAgICAkU2NyaXB0UGFyYW1zID0gQHsKICAgICAgICAgICAgICAgICdQaW5nJyA9ICQoLW5vdCAkTm9QaW5nKQogICAgICAgICAgICAgICAgJ0NoZWNrU2hhcmVBY2Nlc3MnID0gJENoZWNrU2hhcmVBY2Nlc3MKICAgICAgICAgICAgICAgICdFeGNsdWRlZFNoYXJlcycgPSAkRXhjbHVkZWRTaGFyZXMKICAgICAgICAgICAgICAgICdDaGVja0FkbWluJyA9ICRDaGVja0FkbWluCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMga2ljayBvZmYgdGhlIHRocmVhZGVkIHNjcmlwdCBibG9jayArIGFyZ3VtZW50cyAKICAgICAgICAgICAgSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1TY3JpcHRCbG9jayAkSG9zdEVudW1CbG9jayAtU2NyaXB0UGFyYW1ldGVycyAkU2NyaXB0UGFyYW1zIC1UaHJlYWRzICRUaHJlYWRzCiAgICAgICAgfQoKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYoLW5vdCAkTm9QaW5nIC1hbmQgKCRDb21wdXRlck5hbWUuY291bnQgLW5lIDEpKSB7CiAgICAgICAgICAgICAgICAjIHBpbmcgYWxsIGhvc3RzIGluIHBhcmFsbGVsCiAgICAgICAgICAgICAgICAkUGluZyA9IHtwYXJhbSgkQ29tcHV0ZXJOYW1lKSBpZihUZXN0LUNvbm5lY3Rpb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1Db3VudCAxIC1RdWlldCAtRXJyb3JBY3Rpb24gU3RvcCl7JENvbXB1dGVyTmFtZX19CiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLU5vSW1wb3J0cyAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRQaW5nIC1UaHJlYWRzIDEwMAogICAgICAgICAgICB9CgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gVG90YWwgbnVtYmVyIG9mIGFjdGl2ZSBob3N0czogJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSIKICAgICAgICAgICAgJENvdW50ZXIgPSAwCgogICAgICAgICAgICBGb3JFYWNoICgkQ29tcHV0ZXIgaW4gJENvbXB1dGVyTmFtZSkgewoKICAgICAgICAgICAgICAgICRDb3VudGVyID0gJENvdW50ZXIgKyAxCgogICAgICAgICAgICAgICAgIyBzbGVlcCBmb3Igb3VyIHNlbWktcmFuZG9taXplZCBpbnRlcnZhbAogICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgJFJhbmROby5OZXh0KCgxLSRKaXR0ZXIpKiREZWxheSwgKDErJEppdHRlcikqJERlbGF5KQoKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBFbnVtZXJhdGluZyBzZXJ2ZXIgJENvbXB1dGVyICgkQ291bnRlciBvZiAkKCRDb21wdXRlck5hbWUuY291bnQpKSIKICAgICAgICAgICAgICAgIEludm9rZS1Db21tYW5kIC1TY3JpcHRCbG9jayAkSG9zdEVudW1CbG9jayAtQXJndW1lbnRMaXN0ICRDb21wdXRlciwgJEZhbHNlLCAkQ2hlY2tTaGFyZUFjY2VzcywgJEV4Y2x1ZGVkU2hhcmVzLCAkQ2hlY2tBZG1pbgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgfQp9CgoKZnVuY3Rpb24gSW52b2tlLUZpbGVGaW5kZXIgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEZpbmRzIHNlbnNpdGl2ZSBmaWxlcyBvbiB0aGUgZG9tYWluLgoKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFRoaXMgZnVuY3Rpb24gZmluZHMgdGhlIGxvY2FsIGRvbWFpbiBuYW1lIGZvciBhIGhvc3QgdXNpbmcgR2V0LU5ldERvbWFpbiwKICAgICAgICBxdWVyaWVzIHRoZSBkb21haW4gZm9yIGFsbCBhY3RpdmUgbWFjaGluZXMgd2l0aCBHZXQtTmV0Q29tcHV0ZXIsIGdyYWJzCiAgICAgICAgdGhlIHJlYWRhYmxlIHNoYXJlcyBmb3IgZWFjaCBzZXJ2ZXIsIGFuZCByZWN1cnNpdmVseSBzZWFyY2hlcyBldmVyeQogICAgICAgIHNoYXJlIGZvciBmaWxlcyB3aXRoIHNwZWNpZmljIGtleXdvcmRzIGluIHRoZSBuYW1lLgogICAgICAgIElmIGEgc2hhcmUgbGlzdCBpcyBwYXNzZWQsIEVWRVJZIHNoYXJlIGlzIGVudW1lcmF0ZWQgcmVnYXJkbGVzcyBvZgogICAgICAgIG90aGVyIG9wdGlvbnMuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgSG9zdCBhcnJheSB0byBlbnVtZXJhdGUsIHBhc3NhYmxlIG9uIHRoZSBwaXBlbGluZS4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsZQoKICAgICAgICBGaWxlIG9mIGhvc3RuYW1lcy9JUHMgdG8gc2VhcmNoLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJGaWx0ZXIKCiAgICAgICAgSG9zdCBmaWx0ZXIgbmFtZSB0byBxdWVyeSBBRCBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIGhvc3RzLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgU2hhcmVMaXN0CgogICAgICAgIExpc3QgaWYgXFxIT1NUXHNoYXJlcyB0byBzZWFyY2ggdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFRlcm1zCgogICAgICAgIFRlcm1zIHRvIHNlYXJjaCBmb3IuCgogICAgLlBBUkFNRVRFUiBPZmZpY2VEb2NzCgogICAgICAgIFN3aXRjaC4gU2VhcmNoIGZvciBvZmZpY2UgZG9jdW1lbnRzICgqLmRvYyosICoueGxzKiwgKi5wcHQqKQoKICAgIC5QQVJBTUVURVIgRnJlc2hFWEVzCgogICAgICAgIFN3aXRjaC4gRmluZCAuRVhFcyBhY2Nlc3NlZCB3aXRoaW4gdGhlIGxhc3Qgd2Vlay4KCiAgICAuUEFSQU1FVEVSIExhc3RBY2Nlc3NUaW1lCgogICAgICAgIE9ubHkgcmV0dXJuIGZpbGVzIHdpdGggYSBMYXN0QWNjZXNzVGltZSBncmVhdGVyIHRoYW4gdGhpcyBkYXRlIHZhbHVlLgoKICAgIC5QQVJBTUVURVIgTGFzdFdyaXRlVGltZQoKICAgICAgICBPbmx5IHJldHVybiBmaWxlcyB3aXRoIGEgTGFzdFdyaXRlVGltZSBncmVhdGVyIHRoYW4gdGhpcyBkYXRlIHZhbHVlLgoKICAgIC5QQVJBTUVURVIgQ3JlYXRpb25UaW1lCgogICAgICAgIE9ubHkgcmV0dXJuIGZpbGVzIHdpdGggYSBDcmVhdGlvbkRhdGUgZ3JlYXRlciB0aGFuIHRoaXMgZGF0ZSB2YWx1ZS4KCiAgICAuUEFSQU1FVEVSIEluY2x1ZGVDCgogICAgICAgIFN3aXRjaC4gSW5jbHVkZSBhbnkgQyQgc2hhcmVzIGluIHJlY3Vyc2l2ZSBzZWFyY2hpbmcgKGRlZmF1bHQgaWdub3JlKS4KCiAgICAuUEFSQU1FVEVSIEluY2x1ZGVBZG1pbgoKICAgICAgICBTd2l0Y2guIEluY2x1ZGUgYW55IEFETUlOJCBzaGFyZXMgaW4gcmVjdXJzaXZlIHNlYXJjaGluZyAoZGVmYXVsdCBpZ25vcmUpLgoKICAgIC5QQVJBTUVURVIgRXhjbHVkZUZvbGRlcnMKCiAgICAgICAgU3dpdGNoLiBFeGNsdWRlIGZvbGRlcnMgZnJvbSB0aGUgc2VhcmNoIHJlc3VsdHMuCgogICAgLlBBUkFNRVRFUiBFeGNsdWRlSGlkZGVuCgogICAgICAgIFN3aXRjaC4gRXhjbHVkZSBoaWRkZW4gZmlsZXMgYW5kIGZvbGRlcnMgZnJvbSB0aGUgc2VhcmNoIHJlc3VsdHMuCgogICAgLlBBUkFNRVRFUiBDaGVja1dyaXRlQWNjZXNzCgogICAgICAgIFN3aXRjaC4gT25seSByZXR1cm5zIGZpbGVzIHRoZSBjdXJyZW50IHVzZXIgaGFzIHdyaXRlIGFjY2VzcyB0by4KCiAgICAuUEFSQU1FVEVSIE91dEZpbGUKCiAgICAgICAgT3V0cHV0IHJlc3VsdHMgdG8gYSBzcGVjaWZpZWQgY3N2IG91dHB1dCBmaWxlLgoKICAgIC5QQVJBTUVURVIgTm9DbG9iYmVyCgogICAgICAgIFN3aXRjaC4gRG9uJ3Qgb3ZlcndyaXRlIGFueSBleGlzdGluZyBvdXRwdXQgZmlsZS4KCiAgICAuUEFSQU1FVEVSIE5vUGluZwoKICAgICAgICBTd2l0Y2guIERvbid0IHBpbmcgZWFjaCBob3N0IHRvIGVuc3VyZSBpdCdzIHVwIGJlZm9yZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIERlbGF5CgogICAgICAgIERlbGF5IGJldHdlZW4gZW51bWVyYXRpbmcgaG9zdHMsIGRlZmF1bHRzIHRvIDAKCiAgICAuUEFSQU1FVEVSIEppdHRlcgoKICAgICAgICBKaXR0ZXIgZm9yIHRoZSBob3N0IGRlbGF5LCBkZWZhdWx0cyB0byArLy0gMC4zCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIHRvIHF1ZXJ5IGZvciBtYWNoaW5lcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgU2VhcmNoRm9yZXN0CgogICAgICAgIFNlYXJjaCBhbGwgZG9tYWlucyBpbiB0aGUgZm9yZXN0IGZvciB0YXJnZXQgdXNlcnMgaW5zdGVhZCBvZiBqdXN0CiAgICAgICAgYSBzaW5nbGUgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgU2VhcmNoU1lTVk9MCgogICAgICAgIFN3aXRjaC4gU2VhcmNoIGZvciBsb2dpbiBzY3JpcHRzIG9uIHRoZSBTWVNWT0wgb2YgdGhlIHByaW1hcnkgRENzIGZvciBlYWNoIHNwZWNpZmllZCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBUaHJlYWRzCgogICAgICAgIFRoZSBtYXhpbXVtIGNvbmN1cnJlbnQgdGhyZWFkcyB0byBleGVjdXRlLgoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IHRhcmdldCByZW1vdGUgcGF0aCB3aXRoIHRlbXBvcmFyeSBQU0RyaXZlcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1GaWxlRmluZGVyCgogICAgICAgIEZpbmQgcmVhZGFibGUgZmlsZXMgb24gdGhlIGRvbWFpbiB3aXRoICdwYXNzJywgJ3NlbnNpdGl2ZScsCiAgICAgICAgJ3NlY3JldCcsICdhZG1pbicsICdsb2dpbicsIG9yICd1bmF0dGVuZCoueG1sJyBpbiB0aGUgbmFtZSwKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1GaWxlRmluZGVyIC1Eb21haW4gdGVzdGluZwoKICAgICAgICBGaW5kIHJlYWRhYmxlIGZpbGVzIG9uIHRoZSAndGVzdGluZycgZG9tYWluIHdpdGggJ3Bhc3MnLCAnc2Vuc2l0aXZlJywKICAgICAgICAnc2VjcmV0JywgJ2FkbWluJywgJ2xvZ2luJywgb3IgJ3VuYXR0ZW5kKi54bWwnIGluIHRoZSBuYW1lLAoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLUZpbGVGaW5kZXIgLUluY2x1ZGVDCgogICAgICAgIEZpbmQgcmVhZGFibGUgZmlsZXMgb24gdGhlIGRvbWFpbiB3aXRoICdwYXNzJywgJ3NlbnNpdGl2ZScsCiAgICAgICAgJ3NlY3JldCcsICdhZG1pbicsICdsb2dpbicgb3IgJ3VuYXR0ZW5kKi54bWwnIGluIHRoZSBuYW1lLAogICAgICAgIGluY2x1ZGluZyBDJCBzaGFyZXMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtRmlsZUZpbmRlciAtU2hhcmVMaXN0IHNoYXJlcy50eHQgLVRlcm1zIGFjY291bnRzLHNzbiAtT3V0RmlsZSBvdXQuY3N2CgogICAgICAgIEVudW1lcmF0ZSBhIHNwZWNpZmllZCBzaGFyZSBsaXN0IGZvciBmaWxlcyB3aXRoICdhY2NvdW50cycgb3IKICAgICAgICAnc3NuJyBpbiB0aGUgbmFtZSwgYW5kIHdyaXRlIGV2ZXJ5dGhpbmcgdG8gIm91dC5jc3YiCgogICAgLkxJTksKICAgICAgICBodHRwOi8vd3d3Lmhhcm1qMHkubmV0L2Jsb2cvcmVkdGVhbWluZy9maWxlLXNlcnZlci10cmlhZ2Utb24tcmVkLXRlYW0tZW5nYWdlbWVudHMvCgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdHMnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW0FsaWFzKCdIb3N0TGlzdCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyQURTcGF0aCwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2hhcmVMaXN0LAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRPZmZpY2VEb2NzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRGcmVzaEVYRXMsCgogICAgICAgIFtBbGlhcygnVGVybXMnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJFNlYXJjaFRlcm1zLCAKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGVybUxpc3QsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJExhc3RBY2Nlc3NUaW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRMYXN0V3JpdGVUaW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDcmVhdGlvblRpbWUsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEluY2x1ZGVDLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRJbmNsdWRlQWRtaW4sCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEV4Y2x1ZGVGb2xkZXJzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRFeGNsdWRlSGlkZGVuLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRDaGVja1dyaXRlQWNjZXNzLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRPdXRGaWxlLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICROb0Nsb2JiZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJE5vUGluZywKCiAgICAgICAgW1VJbnQzMl0KICAgICAgICAkRGVsYXkgPSAwLAoKICAgICAgICBbRG91YmxlXQogICAgICAgICRKaXR0ZXIgPSAuMywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAogICAgICAgIAogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNlYXJjaEZvcmVzdCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2VhcmNoU1lTVk9MLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFRocmVhZHMsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVzZVBTRHJpdmUKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snRGVidWcnXSkgewogICAgICAgICAgICAkRGVidWdQcmVmZXJlbmNlID0gJ0NvbnRpbnVlJwogICAgICAgIH0KCiAgICAgICAgIyByYW5kb20gb2JqZWN0IGZvciBkZWxheQogICAgICAgICRSYW5kTm8gPSBOZXctT2JqZWN0IFN5c3RlbS5SYW5kb20KCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFJ1bm5pbmcgSW52b2tlLUZpbGVGaW5kZXIgd2l0aCBkZWxheSBvZiAkRGVsYXkiCgogICAgICAgICRTaGFyZXMgPSBAKCkKCiAgICAgICAgIyBmaWd1cmUgb3V0IHRoZSBzaGFyZXMgd2Ugd2FudCB0byBpZ25vcmUKICAgICAgICBbU3RyaW5nW11dICRFeGNsdWRlZFNoYXJlcyA9IEAoIkMkIiwgIkFETUlOJCIpCgogICAgICAgICMgc2VlIGlmIHdlJ3JlIHNwZWNpZmljYWxseSBpbmNsdWRpbmcgYW55IG9mIHRoZSBub3JtYWxseSBleGNsdWRlZCBzZXRzCiAgICAgICAgaWYgKCRJbmNsdWRlQykgewogICAgICAgICAgICBpZiAoJEluY2x1ZGVBZG1pbikgewogICAgICAgICAgICAgICAgJEV4Y2x1ZGVkU2hhcmVzID0gQCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkRXhjbHVkZWRTaGFyZXMgPSBAKCJBRE1JTiQiKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoJEluY2x1ZGVBZG1pbikgewogICAgICAgICAgICBpZiAoJEluY2x1ZGVDKSB7CiAgICAgICAgICAgICAgICAkRXhjbHVkZWRTaGFyZXMgPSBAKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRFeGNsdWRlZFNoYXJlcyA9IEAoIkMkIikKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBkZWxldGUgYW55IGV4aXN0aW5nIG91dHB1dCBmaWxlIGlmIGl0IGFscmVhZHkgZXhpc3RzCiAgICAgICAgaWYoISROb0Nsb2JiZXIpIHsKICAgICAgICAgICAgaWYgKCRPdXRGaWxlIC1hbmQgKFRlc3QtUGF0aCAtUGF0aCAkT3V0RmlsZSkpIHsgUmVtb3ZlLUl0ZW0gLVBhdGggJE91dEZpbGUgfQogICAgICAgIH0KCiAgICAgICAgIyBpZiB0aGVyZSdzIGEgc2V0IG9mIHRlcm1zIHNwZWNpZmllZCB0byBzZWFyY2ggZm9yCiAgICAgICAgaWYgKCRUZXJtTGlzdCkgewogICAgICAgICAgICBGb3JFYWNoICgkVGVybSBpbiBHZXQtQ29udGVudCAtUGF0aCAkVGVybUxpc3QpIHsKICAgICAgICAgICAgICAgIGlmICgoJFRlcm0gLW5lICROdWxsKSAtYW5kICgkVGVybS50cmltKCkgLW5lICcnKSkgewogICAgICAgICAgICAgICAgICAgICRTZWFyY2hUZXJtcyArPSAkVGVybQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGlmIHdlJ3JlIGhhcmQtcGFzc2VkIGEgc2V0IG9mIHNoYXJlcwogICAgICAgIGlmKCRTaGFyZUxpc3QpIHsKICAgICAgICAgICAgRm9yRWFjaCAoJEl0ZW0gaW4gR2V0LUNvbnRlbnQgLVBhdGggJFNoYXJlTGlzdCkgewogICAgICAgICAgICAgICAgaWYgKCgkSXRlbSAtbmUgJE51bGwpIC1hbmQgKCRJdGVtLnRyaW0oKSAtbmUgJycpKSB7CiAgICAgICAgICAgICAgICAgICAgIyBleGNsdWRlIGFueSAiW3RhYl0tIGNvbW1hbnRzIiwgaS5lLiB0aGUgb3V0cHV0IGZyb20gSW52b2tlLVNoYXJlRmluZGVyCiAgICAgICAgICAgICAgICAgICAgJFNoYXJlID0gJEl0ZW0uU3BsaXQoImB0IilbMF0KICAgICAgICAgICAgICAgICAgICAkU2hhcmVzICs9ICRTaGFyZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAjIGlmIHdlJ3JlIHVzaW5nIGEgaG9zdCBmaWxlIGxpc3QsIHJlYWQgdGhlIHRhcmdldHMgaW4gYW5kIGFkZCB0aGVtIHRvIHRoZSB0YXJnZXQgbGlzdAogICAgICAgICAgICBpZigkQ29tcHV0ZXJGaWxlKSB7CiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gR2V0LUNvbnRlbnQgLVBhdGggJENvbXB1dGVyRmlsZQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZighJENvbXB1dGVyTmFtZSkgewoKICAgICAgICAgICAgICAgIGlmKCREb21haW4pIHsKICAgICAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoJERvbWFpbikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2VpZigkU2VhcmNoRm9yZXN0KSB7CiAgICAgICAgICAgICAgICAgICAgIyBnZXQgQUxMIHRoZSBkb21haW5zIGluIHRoZSBmb3Jlc3QgdG8gc2VhcmNoCiAgICAgICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBHZXQtTmV0Rm9yZXN0RG9tYWluIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5OYW1lIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICMgdXNlIHRoZSBsb2NhbCBkb21haW4KICAgICAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoIChHZXQtTmV0RG9tYWluKS5uYW1lICkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigkU2VhcmNoU1lTVk9MKSB7CiAgICAgICAgICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgICAgICAgICAkRENTZWFyY2hQYXRoID0gIlxcJERvbWFpblxTWVNWT0xcIgogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gQWRkaW5nIHNoYXJlIHNlYXJjaCBwYXRoICREQ1NlYXJjaFBhdGgiCiAgICAgICAgICAgICAgICAgICAgICAgICRTaGFyZXMgKz0gJERDU2VhcmNoUGF0aAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZighJFNlYXJjaFRlcm1zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgc2VhcmNoIGZvciBpbnRlcmVzdGluZyBzY3JpcHRzIG9uIFNZU1ZPTAogICAgICAgICAgICAgICAgICAgICAgICAkU2VhcmNoVGVybXMgPSBAKCcudmJzJywgJy5iYXQnLCAnLnBzMScpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgW2FycmF5XSRDb21wdXRlck5hbWUgPSBAKCkKCiAgICAgICAgICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIGhvc3RzIgogICAgICAgICAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lICs9IEdldC1OZXRDb21wdXRlciAtRmlsdGVyICRDb21wdXRlckZpbHRlciAtQURTcGF0aCAkQ29tcHV0ZXJBRFNwYXRoIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgIyByZW1vdmUgYW55IG51bGwgdGFyZ2V0IGhvc3RzLCB1bmlxdWlmeSB0aGUgbGlzdCBhbmQgc2h1ZmZsZSBpdAogICAgICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHsgJF8gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgfCBTb3J0LU9iamVjdCB7IEdldC1SYW5kb20gfQogICAgICAgICAgICAgICAgICAgIGlmKCQoJENvbXB1dGVyTmFtZS5Db3VudCkgLWVxIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgIk5vIGhvc3RzIGZvdW5kISIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgc2NyaXB0IGJsb2NrIHRoYXQgZW51bWVyYXRlcyBzaGFyZXMgYW5kIGZpbGVzIG9uIGEgc2VydmVyCiAgICAgICAgJEhvc3RFbnVtQmxvY2sgPSB7CiAgICAgICAgICAgIHBhcmFtKCRDb21wdXRlck5hbWUsICRQaW5nLCAkRXhjbHVkZWRTaGFyZXMsICRTZWFyY2hUZXJtcywgJEV4Y2x1ZGVGb2xkZXJzLCAkT2ZmaWNlRG9jcywgJEV4Y2x1ZGVIaWRkZW4sICRGcmVzaEVYRXMsICRDaGVja1dyaXRlQWNjZXNzLCAkT3V0RmlsZSwgJFVzZVBTRHJpdmUpCgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDb21wdXRlck5hbWU6ICRDb21wdXRlck5hbWUiCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkV4Y2x1ZGVkU2hhcmVzOiAkRXhjbHVkZWRTaGFyZXMiCiAgICAgICAgICAgICRTZWFyY2hTaGFyZXMgPSBAKCkKCiAgICAgICAgICAgIGlmKCRDb21wdXRlck5hbWUuU3RhcnRzV2l0aCgiXFwiKSkgewogICAgICAgICAgICAgICAgIyBpZiBhIHNoYXJlIGlzIHBhc3NlZCBhcyB0aGUgc2VydmVyCiAgICAgICAgICAgICAgICAkU2VhcmNoU2hhcmVzICs9ICRDb21wdXRlck5hbWUKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICMgaWYgd2UncmUgZW51bWVyYXRpbmcgdGhlIHNoYXJlcyBvbiB0aGUgdGFyZ2V0IHNlcnZlciBmaXJzdAogICAgICAgICAgICAgICAgJFVwID0gJFRydWUKICAgICAgICAgICAgICAgIGlmKCRQaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgJFVwID0gVGVzdC1Db25uZWN0aW9uIC1Db3VudCAxIC1RdWlldCAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCRVcCkgewogICAgICAgICAgICAgICAgICAgICMgZ2V0IHRoZSBzaGFyZXMgZm9yIHRoaXMgaG9zdCBhbmQgZGlzcGxheSB3aGF0IHdlIGZpbmQKICAgICAgICAgICAgICAgICAgICAkU2hhcmVzID0gR2V0LU5ldFNoYXJlIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgICAgIEZvckVhY2ggKCRTaGFyZSBpbiAkU2hhcmVzKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAkTmV0TmFtZSA9ICRTaGFyZS5zaGkxX25ldG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJFBhdGggPSAnXFwnKyRDb21wdXRlck5hbWUrJ1wnKyROZXROYW1lCgogICAgICAgICAgICAgICAgICAgICAgICAjIG1ha2Ugc3VyZSB3ZSBnZXQgYSByZWFsIHNoYXJlIG5hbWUgYmFjawogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCROZXROYW1lKSAtYW5kICgkTmV0TmFtZS50cmltKCkgLW5lICcnKSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgc2tpcCB0aGlzIHNoYXJlIGlmIGl0J3MgaW4gdGhlIGV4Y2x1ZGUgbGlzdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRFeGNsdWRlZFNoYXJlcyAtTm90Q29udGFpbnMgJE5ldE5hbWUuVG9VcHBlcigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBjaGVjayBpZiB0aGUgdXNlciBoYXMgYWNjZXNzIHRvIHRoaXMgcGF0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICROdWxsID0gW0lPLkRpcmVjdG9yeV06OkdldEZpbGVzKCRQYXRoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkU2VhcmNoU2hhcmVzICs9ICRQYXRoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWyFdIE5vIGFjY2VzcyB0byAkUGF0aCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEZvckVhY2goJFNoYXJlIGluICRTZWFyY2hTaGFyZXMpIHsKICAgICAgICAgICAgICAgICRTZWFyY2hBcmdzID0gIEB7CiAgICAgICAgICAgICAgICAgICAgJ1BhdGgnID0gJFNoYXJlCiAgICAgICAgICAgICAgICAgICAgJ1NlYXJjaFRlcm1zJyA9ICRTZWFyY2hUZXJtcwogICAgICAgICAgICAgICAgICAgICdPZmZpY2VEb2NzJyA9ICRPZmZpY2VEb2NzCiAgICAgICAgICAgICAgICAgICAgJ0ZyZXNoRVhFcycgPSAkRnJlc2hFWEVzCiAgICAgICAgICAgICAgICAgICAgJ0xhc3RBY2Nlc3NUaW1lJyA9ICRMYXN0QWNjZXNzVGltZQogICAgICAgICAgICAgICAgICAgICdMYXN0V3JpdGVUaW1lJyA9ICRMYXN0V3JpdGVUaW1lCiAgICAgICAgICAgICAgICAgICAgJ0NyZWF0aW9uVGltZScgPSAkQ3JlYXRpb25UaW1lCiAgICAgICAgICAgICAgICAgICAgJ0V4Y2x1ZGVGb2xkZXJzJyA9ICRFeGNsdWRlRm9sZGVycwogICAgICAgICAgICAgICAgICAgICdFeGNsdWRlSGlkZGVuJyA9ICRFeGNsdWRlSGlkZGVuCiAgICAgICAgICAgICAgICAgICAgJ0NoZWNrV3JpdGVBY2Nlc3MnID0gJENoZWNrV3JpdGVBY2Nlc3MKICAgICAgICAgICAgICAgICAgICAnT3V0RmlsZScgPSAkT3V0RmlsZQogICAgICAgICAgICAgICAgICAgICdVc2VQU0RyaXZlJyA9ICRVc2VQU0RyaXZlCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgRmluZC1JbnRlcmVzdGluZ0ZpbGUgQFNlYXJjaEFyZ3MKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgaWYoJFRocmVhZHMpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVXNpbmcgdGhyZWFkaW5nIHdpdGggdGhyZWFkcyA9ICRUaHJlYWRzIgoKICAgICAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyB0aHJlYWRpbmcsIGtpY2sgb2ZmIHRoZSBzY3JpcHQgYmxvY2sgd2l0aCBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbgogICAgICAgICAgICAkU2NyaXB0UGFyYW1zID0gQHsKICAgICAgICAgICAgICAgICdQaW5nJyA9ICQoLW5vdCAkTm9QaW5nKQogICAgICAgICAgICAgICAgJ0V4Y2x1ZGVkU2hhcmVzJyA9ICRFeGNsdWRlZFNoYXJlcwogICAgICAgICAgICAgICAgJ1NlYXJjaFRlcm1zJyA9ICRTZWFyY2hUZXJtcwogICAgICAgICAgICAgICAgJ0V4Y2x1ZGVGb2xkZXJzJyA9ICRFeGNsdWRlRm9sZGVycwogICAgICAgICAgICAgICAgJ09mZmljZURvY3MnID0gJE9mZmljZURvY3MKICAgICAgICAgICAgICAgICdFeGNsdWRlSGlkZGVuJyA9ICRFeGNsdWRlSGlkZGVuCiAgICAgICAgICAgICAgICAnRnJlc2hFWEVzJyA9ICRGcmVzaEVYRXMKICAgICAgICAgICAgICAgICdDaGVja1dyaXRlQWNjZXNzJyA9ICRDaGVja1dyaXRlQWNjZXNzCiAgICAgICAgICAgICAgICAnT3V0RmlsZScgPSAkT3V0RmlsZQogICAgICAgICAgICAgICAgJ1VzZVBTRHJpdmUnID0gJFVzZVBTRHJpdmUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBraWNrIG9mZiB0aGUgdGhyZWFkZWQgc2NyaXB0IGJsb2NrICsgYXJndW1lbnRzIAogICAgICAgICAgICBpZigkU2hhcmVzKSB7CiAgICAgICAgICAgICAgICAjIHBhc3MgdGhlIHNoYXJlcyBhcyB0aGUgaG9zdHMgc28gdGhlIHRocmVhZGVkIGZ1bmN0aW9uIGNvZGUgZG9lc24ndCBoYXZlIHRvIGJlIGhhY2tlZCB1cAogICAgICAgICAgICAgICAgSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLUNvbXB1dGVyTmFtZSAkU2hhcmVzIC1TY3JpcHRCbG9jayAkSG9zdEVudW1CbG9jayAtU2NyaXB0UGFyYW1ldGVycyAkU2NyaXB0UGFyYW1zIC1UaHJlYWRzICRUaHJlYWRzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1TY3JpcHRQYXJhbWV0ZXJzICRTY3JpcHRQYXJhbXMgLVRocmVhZHMgJFRocmVhZHMKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCRTaGFyZXMpewogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSA9ICRTaGFyZXMKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoLW5vdCAkTm9QaW5nIC1hbmQgKCRDb21wdXRlck5hbWUuY291bnQgLWd0IDEpKSB7CiAgICAgICAgICAgICAgICAjIHBpbmcgYWxsIGhvc3RzIGluIHBhcmFsbGVsCiAgICAgICAgICAgICAgICAkUGluZyA9IHtwYXJhbSgkQ29tcHV0ZXJOYW1lKSBpZihUZXN0LUNvbm5lY3Rpb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1Db3VudCAxIC1RdWlldCAtRXJyb3JBY3Rpb24gU3RvcCl7JENvbXB1dGVyTmFtZX19CiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLU5vSW1wb3J0cyAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRQaW5nIC1UaHJlYWRzIDEwMAogICAgICAgICAgICB9CgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gVG90YWwgbnVtYmVyIG9mIGFjdGl2ZSBob3N0czogJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSIKICAgICAgICAgICAgJENvdW50ZXIgPSAwCgogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDb21wdXRlcjogJF8iCiAgICAgICAgICAgICAgICAkQ291bnRlciA9ICRDb3VudGVyICsgMQoKICAgICAgICAgICAgICAgICMgc2xlZXAgZm9yIG91ciBzZW1pLXJhbmRvbWl6ZWQgaW50ZXJ2YWwKICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzICRSYW5kTm8uTmV4dCgoMS0kSml0dGVyKSokRGVsYXksICgxKyRKaXR0ZXIpKiREZWxheSkKCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gRW51bWVyYXRpbmcgc2VydmVyICRfICgkQ291bnRlciBvZiAkKCRDb21wdXRlck5hbWUuY291bnQpKSIKCiAgICAgICAgICAgICAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgJEhvc3RFbnVtQmxvY2sgLUFyZ3VtZW50TGlzdCAkXywgJEZhbHNlLCAkRXhjbHVkZWRTaGFyZXMsICRTZWFyY2hUZXJtcywgJEV4Y2x1ZGVGb2xkZXJzLCAkT2ZmaWNlRG9jcywgJEV4Y2x1ZGVIaWRkZW4sICRGcmVzaEVYRXMsICRDaGVja1dyaXRlQWNjZXNzLCAkT3V0RmlsZSwgJFVzZVBTRHJpdmUgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBGaW5kLUxvY2FsQWRtaW5BY2Nlc3Mgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEZpbmRzIG1hY2hpbmVzIG9uIHRoZSBsb2NhbCBkb21haW4gd2hlcmUgdGhlIGN1cnJlbnQgdXNlciBoYXMKICAgICAgICBsb2NhbCBhZG1pbmlzdHJhdG9yIGFjY2Vzcy4gVXNlcyBtdWx0aXRocmVhZGluZyB0bwogICAgICAgIHNwZWVkIHVwIGVudW1lcmF0aW9uLgoKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFRoaXMgZnVuY3Rpb24gZmluZHMgdGhlIGxvY2FsIGRvbWFpbiBuYW1lIGZvciBhIGhvc3QgdXNpbmcgR2V0LU5ldERvbWFpbiwKICAgICAgICBxdWVyaWVzIHRoZSBkb21haW4gZm9yIGFsbCBhY3RpdmUgbWFjaGluZXMgd2l0aCBHZXQtTmV0Q29tcHV0ZXIsIHRoZW4gZm9yCiAgICAgICAgZWFjaCBzZXJ2ZXIgaXQgY2hlY2tzIGlmIHRoZSBjdXJyZW50IHVzZXIgaGFzIGxvY2FsIGFkbWluaXN0cmF0b3IKICAgICAgICBhY2Nlc3MgdXNpbmcgSW52b2tlLUNoZWNrTG9jYWxBZG1pbkFjY2Vzcy4KCiAgICAgICAgSWRlYSBzdG9sZW4gZnJvbSB0aGUgbG9jYWxfYWRtaW5fc2VhcmNoX2VudW0gcG9zdCBtb2R1bGUgaW4KICAgICAgICBNZXRhc3Bsb2l0IHdyaXR0ZW4gYnk6CiAgICAgICAgICAgICdCcmFuZG9uIE1jQ2FubiAiemVrbm94IiA8Ym1jY2FublthdF1hY2N1dmFudC5jb20+JwogICAgICAgICAgICAnVGhvbWFzIE1jQ2FydGh5ICJzbWlsaW5ncmFjY29vbiIgPHNtaWxpbmdyYWNjb29uW2F0XWdtYWlsLmNvbT4nCiAgICAgICAgICAgICdSb3ljZSBEYXZpcyAicjNkeSIgPHJkYXZpc1thdF1hY2N1dmFudC5jb20+JwoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIEhvc3QgYXJyYXkgdG8gZW51bWVyYXRlLCBwYXNzYWJsZSBvbiB0aGUgcGlwZWxpbmUuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckZpbGUKCiAgICAgICAgRmlsZSBvZiBob3N0bmFtZXMvSVBzIHRvIHNlYXJjaC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsdGVyCgogICAgICAgIEhvc3QgZmlsdGVyIG5hbWUgdG8gcXVlcnkgQUQgZm9yLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoIGZvciBob3N0cywgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIE5vUGluZwoKICAgICAgICBTd2l0Y2guIERvbid0IHBpbmcgZWFjaCBob3N0IHRvIGVuc3VyZSBpdCdzIHVwIGJlZm9yZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIERlbGF5CgogICAgICAgIERlbGF5IGJldHdlZW4gZW51bWVyYXRpbmcgaG9zdHMsIGRlZmF1bHRzIHRvIDAKCiAgICAuUEFSQU1FVEVSIEppdHRlcgoKICAgICAgICBKaXR0ZXIgZm9yIHRoZSBob3N0IGRlbGF5LCBkZWZhdWx0cyB0byArLy0gMC4zCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIHRvIHF1ZXJ5IGZvciBtYWNoaW5lcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgogICAgCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaEZvcmVzdAoKICAgICAgICBTd2l0Y2guIFNlYXJjaCBhbGwgZG9tYWlucyBpbiB0aGUgZm9yZXN0IGZvciB0YXJnZXQgdXNlcnMgaW5zdGVhZCBvZiBqdXN0CiAgICAgICAgYSBzaW5nbGUgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgVGhyZWFkcwoKICAgICAgICBUaGUgbWF4aW11bSBjb25jdXJyZW50IHRocmVhZHMgdG8gZXhlY3V0ZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtTG9jYWxBZG1pbkFjY2VzcwoKICAgICAgICBGaW5kIG1hY2hpbmVzIG9uIHRoZSBsb2NhbCBkb21haW4gd2hlcmUgdGhlIGN1cnJlbnQgdXNlciBoYXMgbG9jYWwKICAgICAgICBhZG1pbmlzdHJhdG9yIGFjY2Vzcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtTG9jYWxBZG1pbkFjY2VzcyAtVGhyZWFkcyAxMAoKICAgICAgICBNdWx0aS10aHJlYWRlZCBhY2Nlc3MgaHVudGluZywgcmVwbGFjZXMgRmluZC1Mb2NhbEFkbWluQWNjZXNzVGhyZWFkZWQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUxvY2FsQWRtaW5BY2Nlc3MgLURvbWFpbiB0ZXN0aW5nCgogICAgICAgIEZpbmQgbWFjaGluZXMgb24gdGhlICd0ZXN0aW5nJyBkb21haW4gd2hlcmUgdGhlIGN1cnJlbnQgdXNlciBoYXMKICAgICAgICBsb2NhbCBhZG1pbmlzdHJhdG9yIGFjY2Vzcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtTG9jYWxBZG1pbkFjY2VzcyAtQ29tcHV0ZXJGaWxlIGhvc3RzLnR4dAoKICAgICAgICBGaW5kIHdoaWNoIG1hY2hpbmVzIGluIHRoZSBob3N0IGxpc3QgdGhlIGN1cnJlbnQgdXNlciBoYXMgbG9jYWwKICAgICAgICBhZG1pbmlzdHJhdG9yIGFjY2Vzcy4KCiAgICAuTElOSwoKICAgICAgICBodHRwczovL2dpdGh1Yi5jb20vcmFwaWQ3L21ldGFzcGxvaXQtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL21vZHVsZXMvcG9zdC93aW5kb3dzL2dhdGhlci9sb2NhbF9hZG1pbl9zZWFyY2hfZW51bS5yYgogICAgICAgIGh0dHA6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9wZW5ldGVzdGluZy9maW5kaW5nLWxvY2FsLWFkbWluLXdpdGgtdGhlLXZlaWwtZnJhbWV3b3JrLwojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdHMnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW0FsaWFzKCdIb3N0TGlzdCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyQURTcGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTm9QaW5nLAoKICAgICAgICBbVUludDMyXQogICAgICAgICREZWxheSA9IDAsCgogICAgICAgIFtEb3VibGVdCiAgICAgICAgJEppdHRlciA9IC4zLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNlYXJjaEZvcmVzdCwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRUaHJlYWRzCiAgICApCgogICAgYmVnaW4gewogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0RlYnVnJ10pIHsKICAgICAgICAgICAgJERlYnVnUHJlZmVyZW5jZSA9ICdDb250aW51ZScKICAgICAgICB9CgogICAgICAgICMgcmFuZG9tIG9iamVjdCBmb3IgZGVsYXkKICAgICAgICAkUmFuZE5vID0gTmV3LU9iamVjdCBTeXN0ZW0uUmFuZG9tCgogICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBSdW5uaW5nIEZpbmQtTG9jYWxBZG1pbkFjY2VzcyB3aXRoIGRlbGF5IG9mICREZWxheSIKCiAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyBhIGhvc3QgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgaWYoJENvbXB1dGVyRmlsZSkgewogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gR2V0LUNvbnRlbnQgLVBhdGggJENvbXB1dGVyRmlsZQogICAgICAgIH0KCiAgICAgICAgaWYoISRDb21wdXRlck5hbWUpIHsKICAgICAgICAgICAgW2FycmF5XSRDb21wdXRlck5hbWUgPSBAKCkKCiAgICAgICAgICAgIGlmKCREb21haW4pIHsKICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gQCgkRG9tYWluKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZigkU2VhcmNoRm9yZXN0KSB7CiAgICAgICAgICAgICAgICAjIGdldCBBTEwgdGhlIGRvbWFpbnMgaW4gdGhlIGZvcmVzdCB0byBzZWFyY2gKICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gR2V0LU5ldEZvcmVzdERvbWFpbiB8IEZvckVhY2gtT2JqZWN0IHsgJF8uTmFtZSB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAjIHVzZSB0aGUgbG9jYWwgZG9tYWluCiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoIChHZXQtTmV0RG9tYWluKS5uYW1lICkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciBob3N0cyIKICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgKz0gR2V0LU5ldENvbXB1dGVyIC1GaWx0ZXIgJENvbXB1dGVyRmlsdGVyIC1BRFNwYXRoICRDb21wdXRlckFEU3BhdGggLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyCiAgICAgICAgICAgIH0KICAgICAgICAKICAgICAgICAgICAgIyByZW1vdmUgYW55IG51bGwgdGFyZ2V0IGhvc3RzLCB1bmlxdWlmeSB0aGUgbGlzdCBhbmQgc2h1ZmZsZSBpdAogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJENvbXB1dGVyTmFtZSB8IFdoZXJlLU9iamVjdCB7ICRfIH0gfCBTb3J0LU9iamVjdCAtVW5pcXVlIHwgU29ydC1PYmplY3QgeyBHZXQtUmFuZG9tIH0KICAgICAgICAgICAgaWYoJCgkQ29tcHV0ZXJOYW1lLkNvdW50KSAtZXEgMCkgewogICAgICAgICAgICAgICAgdGhyb3cgIk5vIGhvc3RzIGZvdW5kISIKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBzY3JpcHQgYmxvY2sgdGhhdCBlbnVtZXJhdGVzIGEgc2VydmVyCiAgICAgICAgJEhvc3RFbnVtQmxvY2sgPSB7CiAgICAgICAgICAgIHBhcmFtKCRDb21wdXRlck5hbWUsICRQaW5nKQoKICAgICAgICAgICAgJFVwID0gJFRydWUKICAgICAgICAgICAgaWYoJFBpbmcpIHsKICAgICAgICAgICAgICAgICRVcCA9IFRlc3QtQ29ubmVjdGlvbiAtQ291bnQgMSAtUXVpZXQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJFVwKSB7CiAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIHRoZSBjdXJyZW50IHVzZXIgaGFzIGxvY2FsIGFkbWluIGFjY2VzcyB0byB0aGlzIHNlcnZlcgogICAgICAgICAgICAgICAgJEFjY2VzcyA9IEludm9rZS1DaGVja0xvY2FsQWRtaW5BY2Nlc3MgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICBpZiAoJEFjY2Vzcy5Jc0FkbWluKSB7CiAgICAgICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgaWYoJFRocmVhZHMpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVXNpbmcgdGhyZWFkaW5nIHdpdGggdGhyZWFkcyA9ICRUaHJlYWRzIgoKICAgICAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyB0aHJlYWRpbmcsIGtpY2sgb2ZmIHRoZSBzY3JpcHQgYmxvY2sgd2l0aCBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbgogICAgICAgICAgICAkU2NyaXB0UGFyYW1zID0gQHsKICAgICAgICAgICAgICAgICdQaW5nJyA9ICQoLW5vdCAkTm9QaW5nKQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGtpY2sgb2ZmIHRoZSB0aHJlYWRlZCBzY3JpcHQgYmxvY2sgKyBhcmd1bWVudHMgCiAgICAgICAgICAgIEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtU2NyaXB0QmxvY2sgJEhvc3RFbnVtQmxvY2sgLVNjcmlwdFBhcmFtZXRlcnMgJFNjcmlwdFBhcmFtcyAtVGhyZWFkcyAkVGhyZWFkcwogICAgICAgIH0KCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKC1ub3QgJE5vUGluZyAtYW5kICgkQ29tcHV0ZXJOYW1lLmNvdW50IC1uZSAxKSkgewogICAgICAgICAgICAgICAgIyBwaW5nIGFsbCBob3N0cyBpbiBwYXJhbGxlbAogICAgICAgICAgICAgICAgJFBpbmcgPSB7cGFyYW0oJENvbXB1dGVyTmFtZSkgaWYoVGVzdC1Db25uZWN0aW9uIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtQ291bnQgMSAtUXVpZXQgLUVycm9yQWN0aW9uIFN0b3ApeyRDb21wdXRlck5hbWV9fQogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSA9IEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uIC1Ob0ltcG9ydHMgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1TY3JpcHRCbG9jayAkUGluZyAtVGhyZWFkcyAxMDAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFRvdGFsIG51bWJlciBvZiBhY3RpdmUgaG9zdHM6ICQoJENvbXB1dGVyTmFtZS5jb3VudCkiCiAgICAgICAgICAgICRDb3VudGVyID0gMAoKICAgICAgICAgICAgRm9yRWFjaCAoJENvbXB1dGVyIGluICRDb21wdXRlck5hbWUpIHsKCiAgICAgICAgICAgICAgICAkQ291bnRlciA9ICRDb3VudGVyICsgMQoKICAgICAgICAgICAgICAgICMgc2xlZXAgZm9yIG91ciBzZW1pLXJhbmRvbWl6ZWQgaW50ZXJ2YWwKICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzICRSYW5kTm8uTmV4dCgoMS0kSml0dGVyKSokRGVsYXksICgxKyRKaXR0ZXIpKiREZWxheSkKCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gRW51bWVyYXRpbmcgc2VydmVyICRDb21wdXRlciAoJENvdW50ZXIgb2YgJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSkiCiAgICAgICAgICAgICAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgJEhvc3RFbnVtQmxvY2sgLUFyZ3VtZW50TGlzdCAkQ29tcHV0ZXIsICRGYWxzZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LUV4cGxvaXRhYmxlU3lzdGVtIHsKPCMKICAgIC5TeW5vcHNpcwoKICAgICAgICBUaGlzIG1vZHVsZSB3aWxsIHF1ZXJ5IEFjdGl2ZSBEaXJlY3RvcnkgZm9yIHRoZSBob3N0bmFtZSwgT1MgdmVyc2lvbiwgYW5kIHNlcnZpY2UgcGFjayBsZXZlbCAgCiAgICAgICAgZm9yIGVhY2ggY29tcHV0ZXIgYWNjb3VudC4gIFRoYXQgaW5mb3JtYXRpb24gaXMgdGhlbiBjcm9zcy1yZWZlcmVuY2VkIGFnYWluc3QgYSBsaXN0IG9mIGNvbW1vbgogICAgICAgIE1ldGFzcGxvaXQgZXhwbG9pdHMgdGhhdCBjYW4gYmUgdXNlZCBkdXJpbmcgcGVuZXRyYXRpb24gdGVzdGluZy4KCiAgICAuREVTQ1JJUFRJT04KCiAgICAgICAgVGhpcyBtb2R1bGUgd2lsbCBxdWVyeSBBY3RpdmUgRGlyZWN0b3J5IGZvciB0aGUgaG9zdG5hbWUsIE9TIHZlcnNpb24sIGFuZCBzZXJ2aWNlIHBhY2sgbGV2ZWwgIAogICAgICAgIGZvciBlYWNoIGNvbXB1dGVyIGFjY291bnQuICBUaGF0IGluZm9ybWF0aW9uIGlzIHRoZW4gY3Jvc3MtcmVmZXJlbmNlZCBhZ2FpbnN0IGEgbGlzdCBvZiBjb21tb24KICAgICAgICBNZXRhc3Bsb2l0IGV4cGxvaXRzIHRoYXQgY2FuIGJlIHVzZWQgZHVyaW5nIHBlbmV0cmF0aW9uIHRlc3RpbmcuICBUaGUgc2NyaXB0IGZpbHRlcnMgb3V0IGRpc2FibGVkCiAgICAgICAgZG9tYWluIGNvbXB1dGVycyBhbmQgcHJvdmlkZXMgdGhlIGNvbXB1dGVyJ3MgbGFzdCBsb2dvbiB0aW1lIHRvIGhlbHAgZGV0ZXJtaW5lIGlmIGl0J3MgYmVlbiAKICAgICAgICBkZWNvbW1pc3Npb25lZC4gIEFsc28sIHNpbmNlIHRoZSBzY3JpcHQgdXNlcyBkYXRhIHRhYmxlcyB0byBvdXRwdXQgYWZmZWN0ZWQgc3lzdGVtcyB0aGUgcmVzdWx0cwogICAgICAgIGNhbiBiZSBlYXNpbHkgcGlwZWQgdG8gb3RoZXIgY29tbWFuZHMgc3VjaCBhcyB0ZXN0LWNvbm5lY3Rpb24gb3IgYSBFeHBvcnQtQ3N2LgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFJldHVybiBjb21wdXRlcnMgd2l0aCBhIHNwZWNpZmljIG5hbWUsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIFNQTgoKICAgICAgICBSZXR1cm4gY29tcHV0ZXJzIHdpdGggYSBzcGVjaWZpYyBzZXJ2aWNlIHByaW5jaXBhbCBuYW1lLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBPcGVyYXRpbmdTeXN0ZW0KCiAgICAgICAgUmV0dXJuIGNvbXB1dGVycyB3aXRoIGEgc3BlY2lmaWMgb3BlcmF0aW5nIHN5c3RlbSwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgU2VydmljZVBhY2sKCiAgICAgICAgUmV0dXJuIGNvbXB1dGVycyB3aXRoIGEgc3BlY2lmaWMgc2VydmljZSBwYWNrLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBGaWx0ZXIKCiAgICAgICAgQSBjdXN0b21pemVkIGxkYXAgZmlsdGVyIHN0cmluZyB0byB1c2UsIGUuZy4gIihkZXNjcmlwdGlvbj0qYWRtaW4qKSIKCiAgICAuUEFSQU1FVEVSIFBpbmcKCiAgICAgICAgU3dpdGNoLiBQaW5nIGVhY2ggaG9zdCB0byBlbnN1cmUgaXQncyB1cCBiZWZvcmUgZW51bWVyYXRpbmcuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgY29tcHV0ZXJzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCwgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIFVuY29uc3RyYWluZWQKCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gY29tcHV0ZXIgb2JqZWN0cyB0aGF0IGhhdmUgdW5jb25zdHJhaW5lZCBkZWxlZ2F0aW9uLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKICAgICAgIAogICAgICAgIFRoZSBleGFtcGxlIGJlbG93IHNob3dzIHRoZSBzdGFuZGFyZCBjb21tYW5kIHVzYWdlLiAgRGlzYWJsZWQgc3lzdGVtIGFyZSBleGNsdWRlZCBieSBkZWZhdWx0LCBidXQKICAgICAgICB0aGUgIkxhc3RMZ29uIiBjb2x1bW4gY2FuIGJlIHVzZWQgdG8gZGV0ZXJtaW5lIHdoaWNoIHN5c3RlbXMgYXJlIGxpdmUuICBVc3VhbGx5LCBpZiBhIHN5c3RlbSBoYXNuJ3QgCiAgICAgICAgbG9nZ2VkIG9uIGZvciB0d28gb3IgbW9yZSB3ZWVrcyBpdCdzIGJlZW4gZGVjb21taXNzaW9uZWQuICAgICAgCiAgICAgICAgUFMgQzpcPiBHZXQtRXhwbG9pdGFibGVTeXN0ZW0gLURvbWFpbkNvbnRyb2xsZXIgMTkyLjE2OC4xLjEgLUNyZWRlbnRpYWwgZGVtby5jb21cdXNlciB8IEZvcm1hdC1UYWJsZSAtQXV0b1NpemUKICAgICAgICBbKl0gR3JhYmJpbmcgY29tcHV0ZXIgYWNjb3VudHMgZnJvbSBBY3RpdmUgRGlyZWN0b3J5Li4uCiAgICAgICAgWypdIExvYWRpbmcgZXhwbG9pdCBsaXN0IGZvciBjcml0aWNhbCBtaXNzaW5nIHBhdGNoZXMuLi4KICAgICAgICBbKl0gQ2hlY2tpbmcgY29tcHV0ZXJzIGZvciB2dWxuZXJhYmxlIE9TIGFuZCBTUCBsZXZlbHMuLi4KICAgICAgICBbK10gRm91bmQgNSBwb3RlbnRpYWxseSB2dWxuZXJhYmxlIHN5c3RlbXMhCiAgICAgICAgQ29tcHV0ZXJOYW1lICAgICAgICAgIE9wZXJhdGluZ1N5c3RlbSAgICAgICAgIFNlcnZpY2VQYWNrICAgIExhc3RMb2dvbiAgICAgICAgICAgIE1zZk1vZHVsZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ1ZFICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIC0tLS0tLS0tLS0tLSAgICAgICAgICAtLS0tLS0tLS0tLS0tLS0gICAgICAgICAtLS0tLS0tLS0tLSAgICAtLS0tLS0tLS0gICAgICAgICAgICAtLS0tLS0tLS0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tLSAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBBRFMuZGVtby5jb20gICAgICAgICAgV2luZG93cyBTZXJ2ZXIgMjAwMyAgICAgU2VydmljZSBQYWNrIDIgNC84LzIwMTUgNTo0Njo1MiBQTSAgZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA3XzAyOV9tc2Ruc196b25lbmFtZSBodHRwOi8vd3d3LmN2ZWRldGFpbHMuLi4uCiAgICAgICAgQURTLmRlbW8uY29tICAgICAgICAgIFdpbmRvd3MgU2VydmVyIDIwMDMgICAgIFNlcnZpY2UgUGFjayAyIDQvOC8yMDE1IDU6NDY6NTIgUE0gIGV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpICAgICAgICAgICAgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLgogICAgICAgIEFEUy5kZW1vLmNvbSAgICAgICAgICBXaW5kb3dzIFNlcnZlciAyMDAzICAgICBTZXJ2aWNlIFBhY2sgMiA0LzgvMjAxNSA1OjQ2OjUyIFBNICBleHBsb2l0L3dpbmRvd3Mvc21iL21zMTBfMDYxX3Nwb29sc3MgICAgICAgICAgIGh0dHA6Ly93d3cuY3ZlZGV0YWlscy4uLi4KICAgICAgICBMVkEuZGVtby5jb20gICAgICAgICAgV2luZG93cyBTZXJ2ZXIgMjAwMyAgICAgU2VydmljZSBQYWNrIDIgNC84LzIwMTUgMTo0NDo0NiBQTSAgZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA3XzAyOV9tc2Ruc196b25lbmFtZSBodHRwOi8vd3d3LmN2ZWRldGFpbHMuLi4uCiAgICAgICAgTFZBLmRlbW8uY29tICAgICAgICAgIFdpbmRvd3MgU2VydmVyIDIwMDMgICAgIFNlcnZpY2UgUGFjayAyIDQvOC8yMDE1IDE6NDQ6NDYgUE0gIGV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpICAgICAgICAgICAgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLgogICAgICAgIExWQS5kZW1vLmNvbSAgICAgICAgICBXaW5kb3dzIFNlcnZlciAyMDAzICAgICBTZXJ2aWNlIFBhY2sgMiA0LzgvMjAxNSAxOjQ0OjQ2IFBNICBleHBsb2l0L3dpbmRvd3Mvc21iL21zMTBfMDYxX3Nwb29sc3MgICAgICAgICAgIGh0dHA6Ly93d3cuY3ZlZGV0YWlscy4uLi4KICAgICAgICBhc3Nlc3MteHBwcm8uZGVtby5jb20gV2luZG93cyBYUCBQcm9mZXNzaW9uYWwgU2VydmljZSBQYWNrIDMgNC8xLzIwMTQgMTE6MTE6NTQgQU0gZXhwbG9pdC93aW5kb3dzL3NtYi9tczA4XzA2N19uZXRhcGkgICAgICAgICAgICBodHRwOi8vd3d3LmN2ZWRldGFpbHMuLi4uCiAgICAgICAgYXNzZXNzLXhwcHJvLmRlbW8uY29tIFdpbmRvd3MgWFAgUHJvZmVzc2lvbmFsIFNlcnZpY2UgUGFjayAzIDQvMS8yMDE0IDExOjExOjU0IEFNIGV4cGxvaXQvd2luZG93cy9zbWIvbXMxMF8wNjFfc3Bvb2xzcyAgICAgICAgICAgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLgogICAgICAgIEhWQS5kZW1vLmNvbSAgICAgICAgICBXaW5kb3dzIFNlcnZlciAyMDAzICAgICBTZXJ2aWNlIFBhY2sgMiAxMS81LzIwMTMgOToxNjozMSBQTSBleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDdfMDI5X21zZG5zX3pvbmVuYW1lIGh0dHA6Ly93d3cuY3ZlZGV0YWlscy4uLi4KICAgICAgICBIVkEuZGVtby5jb20gICAgICAgICAgV2luZG93cyBTZXJ2ZXIgMjAwMyAgICAgU2VydmljZSBQYWNrIDIgMTEvNS8yMDEzIDk6MTY6MzEgUE0gZXhwbG9pdC93aW5kb3dzL3NtYi9tczA4XzA2N19uZXRhcGkgICAgICAgICAgICBodHRwOi8vd3d3LmN2ZWRldGFpbHMuLi4uCiAgICAgICAgSFZBLmRlbW8uY29tICAgICAgICAgIFdpbmRvd3MgU2VydmVyIDIwMDMgICAgIFNlcnZpY2UgUGFjayAyIDExLzUvMjAxMyA5OjE2OjMxIFBNIGV4cGxvaXQvd2luZG93cy9zbWIvbXMxMF8wNjFfc3Bvb2xzcyAgICAgICAgICAgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLgogICAgICAgIERCMS5kZW1vLmNvbSAgICAgICAgICBXaW5kb3dzIFNlcnZlciAyMDAzICAgICBTZXJ2aWNlIFBhY2sgMiAzLzIyLzIwMTIgNTowNTozNCBQTSBleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDdfMDI5X21zZG5zX3pvbmVuYW1lIGh0dHA6Ly93d3cuY3ZlZGV0YWlscy4uLi4KICAgICAgICBEQjEuZGVtby5jb20gICAgICAgICAgV2luZG93cyBTZXJ2ZXIgMjAwMyAgICAgU2VydmljZSBQYWNrIDIgMy8yMi8yMDEyIDU6MDU6MzQgUE0gZXhwbG9pdC93aW5kb3dzL3NtYi9tczA4XzA2N19uZXRhcGkgICAgICAgICAgICBodHRwOi8vd3d3LmN2ZWRldGFpbHMuLi4uCiAgICAgICAgREIxLmRlbW8uY29tICAgICAgICAgIFdpbmRvd3MgU2VydmVyIDIwMDMgICAgIFNlcnZpY2UgUGFjayAyIDMvMjIvMjAxMiA1OjA1OjM0IFBNIGV4cGxvaXQvd2luZG93cy9zbWIvbXMxMF8wNjFfc3Bvb2xzcyAgICAgICAgICAgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLiAgICAgICAgICAgICAgICAgICAgIAoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUV4cGxvaXRhYmxlU3lzdGVtIHwgRXhwb3J0LUNzdiBjOlx0ZW1wXG91dHB1dC5jc3YgLU5vVHlwZUluZm9ybWF0aW9uCgogICAgICAgIEhvdyB0byB3cml0ZSB0aGUgb3V0cHV0IHRvIGEgY3N2IGZpbGUuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtRXhwbG9pdGFibGVTeXN0ZW0gLURvbWFpbiB0ZXN0bGFiLmxvY2FsIC1QaW5nCgogICAgICAgIFJldHVybiBhIHNldCBvZiBsaXZlIGhvc3RzIGZyb20gdGhlIHRlc3RsYWIubG9jYWwgZG9tYWluCgogICAgIC5MSU5LCiAgICAgICAKICAgICAgIGh0dHA6Ly93d3cubmV0c3BpLmNvbQogICAgICAgaHR0cHM6Ly9naXRodWIuY29tL251bGxiaW5kL1Bvd2Vyc2hlbGxlcnkvYmxvYi9tYXN0ZXIvU3RhYmxlLWlzaC9BRFMvR2V0LUV4cGxvaXRhYmxlU3lzdGVtcy5wc20xCiAgICAgICAKICAgICAuTk9URVMKICAgICAgIAogICAgICAgQXV0aG9yOiAgU2NvdHQgU3V0aGVybGFuZCAtIDIwMTUsIE5ldFNQSQogICAgICAgICAgICAgICAgTW9kaWZpY2F0aW9ucyB0byBpbnRlZ3JhdGUgaW50byBQb3dlclZpZXcgYnkgQGhhcm1qMHkKICAgICAgIFZlcnNpb246IEdldC1FeHBsb2l0YWJsZVN5c3RlbS5wc20xIHYxLjEKICAgICAgIENvbW1lbnRzOiBUaGUgdGVjaG5pcXVlIHVzZWQgdG8gcXVlcnkgTERBUCB3YXMgYmFzZWQgb24gdGhlICJHZXQtQXVkaXREU0NvbXB1dGVyQWNjb3VudCIgCiAgICAgICBmdW5jdGlvbiBmb3VuZCBpbiBDYXJvbHMgUGVyZXoncyBQb3NoU2VjLU1vZCBwcm9qZWN0LiAgVGhlIGdlbmVyYWwgaWRlYSBpcyBiYXNlZCBvZmYgb2YgIAogICAgICAgV2lsbCBTY2hyb2VkZXIncyAiSW52b2tlLUZpbmRWdWxuU3lzdGVtcyIgZnVuY3Rpb24gZnJvbSB0aGUgUG93ZXJWaWV3IHRvb2xraXQuCiM+CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICcqJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU1BOLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRPcGVyYXRpbmdTeXN0ZW0gPSAnKicsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNlcnZpY2VQYWNrID0gJyonLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRGaWx0ZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFBpbmcsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVW5jb25zdHJhaW5lZCwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBHcmFiYmluZyBjb21wdXRlciBhY2NvdW50cyBmcm9tIEFjdGl2ZSBEaXJlY3RvcnkuLi4iCgogICAgIyBDcmVhdGUgZGF0YSB0YWJsZSBmb3IgaG9zdG5hbWVzLCBvcywgYW5kIHNlcnZpY2UgcGFja3MgZnJvbSBMREFQCiAgICAkVGFibGVBZHNDb21wdXRlcnMgPSBOZXctT2JqZWN0IFN5c3RlbS5EYXRhLkRhdGFUYWJsZSAKICAgICROdWxsID0gJFRhYmxlQWRzQ29tcHV0ZXJzLkNvbHVtbnMuQWRkKCdIb3N0bmFtZScpICAgICAgIAogICAgJE51bGwgPSAkVGFibGVBZHNDb21wdXRlcnMuQ29sdW1ucy5BZGQoJ09wZXJhdGluZ1N5c3RlbScpCiAgICAkTnVsbCA9ICRUYWJsZUFkc0NvbXB1dGVycy5Db2x1bW5zLkFkZCgnU2VydmljZVBhY2snKQogICAgJE51bGwgPSAkVGFibGVBZHNDb21wdXRlcnMuQ29sdW1ucy5BZGQoJ0xhc3RMb2dvbicpCgogICAgR2V0LU5ldENvbXB1dGVyIC1GdWxsRGF0YSBAUFNCb3VuZFBhcmFtZXRlcnMgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICRDdXJyZW50SG9zdCA9ICRfLmRuc2hvc3RuYW1lCiAgICAgICAgJEN1cnJlbnRPcyA9ICRfLm9wZXJhdGluZ3N5c3RlbQogICAgICAgICRDdXJyZW50U3AgPSAkXy5vcGVyYXRpbmdzeXN0ZW1zZXJ2aWNlcGFjawogICAgICAgICRDdXJyZW50TGFzdCA9ICRfLmxhc3Rsb2dvbgogICAgICAgICRDdXJyZW50VWFjID0gJF8udXNlcmFjY291bnRjb250cm9sCgogICAgICAgICRDdXJyZW50VWFjQmluID0gW2NvbnZlcnRdOjpUb1N0cmluZygkXy51c2VyYWNjb3VudGNvbnRyb2wsMikKCiAgICAgICAgIyBDaGVjayB0aGUgMm5kIHRvIGxhc3QgdmFsdWUgdG8gZGV0ZXJtaW5lIGlmIGl0cyBkaXNhYmxlZAogICAgICAgICREaXNhYmxlT2Zmc2V0ID0gJEN1cnJlbnRVYWNCaW4uTGVuZ3RoIC0gMgogICAgICAgICRDdXJyZW50RGlzYWJsZWQgPSAkQ3VycmVudFVhY0Jpbi5TdWJzdHJpbmcoJERpc2FibGVPZmZzZXQsMSkKCiAgICAgICAgIyBBZGQgY29tcHV0ZXIgdG8gbGlzdCBpZiBpdCdzIGVuYWJsZWQKICAgICAgICBpZiAoJEN1cnJlbnREaXNhYmxlZCAgLWVxIDApIHsKICAgICAgICAgICAgIyBBZGQgZG9tYWluIGNvbXB1dGVyIHRvIGRhdGEgdGFibGUKICAgICAgICAgICAgJE51bGwgPSAkVGFibGVBZHNDb21wdXRlcnMuUm93cy5BZGQoJEN1cnJlbnRIb3N0LCRDdXJyZW50T1MsJEN1cnJlbnRTUCwkQ3VycmVudExhc3QpCiAgICAgICAgfQogICAgfQoKICAgICMgU3RhdHVzIHVzZXIgICAgICAgIAogICAgV3JpdGUtVmVyYm9zZSAiWypdIExvYWRpbmcgZXhwbG9pdCBsaXN0IGZvciBjcml0aWNhbCBtaXNzaW5nIHBhdGNoZXMuLi4iCgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAjIFNldHVwIGRhdGEgdGFibGUgZm9yIGxpc3Qgb2YgbXNmIGV4cGxvaXRzCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAjIENyZWF0ZSBkYXRhIHRhYmxlIGZvciBsaXN0IG9mIHBhdGNoZXMgbGV2ZWxzIHdpdGggYSBNU0YgZXhwbG9pdAogICAgJFRhYmxlRXhwbG9pdHMgPSBOZXctT2JqZWN0IFN5c3RlbS5EYXRhLkRhdGFUYWJsZSAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuQ29sdW1ucy5BZGQoJ09wZXJhdGluZ1N5c3RlbScpIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Db2x1bW5zLkFkZCgnU2VydmljZVBhY2snKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Db2x1bW5zLkFkZCgnTXNmTW9kdWxlJykgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Db2x1bW5zLkFkZCgnQ1ZFJykKICAgIAogICAgIyBBZGQgZXhwbG9pdHMgdG8gZGF0YSB0YWJsZQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyA3IiwiIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAxMC0yNzI5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDNfMDI2X2Rjb20iLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTAzNTIvIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDVfMDE3X21zbXEiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA1LTAwNTkiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmVyIFBhY2sgMSIsImV4cGxvaXQvd2luZG93cy9paXMvbXMwM18wMDdfbnRkbGxfd2ViZGF2IiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMTA5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3Mvd2lucy9tczA0XzA0NV93aW5zIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNC0xMDgwLyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwM18wMjZfZGNvbSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDMtMDM1Mi8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDVfMDE3X21zbXEiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA1LTAwNTkiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3MvaWlzL21zMDNfMDA3X250ZGxsX3dlYmRhdiIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDMtMDEwOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNF8wMTFfbHNhc3MiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTA1MzMvIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL3dpbnMvbXMwNF8wNDVfd2lucyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDQtMTA4MC8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDMiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDNfMDI2X2Rjb20iLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTAzNTIvIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayAzIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA1XzAxN19tc21xIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNS0wMDU5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayAzIiwiZXhwbG9pdC93aW5kb3dzL2lpcy9tczAzXzAwN19udGRsbF93ZWJkYXYiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTAxMDkiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDMiLCJleHBsb2l0L3dpbmRvd3Mvd2lucy9tczA0XzA0NV93aW5zIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNC0xMDgwLyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2aWNlIFBhY2sgNCIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwM18wMjZfZGNvbSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDMtMDM1Mi8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDQiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDVfMDE3X21zbXEiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA1LTAwNTkiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDQiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDdfMDI5X21zZG5zX3pvbmVuYW1lIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNy0xNzQ4IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayA0IiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA0XzAxMV9sc2FzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDMtMDUzMy8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDQiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDQwX25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDYtMzQzOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2aWNlIFBhY2sgNCIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNl8wNjZfbndhcGkiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA2LTQ2ODgiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDQiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDcwX3drc3N2YyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDYtNDY5MSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2aWNlIFBhY2sgNCIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOC00MjUwIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayA0IiwiZXhwbG9pdC93aW5kb3dzL3dpbnMvbXMwNF8wNDVfd2lucyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDQtMTA4MC8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczAzXzAyNl9kY29tIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMzUyLyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCIiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDVfMDE3X21zbXEiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA1LTAwNTkiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiIiwiZXhwbG9pdC93aW5kb3dzL2lpcy9tczAzXzAwN19udGRsbF93ZWJkYXYiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTAxMDkiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA1XzAzOV9wbnAiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA1LTE5ODMiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiIiwiZXhwbG9pdC93aW5kb3dzL3dpbnMvbXMwNF8wNDVfd2lucyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDQtMTA4MC8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIiwiU2VydmVyIFBhY2sgMSIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwN18wMjlfbXNkbnNfem9uZW5hbWUiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA3LTE3NDgiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIiwiU2VydmVyIFBhY2sgMSIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNl8wNDBfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi0zNDM5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDY2X253YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi00Njg4IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDhfMDY3X25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDgtNDI1MCIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL3dpbnMvbXMwNF8wNDVfd2lucyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDQtMTA4MC8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDdfMDI5X21zZG5zX3pvbmVuYW1lIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNy0xNzQ4IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA4XzA2N19uZXRhcGkiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA4LTQyNTAiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMTBfMDYxX3Nwb29sc3MiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDEwLTI3MjkiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIiwiIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczAzXzAyNl9kY29tIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMzUyLyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMiLCIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDQwX25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDYtMzQzOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMiLCIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDhfMDY3X25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDgtNDI1MCIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMiLCIiLCJleHBsb2l0L3dpbmRvd3Mvd2lucy9tczA0XzA0NV93aW5zIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNC0xMDgwLyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMgUjIiLCIiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDNfMDI2X2Rjb20iLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTAzNTIvIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyBSMiIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNF8wMTFfbHNhc3MiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTA1MzMvIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyBSMiIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNl8wNDBfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi0zNDM5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyBSMiIsIiIsImV4cGxvaXQvd2luZG93cy93aW5zL21zMDRfMDQ1X3dpbnMiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA0LTEwODAvIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwOCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA5XzA1MF9zbWIyX25lZ290aWF0ZV9mdW5jX2luZGV4IiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOS0zMTAzIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwOCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAxMC0yNzI5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwOCIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOV8wNTBfc21iMl9uZWdvdGlhdGVfZnVuY19pbmRleCIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDktMzEwMyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDgiLCIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMTBfMDYxX3Nwb29sc3MiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDEwLTI3MjkiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDA4IFIyIiwiIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAxMC0yNzI5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBWaXN0YSIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDlfMDUwX3NtYjJfbmVnb3RpYXRlX2Z1bmNfaW5kZXgiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA5LTMxMDMiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFZpc3RhIiwiU2VydmVyIFBhY2sgMSIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMxMF8wNjFfc3Bvb2xzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMTAtMjcyOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgVmlzdGEiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOV8wNTBfc21iMl9uZWdvdGlhdGVfZnVuY19pbmRleCIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDktMzEwMyIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgVmlzdGEiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMxMF8wNjFfc3Bvb2xzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMTAtMjcyOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgVmlzdGEiLCIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDlfMDUwX3NtYjJfbmVnb3RpYXRlX2Z1bmNfaW5kZXgiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA5LTMxMDMiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiU2VydmVyIFBhY2sgMSIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwM18wMjZfZGNvbSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDMtMDM1Mi8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiU2VydmVyIFBhY2sgMSIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwNV8wMTdfbXNtcSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDUtMDA1OSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA0XzAxMV9sc2FzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDMtMDUzMy8iKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiU2VydmVyIFBhY2sgMSIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNV8wMzlfcG5wIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNS0xOTgzIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDQwX25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDYtMzQzOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwNV8wMTdfbXNtcSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDUtMDA1OSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNl8wNDBfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi0zNDM5IikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA2XzA2Nl9ud2FwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDYtNDY4OCIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNl8wNzBfd2tzc3ZjIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi00NjkxIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA4XzA2N19uZXRhcGkiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA4LTQyNTAiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMTBfMDYxX3Nwb29sc3MiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDEwLTI3MjkiKSAgCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiU2VydmljZSBQYWNrIDMiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDhfMDY3X25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDgtNDI1MCIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2aWNlIFBhY2sgMyIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMxMF8wNjFfc3Bvb2xzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMTAtMjcyOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCIiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDNfMDI2X2Rjb20iLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTAzNTIvIikgIAogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIiIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwNV8wMTdfbXNtcSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDUtMDA1OSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDQwX25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDYtMzQzOSIpICAKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDhfMDY3X25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDgtNDI1MCIpICAKCiAgICAjIFN0YXR1cyB1c2VyICAgICAgICAKICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBDaGVja2luZyBjb21wdXRlcnMgZm9yIHZ1bG5lcmFibGUgT1MgYW5kIFNQIGxldmVscy4uLiIKCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICMgU2V0dXAgZGF0YSB0YWJsZSB0byBzdG9yZSB2dWxuZXJhYmxlIHN5c3RlbXMKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgICMgQ3JlYXRlIGRhdGEgdGFibGUgdG8gaG91c2UgdnVsbmVyYWJsZSBzZXJ2ZXIgbGlzdAogICAgJFRhYmxlVnVsbkNvbXB1dGVycyA9IE5ldy1PYmplY3QgU3lzdGVtLkRhdGEuRGF0YVRhYmxlIAogICAgJE51bGwgPSAkVGFibGVWdWxuQ29tcHV0ZXJzLkNvbHVtbnMuQWRkKCdDb21wdXRlck5hbWUnKQogICAgJE51bGwgPSAkVGFibGVWdWxuQ29tcHV0ZXJzLkNvbHVtbnMuQWRkKCdPcGVyYXRpbmdTeXN0ZW0nKQogICAgJE51bGwgPSAkVGFibGVWdWxuQ29tcHV0ZXJzLkNvbHVtbnMuQWRkKCdTZXJ2aWNlUGFjaycpCiAgICAkTnVsbCA9ICRUYWJsZVZ1bG5Db21wdXRlcnMuQ29sdW1ucy5BZGQoJ0xhc3RMb2dvbicpCiAgICAkTnVsbCA9ICRUYWJsZVZ1bG5Db21wdXRlcnMuQ29sdW1ucy5BZGQoJ01zZk1vZHVsZScpCiAgICAkTnVsbCA9ICRUYWJsZVZ1bG5Db21wdXRlcnMuQ29sdW1ucy5BZGQoJ0NWRScpCgogICAgIyBJdGVyYXRlIHRocm91Z2ggZWFjaCBleHBsb2l0CiAgICAkVGFibGVFeHBsb2l0cyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAKICAgICAgICAkRXhwbG9pdE9TID0gJF8uT3BlcmF0aW5nU3lzdGVtCiAgICAgICAgJEV4cGxvaXRTUCA9ICRfLlNlcnZpY2VQYWNrCiAgICAgICAgJEV4cGxvaXRNc2YgPSAkXy5Nc2ZNb2R1bGUKICAgICAgICAkRXhwbG9pdENWRSA9ICRfLkNWRQoKICAgICAgICAjIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIEFEUyBjb21wdXRlcgogICAgICAgICRUYWJsZUFkc0NvbXB1dGVycyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgCiAgICAgICAgICAgICRBZHNIb3N0bmFtZSA9ICRfLkhvc3RuYW1lCiAgICAgICAgICAgICRBZHNPUyA9ICRfLk9wZXJhdGluZ1N5c3RlbQogICAgICAgICAgICAkQWRzU1AgPSAkXy5TZXJ2aWNlUGFjayAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICRBZHNMYXN0ID0gJF8uTGFzdExvZ29uCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEFkZCBleHBsb2l0YWJsZSBzeXN0ZW1zIHRvIHZ1bCBjb21wdXRlcnMgZGF0YSB0YWJsZQogICAgICAgICAgICBpZiAoJEFkc09TIC1saWtlICIkRXhwbG9pdE9TKiIgLWFuZCAkQWRzU1AgLWxpa2UgIiRFeHBsb2l0U1AiICkgeyAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEFkZCBkb21haW4gY29tcHV0ZXIgdG8gZGF0YSB0YWJsZSAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkTnVsbCA9ICRUYWJsZVZ1bG5Db21wdXRlcnMuUm93cy5BZGQoJEFkc0hvc3RuYW1lLCRBZHNPUywkQWRzU1AsJEFkc0xhc3QsJEV4cGxvaXRNc2YsJEV4cGxvaXRDVkUpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgICMgRGlzcGxheSByZXN1bHRzCiAgICAkVnVsbkNvbXB1dGVyID0gJFRhYmxlVnVsbkNvbXB1dGVycyB8IFNlbGVjdC1PYmplY3QgQ29tcHV0ZXJOYW1lIC1VbmlxdWUgfCBNZWFzdXJlLU9iamVjdAogICAgJFZ1bG5Db21wdXRlckNvdW50ID0gJFZ1bG5Db21wdXRlci5Db3VudAoKICAgIGlmICgkVnVsbkNvbXB1dGVyLkNvdW50IC1ndCAwKSB7CiAgICAgICAgIyBSZXR1cm4gdnVsbmVyYWJsZSBzZXJ2ZXIgbGlzdCBvcmRlciB3aXRoIHNvbWUgaGFjayBkYXRlIGNhc3RpbmcKICAgICAgICBXcml0ZS1WZXJib3NlICJbK10gRm91bmQgJFZ1bG5Db21wdXRlckNvdW50IHBvdGVudGlhbGx5IHZ1bG5lcmFibGUgc3lzdGVtcyEiCiAgICAgICAgJFRhYmxlVnVsbkNvbXB1dGVycyB8IFNvcnQtT2JqZWN0IHsgJF8ubGFzdGxvZ29uIC1hcyBbZGF0ZXRpbWVdfSAtRGVzY2VuZGluZwogICAgfQogICAgZWxzZSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiWy1dIE5vIHZ1bG5lcmFibGUgc3lzdGVtcyB3ZXJlIGZvdW5kLiIKICAgIH0KfQoKCmZ1bmN0aW9uIEludm9rZS1FbnVtZXJhdGVMb2NhbEFkbWluIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHF1ZXJpZXMgdGhlIGRvbWFpbiBmb3IgYWxsIGFjdGl2ZSBtYWNoaW5lcyB3aXRoCiAgICAgICAgR2V0LU5ldENvbXB1dGVyLCB0aGVuIGZvciBlYWNoIHNlcnZlciBpdCBxdWVyaWVzIHRoZSBsb2NhbAogICAgICAgIEFkbWluaXN0cmF0b3JzIHdpdGggR2V0LU5ldExvY2FsR3JvdXAuCgogICAgICAgIEF1dGhvcjogQGhhcm1qMHkKICAgICAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBIb3N0IGFycmF5IHRvIGVudW1lcmF0ZSwgcGFzc2FibGUgb24gdGhlIHBpcGVsaW5lLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJGaWxlCgogICAgICAgIEZpbGUgb2YgaG9zdG5hbWVzL0lQcyB0byBzZWFyY2guCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckZpbHRlcgoKICAgICAgICBIb3N0IGZpbHRlciBuYW1lIHRvIHF1ZXJ5IEFEIGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCBmb3IgaG9zdHMsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBOb1BpbmcKCiAgICAgICAgU3dpdGNoLiBEb24ndCBwaW5nIGVhY2ggaG9zdCB0byBlbnN1cmUgaXQncyB1cCBiZWZvcmUgZW51bWVyYXRpbmcuCgogICAgLlBBUkFNRVRFUiBEZWxheQoKICAgICAgICBEZWxheSBiZXR3ZWVuIGVudW1lcmF0aW5nIGhvc3RzLCBkZWZhdWx0cyB0byAwCgogICAgLlBBUkFNRVRFUiBKaXR0ZXIKCiAgICAgICAgSml0dGVyIGZvciB0aGUgaG9zdCBkZWxheSwgZGVmYXVsdHMgdG8gKy8tIDAuMwoKICAgIC5QQVJBTUVURVIgT3V0RmlsZQoKICAgICAgICBPdXRwdXQgcmVzdWx0cyB0byBhIHNwZWNpZmllZCBjc3Ygb3V0cHV0IGZpbGUuCgogICAgLlBBUkFNRVRFUiBOb0Nsb2JiZXIKCiAgICAgICAgU3dpdGNoLiBEb24ndCBvdmVyd3JpdGUgYW55IGV4aXN0aW5nIG91dHB1dCBmaWxlLgoKICAgIC5QQVJBTUVURVIgVHJ1c3RHcm91cHMKCiAgICAgICAgU3dpdGNoLiBPbmx5IHJldHVybiByZXN1bHRzIHRoYXQgYXJlIG5vdCBwYXJ0IG9mIHRoZSBsb2NhbCBtYWNoaW5lCiAgICAgICAgb3IgdGhlIG1hY2hpbmUncyBkb21haW4uIE9sZCBJbnZva2UtRW51bWVyYXRlTG9jYWxUcnVzdEdyb3VwCiAgICAgICAgZnVuY3Rpb25hbGl0eS4KICAgIAogICAgLlBBUkFNRVRFUiBEb21haW5Pbmx5CgogICAgICAgIFN3aXRjaC4gT25seSByZXR1cm4gZG9tYWluIChub24tbG9jYWwpIHJlc3VsdHMgIAoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIERvbWFpbiB0byBxdWVyeSBmb3IgbWFjaGluZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KICAgIAogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBTZWFyY2hGb3Jlc3QKCiAgICAgICAgU3dpdGNoLiBTZWFyY2ggYWxsIGRvbWFpbnMgaW4gdGhlIGZvcmVzdCBmb3IgdGFyZ2V0IHVzZXJzIGluc3RlYWQgb2YganVzdAogICAgICAgIGEgc2luZ2xlIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIEFQSQoKICAgICAgICBTd2l0Y2guIFVzZSBBUEkgY2FsbHMgaW5zdGVhZCBvZiB0aGUgV2luTlQgc2VydmljZSBwcm92aWRlci4gTGVzcyBpbmZvcm1hdGlvbiwKICAgICAgICBidXQgdGhlIHJlc3VsdHMgYXJlIGZhc3Rlci4KCiAgICAuUEFSQU1FVEVSIFRocmVhZHMKCiAgICAgICAgVGhlIG1heGltdW0gY29uY3VycmVudCB0aHJlYWRzIHRvIGV4ZWN1dGUuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtRW51bWVyYXRlTG9jYWxBZG1pbgoKICAgICAgICBFbnVtZXJhdGVzIHRoZSBtZW1iZXJzIG9mIGxvY2FsIGFkbWluaXN0cmF0b3JzIGZvciBhbGwgbWFjaGluZXMKICAgICAgICBpbiB0aGUgY3VycmVudCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtRW51bWVyYXRlTG9jYWxBZG1pbiAtVGhyZWFkcyAxMAoKICAgICAgICBUaHJlYWRlZCBsb2NhbCBhZG1pbiBlbnVtZXJhdGlvbiwgcmVwbGFjZXMgSW52b2tlLUVudW1lcmF0ZUxvY2FsQWRtaW5UaHJlYWRlZAoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly9ibG9nLmhhcm1qMHkubmV0LwojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdHMnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW0FsaWFzKCdIb3N0TGlzdCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyQURTcGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTm9QaW5nLAoKICAgICAgICBbVUludDMyXQogICAgICAgICREZWxheSA9IDAsCgogICAgICAgIFtEb3VibGVdCiAgICAgICAgJEppdHRlciA9IC4zLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRPdXRGaWxlLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICROb0Nsb2JiZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFRydXN0R3JvdXBzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICREb21haW5Pbmx5LAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNlYXJjaEZvcmVzdCwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRUaHJlYWRzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRBUEkKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snRGVidWcnXSkgewogICAgICAgICAgICAkRGVidWdQcmVmZXJlbmNlID0gJ0NvbnRpbnVlJwogICAgICAgIH0KCiAgICAgICAgIyByYW5kb20gb2JqZWN0IGZvciBkZWxheQogICAgICAgICRSYW5kTm8gPSBOZXctT2JqZWN0IFN5c3RlbS5SYW5kb20KCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFJ1bm5pbmcgSW52b2tlLUVudW1lcmF0ZUxvY2FsQWRtaW4gd2l0aCBkZWxheSBvZiAkRGVsYXkiCgogICAgICAgICMgaWYgd2UncmUgdXNpbmcgYSBob3N0IGxpc3QsIHJlYWQgdGhlIHRhcmdldHMgaW4gYW5kIGFkZCB0aGVtIHRvIHRoZSB0YXJnZXQgbGlzdAogICAgICAgIGlmKCRDb21wdXRlckZpbGUpIHsKICAgICAgICAgICAgJENvbXB1dGVyTmFtZSA9IEdldC1Db250ZW50IC1QYXRoICRDb21wdXRlckZpbGUKICAgICAgICB9CgogICAgICAgIGlmKCEkQ29tcHV0ZXJOYW1lKSB7IAogICAgICAgICAgICBbYXJyYXldJENvbXB1dGVyTmFtZSA9IEAoKQoKICAgICAgICAgICAgaWYoJERvbWFpbikgewogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCREb21haW4pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRTZWFyY2hGb3Jlc3QpIHsKICAgICAgICAgICAgICAgICMgZ2V0IEFMTCB0aGUgZG9tYWlucyBpbiB0aGUgZm9yZXN0IHRvIHNlYXJjaAogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBHZXQtTmV0Rm9yZXN0RG9tYWluIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5OYW1lIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICMgdXNlIHRoZSBsb2NhbCBkb21haW4KICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gQCggKEdldC1OZXREb21haW4pLm5hbWUgKQogICAgICAgICAgICB9CgogICAgICAgICAgICBGb3JFYWNoICgkRG9tYWluIGluICRUYXJnZXREb21haW5zKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIGhvc3RzIgogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSArPSBHZXQtTmV0Q29tcHV0ZXIgLUZpbHRlciAkQ29tcHV0ZXJGaWx0ZXIgLUFEU3BhdGggJENvbXB1dGVyQURTcGF0aCAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyByZW1vdmUgYW55IG51bGwgdGFyZ2V0IGhvc3RzLCB1bmlxdWlmeSB0aGUgbGlzdCBhbmQgc2h1ZmZsZSBpdAogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJENvbXB1dGVyTmFtZSB8IFdoZXJlLU9iamVjdCB7ICRfIH0gfCBTb3J0LU9iamVjdCAtVW5pcXVlIHwgU29ydC1PYmplY3QgeyBHZXQtUmFuZG9tIH0KICAgICAgICAgICAgaWYoJCgkQ29tcHV0ZXJOYW1lLkNvdW50KSAtZXEgMCkgewogICAgICAgICAgICAgICAgdGhyb3cgIk5vIGhvc3RzIGZvdW5kISIKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBkZWxldGUgYW55IGV4aXN0aW5nIG91dHB1dCBmaWxlIGlmIGl0IGFscmVhZHkgZXhpc3RzCiAgICAgICAgaWYoISROb0Nsb2JiZXIpIHsKICAgICAgICAgICAgaWYgKCRPdXRGaWxlIC1hbmQgKFRlc3QtUGF0aCAtUGF0aCAkT3V0RmlsZSkpIHsgUmVtb3ZlLUl0ZW0gLVBhdGggJE91dEZpbGUgfQogICAgICAgIH0KCiAgICAgICAgaWYoJFRydXN0R3JvdXBzKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJEZXRlcm1pbmluZyBkb21haW4gdHJ1c3QgZ3JvdXBzIgoKICAgICAgICAgICAgIyBmaW5kIGFsbCBncm91cCBuYW1lcyB0aGF0IGhhdmUgb25lIG9yIG1vcmUgdXNlcnMgaW4gYW5vdGhlciBkb21haW4KICAgICAgICAgICAgJFRydXN0R3JvdXBOYW1lcyA9IEZpbmQtRm9yZWlnbkdyb3VwIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciB8IEZvckVhY2gtT2JqZWN0IHsgJF8uR3JvdXBOYW1lIH0gfCBTb3J0LU9iamVjdCAtVW5pcXVlCgogICAgICAgICAgICAkVHJ1c3RHcm91cHNTSURzID0gJFRydXN0R3JvdXBOYW1lcyB8IEZvckVhY2gtT2JqZWN0IHsgCiAgICAgICAgICAgICAgICAjIGlnbm9yZSB0aGUgYnVpbHRpbiBhZG1pbmlzdHJhdG9ycyBncm91cCBmb3IgYSBEQyAoUy0xLTUtMzItNTQ0KQogICAgICAgICAgICAgICAgIyBUT0RPOiBpZ25vcmUgYWxsIGRlZmF1bHQgYnVpbHQgaW4gc2lkcz8KICAgICAgICAgICAgICAgIEdldC1OZXRHcm91cCAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUdyb3VwTmFtZSAkXyAtRnVsbERhdGEgfCBXaGVyZS1PYmplY3QgeyAkXy5vYmplY3RzaWQgLW5vdG1hdGNoICJTLTEtNS0zMi01NDQiIH0gfCBGb3JFYWNoLU9iamVjdCB7ICRfLm9iamVjdHNpZCB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgcXVlcnkgZm9yIHRoZSBwcmltYXJ5IGRvbWFpbiBjb250cm9sbGVyIHNvIHdlIGNhbiBleHRyYWN0IHRoZSBkb21haW4gU0lEIGZvciBmaWx0ZXJpbmcKICAgICAgICAgICAgJERvbWFpblNJRCA9IEdldC1Eb21haW5TSUQgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyCiAgICAgICAgfQoKICAgICAgICAjIHNjcmlwdCBibG9jayB0aGF0IGVudW1lcmF0ZXMgYSBzZXJ2ZXIKICAgICAgICAkSG9zdEVudW1CbG9jayA9IHsKICAgICAgICAgICAgcGFyYW0oJENvbXB1dGVyTmFtZSwgJFBpbmcsICRPdXRGaWxlLCAkRG9tYWluU0lELCAkVHJ1c3RHcm91cHNTSURzLCAkQVBJLCAkRG9tYWluT25seSkKCiAgICAgICAgICAgICMgb3B0aW9uYWxseSBjaGVjayBpZiB0aGUgc2VydmVyIGlzIHVwIGZpcnN0CiAgICAgICAgICAgICRVcCA9ICRUcnVlCiAgICAgICAgICAgIGlmKCRQaW5nKSB7CiAgICAgICAgICAgICAgICAkVXAgPSBUZXN0LUNvbm5lY3Rpb24gLUNvdW50IDEgLVF1aWV0IC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRVcCkgewogICAgICAgICAgICAgICAgIyBncmFiIHRoZSB1c2VycyBmb3IgdGhlIGxvY2FsIGFkbWlucyBvbiB0aGlzIHNlcnZlcgogICAgICAgICAgICAgICAgaWYoJEFQSSkgewogICAgICAgICAgICAgICAgICAgICRMb2NhbEFkbWlucyA9IEdldC1OZXRMb2NhbEdyb3VwIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtQVBJCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkTG9jYWxBZG1pbnMgPSBHZXQtTmV0TG9jYWxHcm91cCAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIGlmIHdlIGp1c3Qgd2FudCB0byByZXR1cm4gY3Jvc3MtdHJ1c3QgdXNlcnMKICAgICAgICAgICAgICAgIGlmKCREb21haW5TSUQpIHsKICAgICAgICAgICAgICAgICAgICAjIGdldCB0aGUgbG9jYWwgbWFjaGluZSBTSUQKICAgICAgICAgICAgICAgICAgICAkTG9jYWxTSUQgPSAoJExvY2FsQWRtaW5zIHwgV2hlcmUtT2JqZWN0IHsgJF8uU0lEIC1tYXRjaCAnLiotNTAwJCcgfSkuU0lEIC1yZXBsYWNlICItNTAwJCIKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJMb2NhbFNpZCBmb3IgJENvbXB1dGVyTmFtZSA6ICRMb2NhbFNJRCIKICAgICAgICAgICAgICAgICAgICAjIGZpbHRlciBvdXQgYWNjb3VudHMgdGhhdCBiZWdpbiB3aXRoIHRoZSBtYWNoaW5lIFNJRCBhbmQgZG9tYWluIFNJRAogICAgICAgICAgICAgICAgICAgICMgICBidXQgcHJlc2VydmUgYW55IGdyb3VwcyB0aGF0IGhhdmUgdXNlcnMgYWNyb3NzIGEgdHJ1c3QgKCRUcnVzdEdyb3VwU0lEUykKICAgICAgICAgICAgICAgICAgICAkTG9jYWxBZG1pbnMgPSAkTG9jYWxBZG1pbnMgfCBXaGVyZS1PYmplY3QgeyAoJFRydXN0R3JvdXBzU0lEcyAtY29udGFpbnMgJF8uU0lEKSAtb3IgKCgtbm90ICRfLlNJRC5zdGFydHNXaXRoKCRMb2NhbFNJRCkpIC1hbmQgKC1ub3QgJF8uU0lELnN0YXJ0c1dpdGgoJERvbWFpblNJRCkpKSB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoJERvbWFpbk9ubHkpIHsKICAgICAgICAgICAgICAgICAgICAkTG9jYWxBZG1pbnMgPSAkTG9jYWxBZG1pbnMgfCBXaGVyZS1PYmplY3QgeyRfLklzRG9tYWlufQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKCRMb2NhbEFkbWlucyAtYW5kICgkTG9jYWxBZG1pbnMuTGVuZ3RoIC1uZSAwKSkgewogICAgICAgICAgICAgICAgICAgICMgb3V0cHV0IHRoZSByZXN1bHRzIHRvIGEgY3N2IGlmIHNwZWNpZmllZAogICAgICAgICAgICAgICAgICAgIGlmKCRPdXRGaWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbEFkbWlucyB8IEV4cG9ydC1Qb3dlclZpZXdDU1YgLU91dEZpbGUgJE91dEZpbGUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgb3RoZXJ3aXNlIHJldHVybiB0aGUgdXNlciBvYmplY3RzCiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbEFkbWlucwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlshXSBObyB1c2VycyByZXR1cm5lZCBmcm9tICRDb21wdXRlck5hbWUiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIGlmKCRUaHJlYWRzKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlVzaW5nIHRocmVhZGluZyB3aXRoIHRocmVhZHMgPSAkVGhyZWFkcyIKCiAgICAgICAgICAgICMgaWYgd2UncmUgdXNpbmcgdGhyZWFkaW5nLCBraWNrIG9mZiB0aGUgc2NyaXB0IGJsb2NrIHdpdGggSW52b2tlLVRocmVhZGVkRnVuY3Rpb24KICAgICAgICAgICAgJFNjcmlwdFBhcmFtcyA9IEB7CiAgICAgICAgICAgICAgICAnUGluZycgPSAkKC1ub3QgJE5vUGluZykKICAgICAgICAgICAgICAgICdPdXRGaWxlJyA9ICRPdXRGaWxlCiAgICAgICAgICAgICAgICAnRG9tYWluU0lEJyA9ICREb21haW5TSUQKICAgICAgICAgICAgICAgICdUcnVzdEdyb3Vwc1NJRHMnID0gJFRydXN0R3JvdXBzU0lEcwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGtpY2sgb2ZmIHRoZSB0aHJlYWRlZCBzY3JpcHQgYmxvY2sgKyBhcmd1bWVudHMKICAgICAgICAgICAgaWYoJEFQSSkgewogICAgICAgICAgICAgICAgJFNjcmlwdFBhcmFtc1snQVBJJ10gPSAkVHJ1ZQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkRG9tYWluT25seSkgewogICAgICAgICAgICAgICAgJFNjcmlwdFBhcmFtc1snRG9tYWluT25seSddID0gJFRydWUKICAgICAgICAgICAgfQogICAgICAgICAKICAgICAgICAgICAgSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1TY3JpcHRCbG9jayAkSG9zdEVudW1CbG9jayAtU2NyaXB0UGFyYW1ldGVycyAkU2NyaXB0UGFyYW1zIC1UaHJlYWRzICRUaHJlYWRzCiAgICAgICAgfQoKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYoLW5vdCAkTm9QaW5nIC1hbmQgKCRDb21wdXRlck5hbWUuY291bnQgLW5lIDEpKSB7CiAgICAgICAgICAgICAgICAjIHBpbmcgYWxsIGhvc3RzIGluIHBhcmFsbGVsCiAgICAgICAgICAgICAgICAkUGluZyA9IHtwYXJhbSgkQ29tcHV0ZXJOYW1lKSBpZihUZXN0LUNvbm5lY3Rpb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1Db3VudCAxIC1RdWlldCAtRXJyb3JBY3Rpb24gU3RvcCl7JENvbXB1dGVyTmFtZX19CiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLU5vSW1wb3J0cyAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRQaW5nIC1UaHJlYWRzIDEwMAogICAgICAgICAgICB9CgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gVG90YWwgbnVtYmVyIG9mIGFjdGl2ZSBob3N0czogJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSIKICAgICAgICAgICAgJENvdW50ZXIgPSAwCgogICAgICAgICAgICBGb3JFYWNoICgkQ29tcHV0ZXIgaW4gJENvbXB1dGVyTmFtZSkgewoKICAgICAgICAgICAgICAgICRDb3VudGVyID0gJENvdW50ZXIgKyAxCgogICAgICAgICAgICAgICAgIyBzbGVlcCBmb3Igb3VyIHNlbWktcmFuZG9taXplZCBpbnRlcnZhbAogICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgJFJhbmROby5OZXh0KCgxLSRKaXR0ZXIpKiREZWxheSwgKDErJEppdHRlcikqJERlbGF5KQogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIEVudW1lcmF0aW5nIHNlcnZlciAkQ29tcHV0ZXIgKCRDb3VudGVyIG9mICQoJENvbXB1dGVyTmFtZS5jb3VudCkpIgoKICAgICAgICAgICAgICAgICRTY3JpcHRBcmdzID0gQCgkQ29tcHV0ZXIsICRGYWxzZSwgJE91dEZpbGUsICREb21haW5TSUQsICRUcnVzdEdyb3Vwc1NJRHMsICRBUEksICREb21haW5Pbmx5KQoKICAgICAgICAgICAgICAgIEludm9rZS1Db21tYW5kIC1TY3JpcHRCbG9jayAkSG9zdEVudW1CbG9jayAtQXJndW1lbnRMaXN0ICRTY3JpcHRBcmdzCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojCiMgRG9tYWluIHRydXN0IGZ1bmN0aW9ucyBiZWxvdy4KIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZnVuY3Rpb24gR2V0LU5ldERvbWFpblRydXN0IHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXR1cm4gYWxsIGRvbWFpbiB0cnVzdHMgZm9yIHRoZSBjdXJyZW50IGRvbWFpbiBvcgogICAgICAgIGEgc3BlY2lmaWVkIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHdob3NlIHRydXN0cyB0byBlbnVtZXJhdGUsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLCBlLmcuICJMREFQOi8vREM9dGVzdGxhYixEQz1sb2NhbCIuCiAgICAgICAgVXNlZnVsIGZvciBnbG9iYWwgY2F0YWxvZyBxdWVyaWVzIDspCgogICAgLlBBUkFNRVRFUiBBUEkKCiAgICAgICAgVXNlIGFuIEFQSSBjYWxsIChEc0VudW1lcmF0ZURvbWFpblRydXN0cykgdG8gZW51bWVyYXRlIHRoZSB0cnVzdHMuCgogICAgLlBBUkFNRVRFUiBMREFQCgogICAgICAgIFN3aXRjaC4gVXNlIExEQVAgcXVlcmllcyB0byBlbnVtZXJhdGUgdGhlIHRydXN0cyBpbnN0ZWFkIG9mIGRpcmVjdCBkb21haW4gY29ubmVjdGlvbnMuIAogICAgICAgIE1vcmUgbGlrZWx5IHRvIGdldCBhcm91bmQgbmV0d29yayBzZWdtZW50YXRpb24sIGJ1dCBub3QgYXMgYWNjdXJhdGUuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0RG9tYWluVHJ1c3QKCiAgICAgICAgUmV0dXJuIGRvbWFpbiB0cnVzdHMgZm9yIHRoZSBjdXJyZW50IGRvbWFpbiB1c2luZyBidWlsdCBpbiAuTkVUIG1ldGhvZHMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0RG9tYWluVHJ1c3QgLURvbWFpbiAicHJvZC50ZXN0bGFiLmxvY2FsIgoKICAgICAgICBSZXR1cm4gZG9tYWluIHRydXN0cyBmb3IgdGhlICJwcm9kLnRlc3RsYWIubG9jYWwiIGRvbWFpbiB1c2luZyAuTkVUIG1ldGhvZHMKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXREb21haW5UcnVzdCAtTERBUCAtRG9tYWluICJwcm9kLnRlc3RsYWIubG9jYWwiIC1Eb21haW5Db250cm9sbGVyICJQUklNQVJZLnRlc3RsYWIubG9jYWwiCgogICAgICAgIFJldHVybiBkb21haW4gdHJ1c3RzIGZvciB0aGUgInByb2QudGVzdGxhYi5sb2NhbCIgZG9tYWluIGVudW1lcmF0ZWQgdGhyb3VnaCBMREFQCiAgICAgICAgcXVlcmllcywgcmVmbGVjdGluZyBxdWVyaWVzIHRocm91Z2ggdGhlICJQcmltYXJ5LnRlc3RsYWIubG9jYWwiIGRvbWFpbiBjb250cm9sbGVyLAogICAgICAgIHVzaW5nIC5ORVQgbWV0aG9kcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXREb21haW5UcnVzdCAtQVBJIC1Eb21haW4gInByb2QudGVzdGxhYi5sb2NhbCIKCiAgICAgICAgUmV0dXJuIGRvbWFpbiB0cnVzdHMgZm9yIHRoZSAicHJvZC50ZXN0bGFiLmxvY2FsIiBkb21haW4gZW51bWVyYXRlZCB0aHJvdWdoIEFQSSBjYWxscy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXREb21haW5UcnVzdCAtQVBJIC1Eb21haW5Db250cm9sbGVyIFdJTkRPV1MyLnRlc3RsYWIubG9jYWwKCiAgICAgICAgUmV0dXJuIGRvbWFpbiB0cnVzdHMgcmVhY2hhYmxlIGZyb20gdGhlIFdJTkRPV1MyIG1hY2hpbmUgdGhyb3VnaCBBUEkgY2FsbHMuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQVBJLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRMREFQLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgYmVnaW4gewogICAgICAgICRUcnVzdEF0dHJpYnV0ZXMgPSBAewogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDAxJyA9ICdub25fdHJhbnNpdGl2ZScKICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDAwMicgPSAndXBsZXZlbF9vbmx5JwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDA0JyA9ICdxdWFyYW50aW5lZF9kb21haW4nCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwMDgnID0gJ2ZvcmVzdF90cmFuc2l0aXZlJwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDEwJyA9ICdjcm9zc19vcmdhbml6YXRpb24nCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwMjAnID0gJ3dpdGhpbl9mb3Jlc3QnCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwNDAnID0gJ3RyZWF0X2FzX2V4dGVybmFsJwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDgwJyA9ICd0cnVzdF91c2VzX3JjNF9lbmNyeXB0aW9uJwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMTAwJyA9ICd0cnVzdF91c2VzX2Flc19rZXlzJwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMjAwJyA9ICdjcm9zc19vcmdhbml6YXRpb25fbm9fdGd0X2RlbGVnYXRpb24nCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDA0MDAnID0gJ3BpbV90cnVzdCcKICAgICAgICB9CiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIGlmKC1ub3QgJERvbWFpbikgewogICAgICAgICAgICAjIGlmIG5vdCBkb21haW4gaXMgc3BlY2lmaWVkIGdyYWIgdGhlIGN1cnJlbnQgZG9tYWluCiAgICAgICAgICAgICRTb3VyY2VEb21haW4gPSAoR2V0LU5ldERvbWFpbiAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCkuTmFtZQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFNvdXJjZURvbWFpbiA9ICREb21haW4KICAgICAgICB9CgogICAgICAgIGlmKCRMREFQIC1vciAkQURTUGF0aCkgewoKICAgICAgICAgICAgJFRydXN0U2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkU291cmNlRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1QYWdlU2l6ZSAkUGFnZVNpemUgLUFEU3BhdGggJEFEU3BhdGgKCiAgICAgICAgICAgICRTb3VyY2VTSUQgPSBHZXQtRG9tYWluU0lEIC1Eb21haW4gJFNvdXJjZURvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlcgoKICAgICAgICAgICAgaWYoJFRydXN0U2VhcmNoZXIpIHsKCiAgICAgICAgICAgICAgICAkVHJ1c3RTZWFyY2hlci5GaWx0ZXIgPSAnKG9iamVjdENsYXNzPXRydXN0ZWREb21haW4pJwoKICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJFRydXN0U2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICRQcm9wcyA9ICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgJFRydXN0QXR0cmliID0gQCgpCiAgICAgICAgICAgICAgICAgICAgJFRydXN0QXR0cmliICs9ICRUcnVzdEF0dHJpYnV0ZXMuS2V5cyB8IFdoZXJlLU9iamVjdCB7ICRQcm9wcy50cnVzdGF0dHJpYnV0ZXNbMF0gLWJhbmQgJF8gfSB8IEZvckVhY2gtT2JqZWN0IHsgJFRydXN0QXR0cmlidXRlc1skX10gfQoKICAgICAgICAgICAgICAgICAgICAkRGlyZWN0aW9uID0gU3dpdGNoICgkUHJvcHMudHJ1c3RkaXJlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgMCB7ICdEaXNhYmxlZCcgfQogICAgICAgICAgICAgICAgICAgICAgICAxIHsgJ0luYm91bmQnIH0KICAgICAgICAgICAgICAgICAgICAgICAgMiB7ICdPdXRib3VuZCcgfQogICAgICAgICAgICAgICAgICAgICAgICAzIHsgJ0JpZGlyZWN0aW9uYWwnIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJE9iamVjdEd1aWQgPSBOZXctT2JqZWN0IEd1aWQgQCgsJFByb3BzLm9iamVjdGd1aWRbMF0pCiAgICAgICAgICAgICAgICAgICAgJFRhcmdldFNJRCA9IChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyKCRQcm9wcy5zZWN1cml0eWlkZW50aWZpZXJbMF0sMCkpLlZhbHVlCiAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NvdXJjZU5hbWUnICRTb3VyY2VEb21haW4KICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU291cmNlU0lEJyAkU291cmNlU0lECiAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RhcmdldE5hbWUnICRQcm9wcy5uYW1lWzBdCiAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RhcmdldFNJRCcgJFRhcmdldFNJRAogICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdPYmplY3RHdWlkJyAieyRPYmplY3RHdWlkfSIKICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVHJ1c3RUeXBlJyAkKCRUcnVzdEF0dHJpYiAtam9pbiAnLCcpCiAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RydXN0RGlyZWN0aW9uJyAiJERpcmVjdGlvbiIKICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LkRvbWFpblRydXN0TERBUCcpCiAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICRUcnVzdFNlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2VpZigkQVBJKSB7CiAgICAgICAgICAgIGlmKC1ub3QgJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgICAgICREb21haW5Db250cm9sbGVyID0gR2V0LU5ldERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLURvbWFpbiAkU291cmNlRG9tYWluIHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgMSB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IE5hbWUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgICAgICMgYXJndW1lbnRzIGZvciBEc0VudW1lcmF0ZURvbWFpblRydXN0cwogICAgICAgICAgICAgICAgJFB0ckluZm8gPSBbSW50UHRyXTo6WmVybwoKICAgICAgICAgICAgICAgICMgNjMgPSBEU19ET01BSU5fSU5fRk9SRVNUICsgRFNfRE9NQUlOX0RJUkVDVF9PVVRCT1VORCArIERTX0RPTUFJTl9UUkVFX1JPT1QgKyBEU19ET01BSU5fUFJJTUFSWSArIERTX0RPTUFJTl9OQVRJVkVfTU9ERSArIERTX0RPTUFJTl9ESVJFQ1RfSU5CT1VORAogICAgICAgICAgICAgICAgJEZsYWdzID0gNjMKICAgICAgICAgICAgICAgICREb21haW5Db3VudCA9IDAKCiAgICAgICAgICAgICAgICAjIGdldCB0aGUgdHJ1c3QgaW5mb3JtYXRpb24gZnJvbSB0aGUgdGFyZ2V0IHNlcnZlcgogICAgICAgICAgICAgICAgJFJlc3VsdCA9ICROZXRhcGkzMjo6RHNFbnVtZXJhdGVEb21haW5UcnVzdHMoJERvbWFpbkNvbnRyb2xsZXIsICRGbGFncywgW3JlZl0kUHRySW5mbywgW3JlZl0kRG9tYWluQ291bnQpCgogICAgICAgICAgICAgICAgIyBMb2NhdGUgdGhlIG9mZnNldCBvZiB0aGUgaW5pdGlhbCBpbnRQdHIKICAgICAgICAgICAgICAgICRPZmZzZXQgPSAkUHRySW5mby5Ub0ludDY0KCkKCiAgICAgICAgICAgICAgICAjIDAgPSBzdWNjZXNzCiAgICAgICAgICAgICAgICBpZiAoKCRSZXN1bHQgLWVxIDApIC1hbmQgKCRPZmZzZXQgLWd0IDApKSB7CgogICAgICAgICAgICAgICAgICAgICMgV29yayBvdXQgaG93IG11Y2ggdG8gaW5jcmVtZW50IHRoZSBwb2ludGVyIGJ5IGZpbmRpbmcgb3V0IHRoZSBzaXplIG9mIHRoZSBzdHJ1Y3R1cmUKICAgICAgICAgICAgICAgICAgICAkSW5jcmVtZW50ID0gJERTX0RPTUFJTl9UUlVTVFM6OkdldFNpemUoKQoKICAgICAgICAgICAgICAgICAgICAjIHBhcnNlIGFsbCB0aGUgcmVzdWx0IHN0cnVjdHVyZXMKICAgICAgICAgICAgICAgICAgICBmb3IgKCRpID0gMDsgKCRpIC1sdCAkRG9tYWluQ291bnQpOyAkaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgY3JlYXRlIGEgbmV3IGludCBwdHIgYXQgdGhlIGdpdmVuIG9mZnNldCBhbmQgY2FzdCB0aGUgcG9pbnRlciBhcyBvdXIgcmVzdWx0IHN0cnVjdHVyZQogICAgICAgICAgICAgICAgICAgICAgICAkTmV3SW50UHRyID0gTmV3LU9iamVjdCBTeXN0ZW0uSW50cHRyIC1Bcmd1bWVudExpc3QgJE9mZnNldAogICAgICAgICAgICAgICAgICAgICAgICAkSW5mbyA9ICROZXdJbnRQdHIgLWFzICREU19ET01BSU5fVFJVU1RTCgogICAgICAgICAgICAgICAgICAgICAgICAkT2Zmc2V0ID0gJE5ld0ludFB0ci5Ub0ludDY0KCkKICAgICAgICAgICAgICAgICAgICAgICAgJE9mZnNldCArPSAkSW5jcmVtZW50CgogICAgICAgICAgICAgICAgICAgICAgICAkU2lkU3RyaW5nID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgJFJlc3VsdCA9ICRBZHZhcGkzMjo6Q29udmVydFNpZFRvU3RyaW5nU2lkKCRJbmZvLkRvbWFpblNpZCwgW3JlZl0kU2lkU3RyaW5nKTskTGFzdEVycm9yID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXRMYXN0V2luMzJFcnJvcigpCgogICAgICAgICAgICAgICAgICAgICAgICBpZigkUmVzdWx0IC1lcSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvcjogJCgoW0NvbXBvbmVudE1vZGVsLldpbjMyRXhjZXB0aW9uXSAkTGFzdEVycm9yKS5NZXNzYWdlKSIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTb3VyY2VEb21haW4nICRTb3VyY2VEb21haW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTb3VyY2VEb21haW5Db250cm9sbGVyJyAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ05ldGJpb3NEb21haW5OYW1lJyAkSW5mby5OZXRiaW9zRG9tYWluTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0Ruc0RvbWFpbk5hbWUnICRJbmZvLkRuc0RvbWFpbk5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdGbGFncycgJEluZm8uRmxhZ3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdQYXJlbnRJbmRleCcgJEluZm8uUGFyZW50SW5kZXgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUcnVzdFR5cGUnICRJbmZvLlRydXN0VHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RydXN0QXR0cmlidXRlcycgJEluZm8uVHJ1c3RBdHRyaWJ1dGVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRG9tYWluU2lkJyAkU2lkU3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRG9tYWluR3VpZCcgJEluZm8uRG9tYWluR3VpZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0LlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5BUElEb21haW5UcnVzdCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAjIGZyZWUgdXAgdGhlIHJlc3VsdCBidWZmZXIKICAgICAgICAgICAgICAgICAgICAkTnVsbCA9ICROZXRhcGkzMjo6TmV0QXBpQnVmZmVyRnJlZSgkUHRySW5mbykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yOiAkKChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRSZXN1bHQpLk1lc3NhZ2UpIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiQ291bGQgbm90IHJldHJpZXZlIGRvbWFpbiBjb250cm9sbGVyIGZvciAkRG9tYWluIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAjIGlmIHdlJ3JlIHVzaW5nIGRpcmVjdCBkb21haW4gY29ubmVjdGlvbnMgdGhyb3VnaCAuTkVUCiAgICAgICAgICAgICRGb3VuZERvbWFpbiA9IEdldC1OZXREb21haW4gLURvbWFpbiAkRG9tYWluIC1DcmVkZW50aWFsICRDcmVkZW50aWFsCiAgICAgICAgICAgIGlmKCRGb3VuZERvbWFpbikgewogICAgICAgICAgICAgICAgJEZvdW5kRG9tYWluLkdldEFsbFRydXN0UmVsYXRpb25zaGlwcygpIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICRfLlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5Eb21haW5UcnVzdCcpCiAgICAgICAgICAgICAgICAgICAgJF8KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1OZXRGb3Jlc3RUcnVzdCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUmV0dXJuIGFsbCB0cnVzdHMgZm9yIHRoZSBjdXJyZW50IGZvcmVzdC4KCiAgICAuUEFSQU1FVEVSIEZvcmVzdAoKICAgICAgICBSZXR1cm4gdHJ1c3RzIGZvciB0aGUgc3BlY2lmaWVkIGZvcmVzdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldEZvcmVzdFRydXN0CgogICAgICAgIFJldHVybiBjdXJyZW50IGZvcmVzdCB0cnVzdHMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Rm9yZXN0VHJ1c3QgLUZvcmVzdCAidGVzdCIKCiAgICAgICAgUmV0dXJuIHRydXN0cyBmb3IgdGhlICJ0ZXN0IiBmb3Jlc3QuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRm9yZXN0LAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIHByb2Nlc3MgewogICAgICAgICRGb3VuZEZvcmVzdCA9IEdldC1OZXRGb3Jlc3QgLUZvcmVzdCAkRm9yZXN0IC1DcmVkZW50aWFsICRDcmVkZW50aWFsCgogICAgICAgIGlmKCRGb3VuZEZvcmVzdCkgewogICAgICAgICAgICAkRm91bmRGb3Jlc3QuR2V0QWxsVHJ1c3RSZWxhdGlvbnNoaXBzKCkgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAkXy5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuRm9yZXN0VHJ1c3QnKQogICAgICAgICAgICAgICAgJF8KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEZpbmQtRm9yZWlnblVzZXIgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEVudW1lcmF0ZXMgdXNlcnMgd2hvIGFyZSBpbiBncm91cHMgb3V0c2lkZSBvZiB0aGVpcgogICAgICAgIHByaW5jaXBhbCBkb21haW4uIFRoZSAtUmVjdXJzZSBvcHRpb24gd2lsbCB0cnkgdG8gbWFwIGFsbCAKICAgICAgICB0cmFuc2l0aXZlIGRvbWFpbiB0cnVzdCByZWxhdGlvbnNoaXBzIGFuZCBlbnVtZXJhdGUgYWxsIAogICAgICAgIHVzZXJzIHdobyBhcmUgaW4gZ3JvdXBzIG91dHNpZGUgb2YgdGhlaXIgcHJpbmNpcGFsIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIFVzZXJOYW1lCgogICAgICAgIFVzZXJuYW1lIHRvIGZpbHRlciByZXN1bHRzIGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIERvbWFpbiB0byBxdWVyeSBmb3IgdXNlcnMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIExEQVAKCiAgICAgICAgU3dpdGNoLiBVc2UgTERBUCBxdWVyaWVzIHRvIGVudW1lcmF0ZSB0aGUgdHJ1c3RzIGluc3RlYWQgb2YgZGlyZWN0IGRvbWFpbiBjb25uZWN0aW9ucy4KICAgICAgICBNb3JlIGxpa2VseSB0byBnZXQgYXJvdW5kIG5ldHdvcmsgc2VnbWVudGF0aW9uLCBidXQgbm90IGFzIGFjY3VyYXRlLgoKICAgIC5QQVJBTUVURVIgUmVjdXJzZQoKICAgICAgICBTd2l0Y2guIEVudW1lcmF0ZSBhbGwgdXNlciB0cnVzdCBncm91cHMgZnJvbSBhbGwgcmVhY2hhYmxlIGRvbWFpbnMgcmVjdXJzaXZlbHkuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL2Jsb2cuaGFybWoweS5uZXQvCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJExEQVAsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlY3Vyc2UsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMAogICAgKQoKICAgIGZ1bmN0aW9uIEdldC1Gb3JlaWduVXNlciB7CiAgICAgICAgIyBoZWxwZXIgdXNlZCB0byBlbnVtZXJhdGUgdXNlcnMgd2hvIGFyZSBpbiBncm91cHMgb3V0c2lkZSBvZiB0aGVpciBwcmluY2lwYWwgZG9tYWluCiAgICAgICAgcGFyYW0oCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICRVc2VyTmFtZSwKCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICREb21haW4sCgogICAgICAgICAgICBbU3RyaW5nXQogICAgICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICAgICAgW0ludF0KICAgICAgICAgICAgJFBhZ2VTaXplID0gMjAwCiAgICAgICAgKQoKICAgICAgICBpZiAoJERvbWFpbikgewogICAgICAgICAgICAjIGdldCB0aGUgZG9tYWluIG5hbWUgaW50byBkaXN0aW5ndWlzaGVkIGZvcm0KICAgICAgICAgICAgJERpc3Rpbmd1aXNoZWREb21haW5OYW1lID0gIkRDPSIgKyAkRG9tYWluIC1yZXBsYWNlICdcLicsJyxEQz0nCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkRGlzdGluZ3Vpc2hlZERvbWFpbk5hbWUgPSBbU3RyaW5nXSAoW2Fkc2ldJycpLmRpc3Rpbmd1aXNoZWRuYW1lCiAgICAgICAgICAgICREb21haW4gPSAkRGlzdGluZ3Vpc2hlZERvbWFpbk5hbWUgLXJlcGxhY2UgJ0RDPScsJycgLXJlcGxhY2UgJywnLCcuJwogICAgICAgIH0KCiAgICAgICAgR2V0LU5ldFVzZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1Vc2VyTmFtZSAkVXNlck5hbWUgLVBhZ2VTaXplICRQYWdlU2l6ZSAtRmlsdGVyICcobWVtYmVyb2Y9KiknIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICBGb3JFYWNoICgkTWVtYmVyc2hpcCBpbiAkXy5tZW1iZXJvZikgewogICAgICAgICAgICAgICAgJEluZGV4ID0gJE1lbWJlcnNoaXAuSW5kZXhPZigiREM9IikKICAgICAgICAgICAgICAgIGlmKCRJbmRleCkgewogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICRHcm91cERvbWFpbiA9ICQoJE1lbWJlcnNoaXAuc3Vic3RyaW5nKCRJbmRleCkpIC1yZXBsYWNlICdEQz0nLCcnIC1yZXBsYWNlICcsJywnLicKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoJEdyb3VwRG9tYWluLkNvbXBhcmVUbygkRG9tYWluKSkgewogICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHRoZSBncm91cCBkb21haW4gZG9lc24ndCBtYXRjaCB0aGUgdXNlciBkb21haW4sIG91dHB1dAogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBOYW1lID0gJE1lbWJlcnNoaXAuc3BsaXQoIiwiKVswXS5zcGxpdCgiPSIpWzFdCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3JlaWduVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgJEZvcmVpZ25Vc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJEb21haW4nICREb21haW4KICAgICAgICAgICAgICAgICAgICAgICAgJEZvcmVpZ25Vc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJOYW1lJyAkXy5zYW1hY2NvdW50bmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnblVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXBEb21haW4nICRHcm91cERvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnblVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXBOYW1lJyAkR3JvdXBOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3JlaWduVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cEROJyAkTWVtYmVyc2hpcAogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnblVzZXIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgaWYgKCRSZWN1cnNlKSB7CiAgICAgICAgIyBnZXQgYWxsIHJlY2hhYmxlIGRvbWFpbnMgaW4gdGhlIHRydXN0IG1lc2ggYW5kIHVuaXF1aWZ5IHRoZW0KICAgICAgICBpZigkTERBUCAtb3IgJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgJERvbWFpblRydXN0cyA9IEludm9rZS1NYXBEb21haW5UcnVzdCAtTERBUCAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5Tb3VyY2VEb21haW4gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICREb21haW5UcnVzdHMgPSBJbnZva2UtTWFwRG9tYWluVHJ1c3QgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IEZvckVhY2gtT2JqZWN0IHsgJF8uU291cmNlRG9tYWluIH0gfCBTb3J0LU9iamVjdCAtVW5pcXVlCiAgICAgICAgfQoKICAgICAgICBGb3JFYWNoKCREb21haW5UcnVzdCBpbiAkRG9tYWluVHJ1c3RzKSB7CiAgICAgICAgICAgICMgZ2V0IHRoZSB0cnVzdCBncm91cHMgZm9yIGVhY2ggZG9tYWluIGluIHRoZSB0cnVzdCBtZXNoCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVudW1lcmF0aW5nIHRydXN0IGdyb3VwcyBpbiBkb21haW4gJERvbWFpblRydXN0IgogICAgICAgICAgICBHZXQtRm9yZWlnblVzZXIgLURvbWFpbiAkRG9tYWluVHJ1c3QgLVVzZXJOYW1lICRVc2VyTmFtZSAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgR2V0LUZvcmVpZ25Vc2VyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtVXNlck5hbWUgJFVzZXJOYW1lIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgIH0KfQoKCmZ1bmN0aW9uIEZpbmQtRm9yZWlnbkdyb3VwIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBFbnVtZXJhdGVzIGFsbCB0aGUgbWVtYmVycyBvZiBhIGdpdmVuIGRvbWFpbidzIGdyb3VwcwogICAgICAgIGFuZCBmaW5kcyB1c2VycyB0aGF0IGFyZSBub3QgaW4gdGhlIHF1ZXJpZWQgZG9tYWluLgogICAgICAgIFRoZSAtUmVjdXJzZSBmbGFnIHdpbGwgcGVyZm9ybSB0aGlzIGVudW1lcmF0aW9uIGZvciBhbGwKICAgICAgICBlYWNoYWJsZSBkb21haW4gdHJ1c3RzLgoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIEdyb3VwbmFtZSB0byBmaWx0ZXIgcmVzdWx0cyBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBEb21haW4gdG8gcXVlcnkgZm9yIGdyb3VwcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgTERBUAoKICAgICAgICBTd2l0Y2guIFVzZSBMREFQIHF1ZXJpZXMgdG8gZW51bWVyYXRlIHRoZSB0cnVzdHMgaW5zdGVhZCBvZiBkaXJlY3QgZG9tYWluIGNvbm5lY3Rpb25zLgogICAgICAgIE1vcmUgbGlrZWx5IHRvIGdldCBhcm91bmQgbmV0d29yayBzZWdtZW50YXRpb24sIGJ1dCBub3QgYXMgYWNjdXJhdGUuCgogICAgLlBBUkFNRVRFUiBSZWN1cnNlCgogICAgICAgIFN3aXRjaC4gRW51bWVyYXRlIGFsbCBncm91cCB0cnVzdCB1c2VycyBmcm9tIGFsbCByZWFjaGFibGUgZG9tYWlucyByZWN1cnNpdmVseS4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vYmxvZy5oYXJtajB5Lm5ldC8KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lID0gJyonLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJExEQVAsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlY3Vyc2UsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXSAKICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMAogICAgKQoKICAgIGZ1bmN0aW9uIEdldC1Gb3JlaWduR3JvdXAgewogICAgICAgIHBhcmFtKAogICAgICAgICAgICBbU3RyaW5nXQogICAgICAgICAgICAkR3JvdXBOYW1lID0gJyonLAoKICAgICAgICAgICAgW1N0cmluZ10KICAgICAgICAgICAgJERvbWFpbiwKCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldIAogICAgICAgICAgICBbSW50XQogICAgICAgICAgICAkUGFnZVNpemUgPSAyMDAKICAgICAgICApCgogICAgICAgIGlmKC1ub3QgJERvbWFpbikgewogICAgICAgICAgICAkRG9tYWluID0gKEdldC1OZXREb21haW4pLk5hbWUKICAgICAgICB9CgogICAgICAgICREb21haW5ETiA9ICJEQz0kKCREb21haW4uUmVwbGFjZSgnLicsICcsREM9JykpIgogICAgICAgIFdyaXRlLVZlcmJvc2UgIkRvbWFpbkROOiAkRG9tYWluRE4iCgogICAgICAgICMgc3RhbmRhcmQgZ3JvdXAgbmFtZXMgdG8gaWdub3JlCiAgICAgICAgJEV4Y2x1ZGVHcm91cHMgPSBAKCJVc2VycyIsICJEb21haW4gVXNlcnMiLCAiR3Vlc3RzIikKCiAgICAgICAgIyBnZXQgYWxsIHRoZSBncm91cG5hbWVzIGZvciB0aGUgZ2l2ZW4gZG9tYWluCiAgICAgICAgR2V0LU5ldEdyb3VwIC1Hcm91cE5hbWUgJEdyb3VwTmFtZSAtRmlsdGVyICcobWVtYmVyPSopJyAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBXaGVyZS1PYmplY3QgewogICAgICAgICAgICAjIGV4Y2x1ZGUgY29tbW9uIGxhcmdlIGdyb3VwcwogICAgICAgICAgICAtbm90ICgkRXhjbHVkZUdyb3VwcyAtY29udGFpbnMgJF8uc2FtYWNjb3VudG5hbWUpIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRHcm91cE5hbWUgPSAkXy5zYW1BY2NvdW50TmFtZQoKICAgICAgICAgICAgICAgICRfLm1lbWJlciB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAjIGZpbHRlciBmb3IgZm9yZWlnbiBTSURzIGluIHRoZSBjbiBmaWVsZCBmb3IgdXNlcnMgaW4gYW5vdGhlciBkb21haW4sCiAgICAgICAgICAgICAgICAgICAgIyAgIG9yIGlmIHRoZSBETiBkb2Vzbid0IGVuZCB3aXRoIHRoZSBwcm9wZXIgRE4gZm9yIHRoZSBxdWVyaWVkIGRvbWFpbiAgCiAgICAgICAgICAgICAgICAgICAgaWYgKCgkXyAtbWF0Y2ggJ0NOPVMtMS01LTIxLiotLionKSAtb3IgKCREb21haW5ETiAtbmUgKCRfLnN1YnN0cmluZygkXy5JbmRleE9mKCJEQz0iKSkpKSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJEb21haW4gPSAkXy5zdWJTdHJpbmcoJF8uSW5kZXhPZigiREM9IikpIC1yZXBsYWNlICdEQz0nLCcnIC1yZXBsYWNlICcsJywnLicKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJOYW1lID0gJF8uc3BsaXQoIiwiKVswXS5zcGxpdCgiPSIpWzFdCgogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnbkdyb3VwVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgJEZvcmVpZ25Hcm91cFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXBEb21haW4nICREb21haW4KICAgICAgICAgICAgICAgICAgICAgICAgJEZvcmVpZ25Hcm91cFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXBOYW1lJyAkR3JvdXBOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3JlaWduR3JvdXBVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJEb21haW4nICRVc2VyRG9tYWluCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3JlaWduR3JvdXBVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJOYW1lJyAkVXNlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJEZvcmVpZ25Hcm91cFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlckROJyAkXwogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnbkdyb3VwVXNlcgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgaWYgKCRSZWN1cnNlKSB7CiAgICAgICAgIyBnZXQgYWxsIHJlY2hhYmxlIGRvbWFpbnMgaW4gdGhlIHRydXN0IG1lc2ggYW5kIHVuaXF1aWZ5IHRoZW0KICAgICAgICBpZigkTERBUCAtb3IgJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgJERvbWFpblRydXN0cyA9IEludm9rZS1NYXBEb21haW5UcnVzdCAtTERBUCAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5Tb3VyY2VEb21haW4gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICREb21haW5UcnVzdHMgPSBJbnZva2UtTWFwRG9tYWluVHJ1c3QgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IEZvckVhY2gtT2JqZWN0IHsgJF8uU291cmNlRG9tYWluIH0gfCBTb3J0LU9iamVjdCAtVW5pcXVlCiAgICAgICAgfQoKICAgICAgICBGb3JFYWNoKCREb21haW5UcnVzdCBpbiAkRG9tYWluVHJ1c3RzKSB7CiAgICAgICAgICAgICMgZ2V0IHRoZSB0cnVzdCBncm91cHMgZm9yIGVhY2ggZG9tYWluIGluIHRoZSB0cnVzdCBtZXNoCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVudW1lcmF0aW5nIHRydXN0IGdyb3VwcyBpbiBkb21haW4gJERvbWFpblRydXN0IgogICAgICAgICAgICBHZXQtRm9yZWlnbkdyb3VwIC1Hcm91cE5hbWUgJEdyb3VwTmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgICAgIH0KICAgIH0KICAgIGVsc2UgewogICAgICAgIEdldC1Gb3JlaWduR3JvdXAgLUdyb3VwTmFtZSAkR3JvdXBOYW1lIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICB9Cn0KCgpmdW5jdGlvbiBGaW5kLU1hbmFnZWRTZWN1cml0eUdyb3VwcyB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiByZXRyaWV2ZXMgYWxsIHNlY3VyaXR5IGdyb3VwcyBpbiB0aGUgZG9tYWluIGFuZCBpZGVudGlmaWVzIG9uZXMgdGhhdAogICAgICAgIGhhdmUgYSBtYW5hZ2VyIHNldC4gSXQgYWxzbyBkZXRlcm1pbmVzIHdoZXRoZXIgdGhlIG1hbmFnZXIgaGFzIHRoZSBhYmlsaXR5IHRvIGFkZAogICAgICAgIG9yIHJlbW92ZSBtZW1iZXJzIGZyb20gdGhlIGdyb3VwLgoKICAgICAgICBBdXRob3I6IFN0dWFydCBNb3JnYW4gKEB1a3N0dWZ1cykgPHN0dWFydC5tb3JnYW5AbXdyaW5mb3NlY3VyaXR5LmNvbT4KICAgICAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtTWFuYWdlZFNlY3VyaXR5R3JvdXBzIHwgRXhwb3J0LVBvd2VyVmlld0NTViAtTm9UeXBlSW5mb3JtYXRpb24gZ3JvdXAtbWFuYWdlcnMuY3N2CgogICAgICAgIFN0b3JlIGEgbGlzdCBvZiBhbGwgc2VjdXJpdHkgZ3JvdXBzIHdpdGggbWFuYWdlcnMgaW4gZ3JvdXAtbWFuYWdlcnMuY3N2CgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIEF1dGhvcml0eSB0byBtYW5pcHVsYXRlIHRoZSBncm91cCBtZW1iZXJzaGlwIG9mIEFEIHNlY3VyaXR5IGdyb3VwcyBhbmQgZGlzdHJpYnV0aW9uIGdyb3VwcyAKICAgICAgICBjYW4gYmUgZGVsZWdhdGVkIHRvIG5vbi1hZG1pbmlzdHJhdG9ycyBieSBzZXR0aW5nIHRoZSAnbWFuYWdlZEJ5JyBhdHRyaWJ1dGUuIFRoaXMgaXMgdHlwaWNhbGx5CiAgICAgICAgdXNlZCB0byBkZWxlZ2F0ZSBtYW5hZ2VtZW50IGF1dGhvcml0eSB0byBkaXN0cmlidXRpb24gZ3JvdXBzLCBidXQgV2luZG93cyBzdXBwb3J0cyBzZWN1cml0eSBncm91cHMKICAgICAgICBiZWluZyBtYW5hZ2VkIGluIHRoZSBzYW1lIHdheS4KCiAgICAgICAgVGhpcyBmdW5jdGlvbiBzZWFyY2hlcyBmb3IgQUQgZ3JvdXBzIHdoaWNoIGhhdmUgYSBncm91cCBtYW5hZ2VyIHNldCwgYW5kIGRldGVybWluZXMgd2hldGhlciB0aGF0CiAgICAgICAgdXNlciBjYW4gbWFuaXB1bGF0ZSBncm91cCBtZW1iZXJzaGlwLiBUaGlzIGNvdWxkIGJlIGEgdXNlZnVsIG1ldGhvZCBvZiBob3Jpem9udGFsIHByaXZpbGVnZQogICAgICAgIGVzY2FsYXRpb24sIGVzcGVjaWFsbHkgaWYgdGhlIG1hbmFnZXIgY2FuIG1hbmlwdWxhdGUgdGhlIG1lbWJlcnNoaXAgb2YgYSBwcml2aWxlZ2VkIGdyb3VwLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9Qb3dlclNoZWxsRW1waXJlL0VtcGlyZS9wdWxsLzExOQoKIz4KCiAgICAjIEdvIHRocm91Z2ggdGhlIGxpc3Qgb2Ygc2VjdXJpdHkgZ3JvdXBzIG9uIHRoZSBkb21haW4gYW5kIGlkZW50aWZ5IHRob3NlIHdobyBoYXZlIGEgbWFuYWdlcgogICAgR2V0LU5ldEdyb3VwIC1GdWxsRGF0YSAtRmlsdGVyICcobWFuYWdlZEJ5PSopJyB8IFNlbGVjdC1PYmplY3QgLVVuaXF1ZSBkaXN0aW5ndWlzaGVkTmFtZSxtYW5hZ2VkQnksY24gfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICMgUmV0cmlldmUgdGhlIG9iamVjdCB0aGF0IHRoZSBtYW5hZ2VkQnkgRE4gcmVmZXJzIHRvCiAgICAgICAgJGdyb3VwX21hbmFnZXIgPSBHZXQtQURPYmplY3QgLUFEU1BhdGggJF8ubWFuYWdlZEJ5IHwgU2VsZWN0LU9iamVjdCBjbixkaXN0aW5ndWlzaGVkbmFtZSxuYW1lLHNhbWFjY291bnR0eXBlLHNhbWFjY291bnRuYW1lCgogICAgICAgICMgQ3JlYXRlIGEgcmVzdWx0cyBvYmplY3QgdG8gc3RvcmUgb3VyIGZpbmRpbmdzCiAgICAgICAgJHJlc3VsdHNfb2JqZWN0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5IEB7CiAgICAgICAgICAgICdHcm91cENOJyA9ICRfLmNuCiAgICAgICAgICAgICdHcm91cEROJyA9ICRfLmRpc3Rpbmd1aXNoZWRuYW1lCiAgICAgICAgICAgICdNYW5hZ2VyQ04nID0gJGdyb3VwX21hbmFnZXIuY24KICAgICAgICAgICAgJ01hbmFnZXJETicgPSAkZ3JvdXBfbWFuYWdlci5kaXN0aW5ndWlzaGVkTmFtZQogICAgICAgICAgICAnTWFuYWdlclNBTicgPSAkZ3JvdXBfbWFuYWdlci5zYW1hY2NvdW50bmFtZQogICAgICAgICAgICAnTWFuYWdlclR5cGUnID0gJycKICAgICAgICAgICAgJ0Nhbk1hbmFnZXJXcml0ZScgPSAkRkFMU0UKICAgICAgICB9CgogICAgICAgICMgRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIG1hbmFnZXIgaXMgYSB1c2VyIG9yIGEgZ3JvdXAKICAgICAgICBpZiAoJGdyb3VwX21hbmFnZXIuc2FtYWNjb3VudHR5cGUgLWVxIDB4MTAwMDAwMDApIHsKICAgICAgICAgICAgJHJlc3VsdHNfb2JqZWN0Lk1hbmFnZXJUeXBlID0gJ0dyb3VwJwogICAgICAgIH0gZWxzZWlmICgkZ3JvdXBfbWFuYWdlci5zYW1hY2NvdW50dHlwZSAtZXEgMHgzMDAwMDAwMCkgewogICAgICAgICAgICAkcmVzdWx0c19vYmplY3QuTWFuYWdlclR5cGUgPSAnVXNlcicKICAgICAgICB9CgogICAgICAgICMgRmluZCB0aGUgQUNMcyB0aGF0IHJlbGF0ZSB0byB0aGUgYWJpbGl0eSB0byB3cml0ZSB0byB0aGUgZ3JvdXAKICAgICAgICAkeGFjbCA9IEdldC1PYmplY3RBY2wgLUFEU1BhdGggJF8uZGlzdGluZ3Vpc2hlZG5hbWUgLVJpZ2h0cyBXcml0ZU1lbWJlcnMKCiAgICAgICAgIyBEb3VibGUtY2hlY2sgdGhhdCB0aGUgbWFuYWdlcgogICAgICAgIGlmICgkeGFjbC5PYmplY3RUeXBlIC1lcSAnYmY5Njc5YzAtMGRlNi0xMWQwLWEyODUtMDBhYTAwMzA0OWUyJyAtYW5kICR4YWNsLkFjY2Vzc0NvbnRyb2xUeXBlIC1lcSAnQWxsb3cnIC1hbmQgJHhhY2wuSWRlbnRpdHlSZWZlcmVuY2UuVmFsdWUuQ29udGFpbnMoJGdyb3VwX21hbmFnZXIuc2FtYWNjb3VudG5hbWUpKSB7CiAgICAgICAgICAgICRyZXN1bHRzX29iamVjdC5DYW5NYW5hZ2VyV3JpdGUgPSAkVFJVRQogICAgICAgIH0KICAgICAgICAkcmVzdWx0c19vYmplY3QKICAgIH0KfQoKCmZ1bmN0aW9uIEludm9rZS1NYXBEb21haW5UcnVzdCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiBnZXRzIGFsbCB0cnVzdHMgZm9yIHRoZSBjdXJyZW50IGRvbWFpbiwKICAgICAgICBhbmQgdHJpZXMgdG8gZ2V0IGFsbCB0cnVzdHMgZm9yIGVhY2ggZG9tYWluIGl0IGZpbmRzLgoKICAgIC5QQVJBTUVURVIgTERBUAoKICAgICAgICBTd2l0Y2guIFVzZSBMREFQIHF1ZXJpZXMgdG8gZW51bWVyYXRlIHRoZSB0cnVzdHMgaW5zdGVhZCBvZiBkaXJlY3QgZG9tYWluIGNvbm5lY3Rpb25zLgogICAgICAgIE1vcmUgbGlrZWx5IHRvIGdldCBhcm91bmQgbmV0d29yayBzZWdtZW50YXRpb24sIGJ1dCBub3QgYXMgYWNjdXJhdGUuCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1NYXBEb21haW5UcnVzdCB8IEV4cG9ydC1DU1YgLU5vVHlwZUluZm9ybWF0aW9uIHRydXN0cy5jc3YKICAgICAgICAKICAgICAgICBNYXAgYWxsIHJlYWNoYWJsZSBkb21haW4gdHJ1c3RzIGFuZCBvdXRwdXQgZXZlcnl0aGluZyB0byBhIC5jc3YgZmlsZS4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vYmxvZy5oYXJtajB5Lm5ldC8KIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbU3dpdGNoXQogICAgICAgICRMREFQLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0gCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgIyBrZWVwIHRyYWNrIG9mIGRvbWFpbnMgc2VlbiBzbyB3ZSBkb24ndCBoaXQgaW5maW5pdGUgcmVjdXJzaW9uCiAgICAkU2VlbkRvbWFpbnMgPSBAe30KCiAgICAjIG91ciBkb21haW4gc3RhdHVzIHRyYWNrZXIKICAgICREb21haW5zID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuU3RhY2sKCiAgICAjIGdldCB0aGUgY3VycmVudCBkb21haW4gYW5kIHB1c2ggaXQgb250byB0aGUgc3RhY2sKICAgICRDdXJyZW50RG9tYWluID0gKEdldC1OZXREb21haW4gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwpLk5hbWUKICAgICREb21haW5zLnB1c2goJEN1cnJlbnREb21haW4pCgogICAgd2hpbGUoJERvbWFpbnMuQ291bnQgLW5lIDApIHsKCiAgICAgICAgJERvbWFpbiA9ICREb21haW5zLlBvcCgpCgogICAgICAgICMgaWYgd2UgaGF2ZW4ndCBzZWVuIHRoaXMgZG9tYWluIGJlZm9yZQogICAgICAgIGlmICgkRG9tYWluIC1hbmQgKCREb21haW4uVHJpbSgpIC1uZSAiIikgLWFuZCAoLW5vdCAkU2VlbkRvbWFpbnMuQ29udGFpbnNLZXkoJERvbWFpbikpKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFbnVtZXJhdGluZyB0cnVzdHMgZm9yIGRvbWFpbiAnJERvbWFpbiciCgogICAgICAgICAgICAjIG1hcmsgaXQgYXMgc2VlbiBpbiBvdXIgbGlzdAogICAgICAgICAgICAkTnVsbCA9ICRTZWVuRG9tYWlucy5hZGQoJERvbWFpbiwgIiIpCgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgIyBnZXQgYWxsIHRoZSB0cnVzdHMgZm9yIHRoaXMgZG9tYWluCiAgICAgICAgICAgICAgICBpZigkTERBUCAtb3IgJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgICAgICAgICAkVHJ1c3RzID0gR2V0LU5ldERvbWFpblRydXN0IC1Eb21haW4gJERvbWFpbiAtTERBUCAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIC1DcmVkZW50aWFsICRDcmVkZW50aWFsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkVHJ1c3RzID0gR2V0LU5ldERvbWFpblRydXN0IC1Eb21haW4gJERvbWFpbiAtUGFnZVNpemUgJFBhZ2VTaXplIC1DcmVkZW50aWFsICRDcmVkZW50aWFsCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoJFRydXN0cyAtaXNub3QgW1N5c3RlbS5BcnJheV0pIHsKICAgICAgICAgICAgICAgICAgICAkVHJ1c3RzID0gQCgkVHJ1c3RzKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgZ2V0IGFueSBmb3Jlc3QgdHJ1c3RzLCBpZiB0aGV5IGV4aXN0CiAgICAgICAgICAgICAgICBpZigtbm90ICgkTERBUCAtb3IgJERvbWFpbkNvbnRyb2xsZXIpICkgewogICAgICAgICAgICAgICAgICAgICRUcnVzdHMgKz0gR2V0LU5ldEZvcmVzdFRydXN0IC1Gb3Jlc3QgJERvbWFpbiAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgkVHJ1c3RzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoJFRydXN0cyAtaXNub3QgW1N5c3RlbS5BcnJheV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFRydXN0cyA9IEAoJFRydXN0cykKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICMgZW51bWVyYXRlIGVhY2ggdHJ1c3QgZm91bmQKICAgICAgICAgICAgICAgICAgICBGb3JFYWNoICgkVHJ1c3QgaW4gJFRydXN0cykgewogICAgICAgICAgICAgICAgICAgICAgICBpZigkVHJ1c3QuU291cmNlTmFtZSAtYW5kICRUcnVzdC5UYXJnZXROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkU291cmNlRG9tYWluID0gJFRydXN0LlNvdXJjZU5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUYXJnZXREb21haW4gPSAkVHJ1c3QuVGFyZ2V0TmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRydXN0VHlwZSA9ICRUcnVzdC5UcnVzdFR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUcnVzdERpcmVjdGlvbiA9ICRUcnVzdC5UcnVzdERpcmVjdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE9iamVjdFR5cGUgPSAkVHJ1c3QuUFNPYmplY3QuVHlwZU5hbWVzIHwgV2hlcmUtT2JqZWN0IHskXyAtbWF0Y2ggJ1Bvd2VyVmlldyd9IHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgMQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgbWFrZSBzdXJlIHdlIHByb2Nlc3MgdGhlIHRhcmdldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE51bGwgPSAkRG9tYWlucy5QdXNoKCRUYXJnZXREb21haW4pCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBidWlsZCB0aGUgbmljZWx5LXBhcnNhYmxlIGN1c3RvbSBvdXRwdXQgb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU291cmNlRG9tYWluJyAiJFNvdXJjZURvbWFpbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTb3VyY2VTSUQnICRUcnVzdC5Tb3VyY2VTSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUYXJnZXREb21haW4nICIkVGFyZ2V0RG9tYWluIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RhcmdldFNJRCcgJFRydXN0LlRhcmdldFNJRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RydXN0VHlwZScgIiRUcnVzdFR5cGUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVHJ1c3REaXJlY3Rpb24nICIkVHJ1c3REaXJlY3Rpb24iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgkT2JqZWN0VHlwZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlshXSBFcnJvcjogJF8iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojCiMgRXhwb3NlIHRoZSBXaW4zMkFQSSBmdW5jdGlvbnMgYW5kIGRhdGFzdHJ1Y3R1cmVzIGJlbG93CiMgdXNpbmcgUFNSZWZsZWN0LiAKIyBXYXJuaW5nOiBPbmNlIHRoZXNlIGFyZSBleGVjdXRlZCwgdGhleSBhcmUgYmFrZWQgaW4gCiMgYW5kIGNhbid0IGJlIGNoYW5nZWQgd2hpbGUgdGhlIHNjcmlwdCBpcyBydW5uaW5nIQojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgokTW9kID0gTmV3LUluTWVtb3J5TW9kdWxlIC1Nb2R1bGVOYW1lIFdpbjMyCgojIGFsbCBvZiB0aGUgV2luMzIgQVBJIGZ1bmN0aW9ucyB3ZSBuZWVkCiRGdW5jdGlvbkRlZmluaXRpb25zID0gQCgKICAgIChmdW5jIG5ldGFwaTMyIE5ldFNoYXJlRW51bSAoW0ludF0pIEAoW1N0cmluZ10sIFtJbnRdLCBbSW50UHRyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnRdLCBbSW50MzJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpKSksCiAgICAoZnVuYyBuZXRhcGkzMiBOZXRXa3N0YVVzZXJFbnVtIChbSW50XSkgQChbU3RyaW5nXSwgW0ludF0sIFtJbnRQdHJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludF0sIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpLCBbSW50MzJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCkpKSwKICAgIChmdW5jIG5ldGFwaTMyIE5ldFNlc3Npb25FbnVtIChbSW50XSkgQChbU3RyaW5nXSwgW1N0cmluZ10sIFtTdHJpbmddLCBbSW50XSwgW0ludFB0cl0uTWFrZUJ5UmVmVHlwZSgpLCBbSW50XSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpLCBbSW50MzJdLk1ha2VCeVJlZlR5cGUoKSkpLAogICAgKGZ1bmMgbmV0YXBpMzIgTmV0TG9jYWxHcm91cEdldE1lbWJlcnMgKFtJbnRdKSBAKFtTdHJpbmddLCBbU3RyaW5nXSwgW0ludF0sIFtJbnRQdHJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludF0sIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpLCBbSW50MzJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCkpKSwKICAgIChmdW5jIG5ldGFwaTMyIERzR2V0U2l0ZU5hbWUgKFtJbnRdKSBAKFtTdHJpbmddLCBbSW50UHRyXS5NYWtlQnlSZWZUeXBlKCkpKSwKICAgIChmdW5jIG5ldGFwaTMyIERzRW51bWVyYXRlRG9tYWluVHJ1c3RzIChbSW50XSkgQChbU3RyaW5nXSwgW1VJbnQzMl0sIFtJbnRQdHJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludFB0cl0uTWFrZUJ5UmVmVHlwZSgpKSksCiAgICAoZnVuYyBuZXRhcGkzMiBOZXRBcGlCdWZmZXJGcmVlIChbSW50XSkgQChbSW50UHRyXSkpLAogICAgKGZ1bmMgYWR2YXBpMzIgQ29udmVydFNpZFRvU3RyaW5nU2lkIChbSW50XSkgQChbSW50UHRyXSwgW1N0cmluZ10uTWFrZUJ5UmVmVHlwZSgpKSAtU2V0TGFzdEVycm9yKSwKICAgIChmdW5jIGFkdmFwaTMyIE9wZW5TQ01hbmFnZXJXIChbSW50UHRyXSkgQChbU3RyaW5nXSwgW1N0cmluZ10sIFtJbnRdKSAtU2V0TGFzdEVycm9yKSwKICAgIChmdW5jIGFkdmFwaTMyIENsb3NlU2VydmljZUhhbmRsZSAoW0ludF0pIEAoW0ludFB0cl0pKSwKICAgIChmdW5jIHd0c2FwaTMyIFdUU09wZW5TZXJ2ZXJFeCAoW0ludFB0cl0pIEAoW1N0cmluZ10pKSwKICAgIChmdW5jIHd0c2FwaTMyIFdUU0VudW1lcmF0ZVNlc3Npb25zRXggKFtJbnRdKSBAKFtJbnRQdHJdLCBbSW50MzJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludF0sIFtJbnRQdHJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCkpIC1TZXRMYXN0RXJyb3IpLAogICAgKGZ1bmMgd3RzYXBpMzIgV1RTUXVlcnlTZXNzaW9uSW5mb3JtYXRpb24gKFtJbnRdKSBAKFtJbnRQdHJdLCBbSW50XSwgW0ludF0sIFtJbnRQdHJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCkpIC1TZXRMYXN0RXJyb3IpLAogICAgKGZ1bmMgd3RzYXBpMzIgV1RTRnJlZU1lbW9yeUV4IChbSW50XSkgQChbSW50MzJdLCBbSW50UHRyXSwgW0ludDMyXSkpLAogICAgKGZ1bmMgd3RzYXBpMzIgV1RTRnJlZU1lbW9yeSAoW0ludF0pIEAoW0ludFB0cl0pKSwKICAgIChmdW5jIHd0c2FwaTMyIFdUU0Nsb3NlU2VydmVyIChbSW50XSkgQChbSW50UHRyXSkpCikKCiMgZW51bSB1c2VkIGJ5ICRXVFNfU0VTU0lPTl9JTkZPXzEgYmVsb3cKJFdUU0Nvbm5lY3RTdGF0ZSA9IHBzZW51bSAkTW9kIFdUU19DT05ORUNUU1RBVEVfQ0xBU1MgVUludDE2IEB7CiAgICBBY3RpdmUgICAgICAgPSAgICAwCiAgICBDb25uZWN0ZWQgICAgPSAgICAxCiAgICBDb25uZWN0UXVlcnkgPSAgICAyCiAgICBTaGFkb3cgICAgICAgPSAgICAzCiAgICBEaXNjb25uZWN0ZWQgPSAgICA0CiAgICBJZGxlICAgICAgICAgPSAgICA1CiAgICBMaXN0ZW4gICAgICAgPSAgICA2CiAgICBSZXNldCAgICAgICAgPSAgICA3CiAgICBEb3duICAgICAgICAgPSAgICA4CiAgICBJbml0ICAgICAgICAgPSAgICA5Cn0KCiMgdGhlIFdUU0VudW1lcmF0ZVNlc3Npb25zRXggcmVzdWx0IHN0cnVjdHVyZQokV1RTX1NFU1NJT05fSU5GT18xID0gc3RydWN0ICRNb2QgV1RTX1NFU1NJT05fSU5GT18xIEB7CiAgICBFeGVjRW52SWQgPSBmaWVsZCAwIFVJbnQzMgogICAgU3RhdGUgPSBmaWVsZCAxICRXVFNDb25uZWN0U3RhdGUKICAgIFNlc3Npb25JZCA9IGZpZWxkIDIgVUludDMyCiAgICBwU2Vzc2lvbk5hbWUgPSBmaWVsZCAzIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICBwSG9zdE5hbWUgPSBmaWVsZCA0IFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICBwVXNlck5hbWUgPSBmaWVsZCA1IFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICBwRG9tYWluTmFtZSA9IGZpZWxkIDYgU3RyaW5nIC1NYXJzaGFsQXMgQCgnTFBXU3RyJykKICAgIHBGYXJtTmFtZSA9IGZpZWxkIDcgU3RyaW5nIC1NYXJzaGFsQXMgQCgnTFBXU3RyJykKfQoKIyB0aGUgcGFydGljdWxhciBXVFNRdWVyeVNlc3Npb25JbmZvcm1hdGlvbiByZXN1bHQgc3RydWN0dXJlCiRXVFNfQ0xJRU5UX0FERFJFU1MgPSBzdHJ1Y3QgJG1vZCBXVFNfQ0xJRU5UX0FERFJFU1MgQHsKICAgIEFkZHJlc3NGYW1pbHkgPSBmaWVsZCAwIFVJbnQzMgogICAgQWRkcmVzcyA9IGZpZWxkIDEgQnl0ZVtdIC1NYXJzaGFsQXMgQCgnQnlWYWxBcnJheScsIDIwKQp9CgojIHRoZSBOZXRTaGFyZUVudW0gcmVzdWx0IHN0cnVjdHVyZQokU0hBUkVfSU5GT18xID0gc3RydWN0ICRNb2QgU0hBUkVfSU5GT18xIEB7CiAgICBzaGkxX25ldG5hbWUgPSBmaWVsZCAwIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICBzaGkxX3R5cGUgPSBmaWVsZCAxIFVJbnQzMgogICAgc2hpMV9yZW1hcmsgPSBmaWVsZCAyIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCn0KCiMgdGhlIE5ldFdrc3RhVXNlckVudW0gcmVzdWx0IHN0cnVjdHVyZQokV0tTVEFfVVNFUl9JTkZPXzEgPSBzdHJ1Y3QgJE1vZCBXS1NUQV9VU0VSX0lORk9fMSBAewogICAgd2t1aTFfdXNlcm5hbWUgPSBmaWVsZCAwIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICB3a3VpMV9sb2dvbl9kb21haW4gPSBmaWVsZCAxIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICB3a3VpMV9vdGhfZG9tYWlucyA9IGZpZWxkIDIgU3RyaW5nIC1NYXJzaGFsQXMgQCgnTFBXU3RyJykKICAgIHdrdWkxX2xvZ29uX3NlcnZlciA9IGZpZWxkIDMgU3RyaW5nIC1NYXJzaGFsQXMgQCgnTFBXU3RyJykKfQoKIyB0aGUgTmV0U2Vzc2lvbkVudW0gcmVzdWx0IHN0cnVjdHVyZQokU0VTU0lPTl9JTkZPXzEwID0gc3RydWN0ICRNb2QgU0VTU0lPTl9JTkZPXzEwIEB7CiAgICBzZXNpMTBfY25hbWUgPSBmaWVsZCAwIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICBzZXNpMTBfdXNlcm5hbWUgPSBmaWVsZCAxIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICBzZXNpMTBfdGltZSA9IGZpZWxkIDIgVUludDMyCiAgICBzZXNpMTBfaWRsZV90aW1lID0gZmllbGQgMyBVSW50MzIKfQoKIyBlbnVtIHVzZWQgYnkgJExPQ0FMR1JPVVBfTUVNQkVSU19JTkZPXzIgYmVsb3cKJFNJRF9OQU1FX1VTRSA9IHBzZW51bSAkTW9kIFNJRF9OQU1FX1VTRSBVSW50MTYgQHsKICAgIFNpZFR5cGVVc2VyICAgICAgICAgICAgID0gMQogICAgU2lkVHlwZUdyb3VwICAgICAgICAgICAgPSAyCiAgICBTaWRUeXBlRG9tYWluICAgICAgICAgICA9IDMKICAgIFNpZFR5cGVBbGlhcyAgICAgICAgICAgID0gNAogICAgU2lkVHlwZVdlbGxLbm93bkdyb3VwICAgPSA1CiAgICBTaWRUeXBlRGVsZXRlZEFjY291bnQgICA9IDYKICAgIFNpZFR5cGVJbnZhbGlkICAgICAgICAgID0gNwogICAgU2lkVHlwZVVua25vd24gICAgICAgICAgPSA4CiAgICBTaWRUeXBlQ29tcHV0ZXIgICAgICAgICA9IDkKfQoKIyB0aGUgTmV0TG9jYWxHcm91cEdldE1lbWJlcnMgcmVzdWx0IHN0cnVjdHVyZQokTE9DQUxHUk9VUF9NRU1CRVJTX0lORk9fMiA9IHN0cnVjdCAkTW9kIExPQ0FMR1JPVVBfTUVNQkVSU19JTkZPXzIgQHsKICAgIGxncm1pMl9zaWQgPSBmaWVsZCAwIEludFB0cgogICAgbGdybWkyX3NpZHVzYWdlID0gZmllbGQgMSAkU0lEX05BTUVfVVNFCiAgICBsZ3JtaTJfZG9tYWluYW5kbmFtZSA9IGZpZWxkIDIgU3RyaW5nIC1NYXJzaGFsQXMgQCgnTFBXU3RyJykKfQoKIyBlbnVtcyB1c2VkIGluIERTX0RPTUFJTl9UUlVTVFMKJERzRG9tYWluRmxhZyA9IHBzZW51bSAkTW9kIERzRG9tYWluLkZsYWdzIFVJbnQzMiBAewogICAgSU5fRk9SRVNUICAgICAgID0gMQogICAgRElSRUNUX09VVEJPVU5EID0gMgogICAgVFJFRV9ST09UICAgICAgID0gNAogICAgUFJJTUFSWSAgICAgICAgID0gOAogICAgTkFUSVZFX01PREUgICAgID0gMTYKICAgIERJUkVDVF9JTkJPVU5EICA9IDMyCn0gLUJpdGZpZWxkCiREc0RvbWFpblRydXN0VHlwZSA9IHBzZW51bSAkTW9kIERzRG9tYWluLlRydXN0VHlwZSBVSW50MzIgQHsKICAgIERPV05MRVZFTCAgID0gMQogICAgVVBMRVZFTCAgICAgPSAyCiAgICBNSVQgICAgICAgICA9IDMKICAgIERDRSAgICAgICAgID0gNAp9CiREc0RvbWFpblRydXN0QXR0cmlidXRlcyA9IHBzZW51bSAkTW9kIERzRG9tYWluLlRydXN0QXR0cmlidXRlcyBVSW50MzIgQHsKICAgIE5PTl9UUkFOU0lUSVZFICAgICAgPSAxCiAgICBVUExFVkVMX09OTFkgICAgICAgID0gMgogICAgRklMVEVSX1NJRFMgICAgICAgICA9IDQKICAgIEZPUkVTVF9UUkFOU0lUSVZFICAgPSA4CiAgICBDUk9TU19PUkdBTklaQVRJT04gID0gMTYKICAgIFdJVEhJTl9GT1JFU1QgICAgICAgPSAzMgogICAgVFJFQVRfQVNfRVhURVJOQUwgICA9IDY0Cn0KCiMgdGhlIERzRW51bWVyYXRlRG9tYWluVHJ1c3RzIHJlc3VsdCBzdHJ1Y3R1cmUKJERTX0RPTUFJTl9UUlVTVFMgPSBzdHJ1Y3QgJE1vZCBEU19ET01BSU5fVFJVU1RTIEB7CiAgICBOZXRiaW9zRG9tYWluTmFtZSA9IGZpZWxkIDAgU3RyaW5nIC1NYXJzaGFsQXMgQCgnTFBXU3RyJykKICAgIERuc0RvbWFpbk5hbWUgPSBmaWVsZCAxIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICBGbGFncyA9IGZpZWxkIDIgJERzRG9tYWluRmxhZwogICAgUGFyZW50SW5kZXggPSBmaWVsZCAzIFVJbnQzMgogICAgVHJ1c3RUeXBlID0gZmllbGQgNCAkRHNEb21haW5UcnVzdFR5cGUKICAgIFRydXN0QXR0cmlidXRlcyA9IGZpZWxkIDUgJERzRG9tYWluVHJ1c3RBdHRyaWJ1dGVzCiAgICBEb21haW5TaWQgPSBmaWVsZCA2IEludFB0cgogICAgRG9tYWluR3VpZCA9IGZpZWxkIDcgR3VpZAp9CgokVHlwZXMgPSAkRnVuY3Rpb25EZWZpbml0aW9ucyB8IEFkZC1XaW4zMlR5cGUgLU1vZHVsZSAkTW9kIC1OYW1lc3BhY2UgJ1dpbjMyJwokTmV0YXBpMzIgPSAkVHlwZXNbJ25ldGFwaTMyJ10KJEFkdmFwaTMyID0gJFR5cGVzWydhZHZhcGkzMiddCiRXdHNhcGkzMiA9ICRUeXBlc1snd3RzYXBpMzInXQo=
