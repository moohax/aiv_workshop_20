BloodHound.ps1,ec2caf479f98f7ab7cab54e56ce3c1cf,Scan result is 32768. IsMalware: 1,I3JlcXVpcmVzIC12ZXJzaW9uIDIKCjwjCgogICAgUG93ZXJTcGxvaXQgRmlsZTogUG93ZXJWaWV3LnBzMQogICAgQXV0aG9yOiBXaWxsIFNjaHJvZWRlciAoQGhhcm1qMHkpCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIFJlcXVpcmVkIERlcGVuZGVuY2llczogTm9uZQogICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBOb25lCgojPgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojIFBTUmVmbGVjdCBjb2RlIGZvciBXaW5kb3dzIEFQSSBhY2Nlc3MKIyBBdXRob3I6IEBtYXR0aWZlc3RhdGlvbgojICAgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL21hdHRpZmVzdGF0aW9uL1BTUmVmbGVjdC9tYXN0ZXIvUFNSZWZsZWN0LnBzbTEKIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZnVuY3Rpb24gTmV3LUluTWVtb3J5TW9kdWxlCnsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBDcmVhdGVzIGFuIGluLW1lbW9yeSBhc3NlbWJseSBhbmQgbW9kdWxlCgogICAgICAgIEF1dGhvcjogTWF0dGhldyBHcmFlYmVyIChAbWF0dGlmZXN0YXRpb24pCiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAgICAgUmVxdWlyZWQgRGVwZW5kZW5jaWVzOiBOb25lCiAgICAgICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBOb25lCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFdoZW4gZGVmaW5pbmcgY3VzdG9tIGVudW1zLCBzdHJ1Y3RzLCBhbmQgdW5tYW5hZ2VkIGZ1bmN0aW9ucywgaXQgaXMKICAgICAgICBuZWNlc3NhcnkgdG8gYXNzb2NpYXRlIHRvIGFuIGFzc2VtYmx5IG1vZHVsZS4gVGhpcyBoZWxwZXIgZnVuY3Rpb24KICAgICAgICBjcmVhdGVzIGFuIGluLW1lbW9yeSBtb2R1bGUgdGhhdCBjYW4gYmUgcGFzc2VkIHRvIHRoZSAnZW51bScsCiAgICAgICAgJ3N0cnVjdCcsIGFuZCBBZGQtV2luMzJUeXBlIGZ1bmN0aW9ucy4KCiAgICAuUEFSQU1FVEVSIE1vZHVsZU5hbWUKCiAgICAgICAgU3BlY2lmaWVzIHRoZSBkZXNpcmVkIG5hbWUgZm9yIHRoZSBpbi1tZW1vcnkgYXNzZW1ibHkgYW5kIG1vZHVsZS4gSWYKICAgICAgICBNb2R1bGVOYW1lIGlzIG5vdCBwcm92aWRlZCwgaXQgd2lsbCBkZWZhdWx0IHRvIGEgR1VJRC4KCiAgICAuRVhBTVBMRQoKICAgICAgICAkTW9kdWxlID0gTmV3LUluTWVtb3J5TW9kdWxlIC1Nb2R1bGVOYW1lIFdpbjMyCiM+CgogICAgUGFyYW0KICAgICgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRNb2R1bGVOYW1lID0gW0d1aWRdOjpOZXdHdWlkKCkuVG9TdHJpbmcoKQogICAgKQoKICAgICRMb2FkZWRBc3NlbWJsaWVzID0gW0FwcERvbWFpbl06OkN1cnJlbnREb21haW4uR2V0QXNzZW1ibGllcygpCgogICAgRm9yRWFjaCAoJEFzc2VtYmx5IGluICRMb2FkZWRBc3NlbWJsaWVzKSB7CiAgICAgICAgaWYgKCRBc3NlbWJseS5GdWxsTmFtZSAtYW5kICgkQXNzZW1ibHkuRnVsbE5hbWUuU3BsaXQoJywnKVswXSAtZXEgJE1vZHVsZU5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybiAkQXNzZW1ibHkKICAgICAgICB9CiAgICB9CgogICAgJER5bkFzc2VtYmx5ID0gTmV3LU9iamVjdCBSZWZsZWN0aW9uLkFzc2VtYmx5TmFtZSgkTW9kdWxlTmFtZSkKICAgICREb21haW4gPSBbQXBwRG9tYWluXTo6Q3VycmVudERvbWFpbgogICAgJEFzc2VtYmx5QnVpbGRlciA9ICREb21haW4uRGVmaW5lRHluYW1pY0Fzc2VtYmx5KCREeW5Bc3NlbWJseSwgJ1J1bicpCiAgICAkTW9kdWxlQnVpbGRlciA9ICRBc3NlbWJseUJ1aWxkZXIuRGVmaW5lRHluYW1pY01vZHVsZSgkTW9kdWxlTmFtZSwgJEZhbHNlKQoKICAgIHJldHVybiAkTW9kdWxlQnVpbGRlcgp9CgoKIyBBIGhlbHBlciBmdW5jdGlvbiB1c2VkIHRvIHJlZHVjZSB0eXBpbmcgd2hpbGUgZGVmaW5pbmcgZnVuY3Rpb24KIyBwcm90b3R5cGVzIGZvciBBZGQtV2luMzJUeXBlLgpmdW5jdGlvbiBmdW5jCnsKICAgIFBhcmFtCiAgICAoCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDAsIE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREbGxOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMSwgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZ1bmN0aW9uTmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDIsIE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbVHlwZV0KICAgICAgICAkUmV0dXJuVHlwZSwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDMpXQogICAgICAgIFtUeXBlW11dCiAgICAgICAgJFBhcmFtZXRlclR5cGVzLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gNCldCiAgICAgICAgW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkNhbGxpbmdDb252ZW50aW9uXQogICAgICAgICROYXRpdmVDYWxsaW5nQ29udmVudGlvbiwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDUpXQogICAgICAgIFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5DaGFyU2V0XQogICAgICAgICRDaGFyc2V0LAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTZXRMYXN0RXJyb3IKICAgICkKCiAgICAkUHJvcGVydGllcyA9IEB7CiAgICAgICAgRGxsTmFtZSA9ICREbGxOYW1lCiAgICAgICAgRnVuY3Rpb25OYW1lID0gJEZ1bmN0aW9uTmFtZQogICAgICAgIFJldHVyblR5cGUgPSAkUmV0dXJuVHlwZQogICAgfQoKICAgIGlmICgkUGFyYW1ldGVyVHlwZXMpIHsgJFByb3BlcnRpZXNbJ1BhcmFtZXRlclR5cGVzJ10gPSAkUGFyYW1ldGVyVHlwZXMgfQogICAgaWYgKCROYXRpdmVDYWxsaW5nQ29udmVudGlvbikgeyAkUHJvcGVydGllc1snTmF0aXZlQ2FsbGluZ0NvbnZlbnRpb24nXSA9ICROYXRpdmVDYWxsaW5nQ29udmVudGlvbiB9CiAgICBpZiAoJENoYXJzZXQpIHsgJFByb3BlcnRpZXNbJ0NoYXJzZXQnXSA9ICRDaGFyc2V0IH0KICAgIGlmICgkU2V0TGFzdEVycm9yKSB7ICRQcm9wZXJ0aWVzWydTZXRMYXN0RXJyb3InXSA9ICRTZXRMYXN0RXJyb3IgfQoKICAgIE5ldy1PYmplY3QgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzCn0KCgpmdW5jdGlvbiBBZGQtV2luMzJUeXBlCnsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBDcmVhdGVzIGEgLk5FVCB0eXBlIGZvciBhbiB1bm1hbmFnZWQgV2luMzIgZnVuY3Rpb24uCgogICAgICAgIEF1dGhvcjogTWF0dGhldyBHcmFlYmVyIChAbWF0dGlmZXN0YXRpb24pCiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAgICAgUmVxdWlyZWQgRGVwZW5kZW5jaWVzOiBOb25lCiAgICAgICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBmdW5jCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIEFkZC1XaW4zMlR5cGUgZW5hYmxlcyB5b3UgdG8gZWFzaWx5IGludGVyYWN0IHdpdGggdW5tYW5hZ2VkIChpLmUuCiAgICAgICAgV2luMzIgdW5tYW5hZ2VkKSBmdW5jdGlvbnMgaW4gUG93ZXJTaGVsbC4gQWZ0ZXIgcHJvdmlkaW5nCiAgICAgICAgQWRkLVdpbjMyVHlwZSB3aXRoIGEgZnVuY3Rpb24gc2lnbmF0dXJlLCBhIC5ORVQgdHlwZSBpcyBjcmVhdGVkCiAgICAgICAgdXNpbmcgcmVmbGVjdGlvbiAoaS5lLiBjc2MuZXhlIGlzIG5ldmVyIGNhbGxlZCBsaWtlIHdpdGggQWRkLVR5cGUpLgoKICAgICAgICBUaGUgJ2Z1bmMnIGhlbHBlciBmdW5jdGlvbiBjYW4gYmUgdXNlZCB0byByZWR1Y2UgdHlwaW5nIHdoZW4gZGVmaW5pbmcKICAgICAgICBtdWx0aXBsZSBmdW5jdGlvbiBkZWZpbml0aW9ucy4KCiAgICAuUEFSQU1FVEVSIERsbE5hbWUKCiAgICAgICAgVGhlIG5hbWUgb2YgdGhlIERMTC4KCiAgICAuUEFSQU1FVEVSIEZ1bmN0aW9uTmFtZQoKICAgICAgICBUaGUgbmFtZSBvZiB0aGUgdGFyZ2V0IGZ1bmN0aW9uLgoKICAgIC5QQVJBTUVURVIgUmV0dXJuVHlwZQoKICAgICAgICBUaGUgcmV0dXJuIHR5cGUgb2YgdGhlIGZ1bmN0aW9uLgoKICAgIC5QQVJBTUVURVIgUGFyYW1ldGVyVHlwZXMKCiAgICAgICAgVGhlIGZ1bmN0aW9uIHBhcmFtZXRlcnMuCgogICAgLlBBUkFNRVRFUiBOYXRpdmVDYWxsaW5nQ29udmVudGlvbgoKICAgICAgICBTcGVjaWZpZXMgdGhlIG5hdGl2ZSBjYWxsaW5nIGNvbnZlbnRpb24gb2YgdGhlIGZ1bmN0aW9uLiBEZWZhdWx0cyB0bwogICAgICAgIHN0ZGNhbGwuCgogICAgLlBBUkFNRVRFUiBDaGFyc2V0CgogICAgICAgIElmIHlvdSBuZWVkIHRvIGV4cGxpY2l0bHkgY2FsbCBhbiAnQScgb3IgJ1cnIFdpbjMyIGZ1bmN0aW9uLCB5b3UgY2FuCiAgICAgICAgc3BlY2lmeSB0aGUgY2hhcmFjdGVyIHNldC4KCiAgICAuUEFSQU1FVEVSIFNldExhc3RFcnJvcgoKICAgICAgICBJbmRpY2F0ZXMgd2hldGhlciB0aGUgY2FsbGVlIGNhbGxzIHRoZSBTZXRMYXN0RXJyb3IgV2luMzIgQVBJCiAgICAgICAgZnVuY3Rpb24gYmVmb3JlIHJldHVybmluZyBmcm9tIHRoZSBhdHRyaWJ1dGVkIG1ldGhvZC4KCiAgICAuUEFSQU1FVEVSIE1vZHVsZQoKICAgICAgICBUaGUgaW4tbWVtb3J5IG1vZHVsZSB0aGF0IHdpbGwgaG9zdCB0aGUgZnVuY3Rpb25zLiBVc2UKICAgICAgICBOZXctSW5NZW1vcnlNb2R1bGUgdG8gZGVmaW5lIGFuIGluLW1lbW9yeSBtb2R1bGUuCgogICAgLlBBUkFNRVRFUiBOYW1lc3BhY2UKCiAgICAgICAgQW4gb3B0aW9uYWwgbmFtZXNwYWNlIHRvIHByZXBlbmQgdG8gdGhlIHR5cGUuIEFkZC1XaW4zMlR5cGUgZGVmYXVsdHMKICAgICAgICB0byBhIG5hbWVzcGFjZSBjb25zaXN0aW5nIG9ubHkgb2YgdGhlIG5hbWUgb2YgdGhlIERMTC4KCiAgICAuRVhBTVBMRQoKICAgICAgICAkTW9kID0gTmV3LUluTWVtb3J5TW9kdWxlIC1Nb2R1bGVOYW1lIFdpbjMyCgogICAgICAgICRGdW5jdGlvbkRlZmluaXRpb25zID0gQCgKICAgICAgICAgIChmdW5jIGtlcm5lbDMyIEdldFByb2NBZGRyZXNzIChbSW50UHRyXSkgQChbSW50UHRyXSwgW1N0cmluZ10pIC1DaGFyc2V0IEFuc2kgLVNldExhc3RFcnJvciksCiAgICAgICAgICAoZnVuYyBrZXJuZWwzMiBHZXRNb2R1bGVIYW5kbGUgKFtJbnRwdHJdKSBAKFtTdHJpbmddKSAtU2V0TGFzdEVycm9yKSwKICAgICAgICAgIChmdW5jIG50ZGxsIFJ0bEdldEN1cnJlbnRQZWIgKFtJbnRQdHJdKSBAKCkpCiAgICAgICAgKQoKICAgICAgICAkVHlwZXMgPSAkRnVuY3Rpb25EZWZpbml0aW9ucyB8IEFkZC1XaW4zMlR5cGUgLU1vZHVsZSAkTW9kIC1OYW1lc3BhY2UgJ1dpbjMyJwogICAgICAgICRLZXJuZWwzMiA9ICRUeXBlc1sna2VybmVsMzInXQogICAgICAgICROdGRsbCA9ICRUeXBlc1snbnRkbGwnXQogICAgICAgICROdGRsbDo6UnRsR2V0Q3VycmVudFBlYigpCiAgICAgICAgJG50ZGxsYmFzZSA9ICRLZXJuZWwzMjo6R2V0TW9kdWxlSGFuZGxlKCdudGRsbCcpCiAgICAgICAgJEtlcm5lbDMyOjpHZXRQcm9jQWRkcmVzcygkbnRkbGxiYXNlLCAnUnRsR2V0Q3VycmVudFBlYicpCgogICAgLk5PVEVTCgogICAgICAgIEluc3BpcmVkIGJ5IExlZSBIb2xtZXMnIEludm9rZS1XaW5kb3dzQXBpIGh0dHA6Ly9wb3NoY29kZS5vcmcvMjE4OQoKICAgICAgICBXaGVuIGRlZmluaW5nIG11bHRpcGxlIGZ1bmN0aW9uIHByb3RvdHlwZXMsIGl0IGlzIGlkZWFsIHRvIHByb3ZpZGUKICAgICAgICBBZGQtV2luMzJUeXBlIHdpdGggYW4gYXJyYXkgb2YgZnVuY3Rpb24gc2lnbmF0dXJlcy4gVGhhdCB3YXksIHRoZXkKICAgICAgICBhcmUgYWxsIGluY29ycG9yYXRlZCBpbnRvIHRoZSBzYW1lIGluLW1lbW9yeSBtb2R1bGUuCiM+CgogICAgW091dHB1dFR5cGUoW0hhc2h0YWJsZV0pXQogICAgUGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREbGxOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZ1bmN0aW9uTmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbVHlwZV0KICAgICAgICAkUmV0dXJuVHlwZSwKCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQogICAgICAgIFtUeXBlW11dCiAgICAgICAgJFBhcmFtZXRlclR5cGVzLAoKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWUgPSAkVHJ1ZSldCiAgICAgICAgW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkNhbGxpbmdDb252ZW50aW9uXQogICAgICAgICROYXRpdmVDYWxsaW5nQ29udmVudGlvbiA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5DYWxsaW5nQ29udmVudGlvbl06OlN0ZENhbGwsCgogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuQ2hhclNldF0KICAgICAgICAkQ2hhcnNldCA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5DaGFyU2V0XTo6QXV0bywKCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNldExhc3RFcnJvciwKCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHsoJF8gLWlzIFtSZWZsZWN0aW9uLkVtaXQuTW9kdWxlQnVpbGRlcl0pIC1vciAoJF8gLWlzIFtSZWZsZWN0aW9uLkFzc2VtYmx5XSl9KV0KICAgICAgICAkTW9kdWxlLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsKCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkTmFtZXNwYWNlID0gJycKICAgICkKCiAgICBCRUdJTgogICAgewogICAgICAgICRUeXBlSGFzaCA9IEB7fQogICAgfQoKICAgIFBST0NFU1MKICAgIHsKICAgICAgICBpZiAoJE1vZHVsZSAtaXMgW1JlZmxlY3Rpb24uQXNzZW1ibHldKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKCROYW1lc3BhY2UpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRUeXBlSGFzaFskRGxsTmFtZV0gPSAkTW9kdWxlLkdldFR5cGUoIiROYW1lc3BhY2UuJERsbE5hbWUiKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJFR5cGVIYXNoWyREbGxOYW1lXSA9ICRNb2R1bGUuR2V0VHlwZSgkRGxsTmFtZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICAjIERlZmluZSBvbmUgdHlwZSBmb3IgZWFjaCBETEwKICAgICAgICAgICAgaWYgKCEkVHlwZUhhc2guQ29udGFpbnNLZXkoJERsbE5hbWUpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoJE5hbWVzcGFjZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkVHlwZUhhc2hbJERsbE5hbWVdID0gJE1vZHVsZS5EZWZpbmVUeXBlKCIkTmFtZXNwYWNlLiREbGxOYW1lIiwgJ1B1YmxpYyxCZWZvcmVGaWVsZEluaXQnKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRUeXBlSGFzaFskRGxsTmFtZV0gPSAkTW9kdWxlLkRlZmluZVR5cGUoJERsbE5hbWUsICdQdWJsaWMsQmVmb3JlRmllbGRJbml0JykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE1ldGhvZCA9ICRUeXBlSGFzaFskRGxsTmFtZV0uRGVmaW5lTWV0aG9kKAogICAgICAgICAgICAgICAgJEZ1bmN0aW9uTmFtZSwKICAgICAgICAgICAgICAgICdQdWJsaWMsU3RhdGljLFBpbnZva2VJbXBsJywKICAgICAgICAgICAgICAgICRSZXR1cm5UeXBlLAogICAgICAgICAgICAgICAgJFBhcmFtZXRlclR5cGVzKQoKICAgICAgICAgICAgIyBNYWtlIGVhY2ggQnlSZWYgcGFyYW1ldGVyIGFuIE91dCBwYXJhbWV0ZXIKICAgICAgICAgICAgJGkgPSAxCiAgICAgICAgICAgIEZvckVhY2goJFBhcmFtZXRlciBpbiAkUGFyYW1ldGVyVHlwZXMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICgkUGFyYW1ldGVyLklzQnlSZWYpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgW3ZvaWRdICRNZXRob2QuRGVmaW5lUGFyYW1ldGVyKCRpLCAnT3V0JywgJE51bGwpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGkrKwogICAgICAgICAgICB9CgogICAgICAgICAgICAkRGxsSW1wb3J0ID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkRsbEltcG9ydEF0dHJpYnV0ZV0KICAgICAgICAgICAgJFNldExhc3RFcnJvckZpZWxkID0gJERsbEltcG9ydC5HZXRGaWVsZCgnU2V0TGFzdEVycm9yJykKICAgICAgICAgICAgJENhbGxpbmdDb252ZW50aW9uRmllbGQgPSAkRGxsSW1wb3J0LkdldEZpZWxkKCdDYWxsaW5nQ29udmVudGlvbicpCiAgICAgICAgICAgICRDaGFyc2V0RmllbGQgPSAkRGxsSW1wb3J0LkdldEZpZWxkKCdDaGFyU2V0JykKICAgICAgICAgICAgaWYgKCRTZXRMYXN0RXJyb3IpIHsgJFNMRVZhbHVlID0gJFRydWUgfSBlbHNlIHsgJFNMRVZhbHVlID0gJEZhbHNlIH0KCiAgICAgICAgICAgICMgRXF1aXZhbGVudCB0byBDIyB2ZXJzaW9uIG9mIFtEbGxJbXBvcnQoRGxsTmFtZSldCiAgICAgICAgICAgICRDb25zdHJ1Y3RvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5EbGxJbXBvcnRBdHRyaWJ1dGVdLkdldENvbnN0cnVjdG9yKFtTdHJpbmddKQogICAgICAgICAgICAkRGxsSW1wb3J0QXR0cmlidXRlID0gTmV3LU9iamVjdCBSZWZsZWN0aW9uLkVtaXQuQ3VzdG9tQXR0cmlidXRlQnVpbGRlcigkQ29uc3RydWN0b3IsCiAgICAgICAgICAgICAgICAkRGxsTmFtZSwgW1JlZmxlY3Rpb24uUHJvcGVydHlJbmZvW11dIEAoKSwgW09iamVjdFtdXSBAKCksCiAgICAgICAgICAgICAgICBbUmVmbGVjdGlvbi5GaWVsZEluZm9bXV0gQCgkU2V0TGFzdEVycm9yRmllbGQsICRDYWxsaW5nQ29udmVudGlvbkZpZWxkLCAkQ2hhcnNldEZpZWxkKSwKICAgICAgICAgICAgICAgIFtPYmplY3RbXV0gQCgkU0xFVmFsdWUsIChbUnVudGltZS5JbnRlcm9wU2VydmljZXMuQ2FsbGluZ0NvbnZlbnRpb25dICROYXRpdmVDYWxsaW5nQ29udmVudGlvbiksIChbUnVudGltZS5JbnRlcm9wU2VydmljZXMuQ2hhclNldF0gJENoYXJzZXQpKSkKCiAgICAgICAgICAgICRNZXRob2QuU2V0Q3VzdG9tQXR0cmlidXRlKCREbGxJbXBvcnRBdHRyaWJ1dGUpCiAgICAgICAgfQogICAgfQoKICAgIEVORAogICAgewogICAgICAgIGlmICgkTW9kdWxlIC1pcyBbUmVmbGVjdGlvbi5Bc3NlbWJseV0pCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gJFR5cGVIYXNoCiAgICAgICAgfQoKICAgICAgICAkUmV0dXJuVHlwZXMgPSBAe30KCiAgICAgICAgRm9yRWFjaCAoJEtleSBpbiAkVHlwZUhhc2guS2V5cykKICAgICAgICB7CiAgICAgICAgICAgICRUeXBlID0gJFR5cGVIYXNoWyRLZXldLkNyZWF0ZVR5cGUoKQoKICAgICAgICAgICAgJFJldHVyblR5cGVzWyRLZXldID0gJFR5cGUKICAgICAgICB9CgogICAgICAgIHJldHVybiAkUmV0dXJuVHlwZXMKICAgIH0KfQoKCmZ1bmN0aW9uIHBzZW51bQp7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQ3JlYXRlcyBhbiBpbi1tZW1vcnkgZW51bWVyYXRpb24gZm9yIHVzZSBpbiB5b3VyIFBvd2VyU2hlbGwgc2Vzc2lvbi4KCiAgICAgICAgQXV0aG9yOiBNYXR0aGV3IEdyYWViZXIgKEBtYXR0aWZlc3RhdGlvbikKICAgICAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgICAgICBSZXF1aXJlZCBEZXBlbmRlbmNpZXM6IE5vbmUKICAgICAgICBPcHRpb25hbCBEZXBlbmRlbmNpZXM6IE5vbmUKCiAgICAuREVTQ1JJUFRJT04KCiAgICAgICAgVGhlICdwc2VudW0nIGZ1bmN0aW9uIGZhY2lsaXRhdGVzIHRoZSBjcmVhdGlvbiBvZiBlbnVtcyBlbnRpcmVseSBpbgogICAgICAgIG1lbW9yeSB1c2luZyBhcyBjbG9zZSB0byBhICJDIHN0eWxlIiBhcyBQb3dlclNoZWxsIHdpbGwgYWxsb3cuCgogICAgLlBBUkFNRVRFUiBNb2R1bGUKCiAgICAgICAgVGhlIGluLW1lbW9yeSBtb2R1bGUgdGhhdCB3aWxsIGhvc3QgdGhlIGVudW0uIFVzZQogICAgICAgIE5ldy1Jbk1lbW9yeU1vZHVsZSB0byBkZWZpbmUgYW4gaW4tbWVtb3J5IG1vZHVsZS4KCiAgICAuUEFSQU1FVEVSIEZ1bGxOYW1lCgogICAgICAgIFRoZSBmdWxseS1xdWFsaWZpZWQgbmFtZSBvZiB0aGUgZW51bS4KCiAgICAuUEFSQU1FVEVSIFR5cGUKCiAgICAgICAgVGhlIHR5cGUgb2YgZWFjaCBlbnVtIGVsZW1lbnQuCgogICAgLlBBUkFNRVRFUiBFbnVtRWxlbWVudHMKCiAgICAgICAgQSBoYXNodGFibGUgb2YgZW51bSBlbGVtZW50cy4KCiAgICAuUEFSQU1FVEVSIEJpdGZpZWxkCgogICAgICAgIFNwZWNpZmllcyB0aGF0IHRoZSBlbnVtIHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgYml0ZmllbGQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgJE1vZCA9IE5ldy1Jbk1lbW9yeU1vZHVsZSAtTW9kdWxlTmFtZSBXaW4zMgoKICAgICAgICAkSW1hZ2VTdWJzeXN0ZW0gPSBwc2VudW0gJE1vZCBQRS5JTUFHRV9TVUJTWVNURU0gVUludDE2IEB7CiAgICAgICAgICAgIFVOS05PV04gPSAgICAgICAgICAgICAgICAgIDAKICAgICAgICAgICAgTkFUSVZFID0gICAgICAgICAgICAgICAgICAgMSAjIEltYWdlIGRvZXNuJ3QgcmVxdWlyZSBhIHN1YnN5c3RlbS4KICAgICAgICAgICAgV0lORE9XU19HVUkgPSAgICAgICAgICAgICAgMiAjIEltYWdlIHJ1bnMgaW4gdGhlIFdpbmRvd3MgR1VJIHN1YnN5c3RlbS4KICAgICAgICAgICAgV0lORE9XU19DVUkgPSAgICAgICAgICAgICAgMyAjIEltYWdlIHJ1bnMgaW4gdGhlIFdpbmRvd3MgY2hhcmFjdGVyIHN1YnN5c3RlbS4KICAgICAgICAgICAgT1MyX0NVSSA9ICAgICAgICAgICAgICAgICAgNSAjIEltYWdlIHJ1bnMgaW4gdGhlIE9TLzIgY2hhcmFjdGVyIHN1YnN5c3RlbS4KICAgICAgICAgICAgUE9TSVhfQ1VJID0gICAgICAgICAgICAgICAgNyAjIEltYWdlIHJ1bnMgaW4gdGhlIFBvc2l4IGNoYXJhY3RlciBzdWJzeXN0ZW0uCiAgICAgICAgICAgIE5BVElWRV9XSU5ET1dTID0gICAgICAgICAgIDggIyBJbWFnZSBpcyBhIG5hdGl2ZSBXaW45eCBkcml2ZXIuCiAgICAgICAgICAgIFdJTkRPV1NfQ0VfR1VJID0gICAgICAgICAgIDkgIyBJbWFnZSBydW5zIGluIHRoZSBXaW5kb3dzIENFIHN1YnN5c3RlbS4KICAgICAgICAgICAgRUZJX0FQUExJQ0FUSU9OID0gICAgICAgICAgMTAKICAgICAgICAgICAgRUZJX0JPT1RfU0VSVklDRV9EUklWRVIgPSAgMTEKICAgICAgICAgICAgRUZJX1JVTlRJTUVfRFJJVkVSID0gICAgICAgMTIKICAgICAgICAgICAgRUZJX1JPTSA9ICAgICAgICAgICAgICAgICAgMTMKICAgICAgICAgICAgWEJPWCA9ICAgICAgICAgICAgICAgICAgICAgMTQKICAgICAgICAgICAgV0lORE9XU19CT09UX0FQUExJQ0FUSU9OID0gMTYKICAgICAgICB9CgogICAgLk5PVEVTCgogICAgICAgIFBvd2VyU2hlbGwgcHVyaXN0cyBtYXkgZGlzYWdyZWUgd2l0aCB0aGUgbmFtaW5nIG9mIHRoaXMgZnVuY3Rpb24gYnV0CiAgICAgICAgYWdhaW4sIHRoaXMgd2FzIGRldmVsb3BlZCBpbiBzdWNoIGEgd2F5IHNvIGFzIHRvIGVtdWxhdGUgYSAiQyBzdHlsZSIKICAgICAgICBkZWZpbml0aW9uIGFzIGNsb3NlbHkgYXMgcG9zc2libGUuIFNvcnJ5LCBJJ20gbm90IGdvaW5nIHRvIG5hbWUgaXQKICAgICAgICBOZXctRW51bS4gOlAKIz4KCiAgICBbT3V0cHV0VHlwZShbVHlwZV0pXQogICAgUGFyYW0KICAgICgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCwgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7KCRfIC1pcyBbUmVmbGVjdGlvbi5FbWl0Lk1vZHVsZUJ1aWxkZXJdKSAtb3IgKCRfIC1pcyBbUmVmbGVjdGlvbi5Bc3NlbWJseV0pfSldCiAgICAgICAgJE1vZHVsZSwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDEsIE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZ1bGxOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMiwgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtUeXBlXQogICAgICAgICRUeXBlLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMywgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW0hhc2h0YWJsZV0KICAgICAgICAkRW51bUVsZW1lbnRzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRCaXRmaWVsZAogICAgKQoKICAgIGlmICgkTW9kdWxlIC1pcyBbUmVmbGVjdGlvbi5Bc3NlbWJseV0pCiAgICB7CiAgICAgICAgcmV0dXJuICgkTW9kdWxlLkdldFR5cGUoJEZ1bGxOYW1lKSkKICAgIH0KCiAgICAkRW51bVR5cGUgPSAkVHlwZSAtYXMgW1R5cGVdCgogICAgJEVudW1CdWlsZGVyID0gJE1vZHVsZS5EZWZpbmVFbnVtKCRGdWxsTmFtZSwgJ1B1YmxpYycsICRFbnVtVHlwZSkKCiAgICBpZiAoJEJpdGZpZWxkKQogICAgewogICAgICAgICRGbGFnc0NvbnN0cnVjdG9yID0gW0ZsYWdzQXR0cmlidXRlXS5HZXRDb25zdHJ1Y3RvcihAKCkpCiAgICAgICAgJEZsYWdzQ3VzdG9tQXR0cmlidXRlID0gTmV3LU9iamVjdCBSZWZsZWN0aW9uLkVtaXQuQ3VzdG9tQXR0cmlidXRlQnVpbGRlcigkRmxhZ3NDb25zdHJ1Y3RvciwgQCgpKQogICAgICAgICRFbnVtQnVpbGRlci5TZXRDdXN0b21BdHRyaWJ1dGUoJEZsYWdzQ3VzdG9tQXR0cmlidXRlKQogICAgfQoKICAgIEZvckVhY2ggKCRLZXkgaW4gJEVudW1FbGVtZW50cy5LZXlzKQogICAgewogICAgICAgICMgQXBwbHkgdGhlIHNwZWNpZmllZCBlbnVtIHR5cGUgdG8gZWFjaCBlbGVtZW50CiAgICAgICAgJE51bGwgPSAkRW51bUJ1aWxkZXIuRGVmaW5lTGl0ZXJhbCgkS2V5LCAkRW51bUVsZW1lbnRzWyRLZXldIC1hcyAkRW51bVR5cGUpCiAgICB9CgogICAgJEVudW1CdWlsZGVyLkNyZWF0ZVR5cGUoKQp9CgoKIyBBIGhlbHBlciBmdW5jdGlvbiB1c2VkIHRvIHJlZHVjZSB0eXBpbmcgd2hpbGUgZGVmaW5pbmcgc3RydWN0CiMgZmllbGRzLgpmdW5jdGlvbiBmaWVsZAp7CiAgICBQYXJhbQogICAgKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAwLCBNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1VJbnQxNl0KICAgICAgICAkUG9zaXRpb24sCgogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAxLCBNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1R5cGVdCiAgICAgICAgJFR5cGUsCgogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAyKV0KICAgICAgICBbVUludDE2XQogICAgICAgICRPZmZzZXQsCgogICAgICAgIFtPYmplY3RbXV0KICAgICAgICAkTWFyc2hhbEFzCiAgICApCgogICAgQHsKICAgICAgICBQb3NpdGlvbiA9ICRQb3NpdGlvbgogICAgICAgIFR5cGUgPSAkVHlwZSAtYXMgW1R5cGVdCiAgICAgICAgT2Zmc2V0ID0gJE9mZnNldAogICAgICAgIE1hcnNoYWxBcyA9ICRNYXJzaGFsQXMKICAgIH0KfQoKCmZ1bmN0aW9uIHN0cnVjdAp7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQ3JlYXRlcyBhbiBpbi1tZW1vcnkgc3RydWN0IGZvciB1c2UgaW4geW91ciBQb3dlclNoZWxsIHNlc3Npb24uCgogICAgICAgIEF1dGhvcjogTWF0dGhldyBHcmFlYmVyIChAbWF0dGlmZXN0YXRpb24pCiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAgICAgUmVxdWlyZWQgRGVwZW5kZW5jaWVzOiBOb25lCiAgICAgICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBmaWVsZAoKICAgIC5ERVNDUklQVElPTgoKICAgICAgICBUaGUgJ3N0cnVjdCcgZnVuY3Rpb24gZmFjaWxpdGF0ZXMgdGhlIGNyZWF0aW9uIG9mIHN0cnVjdHMgZW50aXJlbHkgaW4KICAgICAgICBtZW1vcnkgdXNpbmcgYXMgY2xvc2UgdG8gYSAiQyBzdHlsZSIgYXMgUG93ZXJTaGVsbCB3aWxsIGFsbG93LiBTdHJ1Y3QKICAgICAgICBmaWVsZHMgYXJlIHNwZWNpZmllZCB1c2luZyBhIGhhc2h0YWJsZSB3aGVyZSBlYWNoIGZpZWxkIG9mIHRoZSBzdHJ1Y3QKICAgICAgICBpcyBjb21wcm9zZWQgb2YgdGhlIG9yZGVyIGluIHdoaWNoIGl0IHNob3VsZCBiZSBkZWZpbmVkLCBpdHMgLk5FVAogICAgICAgIHR5cGUsIGFuZCBvcHRpb25hbGx5LCBpdHMgb2Zmc2V0IGFuZCBzcGVjaWFsIG1hcnNoYWxpbmcgYXR0cmlidXRlcy4KCiAgICAgICAgT25lIG9mIHRoZSBmZWF0dXJlcyBvZiAnc3RydWN0JyBpcyB0aGF0IGFmdGVyIHlvdXIgc3RydWN0IGlzIGRlZmluZWQsCiAgICAgICAgaXQgd2lsbCBjb21lIHdpdGggYSBidWlsdC1pbiBHZXRTaXplIG1ldGhvZCBhcyB3ZWxsIGFzIGFuIGV4cGxpY2l0CiAgICAgICAgY29udmVydGVyIHNvIHRoYXQgeW91IGNhbiBlYXNpbHkgY2FzdCBhbiBJbnRQdHIgdG8gdGhlIHN0cnVjdCB3aXRob3V0CiAgICAgICAgcmVseWluZyB1cG9uIGNhbGxpbmcgU2l6ZU9mIGFuZC9vciBQdHJUb1N0cnVjdHVyZSBpbiB0aGUgTWFyc2hhbAogICAgICAgIGNsYXNzLgoKICAgIC5QQVJBTUVURVIgTW9kdWxlCgogICAgICAgIFRoZSBpbi1tZW1vcnkgbW9kdWxlIHRoYXQgd2lsbCBob3N0IHRoZSBzdHJ1Y3QuIFVzZQogICAgICAgIE5ldy1Jbk1lbW9yeU1vZHVsZSB0byBkZWZpbmUgYW4gaW4tbWVtb3J5IG1vZHVsZS4KCiAgICAuUEFSQU1FVEVSIEZ1bGxOYW1lCgogICAgICAgIFRoZSBmdWxseS1xdWFsaWZpZWQgbmFtZSBvZiB0aGUgc3RydWN0LgoKICAgIC5QQVJBTUVURVIgU3RydWN0RmllbGRzCgogICAgICAgIEEgaGFzaHRhYmxlIG9mIGZpZWxkcy4gVXNlIHRoZSAnZmllbGQnIGhlbHBlciBmdW5jdGlvbiB0byBlYXNlCiAgICAgICAgZGVmaW5pbmcgZWFjaCBmaWVsZC4KCiAgICAuUEFSQU1FVEVSIFBhY2tpbmdTaXplCgogICAgICAgIFNwZWNpZmllcyB0aGUgbWVtb3J5IGFsaWdubWVudCBvZiBmaWVsZHMuCgogICAgLlBBUkFNRVRFUiBFeHBsaWNpdExheW91dAoKICAgICAgICBJbmRpY2F0ZXMgdGhhdCBhbiBleHBsaWNpdCBvZmZzZXQgZm9yIGVhY2ggZmllbGQgd2lsbCBiZSBzcGVjaWZpZWQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgJE1vZCA9IE5ldy1Jbk1lbW9yeU1vZHVsZSAtTW9kdWxlTmFtZSBXaW4zMgoKICAgICAgICAkSW1hZ2VEb3NTaWduYXR1cmUgPSBwc2VudW0gJE1vZCBQRS5JTUFHRV9ET1NfU0lHTkFUVVJFIFVJbnQxNiBAewogICAgICAgICAgICBET1NfU0lHTkFUVVJFID0gICAgMHg1QTRECiAgICAgICAgICAgIE9TMl9TSUdOQVRVUkUgPSAgICAweDQ1NEUKICAgICAgICAgICAgT1MyX1NJR05BVFVSRV9MRSA9IDB4NDU0QwogICAgICAgICAgICBWWERfU0lHTkFUVVJFID0gICAgMHg0NTRDCiAgICAgICAgfQoKICAgICAgICAkSW1hZ2VEb3NIZWFkZXIgPSBzdHJ1Y3QgJE1vZCBQRS5JTUFHRV9ET1NfSEVBREVSIEB7CiAgICAgICAgICAgIGVfbWFnaWMgPSAgICBmaWVsZCAwICRJbWFnZURvc1NpZ25hdHVyZQogICAgICAgICAgICBlX2NibHAgPSAgICAgZmllbGQgMSBVSW50MTYKICAgICAgICAgICAgZV9jcCA9ICAgICAgIGZpZWxkIDIgVUludDE2CiAgICAgICAgICAgIGVfY3JsYyA9ICAgICBmaWVsZCAzIFVJbnQxNgogICAgICAgICAgICBlX2NwYXJoZHIgPSAgZmllbGQgNCBVSW50MTYKICAgICAgICAgICAgZV9taW5hbGxvYyA9IGZpZWxkIDUgVUludDE2CiAgICAgICAgICAgIGVfbWF4YWxsb2MgPSBmaWVsZCA2IFVJbnQxNgogICAgICAgICAgICBlX3NzID0gICAgICAgZmllbGQgNyBVSW50MTYKICAgICAgICAgICAgZV9zcCA9ICAgICAgIGZpZWxkIDggVUludDE2CiAgICAgICAgICAgIGVfY3N1bSA9ICAgICBmaWVsZCA5IFVJbnQxNgogICAgICAgICAgICBlX2lwID0gICAgICAgZmllbGQgMTAgVUludDE2CiAgICAgICAgICAgIGVfY3MgPSAgICAgICBmaWVsZCAxMSBVSW50MTYKICAgICAgICAgICAgZV9sZmFybGMgPSAgIGZpZWxkIDEyIFVJbnQxNgogICAgICAgICAgICBlX292bm8gPSAgICAgZmllbGQgMTMgVUludDE2CiAgICAgICAgICAgIGVfcmVzID0gICAgICBmaWVsZCAxNCBVSW50MTZbXSAtTWFyc2hhbEFzIEAoJ0J5VmFsQXJyYXknLCA0KQogICAgICAgICAgICBlX29lbWlkID0gICAgZmllbGQgMTUgVUludDE2CiAgICAgICAgICAgIGVfb2VtaW5mbyA9ICBmaWVsZCAxNiBVSW50MTYKICAgICAgICAgICAgZV9yZXMyID0gICAgIGZpZWxkIDE3IFVJbnQxNltdIC1NYXJzaGFsQXMgQCgnQnlWYWxBcnJheScsIDEwKQogICAgICAgICAgICBlX2xmYW5ldyA9ICAgZmllbGQgMTggSW50MzIKICAgICAgICB9CgogICAgICAgICMgRXhhbXBsZSBvZiB1c2luZyBhbiBleHBsaWNpdCBsYXlvdXQgaW4gb3JkZXIgdG8gY3JlYXRlIGEgdW5pb24uCiAgICAgICAgJFRlc3RVbmlvbiA9IHN0cnVjdCAkTW9kIFRlc3RVbmlvbiBAewogICAgICAgICAgICBmaWVsZDEgPSBmaWVsZCAwIFVJbnQzMiAwCiAgICAgICAgICAgIGZpZWxkMiA9IGZpZWxkIDEgSW50UHRyIDAKICAgICAgICB9IC1FeHBsaWNpdExheW91dAoKICAgIC5OT1RFUwoKICAgICAgICBQb3dlclNoZWxsIHB1cmlzdHMgbWF5IGRpc2FncmVlIHdpdGggdGhlIG5hbWluZyBvZiB0aGlzIGZ1bmN0aW9uIGJ1dAogICAgICAgIGFnYWluLCB0aGlzIHdhcyBkZXZlbG9wZWQgaW4gc3VjaCBhIHdheSBzbyBhcyB0byBlbXVsYXRlIGEgIkMgc3R5bGUiCiAgICAgICAgZGVmaW5pdGlvbiBhcyBjbG9zZWx5IGFzIHBvc3NpYmxlLiBTb3JyeSwgSSdtIG5vdCBnb2luZyB0byBuYW1lIGl0CiAgICAgICAgTmV3LVN0cnVjdC4gOlAKIz4KCiAgICBbT3V0cHV0VHlwZShbVHlwZV0pXQogICAgUGFyYW0KICAgICgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMSwgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7KCRfIC1pcyBbUmVmbGVjdGlvbi5FbWl0Lk1vZHVsZUJ1aWxkZXJdKSAtb3IgKCRfIC1pcyBbUmVmbGVjdGlvbi5Bc3NlbWJseV0pfSldCiAgICAgICAgJE1vZHVsZSwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDIsIE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZ1bGxOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMywgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW0hhc2h0YWJsZV0KICAgICAgICAkU3RydWN0RmllbGRzLAoKICAgICAgICBbUmVmbGVjdGlvbi5FbWl0LlBhY2tpbmdTaXplXQogICAgICAgICRQYWNraW5nU2l6ZSA9IFtSZWZsZWN0aW9uLkVtaXQuUGFja2luZ1NpemVdOjpVbnNwZWNpZmllZCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRXhwbGljaXRMYXlvdXQKICAgICkKCiAgICBpZiAoJE1vZHVsZSAtaXMgW1JlZmxlY3Rpb24uQXNzZW1ibHldKQogICAgewogICAgICAgIHJldHVybiAoJE1vZHVsZS5HZXRUeXBlKCRGdWxsTmFtZSkpCiAgICB9CgogICAgW1JlZmxlY3Rpb24uVHlwZUF0dHJpYnV0ZXNdICRTdHJ1Y3RBdHRyaWJ1dGVzID0gJ0Fuc2lDbGFzcywKICAgICAgICBDbGFzcywKICAgICAgICBQdWJsaWMsCiAgICAgICAgU2VhbGVkLAogICAgICAgIEJlZm9yZUZpZWxkSW5pdCcKCiAgICBpZiAoJEV4cGxpY2l0TGF5b3V0KQogICAgewogICAgICAgICRTdHJ1Y3RBdHRyaWJ1dGVzID0gJFN0cnVjdEF0dHJpYnV0ZXMgLWJvciBbUmVmbGVjdGlvbi5UeXBlQXR0cmlidXRlc106OkV4cGxpY2l0TGF5b3V0CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgJFN0cnVjdEF0dHJpYnV0ZXMgPSAkU3RydWN0QXR0cmlidXRlcyAtYm9yIFtSZWZsZWN0aW9uLlR5cGVBdHRyaWJ1dGVzXTo6U2VxdWVudGlhbExheW91dAogICAgfQoKICAgICRTdHJ1Y3RCdWlsZGVyID0gJE1vZHVsZS5EZWZpbmVUeXBlKCRGdWxsTmFtZSwgJFN0cnVjdEF0dHJpYnV0ZXMsIFtWYWx1ZVR5cGVdLCAkUGFja2luZ1NpemUpCiAgICAkQ29uc3RydWN0b3JJbmZvID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxBc0F0dHJpYnV0ZV0uR2V0Q29uc3RydWN0b3JzKClbMF0KICAgICRTaXplQ29uc3QgPSBAKFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsQXNBdHRyaWJ1dGVdLkdldEZpZWxkKCdTaXplQ29uc3QnKSkKCiAgICAkRmllbGRzID0gTmV3LU9iamVjdCBIYXNodGFibGVbXSgkU3RydWN0RmllbGRzLkNvdW50KQoKICAgICMgU29ydCBlYWNoIGZpZWxkIGFjY29yZGluZyB0byB0aGUgb3JkZXJzIHNwZWNpZmllZAogICAgIyBVbmZvcnR1bmF0ZWx5LCBQU3YyIGRvZXNuJ3QgaGF2ZSB0aGUgbHV4dXJ5IG9mIHRoZQogICAgIyBoYXNodGFibGUgW09yZGVyZWRdIGFjY2VsZXJhdG9yLgogICAgRm9yRWFjaCAoJEZpZWxkIGluICRTdHJ1Y3RGaWVsZHMuS2V5cykKICAgIHsKICAgICAgICAkSW5kZXggPSAkU3RydWN0RmllbGRzWyRGaWVsZF1bJ1Bvc2l0aW9uJ10KICAgICAgICAkRmllbGRzWyRJbmRleF0gPSBAe0ZpZWxkTmFtZSA9ICRGaWVsZDsgUHJvcGVydGllcyA9ICRTdHJ1Y3RGaWVsZHNbJEZpZWxkXX0KICAgIH0KCiAgICBGb3JFYWNoICgkRmllbGQgaW4gJEZpZWxkcykKICAgIHsKICAgICAgICAkRmllbGROYW1lID0gJEZpZWxkWydGaWVsZE5hbWUnXQogICAgICAgICRGaWVsZFByb3AgPSAkRmllbGRbJ1Byb3BlcnRpZXMnXQoKICAgICAgICAkT2Zmc2V0ID0gJEZpZWxkUHJvcFsnT2Zmc2V0J10KICAgICAgICAkVHlwZSA9ICRGaWVsZFByb3BbJ1R5cGUnXQogICAgICAgICRNYXJzaGFsQXMgPSAkRmllbGRQcm9wWydNYXJzaGFsQXMnXQoKICAgICAgICAkTmV3RmllbGQgPSAkU3RydWN0QnVpbGRlci5EZWZpbmVGaWVsZCgkRmllbGROYW1lLCAkVHlwZSwgJ1B1YmxpYycpCgogICAgICAgIGlmICgkTWFyc2hhbEFzKQogICAgICAgIHsKICAgICAgICAgICAgJFVubWFuYWdlZFR5cGUgPSAkTWFyc2hhbEFzWzBdIC1hcyAoW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLlVubWFuYWdlZFR5cGVdKQogICAgICAgICAgICBpZiAoJE1hcnNoYWxBc1sxXSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJFNpemUgPSAkTWFyc2hhbEFzWzFdCiAgICAgICAgICAgICAgICAkQXR0cmliQnVpbGRlciA9IE5ldy1PYmplY3QgUmVmbGVjdGlvbi5FbWl0LkN1c3RvbUF0dHJpYnV0ZUJ1aWxkZXIoJENvbnN0cnVjdG9ySW5mbywKICAgICAgICAgICAgICAgICAgICAkVW5tYW5hZ2VkVHlwZSwgJFNpemVDb25zdCwgQCgkU2l6ZSkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkQXR0cmliQnVpbGRlciA9IE5ldy1PYmplY3QgUmVmbGVjdGlvbi5FbWl0LkN1c3RvbUF0dHJpYnV0ZUJ1aWxkZXIoJENvbnN0cnVjdG9ySW5mbywgW09iamVjdFtdXSBAKCRVbm1hbmFnZWRUeXBlKSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE5ld0ZpZWxkLlNldEN1c3RvbUF0dHJpYnV0ZSgkQXR0cmliQnVpbGRlcikKICAgICAgICB9CgogICAgICAgIGlmICgkRXhwbGljaXRMYXlvdXQpIHsgJE5ld0ZpZWxkLlNldE9mZnNldCgkT2Zmc2V0KSB9CiAgICB9CgogICAgIyBNYWtlIHRoZSBzdHJ1Y3QgYXdhcmUgb2YgaXRzIG93biBzaXplLgogICAgIyBObyBtb3JlIGhhdmluZyB0byBjYWxsIFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6U2l6ZU9mIQogICAgJFNpemVNZXRob2QgPSAkU3RydWN0QnVpbGRlci5EZWZpbmVNZXRob2QoJ0dldFNpemUnLAogICAgICAgICdQdWJsaWMsIFN0YXRpYycsCiAgICAgICAgW0ludF0sCiAgICAgICAgW1R5cGVbXV0gQCgpKQogICAgJElMR2VuZXJhdG9yID0gJFNpemVNZXRob2QuR2V0SUxHZW5lcmF0b3IoKQogICAgIyBUaGFua3MgZm9yIHRoZSBoZWxwLCBKYXNvbiBTaGlyayEKICAgICRJTEdlbmVyYXRvci5FbWl0KFtSZWZsZWN0aW9uLkVtaXQuT3BDb2Rlc106OkxkdG9rZW4sICRTdHJ1Y3RCdWlsZGVyKQogICAgJElMR2VuZXJhdG9yLkVtaXQoW1JlZmxlY3Rpb24uRW1pdC5PcENvZGVzXTo6Q2FsbCwKICAgICAgICBbVHlwZV0uR2V0TWV0aG9kKCdHZXRUeXBlRnJvbUhhbmRsZScpKQogICAgJElMR2VuZXJhdG9yLkVtaXQoW1JlZmxlY3Rpb24uRW1pdC5PcENvZGVzXTo6Q2FsbCwKICAgICAgICBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF0uR2V0TWV0aG9kKCdTaXplT2YnLCBbVHlwZVtdXSBAKFtUeXBlXSkpKQogICAgJElMR2VuZXJhdG9yLkVtaXQoW1JlZmxlY3Rpb24uRW1pdC5PcENvZGVzXTo6UmV0KQoKICAgICMgQWxsb3cgZm9yIGV4cGxpY2l0IGNhc3RpbmcgZnJvbSBhbiBJbnRQdHIKICAgICMgTm8gbW9yZSBoYXZpbmcgdG8gY2FsbCBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlB0clRvU3RydWN0dXJlIQogICAgJEltcGxpY2l0Q29udmVydGVyID0gJFN0cnVjdEJ1aWxkZXIuRGVmaW5lTWV0aG9kKCdvcF9JbXBsaWNpdCcsCiAgICAgICAgJ1ByaXZhdGVTY29wZSwgUHVibGljLCBTdGF0aWMsIEhpZGVCeVNpZywgU3BlY2lhbE5hbWUnLAogICAgICAgICRTdHJ1Y3RCdWlsZGVyLAogICAgICAgIFtUeXBlW11dIEAoW0ludFB0cl0pKQogICAgJElMR2VuZXJhdG9yMiA9ICRJbXBsaWNpdENvbnZlcnRlci5HZXRJTEdlbmVyYXRvcigpCiAgICAkSUxHZW5lcmF0b3IyLkVtaXQoW1JlZmxlY3Rpb24uRW1pdC5PcENvZGVzXTo6Tm9wKQogICAgJElMR2VuZXJhdG9yMi5FbWl0KFtSZWZsZWN0aW9uLkVtaXQuT3BDb2Rlc106OkxkYXJnXzApCiAgICAkSUxHZW5lcmF0b3IyLkVtaXQoW1JlZmxlY3Rpb24uRW1pdC5PcENvZGVzXTo6TGR0b2tlbiwgJFN0cnVjdEJ1aWxkZXIpCiAgICAkSUxHZW5lcmF0b3IyLkVtaXQoW1JlZmxlY3Rpb24uRW1pdC5PcENvZGVzXTo6Q2FsbCwKICAgICAgICBbVHlwZV0uR2V0TWV0aG9kKCdHZXRUeXBlRnJvbUhhbmRsZScpKQogICAgJElMR2VuZXJhdG9yMi5FbWl0KFtSZWZsZWN0aW9uLkVtaXQuT3BDb2Rlc106OkNhbGwsCiAgICAgICAgW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdLkdldE1ldGhvZCgnUHRyVG9TdHJ1Y3R1cmUnLCBbVHlwZVtdXSBAKFtJbnRQdHJdLCBbVHlwZV0pKSkKICAgICRJTEdlbmVyYXRvcjIuRW1pdChbUmVmbGVjdGlvbi5FbWl0Lk9wQ29kZXNdOjpVbmJveF9BbnksICRTdHJ1Y3RCdWlsZGVyKQogICAgJElMR2VuZXJhdG9yMi5FbWl0KFtSZWZsZWN0aW9uLkVtaXQuT3BDb2Rlc106OlJldCkKCiAgICAkU3RydWN0QnVpbGRlci5DcmVhdGVUeXBlKCkKfQoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMKIyBNaXNjLiBoZWxwZXJzCiMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmZpbHRlciBHZXQtSW5pQ29udGVudCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBoZWxwZXIgcGFyc2VzIGFuIC5pbmkgZmlsZSBpbnRvIGEgcHJvcGVyIFBvd2VyU2hlbGwgb2JqZWN0LgoKICAgICAgICBBdXRob3I6ICdUaGUgU2NyaXB0aW5nIEd1eXMnCiAgICAgICAgTGluazogaHR0cHM6Ly9ibG9ncy50ZWNobmV0Lm1pY3Jvc29mdC5jb20vaGV5c2NyaXB0aW5nZ3V5LzIwMTEvMDgvMjAvdXNlLXBvd2Vyc2hlbGwtdG8td29yay13aXRoLWFueS1pbmktZmlsZS8KCiAgICAuTElOSwoKICAgICAgICBodHRwczovL2Jsb2dzLnRlY2huZXQubWljcm9zb2Z0LmNvbS9oZXlzY3JpcHRpbmdndXkvMjAxMS8wOC8yMC91c2UtcG93ZXJzaGVsbC10by13b3JrLXdpdGgtYW55LWluaS1maWxlLwojPgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdGdWxsTmFtZScpXQogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7IFRlc3QtUGF0aCAtUGF0aCAkXyB9KV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJFBhdGgKICAgICkKCiAgICBGb3JFYWNoKCRUYXJnZXRQYXRoIGluICRQYXRoKSB7CiAgICAgICAgJEluaU9iamVjdCA9IEB7fQogICAgICAgIFN3aXRjaCAtUmVnZXggLUZpbGUgJFRhcmdldFBhdGggewogICAgICAgICAgICAiXlxbKC4rKVxdIiAjIFNlY3Rpb24KICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJFNlY3Rpb24gPSAkbWF0Y2hlc1sxXS5UcmltKCkKICAgICAgICAgICAgICAgICRJbmlPYmplY3RbJFNlY3Rpb25dID0gQHt9CiAgICAgICAgICAgICAgICAkQ29tbWVudENvdW50ID0gMAogICAgICAgICAgICB9CiAgICAgICAgICAgICJeKDsuKikkIiAjIENvbW1lbnQKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJFZhbHVlID0gJG1hdGNoZXNbMV0uVHJpbSgpCiAgICAgICAgICAgICAgICAkQ29tbWVudENvdW50ID0gJENvbW1lbnRDb3VudCArIDEKICAgICAgICAgICAgICAgICROYW1lID0gJ0NvbW1lbnQnICsgJENvbW1lbnRDb3VudAogICAgICAgICAgICAgICAgJEluaU9iamVjdFskU2VjdGlvbl1bJE5hbWVdID0gJFZhbHVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgIiguKz8pXHMqPSguKikiICMgS2V5CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICROYW1lLCAkVmFsdWUgPSAkbWF0Y2hlc1sxLi4yXQogICAgICAgICAgICAgICAgJE5hbWUgPSAkTmFtZS5UcmltKCkKICAgICAgICAgICAgICAgICRWYWx1ZXMgPSAkVmFsdWUuc3BsaXQoJywnKSB8IEZvckVhY2gtT2JqZWN0IHskXy5UcmltKCl9CiAgICAgICAgICAgICAgICBpZigkVmFsdWVzIC1pc25vdCBbU3lzdGVtLkFycmF5XSkgeyRWYWx1ZXMgPSBAKCRWYWx1ZXMpfQogICAgICAgICAgICAgICAgJEluaU9iamVjdFskU2VjdGlvbl1bJE5hbWVdID0gJFZhbHVlcwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRJbmlPYmplY3QKICAgIH0KfQoKZmlsdGVyIEV4cG9ydC1Qb3dlclZpZXdDU1Ygewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFRoaXMgaGVscGVyIGV4cG9ydHMgYW4gLUlucHV0T2JqZWN0IHRvIGEgLmNzdiBpbiBhIHRocmVhZC1zYWZlIG1hbm5lcgogICAgICAgIHVzaW5nIGEgbXV0ZXguIFRoaXMgaXMgc28gdGhlIHZhcmlvdXMgbXVsdGktdGhyZWFkZWQgZnVuY3Rpb25zIGluCiAgICAgICAgUG93ZXJWaWV3IGhhcyBhIHRocmVhZC1zYWZlIHdheSB0byBleHBvcnQgb3V0cHV0IHRvIHRoZSBzYW1lIGZpbGUuCgogICAgICAgIEJhc2VkIHBhcnRpYWxseSBvbiBEbWl0cnkgU290bmlrb3YncyBFeHBvcnQtQ1NWIGNvZGUKICAgICAgICAgICAgYXQgaHR0cDovL3Bvc2hjb2RlLm9yZy8xNTkwCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL3Bvc2hjb2RlLm9yZy8xNTkwCiAgICAgICAgaHR0cDovL2RtaXRyeXNvdG5pa292LndvcmRwcmVzcy5jb20vMjAxMC8wMS8xOS9FeHBvcnQtQ3N2LWFwcGVuZC8KIz4KICAgIFBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZT0kVHJ1ZSldCiAgICAgICAgW1N5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNPYmplY3RbXV0KICAgICAgICAkSW5wdXRPYmplY3QsCgogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBQb3NpdGlvbj0wKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJE91dEZpbGUKICAgICkKCiAgICAkT2JqZWN0Q1NWID0gJElucHV0T2JqZWN0IHwgQ29udmVydFRvLUNzdiAtTm9UeXBlSW5mb3JtYXRpb24KCiAgICAjIG11dGV4IHNvIHRocmVhZGVkIGNvZGUgZG9lc24ndCBzdG9tcCBvbiB0aGUgb3V0cHV0IGZpbGUKICAgICRNdXRleCA9IE5ldy1PYmplY3QgU3lzdGVtLlRocmVhZGluZy5NdXRleCAkRmFsc2UsJ0NTVk11dGV4JzsKICAgICROdWxsID0gJE11dGV4LldhaXRPbmUoKQoKICAgIGlmIChUZXN0LVBhdGggLVBhdGggJE91dEZpbGUpIHsKICAgICAgICAjIGhhY2sgdG8gc2tpcCB0aGUgZmlyc3QgbGluZSBvZiBvdXRwdXQgaWYgdGhlIGZpbGUgYWxyZWFkeSBleGlzdHMKICAgICAgICAkT2JqZWN0Q1NWIHwgRm9yRWFjaC1PYmplY3QgeyAkU3RhcnQ9JFRydWUgfXsgaWYgKCRTdGFydCkgeyRTdGFydD0kRmFsc2V9IGVsc2UgeyRffSB9IHwgT3V0LUZpbGUgLUVuY29kaW5nICdBU0NJSScgLUFwcGVuZCAtRmlsZVBhdGggJE91dEZpbGUKICAgIH0KICAgIGVsc2UgewogICAgICAgICRPYmplY3RDU1YgfCBPdXQtRmlsZSAtRW5jb2RpbmcgJ0FTQ0lJJyAtQXBwZW5kIC1GaWxlUGF0aCAkT3V0RmlsZQogICAgfQoKICAgICRNdXRleC5SZWxlYXNlTXV0ZXgoKQp9CgoKZmlsdGVyIEdldC1JUEFkZHJlc3Mgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFJlc29sdmVzIGEgZ2l2ZW4gaG9zdGVuYW1lIHRvIGl0cyBhc3NvY2lhdGVkIElQdjQgYWRkcmVzcy4KICAgICAgICBJZiBubyBob3N0bmFtZSBpcyBwcm92aWRlZCwgaXQgZGVmYXVsdHMgdG8gcmV0dXJuaW5nCiAgICAgICAgdGhlIElQIGFkZHJlc3Mgb2YgdGhlIGxvY2FsaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1JUEFkZHJlc3MgLUNvbXB1dGVyTmFtZSBTRVJWRVIKCiAgICAgICAgUmV0dXJuIHRoZSBJUHY0IGFkZHJlc3Mgb2YgJ1NFUlZFUicKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Db250ZW50IC5caG9zdG5hbWVzLnR4dCB8IEdldC1JUEFkZHJlc3MKCiAgICAgICAgR2V0IHRoZSBJUCBhZGRyZXNzZXMgb2YgYWxsIGhvc3RuYW1lcyBpbiBhbiBpbnB1dCBmaWxlLgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsIFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3ROYW1lJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJEVudjpDb21wdXRlck5hbWUKICAgICkKCiAgICB0cnkgewogICAgICAgICMgZXh0cmFjdCB0aGUgY29tcHV0ZXIgbmFtZSBmcm9tIHdoYXRldmVyIG9iamVjdCB3YXMgcGFzc2VkIG9uIHRoZSBwaXBlbGluZQogICAgICAgICRDb21wdXRlciA9ICRDb21wdXRlck5hbWUgfCBHZXQtTmFtZUZpZWxkCgogICAgICAgICMgZ2V0IHRoZSBJUCByZXNvbHV0aW9uIG9mIHRoaXMgc3BlY2lmaWVkIGhvc3RuYW1lCiAgICAgICAgQCgoW05ldC5EbnNdOjpHZXRIb3N0RW50cnkoJENvbXB1dGVyKSkuQWRkcmVzc0xpc3QpIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICBpZiAoJF8uQWRkcmVzc0ZhbWlseSAtZXEgJ0ludGVyTmV0d29yaycpIHsKICAgICAgICAgICAgICAgICRPdXQgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAkT3V0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyCiAgICAgICAgICAgICAgICAkT3V0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lQQWRkcmVzcycgJF8uSVBBZGRyZXNzVG9TdHJpbmcKICAgICAgICAgICAgICAgICRPdXQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGNhdGNoIHsKICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICdDb3VsZCBub3QgcmVzb2x2ZSBob3N0IHRvIGFuIElQIEFkZHJlc3MuJwogICAgfQp9CgoKZmlsdGVyIENvbnZlcnQtTmFtZVRvU2lkIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBDb252ZXJ0cyBhIGdpdmVuIHVzZXIvZ3JvdXAgbmFtZSB0byBhIHNlY3VyaXR5IGlkZW50aWZpZXIgKFNJRCkuCgogICAgLlBBUkFNRVRFUiBPYmplY3ROYW1lCgogICAgICAgIFRoZSB1c2VyL2dyb3VwIG5hbWUgdG8gY29udmVydCwgY2FuIGJlICd1c2VyJyBvciAnRE9NQUlOXHVzZXInIGZvcm1hdC4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBTcGVjaWZpYyBkb21haW4gZm9yIHRoZSBnaXZlbiB1c2VyIGFjY291bnQsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IENvbnZlcnQtTmFtZVRvU2lkICdERVZcZGZtJwojPgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbQWxpYXMoJ05hbWUnKV0KICAgICAgICAkT2JqZWN0TmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluCiAgICApCgogICAgJE9iamVjdE5hbWUgPSAkT2JqZWN0TmFtZSAtUmVwbGFjZSAiLyIsIlwiCgogICAgaWYoJE9iamVjdE5hbWUuQ29udGFpbnMoIlwiKSkgewogICAgICAgICMgaWYgd2UgZ2V0IGEgRE9NQUlOXHVzZXIgZm9ybWF0LCBhdXRvIGNvbnZlcnQgaXQKICAgICAgICAkRG9tYWluID0gJE9iamVjdE5hbWUuU3BsaXQoIlwiKVswXQogICAgICAgICRPYmplY3ROYW1lID0gJE9iamVjdE5hbWUuU3BsaXQoIlwiKVsxXQogICAgfQogICAgZWxzZWlmKC1ub3QgJERvbWFpbikgewogICAgICAgICREb21haW4gPSAoR2V0LU5ldERvbWFpbikuTmFtZQogICAgfQoKICAgIHRyeSB7CiAgICAgICAgJE9iaiA9IChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuTlRBY2NvdW50KCREb21haW4sICRPYmplY3ROYW1lKSkKICAgICAgICAkU0lEID0gJE9iai5UcmFuc2xhdGUoW1N5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyXSkuVmFsdWUKCiAgICAgICAgJE91dCA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAkT3V0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdE5hbWUnICRPYmplY3ROYW1lCiAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTSUQnICRTSUQKICAgICAgICAkT3V0CiAgICB9CiAgICBjYXRjaCB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiSW52YWxpZCBvYmplY3QvbmFtZTogJERvbWFpblwkT2JqZWN0TmFtZSIKICAgICAgICAkTnVsbAogICAgfQp9CgoKZmlsdGVyIENvbnZlcnQtU2lkVG9OYW1lIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBDb252ZXJ0cyBhIHNlY3VyaXR5IGlkZW50aWZpZXIgKFNJRCkgdG8gYSBncm91cC91c2VyIG5hbWUuCgogICAgLlBBUkFNRVRFUiBTSUQKCiAgICAgICAgVGhlIFNJRCB0byBjb252ZXJ0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gQ29udmVydC1TaWRUb05hbWUgUy0xLTUtMjEtMjYyMDg5MTgyOS0yNDExMjYxNDk3LTE3NzM4NTMwODgtMTEwNQojPgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVQYXR0ZXJuKCdeUy0xLS4qJyldCiAgICAgICAgJFNJRAogICAgKQoKICAgIHRyeSB7CiAgICAgICAgJFNJRDIgPSAkU0lELnRyaW0oJyonKQoKICAgICAgICAjIHRyeSB0byByZXNvbHZlIGFueSBidWlsdC1pbiBTSURzIGZpcnN0CiAgICAgICAgIyAgIGZyb20gaHR0cHM6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20vZW4tdXMva2IvMjQzMzMwCiAgICAgICAgU3dpdGNoICgkU0lEMikgewogICAgICAgICAgICAnUy0xLTAnICAgICAgICAgeyAnTnVsbCBBdXRob3JpdHknIH0KICAgICAgICAgICAgJ1MtMS0wLTAnICAgICAgIHsgJ05vYm9keScgfQogICAgICAgICAgICAnUy0xLTEnICAgICAgICAgeyAnV29ybGQgQXV0aG9yaXR5JyB9CiAgICAgICAgICAgICdTLTEtMS0wJyAgICAgICB7ICdFdmVyeW9uZScgfQogICAgICAgICAgICAnUy0xLTInICAgICAgICAgeyAnTG9jYWwgQXV0aG9yaXR5JyB9CiAgICAgICAgICAgICdTLTEtMi0wJyAgICAgICB7ICdMb2NhbCcgfQogICAgICAgICAgICAnUy0xLTItMScgICAgICAgeyAnQ29uc29sZSBMb2dvbiAnIH0KICAgICAgICAgICAgJ1MtMS0zJyAgICAgICAgIHsgJ0NyZWF0b3IgQXV0aG9yaXR5JyB9CiAgICAgICAgICAgICdTLTEtMy0wJyAgICAgICB7ICdDcmVhdG9yIE93bmVyJyB9CiAgICAgICAgICAgICdTLTEtMy0xJyAgICAgICB7ICdDcmVhdG9yIEdyb3VwJyB9CiAgICAgICAgICAgICdTLTEtMy0yJyAgICAgICB7ICdDcmVhdG9yIE93bmVyIFNlcnZlcicgfQogICAgICAgICAgICAnUy0xLTMtMycgICAgICAgeyAnQ3JlYXRvciBHcm91cCBTZXJ2ZXInIH0KICAgICAgICAgICAgJ1MtMS0zLTQnICAgICAgIHsgJ093bmVyIFJpZ2h0cycgfQogICAgICAgICAgICAnUy0xLTQnICAgICAgICAgeyAnTm9uLXVuaXF1ZSBBdXRob3JpdHknIH0KICAgICAgICAgICAgJ1MtMS01JyAgICAgICAgIHsgJ05UIEF1dGhvcml0eScgfQogICAgICAgICAgICAnUy0xLTUtMScgICAgICAgeyAnRGlhbHVwJyB9CiAgICAgICAgICAgICdTLTEtNS0yJyAgICAgICB7ICdOZXR3b3JrJyB9CiAgICAgICAgICAgICdTLTEtNS0zJyAgICAgICB7ICdCYXRjaCcgfQogICAgICAgICAgICAnUy0xLTUtNCcgICAgICAgeyAnSW50ZXJhY3RpdmUnIH0KICAgICAgICAgICAgJ1MtMS01LTYnICAgICAgIHsgJ1NlcnZpY2UnIH0KICAgICAgICAgICAgJ1MtMS01LTcnICAgICAgIHsgJ0Fub255bW91cycgfQogICAgICAgICAgICAnUy0xLTUtOCcgICAgICAgeyAnUHJveHknIH0KICAgICAgICAgICAgJ1MtMS01LTknICAgICAgIHsgJ0VudGVycHJpc2UgRG9tYWluIENvbnRyb2xsZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0xMCcgICAgICB7ICdQcmluY2lwYWwgU2VsZicgfQogICAgICAgICAgICAnUy0xLTUtMTEnICAgICAgeyAnQXV0aGVudGljYXRlZCBVc2VycycgfQogICAgICAgICAgICAnUy0xLTUtMTInICAgICAgeyAnUmVzdHJpY3RlZCBDb2RlJyB9CiAgICAgICAgICAgICdTLTEtNS0xMycgICAgICB7ICdUZXJtaW5hbCBTZXJ2ZXIgVXNlcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTE0JyAgICAgIHsgJ1JlbW90ZSBJbnRlcmFjdGl2ZSBMb2dvbicgfQogICAgICAgICAgICAnUy0xLTUtMTUnICAgICAgeyAnVGhpcyBPcmdhbml6YXRpb24gJyB9CiAgICAgICAgICAgICdTLTEtNS0xNycgICAgICB7ICdUaGlzIE9yZ2FuaXphdGlvbiAnIH0KICAgICAgICAgICAgJ1MtMS01LTE4JyAgICAgIHsgJ0xvY2FsIFN5c3RlbScgfQogICAgICAgICAgICAnUy0xLTUtMTknICAgICAgeyAnTlQgQXV0aG9yaXR5JyB9CiAgICAgICAgICAgICdTLTEtNS0yMCcgICAgICB7ICdOVCBBdXRob3JpdHknIH0KICAgICAgICAgICAgJ1MtMS01LTgwLTAnICAgIHsgJ0FsbCBTZXJ2aWNlcyAnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU0NCcgIHsgJ0JVSUxUSU5cQWRtaW5pc3RyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU0NScgIHsgJ0JVSUxUSU5cVXNlcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU0NicgIHsgJ0JVSUxUSU5cR3Vlc3RzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NDcnICB7ICdCVUlMVElOXFBvd2VyIFVzZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NDgnICB7ICdCVUlMVElOXEFjY291bnQgT3BlcmF0b3JzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NDknICB7ICdCVUlMVElOXFNlcnZlciBPcGVyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU1MCcgIHsgJ0JVSUxUSU5cUHJpbnQgT3BlcmF0b3JzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NTEnICB7ICdCVUlMVElOXEJhY2t1cCBPcGVyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU1MicgIHsgJ0JVSUxUSU5cUmVwbGljYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU1NCcgIHsgJ0JVSUxUSU5cUHJlLVdpbmRvd3MgMjAwMCBDb21wYXRpYmxlIEFjY2VzcycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTU1JyAgeyAnQlVJTFRJTlxSZW1vdGUgRGVza3RvcCBVc2VycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTU2JyAgeyAnQlVJTFRJTlxOZXR3b3JrIENvbmZpZ3VyYXRpb24gT3BlcmF0b3JzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NTcnICB7ICdCVUlMVElOXEluY29taW5nIEZvcmVzdCBUcnVzdCBCdWlsZGVycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTU4JyAgeyAnQlVJTFRJTlxQZXJmb3JtYW5jZSBNb25pdG9yIFVzZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NTknICB7ICdCVUlMVElOXFBlcmZvcm1hbmNlIExvZyBVc2VycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTYwJyAgeyAnQlVJTFRJTlxXaW5kb3dzIEF1dGhvcml6YXRpb24gQWNjZXNzIEdyb3VwJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NjEnICB7ICdCVUlMVElOXFRlcm1pbmFsIFNlcnZlciBMaWNlbnNlIFNlcnZlcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU2MicgIHsgJ0JVSUxUSU5cRGlzdHJpYnV0ZWQgQ09NIFVzZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NjknICB7ICdCVUlMVElOXENyeXB0b2dyYXBoaWMgT3BlcmF0b3JzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NzMnICB7ICdCVUlMVElOXEV2ZW50IExvZyBSZWFkZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NzQnICB7ICdCVUlMVElOXENlcnRpZmljYXRlIFNlcnZpY2UgRENPTSBBY2Nlc3MnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU3NScgIHsgJ0JVSUxUSU5cUkRTIFJlbW90ZSBBY2Nlc3MgU2VydmVycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTc2JyAgeyAnQlVJTFRJTlxSRFMgRW5kcG9pbnQgU2VydmVycycgfQogICAgICAgICAgICAnUy0xLTUtMzItNTc3JyAgeyAnQlVJTFRJTlxSRFMgTWFuYWdlbWVudCBTZXJ2ZXJzJyB9CiAgICAgICAgICAgICdTLTEtNS0zMi01NzgnICB7ICdCVUlMVElOXEh5cGVyLVYgQWRtaW5pc3RyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU3OScgIHsgJ0JVSUxUSU5cQWNjZXNzIENvbnRyb2wgQXNzaXN0YW5jZSBPcGVyYXRvcnMnIH0KICAgICAgICAgICAgJ1MtMS01LTMyLTU4MCcgIHsgJ0JVSUxUSU5cQWNjZXNzIENvbnRyb2wgQXNzaXN0YW5jZSBPcGVyYXRvcnMnIH0KICAgICAgICAgICAgRGVmYXVsdCB7CiAgICAgICAgICAgICAgICAkT2JqID0gKE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXIoJFNJRDIpKQogICAgICAgICAgICAgICAgJE9iai5UcmFuc2xhdGUoIFtTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLk5UQWNjb3VudF0pLlZhbHVlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBjYXRjaCB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiSW52YWxpZCBTSUQ6ICRTSUQiCiAgICAgICAgJFNJRAogICAgfQp9CgoKZmlsdGVyIENvbnZlcnQtQUROYW1lIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBDb252ZXJ0cyB1c2VyL2dyb3VwIG5hbWVzIGZyb20gTlQ0IChET01BSU5cdXNlcikgb3IgZG9tYWluU2ltcGxlICh1c2VyQGRvbWFpbi5jb20pCiAgICAgICAgdG8gY2Fub25pY2FsIGZvcm1hdCAoZG9tYWluLmNvbS9Vc2Vycy91c2VyKSBvciBOVDQuCgogICAgICAgIEJhc2VkIG9uIEJpbGwgU3Rld2FydCdzIGNvZGUgZnJvbSB0aGlzIGFydGljbGU6CiAgICAgICAgICAgIGh0dHA6Ly93aW5kb3dzaXRwcm8uY29tL2FjdGl2ZS1kaXJlY3RvcnkvdHJhbnNsYXRpbmctYWN0aXZlLWRpcmVjdG9yeS1vYmplY3QtbmFtZXMtYmV0d2Vlbi1mb3JtYXRzCgogICAgLlBBUkFNRVRFUiBPYmplY3ROYW1lCgogICAgICAgIFRoZSB1c2VyL2dyb3VwIG5hbWUgdG8gY29udmVydC4KCiAgICAuUEFSQU1FVEVSIElucHV0VHlwZQoKICAgICAgICBUaGUgSW5wdXRUeXBlIG9mIHRoZSB1c2VyL2dyb3VwIG5hbWUgKCJOVDQiLCJTaW1wbGUiLCJDYW5vbmljYWwiKS4KCiAgICAuUEFSQU1FVEVSIE91dHB1dFR5cGUKCiAgICAgICAgVGhlIE91dHB1dFR5cGUgb2YgdGhlIHVzZXIvZ3JvdXAgbmFtZSAoIk5UNCIsIlNpbXBsZSIsIkNhbm9uaWNhbCIpLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gQ29udmVydC1BRE5hbWUgLU9iamVjdE5hbWUgImRldlxkZm0iCgogICAgICAgIFJldHVybnMgImRldi50ZXN0bGFiLmxvY2FsL1VzZXJzL0RhdmUiCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBDb252ZXJ0LVNpZFRvTmFtZSAiUy0uLi4iIHwgQ29udmVydC1BRE5hbWUKCiAgICAgICAgUmV0dXJucyB0aGUgY2Fub25pY2FsIG5hbWUgZm9yIHRoZSByZXNvbHZlZCBTSUQuCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL3dpbmRvd3NpdHByby5jb20vYWN0aXZlLWRpcmVjdG9yeS90cmFuc2xhdGluZy1hY3RpdmUtZGlyZWN0b3J5LW9iamVjdC1uYW1lcy1iZXR3ZWVuLWZvcm1hdHMKIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE9iamVjdE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlU2V0KCJOVDQiLCJTaW1wbGUiLCJDYW5vbmljYWwiKV0KICAgICAgICAkSW5wdXRUeXBlLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZVNldCgiTlQ0IiwiU2ltcGxlIiwiQ2Fub25pY2FsIildCiAgICAgICAgJE91dHB1dFR5cGUKICAgICkKCiAgICAkTmFtZVR5cGVzID0gQHsKICAgICAgICAnQ2Fub25pY2FsJyA9IDIKICAgICAgICAnTlQ0JyAgICAgICA9IDMKICAgICAgICAnU2ltcGxlJyAgICA9IDUKICAgIH0KCiAgICBpZigtbm90ICRQU0JvdW5kUGFyYW1ldGVyc1snSW5wdXRUeXBlJ10pIHsKICAgICAgICBpZiggKCRPYmplY3ROYW1lLnNwbGl0KCcvJykpLkNvdW50IC1lcSAyICkgewogICAgICAgICAgICAkT2JqZWN0TmFtZSA9ICRPYmplY3ROYW1lLnJlcGxhY2UoJy8nLCAnXCcpCiAgICAgICAgfQoKICAgICAgICBpZigkT2JqZWN0TmFtZSAtbWF0Y2ggIl5bQS1aYS16XStcXFtBLVphLXogXSsiKSB7CiAgICAgICAgICAgICRJbnB1dFR5cGUgPSAnTlQ0JwogICAgICAgIH0KICAgICAgICBlbHNlaWYoJE9iamVjdE5hbWUgLW1hdGNoICJeW0EtWmEteiBdK0BbQS1aYS16XC5dKyIpIHsKICAgICAgICAgICAgJElucHV0VHlwZSA9ICdTaW1wbGUnCiAgICAgICAgfQogICAgICAgIGVsc2VpZigkT2JqZWN0TmFtZSAtbWF0Y2ggIl5bQS1aYS16XC5dKy9bQS1aYS16XSsvW0EtWmEtei8gXSsiKSB7CiAgICAgICAgICAgICRJbnB1dFR5cGUgPSAnQ2Fub25pY2FsJwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiQ2FuIG5vdCBpZGVudGlmeSBJblR5cGUgZm9yICRPYmplY3ROYW1lIgogICAgICAgICAgICByZXR1cm4gJE9iamVjdE5hbWUKICAgICAgICB9CiAgICB9CiAgICBlbHNlaWYoJElucHV0VHlwZSAtZXEgJ05UNCcpIHsKICAgICAgICAkT2JqZWN0TmFtZSA9ICRPYmplY3ROYW1lLnJlcGxhY2UoJy8nLCAnXCcpCiAgICB9CgogICAgaWYoLW5vdCAkUFNCb3VuZFBhcmFtZXRlcnNbJ091dHB1dFR5cGUnXSkgewogICAgICAgICRPdXRwdXRUeXBlID0gU3dpdGNoKCRJbnB1dFR5cGUpIHsKICAgICAgICAgICAgJ05UNCcgeydDYW5vbmljYWwnfQogICAgICAgICAgICAnU2ltcGxlJyB7J05UNCd9CiAgICAgICAgICAgICdDYW5vbmljYWwnIHsnTlQ0J30KICAgICAgICB9CiAgICB9CgogICAgIyB0cnkgdG8gZXh0cmFjdCB0aGUgZG9tYWluIGZyb20gdGhlIGdpdmVuIGZvcm1hdAogICAgJERvbWFpbiA9IFN3aXRjaCgkSW5wdXRUeXBlKSB7CiAgICAgICAgJ05UNCcgeyAkT2JqZWN0TmFtZS5zcGxpdCgiXCIpWzBdIH0KICAgICAgICAnU2ltcGxlJyB7ICRPYmplY3ROYW1lLnNwbGl0KCJAIilbMV0gfQogICAgICAgICdDYW5vbmljYWwnIHsgJE9iamVjdE5hbWUuc3BsaXQoIi8iKVswXSB9CiAgICB9CgogICAgIyBBY2Nlc3NvciBmdW5jdGlvbnMgdG8gc2ltcGxpZnkgY2FsbHMgdG8gTmFtZVRyYW5zbGF0ZQogICAgZnVuY3Rpb24gSW52b2tlLU1ldGhvZChbX19Db21PYmplY3RdICRPYmplY3QsIFtTdHJpbmddICRNZXRob2QsICRQYXJhbWV0ZXJzKSB7CiAgICAgICAgJE91dHB1dCA9ICRPYmplY3QuR2V0VHlwZSgpLkludm9rZU1lbWJlcigkTWV0aG9kLCAiSW52b2tlTWV0aG9kIiwgJE51bGwsICRPYmplY3QsICRQYXJhbWV0ZXJzKQogICAgICAgIGlmICggJE91dHB1dCApIHsgJE91dHB1dCB9CiAgICB9CiAgICBmdW5jdGlvbiBTZXQtUHJvcGVydHkoW19fQ29tT2JqZWN0XSAkT2JqZWN0LCBbU3RyaW5nXSAkUHJvcGVydHksICRQYXJhbWV0ZXJzKSB7CiAgICAgICAgW1ZvaWRdICRPYmplY3QuR2V0VHlwZSgpLkludm9rZU1lbWJlcigkUHJvcGVydHksICJTZXRQcm9wZXJ0eSIsICROdWxsLCAkT2JqZWN0LCAkUGFyYW1ldGVycykKICAgIH0KCiAgICAkVHJhbnNsYXRlID0gTmV3LU9iamVjdCAtQ29tT2JqZWN0IE5hbWVUcmFuc2xhdGUKCiAgICB0cnkgewogICAgICAgIEludm9rZS1NZXRob2QgJFRyYW5zbGF0ZSAiSW5pdCIgKDEsICREb21haW4pCiAgICB9CiAgICBjYXRjaCBbU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5NZXRob2RJbnZvY2F0aW9uRXhjZXB0aW9uXSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3Igd2l0aCB0cmFuc2xhdGUgaW5pdCBpbiBDb252ZXJ0LUFETmFtZTogJF8iCiAgICB9CgogICAgU2V0LVByb3BlcnR5ICRUcmFuc2xhdGUgIkNoYXNlUmVmZXJyYWwiICgweDYwKQoKICAgIHRyeSB7CiAgICAgICAgSW52b2tlLU1ldGhvZCAkVHJhbnNsYXRlICJTZXQiICgkTmFtZVR5cGVzWyRJbnB1dFR5cGVdLCAkT2JqZWN0TmFtZSkKICAgICAgICAoSW52b2tlLU1ldGhvZCAkVHJhbnNsYXRlICJHZXQiICgkTmFtZVR5cGVzWyRPdXRwdXRUeXBlXSkpCiAgICB9CiAgICBjYXRjaCBbU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5NZXRob2RJbnZvY2F0aW9uRXhjZXB0aW9uXSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3Igd2l0aCB0cmFuc2xhdGUgU2V0L0dldCBpbiBDb252ZXJ0LUFETmFtZTogJF8iCiAgICB9Cn0KCgpmdW5jdGlvbiBDb252ZXJ0RnJvbS1VQUNWYWx1ZSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQ29udmVydHMgYSBVQUMgaW50IHZhbHVlIHRvIGh1bWFuIHJlYWRhYmxlIGZvcm0uCgogICAgLlBBUkFNRVRFUiBWYWx1ZQoKICAgICAgICBUaGUgaW50IFVBQyB2YWx1ZSB0byBjb252ZXJ0LgoKICAgIC5QQVJBTUVURVIgU2hvd0FsbAoKICAgICAgICBTaG93IGFsbCBVQUMgdmFsdWVzLCB3aXRoIGEgKyBpbmRpY2F0aW5nIHRoZSB2YWx1ZSBpcyBjdXJyZW50bHkgc2V0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gQ29udmVydEZyb20tVUFDVmFsdWUgLVZhbHVlIDY2MTc2CgogICAgICAgIENvbnZlcnQgdGhlIFVBQyB2YWx1ZSA2NjE3NiB0byBodW1hbiByZWFkYWJsZSBmb3JtYXQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0VXNlciBqYXNvbiB8IHNlbGVjdCB1c2VyYWNjb3VudGNvbnRyb2wgfCBDb252ZXJ0RnJvbS1VQUNWYWx1ZQoKICAgICAgICBDb252ZXJ0IHRoZSBVQUMgdmFsdWUgZm9yICdqYXNvbicgdG8gaHVtYW4gcmVhZGFibGUgZm9ybWF0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldFVzZXIgamFzb24gfCBzZWxlY3QgdXNlcmFjY291bnRjb250cm9sIHwgQ29udmVydEZyb20tVUFDVmFsdWUgLVNob3dBbGwKCiAgICAgICAgQ29udmVydCB0aGUgVUFDIHZhbHVlIGZvciAnamFzb24nIHRvIGh1bWFuIHJlYWRhYmxlIGZvcm1hdCwgc2hvd2luZyBhbGwKICAgICAgICBwb3NzaWJsZSBVQUMgdmFsdWVzLgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgICRWYWx1ZSwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2hvd0FsbAogICAgKQoKICAgIGJlZ2luIHsKICAgICAgICAjIHZhbHVlcyBmcm9tIGh0dHBzOi8vc3VwcG9ydC5taWNyb3NvZnQuY29tL2VuLXVzL2tiLzMwNTE0NAogICAgICAgICRVQUNWYWx1ZXMgPSBOZXctT2JqZWN0IFN5c3RlbS5Db2xsZWN0aW9ucy5TcGVjaWFsaXplZC5PcmRlcmVkRGljdGlvbmFyeQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJTQ1JJUFQiLCAxKQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJBQ0NPVU5URElTQUJMRSIsIDIpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIkhPTUVESVJfUkVRVUlSRUQiLCA4KQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJMT0NLT1VUIiwgMTYpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIlBBU1NXRF9OT1RSRVFEIiwgMzIpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIlBBU1NXRF9DQU5UX0NIQU5HRSIsIDY0KQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJFTkNSWVBURURfVEVYVF9QV0RfQUxMT1dFRCIsIDEyOCkKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiVEVNUF9EVVBMSUNBVEVfQUNDT1VOVCIsIDI1NikKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiTk9STUFMX0FDQ09VTlQiLCA1MTIpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIklOVEVSRE9NQUlOX1RSVVNUX0FDQ09VTlQiLCAyMDQ4KQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJXT1JLU1RBVElPTl9UUlVTVF9BQ0NPVU5UIiwgNDA5NikKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiU0VSVkVSX1RSVVNUX0FDQ09VTlQiLCA4MTkyKQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJET05UX0VYUElSRV9QQVNTV09SRCIsIDY1NTM2KQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJNTlNfTE9HT05fQUNDT1VOVCIsIDEzMTA3MikKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiU01BUlRDQVJEX1JFUVVJUkVEIiwgMjYyMTQ0KQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJUUlVTVEVEX0ZPUl9ERUxFR0FUSU9OIiwgNTI0Mjg4KQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJOT1RfREVMRUdBVEVEIiwgMTA0ODU3NikKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiVVNFX0RFU19LRVlfT05MWSIsIDIwOTcxNTIpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIkRPTlRfUkVRX1BSRUFVVEgiLCA0MTk0MzA0KQogICAgICAgICRVQUNWYWx1ZXMuQWRkKCJQQVNTV09SRF9FWFBJUkVEIiwgODM4ODYwOCkKICAgICAgICAkVUFDVmFsdWVzLkFkZCgiVFJVU1RFRF9UT19BVVRIX0ZPUl9ERUxFR0FUSU9OIiwgMTY3NzcyMTYpCiAgICAgICAgJFVBQ1ZhbHVlcy5BZGQoIlBBUlRJQUxfU0VDUkVUU19BQ0NPVU5UIiwgNjcxMDg4NjQpCiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgICRSZXN1bHRVQUNWYWx1ZXMgPSBOZXctT2JqZWN0IFN5c3RlbS5Db2xsZWN0aW9ucy5TcGVjaWFsaXplZC5PcmRlcmVkRGljdGlvbmFyeQoKICAgICAgICBpZigkVmFsdWUgLWlzIFtJbnRdKSB7CiAgICAgICAgICAgICRJbnRWYWx1ZSA9ICRWYWx1ZQogICAgICAgIH0KICAgICAgICBlbHNlaWYgKCRWYWx1ZSAtaXMgW1BTQ3VzdG9tT2JqZWN0XSkgewogICAgICAgICAgICBpZigkVmFsdWUudXNlcmFjY291bnRjb250cm9sKSB7CiAgICAgICAgICAgICAgICAkSW50VmFsdWUgPSAkVmFsdWUudXNlcmFjY291bnRjb250cm9sCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkludmFsaWQgb2JqZWN0IGlucHV0IGZvciAtVmFsdWUgOiAkVmFsdWUiCiAgICAgICAgICAgIHJldHVybiAkTnVsbAogICAgICAgIH0KCiAgICAgICAgaWYoJFNob3dBbGwpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJFVBQ1ZhbHVlIGluICRVQUNWYWx1ZXMuR2V0RW51bWVyYXRvcigpKSB7CiAgICAgICAgICAgICAgICBpZiggKCRJbnRWYWx1ZSAtYmFuZCAkVUFDVmFsdWUuVmFsdWUpIC1lcSAkVUFDVmFsdWUuVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0VUFDVmFsdWVzLkFkZCgkVUFDVmFsdWUuTmFtZSwgIiQoJFVBQ1ZhbHVlLlZhbHVlKSsiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdFVBQ1ZhbHVlcy5BZGQoJFVBQ1ZhbHVlLk5hbWUsICIkKCRVQUNWYWx1ZS5WYWx1ZSkiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBmb3JlYWNoICgkVUFDVmFsdWUgaW4gJFVBQ1ZhbHVlcy5HZXRFbnVtZXJhdG9yKCkpIHsKICAgICAgICAgICAgICAgIGlmKCAoJEludFZhbHVlIC1iYW5kICRVQUNWYWx1ZS5WYWx1ZSkgLWVxICRVQUNWYWx1ZS5WYWx1ZSkgewogICAgICAgICAgICAgICAgICAgICRSZXN1bHRVQUNWYWx1ZXMuQWRkKCRVQUNWYWx1ZS5OYW1lLCAiJCgkVUFDVmFsdWUuVmFsdWUpIikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkUmVzdWx0VUFDVmFsdWVzCiAgICB9Cn0KCgpmaWx0ZXIgR2V0LVByb3h5IHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBFbnVtZXJhdGVzIHRoZSBwcm94eSBzZXJ2ZXIgYW5kIFdQQUQgY29uZW50cyBmb3IgdGhlIGN1cnJlbnQgdXNlci4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBUaGUgY29tcHV0ZXJuYW1lIHRvIGVudW1lcmF0ZSBwcm94eSBzZXR0aW5ncyBvbiwgZGVmYXVsdHMgdG8gbG9jYWwgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Qcm94eQoKICAgICAgICBSZXR1cm5zIHRoZSBjdXJyZW50IHByb3h5IHNldHRpbmdzLgojPgogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlck5hbWUgPSAkRU5WOkNPTVBVVEVSTkFNRQogICAgKQoKICAgIHRyeSB7CiAgICAgICAgJFJlZyA9IFtNaWNyb3NvZnQuV2luMzIuUmVnaXN0cnlLZXldOjpPcGVuUmVtb3RlQmFzZUtleSgnQ3VycmVudFVzZXInLCAkQ29tcHV0ZXJOYW1lKQogICAgICAgICRSZWdLZXkgPSAkUmVnLk9wZW5TdWJrZXkoIlNPRlRXQVJFXFxNaWNyb3NvZnRcXFdpbmRvd3NcXEN1cnJlbnRWZXJzaW9uXFxJbnRlcm5ldCBTZXR0aW5ncyIpCiAgICAgICAgJFByb3h5U2VydmVyID0gJFJlZ0tleS5HZXRWYWx1ZSgnUHJveHlTZXJ2ZXInKQogICAgICAgICRBdXRvQ29uZmlnVVJMID0gJFJlZ0tleS5HZXRWYWx1ZSgnQXV0b0NvbmZpZ1VSTCcpCgogICAgICAgICRXcGFkID0gIiIKICAgICAgICBpZigkQXV0b0NvbmZpZ1VSTCAtYW5kICgkQXV0b0NvbmZpZ1VSTCAtbmUgIiIpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkV3BhZCA9IChOZXctT2JqZWN0IE5ldC5XZWJjbGllbnQpLkRvd25sb2FkU3RyaW5nKCRBdXRvQ29uZmlnVVJMKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkVycm9yIGNvbm5lY3RpbmcgdG8gQXV0b0NvbmZpZ1VSTCA6ICRBdXRvQ29uZmlnVVJMIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZigkUHJveHlTZXJ2ZXIgLW9yICRBdXRvQ29uZmlnVXJsKSB7CgogICAgICAgICAgICAkUHJvcGVydGllcyA9IEB7CiAgICAgICAgICAgICAgICAnUHJveHlTZXJ2ZXInID0gJFByb3h5U2VydmVyCiAgICAgICAgICAgICAgICAnQXV0b0NvbmZpZ1VSTCcgPSAkQXV0b0NvbmZpZ1VSTAogICAgICAgICAgICAgICAgJ1dwYWQnID0gJFdwYWQKICAgICAgICAgICAgfQoKICAgICAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJObyBwcm94eSBzZXR0aW5ncyBmb3VuZCBmb3IgJENvbXB1dGVyTmFtZSIKICAgICAgICB9CiAgICB9CiAgICBjYXRjaCB7CiAgICAgICAgV3JpdGUtV2FybmluZyAiRXJyb3IgZW51bWVyYXRpbmcgcHJveHkgc2V0dGluZ3MgZm9yICRDb21wdXRlck5hbWUgOiAkXyIKICAgIH0KfQoKCmZ1bmN0aW9uIFJlcXVlc3QtU1BOVGlja2V0IHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXF1ZXN0IHRoZSBrZXJiZXJvcyB0aWNrZXQgZm9yIGEgc3BlY2lmaWVkIHNlcnZpY2UgcHJpbmNpcGFsIG5hbWUgKFNQTikuCgogICAgLlBBUkFNRVRFUiBTUE4KCiAgICAgICAgVGhlIHNlcnZpY2UgcHJpbmNpcGFsIG5hbWUgdG8gcmVxdWVzdCB0aGUgdGlja2V0IGZvci4gUmVxdWlyZWQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBSZXF1ZXN0LVNQTlRpY2tldCAtU1BOICJIVFRQL3dlYi50ZXN0bGFiLmxvY2FsIgoKICAgICAgICBSZXF1ZXN0IGEga2VyYmVyb3Mgc2VydmljZSB0aWNrZXQgZm9yIHRoZSBzcGVjaWZpZWQgU1BOLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gIkhUVFAvd2ViMS50ZXN0bGFiLmxvY2FsIiwiSFRUUC93ZWIyLnRlc3RsYWIubG9jYWwiIHwgUmVxdWVzdC1TUE5UaWNrZXQKCiAgICAgICAgUmVxdWVzdCBrZXJiZXJvcyBzZXJ2aWNlIHRpY2tldHMgZm9yIGFsbCBTUE5zIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0VXNlciAtU1BOIHwgUmVxdWVzdC1TUE5UaWNrZXQKCiAgICAgICAgUmVxdWVzdCBrZXJiZXJvcyBzZXJ2aWNlIHRpY2tldHMgZm9yIGFsbCB1c2VycyB3aXRoIG5vbi1udWxsIFNQTnMuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbQWxpYXMoJ1NlcnZpY2VQcmluY2lwYWxOYW1lJyldCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgICRTUE4KICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgQWRkLVR5cGUgLUFzc2VtYmx5TmFtZSBTeXN0ZW0uSWRlbnRpdHlNb2RlbAogICAgfQoKICAgIHByb2Nlc3MgewogICAgICAgIFdyaXRlLVZlcmJvc2UgIlJlcXVlc3RpbmcgdGlja2V0IGZvcjogJFNQTiIKICAgICAgICBOZXctT2JqZWN0IFN5c3RlbS5JZGVudGl0eU1vZGVsLlRva2Vucy5LZXJiZXJvc1JlcXVlc3RvclNlY3VyaXR5VG9rZW4gLUFyZ3VtZW50TGlzdCAkU1BOCiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtUGF0aEFjbCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgRW51bWVyYXRlcyB0aGUgQUNMIGZvciBhIGdpdmVuIGZpbGUgcGF0aC4KCiAgICAuUEFSQU1FVEVSIFBhdGgKCiAgICAgICAgVGhlIGxvY2FsL3JlbW90ZSBwYXRoIHRvIGVudW1lcmF0ZSB0aGUgQUNMcyBmb3IuCgogICAgLlBBUkFNRVRFUiBSZWN1cnNlCgogICAgICAgIElmIGFueSBBQ0wgcmVzdWx0cyBhcmUgZ3JvdXBzLCByZWN1cnNlIGFuZCByZXRyaWV2ZSB1c2VyIG1lbWJlcnNoaXAuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtUGF0aEFjbCAiXFxTRVJWRVJcU2hhcmVcIgoKICAgICAgICBSZXR1cm5zIEFDTHMgZm9yIHRoZSBnaXZlbiBVTkMgc2hhcmUuCiM+CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRQYXRoLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRSZWN1cnNlCiAgICApCgogICAgYmVnaW4gewoKICAgICAgICBmdW5jdGlvbiBDb252ZXJ0LUZpbGVSaWdodCB7CgogICAgICAgICAgICAjIEZyb20gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yODAyOTg3Mi9yZXRyaWV2aW5nLXNlY3VyaXR5LWRlc2NyaXB0b3ItYW5kLWdldHRpbmctbnVtYmVyLWZvci1maWxlc3lzdGVtcmlnaHRzCgogICAgICAgICAgICBbQ21kbGV0QmluZGluZygpXQogICAgICAgICAgICBwYXJhbSgKICAgICAgICAgICAgICAgIFtJbnRdCiAgICAgICAgICAgICAgICAkRlNSCiAgICAgICAgICAgICkKCiAgICAgICAgICAgICRBY2Nlc3NNYXNrID0gQHsKICAgICAgICAgICAgICBbdWludDMyXScweDgwMDAwMDAwJyA9ICdHZW5lcmljUmVhZCcKICAgICAgICAgICAgICBbdWludDMyXScweDQwMDAwMDAwJyA9ICdHZW5lcmljV3JpdGUnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgyMDAwMDAwMCcgPSAnR2VuZXJpY0V4ZWN1dGUnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgxMDAwMDAwMCcgPSAnR2VuZXJpY0FsbCcKICAgICAgICAgICAgICBbdWludDMyXScweDAyMDAwMDAwJyA9ICdNYXhpbXVtQWxsb3dlZCcKICAgICAgICAgICAgICBbdWludDMyXScweDAxMDAwMDAwJyA9ICdBY2Nlc3NTeXN0ZW1TZWN1cml0eScKICAgICAgICAgICAgICBbdWludDMyXScweDAwMTAwMDAwJyA9ICdTeW5jaHJvbml6ZScKICAgICAgICAgICAgICBbdWludDMyXScweDAwMDgwMDAwJyA9ICdXcml0ZU93bmVyJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwNDAwMDAnID0gJ1dyaXRlREFDJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMjAwMDAnID0gJ1JlYWRDb250cm9sJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMTAwMDAnID0gJ0RlbGV0ZScKICAgICAgICAgICAgICBbdWludDMyXScweDAwMDAwMTAwJyA9ICdXcml0ZUF0dHJpYnV0ZXMnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDA4MCcgPSAnUmVhZEF0dHJpYnV0ZXMnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDA0MCcgPSAnRGVsZXRlQ2hpbGQnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDAyMCcgPSAnRXhlY3V0ZS9UcmF2ZXJzZScKICAgICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDEwJyA9ICdXcml0ZUV4dGVuZGVkQXR0cmlidXRlcycKICAgICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDA4JyA9ICdSZWFkRXh0ZW5kZWRBdHRyaWJ1dGVzJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwMDQnID0gJ0FwcGVuZERhdGEvQWRkU3ViZGlyZWN0b3J5JwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwMDInID0gJ1dyaXRlRGF0YS9BZGRGaWxlJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwMDEnID0gJ1JlYWREYXRhL0xpc3REaXJlY3RvcnknCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRTaW1wbGVQZXJtaXNzaW9ucyA9IEB7CiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgxZjAxZmYnID0gJ0Z1bGxDb250cm9sJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDMwMWJmJyA9ICdNb2RpZnknCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMjAwYTknID0gJ1JlYWRBbmRFeGVjdXRlJwogICAgICAgICAgICAgIFt1aW50MzJdJzB4MDIwMTlmJyA9ICdSZWFkQW5kV3JpdGUnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMjAwODknID0gJ1JlYWQnCiAgICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAxMTYnID0gJ1dyaXRlJwogICAgICAgICAgICB9CgogICAgICAgICAgICAkUGVybWlzc2lvbnMgPSBAKCkKCiAgICAgICAgICAgICMgZ2V0IHNpbXBsZSBwZXJtaXNzaW9uCiAgICAgICAgICAgICRQZXJtaXNzaW9ucyArPSAkU2ltcGxlUGVybWlzc2lvbnMuS2V5cyB8ICAlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCgkRlNSIC1iYW5kICRfKSAtZXEgJF8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkU2ltcGxlUGVybWlzc2lvbnNbJF9dCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZTUiA9ICRGU1IgLWJhbmQgKC1ub3QgJF8pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgZ2V0IHJlbWFpbmluZyBleHRlbmRlZCBwZXJtaXNzaW9ucwogICAgICAgICAgICAkUGVybWlzc2lvbnMgKz0gJEFjY2Vzc01hc2suS2V5cyB8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHsgJEZTUiAtYmFuZCAkXyB9IHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICUgeyAkQWNjZXNzTWFza1skX10gfQoKICAgICAgICAgICAgKCRQZXJtaXNzaW9ucyB8ID97JF99KSAtam9pbiAiLCIKICAgICAgICB9CiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRBQ0wgPSBHZXQtQWNsIC1QYXRoICRQYXRoCgogICAgICAgICAgICAkQUNMLkdldEFjY2Vzc1J1bGVzKCR0cnVlLCR0cnVlLFtTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcl0pIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICROYW1lcyA9IEAoKQogICAgICAgICAgICAgICAgaWYgKCRfLklkZW50aXR5UmVmZXJlbmNlIC1tYXRjaCAnXlMtMS01LTIxLVswLTldKy1bMC05XSstWzAtOV0rLVswLTldKycpIHsKICAgICAgICAgICAgICAgICAgICAkT2JqZWN0ID0gR2V0LUFET2JqZWN0IC1TSUQgJF8uSWRlbnRpdHlSZWZlcmVuY2UKICAgICAgICAgICAgICAgICAgICAkTmFtZXMgPSBAKCkKICAgICAgICAgICAgICAgICAgICAkU0lEcyA9IEAoJE9iamVjdC5vYmplY3RzaWQpCgogICAgICAgICAgICAgICAgICAgIGlmICgkUmVjdXJzZSAtYW5kIChAKCcyNjg0MzU0NTYnLCcyNjg0MzU0NTcnLCc1MzY4NzA5MTInLCc1MzY4NzA5MTMnKSAtY29udGFpbnMgJE9iamVjdC5zYW1BY2NvdW50VHlwZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFNJRHMgKz0gR2V0LU5ldEdyb3VwTWVtYmVyIC1TSUQgJE9iamVjdC5vYmplY3RzaWQgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBNZW1iZXJTaWQKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRTSURzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAkTmFtZXMgKz0gLEAoJF8sIChDb252ZXJ0LVNpZFRvTmFtZSAkXykpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJE5hbWVzICs9ICxAKCRfLklkZW50aXR5UmVmZXJlbmNlLlZhbHVlLCAoQ29udmVydC1TaWRUb05hbWUgJF8uSWRlbnRpdHlSZWZlcmVuY2UuVmFsdWUpKQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEZvckVhY2goJE5hbWUgaW4gJE5hbWVzKSB7CiAgICAgICAgICAgICAgICAgICAgJE91dCA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAkT3V0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1BhdGgnICRQYXRoCiAgICAgICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdGaWxlU3lzdGVtUmlnaHRzJyAoQ29udmVydC1GaWxlUmlnaHQgLUZTUiAkXy5GaWxlU3lzdGVtUmlnaHRzLnZhbHVlX18pCiAgICAgICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJZGVudGl0eVJlZmVyZW5jZScgJE5hbWVbMV0KICAgICAgICAgICAgICAgICAgICAkT3V0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lkZW50aXR5U0lEJyAkTmFtZVswXQogICAgICAgICAgICAgICAgICAgICRPdXQgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQWNjZXNzQ29udHJvbFR5cGUnICRfLkFjY2Vzc0NvbnRyb2xUeXBlCiAgICAgICAgICAgICAgICAgICAgJE91dAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAkXwogICAgICAgIH0KICAgIH0KfQoKCmZpbHRlciBHZXQtTmFtZUZpZWxkIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBIZWxwZXIgdGhhdCBhdHRlbXB0cyB0byBleHRyYWN0IGFwcHJvcHJpYXRlIGZpZWxkIG5hbWVzIGZyb20KICAgICAgICBwYXNzZWQgY29tcHV0ZXIgb2JqZWN0cy4KCiAgICAuUEFSQU1FVEVSIE9iamVjdAoKICAgICAgICBUaGUgcGFzc2VkIG9iamVjdCB0byBleHRyYWN0IG5hbWUgZmllbGRzIGZyb20uCgogICAgLlBBUkFNRVRFUiBEbnNIb3N0TmFtZQoKICAgICAgICBBIERuc0hvc3ROYW1lIHRvIGV4dHJhY3QgdGhyb3VnaCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lLgoKICAgIC5QQVJBTUVURVIgTmFtZQoKICAgICAgICBBIE5hbWUgdG8gZXh0cmFjdCB0aHJvdWdoIFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWUuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Q29tcHV0ZXIgLUZ1bGxEYXRhIHwgR2V0LU5hbWVGaWVsZAojPgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmUgPSAkVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbT2JqZWN0XQogICAgICAgICRPYmplY3QsCgogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREbnNIb3N0TmFtZSwKCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE5hbWUKICAgICkKCiAgICBpZigkUFNCb3VuZFBhcmFtZXRlcnNbJ0Ruc0hvc3ROYW1lJ10pIHsKICAgICAgICAkRG5zSG9zdE5hbWUKICAgIH0KICAgIGVsc2VpZigkUFNCb3VuZFBhcmFtZXRlcnNbJ05hbWUnXSkgewogICAgICAgICROYW1lCiAgICB9CiAgICBlbHNlaWYoJE9iamVjdCkgewogICAgICAgIGlmICggW2Jvb2xdKCRPYmplY3QuUFNvYmplY3QuUHJvcGVydGllcy5uYW1lIC1tYXRjaCAiZG5zaG9zdG5hbWUiKSApIHsKICAgICAgICAgICAgIyBvYmplY3RzIGZyb20gR2V0LU5ldENvbXB1dGVyCiAgICAgICAgICAgICRPYmplY3QuZG5zaG9zdG5hbWUKICAgICAgICB9CiAgICAgICAgZWxzZWlmICggW2Jvb2xdKCRPYmplY3QuUFNvYmplY3QuUHJvcGVydGllcy5uYW1lIC1tYXRjaCAibmFtZSIpICkgewogICAgICAgICAgICAjIG9iamVjdHMgZnJvbSBHZXQtTmV0RG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAkT2JqZWN0Lm5hbWUKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICMgc3RyaW5ncyBhbmQgY2F0Y2ggYWxscwogICAgICAgICAgICAkT2JqZWN0CiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgcmV0dXJuICROdWxsCiAgICB9Cn0KCgpmdW5jdGlvbiBDb252ZXJ0LUxEQVBQcm9wZXJ0eSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgSGVscGVyIHRoYXQgY29udmVydHMgc3BlY2lmaWMgTERBUCBwcm9wZXJ0eSByZXN1bHQgZmllbGRzLgogICAgICAgIFVzZWQgYnkgc2V2ZXJhbCBvZiB0aGUgR2V0LU5ldCogZnVuY3Rpb24uCgogICAgLlBBUkFNRVRFUiBQcm9wZXJ0aWVzCgogICAgICAgIFByb3BlcnRpZXMgb2JqZWN0IHRvIGV4dHJhY3Qgb3V0IExEQVAgZmllbGRzIGZvciBkaXNwbGF5LgojPgogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRQcm9wZXJ0aWVzCiAgICApCgogICAgJE9iamVjdFByb3BlcnRpZXMgPSBAe30KCiAgICAkUHJvcGVydGllcy5Qcm9wZXJ0eU5hbWVzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgIGlmICgoJF8gLWVxICJvYmplY3RzaWQiKSAtb3IgKCRfIC1lcSAic2lkaGlzdG9yeSIpKSB7CiAgICAgICAgICAgICMgY29udmVydCB0aGUgU0lEIHRvIGEgc3RyaW5nCiAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9IChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyKCRQcm9wZXJ0aWVzWyRfXVswXSwwKSkuVmFsdWUKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCRfIC1lcSAib2JqZWN0Z3VpZCIpIHsKICAgICAgICAgICAgIyBjb252ZXJ0IHRoZSBHVUlEIHRvIGEgc3RyaW5nCiAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9IChOZXctT2JqZWN0IEd1aWQgKCwkUHJvcGVydGllc1skX11bMF0pKS5HdWlkCiAgICAgICAgfQogICAgICAgIGVsc2VpZiggKCRfIC1lcSAibGFzdGxvZ29uIikgLW9yICgkXyAtZXEgImxhc3Rsb2dvbnRpbWVzdGFtcCIpIC1vciAoJF8gLWVxICJwd2RsYXN0c2V0IikgLW9yICgkXyAtZXEgImxhc3Rsb2dvZmYiKSAtb3IgKCRfIC1lcSAiYmFkUGFzc3dvcmRUaW1lIikgKSB7CiAgICAgICAgICAgICMgY29udmVydCB0aW1lc3RhbXBzCiAgICAgICAgICAgIGlmICgkUHJvcGVydGllc1skX11bMF0gLWlzIFtTeXN0ZW0uTWFyc2hhbEJ5UmVmT2JqZWN0XSkgewogICAgICAgICAgICAgICAgIyBpZiB3ZSBoYXZlIGEgU3lzdGVtLl9fQ29tT2JqZWN0CiAgICAgICAgICAgICAgICAkVGVtcCA9ICRQcm9wZXJ0aWVzWyRfXVswXQogICAgICAgICAgICAgICAgW0ludDMyXSRIaWdoID0gJFRlbXAuR2V0VHlwZSgpLkludm9rZU1lbWJlcigiSGlnaFBhcnQiLCBbU3lzdGVtLlJlZmxlY3Rpb24uQmluZGluZ0ZsYWdzXTo6R2V0UHJvcGVydHksICRudWxsLCAkVGVtcCwgJG51bGwpCiAgICAgICAgICAgICAgICBbSW50MzJdJExvdyAgPSAkVGVtcC5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCJMb3dQYXJ0IiwgIFtTeXN0ZW0uUmVmbGVjdGlvbi5CaW5kaW5nRmxhZ3NdOjpHZXRQcm9wZXJ0eSwgJG51bGwsICRUZW1wLCAkbnVsbCkKICAgICAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9IChbZGF0ZXRpbWVdOjpGcm9tRmlsZVRpbWUoW0ludDY0XSgiMHh7MDp4OH17MTp4OH0iIC1mICRIaWdoLCAkTG93KSkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1skX10gPSAoW2RhdGV0aW1lXTo6RnJvbUZpbGVUaW1lKCgkUHJvcGVydGllc1skX11bMF0pKSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYoJFByb3BlcnRpZXNbJF9dWzBdIC1pcyBbU3lzdGVtLk1hcnNoYWxCeVJlZk9iamVjdF0pIHsKICAgICAgICAgICAgIyB0cnkgdG8gY29udmVydCBtaXNjIGNvbSBvYmplY3RzCiAgICAgICAgICAgICRQcm9wID0gJFByb3BlcnRpZXNbJF9dCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkVGVtcCA9ICRQcm9wWyRfXVswXQogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAkXwogICAgICAgICAgICAgICAgW0ludDMyXSRIaWdoID0gJFRlbXAuR2V0VHlwZSgpLkludm9rZU1lbWJlcigiSGlnaFBhcnQiLCBbU3lzdGVtLlJlZmxlY3Rpb24uQmluZGluZ0ZsYWdzXTo6R2V0UHJvcGVydHksICRudWxsLCAkVGVtcCwgJG51bGwpCiAgICAgICAgICAgICAgICBbSW50MzJdJExvdyAgPSAkVGVtcC5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCJMb3dQYXJ0IiwgIFtTeXN0ZW0uUmVmbGVjdGlvbi5CaW5kaW5nRmxhZ3NdOjpHZXRQcm9wZXJ0eSwgJG51bGwsICRUZW1wLCAkbnVsbCkKICAgICAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9IFtJbnQ2NF0oIjB4ezA6eDh9ezE6eDh9IiAtZiAkSGlnaCwgJExvdykKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1skX10gPSAkUHJvcFskX10KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYoJFByb3BlcnRpZXNbJF9dLmNvdW50IC1lcSAxKSB7CiAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9ICRQcm9wZXJ0aWVzWyRfXVswXQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gJFByb3BlcnRpZXNbJF9dCiAgICAgICAgfQogICAgfQoKICAgIE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IC1Qcm9wZXJ0eSAkT2JqZWN0UHJvcGVydGllcwp9CgoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMKIyBEb21haW4gaW5mbyBmdW5jdGlvbnMgYmVsb3cuCiMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmZpbHRlciBHZXQtRG9tYWluU2VhcmNoZXIgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEhlbHBlciB1c2VkIGJ5IHZhcmlvdXMgZnVuY3Rpb25zIHRoYXQgdGFrZXMgYW4gQURTcGF0aCBhbmQKICAgICAgICBkb21haW4gc3BlY2lmaWVyIGFuZCBidWlsZHMgdGhlIGNvcnJlY3QgQURTSSBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byB1c2UgZm9yIHRoZSBxdWVyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBBRFNwcmVmaXgKCiAgICAgICAgUHJlZml4IHRvIHNldCBmb3IgdGhlIHNlYXJjaGVyIChsaWtlICJDTj1TaXRlcyxDTj1Db25maWd1cmF0aW9uIikKCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gdGVzdGxhYi5sb2NhbAoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gdGVzdGxhYi5sb2NhbCAtRG9tYWluQ29udHJvbGxlciBTRUNPTkRBUlkuZGV2LnRlc3RsYWIubG9jYWwKIz4KCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3ByZWZpeCwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgaWYoLW5vdCAkQ3JlZGVudGlhbCkgewogICAgICAgIGlmKC1ub3QgJERvbWFpbikgewogICAgICAgICAgICAkRG9tYWluID0gKEdldC1OZXREb21haW4pLm5hbWUKICAgICAgICB9CiAgICAgICAgZWxzZWlmKC1ub3QgJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICMgaWYgdGhlcmUncyBubyAtRG9tYWluQ29udHJvbGxlciBzcGVjaWZpZWQsIHRyeSB0byBwdWxsIHRoZSBwcmltYXJ5IERDIHRvIHJlZmxlY3QgcXVlcmllcyB0aHJvdWdoCiAgICAgICAgICAgICAgICAkRG9tYWluQ29udHJvbGxlciA9ICgoR2V0LU5ldERvbWFpbikuUGRjUm9sZU93bmVyKS5OYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgdGhyb3cgIkdldC1Eb21haW5TZWFyY2hlcjogRXJyb3IgaW4gcmV0cmlldmluZyBQREMgZm9yIGN1cnJlbnQgZG9tYWluIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZWxzZWlmICgtbm90ICREb21haW5Db250cm9sbGVyKSB7CiAgICAgICAgIyBpZiBhIERDIGlzbid0IHNwZWNpZmllZAogICAgICAgIHRyeSB7CiAgICAgICAgICAgICREb21haW5Db250cm9sbGVyID0gKChHZXQtTmV0RG9tYWluIC1DcmVkZW50aWFsICRDcmVkZW50aWFsKS5QZGNSb2xlT3duZXIpLk5hbWUKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICB0aHJvdyAiR2V0LURvbWFpblNlYXJjaGVyOiBFcnJvciBpbiByZXRyaWV2aW5nIFBEQyBmb3IgY3VycmVudCBkb21haW4iCiAgICAgICAgfQoKICAgICAgICBpZighJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgdGhyb3cgIkdldC1Eb21haW5TZWFyY2hlcjogRXJyb3IgaW4gcmV0cmlldmluZyBQREMgZm9yIGN1cnJlbnQgZG9tYWluIgogICAgICAgIH0KICAgIH0KCiAgICAkU2VhcmNoU3RyaW5nID0gIkxEQVA6Ly8iCgogICAgaWYoJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAkU2VhcmNoU3RyaW5nICs9ICREb21haW5Db250cm9sbGVyCiAgICAgICAgaWYoJERvbWFpbil7CiAgICAgICAgICAgICRTZWFyY2hTdHJpbmcgKz0gJy8nCiAgICAgICAgfQogICAgfQoKICAgIGlmKCRBRFNwcmVmaXgpIHsKICAgICAgICAkU2VhcmNoU3RyaW5nICs9ICRBRFNwcmVmaXggKyAnLCcKICAgIH0KCiAgICBpZigkQURTcGF0aCkgewogICAgICAgIGlmKCRBRFNwYXRoIC1NYXRjaCAnXkdDOi8vJykgewogICAgICAgICAgICAjIGlmIHdlJ3JlIHNlYXJjaGluZyB0aGUgZ2xvYmFsIGNhdGFsb2cKICAgICAgICAgICAgJEROID0gJEFkc1BhdGguVG9VcHBlcigpLlRyaW0oJy8nKQogICAgICAgICAgICAkU2VhcmNoU3RyaW5nID0gJycKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCRBRFNwYXRoIC1tYXRjaCAnXkxEQVA6Ly8nKSB7CiAgICAgICAgICAgICAgICBpZigkQURTcGF0aCAtbWF0Y2ggIkxEQVA6Ly8uKy8uKyIpIHsKICAgICAgICAgICAgICAgICAgICAkU2VhcmNoU3RyaW5nID0gJycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRBRFNwYXRoID0gJEFEU3BhdGguU3Vic3RyaW5nKDcpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJEROID0gJEFEU3BhdGgKICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBpZigkRG9tYWluIC1hbmQgKCREb21haW4uVHJpbSgpIC1uZSAiIikpIHsKICAgICAgICAgICAgJEROID0gIkRDPSQoJERvbWFpbi5SZXBsYWNlKCcuJywgJyxEQz0nKSkiCiAgICAgICAgfQogICAgfQoKICAgICRTZWFyY2hTdHJpbmcgKz0gJEROCiAgICBXcml0ZS1WZXJib3NlICJHZXQtRG9tYWluU2VhcmNoZXIgc2VhcmNoIHN0cmluZzogJFNlYXJjaFN0cmluZyIKCiAgICBpZigkQ3JlZGVudGlhbCkgewogICAgICAgIFdyaXRlLVZlcmJvc2UgIlVzaW5nIGFsdGVybmF0ZSBjcmVkZW50aWFscyBmb3IgTERBUCBjb25uZWN0aW9uIgogICAgICAgICREb21haW5PYmplY3QgPSBOZXctT2JqZWN0IERpcmVjdG9yeVNlcnZpY2VzLkRpcmVjdG9yeUVudHJ5KCRTZWFyY2hTdHJpbmcsICRDcmVkZW50aWFsLlVzZXJOYW1lLCAkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLlBhc3N3b3JkKQogICAgICAgICRTZWFyY2hlciA9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkRpcmVjdG9yeVNlYXJjaGVyKCREb21haW5PYmplY3QpCiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkU2VhcmNoZXIgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5EaXJlY3RvcnlTZWFyY2hlcihbQURTSV0kU2VhcmNoU3RyaW5nKQogICAgfQoKICAgICRTZWFyY2hlci5QYWdlU2l6ZSA9ICRQYWdlU2l6ZQogICAgJFNlYXJjaGVyLkNhY2hlUmVzdWx0cyA9ICRGYWxzZQogICAgJFNlYXJjaGVyCn0KCgpmaWx0ZXIgQ29udmVydC1ETlNSZWNvcmQgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgRGVjb2RlcyBhIGJpbmFyeSBETlMgcmVjb3JkLgoKICAgICAgIEFkYXB0ZWQvcG9ydGVkIGZyb20gTWljaGFlbCBCLiBTbWl0aCdzIGNvZGUgYXQgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL21tZXNzYW5vL1Bvd2VyU2hlbGwvbWFzdGVyL2Rucy1kdW1wLnBzMQoKICAgIC5QQVJBTUVURVIgRE5TUmVjb3JkCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHpvbmVzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLkxJTksKCiAgICAgICAgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL21tZXNzYW5vL1Bvd2VyU2hlbGwvbWFzdGVyL2Rucy1kdW1wLnBzMQojPgogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSRUcnVlLCBNYW5kYXRvcnk9JFRydWUpXQogICAgICAgIFtCeXRlW11dCiAgICAgICAgJEROU1JlY29yZAogICAgKQoKICAgIGZ1bmN0aW9uIEdldC1OYW1lIHsKICAgICAgICAjIG1vZGlmaWVkIGRlY29kZU5hbWUgZnJvbSBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vbW1lc3Nhbm8vUG93ZXJTaGVsbC9tYXN0ZXIvZG5zLWR1bXAucHMxCiAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0KICAgICAgICBwYXJhbSgKICAgICAgICAgICAgW0J5dGVbXV0KICAgICAgICAgICAgJFJhdwogICAgICAgICkKCiAgICAgICAgW0ludF0kTGVuZ3RoID0gJFJhd1swXQogICAgICAgIFtJbnRdJFNlZ21lbnRzID0gJFJhd1sxXQogICAgICAgIFtJbnRdJEluZGV4ID0gIDIKICAgICAgICBbU3RyaW5nXSROYW1lICA9ICIiCgogICAgICAgIHdoaWxlICgkU2VnbWVudHMtLSAtZ3QgMCkKICAgICAgICB7CiAgICAgICAgICAgIFtJbnRdJFNlZ21lbnRMZW5ndGggPSAkUmF3WyRJbmRleCsrXQogICAgICAgICAgICB3aGlsZSAoJFNlZ21lbnRMZW5ndGgtLSAtZ3QgMCkgewogICAgICAgICAgICAgICAgJE5hbWUgKz0gW0NoYXJdJFJhd1skSW5kZXgrK10KICAgICAgICAgICAgfQogICAgICAgICAgICAkTmFtZSArPSAiLiIKICAgICAgICB9CiAgICAgICAgJE5hbWUKICAgIH0KCiAgICAkUkRhdGFMZW4gPSBbQml0Q29udmVydGVyXTo6VG9VSW50MTYoJEROU1JlY29yZCwgMCkKICAgICRSRGF0YVR5cGUgPSBbQml0Q29udmVydGVyXTo6VG9VSW50MTYoJEROU1JlY29yZCwgMikKICAgICRVcGRhdGVkQXRTZXJpYWwgPSBbQml0Q29udmVydGVyXTo6VG9VSW50MzIoJEROU1JlY29yZCwgOCkKCiAgICAkVFRMUmF3ID0gJEROU1JlY29yZFsxMi4uMTVdCiAgICAjIHJldmVyc2UgZm9yIGJpZyBlbmRpYW4KICAgICROdWxsID0gW2FycmF5XTo6UmV2ZXJzZSgkVFRMUmF3KQogICAgJFRUTCA9IFtCaXRDb252ZXJ0ZXJdOjpUb1VJbnQzMigkVFRMUmF3LCAwKQoKICAgICRBZ2UgPSBbQml0Q29udmVydGVyXTo6VG9VSW50MzIoJEROU1JlY29yZCwgMjApCiAgICBpZigkQWdlIC1uZSAwKSB7CiAgICAgICAgJFRpbWVTdGFtcCA9ICgoR2V0LURhdGUgLVllYXIgMTYwMSAtTW9udGggMSAtRGF5IDEgLUhvdXIgMCAtTWludXRlIDAgLVNlY29uZCAwKS5BZGRIb3VycygkYWdlKSkuVG9TdHJpbmcoKQogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFRpbWVTdGFtcCA9ICJbc3RhdGljXSIKICAgIH0KCiAgICAkRE5TUmVjb3JkT2JqZWN0ID0gTmV3LU9iamVjdCBQU09iamVjdAoKICAgIGlmKCRSRGF0YVR5cGUgLWVxIDEpIHsKICAgICAgICAkSVAgPSAiezB9LnsxfS57Mn0uezN9IiAtZiAkRE5TUmVjb3JkWzI0XSwgJEROU1JlY29yZFsyNV0sICRETlNSZWNvcmRbMjZdLCAkRE5TUmVjb3JkWzI3XQogICAgICAgICREYXRhID0gJElQCiAgICAgICAgJEROU1JlY29yZE9iamVjdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdSZWNvcmRUeXBlJyAnQScKICAgIH0KCiAgICBlbHNlaWYoJFJEYXRhVHlwZSAtZXEgMikgewogICAgICAgICROU05hbWUgPSBHZXQtTmFtZSAkRE5TUmVjb3JkWzI0Li4kRE5TUmVjb3JkLmxlbmd0aF0KICAgICAgICAkRGF0YSA9ICROU05hbWUKICAgICAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1JlY29yZFR5cGUnICdOUycKICAgIH0KCiAgICBlbHNlaWYoJFJEYXRhVHlwZSAtZXEgNSkgewogICAgICAgICRBbGlhcyA9IEdldC1OYW1lICRETlNSZWNvcmRbMjQuLiRETlNSZWNvcmQubGVuZ3RoXQogICAgICAgICREYXRhID0gJEFsaWFzCiAgICAgICAgJEROU1JlY29yZE9iamVjdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdSZWNvcmRUeXBlJyAnQ05BTUUnCiAgICB9CgogICAgZWxzZWlmKCRSRGF0YVR5cGUgLWVxIDYpIHsKICAgICAgICAjIFRPRE86IGhvdyB0byBpbXBsZW1lbnQgcHJvcGVybHk/IG5lc3RlZCBvYmplY3Q/CiAgICAgICAgJERhdGEgPSAkKFtTeXN0ZW0uQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKCRETlNSZWNvcmRbMjQuLiRETlNSZWNvcmQubGVuZ3RoXSkpCiAgICAgICAgJEROU1JlY29yZE9iamVjdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdSZWNvcmRUeXBlJyAnU09BJwogICAgfQoKICAgIGVsc2VpZigkUkRhdGFUeXBlIC1lcSAxMikgewogICAgICAgICRQdHIgPSBHZXQtTmFtZSAkRE5TUmVjb3JkWzI0Li4kRE5TUmVjb3JkLmxlbmd0aF0KICAgICAgICAkRGF0YSA9ICRQdHIKICAgICAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1JlY29yZFR5cGUnICdQVFInCiAgICB9CgogICAgZWxzZWlmKCRSRGF0YVR5cGUgLWVxIDEzKSB7CiAgICAgICAgIyBUT0RPOiBob3cgdG8gaW1wbGVtZW50IHByb3Blcmx5PyBuZXN0ZWQgb2JqZWN0PwogICAgICAgICREYXRhID0gJChbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkRE5TUmVjb3JkWzI0Li4kRE5TUmVjb3JkLmxlbmd0aF0pKQogICAgICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUmVjb3JkVHlwZScgJ0hJTkZPJwogICAgfQoKICAgIGVsc2VpZigkUkRhdGFUeXBlIC1lcSAxNSkgewogICAgICAgICMgVE9ETzogaG93IHRvIGltcGxlbWVudCBwcm9wZXJseT8gbmVzdGVkIG9iamVjdD8KICAgICAgICAkRGF0YSA9ICQoW1N5c3RlbS5Db252ZXJ0XTo6VG9CYXNlNjRTdHJpbmcoJEROU1JlY29yZFsyNC4uJEROU1JlY29yZC5sZW5ndGhdKSkKICAgICAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1JlY29yZFR5cGUnICdNWCcKICAgIH0KCiAgICBlbHNlaWYoJFJEYXRhVHlwZSAtZXEgMTYpIHsKCiAgICAgICAgW3N0cmluZ10kVFhUICA9ICIiCiAgICAgICAgW2ludF0kU2VnbWVudExlbmd0aCA9ICRETlNSZWNvcmRbMjRdCiAgICAgICAgJEluZGV4ID0gMjUKICAgICAgICB3aGlsZSAoJFNlZ21lbnRMZW5ndGgtLSAtZ3QgMCkgewogICAgICAgICAgICAkVFhUICs9IFtjaGFyXSRETlNSZWNvcmRbJGluZGV4KytdCiAgICAgICAgfQoKICAgICAgICAkRGF0YSA9ICRUWFQKICAgICAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1JlY29yZFR5cGUnICdUWFQnCiAgICB9CgogICAgZWxzZWlmKCRSRGF0YVR5cGUgLWVxIDI4KSB7CiAgICAgICAgIyBUT0RPOiBob3cgdG8gaW1wbGVtZW50IHByb3Blcmx5PyBuZXN0ZWQgb2JqZWN0PwogICAgICAgICREYXRhID0gJChbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkRE5TUmVjb3JkWzI0Li4kRE5TUmVjb3JkLmxlbmd0aF0pKQogICAgICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUmVjb3JkVHlwZScgJ0FBQUEnCiAgICB9CgogICAgZWxzZWlmKCRSRGF0YVR5cGUgLWVxIDMzKSB7CiAgICAgICAgIyBUT0RPOiBob3cgdG8gaW1wbGVtZW50IHByb3Blcmx5PyBuZXN0ZWQgb2JqZWN0PwogICAgICAgICREYXRhID0gJChbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkRE5TUmVjb3JkWzI0Li4kRE5TUmVjb3JkLmxlbmd0aF0pKQogICAgICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUmVjb3JkVHlwZScgJ1NSVicKICAgIH0KCiAgICBlbHNlIHsKICAgICAgICAkRGF0YSA9ICQoW1N5c3RlbS5Db252ZXJ0XTo6VG9CYXNlNjRTdHJpbmcoJEROU1JlY29yZFsyNC4uJEROU1JlY29yZC5sZW5ndGhdKSkKICAgICAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1JlY29yZFR5cGUnICdVTktOT1dOJwogICAgfQoKICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXBkYXRlZEF0U2VyaWFsJyAkVXBkYXRlZEF0U2VyaWFsCiAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RUTCcgJFRUTAogICAgJEROU1JlY29yZE9iamVjdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdBZ2UnICRBZ2UKICAgICRETlNSZWNvcmRPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVGltZVN0YW1wJyAkVGltZVN0YW1wCiAgICAkRE5TUmVjb3JkT2JqZWN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0RhdGEnICREYXRhCiAgICAkRE5TUmVjb3JkT2JqZWN0Cn0KCgpmaWx0ZXIgR2V0LUROU1pvbmUgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgRW51bWVyYXRlcyB0aGUgQWN0aXZlIERpcmVjdG9yeSBETlMgem9uZXMgZm9yIGEgZ2l2ZW4gZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHpvbmVzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIEZ1bGxEYXRhCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIGZ1bGwgY29tcHV0ZXIgb2JqZWN0cyBpbnN0ZWFkIG9mIGp1c3Qgc3lzdGVtIG5hbWVzICh0aGUgZGVmYXVsdCkuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtRE5TWm9uZQoKICAgICAgICBSZXRyaWV2ZXMgdGhlIEROUyB6b25lcyBmb3IgdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUROU1pvbmUgLURvbWFpbiBkZXYudGVzdGxhYi5sb2NhbCAtRG9tYWluQ29udHJvbGxlciBwcmltYXJ5LnRlc3RsYWIubG9jYWwKCiAgICAgICAgUmV0cmlldmVzIHRoZSBETlMgem9uZXMgZm9yIHRoZSBkZXYudGVzdGxhYi5sb2NhbCBkb21haW4sIHJlZmxlY3RpbmcgdGhlIExEQVAgcXVlcmllcwogICAgICAgIHRocm91Z2ggdGhlIHByaW1hcnkudGVzdGxhYi5sb2NhbCBkb21haW4gY29udHJvbGxlci4KIz4KCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsIFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRnVsbERhdGEKICAgICkKCiAgICAkRE5TU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwKICAgICRETlNTZWFyY2hlci5maWx0ZXI9IihvYmplY3RDbGFzcz1kbnNab25lKSIKCiAgICBpZigkRE5TU2VhcmNoZXIpIHsKICAgICAgICAkUmVzdWx0cyA9ICRETlNTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAjIGNvbnZlcnQvcHJvY2VzcyB0aGUgTERBUCBmaWVsZHMgZm9yIGVhY2ggcmVzdWx0CiAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gQ29udmVydC1MREFQUHJvcGVydHkgLVByb3BlcnRpZXMgJF8uUHJvcGVydGllcwogICAgICAgICAgICAkUHJvcGVydGllcyB8IEFkZC1NZW1iZXIgTm90ZVByb3BlcnR5ICdab25lTmFtZScgJFByb3BlcnRpZXMubmFtZQoKICAgICAgICAgICAgaWYgKCRGdWxsRGF0YSkgewogICAgICAgICAgICAgICAgJFByb3BlcnRpZXMKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzIHwgU2VsZWN0LU9iamVjdCBab25lTmFtZSxkaXN0aW5ndWlzaGVkbmFtZSx3aGVuY3JlYXRlZCx3aGVuY2hhbmdlZAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICRETlNTZWFyY2hlci5kaXNwb3NlKCkKICAgIH0KCiAgICAkRE5TU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3ByZWZpeCAiQ049TWljcm9zb2Z0RE5TLERDPURvbWFpbkRuc1pvbmVzIgogICAgJEROU1NlYXJjaGVyLmZpbHRlcj0iKG9iamVjdENsYXNzPWRuc1pvbmUpIgoKICAgIGlmKCRETlNTZWFyY2hlcikgewogICAgICAgICRSZXN1bHRzID0gJEROU1NlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICMgY29udmVydC9wcm9jZXNzIHRoZSBMREFQIGZpZWxkcyBmb3IgZWFjaCByZXN1bHQKICAgICAgICAgICAgJFByb3BlcnRpZXMgPSBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICRQcm9wZXJ0aWVzIHwgQWRkLU1lbWJlciBOb3RlUHJvcGVydHkgJ1pvbmVOYW1lJyAkUHJvcGVydGllcy5uYW1lCgogICAgICAgICAgICBpZiAoJEZ1bGxEYXRhKSB7CiAgICAgICAgICAgICAgICAkUHJvcGVydGllcwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgfCBTZWxlY3QtT2JqZWN0IFpvbmVOYW1lLGRpc3Rpbmd1aXNoZWRuYW1lLHdoZW5jcmVhdGVkLHdoZW5jaGFuZ2VkCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgJEROU1NlYXJjaGVyLmRpc3Bvc2UoKQogICAgfQp9CgoKZmlsdGVyIEdldC1ETlNSZWNvcmQgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgRW51bWVyYXRlcyB0aGUgQWN0aXZlIERpcmVjdG9yeSBETlMgcmVjb3JkcyBmb3IgYSBnaXZlbiB6b25lLgoKICAgIC5QQVJBTUVURVIgWm9uZU5hbWUKCiAgICAgICAgVGhlIHpvbmUgdG8gcXVlcnkgZm9yIHJlY29yZHMgKHdoaWNoIGNhbiBiZSBlbnVtZWFydGVkIHdpdGggR2V0LUROU1pvbmUpLiBSZXF1aXJlZC4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciB6b25lcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtRE5TUmVjb3JkIC1ab25lTmFtZSB0ZXN0bGFiLmxvY2FsCgogICAgICAgIFJldHJpZXZlIGFsbCByZWNvcmRzIGZvciB0aGUgdGVzdGxhYi5sb2NhbCB6b25lLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUROU1pvbmUgfCBHZXQtRE5TUmVjb3JkCgogICAgICAgIFJldHJpZXZlIGFsbCByZWNvcmRzIGZvciBhbGwgem9uZXMgaW4gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUROU1pvbmUgLURvbWFpbiBkZXYudGVzdGxhYi5sb2NhbCB8IEdldC1ETlNSZWNvcmQgLURvbWFpbiBkZXYudGVzdGxhYi5sb2NhbAoKICAgICAgICBSZXRyaWV2ZSBhbGwgcmVjb3JkcyBmb3IgYWxsIHpvbmVzIGluIHRoZSBkZXYudGVzdGxhYi5sb2NhbCBkb21haW4uCiM+CgogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSRUcnVlLCBNYW5kYXRvcnk9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFpvbmVOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgICRETlNTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZSAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcHJlZml4ICJEQz0kKCRab25lTmFtZSksQ049TWljcm9zb2Z0RE5TLERDPURvbWFpbkRuc1pvbmVzIgogICAgJEROU1NlYXJjaGVyLmZpbHRlcj0iKG9iamVjdENsYXNzPWRuc05vZGUpIgoKICAgIGlmKCRETlNTZWFyY2hlcikgewogICAgICAgICRSZXN1bHRzID0gJEROU1NlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAjIGNvbnZlcnQvcHJvY2VzcyB0aGUgTERBUCBmaWVsZHMgZm9yIGVhY2ggcmVzdWx0CiAgICAgICAgICAgICAgICAkUHJvcGVydGllcyA9IENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMgfCBTZWxlY3QtT2JqZWN0IG5hbWUsZGlzdGluZ3Vpc2hlZG5hbWUsZG5zcmVjb3JkLHdoZW5jcmVhdGVkLHdoZW5jaGFuZ2VkCiAgICAgICAgICAgICAgICAkUHJvcGVydGllcyB8IEFkZC1NZW1iZXIgTm90ZVByb3BlcnR5ICdab25lTmFtZScgJFpvbmVOYW1lCgogICAgICAgICAgICAgICAgIyBjb252ZXJ0IHRoZSByZWNvcmQgYW5kIGV4dHJhY3QgdGhlIHByb3BlcnRpZXMKICAgICAgICAgICAgICAgIGlmICgkUHJvcGVydGllcy5kbnNyZWNvcmQgLWlzIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuUmVzdWx0UHJvcGVydHlWYWx1ZUNvbGxlY3Rpb25dKSB7CiAgICAgICAgICAgICAgICAgICAgIyBUT0RPOiBoYW5kbGUgbXVsdGlwbGUgbmVzdGVkIHJlY29yZHMgcHJvcGVybHk/CiAgICAgICAgICAgICAgICAgICAgJFJlY29yZCA9IENvbnZlcnQtRE5TUmVjb3JkIC1ETlNSZWNvcmQgJFByb3BlcnRpZXMuZG5zcmVjb3JkWzBdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkUmVjb3JkID0gQ29udmVydC1ETlNSZWNvcmQgLUROU1JlY29yZCAkUHJvcGVydGllcy5kbnNyZWNvcmQKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigkUmVjb3JkKSB7CiAgICAgICAgICAgICAgICAgICAgJFJlY29yZC5wc29iamVjdC5wcm9wZXJ0aWVzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAkUHJvcGVydGllcyB8IEFkZC1NZW1iZXIgTm90ZVByb3BlcnR5ICRfLk5hbWUgJF8uVmFsdWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJFByb3BlcnRpZXMKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJFUlJPUjogJF8iCiAgICAgICAgICAgICAgICAkUHJvcGVydGllcwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICRETlNTZWFyY2hlci5kaXNwb3NlKCkKICAgIH0KfQoKCmZpbHRlciBHZXQtTmV0RG9tYWluIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXR1cm5zIGEgZ2l2ZW4gZG9tYWluIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIG5hbWUgdG8gcXVlcnkgZm9yLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXREb21haW4gLURvbWFpbiB0ZXN0bGFiLmxvY2FsCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiAidGVzdGxhYi5sb2NhbCIgfCBHZXQtTmV0RG9tYWluCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL3NvY2lhbC50ZWNobmV0Lm1pY3Jvc29mdC5jb20vRm9ydW1zL3NjcmlwdGNlbnRlci9lbi1VUy8wYzViM2Y4My1lNTI4LTRkNDktOTJhNC1kZWUzMWY0YjQ4MWMvZmluZGluZy10aGUtZG4tb2YtdGhlLXRoZS1kb21haW4td2l0aG91dC1hZG1vZHVsZS1pbi1wb3dlcnNoZWxsP2ZvcnVtPUlUQ0cKIz4KCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgaWYoJENyZWRlbnRpYWwpIHsKCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiVXNpbmcgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzIGZvciBHZXQtTmV0RG9tYWluIgoKICAgICAgICBpZighJERvbWFpbikgewogICAgICAgICAgICAjIGlmIG5vIGRvbWFpbiBpcyBzdXBwbGllZCwgZXh0cmFjdCB0aGUgbG9nb24gZG9tYWluIGZyb20gdGhlIFBTQ3JlZGVudGlhbCBwYXNzZWQKICAgICAgICAgICAgJERvbWFpbiA9ICRDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuRG9tYWluCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkV4dHJhY3RlZCBkb21haW4gJyREb21haW4nIGZyb20gLUNyZWRlbnRpYWwiCiAgICAgICAgfQoKICAgICAgICAkRG9tYWluQ29udGV4dCA9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeS5EaXJlY3RvcnlDb250ZXh0KCdEb21haW4nLCAkRG9tYWluLCAkQ3JlZGVudGlhbC5Vc2VyTmFtZSwgJENyZWRlbnRpYWwuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5QYXNzd29yZCkKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRG9tYWluXTo6R2V0RG9tYWluKCREb21haW5Db250ZXh0KQogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlRoZSBzcGVjaWZpZWQgZG9tYWluIGRvZXMgJyREb21haW4nIG5vdCBleGlzdCwgY291bGQgbm90IGJlIGNvbnRhY3RlZCwgdGhlcmUgaXNuJ3QgYW4gZXhpc3RpbmcgdHJ1c3QsIG9yIHRoZSBzcGVjaWZpZWQgY3JlZGVudGlhbHMgYXJlIGludmFsaWQuIgogICAgICAgICAgICAkTnVsbAogICAgICAgIH0KICAgIH0KICAgIGVsc2VpZigkRG9tYWluKSB7CiAgICAgICAgJERvbWFpbkNvbnRleHQgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRGlyZWN0b3J5Q29udGV4dCgnRG9tYWluJywgJERvbWFpbikKICAgICAgICB0cnkgewogICAgICAgICAgICBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeS5Eb21haW5dOjpHZXREb21haW4oJERvbWFpbkNvbnRleHQpCiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVGhlIHNwZWNpZmllZCBkb21haW4gJyREb21haW4nIGRvZXMgbm90IGV4aXN0LCBjb3VsZCBub3QgYmUgY29udGFjdGVkLCBvciB0aGVyZSBpc24ndCBhbiBleGlzdGluZyB0cnVzdC4iCiAgICAgICAgICAgICROdWxsCiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRG9tYWluXTo6R2V0Q3VycmVudERvbWFpbigpCiAgICB9Cn0KCgpmaWx0ZXIgR2V0LU5ldEZvcmVzdCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUmV0dXJucyBhIGdpdmVuIGZvcmVzdCBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBGb3Jlc3QKCiAgICAgICAgVGhlIGZvcmVzdCBuYW1lIHRvIHF1ZXJ5IGZvciwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Rm9yZXN0IC1Gb3Jlc3QgZXh0ZXJuYWwuZG9tYWluCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiAiZXh0ZXJuYWwuZG9tYWluIiB8IEdldC1OZXRGb3Jlc3QKIz4KCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRGb3Jlc3QsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgaWYoJENyZWRlbnRpYWwpIHsKCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiVXNpbmcgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzIGZvciBHZXQtTmV0Rm9yZXN0IgoKICAgICAgICBpZighJEZvcmVzdCkgewogICAgICAgICAgICAjIGlmIG5vIGRvbWFpbiBpcyBzdXBwbGllZCwgZXh0cmFjdCB0aGUgbG9nb24gZG9tYWluIGZyb20gdGhlIFBTQ3JlZGVudGlhbCBwYXNzZWQKICAgICAgICAgICAgJEZvcmVzdCA9ICRDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuRG9tYWluCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkV4dHJhY3RlZCBkb21haW4gJyRGb3Jlc3QnIGZyb20gLUNyZWRlbnRpYWwiCiAgICAgICAgfQoKICAgICAgICAkRm9yZXN0Q29udGV4dCA9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeS5EaXJlY3RvcnlDb250ZXh0KCdGb3Jlc3QnLCAkRm9yZXN0LCAkQ3JlZGVudGlhbC5Vc2VyTmFtZSwgJENyZWRlbnRpYWwuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5QYXNzd29yZCkKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJEZvcmVzdE9iamVjdCA9IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5LkZvcmVzdF06OkdldEZvcmVzdCgkRm9yZXN0Q29udGV4dCkKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJUaGUgc3BlY2lmaWVkIGZvcmVzdCAnJEZvcmVzdCcgZG9lcyBub3QgZXhpc3QsIGNvdWxkIG5vdCBiZSBjb250YWN0ZWQsIHRoZXJlIGlzbid0IGFuIGV4aXN0aW5nIHRydXN0LCBvciB0aGUgc3BlY2lmaWVkIGNyZWRlbnRpYWxzIGFyZSBpbnZhbGlkLiIKICAgICAgICAgICAgJE51bGwKICAgICAgICB9CiAgICB9CiAgICBlbHNlaWYoJEZvcmVzdCkgewogICAgICAgICRGb3Jlc3RDb250ZXh0ID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5LkRpcmVjdG9yeUNvbnRleHQoJ0ZvcmVzdCcsICRGb3Jlc3QpCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJEZvcmVzdE9iamVjdCA9IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5LkZvcmVzdF06OkdldEZvcmVzdCgkRm9yZXN0Q29udGV4dCkKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJUaGUgc3BlY2lmaWVkIGZvcmVzdCAnJEZvcmVzdCcgZG9lcyBub3QgZXhpc3QsIGNvdWxkIG5vdCBiZSBjb250YWN0ZWQsIG9yIHRoZXJlIGlzbid0IGFuIGV4aXN0aW5nIHRydXN0LiIKICAgICAgICAgICAgcmV0dXJuICROdWxsCiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgIyBvdGhlcndpc2UgdXNlIHRoZSBjdXJyZW50IGZvcmVzdAogICAgICAgICRGb3Jlc3RPYmplY3QgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeS5Gb3Jlc3RdOjpHZXRDdXJyZW50Rm9yZXN0KCkKICAgIH0KCiAgICBpZigkRm9yZXN0T2JqZWN0KSB7CiAgICAgICAgIyBnZXQgdGhlIFNJRCBvZiB0aGUgZm9yZXN0IHJvb3QKICAgICAgICAkRm9yZXN0U2lkID0gKE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5OVEFjY291bnQoJEZvcmVzdE9iamVjdC5Sb290RG9tYWluLCJrcmJ0Z3QiKSkuVHJhbnNsYXRlKFtTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcl0pLlZhbHVlCiAgICAgICAgJFBhcnRzID0gJEZvcmVzdFNpZCAtU3BsaXQgIi0iCiAgICAgICAgJEZvcmVzdFNpZCA9ICRQYXJ0c1swLi4kKCRQYXJ0cy5sZW5ndGgtMildIC1qb2luICItIgogICAgICAgICRGb3Jlc3RPYmplY3QgfCBBZGQtTWVtYmVyIE5vdGVQcm9wZXJ0eSAnUm9vdERvbWFpblNpZCcgJEZvcmVzdFNpZAogICAgICAgICRGb3Jlc3RPYmplY3QKICAgIH0KfQoKCmZpbHRlciBHZXQtTmV0Rm9yZXN0RG9tYWluIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXR1cm4gYWxsIGRvbWFpbnMgZm9yIGEgZ2l2ZW4gZm9yZXN0LgoKICAgIC5QQVJBTUVURVIgRm9yZXN0CgogICAgICAgIFRoZSBmb3Jlc3QgbmFtZSB0byBxdWVyeSBkb21haW4gZm9yLgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Rm9yZXN0RG9tYWluCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Rm9yZXN0RG9tYWluIC1Gb3Jlc3QgZXh0ZXJuYWwubG9jYWwKIz4KCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRGb3Jlc3QsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgJEZvcmVzdE9iamVjdCA9IEdldC1OZXRGb3Jlc3QgLUZvcmVzdCAkRm9yZXN0IC1DcmVkZW50aWFsICRDcmVkZW50aWFsCgogICAgaWYoJEZvcmVzdE9iamVjdCkgewogICAgICAgICRGb3Jlc3RPYmplY3QuRG9tYWlucwogICAgfQp9CgoKZmlsdGVyIEdldC1OZXRGb3Jlc3RDYXRhbG9nIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXR1cm4gYWxsIGdsb2JhbCBjYXRhbG9ncyBmb3IgYSBnaXZlbiBmb3Jlc3QuCgogICAgLlBBUkFNRVRFUiBGb3Jlc3QKCiAgICAgICAgVGhlIGZvcmVzdCBuYW1lIHRvIHF1ZXJ5IGRvbWFpbiBmb3IuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRGb3Jlc3RDYXRhbG9nCiM+CgogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRm9yZXN0LAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgICRGb3Jlc3RPYmplY3QgPSBHZXQtTmV0Rm9yZXN0IC1Gb3Jlc3QgJEZvcmVzdCAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbAoKICAgIGlmKCRGb3Jlc3RPYmplY3QpIHsKICAgICAgICAkRm9yZXN0T2JqZWN0LkZpbmRBbGxHbG9iYWxDYXRhbG9ncygpCiAgICB9Cn0KCgpmaWx0ZXIgR2V0LU5ldERvbWFpbkNvbnRyb2xsZXIgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFJldHVybiB0aGUgY3VycmVudCBkb21haW4gY29udHJvbGxlcnMgZm9yIHRoZSBhY3RpdmUgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIGRvbWFpbiBjb250cm9sbGVycywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgTERBUAoKICAgICAgICBTd2l0Y2guIFVzZSBMREFQIHF1ZXJpZXMgdG8gZGV0ZXJtaW5lIHRoZSBkb21haW4gY29udHJvbGxlcnMuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXREb21haW5Db250cm9sbGVyIC1Eb21haW4gJ3Rlc3QubG9jYWwnCgogICAgICAgIERldGVybWluZSB0aGUgZG9tYWluIGNvbnRyb2xsZXJzIGZvciAndGVzdC5sb2NhbCcuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0RG9tYWluQ29udHJvbGxlciAtRG9tYWluICd0ZXN0LmxvY2FsJyAtTERBUAoKICAgICAgICBEZXRlcm1pbmUgdGhlIGRvbWFpbiBjb250cm9sbGVycyBmb3IgJ3Rlc3QubG9jYWwnIHVzaW5nIExEQVAgcXVlcmllcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+ICd0ZXN0LmxvY2FsJyB8IEdldC1OZXREb21haW5Db250cm9sbGVyCgogICAgICAgIERldGVybWluZSB0aGUgZG9tYWluIGNvbnRyb2xsZXJzIGZvciAndGVzdC5sb2NhbCcuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTERBUCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBpZigkTERBUCAtb3IgJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAjIGZpbHRlciBzdHJpbmcgdG8gcmV0dXJuIGFsbCBkb21haW4gY29udHJvbGxlcnMKICAgICAgICBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1GdWxsRGF0YSAtRmlsdGVyICcodXNlckFjY291bnRDb250cm9sOjEuMi44NDAuMTEzNTU2LjEuNC44MDM6PTgxOTIpJwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJEZvdW5kRG9tYWluID0gR2V0LU5ldERvbWFpbiAtRG9tYWluICREb21haW4gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwKICAgICAgICBpZigkRm91bmREb21haW4pIHsKICAgICAgICAgICAgJEZvdW5kZG9tYWluLkRvbWFpbkNvbnRyb2xsZXJzCiAgICAgICAgfQogICAgfQp9CgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojICJuZXQgKiIgcmVwbGFjZW1lbnRzIGFuZCBvdGhlciBmdW4gc3RhcnQgYmVsb3cKIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKZnVuY3Rpb24gR2V0LU5ldFVzZXIgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFF1ZXJ5IGluZm9ybWF0aW9uIGZvciBhIGdpdmVuIHVzZXIgb3IgdXNlcnMgaW4gdGhlIGRvbWFpbgogICAgICAgIHVzaW5nIEFEU0kgYW5kIExEQVAuIEFub3RoZXIgLURvbWFpbiBjYW4gYmUgc3BlY2lmaWVkIHRvCiAgICAgICAgcXVlcnkgZm9yIHVzZXJzIGFjcm9zcyBhIHRydXN0LgogICAgICAgIFJlcGxhY2VtZW50IGZvciAibmV0IHVzZXJzIC9kb21haW4iCgogICAgLlBBUkFNRVRFUiBVc2VyTmFtZQoKICAgICAgICBVc2VybmFtZSBmaWx0ZXIgc3RyaW5nLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgdXNlcnMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgRmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlLCBlLmcuICIoZGVzY3JpcHRpb249KmFkbWluKikiCgogICAgLlBBUkFNRVRFUiBBZG1pbkNvdW50CgogICAgICAgIFN3aXRjaC4gUmV0dXJuIHVzZXJzIHdpdGggYWRtaW5Db3VudD0xLgoKICAgIC5QQVJBTUVURVIgU1BOCgogICAgICAgIFN3aXRjaC4gT25seSByZXR1cm4gdXNlciBvYmplY3RzIHdpdGggbm9uLW51bGwgc2VydmljZSBwcmluY2lwYWwgbmFtZXMuCgogICAgLlBBUkFNRVRFUiBVbmNvbnN0cmFpbmVkCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIHVzZXJzIHRoYXQgaGF2ZSB1bmNvbnN0cmFpbmVkIGRlbGVnYXRpb24uCgogICAgLlBBUkFNRVRFUiBBbGxvd0RlbGVnYXRpb24KCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gdXNlciBhY2NvdW50cyB0aGF0IGFyZSBub3QgbWFya2VkIGFzICdzZW5zaXRpdmUgYW5kIG5vdCBhbGxvd2VkIGZvciBkZWxlZ2F0aW9uJwoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0VXNlciAtRG9tYWluIHRlc3RpbmcKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRVc2VyIC1BRFNwYXRoICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiM+CgogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlck5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRmlsdGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTUE4sCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEFkbWluQ291bnQsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVuY29uc3RyYWluZWQsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEFsbG93RGVsZWdhdGlvbiwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgYmVnaW4gewogICAgICAgIGlmKCREb21haW4pIHsKICAgICAgICAgICAgJFRhcmdldERvbWFpbiA9ICREb21haW4KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRUYXJnZXREb21haW4gPSAoR2V0LU5ldERvbWFpbikubmFtZQogICAgICAgIH0KCiAgICAgICAgIyBzbyB0aGlzIGlzbid0IHJlcGVhdGVkIGlmIHVzZXJzIGFyZSBwYXNzZWQgb24gdGhlIHBpcGVsaW5lCiAgICAgICAgJFVzZXJTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICRUYXJnZXREb21haW4gLUFEU3BhdGggJEFEU3BhdGggLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZSAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbAoKICAgICAgICAkUHJpbWFyeUdyb3VwcyA9IEB7fQogICAgfQoKICAgIHByb2Nlc3MgewogICAgICAgIGlmKCRVc2VyU2VhcmNoZXIpIHsKCiAgICAgICAgICAgICMgaWYgd2UncmUgY2hlY2tpbmcgZm9yIHVuY29uc3RyYWluZWQgZGVsZWdhdGlvbgogICAgICAgICAgICBpZigkVW5jb25zdHJhaW5lZCkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiQ2hlY2tpbmcgZm9yIHVuY29uc3RyYWluZWQgZGVsZWdhdGlvbiIKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIih1c2VyQWNjb3VudENvbnRyb2w6MS4yLjg0MC4xMTM1NTYuMS40LjgwMzo9NTI0Mjg4KSIKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkQWxsb3dEZWxlZ2F0aW9uKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDaGVja2luZyBmb3IgdXNlcnMgd2hvIGNhbiBiZSBkZWxlZ2F0ZWQiCiAgICAgICAgICAgICAgICAjIG5lZ2F0aW9uIG9mICJBY2NvdW50cyB0aGF0IGFyZSBzZW5zaXRpdmUgYW5kIG5vdCB0cnVzdGVkIGZvciBkZWxlZ2F0aW9uIgogICAgICAgICAgICAgICAgJEZpbHRlciArPSAiKCEodXNlckFjY291bnRDb250cm9sOjEuMi44NDAuMTEzNTU2LjEuNC44MDM6PTEwNDg1NzQpKSIKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkQWRtaW5Db3VudCkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiQ2hlY2tpbmcgZm9yIGFkbWluQ291bnQ9MSIKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIihhZG1pbmNvdW50PTEpIgogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGNoZWNrIGlmIHdlJ3JlIHVzaW5nIGEgdXNlcm5hbWUgZmlsdGVyIG9yIG5vdAogICAgICAgICAgICBpZigkVXNlck5hbWUpIHsKICAgICAgICAgICAgICAgICMgc2FtQWNjb3VudFR5cGU9ODA1MzA2MzY4IGluZGljYXRlcyB1c2VyIG9iamVjdHMKICAgICAgICAgICAgICAgICRVc2VyU2VhcmNoZXIuZmlsdGVyPSIoJihzYW1BY2NvdW50VHlwZT04MDUzMDYzNjgpKHNhbUFjY291bnROYW1lPSRVc2VyTmFtZSkkRmlsdGVyKSIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoJFNQTikgewogICAgICAgICAgICAgICAgJFVzZXJTZWFyY2hlci5maWx0ZXI9IigmKHNhbUFjY291bnRUeXBlPTgwNTMwNjM2OCkoc2VydmljZVByaW5jaXBhbE5hbWU9KikkRmlsdGVyKSIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICMgZmlsdGVyIGlzIHNvbWV0aGluZyBsaWtlICIoc2FtQWNjb3VudE5hbWU9KmJsYWgqKSIgaWYgc3BlY2lmaWVkCiAgICAgICAgICAgICAgICAkVXNlclNlYXJjaGVyLmZpbHRlcj0iKCYoc2FtQWNjb3VudFR5cGU9ODA1MzA2MzY4KSRGaWx0ZXIpIgogICAgICAgICAgICB9CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJFJlc3VsdHMgPSAkVXNlclNlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQvcHJvY2VzcyB0aGUgTERBUCBmaWVsZHMgZm9yIGVhY2ggcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgJFVzZXIgPSBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkXy5Qcm9wZXJ0aWVzCgogICAgICAgICAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlUHJvcGVydHkgJ0RvbWFpbicgJFRhcmdldERvbWFpbgoKICAgICAgICAgICAgICAgICAgICAkRG9tYWluU0lEID0gJFVzZXIub2JqZWN0c2lkLlN1YnN0cmluZygwLCAkVXNlci5vYmplY3RzaWQuTGFzdEluZGV4T2YoJy0nKSkKICAgICAgICAgICAgICAgICAgICAkUHJpbWFyeUdyb3VwU0lEID0gIiREb21haW5TSUQtJCgkVXNlci5wcmltYXJ5Z3JvdXBpZCkiCgogICAgICAgICAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlUHJvcGVydHkgJ1ByaW1hcnlHcm91cFNJRCcgJFByaW1hcnlHcm91cFNJRAoKICAgICAgICAgICAgICAgICAgICBpZigkUHJpbWFyeUdyb3Vwc1skUHJpbWFyeUdyb3VwU0lEXSkgewogICAgICAgICAgICAgICAgICAgICAgICAkUHJpbWFyeUdyb3VwTmFtZSA9ICRQcmltYXJ5R3JvdXBzWyRQcmltYXJ5R3JvdXBTSURdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkUHJpbWFyeUdyb3VwTmFtZSA9IEdldC1BRE9iamVjdCAtRG9tYWluICREb21haW4gLVNJRCAkUHJpbWFyeUdyb3VwU0lEIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgc2FtYWNjb3VudG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJFByaW1hcnlHcm91cHNbJFByaW1hcnlHcm91cFNJRF0gPSAkUHJpbWFyeUdyb3VwTmFtZQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVQcm9wZXJ0eSAnUHJpbWFyeUdyb3VwTmFtZScgJFByaW1hcnlHcm91cE5hbWUKCiAgICAgICAgICAgICAgICAgICAgJFVzZXIuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LlVzZXInKQogICAgICAgICAgICAgICAgICAgICRVc2VyCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBidWlsZGluZyB0aGUgVXNlclNlYXJjaGVyIHNlYXJjaGVyIG9iamVjdCEiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJFVzZXJTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBBZGQtTmV0VXNlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQWRkcyBhIGRvbWFpbiB1c2VyIG9yIGEgbG9jYWwgdXNlciB0byB0aGUgY3VycmVudCAob3IgcmVtb3RlKSBtYWNoaW5lLAogICAgICAgIGlmIHBlcm1pc3Npb25zIGFsbG93LCB1dGlsaXppbmcgdGhlIFdpbk5UIHNlcnZpY2UgcHJvdmlkZXIgYW5kCiAgICAgICAgRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQsIHJlc3BlY3RpdmVseS4KCiAgICAgICAgVGhlIGRlZmF1bHQgYmVoYXZpb3IgaXMgdG8gYWRkIGEgdXNlciB0byB0aGUgbG9jYWwgbWFjaGluZS4KICAgICAgICBBbiBvcHRpb25hbCBncm91cCBuYW1lIHRvIGFkZCB0aGUgdXNlciB0byBjYW4gYmUgc3BlY2lmaWVkLgoKICAgIC5QQVJBTUVURVIgVXNlck5hbWUKCiAgICAgICAgVGhlIHVzZXJuYW1lIHRvIGFkZC4gSWYgbm90IGdpdmVuLCBpdCBkZWZhdWx0cyB0byAnYmFja2Rvb3InCgogICAgLlBBUkFNRVRFUiBQYXNzd29yZAoKICAgICAgICBUaGUgcGFzc3dvcmQgdG8gc2V0IGZvciB0aGUgYWRkZWQgdXNlci4gSWYgbm90IGdpdmVuLCBpdCBkZWZhdWx0cyB0byAnUGFzc3dvcmQxMjMhJwoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIEdyb3VwIHRvIG9wdGlvbmFsbHkgYWRkIHRoZSB1c2VyIHRvLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIEhvc3RuYW1lIHRvIGFkZCB0aGUgbG9jYWwgdXNlciB0bywgZGVmYXVsdHMgdG8gJ2xvY2FsaG9zdCcKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBTcGVjaWZpZWQgZG9tYWluIHRvIGFkZCB0aGUgdXNlciB0by4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEFkZC1OZXRVc2VyIC1Vc2VyTmFtZSBqb2huIC1QYXNzd29yZCAnUGFzc3dvcmQxMjMhJwoKICAgICAgICBBZGRzIGEgbG9jYWx1c2VyICdqb2huJyB0byB0aGUgbG9jYWwgbWFjaGluZSB3aXRoIHBhc3N3b3JkIG9mICdQYXNzd29yZDEyMyEnCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBBZGQtTmV0VXNlciAtVXNlck5hbWUgam9obiAtUGFzc3dvcmQgJ1Bhc3N3b3JkMTIzIScgLUNvbXB1dGVyTmFtZSBzZXJ2ZXIudGVzdGxhYi5sb2NhbAoKICAgICAgICBBZGRzIGEgbG9jYWx1c2VyICdqb2huJyB3aXRoIHBhc3N3b3JkIG9mICdQYXNzd29yZDEyMyEnIHRvIHNlcnZlci50ZXN0bGFiLmxvY2FsJ3MgbG9jYWwgQWRtaW5pc3RyYXRvcnMgZ3JvdXAuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBBZGQtTmV0VXNlciAtVXNlck5hbWUgam9obiAtUGFzc3dvcmQgcGFzc3dvcmQgLUdyb3VwTmFtZSAiRG9tYWluIEFkbWlucyIgLURvbWFpbiAnJwoKICAgICAgICBBZGRzIHRoZSB1c2VyICJqb2huIiB3aXRoIHBhc3N3b3JkICJwYXNzd29yZCIgdG8gdGhlIGN1cnJlbnQgZG9tYWluIGFuZCBhZGRzCiAgICAgICAgdGhlIHVzZXIgdG8gdGhlIGRvbWFpbiBncm91cCAiRG9tYWluIEFkbWlucyIKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEFkZC1OZXRVc2VyIC1Vc2VyTmFtZSBqb2huIC1QYXNzd29yZCBwYXNzd29yZCAtR3JvdXBOYW1lICJEb21haW4gQWRtaW5zIiAtRG9tYWluICd0ZXN0aW5nJwoKICAgICAgICBBZGRzIHRoZSB1c2VyICJqb2huIiB3aXRoIHBhc3N3b3JkICJwYXNzd29yZCIgdG8gdGhlICd0ZXN0aW5nJyBkb21haW4gYW5kIGFkZHMKICAgICAgICB0aGUgdXNlciB0byB0aGUgZG9tYWluIGdyb3VwICJEb21haW4gQWRtaW5zIgoKICAgIC5MaW5rCgogICAgICAgIGh0dHA6Ly9ibG9ncy50ZWNobmV0LmNvbS9iL2hleXNjcmlwdGluZ2d1eS9hcmNoaXZlLzIwMTAvMTEvMjMvdXNlLXBvd2Vyc2hlbGwtdG8tY3JlYXRlLWxvY2FsLXVzZXItYWNjb3VudHMuYXNweAojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyTmFtZSA9ICdiYWNrZG9vcicsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkUGFzc3dvcmQgPSAnUGFzc3dvcmQxMjMhJywKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRHcm91cE5hbWUsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICdsb2NhbGhvc3QnLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbgogICAgKQoKICAgIGlmICgkRG9tYWluKSB7CgogICAgICAgICREb21haW5PYmplY3QgPSBHZXQtTmV0RG9tYWluIC1Eb21haW4gJERvbWFpbgogICAgICAgIGlmKC1ub3QgJERvbWFpbk9iamVjdCkgewogICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBpbiBncmFiYmluZyAkRG9tYWluIG9iamVjdCIKICAgICAgICAgICAgcmV0dXJuICROdWxsCiAgICAgICAgfQoKICAgICAgICAjIGFkZCB0aGUgYXNzZW1ibHkgd2UgbmVlZAogICAgICAgIEFkZC1UeXBlIC1Bc3NlbWJseU5hbWUgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50CgogICAgICAgICMgaHR0cDovL3JpY2hhcmRzcG93ZXJzaGVsbGJsb2cud29yZHByZXNzLmNvbS8yMDA4LzA1LzI1L3N5c3RlbS1kaXJlY3RvcnlzZXJ2aWNlcy1hY2NvdW50bWFuYWdlbWVudC8KICAgICAgICAjIGdldCB0aGUgZG9tYWluIGNvbnRleHQKICAgICAgICAkQ29udGV4dCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5QcmluY2lwYWxDb250ZXh0IC1Bcmd1bWVudExpc3QgKFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuQ29udGV4dFR5cGVdOjpEb21haW4pLCAkRG9tYWluT2JqZWN0CgogICAgICAgICMgY3JlYXRlIHRoZSB1c2VyIG9iamVjdAogICAgICAgICRVc2VyID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LlVzZXJQcmluY2lwYWwgLUFyZ3VtZW50TGlzdCAkQ29udGV4dAoKICAgICAgICAjIHNldCB1c2VyIHByb3BlcnRpZXMKICAgICAgICAkVXNlci5OYW1lID0gJFVzZXJOYW1lCiAgICAgICAgJFVzZXIuU2FtQWNjb3VudE5hbWUgPSAkVXNlck5hbWUKICAgICAgICAkVXNlci5QYXNzd29yZE5vdFJlcXVpcmVkID0gJEZhbHNlCiAgICAgICAgJFVzZXIuU2V0UGFzc3dvcmQoJFBhc3N3b3JkKQogICAgICAgICRVc2VyLkVuYWJsZWQgPSAkVHJ1ZQoKICAgICAgICBXcml0ZS1WZXJib3NlICJDcmVhdGluZyB1c2VyICRVc2VyTmFtZSB0byB3aXRoIHBhc3N3b3JkICckUGFzc3dvcmQnIGluIGRvbWFpbiAkRG9tYWluIgoKICAgICAgICB0cnkgewogICAgICAgICAgICAjIGNvbW1pdCB0aGUgdXNlcgogICAgICAgICAgICAkVXNlci5TYXZlKCkKICAgICAgICAgICAgIlsqXSBVc2VyICRVc2VyTmFtZSBzdWNjZXNzZnVsbHkgY3JlYXRlZCBpbiBkb21haW4gJERvbWFpbiIKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1XYXJuaW5nICdbIV0gVXNlciBhbHJlYWR5IGV4aXN0cyEnCiAgICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgIH0KICAgIGVsc2UgewoKICAgICAgICBXcml0ZS1WZXJib3NlICJDcmVhdGluZyB1c2VyICRVc2VyTmFtZSB0byB3aXRoIHBhc3N3b3JkICckUGFzc3dvcmQnIG9uICRDb21wdXRlck5hbWUiCgogICAgICAgICMgaWYgaXQncyBub3QgYSBkb21haW4gYWRkLCBpdCdzIGEgbG9jYWwgbWFjaGluZSBhZGQKICAgICAgICAkT2JqT3UgPSBbQURTSV0iV2luTlQ6Ly8kQ29tcHV0ZXJOYW1lIgogICAgICAgICRPYmpVc2VyID0gJE9iak91LkNyZWF0ZSgnVXNlcicsICRVc2VyTmFtZSkKICAgICAgICAkT2JqVXNlci5TZXRQYXNzd29yZCgkUGFzc3dvcmQpCgogICAgICAgICMgY29tbWl0IHRoZSBjaGFuZ2VzIHRvIHRoZSBsb2NhbCBtYWNoaW5lCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJE51bGwgPSAkT2JqVXNlci5TZXRJbmZvKCkKICAgICAgICAgICAgIlsqXSBVc2VyICRVc2VyTmFtZSBzdWNjZXNzZnVsbHkgY3JlYXRlZCBvbiBob3N0ICRDb21wdXRlck5hbWUiCiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAnWyFdIEFjY291bnQgYWxyZWFkeSBleGlzdHMhJwogICAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICB9CgogICAgIyBpZiBhIGdyb3VwIGlzIHNwZWNpZmllZCwgaW52b2tlIEFkZC1OZXRHcm91cFVzZXIgYW5kIHJldHVybiBpdHMgdmFsdWUKICAgIGlmICgkR3JvdXBOYW1lKSB7CiAgICAgICAgIyBpZiB3ZSdyZSBhZGRpbmcgdGhlIHVzZXIgdG8gYSBkb21haW4KICAgICAgICBpZiAoJERvbWFpbikgewogICAgICAgICAgICBBZGQtTmV0R3JvdXBVc2VyIC1Vc2VyTmFtZSAkVXNlck5hbWUgLUdyb3VwTmFtZSAkR3JvdXBOYW1lIC1Eb21haW4gJERvbWFpbgogICAgICAgICAgICAiWypdIFVzZXIgJFVzZXJOYW1lIHN1Y2Nlc3NmdWxseSBhZGRlZCB0byBncm91cCAkR3JvdXBOYW1lIGluIGRvbWFpbiAkRG9tYWluIgogICAgICAgIH0KICAgICAgICAjIG90aGVyd2lzZSwgd2UncmUgYWRkaW5nIHRvIGEgbG9jYWwgZ3JvdXAKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgQWRkLU5ldEdyb3VwVXNlciAtVXNlck5hbWUgJFVzZXJOYW1lIC1Hcm91cE5hbWUgJEdyb3VwTmFtZSAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICAgICAgIlsqXSBVc2VyICRVc2VyTmFtZSBzdWNjZXNzZnVsbHkgYWRkZWQgdG8gZ3JvdXAgJEdyb3VwTmFtZSBvbiBob3N0ICRDb21wdXRlck5hbWUiCiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gQWRkLU5ldEdyb3VwVXNlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQWRkcyBhIHVzZXIgdG8gYSBkb21haW4gZ3JvdXAgb3IgYSBsb2NhbCBncm91cCBvbiB0aGUgY3VycmVudCAob3IgcmVtb3RlKSBtYWNoaW5lLAogICAgICAgIGlmIHBlcm1pc3Npb25zIGFsbG93LCB1dGlsaXppbmcgdGhlIFdpbk5UIHNlcnZpY2UgcHJvdmlkZXIgYW5kCiAgICAgICAgRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQsIHJlc3BlY3RpdmVseS4KCiAgICAuUEFSQU1FVEVSIFVzZXJOYW1lCgogICAgICAgIFRoZSBkb21haW4gdXNlcm5hbWUgdG8gcXVlcnkgZm9yLgoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIEdyb3VwIHRvIGFkZCB0aGUgdXNlciB0by4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBIb3N0bmFtZSB0byBhZGQgdGhlIHVzZXIgdG8sIGRlZmF1bHRzIHRvIGxvY2FsaG9zdC4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBEb21haW4gdG8gYWRkIHRoZSB1c2VyIHRvLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gQWRkLU5ldEdyb3VwVXNlciAtVXNlck5hbWUgam9obiAtR3JvdXBOYW1lIEFkbWluaXN0cmF0b3JzCgogICAgICAgIEFkZHMgYSBsb2NhbHVzZXIgImpvaG4iIHRvIHRoZSBsb2NhbCBncm91cCAiQWRtaW5pc3RyYXRvcnMiCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBBZGQtTmV0R3JvdXBVc2VyIC1Vc2VyTmFtZSBqb2huIC1Hcm91cE5hbWUgIkRvbWFpbiBBZG1pbnMiIC1Eb21haW4gZGV2LmxvY2FsCgogICAgICAgIEFkZHMgdGhlIGV4aXN0aW5nIHVzZXIgImpvaG4iIHRvIHRoZSBkb21haW4gZ3JvdXAgIkRvbWFpbiBBZG1pbnMiIGluICJkZXYubG9jYWwiCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlck5hbWUsCgogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlck5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbgogICAgKQoKICAgICMgYWRkIHRoZSBhc3NlbWJseSBpZiB3ZSBuZWVkIGl0CiAgICBBZGQtVHlwZSAtQXNzZW1ibHlOYW1lIFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudAoKICAgICMgaWYgd2UncmUgYWRkaW5nIHRvIGEgcmVtb3RlIGhvc3QncyBsb2NhbCBncm91cCwgdXNlIHRoZSBXaW5OVCBwcm92aWRlcgogICAgaWYoJENvbXB1dGVyTmFtZSAtYW5kICgkQ29tcHV0ZXJOYW1lIC1uZSAibG9jYWxob3N0IikpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJBZGRpbmcgdXNlciAkVXNlck5hbWUgdG8gJEdyb3VwTmFtZSBvbiBob3N0ICRDb21wdXRlck5hbWUiCiAgICAgICAgICAgIChbQURTSV0iV2luTlQ6Ly8kQ29tcHV0ZXJOYW1lLyRHcm91cE5hbWUsZ3JvdXAiKS5hZGQoIldpbk5UOi8vJENvbXB1dGVyTmFtZS8kVXNlck5hbWUsdXNlciIpCiAgICAgICAgICAgICJbKl0gVXNlciAkVXNlck5hbWUgc3VjY2Vzc2Z1bGx5IGFkZGVkIHRvIGdyb3VwICRHcm91cE5hbWUgb24gJENvbXB1dGVyTmFtZSIKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJbIV0gRXJyb3IgYWRkaW5nIHVzZXIgJFVzZXJOYW1lIHRvIGdyb3VwICRHcm91cE5hbWUgb24gJENvbXB1dGVyTmFtZSIKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgfQoKICAgICMgb3RoZXJ3aXNlIGl0J3MgYSBsb2NhbCBtYWNoaW5lIG9yIGRvbWFpbiBhZGQKICAgIGVsc2UgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgkRG9tYWluKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJBZGRpbmcgdXNlciAkVXNlck5hbWUgdG8gJEdyb3VwTmFtZSBvbiBkb21haW4gJERvbWFpbiIKICAgICAgICAgICAgICAgICRDVCA9IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuQ29udGV4dFR5cGVdOjpEb21haW4KICAgICAgICAgICAgICAgICREb21haW5PYmplY3QgPSBHZXQtTmV0RG9tYWluIC1Eb21haW4gJERvbWFpbgogICAgICAgICAgICAgICAgaWYoLW5vdCAkRG9tYWluT2JqZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICROdWxsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAjIGdldCB0aGUgZnVsbCBwcmluY2lwYWwgY29udGV4dAogICAgICAgICAgICAgICAgJENvbnRleHQgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuUHJpbmNpcGFsQ29udGV4dCAtQXJndW1lbnRMaXN0ICRDVCwgJERvbWFpbk9iamVjdAogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgIyBvdGhlcndpc2UsIGdldCB0aGUgbG9jYWwgbWFjaGluZSBjb250ZXh0CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJBZGRpbmcgdXNlciAkVXNlck5hbWUgdG8gJEdyb3VwTmFtZSBvbiBsb2NhbGhvc3QiCiAgICAgICAgICAgICAgICAkQ29udGV4dCA9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LlByaW5jaXBhbENvbnRleHQoW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5Db250ZXh0VHlwZV06Ok1hY2hpbmUsICRFbnY6Q29tcHV0ZXJOYW1lKQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGZpbmQgdGhlIHBhcnRpY3VsYXIgZ3JvdXAKICAgICAgICAgICAgJEdyb3VwID0gW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5Hcm91cFByaW5jaXBhbF06OkZpbmRCeUlkZW50aXR5KCRDb250ZXh0LCRHcm91cE5hbWUpCgogICAgICAgICAgICAjIGFkZCB0aGUgcGFydGljdWxhciB1c2VyIHRvIHRoZSBncm91cAogICAgICAgICAgICAkR3JvdXAuTWVtYmVycy5hZGQoJENvbnRleHQsIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuSWRlbnRpdHlUeXBlXTo6U2FtQWNjb3VudE5hbWUsICRVc2VyTmFtZSkKCiAgICAgICAgICAgICMgY29tbWl0IHRoZSBjaGFuZ2VzCiAgICAgICAgICAgICRHcm91cC5TYXZlKCkKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBhZGRpbmcgJFVzZXJOYW1lIHRvICRHcm91cE5hbWUgOiAkXyIKICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtVXNlclByb3BlcnR5IHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXR1cm5zIGEgbGlzdCBvZiBhbGwgdXNlciBvYmplY3QgcHJvcGVydGllcy4gSWYgYSBwcm9wZXJ0eQogICAgICAgIG5hbWUgaXMgc3BlY2lmaWVkLCBpdCByZXR1cm5zIGFsbCBbdXNlcjpwcm9wZXJ0eV0gdmFsdWVzLgoKICAgICAgICBUYWtlbiBkaXJlY3RseSBmcm9tIEBvYnNjdXJlc2VjJ3MgcG9zdDoKICAgICAgICAgICAgaHR0cDovL29ic2N1cmVzZWN1cml0eS5ibG9nc3BvdC5jb20vMjAxNC8wNC9BRFNJU2VhcmNoZXIuaHRtbAoKICAgIC5QQVJBTUVURVIgUHJvcGVydGllcwoKICAgICAgICBQcm9wZXJ0eSBuYW1lcyB0byBleHRyYWN0IGZvciB1c2Vycy4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciB1c2VyIHByb3BlcnRpZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LVVzZXJQcm9wZXJ0eSAtRG9tYWluIHRlc3RpbmcKCiAgICAgICAgUmV0dXJucyBhbGwgdXNlciBwcm9wZXJ0aWVzIGZvciB1c2VycyBpbiB0aGUgJ3Rlc3RpbmcnIGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Vc2VyUHJvcGVydHkgLVByb3BlcnRpZXMgc3NuLGxhc3Rsb2dvbixsb2NhdGlvbgoKICAgICAgICBSZXR1cm5zIGFsbCBhbiBhcnJheSBvZiB1c2VyL3Nzbi9sYXN0bG9naW4vbG9jYXRpb24gY29tYmluYXRpb25zCiAgICAgICAgZm9yIHVzZXJzIGluIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vb2JzY3VyZXNlY3VyaXR5LmJsb2dzcG90LmNvbS8yMDE0LzA0L0FEU0lTZWFyY2hlci5odG1sCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkUHJvcGVydGllcywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0KICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBpZigkUHJvcGVydGllcykgewogICAgICAgICMgZXh0cmFjdCBvdXQgdGhlIHNldCBvZiBhbGwgcHJvcGVydGllcyBmb3IgZWFjaCBvYmplY3QKICAgICAgICAkUHJvcGVydGllcyA9ICwibmFtZSIgKyAkUHJvcGVydGllcwogICAgICAgIEdldC1OZXRVc2VyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIHwgU2VsZWN0LU9iamVjdCAtUHJvcGVydHkgJFByb3BlcnRpZXMKICAgIH0KICAgIGVsc2UgewogICAgICAgICMgZXh0cmFjdCBvdXQganVzdCB0aGUgcHJvcGVydHkgbmFtZXMKICAgICAgICBHZXQtTmV0VXNlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZSAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEgfCBHZXQtTWVtYmVyIC1NZW1iZXJUeXBlICpQcm9wZXJ0eSB8IFNlbGVjdC1PYmplY3QgLVByb3BlcnR5ICdOYW1lJwogICAgfQp9CgoKZmlsdGVyIEZpbmQtVXNlckZpZWxkIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBTZWFyY2hlcyB1c2VyIG9iamVjdCBmaWVsZHMgZm9yIGEgZ2l2ZW4gd29yZCAoZGVmYXVsdCAqcGFzcyopLiBEZWZhdWx0CiAgICAgICAgZmllbGQgYmVpbmcgc2VhcmNoZWQgaXMgJ2Rlc2NyaXB0aW9uJy4KCiAgICAgICAgVGFrZW4gZGlyZWN0bHkgZnJvbSBAb2JzY3VyZXNlYydzIHBvc3Q6CiAgICAgICAgICAgIGh0dHA6Ly9vYnNjdXJlc2VjdXJpdHkuYmxvZ3Nwb3QuY29tLzIwMTQvMDQvQURTSVNlYXJjaGVyLmh0bWwKCiAgICAuUEFSQU1FVEVSIFNlYXJjaFRlcm0KCiAgICAgICAgVGVybSB0byBzZWFyY2ggZm9yLCBkZWZhdWx0IG9mICJwYXNzIi4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaEZpZWxkCgogICAgICAgIFVzZXIgZmllbGQgdG8gc2VhcmNoLCBkZWZhdWx0IG9mICJkZXNjcmlwdGlvbiIuCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCwgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBEb21haW4gdG8gc2VhcmNoIGNvbXB1dGVyIGZpZWxkcyBmb3IsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gRmluZC1Vc2VyRmllbGQgLVNlYXJjaEZpZWxkIGluZm8gLVNlYXJjaFRlcm0gYmFja3VwCgogICAgICAgIEZpbmQgdXNlciBhY2NvdW50cyB3aXRoICJiYWNrdXAiIGluIHRoZSAiaW5mbyIgZmllbGQuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2VhcmNoVGVybSA9ICdwYXNzJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2VhcmNoRmllbGQgPSAnZGVzY3JpcHRpb24nLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIEdldC1OZXRVc2VyIC1BRFNwYXRoICRBRFNwYXRoIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRmlsdGVyICIoJFNlYXJjaEZpZWxkPSokU2VhcmNoVGVybSopIiAtUGFnZVNpemUgJFBhZ2VTaXplIHwgU2VsZWN0LU9iamVjdCBzYW1hY2NvdW50bmFtZSwkU2VhcmNoRmllbGQKfQoKCmZpbHRlciBHZXQtVXNlckV2ZW50IHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBEdW1wIGFuZCBwYXJzZSBzZWN1cml0eSBldmVudHMgcmVsYXRpbmcgdG8gYW4gYWNjb3VudCBsb2dvbiAoSUQgNDYyNCkKICAgICAgICBvciBhIFRHVCByZXF1ZXN0IGV2ZW50IChJRCA0NzY4KS4gSW50ZW5kZWQgdG8gYmUgdXNlZCBhbmQgdGVzdGVkIG9uCiAgICAgICAgV2luZG93cyAyMDA4IERvbWFpbiBDb250cm9sbGVycy4KICAgICAgICBBZG1pbiBSZXFkPyBZRVMKCiAgICAgICAgQXV0aG9yOiBAc2l4ZHViCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGNvbXB1dGVyIHRvIGdldCBldmVudHMgZnJvbS4gRGVmYXVsdDogTG9jYWxob3N0CgogICAgLlBBUkFNRVRFUiBFdmVudFR5cGUKCiAgICAgICAgRWl0aGVyICdsb2dvbicsICd0Z3QnLCBvciAnYWxsJy4gRGVmYXVsdHM6ICdsb2dvbicKCiAgICAuUEFSQU1FVEVSIERhdGVTdGFydAoKICAgICAgICBGaWx0ZXIgb3V0IGFsbCBldmVudHMgYmVmb3JlIHRoaXMgZGF0ZS4gRGVmYXVsdDogNSBkYXlzCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Vc2VyRXZlbnQgLUNvbXB1dGVyTmFtZSBEb21haW5Db250cm9sbGVyLnRlc3RsYWIubG9jYWwKCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vd3d3LnNpeGR1Yi5uZXQvMjAxNC8xMS8wNy9vZmZlbnNpdmUtZXZlbnQtcGFyc2luZy1icmluZ2luZy1ob21lLXRyb3BoaWVzLwojPgoKICAgIFBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICRFbnY6Q29tcHV0ZXJOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZVNldCgibG9nb24iLCJ0Z3QiLCJhbGwiKV0KICAgICAgICAkRXZlbnRUeXBlID0gImxvZ29uIiwKCiAgICAgICAgW0RhdGVUaW1lXQogICAgICAgICREYXRlU3RhcnQgPSBbRGF0ZVRpbWVdOjpUb2RheS5BZGREYXlzKC01KSwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBpZigkRXZlbnRUeXBlLlRvTG93ZXIoKSAtbGlrZSAibG9nb24iKSB7CiAgICAgICAgW0ludDMyW11dJElEID0gQCg0NjI0KQogICAgfQogICAgZWxzZWlmKCRFdmVudFR5cGUuVG9Mb3dlcigpIC1saWtlICJ0Z3QiKSB7CiAgICAgICAgW0ludDMyW11dJElEID0gQCg0NzY4KQogICAgfQogICAgZWxzZSB7CiAgICAgICAgW0ludDMyW11dJElEID0gQCg0NjI0LCA0NzY4KQogICAgfQoKICAgIGlmKCRDcmVkZW50aWFsKSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiVXNpbmcgYWx0ZXJuYXRpdmUgY3JlZGVudGlhbHMiCiAgICAgICAgJEFyZ3VtZW50cyA9IEB7CiAgICAgICAgICAgICdDb21wdXRlck5hbWUnID0gJENvbXB1dGVyTmFtZTsKICAgICAgICAgICAgJ0NyZWRlbnRpYWwnID0gJENyZWRlbnRpYWw7CiAgICAgICAgICAgICdGaWx0ZXJIYXNoVGFibGUnID0gQHsgTG9nTmFtZSA9ICdTZWN1cml0eSc7IElEPSRJRDsgU3RhcnRUaW1lPSREYXRlU3RhcnR9OwogICAgICAgICAgICAnRXJyb3JBY3Rpb24nID0gJ1NpbGVudGx5Q29udGludWUnOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UgewogICAgICAgICRBcmd1bWVudHMgPSBAewogICAgICAgICAgICAnQ29tcHV0ZXJOYW1lJyA9ICRDb21wdXRlck5hbWU7CiAgICAgICAgICAgICdGaWx0ZXJIYXNoVGFibGUnID0gQHsgTG9nTmFtZSA9ICdTZWN1cml0eSc7IElEPSRJRDsgU3RhcnRUaW1lPSREYXRlU3RhcnR9OwogICAgICAgICAgICAnRXJyb3JBY3Rpb24nID0gJ1NpbGVudGx5Q29udGludWUnOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdyYWIgYWxsIGV2ZW50cyBtYXRjaGluZyBvdXIgZmlsdGVyIGZvciB0aGUgc3BlY2lmaWVkIGhvc3QKICAgIEdldC1XaW5FdmVudCBAQXJndW1lbnRzIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICBpZigkSUQgLWNvbnRhaW5zIDQ2MjQpIHsKICAgICAgICAgICAgIyBmaXJzdCBwYXJzZSBhbmQgY2hlY2sgdGhlIGxvZ29uIGV2ZW50IHR5cGUuIFRoaXMgY291bGQgYmUgbGF0ZXIgYWRhcHRlZCBhbmQgdGVzdGVkIGZvciBSRFAgbG9nb25zICh0eXBlIDEwKQogICAgICAgICAgICBpZigkXy5tZXNzYWdlIC1tYXRjaCAnKD9zKSg/PD1Mb2dvbiBUeXBlOikuKj8oPz0oSW1wZXJzb25hdGlvbiBMZXZlbDp8TmV3IExvZ29uOikpJykgewogICAgICAgICAgICAgICAgaWYoJE1hdGNoZXMpIHsKICAgICAgICAgICAgICAgICAgICAkTG9nb25UeXBlID0gJE1hdGNoZXNbMF0udHJpbSgpCiAgICAgICAgICAgICAgICAgICAgJE1hdGNoZXMgPSAkTnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJExvZ29uVHlwZSA9ICIiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgaW50ZXJhY3RpdmUgbG9nb25zIG9yIGRvbWFpbiBsb2dvbnMKICAgICAgICAgICAgaWYgKCgkTG9nb25UeXBlIC1lcSAyKSAtb3IgKCRMb2dvblR5cGUgLWVxIDMpKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICMgcGFyc2UgYW5kIHN0b3JlIHRoZSBhY2NvdW50IHVzZWQgYW5kIHRoZSBhZGRyZXNzIHRoZXkgY2FtZSBmcm9tCiAgICAgICAgICAgICAgICAgICAgaWYoJF8ubWVzc2FnZSAtbWF0Y2ggJyg/cykoPzw9TmV3IExvZ29uOikuKj8oPz1Qcm9jZXNzIEluZm9ybWF0aW9uOiknKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRNYXRjaGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVXNlck5hbWUgPSAkTWF0Y2hlc1swXS5zcGxpdCgiYG4iKVsyXS5zcGxpdCgiOiIpWzFdLnRyaW0oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpbiA9ICRNYXRjaGVzWzBdLnNwbGl0KCJgbiIpWzNdLnNwbGl0KCI6IilbMV0udHJpbSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWF0Y2hlcyA9ICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoJF8ubWVzc2FnZSAtbWF0Y2ggJyg/cykoPzw9TmV0d29yayBJbmZvcm1hdGlvbjopLio/KD89U291cmNlIFBvcnQ6KScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJE1hdGNoZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBZGRyZXNzID0gJE1hdGNoZXNbMF0uc3BsaXQoImBuIilbMl0uc3BsaXQoIjoiKVsxXS50cmltKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNYXRjaGVzID0gJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgIyBvbmx5IGFkZCBpZiB0aGVyZSB3YXMgYWNjb3VudCBpbmZvcm1hdGlvbiBub3QgZm9yIGEgbWFjaGluZSBvciBhbm9ueW1vdXMgbG9nb24KICAgICAgICAgICAgICAgICAgICBpZiAoJFVzZXJOYW1lIC1hbmQgKC1ub3QgJFVzZXJOYW1lLmVuZHNXaXRoKCckJykpIC1hbmQgKCRVc2VyTmFtZSAtbmUgJ0FOT05ZTU9VUyBMT0dPTicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRMb2dvbkV2ZW50UHJvcGVydGllcyA9IEB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRG9tYWluJyA9ICREb21haW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb21wdXRlck5hbWUnID0gJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1VzZXJuYW1lJyA9ICRVc2VyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0FkZHJlc3MnID0gJEFkZHJlc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJRCcgPSAnNDYyNCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdMb2dvblR5cGUnID0gJExvZ29uVHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1RpbWUnID0gJF8uVGltZUNyZWF0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAtUHJvcGVydHkgJExvZ29uRXZlbnRQcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIHBhcnNpbmcgZXZlbnQgbG9nczogJF8iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYoJElEIC1jb250YWlucyA0NzY4KSB7CiAgICAgICAgICAgICMgdGhlIFRHVCBldmVudCB0eXBlCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZigkXy5tZXNzYWdlIC1tYXRjaCAnKD9zKSg/PD1BY2NvdW50IEluZm9ybWF0aW9uOikuKj8oPz1TZXJ2aWNlIEluZm9ybWF0aW9uOiknKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoJE1hdGNoZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJuYW1lID0gJE1hdGNoZXNbMF0uc3BsaXQoImBuIilbMV0uc3BsaXQoIjoiKVsxXS50cmltKCkKICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpbiA9ICRNYXRjaGVzWzBdLnNwbGl0KCJgbiIpWzJdLnNwbGl0KCI6IilbMV0udHJpbSgpCiAgICAgICAgICAgICAgICAgICAgICAgICRNYXRjaGVzID0gJE51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoJF8ubWVzc2FnZSAtbWF0Y2ggJyg/cykoPzw9TmV0d29yayBJbmZvcm1hdGlvbjopLio/KD89QWRkaXRpb25hbCBJbmZvcm1hdGlvbjopJykgewogICAgICAgICAgICAgICAgICAgIGlmKCRNYXRjaGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRBZGRyZXNzID0gJE1hdGNoZXNbMF0uc3BsaXQoImBuIilbMV0uc3BsaXQoIjoiKVstMV0udHJpbSgpCiAgICAgICAgICAgICAgICAgICAgICAgICRNYXRjaGVzID0gJE51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJExvZ29uRXZlbnRQcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICAgICAnRG9tYWluJyA9ICREb21haW4KICAgICAgICAgICAgICAgICAgICAnQ29tcHV0ZXJOYW1lJyA9ICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgICAgICAnVXNlcm5hbWUnID0gJFVzZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgJ0FkZHJlc3MnID0gJEFkZHJlc3MKICAgICAgICAgICAgICAgICAgICAnSUQnID0gJzQ3NjgnCiAgICAgICAgICAgICAgICAgICAgJ0xvZ29uVHlwZScgPSAnJwogICAgICAgICAgICAgICAgICAgICdUaW1lJyA9ICRfLlRpbWVDcmVhdGVkCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5ICRMb2dvbkV2ZW50UHJvcGVydGllcwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIHBhcnNpbmcgZXZlbnQgbG9nczogJF8iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtT2JqZWN0QWNsIHsKPCMKICAgIC5TWU5PUFNJUwogICAgICAgIFJldHVybnMgdGhlIEFDTHMgYXNzb2NpYXRlZCB3aXRoIGEgc3BlY2lmaWMgYWN0aXZlIGRpcmVjdG9yeSBvYmplY3QuCgogICAgICAgIFRoYW5rcyBTZWFuIE1ldGNhbGYgKEBweXJvdGVrMykgZm9yIHRoZSBpZGVhIGFuZCBndWlkYW5jZS4KCiAgICAuUEFSQU1FVEVSIFNhbUFjY291bnROYW1lCgogICAgICAgIE9iamVjdCBuYW1lIHRvIGZpbHRlciBmb3IuCgogICAgLlBBUkFNRVRFUiBOYW1lCgogICAgICAgIE9iamVjdCBuYW1lIHRvIGZpbHRlciBmb3IuCgogICAgLlBBUkFNRVRFUiBEaXN0aW5ndWlzaGVkTmFtZQoKICAgICAgICBPYmplY3QgZGlzdGluZ3Vpc2hlZCBuYW1lIHRvIGZpbHRlciBmb3IuCgogICAgLlBBUkFNRVRFUiBSZXNvbHZlR1VJRHMKCiAgICAgICAgU3dpdGNoLiBSZXNvbHZlIEdVSURzIHRvIHRoZWlyIGRpc3BsYXkgbmFtZXMuCgogICAgLlBBUkFNRVRFUiBGaWx0ZXIKCiAgICAgICAgQSBjdXN0b21pemVkIGxkYXAgZmlsdGVyIHN0cmluZyB0byB1c2UsIGUuZy4gIihkZXNjcmlwdGlvbj0qYWRtaW4qKSIKCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgQURTcHJlZml4CgogICAgICAgIFByZWZpeCB0byBzZXQgZm9yIHRoZSBzZWFyY2hlciAobGlrZSAiQ049U2l0ZXMsQ049Q29uZmlndXJhdGlvbiIpCgogICAgLlBBUkFNRVRFUiBSaWdodHNGaWx0ZXIKCiAgICAgICAgT25seSByZXR1cm4gcmVzdWx0cyB3aXRoIHRoZSBhc3NvY2lhdGVkIHJpZ2h0cywgIkFsbCIsICJSZXNldFBhc3N3b3JkIiwiV3JpdGVNZW1iZXJzIgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gdXNlIGZvciB0aGUgcXVlcnksIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1PYmplY3RBY2wgLVNhbUFjY291bnROYW1lIG1hdHQuYWRtaW4gLWRvbWFpbiB0ZXN0bGFiLmxvY2FsCgogICAgICAgIEdldCB0aGUgQUNMcyBmb3IgdGhlIG1hdHQuYWRtaW4gdXNlciBpbiB0aGUgdGVzdGxhYi5sb2NhbCBkb21haW4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1PYmplY3RBY2wgLVNhbUFjY291bnROYW1lIG1hdHQuYWRtaW4gLWRvbWFpbiB0ZXN0bGFiLmxvY2FsIC1SZXNvbHZlR1VJRHMKCiAgICAgICAgR2V0IHRoZSBBQ0xzIGZvciB0aGUgbWF0dC5hZG1pbiB1c2VyIGluIHRoZSB0ZXN0bGFiLmxvY2FsIGRvbWFpbiBhbmQKICAgICAgICByZXNvbHZlIHJlbGV2YW50IEdVSURzIHRvIHRoZWlyIGRpc3BsYXkgbmFtZXMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0T1UgLUZ1bGxEYXRhIHwgR2V0LU9iamVjdEFjbCAtUmVzb2x2ZUdVSURzCgogICAgICAgIEVudW1lcmF0ZSB0aGUgQUNMIHBlcm1pc3Npb25zIGZvciBhbGwgT1VzIGluIHRoZSBkb21haW4uCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNhbUFjY291bnROYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE5hbWUgPSAiKiIsCgogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRGlzdGluZ3Vpc2hlZE5hbWUgPSAiKiIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlc29sdmVHVUlEcywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwcmVmaXgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlU2V0KCJBbGwiLCJSZXNldFBhc3N3b3JkIiwiV3JpdGVNZW1iZXJzIildCiAgICAgICAgJFJpZ2h0c0ZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0KICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMAogICAgKQoKICAgIGJlZ2luIHsKICAgICAgICAkU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1BRFNwYXRoICRBRFNwYXRoIC1BRFNwcmVmaXggJEFEU3ByZWZpeCAtUGFnZVNpemUgJFBhZ2VTaXplCgogICAgICAgICMgZ2V0IGEgR1VJRCAtPiBuYW1lIG1hcHBpbmcKICAgICAgICBpZigkUmVzb2x2ZUdVSURzKSB7CiAgICAgICAgICAgICRHVUlEcyA9IEdldC1HVUlETWFwIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICAgICAgfQogICAgfQoKICAgIHByb2Nlc3MgewoKICAgICAgICBpZiAoJFNlYXJjaGVyKSB7CgogICAgICAgICAgICBpZigkU2FtQWNjb3VudE5hbWUpIHsKICAgICAgICAgICAgICAgICRTZWFyY2hlci5maWx0ZXI9IigmKHNhbWFjY291bnRuYW1lPSRTYW1BY2NvdW50TmFtZSkobmFtZT0kTmFtZSkoZGlzdGluZ3Vpc2hlZG5hbWU9JERpc3Rpbmd1aXNoZWROYW1lKSRGaWx0ZXIpIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFNlYXJjaGVyLmZpbHRlcj0iKCYobmFtZT0kTmFtZSkoZGlzdGluZ3Vpc2hlZG5hbWU9JERpc3Rpbmd1aXNoZWROYW1lKSRGaWx0ZXIpIgogICAgICAgICAgICB9CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJFJlc3VsdHMgPSAkU2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICRPYmplY3QgPSBbYWRzaV0oJF8ucGF0aCkKCiAgICAgICAgICAgICAgICAgICAgaWYoJE9iamVjdC5kaXN0aW5ndWlzaGVkbmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAkQWNjZXNzID0gJE9iamVjdC5Qc0Jhc2UuT2JqZWN0U2VjdXJpdHkuYWNjZXNzCiAgICAgICAgICAgICAgICAgICAgICAgICRBY2Nlc3MgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkXyB8IEFkZC1NZW1iZXIgTm90ZVByb3BlcnR5ICdPYmplY3RETicgJE9iamVjdC5kaXN0aW5ndWlzaGVkbmFtZVswXQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRPYmplY3Qub2JqZWN0c2lkWzBdKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUyA9IChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyKCRPYmplY3Qub2JqZWN0c2lkWzBdLDApKS5WYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFMgPSAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfIHwgQWRkLU1lbWJlciBOb3RlUHJvcGVydHkgJ09iamVjdFNJRCcgJFMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgIGlmKCRSaWdodHNGaWx0ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEd1aWRGaWx0ZXIgPSBTd2l0Y2ggKCRSaWdodHNGaWx0ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJSZXNldFBhc3N3b3JkIiB7ICIwMDI5OTU3MC0yNDZkLTExZDAtYTc2OC0wMGFhMDA2ZTA1MjkiIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJXcml0ZU1lbWJlcnMiIHsgImJmOTY3OWMwLTBkZTYtMTFkMC1hMjg1LTAwYWEwMDMwNDllMiIgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCB7ICIwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDAifQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRfLk9iamVjdFR5cGUgLWVxICRHdWlkRmlsdGVyKSB7ICRfIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRfCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICBpZigkR1VJRHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSByZXNvbHZpbmcgR1VJRHMsIG1hcCB0aGVtIHRoZW0gdG8gdGhlIHJlc29sdmVkIGhhc2ggdGFibGUKICAgICAgICAgICAgICAgICAgICAgICAgJEFjbFByb3BlcnRpZXMgPSBAe30KICAgICAgICAgICAgICAgICAgICAgICAgJF8ucHNvYmplY3QucHJvcGVydGllcyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAoJF8uTmFtZSAtZXEgJ09iamVjdFR5cGUnKSAtb3IgKCRfLk5hbWUgLWVxICdJbmhlcml0ZWRPYmplY3RUeXBlJykgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEFjbFByb3BlcnRpZXNbJF8uTmFtZV0gPSAkR1VJRFNbJF8uVmFsdWUudG9TdHJpbmcoKV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQWNsUHJvcGVydGllc1skXy5OYW1lXSA9ICRfLlZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEFjbFByb3BlcnRpZXNbJF8uTmFtZV0gPSAkXy5WYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IC1Qcm9wZXJ0eSAkQWNsUHJvcGVydGllcwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsgJF8gfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICAgICAkU2VhcmNoZXIuZGlzcG9zZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgV3JpdGUtV2FybmluZyAkXwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gQWRkLU9iamVjdEFjbCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgQWRkcyBhbiBBQ0wgZm9yIGEgc3BlY2lmaWMgYWN0aXZlIGRpcmVjdG9yeSBvYmplY3QuCgogICAgICAgIEFkbWluU0RIb2xkZXIgQUNMIGFwcHJvYWNoIGZyb20gU2VhbiBNZXRjYWxmIChAcHlyb3RlazMpCiAgICAgICAgICAgIGh0dHBzOi8vYWRzZWN1cml0eS5vcmcvP3A9MTkwNgoKICAgICAgICBBQ0Ugc2V0dGluZyBtZXRob2QgYWRhcHRlZCBmcm9tIGh0dHBzOi8vc29jaWFsLnRlY2huZXQubWljcm9zb2Z0LmNvbS9Gb3J1bXMvd2luZG93c3NlcnZlci9lbi1VUy9kZjNiZmQzMy1jMDcwLTRhOWMtYmU5OC1jNGRhNmU1OTFhMGEvZm9ydW0tZmFxLXVzaW5nLXBvd2Vyc2hlbGwtdG8tYXNzaWduLXBlcm1pc3Npb25zLW9uLWFjdGl2ZS1kaXJlY3Rvcnktb2JqZWN0cy4KCiAgICAgICAgJ1Jlc2V0UGFzc3dvcmQnIGRvZXNuJ3QgbmVlZCB0byBrbm93IHRoZSB1c2VyJ3MgY3VycmVudCBwYXNzd29yZAogICAgICAgICdXcml0ZU1lbWJlcnMnIGFsbG93cyBmb3IgdGhlIG1vZGlmaWNhdGlvbiBvZiBncm91cCBtZW1iZXJzaGlwCgogICAgLlBBUkFNRVRFUiBUYXJnZXRTYW1BY2NvdW50TmFtZQoKICAgICAgICBUYXJnZXQgb2JqZWN0IG5hbWUgdG8gZmlsdGVyIGZvci4KCiAgICAuUEFSQU1FVEVSIFRhcmdldE5hbWUKCiAgICAgICAgVGFyZ2V0IG9iamVjdCBuYW1lIHRvIGZpbHRlciBmb3IuCgogICAgLlBBUkFNRVRFUiBUYXJnZXREaXN0aW5ndWlzaGVkTmFtZQoKICAgICAgICBUYXJnZXQgb2JqZWN0IGRpc3Rpbmd1aXNoZWQgbmFtZSB0byBmaWx0ZXIgZm9yLgoKICAgIC5QQVJBTUVURVIgVGFyZ2V0RmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlIHRvIGZpbmQgYSB0YXJnZXQsIGUuZy4gIihkZXNjcmlwdGlvbj0qYWRtaW4qKSIKCiAgICAuUEFSQU1FVEVSIFRhcmdldEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIGZvciB0aGUgdGFyZ2V0LCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCgogICAgLlBBUkFNRVRFUiBUYXJnZXRBRFNwcmVmaXgKCiAgICAgICAgUHJlZml4IHRvIHNldCBmb3IgdGhlIHRhcmdldCBzZWFyY2hlciAobGlrZSAiQ049U2l0ZXMsQ049Q29uZmlndXJhdGlvbiIpCgogICAgLlBBUkFNRVRFUiBQcmluY2lwYWxTSUQKCiAgICAgICAgVGhlIFNJRCBvZiB0aGUgcHJpbmNpcGFsIG9iamVjdCB0byBhZGQgZm9yIGFjY2Vzcy4KCiAgICAuUEFSQU1FVEVSIFByaW5jaXBhbE5hbWUKCiAgICAgICAgVGhlIG5hbWUgb2YgdGhlIHByaW5jaXBhbCBvYmplY3QgdG8gYWRkIGZvciBhY2Nlc3MuCgogICAgLlBBUkFNRVRFUiBQcmluY2lwYWxTYW1BY2NvdW50TmFtZQoKICAgICAgICBUaGUgc2FtQWNjb3VudE5hbWUgb2YgdGhlIHByaW5jaXBhbCBvYmplY3QgdG8gYWRkIGZvciBhY2Nlc3MuCgogICAgLlBBUkFNRVRFUiBSaWdodHMKCiAgICAgICAgUmlnaHRzIHRvIGFkZCBmb3IgdGhlIHByaW5jaXBhbCwgIkFsbCIsIlJlc2V0UGFzc3dvcmQiLCJXcml0ZU1lbWJlcnMiLCJEQ1N5bmMiCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byB1c2UgZm9yIHRoZSB0YXJnZXQgcXVlcnksIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBBZGQtT2JqZWN0QWNsIC1UYXJnZXRTYW1BY2NvdW50TmFtZSBtYXR0IC1QcmluY2lwYWxTYW1BY2NvdW50TmFtZSBqb2huCgogICAgICAgIEdyYW50cyAnam9obicgYWxsIGZ1bGwgYWNjZXNzIHJpZ2h0cyB0byB0aGUgJ21hdHQnIGFjY291bnQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgQWRkLU9iamVjdEFjbCAtVGFyZ2V0U2FtQWNjb3VudE5hbWUgbWF0dCAtUHJpbmNpcGFsU2FtQWNjb3VudE5hbWUgam9obiAtUmlnaHRzIFJlc2V0UGFzc3dvcmQKCiAgICAgICAgR3JhbnRzICdqb2huJyB0aGUgcmlnaHQgdG8gcmVzZXQgdGhlIHBhc3N3b3JkIGZvciB0aGUgJ21hdHQnIGFjY291bnQuCgogICAgLkxJTksKCiAgICAgICAgaHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xOTA2CgogICAgICAgIGh0dHBzOi8vc29jaWFsLnRlY2huZXQubWljcm9zb2Z0LmNvbS9Gb3J1bXMvd2luZG93c3NlcnZlci9lbi1VUy9kZjNiZmQzMy1jMDcwLTRhOWMtYmU5OC1jNGRhNmU1OTFhMGEvZm9ydW0tZmFxLXVzaW5nLXBvd2Vyc2hlbGwtdG8tYXNzaWduLXBlcm1pc3Npb25zLW9uLWFjdGl2ZS1kaXJlY3Rvcnktb2JqZWN0cz9mb3J1bT13aW5zZXJ2ZXJwb3dlcnNoZWxsCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbU3RyaW5nXQogICAgICAgICRUYXJnZXRTYW1BY2NvdW50TmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGFyZ2V0TmFtZSA9ICIqIiwKCiAgICAgICAgW0FsaWFzKCdETicpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFRhcmdldERpc3Rpbmd1aXNoZWROYW1lID0gIioiLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRUYXJnZXRGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFRhcmdldEFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFRhcmdldEFEU3ByZWZpeCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVQYXR0ZXJuKCdeUy0xLTUtMjEtWzAtOV0rLVswLTldKy1bMC05XSstWzAtOV0rJyldCiAgICAgICAgJFByaW5jaXBhbFNJRCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkUHJpbmNpcGFsTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkUHJpbmNpcGFsU2FtQWNjb3VudE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlU2V0KCJBbGwiLCJSZXNldFBhc3N3b3JkIiwiV3JpdGVNZW1iZXJzIiwiRENTeW5jIildCiAgICAgICAgJFJpZ2h0cyA9ICJBbGwiLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRSaWdodHNHVUlELAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwCiAgICApCgogICAgYmVnaW4gewogICAgICAgICRTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUFEU3BhdGggJFRhcmdldEFEU3BhdGggLUFEU3ByZWZpeCAkVGFyZ2V0QURTcHJlZml4IC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgaWYoJFByaW5jaXBhbFNJRCkgewogICAgICAgICAgICAkUmVzb2x2ZWRQcmluY2lwYWxTSUQgPSAkUHJpbmNpcGFsU0lECiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkUHJpbmNpcGFsID0gR2V0LUFET2JqZWN0IC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtTmFtZSAkUHJpbmNpcGFsTmFtZSAtU2FtQWNjb3VudE5hbWUgJFByaW5jaXBhbFNhbUFjY291bnROYW1lIC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgICAgIGlmKCEkUHJpbmNpcGFsKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiRXJyb3IgcmVzb2x2aW5nIHByaW5jaXBhbCIKICAgICAgICAgICAgfQogICAgICAgICAgICAkUmVzb2x2ZWRQcmluY2lwYWxTSUQgPSAkUHJpbmNpcGFsLm9iamVjdHNpZAogICAgICAgIH0KICAgICAgICBpZighJFJlc29sdmVkUHJpbmNpcGFsU0lEKSB7CiAgICAgICAgICAgIHRocm93ICJFcnJvciByZXNvbHZpbmcgcHJpbmNpcGFsIgogICAgICAgIH0KICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgaWYgKCRTZWFyY2hlcikgewoKICAgICAgICAgICAgaWYoJFRhcmdldFNhbUFjY291bnROYW1lKSB7CiAgICAgICAgICAgICAgICAkU2VhcmNoZXIuZmlsdGVyPSIoJihzYW1hY2NvdW50bmFtZT0kVGFyZ2V0U2FtQWNjb3VudE5hbWUpKG5hbWU9JFRhcmdldE5hbWUpKGRpc3Rpbmd1aXNoZWRuYW1lPSRUYXJnZXREaXN0aW5ndWlzaGVkTmFtZSkkVGFyZ2V0RmlsdGVyKSIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRTZWFyY2hlci5maWx0ZXI9IigmKG5hbWU9JFRhcmdldE5hbWUpKGRpc3Rpbmd1aXNoZWRuYW1lPSRUYXJnZXREaXN0aW5ndWlzaGVkTmFtZSkkVGFyZ2V0RmlsdGVyKSIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJFNlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICAgICAgICAgIyBhZGFwdGVkIGZyb20gaHR0cHM6Ly9zb2NpYWwudGVjaG5ldC5taWNyb3NvZnQuY29tL0ZvcnVtcy93aW5kb3dzc2VydmVyL2VuLVVTL2RmM2JmZDMzLWMwNzAtNGE5Yy1iZTk4LWM0ZGE2ZTU5MWEwYS9mb3J1bS1mYXEtdXNpbmctcG93ZXJzaGVsbC10by1hc3NpZ24tcGVybWlzc2lvbnMtb24tYWN0aXZlLWRpcmVjdG9yeS1vYmplY3RzCgogICAgICAgICAgICAgICAgICAgICRUYXJnZXRETiA9ICRfLlByb3BlcnRpZXMuZGlzdGluZ3Vpc2hlZG5hbWUKCiAgICAgICAgICAgICAgICAgICAgJElkZW50aXR5ID0gW1N5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuSWRlbnRpdHlSZWZlcmVuY2VdIChbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXJdJFJlc29sdmVkUHJpbmNpcGFsU0lEKQogICAgICAgICAgICAgICAgICAgICRJbmhlcml0YW5jZVR5cGUgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeVNlY3VyaXR5SW5oZXJpdGFuY2VdICJOb25lIgogICAgICAgICAgICAgICAgICAgICRDb250cm9sVHlwZSA9IFtTeXN0ZW0uU2VjdXJpdHkuQWNjZXNzQ29udHJvbC5BY2Nlc3NDb250cm9sVHlwZV0gIkFsbG93IgogICAgICAgICAgICAgICAgICAgICRBQ0VzID0gQCgpCgogICAgICAgICAgICAgICAgICAgIGlmKCRSaWdodHNHVUlEKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRHVUlEcyA9IEAoJFJpZ2h0c0dVSUQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkR1VJRHMgPSBTd2l0Y2ggKCRSaWdodHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUmVzZXRQYXNzd29yZCBkb2Vzbid0IG5lZWQgdG8ga25vdyB0aGUgdXNlcidzIGN1cnJlbnQgcGFzc3dvcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJSZXNldFBhc3N3b3JkIiB7ICIwMDI5OTU3MC0yNDZkLTExZDAtYTc2OC0wMGFhMDA2ZTA1MjkiIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgYWxsb3dzIGZvciB0aGUgbW9kaWZpY2F0aW9uIG9mIGdyb3VwIG1lbWJlcnNoaXAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJXcml0ZU1lbWJlcnMiIHsgImJmOTY3OWMwLTBkZTYtMTFkMC1hMjg1LTAwYWEwMDMwNDllMiIgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAnRFMtUmVwbGljYXRpb24tR2V0LUNoYW5nZXMnID0gMTEzMWY2YWEtOWMwNy0xMWQxLWY3OWYtMDBjMDRmYzJkY2QyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICdEUy1SZXBsaWNhdGlvbi1HZXQtQ2hhbmdlcy1BbGwnID0gMTEzMWY2YWQtOWMwNy0xMWQxLWY3OWYtMDBjMDRmYzJkY2QyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICdEUy1SZXBsaWNhdGlvbi1HZXQtQ2hhbmdlcy1Jbi1GaWx0ZXJlZC1TZXQnID0gODllOTViNzYtNDQ0ZC00YzYyLTk5MWEtMGZhY2JlZGE2NDBjCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgd2hlbiBhcHBsaWVkIHRvIGEgZG9tYWluJ3MgQUNMLCBhbGxvd3MgZm9yIHRoZSB1c2Ugb2YgRENTeW5jCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiRENTeW5jIiB7ICIxMTMxZjZhYS05YzA3LTExZDEtZjc5Zi0wMGMwNGZjMmRjZDIiLCAiMTEzMWY2YWQtOWMwNy0xMWQxLWY3OWYtMDBjMDRmYzJkY2QyIiwgIjg5ZTk1Yjc2LTQ0NGQtNGM2Mi05OTFhLTBmYWNiZWRhNjQwYyJ9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKCRHVUlEcykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRHVUlEIGluICRHVUlEcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE5ld0dVSUQgPSBOZXctT2JqZWN0IEd1aWQgJEdVSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBRFJpZ2h0cyA9IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5UmlnaHRzXSAiRXh0ZW5kZWRSaWdodCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBQ0VzICs9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeUFjY2Vzc1J1bGUgJElkZW50aXR5LCRBRFJpZ2h0cywkQ29udHJvbFR5cGUsJE5ld0dVSUQsJEluaGVyaXRhbmNlVHlwZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAjIGRlYXVsdCB0byBHZW5lcmljQWxsIHJpZ2h0cwogICAgICAgICAgICAgICAgICAgICAgICAkQURSaWdodHMgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeVJpZ2h0c10gIkdlbmVyaWNBbGwiCiAgICAgICAgICAgICAgICAgICAgICAgICRBQ0VzICs9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeUFjY2Vzc1J1bGUgJElkZW50aXR5LCRBRFJpZ2h0cywkQ29udHJvbFR5cGUsJEluaGVyaXRhbmNlVHlwZQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiR3JhbnRpbmcgcHJpbmNpcGFsICRSZXNvbHZlZFByaW5jaXBhbFNJRCAnJFJpZ2h0cycgb24gJCgkXy5Qcm9wZXJ0aWVzLmRpc3Rpbmd1aXNoZWRuYW1lKSIKCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBhZGQgYWxsIHRoZSBuZXcgQUNFcyB0byB0aGUgc3BlY2lmaWVkIG9iamVjdAogICAgICAgICAgICAgICAgICAgICAgICBGb3JFYWNoICgkQUNFIGluICRBQ0VzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJHcmFudGluZyBwcmluY2lwYWwgJFJlc29sdmVkUHJpbmNpcGFsU0lEICckKCRBQ0UuT2JqZWN0VHlwZSknIHJpZ2h0cyBvbiAkKCRfLlByb3BlcnRpZXMuZGlzdGluZ3Vpc2hlZG5hbWUpIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE9iamVjdCA9IFthZHNpXSgkXy5wYXRoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE9iamVjdC5Qc0Jhc2UuT2JqZWN0U2VjdXJpdHkuQWRkQWNjZXNzUnVsZSgkQUNFKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE9iamVjdC5Qc0Jhc2UuY29tbWl0Y2hhbmdlcygpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBncmFudGluZyBwcmluY2lwYWwgJFJlc29sdmVkUHJpbmNpcGFsU0lEICckUmlnaHRzJyBvbiAkVGFyZ2V0RE4gOiAkXyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICRTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvcjogJF8iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBJbnZva2UtQUNMU2Nhbm5lciB7CjwjCiAgICAuU1lOT1BTSVMKICAgICAgICBTZWFyY2hlcyBmb3IgQUNMcyBmb3Igc3BlY2lmYWJsZSBBRCBvYmplY3RzIChkZWZhdWx0IHRvIGFsbCBkb21haW4gb2JqZWN0cykKICAgICAgICB3aXRoIGEgZG9tYWluIHNpZCBvZiA+IC0xMDAwLCBhbmQgaGF2ZSBtb2RpZmlhYmxlIHJpZ2h0cy4KCiAgICAgICAgVGhhbmtzIFNlYW4gTWV0Y2FsZiAoQHB5cm90ZWszKSBmb3IgdGhlIGlkZWEgYW5kIGd1aWRhbmNlLgoKICAgIC5QQVJBTUVURVIgU2FtQWNjb3VudE5hbWUKCiAgICAgICAgT2JqZWN0IG5hbWUgdG8gZmlsdGVyIGZvci4KCiAgICAuUEFSQU1FVEVSIE5hbWUKCiAgICAgICAgT2JqZWN0IG5hbWUgdG8gZmlsdGVyIGZvci4KCiAgICAuUEFSQU1FVEVSIERpc3Rpbmd1aXNoZWROYW1lCgogICAgICAgIE9iamVjdCBkaXN0aW5ndWlzaGVkIG5hbWUgdG8gZmlsdGVyIGZvci4KCiAgICAuUEFSQU1FVEVSIEZpbHRlcgoKICAgICAgICBBIGN1c3RvbWl6ZWQgbGRhcCBmaWx0ZXIgc3RyaW5nIHRvIHVzZSwgZS5nLiAiKGRlc2NyaXB0aW9uPSphZG1pbiopIgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBBRFNwcmVmaXgKCiAgICAgICAgUHJlZml4IHRvIHNldCBmb3IgdGhlIHNlYXJjaGVyIChsaWtlICJDTj1TaXRlcyxDTj1Db25maWd1cmF0aW9uIikKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHVzZSBmb3IgdGhlIHF1ZXJ5LCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBSZXNvbHZlR1VJRHMKCiAgICAgICAgU3dpdGNoLiBSZXNvbHZlIEdVSURzIHRvIHRoZWlyIGRpc3BsYXkgbmFtZXMuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtQUNMU2Nhbm5lciAtUmVzb2x2ZUdVSURzIHwgRXhwb3J0LUNTViAtTm9UeXBlSW5mb3JtYXRpb24gYWNscy5jc3YKCiAgICAgICAgRW51bWVyYXRlIGFsbCBtb2RpZmFibGUgQUNMcyBpbiB0aGUgY3VycmVudCBkb21haW4sIHJlc29sdmluZyBHVUlEcyB0byBkaXNwbGF5CiAgICAgICAgbmFtZXMsIGFuZCBleHBvcnQgZXZlcnl0aGluZyB0byBhIC5jc3YKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNhbUFjY291bnROYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICROYW1lID0gIioiLAoKICAgICAgICBbQWxpYXMoJ0ROJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRGlzdGluZ3Vpc2hlZE5hbWUgPSAiKiIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcHJlZml4LAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlc29sdmVHVUlEcywKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAKICAgICkKCiAgICAjIEdldCBhbGwgZG9tYWluIEFDTHMgd2l0aCB0aGUgYXBwcm9wcmlhdGUgcGFyYW1ldGVycwogICAgR2V0LU9iamVjdEFDTCBAUFNCb3VuZFBhcmFtZXRlcnMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgIyBhZGQgaW4gdGhlIHRyYW5zbGF0ZWQgU0lEIGZvciB0aGUgb2JqZWN0IGlkZW50aXR5CiAgICAgICAgJF8gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSWRlbnRpdHlTSUQnICgkXy5JZGVudGl0eVJlZmVyZW5jZS5UcmFuc2xhdGUoW1N5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyXSkuVmFsdWUpCiAgICAgICAgJF8KICAgIH0gfCBXaGVyZS1PYmplY3QgewogICAgICAgICMgY2hlY2sgZm9yIGFueSBBQ0xzIHdpdGggU0lEcyA+IC0xMDAwCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgIyBUT0RPOiBjaGFuZ2UgdGhpcyB0byBhIHJlZ2V4IGZvciBzcGVlZHVwPwogICAgICAgICAgICBbaW50XSgkXy5JZGVudGl0eVNpZC5zcGxpdCgiLSIpWy0xXSkgLWdlIDEwMDAKICAgICAgICB9CiAgICAgICAgY2F0Y2gge30KICAgIH0gfCBXaGVyZS1PYmplY3QgewogICAgICAgICMgZmlsdGVyIGZvciBtb2RpZmlhYmxlIHJpZ2h0cwogICAgICAgICgkXy5BY3RpdmVEaXJlY3RvcnlSaWdodHMgLWVxICJHZW5lcmljQWxsIikgLW9yICgkXy5BY3RpdmVEaXJlY3RvcnlSaWdodHMgLW1hdGNoICJXcml0ZSIpIC1vciAoJF8uQWN0aXZlRGlyZWN0b3J5UmlnaHRzIC1tYXRjaCAiQ3JlYXRlIikgLW9yICgkXy5BY3RpdmVEaXJlY3RvcnlSaWdodHMgLW1hdGNoICJEZWxldGUiKSAtb3IgKCgkXy5BY3RpdmVEaXJlY3RvcnlSaWdodHMgLW1hdGNoICJFeHRlbmRlZFJpZ2h0IikgLWFuZCAoJF8uQWNjZXNzQ29udHJvbFR5cGUgLWVxICJBbGxvdyIpKQogICAgfQp9CgoKZmlsdGVyIEdldC1HVUlETWFwIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBIZWxwZXIgdG8gYnVpbGQgYSBoYXNoIHRhYmxlIG9mIFtHVUlEXSAtPiByZXNvbHZlZCBuYW1lcwoKICAgICAgICBIZWF2aWx5IGFkYXB0ZWQgZnJvbSBodHRwOi8vYmxvZ3MudGVjaG5ldC5jb20vYi9hc2hsZXltY2dsb25lL2FyY2hpdmUvMjAxMy8wMy8yNS9hY3RpdmUtZGlyZWN0b3J5LW91LXBlcm1pc3Npb25zLXJlcG9ydC1mcmVlLXBvd2Vyc2hlbGwtc2NyaXB0LWRvd25sb2FkLmFzcHgKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHVzZSBmb3IgdGhlIHF1ZXJ5LCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL2Jsb2dzLnRlY2huZXQuY29tL2IvYXNobGV5bWNnbG9uZS9hcmNoaXZlLzIwMTMvMDMvMjUvYWN0aXZlLWRpcmVjdG9yeS1vdS1wZXJtaXNzaW9ucy1yZXBvcnQtZnJlZS1wb3dlcnNoZWxsLXNjcmlwdC1kb3dubG9hZC5hc3B4CiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwCiAgICApCgogICAgJEdVSURzID0gQHsnMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwJyA9ICdBbGwnfQoKICAgICRTY2hlbWFQYXRoID0gKEdldC1OZXRGb3Jlc3QpLnNjaGVtYS5uYW1lCgogICAgJFNjaGVtYVNlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1BRFNwYXRoICRTY2hlbWFQYXRoIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgIGlmKCRTY2hlbWFTZWFyY2hlcikgewogICAgICAgICRTY2hlbWFTZWFyY2hlci5maWx0ZXIgPSAiKHNjaGVtYUlER1VJRD0qKSIKICAgICAgICB0cnkgewogICAgICAgICAgICAkUmVzdWx0cyA9ICRTY2hlbWFTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICMgY29udmVydCB0aGUgR1VJRAogICAgICAgICAgICAgICAgJEdVSURzWyhOZXctT2JqZWN0IEd1aWQgKCwkXy5wcm9wZXJ0aWVzLnNjaGVtYWlkZ3VpZFswXSkpLkd1aWRdID0gJF8ucHJvcGVydGllcy5uYW1lWzBdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICRTY2hlbWFTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBpbiBidWlsZGluZyBHVUlEIG1hcDogJF8iCiAgICAgICAgfQogICAgfQoKICAgICRSaWdodHNTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtQURTcGF0aCAkU2NoZW1hUGF0aC5yZXBsYWNlKCJTY2hlbWEiLCJFeHRlbmRlZC1SaWdodHMiKSAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIC1DcmVkZW50aWFsICRDcmVkZW50aWFsCiAgICBpZiAoJFJpZ2h0c1NlYXJjaGVyKSB7CiAgICAgICAgJFJpZ2h0c1NlYXJjaGVyLmZpbHRlciA9ICIob2JqZWN0Q2xhc3M9Y29udHJvbEFjY2Vzc1JpZ2h0KSIKICAgICAgICB0cnkgewogICAgICAgICAgICAkUmVzdWx0cyA9ICRSaWdodHNTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICMgY29udmVydCB0aGUgR1VJRAogICAgICAgICAgICAgICAgJEdVSURzWyRfLnByb3BlcnRpZXMucmlnaHRzZ3VpZFswXS50b1N0cmluZygpXSA9ICRfLnByb3BlcnRpZXMubmFtZVswXQogICAgICAgICAgICB9CiAgICAgICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICAgICAkUmlnaHRzU2VhcmNoZXIuZGlzcG9zZSgpCiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgaW4gYnVpbGRpbmcgR1VJRCBtYXA6ICRfIgogICAgICAgIH0KICAgIH0KCiAgICAkR1VJRHMKfQoKCmZ1bmN0aW9uIEdldC1OZXRDb21wdXRlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiB1dGlsaXplcyBhZHNpc2VhcmNoZXIgdG8gcXVlcnkgdGhlIGN1cnJlbnQgQUQgY29udGV4dAogICAgICAgIGZvciBjdXJyZW50IGNvbXB1dGVyIG9iamVjdHMuIEJhc2VkIG9mZiBvZiBDYXJsb3MgUGVyZXoncyBBdWRpdC5wc20xCiAgICAgICAgc2NyaXB0IGluIFBvc2gtU2VjTW9kIChsaW5rIGJlbG93KS4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBSZXR1cm4gY29tcHV0ZXJzIHdpdGggYSBzcGVjaWZpYyBuYW1lLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBTUE4KCiAgICAgICAgUmV0dXJuIGNvbXB1dGVycyB3aXRoIGEgc3BlY2lmaWMgc2VydmljZSBwcmluY2lwYWwgbmFtZSwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgT3BlcmF0aW5nU3lzdGVtCgogICAgICAgIFJldHVybiBjb21wdXRlcnMgd2l0aCBhIHNwZWNpZmljIG9wZXJhdGluZyBzeXN0ZW0sIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIFNlcnZpY2VQYWNrCgogICAgICAgIFJldHVybiBjb21wdXRlcnMgd2l0aCBhIHNwZWNpZmljIHNlcnZpY2UgcGFjaywgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgRmlsdGVyCgogICAgICAgIEEgY3VzdG9taXplZCBsZGFwIGZpbHRlciBzdHJpbmcgdG8gdXNlLCBlLmcuICIoZGVzY3JpcHRpb249KmFkbWluKikiCgogICAgLlBBUkFNRVRFUiBQcmludGVycwoKICAgICAgICBTd2l0Y2guIFJldHVybiBvbmx5IHByaW50ZXJzLgoKICAgIC5QQVJBTUVURVIgUGluZwoKICAgICAgICBTd2l0Y2guIFBpbmcgZWFjaCBob3N0IHRvIGVuc3VyZSBpdCdzIHVwIGJlZm9yZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIEZ1bGxEYXRhCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIGZ1bGwgY29tcHV0ZXIgb2JqZWN0cyBpbnN0ZWFkIG9mIGp1c3Qgc3lzdGVtIG5hbWVzICh0aGUgZGVmYXVsdCkuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgY29tcHV0ZXJzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCwgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIFNpdGVOYW1lCgogICAgICAgIFRoZSBBRCBTaXRlIG5hbWUgdG8gc2VhcmNoIGZvciBjb21wdXRlcnMuCgogICAgLlBBUkFNRVRFUiBVbmNvbnN0cmFpbmVkCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIGNvbXB1dGVyIG9iamVjdHMgdGhhdCBoYXZlIHVuY29uc3RyYWluZWQgZGVsZWdhdGlvbi4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldENvbXB1dGVyCgogICAgICAgIFJldHVybnMgdGhlIGN1cnJlbnQgY29tcHV0ZXJzIGluIGN1cnJlbnQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldENvbXB1dGVyIC1TUE4gbXNzcWwqCgogICAgICAgIFJldHVybnMgYWxsIE1TIFNRTCBzZXJ2ZXJzIG9uIHRoZSBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiB0ZXN0aW5nCgogICAgICAgIFJldHVybnMgdGhlIGN1cnJlbnQgY29tcHV0ZXJzIGluICd0ZXN0aW5nJyBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiB0ZXN0aW5nIC1GdWxsRGF0YQoKICAgICAgICBSZXR1cm5zIGZ1bGwgY29tcHV0ZXIgb2JqZWN0cyBpbiB0aGUgJ3Rlc3RpbmcnIGRvbWFpbi4KCiAgICAuTElOSwoKICAgICAgICBodHRwczovL2dpdGh1Yi5jb20vZGFya29wZXJhdG9yL1Bvc2gtU2VjTW9kL2Jsb2IvbWFzdGVyL0F1ZGl0L0F1ZGl0LnBzbTEKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnKicsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNQTiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkT3BlcmF0aW5nU3lzdGVtLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRTZXJ2aWNlUGFjaywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRmlsdGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRQcmludGVycywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkUGluZywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRnVsbERhdGEsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2l0ZU5hbWUsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVuY29uc3RyYWluZWQsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIGJlZ2luIHsKICAgICAgICAjIHNvIHRoaXMgaXNuJ3QgcmVwZWF0ZWQgaWYgbXVsdGlwbGUgY29tcHV0ZXIgbmFtZXMgYXJlIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICAgICAkQ29tcFNlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQURTcGF0aCAkQURTcGF0aCAtUGFnZVNpemUgJFBhZ2VTaXplIC1DcmVkZW50aWFsICRDcmVkZW50aWFsCiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIGlmICgkQ29tcFNlYXJjaGVyKSB7CgogICAgICAgICAgICAjIGlmIHdlJ3JlIGNoZWNraW5nIGZvciB1bmNvbnN0cmFpbmVkIGRlbGVnYXRpb24KICAgICAgICAgICAgaWYoJFVuY29uc3RyYWluZWQpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlNlYXJjaGluZyBmb3IgY29tcHV0ZXJzIHdpdGggZm9yIHVuY29uc3RyYWluZWQgZGVsZWdhdGlvbiIKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIih1c2VyQWNjb3VudENvbnRyb2w6MS4yLjg0MC4xMTM1NTYuMS40LjgwMzo9NTI0Mjg4KSIKICAgICAgICAgICAgfQogICAgICAgICAgICAjIHNldCB0aGUgZmlsdGVycyBmb3IgdGhlIHNlcmFjaGVyIGlmIGl0IGV4aXN0cwogICAgICAgICAgICBpZigkUHJpbnRlcnMpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlNlYXJjaGluZyBmb3IgcHJpbnRlcnMiCiAgICAgICAgICAgICAgICAjICRDb21wU2VhcmNoZXIuZmlsdGVyPSIoJihvYmplY3RDYXRlZ29yeT1wcmludFF1ZXVlKSRGaWx0ZXIpIgogICAgICAgICAgICAgICAgJEZpbHRlciArPSAiKG9iamVjdENhdGVnb3J5PXByaW50UXVldWUpIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRTUE4pIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlNlYXJjaGluZyBmb3IgY29tcHV0ZXJzIHdpdGggU1BOOiAkU1BOIgogICAgICAgICAgICAgICAgJEZpbHRlciArPSAiKHNlcnZpY2VQcmluY2lwYWxOYW1lPSRTUE4pIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRPcGVyYXRpbmdTeXN0ZW0pIHsKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIihvcGVyYXRpbmdzeXN0ZW09JE9wZXJhdGluZ1N5c3RlbSkiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJFNlcnZpY2VQYWNrKSB7CiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICIob3BlcmF0aW5nc3lzdGVtc2VydmljZXBhY2s9JFNlcnZpY2VQYWNrKSIKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkU2l0ZU5hbWUpIHsKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIihzZXJ2ZXJyZWZlcmVuY2VibD0kU2l0ZU5hbWUpIgogICAgICAgICAgICB9CgogICAgICAgICAgICAkQ29tcEZpbHRlciA9ICIoJihzQU1BY2NvdW50VHlwZT04MDUzMDYzNjkpKGRuc2hvc3RuYW1lPSRDb21wdXRlck5hbWUpJEZpbHRlcikiCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkdldC1OZXRDb21wdXRlciBmaWx0ZXIgOiAnJENvbXBGaWx0ZXInIgogICAgICAgICAgICAkQ29tcFNlYXJjaGVyLmZpbHRlciA9ICRDb21wRmlsdGVyCgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJFJlc3VsdHMgPSAkQ29tcFNlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAkVXAgPSAkVHJ1ZQogICAgICAgICAgICAgICAgICAgIGlmKCRQaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgVE9ETzogaG93IGNhbiB0aGVzZSByZXN1bHRzIGJlIHBpcGVkIHRvIHBpbmcgZm9yIGEgc3BlZWR1cD8KICAgICAgICAgICAgICAgICAgICAgICAgJFVwID0gVGVzdC1Db25uZWN0aW9uIC1Db3VudCAxIC1RdWlldCAtQ29tcHV0ZXJOYW1lICRfLnByb3BlcnRpZXMuZG5zaG9zdG5hbWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoJFVwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgcmV0dXJuIGZ1bGwgZGF0YSBvYmplY3RzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkRnVsbERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgY29udmVydC9wcm9jZXNzIHRoZSBMREFQIGZpZWxkcyBmb3IgZWFjaCByZXN1bHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDb21wdXRlciA9IENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDb21wdXRlci5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuQ29tcHV0ZXInKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJENvbXB1dGVyCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSB3ZSdyZSBqdXN0IHJldHVybmluZyB0aGUgRE5TIGhvc3QgbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJF8ucHJvcGVydGllcy5kbnNob3N0bmFtZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICAgICAkQ29tcFNlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkVycm9yOiAkXyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1BRE9iamVjdCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGFrZXMgYSBkb21haW4gU0lEIGFuZCByZXR1cm5zIHRoZSB1c2VyLCBncm91cCwgb3IgY29tcHV0ZXIgb2JqZWN0CiAgICAgICAgYXNzb2NpYXRlZCB3aXRoIGl0LgoKICAgIC5QQVJBTUVURVIgU0lECgogICAgICAgIFRoZSBTSUQgb2YgdGhlIGRvbWFpbiBvYmplY3QgeW91J3JlIHF1ZXJ5aW5nIGZvci4KCiAgICAuUEFSQU1FVEVSIE5hbWUKCiAgICAgICAgVGhlIE5hbWUgb2YgdGhlIGRvbWFpbiBvYmplY3QgeW91J3JlIHF1ZXJ5aW5nIGZvci4KCiAgICAuUEFSQU1FVEVSIFNhbUFjY291bnROYW1lCgogICAgICAgIFRoZSBTYW1BY2NvdW50TmFtZSBvZiB0aGUgZG9tYWluIG9iamVjdCB5b3UncmUgcXVlcnlpbmcgZm9yLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIG9iamVjdHMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgRmlsdGVyCgogICAgICAgIEFkZGl0aW9uYWwgTERBUCBmaWx0ZXIgc3RyaW5nIGZvciB0aGUgcXVlcnkuCgogICAgLlBBUkFNRVRFUiBSZXR1cm5SYXcKCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gdGhlIHJhdyBvYmplY3QgaW5zdGVhZCBvZiB0cmFuc2xhdGluZyBpdHMgcHJvcGVydGllcy4KICAgICAgICBVc2VkIGJ5IFNldC1BRE9iamVjdCB0byBtb2RpZnkgb2JqZWN0IHByb3BlcnRpZXMuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1BRE9iamVjdCAtU0lEICJTLTEtNS0yMS0yNjIwODkxODI5LTI0MTEyNjE0OTctMTc3Mzg1MzA4OC0xMTEwIgoKICAgICAgICBHZXQgdGhlIGRvbWFpbiBvYmplY3QgYXNzb2NpYXRlZCB3aXRoIHRoZSBzcGVjaWZpZWQgU0lELgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUFET2JqZWN0IC1BRFNwYXRoICJDTj1BZG1pblNESG9sZGVyLENOPVN5c3RlbSxEQz10ZXN0bGFiLERDPWxvY2FsIgoKICAgICAgICBHZXQgdGhlIEFkbWluU0RIb2xkZXIgb2JqZWN0IGZvciB0aGUgdGVzdGxhYi5sb2NhbCBkb21haW4uCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRTSUQsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNhbUFjY291bnROYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZpbHRlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkUmV0dXJuUmF3LAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0KICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKICAgIHByb2Nlc3MgewogICAgICAgIGlmKCRTSUQgLWFuZCAoLW5vdCAkRG9tYWluKSkgewogICAgICAgICAgICAjIGlmIGEgU0lEIGlzIHBhc3NlZCwgdHJ5IHRvIHJlc29sdmUgaXQgdG8gYSByZWFjaGFibGUgZG9tYWluIG5hbWUgZm9yIHRoZSBzZWFyY2hlcgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJE5hbWUgPSBDb252ZXJ0LVNpZFRvTmFtZSAkU0lECiAgICAgICAgICAgICAgICBpZigkTmFtZSkgewogICAgICAgICAgICAgICAgICAgICRDYW5vbmljYWwgPSBDb252ZXJ0LUFETmFtZSAtT2JqZWN0TmFtZSAkTmFtZSAtSW5wdXRUeXBlIE5UNCAtT3V0cHV0VHlwZSBDYW5vbmljYWwKICAgICAgICAgICAgICAgICAgICBpZigkQ2Fub25pY2FsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICREb21haW4gPSAkQ2Fub25pY2FsLnNwbGl0KCIvIilbMF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIHJlc29sdmluZyBTSUQgJyRTSUQnIgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJE51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgcmVzb2x2aW5nIFNJRCAnJFNJRCcgOiAkXyIKICAgICAgICAgICAgICAgIHJldHVybiAkTnVsbAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkT2JqZWN0U2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwYXRoICRBRFNwYXRoIC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgaWYoJE9iamVjdFNlYXJjaGVyKSB7CiAgICAgICAgICAgIGlmKCRTSUQpIHsKICAgICAgICAgICAgICAgICRPYmplY3RTZWFyY2hlci5maWx0ZXIgPSAiKCYob2JqZWN0c2lkPSRTSUQpJEZpbHRlcikiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCROYW1lKSB7CiAgICAgICAgICAgICAgICAkT2JqZWN0U2VhcmNoZXIuZmlsdGVyID0gIigmKG5hbWU9JE5hbWUpJEZpbHRlcikiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRTYW1BY2NvdW50TmFtZSkgewogICAgICAgICAgICAgICAgJE9iamVjdFNlYXJjaGVyLmZpbHRlciA9ICIoJihzYW1BY2NvdW50TmFtZT0kU2FtQWNjb3VudE5hbWUpJEZpbHRlcikiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkUmVzdWx0cyA9ICRPYmplY3RTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgaWYoJFJldHVyblJhdykgewogICAgICAgICAgICAgICAgICAgICAgICAkXwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0L3Byb2Nlc3MgdGhlIExEQVAgZmllbGRzIGZvciBlYWNoIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgYnVpbGRpbmcgdGhlIHNlYXJjaGVyIG9iamVjdCEiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJE9iamVjdFNlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIFNldC1BRE9iamVjdCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGFrZXMgYSBTSUQsIG5hbWUsIG9yIFNhbUFjY291bnROYW1lIHRvIHF1ZXJ5IGZvciBhIHNwZWNpZmllZAogICAgICAgIGRvbWFpbiBvYmplY3QsIGFuZCB0aGVuIHNldHMgYSBzcGVjaWZpZWQgJ1Byb3BlcnR5TmFtZScgdG8gYQogICAgICAgIHNwZWNpZmllZCAnUHJvcGVydHlWYWx1ZScuCgogICAgLlBBUkFNRVRFUiBTSUQKCiAgICAgICAgVGhlIFNJRCBvZiB0aGUgZG9tYWluIG9iamVjdCB5b3UncmUgcXVlcnlpbmcgZm9yLgoKICAgIC5QQVJBTUVURVIgTmFtZQoKICAgICAgICBUaGUgTmFtZSBvZiB0aGUgZG9tYWluIG9iamVjdCB5b3UncmUgcXVlcnlpbmcgZm9yLgoKICAgIC5QQVJBTUVURVIgU2FtQWNjb3VudE5hbWUKCiAgICAgICAgVGhlIFNhbUFjY291bnROYW1lIG9mIHRoZSBkb21haW4gb2JqZWN0IHlvdSdyZSBxdWVyeWluZyBmb3IuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3Igb2JqZWN0cywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgRmlsdGVyCgogICAgICAgIEFkZGl0aW9uYWwgTERBUCBmaWx0ZXIgc3RyaW5nIGZvciB0aGUgcXVlcnkuCgogICAgLlBBUkFNRVRFUiBQcm9wZXJ0eU5hbWUKCiAgICAgICAgVGhlIHByb3BlcnR5IG5hbWUgdG8gc2V0LgoKICAgIC5QQVJBTUVURVIgUHJvcGVydHlWYWx1ZQoKICAgICAgICBUaGUgdmFsdWUgdG8gc2V0IGZvciBQcm9wZXJ0eU5hbWUKCiAgICAuUEFSQU1FVEVSIFByb3BlcnR5WG9yVmFsdWUKCiAgICAgICAgSW50ZWdlciB2YWx1ZSB0byBiaW5hcnkgeG9yICgtYnhvcikgd2l0aCB0aGUgY3VycmVudCBpbnQgdmFsdWUuCgogICAgLlBBUkFNRVRFUiBDbGVhclZhbHVlCgogICAgICAgIFN3aXRjaC4gQ2xlYXIgdGhlIHZhbHVlIG9mIFByb3BlcnR5TmFtZQoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBTZXQtQURPYmplY3QgLVNhbUFjY291bnROYW1lIG1hdHQuYWRtaW4gLVByb3BlcnR5TmFtZSBjb3VudHJ5Y29kZSAtUHJvcGVydHlWYWx1ZSAwCgogICAgICAgIFNldCB0aGUgY291bnRyeWNvZGUgZm9yIG1hdHQuYWRtaW4gdG8gMAoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gU2V0LUFET2JqZWN0IC1TYW1BY2NvdW50TmFtZSBtYXR0LmFkbWluIC1Qcm9wZXJ0eU5hbWUgdXNlcmFjY291bnRjb250cm9sIC1Qcm9wZXJ0eVhvclZhbHVlIDY1NTM2CgogICAgICAgIFNldCB0aGUgcGFzc3dvcmQgbm90IHRvIGV4cGlyZSBvbiBtYXR0LmFkbWluCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbU3RyaW5nXQogICAgICAgICRTSUQsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNhbUFjY291bnROYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZpbHRlciwKCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkUHJvcGVydHlOYW1lLAoKICAgICAgICAkUHJvcGVydHlWYWx1ZSwKCiAgICAgICAgW0ludF0KICAgICAgICAkUHJvcGVydHlYb3JWYWx1ZSwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQ2xlYXJWYWx1ZSwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgJEFyZ3VtZW50cyA9IEB7CiAgICAgICAgJ1NJRCcgPSAkU0lECiAgICAgICAgJ05hbWUnID0gJE5hbWUKICAgICAgICAnU2FtQWNjb3VudE5hbWUnID0gJFNhbUFjY291bnROYW1lCiAgICAgICAgJ0RvbWFpbicgPSAkRG9tYWluCiAgICAgICAgJ0RvbWFpbkNvbnRyb2xsZXInID0gJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAnRmlsdGVyJyA9ICRGaWx0ZXIKICAgICAgICAnUGFnZVNpemUnID0gJFBhZ2VTaXplCiAgICAgICAgJ0NyZWRlbnRpYWwnID0gJENyZWRlbnRpYWwKICAgIH0KICAgICMgc3BsYXQgdGhlIGFwcHJvcHJpYXRlIGFyZ3VtZW50cyB0byBHZXQtQURPYmplY3QKICAgICRSYXdPYmplY3QgPSBHZXQtQURPYmplY3QgLVJldHVyblJhdyBAQXJndW1lbnRzCgogICAgdHJ5IHsKICAgICAgICAjIGdldCB0aGUgbW9kaWZpYWJsZSBvYmplY3QgZm9yIHRoaXMgc2VhcmNoIHJlc3VsdAogICAgICAgICRFbnRyeSA9ICRSYXdPYmplY3QuR2V0RGlyZWN0b3J5RW50cnkoKQoKICAgICAgICBpZigkQ2xlYXJWYWx1ZSkgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDbGVhcmluZyB2YWx1ZSIKICAgICAgICAgICAgJEVudHJ5LiRQcm9wZXJ0eU5hbWUuY2xlYXIoKQogICAgICAgICAgICAkRW50cnkuY29tbWl0Y2hhbmdlcygpCiAgICAgICAgfQoKICAgICAgICBlbHNlaWYoJFByb3BlcnR5WG9yVmFsdWUpIHsKICAgICAgICAgICAgJFR5cGVOYW1lID0gJEVudHJ5LiRQcm9wZXJ0eU5hbWVbMF0uR2V0VHlwZSgpLm5hbWUKCiAgICAgICAgICAgICMgVUFDIHZhbHVlIHJlZmVyZW5jZXMtIGh0dHBzOi8vc3VwcG9ydC5taWNyb3NvZnQuY29tL2VuLXVzL2tiLzMwNTE0NAogICAgICAgICAgICAkUHJvcGVydHlWYWx1ZSA9ICQoJEVudHJ5LiRQcm9wZXJ0eU5hbWUpIC1ieG9yICRQcm9wZXJ0eVhvclZhbHVlCiAgICAgICAgICAgICRFbnRyeS4kUHJvcGVydHlOYW1lID0gJFByb3BlcnR5VmFsdWUgLWFzICRUeXBlTmFtZQogICAgICAgICAgICAkRW50cnkuY29tbWl0Y2hhbmdlcygpCiAgICAgICAgfQoKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJEVudHJ5LnB1dCgkUHJvcGVydHlOYW1lLCAkUHJvcGVydHlWYWx1ZSkKICAgICAgICAgICAgJEVudHJ5LnNldGluZm8oKQogICAgICAgIH0KICAgIH0KICAgIGNhdGNoIHsKICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBzZXR0aW5nIHByb3BlcnR5ICRQcm9wZXJ0eU5hbWUgdG8gdmFsdWUgJyRQcm9wZXJ0eVZhbHVlJyBmb3Igb2JqZWN0ICQoJFJhd09iamVjdC5Qcm9wZXJ0aWVzLnNhbWFjY291bnRuYW1lKSA6ICRfIgogICAgfQp9CgoKZnVuY3Rpb24gSW52b2tlLURvd25ncmFkZUFjY291bnQgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFNldCByZXZlcnNpYmxlIGVuY3J5cHRpb24gb24gYSBnaXZlbiBhY2NvdW50IGFuZCB0aGVuIGZvcmNlIHRoZSBwYXNzd29yZAogICAgICAgIHRvIGJlIHNldCBvbiBuZXh0IHVzZXIgbG9naW4uIFRvIHJlcGFpciB1c2UgIi1SZXBhaXIiLgoKICAgIC5QQVJBTUVURVIgU2FtQWNjb3VudE5hbWUKCiAgICAgICAgVGhlIFNhbUFjY291bnROYW1lIG9mIHRoZSBkb21haW4gb2JqZWN0IHlvdSdyZSBxdWVyeWluZyBmb3IuCgogICAgLlBBUkFNRVRFUiBOYW1lCgogICAgICAgIFRoZSBOYW1lIG9mIHRoZSBkb21haW4gb2JqZWN0IHlvdSdyZSBxdWVyeWluZyBmb3IuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3Igb2JqZWN0cywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgRmlsdGVyCgogICAgICAgIEFkZGl0aW9uYWwgTERBUCBmaWx0ZXIgc3RyaW5nIGZvciB0aGUgcXVlcnkuCgogICAgLlBBUkFNRVRFUiBSZXBhaXIKCiAgICAgICAgU3dpdGNoLiBVbnNldCB0aGUgcmV2ZXJzaWJsZSBlbmNyeXB0aW9uIGZsYWcgYW5kIGZvcmNlIHBhc3N3b3JkIHJlc2V0IGZsYWcuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUz4gSW52b2tlLURvd25ncmFkZUFjY291bnQgLVNhbUFjY291bnROYW1lIGphc29uCgogICAgICAgIFNldCByZXZlcnNpYmxlIGVuY3J5cHRpb24gb24gdGhlICdqYXNvbicgYWNjb3VudCBhbmQgZm9yY2UgdGhlIHBhc3N3b3JkIHRvIGJlIGNoYW5nZWQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFM+IEludm9rZS1Eb3duZ3JhZGVBY2NvdW50IC1TYW1BY2NvdW50TmFtZSBqYXNvbiAtUmVwYWlyCgogICAgICAgIFVuc2V0IHJldmVyc2libGUgZW5jcnlwdGlvbiBvbiB0aGUgJ2phc29uJyBhY2NvdW50IGFuZCByZW1vdmUgdGhlIGZvcmNlZCBwYXNzd29yZCBjaGFuZ2UuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnU2FtQWNjb3VudE5hbWUnLCBQb3NpdGlvbj0wLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2FtQWNjb3VudE5hbWUsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdOYW1lJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRGaWx0ZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlcGFpciwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBwcm9jZXNzIHsKICAgICAgICAkQXJndW1lbnRzID0gQHsKICAgICAgICAgICAgJ1NhbUFjY291bnROYW1lJyA9ICRTYW1BY2NvdW50TmFtZQogICAgICAgICAgICAnTmFtZScgPSAkTmFtZQogICAgICAgICAgICAnRG9tYWluJyA9ICREb21haW4KICAgICAgICAgICAgJ0RvbWFpbkNvbnRyb2xsZXInID0gJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgJ0ZpbHRlcicgPSAkRmlsdGVyCiAgICAgICAgICAgICdDcmVkZW50aWFsJyA9ICRDcmVkZW50aWFsCiAgICAgICAgfQoKICAgICAgICAjIHNwbGF0IHRoZSBhcHByb3ByaWF0ZSBhcmd1bWVudHMgdG8gR2V0LUFET2JqZWN0CiAgICAgICAgJFVBQ1ZhbHVlcyA9IEdldC1BRE9iamVjdCBAQXJndW1lbnRzIHwgc2VsZWN0IHVzZXJhY2NvdW50Y29udHJvbCB8IENvbnZlcnRGcm9tLVVBQ1ZhbHVlCgogICAgICAgIGlmKCRSZXBhaXIpIHsKCiAgICAgICAgICAgIGlmKCRVQUNWYWx1ZXMuS2V5cyAtY29udGFpbnMgIkVOQ1JZUFRFRF9URVhUX1BXRF9BTExPV0VEIikgewogICAgICAgICAgICAgICAgIyBpZiByZXZlcnNpYmxlIGVuY3J5cHRpb24gaXMgc2V0LCB1bnNldCBpdAogICAgICAgICAgICAgICAgU2V0LUFET2JqZWN0IEBBcmd1bWVudHMgLVByb3BlcnR5TmFtZSB1c2VyYWNjb3VudGNvbnRyb2wgLVByb3BlcnR5WG9yVmFsdWUgMTI4CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgdW5zZXQgdGhlIGZvcmNlZCBwYXNzd29yZCBjaGFuZ2UKICAgICAgICAgICAgU2V0LUFET2JqZWN0IEBBcmd1bWVudHMgLVByb3BlcnR5TmFtZSBwd2RsYXN0c2V0IC1Qcm9wZXJ0eVZhbHVlIC0xCiAgICAgICAgfQoKICAgICAgICBlbHNlIHsKCiAgICAgICAgICAgIGlmKCRVQUNWYWx1ZXMuS2V5cyAtY29udGFpbnMgIkRPTlRfRVhQSVJFX1BBU1NXT1JEIikgewogICAgICAgICAgICAgICAgIyBpZiB0aGUgcGFzc3dvcmQgaXMgc2V0IHRvIG5ldmVyIGV4cGlyZSwgdW5zZXQKICAgICAgICAgICAgICAgIFNldC1BRE9iamVjdCBAQXJndW1lbnRzIC1Qcm9wZXJ0eU5hbWUgdXNlcmFjY291bnRjb250cm9sIC1Qcm9wZXJ0eVhvclZhbHVlIDY1NTM2CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCRVQUNWYWx1ZXMuS2V5cyAtbm90Y29udGFpbnMgIkVOQ1JZUFRFRF9URVhUX1BXRF9BTExPV0VEIikgewogICAgICAgICAgICAgICAgIyBpZiByZXZlcnNpYmxlIGVuY3J5cHRpb24gaXMgbm90IHNldCwgc2V0IGl0CiAgICAgICAgICAgICAgICBTZXQtQURPYmplY3QgQEFyZ3VtZW50cyAtUHJvcGVydHlOYW1lIHVzZXJhY2NvdW50Y29udHJvbCAtUHJvcGVydHlYb3JWYWx1ZSAxMjgKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBmb3JjZSB0aGUgcGFzc3dvcmQgdG8gYmUgY2hhbmdlZCBvbiBuZXh0IGxvZ2luCiAgICAgICAgICAgIFNldC1BRE9iamVjdCBAQXJndW1lbnRzIC1Qcm9wZXJ0eU5hbWUgcHdkbGFzdHNldCAtUHJvcGVydHlWYWx1ZSAwCiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LUNvbXB1dGVyUHJvcGVydHkgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFJldHVybnMgYSBsaXN0IG9mIGFsbCBjb21wdXRlciBvYmplY3QgcHJvcGVydGllcy4gSWYgYSBwcm9wZXJ0eQogICAgICAgIG5hbWUgaXMgc3BlY2lmaWVkLCBpdCByZXR1cm5zIGFsbCBbY29tcHV0ZXI6cHJvcGVydHldIHZhbHVlcy4KCiAgICAgICAgVGFrZW4gZGlyZWN0bHkgZnJvbSBAb2JzY3VyZXNlYydzIHBvc3Q6CiAgICAgICAgICAgIGh0dHA6Ly9vYnNjdXJlc2VjdXJpdHkuYmxvZ3Nwb3QuY29tLzIwMTQvMDQvQURTSVNlYXJjaGVyLmh0bWwKCiAgICAuUEFSQU1FVEVSIFByb3BlcnRpZXMKCiAgICAgICAgUmV0dXJuIHByb3BlcnR5IG5hbWVzIGZvciBjb21wdXRlcnMuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgY29tcHV0ZXIgcHJvcGVydGllcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtQ29tcHV0ZXJQcm9wZXJ0eSAtRG9tYWluIHRlc3RpbmcKCiAgICAgICAgUmV0dXJucyBhbGwgdXNlciBwcm9wZXJ0aWVzIGZvciBjb21wdXRlcnMgaW4gdGhlICd0ZXN0aW5nJyBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtQ29tcHV0ZXJQcm9wZXJ0eSAtUHJvcGVydGllcyBzc24sbGFzdGxvZ29uLGxvY2F0aW9uCgogICAgICAgIFJldHVybnMgYWxsIGFuIGFycmF5IG9mIGNvbXB1dGVyL3Nzbi9sYXN0bG9naW4vbG9jYXRpb24gY29tYmluYXRpb25zCiAgICAgICAgZm9yIGNvbXB1dGVycyBpbiB0aGUgY3VycmVudCBkb21haW4uCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL29ic2N1cmVzZWN1cml0eS5ibG9nc3BvdC5jb20vMjAxNC8wNC9BRFNJU2VhcmNoZXIuaHRtbAojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJFByb3BlcnRpZXMsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgaWYoJFByb3BlcnRpZXMpIHsKICAgICAgICAjIGV4dHJhY3Qgb3V0IHRoZSBzZXQgb2YgYWxsIHByb3BlcnRpZXMgZm9yIGVhY2ggb2JqZWN0CiAgICAgICAgJFByb3BlcnRpZXMgPSAsIm5hbWUiICsgJFByb3BlcnRpZXMgfCBTb3J0LU9iamVjdCAtVW5pcXVlCiAgICAgICAgR2V0LU5ldENvbXB1dGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRnVsbERhdGEgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IFNlbGVjdC1PYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzCiAgICB9CiAgICBlbHNlIHsKICAgICAgICAjIGV4dHJhY3Qgb3V0IGp1c3QgdGhlIHByb3BlcnR5IG5hbWVzCiAgICAgICAgR2V0LU5ldENvbXB1dGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRnVsbERhdGEgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IFNlbGVjdC1PYmplY3QgLWZpcnN0IDEgfCBHZXQtTWVtYmVyIC1NZW1iZXJUeXBlICpQcm9wZXJ0eSB8IFNlbGVjdC1PYmplY3QgLVByb3BlcnR5ICJOYW1lIgogICAgfQp9CgoKZnVuY3Rpb24gRmluZC1Db21wdXRlckZpZWxkIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBTZWFyY2hlcyBjb21wdXRlciBvYmplY3QgZmllbGRzIGZvciBhIGdpdmVuIHdvcmQgKGRlZmF1bHQgKnBhc3MqKS4gRGVmYXVsdAogICAgICAgIGZpZWxkIGJlaW5nIHNlYXJjaGVkIGlzICdkZXNjcmlwdGlvbicuCgogICAgICAgIFRha2VuIGRpcmVjdGx5IGZyb20gQG9ic2N1cmVzZWMncyBwb3N0OgogICAgICAgICAgICBodHRwOi8vb2JzY3VyZXNlY3VyaXR5LmJsb2dzcG90LmNvbS8yMDE0LzA0L0FEU0lTZWFyY2hlci5odG1sCgogICAgLlBBUkFNRVRFUiBTZWFyY2hUZXJtCgogICAgICAgIFRlcm0gdG8gc2VhcmNoIGZvciwgZGVmYXVsdCBvZiAicGFzcyIuCgogICAgLlBBUkFNRVRFUiBTZWFyY2hGaWVsZAoKICAgICAgICBVc2VyIGZpZWxkIHRvIHNlYXJjaCBpbiwgZGVmYXVsdCBvZiAiZGVzY3JpcHRpb24iLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIHRvIHNlYXJjaCBjb21wdXRlciBmaWVsZHMgZm9yLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtQ29tcHV0ZXJGaWVsZCAtU2VhcmNoVGVybSBiYWNrdXAgLVNlYXJjaEZpZWxkIGluZm8KCiAgICAgICAgRmluZCBjb21wdXRlciBhY2NvdW50cyB3aXRoICJiYWNrdXAiIGluIHRoZSAiaW5mbyIgZmllbGQuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdUZXJtJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2VhcmNoVGVybSA9ICdwYXNzJywKCiAgICAgICAgW0FsaWFzKCdGaWVsZCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNlYXJjaEZpZWxkID0gJ2Rlc2NyaXB0aW9uJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0KICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBwcm9jZXNzIHsKICAgICAgICBHZXQtTmV0Q29tcHV0ZXIgLUFEU3BhdGggJEFEU3BhdGggLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1GdWxsRGF0YSAtRmlsdGVyICIoJFNlYXJjaEZpZWxkPSokU2VhcmNoVGVybSopIiAtUGFnZVNpemUgJFBhZ2VTaXplIHwgU2VsZWN0LU9iamVjdCBzYW1hY2NvdW50bmFtZSwkU2VhcmNoRmllbGQKICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1OZXRPVSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgR2V0cyBhIGxpc3Qgb2YgYWxsIGN1cnJlbnQgT1VzIGluIGEgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgT1VOYW1lCgogICAgICAgIFRoZSBPVSBuYW1lIHRvIHF1ZXJ5IGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgR1VJRAoKICAgICAgICBPbmx5IHJldHVybiBPVXMgd2l0aCB0aGUgc3BlY2lmaWVkIEdVSUQgaW4gdGhlaXIgZ3BsaW5rIHByb3BlcnR5LgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIE9VcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBGdWxsRGF0YQoKICAgICAgICBTd2l0Y2guIFJldHVybiBmdWxsIE9VIG9iamVjdHMgaW5zdGVhZCBvZiBqdXN0IG9iamVjdCBuYW1lcyAodGhlIGRlZmF1bHQpLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0T1UKCiAgICAgICAgUmV0dXJucyB0aGUgY3VycmVudCBPVXMgaW4gdGhlIGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRPVSAtT1VOYW1lICphZG1pbiogLURvbWFpbiB0ZXN0bGFiLmxvY2FsCgogICAgICAgIFJldHVybnMgYWxsIE9VcyB3aXRoICJhZG1pbiIgaW4gdGhlaXIgbmFtZSBpbiB0aGUgdGVzdGxhYi5sb2NhbCBkb21haW4uCgogICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldE9VIC1HVUlEIDEyMy0uLi4KCiAgICAgICAgUmV0dXJucyBhbGwgT1VzIHdpdGggbGlua2VkIHRvIHRoZSBzcGVjaWZpZWQgZ3JvdXAgcG9saWN5IG9iamVjdC4KCiAgICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiAiKmFkbWluKiIsIipzZXJ2ZXIqIiB8IEdldC1OZXRPVQoKICAgICAgICBHZXQgdGhlIGZ1bGwgT1UgbmFtZXMgZm9yIHRoZSBnaXZlbiBzZWFyY2ggdGVybXMgcGlwZWQgb24gdGhlIHBpcGVsaW5lLgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkT1VOYW1lID0gJyonLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRHVUlELAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEZ1bGxEYXRhLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0KICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgJE9VU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwYXRoICRBRFNwYXRoIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgIH0KICAgIHByb2Nlc3MgewogICAgICAgIGlmICgkT1VTZWFyY2hlcikgewogICAgICAgICAgICBpZiAoJEdVSUQpIHsKICAgICAgICAgICAgICAgICMgaWYgd2UncmUgZmlsdGVyaW5nIGZvciBhIEdVSUQgaW4gLmdwbGluawogICAgICAgICAgICAgICAgJE9VU2VhcmNoZXIuZmlsdGVyPSIoJihvYmplY3RDYXRlZ29yeT1vcmdhbml6YXRpb25hbFVuaXQpKG5hbWU9JE9VTmFtZSkoZ3BsaW5rPSokR1VJRCopKSIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRPVVNlYXJjaGVyLmZpbHRlcj0iKCYob2JqZWN0Q2F0ZWdvcnk9b3JnYW5pemF0aW9uYWxVbml0KShuYW1lPSRPVU5hbWUpKSIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJE9VU2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgIGlmICgkRnVsbERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0L3Byb2Nlc3MgdGhlIExEQVAgZmllbGRzIGZvciBlYWNoIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICAkT1UgPSBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgICAgICRPVS5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuT1UnKQogICAgICAgICAgICAgICAgICAgICAgICAkT1UKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgb3RoZXJ3aXNlIGp1c3QgcmV0dXJuaW5nIHRoZSBBRFMgcGF0aHMgb2YgdGhlIE9VcwogICAgICAgICAgICAgICAgICAgICAgICAkXy5wcm9wZXJ0aWVzLmFkc3BhdGgKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICRPVVNlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgJF8KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1OZXRTaXRlIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBHZXRzIGEgbGlzdCBvZiBhbGwgY3VycmVudCBzaXRlcyBpbiBhIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIFNpdGVOYW1lCgogICAgICAgIFNpdGUgZmlsdGVyIHN0cmluZywgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHNpdGVzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEdVSUQKCiAgICAgICAgT25seSByZXR1cm4gc2l0ZSB3aXRoIHRoZSBzcGVjaWZpZWQgR1VJRCBpbiB0aGVpciBncGxpbmsgcHJvcGVydHkuCgogICAgLlBBUkFNRVRFUiBGdWxsRGF0YQoKICAgICAgICBTd2l0Y2guIFJldHVybiBmdWxsIHNpdGUgb2JqZWN0cyBpbnN0ZWFkIG9mIGp1c3Qgb2JqZWN0IG5hbWVzICh0aGUgZGVmYXVsdCkuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRTaXRlIC1Eb21haW4gdGVzdGxhYi5sb2NhbCAtRnVsbERhdGEKCiAgICAgICAgUmV0dXJucyB0aGUgZnVsbCBkYXRhIG9iamVjdHMgZm9yIGFsbCBzaXRlcyBpbiB0ZXN0bGFiLmxvY2FsCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRTaXRlTmFtZSA9ICIqIiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRHVUlELAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRGdWxsRGF0YSwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgYmVnaW4gewogICAgICAgICRTaXRlU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLUFEU3BhdGggJEFEU3BhdGggLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwcmVmaXggIkNOPVNpdGVzLENOPUNvbmZpZ3VyYXRpb24iIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgIH0KICAgIHByb2Nlc3MgewogICAgICAgIGlmKCRTaXRlU2VhcmNoZXIpIHsKCiAgICAgICAgICAgIGlmICgkR1VJRCkgewogICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSBmaWx0ZXJpbmcgZm9yIGEgR1VJRCBpbiAuZ3BsaW5rCiAgICAgICAgICAgICAgICAkU2l0ZVNlYXJjaGVyLmZpbHRlcj0iKCYob2JqZWN0Q2F0ZWdvcnk9c2l0ZSkobmFtZT0kU2l0ZU5hbWUpKGdwbGluaz0qJEdVSUQqKSkiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkU2l0ZVNlYXJjaGVyLmZpbHRlcj0iKCYob2JqZWN0Q2F0ZWdvcnk9c2l0ZSkobmFtZT0kU2l0ZU5hbWUpKSIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJFNpdGVTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRGdWxsRGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQvcHJvY2VzcyB0aGUgTERBUCBmaWVsZHMgZm9yIGVhY2ggcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICRTaXRlID0gQ29udmVydC1MREFQUHJvcGVydHkgLVByb3BlcnRpZXMgJF8uUHJvcGVydGllcwogICAgICAgICAgICAgICAgICAgICAgICAkU2l0ZS5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuU2l0ZScpCiAgICAgICAgICAgICAgICAgICAgICAgICRTaXRlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSBqdXN0IHJldHVybiB0aGUgc2l0ZSBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRfLnByb3BlcnRpZXMubmFtZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRSZXN1bHRzLmRpc3Bvc2UoKQogICAgICAgICAgICAgICAgJFNpdGVTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICRfCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtTmV0U3VibmV0IHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBHZXRzIGEgbGlzdCBvZiBhbGwgY3VycmVudCBzdWJuZXRzIGluIGEgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgU2l0ZU5hbWUKCiAgICAgICAgT25seSByZXR1cm4gc3VibmV0cyBmcm9tIHRoZSBzcGVjaWZpZWQgU2l0ZU5hbWUuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3Igc3VibmV0cywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBGdWxsRGF0YQoKICAgICAgICBTd2l0Y2guIFJldHVybiBmdWxsIHN1Ym5ldCBvYmplY3RzIGluc3RlYWQgb2YganVzdCBvYmplY3QgbmFtZXMgKHRoZSBkZWZhdWx0KS4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldFN1Ym5ldAoKICAgICAgICBSZXR1cm5zIGFsbCBzdWJuZXQgbmFtZXMgaW4gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldFN1Ym5ldCAtRG9tYWluIHRlc3RsYWIubG9jYWwgLUZ1bGxEYXRhCgogICAgICAgIFJldHVybnMgdGhlIGZ1bGwgZGF0YSBvYmplY3RzIGZvciBhbGwgc3VibmV0cyBpbiB0ZXN0bGFiLmxvY2FsCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRTaXRlTmFtZSA9ICIqIiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRGdWxsRGF0YSwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgYmVnaW4gewogICAgICAgICRTdWJuZXRTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJEFEU3BhdGggLUFEU3ByZWZpeCAiQ049U3VibmV0cyxDTj1TaXRlcyxDTj1Db25maWd1cmF0aW9uIiAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICB9CgogICAgcHJvY2VzcyB7CiAgICAgICAgaWYoJFN1Ym5ldFNlYXJjaGVyKSB7CgogICAgICAgICAgICAkU3VibmV0U2VhcmNoZXIuZmlsdGVyPSIoJihvYmplY3RDYXRlZ29yeT1zdWJuZXQpKSIKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkUmVzdWx0cyA9ICRTdWJuZXRTZWFyY2hlci5GaW5kQWxsKCkKICAgICAgICAgICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRGdWxsRGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQvcHJvY2VzcyB0aGUgTERBUCBmaWVsZHMgZm9yIGVhY2ggcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgIENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMgfCBXaGVyZS1PYmplY3QgeyAkXy5zaXRlb2JqZWN0IC1tYXRjaCAiQ049JFNpdGVOYW1lIiB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSBqdXN0IHJldHVybiB0aGUgc3VibmV0IG5hbWUgYW5kIHNpdGUgbmFtZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICgkU2l0ZU5hbWUgLWFuZCAoJF8ucHJvcGVydGllcy5zaXRlb2JqZWN0IC1tYXRjaCAiQ049JFNpdGVOYW1lLCIpKSAtb3IgKCRTaXRlTmFtZSAtZXEgJyonKSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTdWJuZXRQcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU3VibmV0JyA9ICRfLnByb3BlcnRpZXMubmFtZVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkU3VibmV0UHJvcGVydGllc1snU2l0ZSddID0gKCRfLnByb3BlcnRpZXMuc2l0ZW9iamVjdFswXSkuc3BsaXQoIiwiKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTdWJuZXRQcm9wZXJ0aWVzWydTaXRlJ10gPSAnRXJyb3InCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5ICRTdWJuZXRQcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICRTdWJuZXRTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICRfCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtRG9tYWluU0lEIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBHZXRzIHRoZSBTSUQgZm9yIHRoZSBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5FWEFNUExFCgogICAgICAgIEM6XD4gR2V0LURvbWFpblNJRCAtRG9tYWluIFRFU1QKCiAgICAgICAgUmV0dXJucyBTSUQgZm9yIHRoZSBkb21haW4gJ1RFU1QnCiM+CgogICAgcGFyYW0oCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyCiAgICApCgogICAgJERDU0lEID0gR2V0LU5ldENvbXB1dGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtRnVsbERhdGEgLUZpbHRlciAnKHVzZXJBY2NvdW50Q29udHJvbDoxLjIuODQwLjExMzU1Ni4xLjQuODAzOj04MTkyKScgfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxIC1FeHBhbmRQcm9wZXJ0eSBvYmplY3RzaWQKICAgIGlmKCREQ1NJRCkgewogICAgICAgICREQ1NJRC5TdWJzdHJpbmcoMCwgJERDU0lELkxhc3RJbmRleE9mKCctJykpCiAgICB9CiAgICBlbHNlIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBleHRyYWN0aW5nIGRvbWFpbiBTSUQgZm9yICREb21haW4iCiAgICB9Cn0KCgpmdW5jdGlvbiBHZXQtTmV0R3JvdXAgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEdldHMgYSBsaXN0IG9mIGFsbCBjdXJyZW50IGdyb3VwcyBpbiBhIGRvbWFpbiwgb3IgYWxsCiAgICAgICAgdGhlIGdyb3VwcyBhIGdpdmVuIHVzZXIvZ3JvdXAgb2JqZWN0IGJlbG9uZ3MgdG8uCgogICAgLlBBUkFNRVRFUiBHcm91cE5hbWUKCiAgICAgICAgVGhlIGdyb3VwIG5hbWUgdG8gcXVlcnkgZm9yLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBTSUQKCiAgICAgICAgVGhlIGdyb3VwIFNJRCB0byBxdWVyeSBmb3IuCgogICAgLlBBUkFNRVRFUiBVc2VyTmFtZQoKICAgICAgICBUaGUgdXNlciBuYW1lIChvciBncm91cCBuYW1lKSB0byBxdWVyeSBmb3IgYWxsIGVmZmVjdGl2ZQogICAgICAgIGdyb3VwcyBvZi4KCiAgICAuUEFSQU1FVEVSIEZpbHRlcgoKICAgICAgICBBIGN1c3RvbWl6ZWQgbGRhcCBmaWx0ZXIgc3RyaW5nIHRvIHVzZSwgZS5nLiAiKGRlc2NyaXB0aW9uPSphZG1pbiopIgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIGdyb3VwcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBBZG1pbkNvdW50CgogICAgICAgIFN3aXRjaC4gUmV0dXJuIGdyb3VwIHdpdGggYWRtaW5Db3VudD0xLgoKICAgIC5QQVJBTUVURVIgRnVsbERhdGEKCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gZnVsbCBncm91cCBvYmplY3RzIGluc3RlYWQgb2YganVzdCBvYmplY3QgbmFtZXMgKHRoZSBkZWZhdWx0KS4KCiAgICAuUEFSQU1FVEVSIFJhd1NpZHMKCiAgICAgICAgU3dpdGNoLiBSZXR1cm4gcmF3IFNJRHMgd2hlbiB1c2luZyAiR2V0LU5ldEdyb3VwIC1Vc2VyTmFtZSBYIgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0R3JvdXAKCiAgICAgICAgUmV0dXJucyB0aGUgY3VycmVudCBncm91cHMgaW4gdGhlIGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRHcm91cCAtR3JvdXBOYW1lICphZG1pbioKCiAgICAgICAgUmV0dXJucyBhbGwgZ3JvdXBzIHdpdGggImFkbWluIiBpbiB0aGVpciBncm91cCBuYW1lLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldEdyb3VwIC1Eb21haW4gdGVzdGluZyAtRnVsbERhdGEKCiAgICAgICAgUmV0dXJucyBmdWxsIGdyb3VwIGRhdGEgb2JqZWN0cyBpbiB0aGUgJ3Rlc3RpbmcnIGRvbWFpbgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRHcm91cE5hbWUgPSAnKicsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNJRCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlck5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRBZG1pbkNvdW50LAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRGdWxsRGF0YSwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkUmF3U2lkcywKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgYmVnaW4gewogICAgICAgICRHcm91cFNlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcGF0aCAkQURTcGF0aCAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICB9CgogICAgcHJvY2VzcyB7CiAgICAgICAgaWYoJEdyb3VwU2VhcmNoZXIpIHsKCiAgICAgICAgICAgIGlmKCRBZG1pbkNvdW50KSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDaGVja2luZyBmb3IgYWRtaW5Db3VudD0xIgogICAgICAgICAgICAgICAgJEZpbHRlciArPSAiKGFkbWluY291bnQ9MSkiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgkVXNlck5hbWUpIHsKICAgICAgICAgICAgICAgICMgZ2V0IHRoZSByYXcgdXNlciBvYmplY3QKICAgICAgICAgICAgICAgICRVc2VyID0gR2V0LUFET2JqZWN0IC1TYW1BY2NvdW50TmFtZSAkVXNlck5hbWUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1SZXR1cm5SYXcgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEKCiAgICAgICAgICAgICAgICBpZigkVXNlcikgewogICAgICAgICAgICAgICAgICAgICMgY29udmVydCB0aGUgdXNlciB0byBhIGRpcmVjdG9yeSBlbnRyeQogICAgICAgICAgICAgICAgICAgICRVc2VyRGlyZWN0b3J5RW50cnkgPSAkVXNlci5HZXREaXJlY3RvcnlFbnRyeSgpCgogICAgICAgICAgICAgICAgICAgICMgY2F1c2UgdGhlIGNhY2hlIHRvIGNhbGN1bGF0ZSB0aGUgdG9rZW4gZ3JvdXBzIGZvciB0aGUgdXNlcgogICAgICAgICAgICAgICAgICAgICRVc2VyRGlyZWN0b3J5RW50cnkuUmVmcmVzaENhY2hlKCJ0b2tlbkdyb3VwcyIpCgogICAgICAgICAgICAgICAgICAgICRVc2VyRGlyZWN0b3J5RW50cnkuVG9rZW5Hcm91cHMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgY29udmVydCB0aGUgdG9rZW4gZ3JvdXAgc2lkCiAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cFNpZCA9IChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyKCRfLDApKS5WYWx1ZQoKICAgICAgICAgICAgICAgICAgICAgICAgIyBpZ25vcmUgdGhlIGJ1aWx0IGluIGdyb3VwcwogICAgICAgICAgICAgICAgICAgICAgICBpZigkR3JvdXBTaWQgLW5vdG1hdGNoICdeUy0xLTUtMzItLionKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkRnVsbERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAgPSBHZXQtQURPYmplY3QgLVNJRCAkR3JvdXBTaWQgLVBhZ2VTaXplICRQYWdlU2l6ZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3Lkdyb3VwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRSYXdTaWRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cFNpZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29udmVydC1TaWRUb05hbWUgLVNJRCAkR3JvdXBTaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJVc2VyTmFtZSAnJFVzZXJOYW1lJyBmYWlsZWQgdG8gcmVzb2x2ZS4iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoJFNJRCkgewogICAgICAgICAgICAgICAgICAgICRHcm91cFNlYXJjaGVyLmZpbHRlciA9ICIoJihvYmplY3RDYXRlZ29yeT1ncm91cCkob2JqZWN0U0lEPSRTSUQpJEZpbHRlcikiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkR3JvdXBTZWFyY2hlci5maWx0ZXIgPSAiKCYob2JqZWN0Q2F0ZWdvcnk9Z3JvdXApKG5hbWU9JEdyb3VwTmFtZSkkRmlsdGVyKSIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkUmVzdWx0cyA9ICRHcm91cFNlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIHJldHVybmluZyBmdWxsIGRhdGEgb2JqZWN0cwogICAgICAgICAgICAgICAgICAgIGlmICgkRnVsbERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0L3Byb2Nlc3MgdGhlIExEQVAgZmllbGRzIGZvciBlYWNoIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAgPSBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkXy5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cC5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuR3JvdXAnKQogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgb3RoZXJ3aXNlIHdlJ3JlIGp1c3QgcmV0dXJuaW5nIHRoZSBncm91cCBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRfLnByb3BlcnRpZXMuc2FtYWNjb3VudG5hbWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICRHcm91cFNlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LU5ldEdyb3VwTWVtYmVyIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHVzZXJzIFtBRFNJXSBhbmQgTERBUCB0byBxdWVyeSB0aGUgY3VycmVudCBBRCBjb250ZXh0CiAgICAgICAgb3IgdHJ1c3RlZCBkb21haW4gZm9yIHVzZXJzIGluIGEgc3BlY2lmaWVkIGdyb3VwLiBJZiBubyBHcm91cE5hbWUgaXMKICAgICAgICBzcGVjaWZpZWQsIGl0IGRlZmF1bHRzIHRvIHF1ZXJ5aW5nIHRoZSAiRG9tYWluIEFkbWlucyIgZ3JvdXAuCiAgICAgICAgVGhpcyBpcyBhIHJlcGxhY2VtZW50IGZvciAibmV0IGdyb3VwICduYW1lJyAvZG9tYWluIgoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIFRoZSBncm91cCBuYW1lIHRvIHF1ZXJ5IGZvciB1c2Vycy4KCiAgICAuUEFSQU1FVEVSIFNJRAoKICAgICAgICBUaGUgR3JvdXAgU0lEIHRvIHF1ZXJ5IGZvciB1c2Vycy4gSWYgbm90IGdpdmVuLCBpdCBkZWZhdWx0cyB0byA1MTIgIkRvbWFpbiBBZG1pbnMiCgogICAgLlBBUkFNRVRFUiBGaWx0ZXIKCiAgICAgICAgQSBjdXN0b21pemVkIGxkYXAgZmlsdGVyIHN0cmluZyB0byB1c2UsIGUuZy4gIihkZXNjcmlwdGlvbj0qYWRtaW4qKSIKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciBncm91cCB1c2VycywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBGdWxsRGF0YQoKICAgICAgICBTd2l0Y2guIFJldHVybnMgZnVsbCBkYXRhIG9iamVjdHMgaW5zdGVhZCBvZiBqdXN0IGdyb3VwL3VzZXJzLgoKICAgIC5QQVJBTUVURVIgUmVjdXJzZQoKICAgICAgICBTd2l0Y2guIElmIHRoZSBncm91cCBtZW1iZXIgaXMgYSBncm91cCwgcmVjdXJzaXZlbHkgdHJ5IHRvIHF1ZXJ5IGl0cyBtZW1iZXJzIGFzIHdlbGwuCgogICAgLlBBUkFNRVRFUiBVc2VNYXRjaGluZ1J1bGUKCiAgICAgICAgU3dpdGNoLiBVc2UgTERBUF9NQVRDSElOR19SVUxFX0lOX0NIQUlOIGluIHRoZSBMREFQIHNlYXJjaCBxdWVyeSB3aGVuIC1SZWN1cnNlIGlzIHNwZWNpZmllZC4KICAgICAgICBNdWNoIGZhc3RlciB0aGFuIG1hbnVhbCByZWN1cnNpb24sIGJ1dCBkb2Vzbid0IHJldmVhbCBjcm9zcy1kb21haW4gZ3JvdXBzLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0R3JvdXBNZW1iZXIKCiAgICAgICAgUmV0dXJucyB0aGUgdXNlcm5hbWVzIHRoYXQgb2YgbWVtYmVycyBvZiB0aGUgIkRvbWFpbiBBZG1pbnMiIGRvbWFpbiBncm91cC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRHcm91cE1lbWJlciAtRG9tYWluIHRlc3RpbmcgLUdyb3VwTmFtZSAiUG93ZXIgVXNlcnMiCgogICAgICAgIFJldHVybnMgdGhlIHVzZXJuYW1lcyB0aGF0IG9mIG1lbWJlcnMgb2YgdGhlICJQb3dlciBVc2VycyIgZ3JvdXAgaW4gdGhlICd0ZXN0aW5nJyBkb21haW4uCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL3d3dy5wb3dlcnNoZWxsbWFnYXppbmUuY29tLzIwMTMvMDUvMjMvcHN0aXAtcmV0cmlldmUtZ3JvdXAtbWVtYmVyc2hpcC1vZi1hbi1hY3RpdmUtZGlyZWN0b3J5LWdyb3VwLXJlY3Vyc2l2ZWx5LwojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRHcm91cE5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNJRCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRGdWxsRGF0YSwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkUmVjdXJzZSwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVXNlTWF0Y2hpbmdSdWxlLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0KICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgaWYoJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgJFRhcmdldERvbWFpbkNvbnRyb2xsZXIgPSAkRG9tYWluQ29udHJvbGxlcgogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFRhcmdldERvbWFpbkNvbnRyb2xsZXIgPSAoKEdldC1OZXREb21haW4gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwpLlBkY1JvbGVPd25lcikuTmFtZQogICAgICAgIH0KCiAgICAgICAgaWYoJERvbWFpbikgewogICAgICAgICAgICAkVGFyZ2V0RG9tYWluID0gJERvbWFpbgogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFRhcmdldERvbWFpbiA9IEdldC1OZXREb21haW4gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBuYW1lCiAgICAgICAgfQoKICAgICAgICAjIHNvIHRoaXMgaXNuJ3QgcmVwZWF0ZWQgaWYgdXNlcnMgYXJlIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICAgICAkR3JvdXBTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICRUYXJnZXREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJFRhcmdldERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJEFEU3BhdGggLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgfQoKICAgIHByb2Nlc3MgewogICAgICAgIGlmICgkR3JvdXBTZWFyY2hlcikgewogICAgICAgICAgICBpZiAoJFJlY3Vyc2UgLWFuZCAkVXNlTWF0Y2hpbmdSdWxlKSB7CiAgICAgICAgICAgICAgICAjIHJlc29sdmUgdGhlIGdyb3VwIHRvIGEgZGlzdGluZ3Vpc2hlZG5hbWUKICAgICAgICAgICAgICAgIGlmICgkR3JvdXBOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgJEdyb3VwID0gR2V0LU5ldEdyb3VwIC1Hcm91cE5hbWUgJEdyb3VwTmFtZSAtRG9tYWluICRUYXJnZXREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJFRhcmdldERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2VpZiAoJFNJRCkgewogICAgICAgICAgICAgICAgICAgICRHcm91cCA9IEdldC1OZXRHcm91cCAtU0lEICRTSUQgLURvbWFpbiAkVGFyZ2V0RG9tYWluIC1Eb21haW5Db250cm9sbGVyICRUYXJnZXREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1GdWxsRGF0YSAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAjIGRlZmF1bHQgdG8gZG9tYWluIGFkbWlucwogICAgICAgICAgICAgICAgICAgICRTSUQgPSAoR2V0LURvbWFpblNJRCAtRG9tYWluICRUYXJnZXREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJFRhcmdldERvbWFpbkNvbnRyb2xsZXIpICsgIi01MTIiCiAgICAgICAgICAgICAgICAgICAgJEdyb3VwID0gR2V0LU5ldEdyb3VwIC1TSUQgJFNJRCAtRG9tYWluICRUYXJnZXREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJFRhcmdldERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRHcm91cEROID0gJEdyb3VwLmRpc3Rpbmd1aXNoZWRuYW1lCiAgICAgICAgICAgICAgICAkR3JvdXBGb3VuZE5hbWUgPSAkR3JvdXAubmFtZQoKICAgICAgICAgICAgICAgIGlmICgkR3JvdXBETikgewogICAgICAgICAgICAgICAgICAgICRHcm91cFNlYXJjaGVyLmZpbHRlciA9ICIoJihzYW1BY2NvdW50VHlwZT04MDUzMDYzNjgpKG1lbWJlcm9mOjEuMi44NDAuMTEzNTU2LjEuNC4xOTQxOj0kR3JvdXBETikkRmlsdGVyKSIKICAgICAgICAgICAgICAgICAgICAkR3JvdXBTZWFyY2hlci5Qcm9wZXJ0aWVzVG9Mb2FkLkFkZFJhbmdlKCgnZGlzdGluZ3Vpc2hlZE5hbWUnLCdzYW1hY2NvdW50dHlwZScsJ2xhc3Rsb2dvbicsJ2xhc3Rsb2dvbnRpbWVzdGFtcCcsJ2RzY29yZXByb3BhZ2F0aW9uZGF0YScsJ29iamVjdHNpZCcsJ3doZW5jcmVhdGVkJywnYmFkcGFzc3dvcmR0aW1lJywnYWNjb3VudGV4cGlyZXMnLCdpc2NyaXRpY2Fsc3lzdGVtb2JqZWN0JywnbmFtZScsJ3VzbmNoYW5nZWQnLCdvYmplY3RjYXRlZ29yeScsJ2Rlc2NyaXB0aW9uJywnY29kZXBhZ2UnLCdpbnN0YW5jZXR5cGUnLCdjb3VudHJ5Y29kZScsJ2Rpc3Rpbmd1aXNoZWRuYW1lJywnY24nLCdhZG1pbmNvdW50JywnbG9nb25ob3VycycsJ29iamVjdGNsYXNzJywnbG9nb25jb3VudCcsJ3VzbmNyZWF0ZWQnLCd1c2VyYWNjb3VudGNvbnRyb2wnLCdvYmplY3RndWlkJywncHJpbWFyeWdyb3VwaWQnLCdsYXN0bG9nb2ZmJywnc2FtYWNjb3VudG5hbWUnLCdiYWRwd2Rjb3VudCcsJ3doZW5jaGFuZ2VkJywnbWVtYmVyb2YnLCdwd2RsYXN0c2V0JywnYWRzcGF0aCcpKQoKICAgICAgICAgICAgICAgICAgICAkTWVtYmVycyA9ICRHcm91cFNlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgICAgICRHcm91cEZvdW5kTmFtZSA9ICRHcm91cE5hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLUVycm9yICJVbmFibGUgdG8gZmluZCBHcm91cCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICgkR3JvdXBOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgJEdyb3VwU2VhcmNoZXIuZmlsdGVyID0gIigmKG9iamVjdENhdGVnb3J5PWdyb3VwKShuYW1lPSRHcm91cE5hbWUpJEZpbHRlcikiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYgKCRTSUQpIHsKICAgICAgICAgICAgICAgICAgICAkR3JvdXBTZWFyY2hlci5maWx0ZXIgPSAiKCYob2JqZWN0Q2F0ZWdvcnk9Z3JvdXApKG9iamVjdFNJRD0kU0lEKSRGaWx0ZXIpIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgIyBkZWZhdWx0IHRvIGRvbWFpbiBhZG1pbnMKICAgICAgICAgICAgICAgICAgICAkU0lEID0gKEdldC1Eb21haW5TSUQgLURvbWFpbiAkVGFyZ2V0RG9tYWluIC1Eb21haW5Db250cm9sbGVyICRUYXJnZXREb21haW5Db250cm9sbGVyKSArICItNTEyIgogICAgICAgICAgICAgICAgICAgICRHcm91cFNlYXJjaGVyLmZpbHRlciA9ICIoJihvYmplY3RDYXRlZ29yeT1ncm91cCkob2JqZWN0U0lEPSRTSUQpJEZpbHRlcikiCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJE1lbWJlcnMgPSBAKCkKICAgICAgICAgICAgICAgICRHcm91cFNlYXJjaGVyLlByb3BlcnRpZXNUb0xvYWQuQ2xlYXIoKQogICAgICAgICAgICAgICAgJFJlc3VsdCA9ICRGYWxzZQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0ID0gJEdyb3VwU2VhcmNoZXIuRmluZE9uZSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgcmV0cmlldmluZyBncm91cCBzZWFyY2hlciByZXN1bHRzOiAkXyIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkR3JvdXBGb3VuZE5hbWUgPSAnJwoKICAgICAgICAgICAgICAgIGlmICgkUmVzdWx0IC1hbmQgJFJlc3VsdC5wcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlcnMgPSAkUmVzdWx0LnByb3BlcnRpZXMuaXRlbSgibWVtYmVyIikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciByZXRyaWV2aW5nIG1lbWJlcnMgcHJvcGVydHkuIgogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYoJE1lbWJlcnMuY291bnQgLWVxIDApIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICRGaW5pc2hlZCA9ICRGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAkQm90dG9tID0gMAogICAgICAgICAgICAgICAgICAgICAgICAkVG9wID0gMAoKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUoISRGaW5pc2hlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRvcCA9ICRCb3R0b20gKyAxNDk5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyUmFuZ2U9Im1lbWJlcjtyYW5nZT0kQm90dG9tLSRUb3AiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQm90dG9tICs9IDE1MDAKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBTZWFyY2hlci5Qcm9wZXJ0aWVzVG9Mb2FkLkNsZWFyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFt2b2lkXSRHcm91cFNlYXJjaGVyLlByb3BlcnRpZXNUb0xvYWQuQWRkKCIkTWVtYmVyUmFuZ2UiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgW3ZvaWRdJEdyb3VwU2VhcmNoZXIuUHJvcGVydGllc1RvTG9hZC5BZGQoIm5hbWUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0ID0gJEdyb3VwU2VhcmNoZXIuRmluZE9uZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFJhbmdlZFByb3BlcnR5ID0gJFJlc3VsdC5Qcm9wZXJ0aWVzLlByb3BlcnR5TmFtZXMgLWxpa2UgIm1lbWJlcjtyYW5nZT0qIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJzICs9ICRSZXN1bHQuUHJvcGVydGllcy5pdGVtKCRSYW5nZWRQcm9wZXJ0eSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBGb3VuZE5hbWUgPSAkUmVzdWx0LnByb3BlcnRpZXMuaXRlbSgibmFtZSIpWzBdCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkTWVtYmVycy5jb3VudCAtZXEgMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRmluaXNoZWQgPSAkVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIFtTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLk1ldGhvZEludm9jYXRpb25FeGNlcHRpb25dIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRmluaXNoZWQgPSAkVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBGb3VuZE5hbWUgPSAkUmVzdWx0LnByb3BlcnRpZXMuaXRlbSgibmFtZSIpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJzICs9ICRSZXN1bHQuUHJvcGVydGllcy5pdGVtKCRSYW5nZWRQcm9wZXJ0eSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkR3JvdXBTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE1lbWJlcnMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICMgaWYgd2UncmUgZG9pbmcgdGhlIExEQVBfTUFUQ0hJTkdfUlVMRV9JTl9DSEFJTiByZWN1cnNpb24KICAgICAgICAgICAgICAgIGlmICgkUmVjdXJzZSAtYW5kICRVc2VNYXRjaGluZ1J1bGUpIHsKICAgICAgICAgICAgICAgICAgICAkUHJvcGVydGllcyA9ICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmKCRUYXJnZXREb21haW5Db250cm9sbGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRSZXN1bHQgPSBbYWRzaV0iTERBUDovLyRUYXJnZXREb21haW5Db250cm9sbGVyLyRfIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFJlc3VsdCA9IFthZHNpXSJMREFQOi8vJF8iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKCRSZXN1bHQpewogICAgICAgICAgICAgICAgICAgICAgICAkUHJvcGVydGllcyA9ICRSZXN1bHQuUHJvcGVydGllcwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigkUHJvcGVydGllcykgewoKICAgICAgICAgICAgICAgICAgICAkSXNHcm91cCA9IEAoJzI2ODQzNTQ1NicsJzI2ODQzNTQ1NycsJzUzNjg3MDkxMicsJzUzNjg3MDkxMycpIC1jb250YWlucyAkUHJvcGVydGllcy5zYW1hY2NvdW50dHlwZQoKICAgICAgICAgICAgICAgICAgICBpZiAoJEZ1bGxEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlciA9IENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRQcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXIgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXBEb21haW4nICRUYXJnZXREb21haW4KICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXBOYW1lJyAkR3JvdXBGb3VuZE5hbWUKCiAgICAgICAgICAgICAgICAgICAgaWYoJFByb3BlcnRpZXMub2JqZWN0U2lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJTSUQgPSAoKE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXIgJFByb3BlcnRpZXMub2JqZWN0U2lkWzBdLDApLlZhbHVlKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlclNJRCA9ICROdWxsCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRE4gPSAkUHJvcGVydGllcy5kaXN0aW5ndWlzaGVkbmFtZVswXQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCgkTWVtYmVyRE4gLW1hdGNoICdGb3JlaWduU2VjdXJpdHlQcmluY2lwYWxzJykgLWFuZCAoJE1lbWJlckROIC1tYXRjaCAnUy0xLTUtMjEnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigtbm90ICRNZW1iZXJTSUQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlclNJRCA9ICRQcm9wZXJ0aWVzLmNuWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJTaW1wbGVOYW1lID0gQ29udmVydC1TaWRUb05hbWUgLVNJRCAkTWVtYmVyU0lEIHwgQ29udmVydC1BRE5hbWUgLUlucHV0VHlwZSAnTlQ0JyAtT3V0cHV0VHlwZSAnQ2Fub25pY2FsJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRNZW1iZXJTaW1wbGVOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJEb21haW4gPSAkTWVtYmVyU2ltcGxlTmFtZS5TcGxpdCgnLycpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBjb252ZXJ0aW5nICRNZW1iZXJETiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlckRvbWFpbiA9ICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkVycm9yIGNvbnZlcnRpbmcgJE1lbWJlckROIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJEb21haW4gPSAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBleHRyYWN0IHRoZSBGUUROIGZyb20gdGhlIERpc3Rpbmd1aXNoZWQgTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlckRvbWFpbiA9ICRNZW1iZXJETi5zdWJTdHJpbmcoJE1lbWJlckROLkluZGV4T2YoIkRDPSIpKSAtcmVwbGFjZSAnREM9JywnJyAtcmVwbGFjZSAnLCcsJy4nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRE4gPSAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRG9tYWluID0gJE51bGwKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICgkUHJvcGVydGllcy5zYW1hY2NvdW50bmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAjIGZvcmVzdCB1c2VycyBoYXZlIHRoZSBzYW1BY2NvdW50TmFtZSBzZXQKICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlck5hbWUgPSAkUHJvcGVydGllcy5zYW1hY2NvdW50bmFtZVswXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBleHRlcm5hbCB0cnVzdCB1c2VycyBoYXZlIGEgU0lELCBzbyBjb252ZXJ0IGl0CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyTmFtZSA9IENvbnZlcnQtU2lkVG9OYW1lICRQcm9wZXJ0aWVzLmNuWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBpZiB0aGVyZSdzIGEgcHJvYmxlbSBjb250YWN0aW5nIHRoZSBkb21haW4gdG8gcmVzb2x2ZSB0aGUgU0lECiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyTmFtZSA9ICRQcm9wZXJ0aWVzLmNuCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJEb21haW4nICRNZW1iZXJEb21haW4KICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyTmFtZScgJE1lbWJlck5hbWUKICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyU0lEJyAkTWVtYmVyU0lECiAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzR3JvdXAnICRJc0dyb3VwCiAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlckROJyAkTWVtYmVyRE4KICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnT2JqZWN0Q2xhc3MnICRQcm9wZXJ0aWVzLm9iamVjdGNsYXNzIC1Gb3JjZQogICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdETlNIb3N0TmFtZScgJFByb3BlcnRpZXMuZG5zaG9zdG5hbWUgLUZvcmNlCiAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVyLlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5Hcm91cE1lbWJlcicpCiAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVyCgogICAgICAgICAgICAgICAgICAgICMgaWYgd2UncmUgZG9pbmcgbWFudWFsIHJlY3Vyc2lvbgogICAgICAgICAgICAgICAgICAgIGlmICgkUmVjdXJzZSAtYW5kICEkVXNlTWF0Y2hpbmdSdWxlIC1hbmQgJElzR3JvdXAgLWFuZCAkTWVtYmVyTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZigkRnVsbERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdldC1OZXRHcm91cE1lbWJlciAtRnVsbERhdGEgLURvbWFpbiAkTWVtYmVyRG9tYWluIC1Eb21haW5Db250cm9sbGVyICRUYXJnZXREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1Hcm91cE5hbWUgJE1lbWJlck5hbWUgLVJlY3Vyc2UgLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgR2V0LU5ldEdyb3VwTWVtYmVyIC1Eb21haW4gJE1lbWJlckRvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkVGFyZ2V0RG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtR3JvdXBOYW1lICRNZW1iZXJOYW1lIC1SZWN1cnNlIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1OZXRGaWxlU2VydmVyIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXR1cm5zIGEgbGlzdCBvZiBhbGwgZmlsZSBzZXJ2ZXJzIGV4dHJhY3RlZCBmcm9tIHVzZXIKICAgICAgICBob21lZGlyZWN0b3J5LCBzY3JpcHRwYXRoLCBhbmQgcHJvZmlsZXBhdGggZmllbGRzLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHVzZXIgZmlsZSBzZXJ2ZXJzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBUYXJnZXRVc2VycwoKICAgICAgICBBbiBhcnJheSBvZiB1c2VycyB0byBxdWVyeSBmb3IgZmlsZSBzZXJ2ZXJzLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0RmlsZVNlcnZlcgoKICAgICAgICBSZXR1cm5zIGFjdGl2ZSBmaWxlIHNlcnZlcnMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0RmlsZVNlcnZlciAtRG9tYWluIHRlc3RpbmcKCiAgICAgICAgUmV0dXJucyBhY3RpdmUgZmlsZSBzZXJ2ZXJzIGZvciB0aGUgJ3Rlc3RpbmcnIGRvbWFpbi4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJFRhcmdldFVzZXJzLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0KICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBmdW5jdGlvbiBTcGxpdFBhdGggewogICAgICAgICMgc2hvcnQgaW50ZXJuYWwgaGVscGVyIHRvIHNwbGl0IFVOQyBzZXJ2ZXIgcGF0aHMKICAgICAgICBwYXJhbShbU3RyaW5nXSRQYXRoKQoKICAgICAgICBpZiAoJFBhdGggLWFuZCAoJFBhdGguc3BsaXQoIlxcIikuQ291bnQgLWdlIDMpKSB7CiAgICAgICAgICAgICRUZW1wID0gJFBhdGguc3BsaXQoIlxcIilbMl0KICAgICAgICAgICAgaWYoJFRlbXAgLWFuZCAoJFRlbXAgLW5lICcnKSkgewogICAgICAgICAgICAgICAgJFRlbXAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBHZXQtTmV0VXNlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IFdoZXJlLU9iamVjdCB7JF99IHwgV2hlcmUtT2JqZWN0IHsKICAgICAgICAgICAgIyBmaWx0ZXIgZm9yIGFueSB0YXJnZXQgdXNlcnMKICAgICAgICAgICAgaWYoJFRhcmdldFVzZXJzKSB7CiAgICAgICAgICAgICAgICAkVGFyZ2V0VXNlcnMgLU1hdGNoICRfLnNhbUFjY291bnROYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7ICRUcnVlIH0KICAgICAgICB9IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAjIHNwbGl0IG91dCBldmVyeSBwb3RlbnRpYWwgZmlsZSBzZXJ2ZXIgcGF0aAogICAgICAgICAgICBpZigkXy5ob21lZGlyZWN0b3J5KSB7CiAgICAgICAgICAgICAgICBTcGxpdFBhdGgoJF8uaG9tZWRpcmVjdG9yeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkXy5zY3JpcHRwYXRoKSB7CiAgICAgICAgICAgICAgICBTcGxpdFBhdGgoJF8uc2NyaXB0cGF0aCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkXy5wcm9maWxlcGF0aCkgewogICAgICAgICAgICAgICAgU3BsaXRQYXRoKCRfLnByb2ZpbGVwYXRoKQogICAgICAgICAgICB9CgogICAgICAgIH0gfCBXaGVyZS1PYmplY3QgeyRffSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUKfQoKCmZ1bmN0aW9uIEdldC1ERlNzaGFyZSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUmV0dXJucyBhIGxpc3Qgb2YgYWxsIGZhdWx0LXRvbGVyYW50IGRpc3RyaWJ1dGVkIGZpbGUKICAgICAgICBzeXN0ZW1zIGZvciBhIGdpdmVuIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIFZlcnNpb24KCiAgICAgICAgVGhlIHZlcnNpb24gb2YgREZTIHRvIHF1ZXJ5IGZvciBzZXJ2ZXJzLgogICAgICAgIDEvdjEsIDIvdjIsIG9yIGFsbAoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIHVzZXIgREZTIHNoYXJlcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1ERlNzaGFyZQoKICAgICAgICBSZXR1cm5zIGFsbCBkaXN0cmlidXRlZCBmaWxlIHN5c3RlbSBzaGFyZXMgZm9yIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1ERlNzaGFyZSAtRG9tYWluIHRlc3QKCiAgICAgICAgUmV0dXJucyBhbGwgZGlzdHJpYnV0ZWQgZmlsZSBzeXN0ZW0gc2hhcmVzIGZvciB0aGUgJ3Rlc3QnIGRvbWFpbi4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVTZXQoIkFsbCIsIlYxIiwiMSIsIlYyIiwiMiIpXQogICAgICAgICRWZXJzaW9uID0gIkFsbCIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgZnVuY3Rpb24gUGFyc2UtUGt0IHsKICAgICAgICBbQ21kbGV0QmluZGluZygpXQogICAgICAgIHBhcmFtKAogICAgICAgICAgICBbYnl0ZVtdXQogICAgICAgICAgICAkUGt0CiAgICAgICAgKQoKICAgICAgICAkYmluID0gJFBrdAogICAgICAgICRibG9iX3ZlcnNpb24gPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGJpblswLi4zXSwwKQogICAgICAgICRibG9iX2VsZW1lbnRfY291bnQgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGJpbls0Li43XSwwKQogICAgICAgICRvZmZzZXQgPSA4CiAgICAgICAgI2h0dHBzOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvY2MyMjcxNDcuYXNweAogICAgICAgICRvYmplY3RfbGlzdCA9IEAoKQogICAgICAgIGZvcigkaT0xOyAkaSAtbGUgJGJsb2JfZWxlbWVudF9jb3VudDsgJGkrKyl7CiAgICAgICAgICAgICAgICRibG9iX25hbWVfc2l6ZV9zdGFydCA9ICRvZmZzZXQKICAgICAgICAgICAgICAgJGJsb2JfbmFtZV9zaXplX2VuZCA9ICRvZmZzZXQgKyAxCiAgICAgICAgICAgICAgICRibG9iX25hbWVfc2l6ZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQxNigkYmluWyRibG9iX25hbWVfc2l6ZV9zdGFydC4uJGJsb2JfbmFtZV9zaXplX2VuZF0sMCkKCiAgICAgICAgICAgICAgICRibG9iX25hbWVfc3RhcnQgPSAkYmxvYl9uYW1lX3NpemVfZW5kICsgMQogICAgICAgICAgICAgICAkYmxvYl9uYW1lX2VuZCA9ICRibG9iX25hbWVfc3RhcnQgKyAkYmxvYl9uYW1lX3NpemUgLSAxCiAgICAgICAgICAgICAgICRibG9iX25hbWUgPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVbmljb2RlLkdldFN0cmluZygkYmluWyRibG9iX25hbWVfc3RhcnQuLiRibG9iX25hbWVfZW5kXSkKCiAgICAgICAgICAgICAgICRibG9iX2RhdGFfc2l6ZV9zdGFydCA9ICRibG9iX25hbWVfZW5kICsgMQogICAgICAgICAgICAgICAkYmxvYl9kYXRhX3NpemVfZW5kID0gJGJsb2JfZGF0YV9zaXplX3N0YXJ0ICsgMwogICAgICAgICAgICAgICAkYmxvYl9kYXRhX3NpemUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGJpblskYmxvYl9kYXRhX3NpemVfc3RhcnQuLiRibG9iX2RhdGFfc2l6ZV9lbmRdLDApCgogICAgICAgICAgICAgICAkYmxvYl9kYXRhX3N0YXJ0ID0gJGJsb2JfZGF0YV9zaXplX2VuZCArIDEKICAgICAgICAgICAgICAgJGJsb2JfZGF0YV9lbmQgPSAkYmxvYl9kYXRhX3N0YXJ0ICsgJGJsb2JfZGF0YV9zaXplIC0gMQogICAgICAgICAgICAgICAkYmxvYl9kYXRhID0gJGJpblskYmxvYl9kYXRhX3N0YXJ0Li4kYmxvYl9kYXRhX2VuZF0KICAgICAgICAgICAgICAgc3dpdGNoIC13aWxkY2FyZCAoJGJsb2JfbmFtZSkgewogICAgICAgICAgICAgICAgIlxzaXRlcm9vdCIgeyAgfQogICAgICAgICAgICAgICAgIlxkb21haW5yb290KiIgewogICAgICAgICAgICAgICAgICAgICMgUGFyc2UgREZTTmFtZXNwYWNlUm9vdE9yTGlua0Jsb2Igb2JqZWN0LiBTdGFydHMgd2l0aCB2YXJpYWJsZSBsZW5ndGggREZTUm9vdE9yTGlua0lEQmxvYiB3aGljaCB3ZSBwYXJzZSBmaXJzdC4uLgogICAgICAgICAgICAgICAgICAgICMgREZTUm9vdE9yTGlua0lEQmxvYgogICAgICAgICAgICAgICAgICAgICRyb290X29yX2xpbmtfZ3VpZF9zdGFydCA9IDAKICAgICAgICAgICAgICAgICAgICAkcm9vdF9vcl9saW5rX2d1aWRfZW5kID0gMTUKICAgICAgICAgICAgICAgICAgICAkcm9vdF9vcl9saW5rX2d1aWQgPSBbYnl0ZVtdXSRibG9iX2RhdGFbJHJvb3Rfb3JfbGlua19ndWlkX3N0YXJ0Li4kcm9vdF9vcl9saW5rX2d1aWRfZW5kXQogICAgICAgICAgICAgICAgICAgICRndWlkID0gTmV3LU9iamVjdCBHdWlkKCwkcm9vdF9vcl9saW5rX2d1aWQpICMgc2hvdWxkIG1hdGNoICRndWlkX3N0cgogICAgICAgICAgICAgICAgICAgICRwcmVmaXhfc2l6ZV9zdGFydCA9ICRyb290X29yX2xpbmtfZ3VpZF9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHByZWZpeF9zaXplX2VuZCA9ICRwcmVmaXhfc2l6ZV9zdGFydCArIDEKICAgICAgICAgICAgICAgICAgICAkcHJlZml4X3NpemUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MTYoJGJsb2JfZGF0YVskcHJlZml4X3NpemVfc3RhcnQuLiRwcmVmaXhfc2l6ZV9lbmRdLDApCiAgICAgICAgICAgICAgICAgICAgJHByZWZpeF9zdGFydCA9ICRwcmVmaXhfc2l6ZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHByZWZpeF9lbmQgPSAkcHJlZml4X3N0YXJ0ICsgJHByZWZpeF9zaXplIC0gMQogICAgICAgICAgICAgICAgICAgICRwcmVmaXggPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVbmljb2RlLkdldFN0cmluZygkYmxvYl9kYXRhWyRwcmVmaXhfc3RhcnQuLiRwcmVmaXhfZW5kXSkKCiAgICAgICAgICAgICAgICAgICAgJHNob3J0X3ByZWZpeF9zaXplX3N0YXJ0ID0gJHByZWZpeF9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHNob3J0X3ByZWZpeF9zaXplX2VuZCA9ICRzaG9ydF9wcmVmaXhfc2l6ZV9zdGFydCArIDEKICAgICAgICAgICAgICAgICAgICAkc2hvcnRfcHJlZml4X3NpemUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MTYoJGJsb2JfZGF0YVskc2hvcnRfcHJlZml4X3NpemVfc3RhcnQuLiRzaG9ydF9wcmVmaXhfc2l6ZV9lbmRdLDApCiAgICAgICAgICAgICAgICAgICAgJHNob3J0X3ByZWZpeF9zdGFydCA9ICRzaG9ydF9wcmVmaXhfc2l6ZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHNob3J0X3ByZWZpeF9lbmQgPSAkc2hvcnRfcHJlZml4X3N0YXJ0ICsgJHNob3J0X3ByZWZpeF9zaXplIC0gMQogICAgICAgICAgICAgICAgICAgICRzaG9ydF9wcmVmaXggPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVbmljb2RlLkdldFN0cmluZygkYmxvYl9kYXRhWyRzaG9ydF9wcmVmaXhfc3RhcnQuLiRzaG9ydF9wcmVmaXhfZW5kXSkKCiAgICAgICAgICAgICAgICAgICAgJHR5cGVfc3RhcnQgPSAkc2hvcnRfcHJlZml4X2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAkdHlwZV9lbmQgPSAkdHlwZV9zdGFydCArIDMKICAgICAgICAgICAgICAgICAgICAkdHlwZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkYmxvYl9kYXRhWyR0eXBlX3N0YXJ0Li4kdHlwZV9lbmRdLDApCgogICAgICAgICAgICAgICAgICAgICRzdGF0ZV9zdGFydCA9ICR0eXBlX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAkc3RhdGVfZW5kID0gJHN0YXRlX3N0YXJ0ICsgMwogICAgICAgICAgICAgICAgICAgICRzdGF0ZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkYmxvYl9kYXRhWyRzdGF0ZV9zdGFydC4uJHN0YXRlX2VuZF0sMCkKCiAgICAgICAgICAgICAgICAgICAgJGNvbW1lbnRfc2l6ZV9zdGFydCA9ICRzdGF0ZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJGNvbW1lbnRfc2l6ZV9lbmQgPSAkY29tbWVudF9zaXplX3N0YXJ0ICsgMQogICAgICAgICAgICAgICAgICAgICRjb21tZW50X3NpemUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MTYoJGJsb2JfZGF0YVskY29tbWVudF9zaXplX3N0YXJ0Li4kY29tbWVudF9zaXplX2VuZF0sMCkKICAgICAgICAgICAgICAgICAgICAkY29tbWVudF9zdGFydCA9ICRjb21tZW50X3NpemVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRjb21tZW50X2VuZCA9ICRjb21tZW50X3N0YXJ0ICsgJGNvbW1lbnRfc2l6ZSAtIDEKICAgICAgICAgICAgICAgICAgICBpZiAoJGNvbW1lbnRfc2l6ZSAtZ3QgMCkgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGNvbW1lbnQgPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVbmljb2RlLkdldFN0cmluZygkYmxvYl9kYXRhWyRjb21tZW50X3N0YXJ0Li4kY29tbWVudF9lbmRdKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkcHJlZml4X3RpbWVzdGFtcF9zdGFydCA9ICRjb21tZW50X2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAkcHJlZml4X3RpbWVzdGFtcF9lbmQgPSAkcHJlZml4X3RpbWVzdGFtcF9zdGFydCArIDcKICAgICAgICAgICAgICAgICAgICAjIGh0dHBzOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvY2MyMzAzMjQuYXNweCBGSUxFVElNRQogICAgICAgICAgICAgICAgICAgICRwcmVmaXhfdGltZXN0YW1wID0gJGJsb2JfZGF0YVskcHJlZml4X3RpbWVzdGFtcF9zdGFydC4uJHByZWZpeF90aW1lc3RhbXBfZW5kXSAjZHdvcmQgbG93RGF0ZVRpbWUgI2R3b3JkIGhpZ2hkYXRldGltZQogICAgICAgICAgICAgICAgICAgICRzdGF0ZV90aW1lc3RhbXBfc3RhcnQgPSAkcHJlZml4X3RpbWVzdGFtcF9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHN0YXRlX3RpbWVzdGFtcF9lbmQgPSAkc3RhdGVfdGltZXN0YW1wX3N0YXJ0ICsgNwogICAgICAgICAgICAgICAgICAgICRzdGF0ZV90aW1lc3RhbXAgPSAkYmxvYl9kYXRhWyRzdGF0ZV90aW1lc3RhbXBfc3RhcnQuLiRzdGF0ZV90aW1lc3RhbXBfZW5kXQogICAgICAgICAgICAgICAgICAgICRjb21tZW50X3RpbWVzdGFtcF9zdGFydCA9ICRzdGF0ZV90aW1lc3RhbXBfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRjb21tZW50X3RpbWVzdGFtcF9lbmQgPSAkY29tbWVudF90aW1lc3RhbXBfc3RhcnQgKyA3CiAgICAgICAgICAgICAgICAgICAgJGNvbW1lbnRfdGltZXN0YW1wID0gJGJsb2JfZGF0YVskY29tbWVudF90aW1lc3RhbXBfc3RhcnQuLiRjb21tZW50X3RpbWVzdGFtcF9lbmRdCiAgICAgICAgICAgICAgICAgICAgJHZlcnNpb25fc3RhcnQgPSAkY29tbWVudF90aW1lc3RhbXBfZW5kICArIDEKICAgICAgICAgICAgICAgICAgICAkdmVyc2lvbl9lbmQgPSAkdmVyc2lvbl9zdGFydCArIDMKICAgICAgICAgICAgICAgICAgICAkdmVyc2lvbiA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkYmxvYl9kYXRhWyR2ZXJzaW9uX3N0YXJ0Li4kdmVyc2lvbl9lbmRdLDApCgogICAgICAgICAgICAgICAgICAgICMgUGFyc2UgcmVzdCBvZiBERlNOYW1lc3BhY2VSb290T3JMaW5rQmxvYiBoZXJlCiAgICAgICAgICAgICAgICAgICAgJGRmc190YXJnZXRsaXN0X2Jsb2Jfc2l6ZV9zdGFydCA9ICR2ZXJzaW9uX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAkZGZzX3RhcmdldGxpc3RfYmxvYl9zaXplX2VuZCA9ICRkZnNfdGFyZ2V0bGlzdF9ibG9iX3NpemVfc3RhcnQgKyAzCiAgICAgICAgICAgICAgICAgICAgJGRmc190YXJnZXRsaXN0X2Jsb2Jfc2l6ZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkYmxvYl9kYXRhWyRkZnNfdGFyZ2V0bGlzdF9ibG9iX3NpemVfc3RhcnQuLiRkZnNfdGFyZ2V0bGlzdF9ibG9iX3NpemVfZW5kXSwwKQoKICAgICAgICAgICAgICAgICAgICAkZGZzX3RhcmdldGxpc3RfYmxvYl9zdGFydCA9ICRkZnNfdGFyZ2V0bGlzdF9ibG9iX3NpemVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRkZnNfdGFyZ2V0bGlzdF9ibG9iX2VuZCA9ICRkZnNfdGFyZ2V0bGlzdF9ibG9iX3N0YXJ0ICsgJGRmc190YXJnZXRsaXN0X2Jsb2Jfc2l6ZSAtIDEKICAgICAgICAgICAgICAgICAgICAkZGZzX3RhcmdldGxpc3RfYmxvYiA9ICRibG9iX2RhdGFbJGRmc190YXJnZXRsaXN0X2Jsb2Jfc3RhcnQuLiRkZnNfdGFyZ2V0bGlzdF9ibG9iX2VuZF0KICAgICAgICAgICAgICAgICAgICAkcmVzZXJ2ZWRfYmxvYl9zaXplX3N0YXJ0ID0gJGRmc190YXJnZXRsaXN0X2Jsb2JfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICRyZXNlcnZlZF9ibG9iX3NpemVfZW5kID0gJHJlc2VydmVkX2Jsb2Jfc2l6ZV9zdGFydCArIDMKICAgICAgICAgICAgICAgICAgICAkcmVzZXJ2ZWRfYmxvYl9zaXplID0gW2JpdGNvbnZlcnRlcl06OlRvVUludDMyKCRibG9iX2RhdGFbJHJlc2VydmVkX2Jsb2Jfc2l6ZV9zdGFydC4uJHJlc2VydmVkX2Jsb2Jfc2l6ZV9lbmRdLDApCgogICAgICAgICAgICAgICAgICAgICRyZXNlcnZlZF9ibG9iX3N0YXJ0ID0gJHJlc2VydmVkX2Jsb2Jfc2l6ZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHJlc2VydmVkX2Jsb2JfZW5kID0gJHJlc2VydmVkX2Jsb2Jfc3RhcnQgKyAkcmVzZXJ2ZWRfYmxvYl9zaXplIC0gMQogICAgICAgICAgICAgICAgICAgICRyZXNlcnZlZF9ibG9iID0gJGJsb2JfZGF0YVskcmVzZXJ2ZWRfYmxvYl9zdGFydC4uJHJlc2VydmVkX2Jsb2JfZW5kXQogICAgICAgICAgICAgICAgICAgICRyZWZlcnJhbF90dGxfc3RhcnQgPSAkcmVzZXJ2ZWRfYmxvYl9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgJHJlZmVycmFsX3R0bF9lbmQgPSAkcmVmZXJyYWxfdHRsX3N0YXJ0ICsgMwogICAgICAgICAgICAgICAgICAgICRyZWZlcnJhbF90dGwgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGJsb2JfZGF0YVskcmVmZXJyYWxfdHRsX3N0YXJ0Li4kcmVmZXJyYWxfdHRsX2VuZF0sMCkKCiAgICAgICAgICAgICAgICAgICAgI1BhcnNlIERGU1RhcmdldExpc3RCbG9iCiAgICAgICAgICAgICAgICAgICAgJHRhcmdldF9jb3VudF9zdGFydCA9IDAKICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0X2NvdW50X2VuZCA9ICR0YXJnZXRfY291bnRfc3RhcnQgKyAzCiAgICAgICAgICAgICAgICAgICAgJHRhcmdldF9jb3VudCA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkZGZzX3RhcmdldGxpc3RfYmxvYlskdGFyZ2V0X2NvdW50X3N0YXJ0Li4kdGFyZ2V0X2NvdW50X2VuZF0sMCkKICAgICAgICAgICAgICAgICAgICAkdF9vZmZzZXQgPSAkdGFyZ2V0X2NvdW50X2VuZCArIDEKCiAgICAgICAgICAgICAgICAgICAgZm9yKCRqPTE7ICRqIC1sZSAkdGFyZ2V0X2NvdW50OyAkaisrKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHRhcmdldF9lbnRyeV9zaXplX3N0YXJ0ID0gJHRfb2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfZW50cnlfc2l6ZV9lbmQgPSAkdGFyZ2V0X2VudHJ5X3NpemVfc3RhcnQgKyAzCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfZW50cnlfc2l6ZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkZGZzX3RhcmdldGxpc3RfYmxvYlskdGFyZ2V0X2VudHJ5X3NpemVfc3RhcnQuLiR0YXJnZXRfZW50cnlfc2l6ZV9lbmRdLDApCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfdGltZV9zdGFtcF9zdGFydCA9ICR0YXJnZXRfZW50cnlfc2l6ZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfdGltZV9zdGFtcF9lbmQgPSAkdGFyZ2V0X3RpbWVfc3RhbXBfc3RhcnQgKyA3CiAgICAgICAgICAgICAgICAgICAgICAgICMgRklMRVRJTUUgYWdhaW4gb3Igc3BlY2lhbCBpZiBwcmlvcml0eSByYW5rIGFuZCBwcmlvcml0eSBjbGFzcyAwCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfdGltZV9zdGFtcCA9ICRkZnNfdGFyZ2V0bGlzdF9ibG9iWyR0YXJnZXRfdGltZV9zdGFtcF9zdGFydC4uJHRhcmdldF90aW1lX3N0YW1wX2VuZF0KICAgICAgICAgICAgICAgICAgICAgICAgJHRhcmdldF9zdGF0ZV9zdGFydCA9ICR0YXJnZXRfdGltZV9zdGFtcF9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfc3RhdGVfZW5kID0gJHRhcmdldF9zdGF0ZV9zdGFydCArIDMKICAgICAgICAgICAgICAgICAgICAgICAgJHRhcmdldF9zdGF0ZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQzMigkZGZzX3RhcmdldGxpc3RfYmxvYlskdGFyZ2V0X3N0YXRlX3N0YXJ0Li4kdGFyZ2V0X3N0YXRlX2VuZF0sMCkKCiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRfdHlwZV9zdGFydCA9ICR0YXJnZXRfc3RhdGVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0X3R5cGVfZW5kID0gJHRhcmdldF90eXBlX3N0YXJ0ICsgMwogICAgICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0X3R5cGUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MzIoJGRmc190YXJnZXRsaXN0X2Jsb2JbJHRhcmdldF90eXBlX3N0YXJ0Li4kdGFyZ2V0X3R5cGVfZW5kXSwwKQoKICAgICAgICAgICAgICAgICAgICAgICAgJHNlcnZlcl9uYW1lX3NpemVfc3RhcnQgPSAkdGFyZ2V0X3R5cGVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgICAgICAkc2VydmVyX25hbWVfc2l6ZV9lbmQgPSAkc2VydmVyX25hbWVfc2l6ZV9zdGFydCArIDEKICAgICAgICAgICAgICAgICAgICAgICAgJHNlcnZlcl9uYW1lX3NpemUgPSBbYml0Y29udmVydGVyXTo6VG9VSW50MTYoJGRmc190YXJnZXRsaXN0X2Jsb2JbJHNlcnZlcl9uYW1lX3NpemVfc3RhcnQuLiRzZXJ2ZXJfbmFtZV9zaXplX2VuZF0sMCkKCiAgICAgICAgICAgICAgICAgICAgICAgICRzZXJ2ZXJfbmFtZV9zdGFydCA9ICRzZXJ2ZXJfbmFtZV9zaXplX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAgICAgJHNlcnZlcl9uYW1lX2VuZCA9ICRzZXJ2ZXJfbmFtZV9zdGFydCArICRzZXJ2ZXJfbmFtZV9zaXplIC0gMQogICAgICAgICAgICAgICAgICAgICAgICAkc2VydmVyX25hbWUgPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVbmljb2RlLkdldFN0cmluZygkZGZzX3RhcmdldGxpc3RfYmxvYlskc2VydmVyX25hbWVfc3RhcnQuLiRzZXJ2ZXJfbmFtZV9lbmRdKQoKICAgICAgICAgICAgICAgICAgICAgICAgJHNoYXJlX25hbWVfc2l6ZV9zdGFydCA9ICRzZXJ2ZXJfbmFtZV9lbmQgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICRzaGFyZV9uYW1lX3NpemVfZW5kID0gJHNoYXJlX25hbWVfc2l6ZV9zdGFydCArIDEKICAgICAgICAgICAgICAgICAgICAgICAgJHNoYXJlX25hbWVfc2l6ZSA9IFtiaXRjb252ZXJ0ZXJdOjpUb1VJbnQxNigkZGZzX3RhcmdldGxpc3RfYmxvYlskc2hhcmVfbmFtZV9zaXplX3N0YXJ0Li4kc2hhcmVfbmFtZV9zaXplX2VuZF0sMCkKICAgICAgICAgICAgICAgICAgICAgICAgJHNoYXJlX25hbWVfc3RhcnQgPSAkc2hhcmVfbmFtZV9zaXplX2VuZCArIDEKICAgICAgICAgICAgICAgICAgICAgICAgJHNoYXJlX25hbWVfZW5kID0gJHNoYXJlX25hbWVfc3RhcnQgKyAkc2hhcmVfbmFtZV9zaXplIC0gMQogICAgICAgICAgICAgICAgICAgICAgICAkc2hhcmVfbmFtZSA9IFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OlVuaWNvZGUuR2V0U3RyaW5nKCRkZnNfdGFyZ2V0bGlzdF9ibG9iWyRzaGFyZV9uYW1lX3N0YXJ0Li4kc2hhcmVfbmFtZV9lbmRdKQoKICAgICAgICAgICAgICAgICAgICAgICAgJHRhcmdldF9saXN0ICs9ICJcXCRzZXJ2ZXJfbmFtZVwkc2hhcmVfbmFtZSIKICAgICAgICAgICAgICAgICAgICAgICAgJHRfb2Zmc2V0ID0gJHNoYXJlX25hbWVfZW5kICsgMQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkb2Zmc2V0ID0gJGJsb2JfZGF0YV9lbmQgKyAxCiAgICAgICAgICAgICRkZnNfcGt0X3Byb3BlcnRpZXMgPSBAewogICAgICAgICAgICAgICAgJ05hbWUnID0gJGJsb2JfbmFtZQogICAgICAgICAgICAgICAgJ1ByZWZpeCcgPSAkcHJlZml4CiAgICAgICAgICAgICAgICAnVGFyZ2V0TGlzdCcgPSAkdGFyZ2V0X2xpc3QKICAgICAgICAgICAgfQogICAgICAgICAgICAkb2JqZWN0X2xpc3QgKz0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5ICRkZnNfcGt0X3Byb3BlcnRpZXMKICAgICAgICAgICAgJHByZWZpeCA9ICRudWxsCiAgICAgICAgICAgICRibG9iX25hbWUgPSAkbnVsbAogICAgICAgICAgICAkdGFyZ2V0X2xpc3QgPSAkbnVsbAogICAgICAgIH0KCiAgICAgICAgJHNlcnZlcnMgPSBAKCkKICAgICAgICAkb2JqZWN0X2xpc3QgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIGlmICgkXy5UYXJnZXRMaXN0KSB7CiAgICAgICAgICAgICAgICAkXy5UYXJnZXRMaXN0IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICRzZXJ2ZXJzICs9ICRfLnNwbGl0KCJcIilbMl0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJHNlcnZlcnMKICAgIH0KCiAgICBmdW5jdGlvbiBHZXQtREZTc2hhcmVWMSB7CiAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0KICAgICAgICBwYXJhbSgKICAgICAgICAgICAgW1N0cmluZ10KICAgICAgICAgICAgJERvbWFpbiwKCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICAgICAgW1N0cmluZ10KICAgICAgICAgICAgJEFEU3BhdGgsCgogICAgICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0KICAgICAgICAgICAgW0ludF0KICAgICAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgICAgICRDcmVkZW50aWFsCiAgICAgICAgKQoKICAgICAgICAkREZTc2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwYXRoICRBRFNwYXRoIC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgaWYoJERGU3NlYXJjaGVyKSB7CiAgICAgICAgICAgICRERlNzaGFyZXMgPSBAKCkKICAgICAgICAgICAgJERGU3NlYXJjaGVyLmZpbHRlciA9ICIoJihvYmplY3RDbGFzcz1mVERmcykpIgoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJERGU1NlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAkUHJvcGVydGllcyA9ICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAkUmVtb3RlTmFtZXMgPSAkUHJvcGVydGllcy5yZW1vdGVzZXJ2ZXJuYW1lCiAgICAgICAgICAgICAgICAgICAgJFBrdCA9ICRQcm9wZXJ0aWVzLnBrdAoKICAgICAgICAgICAgICAgICAgICAkREZTc2hhcmVzICs9ICRSZW1vdGVOYW1lcyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJF8uQ29udGFpbnMoJ1wnKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAtUHJvcGVydHkgQHsnTmFtZSc9JFByb3BlcnRpZXMubmFtZVswXTsnUmVtb3RlU2VydmVyTmFtZSc9JF8uc3BsaXQoIlwiKVsyXX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBpbiBwYXJzaW5nIERGUyBzaGFyZSA6ICRfIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICAgICAkREZTU2VhcmNoZXIuZGlzcG9zZSgpCgogICAgICAgICAgICAgICAgaWYoJHBrdCAtYW5kICRwa3RbMF0pIHsKICAgICAgICAgICAgICAgICAgICBQYXJzZS1Qa3QgJHBrdFswXSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBJZiBhIGZvbGRlciBkb2Vzbid0IGhhdmUgYSByZWRpcmVjdGlvbiBpdCB3aWxsCiAgICAgICAgICAgICAgICAgICAgICAgICMgaGF2ZSBhIHRhcmdldCBsaWtlCiAgICAgICAgICAgICAgICAgICAgICAgICMgXFxudWxsXFRlc3ROYW1lU3BhY2VcZm9sZGVyXC5ERlNGb2xkZXJMaW5rIHNvIHdlCiAgICAgICAgICAgICAgICAgICAgICAgICMgZG8gYWN0dWFsbHkgd2FudCB0byBtYXRjaCBvbiAibnVsbCIgcmF0aGVyIHRoYW4KICAgICAgICAgICAgICAgICAgICAgICAgIyAkbnVsbAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF8gLW5lICJudWxsIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5IEB7J05hbWUnPSRQcm9wZXJ0aWVzLm5hbWVbMF07J1JlbW90ZVNlcnZlck5hbWUnPSRffQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkdldC1ERlNzaGFyZVYxIGVycm9yIDogJF8iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJERGU3NoYXJlcyB8IFNvcnQtT2JqZWN0IC1Qcm9wZXJ0eSAiUmVtb3RlU2VydmVyTmFtZSIKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gR2V0LURGU3NoYXJlVjIgewogICAgICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICAgICAgcGFyYW0oCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICREb21haW4sCgogICAgICAgICAgICBbU3RyaW5nXQogICAgICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICRBRFNwYXRoLAoKICAgICAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgICAgIFtJbnRdCiAgICAgICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICAgICAkQ3JlZGVudGlhbAogICAgICAgICkKCiAgICAgICAgJERGU3NlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcGF0aCAkQURTcGF0aCAtUGFnZVNpemUgJFBhZ2VTaXplCgogICAgICAgIGlmKCRERlNzZWFyY2hlcikgewogICAgICAgICAgICAkREZTc2hhcmVzID0gQCgpCiAgICAgICAgICAgICRERlNzZWFyY2hlci5maWx0ZXIgPSAiKCYob2JqZWN0Q2xhc3M9bXNERlMtTGlua3YyKSkiCiAgICAgICAgICAgICRERlNTZWFyY2hlci5Qcm9wZXJ0aWVzVG9Mb2FkLkFkZFJhbmdlKCgnbXNkZnMtbGlua3BhdGh2MicsJ21zREZTLVRhcmdldExpc3R2MicpKQoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJERGU1NlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAkUHJvcGVydGllcyA9ICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0X2xpc3QgPSAkUHJvcGVydGllcy4nbXNkZnMtdGFyZ2V0bGlzdHYyJ1swXQogICAgICAgICAgICAgICAgICAgICR4bWwgPSBbeG1sXVtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OlVuaWNvZGUuR2V0U3RyaW5nKCR0YXJnZXRfbGlzdFsyLi4oJHRhcmdldF9saXN0Lkxlbmd0aC0xKV0pCiAgICAgICAgICAgICAgICAgICAgJERGU3NoYXJlcyArPSAkeG1sLnRhcmdldHMuQ2hpbGROb2RlcyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUYXJnZXQgPSAkXy5Jbm5lclRleHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJFRhcmdldC5Db250YWlucygnXCcpICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRERlNyb290ID0gJFRhcmdldC5zcGxpdCgiXCIpWzNdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFNoYXJlTmFtZSA9ICRQcm9wZXJ0aWVzLidtc2Rmcy1saW5rcGF0aHYyJ1swXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IC1Qcm9wZXJ0eSBAeydOYW1lJz0iJERGU3Jvb3QkU2hhcmVOYW1lIjsnUmVtb3RlU2VydmVyTmFtZSc9JFRhcmdldC5zcGxpdCgiXCIpWzJdfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIGluIHBhcnNpbmcgdGFyZ2V0IDogJF8iCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICRERlNTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJHZXQtREZTc2hhcmVWMiBlcnJvciA6ICRfIgogICAgICAgICAgICB9CiAgICAgICAgICAgICRERlNzaGFyZXMgfCBTb3J0LU9iamVjdCAtVW5pcXVlIC1Qcm9wZXJ0eSAiUmVtb3RlU2VydmVyTmFtZSIKICAgICAgICB9CiAgICB9CgogICAgJERGU3NoYXJlcyA9IEAoKQoKICAgIGlmICggKCRWZXJzaW9uIC1lcSAiYWxsIikgLW9yICgkVmVyc2lvbi5lbmRzV2l0aCgiMSIpKSApIHsKICAgICAgICAkREZTc2hhcmVzICs9IEdldC1ERlNzaGFyZVYxIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcGF0aCAkQURTcGF0aCAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICB9CiAgICBpZiAoICgkVmVyc2lvbiAtZXEgImFsbCIpIC1vciAoJFZlcnNpb24uZW5kc1dpdGgoIjIiKSkgKSB7CiAgICAgICAgJERGU3NoYXJlcyArPSBHZXQtREZTc2hhcmVWMiAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJEFEU3BhdGggLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgfQoKICAgICRERlNzaGFyZXMgfCBTb3J0LU9iamVjdCAtUHJvcGVydHkgKCJSZW1vdGVTZXJ2ZXJOYW1lIiwiTmFtZSIpIC1VbmlxdWUKfQoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMKIyBHUE8gcmVsYXRlZCBmdW5jdGlvbnMuCiMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmZ1bmN0aW9uIEdldC1HcHRUbXBsIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBIZWxwZXIgdG8gcGFyc2UgYSBHcHRUbXBsLmluZiBwb2xpY3kgZmlsZSBwYXRoIGludG8gYSBjdXN0b20gb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgR3B0VG1wbFBhdGgKCiAgICAgICAgVGhlIEdwdFRtcGwuaW5mIGZpbGUgcGF0aCBuYW1lIHRvIHBhcnNlLgoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IHRoZSB0YXJnZXQgR3B0VG1wbCBmb2xkZXIgcGF0aCBhcyBhIHRlbXBvcmFyeSBQU0RyaXZlLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUdwdFRtcGwgLUdwdFRtcGxQYXRoICJcXGRldi50ZXN0bGFiLmxvY2FsXHN5c3ZvbFxkZXYudGVzdGxhYi5sb2NhbFxQb2xpY2llc1x7MzFCMkYzNDAtMDE2RC0xMUQyLTk0NUYtMDBDMDRGQjk4NEY5fVxNQUNISU5FXE1pY3Jvc29mdFxXaW5kb3dzIE5UXFNlY0VkaXRcR3B0VG1wbC5pbmYiCgogICAgICAgIFBhcnNlIHRoZSBkZWZhdWx0IGRvbWFpbiBwb2xpY3kgLmluZiBmb3IgZGV2LnRlc3RsYWIubG9jYWwKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3B0VG1wbFBhdGgsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVzZVBTRHJpdmUKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgaWYoJFVzZVBTRHJpdmUpIHsKICAgICAgICAgICAgIyBpZiB3ZSdyZSBQU0RyaXZlcywgY3JlYXRlIGEgdGVtcG9yYXJ5IG1vdW50IHBvaW50CiAgICAgICAgICAgICRQYXJ0cyA9ICRHcHRUbXBsUGF0aC5zcGxpdCgnXCcpCiAgICAgICAgICAgICRGb2xkZXJQYXRoID0gJFBhcnRzWzAuLigkUGFydHMubGVuZ3RoLTIpXSAtam9pbiAnXCcKICAgICAgICAgICAgJEZpbGVQYXRoID0gJFBhcnRzWy0xXQogICAgICAgICAgICAkUmFuZERyaXZlID0gKCJhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eiIuVG9DaGFyQXJyYXkoKSB8IEdldC1SYW5kb20gLUNvdW50IDcpIC1qb2luICcnCgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJNb3VudGluZyBwYXRoICRHcHRUbXBsUGF0aCB1c2luZyBhIHRlbXAgUFNEcml2ZSBhdCAkUmFuZERyaXZlIgoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICROdWxsID0gTmV3LVBTRHJpdmUgLU5hbWUgJFJhbmREcml2ZSAtUFNQcm92aWRlciBGaWxlU3lzdGVtIC1Sb290ICRGb2xkZXJQYXRoICAtRXJyb3JBY3Rpb24gU3RvcAogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIG1vdW50aW5nIHBhdGggJEdwdFRtcGxQYXRoIDogJF8iCiAgICAgICAgICAgICAgICByZXR1cm4gJE51bGwKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzbyB3ZSBjYW4gY2QvZGlyIHRoZSBuZXcgZHJpdmUKICAgICAgICAgICAgJFRhcmdldEdwdFRtcGxQYXRoID0gJFJhbmREcml2ZSArICI6XCIgKyAkRmlsZVBhdGgKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRUYXJnZXRHcHRUbXBsUGF0aCA9ICRHcHRUbXBsUGF0aAogICAgICAgIH0KICAgICAgICBXcml0ZS1WZXJib3NlICJHcHRUbXBsUGF0aDogJEdwdFRtcGxQYXRoIgogICAgfQoKICAgIHByb2Nlc3MgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlBhcnNpbmcgJFRhcmdldEdwdFRtcGxQYXRoIgogICAgICAgICAgICAkVGFyZ2V0R3B0VG1wbFBhdGggfCBHZXQtSW5pQ29udGVudCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIHBhcnNpbmcgJFRhcmdldEdwdFRtcGxQYXRoIDogJF8iCiAgICAgICAgfQogICAgfQoKICAgIGVuZCB7CiAgICAgICAgaWYoJFVzZVBTRHJpdmUgLWFuZCAkUmFuZERyaXZlKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlJlbW92aW5nIHRlbXAgUFNEcml2ZSAkUmFuZERyaXZlIgogICAgICAgICAgICBHZXQtUFNEcml2ZSAtTmFtZSAkUmFuZERyaXZlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgUmVtb3ZlLVBTRHJpdmUgLUZvcmNlCiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LUdyb3Vwc1hNTCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgSGVscGVyIHRvIHBhcnNlIGEgZ3JvdXBzLnhtbCBmaWxlIHBhdGggaW50byBhIGN1c3RvbSBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBHcm91cHNYTUxwYXRoCgogICAgICAgIFRoZSBncm91cHMueG1sIGZpbGUgcGF0aCBuYW1lIHRvIHBhcnNlLgoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IHRoZSB0YXJnZXQgZ3JvdXBzLnhtbCBmb2xkZXIgcGF0aCBhcyBhIHRlbXBvcmFyeSBQU0RyaXZlLgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRHcm91cHNYTUxQYXRoLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRVc2VQU0RyaXZlCiAgICApCgogICAgYmVnaW4gewogICAgICAgIGlmKCRVc2VQU0RyaXZlKSB7CiAgICAgICAgICAgICMgaWYgd2UncmUgUFNEcml2ZXMsIGNyZWF0ZSBhIHRlbXBvcmFyeSBtb3VudCBwb2ludAogICAgICAgICAgICAkUGFydHMgPSAkR3JvdXBzWE1MUGF0aC5zcGxpdCgnXCcpCiAgICAgICAgICAgICRGb2xkZXJQYXRoID0gJFBhcnRzWzAuLigkUGFydHMubGVuZ3RoLTIpXSAtam9pbiAnXCcKICAgICAgICAgICAgJEZpbGVQYXRoID0gJFBhcnRzWy0xXQogICAgICAgICAgICAkUmFuZERyaXZlID0gKCJhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eiIuVG9DaGFyQXJyYXkoKSB8IEdldC1SYW5kb20gLUNvdW50IDcpIC1qb2luICcnCgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJNb3VudGluZyBwYXRoICRHcm91cHNYTUxQYXRoIHVzaW5nIGEgdGVtcCBQU0RyaXZlIGF0ICRSYW5kRHJpdmUiCgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJE51bGwgPSBOZXctUFNEcml2ZSAtTmFtZSAkUmFuZERyaXZlIC1QU1Byb3ZpZGVyIEZpbGVTeXN0ZW0gLVJvb3QgJEZvbGRlclBhdGggIC1FcnJvckFjdGlvbiBTdG9wCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgbW91bnRpbmcgcGF0aCAkR3JvdXBzWE1MUGF0aCA6ICRfIgogICAgICAgICAgICAgICAgcmV0dXJuICROdWxsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgc28gd2UgY2FuIGNkL2RpciB0aGUgbmV3IGRyaXZlCiAgICAgICAgICAgICRUYXJnZXRHcm91cHNYTUxQYXRoID0gJFJhbmREcml2ZSArICI6XCIgKyAkRmlsZVBhdGgKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRUYXJnZXRHcm91cHNYTUxQYXRoID0gJEdyb3Vwc1hNTFBhdGgKICAgICAgICB9CiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFtYTUxdJEdyb3Vwc1hNTGNvbnRlbnQgPSBHZXQtQ29udGVudCAkVGFyZ2V0R3JvdXBzWE1MUGF0aCAtRXJyb3JBY3Rpb24gU3RvcAoKICAgICAgICAgICAgIyBwcm9jZXNzIGFsbCBncm91cCBwcm9wZXJ0aWVzIGluIHRoZSBYTUwKICAgICAgICAgICAgJEdyb3Vwc1hNTGNvbnRlbnQgfCBTZWxlY3QtWG1sICIvL0dyb3VwcyIgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBub2RlIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICRHcm91cG5hbWUgPSAkXy5Hcm91cC5Qcm9wZXJ0aWVzLmdyb3VwTmFtZQoKICAgICAgICAgICAgICAgICMgZXh0cmFjdCB0aGUgbG9jYWxncm91cCBzaWQgZm9yIG1lbWJlcm9mCiAgICAgICAgICAgICAgICAkR3JvdXBTSUQgPSAkXy5Hcm91cC5Qcm9wZXJ0aWVzLkdyb3VwU2lkCiAgICAgICAgICAgICAgICBpZigtbm90ICRMb2NhbFNpZCkgewogICAgICAgICAgICAgICAgICAgIGlmKCRHcm91cG5hbWUgLW1hdGNoICdBZG1pbmlzdHJhdG9ycycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwU0lEID0gJ1MtMS01LTMyLTU0NCcKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZWlmKCRHcm91cG5hbWUgLW1hdGNoICdSZW1vdGUgRGVza3RvcCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwU0lEID0gJ1MtMS01LTMyLTU1NScKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZWlmKCRHcm91cG5hbWUgLW1hdGNoICdHdWVzdHMnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cFNJRCA9ICdTLTEtNS0zMi01NDYnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBTSUQgPSBDb252ZXJ0LU5hbWVUb1NpZCAtT2JqZWN0TmFtZSAkR3JvdXBuYW1lIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgU0lECiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgZXh0cmFjdCBvdXQgbWVtYmVycyBhZGRlZCB0byB0aGlzIGdyb3VwCiAgICAgICAgICAgICAgICAkTWVtYmVycyA9ICRfLkdyb3VwLlByb3BlcnRpZXMubWVtYmVycyB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IE1lbWJlciB8IFdoZXJlLU9iamVjdCB7ICRfLmFjdGlvbiAtbWF0Y2ggJ0FERCcgfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICBpZigkXy5zaWQpIHsgJF8uc2lkIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsgJF8ubmFtZSB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCRNZW1iZXJzKSB7CgogICAgICAgICAgICAgICAgICAgICMgZXh0cmFjdCBvdXQgYW55L2FsbCBmaWx0ZXJzLi4uSSBoYXRlIHlvdSBHUFAKICAgICAgICAgICAgICAgICAgICBpZigkXy5Hcm91cC5maWx0ZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRGaWx0ZXJzID0gJF8uR3JvdXAuZmlsdGVycy5HZXRFbnVtZXJhdG9yKCkgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAtUHJvcGVydHkgQHsnVHlwZScgPSAkXy5Mb2NhbE5hbWU7J1ZhbHVlJyA9ICRfLm5hbWV9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRGaWx0ZXJzID0gJE51bGwKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKCRNZW1iZXJzIC1pc25vdCBbU3lzdGVtLkFycmF5XSkgeyAkTWVtYmVycyA9IEAoJE1lbWJlcnMpIH0KCiAgICAgICAgICAgICAgICAgICAgJEdQT0dyb3VwID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9QYXRoJyAkVGFyZ2V0R3JvdXBzWE1MUGF0aAogICAgICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdGaWx0ZXJzJyAkRmlsdGVycwogICAgICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cE5hbWUnICRHcm91cE5hbWUKICAgICAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXBTSUQnICRHcm91cFNJRAogICAgICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cE1lbWJlck9mJyAkTnVsbAogICAgICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cE1lbWJlcnMnICRNZW1iZXJzCiAgICAgICAgICAgICAgICAgICAgJEdQT0dyb3VwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBwYXJzaW5nICRUYXJnZXRHcm91cHNYTUxQYXRoIDogJF8iCiAgICAgICAgfQogICAgfQoKICAgIGVuZCB7CiAgICAgICAgaWYoJFVzZVBTRHJpdmUgLWFuZCAkUmFuZERyaXZlKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlJlbW92aW5nIHRlbXAgUFNEcml2ZSAkUmFuZERyaXZlIgogICAgICAgICAgICBHZXQtUFNEcml2ZSAtTmFtZSAkUmFuZERyaXZlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgUmVtb3ZlLVBTRHJpdmUgLUZvcmNlCiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LU5ldEdQTyB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgR2V0cyBhIGxpc3Qgb2YgYWxsIGN1cnJlbnQgR1BPcyBpbiBhIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIEdQT25hbWUKCiAgICAgICAgVGhlIEdQTyBuYW1lIHRvIHF1ZXJ5IGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgRGlzcGxheU5hbWUKCiAgICAgICAgVGhlIEdQTyBkaXNwbGF5IG5hbWUgdG8gcXVlcnkgZm9yLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgUmV0dXJuIGFsbCBHUE8gb2JqZWN0cyBhcHBsaWVkIHRvIGEgZ2l2ZW4gY29tcHV0ZXIgKEZRRE4pLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIEdQT3MsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoCiAgICAgICAgZS5nLiAiTERBUDovL2NuPXs4RkY1OUQyOC0xNUQ3LTQyMkEtQkNCNy0yQUU0NTcyNDEyNUF9LGNuPXBvbGljaWVzLGNuPXN5c3RlbSxEQz1kZXYsREM9dGVzdGxhYixEQz1sb2NhbCIKCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgIGZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldEdQTyAtRG9tYWluIHRlc3RsYWIubG9jYWwKCiAgICAgICAgUmV0dXJucyB0aGUgR1BPcyBpbiB0aGUgJ3Rlc3RsYWIubG9jYWwnIGRvbWFpbi4KIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBQYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR1BPbmFtZSA9ICcqJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRGlzcGxheU5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0KICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgJEdQT1NlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcGF0aCAkQURTcGF0aCAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICB9CgogICAgcHJvY2VzcyB7CiAgICAgICAgaWYgKCRHUE9TZWFyY2hlcikgewoKICAgICAgICAgICAgaWYoJENvbXB1dGVyTmFtZSkgewogICAgICAgICAgICAgICAgJEdQT05hbWVzID0gQCgpCiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJzID0gR2V0LU5ldENvbXB1dGVyIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgICAgICAgICBpZighJENvbXB1dGVycykgewogICAgICAgICAgICAgICAgICAgIHRocm93ICJDb21wdXRlciAkQ29tcHV0ZXJOYW1lIGluIGRvbWFpbiAnJERvbWFpbicgbm90IGZvdW5kISBUcnkgYSBmdWxseSBxdWFsaWZpZWQgaG9zdCBuYW1lIgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgZ2V0IHRoZSBnaXZlbiBjb21wdXRlcidzIE9VCiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJPVXMgPSBAKCkKICAgICAgICAgICAgICAgIEZvckVhY2goJENvbXB1dGVyIGluICRDb21wdXRlcnMpIHsKICAgICAgICAgICAgICAgICAgICAjIGV4dHJhY3QgYWxsIE9VcyBhIGNvbXB1dGVyIGlzIGEgcGFydCBvZgogICAgICAgICAgICAgICAgICAgICRETiA9ICRDb21wdXRlci5kaXN0aW5ndWlzaGVkbmFtZQoKICAgICAgICAgICAgICAgICAgICAkQ29tcHV0ZXJPVXMgKz0gJEROLnNwbGl0KCIsIikgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRfLnN0YXJ0c3dpdGgoIk9VPSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRE4uc3Vic3RyaW5nKCRETi5pbmRleG9mKCRfKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDb21wdXRlck9VczogJENvbXB1dGVyT1VzIgoKICAgICAgICAgICAgICAgICMgZmluZCBhbGwgdGhlIEdQT3MgbGlua2VkIHRvIHRoZSBjb21wdXRlcidzIE9VCiAgICAgICAgICAgICAgICBGb3JFYWNoKCRDb21wdXRlck9VIGluICRDb21wdXRlck9VcykgewogICAgICAgICAgICAgICAgICAgICRHUE9OYW1lcyArPSBHZXQtTmV0T1UgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1BRFNwYXRoICRDb21wdXRlck9VIC1GdWxsRGF0YSAtUGFnZVNpemUgJFBhZ2VTaXplIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAjIGdldCBhbnkgR1BPIGxpbmtzCiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlLXZlcmJvc2UgImJsYWg6ICQoJF8ubmFtZSkiCiAgICAgICAgICAgICAgICAgICAgICAgICRfLmdwbGluay5zcGxpdCgiXVsiKSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkXy5zdGFydHN3aXRoKCJMREFQIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkXy5zcGxpdCgiOyIpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiR1BPTmFtZXM6ICRHUE9OYW1lcyIKCiAgICAgICAgICAgICAgICAjIGZpbmQgYW55IEdQT3MgbGlua2VkIHRvIHRoZSBzaXRlIGZvciB0aGUgZ2l2ZW4gY29tcHV0ZXIKICAgICAgICAgICAgICAgICRDb21wdXRlclNpdGUgPSAoR2V0LVNpdGVOYW1lIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSkuU2l0ZU5hbWUKICAgICAgICAgICAgICAgIGlmKCRDb21wdXRlclNpdGUgLWFuZCAoJENvbXB1dGVyU2l0ZSAtbm90bGlrZSAnRXJyb3IqJykpIHsKICAgICAgICAgICAgICAgICAgICAkR1BPTmFtZXMgKz0gR2V0LU5ldFNpdGUgLVNpdGVOYW1lICRDb21wdXRlclNpdGUgLUZ1bGxEYXRhIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICBpZigkXy5ncGxpbmspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfLmdwbGluay5zcGxpdCgiXVsiKSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF8uc3RhcnRzd2l0aCgiTERBUCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfLnNwbGl0KCI7IilbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJEdQT05hbWVzIHwgV2hlcmUtT2JqZWN0eyRfIC1hbmQgKCRfIC1uZSAnJyl9IHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICAgICAjIHVzZSB0aGUgZ3BsaW5rIGFzIGFuIEFEUyBwYXRoIHRvIGVudW1lcmF0ZSBhbGwgR1BPcyBmb3IgdGhlIGNvbXB1dGVyCiAgICAgICAgICAgICAgICAgICAgJEdQT1NlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcGF0aCAkXyAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICAgICAgICAgICAgICAgICAgJEdQT1NlYXJjaGVyLmZpbHRlcj0iKCYob2JqZWN0Q2F0ZWdvcnk9Z3JvdXBQb2xpY3lDb250YWluZXIpKG5hbWU9JEdQT25hbWUpKSIKCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgJFJlc3VsdHMgPSAkR1BPU2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgICAgICAgICAgICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkT3V0ID0gQ29udmVydC1MREFQUHJvcGVydHkgLVByb3BlcnRpZXMgJF8uUHJvcGVydGllcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRPdXQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICAgICAgICAgJEdQT1NlYXJjaGVyLmRpc3Bvc2UoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgJF8KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYoJERpc3BsYXlOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgJEdQT1NlYXJjaGVyLmZpbHRlcj0iKCYob2JqZWN0Q2F0ZWdvcnk9Z3JvdXBQb2xpY3lDb250YWluZXIpKGRpc3BsYXluYW1lPSREaXNwbGF5TmFtZSkpIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJEdQT1NlYXJjaGVyLmZpbHRlcj0iKCYob2JqZWN0Q2F0ZWdvcnk9Z3JvdXBQb2xpY3lDb250YWluZXIpKG5hbWU9JEdQT25hbWUpKSIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJEdQT1NlYXJjaGVyLkZpbmRBbGwoKQogICAgICAgICAgICAgICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRBRFNQYXRoIC1hbmQgKCRBRFNwYXRoIC1NYXRjaCAnXkdDOi8vJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gQ29udmVydC1MREFQUHJvcGVydHkgLVByb3BlcnRpZXMgJF8uUHJvcGVydGllcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR1BPRE4gPSAkUHJvcGVydGllcy5kaXN0aW5ndWlzaGVkbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHUE9Eb21haW4gPSAkR1BPRE4uc3ViU3RyaW5nKCRHUE9ETi5JbmRleE9mKCJEQz0iKSkgLXJlcGxhY2UgJ0RDPScsJycgLXJlcGxhY2UgJywnLCcuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRncGNmaWxlc3lzcGF0aCA9ICJcXCRHUE9Eb21haW5cU3lzVm9sXCRHUE9Eb21haW5cUG9saWNpZXNcJCgkUHJvcGVydGllcy5jbikiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnZ3BjZmlsZXN5c3BhdGgnICRncGNmaWxlc3lzcGF0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgY29udmVydC9wcm9jZXNzIHRoZSBMREFQIGZpZWxkcyBmb3IgZWFjaCByZXN1bHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkUmVzdWx0cy5kaXNwb3NlKCkKICAgICAgICAgICAgICAgICAgICAkR1BPU2VhcmNoZXIuZGlzcG9zZSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtV2FybmluZyAkXwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gTmV3LUdQT0ltbWVkaWF0ZVRhc2sgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEJ1aWxkcyBhbiAnSW1tZWRpYXRlJyBzY2h0YXNrIHRvIHB1c2ggb3V0IHRocm91Z2ggYSBzcGVjaWZpZWQgR1BPLgoKICAgIC5QQVJBTUVURVIgVGFza05hbWUKCiAgICAgICAgTmFtZSBmb3IgdGhlIHNjaHRhc2sgdG8gcmVjcmVhdGUuIFJlcXVpcmVkLgoKICAgIC5QQVJBTUVURVIgQ29tbWFuZAoKICAgICAgICBUaGUgY29tbWFuZCB0byBleGVjdXRlIHdpdGggdGhlIHRhc2ssIGRlZmF1bHRzIHRvICdwb3dlcnNoZWxsJwoKICAgIC5QQVJBTUVURVIgQ29tbWFuZEFyZ3VtZW50cwoKICAgICAgICBUaGUgYXJndW1lbnRzIHRvIHN1cHBseSB0byB0aGUgLUNvbW1hbmQgYmVpbmcgbGF1bmNoZWQuCgogICAgLlBBUkFNRVRFUiBUYXNrRGVzY3JpcHRpb24KCiAgICAgICAgQW4gb3B0aW9uYWwgZGVzY3JpcHRpb24gZm9yIHRoZSB0YXNrLgoKICAgIC5QQVJBTUVURVIgVGFza0F1dGhvcgoKICAgICAgICBUaGUgZGlzcGxheWVkIGF1dGhvciBvZiB0aGUgdGFzaywgZGVmYXVsdHMgdG8gJydOVCBBVVRIT1JJVFlcU3lzdGVtJwoKICAgIC5QQVJBTUVURVIgVGFza01vZGlmaWVkRGF0ZQoKICAgICAgICBUaGUgZGlzcGxheWVkIG1vZGlmaWVkIGRhdGUgZm9yIHRoZSB0YXNrLCBkZWZhdWx0cyB0byAzMCBkYXlzIGFnby4KCiAgICAuUEFSQU1FVEVSIEdQT25hbWUKCiAgICAgICAgVGhlIEdQTyBuYW1lIHRvIGJ1aWxkIHRoZSB0YXNrIGZvci4KCiAgICAuUEFSQU1FVEVSIEdQT0Rpc3BsYXlOYW1lCgogICAgICAgIFRoZSBHUE8gZGlzcGxheSBuYW1lIHRvIGJ1aWxkIHRoZSB0YXNrIGZvci4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciB0aGUgR1BPcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gKICAgICAgICBlLmcuICJMREFQOi8vY249ezhGRjU5RDI4LTE1RDctNDIyQS1CQ0I3LTJBRTQ1NzI0MTI1QX0sY249cG9saWNpZXMsY249c3lzdGVtLERDPWRldixEQz10ZXN0bGFiLERDPWxvY2FsIgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUz4gTmV3LUdQT0ltbWVkaWF0ZVRhc2sgLVRhc2tOYW1lIERlYnVnZ2luZyAtR1BPRGlzcGxheU5hbWUgU2VjdXJlUG9saWN5IC1Db21tYW5kQXJndW1lbnRzICctYyAiMTIzIHwgT3V0LUZpbGUgQzpcVGVtcFxkZWJ1Zy50eHQiJyAtRm9yY2UKCiAgICAgICAgQ3JlYXRlIGFuIGltbWVkaWF0ZSBzY2h0YXNrIHRoYXQgZXhlY3V0ZXMgdGhlIHNwZWNpZmllZCBQb3dlclNoZWxsIGFyZ3VtZW50cyBhbmQKICAgICAgICBwdXNoIGl0IG91dCB0byB0aGUgJ1NlY3VyZVBvbGljeScgR1BPLCBza2lwcGluZyB0aGUgY29uZmlybWF0aW9uIHByb21wdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUz4gTmV3LUdQT0ltbWVkaWF0ZVRhc2sgLUdQT0Rpc3BsYXlOYW1lIFNlY3VyZVBvbGljeSAtUmVtb3ZlIC1Gb3JjZQoKICAgICAgICBSZW1vdmUgYWxsIHNjaHRhc2tzIGZyb20gdGhlICdTZWN1cmVQb2xpY3knIEdQTywgc2tpcHBpbmcgdGhlIGNvbmZpcm1hdGlvbiBwcm9tcHQuCiM+CiAgICBbQ21kbGV0QmluZGluZyhEZWZhdWx0UGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQ3JlYXRlJywgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkVGFza05hbWUsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJENvbW1hbmQgPSAncG93ZXJzaGVsbCcsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJENvbW1hbmRBcmd1bWVudHMsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJFRhc2tEZXNjcmlwdGlvbiA9ICcnLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQ3JlYXRlJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRUYXNrQXV0aG9yID0gJ05UIEFVVEhPUklUWVxTeXN0ZW0nLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQ3JlYXRlJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRUYXNrTW9kaWZpZWREYXRlID0gKEdldC1EYXRlIChHZXQtRGF0ZSkuQWRkRGF5cygtMzApIC1Gb3JtYXQgdSkudHJpbSgiWiIpLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQ3JlYXRlJyldCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ1JlbW92ZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdQT25hbWUsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnKV0KICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnUmVtb3ZlJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR1BPRGlzcGxheU5hbWUsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnKV0KICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnUmVtb3ZlJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQ3JlYXRlJyldCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ1JlbW92ZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdDcmVhdGUnKV0KICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnUmVtb3ZlJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQURTcGF0aCwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScpXQogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdSZW1vdmUnKV0KICAgICAgICBbU3dpdGNoXQogICAgICAgICRGb3JjZSwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ1JlbW92ZScpXQogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlbW92ZSwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0NyZWF0ZScpXQogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdSZW1vdmUnKV0KICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgICMgYnVpbGQgdGhlIFhNTCBzcGVjIGZvciBvdXIgJ2ltbWVkaWF0ZScgc2NoZWR1bGVkIHRhc2sKICAgICRUYXNrWE1MID0gJzw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9InV0Zi04Ij8+PFNjaGVkdWxlZFRhc2tzIGNsc2lkPSJ7Q0M2M0YyMDAtNzMwOS00YmEwLUIxNTQtQTcxQ0QxMThEQkNDfSI+PEltbWVkaWF0ZVRhc2tWMiBjbHNpZD0iezk3NTZCNTgxLTc2RUMtNDE2OS05QUZDLTBDQThENDNBREI1Rn0iIG5hbWU9IicrJFRhc2tOYW1lKyciIGltYWdlPSIwIiBjaGFuZ2VkPSInKyRUYXNrTW9kaWZpZWREYXRlKyciIHVpZD0ieycrJChbZ3VpZF06Ok5ld0d1aWQoKSkrJ30iIHVzZXJDb250ZXh0PSIwIiByZW1vdmVQb2xpY3k9IjAiPjxQcm9wZXJ0aWVzIGFjdGlvbj0iQyIgbmFtZT0iJyskVGFza05hbWUrJyIgcnVuQXM9Ik5UIEFVVEhPUklUWVxTeXN0ZW0iIGxvZ29uVHlwZT0iUzRVIj48VGFzayB2ZXJzaW9uPSIxLjMiPjxSZWdpc3RyYXRpb25JbmZvPjxBdXRob3I+JyskVGFza0F1dGhvcisnPC9BdXRob3I+PERlc2NyaXB0aW9uPicrJFRhc2tEZXNjcmlwdGlvbisnPC9EZXNjcmlwdGlvbj48L1JlZ2lzdHJhdGlvbkluZm8+PFByaW5jaXBhbHM+PFByaW5jaXBhbCBpZD0iQXV0aG9yIj48VXNlcklkPk5UIEFVVEhPUklUWVxTeXN0ZW08L1VzZXJJZD48UnVuTGV2ZWw+SGlnaGVzdEF2YWlsYWJsZTwvUnVuTGV2ZWw+PExvZ29uVHlwZT5TNFU8L0xvZ29uVHlwZT48L1ByaW5jaXBhbD48L1ByaW5jaXBhbHM+PFNldHRpbmdzPjxJZGxlU2V0dGluZ3M+PER1cmF0aW9uPlBUMTBNPC9EdXJhdGlvbj48V2FpdFRpbWVvdXQ+UFQxSDwvV2FpdFRpbWVvdXQ+PFN0b3BPbklkbGVFbmQ+dHJ1ZTwvU3RvcE9uSWRsZUVuZD48UmVzdGFydE9uSWRsZT5mYWxzZTwvUmVzdGFydE9uSWRsZT48L0lkbGVTZXR0aW5ncz48TXVsdGlwbGVJbnN0YW5jZXNQb2xpY3k+SWdub3JlTmV3PC9NdWx0aXBsZUluc3RhbmNlc1BvbGljeT48RGlzYWxsb3dTdGFydElmT25CYXR0ZXJpZXM+ZmFsc2U8L0Rpc2FsbG93U3RhcnRJZk9uQmF0dGVyaWVzPjxTdG9wSWZHb2luZ09uQmF0dGVyaWVzPnRydWU8L1N0b3BJZkdvaW5nT25CYXR0ZXJpZXM+PEFsbG93SGFyZFRlcm1pbmF0ZT5mYWxzZTwvQWxsb3dIYXJkVGVybWluYXRlPjxTdGFydFdoZW5BdmFpbGFibGU+dHJ1ZTwvU3RhcnRXaGVuQXZhaWxhYmxlPjxBbGxvd1N0YXJ0T25EZW1hbmQ+ZmFsc2U8L0FsbG93U3RhcnRPbkRlbWFuZD48RW5hYmxlZD50cnVlPC9FbmFibGVkPjxIaWRkZW4+dHJ1ZTwvSGlkZGVuPjxFeGVjdXRpb25UaW1lTGltaXQ+UFQwUzwvRXhlY3V0aW9uVGltZUxpbWl0PjxQcmlvcml0eT43PC9Qcmlvcml0eT48RGVsZXRlRXhwaXJlZFRhc2tBZnRlcj5QVDBTPC9EZWxldGVFeHBpcmVkVGFza0FmdGVyPjxSZXN0YXJ0T25GYWlsdXJlPjxJbnRlcnZhbD5QVDE1TTwvSW50ZXJ2YWw+PENvdW50PjM8L0NvdW50PjwvUmVzdGFydE9uRmFpbHVyZT48L1NldHRpbmdzPjxBY3Rpb25zIENvbnRleHQ9IkF1dGhvciI+PEV4ZWM+PENvbW1hbmQ+JyskQ29tbWFuZCsnPC9Db21tYW5kPjxBcmd1bWVudHM+JyskQ29tbWFuZEFyZ3VtZW50cysnPC9Bcmd1bWVudHM+PC9FeGVjPjwvQWN0aW9ucz48VHJpZ2dlcnM+PFRpbWVUcmlnZ2VyPjxTdGFydEJvdW5kYXJ5PiVMb2NhbFRpbWVYbWxFeCU8L1N0YXJ0Qm91bmRhcnk+PEVuZEJvdW5kYXJ5PiVMb2NhbFRpbWVYbWxFeCU8L0VuZEJvdW5kYXJ5PjxFbmFibGVkPnRydWU8L0VuYWJsZWQ+PC9UaW1lVHJpZ2dlcj48L1RyaWdnZXJzPjwvVGFzaz48L1Byb3BlcnRpZXM+PC9JbW1lZGlhdGVUYXNrVjI+PC9TY2hlZHVsZWRUYXNrcz4nCgogICAgaWYgKCEkUFNCb3VuZFBhcmFtZXRlcnNbJ0dQT25hbWUnXSAtYW5kICEkUFNCb3VuZFBhcmFtZXRlcnNbJ0dQT0Rpc3BsYXlOYW1lJ10pIHsKICAgICAgICBXcml0ZS1XYXJuaW5nICdFaXRoZXIgLUdQT05hbWUgb3IgLUdQT0Rpc3BsYXlOYW1lIG11c3QgYmUgc3BlY2lmaWVkJwogICAgICAgIHJldHVybgogICAgfQoKICAgICMgZXVubWVyYXRlIHRoZSBzcGVjaWZpZWQgR1BPKHMpCiAgICAkR1BPcyA9IEdldC1OZXRHUE8gLUdQT25hbWUgJEdQT25hbWUgLURpc3BsYXlOYW1lICRHUE9EaXNwbGF5TmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUFEU3BhdGggJEFEU3BhdGggLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwKCiAgICBpZighJEdQT3MpIHsKICAgICAgICBXcml0ZS1XYXJuaW5nICdObyBHUE8gZm91bmQuJwogICAgICAgIHJldHVybgogICAgfQoKICAgICRHUE9zIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICRQcm9jZXNzZWRHUE9OYW1lID0gJF8uTmFtZQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlRyeWluZyB0byB3ZWFwb25pemUgR1BPOiAkUHJvY2Vzc2VkR1BPTmFtZSIKCiAgICAgICAgICAgICMgbWFwIGEgbmV0d29yayBkcml2ZSBhcyBOZXctUFNEcml2ZS9OZXctSXRlbS9ldGMuIGRvbid0IGFjY2VwdCAtQ3JlZGVudGlhbCBwcm9wZXJseSA6KAogICAgICAgICAgICBpZigkQ3JlZGVudGlhbCkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiTWFwcGluZyAnJCgkXy5ncGNmaWxlc3lzcGF0aCknIHRvIG5ldHdvcmsgZHJpdmUgTjpcIgogICAgICAgICAgICAgICAgJFBhdGggPSAkXy5ncGNmaWxlc3lzcGF0aC5UcmltRW5kKCdcJykKICAgICAgICAgICAgICAgICROZXQgPSBOZXctT2JqZWN0IC1Db21PYmplY3QgV1NjcmlwdC5OZXR3b3JrCiAgICAgICAgICAgICAgICAkTmV0Lk1hcE5ldHdvcmtEcml2ZSgiTjoiLCAkUGF0aCwgJEZhbHNlLCAkQ3JlZGVudGlhbC5Vc2VyTmFtZSwgJENyZWRlbnRpYWwuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5QYXNzd29yZCkKICAgICAgICAgICAgICAgICRUYXNrUGF0aCA9ICJOOlxNYWNoaW5lXFByZWZlcmVuY2VzXFNjaGVkdWxlZFRhc2tzXCIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRUYXNrUGF0aCA9ICRfLmdwY2ZpbGVzeXNwYXRoICsgIlxNYWNoaW5lXFByZWZlcmVuY2VzXFNjaGVkdWxlZFRhc2tzXCIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoJFJlbW92ZSkgewogICAgICAgICAgICAgICAgaWYoIShUZXN0LVBhdGggIiRUYXNrUGF0aFxTY2hlZHVsZWRUYXNrcy54bWwiKSkgewogICAgICAgICAgICAgICAgICAgIFRocm93ICJTY2hlZHVsZWQgdGFzayBkb2Vzbid0IGV4aXN0IGF0ICRUYXNrUGF0aFxTY2hlZHVsZWRUYXNrcy54bWwiCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCEkRm9yY2UgLWFuZCAhJHBzQ21kbGV0LlNob3VsZENvbnRpbnVlKCdEbyB5b3Ugd2FudCB0byBjb250aW51ZT8nLCJSZW1vdmluZyBzY2h0YXNrIGF0ICRUYXNrUGF0aFxTY2hlZHVsZWRUYXNrcy54bWwiKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIFJlbW92ZS1JdGVtIC1QYXRoICIkVGFza1BhdGhcU2NoZWR1bGVkVGFza3MueG1sIiAtRm9yY2UKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICghJEZvcmNlIC1hbmQgISRwc0NtZGxldC5TaG91bGRDb250aW51ZSgnRG8geW91IHdhbnQgdG8gY29udGludWU/JywiQ3JlYXRpbmcgc2NodGFzayBhdCAkVGFza1BhdGhcU2NoZWR1bGVkVGFza3MueG1sIikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIGNyZWF0ZSB0aGUgZm9sZGVyIGlmIGl0IGRvZXNuJ3QgZXhpc3QKICAgICAgICAgICAgICAgICROdWxsID0gTmV3LUl0ZW0gLUl0ZW1UeXBlIERpcmVjdG9yeSAtRm9yY2UgLVBhdGggJFRhc2tQYXRoCgogICAgICAgICAgICAgICAgaWYoVGVzdC1QYXRoICIkVGFza1BhdGhcU2NoZWR1bGVkVGFza3MueG1sIikgewogICAgICAgICAgICAgICAgICAgIFRocm93ICJTY2hlZHVsZWQgdGFzayBhbHJlYWR5IGV4aXN0cyBhdCAkVGFza1BhdGhcU2NoZWR1bGVkVGFza3MueG1sICEiCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJFRhc2tYTUwgfCBTZXQtQ29udGVudCAtRW5jb2RpbmcgQVNDSUkgLVBhdGggIiRUYXNrUGF0aFxTY2hlZHVsZWRUYXNrcy54bWwiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCRDcmVkZW50aWFsKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJSZW1vdmluZyBtb3VudGVkIGRyaXZlIGF0IE46XCIKICAgICAgICAgICAgICAgICROZXQgPSBOZXctT2JqZWN0IC1Db21PYmplY3QgV1NjcmlwdC5OZXR3b3JrCiAgICAgICAgICAgICAgICAkTmV0LlJlbW92ZU5ldHdvcmtEcml2ZSgiTjoiKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiRXJyb3IgZm9yIEdQTyAkUHJvY2Vzc2VkR1BPTmFtZSA6ICRfIgogICAgICAgICAgICBpZigkQ3JlZGVudGlhbCkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiUmVtb3ZpbmcgbW91bnRlZCBkcml2ZSBhdCBOOlwiCiAgICAgICAgICAgICAgICAkTmV0ID0gTmV3LU9iamVjdCAtQ29tT2JqZWN0IFdTY3JpcHQuTmV0d29yawogICAgICAgICAgICAgICAgJE5ldC5SZW1vdmVOZXR3b3JrRHJpdmUoIk46IikKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1OZXRHUE9Hcm91cCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUmV0dXJucyBhbGwgR1BPcyBpbiBhIGRvbWFpbiB0aGF0IHNldCAiUmVzdHJpY3RlZCBHcm91cHMiIG9yIHVzZSBncm91cHMueG1sIG9uIG9uIHRhcmdldCBtYWNoaW5lcy4KCiAgICAgICAgQXV0aG9yOiBAaGFybWoweQogICAgICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgICAgIFJlcXVpcmVkIERlcGVuZGVuY2llczogR2V0LU5ldEdQTywgR2V0LUdwdFRtcGwsIEdldC1Hcm91cHNYTUwsIENvbnZlcnQtTmFtZVRvU2lkLCBDb252ZXJ0LVNpZFRvTmFtZQogICAgICAgIE9wdGlvbmFsIERlcGVuZGVuY2llczogTm9uZQoKICAgIC5ERVNDUklQVElPTgoKICAgICAgICBGaXJzdCBlbnVtZXJhdGVzIGFsbCBHUE9zIGluIHRoZSBjdXJyZW50L3RhcmdldCBkb21haW4gdXNpbmcgR2V0LU5ldEdQTyB3aXRoIHBhc3NlZAogICAgICAgIGFyZ3VtZW50cywgYW5kIGZvciBlYWNoIEdQTyBjaGVja3MgaWYgJ1Jlc3RyaWN0ZWQgR3JvdXBzJyBhcmUgc2V0IHdpdGggR3B0VG1wbC5pbmYgb3IKICAgICAgICBncm91cCBtZW1iZXJzaGlwIGlzIHNldCB0aHJvdWdoIEdyb3VwIFBvbGljeSBQcmVmZXJlbmNlcyBncm91cHMueG1sIGZpbGVzLiBGb3IgYW55CiAgICAgICAgR3B0VG1wbC5pbmYgZmlsZXMgZm91bmQsIHRoZSBmaWxlIGlzIHBhcnNlZCB3aXRoIEdldC1HcHRUbXBsIGFuZCBhbnkgJ0dyb3VwIE1lbWJlcnNoaXAnCiAgICAgICAgc2VjdGlvbiBkYXRhIGlzIHByb2Nlc3NlZCBpZiBwcmVzZW50LiBBbnkgZm91bmQgR3JvdXBzLnhtbCBmaWxlcyBhcmUgcGFyc2VkIHdpdGgKICAgICAgICBHZXQtR3JvdXBzWE1MIGFuZCB0aG9zZSBtZW1iZXJzaGlwcyBhcmUgcmV0dXJuZWQgYXMgd2VsbC4KCiAgICAuUEFSQU1FVEVSIEdQT25hbWUKCiAgICAgICAgVGhlIEdQTyBuYW1lIHRvIHF1ZXJ5IGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgRGlzcGxheU5hbWUKCiAgICAgICAgVGhlIEdQTyBkaXNwbGF5IG5hbWUgdG8gcXVlcnkgZm9yLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgVGhlIGRvbWFpbiB0byBxdWVyeSBmb3IgR1BPcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIEdQT3MuCiAgICAgICAgZS5nLiAiTERBUDovL2NuPXs4RkY1OUQyOC0xNUQ3LTQyMkEtQkNCNy0yQUU0NTcyNDEyNUF9LGNuPXBvbGljaWVzLGNuPXN5c3RlbSxEQz1kZXYsREM9dGVzdGxhYixEQz1sb2NhbCIKCiAgICAuUEFSQU1FVEVSIFJlc29sdmVNZW1iZXJTSURzCgogICAgICAgIFN3aXRjaC4gVHJ5IHRvIHJlc29sdmUgdGhlIFNJRHMgb2YgYWxsIGZvdW5kIGdyb3VwIG1lbWJlcnMuCgogICAgLlBBUkFNRVRFUiBVc2VQU0RyaXZlCgogICAgICAgIFN3aXRjaC4gTW91bnQgYW55IGZvdW5kIHBvbGljeSBmaWxlcyB3aXRoIHRlbXBvcmFyeSBQU0RyaXZlcy4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRHUE9Hcm91cAoKICAgICAgICBSZXR1cm5zIGFsbCBsb2NhbCBncm91cHMgc2V0IGJ5IEdQTyBhbG9uZyB3aXRoIHRoZWlyIG1lbWJlcnMgYW5kIG1lbWJlcm9mLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHBzOi8vbW9yZ2Fuc2ltb25zZW5ibG9nLmF6dXJld2Vic2l0ZXMubmV0L3RhZy9ncm91cHMvCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbU3RyaW5nXQogICAgICAgICRHUE9uYW1lID0gJyonLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREaXNwbGF5TmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBRFNwYXRoLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRSZXNvbHZlTWVtYmVyU0lEcywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVXNlUFNEcml2ZSwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAKICAgICkKCiAgICAkT3B0aW9uID0gW1N5c3RlbS5TdHJpbmdTcGxpdE9wdGlvbnNdOjpSZW1vdmVFbXB0eUVudHJpZXMKCiAgICAjIGdldCBldmVyeSBHUE8gZnJvbSB0aGUgc3BlY2lmaWVkIGRvbWFpbiB3aXRoIHJlc3RyaWN0ZWQgZ3JvdXBzIHNldAogICAgR2V0LU5ldEdQTyAtR1BPTmFtZSAkR1BPbmFtZSAtRGlzcGxheU5hbWUgJEdQT25hbWUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1BRFNwYXRoICRBRFNwYXRoIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICRHUE9kaXNwbGF5TmFtZSA9ICRfLmRpc3BsYXluYW1lCiAgICAgICAgJEdQT25hbWUgPSAkXy5uYW1lCiAgICAgICAgJEdQT1BhdGggPSAkXy5ncGNmaWxlc3lzcGF0aAoKICAgICAgICAkUGFyc2VBcmdzID0gIEB7CiAgICAgICAgICAgICdHcHRUbXBsUGF0aCcgPSAiJEdQT1BhdGhcTUFDSElORVxNaWNyb3NvZnRcV2luZG93cyBOVFxTZWNFZGl0XEdwdFRtcGwuaW5mIgogICAgICAgICAgICAnVXNlUFNEcml2ZScgPSAkVXNlUFNEcml2ZQogICAgICAgIH0KCiAgICAgICAgIyBwYXJzZSB0aGUgR3B0VG1wbC5pbmYgJ1Jlc3RyaWN0ZWQgR3JvdXBzJyBmaWxlIGlmIGl0IGV4aXN0cwogICAgICAgICRJbmYgPSBHZXQtR3B0VG1wbCBAUGFyc2VBcmdzCgogICAgICAgIGlmKCRJbmYgLWFuZCAoJEluZi5wc2Jhc2UuS2V5cyAtY29udGFpbnMgJ0dyb3VwIE1lbWJlcnNoaXAnKSkgewoKICAgICAgICAgICAgJE1lbWJlcnNoaXBzID0gQHt9CgogICAgICAgICAgICAjIGdyb3VwIHRoZSBtZW1iZXJzL21lbWJlcm9mIGZpZWxkcyBmb3IgZWFjaCBlbnRyeQogICAgICAgICAgICBGb3JFYWNoICgkTWVtYmVyc2hpcCBpbiAkSW5mLidHcm91cCBNZW1iZXJzaGlwJy5HZXRFbnVtZXJhdG9yKCkpIHsKICAgICAgICAgICAgICAgICRHcm91cCwgJFJlbGF0aW9uID0gJE1lbWJlcnNoaXAuS2V5LlNwbGl0KCdfXycsICRPcHRpb24pIHwgRm9yRWFjaC1PYmplY3QgeyRfLlRyaW0oKX0KCiAgICAgICAgICAgICAgICAjIGV4dHJhY3Qgb3V0IEFMTCBtZW1iZXJzCiAgICAgICAgICAgICAgICAkTWVtYmVyc2hpcFZhbHVlID0gJE1lbWJlcnNoaXAuVmFsdWUgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsgJF8uVHJpbSgnKicpIH0gfCBXaGVyZS1PYmplY3QgeyRffQoKICAgICAgICAgICAgICAgIGlmKCRSZXNvbHZlTWVtYmVyU0lEcykgewogICAgICAgICAgICAgICAgICAgICMgaWYgdGhlIHJlc3VsdGluZyBtZW1iZXIgaXMgdXNlcm5hbWUgYW5kIG5vdCBhIFNJRCwgYXR0ZW1wdCB0byByZXNvbHZlIGl0CiAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVycyA9IEAoKQogICAgICAgICAgICAgICAgICAgIEZvckVhY2goJE1lbWJlciBpbiAkTWVtYmVyc2hpcFZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRNZW1iZXIgLWFuZCAoJE1lbWJlci5UcmltKCkgLW5lICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJE1lbWJlciAtbm90bWF0Y2ggJ15TLTEtLionKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlclNJRCA9IENvbnZlcnQtTmFtZVRvU2lkIC1Eb21haW4gJERvbWFpbiAtT2JqZWN0TmFtZSAkTWVtYmVyIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgU0lECiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJE1lbWJlclNJRCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXJzICs9ICRNZW1iZXJTSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlcnMgKz0gJE1lbWJlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlcnMgKz0gJE1lbWJlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRNZW1iZXJzaGlwVmFsdWUgPSAkR3JvdXBNZW1iZXJzCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoLW5vdCAkTWVtYmVyc2hpcHNbJEdyb3VwXSkgewogICAgICAgICAgICAgICAgICAgICRNZW1iZXJzaGlwc1skR3JvdXBdID0gQHt9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZigkTWVtYmVyc2hpcFZhbHVlIC1pc25vdCBbU3lzdGVtLkFycmF5XSkgeyRNZW1iZXJzaGlwVmFsdWUgPSBAKCRNZW1iZXJzaGlwVmFsdWUpfQogICAgICAgICAgICAgICAgJE1lbWJlcnNoaXBzWyRHcm91cF0uQWRkKCRSZWxhdGlvbiwgJE1lbWJlcnNoaXBWYWx1ZSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgRm9yRWFjaCAoJE1lbWJlcnNoaXAgaW4gJE1lbWJlcnNoaXBzLkdldEVudW1lcmF0b3IoKSkgewogICAgICAgICAgICAgICAgaWYoJE1lbWJlcnNoaXAgLWFuZCAkTWVtYmVyc2hpcC5LZXkgLWFuZCAoJE1lbWJlcnNoaXAuS2V5IC1tYXRjaCAnXlwqJykpIHsKICAgICAgICAgICAgICAgICAgICAjIGlmIHRoZSBTSUQgaXMgYWxyZWFkeSByZXNvbHZlZCAoaS5lLiBiZWdpbnMgd2l0aCAqKSB0cnkgdG8gcmVzb2x2ZSBTSUQgdG8gYSBuYW1lCiAgICAgICAgICAgICAgICAgICAgJEdyb3VwU0lEID0gJE1lbWJlcnNoaXAuS2V5LlRyaW0oJyonKQogICAgICAgICAgICAgICAgICAgIGlmKCRHcm91cFNJRCAtYW5kICgkR3JvdXBTSUQuVHJpbSgpIC1uZSAnJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwTmFtZSA9IENvbnZlcnQtU2lkVG9OYW1lIC1TSUQgJEdyb3VwU0lECiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBOYW1lID0gJEZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJEdyb3VwTmFtZSA9ICRNZW1iZXJzaGlwLktleQoKICAgICAgICAgICAgICAgICAgICBpZigkR3JvdXBOYW1lIC1hbmQgKCRHcm91cE5hbWUuVHJpbSgpIC1uZSAnJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJEdyb3VwbmFtZSAtbWF0Y2ggJ0FkbWluaXN0cmF0b3JzJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwU0lEID0gJ1MtMS01LTMyLTU0NCcKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYoJEdyb3VwbmFtZSAtbWF0Y2ggJ1JlbW90ZSBEZXNrdG9wJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwU0lEID0gJ1MtMS01LTMyLTU1NScKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYoJEdyb3VwbmFtZSAtbWF0Y2ggJ0d1ZXN0cycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cFNJRCA9ICdTLTEtNS0zMi01NDYnCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmKCRHcm91cE5hbWUuVHJpbSgpIC1uZSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwU0lEID0gQ29udmVydC1OYW1lVG9TaWQgLURvbWFpbiAkRG9tYWluIC1PYmplY3ROYW1lICRHcm91cG5hbWUgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBTSUQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cFNJRCA9ICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJEdQT0dyb3VwID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgJEdQT0dyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0Rpc3BsYXlOYW1lJyAkR1BPRGlzcGxheU5hbWUKICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9OYW1lJyAkR1BPTmFtZQogICAgICAgICAgICAgICAgJEdQT0dyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT1BhdGgnICRHUE9QYXRoCiAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPVHlwZScgJ1Jlc3RyaWN0ZWRHcm91cHMnCiAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRmlsdGVycycgJE51bGwKICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cE5hbWUnICRHcm91cE5hbWUKICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cFNJRCcgJEdyb3VwU0lECiAgICAgICAgICAgICAgICAkR1BPR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXBNZW1iZXJPZicgJE1lbWJlcnNoaXAuVmFsdWUuTWVtYmVyb2YKICAgICAgICAgICAgICAgICRHUE9Hcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cE1lbWJlcnMnICRNZW1iZXJzaGlwLlZhbHVlLk1lbWJlcnMKICAgICAgICAgICAgICAgICRHUE9Hcm91cAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkUGFyc2VBcmdzID0gIEB7CiAgICAgICAgICAgICdHcm91cHNYTUxwYXRoJyA9ICIkR1BPUGF0aFxNQUNISU5FXFByZWZlcmVuY2VzXEdyb3Vwc1xHcm91cHMueG1sIgogICAgICAgICAgICAnVXNlUFNEcml2ZScgPSAkVXNlUFNEcml2ZQogICAgICAgIH0KCiAgICAgICAgR2V0LUdyb3Vwc1hNTCBAUGFyc2VBcmdzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICBpZigkUmVzb2x2ZU1lbWJlclNJRHMpIHsKICAgICAgICAgICAgICAgICRHcm91cE1lbWJlcnMgPSBAKCkKICAgICAgICAgICAgICAgIEZvckVhY2goJE1lbWJlciBpbiAkXy5Hcm91cE1lbWJlcnMpIHsKICAgICAgICAgICAgICAgICAgICBpZigkTWVtYmVyIC1hbmQgKCRNZW1iZXIuVHJpbSgpIC1uZSAnJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJE1lbWJlciAtbm90bWF0Y2ggJ15TLTEtLionKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHRoZSByZXN1bHRpbmcgbWVtYmVyIGlzIHVzZXJuYW1lIGFuZCBub3QgYSBTSUQsIGF0dGVtcHQgdG8gcmVzb2x2ZSBpdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlclNJRCA9IENvbnZlcnQtTmFtZVRvU2lkIC1Eb21haW4gJERvbWFpbiAtT2JqZWN0TmFtZSAkTWVtYmVyIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgU0lECiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkTWVtYmVyU0lEKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwTWVtYmVycyArPSAkTWVtYmVyU0lECiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBNZW1iZXJzICs9ICRNZW1iZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cE1lbWJlcnMgKz0gJE1lbWJlcgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJF8uR3JvdXBNZW1iZXJzID0gJEdyb3VwTWVtYmVycwogICAgICAgICAgICB9CgogICAgICAgICAgICAkXyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9EaXNwbGF5TmFtZScgJEdQT0Rpc3BsYXlOYW1lCiAgICAgICAgICAgICRfIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT05hbWUnICRHUE9OYW1lCiAgICAgICAgICAgICRfIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT1R5cGUnICdHcm91cFBvbGljeVByZWZlcmVuY2VzJwogICAgICAgICAgICAkXwogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEZpbmQtR1BPTG9jYXRpb24gewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIEVudW1lcmF0ZXMgdGhlIG1hY2hpbmVzIHdoZXJlIGEgc3BlY2lmaWMgdXNlci9ncm91cCBpcyBhIG1lbWJlciBvZiBhIHNwZWNpZmljCiAgICAgICAgbG9jYWwgZ3JvdXAsIGFsbCB0aHJvdWdoIEdQTyBjb3JyZWxhdGlvbi4KCiAgICAgICAgQXV0aG9yOiBAaGFybWoweQogICAgICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgICAgIFJlcXVpcmVkIERlcGVuZGVuY2llczogR2V0LU5ldFVzZXIsIEdldC1OZXRHcm91cCwgR2V0LU5ldEdQT0dyb3VwLCBHZXQtTmV0T1UsIEdldC1OZXRDb21wdXRlciwgR2V0LUFET2JqZWN0LCBHZXQtTmV0U2l0ZQogICAgICAgIE9wdGlvbmFsIERlcGVuZGVuY2llczogTm9uZQoKICAgIC5ERVNDUklQVElPTgoKICAgICAgICBUYWtlcyBhIHVzZXIvZ3JvdXAgbmFtZSBhbmQgb3B0aW9uYWwgZG9tYWluLCBhbmQgZGV0ZXJtaW5lcyB0aGUgY29tcHV0ZXJzIGluIHRoZSBkb21haW4KICAgICAgICB0aGUgdXNlci9ncm91cCBoYXMgbG9jYWwgYWRtaW4gKG9yIFJEUCkgcmlnaHRzIHRvLgoKICAgICAgICBJdCBkb2VzIHRoaXMgYnk6CiAgICAgICAgICAgIDEuICByZXNvbHZpbmcgdGhlIHVzZXIvZ3JvdXAgdG8gaXRzIHByb3BlciBTSUQKICAgICAgICAgICAgMi4gIGVudW1lcmF0aW5nIGFsbCBncm91cHMgdGhlIHVzZXIvZ3JvdXAgaXMgYSBjdXJyZW50IHBhcnQgb2YKICAgICAgICAgICAgICAgIGFuZCBleHRyYWN0aW5nIGFsbCB0YXJnZXQgU0lEcyB0byBidWlsZCBhIHRhcmdldCBTSUQgbGlzdAogICAgICAgICAgICAzLiAgcHVsbGluZyBhbGwgR1BPcyB0aGF0IHNldCAnUmVzdHJpY3RlZCBHcm91cHMnIG9yIEdyb3Vwcy54bWwgYnkgY2FsbGluZwogICAgICAgICAgICAgICAgR2V0LU5ldEdQT0dyb3VwCiAgICAgICAgICAgIDQuICBtYXRjaGluZyB0aGUgdGFyZ2V0IFNJRCBsaXN0IHRvIHRoZSBxdWVyaWVkIEdQTyBTSUQgbGlzdAogICAgICAgICAgICAgICAgdG8gZW51bWVyYXRlIGFsbCBHUE8gdGhlIHVzZXIgaXMgZWZmZWN0aXZlbHkgYXBwbGllZCB3aXRoCiAgICAgICAgICAgIDUuICBlbnVtZXJhdGluZyBhbGwgT1VzIGFuZCBzaXRlcyBhbmQgYXBwbGljYWJsZSBHUE8gR1VJcyBhcmUKICAgICAgICAgICAgICAgIGFwcGxpZWQgdG8gdGhyb3VnaCBncGxpbmsgZW51bWVyYXRpbmcKICAgICAgICAgICAgNi4gIHF1ZXJ5aW5nIGZvciBhbGwgY29tcHV0ZXJzIHVuZGVyIHRoZSBnaXZlbiBPVXMgb3Igc2l0ZXMKCiAgICAgICAgSWYgbm8gdXNlci9ncm91cCBpcyBzcGVjaWZpZWQsIGFsbCB1c2VyL2dyb3VwIC0+IG1hY2hpbmUgbWFwcGluZ3MgZGlzY292ZXJlZCB0aHJvdWdoCiAgICAgICAgR1BPIHJlbGF0aW9uc2hpcHMgYXJlIHJldHVybmVkLgoKICAgIC5QQVJBTUVURVIgVXNlck5hbWUKCiAgICAgICAgQSAoc2luZ2xlKSB1c2VyIG5hbWUgbmFtZSB0byBxdWVyeSBmb3IgYWNjZXNzLgoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIEEgKHNpbmdsZSkgZ3JvdXAgbmFtZSBuYW1lIHRvIHF1ZXJ5IGZvciBhY2Nlc3MuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgT3B0aW9uYWwgZG9tYWluIHRoZSB1c2VyIGV4aXN0cyBpbiBmb3IgcXVlcnlpbmcsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIExvY2FsR3JvdXAKCiAgICAgICAgVGhlIGxvY2FsIGdyb3VwIHRvIGNoZWNrIGFjY2VzcyBhZ2FpbnN0LgogICAgICAgIENhbiBiZSAiQWRtaW5pc3RyYXRvcnMiIChTLTEtNS0zMi01NDQpLCAiUkRQL1JlbW90ZSBEZXNrdG9wIFVzZXJzIiAoUy0xLTUtMzItNTU1KSwKICAgICAgICBvciBhIGN1c3RvbSBsb2NhbCBTSUQuIERlZmF1bHRzIHRvIGxvY2FsICdBZG1pbmlzdHJhdG9ycycuCgogICAgLlBBUkFNRVRFUiBVc2VQU0RyaXZlCgogICAgICAgIFN3aXRjaC4gTW91bnQgYW55IGZvdW5kIHBvbGljeSBmaWxlcyB3aXRoIHRlbXBvcmFyeSBQU0RyaXZlcy4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtR1BPTG9jYXRpb24KCiAgICAgICAgRmluZCBhbGwgdXNlci9ncm91cCAtPiBtYWNoaW5lIHJlbGF0aW9uc2hpcHMgd2hlcmUgdGhlIHVzZXIvZ3JvdXAgaXMgYSBtZW1iZXIKICAgICAgICBvZiB0aGUgbG9jYWwgYWRtaW5pc3RyYXRvcnMgZ3JvdXAgb24gdGFyZ2V0IG1hY2hpbmVzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gRmluZC1HUE9Mb2NhdGlvbiAtVXNlck5hbWUgZGZtCgogICAgICAgIEZpbmQgYWxsIGNvbXB1dGVycyB0aGF0IGRmbSB1c2VyIGhhcyBsb2NhbCBhZG1pbmlzdHJhdG9yIHJpZ2h0cyB0byBpbgogICAgICAgIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtR1BPTG9jYXRpb24gLVVzZXJOYW1lIGRmbSAtRG9tYWluIGRldi50ZXN0bGFiLmxvY2FsCgogICAgICAgIEZpbmQgYWxsIGNvbXB1dGVycyB0aGF0IGRmbSB1c2VyIGhhcyBsb2NhbCBhZG1pbmlzdHJhdG9yIHJpZ2h0cyB0byBpbgogICAgICAgIHRoZSBkZXYudGVzdGxhYi5sb2NhbCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUdQT0xvY2F0aW9uIC1Vc2VyTmFtZSBqYXNvbiAtTG9jYWxHcm91cCBSRFAKCiAgICAgICAgRmluZCBhbGwgY29tcHV0ZXJzIHRoYXQgamFzb24gaGFzIGxvY2FsIFJEUCBhY2Nlc3MgcmlnaHRzIHRvIGluIHRoZSBkb21haW4uCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJExvY2FsR3JvdXAgPSAnQWRtaW5pc3RyYXRvcnMnLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRVc2VQU0RyaXZlLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0KICAgICAgICBbSW50XQogICAgICAgICRQYWdlU2l6ZSA9IDIwMAogICAgKQoKICAgIGlmKCRVc2VyTmFtZSkgewogICAgICAgICMgaWYgYSBncm91cCBuYW1lIGlzIHNwZWNpZmllZCwgZ2V0IHRoYXQgdXNlciBvYmplY3Qgc28gd2UgY2FuIGV4dHJhY3QgdGhlIHRhcmdldCBTSUQKICAgICAgICAkVXNlciA9IEdldC1OZXRVc2VyIC1Vc2VyTmFtZSAkVXNlck5hbWUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxCiAgICAgICAgJFVzZXJTaWQgPSAkVXNlci5vYmplY3RzaWQKCiAgICAgICAgaWYoLW5vdCAkVXNlclNpZCkgewogICAgICAgICAgICBUaHJvdyAiVXNlciAnJFVzZXJOYW1lJyBub3QgZm91bmQhIgogICAgICAgIH0KCiAgICAgICAgJFRhcmdldFNJRHMgPSBAKCRVc2VyU2lkKQogICAgICAgICRPYmplY3RTYW1BY2NvdW50TmFtZSA9ICRVc2VyLnNhbWFjY291bnRuYW1lCiAgICAgICAgJFRhcmdldE9iamVjdCA9ICRVc2VyU2lkCiAgICB9CiAgICBlbHNlaWYoJEdyb3VwTmFtZSkgewogICAgICAgICMgaWYgYSBncm91cCBuYW1lIGlzIHNwZWNpZmllZCwgZ2V0IHRoYXQgZ3JvdXAgb2JqZWN0IHNvIHdlIGNhbiBleHRyYWN0IHRoZSB0YXJnZXQgU0lECiAgICAgICAgJEdyb3VwID0gR2V0LU5ldEdyb3VwIC1Hcm91cE5hbWUgJEdyb3VwTmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxCiAgICAgICAgJEdyb3VwU2lkID0gJEdyb3VwLm9iamVjdHNpZAoKICAgICAgICBpZigtbm90ICRHcm91cFNpZCkgewogICAgICAgICAgICBUaHJvdyAiR3JvdXAgJyRHcm91cE5hbWUnIG5vdCBmb3VuZCEiCiAgICAgICAgfQoKICAgICAgICAkVGFyZ2V0U0lEcyA9IEAoJEdyb3VwU2lkKQogICAgICAgICRPYmplY3RTYW1BY2NvdW50TmFtZSA9ICRHcm91cC5zYW1hY2NvdW50bmFtZQogICAgICAgICRUYXJnZXRPYmplY3QgPSAkR3JvdXBTaWQKICAgIH0KICAgIGVsc2UgewogICAgICAgICRUYXJnZXRTSURzID0gQCgnKicpCiAgICB9CgogICAgIyBmaWd1cmUgb3V0IHdoYXQgdGhlIFNJRCBpcyBvZiB0aGUgdGFyZ2V0IGxvY2FsIGdyb3VwIHdlJ3JlIGNoZWNraW5nIGZvciBtZW1iZXJzaGlwIGluCiAgICBpZigkTG9jYWxHcm91cCAtbGlrZSAiKkFkbWluKiIpIHsKICAgICAgICAkVGFyZ2V0TG9jYWxTSUQgPSAnUy0xLTUtMzItNTQ0JwogICAgfQogICAgZWxzZWlmICggKCRMb2NhbEdyb3VwIC1saWtlICIqUkRQKiIpIC1vciAoJExvY2FsR3JvdXAgLWxpa2UgIipSZW1vdGUqIikgKSB7CiAgICAgICAgJFRhcmdldExvY2FsU0lEID0gJ1MtMS01LTMyLTU1NScKICAgIH0KICAgIGVsc2VpZiAoJExvY2FsR3JvdXAgLWxpa2UgIlMtMS01LSoiKSB7CiAgICAgICAgJFRhcmdldExvY2FsU0lEID0gJExvY2FsR3JvdXAKICAgIH0KICAgIGVsc2UgewogICAgICAgIHRocm93ICJMb2NhbEdyb3VwIG11c3QgYmUgJ0FkbWluaXN0cmF0b3JzJywgJ1JEUCcsIG9yIGEgJ1MtMS01LVgnIFNJRCBmb3JtYXQuIgogICAgfQoKICAgICMgaWYgd2UncmUgbm90IGxpc3RpbmcgYWxsIHJlbGF0aW9uc2hpcHMsIHVzZSB0aGUgdG9rZW5Hcm91cHMgYXBwcm9hY2ggZnJvbSBHZXQtTmV0R3JvdXAgdG8KICAgICMgZ2V0IGFsbCBlZmZlY3RpdmUgc2VjdXJpdHkgU0lEcyB0aGlzIG9iamVjdCBpcyBhIHBhcnQgb2YKICAgIGlmKCRUYXJnZXRTSURzWzBdIC1hbmQgKCRUYXJnZXRTSURzWzBdIC1uZSAnKicpKSB7CiAgICAgICAgJFRhcmdldFNJRHMgKz0gR2V0LU5ldEdyb3VwIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIC1Vc2VyTmFtZSAkT2JqZWN0U2FtQWNjb3VudE5hbWUgLVJhd1NpZHMKICAgIH0KCiAgICBpZigtbm90ICRUYXJnZXRTSURzKSB7CiAgICAgICAgdGhyb3cgIk5vIGVmZmVjdGl2ZSB0YXJnZXQgU0lEcyEiCiAgICB9CgogICAgV3JpdGUtVmVyYm9zZSAiVGFyZ2V0TG9jYWxTSUQ6ICRUYXJnZXRMb2NhbFNJRCIKICAgIFdyaXRlLVZlcmJvc2UgIkVmZmVjdGl2ZSB0YXJnZXQgU0lEczogJFRhcmdldFNJRHMiCgogICAgJEdQT0dyb3VwQXJncyA9ICBAewogICAgICAgICdEb21haW4nID0gJERvbWFpbgogICAgICAgICdEb21haW5Db250cm9sbGVyJyA9ICREb21haW5Db250cm9sbGVyCiAgICAgICAgJ1VzZVBTRHJpdmUnID0gJFVzZVBTRHJpdmUKICAgICAgICAnUmVzb2x2ZU1lbWJlclNJRHMnID0gJFRydWUKICAgICAgICAnUGFnZVNpemUnID0gJFBhZ2VTaXplCiAgICB9CgogICAgIyBlbnVtZXJhdGUgYWxsIEdQTyBncm91cCBtYXBwaW5ncyBmb3IgdGhlIHRhcmdldCBkb21haW4gdGhhdCBpbnZvbHZlIG91ciB0YXJnZXQgU0lEIHNldAogICAgJEdQT2dyb3VwcyA9IEdldC1OZXRHUE9Hcm91cCBAR1BPR3JvdXBBcmdzIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAkR1BPZ3JvdXAgPSAkXwoKICAgICAgICAjIGlmIHRoZSBsb2NhbGx5IHNldCBncm91cCBpcyB3aGF0IHdlJ3JlIGxvb2tpbmcgZm9yLCBjaGVjayB0aGUgR3JvdXBNZW1iZXJzICgnbWVtYmVycycpCiAgICAgICAgIyAgICBmb3Igb3VyIHRhcmdldCBTSUQKICAgICAgICBpZigkR1BPZ3JvdXAuR3JvdXBTSUQgLW1hdGNoICRUYXJnZXRMb2NhbFNJRCkgewogICAgICAgICAgICAkR1BPZ3JvdXAuR3JvdXBNZW1iZXJzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICBpZiAoICgkVGFyZ2V0U0lEc1swXSAtZXEgJyonKSAtb3IgKCRUYXJnZXRTSURzIC1Db250YWlucyAkXykgKSB7CiAgICAgICAgICAgICAgICAgICAgJEdQT2dyb3VwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgIyBpZiB0aGUgZ3JvdXAgaXMgYSAnbWVtYmVyb2YnIHRoZSBncm91cCB3ZSdyZSBsb29raW5nIGZvciwgY2hlY2sgR3JvdXBTSUQgYWdhaW5zdCB0aGUgdGFyZ3QgU0lEcwogICAgICAgIGlmKCAoJEdQT2dyb3VwLkdyb3VwTWVtYmVyT2YgLWNvbnRhaW5zICRUYXJnZXRMb2NhbFNJRCkgKSB7CiAgICAgICAgICAgIGlmKCAoJFRhcmdldFNJRHNbMF0gLWVxICcqJykgLW9yICgkVGFyZ2V0U0lEcyAtQ29udGFpbnMgJEdQT2dyb3VwLkdyb3VwU0lEKSApIHsKICAgICAgICAgICAgICAgICRHUE9ncm91cAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB8IFNvcnQtT2JqZWN0IC1Qcm9wZXJ0eSBHUE9OYW1lIC1VbmlxdWUKCiAgICAkR1BPZ3JvdXBzIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAkR1BPbmFtZSA9ICRfLkdQT0Rpc3BsYXlOYW1lCiAgICAgICAgJEdQT2d1aWQgPSAkXy5HUE9OYW1lCiAgICAgICAgJEdQT1BhdGggPSAkXy5HUE9QYXRoCiAgICAgICAgJEdQT1R5cGUgPSAkXy5HUE9UeXBlCiAgICAgICAgaWYoJF8uR3JvdXBNZW1iZXJzKSB7CiAgICAgICAgICAgICRHUE9NZW1iZXJzID0gJF8uR3JvdXBNZW1iZXJzCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkR1BPTWVtYmVycyA9ICRfLkdyb3VwU0lECiAgICAgICAgfQoKICAgICAgICAkRmlsdGVycyA9ICRfLkZpbHRlcnMKCiAgICAgICAgaWYoLW5vdCAkVGFyZ2V0T2JqZWN0KSB7CiAgICAgICAgICAgICMgaWYgdGhlICogd2lsZGNhcmQgd2FzIHVzZWQsIHNldCB0aGUgT2JqZWN0RGlzdE5hbWUgYXMgdGhlIEdQTyBtZW1iZXIgU0lEIHNldAogICAgICAgICAgICAjICAgc28gYWxsIHJlbGF0aW9uc2hpcCBtYXBwaW5ncyBhcmUgb3V0cHV0CiAgICAgICAgICAgICRUYXJnZXRPYmplY3RTSURzID0gJEdQT01lbWJlcnMKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRUYXJnZXRPYmplY3RTSURzID0gJFRhcmdldE9iamVjdAogICAgICAgIH0KCiAgICAgICAgIyBmaW5kIGFueSBPVXMgdGhhdCBoYXZlIHRoaXMgR1VJRCBhcHBsaWVkIGFuZCB0aGVuIHJldHJpZXZlIGFueSBjb21wdXRlcnMgZnJvbSB0aGUgT1UKICAgICAgICBHZXQtTmV0T1UgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1HVUlEICRHUE9ndWlkIC1GdWxsRGF0YSAtUGFnZVNpemUgJFBhZ2VTaXplIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICBpZigkRmlsdGVycykgewogICAgICAgICAgICAgICAgIyBmaWx0ZXIgZm9yIGNvbXB1dGVyIG5hbWUvb3JnIHVuaXQgaWYgYSBmaWx0ZXIgaXMgc3BlY2lmaWVkCiAgICAgICAgICAgICAgICAjICAgVE9ETzogaGFuZGxlIG90aGVyIGZpbHRlcnMgKGkuZS4gT1UgZmlsdGVycz8pIGFnYWluLCBJIGhhdGUgeW91IEdQUC4uLgogICAgICAgICAgICAgICAgJE9VQ29tcHV0ZXJzID0gR2V0LU5ldENvbXB1dGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtQURTcGF0aCAkXy5BRFNwYXRoIC1GdWxsRGF0YSAtUGFnZVNpemUgJFBhZ2VTaXplIHwgV2hlcmUtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAkXy5hZHNwYXRoIC1tYXRjaCAoJEZpbHRlcnMuVmFsdWUpCiAgICAgICAgICAgICAgICB9IHwgRm9yRWFjaC1PYmplY3QgeyAkXy5kbnNob3N0bmFtZSB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkT1VDb21wdXRlcnMgPSBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1BRFNwYXRoICRfLkFEU3BhdGggLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkT1VDb21wdXRlcnMpIHsKICAgICAgICAgICAgICAgIGlmKCRPVUNvbXB1dGVycyAtaXNub3QgW1N5c3RlbS5BcnJheV0pIHskT1VDb21wdXRlcnMgPSBAKCRPVUNvbXB1dGVycyl9CgogICAgICAgICAgICAgICAgRm9yRWFjaCAoJFRhcmdldFNpZCBpbiAkVGFyZ2V0T2JqZWN0U0lEcykgewogICAgICAgICAgICAgICAgICAgICRPYmplY3QgPSBHZXQtQURPYmplY3QgLVNJRCAkVGFyZ2V0U2lkIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtUGFnZVNpemUgJFBhZ2VTaXplCgogICAgICAgICAgICAgICAgICAgICRJc0dyb3VwID0gQCgnMjY4NDM1NDU2JywnMjY4NDM1NDU3JywnNTM2ODcwOTEyJywnNTM2ODcwOTEzJykgLWNvbnRhaW5zICRPYmplY3Quc2FtYWNjb3VudHR5cGUKCiAgICAgICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdPYmplY3ROYW1lJyAkT2JqZWN0LnNhbWFjY291bnRuYW1lCiAgICAgICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdEROJyAkT2JqZWN0LmRpc3Rpbmd1aXNoZWRuYW1lCiAgICAgICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdFNJRCcgJE9iamVjdC5vYmplY3RzaWQKICAgICAgICAgICAgICAgICAgICAkR1BPTG9jYXRpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRG9tYWluJyAkRG9tYWluCiAgICAgICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzR3JvdXAnICRJc0dyb3VwCiAgICAgICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0Rpc3BsYXlOYW1lJyAkR1BPbmFtZQogICAgICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9HdWlkJyAkR1BPR3VpZAogICAgICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9QYXRoJyAkR1BPUGF0aAogICAgICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9UeXBlJyAkR1BPVHlwZQogICAgICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb250YWluZXJOYW1lJyAkXy5kaXN0aW5ndWlzaGVkbmFtZQogICAgICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRPVUNvbXB1dGVycwogICAgICAgICAgICAgICAgICAgICRHUE9Mb2NhdGlvbi5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuR1BPTG9jYWxHcm91cCcpCiAgICAgICAgICAgICAgICAgICAgJEdQT0xvY2F0aW9uCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgZmluZCBhbnkgc2l0ZXMgdGhhdCBoYXZlIHRoaXMgR1VJRCBhcHBsaWVkCiAgICAgICAgR2V0LU5ldFNpdGUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1HVUlEICRHUE9ndWlkIC1QYWdlU2l6ZSAkUGFnZVNpemUgLUZ1bGxEYXRhIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgRm9yRWFjaCAoJFRhcmdldFNpZCBpbiAkVGFyZ2V0T2JqZWN0U0lEcykgewogICAgICAgICAgICAgICAgJE9iamVjdCA9IEdldC1BRE9iamVjdCAtU0lEICRUYXJnZXRTaWQgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1QYWdlU2l6ZSAkUGFnZVNpemUKCiAgICAgICAgICAgICAgICAkSXNHcm91cCA9IEAoJzI2ODQzNTQ1NicsJzI2ODQzNTQ1NycsJzUzNjg3MDkxMicsJzUzNjg3MDkxMycpIC1jb250YWlucyAkT2JqZWN0LnNhbWFjY291bnR0eXBlCgogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdE5hbWUnICRPYmplY3Quc2FtYWNjb3VudG5hbWUKICAgICAgICAgICAgICAgICRBcHBsaWVkU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdPYmplY3RETicgJE9iamVjdC5kaXN0aW5ndWlzaGVkbmFtZQogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdFNJRCcgJE9iamVjdC5vYmplY3RzaWQKICAgICAgICAgICAgICAgICRBcHBsaWVkU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0dyb3VwJyAkSXNHcm91cAogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0RvbWFpbicgJERvbWFpbgogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0Rpc3BsYXlOYW1lJyAkR1BPbmFtZQogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0d1aWQnICRHUE9HdWlkCiAgICAgICAgICAgICAgICAkQXBwbGllZFNpdGUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPUGF0aCcgJEdQT1BhdGgKICAgICAgICAgICAgICAgICRBcHBsaWVkU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9UeXBlJyAkR1BPVHlwZQogICAgICAgICAgICAgICAgJEFwcGxpZWRTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbnRhaW5lck5hbWUnICRfLmRpc3Rpbmd1aXNoZWRuYW1lCiAgICAgICAgICAgICAgICAkQXBwbGllZFNpdGUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkXy5zaXRlb2JqZWN0YmwKICAgICAgICAgICAgICAgICRBcHBsaWVkU2l0ZS5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuR1BPTG9jYWxHcm91cCcpCiAgICAgICAgICAgICAgICAkQXBwbGllZFNpdGUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEZpbmQtR1BPQ29tcHV0ZXJBZG1pbiB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGFrZXMgYSBjb21wdXRlciAob3IgR1BPKSBvYmplY3QgYW5kIGRldGVybWluZXMgd2hhdCB1c2Vycy9ncm91cHMgYXJlIGluIHRoZSBzcGVjaWZpZWQKICAgICAgICBsb2NhbCBncm91cCBmb3IgdGhlIG1hY2hpbmUuCgogICAgICAgIEF1dGhvcjogQGhhcm1qMHkKICAgICAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgICAgICBSZXF1aXJlZCBEZXBlbmRlbmNpZXM6IEdldC1OZXRDb21wdXRlciwgR2V0LVNpdGVOYW1lLCBHZXQtTmV0U2l0ZSwgR2V0LU5ldEdQT0dyb3VwLCBHZXQtQURPYmplY3QsIEdldC1OZXRHcm91cE1lbWJlciwgQ29udmVydC1TaWRUb05hbWUKICAgICAgICBPcHRpb25hbCBEZXBlbmRlbmNpZXM6IE5vbmUKCiAgICAuREVTQ1JJUFRJT04KCiAgICAgICAgSWYgYSAtQ29tcHV0ZXJOYW1lIGlzIHNwZWNpZmllZCwgcmV0cmlldmUgdGhlIGNvbXBsZXRlIGNvbXB1dGVyIG9iamVjdCwgYXR0ZW1wdCB0bwogICAgICAgIGRldGVybWluZSB0aGUgT1UgdGhlIGNvbXB1dGVyIGlzIGEgcGFydCBvZi4gVGhlbiByZXNvbHZlIHRoZSBjb21wdXRlcidzIHNpdGUgbmFtZSB3aXRoCiAgICAgICAgR2V0LVNpdGVOYW1lIGFuZCByZXRyaWV2ZSBhbGwgc2l0ZXMgb2JqZWN0IEdldC1OZXRTaXRlLiBGb3IgdGhvc2UgcmVzdWx0cywgYXR0ZW1wdCB0bwogICAgICAgIGVudW1lcmF0ZSBhbGwgbGlua2VkIEdQT3MgYW5kIGFzc29jaWF0ZWQgbG9jYWwgZ3JvdXAgc2V0dGluZ3Mgd2l0aCBHZXQtTmV0R1BPR3JvdXAuIEZvcgogICAgICAgIGVhY2ggcmVzdWx0aW5nIEdQTyBncm91cCwgcmVzb2x2ZSB0aGUgcmVzdWx0aW5nIHVzZXIvZ3JvdXAgbmFtZSB0byBhIGZ1bGwgQUQgb2JqZWN0IGFuZAogICAgICAgIHJldHVybiB0aGUgcmVzdWx0cy4gVGhpcyB3aWxsIHJldHVybiB0aGUgZG9tYWluIG9iamVjdHMgdGhhdCBhcmUgbWVtYmVycyBvZiB0aGUgc3BlY2lmaWVkCiAgICAgICAgLUxvY2FsR3JvdXAgZm9yIHRoZSBnaXZlbiBjb21wdXRlci4KCiAgICAgICAgSW52ZXJzZSBvZiBGaW5kLUdQT0xvY2F0aW9uLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBjb21wdXRlciB0byBkZXRlcm1pbmUgbG9jYWwgYWRtaW5pc3RyYXRpdmUgYWNjZXNzIHRvLgoKICAgIC5QQVJBTUVURVIgT1VOYW1lCgogICAgICAgIE9VIG5hbWUgdG8gZGV0ZXJtaW5lIHdobyBoYXMgbG9jYWwgYWRtaW5pc3J0YXRpdmUgYWNlc3MgdG8gY29tcHV0ZXJzCiAgICAgICAgd2l0aGluIGl0LgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIE9wdGlvbmFsIGRvbWFpbiB0aGUgY29tcHV0ZXIvT1UgZXhpc3RzIGluLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBSZWN1cnNlCgogICAgICAgIFN3aXRjaC4gSWYgYSByZXR1cm5lZCBtZW1iZXIgaXMgYSBncm91cCwgcmVjdXJzZSBhbmQgZ2V0IGFsbCBtZW1iZXJzLgoKICAgIC5QQVJBTUVURVIgTG9jYWxHcm91cAoKICAgICAgICBUaGUgbG9jYWwgZ3JvdXAgdG8gY2hlY2sgYWNjZXNzIGFnYWluc3QuCiAgICAgICAgQ2FuIGJlICJBZG1pbmlzdHJhdG9ycyIgKFMtMS01LTMyLTU0NCksICJSRFAvUmVtb3RlIERlc2t0b3AgVXNlcnMiIChTLTEtNS0zMi01NTUpLAogICAgICAgIG9yIGEgY3VzdG9tIGxvY2FsIFNJRC4KICAgICAgICBEZWZhdWx0cyB0byBsb2NhbCAnQWRtaW5pc3RyYXRvcnMnLgoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IGFueSBmb3VuZCBwb2xpY3kgZmlsZXMgd2l0aCB0ZW1wb3JhcnkgUFNEcml2ZXMuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUdQT0NvbXB1dGVyQWRtaW4gLUNvbXB1dGVyTmFtZSBXSU5ET1dTMy5kZXYudGVzdGxhYi5sb2NhbAoKICAgICAgICBGaW5kcyB1c2VycyB3aG8gaGF2ZSBsb2NhbCBhZG1pbiByaWdodHMgb3ZlciBXSU5ET1dTMyB0aHJvdWdoIEdQTyBjb3JyZWxhdGlvbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtR1BPQ29tcHV0ZXJBZG1pbiAtQ29tcHV0ZXJOYW1lIFdJTkRPV1MzLmRldi50ZXN0bGFiLmxvY2FsIC1Mb2NhbEdyb3VwIFJEUAoKICAgICAgICBGaW5kcyB1c2VycyB3aG8gaGF2ZSBSRFAgcmlnaHRzIG92ZXIgV0lORE9XUzMgdGhyb3VnaCBHUE8gY29ycmVsYXRpb24uCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlck5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE9VTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRSZWN1cnNlLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRMb2NhbEdyb3VwID0gJ0FkbWluaXN0cmF0b3JzJywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVXNlUFNEcml2ZSwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAKICAgICkKCiAgICBwcm9jZXNzIHsKCiAgICAgICAgaWYoISRDb21wdXRlck5hbWUgLWFuZCAhJE9VTmFtZSkgewogICAgICAgICAgICBUaHJvdyAiLUNvbXB1dGVyTmFtZSBvciAtT1VOYW1lIG11c3QgYmUgcHJvdmlkZWQiCiAgICAgICAgfQoKICAgICAgICAkR1BPR3JvdXBzID0gQCgpCgogICAgICAgIGlmKCRDb21wdXRlck5hbWUpIHsKICAgICAgICAgICAgJENvbXB1dGVycyA9IEdldC1OZXRDb21wdXRlciAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1GdWxsRGF0YSAtUGFnZVNpemUgJFBhZ2VTaXplCgogICAgICAgICAgICBpZighJENvbXB1dGVycykgewogICAgICAgICAgICAgICAgdGhyb3cgIkNvbXB1dGVyICRDb21wdXRlck5hbWUgaW4gZG9tYWluICckRG9tYWluJyBub3QgZm91bmQhIFRyeSBhIGZ1bGx5IHF1YWxpZmllZCBob3N0IG5hbWUiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRUYXJnZXRPVXMgPSBAKCkKICAgICAgICAgICAgRm9yRWFjaCgkQ29tcHV0ZXIgaW4gJENvbXB1dGVycykgewogICAgICAgICAgICAgICAgIyBleHRyYWN0IGFsbCBPVXMgYSBjb21wdXRlciBpcyBhIHBhcnQgb2YKICAgICAgICAgICAgICAgICRETiA9ICRDb21wdXRlci5kaXN0aW5ndWlzaGVkbmFtZQoKICAgICAgICAgICAgICAgICRUYXJnZXRPVXMgKz0gJEROLnNwbGl0KCIsIikgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgaWYoJF8uc3RhcnRzd2l0aCgiT1U9IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEROLnN1YnN0cmluZygkRE4uaW5kZXhvZigkXykpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGVudW1lcmF0ZSBhbnkgbGlua2VkIEdQT3MgZm9yIHRoZSBjb21wdXRlcidzIHNpdGUKICAgICAgICAgICAgJENvbXB1dGVyU2l0ZSA9IChHZXQtU2l0ZU5hbWUgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lKS5TaXRlTmFtZQogICAgICAgICAgICBpZigkQ29tcHV0ZXJTaXRlIC1hbmQgKCRDb21wdXRlclNpdGUgLW5vdGxpa2UgJ0Vycm9yKicpKSB7CiAgICAgICAgICAgICAgICAkR1BPR3JvdXBzICs9IEdldC1OZXRTaXRlIC1TaXRlTmFtZSAkQ29tcHV0ZXJTaXRlIC1GdWxsRGF0YSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICBpZigkXy5ncGxpbmspIHsKICAgICAgICAgICAgICAgICAgICAgICAgJF8uZ3BsaW5rLnNwbGl0KCJdWyIpIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRfLnN0YXJ0c3dpdGgoIkxEQVAiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfLnNwbGl0KCI7IilbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgJEdQT0dyb3VwQXJncyA9ICBAewogICAgICAgICAgICAgICAgICAgICAgICAnRG9tYWluJyA9ICREb21haW4KICAgICAgICAgICAgICAgICAgICAgICAgJ0RvbWFpbkNvbnRyb2xsZXInID0gJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgICAgICAgICAgICAgJ1Jlc29sdmVNZW1iZXJTSURzJyA9ICRUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICdVc2VQU0RyaXZlJyA9ICRVc2VQU0RyaXZlCiAgICAgICAgICAgICAgICAgICAgICAgICdQYWdlU2l6ZScgPSAkUGFnZVNpemUKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICMgZm9yIGVhY2ggR1BPIGxpbmssIGdldCBhbnkgbG9jYWxseSBzZXQgdXNlci9ncm91cCBTSURzCiAgICAgICAgICAgICAgICAgICAgR2V0LU5ldEdQT0dyb3VwIEBHUE9Hcm91cEFyZ3MKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFRhcmdldE9VcyA9IEAoJE9VTmFtZSkKICAgICAgICB9CgogICAgICAgIFdyaXRlLVZlcmJvc2UgIlRhcmdldCBPVXM6ICRUYXJnZXRPVXMiCgogICAgICAgICRUYXJnZXRPVXMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICRHUE9MaW5rcyA9IEdldC1OZXRPVSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUFEU3BhdGggJF8gLUZ1bGxEYXRhIC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAjIGFuZCB0aGVuIGdldCBhbnkgR1BPIGxpbmtzCiAgICAgICAgICAgICAgICBpZigkXy5ncGxpbmspIHsKICAgICAgICAgICAgICAgICAgICAkXy5ncGxpbmsuc3BsaXQoIl1bIikgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkXy5zdGFydHN3aXRoKCJMREFQIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfLnNwbGl0KCI7IilbMF0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJEdQT0dyb3VwQXJncyA9ICBAewogICAgICAgICAgICAgICAgJ0RvbWFpbicgPSAkRG9tYWluCiAgICAgICAgICAgICAgICAnRG9tYWluQ29udHJvbGxlcicgPSAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAgICAgJ1VzZVBTRHJpdmUnID0gJFVzZVBTRHJpdmUKICAgICAgICAgICAgICAgICdSZXNvbHZlTWVtYmVyU0lEcycgPSAkVHJ1ZQogICAgICAgICAgICAgICAgJ1BhZ2VTaXplJyA9ICRQYWdlU2l6ZQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGV4dHJhY3QgR1BPIGdyb3VwcyB0aGF0IGFyZSBzZXQgdGhyb3VnaCBhbnkgZ1BsaW5rIGZvciB0aGlzIE9VCiAgICAgICAgICAgICRHUE9Hcm91cHMgKz0gR2V0LU5ldEdQT0dyb3VwIEBHUE9Hcm91cEFyZ3MgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICBGb3JFYWNoKCRHUE9MaW5rIGluICRHUE9MaW5rcykgewogICAgICAgICAgICAgICAgICAgICROYW1lID0gJF8uR1BPTmFtZQogICAgICAgICAgICAgICAgICAgIGlmKCRHUE9MaW5rIC1saWtlICIqJE5hbWUqIikgewogICAgICAgICAgICAgICAgICAgICAgICAkXwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBmb3IgZWFjaCBmb3VuZCBHUE8gZ3JvdXAsIHJlc29sdmUgdGhlIFNJRHMgb2YgdGhlIG1lbWJlcnMKICAgICAgICAkR1BPZ3JvdXBzIHwgU29ydC1PYmplY3QgLVByb3BlcnR5IEdQT05hbWUgLVVuaXF1ZSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgJEdQT0dyb3VwID0gJF8KCiAgICAgICAgICAgIGlmKCRHUE9Hcm91cC5Hcm91cE1lbWJlcnMpIHsKICAgICAgICAgICAgICAgICRHUE9NZW1iZXJzID0gJEdQT0dyb3VwLkdyb3VwTWVtYmVycwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJEdQT01lbWJlcnMgPSAkR1BPR3JvdXAuR3JvdXBTSUQKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJEdQT01lbWJlcnMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAjIHJlc29sdmUgdGhpcyBTSUQgdG8gYSBkb21haW4gb2JqZWN0CiAgICAgICAgICAgICAgICAkT2JqZWN0ID0gR2V0LUFET2JqZWN0IC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIC1TSUQgJF8KCiAgICAgICAgICAgICAgICAkSXNHcm91cCA9IEAoJzI2ODQzNTQ1NicsJzI2ODQzNTQ1NycsJzUzNjg3MDkxMicsJzUzNjg3MDkxMycpIC1jb250YWlucyAkT2JqZWN0LnNhbWFjY291bnR0eXBlCgogICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdE5hbWUnICRPYmplY3Quc2FtYWNjb3VudG5hbWUKICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdEROJyAkT2JqZWN0LmRpc3Rpbmd1aXNoZWRuYW1lCiAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdPYmplY3RTSUQnICRfCiAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0dyb3VwJyAkSXNHcm91cAogICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPRGlzcGxheU5hbWUnICRHUE9Hcm91cC5HUE9EaXNwbGF5TmFtZQogICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR1BPR3VpZCcgJEdQT0dyb3VwLkdQT05hbWUKICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT1BhdGgnICRHUE9Hcm91cC5HUE9QYXRoCiAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9UeXBlJyAkR1BPR3JvdXAuR1BPVHlwZQogICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4KCiAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIHJlY3Vyc2luZyBhbmQgdGhlIGN1cnJlbnQgcmVzdWx0IG9iamVjdCBpcyBhIGdyb3VwCiAgICAgICAgICAgICAgICBpZigkUmVjdXJzZSAtYW5kICRHUE9Db21wdXRlckFkbWluLmlzR3JvdXApIHsKCiAgICAgICAgICAgICAgICAgICAgR2V0LU5ldEdyb3VwTWVtYmVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtU0lEICRfIC1GdWxsRGF0YSAtUmVjdXJzZSAtUGFnZVNpemUgJFBhZ2VTaXplIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlckROID0gJF8uZGlzdGluZ3Vpc2hlZE5hbWUKCiAgICAgICAgICAgICAgICAgICAgICAgICMgZXh0cmFjdCB0aGUgRlFETiBmcm9tIHRoZSBEaXN0aW5ndWlzaGVkIE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlckRvbWFpbiA9ICRNZW1iZXJETi5zdWJTdHJpbmcoJE1lbWJlckROLkluZGV4T2YoIkRDPSIpKSAtcmVwbGFjZSAnREM9JywnJyAtcmVwbGFjZSAnLCcsJy4nCgogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVySXNHcm91cCA9IEAoJzI2ODQzNTQ1NicsJzI2ODQzNTQ1NycsJzUzNjg3MDkxMicsJzUzNjg3MDkxMycpIC1jb250YWlucyAkXy5zYW1hY2NvdW50dHlwZQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRfLnNhbUFjY291bnROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGZvcmVzdCB1c2VycyBoYXZlIHRoZSBzYW1BY2NvdW50TmFtZSBzZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJOYW1lID0gJF8uc2FtQWNjb3VudE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgZXh0ZXJuYWwgdHJ1c3QgdXNlcnMgaGF2ZSBhIFNJRCwgc28gY29udmVydCBpdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyTmFtZSA9IENvbnZlcnQtU2lkVG9OYW1lICRfLmNuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBpZiB0aGVyZSdzIGEgcHJvYmxlbSBjb250YWN0aW5nIHRoZSBkb21haW4gdG8gcmVzb2x2ZSB0aGUgU0lECiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlck5hbWUgPSAkXy5jbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdE5hbWUnICRNZW1iZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ09iamVjdEROJyAkTWVtYmVyRE4KICAgICAgICAgICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnT2JqZWN0U0lEJyAkXy5vYmplY3RzaWQKICAgICAgICAgICAgICAgICAgICAgICAgJEdQT0NvbXB1dGVyQWRtaW4gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSXNHcm91cCcgJE1lbWJlcklzR3JvdQogICAgICAgICAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHUE9EaXNwbGF5TmFtZScgJEdQT0dyb3VwLkdQT0Rpc3BsYXlOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT0d1aWQnICRHUE9Hcm91cC5HUE9OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT1BhdGgnICRHUE9Hcm91cC5HUE9QYXRoCiAgICAgICAgICAgICAgICAgICAgICAgICRHUE9Db21wdXRlckFkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dQT1R5cGUnICRHUE9UeXBlcAogICAgICAgICAgICAgICAgICAgICAgICAkR1BPQ29tcHV0ZXJBZG1pbgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1Eb21haW5Qb2xpY3kgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFJldHVybnMgdGhlIGRlZmF1bHQgZG9tYWluIG9yIERDIHBvbGljeSBmb3IgYSBnaXZlbgogICAgICAgIGRvbWFpbiBvciBkb21haW4gY29udHJvbGxlci4KCiAgICAgICAgVGhhbmtzIFNlYW4gTWV0YWNhbGYgKEBweXJvdGVrMykgZm9yIHRoZSBpZGVhIGFuZCBndWlkYW5jZS4KCiAgICAuUEFSQU1FVEVSIFNvdXJjZQoKICAgICAgICBFeHRyYWN0IERvbWFpbiBvciBEQyAoZG9tYWluIGNvbnRyb2xsZXIpIHBvbGljaWVzLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gdG8gcXVlcnkgZm9yIGRlZmF1bHQgcG9saWNpZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFJlc29sdmVTaWRzCgogICAgICAgIFN3aXRjaC4gUmVzb2x2ZSBTaWRzIGZyb20gYSBEQyBwb2xpY3kgdG8gb2JqZWN0IG5hbWVzLgoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IGFueSBmb3VuZCBwb2xpY3kgZmlsZXMgd2l0aCB0ZW1wb3JhcnkgUFNEcml2ZXMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtRG9tYWluUG9saWN5CgogICAgICAgIFJldHVybnMgdGhlIGRvbWFpbiBwb2xpY3kgZm9yIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Eb21haW5Qb2xpY3kgLVNvdXJjZSBEQyAtRG9tYWluQ29udHJvbGxlciBNQVNURVIudGVzdGxhYi5sb2NhbAoKICAgICAgICBSZXR1cm5zIHRoZSBwb2xpY3kgZm9yIHRoZSBNQVNURVIudGVzdGxhYi5sb2NhbCBkb21haW4gY29udHJvbGxlci4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0gKAogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlU2V0KCJEb21haW4iLCJEQyIpXQogICAgICAgICRTb3VyY2UgPSJEb21haW4iLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlc29sdmVTaWRzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRVc2VQU0RyaXZlCiAgICApCgogICAgaWYoJFNvdXJjZSAtZXEgIkRvbWFpbiIpIHsKICAgICAgICAjIHF1ZXJ5IHRoZSBnaXZlbiBkb21haW4gZm9yIHRoZSBkZWZhdWx0IGRvbWFpbiBwb2xpY3kgb2JqZWN0CiAgICAgICAgJEdQTyA9IEdldC1OZXRHUE8gLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1HUE9uYW1lICJ7MzFCMkYzNDAtMDE2RC0xMUQyLTk0NUYtMDBDMDRGQjk4NEY5fSIKCiAgICAgICAgaWYoJEdQTykgewogICAgICAgICAgICAjIGdyYWIgdGhlIEdwdFRtcGwuaW5mIGZpbGUgYW5kIHBhcnNlIGl0CiAgICAgICAgICAgICRHcHRUbXBsUGF0aCA9ICRHUE8uZ3BjZmlsZXN5c3BhdGggKyAiXE1BQ0hJTkVcTWljcm9zb2Z0XFdpbmRvd3MgTlRcU2VjRWRpdFxHcHRUbXBsLmluZiIKCiAgICAgICAgICAgICRQYXJzZUFyZ3MgPSAgQHsKICAgICAgICAgICAgICAgICdHcHRUbXBsUGF0aCcgPSAkR3B0VG1wbFBhdGgKICAgICAgICAgICAgICAgICdVc2VQU0RyaXZlJyA9ICRVc2VQU0RyaXZlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgcGFyc2UgdGhlIEdwdFRtcGwuaW5mCiAgICAgICAgICAgIEdldC1HcHRUbXBsIEBQYXJzZUFyZ3MKICAgICAgICB9CgogICAgfQogICAgZWxzZWlmKCRTb3VyY2UgLWVxICJEQyIpIHsKICAgICAgICAjIHF1ZXJ5IHRoZSBnaXZlbiBkb21haW4vZGMgZm9yIHRoZSBkZWZhdWx0IGRvbWFpbiBjb250cm9sbGVyIHBvbGljeSBvYmplY3QKICAgICAgICAkR1BPID0gR2V0LU5ldEdQTyAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUdQT25hbWUgIns2QUMxNzg2Qy0wMTZGLTExRDItOTQ1Ri0wMEMwNEZCOTg0Rjl9IgoKICAgICAgICBpZigkR1BPKSB7CiAgICAgICAgICAgICMgZ3JhYiB0aGUgR3B0VG1wbC5pbmYgZmlsZSBhbmQgcGFyc2UgaXQKICAgICAgICAgICAgJEdwdFRtcGxQYXRoID0gJEdQTy5ncGNmaWxlc3lzcGF0aCArICJcTUFDSElORVxNaWNyb3NvZnRcV2luZG93cyBOVFxTZWNFZGl0XEdwdFRtcGwuaW5mIgoKICAgICAgICAgICAgJFBhcnNlQXJncyA9ICBAewogICAgICAgICAgICAgICAgJ0dwdFRtcGxQYXRoJyA9ICRHcHRUbXBsUGF0aAogICAgICAgICAgICAgICAgJ1VzZVBTRHJpdmUnID0gJFVzZVBTRHJpdmUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBwYXJzZSB0aGUgR3B0VG1wbC5pbmYKICAgICAgICAgICAgR2V0LUdwdFRtcGwgQFBhcnNlQXJncyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgIGlmKCRSZXNvbHZlU2lkcykgewogICAgICAgICAgICAgICAgICAgICMgaWYgd2UncmUgcmVzb2x2aW5nIHNpZHMgaW4gUHJpdmlsZWdlUmlnaHRzIHRvIG5hbWVzCiAgICAgICAgICAgICAgICAgICAgJFBvbGljeSA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAkXy5wc29iamVjdC5wcm9wZXJ0aWVzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICBpZiggJF8uTmFtZSAtZXEgJ1ByaXZpbGVnZVJpZ2h0cycpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUHJpdmlsZWdlUmlnaHRzID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBmb3IgZXZlcnkgbmVzdGVkIFNJRCBtZW1iZXIgb2YgUHJpdmlsZWdlUmlnaHRzLCB0cnkgdG8gdW5wYWNrIGV2ZXJ5dGhpbmcgYW5kIHJlc29sdmUgdGhlIFNJRHMgYXMgYXBwcm9wcmlhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfLlZhbHVlLnBzb2JqZWN0LnByb3BlcnRpZXMgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTaWRzID0gJF8uVmFsdWUgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkXyAtaXNub3QgW1N5c3RlbS5BcnJheV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb252ZXJ0LVNpZFRvTmFtZSAkXwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJF8gfCBGb3JFYWNoLU9iamVjdCB7IENvbnZlcnQtU2lkVG9OYW1lICRfIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciByZXNvbHZpbmcgU0lEIDogJF8iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcml2aWxlZ2VSaWdodHMgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAkXy5OYW1lICRTaWRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFBvbGljeSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdQcml2aWxlZ2VSaWdodHMnICRQcml2aWxlZ2VSaWdodHMKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQb2xpY3kgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAkXy5OYW1lICRfLlZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJFBvbGljeQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7ICRfIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojCiMgRnVuY3Rpb25zIHRoYXQgZW51bWVyYXRlIGEgc2luZ2xlIGhvc3QsIGVpdGhlciB0aHJvdWdoCiMgV2luTlQsIFdNSSwgcmVtb3RlIHJlZ2lzdHJ5LCBvciBBUEkgY2FsbHMKIyAod2l0aCBQU1JlZmxlY3QpLgojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpmdW5jdGlvbiBHZXQtTmV0TG9jYWxHcm91cCB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgR2V0cyBhIGxpc3Qgb2YgYWxsIGN1cnJlbnQgdXNlcnMgaW4gYSBzcGVjaWZpZWQgbG9jYWwgZ3JvdXAsCiAgICAgICAgb3IgcmV0dXJucyB0aGUgbmFtZXMgb2YgYWxsIGxvY2FsIGdyb3VwcyB3aXRoIC1MaXN0R3JvdXBzLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBob3N0bmFtZSBvciBJUCB0byBxdWVyeSBmb3IgbG9jYWwgZ3JvdXAgdXNlcnMuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckZpbGUKCiAgICAgICAgRmlsZSBvZiBob3N0bmFtZXMvSVBzIHRvIHF1ZXJ5IGZvciBsb2NhbCBncm91cCB1c2Vycy4KCiAgICAuUEFSQU1FVEVSIEdyb3VwTmFtZQoKICAgICAgICBUaGUgbG9jYWwgZ3JvdXAgbmFtZSB0byBxdWVyeSBmb3IgdXNlcnMuIElmIG5vdCBnaXZlbiwgaXQgZGVmYXVsdHMgdG8gIkFkbWluaXN0cmF0b3JzIgoKICAgIC5QQVJBTUVURVIgTGlzdEdyb3VwcwoKICAgICAgICBTd2l0Y2guIExpc3QgYWxsIHRoZSBsb2NhbCBncm91cHMgaW5zdGVhZCBvZiB0aGVpciBtZW1iZXJzLgogICAgICAgIE9sZCBHZXQtTmV0TG9jYWxHcm91cHMgZnVuY3Rpb25hbGl0eS4KCiAgICAuUEFSQU1FVEVSIFJlY3Vyc2UKCiAgICAgICAgU3dpdGNoLiBJZiB0aGUgbG9jYWwgbWVtYmVyIG1lbWJlciBpcyBhIGRvbWFpbiBncm91cCwgcmVjdXJzaXZlbHkgdHJ5IHRvIHJlc29sdmUgaXRzIG1lbWJlcnMgdG8gZ2V0IGEgbGlzdCBvZiBkb21haW4gdXNlcnMgd2hvIGNhbiBhY2Nlc3MgdGhpcyBtYWNoaW5lLgoKICAgIC5QQVJBTUVURVIgQVBJCgogICAgICAgIFN3aXRjaC4gVXNlIEFQSSBjYWxscyBpbnN0ZWFkIG9mIHRoZSBXaW5OVCBzZXJ2aWNlIHByb3ZpZGVyLiBMZXNzIGluZm9ybWF0aW9uLAogICAgICAgIGJ1dCB0aGUgcmVzdWx0cyBhcmUgZmFzdGVyLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldExvY2FsR3JvdXAKCiAgICAgICAgUmV0dXJucyB0aGUgdXNlcm5hbWVzIHRoYXQgb2YgbWVtYmVycyBvZiBsb2NhbGdyb3VwICJBZG1pbmlzdHJhdG9ycyIgb24gdGhlIGxvY2FsIGhvc3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0TG9jYWxHcm91cCAtQ29tcHV0ZXJOYW1lIFdJTkRPV1NYUAoKICAgICAgICBSZXR1cm5zIGFsbCB0aGUgbG9jYWwgYWRtaW5pc3RyYXRvciBhY2NvdW50cyBmb3IgV0lORE9XU1hQCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0TG9jYWxHcm91cCAtQ29tcHV0ZXJOYW1lIFdJTkRPV1M3IC1SZWN1cnNlCgogICAgICAgIFJldHVybnMgYWxsIGVmZmVjdGl2ZSBsb2NhbC9kb21haW4gdXNlcnMvZ3JvdXBzIHRoYXQgY2FuIGFjY2VzcyBXSU5ET1dTNyB3aXRoCiAgICAgICAgbG9jYWwgYWRtaW5pc3RyYXRpdmUgcHJpdmlsZWdlcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRMb2NhbEdyb3VwIC1Db21wdXRlck5hbWUgV0lORE9XUzcgLUxpc3RHcm91cHMKCiAgICAgICAgUmV0dXJucyBhbGwgbG9jYWwgZ3JvdXBzIG9uIHRoZSBXSU5ET1dTNyBob3N0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gIldJTkRPV1M3IiwgIldJTkRPV1NTUCIgfCBHZXQtTmV0TG9jYWxHcm91cCAtQVBJCgogICAgICAgIFJldHVybnMgYWxsIGxvY2FsIGdyb3VwcyBvbiB0aGUgdGhlIHBhc3NlZCBob3N0cyB1c2luZyBBUEkgY2FsbHMgaW5zdGVhZCBvZiB0aGUKICAgICAgICBXaW5OVCBzZXJ2aWNlIHByb3ZpZGVyLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjEyODgyMjAvZ2V0LWFsbC1sb2NhbC1tZW1iZXJzLWFuZC1ncm91cHMtZGlzcGxheWVkLXRvZ2V0aGVyCiAgICAgICAgaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2FhNzcyMjExKFZTLjg1KS5hc3B4CiM+CgogICAgW0NtZGxldEJpbmRpbmcoRGVmYXVsdFBhcmFtZXRlclNldE5hbWUgPSAnV2luTlQnKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdBUEknLCBQb3NpdGlvbj0wLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ1dpbk5UJywgUG9zaXRpb249MCwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICRFbnY6Q29tcHV0ZXJOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnV2luTlQnKV0KICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnQVBJJyldCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW0FsaWFzKCdIb3N0TGlzdCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsZSwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ1dpbk5UJyldCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0FQSScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdyb3VwTmFtZSA9ICdBZG1pbmlzdHJhdG9ycycsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdXaW5OVCcpXQogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJExpc3RHcm91cHMsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdXaW5OVCcpXQogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlY3Vyc2UsCgogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdBUEknKV0KICAgICAgICBbU3dpdGNoXQogICAgICAgICRBUEkKICAgICkKCiAgICBwcm9jZXNzIHsKCiAgICAgICAgJFNlcnZlcnMgPSBAKCkKCiAgICAgICAgIyBpZiB3ZSBoYXZlIGEgaG9zdCBsaXN0IHBhc3NlZCwgZ3JhYiBpdAogICAgICAgIGlmKCRDb21wdXRlckZpbGUpIHsKICAgICAgICAgICAgJFNlcnZlcnMgPSBHZXQtQ29udGVudCAtUGF0aCAkQ29tcHV0ZXJGaWxlCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAjIG90aGVyd2lzZSBhc3N1bWUgYSBzaW5nbGUgaG9zdCBuYW1lCiAgICAgICAgICAgICRTZXJ2ZXJzICs9ICRDb21wdXRlck5hbWUgfCBHZXQtTmFtZUZpZWxkCiAgICAgICAgfQoKICAgICAgICAjIHF1ZXJ5IHRoZSBzcGVjaWZpZWQgZ3JvdXAgdXNpbmcgdGhlIFdJTk5UIHByb3ZpZGVyLCBhbmQKICAgICAgICAjIGV4dHJhY3QgZmllbGRzIGFzIGFwcHJvcHJpYXRlIGZyb20gdGhlIHJlc3VsdHMKICAgICAgICBGb3JFYWNoKCRTZXJ2ZXIgaW4gJFNlcnZlcnMpIHsKCiAgICAgICAgICAgIGlmKCRBUEkpIHsKICAgICAgICAgICAgICAgICMgaWYgd2UncmUgdXNpbmcgdGhlIE5ldGFwaTMyIE5ldExvY2FsR3JvdXBHZXRNZW1iZXJzIEFQSSBjYWxsIHRvIGdldCB0aGUgbG9jYWwgZ3JvdXAgaW5mb3JtYXRpb24KCiAgICAgICAgICAgICAgICAjIGFyZ3VtZW50cyBmb3IgTmV0TG9jYWxHcm91cEdldE1lbWJlcnMKICAgICAgICAgICAgICAgICRRdWVyeUxldmVsID0gMgogICAgICAgICAgICAgICAgJFB0ckluZm8gPSBbSW50UHRyXTo6WmVybwogICAgICAgICAgICAgICAgJEVudHJpZXNSZWFkID0gMAogICAgICAgICAgICAgICAgJFRvdGFsUmVhZCA9IDAKICAgICAgICAgICAgICAgICRSZXN1bWVIYW5kbGUgPSAwCgogICAgICAgICAgICAgICAgIyBnZXQgdGhlIGxvY2FsIHVzZXIgaW5mb3JtYXRpb24KICAgICAgICAgICAgICAgICRSZXN1bHQgPSAkTmV0YXBpMzI6Ok5ldExvY2FsR3JvdXBHZXRNZW1iZXJzKCRTZXJ2ZXIsICRHcm91cE5hbWUsICRRdWVyeUxldmVsLCBbcmVmXSRQdHJJbmZvLCAtMSwgW3JlZl0kRW50cmllc1JlYWQsIFtyZWZdJFRvdGFsUmVhZCwgW3JlZl0kUmVzdW1lSGFuZGxlKQoKICAgICAgICAgICAgICAgICMgTG9jYXRlIHRoZSBvZmZzZXQgb2YgdGhlIGluaXRpYWwgaW50UHRyCiAgICAgICAgICAgICAgICAkT2Zmc2V0ID0gJFB0ckluZm8uVG9JbnQ2NCgpCgogICAgICAgICAgICAgICAgJExvY2FsVXNlcnMgPSBAKCkKCiAgICAgICAgICAgICAgICAjIDAgPSBzdWNjZXNzCiAgICAgICAgICAgICAgICBpZiAoKCRSZXN1bHQgLWVxIDApIC1hbmQgKCRPZmZzZXQgLWd0IDApKSB7CgogICAgICAgICAgICAgICAgICAgICMgV29yayBvdXQgaG93IG11dGNoIHRvIGluY3JlbWVudCB0aGUgcG9pbnRlciBieSBmaW5kaW5nIG91dCB0aGUgc2l6ZSBvZiB0aGUgc3RydWN0dXJlCiAgICAgICAgICAgICAgICAgICAgJEluY3JlbWVudCA9ICRMT0NBTEdST1VQX01FTUJFUlNfSU5GT18yOjpHZXRTaXplKCkKCiAgICAgICAgICAgICAgICAgICAgIyBwYXJzZSBhbGwgdGhlIHJlc3VsdCBzdHJ1Y3R1cmVzCiAgICAgICAgICAgICAgICAgICAgZm9yICgkaSA9IDA7ICgkaSAtbHQgJEVudHJpZXNSZWFkKTsgJGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAjIGNyZWF0ZSBhIG5ldyBpbnQgcHRyIGF0IHRoZSBnaXZlbiBvZmZzZXQgYW5kIGNhc3QgdGhlIHBvaW50ZXIgYXMgb3VyIHJlc3VsdCBzdHJ1Y3R1cmUKICAgICAgICAgICAgICAgICAgICAgICAgJE5ld0ludFB0ciA9IE5ldy1PYmplY3QgU3lzdGVtLkludHB0ciAtQXJndW1lbnRMaXN0ICRPZmZzZXQKICAgICAgICAgICAgICAgICAgICAgICAgJEluZm8gPSAkTmV3SW50UHRyIC1hcyAkTE9DQUxHUk9VUF9NRU1CRVJTX0lORk9fMgoKICAgICAgICAgICAgICAgICAgICAgICAgJE9mZnNldCA9ICROZXdJbnRQdHIuVG9JbnQ2NCgpCiAgICAgICAgICAgICAgICAgICAgICAgICRPZmZzZXQgKz0gJEluY3JlbWVudAoKICAgICAgICAgICAgICAgICAgICAgICAgJFNpZFN0cmluZyA9ICIiCiAgICAgICAgICAgICAgICAgICAgICAgICRSZXN1bHQyID0gJEFkdmFwaTMyOjpDb252ZXJ0U2lkVG9TdHJpbmdTaWQoJEluZm8ubGdybWkyX3NpZCwgW3JlZl0kU2lkU3RyaW5nKTskTGFzdEVycm9yID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXRMYXN0V2luMzJFcnJvcigpCgogICAgICAgICAgICAgICAgICAgICAgICBpZigkUmVzdWx0MiAtZXEgMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3I6ICQoKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJExhc3RFcnJvcikuTWVzc2FnZSkiCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWxVc2VyID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRTZXJ2ZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQWNjb3VudE5hbWUnICRJbmZvLmxncm1pMl9kb21haW5hbmRuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWxVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NJRCcgJFNpZFN0cmluZwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRJc0dyb3VwID0gJCgkSW5mby5sZ3JtaTJfc2lkdXNhZ2UgLW5lICdTaWRUeXBlVXNlcicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWxVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzR3JvdXAnICRJc0dyb3VwCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsVXNlci5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuTG9jYWxVc2VyQVBJJykKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWxVc2VycyArPSAkTG9jYWxVc2VyCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICMgZnJlZSB1cCB0aGUgcmVzdWx0IGJ1ZmZlcgogICAgICAgICAgICAgICAgICAgICROdWxsID0gJE5ldGFwaTMyOjpOZXRBcGlCdWZmZXJGcmVlKCRQdHJJbmZvKQoKICAgICAgICAgICAgICAgICAgICAjIHRyeSB0byBleHRyYWN0IG91dCB0aGUgbWFjaGluZSBTSUQgYnkgdXNpbmcgdGhlIC01MDAgYWNjb3VudCBhcyBhIHJlZmVyZW5jZQogICAgICAgICAgICAgICAgICAgICRNYWNoaW5lU2lkID0gJExvY2FsVXNlcnMgfCBXaGVyZS1PYmplY3QgeyRfLlNJRCAtbGlrZSAnKi01MDAnfQogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRQYXJ0cyA9ICRNYWNoaW5lU2lkLlNJRC5TcGxpdCgnLScpCiAgICAgICAgICAgICAgICAgICAgICAgICRNYWNoaW5lU2lkID0gJFBhcnRzWzAuLigkUGFydHMuTGVuZ3RoIC0yKV0gLWpvaW4gJy0nCgogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWxVc2VycyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRfLlNJRCAtbWF0Y2ggJE1hY2hpbmVTaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkXyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0RvbWFpbicgJEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkXyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0RvbWFpbicgJFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWxVc2VycwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIHJldHJpZXZpbmcgbWFjaGluZSBTSUQgZm9yICRTZXJ2ZXIiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3I6ICQoKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJFJlc3VsdCkuTWVzc2FnZSkiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgIyBvdGhlcndpc2Ugd2UncmUgdXNpbmcgdGhlIFdpbk5UIHNlcnZpY2UgcHJvdmlkZXIKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaWYoJExpc3RHcm91cHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSBsaXN0aW5nIHRoZSBncm91cCBuYW1lcyBvbiBhIHJlbW90ZSBzZXJ2ZXIKICAgICAgICAgICAgICAgICAgICAgICAgJENvbXB1dGVyID0gW0FEU0ldIldpbk5UOi8vJFNlcnZlcixjb21wdXRlciIKCiAgICAgICAgICAgICAgICAgICAgICAgICRDb21wdXRlci5wc2Jhc2UuY2hpbGRyZW4gfCBXaGVyZS1PYmplY3QgeyAkXy5wc2Jhc2Uuc2NoZW1hQ2xhc3NOYW1lIC1lcSAnZ3JvdXAnIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU2VydmVyJyAkU2VydmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXAgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXAnICgkXy5uYW1lWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NJRCcgKChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyICRfLm9iamVjdHNpZFswXSwwKS5WYWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEZXNjcmlwdGlvbicgKCRfLkRlc2NyaXB0aW9uWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdyb3VwLlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5Mb2NhbEdyb3VwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSB3ZSdyZSBsaXN0aW5nIHRoZSBncm91cCBtZW1iZXJzCiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJzID0gQCgkKFtBRFNJXSJXaW5OVDovLyRTZXJ2ZXIvJEdyb3VwTmFtZSxncm91cCIpLnBzYmFzZS5JbnZva2UoJ01lbWJlcnMnKSkKCiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJzIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJFNlcnZlcgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBZHNQYXRoID0gKCRfLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoJ0Fkc3BhdGgnLCAnR2V0UHJvcGVydHknLCAkTnVsbCwgJF8sICROdWxsKSkuUmVwbGFjZSgnV2luTlQ6Ly8nLCAnJykKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHRyeSB0byB0cmFuc2xhdGUgdGhlIE5UNCBkb21haW4gdG8gYSBGUUROIGlmIHBvc3NpYmxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTmFtZSA9IENvbnZlcnQtQUROYW1lIC1PYmplY3ROYW1lICRBZHNQYXRoIC1JbnB1dFR5cGUgJ05UNCcgLU91dHB1dFR5cGUgJ0Nhbm9uaWNhbCcKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGUUROID0gJE5hbWUuc3BsaXQoIi8iKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRPYmpOYW1lID0gJEFkc1BhdGguc3BsaXQoIi8iKVstMV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTmFtZSA9ICIkRlFETi8kT2JqTmFtZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSXNEb21haW4gPSAkVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE5hbWUgPSAkQWRzUGF0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRJc0RvbWFpbiA9ICRGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQWNjb3VudE5hbWUnICROYW1lCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJElzRG9tYWluKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyB0cmFuc2xhdGUgdGhlIGJpbmFyeSBzaWQgdG8gYSBzdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NJRCcgKChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyKCRfLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoJ09iamVjdFNJRCcsICdHZXRQcm9wZXJ0eScsICROdWxsLCAkXywgJE51bGwpLDApKS5WYWx1ZSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEZXNjcmlwdGlvbicgIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0Rpc2FibGVkJyAkRmFsc2UKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBjaGVjayBpZiB0aGUgbWVtYmVyIGlzIGEgZ3JvdXAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSXNHcm91cCA9ICgkXy5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCdDbGFzcycsICdHZXRQcm9wZXJ0eScsICROdWxsLCAkXywgJE51bGwpIC1lcSAnZ3JvdXAnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSXNHcm91cCcgJElzR3JvdXAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzRG9tYWluJyAkSXNEb21haW4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJElzR3JvdXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdMYXN0TG9naW4nICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdMYXN0TG9naW4nICggJF8uR2V0VHlwZSgpLkludm9rZU1lbWJlcignTGFzdExvZ2luJywgJ0dldFByb3BlcnR5JywgJE51bGwsICRfLCAkTnVsbCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdMYXN0TG9naW4nICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdQd2RMYXN0U2V0JyAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUHdkRXhwaXJlZCcgIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJGbGFncycgIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcmVwdWxsIHRoaXMgdXNlciBvYmplY3Qgc28gd2UgY2FuIGVuc3VyZSBjb3JyZWN0IGluZm9ybWF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsVXNlciA9ICQoW0FEU0ldICJXaW5OVDovLyRBZHNQYXRoIikKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyB0cmFuc2xhdGUgdGhlIGJpbmFyeSBzaWQgdG8gYSBzdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NJRCcgKChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyKCRMb2NhbFVzZXIub2JqZWN0U2lkLnZhbHVlLDApKS5WYWx1ZSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEZXNjcmlwdGlvbicgKCRMb2NhbFVzZXIuRGVzY3JpcHRpb25bMF0pCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVUFDIGZsYWdzIG9mIDB4MiBtZWFuIHRoZSBhY2NvdW50IGlzIGRpc2FibGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEaXNhYmxlZCcgJCgoJExvY2FsVXNlci51c2VyRmxhZ3MudmFsdWUgLWJhbmQgMikgLWVxIDIpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgY2hlY2sgaWYgdGhlIG1lbWJlciBpcyBhIGdyb3VwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0dyb3VwJyAoJExvY2FsVXNlci5TY2hlbWFDbGFzc05hbWUgLWxpa2UgJ2dyb3VwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzRG9tYWluJyAkSXNEb21haW4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJElzR3JvdXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdMYXN0TG9naW4nICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdMYXN0TG9naW4nICggJExvY2FsVXNlci5MYXN0TG9naW5bMF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdMYXN0TG9naW4nICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUHdkTGFzdFNldCcgKCAoR2V0LURhdGUpLkFkZFNlY29uZHMoLSRMb2NhbFVzZXIuUGFzc3dvcmRBZ2VbMF0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUHdkRXhwaXJlZCcgKCAkTG9jYWxVc2VyLlBhc3N3b3JkRXhwaXJlZFswXSAtZXEgJzEnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlckZsYWdzJyAoICRMb2NhbFVzZXIuVXNlckZsYWdzWzBdICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LkxvY2FsVXNlcicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBpZiB0aGUgcmVzdWx0IGlzIGEgZ3JvdXAgZG9tYWluIG9iamVjdCBhbmQgd2UncmUgcmVjdXJzaW5nLCB0cnkgdG8gcmVzb2x2ZSBhbGwgdGhlIGdyb3VwIG1lbWJlciByZXN1bHRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkUmVjdXJzZSAtYW5kICRJc0RvbWFpbiAtYW5kICRJc0dyb3VwKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGUUROID0gJE5hbWUuc3BsaXQoIi8iKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cE5hbWUgPSAkTmFtZS5zcGxpdCgiLyIpWzFdLnRyaW0oKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHZXQtTmV0R3JvdXBNZW1iZXIgLUdyb3VwTmFtZSAkR3JvdXBOYW1lIC1Eb21haW4gJEZRRE4gLUZ1bGxEYXRhIC1SZWN1cnNlIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICIkRlFETi8kKCRfLkdyb3VwTmFtZSkiCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRE4gPSAkXy5kaXN0aW5ndWlzaGVkTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGV4dHJhY3QgdGhlIEZRRE4gZnJvbSB0aGUgRGlzdGluZ3Vpc2hlZCBOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJEb21haW4gPSAkTWVtYmVyRE4uc3ViU3RyaW5nKCRNZW1iZXJETi5JbmRleE9mKCJEQz0iKSkgLXJlcGxhY2UgJ0RDPScsJycgLXJlcGxhY2UgJywnLCcuJwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlcklzR3JvdXAgPSBAKCcyNjg0MzU0NTYnLCcyNjg0MzU0NTcnLCc1MzY4NzA5MTInLCc1MzY4NzA5MTMnKSAtY29udGFpbnMgJF8uc2FtYWNjb3VudHR5cGUKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkXy5zYW1BY2NvdW50TmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBmb3Jlc3QgdXNlcnMgaGF2ZSB0aGUgc2FtQWNjb3VudE5hbWUgc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyTmFtZSA9ICRfLnNhbUFjY291bnROYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgZXh0ZXJuYWwgdHJ1c3QgdXNlcnMgaGF2ZSBhIFNJRCwgc28gY29udmVydCBpdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJOYW1lID0gQ29udmVydC1TaWRUb05hbWUgJF8uY24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHRoZXJlJ3MgYSBwcm9ibGVtIGNvbnRhY3RpbmcgdGhlIGRvbWFpbiB0byByZXNvbHZlIHRoZSBTSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlck5hbWUgPSAkXy5jbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciByZXNvbHZpbmcgU0lEIDogJF8iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQWNjb3VudE5hbWUnICIkTWVtYmVyRG9tYWluLyRNZW1iZXJOYW1lIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NJRCcgJF8ub2JqZWN0c2lkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRGVzY3JpcHRpb24nICRfLmRlc2NyaXB0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRGlzYWJsZWQnICRGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzR3JvdXAnICRNZW1iZXJJc0dyb3VwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSXNEb21haW4nICRUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTGFzdExvZ2luJyAnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1B3ZExhc3RTZXQnICRfLnB3ZExhc3RTZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdQd2RFeHBpcmVkJyAnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJGbGFncycgJF8udXNlckFjY291bnRDb250cm9sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LkxvY2FsVXNlcicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiWyFdIEVycm9yOiAkXyIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZpbHRlciBHZXQtTmV0U2hhcmUgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFRoaXMgZnVuY3Rpb24gd2lsbCBleGVjdXRlIHRoZSBOZXRTaGFyZUVudW0gV2luMzJBUEkgY2FsbCB0byBxdWVyeQogICAgICAgIGEgZ2l2ZW4gaG9zdCBmb3Igb3BlbiBzaGFyZXMuIFRoaXMgaXMgYSByZXBsYWNlbWVudCBmb3IKICAgICAgICAibmV0IHNoYXJlIFxcaG9zdG5hbWUiCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGhvc3RuYW1lIHRvIHF1ZXJ5IGZvciBzaGFyZXMuIEFsc28gYWNjZXB0cyBJUCBhZGRyZXNzZXMuCgogICAgLk9VVFBVVFMKCiAgICAgICAgU0hBUkVfSU5GT18xIHN0cnVjdHVyZS4gQSByZXByZXNlbnRhdGlvbiBvZiB0aGUgU0hBUkVfSU5GT18xCiAgICAgICAgcmVzdWx0IHN0cnVjdHVyZSB3aGljaCBpbmNsdWRlcyB0aGUgbmFtZSBhbmQgbm90ZSBmb3IgZWFjaCBzaGFyZSwKICAgICAgICB3aXRoIHRoZSBDb21wdXRlck5hbWUgYWRkZWQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0U2hhcmUKCiAgICAgICAgUmV0dXJucyBhY3RpdmUgc2hhcmVzIG9uIHRoZSBsb2NhbCBob3N0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldFNoYXJlIC1Db21wdXRlck5hbWUgc3Fsc2VydmVyCgogICAgICAgIFJldHVybnMgYWN0aXZlIHNoYXJlcyBvbiB0aGUgJ3NxbHNlcnZlcicgaG9zdAoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldENvbXB1dGVyIHwgR2V0LU5ldFNoYXJlCgogICAgICAgIFJldHVybnMgYWxsIHNoYXJlcyBmb3IgYWxsIGNvbXB1dGVycyBpbiB0aGUgZG9tYWluLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly93d3cucG93ZXJzaGVsbG1hZ2F6aW5lLmNvbS8yMDE0LzA5LzI1L2Vhc2lseS1kZWZpbmluZy1lbnVtcy1zdHJ1Y3RzLWFuZC13aW4zMi1mdW5jdGlvbnMtaW4tbWVtb3J5LwojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3ROYW1lJyldCiAgICAgICAgW09iamVjdFtdXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICdsb2NhbGhvc3QnCiAgICApCgogICAgIyBleHRyYWN0IHRoZSBjb21wdXRlciBuYW1lIGZyb20gd2hhdGV2ZXIgb2JqZWN0IHdhcyBwYXNzZWQgb24gdGhlIHBpcGVsaW5lCiAgICAkQ29tcHV0ZXIgPSAkQ29tcHV0ZXJOYW1lIHwgR2V0LU5hbWVGaWVsZAoKICAgICMgYXJndW1lbnRzIGZvciBOZXRTaGFyZUVudW0KICAgICRRdWVyeUxldmVsID0gMQogICAgJFB0ckluZm8gPSBbSW50UHRyXTo6WmVybwogICAgJEVudHJpZXNSZWFkID0gMAogICAgJFRvdGFsUmVhZCA9IDAKICAgICRSZXN1bWVIYW5kbGUgPSAwCgogICAgIyBnZXQgdGhlIHNoYXJlIGluZm9ybWF0aW9uCiAgICAkUmVzdWx0ID0gJE5ldGFwaTMyOjpOZXRTaGFyZUVudW0oJENvbXB1dGVyLCAkUXVlcnlMZXZlbCwgW3JlZl0kUHRySW5mbywgLTEsIFtyZWZdJEVudHJpZXNSZWFkLCBbcmVmXSRUb3RhbFJlYWQsIFtyZWZdJFJlc3VtZUhhbmRsZSkKCiAgICAjIExvY2F0ZSB0aGUgb2Zmc2V0IG9mIHRoZSBpbml0aWFsIGludFB0cgogICAgJE9mZnNldCA9ICRQdHJJbmZvLlRvSW50NjQoKQoKICAgICMgMCA9IHN1Y2Nlc3MKICAgIGlmICgoJFJlc3VsdCAtZXEgMCkgLWFuZCAoJE9mZnNldCAtZ3QgMCkpIHsKCiAgICAgICAgIyBXb3JrIG91dCBob3cgbXV0Y2ggdG8gaW5jcmVtZW50IHRoZSBwb2ludGVyIGJ5IGZpbmRpbmcgb3V0IHRoZSBzaXplIG9mIHRoZSBzdHJ1Y3R1cmUKICAgICAgICAkSW5jcmVtZW50ID0gJFNIQVJFX0lORk9fMTo6R2V0U2l6ZSgpCgogICAgICAgICMgcGFyc2UgYWxsIHRoZSByZXN1bHQgc3RydWN0dXJlcwogICAgICAgIGZvciAoJGkgPSAwOyAoJGkgLWx0ICRFbnRyaWVzUmVhZCk7ICRpKyspIHsKICAgICAgICAgICAgIyBjcmVhdGUgYSBuZXcgaW50IHB0ciBhdCB0aGUgZ2l2ZW4gb2Zmc2V0IGFuZCBjYXN0IHRoZSBwb2ludGVyIGFzIG91ciByZXN1bHQgc3RydWN0dXJlCiAgICAgICAgICAgICROZXdJbnRQdHIgPSBOZXctT2JqZWN0IFN5c3RlbS5JbnRwdHIgLUFyZ3VtZW50TGlzdCAkT2Zmc2V0CiAgICAgICAgICAgICRJbmZvID0gJE5ld0ludFB0ciAtYXMgJFNIQVJFX0lORk9fMQoKICAgICAgICAgICAgIyByZXR1cm4gYWxsIHRoZSBzZWN0aW9ucyBvZiB0aGUgc3RydWN0dXJlCiAgICAgICAgICAgICRTaGFyZXMgPSAkSW5mbyB8IFNlbGVjdC1PYmplY3QgKgogICAgICAgICAgICAkU2hhcmVzIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyCiAgICAgICAgICAgICRPZmZzZXQgPSAkTmV3SW50UHRyLlRvSW50NjQoKQogICAgICAgICAgICAkT2Zmc2V0ICs9ICRJbmNyZW1lbnQKICAgICAgICAgICAgJFNoYXJlcwogICAgICAgIH0KCiAgICAgICAgIyBmcmVlIHVwIHRoZSByZXN1bHQgYnVmZmVyCiAgICAgICAgJE51bGwgPSAkTmV0YXBpMzI6Ok5ldEFwaUJ1ZmZlckZyZWUoJFB0ckluZm8pCiAgICB9CiAgICBlbHNlIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvcjogJCgoW0NvbXBvbmVudE1vZGVsLldpbjMyRXhjZXB0aW9uXSAkUmVzdWx0KS5NZXNzYWdlKSIKICAgIH0KfQoKCmZpbHRlciBHZXQtTmV0TG9nZ2Vkb24gewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFRoaXMgZnVuY3Rpb24gd2lsbCBleGVjdXRlIHRoZSBOZXRXa3N0YVVzZXJFbnVtIFdpbjMyQVBJIGNhbGwgdG8gcXVlcnkKICAgICAgICBhIGdpdmVuIGhvc3QgZm9yIGFjdGl2ZWx5IGxvZ2dlZCBvbiB1c2Vycy4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBUaGUgaG9zdG5hbWUgdG8gcXVlcnkgZm9yIGxvZ2dlZCBvbiB1c2Vycy4KCiAgICAuT1VUUFVUUwoKICAgICAgICBXS1NUQV9VU0VSX0lORk9fMSBzdHJ1Y3R1cmUuIEEgcmVwcmVzZW50YXRpb24gb2YgdGhlIFdLU1RBX1VTRVJfSU5GT18xCiAgICAgICAgcmVzdWx0IHN0cnVjdHVyZSB3aGljaCBpbmNsdWRlcyB0aGUgdXNlcm5hbWUgYW5kIGRvbWFpbiBvZiBsb2dnZWQgb24gdXNlcnMsCiAgICAgICAgd2l0aCB0aGUgQ29tcHV0ZXJOYW1lIGFkZGVkLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldExvZ2dlZG9uCgogICAgICAgIFJldHVybnMgdXNlcnMgYWN0aXZlbHkgbG9nZ2VkIG9udG8gdGhlIGxvY2FsIGhvc3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0TG9nZ2Vkb24gLUNvbXB1dGVyTmFtZSBzcWxzZXJ2ZXIKCiAgICAgICAgUmV0dXJucyB1c2VycyBhY3RpdmVseSBsb2dnZWQgb250byB0aGUgJ3NxbHNlcnZlcicgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRDb21wdXRlciB8IEdldC1OZXRMb2dnZWRvbgoKICAgICAgICBSZXR1cm5zIGFsbCBsb2dnZWQgb24gdXNlcnNlIGZvciBhbGwgY29tcHV0ZXJzIGluIHRoZSBkb21haW4uCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL3d3dy5wb3dlcnNoZWxsbWFnYXppbmUuY29tLzIwMTQvMDkvMjUvZWFzaWx5LWRlZmluaW5nLWVudW1zLXN0cnVjdHMtYW5kLXdpbjMyLWZ1bmN0aW9ucy1pbi1tZW1vcnkvCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbT2JqZWN0W11dCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJ2xvY2FsaG9zdCcKICAgICkKCiAgICAjIGV4dHJhY3QgdGhlIGNvbXB1dGVyIG5hbWUgZnJvbSB3aGF0ZXZlciBvYmplY3Qgd2FzIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICRDb21wdXRlciA9ICRDb21wdXRlck5hbWUgfCBHZXQtTmFtZUZpZWxkCgogICAgIyBEZWNsYXJlIHRoZSByZWZlcmVuY2UgdmFyaWFibGVzCiAgICAkUXVlcnlMZXZlbCA9IDEKICAgICRQdHJJbmZvID0gW0ludFB0cl06Olplcm8KICAgICRFbnRyaWVzUmVhZCA9IDAKICAgICRUb3RhbFJlYWQgPSAwCiAgICAkUmVzdW1lSGFuZGxlID0gMAoKICAgICMgZ2V0IGxvZ2dlZCBvbiB1c2VyIGluZm9ybWF0aW9uCiAgICAkUmVzdWx0ID0gJE5ldGFwaTMyOjpOZXRXa3N0YVVzZXJFbnVtKCRDb21wdXRlciwgJFF1ZXJ5TGV2ZWwsIFtyZWZdJFB0ckluZm8sIC0xLCBbcmVmXSRFbnRyaWVzUmVhZCwgW3JlZl0kVG90YWxSZWFkLCBbcmVmXSRSZXN1bWVIYW5kbGUpCgogICAgIyBMb2NhdGUgdGhlIG9mZnNldCBvZiB0aGUgaW5pdGlhbCBpbnRQdHIKICAgICRPZmZzZXQgPSAkUHRySW5mby5Ub0ludDY0KCkKCiAgICAjIDAgPSBzdWNjZXNzCiAgICBpZiAoKCRSZXN1bHQgLWVxIDApIC1hbmQgKCRPZmZzZXQgLWd0IDApKSB7CgogICAgICAgICMgV29yayBvdXQgaG93IG11dGNoIHRvIGluY3JlbWVudCB0aGUgcG9pbnRlciBieSBmaW5kaW5nIG91dCB0aGUgc2l6ZSBvZiB0aGUgc3RydWN0dXJlCiAgICAgICAgJEluY3JlbWVudCA9ICRXS1NUQV9VU0VSX0lORk9fMTo6R2V0U2l6ZSgpCgogICAgICAgICMgcGFyc2UgYWxsIHRoZSByZXN1bHQgc3RydWN0dXJlcwogICAgICAgIGZvciAoJGkgPSAwOyAoJGkgLWx0ICRFbnRyaWVzUmVhZCk7ICRpKyspIHsKICAgICAgICAgICAgIyBjcmVhdGUgYSBuZXcgaW50IHB0ciBhdCB0aGUgZ2l2ZW4gb2Zmc2V0IGFuZCBjYXN0IHRoZSBwb2ludGVyIGFzIG91ciByZXN1bHQgc3RydWN0dXJlCiAgICAgICAgICAgICROZXdJbnRQdHIgPSBOZXctT2JqZWN0IFN5c3RlbS5JbnRwdHIgLUFyZ3VtZW50TGlzdCAkT2Zmc2V0CiAgICAgICAgICAgICRJbmZvID0gJE5ld0ludFB0ciAtYXMgJFdLU1RBX1VTRVJfSU5GT18xCgogICAgICAgICAgICAjIHJldHVybiBhbGwgdGhlIHNlY3Rpb25zIG9mIHRoZSBzdHJ1Y3R1cmUKICAgICAgICAgICAgJExvZ2dlZE9uID0gJEluZm8gfCBTZWxlY3QtT2JqZWN0ICoKICAgICAgICAgICAgJExvZ2dlZE9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyCiAgICAgICAgICAgICRPZmZzZXQgPSAkTmV3SW50UHRyLlRvSW50NjQoKQogICAgICAgICAgICAkT2Zmc2V0ICs9ICRJbmNyZW1lbnQKICAgICAgICAgICAgJExvZ2dlZE9uCiAgICAgICAgfQoKICAgICAgICAjIGZyZWUgdXAgdGhlIHJlc3VsdCBidWZmZXIKICAgICAgICAkTnVsbCA9ICROZXRhcGkzMjo6TmV0QXBpQnVmZmVyRnJlZSgkUHRySW5mbykKICAgIH0KICAgIGVsc2UgewogICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yOiAkKChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRSZXN1bHQpLk1lc3NhZ2UpIgogICAgfQp9CgoKZmlsdGVyIEdldC1OZXRTZXNzaW9uIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHdpbGwgZXhlY3V0ZSB0aGUgTmV0U2Vzc2lvbkVudW0gV2luMzJBUEkgY2FsbCB0byBxdWVyeQogICAgICAgIGEgZ2l2ZW4gaG9zdCBmb3IgYWN0aXZlIHNlc3Npb25zIG9uIHRoZSBob3N0LgogICAgICAgIEhlYXZpbHkgYWRhcHRlZCBmcm9tIGR1bmVkaW5pdGUncyBwb3N0IG9uIHN0YWNrb3ZlcmZsb3cgKHNlZSBMSU5LIGJlbG93KQoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBDb21wdXRlck5hbWUgdG8gcXVlcnkgZm9yIGFjdGl2ZSBzZXNzaW9ucy4KCiAgICAuUEFSQU1FVEVSIFVzZXJOYW1lCgogICAgICAgIFRoZSB1c2VyIG5hbWUgdG8gZmlsdGVyIGZvciBhY3RpdmUgc2Vzc2lvbnMuCgogICAgLk9VVFBVVFMKCiAgICAgICAgU0VTU0lPTl9JTkZPXzEwIHN0cnVjdHVyZS4gQSByZXByZXNlbnRhdGlvbiBvZiB0aGUgU0VTU0lPTl9JTkZPXzEwCiAgICAgICAgcmVzdWx0IHN0cnVjdHVyZSB3aGljaCBpbmNsdWRlcyB0aGUgaG9zdCBhbmQgdXNlcm5hbWUgYXNzb2NpYXRlZAogICAgICAgIHdpdGggYWN0aXZlIHNlc3Npb25zLCB3aXRoIHRoZSBDb21wdXRlck5hbWUgYWRkZWQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0U2Vzc2lvbgoKICAgICAgICBSZXR1cm5zIGFjdGl2ZSBzZXNzaW9ucyBvbiB0aGUgbG9jYWwgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRTZXNzaW9uIC1Db21wdXRlck5hbWUgc3Fsc2VydmVyCgogICAgICAgIFJldHVybnMgYWN0aXZlIHNlc3Npb25zIG9uIHRoZSAnc3Fsc2VydmVyJyBob3N0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldERvbWFpbkNvbnRyb2xsZXIgfCBHZXQtTmV0U2Vzc2lvbgoKICAgICAgICBSZXR1cm5zIGFjdGl2ZSBzZXNzaW9ucyBvbiBhbGwgZG9tYWluIGNvbnRyb2xsZXJzLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly93d3cucG93ZXJzaGVsbG1hZ2F6aW5lLmNvbS8yMDE0LzA5LzI1L2Vhc2lseS1kZWZpbmluZy1lbnVtcy1zdHJ1Y3RzLWFuZC13aW4zMi1mdW5jdGlvbnMtaW4tbWVtb3J5LwojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3ROYW1lJyldCiAgICAgICAgW09iamVjdFtdXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICdsb2NhbGhvc3QnLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyTmFtZSA9ICcnCiAgICApCgogICAgIyBleHRyYWN0IHRoZSBjb21wdXRlciBuYW1lIGZyb20gd2hhdGV2ZXIgb2JqZWN0IHdhcyBwYXNzZWQgb24gdGhlIHBpcGVsaW5lCiAgICAkQ29tcHV0ZXIgPSAkQ29tcHV0ZXJOYW1lIHwgR2V0LU5hbWVGaWVsZAoKICAgICMgYXJndW1lbnRzIGZvciBOZXRTZXNzaW9uRW51bQogICAgJFF1ZXJ5TGV2ZWwgPSAxMAogICAgJFB0ckluZm8gPSBbSW50UHRyXTo6WmVybwogICAgJEVudHJpZXNSZWFkID0gMAogICAgJFRvdGFsUmVhZCA9IDAKICAgICRSZXN1bWVIYW5kbGUgPSAwCgogICAgIyBnZXQgc2Vzc2lvbiBpbmZvcm1hdGlvbgogICAgJFJlc3VsdCA9ICROZXRhcGkzMjo6TmV0U2Vzc2lvbkVudW0oJENvbXB1dGVyLCAnJywgJFVzZXJOYW1lLCAkUXVlcnlMZXZlbCwgW3JlZl0kUHRySW5mbywgLTEsIFtyZWZdJEVudHJpZXNSZWFkLCBbcmVmXSRUb3RhbFJlYWQsIFtyZWZdJFJlc3VtZUhhbmRsZSkKCiAgICAjIExvY2F0ZSB0aGUgb2Zmc2V0IG9mIHRoZSBpbml0aWFsIGludFB0cgogICAgJE9mZnNldCA9ICRQdHJJbmZvLlRvSW50NjQoKQoKICAgICMgMCA9IHN1Y2Nlc3MKICAgIGlmICgoJFJlc3VsdCAtZXEgMCkgLWFuZCAoJE9mZnNldCAtZ3QgMCkpIHsKCiAgICAgICAgIyBXb3JrIG91dCBob3cgbXV0Y2ggdG8gaW5jcmVtZW50IHRoZSBwb2ludGVyIGJ5IGZpbmRpbmcgb3V0IHRoZSBzaXplIG9mIHRoZSBzdHJ1Y3R1cmUKICAgICAgICAkSW5jcmVtZW50ID0gJFNFU1NJT05fSU5GT18xMDo6R2V0U2l6ZSgpCgogICAgICAgICMgcGFyc2UgYWxsIHRoZSByZXN1bHQgc3RydWN0dXJlcwogICAgICAgIGZvciAoJGkgPSAwOyAoJGkgLWx0ICRFbnRyaWVzUmVhZCk7ICRpKyspIHsKICAgICAgICAgICAgIyBjcmVhdGUgYSBuZXcgaW50IHB0ciBhdCB0aGUgZ2l2ZW4gb2Zmc2V0IGFuZCBjYXN0IHRoZSBwb2ludGVyIGFzIG91ciByZXN1bHQgc3RydWN0dXJlCiAgICAgICAgICAgICROZXdJbnRQdHIgPSBOZXctT2JqZWN0IFN5c3RlbS5JbnRwdHIgLUFyZ3VtZW50TGlzdCAkT2Zmc2V0CiAgICAgICAgICAgICRJbmZvID0gJE5ld0ludFB0ciAtYXMgJFNFU1NJT05fSU5GT18xMAoKICAgICAgICAgICAgIyByZXR1cm4gYWxsIHRoZSBzZWN0aW9ucyBvZiB0aGUgc3RydWN0dXJlCiAgICAgICAgICAgICRTZXNzaW9ucyA9ICRJbmZvIHwgU2VsZWN0LU9iamVjdCAqCiAgICAgICAgICAgICRTZXNzaW9ucyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgogICAgICAgICAgICAkT2Zmc2V0ID0gJE5ld0ludFB0ci5Ub0ludDY0KCkKICAgICAgICAgICAgJE9mZnNldCArPSAkSW5jcmVtZW50CiAgICAgICAgICAgICRTZXNzaW9ucwogICAgICAgIH0KICAgICAgICAjIGZyZWUgdXAgdGhlIHJlc3VsdCBidWZmZXIKICAgICAgICAkTnVsbCA9ICROZXRhcGkzMjo6TmV0QXBpQnVmZmVyRnJlZSgkUHRySW5mbykKICAgIH0KICAgIGVsc2UgewogICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yOiAkKChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRSZXN1bHQpLk1lc3NhZ2UpIgogICAgfQp9CgoKZmlsdGVyIEdldC1Mb2dnZWRPbkxvY2FsIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHdpbGwgcXVlcnkgdGhlIEhLVSByZWdpc3RyeSB2YWx1ZXMgdG8gcmV0cmlldmUgdGhlIGxvY2FsCiAgICAgICAgbG9nZ2VkIG9uIHVzZXJzIFNJRCBhbmQgdGhlbiBhdHRlbXB0IGFuZCByZXZlcnNlIGl0LgogICAgICAgIEFkYXB0ZWQgdGVjaG5pcXVlIGZyb20gU3lzaW50ZXJuYWwncyBQU0xvZ2dlZE9uIHNjcmlwdC4gQmVuZWZpdCBvdmVyCiAgICAgICAgdXNpbmcgdGhlIE5ldFdrc3RhVXNlckVudW0gQVBJIChHZXQtTmV0TG9nZ2Vkb24pIG9mIGxlc3MgdXNlciBwcml2aWxlZ2VzCiAgICAgICAgcmVxdWlyZWQgKE5ldFdrc3RhVXNlckVudW0gcmVxdWlyZXMgcmVtb3RlIGFkbWluIGFjY2VzcykuCgogICAgICAgIE5vdGU6IFRoaXMgZnVuY3Rpb24gcmVxdWlyZXMgb25seSBkb21haW4gdXNlciByaWdodHMgb24gdGhlCiAgICAgICAgbWFjaGluZSB5b3UncmUgZW51bWVyYXRpbmcsIGJ1dCByZW1vdGUgcmVnaXN0cnkgbXVzdCBiZSBlbmFibGVkLgoKICAgICAgICBGdW5jdGlvbjogR2V0LUxvZ2dlZE9uTG9jYWwKICAgICAgICBBdXRob3I6IE1hdHQgS2VsbHksIEBCcmVha2Vyc0FsbAoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBDb21wdXRlck5hbWUgdG8gcXVlcnkgZm9yIGFjdGl2ZSBzZXNzaW9ucy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1Mb2dnZWRPbkxvY2FsCgogICAgICAgIFJldHVybnMgYWN0aXZlIHNlc3Npb25zIG9uIHRoZSBsb2NhbCBob3N0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUxvZ2dlZE9uTG9jYWwgLUNvbXB1dGVyTmFtZSBzcWxzZXJ2ZXIKCiAgICAgICAgUmV0dXJucyBhY3RpdmUgc2Vzc2lvbnMgb24gdGhlICdzcWxzZXJ2ZXInIGhvc3QuCgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3ROYW1lJyldCiAgICAgICAgW09iamVjdFtdXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICdsb2NhbGhvc3QnCiAgICApCgogICAgIyBwcm9jZXNzIG11bHRpcGxlIGhvc3Qgb2JqZWN0IHR5cGVzIGZyb20gdGhlIHBpcGVsaW5lCiAgICAkQ29tcHV0ZXJOYW1lID0gR2V0LU5hbWVGaWVsZCAtT2JqZWN0ICRDb21wdXRlck5hbWUKCiAgICB0cnkgewogICAgICAgICMgcmV0cmlldmUgSEtVIHJlbW90ZSByZWdpc3RyeSB2YWx1ZXMKICAgICAgICAkUmVnID0gW01pY3Jvc29mdC5XaW4zMi5SZWdpc3RyeUtleV06Ok9wZW5SZW1vdGVCYXNlS2V5KCdVc2VycycsICIkQ29tcHV0ZXJOYW1lIikKCiAgICAgICAgIyBzb3J0IG91dCBib2d1cyBzaWQncyBsaWtlIF9jbGFzcwogICAgICAgICRSZWcuR2V0U3ViS2V5TmFtZXMoKSB8IFdoZXJlLU9iamVjdCB7ICRfIC1tYXRjaCAnUy0xLTUtMjEtWzAtOV0rLVswLTldKy1bMC05XSstWzAtOV0rJCcgfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgJFVzZXJOYW1lID0gQ29udmVydC1TaWRUb05hbWUgJF8KCiAgICAgICAgICAgICRQYXJ0cyA9ICRVc2VyTmFtZS5TcGxpdCgnXCcpCiAgICAgICAgICAgICRVc2VyRG9tYWluID0gJE51bGwKICAgICAgICAgICAgJFVzZXJOYW1lID0gJFBhcnRzWy0xXQogICAgICAgICAgICBpZiAoJFBhcnRzLkxlbmd0aCAtZXEgMikgewogICAgICAgICAgICAgICAgJFVzZXJEb21haW4gPSAkUGFydHNbMF0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJExvY2FsTG9nZ2VkT25Vc2VyID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAkTG9jYWxMb2dnZWRPblVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAiJENvbXB1dGVyTmFtZSIKICAgICAgICAgICAgJExvY2FsTG9nZ2VkT25Vc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJEb21haW4nICRVc2VyRG9tYWluCiAgICAgICAgICAgICRMb2NhbExvZ2dlZE9uVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyTmFtZScgJFVzZXJOYW1lCiAgICAgICAgICAgICRMb2NhbExvZ2dlZE9uVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyU0lEJyAkXwogICAgICAgICAgICAkTG9jYWxMb2dnZWRPblVzZXIKICAgICAgICB9CiAgICB9CiAgICBjYXRjaCB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3Igb3BlbmluZyByZW1vdGUgcmVnaXN0cnkgb24gJyRDb21wdXRlck5hbWUnIgogICAgfQp9CgoKZmlsdGVyIEdldC1OZXRSRFBTZXNzaW9uIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHdpbGwgZXhlY3V0ZSB0aGUgV1RTRW51bWVyYXRlU2Vzc2lvbnNFeCBhbmQKICAgICAgICBXVFNRdWVyeVNlc3Npb25JbmZvcm1hdGlvbiBXaW4zMkFQSSBjYWxscyB0byBxdWVyeSBhIGdpdmVuCiAgICAgICAgUkRQIHJlbW90ZSBzZXJ2aWNlIGZvciBhY3RpdmUgc2Vzc2lvbnMgYW5kIG9yaWdpbmF0aW5nIElQcy4KICAgICAgICBUaGlzIGlzIGEgcmVwbGFjZW1lbnQgZm9yIHF3aW5zdGEuCgogICAgICAgIE5vdGU6IG9ubHkgbWVtYmVycyBvZiB0aGUgQWRtaW5pc3RyYXRvcnMgb3IgQWNjb3VudCBPcGVyYXRvcnMgbG9jYWwgZ3JvdXAKICAgICAgICBjYW4gc3VjY2Vzc2Z1bGx5IGV4ZWN1dGUgdGhpcyBmdW5jdGlvbmFsaXR5IG9uIGEgcmVtb3RlIHRhcmdldC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBUaGUgaG9zdG5hbWUgdG8gcXVlcnkgZm9yIGFjdGl2ZSBSRFAgc2Vzc2lvbnMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0UkRQU2Vzc2lvbgoKICAgICAgICBSZXR1cm5zIGFjdGl2ZSBSRFAvdGVybWluYWwgc2Vzc2lvbnMgb24gdGhlIGxvY2FsIGhvc3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0UkRQU2Vzc2lvbiAtQ29tcHV0ZXJOYW1lICJzcWxzZXJ2ZXIiCgogICAgICAgIFJldHVybnMgYWN0aXZlIFJEUC90ZXJtaW5hbCBzZXNzaW9ucyBvbiB0aGUgJ3NxbHNlcnZlcicgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXREb21haW5Db250cm9sbGVyIHwgR2V0LU5ldFJEUFNlc3Npb24KCiAgICAgICAgUmV0dXJucyBhY3RpdmUgUkRQL3Rlcm1pbmFsIHNlc3Npb25zIG9uIGFsbCBkb21haW4gY29udHJvbGxlcnMuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbT2JqZWN0W11dCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJ2xvY2FsaG9zdCcKICAgICkKCiAgICAjIGV4dHJhY3QgdGhlIGNvbXB1dGVyIG5hbWUgZnJvbSB3aGF0ZXZlciBvYmplY3Qgd2FzIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICRDb21wdXRlciA9ICRDb21wdXRlck5hbWUgfCBHZXQtTmFtZUZpZWxkCgogICAgIyBvcGVuIHVwIGEgaGFuZGxlIHRvIHRoZSBSZW1vdGUgRGVza3RvcCBTZXNzaW9uIGhvc3QKICAgICRIYW5kbGUgPSAkV3RzYXBpMzI6OldUU09wZW5TZXJ2ZXJFeCgkQ29tcHV0ZXIpCgogICAgIyBpZiB3ZSBnZXQgYSBub24temVybyBoYW5kbGUgYmFjaywgZXZlcnl0aGluZyB3YXMgc3VjY2Vzc2Z1bAogICAgaWYgKCRIYW5kbGUgLW5lIDApIHsKCiAgICAgICAgIyBhcmd1bWVudHMgZm9yIFdUU0VudW1lcmF0ZVNlc3Npb25zRXgKICAgICAgICAkcHBTZXNzaW9uSW5mbyA9IFtJbnRQdHJdOjpaZXJvCiAgICAgICAgJHBDb3VudCA9IDAKCiAgICAgICAgIyBnZXQgaW5mb3JtYXRpb24gb24gYWxsIGN1cnJlbnQgc2Vzc2lvbnMKICAgICAgICAkUmVzdWx0ID0gJFd0c2FwaTMyOjpXVFNFbnVtZXJhdGVTZXNzaW9uc0V4KCRIYW5kbGUsIFtyZWZdMSwgMCwgW3JlZl0kcHBTZXNzaW9uSW5mbywgW3JlZl0kcENvdW50KTskTGFzdEVycm9yID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXRMYXN0V2luMzJFcnJvcigpCgogICAgICAgICMgTG9jYXRlIHRoZSBvZmZzZXQgb2YgdGhlIGluaXRpYWwgaW50UHRyCiAgICAgICAgJE9mZnNldCA9ICRwcFNlc3Npb25JbmZvLlRvSW50NjQoKQoKICAgICAgICBpZiAoKCRSZXN1bHQgLW5lIDApIC1hbmQgKCRPZmZzZXQgLWd0IDApKSB7CgogICAgICAgICAgICAjIFdvcmsgb3V0IGhvdyBtdXRjaCB0byBpbmNyZW1lbnQgdGhlIHBvaW50ZXIgYnkgZmluZGluZyBvdXQgdGhlIHNpemUgb2YgdGhlIHN0cnVjdHVyZQogICAgICAgICAgICAkSW5jcmVtZW50ID0gJFdUU19TRVNTSU9OX0lORk9fMTo6R2V0U2l6ZSgpCgogICAgICAgICAgICAjIHBhcnNlIGFsbCB0aGUgcmVzdWx0IHN0cnVjdHVyZXMKICAgICAgICAgICAgZm9yICgkaSA9IDA7ICgkaSAtbHQgJHBDb3VudCk7ICRpKyspIHsKCiAgICAgICAgICAgICAgICAjIGNyZWF0ZSBhIG5ldyBpbnQgcHRyIGF0IHRoZSBnaXZlbiBvZmZzZXQgYW5kIGNhc3QgdGhlIHBvaW50ZXIgYXMgb3VyIHJlc3VsdCBzdHJ1Y3R1cmUKICAgICAgICAgICAgICAgICROZXdJbnRQdHIgPSBOZXctT2JqZWN0IFN5c3RlbS5JbnRwdHIgLUFyZ3VtZW50TGlzdCAkT2Zmc2V0CiAgICAgICAgICAgICAgICAkSW5mbyA9ICROZXdJbnRQdHIgLWFzICRXVFNfU0VTU0lPTl9JTkZPXzEKCiAgICAgICAgICAgICAgICAkUkRQU2Vzc2lvbiA9IE5ldy1PYmplY3QgUFNPYmplY3QKCiAgICAgICAgICAgICAgICBpZiAoJEluZm8ucEhvc3ROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgJFJEUFNlc3Npb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkSW5mby5wSG9zdE5hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICMgaWYgbm8gaG9zdG5hbWUgcmV0dXJuZWQsIHVzZSB0aGUgc3BlY2lmaWVkIGhvc3RuYW1lCiAgICAgICAgICAgICAgICAgICAgJFJEUFNlc3Npb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkUkRQU2Vzc2lvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTZXNzaW9uTmFtZScgJEluZm8ucFNlc3Npb25OYW1lCgogICAgICAgICAgICAgICAgaWYgKCQoLW5vdCAkSW5mby5wRG9tYWluTmFtZSkgLW9yICgkSW5mby5wRG9tYWluTmFtZSAtZXEgJycpKSB7CiAgICAgICAgICAgICAgICAgICAgIyBpZiBhIGRvbWFpbiBpc24ndCByZXR1cm5lZCBqdXN0IHVzZSB0aGUgdXNlcm5hbWUKICAgICAgICAgICAgICAgICAgICAkUkRQU2Vzc2lvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyTmFtZScgIiQoJEluZm8ucFVzZXJOYW1lKSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRSRFBTZXNzaW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJOYW1lJyAiJCgkSW5mby5wRG9tYWluTmFtZSlcJCgkSW5mby5wVXNlck5hbWUpIgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRSRFBTZXNzaW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lEJyAkSW5mby5TZXNzaW9uSUQKICAgICAgICAgICAgICAgICRSRFBTZXNzaW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1N0YXRlJyAkSW5mby5TdGF0ZQoKICAgICAgICAgICAgICAgICRwcEJ1ZmZlciA9IFtJbnRQdHJdOjpaZXJvCiAgICAgICAgICAgICAgICAkcEJ5dGVzUmV0dXJuZWQgPSAwCgogICAgICAgICAgICAgICAgIyBxdWVyeSBmb3IgdGhlIHNvdXJjZSBjbGllbnQgSVAgd2l0aCBXVFNRdWVyeVNlc3Npb25JbmZvcm1hdGlvbgogICAgICAgICAgICAgICAgIyAgIGh0dHBzOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvYWEzODM4NjEodj12cy44NSkuYXNweAogICAgICAgICAgICAgICAgJFJlc3VsdDIgPSAkV3RzYXBpMzI6OldUU1F1ZXJ5U2Vzc2lvbkluZm9ybWF0aW9uKCRIYW5kbGUsICRJbmZvLlNlc3Npb25JRCwgMTQsIFtyZWZdJHBwQnVmZmVyLCBbcmVmXSRwQnl0ZXNSZXR1cm5lZCk7JExhc3RFcnJvcjIgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkdldExhc3RXaW4zMkVycm9yKCkKCiAgICAgICAgICAgICAgICBpZigkUmVzdWx0IC1lcSAwKSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3I6ICQoKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJExhc3RFcnJvcjIpLk1lc3NhZ2UpIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJE9mZnNldDIgPSAkcHBCdWZmZXIuVG9JbnQ2NCgpCiAgICAgICAgICAgICAgICAgICAgJE5ld0ludFB0cjIgPSBOZXctT2JqZWN0IFN5c3RlbS5JbnRwdHIgLUFyZ3VtZW50TGlzdCAkT2Zmc2V0MgogICAgICAgICAgICAgICAgICAgICRJbmZvMiA9ICROZXdJbnRQdHIyIC1hcyAkV1RTX0NMSUVOVF9BRERSRVNTCgogICAgICAgICAgICAgICAgICAgICRTb3VyY2VJUCA9ICRJbmZvMi5BZGRyZXNzCiAgICAgICAgICAgICAgICAgICAgaWYoJFNvdXJjZUlQWzJdIC1uZSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRTb3VyY2VJUCA9IFtTdHJpbmddJFNvdXJjZUlQWzJdKyIuIitbU3RyaW5nXSRTb3VyY2VJUFszXSsiLiIrW1N0cmluZ10kU291cmNlSVBbNF0rIi4iK1tTdHJpbmddJFNvdXJjZUlQWzVdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkU291cmNlSVAgPSAkTnVsbAogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJFJEUFNlc3Npb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU291cmNlSVAnICRTb3VyY2VJUAogICAgICAgICAgICAgICAgICAgICRSRFBTZXNzaW9uCgogICAgICAgICAgICAgICAgICAgICMgZnJlZSB1cCB0aGUgbWVtb3J5IGJ1ZmZlcgogICAgICAgICAgICAgICAgICAgICROdWxsID0gJFd0c2FwaTMyOjpXVFNGcmVlTWVtb3J5KCRwcEJ1ZmZlcikKCiAgICAgICAgICAgICAgICAgICAgJE9mZnNldCArPSAkSW5jcmVtZW50CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgIyBmcmVlIHVwIHRoZSBtZW1vcnkgcmVzdWx0IGJ1ZmZlcgogICAgICAgICAgICAkTnVsbCA9ICRXdHNhcGkzMjo6V1RTRnJlZU1lbW9yeUV4KDIsICRwcFNlc3Npb25JbmZvLCAkcENvdW50KQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3I6ICQoKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJExhc3RFcnJvcikuTWVzc2FnZSkiCiAgICAgICAgfQogICAgICAgICMgQ2xvc2Ugb2ZmIHRoZSBzZXJ2aWNlIGhhbmRsZQogICAgICAgICROdWxsID0gJFd0c2FwaTMyOjpXVFNDbG9zZVNlcnZlcigkSGFuZGxlKQogICAgfQogICAgZWxzZSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3Igb3BlbmluZyB0aGUgUmVtb3RlIERlc2t0b3AgU2Vzc2lvbiBIb3N0IChSRCBTZXNzaW9uIEhvc3QpIHNlcnZlciBmb3I6ICRDb21wdXRlck5hbWUiCiAgICB9Cn0KCgpmaWx0ZXIgSW52b2tlLUNoZWNrTG9jYWxBZG1pbkFjY2VzcyB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiB3aWxsIHVzZSB0aGUgT3BlblNDTWFuYWdlclcgV2luMzJBUEkgY2FsbCB0byBlc3RhYmxpc2gKICAgICAgICBhIGhhbmRsZSB0byB0aGUgcmVtb3RlIGhvc3QuIElmIHRoaXMgc3VjY2VlZHMsIHRoZSBjdXJyZW50IHVzZXIgY29udGV4dAogICAgICAgIGhhcyBsb2NhbCBhZG1pbmlzdHJhdG9yIGFjZXNzIHRvIHRoZSB0YXJnZXQuCgogICAgICAgIElkZWEgc3RvbGVuIGZyb20gdGhlIGxvY2FsX2FkbWluX3NlYXJjaF9lbnVtIHBvc3QgbW9kdWxlIGluIE1ldGFzcGxvaXQgd3JpdHRlbiBieToKICAgICAgICAgICAgJ0JyYW5kb24gTWNDYW5uICJ6ZWtub3giIDxibWNjYW5uW2F0XWFjY3V2YW50LmNvbT4nCiAgICAgICAgICAgICdUaG9tYXMgTWNDYXJ0aHkgInNtaWxpbmdyYWNjb29uIiA8c21pbGluZ3JhY2Nvb25bYXRdZ21haWwuY29tPicKICAgICAgICAgICAgJ1JveWNlIERhdmlzICJyM2R5IiA8cmRhdmlzW2F0XWFjY3V2YW50LmNvbT4nCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGhvc3RuYW1lIHRvIHF1ZXJ5IGZvciBhY3RpdmUgc2Vzc2lvbnMuCgogICAgLk9VVFBVVFMKCiAgICAgICAgJFRydWUgaWYgdGhlIGN1cnJlbnQgdXNlciBoYXMgbG9jYWwgYWRtaW4gYWNjZXNzIHRvIHRoZSBob3N0bmFtZSwgJEZhbHNlIG90aGVyd2lzZQoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLUNoZWNrTG9jYWxBZG1pbkFjY2VzcyAtQ29tcHV0ZXJOYW1lIHNxbHNlcnZlcgoKICAgICAgICBSZXR1cm5zIGFjdGl2ZSBzZXNzaW9ucyBvbiB0aGUgbG9jYWwgaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRDb21wdXRlciB8IEludm9rZS1DaGVja0xvY2FsQWRtaW5BY2Nlc3MKCiAgICAgICAgU2VlcyB3aGF0IG1hY2hpbmVzIGluIHRoZSBkb21haW4gdGhlIGN1cnJlbnQgdXNlciBoYXMgYWNjZXNzIHRvLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9yYXBpZDcvbWV0YXNwbG9pdC1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvbW9kdWxlcy9wb3N0L3dpbmRvd3MvZ2F0aGVyL2xvY2FsX2FkbWluX3NlYXJjaF9lbnVtLnJiCiAgICAgICAgaHR0cDovL3d3dy5wb3dlcnNoZWxsbWFnYXppbmUuY29tLzIwMTQvMDkvMjUvZWFzaWx5LWRlZmluaW5nLWVudW1zLXN0cnVjdHMtYW5kLXdpbjMyLWZ1bmN0aW9ucy1pbi1tZW1vcnkvCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbT2JqZWN0W11dCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJ2xvY2FsaG9zdCcKICAgICkKCiAgICAjIGV4dHJhY3QgdGhlIGNvbXB1dGVyIG5hbWUgZnJvbSB3aGF0ZXZlciBvYmplY3Qgd2FzIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICRDb21wdXRlciA9ICRDb21wdXRlck5hbWUgfCBHZXQtTmFtZUZpZWxkCgogICAgIyAweEYwMDNGIC0gU0NfTUFOQUdFUl9BTExfQUNDRVNTCiAgICAjICAgaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L3dpbmRvd3MvZGVza3RvcC9tczY4NTk4MSh2PXZzLjg1KS5hc3B4CiAgICAkSGFuZGxlID0gJEFkdmFwaTMyOjpPcGVuU0NNYW5hZ2VyVygiXFwkQ29tcHV0ZXIiLCAnU2VydmljZXNBY3RpdmUnLCAweEYwMDNGKTskTGFzdEVycm9yID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXRMYXN0V2luMzJFcnJvcigpCgogICAgV3JpdGUtVmVyYm9zZSAiSW52b2tlLUNoZWNrTG9jYWxBZG1pbkFjY2VzcyBoYW5kbGU6ICRIYW5kbGUiCgogICAgJElzQWRtaW4gPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAkSXNBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgoKICAgICMgaWYgd2UgZ2V0IGEgbm9uLXplcm8gaGFuZGxlIGJhY2ssIGV2ZXJ5dGhpbmcgd2FzIHN1Y2Nlc3NmdWwKICAgIGlmICgkSGFuZGxlIC1uZSAwKSB7CiAgICAgICAgJE51bGwgPSAkQWR2YXBpMzI6OkNsb3NlU2VydmljZUhhbmRsZSgkSGFuZGxlKQogICAgICAgICRJc0FkbWluIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lzQWRtaW4nICRUcnVlCiAgICB9CiAgICBlbHNlIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvcjogJCgoW0NvbXBvbmVudE1vZGVsLldpbjMyRXhjZXB0aW9uXSAkTGFzdEVycm9yKS5NZXNzYWdlKSIKICAgICAgICAkSXNBZG1pbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJc0FkbWluJyAkRmFsc2UKICAgIH0KCiAgICAkSXNBZG1pbgp9CgoKZmlsdGVyIEdldC1TaXRlTmFtZSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiB3aWxsIHVzZSB0aGUgRHNHZXRTaXRlTmFtZSBXaW4zMkFQSSBjYWxsIHRvIGxvb2sgdXAgdGhlCiAgICAgICAgbmFtZSBvZiB0aGUgc2l0ZSB3aGVyZSBhIHNwZWNpZmllZCBjb21wdXRlciByZXNpZGVzLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIFRoZSBob3N0bmFtZSB0byBsb29rIHRoZSBzaXRlIHVwIGZvciwgZGVmYXVsdCB0byBsb2NhbGhvc3QuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtU2l0ZU5hbWUgLUNvbXB1dGVyTmFtZSBXSU5ET1dTMQoKICAgICAgICBSZXR1cm5zIHRoZSBzaXRlIGZvciBXSU5ET1dTMS50ZXN0bGFiLmxvY2FsLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldENvbXB1dGVyIHwgSW52b2tlLUNoZWNrTG9jYWxBZG1pbkFjY2VzcwoKICAgICAgICBSZXR1cm5zIHRoZSBzaXRlcyBmb3IgZXZlcnkgbWFjaGluZSBpbiBBRC4KIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3ROYW1lJyldCiAgICAgICAgW09iamVjdFtdXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJENvbXB1dGVyTmFtZSA9ICRFbnY6Q29tcHV0ZXJOYW1lCiAgICApCgogICAgIyBleHRyYWN0IHRoZSBjb21wdXRlciBuYW1lIGZyb20gd2hhdGV2ZXIgb2JqZWN0IHdhcyBwYXNzZWQgb24gdGhlIHBpcGVsaW5lCiAgICAkQ29tcHV0ZXIgPSAkQ29tcHV0ZXJOYW1lIHwgR2V0LU5hbWVGaWVsZAoKICAgICMgaWYgd2UgZ2V0IGFuIElQIGFkZHJlc3MsIHRyeSB0byByZXNvbHZlIHRoZSBJUCB0byBhIGhvc3RuYW1lCiAgICBpZigkQ29tcHV0ZXIgLW1hdGNoICdeKD86WzAtOV17MSwzfVwuKXszfVswLTldezEsM30kJykgewogICAgICAgICRJUEFkZHJlc3MgPSAkQ29tcHV0ZXIKICAgICAgICAkQ29tcHV0ZXIgPSBbU3lzdGVtLk5ldC5EbnNdOjpHZXRIb3N0QnlBZGRyZXNzKCRDb21wdXRlcikKICAgIH0KICAgIGVsc2UgewogICAgICAgICRJUEFkZHJlc3MgPSBAKEdldC1JUEFkZHJlc3MgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXIpWzBdLklQQWRkcmVzcwogICAgfQoKICAgICRQdHJJbmZvID0gW0ludFB0cl06Olplcm8KCiAgICAkUmVzdWx0ID0gJE5ldGFwaTMyOjpEc0dldFNpdGVOYW1lKCRDb21wdXRlciwgW3JlZl0kUHRySW5mbykKCiAgICAkQ29tcHV0ZXJTaXRlID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgJENvbXB1dGVyU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgogICAgJENvbXB1dGVyU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJUEFkZHJlc3MnICRJUEFkZHJlc3MKCiAgICBpZiAoJFJlc3VsdCAtZXEgMCkgewogICAgICAgICRTaXRlbmFtZSA9IFtTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlB0clRvU3RyaW5nQXV0bygkUHRySW5mbykKICAgICAgICAkQ29tcHV0ZXJTaXRlIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NpdGVOYW1lJyAkU2l0ZW5hbWUKICAgIH0KICAgIGVsc2UgewogICAgICAgICRFcnJvck1lc3NhZ2UgPSAiRXJyb3I6ICQoKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJFJlc3VsdCkuTWVzc2FnZSkiCiAgICAgICAgJENvbXB1dGVyU2l0ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTaXRlTmFtZScgJEVycm9yTWVzc2FnZQogICAgfQoKICAgICROdWxsID0gJE5ldGFwaTMyOjpOZXRBcGlCdWZmZXJGcmVlKCRQdHJJbmZvKQoKICAgICRDb21wdXRlclNpdGUKfQoKCmZpbHRlciBHZXQtTGFzdExvZ2dlZE9uIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHVzZXMgcmVtb3RlIHJlZ2lzdHJ5IGZ1bmN0aW9uYWxpdHkgdG8gcmV0dXJuCiAgICAgICAgdGhlIGxhc3QgdXNlciBsb2dnZWQgb250byBhIHRhcmdldCBtYWNoaW5lLgoKICAgICAgICBOb3RlOiBUaGlzIGZ1bmN0aW9uIHJlcXVpcmVzIGFkbWluaXN0cmF0aXZlIHJpZ2h0cyBvbiB0aGUKICAgICAgICBtYWNoaW5lIHlvdSdyZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBUaGUgaG9zdG5hbWUgdG8gcXVlcnkgZm9yIHRoZSBsYXN0IGxvZ2dlZCBvbiB1c2VyLgogICAgICAgIERlZmF1bHRzIHRvIHRoZSBsb2NhbGhvc3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBmb3IgdGhlIHJlbW90ZSBjb25uZWN0aW9uLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUxhc3RMb2dnZWRPbgoKICAgICAgICBSZXR1cm5zIHRoZSBsYXN0IHVzZXIgbG9nZ2VkIG9udG8gdGhlIGxvY2FsIG1hY2hpbmUuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTGFzdExvZ2dlZE9uIC1Db21wdXRlck5hbWUgV0lORE9XUzEKCiAgICAgICAgUmV0dXJucyB0aGUgbGFzdCB1c2VyIGxvZ2dlZCBvbnRvIFdJTkRPV1MxCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Q29tcHV0ZXIgfCBHZXQtTGFzdExvZ2dlZE9uCgogICAgICAgIFJldHVybnMgdGhlIGxhc3QgdXNlciBsb2dnZWQgb250byBhbGwgbWFjaGluZXMgaW4gdGhlIGRvbWFpbi4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtPYmplY3RbXV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnbG9jYWxob3N0JywKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICAjIGV4dHJhY3QgdGhlIGNvbXB1dGVyIG5hbWUgZnJvbSB3aGF0ZXZlciBvYmplY3Qgd2FzIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICRDb21wdXRlciA9ICRDb21wdXRlck5hbWUgfCBHZXQtTmFtZUZpZWxkCgogICAgIyBIS0VZX0xPQ0FMX01BQ0hJTkUKICAgICRIS0xNID0gMjE0NzQ4MzY1MAoKICAgICMgdHJ5IHRvIG9wZW4gdXAgdGhlIHJlbW90ZSByZWdpc3RyeSBrZXkgdG8gZ3JhYiB0aGUgbGFzdCBsb2dnZWQgb24gdXNlcgogICAgdHJ5IHsKCiAgICAgICAgaWYoJENyZWRlbnRpYWwpIHsKICAgICAgICAgICAgJFJlZyA9IEdldC1XbWlPYmplY3QgLUxpc3QgJ1N0ZFJlZ1Byb3YnIC1OYW1lc3BhY2Ugcm9vdFxkZWZhdWx0IC1Db21wdXRlcm5hbWUgJENvbXB1dGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkUmVnID0gR2V0LVdtaU9iamVjdCAtTGlzdCAnU3RkUmVnUHJvdicgLU5hbWVzcGFjZSByb290XGRlZmF1bHQgLUNvbXB1dGVybmFtZSAkQ29tcHV0ZXIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICB9CgogICAgICAgICRLZXkgPSAiU09GVFdBUkVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cQXV0aGVudGljYXRpb25cTG9nb25VSSIKICAgICAgICAkVmFsdWUgPSAiTGFzdExvZ2dlZE9uVXNlciIKICAgICAgICAkTGFzdFVzZXIgPSAkUmVnLkdldFN0cmluZ1ZhbHVlKCRIS0xNLCAkS2V5LCAkVmFsdWUpLnNWYWx1ZQoKICAgICAgICAkTGFzdExvZ2dlZE9uID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICRMYXN0TG9nZ2VkT24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXIKICAgICAgICAkTGFzdExvZ2dlZE9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0xhc3RMb2dnZWRPbicgJExhc3RVc2VyCiAgICAgICAgJExhc3RMb2dnZWRPbgogICAgfQogICAgY2F0Y2ggewogICAgICAgIFdyaXRlLVdhcm5pbmcgIlshXSBFcnJvciBvcGVuaW5nIHJlbW90ZSByZWdpc3RyeSBvbiAkQ29tcHV0ZXIuIFJlbW90ZSByZWdpc3RyeSBsaWtlbHkgbm90IGVuYWJsZWQuIgogICAgfQp9CgoKZmlsdGVyIEdldC1DYWNoZWRSRFBDb25uZWN0aW9uIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBVc2VzIHJlbW90ZSByZWdpc3RyeSBmdW5jdGlvbmFsaXR5IHRvIHF1ZXJ5IGFsbCBlbnRyaWVzIGZvciB0aGUKICAgICAgICAiV2luZG93cyBSZW1vdGUgRGVza3RvcCBDb25uZWN0aW9uIENsaWVudCIgb24gYSBtYWNoaW5lLCBzZXBhcmF0ZWQgYnkKICAgICAgICB1c2VyIGFuZCB0YXJnZXQgc2VydmVyLgoKICAgICAgICBOb3RlOiBUaGlzIGZ1bmN0aW9uIHJlcXVpcmVzIGFkbWluaXN0cmF0aXZlIHJpZ2h0cyBvbiB0aGUKICAgICAgICBtYWNoaW5lIHlvdSdyZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBUaGUgaG9zdG5hbWUgdG8gcXVlcnkgZm9yIFJEUCBjbGllbnQgaW5mb3JtYXRpb24uCiAgICAgICAgRGVmYXVsdHMgdG8gbG9jYWxob3N0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3QgZm9yIHRoZSByZW1vdGUgY29ubmVjdGlvbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1DYWNoZWRSRFBDb25uZWN0aW9uCgogICAgICAgIFJldHVybnMgdGhlIFJEUCBjb25uZWN0aW9uIGNsaWVudCBpbmZvcm1hdGlvbiBmb3IgdGhlIGxvY2FsIG1hY2hpbmUuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtQ2FjaGVkUkRQQ29ubmVjdGlvbiAtQ29tcHV0ZXJOYW1lIFdJTkRPV1MyLnRlc3RsYWIubG9jYWwKCiAgICAgICAgUmV0dXJucyB0aGUgUkRQIGNvbm5lY3Rpb24gY2xpZW50IGluZm9ybWF0aW9uIGZvciB0aGUgV0lORE9XUzIudGVzdGxhYi5sb2NhbCBtYWNoaW5lCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtQ2FjaGVkUkRQQ29ubmVjdGlvbiAtQ29tcHV0ZXJOYW1lIFdJTkRPV1MyLnRlc3RsYWIubG9jYWwgLUNyZWRlbnRpYWwgJENyZWQKCiAgICAgICAgUmV0dXJucyB0aGUgUkRQIGNvbm5lY3Rpb24gY2xpZW50IGluZm9ybWF0aW9uIGZvciB0aGUgV0lORE9XUzIudGVzdGxhYi5sb2NhbCBtYWNoaW5lIHVzaW5nIGFsdGVybmF0ZSBjcmVkZW50aWFscy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRDb21wdXRlciB8IEdldC1DYWNoZWRSRFBDb25uZWN0aW9uCgogICAgICAgIEdldCBjYWNoZWQgUkRQIGluZm9ybWF0aW9uIGZvciBhbGwgbWFjaGluZXMgaW4gdGhlIGRvbWFpbi4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtPYmplY3RbXV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnbG9jYWxob3N0JywKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICAjIGV4dHJhY3QgdGhlIGNvbXB1dGVyIG5hbWUgZnJvbSB3aGF0ZXZlciBvYmplY3Qgd2FzIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICRDb21wdXRlciA9ICRDb21wdXRlck5hbWUgfCBHZXQtTmFtZUZpZWxkCgogICAgIyBIS0VZX1VTRVJTCiAgICAkSEtVID0gMjE0NzQ4MzY1MQoKICAgIHRyeSB7CiAgICAgICAgaWYoJENyZWRlbnRpYWwpIHsKICAgICAgICAgICAgJFJlZyA9IEdldC1XbWlPYmplY3QgLUxpc3QgJ1N0ZFJlZ1Byb3YnIC1OYW1lc3BhY2Ugcm9vdFxkZWZhdWx0IC1Db21wdXRlcm5hbWUgJENvbXB1dGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkUmVnID0gR2V0LVdtaU9iamVjdCAtTGlzdCAnU3RkUmVnUHJvdicgLU5hbWVzcGFjZSByb290XGRlZmF1bHQgLUNvbXB1dGVybmFtZSAkQ29tcHV0ZXIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICB9CgogICAgICAgICMgZXh0cmFjdCBvdXQgdGhlIFNJRHMgb2YgZG9tYWluIHVzZXJzIGluIHRoaXMgaGl2ZQogICAgICAgICRVc2VyU0lEcyA9ICgkUmVnLkVudW1LZXkoJEhLVSwgIiIpKS5zTmFtZXMgfCA/IHsgJF8gLW1hdGNoICdTLTEtNS0yMS1bMC05XSstWzAtOV0rLVswLTldKy1bMC05XSskJyB9CgogICAgICAgIGZvcmVhY2ggKCRVc2VyU0lEIGluICRVc2VyU0lEcykgewoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRVc2VyTmFtZSA9IENvbnZlcnQtU2lkVG9OYW1lICRVc2VyU0lECgogICAgICAgICAgICAgICAgIyBwdWxsIG91dCBhbGwgdGhlIGNhY2hlZCBSRFAgY29ubmVjdGlvbnMKICAgICAgICAgICAgICAgICRDb25uZWN0aW9uS2V5cyA9ICRSZWcuRW51bVZhbHVlcygkSEtVLCIkVXNlclNJRFxTb2Z0d2FyZVxNaWNyb3NvZnRcVGVybWluYWwgU2VydmVyIENsaWVudFxEZWZhdWx0Iikuc05hbWVzCgogICAgICAgICAgICAgICAgZm9yZWFjaCAoJENvbm5lY3Rpb24gaW4gJENvbm5lY3Rpb25LZXlzKSB7CiAgICAgICAgICAgICAgICAgICAgIyBtYWtlIHN1cmUgdGhpcyBrZXkgaXMgYSBjYWNoZWQgY29ubmVjdGlvbgogICAgICAgICAgICAgICAgICAgIGlmKCRDb25uZWN0aW9uIC1tYXRjaCAnTVJVLionKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRUYXJnZXRTZXJ2ZXIgPSAkUmVnLkdldFN0cmluZ1ZhbHVlKCRIS1UsICIkVXNlclNJRFxTb2Z0d2FyZVxNaWNyb3NvZnRcVGVybWluYWwgU2VydmVyIENsaWVudFxEZWZhdWx0IiwgJENvbm5lY3Rpb24pLnNWYWx1ZQoKICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kQ29ubmVjdGlvbiA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kQ29ubmVjdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgogICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRDb25uZWN0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJOYW1lJyAkVXNlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kQ29ubmVjdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyU0lEJyAkVXNlclNJRAogICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRDb25uZWN0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RhcmdldFNlcnZlcicgJFRhcmdldFNlcnZlcgogICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRDb25uZWN0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJuYW1lSGludCcgJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kQ29ubmVjdGlvbgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIHB1bGwgb3V0IGFsbCB0aGUgY2FjaGVkIHNlcnZlciBpbmZvIHdpdGggdXNlcm5hbWUgaGludHMKICAgICAgICAgICAgICAgICRTZXJ2ZXJLZXlzID0gJFJlZy5FbnVtS2V5KCRIS1UsIiRVc2VyU0lEXFNvZnR3YXJlXE1pY3Jvc29mdFxUZXJtaW5hbCBTZXJ2ZXIgQ2xpZW50XFNlcnZlcnMiKS5zTmFtZXMKCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkU2VydmVyIGluICRTZXJ2ZXJLZXlzKSB7CgogICAgICAgICAgICAgICAgICAgICRVc2VybmFtZUhpbnQgPSAkUmVnLkdldFN0cmluZ1ZhbHVlKCRIS1UsICIkVXNlclNJRFxTb2Z0d2FyZVxNaWNyb3NvZnRcVGVybWluYWwgU2VydmVyIENsaWVudFxTZXJ2ZXJzXCRTZXJ2ZXIiLCAnVXNlcm5hbWVIaW50Jykuc1ZhbHVlCgogICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgJEZvdW5kQ29ubmVjdGlvbiB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgogICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlck5hbWUnICRVc2VyTmFtZQogICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlclNJRCcgJFVzZXJTSUQKICAgICAgICAgICAgICAgICAgICAkRm91bmRDb25uZWN0aW9uIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RhcmdldFNlcnZlcicgJFNlcnZlcgogICAgICAgICAgICAgICAgICAgICRGb3VuZENvbm5lY3Rpb24gfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlcm5hbWVIaW50JyAkVXNlcm5hbWVIaW50CiAgICAgICAgICAgICAgICAgICAgJEZvdW5kQ29ubmVjdGlvbgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvcjogJF8iCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQogICAgY2F0Y2ggewogICAgICAgIFdyaXRlLVdhcm5pbmcgIkVycm9yIGFjY2Vzc2luZyAkQ29tcHV0ZXIsIGxpa2VseSBpbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMgb3IgZmlyZXdhbGwgcnVsZXMgb24gaG9zdDogJF8iCiAgICB9Cn0KCgpmaWx0ZXIgR2V0LVJlZ2lzdHJ5TW91bnRlZERyaXZlIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBVc2VzIHJlbW90ZSByZWdpc3RyeSBmdW5jdGlvbmFsaXR5IHRvIHF1ZXJ5IGFsbCBlbnRyaWVzIGZvciB0aGUKICAgICAgICB0aGUgc2F2ZWQgbmV0d29yayBtb3VudGVkIGRyaXZlIG9uIGEgbWFjaGluZSwgc2VwYXJhdGVkIGJ5CiAgICAgICAgdXNlciBhbmQgdGFyZ2V0IHNlcnZlci4KCiAgICAgICAgTm90ZTogVGhpcyBmdW5jdGlvbiByZXF1aXJlcyBhZG1pbmlzdHJhdGl2ZSByaWdodHMgb24gdGhlCiAgICAgICAgbWFjaGluZSB5b3UncmUgZW51bWVyYXRpbmcuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGhvc3RuYW1lIHRvIHF1ZXJ5IGZvciBSRFAgY2xpZW50IGluZm9ybWF0aW9uLgogICAgICAgIERlZmF1bHRzIHRvIGxvY2FsaG9zdC4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IGZvciB0aGUgcmVtb3RlIGNvbm5lY3Rpb24uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtUmVnaXN0cnlNb3VudGVkRHJpdmUKCiAgICAgICAgUmV0dXJucyB0aGUgc2F2ZWQgbmV0d29yayBtb3VudGVkIGRyaXZlcyBmb3IgdGhlIGxvY2FsIG1hY2hpbmUuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtUmVnaXN0cnlNb3VudGVkRHJpdmUgLUNvbXB1dGVyTmFtZSBXSU5ET1dTMi50ZXN0bGFiLmxvY2FsCgogICAgICAgIFJldHVybnMgdGhlIHNhdmVkIG5ldHdvcmsgbW91bnRlZCBkcml2ZXMgZm9yIHRoZSBXSU5ET1dTMi50ZXN0bGFiLmxvY2FsIG1hY2hpbmUKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1SZWdpc3RyeU1vdW50ZWREcml2ZSAtQ29tcHV0ZXJOYW1lIFdJTkRPV1MyLnRlc3RsYWIubG9jYWwgLUNyZWRlbnRpYWwgJENyZWQKCiAgICAgICAgUmV0dXJucyB0aGUgc2F2ZWQgbmV0d29yayBtb3VudGVkIGRyaXZlcyBmb3IgdGhlIFdJTkRPV1MyLnRlc3RsYWIubG9jYWwgbWFjaGluZSB1c2luZyBhbHRlcm5hdGUgY3JlZGVudGlhbHMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Q29tcHV0ZXIgfCBHZXQtUmVnaXN0cnlNb3VudGVkRHJpdmUKCiAgICAgICAgR2V0IHRoZSBzYXZlZCBuZXR3b3JrIG1vdW50ZWQgZHJpdmVzIGZvciBhbGwgbWFjaGluZXMgaW4gdGhlIGRvbWFpbi4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0TmFtZScpXQogICAgICAgIFtPYmplY3RbXV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnbG9jYWxob3N0JywKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICAjIGV4dHJhY3QgdGhlIGNvbXB1dGVyIG5hbWUgZnJvbSB3aGF0ZXZlciBvYmplY3Qgd2FzIHBhc3NlZCBvbiB0aGUgcGlwZWxpbmUKICAgICRDb21wdXRlciA9ICRDb21wdXRlck5hbWUgfCBHZXQtTmFtZUZpZWxkCgogICAgIyBIS0VZX1VTRVJTCiAgICAkSEtVID0gMjE0NzQ4MzY1MQoKICAgIHRyeSB7CiAgICAgICAgaWYoJENyZWRlbnRpYWwpIHsKICAgICAgICAgICAgJFJlZyA9IEdldC1XbWlPYmplY3QgLUxpc3QgJ1N0ZFJlZ1Byb3YnIC1OYW1lc3BhY2Ugcm9vdFxkZWZhdWx0IC1Db21wdXRlcm5hbWUgJENvbXB1dGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkUmVnID0gR2V0LVdtaU9iamVjdCAtTGlzdCAnU3RkUmVnUHJvdicgLU5hbWVzcGFjZSByb290XGRlZmF1bHQgLUNvbXB1dGVybmFtZSAkQ29tcHV0ZXIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICB9CgogICAgICAgICMgZXh0cmFjdCBvdXQgdGhlIFNJRHMgb2YgZG9tYWluIHVzZXJzIGluIHRoaXMgaGl2ZQogICAgICAgICRVc2VyU0lEcyA9ICgkUmVnLkVudW1LZXkoJEhLVSwgIiIpKS5zTmFtZXMgfCA/IHsgJF8gLW1hdGNoICdTLTEtNS0yMS1bMC05XSstWzAtOV0rLVswLTldKy1bMC05XSskJyB9CgogICAgICAgIGZvcmVhY2ggKCRVc2VyU0lEIGluICRVc2VyU0lEcykgewoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRVc2VyTmFtZSA9IENvbnZlcnQtU2lkVG9OYW1lICRVc2VyU0lECgogICAgICAgICAgICAgICAgJERyaXZlTGV0dGVycyA9ICgkUmVnLkVudW1LZXkoJEhLVSwgIiRVc2VyU0lEXE5ldHdvcmsiKSkuc05hbWVzCgogICAgICAgICAgICAgICAgRm9yRWFjaCgkRHJpdmVMZXR0ZXIgaW4gJERyaXZlTGV0dGVycykgewogICAgICAgICAgICAgICAgICAgICRQcm92aWRlck5hbWUgPSAkUmVnLkdldFN0cmluZ1ZhbHVlKCRIS1UsICIkVXNlclNJRFxOZXR3b3JrXCREcml2ZUxldHRlciIsICdQcm92aWRlck5hbWUnKS5zVmFsdWUKICAgICAgICAgICAgICAgICAgICAkUmVtb3RlUGF0aCA9ICRSZWcuR2V0U3RyaW5nVmFsdWUoJEhLVSwgIiRVc2VyU0lEXE5ldHdvcmtcJERyaXZlTGV0dGVyIiwgJ1JlbW90ZVBhdGgnKS5zVmFsdWUKICAgICAgICAgICAgICAgICAgICAkRHJpdmVVc2VyTmFtZSA9ICRSZWcuR2V0U3RyaW5nVmFsdWUoJEhLVSwgIiRVc2VyU0lEXE5ldHdvcmtcJERyaXZlTGV0dGVyIiwgJ1VzZXJOYW1lJykuc1ZhbHVlCiAgICAgICAgICAgICAgICAgICAgaWYoLW5vdCAkVXNlck5hbWUpIHsgJFVzZXJOYW1lID0gJycgfQoKICAgICAgICAgICAgICAgICAgICBpZigkUmVtb3RlUGF0aCAtYW5kICgkUmVtb3RlUGF0aCAtbmUgJycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRNb3VudGVkRHJpdmUgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICRNb3VudGVkRHJpdmUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgJE1vdW50ZWREcml2ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyTmFtZScgJFVzZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRNb3VudGVkRHJpdmUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlclNJRCcgJFVzZXJTSUQKICAgICAgICAgICAgICAgICAgICAgICAgJE1vdW50ZWREcml2ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEcml2ZUxldHRlcicgJERyaXZlTGV0dGVyCiAgICAgICAgICAgICAgICAgICAgICAgICRNb3VudGVkRHJpdmUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUHJvdmlkZXJOYW1lJyAkUHJvdmlkZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRNb3VudGVkRHJpdmUgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUmVtb3RlUGF0aCcgJFJlbW90ZVBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgJE1vdW50ZWREcml2ZSB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEcml2ZVVzZXJOYW1lJyAkRHJpdmVVc2VyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkTW91bnRlZERyaXZlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yOiAkXyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGNhdGNoIHsKICAgICAgICBXcml0ZS1XYXJuaW5nICJFcnJvciBhY2Nlc3NpbmcgJENvbXB1dGVyLCBsaWtlbHkgaW5zdWZmaWNpZW50IHBlcm1pc3Npb25zIG9yIGZpcmV3YWxsIHJ1bGVzIG9uIGhvc3Q6ICRfIgogICAgfQp9CgoKZmlsdGVyIEdldC1OZXRQcm9jZXNzIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBHZXRzIGEgbGlzdCBvZiBwcm9jZXNzZXMvb3duZXJzIG9uIGEgcmVtb3RlIG1hY2hpbmUuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgVGhlIGhvc3RuYW1lIHRvIHF1ZXJ5IHByb2Nlc3Nlcy4gRGVmYXVsdHMgdG8gdGhlIGxvY2FsIGhvc3QgbmFtZS4KCiAgICAuUEFSQU1FVEVSIENyZWRlbnRpYWwKCiAgICAgICAgQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IGZvciB0aGUgcmVtb3RlIGNvbm5lY3Rpb24uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0UHJvY2VzcyAtQ29tcHV0ZXJOYW1lIFdJTkRPV1MxCgogICAgICAgIFJldHVybnMgdGhlIGN1cnJlbnQgcHJvY2Vzc2VzIGZvciBXSU5ET1dTMQojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3ROYW1lJyldCiAgICAgICAgW09iamVjdFtdXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJENvbXB1dGVyTmFtZSA9IFtTeXN0ZW0uTmV0LkRuc106OkdldEhvc3ROYW1lKCksCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgIyBleHRyYWN0IHRoZSBjb21wdXRlciBuYW1lIGZyb20gd2hhdGV2ZXIgb2JqZWN0IHdhcyBwYXNzZWQgb24gdGhlIHBpcGVsaW5lCiAgICAkQ29tcHV0ZXIgPSAkQ29tcHV0ZXJOYW1lIHwgR2V0LU5hbWVGaWVsZAoKICAgIHRyeSB7CiAgICAgICAgaWYoJENyZWRlbnRpYWwpIHsKICAgICAgICAgICAgJFByb2Nlc3NlcyA9IEdldC1XTUlvYmplY3QgLUNsYXNzIFdpbjMyX3Byb2Nlc3MgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1DcmVkZW50aWFsICRDcmVkZW50aWFsCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkUHJvY2Vzc2VzID0gR2V0LVdNSW9iamVjdCAtQ2xhc3MgV2luMzJfcHJvY2VzcyAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICB9CgogICAgICAgICRQcm9jZXNzZXMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICRPd25lciA9ICRfLmdldG93bmVyKCk7CiAgICAgICAgICAgICRQcm9jZXNzID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAkUHJvY2VzcyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlcgogICAgICAgICAgICAkUHJvY2VzcyB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdQcm9jZXNzTmFtZScgJF8uUHJvY2Vzc05hbWUKICAgICAgICAgICAgJFByb2Nlc3MgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnUHJvY2Vzc0lEJyAkXy5Qcm9jZXNzSUQKICAgICAgICAgICAgJFByb2Nlc3MgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRG9tYWluJyAkT3duZXIuRG9tYWluCiAgICAgICAgICAgICRQcm9jZXNzIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXInICRPd25lci5Vc2VyCiAgICAgICAgICAgICRQcm9jZXNzCiAgICAgICAgfQogICAgfQogICAgY2F0Y2ggewogICAgICAgIFdyaXRlLVZlcmJvc2UgIlshXSBFcnJvciBlbnVtZXJhdGluZyByZW1vdGUgcHJvY2Vzc2VzIG9uICRDb21wdXRlciwgYWNjZXNzIGxpa2VseSBkZW5pZWQ6ICRfIgogICAgfQp9CgoKZnVuY3Rpb24gRmluZC1JbnRlcmVzdGluZ0ZpbGUgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFRoaXMgZnVuY3Rpb24gcmVjdXJzaXZlbHkgc2VhcmNoZXMgYSBnaXZlbiBVTkMgcGF0aCBmb3IgZmlsZXMgd2l0aAogICAgICAgIHNwZWNpZmljIGtleXdvcmRzIGluIHRoZSBuYW1lIChkZWZhdWx0IG9mIHBhc3MsIHNlbnNpdGl2ZSwgc2VjcmV0LCBhZG1pbiwKICAgICAgICBsb2dpbiBhbmQgdW5hdHRlbmQqLnhtbCkuIFRoZSBvdXRwdXQgY2FuIGJlIHBpcGVkIG91dCB0byBhIGNzdiB3aXRoIHRoZQogICAgICAgIC1PdXRGaWxlIGZsYWcuIEJ5IGRlZmF1bHQsIGhpZGRlbiBmaWxlcy9mb2xkZXJzIGFyZSBpbmNsdWRlZCBpbiBzZWFyY2ggcmVzdWx0cy4KCiAgICAuUEFSQU1FVEVSIFBhdGgKCiAgICAgICAgVU5DL2xvY2FsIHBhdGggdG8gcmVjdXJzaXZlbHkgc2VhcmNoLgoKICAgIC5QQVJBTUVURVIgVGVybXMKCiAgICAgICAgVGVybXMgdG8gc2VhcmNoIGZvci4KCiAgICAuUEFSQU1FVEVSIE9mZmljZURvY3MKCiAgICAgICAgU3dpdGNoLiBTZWFyY2ggZm9yIG9mZmljZSBkb2N1bWVudHMgKCouZG9jKiwgKi54bHMqLCAqLnBwdCopCgogICAgLlBBUkFNRVRFUiBGcmVzaEVYRXMKCiAgICAgICAgU3dpdGNoLiBGaW5kIC5FWEVzIGFjY2Vzc2VkIHdpdGhpbiB0aGUgbGFzdCB3ZWVrLgoKICAgIC5QQVJBTUVURVIgTGFzdEFjY2Vzc1RpbWUKCiAgICAgICAgT25seSByZXR1cm4gZmlsZXMgd2l0aCBhIExhc3RBY2Nlc3NUaW1lIGdyZWF0ZXIgdGhhbiB0aGlzIGRhdGUgdmFsdWUuCgogICAgLlBBUkFNRVRFUiBMYXN0V3JpdGVUaW1lCgogICAgICAgIE9ubHkgcmV0dXJuIGZpbGVzIHdpdGggYSBMYXN0V3JpdGVUaW1lIGdyZWF0ZXIgdGhhbiB0aGlzIGRhdGUgdmFsdWUuCgogICAgLlBBUkFNRVRFUiBDcmVhdGlvblRpbWUKCiAgICAgICAgT25seSByZXR1cm4gZmlsZXMgd2l0aCBhIENyZWF0aW9uVGltZSBncmVhdGVyIHRoYW4gdGhpcyBkYXRlIHZhbHVlLgoKICAgIC5QQVJBTUVURVIgRXhjbHVkZUZvbGRlcnMKCiAgICAgICAgU3dpdGNoLiBFeGNsdWRlIGZvbGRlcnMgZnJvbSB0aGUgc2VhcmNoIHJlc3VsdHMuCgogICAgLlBBUkFNRVRFUiBFeGNsdWRlSGlkZGVuCgogICAgICAgIFN3aXRjaC4gRXhjbHVkZSBoaWRkZW4gZmlsZXMgYW5kIGZvbGRlcnMgZnJvbSB0aGUgc2VhcmNoIHJlc3VsdHMuCgogICAgLlBBUkFNRVRFUiBDaGVja1dyaXRlQWNjZXNzCgogICAgICAgIFN3aXRjaC4gT25seSByZXR1cm5zIGZpbGVzIHRoZSBjdXJyZW50IHVzZXIgaGFzIHdyaXRlIGFjY2VzcyB0by4KCiAgICAuUEFSQU1FVEVSIE91dEZpbGUKCiAgICAgICAgT3V0cHV0IHJlc3VsdHMgdG8gYSBzcGVjaWZpZWQgY3N2IG91dHB1dCBmaWxlLgoKICAgIC5QQVJBTUVURVIgVXNlUFNEcml2ZQoKICAgICAgICBTd2l0Y2guIE1vdW50IHRhcmdldCByZW1vdGUgcGF0aCB3aXRoIHRlbXBvcmFyeSBQU0RyaXZlcy4KCiAgICAuT1VUUFVUUwoKICAgICAgICBUaGUgZnVsbCBwYXRoLCBvd25lciwgbGFzdGFjY2VzcyB0aW1lLCBsYXN0d3JpdGUgdGltZSwgYW5kIHNpemUgZm9yIGVhY2ggZm91bmQgZmlsZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtSW50ZXJlc3RpbmdGaWxlIC1QYXRoIEM6XEJhY2t1cFwKCiAgICAgICAgUmV0dXJucyBhbnkgZmlsZXMgb24gdGhlIGxvY2FsIHBhdGggQzpcQmFja3VwXCB0aGF0IGhhdmUgdGhlIGRlZmF1bHQKICAgICAgICBzZWFyY2ggdGVybSBzZXQgaW4gdGhlIHRpdGxlLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gRmluZC1JbnRlcmVzdGluZ0ZpbGUgLVBhdGggXFxXSU5ET1dTN1xVc2Vyc1wgLVRlcm1zIHNhbGFyaWVzLGVtYWlsIC1PdXRGaWxlIG91dC5jc3YKCiAgICAgICAgUmV0dXJucyBhbnkgZmlsZXMgb24gdGhlIHJlbW90ZSBwYXRoIFxcV0lORE9XUzdcVXNlcnNcIHRoYXQgaGF2ZSAnc2FsYXJpZXMnCiAgICAgICAgb3IgJ2VtYWlsJyBpbiB0aGUgdGl0bGUsIGFuZCB3cml0ZXMgdGhlIHJlc3VsdHMgb3V0IHRvIGEgY3N2IGZpbGUKICAgICAgICBuYW1lZCAnb3V0LmNzdicKCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEZpbmQtSW50ZXJlc3RpbmdGaWxlIC1QYXRoIFxcV0lORE9XUzdcVXNlcnNcIC1MYXN0QWNjZXNzVGltZSAoR2V0LURhdGUpLkFkZERheXMoLTcpCgogICAgICAgIFJldHVybnMgYW55IGZpbGVzIG9uIHRoZSByZW1vdGUgcGF0aCBcXFdJTkRPV1M3XFVzZXJzXCB0aGF0IGhhdmUgdGhlIGRlZmF1bHQKICAgICAgICBzZWFyY2ggdGVybSBzZXQgaW4gdGhlIHRpdGxlIGFuZCB3ZXJlIGFjY2Vzc2VkIHdpdGhpbiB0aGUgbGFzdCB3ZWVrLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9yZWR0ZWFtaW5nL2ZpbGUtc2VydmVyLXRyaWFnZS1vbi1yZWQtdGVhbS1lbmdhZ2VtZW50cy8KIz4KCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRQYXRoID0gJy5cJywKCiAgICAgICAgW0FsaWFzKCdUZXJtcycpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkU2VhcmNoVGVybXMgPSBAKCdwYXNzJywgJ3NlbnNpdGl2ZScsICdhZG1pbicsICdsb2dpbicsICdzZWNyZXQnLCAndW5hdHRlbmQqLnhtbCcsICcudm1kaycsICdjcmVkcycsICdjcmVkZW50aWFsJywgJy5jb25maWcnKSwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkT2ZmaWNlRG9jcywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRnJlc2hFWEVzLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRMYXN0QWNjZXNzVGltZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkTGFzdFdyaXRlVGltZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ3JlYXRpb25UaW1lLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRFeGNsdWRlRm9sZGVycywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRXhjbHVkZUhpZGRlbiwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQ2hlY2tXcml0ZUFjY2VzcywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkT3V0RmlsZSwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVXNlUFNEcml2ZQogICAgKQoKICAgIGJlZ2luIHsKCiAgICAgICAgJFBhdGggKz0gaWYoISRQYXRoLkVuZHNXaXRoKCdcJykpIHsiXCJ9CgogICAgICAgIGlmICgkQ3JlZGVudGlhbCkgewogICAgICAgICAgICAkVXNlUFNEcml2ZSA9ICRUcnVlCiAgICAgICAgfQoKICAgICAgICAjIGFwcGVuZCB3aWxkY2FyZHMgdG8gdGhlIGZyb250IGFuZCBiYWNrIG9mIGFsbCBzZWFyY2ggdGVybXMKICAgICAgICAkU2VhcmNoVGVybXMgPSAkU2VhcmNoVGVybXMgfCBGb3JFYWNoLU9iamVjdCB7IGlmKCRfIC1ub3RtYXRjaCAnXlwqLipcKiQnKSB7IiokKCRfKSoifSBlbHNleyRffSB9CgogICAgICAgICMgc2VhcmNoIGp1c3QgZm9yIG9mZmljZSBkb2N1bWVudHMgaWYgc3BlY2lmaWVkCiAgICAgICAgaWYgKCRPZmZpY2VEb2NzKSB7CiAgICAgICAgICAgICRTZWFyY2hUZXJtcyA9IEAoJyouZG9jJywgJyouZG9jeCcsICcqLnhscycsICcqLnhsc3gnLCAnKi5wcHQnLCAnKi5wcHR4JykKICAgICAgICB9CgogICAgICAgICMgZmluZCAuZXhlJ3MgYWNjZXNzZWQgd2l0aGluIHRoZSBsYXN0IDcgZGF5cwogICAgICAgIGlmKCRGcmVzaEVYRXMpIHsKICAgICAgICAgICAgIyBnZXQgYW4gYWNjZXNzIHRpbWUgbGltaXQgb2YgNyBkYXlzIGFnbwogICAgICAgICAgICAkTGFzdEFjY2Vzc1RpbWUgPSAoR2V0LURhdGUpLkFkZERheXMoLTcpLlRvU3RyaW5nKCdNTS9kZC95eXl5JykKICAgICAgICAgICAgJFNlYXJjaFRlcm1zID0gJyouZXhlJwogICAgICAgIH0KCiAgICAgICAgaWYoJFVzZVBTRHJpdmUpIHsKICAgICAgICAgICAgIyBpZiB3ZSdyZSBQU0RyaXZlcywgY3JlYXRlIGEgdGVtcG9yYXJ5IG1vdW50IHBvaW50CgogICAgICAgICAgICAkUGFydHMgPSAkUGF0aC5zcGxpdCgnXCcpCiAgICAgICAgICAgICRGb2xkZXJQYXRoID0gJFBhcnRzWzAuLigkUGFydHMubGVuZ3RoLTIpXSAtam9pbiAnXCcKICAgICAgICAgICAgJEZpbGVQYXRoID0gJFBhcnRzWy0xXQoKICAgICAgICAgICAgJFJhbmREcml2ZSA9ICgiYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoiLlRvQ2hhckFycmF5KCkgfCBHZXQtUmFuZG9tIC1Db3VudCA3KSAtam9pbiAnJwoKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiTW91bnRpbmcgcGF0aCAnJFBhdGgnIHVzaW5nIGEgdGVtcCBQU0RyaXZlIGF0ICRSYW5kRHJpdmUiCgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJE51bGwgPSBOZXctUFNEcml2ZSAtTmFtZSAkUmFuZERyaXZlIC1QU1Byb3ZpZGVyIEZpbGVTeXN0ZW0gLVJvb3QgJEZvbGRlclBhdGggLUVycm9yQWN0aW9uIFN0b3AKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBtb3VudGluZyBwYXRoICckUGF0aCcgOiAkXyIKICAgICAgICAgICAgICAgIHJldHVybiAkTnVsbAogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHNvIHdlIGNhbiBjZC9kaXIgdGhlIG5ldyBkcml2ZQogICAgICAgICAgICAkUGF0aCA9ICIke1JhbmREcml2ZX06XCR7RmlsZVBhdGh9IgogICAgICAgIH0KICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFNlYXJjaCBwYXRoICRQYXRoIgoKICAgICAgICBmdW5jdGlvbiBJbnZva2UtQ2hlY2tXcml0ZSB7CiAgICAgICAgICAgICMgc2hvcnQgaGVscGVyIHRvIGNoZWNrIGlzIHRoZSBjdXJyZW50IHVzZXIgY2FuIHdyaXRlIHRvIGEgZmlsZQogICAgICAgICAgICBbQ21kbGV0QmluZGluZygpXXBhcmFtKFtTdHJpbmddJFBhdGgpCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkRmlsZXRlc3QgPSBbSU8uRklMRV06Ok9wZW5Xcml0ZSgkUGF0aCkKICAgICAgICAgICAgICAgICRGaWxldGVzdC5DbG9zZSgpCiAgICAgICAgICAgICAgICAkVHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgJEVycm9yWzBdCiAgICAgICAgICAgICAgICAkRmFsc2UKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJFNlYXJjaEFyZ3MgPSAgQHsKICAgICAgICAgICAgJ1BhdGgnID0gJFBhdGgKICAgICAgICAgICAgJ1JlY3Vyc2UnID0gJFRydWUKICAgICAgICAgICAgJ0ZvcmNlJyA9ICQoLW5vdCAkRXhjbHVkZUhpZGRlbikKICAgICAgICAgICAgJ0luY2x1ZGUnID0gJFNlYXJjaFRlcm1zCiAgICAgICAgICAgICdFcnJvckFjdGlvbicgPSAnU2lsZW50bHlDb250aW51ZScKICAgICAgICB9CgogICAgICAgIEdldC1DaGlsZEl0ZW0gQFNlYXJjaEFyZ3MgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgJF8KICAgICAgICAgICAgIyBjaGVjayBpZiB3ZSdyZSBleGNsdWRpbmcgZm9sZGVycwogICAgICAgICAgICBpZighJEV4Y2x1ZGVGb2xkZXJzIC1vciAhJF8uUFNJc0NvbnRhaW5lcikgeyRffQogICAgICAgIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIGlmKCRMYXN0QWNjZXNzVGltZSAtb3IgJExhc3RXcml0ZVRpbWUgLW9yICRDcmVhdGlvblRpbWUpIHsKICAgICAgICAgICAgICAgIGlmKCRMYXN0QWNjZXNzVGltZSAtYW5kICgkXy5MYXN0QWNjZXNzVGltZSAtZ3QgJExhc3RBY2Nlc3NUaW1lKSkgeyRffQogICAgICAgICAgICAgICAgZWxzZWlmKCRMYXN0V3JpdGVUaW1lIC1hbmQgKCRfLkxhc3RXcml0ZVRpbWUgLWd0ICRMYXN0V3JpdGVUaW1lKSkgeyRffQogICAgICAgICAgICAgICAgZWxzZWlmKCRDcmVhdGlvblRpbWUgLWFuZCAoJF8uQ3JlYXRpb25UaW1lIC1ndCAkQ3JlYXRpb25UaW1lKSkgeyRffQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgeyRffQogICAgICAgIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICMgZmlsdGVyIGZvciB3cml0ZSBhY2Nlc3MgKGlmIGFwcGxpY2FibGUpCiAgICAgICAgICAgIGlmKCgtbm90ICRDaGVja1dyaXRlQWNjZXNzKSAtb3IgKEludm9rZS1DaGVja1dyaXRlIC1QYXRoICRfLkZ1bGxOYW1lKSkgeyRffQogICAgICAgIH0gfCBTZWxlY3QtT2JqZWN0IEZ1bGxOYW1lLEB7TmFtZT0nT3duZXInO0V4cHJlc3Npb249eyhHZXQtQWNsICRfLkZ1bGxOYW1lKS5Pd25lcn19LExhc3RBY2Nlc3NUaW1lLExhc3RXcml0ZVRpbWUsQ3JlYXRpb25UaW1lLExlbmd0aCB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgIyBjaGVjayBpZiB3ZSdyZSBvdXRwdXR0aW5nIHRvIHRoZSBwaXBlbGluZSBvciBhbiBvdXRwdXQgZmlsZQogICAgICAgICAgICBpZigkT3V0RmlsZSkge0V4cG9ydC1Qb3dlclZpZXdDU1YgLUlucHV0T2JqZWN0ICRfIC1PdXRGaWxlICRPdXRGaWxlfQogICAgICAgICAgICBlbHNlIHskX30KICAgICAgICB9CiAgICB9CgogICAgZW5kIHsKICAgICAgICBpZigkVXNlUFNEcml2ZSAtYW5kICRSYW5kRHJpdmUpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiUmVtb3ZpbmcgdGVtcCBQU0RyaXZlICRSYW5kRHJpdmUiCiAgICAgICAgICAgIEdldC1QU0RyaXZlIC1OYW1lICRSYW5kRHJpdmUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgfCBSZW1vdmUtUFNEcml2ZSAtRm9yY2UKICAgICAgICB9CiAgICB9Cn0KCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojCiMgJ01ldGEnLWZ1bmN0aW9ucyBzdGFydCBiZWxvdwojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpmdW5jdGlvbiBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiB7CiAgICAjIEhlbHBlciB1c2VkIGJ5IGFueSB0aHJlYWRlZCBob3N0IGVudW1lcmF0aW9uIGZ1bmN0aW9ucwogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxNYW5kYXRvcnk9JFRydWUpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkQ29tcHV0ZXJOYW1lLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTEsTWFuZGF0b3J5PSRUcnVlKV0KICAgICAgICBbU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5TY3JpcHRCbG9ja10KICAgICAgICAkU2NyaXB0QmxvY2ssCgogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MildCiAgICAgICAgW0hhc2h0YWJsZV0KICAgICAgICAkU2NyaXB0UGFyYW1ldGVycywKCiAgICAgICAgW0ludF0KICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMCldCiAgICAgICAgJFRocmVhZHMgPSAyMCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTm9JbXBvcnRzCiAgICApCgogICAgYmVnaW4gewoKICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydEZWJ1ZyddKSB7CiAgICAgICAgICAgICREZWJ1Z1ByZWZlcmVuY2UgPSAnQ29udGludWUnCiAgICAgICAgfQoKICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gVG90YWwgbnVtYmVyIG9mIGhvc3RzOiAkKCRDb21wdXRlck5hbWUuY291bnQpIgoKICAgICAgICAjIEFkYXB0ZWQgZnJvbToKICAgICAgICAjICAgaHR0cDovL3Bvd2Vyc2hlbGwub3JnL3dwL2ZvcnVtcy90b3BpYy9pbnZwa2UtcGFyYWxsZWwtbmVlZC1oZWxwLXRvLWNsb25lLXRoZS1jdXJyZW50LXJ1bnNwYWNlLwogICAgICAgICRTZXNzaW9uU3RhdGUgPSBbU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5SdW5zcGFjZXMuSW5pdGlhbFNlc3Npb25TdGF0ZV06OkNyZWF0ZURlZmF1bHQoKQogICAgICAgICRTZXNzaW9uU3RhdGUuQXBhcnRtZW50U3RhdGUgPSBbU3lzdGVtLlRocmVhZGluZy5UaHJlYWRdOjpDdXJyZW50VGhyZWFkLkdldEFwYXJ0bWVudFN0YXRlKCkKCiAgICAgICAgIyBpbXBvcnQgdGhlIGN1cnJlbnQgc2Vzc2lvbiBzdGF0ZSdzIHZhcmlhYmxlcyBhbmQgZnVuY3Rpb25zIHNvIHRoZSBjaGFpbmVkIFBvd2VyVmlldwogICAgICAgICMgICBmdW5jdGlvbmFsaXR5IGNhbiBiZSB1c2VkIGJ5IHRoZSB0aHJlYWRlZCBibG9ja3MKICAgICAgICBpZighJE5vSW1wb3J0cykgewoKICAgICAgICAgICAgIyBncmFiIGFsbCB0aGUgY3VycmVudCB2YXJpYWJsZXMgZm9yIHRoaXMgcnVuc3BhY2UKICAgICAgICAgICAgJE15VmFycyA9IEdldC1WYXJpYWJsZSAtU2NvcGUgMgoKICAgICAgICAgICAgIyB0aGVzZSBWYXJpYWJsZXMgYXJlIGFkZGVkIGJ5IFJ1bnNwYWNlLk9wZW4oKSBNZXRob2QgYW5kIHByb2R1Y2UgU3RvcCBlcnJvcnMgaWYgeW91IGFkZCB0aGVtIHR3aWNlCiAgICAgICAgICAgICRWb3JiaWRkZW5WYXJzID0gQCgiPyIsImFyZ3MiLCJDb25zb2xlRmlsZU5hbWUiLCJFcnJvciIsIkV4ZWN1dGlvbkNvbnRleHQiLCJmYWxzZSIsIkhPTUUiLCJIb3N0IiwiaW5wdXQiLCJJbnB1dE9iamVjdCIsIk1heGltdW1BbGlhc0NvdW50IiwiTWF4aW11bURyaXZlQ291bnQiLCJNYXhpbXVtRXJyb3JDb3VudCIsIk1heGltdW1GdW5jdGlvbkNvdW50IiwiTWF4aW11bUhpc3RvcnlDb3VudCIsIk1heGltdW1WYXJpYWJsZUNvdW50IiwiTXlJbnZvY2F0aW9uIiwibnVsbCIsIlBJRCIsIlBTQm91bmRQYXJhbWV0ZXJzIiwiUFNDb21tYW5kUGF0aCIsIlBTQ3VsdHVyZSIsIlBTRGVmYXVsdFBhcmFtZXRlclZhbHVlcyIsIlBTSE9NRSIsIlBTU2NyaXB0Um9vdCIsIlBTVUlDdWx0dXJlIiwiUFNWZXJzaW9uVGFibGUiLCJQV0QiLCJTaGVsbElkIiwiU3luY2hyb25pemVkSGFzaCIsInRydWUiKQoKICAgICAgICAgICAgIyBBZGQgVmFyaWFibGVzIGZyb20gUGFyZW50IFNjb3BlIChjdXJyZW50IHJ1bnNwYWNlKSBpbnRvIHRoZSBJbml0aWFsU2Vzc2lvblN0YXRlCiAgICAgICAgICAgIEZvckVhY2goJFZhciBpbiAkTXlWYXJzKSB7CiAgICAgICAgICAgICAgICBpZigkVm9yYmlkZGVuVmFycyAtTm90Q29udGFpbnMgJFZhci5OYW1lKSB7CiAgICAgICAgICAgICAgICAkU2Vzc2lvblN0YXRlLlZhcmlhYmxlcy5BZGQoKE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUnVuc3BhY2VzLlNlc3Npb25TdGF0ZVZhcmlhYmxlRW50cnkgLUFyZ3VtZW50TGlzdCAkVmFyLm5hbWUsJFZhci5WYWx1ZSwkVmFyLmRlc2NyaXB0aW9uLCRWYXIub3B0aW9ucywkVmFyLmF0dHJpYnV0ZXMpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIEFkZCBGdW5jdGlvbnMgZnJvbSBjdXJyZW50IHJ1bnNwYWNlIHRvIHRoZSBJbml0aWFsU2Vzc2lvblN0YXRlCiAgICAgICAgICAgIEZvckVhY2goJEZ1bmN0aW9uIGluIChHZXQtQ2hpbGRJdGVtIEZ1bmN0aW9uOikpIHsKICAgICAgICAgICAgICAgICRTZXNzaW9uU3RhdGUuQ29tbWFuZHMuQWRkKChOZXctT2JqZWN0IC1UeXBlTmFtZSBTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlJ1bnNwYWNlcy5TZXNzaW9uU3RhdGVGdW5jdGlvbkVudHJ5IC1Bcmd1bWVudExpc3QgJEZ1bmN0aW9uLk5hbWUsICRGdW5jdGlvbi5EZWZpbml0aW9uKSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyB0aHJlYWRpbmcgYWRhcHRlZCBmcm9tCiAgICAgICAgIyBodHRwczovL2dpdGh1Yi5jb20vZGFya29wZXJhdG9yL1Bvc2gtU2VjTW9kL2Jsb2IvbWFzdGVyL0Rpc2NvdmVyeS9EaXNjb3ZlcnkucHNtMSNMNDA3CiAgICAgICAgIyAgIFRoYW5rcyBDYXJsb3MhCgogICAgICAgICMgY3JlYXRlIGEgcG9vbCBvZiBtYXhUaHJlYWQgcnVuc3BhY2VzCiAgICAgICAgJFBvb2wgPSBbcnVuc3BhY2VmYWN0b3J5XTo6Q3JlYXRlUnVuc3BhY2VQb29sKDEsICRUaHJlYWRzLCAkU2Vzc2lvblN0YXRlLCAkSG9zdCkKICAgICAgICAkUG9vbC5PcGVuKCkKCiAgICAgICAgJEpvYnMgPSBAKCkKICAgICAgICAkUFMgPSBAKCkKICAgICAgICAkV2FpdCA9IEAoKQoKICAgICAgICAkQ291bnRlciA9IDAKICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgRm9yRWFjaCAoJENvbXB1dGVyIGluICRDb21wdXRlck5hbWUpIHsKCiAgICAgICAgICAgICMgbWFrZSBzdXJlIHdlIGdldCBhIHNlcnZlciBuYW1lCiAgICAgICAgICAgIGlmICgkQ29tcHV0ZXIgLW5lICcnKSB7CiAgICAgICAgICAgICAgICAjIFdyaXRlLVZlcmJvc2UgIlsqXSBFbnVtZXJhdGluZyBzZXJ2ZXIgJENvbXB1dGVyICgkKCRDb3VudGVyKzEpIG9mICQoJENvbXB1dGVyTmFtZS5jb3VudCkpIgoKICAgICAgICAgICAgICAgIFdoaWxlICgkKCRQb29sLkdldEF2YWlsYWJsZVJ1bnNwYWNlcygpKSAtbGUgMCkgewogICAgICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1NaWxsaVNlY29uZHMgNTAwCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBjcmVhdGUgYSAicG93ZXJzaGVsbCBwaXBlbGluZSBydW5uZXIiCiAgICAgICAgICAgICAgICAkUFMgKz0gW3Bvd2Vyc2hlbGxdOjpjcmVhdGUoKQoKICAgICAgICAgICAgICAgICRQU1skQ291bnRlcl0ucnVuc3BhY2Vwb29sID0gJFBvb2wKCiAgICAgICAgICAgICAgICAjIGFkZCB0aGUgc2NyaXB0IGJsb2NrICsgYXJndW1lbnRzCiAgICAgICAgICAgICAgICAkTnVsbCA9ICRQU1skQ291bnRlcl0uQWRkU2NyaXB0KCRTY3JpcHRCbG9jaykuQWRkUGFyYW1ldGVyKCdDb21wdXRlck5hbWUnLCAkQ29tcHV0ZXIpCiAgICAgICAgICAgICAgICBpZigkU2NyaXB0UGFyYW1ldGVycykgewogICAgICAgICAgICAgICAgICAgIEZvckVhY2ggKCRQYXJhbSBpbiAkU2NyaXB0UGFyYW1ldGVycy5HZXRFbnVtZXJhdG9yKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE51bGwgPSAkUFNbJENvdW50ZXJdLkFkZFBhcmFtZXRlcigkUGFyYW0uTmFtZSwgJFBhcmFtLlZhbHVlKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIHN0YXJ0IGpvYgogICAgICAgICAgICAgICAgJEpvYnMgKz0gJFBTWyRDb3VudGVyXS5CZWdpbkludm9rZSgpOwoKICAgICAgICAgICAgICAgICMgc3RvcmUgd2FpdCBoYW5kbGVzIGZvciBXYWl0Rm9yQWxsIGNhbGwKICAgICAgICAgICAgICAgICRXYWl0ICs9ICRKb2JzWyRDb3VudGVyXS5Bc3luY1dhaXRIYW5kbGUKICAgICAgICAgICAgfQogICAgICAgICAgICAkQ291bnRlciA9ICRDb3VudGVyICsgMQogICAgICAgIH0KICAgIH0KCiAgICBlbmQgewoKICAgICAgICBXcml0ZS1WZXJib3NlICJXYWl0aW5nIGZvciBzY2FubmluZyB0aHJlYWRzIHRvIGZpbmlzaC4uLiIKCiAgICAgICAgJFdhaXRUaW1lb3V0ID0gR2V0LURhdGUKCiAgICAgICAgIyBzZXQgYSA2MCBzZWNvbmQgdGltZW91dCBmb3IgdGhlIHNjYW5uaW5nIHRocmVhZHMKICAgICAgICB3aGlsZSAoJCgkSm9icyB8IFdoZXJlLU9iamVjdCB7JF8uSXNDb21wbGV0ZWQgLWVxICRGYWxzZX0pLmNvdW50IC1ndCAwIC1hbmQgJCgkKCQoR2V0LURhdGUpIC0gJFdhaXRUaW1lb3V0KS50b3RhbFNlY29uZHMpIC1sdCA2MCkgewogICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLU1pbGxpU2Vjb25kcyA1MDAKICAgICAgICAgICAgfQoKICAgICAgICAjIGVuZCBhc3luYyBjYWxsCiAgICAgICAgZm9yICgkeSA9IDA7ICR5IC1sdCAkQ291bnRlcjsgJHkrKykgewoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICMgY29tcGxldGUgYXN5bmMgam9iCiAgICAgICAgICAgICAgICAkUFNbJHldLkVuZEludm9rZSgkSm9ic1skeV0pCgogICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgImVycm9yOiAkXyIKICAgICAgICAgICAgfQogICAgICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICRQU1skeV0uRGlzcG9zZSgpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRQb29sLkRpc3Bvc2UoKQogICAgICAgIFdyaXRlLVZlcmJvc2UgIkFsbCB0aHJlYWRzIGNvbXBsZXRlZCEiCiAgICB9Cn0KCgpmdW5jdGlvbiBJbnZva2UtVXNlckh1bnRlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgRmluZHMgd2hpY2ggbWFjaGluZXMgdXNlcnMgb2YgYSBzcGVjaWZpZWQgZ3JvdXAgYXJlIGxvZ2dlZCBpbnRvLgoKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFRoaXMgZnVuY3Rpb24gZmluZHMgdGhlIGxvY2FsIGRvbWFpbiBuYW1lIGZvciBhIGhvc3QgdXNpbmcgR2V0LU5ldERvbWFpbiwKICAgICAgICBxdWVyaWVzIHRoZSBkb21haW4gZm9yIHVzZXJzIG9mIGEgc3BlY2lmaWVkIGdyb3VwIChkZWZhdWx0ICJkb21haW4gYWRtaW5zIikKICAgICAgICB3aXRoIEdldC1OZXRHcm91cE1lbWJlciBvciByZWFkcyBpbiBhIHRhcmdldCB1c2VyIGxpc3QsIHF1ZXJpZXMgdGhlIGRvbWFpbiBmb3IgYWxsCiAgICAgICAgYWN0aXZlIG1hY2hpbmVzIHdpdGggR2V0LU5ldENvbXB1dGVyIG9yIHJlYWRzIGluIGEgcHJlLXBvcHVsYXRlZCBob3N0IGxpc3QsCiAgICAgICAgcmFuZG9tbHkgc2h1ZmZsZXMgdGhlIHRhcmdldCBsaXN0LCB0aGVuIGZvciBlYWNoIHNlcnZlciBpdCBnZXRzIGEgbGlzdCBvZgogICAgICAgIGFjdGl2ZSB1c2VycyB3aXRoIEdldC1OZXRTZXNzaW9uL0dldC1OZXRMb2dnZWRvbi4gVGhlIGZvdW5kIHVzZXIgbGlzdCBpcyBjb21wYXJlZAogICAgICAgIGFnYWluc3QgdGhlIHRhcmdldCBsaXN0LCBhbmQgYSBzdGF0dXMgbWVzc2FnZSBpcyBkaXNwbGF5ZWQgZm9yIGFueSBoaXRzLgogICAgICAgIFRoZSBmbGFnIC1DaGVja0FjY2VzcyB3aWxsIGNoZWNrIGVhY2ggcG9zaXRpdmUgaG9zdCB0byBzZWUgaWYgdGhlIGN1cnJlbnQKICAgICAgICB1c2VyIGhhcyBsb2NhbCBhZG1pbiBhY2Nlc3MgdG8gdGhlIG1hY2hpbmUuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgSG9zdCBhcnJheSB0byBlbnVtZXJhdGUsIHBhc3NhYmxlIG9uIHRoZSBwaXBlbGluZS4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsZQoKICAgICAgICBGaWxlIG9mIGhvc3RuYW1lcy9JUHMgdG8gc2VhcmNoLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJGaWx0ZXIKCiAgICAgICAgSG9zdCBmaWx0ZXIgbmFtZSB0byBxdWVyeSBBRCBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIGhvc3RzLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgVW5jb25zdHJhaW5lZAoKICAgICAgICBTd2l0Y2guIE9ubHkgZW51bWVyYXRlIGNvbXB1dGVycyB0aGF0IGhhdmUgdW5jb25zdHJhaW5lZCBkZWxlZ2F0aW9uLgoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIEdyb3VwIG5hbWUgdG8gcXVlcnkgZm9yIHRhcmdldCB1c2Vycy4KCiAgICAuUEFSQU1FVEVSIFRhcmdldFNlcnZlcgoKICAgICAgICBIdW50IGZvciB1c2VycyB3aG8gYXJlIGVmZmVjdGl2ZSBsb2NhbCBhZG1pbnMgb24gYSB0YXJnZXQgc2VydmVyLgoKICAgIC5QQVJBTUVURVIgVXNlck5hbWUKCiAgICAgICAgU3BlY2lmaWMgdXNlcm5hbWUgdG8gc2VhcmNoIGZvci4KCiAgICAuUEFSQU1FVEVSIFVzZXJGaWx0ZXIKCiAgICAgICAgQSBjdXN0b21pemVkIGxkYXAgZmlsdGVyIHN0cmluZyB0byB1c2UgZm9yIHVzZXIgZW51bWVyYXRpb24sIGUuZy4gIihkZXNjcmlwdGlvbj0qYWRtaW4qKSIKCiAgICAuUEFSQU1FVEVSIFVzZXJBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCBmb3IgdXNlcnMsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBVc2VyRmlsZQoKICAgICAgICBGaWxlIG9mIHVzZXJuYW1lcyB0byBzZWFyY2ggZm9yLgoKICAgIC5QQVJBTUVURVIgQWRtaW5Db3VudAoKICAgICAgICBTd2l0Y2guIEh1bnQgZm9yIHVzZXJzIHdpdGggYWRtaW5Db3VudD0xLgoKICAgIC5QQVJBTUVURVIgQWxsb3dEZWxlZ2F0aW9uCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIHVzZXIgYWNjb3VudHMgdGhhdCBhcmUgbm90IG1hcmtlZCBhcyAnc2Vuc2l0aXZlIGFuZCBub3QgYWxsb3dlZCBmb3IgZGVsZWdhdGlvbicKCiAgICAuUEFSQU1FVEVSIFN0b3BPblN1Y2Nlc3MKCiAgICAgICAgU3dpdGNoLiBTdG9wIGh1bnRpbmcgYWZ0ZXIgZmluZGluZyBhZnRlciBmaW5kaW5nIGEgdGFyZ2V0IHVzZXIuCgogICAgLlBBUkFNRVRFUiBOb1BpbmcKCiAgICAgICAgRG9uJ3QgcGluZyBlYWNoIGhvc3QgdG8gZW5zdXJlIGl0J3MgdXAgYmVmb3JlIGVudW1lcmF0aW5nLgoKICAgIC5QQVJBTUVURVIgQ2hlY2tBY2Nlc3MKCiAgICAgICAgU3dpdGNoLiBDaGVjayBpZiB0aGUgY3VycmVudCB1c2VyIGhhcyBsb2NhbCBhZG1pbiBhY2Nlc3MgdG8gZm91bmQgbWFjaGluZXMuCgogICAgLlBBUkFNRVRFUiBEZWxheQoKICAgICAgICBEZWxheSBiZXR3ZWVuIGVudW1lcmF0aW5nIGhvc3RzLCBkZWZhdWx0cyB0byAwCgogICAgLlBBUkFNRVRFUiBKaXR0ZXIKCiAgICAgICAgSml0dGVyIGZvciB0aGUgaG9zdCBkZWxheSwgZGVmYXVsdHMgdG8gKy8tIDAuMwoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIERvbWFpbiBmb3IgcXVlcnkgZm9yIG1hY2hpbmVzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBTaG93QWxsCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIGFsbCB1c2VyIGxvY2F0aW9uIHJlc3VsdHMsIGkuZS4gSW52b2tlLVVzZXJWaWV3IGZ1bmN0aW9uYWxpdHkuCgogICAgLlBBUkFNRVRFUiBTZWFyY2hGb3Jlc3QKCiAgICAgICAgU3dpdGNoLiBTZWFyY2ggYWxsIGRvbWFpbnMgaW4gdGhlIGZvcmVzdCBmb3IgdGFyZ2V0IHVzZXJzIGluc3RlYWQgb2YganVzdAogICAgICAgIGEgc2luZ2xlIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIFN0ZWFsdGgKCiAgICAgICAgU3dpdGNoLiBPbmx5IGVudW1lcmF0ZSBzZXNzaW9ucyBmcm9tIGNvbm5vbmx5IHVzZWQgdGFyZ2V0IHNlcnZlcnMuCgogICAgLlBBUkFNRVRFUiBTdGVhbHRoU291cmNlCgogICAgICAgIFRoZSBzb3VyY2Ugb2YgdGFyZ2V0IHNlcnZlcnMgdG8gdXNlLCAnREZTJyAoZGlzdHJpYnV0ZWQgZmlsZSBzZXJ2ZXJzKSwKICAgICAgICAnREMnIChkb21haW4gY29udHJvbGxlcnMpLCAnRmlsZScgKGZpbGUgc2VydmVycyksIG9yICdBbGwnCgogICAgLlBBUkFNRVRFUiBGb3JlaWduVXNlcnMKCiAgICAgICAgU3dpdGNoLiBPbmx5IHJldHVybiByZXN1bHRzIHRoYXQgYXJlIG5vdCBwYXJ0IG9mIHNlYXJjaGVkIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIFRocmVhZHMKCiAgICAgICAgVGhlIG1heGltdW0gY29uY3VycmVudCB0aHJlYWRzIHRvIGV4ZWN1dGUuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtVXNlckh1bnRlciAtQ2hlY2tBY2Nlc3MKCiAgICAgICAgRmluZHMgbWFjaGluZXMgb24gdGhlIGxvY2FsIGRvbWFpbiB3aGVyZSBkb21haW4gYWRtaW5zIGFyZSBsb2dnZWQgaW50bwogICAgICAgIGFuZCBjaGVja3MgaWYgdGhlIGN1cnJlbnQgdXNlciBoYXMgbG9jYWwgYWRtaW5pc3RyYXRvciBhY2Nlc3MuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtVXNlckh1bnRlciAtRG9tYWluICd0ZXN0aW5nJwoKICAgICAgICBGaW5kcyBtYWNoaW5lcyBvbiB0aGUgJ3Rlc3RpbmcnIGRvbWFpbiB3aGVyZSBkb21haW4gYWRtaW5zIGFyZSBsb2dnZWQgaW50by4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1Vc2VySHVudGVyIC1UaHJlYWRzIDIwCgogICAgICAgIE11bHRpLXRocmVhZGVkIHVzZXIgaHVudGluZywgcmVwbGFjZXMgSW52b2tlLVVzZXJIdW50ZXJUaHJlYWRlZC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1Vc2VySHVudGVyIC1Vc2VyRmlsZSB1c2Vycy50eHQgLUNvbXB1dGVyRmlsZSBob3N0cy50eHQKCiAgICAgICAgRmluZHMgbWFjaGluZXMgaW4gaG9zdHMudHh0IHdoZXJlIGFueSBtZW1iZXJzIG9mIHVzZXJzLnR4dCBhcmUgbG9nZ2VkIGluCiAgICAgICAgb3IgaGF2ZSBzZXNzaW9ucy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1Vc2VySHVudGVyIC1Hcm91cE5hbWUgIlBvd2VyIFVzZXJzIiAtRGVsYXkgNjAKCiAgICAgICAgRmluZCBtYWNoaW5lcyBvbiB0aGUgZG9tYWluIHdoZXJlIG1lbWJlcnMgb2YgdGhlICJQb3dlciBVc2VycyIgZ3JvdXBzIGFyZQogICAgICAgIGxvZ2dlZCBpbnRvIHdpdGggYSA2MCBzZWNvbmQgKCsvLSAqLjMpIHJhbmRvbWl6ZWQgZGVsYXkgYmV0d2VlbgogICAgICAgIHRvdWNoaW5nIGVhY2ggaG9zdC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1Vc2VySHVudGVyIC1UYXJnZXRTZXJ2ZXIgRklMRVNFUlZFUgoKICAgICAgICBRdWVyeSBGSUxFU0VSVkVSIGZvciB1c2VyZXMgd2hvIGFyZSBlZmZlY3RpdmUgbG9jYWwgYWRtaW5pc3RyYXRvcnMgdXNpbmcKICAgICAgICBHZXQtTmV0TG9jYWxHcm91cCAtUmVjdXJzZSwgYW5kIGh1bnQgZm9yIHRoYXQgdXNlciBzZXQgb24gdGhlIG5ldHdvcmsuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtVXNlckh1bnRlciAtU2VhcmNoRm9yZXN0CgogICAgICAgIEZpbmQgYWxsIG1hY2hpbmVzIGluIHRoZSBjdXJyZW50IGZvcmVzdCB3aGVyZSBkb21haW4gYWRtaW5zIGFyZSBsb2dnZWQgaW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtVXNlckh1bnRlciAtU3RlYWx0aAoKICAgICAgICBFeGVjdXRlcyBvbGQgSW52b2tlLVN0ZWFsdGhVc2VySHVudGVyIGZ1bmN0aW9uYWxpdHksIGVudW1lcmF0aW5nIGNvbW1vbmx5CiAgICAgICAgdXNlZCBzZXJ2ZXJzIGFuZCBjaGVja2luZyBqdXN0IHNlc3Npb25zIGZvciBlYWNoLgoKICAgIC5MSU5LCiAgICAgICAgaHR0cDovL2Jsb2cuaGFybWoweS5uZXQKIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3RzJyldCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgICRDb21wdXRlck5hbWUsCgogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7VGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtBbGlhcygnSG9zdExpc3QnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckZpbGUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckFEU3BhdGgsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVuY29uc3RyYWluZWQsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdyb3VwTmFtZSA9ICdEb21haW4gQWRtaW5zJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGFyZ2V0U2VydmVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckFEU3BhdGgsCgogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7VGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJGaWxlLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRBZG1pbkNvdW50LAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRBbGxvd0RlbGVnYXRpb24sCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJENoZWNrQWNjZXNzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTdG9wT25TdWNjZXNzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICROb1BpbmcsCgogICAgICAgIFtVSW50MzJdCiAgICAgICAgJERlbGF5ID0gMCwKCiAgICAgICAgW0RvdWJsZV0KICAgICAgICAkSml0dGVyID0gLjMsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2hvd0FsbCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2VhcmNoRm9yZXN0LAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTdGVhbHRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZVNldCgiREZTIiwiREMiLCJGaWxlIiwiQWxsIildCiAgICAgICAgJFN0ZWFsdGhTb3VyY2UgPSJBbGwiLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRGb3JlaWduVXNlcnMsCgogICAgICAgIFtJbnRdCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDApXQogICAgICAgICRUaHJlYWRzCiAgICApCgogICAgYmVnaW4gewoKICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydEZWJ1ZyddKSB7CiAgICAgICAgICAgICREZWJ1Z1ByZWZlcmVuY2UgPSAnQ29udGludWUnCiAgICAgICAgfQoKICAgICAgICAjIHJhbmRvbSBvYmplY3QgZm9yIGRlbGF5CiAgICAgICAgJFJhbmRObyA9IE5ldy1PYmplY3QgU3lzdGVtLlJhbmRvbQoKICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUnVubmluZyBJbnZva2UtVXNlckh1bnRlciB3aXRoIGRlbGF5IG9mICREZWxheSIKCiAgICAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgICAgICAjCiAgICAgICAgIyBGaXJzdCB3ZSBidWlsZCB0aGUgaG9zdCB0YXJnZXQgc2V0CiAgICAgICAgIwogICAgICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgogICAgICAgIGlmKCRDb21wdXRlckZpbGUpIHsKICAgICAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyBhIGhvc3QgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSBHZXQtQ29udGVudCAtUGF0aCAkQ29tcHV0ZXJGaWxlCiAgICAgICAgfQoKICAgICAgICBpZighJENvbXB1dGVyTmFtZSkgewogICAgICAgICAgICBbQXJyYXldJENvbXB1dGVyTmFtZSA9IEAoKQoKICAgICAgICAgICAgaWYoJERvbWFpbikgewogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCREb21haW4pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRTZWFyY2hGb3Jlc3QpIHsKICAgICAgICAgICAgICAgICMgZ2V0IEFMTCB0aGUgZG9tYWlucyBpbiB0aGUgZm9yZXN0IHRvIHNlYXJjaAogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBHZXQtTmV0Rm9yZXN0RG9tYWluIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5OYW1lIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICMgdXNlIHRoZSBsb2NhbCBkb21haW4KICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gQCggKEdldC1OZXREb21haW4pLm5hbWUgKQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkU3RlYWx0aCkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiU3RlYWx0aCBtb2RlISBFbnVtZXJhdGluZyBjb21tb25seSB1c2VkIHNlcnZlcnMiCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJTdGVhbHRoIHNvdXJjZTogJFN0ZWFsdGhTb3VyY2UiCgogICAgICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgICAgIGlmICgoJFN0ZWFsdGhTb3VyY2UgLWVxICJGaWxlIikgLW9yICgkU3RlYWx0aFNvdXJjZSAtZXEgIkFsbCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBRdWVyeWluZyBkb21haW4gJERvbWFpbiBmb3IgRmlsZSBTZXJ2ZXJzLi4uIgogICAgICAgICAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lICs9IEdldC1OZXRGaWxlU2VydmVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoKCRTdGVhbHRoU291cmNlIC1lcSAiREZTIikgLW9yICgkU3RlYWx0aFNvdXJjZSAtZXEgIkFsbCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBRdWVyeWluZyBkb21haW4gJERvbWFpbiBmb3IgREZTIFNlcnZlcnMuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgKz0gR2V0LURGU3NoYXJlIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciB8IEZvckVhY2gtT2JqZWN0IHskXy5SZW1vdGVTZXJ2ZXJOYW1lfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoKCRTdGVhbHRoU291cmNlIC1lcSAiREMiKSAtb3IgKCRTdGVhbHRoU291cmNlIC1lcSAiQWxsIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciBEb21haW4gQ29udHJvbGxlcnMuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgKz0gR2V0LU5ldERvbWFpbkNvbnRyb2xsZXIgLUxEQVAgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5kbnNob3N0bmFtZX0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBGb3JFYWNoICgkRG9tYWluIGluICRUYXJnZXREb21haW5zKSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciBob3N0cyIKCiAgICAgICAgICAgICAgICAgICAgJEFyZ3VtZW50cyA9IEB7CiAgICAgICAgICAgICAgICAgICAgICAgICdEb21haW4nID0gJERvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAnRG9tYWluQ29udHJvbGxlcicgPSAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAgICAgICAgICAgICAnQURTcGF0aCcgPSAkQURTcGF0aAogICAgICAgICAgICAgICAgICAgICAgICAnRmlsdGVyJyA9ICRDb21wdXRlckZpbHRlcgogICAgICAgICAgICAgICAgICAgICAgICAnVW5jb25zdHJhaW5lZCcgPSAkVW5jb25zdHJhaW5lZAogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSArPSBHZXQtTmV0Q29tcHV0ZXIgQEFyZ3VtZW50cwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHJlbW92ZSBhbnkgbnVsbCB0YXJnZXQgaG9zdHMsIHVuaXF1aWZ5IHRoZSBsaXN0IGFuZCBzaHVmZmxlIGl0CiAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHsgJF8gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgfCBTb3J0LU9iamVjdCB7IEdldC1SYW5kb20gfQogICAgICAgICAgICBpZigkKCRDb21wdXRlck5hbWUuQ291bnQpIC1lcSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiTm8gaG9zdHMgZm91bmQhIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgICAgICMKICAgICAgICAjIE5vdyB3ZSBidWlsZCB0aGUgdXNlciB0YXJnZXQgc2V0CiAgICAgICAgIwogICAgICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgogICAgICAgICMgdXNlcnMgd2UncmUgZ29pbmcgdG8gYmUgc2VhcmNoaW5nIGZvcgogICAgICAgICRUYXJnZXRVc2VycyA9IEAoKQoKICAgICAgICAjIGdldCB0aGUgY3VycmVudCB1c2VyIHNvIHdlIGNhbiBpZ25vcmUgaXQgaW4gdGhlIHJlc3VsdHMKICAgICAgICAkQ3VycmVudFVzZXIgPSAoW0Vudmlyb25tZW50XTo6VXNlck5hbWUpLnRvTG93ZXIoKQoKICAgICAgICAjIGlmIHdlJ3JlIHNob3dpbmcgYWxsIHJlc3VsdHMsIHNraXAgdXNlcm5hbWUgZW51bWVyYXRpb24KICAgICAgICBpZigkU2hvd0FsbCAtb3IgJEZvcmVpZ25Vc2VycykgewogICAgICAgICAgICAkVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyRG9tYWluJyAkTnVsbAogICAgICAgICAgICAkVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdNZW1iZXJOYW1lJyAnKicKICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gQCgkVXNlcikKCiAgICAgICAgICAgIGlmKCRGb3JlaWduVXNlcnMpIHsKICAgICAgICAgICAgICAgICMgaWYgd2UncmUgc2VhcmNoaW5nIGZvciB1c2VyIHJlc3VsdHMgbm90IGluIHRoZSBwcmltYXJ5IGRvbWFpbgogICAgICAgICAgICAgICAgJGtyYnRndE5hbWUgPSBDb252ZXJ0LUFETmFtZSAtT2JqZWN0TmFtZSAia3JidGd0QCQoJERvbWFpbikiIC1JbnB1dFR5cGUgU2ltcGxlIC1PdXRwdXRUeXBlIE5UNAogICAgICAgICAgICAgICAgJERvbWFpblNob3J0TmFtZSA9ICRrcmJ0Z3ROYW1lLnNwbGl0KCJcIilbMF0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAjIGlmIHdlIHdhbnQgdG8gaHVudCBmb3IgdGhlIGVmZmVjdGl2ZSBkb21haW4gdXNlcnMgd2hvIGNhbiBhY2Nlc3MgYSB0YXJnZXQgc2VydmVyCiAgICAgICAgZWxzZWlmKCRUYXJnZXRTZXJ2ZXIpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiUXVlcnlpbmcgdGFyZ2V0IHNlcnZlciAnJFRhcmdldFNlcnZlcicgZm9yIGxvY2FsIHVzZXJzIgogICAgICAgICAgICAkVGFyZ2V0VXNlcnMgPSBHZXQtTmV0TG9jYWxHcm91cCAkVGFyZ2V0U2VydmVyIC1SZWN1cnNlIHwgV2hlcmUtT2JqZWN0IHsoLW5vdCAkXy5Jc0dyb3VwKSAtYW5kICRfLklzRG9tYWluIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAkVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlckRvbWFpbicgKCRfLkFjY291bnROYW1lKS5zcGxpdCgiLyIpWzBdLnRvTG93ZXIoKQogICAgICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyTmFtZScgKCRfLkFjY291bnROYW1lKS5zcGxpdCgiLyIpWzFdLnRvTG93ZXIoKQogICAgICAgICAgICAgICAgJFVzZXIKICAgICAgICAgICAgfSAgfCBXaGVyZS1PYmplY3QgeyRffQogICAgICAgIH0KICAgICAgICAjIGlmIHdlIGdldCBhIHNwZWNpZmljIHVzZXJuYW1lLCBvbmx5IHVzZSB0aGF0CiAgICAgICAgZWxzZWlmKCRVc2VyTmFtZSkgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gVXNpbmcgdGFyZ2V0IHVzZXIgJyRVc2VyTmFtZScuLi4iCiAgICAgICAgICAgICRVc2VyID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICBpZigkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyRG9tYWluJyAkVGFyZ2V0RG9tYWluc1swXQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyRG9tYWluJyAkTnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlck5hbWUnICRVc2VyTmFtZS5Ub0xvd2VyKCkKICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gQCgkVXNlcikKICAgICAgICB9CiAgICAgICAgIyByZWFkIGluIGEgdGFyZ2V0IHVzZXIgbGlzdCBpZiB3ZSBoYXZlIG9uZQogICAgICAgIGVsc2VpZigkVXNlckZpbGUpIHsKICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gR2V0LUNvbnRlbnQgLVBhdGggJFVzZXJGaWxlIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgJFVzZXIgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICBpZigkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlckRvbWFpbicgJFRhcmdldERvbWFpbnNbMF0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlckRvbWFpbicgJE51bGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlck5hbWUnICRfCiAgICAgICAgICAgICAgICAkVXNlcgogICAgICAgICAgICB9ICB8IFdoZXJlLU9iamVjdCB7JF99CiAgICAgICAgfQogICAgICAgIGVsc2VpZigkVXNlckFEU3BhdGggLW9yICRVc2VyRmlsdGVyIC1vciAkQWRtaW5Db3VudCkgewogICAgICAgICAgICBGb3JFYWNoICgkRG9tYWluIGluICRUYXJnZXREb21haW5zKSB7CgogICAgICAgICAgICAgICAgJEFyZ3VtZW50cyA9IEB7CiAgICAgICAgICAgICAgICAgICAgJ0RvbWFpbicgPSAkRG9tYWluCiAgICAgICAgICAgICAgICAgICAgJ0RvbWFpbkNvbnRyb2xsZXInID0gJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgICAgICAgICAnQURTcGF0aCcgPSAkVXNlckFEU3BhdGgKICAgICAgICAgICAgICAgICAgICAnRmlsdGVyJyA9ICRVc2VyRmlsdGVyCiAgICAgICAgICAgICAgICAgICAgJ0FkbWluQ291bnQnID0gJEFkbWluQ291bnQKICAgICAgICAgICAgICAgICAgICAnQWxsb3dEZWxlZ2F0aW9uJyA9ICRBbGxvd0RlbGVnYXRpb24KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIHVzZXJzIgogICAgICAgICAgICAgICAgJFRhcmdldFVzZXJzICs9IEdldC1OZXRVc2VyIEBBcmd1bWVudHMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgJFVzZXIgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyRG9tYWluJyAkRG9tYWluCiAgICAgICAgICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTWVtYmVyTmFtZScgJF8uc2FtYWNjb3VudG5hbWUKICAgICAgICAgICAgICAgICAgICAkVXNlcgogICAgICAgICAgICAgICAgfSAgfCBXaGVyZS1PYmplY3QgeyRffQoKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciB1c2VycyBvZiBncm91cCAnJEdyb3VwTmFtZSciCiAgICAgICAgICAgICAgICAkVGFyZ2V0VXNlcnMgKz0gR2V0LU5ldEdyb3VwTWVtYmVyIC1Hcm91cE5hbWUgJEdyb3VwTmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCggKC1ub3QgJFNob3dBbGwpIC1hbmQgKC1ub3QgJEZvcmVpZ25Vc2VycykgKSAtYW5kICgoISRUYXJnZXRVc2VycykgLW9yICgkVGFyZ2V0VXNlcnMuQ291bnQgLWVxIDApKSkgewogICAgICAgICAgICB0aHJvdyAiWyFdIE5vIHVzZXJzIGZvdW5kIHRvIHNlYXJjaCBmb3IhIgogICAgICAgIH0KCiAgICAgICAgIyBzY3JpcHQgYmxvY2sgdGhhdCBlbnVtZXJhdGVzIGEgc2VydmVyCiAgICAgICAgJEhvc3RFbnVtQmxvY2sgPSB7CiAgICAgICAgICAgIHBhcmFtKCRDb21wdXRlck5hbWUsICRQaW5nLCAkVGFyZ2V0VXNlcnMsICRDdXJyZW50VXNlciwgJFN0ZWFsdGgsICREb21haW5TaG9ydE5hbWUpCgogICAgICAgICAgICAjIG9wdGlvbmFsbHkgY2hlY2sgaWYgdGhlIHNlcnZlciBpcyB1cCBmaXJzdAogICAgICAgICAgICAkVXAgPSAkVHJ1ZQogICAgICAgICAgICBpZigkUGluZykgewogICAgICAgICAgICAgICAgJFVwID0gVGVzdC1Db25uZWN0aW9uIC1Db3VudCAxIC1RdWlldCAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkVXApIHsKICAgICAgICAgICAgICAgIGlmKCEkRG9tYWluU2hvcnROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSBub3Qgc2VhcmNoaW5nIGZvciBmb3JlaWduIHVzZXJzLCBjaGVjayBzZXNzaW9uIGluZm9ybWF0aW9uCiAgICAgICAgICAgICAgICAgICAgJFNlc3Npb25zID0gR2V0LU5ldFNlc3Npb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgRm9yRWFjaCAoJFNlc3Npb24gaW4gJFNlc3Npb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyTmFtZSA9ICRTZXNzaW9uLnNlc2kxMF91c2VybmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkQ05hbWUgPSAkU2Vzc2lvbi5zZXNpMTBfY25hbWUKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRDTmFtZSAtYW5kICRDTmFtZS5TdGFydHNXaXRoKCJcXCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQ05hbWUgPSAkQ05hbWUuVHJpbVN0YXJ0KCJcIikKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgIyBtYWtlIHN1cmUgd2UgaGF2ZSBhIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCRVc2VyTmFtZSkgLWFuZCAoJFVzZXJOYW1lLnRyaW0oKSAtbmUgJycpIC1hbmQgKCEoJFVzZXJOYW1lIC1tYXRjaCAkQ3VycmVudFVzZXIpKSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyB8IFdoZXJlLU9iamVjdCB7JFVzZXJOYW1lIC1saWtlICRfLk1lbWJlck5hbWV9IHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSVBBZGRyZXNzID0gQChHZXQtSVBBZGRyZXNzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSlbMF0uSVBBZGRyZXNzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJEb21haW4nICRfLk1lbWJlckRvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVXNlck5hbWUnICRVc2VyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJUEFkZHJlc3MnICRJUEFkZHJlc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1Nlc3Npb25Gcm9tJyAkQ05hbWUKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUcnkgdG8gcmVzb2x2ZSB0aGUgRE5TIGhvc3RuYW1lIG9mICRDbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDTmFtZUROU05hbWUgPSBbU3lzdGVtLk5ldC5EbnNdOjpHZXRIb3N0RW50cnkoJENOYW1lKSB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IEhvc3ROYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVQcm9wZXJ0eSAnU2Vzc2lvbkZyb21OYW1lJyAkQ25hbWVETlNOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZVByb3BlcnR5ICdTZXNzaW9uRnJvbU5hbWUnICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHNlZSBpZiB3ZSdyZSBjaGVja2luZyB0byBzZWUgaWYgd2UgaGF2ZSBsb2NhbCBhZG1pbiBhY2Nlc3Mgb24gdGhpcyBtYWNoaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRDaGVja0FjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQWRtaW4gPSBJbnZva2UtQ2hlY2tMb2NhbEFkbWluQWNjZXNzIC1Db21wdXRlck5hbWUgJENOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTG9jYWxBZG1pbicgJEFkbWluCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0xvY2FsQWRtaW4nICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LlVzZXJTZXNzaW9uJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZighJFN0ZWFsdGgpIHsKICAgICAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIG5vdCAnc3RlYWx0aHknLCBlbnVtZXJhdGUgbG9nZ2Vkb24gdXNlcnMgYXMgd2VsbAogICAgICAgICAgICAgICAgICAgICRMb2dnZWRPbiA9IEdldC1OZXRMb2dnZWRvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgICAgICBGb3JFYWNoICgkVXNlciBpbiAkTG9nZ2VkT24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJOYW1lID0gJFVzZXIud2t1aTFfdXNlcm5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgIyBUT0RPOiB0cmFuc2xhdGUgZG9tYWluIHRvIGF1dGhvcmF0YXRpdmUgbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAjICAgdGhlbiBtYXRjaCBkb21haW4gbmFtZSA/CiAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyRG9tYWluID0gJFVzZXIud2t1aTFfbG9nb25fZG9tYWluCgogICAgICAgICAgICAgICAgICAgICAgICAjIG1ha2Ugc3VyZSB3ZXQgaGF2ZSBhIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCRVc2VyTmFtZSkgLWFuZCAoJFVzZXJOYW1lLnRyaW0oKSAtbmUgJycpKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRhcmdldFVzZXJzIHwgV2hlcmUtT2JqZWN0IHskVXNlck5hbWUgLWxpa2UgJF8uTWVtYmVyTmFtZX0gfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcm9jZWVkID0gJFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkRG9tYWluU2hvcnROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkRG9tYWluU2hvcnROYW1lLlRvTG93ZXIoKSAtbmUgJFVzZXJEb21haW4uVG9Mb3dlcigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUHJvY2VlZCA9ICRUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUHJvY2VlZCA9ICRGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRQcm9jZWVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRJUEFkZHJlc3MgPSBAKEdldC1JUEFkZHJlc3MgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lKVswXS5JUEFkZHJlc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyRG9tYWluJyAkVXNlckRvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJOYW1lJyAkVXNlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJUEFkZHJlc3MnICRJUEFkZHJlc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTZXNzaW9uRnJvbScgJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTZXNzaW9uRnJvbU5hbWUnICROdWxsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHNlZSBpZiB3ZSdyZSBjaGVja2luZyB0byBzZWUgaWYgd2UgaGF2ZSBsb2NhbCBhZG1pbiBhY2Nlc3Mgb24gdGhpcyBtYWNoaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkQ2hlY2tBY2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBZG1pbiA9IEludm9rZS1DaGVja0xvY2FsQWRtaW5BY2Nlc3MgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0xvY2FsQWRtaW4nICRBZG1pbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdMb2NhbEFkbWluJyAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LlVzZXJTZXNzaW9uJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIGlmKCRUaHJlYWRzKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlVzaW5nIHRocmVhZGluZyB3aXRoIHRocmVhZHMgPSAkVGhyZWFkcyIKCiAgICAgICAgICAgICMgaWYgd2UncmUgdXNpbmcgdGhyZWFkaW5nLCBraWNrIG9mZiB0aGUgc2NyaXB0IGJsb2NrIHdpdGggSW52b2tlLVRocmVhZGVkRnVuY3Rpb24KICAgICAgICAgICAgJFNjcmlwdFBhcmFtcyA9IEB7CiAgICAgICAgICAgICAgICAnUGluZycgPSAkKC1ub3QgJE5vUGluZykKICAgICAgICAgICAgICAgICdUYXJnZXRVc2VycycgPSAkVGFyZ2V0VXNlcnMKICAgICAgICAgICAgICAgICdDdXJyZW50VXNlcicgPSAkQ3VycmVudFVzZXIKICAgICAgICAgICAgICAgICdTdGVhbHRoJyA9ICRTdGVhbHRoCiAgICAgICAgICAgICAgICAnRG9tYWluU2hvcnROYW1lJyA9ICREb21haW5TaG9ydE5hbWUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBraWNrIG9mZiB0aGUgdGhyZWFkZWQgc2NyaXB0IGJsb2NrICsgYXJndW1lbnRzCiAgICAgICAgICAgIEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtU2NyaXB0QmxvY2sgJEhvc3RFbnVtQmxvY2sgLVNjcmlwdFBhcmFtZXRlcnMgJFNjcmlwdFBhcmFtcyAtVGhyZWFkcyAkVGhyZWFkcwogICAgICAgIH0KCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKC1ub3QgJE5vUGluZyAtYW5kICgkQ29tcHV0ZXJOYW1lLmNvdW50IC1uZSAxKSkgewogICAgICAgICAgICAgICAgIyBwaW5nIGFsbCBob3N0cyBpbiBwYXJhbGxlbAogICAgICAgICAgICAgICAgJFBpbmcgPSB7cGFyYW0oJENvbXB1dGVyTmFtZSkgaWYoVGVzdC1Db25uZWN0aW9uIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtQ291bnQgMSAtUXVpZXQgLUVycm9yQWN0aW9uIFN0b3ApeyRDb21wdXRlck5hbWV9fQogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSA9IEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uIC1Ob0ltcG9ydHMgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1TY3JpcHRCbG9jayAkUGluZyAtVGhyZWFkcyAxMDAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFRvdGFsIG51bWJlciBvZiBhY3RpdmUgaG9zdHM6ICQoJENvbXB1dGVyTmFtZS5jb3VudCkiCiAgICAgICAgICAgICRDb3VudGVyID0gMAoKICAgICAgICAgICAgRm9yRWFjaCAoJENvbXB1dGVyIGluICRDb21wdXRlck5hbWUpIHsKCiAgICAgICAgICAgICAgICAkQ291bnRlciA9ICRDb3VudGVyICsgMQoKICAgICAgICAgICAgICAgICMgc2xlZXAgZm9yIG91ciBzZW1pLXJhbmRvbWl6ZWQgaW50ZXJ2YWwKICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzICRSYW5kTm8uTmV4dCgoMS0kSml0dGVyKSokRGVsYXksICgxKyRKaXR0ZXIpKiREZWxheSkKCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gRW51bWVyYXRpbmcgc2VydmVyICRDb21wdXRlciAoJENvdW50ZXIgb2YgJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSkiCiAgICAgICAgICAgICAgICAkUmVzdWx0ID0gSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1Bcmd1bWVudExpc3QgJENvbXB1dGVyLCAkRmFsc2UsICRUYXJnZXRVc2VycywgJEN1cnJlbnRVc2VyLCAkU3RlYWx0aCwgJERvbWFpblNob3J0TmFtZQogICAgICAgICAgICAgICAgJFJlc3VsdAoKICAgICAgICAgICAgICAgIGlmKCRSZXN1bHQgLWFuZCAkU3RvcE9uU3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBUYXJnZXQgdXNlciBmb3VuZCwgcmV0dXJuaW5nIGVhcmx5IgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KfQoKCmZ1bmN0aW9uIEludm9rZS1TdGVhbHRoVXNlckh1bnRlciB7CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3RzJyldCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgICRDb21wdXRlck5hbWUsCgogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7VGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtBbGlhcygnSG9zdExpc3QnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckZpbGUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckFEU3BhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdyb3VwTmFtZSA9ICdEb21haW4gQWRtaW5zJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGFyZ2V0U2VydmVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckFEU3BhdGgsCgogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7VGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJGaWxlLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRDaGVja0FjY2VzcywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU3RvcE9uU3VjY2VzcywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTm9QaW5nLAoKICAgICAgICBbVUludDMyXQogICAgICAgICREZWxheSA9IDAsCgogICAgICAgIFtEb3VibGVdCiAgICAgICAgJEppdHRlciA9IC4zLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNob3dBbGwsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNlYXJjaEZvcmVzdCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICBbVmFsaWRhdGVTZXQoIkRGUyIsIkRDIiwiRmlsZSIsIkFsbCIpXQogICAgICAgICRTdGVhbHRoU291cmNlID0iQWxsIgogICAgKQogICAgIyBraWNrIG9mZiBJbnZva2UtVXNlckh1bnRlciB3aXRoIHN0ZWFsdGggb3B0aW9ucwogICAgSW52b2tlLVVzZXJIdW50ZXIgLVN0ZWFsdGggQFBTQm91bmRQYXJhbWV0ZXJzCn0KCgpmdW5jdGlvbiBJbnZva2UtUHJvY2Vzc0h1bnRlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgUXVlcnkgdGhlIHByb2Nlc3MgbGlzdHMgb2YgcmVtb3RlIG1hY2hpbmVzLCBzZWFyY2hpbmcgZm9yCiAgICAgICAgcHJvY2Vzc2VzIHdpdGggYSBzcGVjaWZpYyBuYW1lIG9yIG93bmVkIGJ5IGEgc3BlY2lmaWMgdXNlci4KICAgICAgICBUaGFua3MgdG8gQHBhdWxicmFuZGF1IGZvciB0aGUgYXBwcm9hY2ggaWRlYS4KCiAgICAgICAgQXV0aG9yOiBAaGFybWoweQogICAgICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJOYW1lCgogICAgICAgIEhvc3QgYXJyYXkgdG8gZW51bWVyYXRlLCBwYXNzYWJsZSBvbiB0aGUgcGlwZWxpbmUuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckZpbGUKCiAgICAgICAgRmlsZSBvZiBob3N0bmFtZXMvSVBzIHRvIHNlYXJjaC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsdGVyCgogICAgICAgIEhvc3QgZmlsdGVyIG5hbWUgdG8gcXVlcnkgQUQgZm9yLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoIGZvciBob3N0cywgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIFByb2Nlc3NOYW1lCgogICAgICAgIFRoZSBuYW1lIG9mIHRoZSBwcm9jZXNzIHRvIGh1bnQsIG9yIGEgY29tbWEgc2VwYXJhdGVkIGxpc3Qgb2YgbmFtZXMuCgogICAgLlBBUkFNRVRFUiBHcm91cE5hbWUKCiAgICAgICAgR3JvdXAgbmFtZSB0byBxdWVyeSBmb3IgdGFyZ2V0IHVzZXJzLgoKICAgIC5QQVJBTUVURVIgVGFyZ2V0U2VydmVyCgogICAgICAgIEh1bnQgZm9yIHVzZXJzIHdobyBhcmUgZWZmZWN0aXZlIGxvY2FsIGFkbWlucyBvbiBhIHRhcmdldCBzZXJ2ZXIuCgogICAgLlBBUkFNRVRFUiBVc2VyTmFtZQoKICAgICAgICBTcGVjaWZpYyB1c2VybmFtZSB0byBzZWFyY2ggZm9yLgoKICAgIC5QQVJBTUVURVIgVXNlckZpbHRlcgoKICAgICAgICBBIGN1c3RvbWl6ZWQgbGRhcCBmaWx0ZXIgc3RyaW5nIHRvIHVzZSBmb3IgdXNlciBlbnVtZXJhdGlvbiwgZS5nLiAiKGRlc2NyaXB0aW9uPSphZG1pbiopIgoKICAgIC5QQVJBTUVURVIgVXNlckFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoIGZvciB1c2VycywgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIgogICAgICAgIFVzZWZ1bCBmb3IgT1UgcXVlcmllcy4KCiAgICAuUEFSQU1FVEVSIFVzZXJGaWxlCgogICAgICAgIEZpbGUgb2YgdXNlcm5hbWVzIHRvIHNlYXJjaCBmb3IuCgogICAgLlBBUkFNRVRFUiBTdG9wT25TdWNjZXNzCgogICAgICAgIFN3aXRjaC4gU3RvcCBodW50aW5nIGFmdGVyIGZpbmRpbmcgYWZ0ZXIgZmluZGluZyBhIHRhcmdldCB1c2VyL3Byb2Nlc3MuCgogICAgLlBBUkFNRVRFUiBOb1BpbmcKCiAgICAgICAgU3dpdGNoLiBEb24ndCBwaW5nIGVhY2ggaG9zdCB0byBlbnN1cmUgaXQncyB1cCBiZWZvcmUgZW51bWVyYXRpbmcuCgogICAgLlBBUkFNRVRFUiBEZWxheQoKICAgICAgICBEZWxheSBiZXR3ZWVuIGVudW1lcmF0aW5nIGhvc3RzLCBkZWZhdWx0cyB0byAwCgogICAgLlBBUkFNRVRFUiBKaXR0ZXIKCiAgICAgICAgSml0dGVyIGZvciB0aGUgaG9zdCBkZWxheSwgZGVmYXVsdHMgdG8gKy8tIDAuMwoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIERvbWFpbiBmb3IgcXVlcnkgZm9yIG1hY2hpbmVzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBTaG93QWxsCgogICAgICAgIFN3aXRjaC4gUmV0dXJuIGFsbCB1c2VyIGxvY2F0aW9uIHJlc3VsdHMuCgogICAgLlBBUkFNRVRFUiBTZWFyY2hGb3Jlc3QKCiAgICAgICAgU3dpdGNoLiBTZWFyY2ggYWxsIGRvbWFpbnMgaW4gdGhlIGZvcmVzdCBmb3IgdGFyZ2V0IHVzZXJzIGluc3RlYWQgb2YganVzdAogICAgICAgIGEgc2luZ2xlIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIFRocmVhZHMKCiAgICAgICAgVGhlIG1heGltdW0gY29uY3VycmVudCB0aHJlYWRzIHRvIGV4ZWN1dGUuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IG1hY2hpbmUvZG9tYWluLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVByb2Nlc3NIdW50ZXIgLURvbWFpbiAndGVzdGluZycKCiAgICAgICAgRmluZHMgbWFjaGluZXMgb24gdGhlICd0ZXN0aW5nJyBkb21haW4gd2hlcmUgZG9tYWluIGFkbWlucyBoYXZlIGEKICAgICAgICBydW5uaW5nIHByb2Nlc3MuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtUHJvY2Vzc0h1bnRlciAtVGhyZWFkcyAyMAoKICAgICAgICBNdWx0aS10aHJlYWRlZCBwcm9jZXNzIGh1bnRpbmcsIHJlcGxhY2VzIEludm9rZS1Qcm9jZXNzSHVudGVyVGhyZWFkZWQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtUHJvY2Vzc0h1bnRlciAtVXNlckZpbGUgdXNlcnMudHh0IC1Db21wdXRlckZpbGUgaG9zdHMudHh0CgogICAgICAgIEZpbmRzIG1hY2hpbmVzIGluIGhvc3RzLnR4dCB3aGVyZSBhbnkgbWVtYmVycyBvZiB1c2Vycy50eHQgaGF2ZSBydW5uaW5nCiAgICAgICAgcHJvY2Vzc2VzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVByb2Nlc3NIdW50ZXIgLUdyb3VwTmFtZSAiUG93ZXIgVXNlcnMiIC1EZWxheSA2MAoKICAgICAgICBGaW5kIG1hY2hpbmVzIG9uIHRoZSBkb21haW4gd2hlcmUgbWVtYmVycyBvZiB0aGUgIlBvd2VyIFVzZXJzIiBncm91cHMgaGF2ZQogICAgICAgIHJ1bm5pbmcgcHJvY2Vzc2VzIHdpdGggYSA2MCBzZWNvbmQgKCsvLSAqLjMpIHJhbmRvbWl6ZWQgZGVsYXkgYmV0d2VlbgogICAgICAgIHRvdWNoaW5nIGVhY2ggaG9zdC4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vYmxvZy5oYXJtajB5Lm5ldAojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdHMnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW0FsaWFzKCdIb3N0TGlzdCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyQURTcGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkUHJvY2Vzc05hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEdyb3VwTmFtZSA9ICdEb21haW4gQWRtaW5zJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVGFyZ2V0U2VydmVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyTmFtZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkVXNlckFEU3BhdGgsCgogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7VGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJGaWxlLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTdG9wT25TdWNjZXNzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICROb1BpbmcsCgogICAgICAgIFtVSW50MzJdCiAgICAgICAgJERlbGF5ID0gMCwKCiAgICAgICAgW0RvdWJsZV0KICAgICAgICAkSml0dGVyID0gLjMsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2hvd0FsbCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2VhcmNoRm9yZXN0LAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkVGhyZWFkcywKCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICBiZWdpbiB7CgogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0RlYnVnJ10pIHsKICAgICAgICAgICAgJERlYnVnUHJlZmVyZW5jZSA9ICdDb250aW51ZScKICAgICAgICB9CgogICAgICAgICMgcmFuZG9tIG9iamVjdCBmb3IgZGVsYXkKICAgICAgICAkUmFuZE5vID0gTmV3LU9iamVjdCBTeXN0ZW0uUmFuZG9tCgogICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBSdW5uaW5nIEludm9rZS1Qcm9jZXNzSHVudGVyIHdpdGggZGVsYXkgb2YgJERlbGF5IgoKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgICAgICMKICAgICAgICAjIEZpcnN0IHdlIGJ1aWxkIHRoZSBob3N0IHRhcmdldCBzZXQKICAgICAgICAjCiAgICAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyBhIGhvc3QgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgaWYoJENvbXB1dGVyRmlsZSkgewogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gR2V0LUNvbnRlbnQgLVBhdGggJENvbXB1dGVyRmlsZQogICAgICAgIH0KCiAgICAgICAgaWYoISRDb21wdXRlck5hbWUpIHsKICAgICAgICAgICAgW2FycmF5XSRDb21wdXRlck5hbWUgPSBAKCkKCiAgICAgICAgICAgIGlmKCREb21haW4pIHsKICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gQCgkRG9tYWluKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZigkU2VhcmNoRm9yZXN0KSB7CiAgICAgICAgICAgICAgICAjIGdldCBBTEwgdGhlIGRvbWFpbnMgaW4gdGhlIGZvcmVzdCB0byBzZWFyY2gKICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gR2V0LU5ldEZvcmVzdERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCB8IEZvckVhY2gtT2JqZWN0IHsgJF8uTmFtZSB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAjIHVzZSB0aGUgbG9jYWwgZG9tYWluCiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoIChHZXQtTmV0RG9tYWluIC1Eb21haW4gJERvbWFpbiAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCkubmFtZSApCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEZvckVhY2ggKCREb21haW4gaW4gJFRhcmdldERvbWFpbnMpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBRdWVyeWluZyBkb21haW4gJERvbWFpbiBmb3IgaG9zdHMiCiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lICs9IEdldC1OZXRDb21wdXRlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUZpbHRlciAkQ29tcHV0ZXJGaWx0ZXIgLUFEU3BhdGggJENvbXB1dGVyQURTcGF0aAogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHJlbW92ZSBhbnkgbnVsbCB0YXJnZXQgaG9zdHMsIHVuaXF1aWZ5IHRoZSBsaXN0IGFuZCBzaHVmZmxlIGl0CiAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHsgJF8gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgfCBTb3J0LU9iamVjdCB7IEdldC1SYW5kb20gfQogICAgICAgICAgICBpZigkKCRDb21wdXRlck5hbWUuQ291bnQpIC1lcSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiTm8gaG9zdHMgZm91bmQhIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgICAgICMKICAgICAgICAjIE5vdyB3ZSBidWlsZCB0aGUgdXNlciB0YXJnZXQgc2V0CiAgICAgICAgIwogICAgICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgogICAgICAgIGlmKCEkUHJvY2Vzc05hbWUpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiTm8gcHJvY2VzcyBuYW1lIHNwZWNpZmllZCwgYnVpbGRpbmcgYSB0YXJnZXQgdXNlciBzZXQiCgogICAgICAgICAgICAjIHVzZXJzIHdlJ3JlIGdvaW5nIHRvIGJlIHNlYXJjaGluZyBmb3IKICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gQCgpCgogICAgICAgICAgICAjIGlmIHdlIHdhbnQgdG8gaHVudCBmb3IgdGhlIGVmZmVjdGl2ZSBkb21haW4gdXNlcnMgd2hvIGNhbiBhY2Nlc3MgYSB0YXJnZXQgc2VydmVyCiAgICAgICAgICAgIGlmKCRUYXJnZXRTZXJ2ZXIpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlF1ZXJ5aW5nIHRhcmdldCBzZXJ2ZXIgJyRUYXJnZXRTZXJ2ZXInIGZvciBsb2NhbCB1c2VycyIKICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyA9IEdldC1OZXRMb2NhbEdyb3VwICRUYXJnZXRTZXJ2ZXIgLVJlY3Vyc2UgfCBXaGVyZS1PYmplY3Qgeygtbm90ICRfLklzR3JvdXApIC1hbmQgJF8uSXNEb21haW4gfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAoJF8uQWNjb3VudE5hbWUpLnNwbGl0KCIvIilbMV0udG9Mb3dlcigpCiAgICAgICAgICAgICAgICB9ICB8IFdoZXJlLU9iamVjdCB7JF99CiAgICAgICAgICAgIH0KICAgICAgICAgICAgIyBpZiB3ZSBnZXQgYSBzcGVjaWZpYyB1c2VybmFtZSwgb25seSB1c2UgdGhhdAogICAgICAgICAgICBlbHNlaWYoJFVzZXJOYW1lKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gVXNpbmcgdGFyZ2V0IHVzZXIgJyRVc2VyTmFtZScuLi4iCiAgICAgICAgICAgICAgICAkVGFyZ2V0VXNlcnMgPSBAKCAkVXNlck5hbWUuVG9Mb3dlcigpICkKICAgICAgICAgICAgfQogICAgICAgICAgICAjIHJlYWQgaW4gYSB0YXJnZXQgdXNlciBsaXN0IGlmIHdlIGhhdmUgb25lCiAgICAgICAgICAgIGVsc2VpZigkVXNlckZpbGUpIHsKICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyA9IEdldC1Db250ZW50IC1QYXRoICRVc2VyRmlsZSB8IFdoZXJlLU9iamVjdCB7JF99CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRVc2VyQURTcGF0aCAtb3IgJFVzZXJGaWx0ZXIpIHsKICAgICAgICAgICAgICAgIEZvckVhY2ggKCREb21haW4gaW4gJFRhcmdldERvbWFpbnMpIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIHVzZXJzIgogICAgICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyArPSBHZXQtTmV0VXNlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJFVzZXJBRFNwYXRoIC1GaWx0ZXIgJFVzZXJGaWx0ZXIgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICRfLnNhbWFjY291bnRuYW1lCiAgICAgICAgICAgICAgICAgICAgfSAgfCBXaGVyZS1PYmplY3QgeyRffQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBRdWVyeWluZyBkb21haW4gJERvbWFpbiBmb3IgdXNlcnMgb2YgZ3JvdXAgJyRHcm91cE5hbWUnIgogICAgICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyArPSBHZXQtTmV0R3JvdXBNZW1iZXIgLUdyb3VwTmFtZSAkR3JvdXBOYW1lIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAkXy5NZW1iZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoKC1ub3QgJFNob3dBbGwpIC1hbmQgKCghJFRhcmdldFVzZXJzKSAtb3IgKCRUYXJnZXRVc2Vycy5Db3VudCAtZXEgMCkpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiWyFdIE5vIHVzZXJzIGZvdW5kIHRvIHNlYXJjaCBmb3IhIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHNjcmlwdCBibG9jayB0aGF0IGVudW1lcmF0ZXMgYSBzZXJ2ZXIKICAgICAgICAkSG9zdEVudW1CbG9jayA9IHsKICAgICAgICAgICAgcGFyYW0oJENvbXB1dGVyTmFtZSwgJFBpbmcsICRQcm9jZXNzTmFtZSwgJFRhcmdldFVzZXJzLCAkQ3JlZGVudGlhbCkKCiAgICAgICAgICAgICMgb3B0aW9uYWxseSBjaGVjayBpZiB0aGUgc2VydmVyIGlzIHVwIGZpcnN0CiAgICAgICAgICAgICRVcCA9ICRUcnVlCiAgICAgICAgICAgIGlmKCRQaW5nKSB7CiAgICAgICAgICAgICAgICAkVXAgPSBUZXN0LUNvbm5lY3Rpb24gLUNvdW50IDEgLVF1aWV0IC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRVcCkgewogICAgICAgICAgICAgICAgIyB0cnkgdG8gZW51bWVyYXRlIGFsbCBhY3RpdmUgcHJvY2Vzc2VzIG9uIHRoZSByZW1vdGUgaG9zdAogICAgICAgICAgICAgICAgIyBhbmQgc2VhcmNoIGZvciBhIHNwZWNpZmljIHByb2Nlc3MgbmFtZQogICAgICAgICAgICAgICAgJFByb2Nlc3NlcyA9IEdldC1OZXRQcm9jZXNzIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQoKICAgICAgICAgICAgICAgIEZvckVhY2ggKCRQcm9jZXNzIGluICRQcm9jZXNzZXMpIHsKICAgICAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIGh1bnRpbmcgZm9yIGEgcHJvY2VzcyBuYW1lIG9yIGNvbW1hLXNlcGFyYXRlZCBuYW1lcwogICAgICAgICAgICAgICAgICAgIGlmKCRQcm9jZXNzTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAkUHJvY2Vzc05hbWUuc3BsaXQoIiwiKSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkUHJvY2Vzcy5Qcm9jZXNzTmFtZSAtbWF0Y2ggJF8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUHJvY2VzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICMgaWYgdGhlIHNlc3Npb24gdXNlciBpcyBpbiB0aGUgdGFyZ2V0IGxpc3QsIGRpc3BsYXkgc29tZSBvdXRwdXQKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKCRUYXJnZXRVc2VycyAtY29udGFpbnMgJFByb2Nlc3MuVXNlcikgewogICAgICAgICAgICAgICAgICAgICAgICAkUHJvY2VzcwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIGlmKCRUaHJlYWRzKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlVzaW5nIHRocmVhZGluZyB3aXRoIHRocmVhZHMgPSAkVGhyZWFkcyIKCiAgICAgICAgICAgICMgaWYgd2UncmUgdXNpbmcgdGhyZWFkaW5nLCBraWNrIG9mZiB0aGUgc2NyaXB0IGJsb2NrIHdpdGggSW52b2tlLVRocmVhZGVkRnVuY3Rpb24KICAgICAgICAgICAgJFNjcmlwdFBhcmFtcyA9IEB7CiAgICAgICAgICAgICAgICAnUGluZycgPSAkKC1ub3QgJE5vUGluZykKICAgICAgICAgICAgICAgICdQcm9jZXNzTmFtZScgPSAkUHJvY2Vzc05hbWUKICAgICAgICAgICAgICAgICdUYXJnZXRVc2VycycgPSAkVGFyZ2V0VXNlcnMKICAgICAgICAgICAgICAgICdDcmVkZW50aWFsJyA9ICRDcmVkZW50aWFsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMga2ljayBvZmYgdGhlIHRocmVhZGVkIHNjcmlwdCBibG9jayArIGFyZ3VtZW50cwogICAgICAgICAgICBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1TY3JpcHRQYXJhbWV0ZXJzICRTY3JpcHRQYXJhbXMgLVRocmVhZHMgJFRocmVhZHMKICAgICAgICB9CgogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZigtbm90ICROb1BpbmcgLWFuZCAoJENvbXB1dGVyTmFtZS5jb3VudCAtbmUgMSkpIHsKICAgICAgICAgICAgICAgICMgcGluZyBhbGwgaG9zdHMgaW4gcGFyYWxsZWwKICAgICAgICAgICAgICAgICRQaW5nID0ge3BhcmFtKCRDb21wdXRlck5hbWUpIGlmKFRlc3QtQ29ubmVjdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLUNvdW50IDEgLVF1aWV0IC1FcnJvckFjdGlvbiBTdG9wKXskQ29tcHV0ZXJOYW1lfX0KICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtTm9JbXBvcnRzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtU2NyaXB0QmxvY2sgJFBpbmcgLVRocmVhZHMgMTAwCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBUb3RhbCBudW1iZXIgb2YgYWN0aXZlIGhvc3RzOiAkKCRDb21wdXRlck5hbWUuY291bnQpIgogICAgICAgICAgICAkQ291bnRlciA9IDAKCiAgICAgICAgICAgIEZvckVhY2ggKCRDb21wdXRlciBpbiAkQ29tcHV0ZXJOYW1lKSB7CgogICAgICAgICAgICAgICAgJENvdW50ZXIgPSAkQ291bnRlciArIDEKCiAgICAgICAgICAgICAgICAjIHNsZWVwIGZvciBvdXIgc2VtaS1yYW5kb21pemVkIGludGVydmFsCiAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAtU2Vjb25kcyAkUmFuZE5vLk5leHQoKDEtJEppdHRlcikqJERlbGF5LCAoMSskSml0dGVyKSokRGVsYXkpCgogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIEVudW1lcmF0aW5nIHNlcnZlciAkQ29tcHV0ZXIgKCRDb3VudGVyIG9mICQoJENvbXB1dGVyTmFtZS5jb3VudCkpIgogICAgICAgICAgICAgICAgJFJlc3VsdCA9IEludm9rZS1Db21tYW5kIC1TY3JpcHRCbG9jayAkSG9zdEVudW1CbG9jayAtQXJndW1lbnRMaXN0ICRDb21wdXRlciwgJEZhbHNlLCAkUHJvY2Vzc05hbWUsICRUYXJnZXRVc2VycywgJENyZWRlbnRpYWwKICAgICAgICAgICAgICAgICRSZXN1bHQKCiAgICAgICAgICAgICAgICBpZigkUmVzdWx0IC1hbmQgJFN0b3BPblN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gVGFyZ2V0IHVzZXIvcHJvY2VzcyBmb3VuZCwgcmV0dXJuaW5nIGVhcmx5IgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gSW52b2tlLUV2ZW50SHVudGVyIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBRdWVyaWVzIGFsbCBkb21haW4gY29udHJvbGxlcnMgb24gdGhlIG5ldHdvcmsgZm9yIGFjY291bnQKICAgICAgICBsb2dvbiBldmVudHMgKElEIDQ2MjQpIGFuZCBUR1QgcmVxdWVzdCBldmVudHMgKElEIDQ3NjgpLAogICAgICAgIHNlYXJjaGluZyBmb3IgdGFyZ2V0IHVzZXJzLgoKICAgICAgICBOb3RlOiBEb21haW4gQWRtaW4gKG9yIGVxdWl2KSByaWdodHMgYXJlIG5lZWRlZCB0byBxdWVyeQogICAgICAgIHRoaXMgaW5mb3JtYXRpb24gZnJvbSB0aGUgRENzLgoKICAgICAgICBBdXRob3I6IEBzaXhkdWIsIEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgSG9zdCBhcnJheSB0byBlbnVtZXJhdGUsIHBhc3NhYmxlIG9uIHRoZSBwaXBlbGluZS4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsZQoKICAgICAgICBGaWxlIG9mIGhvc3RuYW1lcy9JUHMgdG8gc2VhcmNoLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJGaWx0ZXIKCiAgICAgICAgSG9zdCBmaWx0ZXIgbmFtZSB0byBxdWVyeSBBRCBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIGhvc3RzLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIEdyb3VwIG5hbWUgdG8gcXVlcnkgZm9yIHRhcmdldCB1c2Vycy4KCiAgICAuUEFSQU1FVEVSIFRhcmdldFNlcnZlcgoKICAgICAgICBIdW50IGZvciB1c2VycyB3aG8gYXJlIGVmZmVjdGl2ZSBsb2NhbCBhZG1pbnMgb24gYSB0YXJnZXQgc2VydmVyLgoKICAgIC5QQVJBTUVURVIgVXNlck5hbWUKCiAgICAgICAgU3BlY2lmaWMgdXNlcm5hbWUgdG8gc2VhcmNoIGZvci4KCiAgICAuUEFSQU1FVEVSIFVzZXJGaWx0ZXIKCiAgICAgICAgQSBjdXN0b21pemVkIGxkYXAgZmlsdGVyIHN0cmluZyB0byB1c2UgZm9yIHVzZXIgZW51bWVyYXRpb24sIGUuZy4gIihkZXNjcmlwdGlvbj0qYWRtaW4qKSIKCiAgICAuUEFSQU1FVEVSIFVzZXJBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCBmb3IgdXNlcnMsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBVc2VyRmlsZQoKICAgICAgICBGaWxlIG9mIHVzZXJuYW1lcyB0byBzZWFyY2ggZm9yLgoKICAgIC5QQVJBTUVURVIgTm9QaW5nCgogICAgICAgIERvbid0IHBpbmcgZWFjaCBob3N0IHRvIGVuc3VyZSBpdCdzIHVwIGJlZm9yZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBEb21haW4gZm9yIHF1ZXJ5IGZvciBtYWNoaW5lcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgU2VhcmNoRGF5cwoKICAgICAgICBOdW1iZXIgb2YgZGF5cyBiYWNrIHRvIHNlYXJjaCBsb2dzIGZvci4gRGVmYXVsdCAzLgoKICAgIC5QQVJBTUVURVIgU2VhcmNoRm9yZXN0CgogICAgICAgIFN3aXRjaC4gU2VhcmNoIGFsbCBkb21haW5zIGluIHRoZSBmb3Jlc3QgZm9yIHRhcmdldCB1c2VycyBpbnN0ZWFkIG9mIGp1c3QKICAgICAgICBhIHNpbmdsZSBkb21haW4uCgogICAgLlBBUkFNRVRFUiBUaHJlYWRzCgogICAgICAgIFRoZSBtYXhpbXVtIGNvbmN1cnJlbnQgdGhyZWFkcyB0byBleGVjdXRlLgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtRXZlbnRIdW50ZXIKCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vYmxvZy5oYXJtajB5Lm5ldAojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdHMnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJENvbXB1dGVyTmFtZSwKCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHtUZXN0LVBhdGggLVBhdGggJF8gfSldCiAgICAgICAgW0FsaWFzKCdIb3N0TGlzdCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyQURTcGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lID0gJ0RvbWFpbiBBZG1pbnMnLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRUYXJnZXRTZXJ2ZXIsCgogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkVXNlck5hbWUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJGaWx0ZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJBRFNwYXRoLAoKICAgICAgICBbVmFsaWRhdGVTY3JpcHQoe1Rlc3QtUGF0aCAtUGF0aCAkXyB9KV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRVc2VyRmlsZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbSW50MzJdCiAgICAgICAgJFNlYXJjaERheXMgPSAzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTZWFyY2hGb3Jlc3QsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwKV0KICAgICAgICBbSW50XQogICAgICAgICRUaHJlYWRzLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIGJlZ2luIHsKCiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snRGVidWcnXSkgewogICAgICAgICAgICAkRGVidWdQcmVmZXJlbmNlID0gJ0NvbnRpbnVlJwogICAgICAgIH0KCiAgICAgICAgIyByYW5kb20gb2JqZWN0IGZvciBkZWxheQogICAgICAgICRSYW5kTm8gPSBOZXctT2JqZWN0IFN5c3RlbS5SYW5kb20KCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFJ1bm5pbmcgSW52b2tlLUV2ZW50SHVudGVyIgoKICAgICAgICBpZigkRG9tYWluKSB7CiAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gQCgkRG9tYWluKQogICAgICAgIH0KICAgICAgICBlbHNlaWYoJFNlYXJjaEZvcmVzdCkgewogICAgICAgICAgICAjIGdldCBBTEwgdGhlIGRvbWFpbnMgaW4gdGhlIGZvcmVzdCB0byBzZWFyY2gKICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBHZXQtTmV0Rm9yZXN0RG9tYWluIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5OYW1lIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICMgdXNlIHRoZSBsb2NhbCBkb21haW4KICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCAoR2V0LU5ldERvbWFpbiAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCkubmFtZSApCiAgICAgICAgfQoKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgICAgICMKICAgICAgICAjIEZpcnN0IHdlIGJ1aWxkIHRoZSBob3N0IHRhcmdldCBzZXQKICAgICAgICAjCiAgICAgICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiAgICAgICAgaWYoISRDb21wdXRlck5hbWUpIHsKICAgICAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyBhIGhvc3QgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgICAgIGlmKCRDb21wdXRlckZpbGUpIHsKICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSBHZXQtQ29udGVudCAtUGF0aCAkQ29tcHV0ZXJGaWxlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRDb21wdXRlckZpbHRlciAtb3IgJENvbXB1dGVyQURTcGF0aCkgewogICAgICAgICAgICAgICAgW2FycmF5XSRDb21wdXRlck5hbWUgPSBAKCkKICAgICAgICAgICAgICAgIEZvckVhY2ggKCREb21haW4gaW4gJFRhcmdldERvbWFpbnMpIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIGhvc3RzIgogICAgICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgKz0gR2V0LU5ldENvbXB1dGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCAtRmlsdGVyICRDb21wdXRlckZpbHRlciAtQURTcGF0aCAkQ29tcHV0ZXJBRFNwYXRoCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAjIGlmIGEgY29tcHV0ZXIgc3BlY2lmaWVyIGlzbid0IGdpdmVuLCB0cnkgdG8gZW51bWVyYXRlIGFsbCBkb21haW4gY29udHJvbGxlcnMKICAgICAgICAgICAgICAgIFthcnJheV0kQ29tcHV0ZXJOYW1lID0gQCgpCiAgICAgICAgICAgICAgICBGb3JFYWNoICgkRG9tYWluIGluICRUYXJnZXREb21haW5zKSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciBkb21haW4gY29udHJvbGxlcnMiCiAgICAgICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSArPSBHZXQtTmV0RG9tYWluQ29udHJvbGxlciAtTERBUCAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgfCBGb3JFYWNoLU9iamVjdCB7ICRfLmRuc2hvc3RuYW1lfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHJlbW92ZSBhbnkgbnVsbCB0YXJnZXQgaG9zdHMsIHVuaXF1aWZ5IHRoZSBsaXN0IGFuZCBzaHVmZmxlIGl0CiAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHsgJF8gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgfCBTb3J0LU9iamVjdCB7IEdldC1SYW5kb20gfQogICAgICAgICAgICBpZigkKCRDb21wdXRlck5hbWUuQ291bnQpIC1lcSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiTm8gaG9zdHMgZm91bmQhIgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgICAgICMKICAgICAgICAjIE5vdyB3ZSBidWlsZCB0aGUgdXNlciB0YXJnZXQgc2V0CiAgICAgICAgIwogICAgICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgogICAgICAgICMgdXNlcnMgd2UncmUgZ29pbmcgdG8gYmUgc2VhcmNoaW5nIGZvcgogICAgICAgICRUYXJnZXRVc2VycyA9IEAoKQoKICAgICAgICAjIGlmIHdlIHdhbnQgdG8gaHVudCBmb3IgdGhlIGVmZmVjdGl2ZSBkb21haW4gdXNlcnMgd2hvIGNhbiBhY2Nlc3MgYSB0YXJnZXQgc2VydmVyCiAgICAgICAgaWYoJFRhcmdldFNlcnZlcikgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJRdWVyeWluZyB0YXJnZXQgc2VydmVyICckVGFyZ2V0U2VydmVyJyBmb3IgbG9jYWwgdXNlcnMiCiAgICAgICAgICAgICRUYXJnZXRVc2VycyA9IEdldC1OZXRMb2NhbEdyb3VwICRUYXJnZXRTZXJ2ZXIgLVJlY3Vyc2UgfCBXaGVyZS1PYmplY3Qgeygtbm90ICRfLklzR3JvdXApIC1hbmQgJF8uSXNEb21haW4gfSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICgkXy5BY2NvdW50TmFtZSkuc3BsaXQoIi8iKVsxXS50b0xvd2VyKCkKICAgICAgICAgICAgfSAgfCBXaGVyZS1PYmplY3QgeyRffQogICAgICAgIH0KICAgICAgICAjIGlmIHdlIGdldCBhIHNwZWNpZmljIHVzZXJuYW1lLCBvbmx5IHVzZSB0aGF0CiAgICAgICAgZWxzZWlmKCRVc2VyTmFtZSkgewogICAgICAgICAgICAjIFdyaXRlLVZlcmJvc2UgIlsqXSBVc2luZyB0YXJnZXQgdXNlciAnJFVzZXJOYW1lJy4uLiIKICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gJFVzZXJOYW1lIHwgRm9yRWFjaC1PYmplY3QgeyRfLlRvTG93ZXIoKX0KICAgICAgICAgICAgaWYoJFRhcmdldFVzZXJzIC1pc25vdCBbU3lzdGVtLkFycmF5XSkgewogICAgICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gQCgkVGFyZ2V0VXNlcnMpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgIyByZWFkIGluIGEgdGFyZ2V0IHVzZXIgbGlzdCBpZiB3ZSBoYXZlIG9uZQogICAgICAgIGVsc2VpZigkVXNlckZpbGUpIHsKICAgICAgICAgICAgJFRhcmdldFVzZXJzID0gR2V0LUNvbnRlbnQgLVBhdGggJFVzZXJGaWxlIHwgV2hlcmUtT2JqZWN0IHskX30KICAgICAgICB9CiAgICAgICAgZWxzZWlmKCRVc2VyQURTcGF0aCAtb3IgJFVzZXJGaWx0ZXIpIHsKICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciB1c2VycyIKICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyArPSBHZXQtTmV0VXNlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUFEU3BhdGggJFVzZXJBRFNwYXRoIC1GaWx0ZXIgJFVzZXJGaWx0ZXIgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgJF8uc2FtYWNjb3VudG5hbWUKICAgICAgICAgICAgICAgIH0gIHwgV2hlcmUtT2JqZWN0IHskX30KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciB1c2VycyBvZiBncm91cCAnJEdyb3VwTmFtZSciCiAgICAgICAgICAgICAgICAkVGFyZ2V0VXNlcnMgKz0gR2V0LU5ldEdyb3VwTWVtYmVyIC1Hcm91cE5hbWUgJEdyb3VwTmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgJF8uTWVtYmVyTmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoKCghJFRhcmdldFVzZXJzKSAtb3IgKCRUYXJnZXRVc2Vycy5Db3VudCAtZXEgMCkpKSB7CiAgICAgICAgICAgIHRocm93ICJbIV0gTm8gdXNlcnMgZm91bmQgdG8gc2VhcmNoIGZvciEiCiAgICAgICAgfQoKICAgICAgICAjIHNjcmlwdCBibG9jayB0aGF0IGVudW1lcmF0ZXMgYSBzZXJ2ZXIKICAgICAgICAkSG9zdEVudW1CbG9jayA9IHsKICAgICAgICAgICAgcGFyYW0oJENvbXB1dGVyTmFtZSwgJFBpbmcsICRUYXJnZXRVc2VycywgJFNlYXJjaERheXMsICRDcmVkZW50aWFsKQoKICAgICAgICAgICAgIyBvcHRpb25hbGx5IGNoZWNrIGlmIHRoZSBzZXJ2ZXIgaXMgdXAgZmlyc3QKICAgICAgICAgICAgJFVwID0gJFRydWUKICAgICAgICAgICAgaWYoJFBpbmcpIHsKICAgICAgICAgICAgICAgICRVcCA9IFRlc3QtQ29ubmVjdGlvbiAtQ291bnQgMSAtUXVpZXQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJFVwKSB7CiAgICAgICAgICAgICAgICAjIHRyeSB0byBlbnVtZXJhdGUKICAgICAgICAgICAgICAgIGlmKCRDcmVkZW50aWFsKSB7CiAgICAgICAgICAgICAgICAgICAgR2V0LVVzZXJFdmVudCAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwgLUV2ZW50VHlwZSAnYWxsJyAtRGF0ZVN0YXJ0IChbRGF0ZVRpbWVdOjpUb2RheS5BZGREYXlzKC0kU2VhcmNoRGF5cykpIHwgV2hlcmUtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBmaWx0ZXIgZm9yIHRoZSB0YXJnZXQgdXNlciBzZXQKICAgICAgICAgICAgICAgICAgICAgICAgJFRhcmdldFVzZXJzIC1jb250YWlucyAkXy5Vc2VyTmFtZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIEdldC1Vc2VyRXZlbnQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1FdmVudFR5cGUgJ2FsbCcgLURhdGVTdGFydCAoW0RhdGVUaW1lXTo6VG9kYXkuQWRkRGF5cygtJFNlYXJjaERheXMpKSB8IFdoZXJlLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgZmlsdGVyIGZvciB0aGUgdGFyZ2V0IHVzZXIgc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICRUYXJnZXRVc2VycyAtY29udGFpbnMgJF8uVXNlck5hbWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQoKICAgIHByb2Nlc3MgewoKICAgICAgICBpZigkVGhyZWFkcykgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJVc2luZyB0aHJlYWRpbmcgd2l0aCB0aHJlYWRzID0gJFRocmVhZHMiCgogICAgICAgICAgICAjIGlmIHdlJ3JlIHVzaW5nIHRocmVhZGluZywga2ljayBvZmYgdGhlIHNjcmlwdCBibG9jayB3aXRoIEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uCiAgICAgICAgICAgICRTY3JpcHRQYXJhbXMgPSBAewogICAgICAgICAgICAgICAgJ1BpbmcnID0gJCgtbm90ICROb1BpbmcpCiAgICAgICAgICAgICAgICAnVGFyZ2V0VXNlcnMnID0gJFRhcmdldFVzZXJzCiAgICAgICAgICAgICAgICAnU2VhcmNoRGF5cycgPSAkU2VhcmNoRGF5cwogICAgICAgICAgICAgICAgJ0NyZWRlbnRpYWwnID0gJENyZWRlbnRpYWwKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBraWNrIG9mZiB0aGUgdGhyZWFkZWQgc2NyaXB0IGJsb2NrICsgYXJndW1lbnRzCiAgICAgICAgICAgIEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtU2NyaXB0QmxvY2sgJEhvc3RFbnVtQmxvY2sgLVNjcmlwdFBhcmFtZXRlcnMgJFNjcmlwdFBhcmFtcyAtVGhyZWFkcyAkVGhyZWFkcwogICAgICAgIH0KCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKC1ub3QgJE5vUGluZyAtYW5kICgkQ29tcHV0ZXJOYW1lLmNvdW50IC1uZSAxKSkgewogICAgICAgICAgICAgICAgIyBwaW5nIGFsbCBob3N0cyBpbiBwYXJhbGxlbAogICAgICAgICAgICAgICAgJFBpbmcgPSB7cGFyYW0oJENvbXB1dGVyTmFtZSkgaWYoVGVzdC1Db25uZWN0aW9uIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtQ291bnQgMSAtUXVpZXQgLUVycm9yQWN0aW9uIFN0b3ApeyRDb21wdXRlck5hbWV9fQogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSA9IEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uIC1Ob0ltcG9ydHMgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1TY3JpcHRCbG9jayAkUGluZyAtVGhyZWFkcyAxMDAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFRvdGFsIG51bWJlciBvZiBhY3RpdmUgaG9zdHM6ICQoJENvbXB1dGVyTmFtZS5jb3VudCkiCiAgICAgICAgICAgICRDb3VudGVyID0gMAoKICAgICAgICAgICAgRm9yRWFjaCAoJENvbXB1dGVyIGluICRDb21wdXRlck5hbWUpIHsKCiAgICAgICAgICAgICAgICAkQ291bnRlciA9ICRDb3VudGVyICsgMQoKICAgICAgICAgICAgICAgICMgc2xlZXAgZm9yIG91ciBzZW1pLXJhbmRvbWl6ZWQgaW50ZXJ2YWwKICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzICRSYW5kTm8uTmV4dCgoMS0kSml0dGVyKSokRGVsYXksICgxKyRKaXR0ZXIpKiREZWxheSkKCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gRW51bWVyYXRpbmcgc2VydmVyICRDb21wdXRlciAoJENvdW50ZXIgb2YgJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSkiCiAgICAgICAgICAgICAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgJEhvc3RFbnVtQmxvY2sgLUFyZ3VtZW50TGlzdCAkQ29tcHV0ZXIsICQoLW5vdCAkTm9QaW5nKSwgJFRhcmdldFVzZXJzLCAkU2VhcmNoRGF5cywgJENyZWRlbnRpYWwKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9Cn0KCgpmdW5jdGlvbiBJbnZva2UtU2hhcmVGaW5kZXIgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFRoaXMgZnVuY3Rpb24gZmluZHMgdGhlIGxvY2FsIGRvbWFpbiBuYW1lIGZvciBhIGhvc3QgdXNpbmcgR2V0LU5ldERvbWFpbiwKICAgICAgICBxdWVyaWVzIHRoZSBkb21haW4gZm9yIGFsbCBhY3RpdmUgbWFjaGluZXMgd2l0aCBHZXQtTmV0Q29tcHV0ZXIsIHRoZW4gZm9yCiAgICAgICAgZWFjaCBzZXJ2ZXIgaXQgbGlzdHMgb2YgYWN0aXZlIHNoYXJlcyB3aXRoIEdldC1OZXRTaGFyZS4gTm9uLXN0YW5kYXJkIHNoYXJlcwogICAgICAgIGNhbiBiZSBmaWx0ZXJlZCBvdXQgd2l0aCAtRXhjbHVkZSogZmxhZ3MuCgogICAgICAgIEF1dGhvcjogQGhhcm1qMHkKICAgICAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBIb3N0IGFycmF5IHRvIGVudW1lcmF0ZSwgcGFzc2FibGUgb24gdGhlIHBpcGVsaW5lLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJGaWxlCgogICAgICAgIEZpbGUgb2YgaG9zdG5hbWVzL0lQcyB0byBzZWFyY2guCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckZpbHRlcgoKICAgICAgICBIb3N0IGZpbHRlciBuYW1lIHRvIHF1ZXJ5IEFEIGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCBmb3IgaG9zdHMsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBFeGNsdWRlU3RhbmRhcmQKCiAgICAgICAgU3dpdGNoLiBFeGNsdWRlIHN0YW5kYXJkIHNoYXJlcyBmcm9tIGRpc3BsYXkgKEMkLCBJUEMkLCBwcmludCQgZXRjLikKCiAgICAuUEFSQU1FVEVSIEV4Y2x1ZGVQcmludAoKICAgICAgICBTd2l0Y2guIEV4Y2x1ZGUgdGhlIHByaW50JCBzaGFyZS4KCiAgICAuUEFSQU1FVEVSIEV4Y2x1ZGVJUEMKCiAgICAgICAgU3dpdGNoLiBFeGNsdWRlIHRoZSBJUEMkIHNoYXJlLgoKICAgIC5QQVJBTUVURVIgQ2hlY2tTaGFyZUFjY2VzcwoKICAgICAgICBTd2l0Y2guIE9ubHkgZGlzcGxheSBmb3VuZCBzaGFyZXMgdGhhdCB0aGUgbG9jYWwgdXNlciBoYXMgYWNjZXNzIHRvLgoKICAgIC5QQVJBTUVURVIgQ2hlY2tBZG1pbgoKICAgICAgICBTd2l0Y2guIE9ubHkgZGlzcGxheSBBRE1JTiQgc2hhcmVzIHRoZSBsb2NhbCB1c2VyIGhhcyBhY2Nlc3MgdG8uCgogICAgLlBBUkFNRVRFUiBOb1BpbmcKCiAgICAgICAgU3dpdGNoLiBEb24ndCBwaW5nIGVhY2ggaG9zdCB0byBlbnN1cmUgaXQncyB1cCBiZWZvcmUgZW51bWVyYXRpbmcuCgogICAgLlBBUkFNRVRFUiBEZWxheQoKICAgICAgICBEZWxheSBiZXR3ZWVuIGVudW1lcmF0aW5nIGhvc3RzLCBkZWZhdWx0cyB0byAwLgoKICAgIC5QQVJBTUVURVIgSml0dGVyCgogICAgICAgIEppdHRlciBmb3IgdGhlIGhvc3QgZGVsYXksIGRlZmF1bHRzIHRvICsvLSAwLjMuCgogICAgLlBBUkFNRVRFUiBEb21haW4KCiAgICAgICAgRG9tYWluIHRvIHF1ZXJ5IGZvciBtYWNoaW5lcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgU2VhcmNoRm9yZXN0CgogICAgICAgIFN3aXRjaC4gU2VhcmNoIGFsbCBkb21haW5zIGluIHRoZSBmb3Jlc3QgZm9yIHRhcmdldCB1c2VycyBpbnN0ZWFkIG9mIGp1c3QKICAgICAgICBhIHNpbmdsZSBkb21haW4uCgogICAgLlBBUkFNRVRFUiBUaHJlYWRzCgogICAgICAgIFRoZSBtYXhpbXVtIGNvbmN1cnJlbnQgdGhyZWFkcyB0byBleGVjdXRlLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVNoYXJlRmluZGVyIC1FeGNsdWRlU3RhbmRhcmQKCiAgICAgICAgRmluZCBub24tc3RhbmRhcmQgc2hhcmVzIG9uIHRoZSBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtU2hhcmVGaW5kZXIgLVRocmVhZHMgMjAKCiAgICAgICAgTXVsdGktdGhyZWFkZWQgc2hhcmUgZmluZGluZywgcmVwbGFjZXMgSW52b2tlLVNoYXJlRmluZGVyVGhyZWFkZWQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtU2hhcmVGaW5kZXIgLURlbGF5IDYwCgogICAgICAgIEZpbmQgc2hhcmVzIG9uIHRoZSBkb21haW4gd2l0aCBhIDYwIHNlY29uZCAoKy8tICouMykKICAgICAgICByYW5kb21pemVkIGRlbGF5IGJldHdlZW4gdG91Y2hpbmcgZWFjaCBob3N0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLVNoYXJlRmluZGVyIC1Db21wdXRlckZpbGUgaG9zdHMudHh0CgogICAgICAgIEZpbmQgc2hhcmVzIGZvciBtYWNoaW5lcyBpbiB0aGUgc3BlY2lmaWVkIGhvc3RzIGZpbGUuCgogICAgLkxJTksKICAgIGh0dHA6Ly9ibG9nLmhhcm1qMHkubmV0CiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0cycpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkQ29tcHV0ZXJOYW1lLAoKICAgICAgICBbVmFsaWRhdGVTY3JpcHQoe1Rlc3QtUGF0aCAtUGF0aCAkXyB9KV0KICAgICAgICBbQWxpYXMoJ0hvc3RMaXN0JyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWxlLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJBRFNwYXRoLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRFeGNsdWRlU3RhbmRhcmQsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEV4Y2x1ZGVQcmludCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRXhjbHVkZUlQQywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTm9QaW5nLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRDaGVja1NoYXJlQWNjZXNzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRDaGVja0FkbWluLAoKICAgICAgICBbVUludDMyXQogICAgICAgICREZWxheSA9IDAsCgogICAgICAgIFtEb3VibGVdCiAgICAgICAgJEppdHRlciA9IC4zLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNlYXJjaEZvcmVzdCwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJFRocmVhZHMKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snRGVidWcnXSkgewogICAgICAgICAgICAkRGVidWdQcmVmZXJlbmNlID0gJ0NvbnRpbnVlJwogICAgICAgIH0KCiAgICAgICAgIyByYW5kb20gb2JqZWN0IGZvciBkZWxheQogICAgICAgICRSYW5kTm8gPSBOZXctT2JqZWN0IFN5c3RlbS5SYW5kb20KCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFJ1bm5pbmcgSW52b2tlLVNoYXJlRmluZGVyIHdpdGggZGVsYXkgb2YgJERlbGF5IgoKICAgICAgICAjIGZpZ3VyZSBvdXQgdGhlIHNoYXJlcyB3ZSB3YW50IHRvIGlnbm9yZQogICAgICAgIFtTdHJpbmdbXV0gJEV4Y2x1ZGVkU2hhcmVzID0gQCgnJykKCiAgICAgICAgaWYgKCRFeGNsdWRlUHJpbnQpIHsKICAgICAgICAgICAgJEV4Y2x1ZGVkU2hhcmVzID0gJEV4Y2x1ZGVkU2hhcmVzICsgIlBSSU5UJCIKICAgICAgICB9CiAgICAgICAgaWYgKCRFeGNsdWRlSVBDKSB7CiAgICAgICAgICAgICRFeGNsdWRlZFNoYXJlcyA9ICRFeGNsdWRlZFNoYXJlcyArICJJUEMkIgogICAgICAgIH0KICAgICAgICBpZiAoJEV4Y2x1ZGVTdGFuZGFyZCkgewogICAgICAgICAgICAkRXhjbHVkZWRTaGFyZXMgPSBAKCcnLCAiQURNSU4kIiwgIklQQyQiLCAiQyQiLCAiUFJJTlQkIikKICAgICAgICB9CgogICAgICAgICMgaWYgd2UncmUgdXNpbmcgYSBob3N0IGZpbGUgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgaWYoJENvbXB1dGVyRmlsZSkgewogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gR2V0LUNvbnRlbnQgLVBhdGggJENvbXB1dGVyRmlsZQogICAgICAgIH0KCiAgICAgICAgaWYoISRDb21wdXRlck5hbWUpIHsKICAgICAgICAgICAgW2FycmF5XSRDb21wdXRlck5hbWUgPSBAKCkKCiAgICAgICAgICAgIGlmKCREb21haW4pIHsKICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gQCgkRG9tYWluKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZigkU2VhcmNoRm9yZXN0KSB7CiAgICAgICAgICAgICAgICAjIGdldCBBTEwgdGhlIGRvbWFpbnMgaW4gdGhlIGZvcmVzdCB0byBzZWFyY2gKICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gR2V0LU5ldEZvcmVzdERvbWFpbiB8IEZvckVhY2gtT2JqZWN0IHsgJF8uTmFtZSB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAjIHVzZSB0aGUgbG9jYWwgZG9tYWluCiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoIChHZXQtTmV0RG9tYWluKS5uYW1lICkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciBob3N0cyIKICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgKz0gR2V0LU5ldENvbXB1dGVyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtRmlsdGVyICRDb21wdXRlckZpbHRlciAtQURTcGF0aCAkQ29tcHV0ZXJBRFNwYXRoCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgcmVtb3ZlIGFueSBudWxsIHRhcmdldCBob3N0cywgdW5pcXVpZnkgdGhlIGxpc3QgYW5kIHNodWZmbGUgaXQKICAgICAgICAgICAgJENvbXB1dGVyTmFtZSA9ICRDb21wdXRlck5hbWUgfCBXaGVyZS1PYmplY3QgeyAkXyB9IHwgU29ydC1PYmplY3QgLVVuaXF1ZSB8IFNvcnQtT2JqZWN0IHsgR2V0LVJhbmRvbSB9CiAgICAgICAgICAgIGlmKCQoJENvbXB1dGVyTmFtZS5jb3VudCkgLWVxIDApIHsKICAgICAgICAgICAgICAgIHRocm93ICJObyBob3N0cyBmb3VuZCEiCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgc2NyaXB0IGJsb2NrIHRoYXQgZW51bWVyYXRlcyBhIHNlcnZlcgogICAgICAgICRIb3N0RW51bUJsb2NrID0gewogICAgICAgICAgICBwYXJhbSgkQ29tcHV0ZXJOYW1lLCAkUGluZywgJENoZWNrU2hhcmVBY2Nlc3MsICRFeGNsdWRlZFNoYXJlcywgJENoZWNrQWRtaW4pCgogICAgICAgICAgICAjIG9wdGlvbmFsbHkgY2hlY2sgaWYgdGhlIHNlcnZlciBpcyB1cCBmaXJzdAogICAgICAgICAgICAkVXAgPSAkVHJ1ZQogICAgICAgICAgICBpZigkUGluZykgewogICAgICAgICAgICAgICAgJFVwID0gVGVzdC1Db25uZWN0aW9uIC1Db3VudCAxIC1RdWlldCAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkVXApIHsKICAgICAgICAgICAgICAgICMgZ2V0IHRoZSBzaGFyZXMgZm9yIHRoaXMgaG9zdCBhbmQgY2hlY2sgd2hhdCB3ZSBmaW5kCiAgICAgICAgICAgICAgICAkU2hhcmVzID0gR2V0LU5ldFNoYXJlIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgRm9yRWFjaCAoJFNoYXJlIGluICRTaGFyZXMpIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gU2VydmVyIHNoYXJlOiAkU2hhcmUiCiAgICAgICAgICAgICAgICAgICAgJE5ldE5hbWUgPSAkU2hhcmUuc2hpMV9uZXRuYW1lCiAgICAgICAgICAgICAgICAgICAgJFJlbWFyayA9ICRTaGFyZS5zaGkxX3JlbWFyawogICAgICAgICAgICAgICAgICAgICRQYXRoID0gJ1xcJyskQ29tcHV0ZXJOYW1lKydcJyskTmV0TmFtZQoKICAgICAgICAgICAgICAgICAgICAjIG1ha2Ugc3VyZSB3ZSBnZXQgYSByZWFsIHNoYXJlIG5hbWUgYmFjawogICAgICAgICAgICAgICAgICAgIGlmICgoJE5ldE5hbWUpIC1hbmQgKCROZXROYW1lLnRyaW0oKSAtbmUgJycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgd2UncmUganVzdCBjaGVja2luZyBmb3IgYWNjZXNzIHRvIEFETUlOJAogICAgICAgICAgICAgICAgICAgICAgICBpZigkQ2hlY2tBZG1pbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJE5ldE5hbWUuVG9VcHBlcigpIC1lcSAiQURNSU4kIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICROdWxsID0gW0lPLkRpcmVjdG9yeV06OkdldEZpbGVzKCRQYXRoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiXFwkQ29tcHV0ZXJOYW1lXCROZXROYW1lIGB0LSAkUmVtYXJrIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIGFjY2Vzc2luZyBwYXRoICRQYXRoIDogJF8iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICMgc2tpcCB0aGlzIHNoYXJlIGlmIGl0J3MgaW4gdGhlIGV4Y2x1ZGUgbGlzdAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKCRFeGNsdWRlZFNoYXJlcyAtTm90Q29udGFpbnMgJE5ldE5hbWUuVG9VcHBlcigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHNlZSBpZiB3ZSB3YW50IHRvIGNoZWNrIGFjY2VzcyB0byB0aGlzIHNoYXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkQ2hlY2tTaGFyZUFjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgY2hlY2sgaWYgdGhlIHVzZXIgaGFzIGFjY2VzcyB0byB0aGlzIHBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTnVsbCA9IFtJTy5EaXJlY3RvcnldOjpHZXRGaWxlcygkUGF0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlxcJENvbXB1dGVyTmFtZVwkTmV0TmFtZSBgdC0gJFJlbWFyayIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBhY2Nlc3NpbmcgcGF0aCAkUGF0aCA6ICRfIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJcXCRDb21wdXRlck5hbWVcJE5ldE5hbWUgYHQtICRSZW1hcmsiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQoKICAgIHByb2Nlc3MgewoKICAgICAgICBpZigkVGhyZWFkcykgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJVc2luZyB0aHJlYWRpbmcgd2l0aCB0aHJlYWRzID0gJFRocmVhZHMiCgogICAgICAgICAgICAjIGlmIHdlJ3JlIHVzaW5nIHRocmVhZGluZywga2ljayBvZmYgdGhlIHNjcmlwdCBibG9jayB3aXRoIEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uCiAgICAgICAgICAgICRTY3JpcHRQYXJhbXMgPSBAewogICAgICAgICAgICAgICAgJ1BpbmcnID0gJCgtbm90ICROb1BpbmcpCiAgICAgICAgICAgICAgICAnQ2hlY2tTaGFyZUFjY2VzcycgPSAkQ2hlY2tTaGFyZUFjY2VzcwogICAgICAgICAgICAgICAgJ0V4Y2x1ZGVkU2hhcmVzJyA9ICRFeGNsdWRlZFNoYXJlcwogICAgICAgICAgICAgICAgJ0NoZWNrQWRtaW4nID0gJENoZWNrQWRtaW4KICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBraWNrIG9mZiB0aGUgdGhyZWFkZWQgc2NyaXB0IGJsb2NrICsgYXJndW1lbnRzCiAgICAgICAgICAgIEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtU2NyaXB0QmxvY2sgJEhvc3RFbnVtQmxvY2sgLVNjcmlwdFBhcmFtZXRlcnMgJFNjcmlwdFBhcmFtcyAtVGhyZWFkcyAkVGhyZWFkcwogICAgICAgIH0KCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKC1ub3QgJE5vUGluZyAtYW5kICgkQ29tcHV0ZXJOYW1lLmNvdW50IC1uZSAxKSkgewogICAgICAgICAgICAgICAgIyBwaW5nIGFsbCBob3N0cyBpbiBwYXJhbGxlbAogICAgICAgICAgICAgICAgJFBpbmcgPSB7cGFyYW0oJENvbXB1dGVyTmFtZSkgaWYoVGVzdC1Db25uZWN0aW9uIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtQ291bnQgMSAtUXVpZXQgLUVycm9yQWN0aW9uIFN0b3ApeyRDb21wdXRlck5hbWV9fQogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSA9IEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uIC1Ob0ltcG9ydHMgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1TY3JpcHRCbG9jayAkUGluZyAtVGhyZWFkcyAxMDAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFRvdGFsIG51bWJlciBvZiBhY3RpdmUgaG9zdHM6ICQoJENvbXB1dGVyTmFtZS5jb3VudCkiCiAgICAgICAgICAgICRDb3VudGVyID0gMAoKICAgICAgICAgICAgRm9yRWFjaCAoJENvbXB1dGVyIGluICRDb21wdXRlck5hbWUpIHsKCiAgICAgICAgICAgICAgICAkQ291bnRlciA9ICRDb3VudGVyICsgMQoKICAgICAgICAgICAgICAgICMgc2xlZXAgZm9yIG91ciBzZW1pLXJhbmRvbWl6ZWQgaW50ZXJ2YWwKICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzICRSYW5kTm8uTmV4dCgoMS0kSml0dGVyKSokRGVsYXksICgxKyRKaXR0ZXIpKiREZWxheSkKCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gRW51bWVyYXRpbmcgc2VydmVyICRDb21wdXRlciAoJENvdW50ZXIgb2YgJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSkiCiAgICAgICAgICAgICAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgJEhvc3RFbnVtQmxvY2sgLUFyZ3VtZW50TGlzdCAkQ29tcHV0ZXIsICRGYWxzZSwgJENoZWNrU2hhcmVBY2Nlc3MsICRFeGNsdWRlZFNoYXJlcywgJENoZWNrQWRtaW4KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9Cn0KCgpmdW5jdGlvbiBJbnZva2UtRmlsZUZpbmRlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgRmluZHMgc2Vuc2l0aXZlIGZpbGVzIG9uIHRoZSBkb21haW4uCgogICAgICAgIEF1dGhvcjogQGhhcm1qMHkKICAgICAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKCiAgICAuREVTQ1JJUFRJT04KCiAgICAgICAgVGhpcyBmdW5jdGlvbiBmaW5kcyB0aGUgbG9jYWwgZG9tYWluIG5hbWUgZm9yIGEgaG9zdCB1c2luZyBHZXQtTmV0RG9tYWluLAogICAgICAgIHF1ZXJpZXMgdGhlIGRvbWFpbiBmb3IgYWxsIGFjdGl2ZSBtYWNoaW5lcyB3aXRoIEdldC1OZXRDb21wdXRlciwgZ3JhYnMKICAgICAgICB0aGUgcmVhZGFibGUgc2hhcmVzIGZvciBlYWNoIHNlcnZlciwgYW5kIHJlY3Vyc2l2ZWx5IHNlYXJjaGVzIGV2ZXJ5CiAgICAgICAgc2hhcmUgZm9yIGZpbGVzIHdpdGggc3BlY2lmaWMga2V5d29yZHMgaW4gdGhlIG5hbWUuCiAgICAgICAgSWYgYSBzaGFyZSBsaXN0IGlzIHBhc3NlZCwgRVZFUlkgc2hhcmUgaXMgZW51bWVyYXRlZCByZWdhcmRsZXNzIG9mCiAgICAgICAgb3RoZXIgb3B0aW9ucy4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBIb3N0IGFycmF5IHRvIGVudW1lcmF0ZSwgcGFzc2FibGUgb24gdGhlIHBpcGVsaW5lLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJGaWxlCgogICAgICAgIEZpbGUgb2YgaG9zdG5hbWVzL0lQcyB0byBzZWFyY2guCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckZpbHRlcgoKICAgICAgICBIb3N0IGZpbHRlciBuYW1lIHRvIHF1ZXJ5IEFEIGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCBmb3IgaG9zdHMsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBTaGFyZUxpc3QKCiAgICAgICAgTGlzdCBpZiBcXEhPU1Rcc2hhcmVzIHRvIHNlYXJjaCB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgVGVybXMKCiAgICAgICAgVGVybXMgdG8gc2VhcmNoIGZvci4KCiAgICAuUEFSQU1FVEVSIE9mZmljZURvY3MKCiAgICAgICAgU3dpdGNoLiBTZWFyY2ggZm9yIG9mZmljZSBkb2N1bWVudHMgKCouZG9jKiwgKi54bHMqLCAqLnBwdCopCgogICAgLlBBUkFNRVRFUiBGcmVzaEVYRXMKCiAgICAgICAgU3dpdGNoLiBGaW5kIC5FWEVzIGFjY2Vzc2VkIHdpdGhpbiB0aGUgbGFzdCB3ZWVrLgoKICAgIC5QQVJBTUVURVIgTGFzdEFjY2Vzc1RpbWUKCiAgICAgICAgT25seSByZXR1cm4gZmlsZXMgd2l0aCBhIExhc3RBY2Nlc3NUaW1lIGdyZWF0ZXIgdGhhbiB0aGlzIGRhdGUgdmFsdWUuCgogICAgLlBBUkFNRVRFUiBMYXN0V3JpdGVUaW1lCgogICAgICAgIE9ubHkgcmV0dXJuIGZpbGVzIHdpdGggYSBMYXN0V3JpdGVUaW1lIGdyZWF0ZXIgdGhhbiB0aGlzIGRhdGUgdmFsdWUuCgogICAgLlBBUkFNRVRFUiBDcmVhdGlvblRpbWUKCiAgICAgICAgT25seSByZXR1cm4gZmlsZXMgd2l0aCBhIENyZWF0aW9uRGF0ZSBncmVhdGVyIHRoYW4gdGhpcyBkYXRlIHZhbHVlLgoKICAgIC5QQVJBTUVURVIgSW5jbHVkZUMKCiAgICAgICAgU3dpdGNoLiBJbmNsdWRlIGFueSBDJCBzaGFyZXMgaW4gcmVjdXJzaXZlIHNlYXJjaGluZyAoZGVmYXVsdCBpZ25vcmUpLgoKICAgIC5QQVJBTUVURVIgSW5jbHVkZUFkbWluCgogICAgICAgIFN3aXRjaC4gSW5jbHVkZSBhbnkgQURNSU4kIHNoYXJlcyBpbiByZWN1cnNpdmUgc2VhcmNoaW5nIChkZWZhdWx0IGlnbm9yZSkuCgogICAgLlBBUkFNRVRFUiBFeGNsdWRlRm9sZGVycwoKICAgICAgICBTd2l0Y2guIEV4Y2x1ZGUgZm9sZGVycyBmcm9tIHRoZSBzZWFyY2ggcmVzdWx0cy4KCiAgICAuUEFSQU1FVEVSIEV4Y2x1ZGVIaWRkZW4KCiAgICAgICAgU3dpdGNoLiBFeGNsdWRlIGhpZGRlbiBmaWxlcyBhbmQgZm9sZGVycyBmcm9tIHRoZSBzZWFyY2ggcmVzdWx0cy4KCiAgICAuUEFSQU1FVEVSIENoZWNrV3JpdGVBY2Nlc3MKCiAgICAgICAgU3dpdGNoLiBPbmx5IHJldHVybnMgZmlsZXMgdGhlIGN1cnJlbnQgdXNlciBoYXMgd3JpdGUgYWNjZXNzIHRvLgoKICAgIC5QQVJBTUVURVIgT3V0RmlsZQoKICAgICAgICBPdXRwdXQgcmVzdWx0cyB0byBhIHNwZWNpZmllZCBjc3Ygb3V0cHV0IGZpbGUuCgogICAgLlBBUkFNRVRFUiBOb0Nsb2JiZXIKCiAgICAgICAgU3dpdGNoLiBEb24ndCBvdmVyd3JpdGUgYW55IGV4aXN0aW5nIG91dHB1dCBmaWxlLgoKICAgIC5QQVJBTUVURVIgTm9QaW5nCgogICAgICAgIFN3aXRjaC4gRG9uJ3QgcGluZyBlYWNoIGhvc3QgdG8gZW5zdXJlIGl0J3MgdXAgYmVmb3JlIGVudW1lcmF0aW5nLgoKICAgIC5QQVJBTUVURVIgRGVsYXkKCiAgICAgICAgRGVsYXkgYmV0d2VlbiBlbnVtZXJhdGluZyBob3N0cywgZGVmYXVsdHMgdG8gMAoKICAgIC5QQVJBTUVURVIgSml0dGVyCgogICAgICAgIEppdHRlciBmb3IgdGhlIGhvc3QgZGVsYXksIGRlZmF1bHRzIHRvICsvLSAwLjMKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBEb21haW4gdG8gcXVlcnkgZm9yIG1hY2hpbmVzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBTZWFyY2hGb3Jlc3QKCiAgICAgICAgU2VhcmNoIGFsbCBkb21haW5zIGluIHRoZSBmb3Jlc3QgZm9yIHRhcmdldCB1c2VycyBpbnN0ZWFkIG9mIGp1c3QKICAgICAgICBhIHNpbmdsZSBkb21haW4uCgogICAgLlBBUkFNRVRFUiBTZWFyY2hTWVNWT0wKCiAgICAgICAgU3dpdGNoLiBTZWFyY2ggZm9yIGxvZ2luIHNjcmlwdHMgb24gdGhlIFNZU1ZPTCBvZiB0aGUgcHJpbWFyeSBEQ3MgZm9yIGVhY2ggc3BlY2lmaWVkIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIFRocmVhZHMKCiAgICAgICAgVGhlIG1heGltdW0gY29uY3VycmVudCB0aHJlYWRzIHRvIGV4ZWN1dGUuCgogICAgLlBBUkFNRVRFUiBVc2VQU0RyaXZlCgogICAgICAgIFN3aXRjaC4gTW91bnQgdGFyZ2V0IHJlbW90ZSBwYXRoIHdpdGggdGVtcG9yYXJ5IFBTRHJpdmVzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLUZpbGVGaW5kZXIKCiAgICAgICAgRmluZCByZWFkYWJsZSBmaWxlcyBvbiB0aGUgZG9tYWluIHdpdGggJ3Bhc3MnLCAnc2Vuc2l0aXZlJywKICAgICAgICAnc2VjcmV0JywgJ2FkbWluJywgJ2xvZ2luJywgb3IgJ3VuYXR0ZW5kKi54bWwnIGluIHRoZSBuYW1lLAoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gSW52b2tlLUZpbGVGaW5kZXIgLURvbWFpbiB0ZXN0aW5nCgogICAgICAgIEZpbmQgcmVhZGFibGUgZmlsZXMgb24gdGhlICd0ZXN0aW5nJyBkb21haW4gd2l0aCAncGFzcycsICdzZW5zaXRpdmUnLAogICAgICAgICdzZWNyZXQnLCAnYWRtaW4nLCAnbG9naW4nLCBvciAndW5hdHRlbmQqLnhtbCcgaW4gdGhlIG5hbWUsCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtRmlsZUZpbmRlciAtSW5jbHVkZUMKCiAgICAgICAgRmluZCByZWFkYWJsZSBmaWxlcyBvbiB0aGUgZG9tYWluIHdpdGggJ3Bhc3MnLCAnc2Vuc2l0aXZlJywKICAgICAgICAnc2VjcmV0JywgJ2FkbWluJywgJ2xvZ2luJyBvciAndW5hdHRlbmQqLnhtbCcgaW4gdGhlIG5hbWUsCiAgICAgICAgaW5jbHVkaW5nIEMkIHNoYXJlcy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1GaWxlRmluZGVyIC1TaGFyZUxpc3Qgc2hhcmVzLnR4dCAtVGVybXMgYWNjb3VudHMsc3NuIC1PdXRGaWxlIG91dC5jc3YKCiAgICAgICAgRW51bWVyYXRlIGEgc3BlY2lmaWVkIHNoYXJlIGxpc3QgZm9yIGZpbGVzIHdpdGggJ2FjY291bnRzJyBvcgogICAgICAgICdzc24nIGluIHRoZSBuYW1lLCBhbmQgd3JpdGUgZXZlcnl0aGluZyB0byAib3V0LmNzdiIKCiAgICAuTElOSwogICAgICAgIGh0dHA6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9yZWR0ZWFtaW5nL2ZpbGUtc2VydmVyLXRyaWFnZS1vbi1yZWQtdGVhbS1lbmdhZ2VtZW50cy8KCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0cycpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkQ29tcHV0ZXJOYW1lLAoKICAgICAgICBbVmFsaWRhdGVTY3JpcHQoe1Rlc3QtUGF0aCAtUGF0aCAkXyB9KV0KICAgICAgICBbQWxpYXMoJ0hvc3RMaXN0JyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWxlLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJBRFNwYXRoLAoKICAgICAgICBbVmFsaWRhdGVTY3JpcHQoe1Rlc3QtUGF0aCAtUGF0aCAkXyB9KV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRTaGFyZUxpc3QsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJE9mZmljZURvY3MsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEZyZXNoRVhFcywKCiAgICAgICAgW0FsaWFzKCdUZXJtcycpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkU2VhcmNoVGVybXMsCgogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7VGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFRlcm1MaXN0LAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRMYXN0QWNjZXNzVGltZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkTGFzdFdyaXRlVGltZSwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ3JlYXRpb25UaW1lLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRJbmNsdWRlQywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkSW5jbHVkZUFkbWluLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRFeGNsdWRlRm9sZGVycywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkRXhjbHVkZUhpZGRlbiwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQ2hlY2tXcml0ZUFjY2VzcywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkT3V0RmlsZSwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTm9DbG9iYmVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICROb1BpbmcsCgogICAgICAgIFtVSW50MzJdCiAgICAgICAgJERlbGF5ID0gMCwKCiAgICAgICAgW0RvdWJsZV0KICAgICAgICAkSml0dGVyID0gLjMsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2VhcmNoRm9yZXN0LAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTZWFyY2hTWVNWT0wsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwKV0KICAgICAgICBbSW50XQogICAgICAgICRUaHJlYWRzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRVc2VQU0RyaXZlCiAgICApCgogICAgYmVnaW4gewogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0RlYnVnJ10pIHsKICAgICAgICAgICAgJERlYnVnUHJlZmVyZW5jZSA9ICdDb250aW51ZScKICAgICAgICB9CgogICAgICAgICMgcmFuZG9tIG9iamVjdCBmb3IgZGVsYXkKICAgICAgICAkUmFuZE5vID0gTmV3LU9iamVjdCBTeXN0ZW0uUmFuZG9tCgogICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBSdW5uaW5nIEludm9rZS1GaWxlRmluZGVyIHdpdGggZGVsYXkgb2YgJERlbGF5IgoKICAgICAgICAkU2hhcmVzID0gQCgpCgogICAgICAgICMgZmlndXJlIG91dCB0aGUgc2hhcmVzIHdlIHdhbnQgdG8gaWdub3JlCiAgICAgICAgW1N0cmluZ1tdXSAkRXhjbHVkZWRTaGFyZXMgPSBAKCJDJCIsICJBRE1JTiQiKQoKICAgICAgICAjIHNlZSBpZiB3ZSdyZSBzcGVjaWZpY2FsbHkgaW5jbHVkaW5nIGFueSBvZiB0aGUgbm9ybWFsbHkgZXhjbHVkZWQgc2V0cwogICAgICAgIGlmICgkSW5jbHVkZUMpIHsKICAgICAgICAgICAgaWYgKCRJbmNsdWRlQWRtaW4pIHsKICAgICAgICAgICAgICAgICRFeGNsdWRlZFNoYXJlcyA9IEAoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJEV4Y2x1ZGVkU2hhcmVzID0gQCgiQURNSU4kIikKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCRJbmNsdWRlQWRtaW4pIHsKICAgICAgICAgICAgaWYgKCRJbmNsdWRlQykgewogICAgICAgICAgICAgICAgJEV4Y2x1ZGVkU2hhcmVzID0gQCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkRXhjbHVkZWRTaGFyZXMgPSBAKCJDJCIpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgZGVsZXRlIGFueSBleGlzdGluZyBvdXRwdXQgZmlsZSBpZiBpdCBhbHJlYWR5IGV4aXN0cwogICAgICAgIGlmKCEkTm9DbG9iYmVyKSB7CiAgICAgICAgICAgIGlmICgkT3V0RmlsZSAtYW5kIChUZXN0LVBhdGggLVBhdGggJE91dEZpbGUpKSB7IFJlbW92ZS1JdGVtIC1QYXRoICRPdXRGaWxlIH0KICAgICAgICB9CgogICAgICAgICMgaWYgdGhlcmUncyBhIHNldCBvZiB0ZXJtcyBzcGVjaWZpZWQgdG8gc2VhcmNoIGZvcgogICAgICAgIGlmICgkVGVybUxpc3QpIHsKICAgICAgICAgICAgRm9yRWFjaCAoJFRlcm0gaW4gR2V0LUNvbnRlbnQgLVBhdGggJFRlcm1MaXN0KSB7CiAgICAgICAgICAgICAgICBpZiAoKCRUZXJtIC1uZSAkTnVsbCkgLWFuZCAoJFRlcm0udHJpbSgpIC1uZSAnJykpIHsKICAgICAgICAgICAgICAgICAgICAkU2VhcmNoVGVybXMgKz0gJFRlcm0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBpZiB3ZSdyZSBoYXJkLXBhc3NlZCBhIHNldCBvZiBzaGFyZXMKICAgICAgICBpZigkU2hhcmVMaXN0KSB7CiAgICAgICAgICAgIEZvckVhY2ggKCRJdGVtIGluIEdldC1Db250ZW50IC1QYXRoICRTaGFyZUxpc3QpIHsKICAgICAgICAgICAgICAgIGlmICgoJEl0ZW0gLW5lICROdWxsKSAtYW5kICgkSXRlbS50cmltKCkgLW5lICcnKSkgewogICAgICAgICAgICAgICAgICAgICMgZXhjbHVkZSBhbnkgIlt0YWJdLSBjb21tYW50cyIsIGkuZS4gdGhlIG91dHB1dCBmcm9tIEludm9rZS1TaGFyZUZpbmRlcgogICAgICAgICAgICAgICAgICAgICRTaGFyZSA9ICRJdGVtLlNwbGl0KCJgdCIpWzBdCiAgICAgICAgICAgICAgICAgICAgJFNoYXJlcyArPSAkU2hhcmUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyBhIGhvc3QgZmlsZSBsaXN0LCByZWFkIHRoZSB0YXJnZXRzIGluIGFuZCBhZGQgdGhlbSB0byB0aGUgdGFyZ2V0IGxpc3QKICAgICAgICAgICAgaWYoJENvbXB1dGVyRmlsZSkgewogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSA9IEdldC1Db250ZW50IC1QYXRoICRDb21wdXRlckZpbGUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoISRDb21wdXRlck5hbWUpIHsKCiAgICAgICAgICAgICAgICBpZigkRG9tYWluKSB7CiAgICAgICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCREb21haW4pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYoJFNlYXJjaEZvcmVzdCkgewogICAgICAgICAgICAgICAgICAgICMgZ2V0IEFMTCB0aGUgZG9tYWlucyBpbiB0aGUgZm9yZXN0IHRvIHNlYXJjaAogICAgICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gR2V0LU5ldEZvcmVzdERvbWFpbiB8IEZvckVhY2gtT2JqZWN0IHsgJF8uTmFtZSB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAjIHVzZSB0aGUgbG9jYWwgZG9tYWluCiAgICAgICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCAoR2V0LU5ldERvbWFpbikubmFtZSApCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoJFNlYXJjaFNZU1ZPTCkgewogICAgICAgICAgICAgICAgICAgIEZvckVhY2ggKCREb21haW4gaW4gJFRhcmdldERvbWFpbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJERDU2VhcmNoUGF0aCA9ICJcXCREb21haW5cU1lTVk9MXCIKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIEFkZGluZyBzaGFyZSBzZWFyY2ggcGF0aCAkRENTZWFyY2hQYXRoIgogICAgICAgICAgICAgICAgICAgICAgICAkU2hhcmVzICs9ICREQ1NlYXJjaFBhdGgKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoISRTZWFyY2hUZXJtcykgewogICAgICAgICAgICAgICAgICAgICAgICAjIHNlYXJjaCBmb3IgaW50ZXJlc3Rpbmcgc2NyaXB0cyBvbiBTWVNWT0wKICAgICAgICAgICAgICAgICAgICAgICAgJFNlYXJjaFRlcm1zID0gQCgnLnZicycsICcuYmF0JywgJy5wczEnKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIFthcnJheV0kQ29tcHV0ZXJOYW1lID0gQCgpCgogICAgICAgICAgICAgICAgICAgIEZvckVhY2ggKCREb21haW4gaW4gJFRhcmdldERvbWFpbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciBob3N0cyIKICAgICAgICAgICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSArPSBHZXQtTmV0Q29tcHV0ZXIgLUZpbHRlciAkQ29tcHV0ZXJGaWx0ZXIgLUFEU3BhdGggJENvbXB1dGVyQURTcGF0aCAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICMgcmVtb3ZlIGFueSBudWxsIHRhcmdldCBob3N0cywgdW5pcXVpZnkgdGhlIGxpc3QgYW5kIHNodWZmbGUgaXQKICAgICAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJENvbXB1dGVyTmFtZSB8IFdoZXJlLU9iamVjdCB7ICRfIH0gfCBTb3J0LU9iamVjdCAtVW5pcXVlIHwgU29ydC1PYmplY3QgeyBHZXQtUmFuZG9tIH0KICAgICAgICAgICAgICAgICAgICBpZigkKCRDb21wdXRlck5hbWUuQ291bnQpIC1lcSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93ICJObyBob3N0cyBmb3VuZCEiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHNjcmlwdCBibG9jayB0aGF0IGVudW1lcmF0ZXMgc2hhcmVzIGFuZCBmaWxlcyBvbiBhIHNlcnZlcgogICAgICAgICRIb3N0RW51bUJsb2NrID0gewogICAgICAgICAgICBwYXJhbSgkQ29tcHV0ZXJOYW1lLCAkUGluZywgJEV4Y2x1ZGVkU2hhcmVzLCAkU2VhcmNoVGVybXMsICRFeGNsdWRlRm9sZGVycywgJE9mZmljZURvY3MsICRFeGNsdWRlSGlkZGVuLCAkRnJlc2hFWEVzLCAkQ2hlY2tXcml0ZUFjY2VzcywgJE91dEZpbGUsICRVc2VQU0RyaXZlKQoKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiQ29tcHV0ZXJOYW1lOiAkQ29tcHV0ZXJOYW1lIgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFeGNsdWRlZFNoYXJlczogJEV4Y2x1ZGVkU2hhcmVzIgogICAgICAgICAgICAkU2VhcmNoU2hhcmVzID0gQCgpCgogICAgICAgICAgICBpZigkQ29tcHV0ZXJOYW1lLlN0YXJ0c1dpdGgoIlxcIikpIHsKICAgICAgICAgICAgICAgICMgaWYgYSBzaGFyZSBpcyBwYXNzZWQgYXMgdGhlIHNlcnZlcgogICAgICAgICAgICAgICAgJFNlYXJjaFNoYXJlcyArPSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIGVudW1lcmF0aW5nIHRoZSBzaGFyZXMgb24gdGhlIHRhcmdldCBzZXJ2ZXIgZmlyc3QKICAgICAgICAgICAgICAgICRVcCA9ICRUcnVlCiAgICAgICAgICAgICAgICBpZigkUGluZykgewogICAgICAgICAgICAgICAgICAgICRVcCA9IFRlc3QtQ29ubmVjdGlvbiAtQ291bnQgMSAtUXVpZXQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZigkVXApIHsKICAgICAgICAgICAgICAgICAgICAjIGdldCB0aGUgc2hhcmVzIGZvciB0aGlzIGhvc3QgYW5kIGRpc3BsYXkgd2hhdCB3ZSBmaW5kCiAgICAgICAgICAgICAgICAgICAgJFNoYXJlcyA9IEdldC1OZXRTaGFyZSAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgICAgICBGb3JFYWNoICgkU2hhcmUgaW4gJFNoYXJlcykgewoKICAgICAgICAgICAgICAgICAgICAgICAgJE5ldE5hbWUgPSAkU2hhcmUuc2hpMV9uZXRuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRQYXRoID0gJ1xcJyskQ29tcHV0ZXJOYW1lKydcJyskTmV0TmFtZQoKICAgICAgICAgICAgICAgICAgICAgICAgIyBtYWtlIHN1cmUgd2UgZ2V0IGEgcmVhbCBzaGFyZSBuYW1lIGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCgkTmV0TmFtZSkgLWFuZCAoJE5ldE5hbWUudHJpbSgpIC1uZSAnJykpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHNraXAgdGhpcyBzaGFyZSBpZiBpdCdzIGluIHRoZSBleGNsdWRlIGxpc3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkRXhjbHVkZWRTaGFyZXMgLU5vdENvbnRhaW5zICROZXROYW1lLlRvVXBwZXIoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgY2hlY2sgaWYgdGhlIHVzZXIgaGFzIGFjY2VzcyB0byB0aGlzIHBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTnVsbCA9IFtJTy5EaXJlY3RvcnldOjpHZXRGaWxlcygkUGF0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFNlYXJjaFNoYXJlcyArPSAkUGF0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlshXSBObyBhY2Nlc3MgdG8gJFBhdGgiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBGb3JFYWNoKCRTaGFyZSBpbiAkU2VhcmNoU2hhcmVzKSB7CiAgICAgICAgICAgICAgICAkU2VhcmNoQXJncyA9ICBAewogICAgICAgICAgICAgICAgICAgICdQYXRoJyA9ICRTaGFyZQogICAgICAgICAgICAgICAgICAgICdTZWFyY2hUZXJtcycgPSAkU2VhcmNoVGVybXMKICAgICAgICAgICAgICAgICAgICAnT2ZmaWNlRG9jcycgPSAkT2ZmaWNlRG9jcwogICAgICAgICAgICAgICAgICAgICdGcmVzaEVYRXMnID0gJEZyZXNoRVhFcwogICAgICAgICAgICAgICAgICAgICdMYXN0QWNjZXNzVGltZScgPSAkTGFzdEFjY2Vzc1RpbWUKICAgICAgICAgICAgICAgICAgICAnTGFzdFdyaXRlVGltZScgPSAkTGFzdFdyaXRlVGltZQogICAgICAgICAgICAgICAgICAgICdDcmVhdGlvblRpbWUnID0gJENyZWF0aW9uVGltZQogICAgICAgICAgICAgICAgICAgICdFeGNsdWRlRm9sZGVycycgPSAkRXhjbHVkZUZvbGRlcnMKICAgICAgICAgICAgICAgICAgICAnRXhjbHVkZUhpZGRlbicgPSAkRXhjbHVkZUhpZGRlbgogICAgICAgICAgICAgICAgICAgICdDaGVja1dyaXRlQWNjZXNzJyA9ICRDaGVja1dyaXRlQWNjZXNzCiAgICAgICAgICAgICAgICAgICAgJ091dEZpbGUnID0gJE91dEZpbGUKICAgICAgICAgICAgICAgICAgICAnVXNlUFNEcml2ZScgPSAkVXNlUFNEcml2ZQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEZpbmQtSW50ZXJlc3RpbmdGaWxlIEBTZWFyY2hBcmdzCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIGlmKCRUaHJlYWRzKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlVzaW5nIHRocmVhZGluZyB3aXRoIHRocmVhZHMgPSAkVGhyZWFkcyIKCiAgICAgICAgICAgICMgaWYgd2UncmUgdXNpbmcgdGhyZWFkaW5nLCBraWNrIG9mZiB0aGUgc2NyaXB0IGJsb2NrIHdpdGggSW52b2tlLVRocmVhZGVkRnVuY3Rpb24KICAgICAgICAgICAgJFNjcmlwdFBhcmFtcyA9IEB7CiAgICAgICAgICAgICAgICAnUGluZycgPSAkKC1ub3QgJE5vUGluZykKICAgICAgICAgICAgICAgICdFeGNsdWRlZFNoYXJlcycgPSAkRXhjbHVkZWRTaGFyZXMKICAgICAgICAgICAgICAgICdTZWFyY2hUZXJtcycgPSAkU2VhcmNoVGVybXMKICAgICAgICAgICAgICAgICdFeGNsdWRlRm9sZGVycycgPSAkRXhjbHVkZUZvbGRlcnMKICAgICAgICAgICAgICAgICdPZmZpY2VEb2NzJyA9ICRPZmZpY2VEb2NzCiAgICAgICAgICAgICAgICAnRXhjbHVkZUhpZGRlbicgPSAkRXhjbHVkZUhpZGRlbgogICAgICAgICAgICAgICAgJ0ZyZXNoRVhFcycgPSAkRnJlc2hFWEVzCiAgICAgICAgICAgICAgICAnQ2hlY2tXcml0ZUFjY2VzcycgPSAkQ2hlY2tXcml0ZUFjY2VzcwogICAgICAgICAgICAgICAgJ091dEZpbGUnID0gJE91dEZpbGUKICAgICAgICAgICAgICAgICdVc2VQU0RyaXZlJyA9ICRVc2VQU0RyaXZlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMga2ljayBvZmYgdGhlIHRocmVhZGVkIHNjcmlwdCBibG9jayArIGFyZ3VtZW50cwogICAgICAgICAgICBpZigkU2hhcmVzKSB7CiAgICAgICAgICAgICAgICAjIHBhc3MgdGhlIHNoYXJlcyBhcyB0aGUgaG9zdHMgc28gdGhlIHRocmVhZGVkIGZ1bmN0aW9uIGNvZGUgZG9lc24ndCBoYXZlIHRvIGJlIGhhY2tlZCB1cAogICAgICAgICAgICAgICAgSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLUNvbXB1dGVyTmFtZSAkU2hhcmVzIC1TY3JpcHRCbG9jayAkSG9zdEVudW1CbG9jayAtU2NyaXB0UGFyYW1ldGVycyAkU2NyaXB0UGFyYW1zIC1UaHJlYWRzICRUaHJlYWRzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1TY3JpcHRQYXJhbWV0ZXJzICRTY3JpcHRQYXJhbXMgLVRocmVhZHMgJFRocmVhZHMKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCRTaGFyZXMpewogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSA9ICRTaGFyZXMKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoLW5vdCAkTm9QaW5nIC1hbmQgKCRDb21wdXRlck5hbWUuY291bnQgLWd0IDEpKSB7CiAgICAgICAgICAgICAgICAjIHBpbmcgYWxsIGhvc3RzIGluIHBhcmFsbGVsCiAgICAgICAgICAgICAgICAkUGluZyA9IHtwYXJhbSgkQ29tcHV0ZXJOYW1lKSBpZihUZXN0LUNvbm5lY3Rpb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1Db3VudCAxIC1RdWlldCAtRXJyb3JBY3Rpb24gU3RvcCl7JENvbXB1dGVyTmFtZX19CiAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gSW52b2tlLVRocmVhZGVkRnVuY3Rpb24gLU5vSW1wb3J0cyAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRQaW5nIC1UaHJlYWRzIDEwMAogICAgICAgICAgICB9CgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gVG90YWwgbnVtYmVyIG9mIGFjdGl2ZSBob3N0czogJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSIKICAgICAgICAgICAgJENvdW50ZXIgPSAwCgogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDb21wdXRlcjogJF8iCiAgICAgICAgICAgICAgICAkQ291bnRlciA9ICRDb3VudGVyICsgMQoKICAgICAgICAgICAgICAgICMgc2xlZXAgZm9yIG91ciBzZW1pLXJhbmRvbWl6ZWQgaW50ZXJ2YWwKICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzICRSYW5kTm8uTmV4dCgoMS0kSml0dGVyKSokRGVsYXksICgxKyRKaXR0ZXIpKiREZWxheSkKCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gRW51bWVyYXRpbmcgc2VydmVyICRfICgkQ291bnRlciBvZiAkKCRDb21wdXRlck5hbWUuY291bnQpKSIKCiAgICAgICAgICAgICAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgJEhvc3RFbnVtQmxvY2sgLUFyZ3VtZW50TGlzdCAkXywgJEZhbHNlLCAkRXhjbHVkZWRTaGFyZXMsICRTZWFyY2hUZXJtcywgJEV4Y2x1ZGVGb2xkZXJzLCAkT2ZmaWNlRG9jcywgJEV4Y2x1ZGVIaWRkZW4sICRGcmVzaEVYRXMsICRDaGVja1dyaXRlQWNjZXNzLCAkT3V0RmlsZSwgJFVzZVBTRHJpdmUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEZpbmQtTG9jYWxBZG1pbkFjY2VzcyB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgRmluZHMgbWFjaGluZXMgb24gdGhlIGxvY2FsIGRvbWFpbiB3aGVyZSB0aGUgY3VycmVudCB1c2VyIGhhcwogICAgICAgIGxvY2FsIGFkbWluaXN0cmF0b3IgYWNjZXNzLiBVc2VzIG11bHRpdGhyZWFkaW5nIHRvCiAgICAgICAgc3BlZWQgdXAgZW51bWVyYXRpb24uCgogICAgICAgIEF1dGhvcjogQGhhcm1qMHkKICAgICAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKCiAgICAuREVTQ1JJUFRJT04KCiAgICAgICAgVGhpcyBmdW5jdGlvbiBmaW5kcyB0aGUgbG9jYWwgZG9tYWluIG5hbWUgZm9yIGEgaG9zdCB1c2luZyBHZXQtTmV0RG9tYWluLAogICAgICAgIHF1ZXJpZXMgdGhlIGRvbWFpbiBmb3IgYWxsIGFjdGl2ZSBtYWNoaW5lcyB3aXRoIEdldC1OZXRDb21wdXRlciwgdGhlbiBmb3IKICAgICAgICBlYWNoIHNlcnZlciBpdCBjaGVja3MgaWYgdGhlIGN1cnJlbnQgdXNlciBoYXMgbG9jYWwgYWRtaW5pc3RyYXRvcgogICAgICAgIGFjY2VzcyB1c2luZyBJbnZva2UtQ2hlY2tMb2NhbEFkbWluQWNjZXNzLgoKICAgICAgICBJZGVhIHN0b2xlbiBmcm9tIHRoZSBsb2NhbF9hZG1pbl9zZWFyY2hfZW51bSBwb3N0IG1vZHVsZSBpbgogICAgICAgIE1ldGFzcGxvaXQgd3JpdHRlbiBieToKICAgICAgICAgICAgJ0JyYW5kb24gTWNDYW5uICJ6ZWtub3giIDxibWNjYW5uW2F0XWFjY3V2YW50LmNvbT4nCiAgICAgICAgICAgICdUaG9tYXMgTWNDYXJ0aHkgInNtaWxpbmdyYWNjb29uIiA8c21pbGluZ3JhY2Nvb25bYXRdZ21haWwuY29tPicKICAgICAgICAgICAgJ1JveWNlIERhdmlzICJyM2R5IiA8cmRhdmlzW2F0XWFjY3V2YW50LmNvbT4nCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgSG9zdCBhcnJheSB0byBlbnVtZXJhdGUsIHBhc3NhYmxlIG9uIHRoZSBwaXBlbGluZS4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyRmlsZQoKICAgICAgICBGaWxlIG9mIGhvc3RuYW1lcy9JUHMgdG8gc2VhcmNoLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJGaWx0ZXIKCiAgICAgICAgSG9zdCBmaWx0ZXIgbmFtZSB0byBxdWVyeSBBRCBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2ggZm9yIGhvc3RzLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgTm9QaW5nCgogICAgICAgIFN3aXRjaC4gRG9uJ3QgcGluZyBlYWNoIGhvc3QgdG8gZW5zdXJlIGl0J3MgdXAgYmVmb3JlIGVudW1lcmF0aW5nLgoKICAgIC5QQVJBTUVURVIgRGVsYXkKCiAgICAgICAgRGVsYXkgYmV0d2VlbiBlbnVtZXJhdGluZyBob3N0cywgZGVmYXVsdHMgdG8gMAoKICAgIC5QQVJBTUVURVIgSml0dGVyCgogICAgICAgIEppdHRlciBmb3IgdGhlIGhvc3QgZGVsYXksIGRlZmF1bHRzIHRvICsvLSAwLjMKCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBEb21haW4gdG8gcXVlcnkgZm9yIG1hY2hpbmVzLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uCgogICAgLlBBUkFNRVRFUiBEb21haW5Db250cm9sbGVyCgogICAgICAgIERvbWFpbiBjb250cm9sbGVyIHRvIHJlZmxlY3QgTERBUCBxdWVyaWVzIHRocm91Z2guCgogICAgLlBBUkFNRVRFUiBTZWFyY2hGb3Jlc3QKCiAgICAgICAgU3dpdGNoLiBTZWFyY2ggYWxsIGRvbWFpbnMgaW4gdGhlIGZvcmVzdCBmb3IgdGFyZ2V0IHVzZXJzIGluc3RlYWQgb2YganVzdAogICAgICAgIGEgc2luZ2xlIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIFRocmVhZHMKCiAgICAgICAgVGhlIG1heGltdW0gY29uY3VycmVudCB0aHJlYWRzIHRvIGV4ZWN1dGUuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUxvY2FsQWRtaW5BY2Nlc3MKCiAgICAgICAgRmluZCBtYWNoaW5lcyBvbiB0aGUgbG9jYWwgZG9tYWluIHdoZXJlIHRoZSBjdXJyZW50IHVzZXIgaGFzIGxvY2FsCiAgICAgICAgYWRtaW5pc3RyYXRvciBhY2Nlc3MuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUxvY2FsQWRtaW5BY2Nlc3MgLVRocmVhZHMgMTAKCiAgICAgICAgTXVsdGktdGhyZWFkZWQgYWNjZXNzIGh1bnRpbmcsIHJlcGxhY2VzIEZpbmQtTG9jYWxBZG1pbkFjY2Vzc1RocmVhZGVkLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gRmluZC1Mb2NhbEFkbWluQWNjZXNzIC1Eb21haW4gdGVzdGluZwoKICAgICAgICBGaW5kIG1hY2hpbmVzIG9uIHRoZSAndGVzdGluZycgZG9tYWluIHdoZXJlIHRoZSBjdXJyZW50IHVzZXIgaGFzCiAgICAgICAgbG9jYWwgYWRtaW5pc3RyYXRvciBhY2Nlc3MuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLUxvY2FsQWRtaW5BY2Nlc3MgLUNvbXB1dGVyRmlsZSBob3N0cy50eHQKCiAgICAgICAgRmluZCB3aGljaCBtYWNoaW5lcyBpbiB0aGUgaG9zdCBsaXN0IHRoZSBjdXJyZW50IHVzZXIgaGFzIGxvY2FsCiAgICAgICAgYWRtaW5pc3RyYXRvciBhY2Nlc3MuCgogICAgLkxJTksKCiAgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL3JhcGlkNy9tZXRhc3Bsb2l0LWZyYW1ld29yay9ibG9iL21hc3Rlci9tb2R1bGVzL3Bvc3Qvd2luZG93cy9nYXRoZXIvbG9jYWxfYWRtaW5fc2VhcmNoX2VudW0ucmIKICAgICAgICBodHRwOi8vd3d3Lmhhcm1qMHkubmV0L2Jsb2cvcGVuZXRlc3RpbmcvZmluZGluZy1sb2NhbC1hZG1pbi13aXRoLXRoZS12ZWlsLWZyYW1ld29yay8KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0hvc3RzJyldCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgICRDb21wdXRlck5hbWUsCgogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7VGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtBbGlhcygnSG9zdExpc3QnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckZpbGUsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENvbXB1dGVyRmlsdGVyLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckFEU3BhdGgsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJE5vUGluZywKCiAgICAgICAgW1VJbnQzMl0KICAgICAgICAkRGVsYXkgPSAwLAoKICAgICAgICBbRG91YmxlXQogICAgICAgICRKaXR0ZXIgPSAuMywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTZWFyY2hGb3Jlc3QsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwKV0KICAgICAgICBbSW50XQogICAgICAgICRUaHJlYWRzCiAgICApCgogICAgYmVnaW4gewogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0RlYnVnJ10pIHsKICAgICAgICAgICAgJERlYnVnUHJlZmVyZW5jZSA9ICdDb250aW51ZScKICAgICAgICB9CgogICAgICAgICMgcmFuZG9tIG9iamVjdCBmb3IgZGVsYXkKICAgICAgICAkUmFuZE5vID0gTmV3LU9iamVjdCBTeXN0ZW0uUmFuZG9tCgogICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBSdW5uaW5nIEZpbmQtTG9jYWxBZG1pbkFjY2VzcyB3aXRoIGRlbGF5IG9mICREZWxheSIKCiAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyBhIGhvc3QgbGlzdCwgcmVhZCB0aGUgdGFyZ2V0cyBpbiBhbmQgYWRkIHRoZW0gdG8gdGhlIHRhcmdldCBsaXN0CiAgICAgICAgaWYoJENvbXB1dGVyRmlsZSkgewogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gR2V0LUNvbnRlbnQgLVBhdGggJENvbXB1dGVyRmlsZQogICAgICAgIH0KCiAgICAgICAgaWYoISRDb21wdXRlck5hbWUpIHsKICAgICAgICAgICAgW2FycmF5XSRDb21wdXRlck5hbWUgPSBAKCkKCiAgICAgICAgICAgIGlmKCREb21haW4pIHsKICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gQCgkRG9tYWluKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZigkU2VhcmNoRm9yZXN0KSB7CiAgICAgICAgICAgICAgICAjIGdldCBBTEwgdGhlIGRvbWFpbnMgaW4gdGhlIGZvcmVzdCB0byBzZWFyY2gKICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gR2V0LU5ldEZvcmVzdERvbWFpbiB8IEZvckVhY2gtT2JqZWN0IHsgJF8uTmFtZSB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAjIHVzZSB0aGUgbG9jYWwgZG9tYWluCiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWlucyA9IEAoIChHZXQtTmV0RG9tYWluKS5uYW1lICkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgRm9yRWFjaCAoJERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIFF1ZXJ5aW5nIGRvbWFpbiAkRG9tYWluIGZvciBob3N0cyIKICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgKz0gR2V0LU5ldENvbXB1dGVyIC1GaWx0ZXIgJENvbXB1dGVyRmlsdGVyIC1BRFNwYXRoICRDb21wdXRlckFEU3BhdGggLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgcmVtb3ZlIGFueSBudWxsIHRhcmdldCBob3N0cywgdW5pcXVpZnkgdGhlIGxpc3QgYW5kIHNodWZmbGUgaXQKICAgICAgICAgICAgJENvbXB1dGVyTmFtZSA9ICRDb21wdXRlck5hbWUgfCBXaGVyZS1PYmplY3QgeyAkXyB9IHwgU29ydC1PYmplY3QgLVVuaXF1ZSB8IFNvcnQtT2JqZWN0IHsgR2V0LVJhbmRvbSB9CiAgICAgICAgICAgIGlmKCQoJENvbXB1dGVyTmFtZS5Db3VudCkgLWVxIDApIHsKICAgICAgICAgICAgICAgIHRocm93ICJObyBob3N0cyBmb3VuZCEiCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgc2NyaXB0IGJsb2NrIHRoYXQgZW51bWVyYXRlcyBhIHNlcnZlcgogICAgICAgICRIb3N0RW51bUJsb2NrID0gewogICAgICAgICAgICBwYXJhbSgkQ29tcHV0ZXJOYW1lLCAkUGluZykKCiAgICAgICAgICAgICRVcCA9ICRUcnVlCiAgICAgICAgICAgIGlmKCRQaW5nKSB7CiAgICAgICAgICAgICAgICAkVXAgPSBUZXN0LUNvbm5lY3Rpb24gLUNvdW50IDEgLVF1aWV0IC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRVcCkgewogICAgICAgICAgICAgICAgIyBjaGVjayBpZiB0aGUgY3VycmVudCB1c2VyIGhhcyBsb2NhbCBhZG1pbiBhY2Nlc3MgdG8gdGhpcyBzZXJ2ZXIKICAgICAgICAgICAgICAgICRBY2Nlc3MgPSBJbnZva2UtQ2hlY2tMb2NhbEFkbWluQWNjZXNzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgaWYgKCRBY2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQoKICAgIHByb2Nlc3MgewoKICAgICAgICBpZigkVGhyZWFkcykgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJVc2luZyB0aHJlYWRpbmcgd2l0aCB0aHJlYWRzID0gJFRocmVhZHMiCgogICAgICAgICAgICAjIGlmIHdlJ3JlIHVzaW5nIHRocmVhZGluZywga2ljayBvZmYgdGhlIHNjcmlwdCBibG9jayB3aXRoIEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uCiAgICAgICAgICAgICRTY3JpcHRQYXJhbXMgPSBAewogICAgICAgICAgICAgICAgJ1BpbmcnID0gJCgtbm90ICROb1BpbmcpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMga2ljayBvZmYgdGhlIHRocmVhZGVkIHNjcmlwdCBibG9jayArIGFyZ3VtZW50cwogICAgICAgICAgICBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1TY3JpcHRQYXJhbWV0ZXJzICRTY3JpcHRQYXJhbXMgLVRocmVhZHMgJFRocmVhZHMKICAgICAgICB9CgogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZigtbm90ICROb1BpbmcgLWFuZCAoJENvbXB1dGVyTmFtZS5jb3VudCAtbmUgMSkpIHsKICAgICAgICAgICAgICAgICMgcGluZyBhbGwgaG9zdHMgaW4gcGFyYWxsZWwKICAgICAgICAgICAgICAgICRQaW5nID0ge3BhcmFtKCRDb21wdXRlck5hbWUpIGlmKFRlc3QtQ29ubmVjdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLUNvdW50IDEgLVF1aWV0IC1FcnJvckFjdGlvbiBTdG9wKXskQ29tcHV0ZXJOYW1lfX0KICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtTm9JbXBvcnRzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtU2NyaXB0QmxvY2sgJFBpbmcgLVRocmVhZHMgMTAwCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBUb3RhbCBudW1iZXIgb2YgYWN0aXZlIGhvc3RzOiAkKCRDb21wdXRlck5hbWUuY291bnQpIgogICAgICAgICAgICAkQ291bnRlciA9IDAKCiAgICAgICAgICAgIEZvckVhY2ggKCRDb21wdXRlciBpbiAkQ29tcHV0ZXJOYW1lKSB7CgogICAgICAgICAgICAgICAgJENvdW50ZXIgPSAkQ291bnRlciArIDEKCiAgICAgICAgICAgICAgICAjIHNsZWVwIGZvciBvdXIgc2VtaS1yYW5kb21pemVkIGludGVydmFsCiAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAtU2Vjb25kcyAkUmFuZE5vLk5leHQoKDEtJEppdHRlcikqJERlbGF5LCAoMSskSml0dGVyKSokRGVsYXkpCgogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIEVudW1lcmF0aW5nIHNlcnZlciAkQ29tcHV0ZXIgKCRDb3VudGVyIG9mICQoJENvbXB1dGVyTmFtZS5jb3VudCkpIgogICAgICAgICAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1Bcmd1bWVudExpc3QgJENvbXB1dGVyLCAkRmFsc2UKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1FeHBsb2l0YWJsZVN5c3RlbSB7CjwjCiAgICAuU3lub3BzaXMKCiAgICAgICAgVGhpcyBtb2R1bGUgd2lsbCBxdWVyeSBBY3RpdmUgRGlyZWN0b3J5IGZvciB0aGUgaG9zdG5hbWUsIE9TIHZlcnNpb24sIGFuZCBzZXJ2aWNlIHBhY2sgbGV2ZWwKICAgICAgICBmb3IgZWFjaCBjb21wdXRlciBhY2NvdW50LiAgVGhhdCBpbmZvcm1hdGlvbiBpcyB0aGVuIGNyb3NzLXJlZmVyZW5jZWQgYWdhaW5zdCBhIGxpc3Qgb2YgY29tbW9uCiAgICAgICAgTWV0YXNwbG9pdCBleHBsb2l0cyB0aGF0IGNhbiBiZSB1c2VkIGR1cmluZyBwZW5ldHJhdGlvbiB0ZXN0aW5nLgoKICAgIC5ERVNDUklQVElPTgoKICAgICAgICBUaGlzIG1vZHVsZSB3aWxsIHF1ZXJ5IEFjdGl2ZSBEaXJlY3RvcnkgZm9yIHRoZSBob3N0bmFtZSwgT1MgdmVyc2lvbiwgYW5kIHNlcnZpY2UgcGFjayBsZXZlbAogICAgICAgIGZvciBlYWNoIGNvbXB1dGVyIGFjY291bnQuICBUaGF0IGluZm9ybWF0aW9uIGlzIHRoZW4gY3Jvc3MtcmVmZXJlbmNlZCBhZ2FpbnN0IGEgbGlzdCBvZiBjb21tb24KICAgICAgICBNZXRhc3Bsb2l0IGV4cGxvaXRzIHRoYXQgY2FuIGJlIHVzZWQgZHVyaW5nIHBlbmV0cmF0aW9uIHRlc3RpbmcuICBUaGUgc2NyaXB0IGZpbHRlcnMgb3V0IGRpc2FibGVkCiAgICAgICAgZG9tYWluIGNvbXB1dGVycyBhbmQgcHJvdmlkZXMgdGhlIGNvbXB1dGVyJ3MgbGFzdCBsb2dvbiB0aW1lIHRvIGhlbHAgZGV0ZXJtaW5lIGlmIGl0J3MgYmVlbgogICAgICAgIGRlY29tbWlzc2lvbmVkLiAgQWxzbywgc2luY2UgdGhlIHNjcmlwdCB1c2VzIGRhdGEgdGFibGVzIHRvIG91dHB1dCBhZmZlY3RlZCBzeXN0ZW1zIHRoZSByZXN1bHRzCiAgICAgICAgY2FuIGJlIGVhc2lseSBwaXBlZCB0byBvdGhlciBjb21tYW5kcyBzdWNoIGFzIHRlc3QtY29ubmVjdGlvbiBvciBhIEV4cG9ydC1Dc3YuCgogICAgLlBBUkFNRVRFUiBDb21wdXRlck5hbWUKCiAgICAgICAgUmV0dXJuIGNvbXB1dGVycyB3aXRoIGEgc3BlY2lmaWMgbmFtZSwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgU1BOCgogICAgICAgIFJldHVybiBjb21wdXRlcnMgd2l0aCBhIHNwZWNpZmljIHNlcnZpY2UgcHJpbmNpcGFsIG5hbWUsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIE9wZXJhdGluZ1N5c3RlbQoKICAgICAgICBSZXR1cm4gY29tcHV0ZXJzIHdpdGggYSBzcGVjaWZpYyBvcGVyYXRpbmcgc3lzdGVtLCB3aWxkY2FyZHMgYWNjZXB0ZWQuCgogICAgLlBBUkFNRVRFUiBTZXJ2aWNlUGFjawoKICAgICAgICBSZXR1cm4gY29tcHV0ZXJzIHdpdGggYSBzcGVjaWZpYyBzZXJ2aWNlIHBhY2ssIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIEZpbHRlcgoKICAgICAgICBBIGN1c3RvbWl6ZWQgbGRhcCBmaWx0ZXIgc3RyaW5nIHRvIHVzZSwgZS5nLiAiKGRlc2NyaXB0aW9uPSphZG1pbiopIgoKICAgIC5QQVJBTUVURVIgUGluZwoKICAgICAgICBTd2l0Y2guIFBpbmcgZWFjaCBob3N0IHRvIGVuc3VyZSBpdCdzIHVwIGJlZm9yZSBlbnVtZXJhdGluZy4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBUaGUgZG9tYWluIHRvIHF1ZXJ5IGZvciBjb21wdXRlcnMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIEFEU3BhdGgKCiAgICAgICAgVGhlIExEQVAgc291cmNlIHRvIHNlYXJjaCB0aHJvdWdoLCBlLmcuICJMREFQOi8vT1U9c2VjcmV0LERDPXRlc3RsYWIsREM9bG9jYWwiCiAgICAgICAgVXNlZnVsIGZvciBPVSBxdWVyaWVzLgoKICAgIC5QQVJBTUVURVIgVW5jb25zdHJhaW5lZAoKICAgICAgICBTd2l0Y2guIFJldHVybiBjb21wdXRlciBvYmplY3RzIHRoYXQgaGF2ZSB1bmNvbnN0cmFpbmVkIGRlbGVnYXRpb24uCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMKICAgICAgICBmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBUaGUgZXhhbXBsZSBiZWxvdyBzaG93cyB0aGUgc3RhbmRhcmQgY29tbWFuZCB1c2FnZS4gIERpc2FibGVkIHN5c3RlbSBhcmUgZXhjbHVkZWQgYnkgZGVmYXVsdCwgYnV0CiAgICAgICAgdGhlICJMYXN0TGdvbiIgY29sdW1uIGNhbiBiZSB1c2VkIHRvIGRldGVybWluZSB3aGljaCBzeXN0ZW1zIGFyZSBsaXZlLiAgVXN1YWxseSwgaWYgYSBzeXN0ZW0gaGFzbid0CiAgICAgICAgbG9nZ2VkIG9uIGZvciB0d28gb3IgbW9yZSB3ZWVrcyBpdCdzIGJlZW4gZGVjb21taXNzaW9uZWQuCiAgICAgICAgUFMgQzpcPiBHZXQtRXhwbG9pdGFibGVTeXN0ZW0gLURvbWFpbkNvbnRyb2xsZXIgMTkyLjE2OC4xLjEgLUNyZWRlbnRpYWwgZGVtby5jb21cdXNlciB8IEZvcm1hdC1UYWJsZSAtQXV0b1NpemUKICAgICAgICBbKl0gR3JhYmJpbmcgY29tcHV0ZXIgYWNjb3VudHMgZnJvbSBBY3RpdmUgRGlyZWN0b3J5Li4uCiAgICAgICAgWypdIExvYWRpbmcgZXhwbG9pdCBsaXN0IGZvciBjcml0aWNhbCBtaXNzaW5nIHBhdGNoZXMuLi4KICAgICAgICBbKl0gQ2hlY2tpbmcgY29tcHV0ZXJzIGZvciB2dWxuZXJhYmxlIE9TIGFuZCBTUCBsZXZlbHMuLi4KICAgICAgICBbK10gRm91bmQgNSBwb3RlbnRpYWxseSB2dWxuZXJhYmxlIHN5c3RlbXMhCiAgICAgICAgQ29tcHV0ZXJOYW1lICAgICAgICAgIE9wZXJhdGluZ1N5c3RlbSAgICAgICAgIFNlcnZpY2VQYWNrICAgIExhc3RMb2dvbiAgICAgICAgICAgIE1zZk1vZHVsZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ1ZFCiAgICAgICAgLS0tLS0tLS0tLS0tICAgICAgICAgIC0tLS0tLS0tLS0tLS0tLSAgICAgICAgIC0tLS0tLS0tLS0tICAgIC0tLS0tLS0tLSAgICAgICAgICAgIC0tLS0tLS0tLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0tCiAgICAgICAgQURTLmRlbW8uY29tICAgICAgICAgIFdpbmRvd3MgU2VydmVyIDIwMDMgICAgIFNlcnZpY2UgUGFjayAyIDQvOC8yMDE1IDU6NDY6NTIgUE0gIGV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwN18wMjlfbXNkbnNfem9uZW5hbWUgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLgogICAgICAgIEFEUy5kZW1vLmNvbSAgICAgICAgICBXaW5kb3dzIFNlcnZlciAyMDAzICAgICBTZXJ2aWNlIFBhY2sgMiA0LzgvMjAxNSA1OjQ2OjUyIFBNICBleHBsb2l0L3dpbmRvd3Mvc21iL21zMDhfMDY3X25ldGFwaSAgICAgICAgICAgIGh0dHA6Ly93d3cuY3ZlZGV0YWlscy4uLi4KICAgICAgICBBRFMuZGVtby5jb20gICAgICAgICAgV2luZG93cyBTZXJ2ZXIgMjAwMyAgICAgU2VydmljZSBQYWNrIDIgNC84LzIwMTUgNTo0Njo1MiBQTSAgZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzICAgICAgICAgICBodHRwOi8vd3d3LmN2ZWRldGFpbHMuLi4uCiAgICAgICAgTFZBLmRlbW8uY29tICAgICAgICAgIFdpbmRvd3MgU2VydmVyIDIwMDMgICAgIFNlcnZpY2UgUGFjayAyIDQvOC8yMDE1IDE6NDQ6NDYgUE0gIGV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwN18wMjlfbXNkbnNfem9uZW5hbWUgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLgogICAgICAgIExWQS5kZW1vLmNvbSAgICAgICAgICBXaW5kb3dzIFNlcnZlciAyMDAzICAgICBTZXJ2aWNlIFBhY2sgMiA0LzgvMjAxNSAxOjQ0OjQ2IFBNICBleHBsb2l0L3dpbmRvd3Mvc21iL21zMDhfMDY3X25ldGFwaSAgICAgICAgICAgIGh0dHA6Ly93d3cuY3ZlZGV0YWlscy4uLi4KICAgICAgICBMVkEuZGVtby5jb20gICAgICAgICAgV2luZG93cyBTZXJ2ZXIgMjAwMyAgICAgU2VydmljZSBQYWNrIDIgNC84LzIwMTUgMTo0NDo0NiBQTSAgZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzICAgICAgICAgICBodHRwOi8vd3d3LmN2ZWRldGFpbHMuLi4uCiAgICAgICAgYXNzZXNzLXhwcHJvLmRlbW8uY29tIFdpbmRvd3MgWFAgUHJvZmVzc2lvbmFsIFNlcnZpY2UgUGFjayAzIDQvMS8yMDE0IDExOjExOjU0IEFNIGV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpICAgICAgICAgICAgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLgogICAgICAgIGFzc2Vzcy14cHByby5kZW1vLmNvbSBXaW5kb3dzIFhQIFByb2Zlc3Npb25hbCBTZXJ2aWNlIFBhY2sgMyA0LzEvMjAxNCAxMToxMTo1NCBBTSBleHBsb2l0L3dpbmRvd3Mvc21iL21zMTBfMDYxX3Nwb29sc3MgICAgICAgICAgIGh0dHA6Ly93d3cuY3ZlZGV0YWlscy4uLi4KICAgICAgICBIVkEuZGVtby5jb20gICAgICAgICAgV2luZG93cyBTZXJ2ZXIgMjAwMyAgICAgU2VydmljZSBQYWNrIDIgMTEvNS8yMDEzIDk6MTY6MzEgUE0gZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA3XzAyOV9tc2Ruc196b25lbmFtZSBodHRwOi8vd3d3LmN2ZWRldGFpbHMuLi4uCiAgICAgICAgSFZBLmRlbW8uY29tICAgICAgICAgIFdpbmRvd3MgU2VydmVyIDIwMDMgICAgIFNlcnZpY2UgUGFjayAyIDExLzUvMjAxMyA5OjE2OjMxIFBNIGV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpICAgICAgICAgICAgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLgogICAgICAgIEhWQS5kZW1vLmNvbSAgICAgICAgICBXaW5kb3dzIFNlcnZlciAyMDAzICAgICBTZXJ2aWNlIFBhY2sgMiAxMS81LzIwMTMgOToxNjozMSBQTSBleHBsb2l0L3dpbmRvd3Mvc21iL21zMTBfMDYxX3Nwb29sc3MgICAgICAgICAgIGh0dHA6Ly93d3cuY3ZlZGV0YWlscy4uLi4KICAgICAgICBEQjEuZGVtby5jb20gICAgICAgICAgV2luZG93cyBTZXJ2ZXIgMjAwMyAgICAgU2VydmljZSBQYWNrIDIgMy8yMi8yMDEyIDU6MDU6MzQgUE0gZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA3XzAyOV9tc2Ruc196b25lbmFtZSBodHRwOi8vd3d3LmN2ZWRldGFpbHMuLi4uCiAgICAgICAgREIxLmRlbW8uY29tICAgICAgICAgIFdpbmRvd3MgU2VydmVyIDIwMDMgICAgIFNlcnZpY2UgUGFjayAyIDMvMjIvMjAxMiA1OjA1OjM0IFBNIGV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpICAgICAgICAgICAgaHR0cDovL3d3dy5jdmVkZXRhaWxzLi4uLgogICAgICAgIERCMS5kZW1vLmNvbSAgICAgICAgICBXaW5kb3dzIFNlcnZlciAyMDAzICAgICBTZXJ2aWNlIFBhY2sgMiAzLzIyLzIwMTIgNTowNTozNCBQTSBleHBsb2l0L3dpbmRvd3Mvc21iL21zMTBfMDYxX3Nwb29sc3MgICAgICAgICAgIGh0dHA6Ly93d3cuY3ZlZGV0YWlscy4uLi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1FeHBsb2l0YWJsZVN5c3RlbSB8IEV4cG9ydC1Dc3YgYzpcdGVtcFxvdXRwdXQuY3N2IC1Ob1R5cGVJbmZvcm1hdGlvbgoKICAgICAgICBIb3cgdG8gd3JpdGUgdGhlIG91dHB1dCB0byBhIGNzdiBmaWxlLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUV4cGxvaXRhYmxlU3lzdGVtIC1Eb21haW4gdGVzdGxhYi5sb2NhbCAtUGluZwoKICAgICAgICBSZXR1cm4gYSBzZXQgb2YgbGl2ZSBob3N0cyBmcm9tIHRoZSB0ZXN0bGFiLmxvY2FsIGRvbWFpbgoKICAgICAuTElOSwoKICAgICAgIGh0dHA6Ly93d3cubmV0c3BpLmNvbQogICAgICAgaHR0cHM6Ly9naXRodWIuY29tL251bGxiaW5kL1Bvd2Vyc2hlbGxlcnkvYmxvYi9tYXN0ZXIvU3RhYmxlLWlzaC9BRFMvR2V0LUV4cGxvaXRhYmxlU3lzdGVtcy5wc20xCgogICAgIC5OT1RFUwoKICAgICAgIEF1dGhvcjogIFNjb3R0IFN1dGhlcmxhbmQgLSAyMDE1LCBOZXRTUEkKICAgICAgICAgICAgICAgIE1vZGlmaWNhdGlvbnMgdG8gaW50ZWdyYXRlIGludG8gUG93ZXJWaWV3IGJ5IEBoYXJtajB5CiAgICAgICBWZXJzaW9uOiBHZXQtRXhwbG9pdGFibGVTeXN0ZW0ucHNtMSB2MS4xCiAgICAgICBDb21tZW50czogVGhlIHRlY2huaXF1ZSB1c2VkIHRvIHF1ZXJ5IExEQVAgd2FzIGJhc2VkIG9uIHRoZSAiR2V0LUF1ZGl0RFNDb21wdXRlckFjY291bnQiCiAgICAgICBmdW5jdGlvbiBmb3VuZCBpbiBDYXJvbHMgUGVyZXoncyBQb3NoU2VjLU1vZCBwcm9qZWN0LiAgVGhlIGdlbmVyYWwgaWRlYSBpcyBiYXNlZCBvZmYgb2YKICAgICAgIFdpbGwgU2Nocm9lZGVyJ3MgIkludm9rZS1GaW5kVnVsblN5c3RlbXMiIGZ1bmN0aW9uIGZyb20gdGhlIFBvd2VyVmlldyB0b29sa2l0LgojPgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUpXQogICAgICAgIFtBbGlhcygnSG9zdE5hbWUnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlck5hbWUgPSAnKicsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNQTiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkT3BlcmF0aW5nU3lzdGVtID0gJyonLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRTZXJ2aWNlUGFjayA9ICcqJywKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRmlsdGVyLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRQaW5nLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFVuY29uc3RyYWluZWQsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBHcmFiYmluZyBjb21wdXRlciBhY2NvdW50cyBmcm9tIEFjdGl2ZSBEaXJlY3RvcnkuLi4iCgogICAgIyBDcmVhdGUgZGF0YSB0YWJsZSBmb3IgaG9zdG5hbWVzLCBvcywgYW5kIHNlcnZpY2UgcGFja3MgZnJvbSBMREFQCiAgICAkVGFibGVBZHNDb21wdXRlcnMgPSBOZXctT2JqZWN0IFN5c3RlbS5EYXRhLkRhdGFUYWJsZQogICAgJE51bGwgPSAkVGFibGVBZHNDb21wdXRlcnMuQ29sdW1ucy5BZGQoJ0hvc3RuYW1lJykKICAgICROdWxsID0gJFRhYmxlQWRzQ29tcHV0ZXJzLkNvbHVtbnMuQWRkKCdPcGVyYXRpbmdTeXN0ZW0nKQogICAgJE51bGwgPSAkVGFibGVBZHNDb21wdXRlcnMuQ29sdW1ucy5BZGQoJ1NlcnZpY2VQYWNrJykKICAgICROdWxsID0gJFRhYmxlQWRzQ29tcHV0ZXJzLkNvbHVtbnMuQWRkKCdMYXN0TG9nb24nKQoKICAgIEdldC1OZXRDb21wdXRlciAtRnVsbERhdGEgQFBTQm91bmRQYXJhbWV0ZXJzIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAkQ3VycmVudEhvc3QgPSAkXy5kbnNob3N0bmFtZQogICAgICAgICRDdXJyZW50T3MgPSAkXy5vcGVyYXRpbmdzeXN0ZW0KICAgICAgICAkQ3VycmVudFNwID0gJF8ub3BlcmF0aW5nc3lzdGVtc2VydmljZXBhY2sKICAgICAgICAkQ3VycmVudExhc3QgPSAkXy5sYXN0bG9nb24KICAgICAgICAkQ3VycmVudFVhYyA9ICRfLnVzZXJhY2NvdW50Y29udHJvbAoKICAgICAgICAkQ3VycmVudFVhY0JpbiA9IFtjb252ZXJ0XTo6VG9TdHJpbmcoJF8udXNlcmFjY291bnRjb250cm9sLDIpCgogICAgICAgICMgQ2hlY2sgdGhlIDJuZCB0byBsYXN0IHZhbHVlIHRvIGRldGVybWluZSBpZiBpdHMgZGlzYWJsZWQKICAgICAgICAkRGlzYWJsZU9mZnNldCA9ICRDdXJyZW50VWFjQmluLkxlbmd0aCAtIDIKICAgICAgICAkQ3VycmVudERpc2FibGVkID0gJEN1cnJlbnRVYWNCaW4uU3Vic3RyaW5nKCREaXNhYmxlT2Zmc2V0LDEpCgogICAgICAgICMgQWRkIGNvbXB1dGVyIHRvIGxpc3QgaWYgaXQncyBlbmFibGVkCiAgICAgICAgaWYgKCRDdXJyZW50RGlzYWJsZWQgIC1lcSAwKSB7CiAgICAgICAgICAgICMgQWRkIGRvbWFpbiBjb21wdXRlciB0byBkYXRhIHRhYmxlCiAgICAgICAgICAgICROdWxsID0gJFRhYmxlQWRzQ29tcHV0ZXJzLlJvd3MuQWRkKCRDdXJyZW50SG9zdCwkQ3VycmVudE9TLCRDdXJyZW50U1AsJEN1cnJlbnRMYXN0KQogICAgICAgIH0KICAgIH0KCiAgICAjIFN0YXR1cyB1c2VyCiAgICBXcml0ZS1WZXJib3NlICJbKl0gTG9hZGluZyBleHBsb2l0IGxpc3QgZm9yIGNyaXRpY2FsIG1pc3NpbmcgcGF0Y2hlcy4uLiIKCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICMgU2V0dXAgZGF0YSB0YWJsZSBmb3IgbGlzdCBvZiBtc2YgZXhwbG9pdHMKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgICMgQ3JlYXRlIGRhdGEgdGFibGUgZm9yIGxpc3Qgb2YgcGF0Y2hlcyBsZXZlbHMgd2l0aCBhIE1TRiBleHBsb2l0CiAgICAkVGFibGVFeHBsb2l0cyA9IE5ldy1PYmplY3QgU3lzdGVtLkRhdGEuRGF0YVRhYmxlCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLkNvbHVtbnMuQWRkKCdPcGVyYXRpbmdTeXN0ZW0nKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Db2x1bW5zLkFkZCgnU2VydmljZVBhY2snKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Db2x1bW5zLkFkZCgnTXNmTW9kdWxlJykKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuQ29sdW1ucy5BZGQoJ0NWRScpCgogICAgIyBBZGQgZXhwbG9pdHMgdG8gZGF0YSB0YWJsZQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyA3IiwiIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAxMC0yNzI5IikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczAzXzAyNl9kY29tIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMzUyLyIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmVyIFBhY2sgMSIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwNV8wMTdfbXNtcSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDUtMDA1OSIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmVyIFBhY2sgMSIsImV4cGxvaXQvd2luZG93cy9paXMvbXMwM18wMDdfbnRkbGxfd2ViZGF2IiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMTA5IikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL3dpbnMvbXMwNF8wNDVfd2lucyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDQtMTA4MC8iKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczAzXzAyNl9kY29tIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMzUyLyIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDVfMDE3X21zbXEiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA1LTAwNTkiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL2lpcy9tczAzXzAwN19udGRsbF93ZWJkYXYiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTAxMDkiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA0XzAxMV9sc2FzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDMtMDUzMy8iKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL3dpbnMvbXMwNF8wNDVfd2lucyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDQtMTA4MC8iKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayAzIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczAzXzAyNl9kY29tIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMzUyLyIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDMiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDVfMDE3X21zbXEiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA1LTAwNTkiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayAzIiwiZXhwbG9pdC93aW5kb3dzL2lpcy9tczAzXzAwN19udGRsbF93ZWJkYXYiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTAxMDkiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayAzIiwiZXhwbG9pdC93aW5kb3dzL3dpbnMvbXMwNF8wNDVfd2lucyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDQtMTA4MC8iKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayA0IiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczAzXzAyNl9kY29tIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMzUyLyIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDQiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDVfMDE3X21zbXEiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA1LTAwNTkiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIlNlcnZpY2UgUGFjayA0IiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA3XzAyOV9tc2Ruc196b25lbmFtZSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDctMTc0OCIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDQiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDRfMDExX2xzYXNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wNTMzLyIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDQiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDQwX25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDYtMzQzOSIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiU2VydmljZSBQYWNrIDQiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDY2X253YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi00Njg4IikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2aWNlIFBhY2sgNCIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNl8wNzBfd2tzc3ZjIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi00NjkxIikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2aWNlIFBhY2sgNCIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOC00MjUwIikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCJTZXJ2aWNlIFBhY2sgNCIsImV4cGxvaXQvd2luZG93cy93aW5zL21zMDRfMDQ1X3dpbnMiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA0LTEwODAvIikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCIiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDNfMDI2X2Rjb20iLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTAzNTIvIikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCIiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDVfMDE3X21zbXEiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA1LTAwNTkiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMCIsIiIsImV4cGxvaXQvd2luZG93cy9paXMvbXMwM18wMDdfbnRkbGxfd2ViZGF2IiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMTA5IikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDAiLCIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDVfMDM5X3BucCIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDUtMTk4MyIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAwIiwiIiwiZXhwbG9pdC93aW5kb3dzL3dpbnMvbXMwNF8wNDVfd2lucyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDQtMTA4MC8iKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDdfMDI5X21zZG5zX3pvbmVuYW1lIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNy0xNzQ4IikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA2XzA0MF9uZXRhcGkiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA2LTM0MzkiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDY2X253YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi00Njg4IikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA4XzA2N19uZXRhcGkiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA4LTQyNTAiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3Mvd2lucy9tczA0XzA0NV93aW5zIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNC0xMDgwLyIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDdfMDI5X21zZG5zX3pvbmVuYW1lIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNy0xNzQ4IikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOC00MjUwIikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMxMF8wNjFfc3Bvb2xzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMTAtMjcyOSIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIiwiIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczAzXzAyNl9kY29tIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMzUyLyIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIiwiIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA2XzA0MF9uZXRhcGkiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA2LTM0MzkiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOC00MjUwIikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMiLCIiLCJleHBsb2l0L3dpbmRvd3Mvd2lucy9tczA0XzA0NV93aW5zIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNC0xMDgwLyIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIFIyIiwiIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczAzXzAyNl9kY29tIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwMy0wMzUyLyIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDAzIFIyIiwiIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA0XzAxMV9sc2FzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDMtMDUzMy8iKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwMyBSMiIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNl8wNDBfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi0zNDM5IikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDMgUjIiLCIiLCJleHBsb2l0L3dpbmRvd3Mvd2lucy9tczA0XzA0NV93aW5zIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNC0xMDgwLyIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDA4IiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDlfMDUwX3NtYjJfbmVnb3RpYXRlX2Z1bmNfaW5kZXgiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA5LTMxMDMiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwOCIsIlNlcnZpY2UgUGFjayAyIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAxMC0yNzI5IikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDgiLCIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDhfMDY3X25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDgtNDI1MCIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFNlcnZlciAyMDA4IiwiIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA5XzA1MF9zbWIyX25lZ290aWF0ZV9mdW5jX2luZGV4IiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOS0zMTAzIikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgU2VydmVyIDIwMDgiLCIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMTBfMDYxX3Nwb29sc3MiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDEwLTI3MjkiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBTZXJ2ZXIgMjAwOCBSMiIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMxMF8wNjFfc3Bvb2xzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMTAtMjcyOSIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFZpc3RhIiwiU2VydmVyIFBhY2sgMSIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOC00MjUwIikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgVmlzdGEiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA5XzA1MF9zbWIyX25lZ290aWF0ZV9mdW5jX2luZGV4IiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOS0zMTAzIikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgVmlzdGEiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczEwXzA2MV9zcG9vbHNzIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAxMC0yNzI5IikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgVmlzdGEiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOV8wNTBfc21iMl9uZWdvdGlhdGVfZnVuY19pbmRleCIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDktMzEwMyIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFZpc3RhIiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMTBfMDYxX3Nwb29sc3MiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDEwLTI3MjkiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBWaXN0YSIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOC00MjUwIikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgVmlzdGEiLCIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDlfMDUwX3NtYjJfbmVnb3RpYXRlX2Z1bmNfaW5kZXgiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA5LTMxMDMiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3MvZGNlcnBjL21zMDNfMDI2X2Rjb20iLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDAzLTAzNTIvIikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL2RjZXJwYy9tczA1XzAxN19tc21xIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNS0wMDU5IikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2ZXIgUGFjayAxIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA0XzAxMV9sc2FzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDMtMDUzMy8iKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIlNlcnZlciBQYWNrIDEiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDVfMDM5X3BucCIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDUtMTk4MyIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiU2VydmVyIFBhY2sgMSIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNl8wNDBfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi0zNDM5IikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwNV8wMTdfbXNtcSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDUtMDA1OSIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDQwX25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDYtMzQzOSIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiU2VydmljZSBQYWNrIDIiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDZfMDY2X253YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi00Njg4IikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwNl8wNzBfd2tzc3ZjIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwNi00NjkxIikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOC00MjUwIikKICAgICROdWxsID0gJFRhYmxlRXhwbG9pdHMuUm93cy5BZGQoIldpbmRvd3MgWFAiLCJTZXJ2aWNlIFBhY2sgMiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMxMF8wNjFfc3Bvb2xzcyIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMTAtMjcyOSIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiU2VydmljZSBQYWNrIDMiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMDhfMDY3X25ldGFwaSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDgtNDI1MCIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiU2VydmljZSBQYWNrIDMiLCJleHBsb2l0L3dpbmRvd3Mvc21iL21zMTBfMDYxX3Nwb29sc3MiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDEwLTI3MjkiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIiIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwM18wMjZfZGNvbSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDMtMDM1Mi8iKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIiIsImV4cGxvaXQvd2luZG93cy9kY2VycGMvbXMwNV8wMTdfbXNtcSIsImh0dHA6Ly93d3cuY3ZlZGV0YWlscy5jb20vY3ZlLzIwMDUtMDA1OSIpCiAgICAkTnVsbCA9ICRUYWJsZUV4cGxvaXRzLlJvd3MuQWRkKCJXaW5kb3dzIFhQIiwiIiwiZXhwbG9pdC93aW5kb3dzL3NtYi9tczA2XzA0MF9uZXRhcGkiLCJodHRwOi8vd3d3LmN2ZWRldGFpbHMuY29tL2N2ZS8yMDA2LTM0MzkiKQogICAgJE51bGwgPSAkVGFibGVFeHBsb2l0cy5Sb3dzLkFkZCgiV2luZG93cyBYUCIsIiIsImV4cGxvaXQvd2luZG93cy9zbWIvbXMwOF8wNjdfbmV0YXBpIiwiaHR0cDovL3d3dy5jdmVkZXRhaWxzLmNvbS9jdmUvMjAwOC00MjUwIikKCiAgICAjIFN0YXR1cyB1c2VyCiAgICBXcml0ZS1WZXJib3NlICJbKl0gQ2hlY2tpbmcgY29tcHV0ZXJzIGZvciB2dWxuZXJhYmxlIE9TIGFuZCBTUCBsZXZlbHMuLi4iCgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAjIFNldHVwIGRhdGEgdGFibGUgdG8gc3RvcmUgdnVsbmVyYWJsZSBzeXN0ZW1zCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAjIENyZWF0ZSBkYXRhIHRhYmxlIHRvIGhvdXNlIHZ1bG5lcmFibGUgc2VydmVyIGxpc3QKICAgICRUYWJsZVZ1bG5Db21wdXRlcnMgPSBOZXctT2JqZWN0IFN5c3RlbS5EYXRhLkRhdGFUYWJsZQogICAgJE51bGwgPSAkVGFibGVWdWxuQ29tcHV0ZXJzLkNvbHVtbnMuQWRkKCdDb21wdXRlck5hbWUnKQogICAgJE51bGwgPSAkVGFibGVWdWxuQ29tcHV0ZXJzLkNvbHVtbnMuQWRkKCdPcGVyYXRpbmdTeXN0ZW0nKQogICAgJE51bGwgPSAkVGFibGVWdWxuQ29tcHV0ZXJzLkNvbHVtbnMuQWRkKCdTZXJ2aWNlUGFjaycpCiAgICAkTnVsbCA9ICRUYWJsZVZ1bG5Db21wdXRlcnMuQ29sdW1ucy5BZGQoJ0xhc3RMb2dvbicpCiAgICAkTnVsbCA9ICRUYWJsZVZ1bG5Db21wdXRlcnMuQ29sdW1ucy5BZGQoJ01zZk1vZHVsZScpCiAgICAkTnVsbCA9ICRUYWJsZVZ1bG5Db21wdXRlcnMuQ29sdW1ucy5BZGQoJ0NWRScpCgogICAgIyBJdGVyYXRlIHRocm91Z2ggZWFjaCBleHBsb2l0CiAgICAkVGFibGVFeHBsb2l0cyB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgJEV4cGxvaXRPUyA9ICRfLk9wZXJhdGluZ1N5c3RlbQogICAgICAgICRFeHBsb2l0U1AgPSAkXy5TZXJ2aWNlUGFjawogICAgICAgICRFeHBsb2l0TXNmID0gJF8uTXNmTW9kdWxlCiAgICAgICAgJEV4cGxvaXRDVkUgPSAkXy5DVkUKCiAgICAgICAgIyBJdGVyYXRlIHRocm91Z2ggZWFjaCBBRFMgY29tcHV0ZXIKICAgICAgICAkVGFibGVBZHNDb21wdXRlcnMgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAkQWRzSG9zdG5hbWUgPSAkXy5Ib3N0bmFtZQogICAgICAgICAgICAkQWRzT1MgPSAkXy5PcGVyYXRpbmdTeXN0ZW0KICAgICAgICAgICAgJEFkc1NQID0gJF8uU2VydmljZVBhY2sKICAgICAgICAgICAgJEFkc0xhc3QgPSAkXy5MYXN0TG9nb24KCiAgICAgICAgICAgICMgQWRkIGV4cGxvaXRhYmxlIHN5c3RlbXMgdG8gdnVsIGNvbXB1dGVycyBkYXRhIHRhYmxlCiAgICAgICAgICAgIGlmICgkQWRzT1MgLWxpa2UgIiRFeHBsb2l0T1MqIiAtYW5kICRBZHNTUCAtbGlrZSAiJEV4cGxvaXRTUCIgKSB7CiAgICAgICAgICAgICAgICAjIEFkZCBkb21haW4gY29tcHV0ZXIgdG8gZGF0YSB0YWJsZQogICAgICAgICAgICAgICAgJE51bGwgPSAkVGFibGVWdWxuQ29tcHV0ZXJzLlJvd3MuQWRkKCRBZHNIb3N0bmFtZSwkQWRzT1MsJEFkc1NQLCRBZHNMYXN0LCRFeHBsb2l0TXNmLCRFeHBsb2l0Q1ZFKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgRGlzcGxheSByZXN1bHRzCiAgICAkVnVsbkNvbXB1dGVyID0gJFRhYmxlVnVsbkNvbXB1dGVycyB8IFNlbGVjdC1PYmplY3QgQ29tcHV0ZXJOYW1lIC1VbmlxdWUgfCBNZWFzdXJlLU9iamVjdAogICAgJFZ1bG5Db21wdXRlckNvdW50ID0gJFZ1bG5Db21wdXRlci5Db3VudAoKICAgIGlmICgkVnVsbkNvbXB1dGVyLkNvdW50IC1ndCAwKSB7CiAgICAgICAgIyBSZXR1cm4gdnVsbmVyYWJsZSBzZXJ2ZXIgbGlzdCBvcmRlciB3aXRoIHNvbWUgaGFjayBkYXRlIGNhc3RpbmcKICAgICAgICBXcml0ZS1WZXJib3NlICJbK10gRm91bmQgJFZ1bG5Db21wdXRlckNvdW50IHBvdGVudGlhbGx5IHZ1bG5lcmFibGUgc3lzdGVtcyEiCiAgICAgICAgJFRhYmxlVnVsbkNvbXB1dGVycyB8IFNvcnQtT2JqZWN0IHsgJF8ubGFzdGxvZ29uIC1hcyBbZGF0ZXRpbWVdfSAtRGVzY2VuZGluZwogICAgfQogICAgZWxzZSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiWy1dIE5vIHZ1bG5lcmFibGUgc3lzdGVtcyB3ZXJlIGZvdW5kLiIKICAgIH0KfQoKCmZ1bmN0aW9uIEludm9rZS1FbnVtZXJhdGVMb2NhbEFkbWluIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUaGlzIGZ1bmN0aW9uIHF1ZXJpZXMgdGhlIGRvbWFpbiBmb3IgYWxsIGFjdGl2ZSBtYWNoaW5lcyB3aXRoCiAgICAgICAgR2V0LU5ldENvbXB1dGVyLCB0aGVuIGZvciBlYWNoIHNlcnZlciBpdCBxdWVyaWVzIHRoZSBsb2NhbAogICAgICAgIEFkbWluaXN0cmF0b3JzIHdpdGggR2V0LU5ldExvY2FsR3JvdXAuCgogICAgICAgIEF1dGhvcjogQGhhcm1qMHkKICAgICAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBIb3N0IGFycmF5IHRvIGVudW1lcmF0ZSwgcGFzc2FibGUgb24gdGhlIHBpcGVsaW5lLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJGaWxlCgogICAgICAgIEZpbGUgb2YgaG9zdG5hbWVzL0lQcyB0byBzZWFyY2guCgogICAgLlBBUkFNRVRFUiBDb21wdXRlckZpbHRlcgoKICAgICAgICBIb3N0IGZpbHRlciBuYW1lIHRvIHF1ZXJ5IEFEIGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgQ29tcHV0ZXJBRFNwYXRoCgogICAgICAgIFRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCBmb3IgaG9zdHMsIGUuZy4gIkxEQVA6Ly9PVT1zZWNyZXQsREM9dGVzdGxhYixEQz1sb2NhbCIKICAgICAgICBVc2VmdWwgZm9yIE9VIHF1ZXJpZXMuCgogICAgLlBBUkFNRVRFUiBOb1BpbmcKCiAgICAgICAgU3dpdGNoLiBEb24ndCBwaW5nIGVhY2ggaG9zdCB0byBlbnN1cmUgaXQncyB1cCBiZWZvcmUgZW51bWVyYXRpbmcuCgogICAgLlBBUkFNRVRFUiBEZWxheQoKICAgICAgICBEZWxheSBiZXR3ZWVuIGVudW1lcmF0aW5nIGhvc3RzLCBkZWZhdWx0cyB0byAwCgogICAgLlBBUkFNRVRFUiBKaXR0ZXIKCiAgICAgICAgSml0dGVyIGZvciB0aGUgaG9zdCBkZWxheSwgZGVmYXVsdHMgdG8gKy8tIDAuMwoKICAgIC5QQVJBTUVURVIgT3V0RmlsZQoKICAgICAgICBPdXRwdXQgcmVzdWx0cyB0byBhIHNwZWNpZmllZCBjc3Ygb3V0cHV0IGZpbGUuCgogICAgLlBBUkFNRVRFUiBOb0Nsb2JiZXIKCiAgICAgICAgU3dpdGNoLiBEb24ndCBvdmVyd3JpdGUgYW55IGV4aXN0aW5nIG91dHB1dCBmaWxlLgoKICAgIC5QQVJBTUVURVIgVHJ1c3RHcm91cHMKCiAgICAgICAgU3dpdGNoLiBPbmx5IHJldHVybiByZXN1bHRzIHRoYXQgYXJlIG5vdCBwYXJ0IG9mIHRoZSBsb2NhbCBtYWNoaW5lCiAgICAgICAgb3IgdGhlIG1hY2hpbmUncyBkb21haW4uIE9sZCBJbnZva2UtRW51bWVyYXRlTG9jYWxUcnVzdEdyb3VwCiAgICAgICAgZnVuY3Rpb25hbGl0eS4KCiAgICAuUEFSQU1FVEVSIERvbWFpbk9ubHkKCiAgICAgICAgU3dpdGNoLiBPbmx5IHJldHVybiBkb21haW4gKG5vbi1sb2NhbCkgcmVzdWx0cwoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIERvbWFpbiB0byBxdWVyeSBmb3IgbWFjaGluZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIFNlYXJjaEZvcmVzdAoKICAgICAgICBTd2l0Y2guIFNlYXJjaCBhbGwgZG9tYWlucyBpbiB0aGUgZm9yZXN0IGZvciB0YXJnZXQgdXNlcnMgaW5zdGVhZCBvZiBqdXN0CiAgICAgICAgYSBzaW5nbGUgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgQVBJCgogICAgICAgIFN3aXRjaC4gVXNlIEFQSSBjYWxscyBpbnN0ZWFkIG9mIHRoZSBXaW5OVCBzZXJ2aWNlIHByb3ZpZGVyLiBMZXNzIGluZm9ybWF0aW9uLAogICAgICAgIGJ1dCB0aGUgcmVzdWx0cyBhcmUgZmFzdGVyLgoKICAgIC5QQVJBTUVURVIgVGhyZWFkcwoKICAgICAgICBUaGUgbWF4aW11bSBjb25jdXJyZW50IHRocmVhZHMgdG8gZXhlY3V0ZS4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1FbnVtZXJhdGVMb2NhbEFkbWluCgogICAgICAgIEVudW1lcmF0ZXMgdGhlIG1lbWJlcnMgb2YgbG9jYWwgYWRtaW5pc3RyYXRvcnMgZm9yIGFsbCBtYWNoaW5lcwogICAgICAgIGluIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEludm9rZS1FbnVtZXJhdGVMb2NhbEFkbWluIC1UaHJlYWRzIDEwCgogICAgICAgIFRocmVhZGVkIGxvY2FsIGFkbWluIGVudW1lcmF0aW9uLCByZXBsYWNlcyBJbnZva2UtRW51bWVyYXRlTG9jYWxBZG1pblRocmVhZGVkCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL2Jsb2cuaGFybWoweS5uZXQvCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0cycpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkQ29tcHV0ZXJOYW1lLAoKICAgICAgICBbVmFsaWRhdGVTY3JpcHQoe1Rlc3QtUGF0aCAtUGF0aCAkXyB9KV0KICAgICAgICBbQWxpYXMoJ0hvc3RMaXN0JyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJGaWxlLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRDb21wdXRlckZpbHRlciwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ29tcHV0ZXJBRFNwYXRoLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICROb1BpbmcsCgogICAgICAgIFtVSW50MzJdCiAgICAgICAgJERlbGF5ID0gMCwKCiAgICAgICAgW0RvdWJsZV0KICAgICAgICAkSml0dGVyID0gLjMsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJE91dEZpbGUsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJE5vQ2xvYmJlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVHJ1c3RHcm91cHMsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJERvbWFpbk9ubHksCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbiwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluQ29udHJvbGxlciwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2VhcmNoRm9yZXN0LAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkVGhyZWFkcywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQVBJCiAgICApCgogICAgYmVnaW4gewogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0RlYnVnJ10pIHsKICAgICAgICAgICAgJERlYnVnUHJlZmVyZW5jZSA9ICdDb250aW51ZScKICAgICAgICB9CgogICAgICAgICMgcmFuZG9tIG9iamVjdCBmb3IgZGVsYXkKICAgICAgICAkUmFuZE5vID0gTmV3LU9iamVjdCBTeXN0ZW0uUmFuZG9tCgogICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBSdW5uaW5nIEludm9rZS1FbnVtZXJhdGVMb2NhbEFkbWluIHdpdGggZGVsYXkgb2YgJERlbGF5IgoKICAgICAgICAjIGlmIHdlJ3JlIHVzaW5nIGEgaG9zdCBsaXN0LCByZWFkIHRoZSB0YXJnZXRzIGluIGFuZCBhZGQgdGhlbSB0byB0aGUgdGFyZ2V0IGxpc3QKICAgICAgICBpZigkQ29tcHV0ZXJGaWxlKSB7CiAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSBHZXQtQ29udGVudCAtUGF0aCAkQ29tcHV0ZXJGaWxlCiAgICAgICAgfQoKICAgICAgICBpZighJENvbXB1dGVyTmFtZSkgewogICAgICAgICAgICBbYXJyYXldJENvbXB1dGVyTmFtZSA9IEAoKQoKICAgICAgICAgICAgaWYoJERvbWFpbikgewogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCREb21haW4pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRTZWFyY2hGb3Jlc3QpIHsKICAgICAgICAgICAgICAgICMgZ2V0IEFMTCB0aGUgZG9tYWlucyBpbiB0aGUgZm9yZXN0IHRvIHNlYXJjaAogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBHZXQtTmV0Rm9yZXN0RG9tYWluIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5OYW1lIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICMgdXNlIHRoZSBsb2NhbCBkb21haW4KICAgICAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gQCggKEdldC1OZXREb21haW4pLm5hbWUgKQogICAgICAgICAgICB9CgogICAgICAgICAgICBGb3JFYWNoICgkRG9tYWluIGluICRUYXJnZXREb21haW5zKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gUXVlcnlpbmcgZG9tYWluICREb21haW4gZm9yIGhvc3RzIgogICAgICAgICAgICAgICAgJENvbXB1dGVyTmFtZSArPSBHZXQtTmV0Q29tcHV0ZXIgLUZpbHRlciAkQ29tcHV0ZXJGaWx0ZXIgLUFEU3BhdGggJENvbXB1dGVyQURTcGF0aCAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyByZW1vdmUgYW55IG51bGwgdGFyZ2V0IGhvc3RzLCB1bmlxdWlmeSB0aGUgbGlzdCBhbmQgc2h1ZmZsZSBpdAogICAgICAgICAgICAkQ29tcHV0ZXJOYW1lID0gJENvbXB1dGVyTmFtZSB8IFdoZXJlLU9iamVjdCB7ICRfIH0gfCBTb3J0LU9iamVjdCAtVW5pcXVlIHwgU29ydC1PYmplY3QgeyBHZXQtUmFuZG9tIH0KICAgICAgICAgICAgaWYoJCgkQ29tcHV0ZXJOYW1lLkNvdW50KSAtZXEgMCkgewogICAgICAgICAgICAgICAgdGhyb3cgIk5vIGhvc3RzIGZvdW5kISIKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBkZWxldGUgYW55IGV4aXN0aW5nIG91dHB1dCBmaWxlIGlmIGl0IGFscmVhZHkgZXhpc3RzCiAgICAgICAgaWYoISROb0Nsb2JiZXIpIHsKICAgICAgICAgICAgaWYgKCRPdXRGaWxlIC1hbmQgKFRlc3QtUGF0aCAtUGF0aCAkT3V0RmlsZSkpIHsgUmVtb3ZlLUl0ZW0gLVBhdGggJE91dEZpbGUgfQogICAgICAgIH0KCiAgICAgICAgaWYoJFRydXN0R3JvdXBzKSB7CgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJEZXRlcm1pbmluZyBkb21haW4gdHJ1c3QgZ3JvdXBzIgoKICAgICAgICAgICAgIyBmaW5kIGFsbCBncm91cCBuYW1lcyB0aGF0IGhhdmUgb25lIG9yIG1vcmUgdXNlcnMgaW4gYW5vdGhlciBkb21haW4KICAgICAgICAgICAgJFRydXN0R3JvdXBOYW1lcyA9IEZpbmQtRm9yZWlnbkdyb3VwIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciB8IEZvckVhY2gtT2JqZWN0IHsgJF8uR3JvdXBOYW1lIH0gfCBTb3J0LU9iamVjdCAtVW5pcXVlCgogICAgICAgICAgICAkVHJ1c3RHcm91cHNTSURzID0gJFRydXN0R3JvdXBOYW1lcyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICMgaWdub3JlIHRoZSBidWlsdGluIGFkbWluaXN0cmF0b3JzIGdyb3VwIGZvciBhIERDIChTLTEtNS0zMi01NDQpCiAgICAgICAgICAgICAgICAjIFRPRE86IGlnbm9yZSBhbGwgZGVmYXVsdCBidWlsdCBpbiBzaWRzPwogICAgICAgICAgICAgICAgR2V0LU5ldEdyb3VwIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtR3JvdXBOYW1lICRfIC1GdWxsRGF0YSB8IFdoZXJlLU9iamVjdCB7ICRfLm9iamVjdHNpZCAtbm90bWF0Y2ggIlMtMS01LTMyLTU0NCIgfSB8IEZvckVhY2gtT2JqZWN0IHsgJF8ub2JqZWN0c2lkIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBxdWVyeSBmb3IgdGhlIHByaW1hcnkgZG9tYWluIGNvbnRyb2xsZXIgc28gd2UgY2FuIGV4dHJhY3QgdGhlIGRvbWFpbiBTSUQgZm9yIGZpbHRlcmluZwogICAgICAgICAgICAkRG9tYWluU0lEID0gR2V0LURvbWFpblNJRCAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICB9CgogICAgICAgICMgc2NyaXB0IGJsb2NrIHRoYXQgZW51bWVyYXRlcyBhIHNlcnZlcgogICAgICAgICRIb3N0RW51bUJsb2NrID0gewogICAgICAgICAgICBwYXJhbSgkQ29tcHV0ZXJOYW1lLCAkUGluZywgJE91dEZpbGUsICREb21haW5TSUQsICRUcnVzdEdyb3Vwc1NJRHMsICRBUEksICREb21haW5Pbmx5KQoKICAgICAgICAgICAgIyBvcHRpb25hbGx5IGNoZWNrIGlmIHRoZSBzZXJ2ZXIgaXMgdXAgZmlyc3QKICAgICAgICAgICAgJFVwID0gJFRydWUKICAgICAgICAgICAgaWYoJFBpbmcpIHsKICAgICAgICAgICAgICAgICRVcCA9IFRlc3QtQ29ubmVjdGlvbiAtQ291bnQgMSAtUXVpZXQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJFVwKSB7CiAgICAgICAgICAgICAgICAjIGdyYWIgdGhlIHVzZXJzIGZvciB0aGUgbG9jYWwgYWRtaW5zIG9uIHRoaXMgc2VydmVyCiAgICAgICAgICAgICAgICBpZigkQVBJKSB7CiAgICAgICAgICAgICAgICAgICAgJExvY2FsQWRtaW5zID0gR2V0LU5ldExvY2FsR3JvdXAgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lIC1BUEkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRMb2NhbEFkbWlucyA9IEdldC1OZXRMb2NhbEdyb3VwIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgaWYgd2UganVzdCB3YW50IHRvIHJldHVybiBjcm9zcy10cnVzdCB1c2VycwogICAgICAgICAgICAgICAgaWYoJERvbWFpblNJRCkgewogICAgICAgICAgICAgICAgICAgICMgZ2V0IHRoZSBsb2NhbCBtYWNoaW5lIFNJRAogICAgICAgICAgICAgICAgICAgICRMb2NhbFNJRCA9ICgkTG9jYWxBZG1pbnMgfCBXaGVyZS1PYmplY3QgeyAkXy5TSUQgLW1hdGNoICcuKi01MDAkJyB9KS5TSUQgLXJlcGxhY2UgIi01MDAkIgogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkxvY2FsU2lkIGZvciAkQ29tcHV0ZXJOYW1lIDogJExvY2FsU0lEIgogICAgICAgICAgICAgICAgICAgICMgZmlsdGVyIG91dCBhY2NvdW50cyB0aGF0IGJlZ2luIHdpdGggdGhlIG1hY2hpbmUgU0lEIGFuZCBkb21haW4gU0lECiAgICAgICAgICAgICAgICAgICAgIyAgIGJ1dCBwcmVzZXJ2ZSBhbnkgZ3JvdXBzIHRoYXQgaGF2ZSB1c2VycyBhY3Jvc3MgYSB0cnVzdCAoJFRydXN0R3JvdXBTSURTKQogICAgICAgICAgICAgICAgICAgICRMb2NhbEFkbWlucyA9ICRMb2NhbEFkbWlucyB8IFdoZXJlLU9iamVjdCB7ICgkVHJ1c3RHcm91cHNTSURzIC1jb250YWlucyAkXy5TSUQpIC1vciAoKC1ub3QgJF8uU0lELnN0YXJ0c1dpdGgoJExvY2FsU0lEKSkgLWFuZCAoLW5vdCAkXy5TSUQuc3RhcnRzV2l0aCgkRG9tYWluU0lEKSkpIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigkRG9tYWluT25seSkgewogICAgICAgICAgICAgICAgICAgICRMb2NhbEFkbWlucyA9ICRMb2NhbEFkbWlucyB8IFdoZXJlLU9iamVjdCB7JF8uSXNEb21haW59CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoJExvY2FsQWRtaW5zIC1hbmQgKCRMb2NhbEFkbWlucy5MZW5ndGggLW5lIDApKSB7CiAgICAgICAgICAgICAgICAgICAgIyBvdXRwdXQgdGhlIHJlc3VsdHMgdG8gYSBjc3YgaWYgc3BlY2lmaWVkCiAgICAgICAgICAgICAgICAgICAgaWYoJE91dEZpbGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsQWRtaW5zIHwgRXhwb3J0LVBvd2VyVmlld0NTViAtT3V0RmlsZSAkT3V0RmlsZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBvdGhlcndpc2UgcmV0dXJuIHRoZSB1c2VyIG9iamVjdHMKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsQWRtaW5zCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWyFdIE5vIHVzZXJzIHJldHVybmVkIGZyb20gJENvbXB1dGVyTmFtZSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcm9jZXNzIHsKCiAgICAgICAgaWYoJFRocmVhZHMpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVXNpbmcgdGhyZWFkaW5nIHdpdGggdGhyZWFkcyA9ICRUaHJlYWRzIgoKICAgICAgICAgICAgIyBpZiB3ZSdyZSB1c2luZyB0aHJlYWRpbmcsIGtpY2sgb2ZmIHRoZSBzY3JpcHQgYmxvY2sgd2l0aCBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbgogICAgICAgICAgICAkU2NyaXB0UGFyYW1zID0gQHsKICAgICAgICAgICAgICAgICdQaW5nJyA9ICQoLW5vdCAkTm9QaW5nKQogICAgICAgICAgICAgICAgJ091dEZpbGUnID0gJE91dEZpbGUKICAgICAgICAgICAgICAgICdEb21haW5TSUQnID0gJERvbWFpblNJRAogICAgICAgICAgICAgICAgJ1RydXN0R3JvdXBzU0lEcycgPSAkVHJ1c3RHcm91cHNTSURzCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMga2ljayBvZmYgdGhlIHRocmVhZGVkIHNjcmlwdCBibG9jayArIGFyZ3VtZW50cwogICAgICAgICAgICBpZigkQVBJKSB7CiAgICAgICAgICAgICAgICAkU2NyaXB0UGFyYW1zWydBUEknXSA9ICRUcnVlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCREb21haW5Pbmx5KSB7CiAgICAgICAgICAgICAgICAkU2NyaXB0UGFyYW1zWydEb21haW5Pbmx5J10gPSAkVHJ1ZQogICAgICAgICAgICB9CgogICAgICAgICAgICBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1TY3JpcHRQYXJhbWV0ZXJzICRTY3JpcHRQYXJhbXMgLVRocmVhZHMgJFRocmVhZHMKICAgICAgICB9CgogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZigtbm90ICROb1BpbmcgLWFuZCAoJENvbXB1dGVyTmFtZS5jb3VudCAtbmUgMSkpIHsKICAgICAgICAgICAgICAgICMgcGluZyBhbGwgaG9zdHMgaW4gcGFyYWxsZWwKICAgICAgICAgICAgICAgICRQaW5nID0ge3BhcmFtKCRDb21wdXRlck5hbWUpIGlmKFRlc3QtQ29ubmVjdGlvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUgLUNvdW50IDEgLVF1aWV0IC1FcnJvckFjdGlvbiBTdG9wKXskQ29tcHV0ZXJOYW1lfX0KICAgICAgICAgICAgICAgICRDb21wdXRlck5hbWUgPSBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtTm9JbXBvcnRzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtU2NyaXB0QmxvY2sgJFBpbmcgLVRocmVhZHMgMTAwCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBUb3RhbCBudW1iZXIgb2YgYWN0aXZlIGhvc3RzOiAkKCRDb21wdXRlck5hbWUuY291bnQpIgogICAgICAgICAgICAkQ291bnRlciA9IDAKCiAgICAgICAgICAgIEZvckVhY2ggKCRDb21wdXRlciBpbiAkQ29tcHV0ZXJOYW1lKSB7CgogICAgICAgICAgICAgICAgJENvdW50ZXIgPSAkQ291bnRlciArIDEKCiAgICAgICAgICAgICAgICAjIHNsZWVwIGZvciBvdXIgc2VtaS1yYW5kb21pemVkIGludGVydmFsCiAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAtU2Vjb25kcyAkUmFuZE5vLk5leHQoKDEtJEppdHRlcikqJERlbGF5LCAoMSskSml0dGVyKSokRGVsYXkpCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbKl0gRW51bWVyYXRpbmcgc2VydmVyICRDb21wdXRlciAoJENvdW50ZXIgb2YgJCgkQ29tcHV0ZXJOYW1lLmNvdW50KSkiCgogICAgICAgICAgICAgICAgJFNjcmlwdEFyZ3MgPSBAKCRDb21wdXRlciwgJEZhbHNlLCAkT3V0RmlsZSwgJERvbWFpblNJRCwgJFRydXN0R3JvdXBzU0lEcywgJEFQSSwgJERvbWFpbk9ubHkpCgogICAgICAgICAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1Bcmd1bWVudExpc3QgJFNjcmlwdEFyZ3MKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMKIyBEb21haW4gdHJ1c3QgZnVuY3Rpb25zIGJlbG93LgojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpmdW5jdGlvbiBHZXQtTmV0RG9tYWluVHJ1c3Qgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFJldHVybiBhbGwgZG9tYWluIHRydXN0cyBmb3IgdGhlIGN1cnJlbnQgZG9tYWluIG9yCiAgICAgICAgYSBzcGVjaWZpZWQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIFRoZSBkb21haW4gd2hvc2UgdHJ1c3RzIHRvIGVudW1lcmF0ZSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgQURTcGF0aAoKICAgICAgICBUaGUgTERBUCBzb3VyY2UgdG8gc2VhcmNoIHRocm91Z2gsIGUuZy4gIkxEQVA6Ly9EQz10ZXN0bGFiLERDPWxvY2FsIi4KICAgICAgICBVc2VmdWwgZm9yIGdsb2JhbCBjYXRhbG9nIHF1ZXJpZXMgOykKCiAgICAuUEFSQU1FVEVSIEFQSQoKICAgICAgICBVc2UgYW4gQVBJIGNhbGwgKERzRW51bWVyYXRlRG9tYWluVHJ1c3RzKSB0byBlbnVtZXJhdGUgdGhlIHRydXN0cy4KCiAgICAuUEFSQU1FVEVSIExEQVAKCiAgICAgICAgU3dpdGNoLiBVc2UgTERBUCBxdWVyaWVzIHRvIGVudW1lcmF0ZSB0aGUgdHJ1c3RzIGluc3RlYWQgb2YgZGlyZWN0IGRvbWFpbiBjb25uZWN0aW9ucy4KICAgICAgICBNb3JlIGxpa2VseSB0byBnZXQgYXJvdW5kIG5ldHdvcmsgc2VnbWVudGF0aW9uLCBidXQgbm90IGFzIGFjY3VyYXRlLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldERvbWFpblRydXN0CgogICAgICAgIFJldHVybiBkb21haW4gdHJ1c3RzIGZvciB0aGUgY3VycmVudCBkb21haW4gdXNpbmcgYnVpbHQgaW4gLk5FVCBtZXRob2RzLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LU5ldERvbWFpblRydXN0IC1Eb21haW4gInByb2QudGVzdGxhYi5sb2NhbCIKCiAgICAgICAgUmV0dXJuIGRvbWFpbiB0cnVzdHMgZm9yIHRoZSAicHJvZC50ZXN0bGFiLmxvY2FsIiBkb21haW4gdXNpbmcgLk5FVCBtZXRob2RzCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0RG9tYWluVHJ1c3QgLUxEQVAgLURvbWFpbiAicHJvZC50ZXN0bGFiLmxvY2FsIiAtRG9tYWluQ29udHJvbGxlciAiUFJJTUFSWS50ZXN0bGFiLmxvY2FsIgoKICAgICAgICBSZXR1cm4gZG9tYWluIHRydXN0cyBmb3IgdGhlICJwcm9kLnRlc3RsYWIubG9jYWwiIGRvbWFpbiBlbnVtZXJhdGVkIHRocm91Z2ggTERBUAogICAgICAgIHF1ZXJpZXMsIHJlZmxlY3RpbmcgcXVlcmllcyB0aHJvdWdoIHRoZSAiUHJpbWFyeS50ZXN0bGFiLmxvY2FsIiBkb21haW4gY29udHJvbGxlciwKICAgICAgICB1c2luZyAuTkVUIG1ldGhvZHMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0RG9tYWluVHJ1c3QgLUFQSSAtRG9tYWluICJwcm9kLnRlc3RsYWIubG9jYWwiCgogICAgICAgIFJldHVybiBkb21haW4gdHJ1c3RzIGZvciB0aGUgInByb2QudGVzdGxhYi5sb2NhbCIgZG9tYWluIGVudW1lcmF0ZWQgdGhyb3VnaCBBUEkgY2FsbHMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0RG9tYWluVHJ1c3QgLUFQSSAtRG9tYWluQ29udHJvbGxlciBXSU5ET1dTMi50ZXN0bGFiLmxvY2FsCgogICAgICAgIFJldHVybiBkb21haW4gdHJ1c3RzIHJlYWNoYWJsZSBmcm9tIHRoZSBXSU5ET1dTMiBtYWNoaW5lIHRocm91Z2ggQVBJIGNhbGxzLgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsIFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFEU3BhdGgsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEFQSSwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTERBUCwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgYmVnaW4gewogICAgICAgICRUcnVzdEF0dHJpYnV0ZXMgPSBAewogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDAxJyA9ICdub25fdHJhbnNpdGl2ZScKICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDAwMicgPSAndXBsZXZlbF9vbmx5JwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDA0JyA9ICdxdWFyYW50aW5lZF9kb21haW4nCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwMDgnID0gJ2ZvcmVzdF90cmFuc2l0aXZlJwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDEwJyA9ICdjcm9zc19vcmdhbml6YXRpb24nCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwMjAnID0gJ3dpdGhpbl9mb3Jlc3QnCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwNDAnID0gJ3RyZWF0X2FzX2V4dGVybmFsJwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDgwJyA9ICd0cnVzdF91c2VzX3JjNF9lbmNyeXB0aW9uJwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMTAwJyA9ICd0cnVzdF91c2VzX2Flc19rZXlzJwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMjAwJyA9ICdjcm9zc19vcmdhbml6YXRpb25fbm9fdGd0X2RlbGVnYXRpb24nCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDA0MDAnID0gJ3BpbV90cnVzdCcKICAgICAgICB9CiAgICB9CgogICAgcHJvY2VzcyB7CgogICAgICAgIGlmKC1ub3QgJERvbWFpbikgewogICAgICAgICAgICAjIGlmIG5vdCBkb21haW4gaXMgc3BlY2lmaWVkIGdyYWIgdGhlIGN1cnJlbnQgZG9tYWluCiAgICAgICAgICAgICRTb3VyY2VEb21haW4gPSAoR2V0LU5ldERvbWFpbiAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbCkuTmFtZQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFNvdXJjZURvbWFpbiA9ICREb21haW4KICAgICAgICB9CgogICAgICAgIGlmKCRMREFQIC1vciAkQURTUGF0aCkgewoKICAgICAgICAgICAgJFRydXN0U2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLURvbWFpbiAkU291cmNlRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1QYWdlU2l6ZSAkUGFnZVNpemUgLUFEU3BhdGggJEFEU3BhdGgKCiAgICAgICAgICAgICRTb3VyY2VTSUQgPSBHZXQtRG9tYWluU0lEIC1Eb21haW4gJFNvdXJjZURvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlcgoKICAgICAgICAgICAgaWYoJFRydXN0U2VhcmNoZXIpIHsKCiAgICAgICAgICAgICAgICAkVHJ1c3RTZWFyY2hlci5GaWx0ZXIgPSAnKG9iamVjdENsYXNzPXRydXN0ZWREb21haW4pJwoKICAgICAgICAgICAgICAgICRSZXN1bHRzID0gJFRydXN0U2VhcmNoZXIuRmluZEFsbCgpCiAgICAgICAgICAgICAgICAkUmVzdWx0cyB8IFdoZXJlLU9iamVjdCB7JF99IHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICRQcm9wcyA9ICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgPSBOZXctT2JqZWN0IFBTT2JqZWN0CgogICAgICAgICAgICAgICAgICAgICRUcnVzdEF0dHJpYiA9IEAoKQogICAgICAgICAgICAgICAgICAgICRUcnVzdEF0dHJpYiArPSAkVHJ1c3RBdHRyaWJ1dGVzLktleXMgfCBXaGVyZS1PYmplY3QgeyAkUHJvcHMudHJ1c3RhdHRyaWJ1dGVzWzBdIC1iYW5kICRfIH0gfCBGb3JFYWNoLU9iamVjdCB7ICRUcnVzdEF0dHJpYnV0ZXNbJF9dIH0KCiAgICAgICAgICAgICAgICAgICAgJERpcmVjdGlvbiA9IFN3aXRjaCAoJFByb3BzLnRydXN0ZGlyZWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIDAgeyAnRGlzYWJsZWQnIH0KICAgICAgICAgICAgICAgICAgICAgICAgMSB7ICdJbmJvdW5kJyB9CiAgICAgICAgICAgICAgICAgICAgICAgIDIgeyAnT3V0Ym91bmQnIH0KICAgICAgICAgICAgICAgICAgICAgICAgMyB7ICdCaWRpcmVjdGlvbmFsJyB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRPYmplY3RHdWlkID0gTmV3LU9iamVjdCBHdWlkIEAoLCRQcm9wcy5vYmplY3RndWlkWzBdKQogICAgICAgICAgICAgICAgICAgICRUYXJnZXRTSUQgPSAoTmV3LU9iamVjdCBTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcigkUHJvcHMuc2VjdXJpdHlpZGVudGlmaWVyWzBdLDApKS5WYWx1ZQogICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTb3VyY2VOYW1lJyAkU291cmNlRG9tYWluCiAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NvdXJjZVNJRCcgJFNvdXJjZVNJRAogICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUYXJnZXROYW1lJyAkUHJvcHMubmFtZVswXQogICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUYXJnZXRTSUQnICRUYXJnZXRTSUQKICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnT2JqZWN0R3VpZCcgInskT2JqZWN0R3VpZH0iCiAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RydXN0VHlwZScgJCgkVHJ1c3RBdHRyaWIgLWpvaW4gJywnKQogICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUcnVzdERpcmVjdGlvbicgIiREaXJlY3Rpb24iCiAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0LlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5Eb21haW5UcnVzdExEQVAnKQogICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFJlc3VsdHMuZGlzcG9zZSgpCiAgICAgICAgICAgICAgICAkVHJ1c3RTZWFyY2hlci5kaXNwb3NlKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYoJEFQSSkgewogICAgICAgICAgICBpZigtbm90ICREb21haW5Db250cm9sbGVyKSB7CiAgICAgICAgICAgICAgICAkRG9tYWluQ29udHJvbGxlciA9IEdldC1OZXREb21haW5Db250cm9sbGVyIC1DcmVkZW50aWFsICRDcmVkZW50aWFsIC1Eb21haW4gJFNvdXJjZURvbWFpbiB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBOYW1lCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCREb21haW5Db250cm9sbGVyKSB7CiAgICAgICAgICAgICAgICAjIGFyZ3VtZW50cyBmb3IgRHNFbnVtZXJhdGVEb21haW5UcnVzdHMKICAgICAgICAgICAgICAgICRQdHJJbmZvID0gW0ludFB0cl06Olplcm8KCiAgICAgICAgICAgICAgICAjIDYzID0gRFNfRE9NQUlOX0lOX0ZPUkVTVCArIERTX0RPTUFJTl9ESVJFQ1RfT1VUQk9VTkQgKyBEU19ET01BSU5fVFJFRV9ST09UICsgRFNfRE9NQUlOX1BSSU1BUlkgKyBEU19ET01BSU5fTkFUSVZFX01PREUgKyBEU19ET01BSU5fRElSRUNUX0lOQk9VTkQKICAgICAgICAgICAgICAgICRGbGFncyA9IDYzCiAgICAgICAgICAgICAgICAkRG9tYWluQ291bnQgPSAwCgogICAgICAgICAgICAgICAgIyBnZXQgdGhlIHRydXN0IGluZm9ybWF0aW9uIGZyb20gdGhlIHRhcmdldCBzZXJ2ZXIKICAgICAgICAgICAgICAgICRSZXN1bHQgPSAkTmV0YXBpMzI6OkRzRW51bWVyYXRlRG9tYWluVHJ1c3RzKCREb21haW5Db250cm9sbGVyLCAkRmxhZ3MsIFtyZWZdJFB0ckluZm8sIFtyZWZdJERvbWFpbkNvdW50KQoKICAgICAgICAgICAgICAgICMgTG9jYXRlIHRoZSBvZmZzZXQgb2YgdGhlIGluaXRpYWwgaW50UHRyCiAgICAgICAgICAgICAgICAkT2Zmc2V0ID0gJFB0ckluZm8uVG9JbnQ2NCgpCgogICAgICAgICAgICAgICAgIyAwID0gc3VjY2VzcwogICAgICAgICAgICAgICAgaWYgKCgkUmVzdWx0IC1lcSAwKSAtYW5kICgkT2Zmc2V0IC1ndCAwKSkgewoKICAgICAgICAgICAgICAgICAgICAjIFdvcmsgb3V0IGhvdyBtdXRjaCB0byBpbmNyZW1lbnQgdGhlIHBvaW50ZXIgYnkgZmluZGluZyBvdXQgdGhlIHNpemUgb2YgdGhlIHN0cnVjdHVyZQogICAgICAgICAgICAgICAgICAgICRJbmNyZW1lbnQgPSAkRFNfRE9NQUlOX1RSVVNUUzo6R2V0U2l6ZSgpCgogICAgICAgICAgICAgICAgICAgICMgcGFyc2UgYWxsIHRoZSByZXN1bHQgc3RydWN0dXJlcwogICAgICAgICAgICAgICAgICAgIGZvciAoJGkgPSAwOyAoJGkgLWx0ICREb21haW5Db3VudCk7ICRpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBjcmVhdGUgYSBuZXcgaW50IHB0ciBhdCB0aGUgZ2l2ZW4gb2Zmc2V0IGFuZCBjYXN0IHRoZSBwb2ludGVyIGFzIG91ciByZXN1bHQgc3RydWN0dXJlCiAgICAgICAgICAgICAgICAgICAgICAgICROZXdJbnRQdHIgPSBOZXctT2JqZWN0IFN5c3RlbS5JbnRwdHIgLUFyZ3VtZW50TGlzdCAkT2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICRJbmZvID0gJE5ld0ludFB0ciAtYXMgJERTX0RPTUFJTl9UUlVTVFMKCiAgICAgICAgICAgICAgICAgICAgICAgICRPZmZzZXQgPSAkTmV3SW50UHRyLlRvSW50NjQoKQogICAgICAgICAgICAgICAgICAgICAgICAkT2Zmc2V0ICs9ICRJbmNyZW1lbnQKCiAgICAgICAgICAgICAgICAgICAgICAgICRTaWRTdHJpbmcgPSAiIgogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0ID0gJEFkdmFwaTMyOjpDb252ZXJ0U2lkVG9TdHJpbmdTaWQoJEluZm8uRG9tYWluU2lkLCBbcmVmXSRTaWRTdHJpbmcpOyRMYXN0RXJyb3IgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkdldExhc3RXaW4zMkVycm9yKCkKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRSZXN1bHQgLWVxIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yOiAkKChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpLk1lc3NhZ2UpIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0ID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NvdXJjZURvbWFpbicgJFNvdXJjZURvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NvdXJjZURvbWFpbkNvbnRyb2xsZXInICREb21haW5Db250cm9sbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTmV0Ymlvc0RvbWFpbk5hbWUnICRJbmZvLk5ldGJpb3NEb21haW5OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnRG5zRG9tYWluTmFtZScgJEluZm8uRG5zRG9tYWluTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0ZsYWdzJyAkSW5mby5GbGFncwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1BhcmVudEluZGV4JyAkSW5mby5QYXJlbnRJbmRleAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RydXN0VHlwZScgJEluZm8uVHJ1c3RUeXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVHJ1c3RBdHRyaWJ1dGVzJyAkSW5mby5UcnVzdEF0dHJpYnV0ZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEb21haW5TaWQnICRTaWRTdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEb21haW5HdWlkJyAkSW5mby5Eb21haW5HdWlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LkFQSURvbWFpblRydXN0JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICMgZnJlZSB1cCB0aGUgcmVzdWx0IGJ1ZmZlcgogICAgICAgICAgICAgICAgICAgICROdWxsID0gJE5ldGFwaTMyOjpOZXRBcGlCdWZmZXJGcmVlKCRQdHJJbmZvKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3I6ICQoKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJFJlc3VsdCkuTWVzc2FnZSkiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDb3VsZCBub3QgcmV0cmlldmUgZG9tYWluIGNvbnRyb2xsZXIgZm9yICREb21haW4iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICMgaWYgd2UncmUgdXNpbmcgZGlyZWN0IGRvbWFpbiBjb25uZWN0aW9ucyB0aHJvdWdoIC5ORVQKICAgICAgICAgICAgJEZvdW5kRG9tYWluID0gR2V0LU5ldERvbWFpbiAtRG9tYWluICREb21haW4gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwKICAgICAgICAgICAgaWYoJEZvdW5kRG9tYWluKSB7CiAgICAgICAgICAgICAgICAkRm91bmREb21haW4uR2V0QWxsVHJ1c3RSZWxhdGlvbnNoaXBzKCkgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgJF8uUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LkRvbWFpblRydXN0JykKICAgICAgICAgICAgICAgICAgICAkXwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LU5ldEZvcmVzdFRydXN0IHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBSZXR1cm4gYWxsIHRydXN0cyBmb3IgdGhlIGN1cnJlbnQgZm9yZXN0LgoKICAgIC5QQVJBTUVURVIgRm9yZXN0CgogICAgICAgIFJldHVybiB0cnVzdHMgZm9yIHRoZSBzcGVjaWZpZWQgZm9yZXN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtTmV0Rm9yZXN0VHJ1c3QKCiAgICAgICAgUmV0dXJuIGN1cnJlbnQgZm9yZXN0IHRydXN0cy4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1OZXRGb3Jlc3RUcnVzdCAtRm9yZXN0ICJ0ZXN0IgoKICAgICAgICBSZXR1cm4gdHJ1c3RzIGZvciB0aGUgInRlc3QiIGZvcmVzdC4KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRGb3Jlc3QsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCiAgICApCgogICAgcHJvY2VzcyB7CiAgICAgICAgJEZvdW5kRm9yZXN0ID0gR2V0LU5ldEZvcmVzdCAtRm9yZXN0ICRGb3Jlc3QgLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwKCiAgICAgICAgaWYoJEZvdW5kRm9yZXN0KSB7CiAgICAgICAgICAgICRGb3VuZEZvcmVzdC5HZXRBbGxUcnVzdFJlbGF0aW9uc2hpcHMoKSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICRfLlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5Gb3Jlc3RUcnVzdCcpCiAgICAgICAgICAgICAgICAkXwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gRmluZC1Gb3JlaWduVXNlciB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgRW51bWVyYXRlcyB1c2VycyB3aG8gYXJlIGluIGdyb3VwcyBvdXRzaWRlIG9mIHRoZWlyCiAgICAgICAgcHJpbmNpcGFsIGRvbWFpbi4gVGhlIC1SZWN1cnNlIG9wdGlvbiB3aWxsIHRyeSB0byBtYXAgYWxsCiAgICAgICAgdHJhbnNpdGl2ZSBkb21haW4gdHJ1c3QgcmVsYXRpb25zaGlwcyBhbmQgZW51bWVyYXRlIGFsbAogICAgICAgIHVzZXJzIHdobyBhcmUgaW4gZ3JvdXBzIG91dHNpZGUgb2YgdGhlaXIgcHJpbmNpcGFsIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIFVzZXJOYW1lCgogICAgICAgIFVzZXJuYW1lIHRvIGZpbHRlciByZXN1bHRzIGZvciwgd2lsZGNhcmRzIGFjY2VwdGVkLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIERvbWFpbiB0byBxdWVyeSBmb3IgdXNlcnMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIExEQVAKCiAgICAgICAgU3dpdGNoLiBVc2UgTERBUCBxdWVyaWVzIHRvIGVudW1lcmF0ZSB0aGUgdHJ1c3RzIGluc3RlYWQgb2YgZGlyZWN0IGRvbWFpbiBjb25uZWN0aW9ucy4KICAgICAgICBNb3JlIGxpa2VseSB0byBnZXQgYXJvdW5kIG5ldHdvcmsgc2VnbWVudGF0aW9uLCBidXQgbm90IGFzIGFjY3VyYXRlLgoKICAgIC5QQVJBTUVURVIgUmVjdXJzZQoKICAgICAgICBTd2l0Y2guIEVudW1lcmF0ZSBhbGwgdXNlciB0cnVzdCBncm91cHMgZnJvbSBhbGwgcmVhY2hhYmxlIGRvbWFpbnMgcmVjdXJzaXZlbHkuCgogICAgLlBBUkFNRVRFUiBQYWdlU2l6ZQoKICAgICAgICBUaGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuCgogICAgLkxJTksKCiAgICAgICAgaHR0cDovL2Jsb2cuaGFybWoweS5uZXQvCiM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFVzZXJOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJExEQVAsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlY3Vyc2UsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwCiAgICApCgogICAgZnVuY3Rpb24gR2V0LUZvcmVpZ25Vc2VyIHsKICAgICAgICAjIGhlbHBlciB1c2VkIHRvIGVudW1lcmF0ZSB1c2VycyB3aG8gYXJlIGluIGdyb3VwcyBvdXRzaWRlIG9mIHRoZWlyIHByaW5jaXBhbCBkb21haW4KICAgICAgICBwYXJhbSgKICAgICAgICAgICAgW1N0cmluZ10KICAgICAgICAgICAgJFVzZXJOYW1lLAoKICAgICAgICAgICAgW1N0cmluZ10KICAgICAgICAgICAgJERvbWFpbiwKCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICREb21haW5Db250cm9sbGVyLAoKICAgICAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwxMDAwMCldCiAgICAgICAgICAgIFtJbnRdCiAgICAgICAgICAgICRQYWdlU2l6ZSA9IDIwMAogICAgICAgICkKCiAgICAgICAgaWYgKCREb21haW4pIHsKICAgICAgICAgICAgIyBnZXQgdGhlIGRvbWFpbiBuYW1lIGludG8gZGlzdGluZ3Vpc2hlZCBmb3JtCiAgICAgICAgICAgICREaXN0aW5ndWlzaGVkRG9tYWluTmFtZSA9ICJEQz0iICsgJERvbWFpbiAtcmVwbGFjZSAnXC4nLCcsREM9JwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJERpc3Rpbmd1aXNoZWREb21haW5OYW1lID0gW1N0cmluZ10gKFthZHNpXScnKS5kaXN0aW5ndWlzaGVkbmFtZQogICAgICAgICAgICAkRG9tYWluID0gJERpc3Rpbmd1aXNoZWREb21haW5OYW1lIC1yZXBsYWNlICdEQz0nLCcnIC1yZXBsYWNlICcsJywnLicKICAgICAgICB9CgogICAgICAgIEdldC1OZXRVc2VyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtVXNlck5hbWUgJFVzZXJOYW1lIC1QYWdlU2l6ZSAkUGFnZVNpemUgLUZpbHRlciAnKG1lbWJlcm9mPSopJyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgRm9yRWFjaCAoJE1lbWJlcnNoaXAgaW4gJF8ubWVtYmVyb2YpIHsKICAgICAgICAgICAgICAgICRJbmRleCA9ICRNZW1iZXJzaGlwLkluZGV4T2YoIkRDPSIpCiAgICAgICAgICAgICAgICBpZigkSW5kZXgpIHsKCiAgICAgICAgICAgICAgICAgICAgJEdyb3VwRG9tYWluID0gJCgkTWVtYmVyc2hpcC5zdWJzdHJpbmcoJEluZGV4KSkgLXJlcGxhY2UgJ0RDPScsJycgLXJlcGxhY2UgJywnLCcuJwoKICAgICAgICAgICAgICAgICAgICBpZiAoJEdyb3VwRG9tYWluLkNvbXBhcmVUbygkRG9tYWluKSkgewogICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHRoZSBncm91cCBkb21haW4gZG9lc24ndCBtYXRjaCB0aGUgdXNlciBkb21haW4sIG91dHB1dAogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBOYW1lID0gJE1lbWJlcnNoaXAuc3BsaXQoIiwiKVswXS5zcGxpdCgiPSIpWzFdCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3JlaWduVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgJEZvcmVpZ25Vc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJEb21haW4nICREb21haW4KICAgICAgICAgICAgICAgICAgICAgICAgJEZvcmVpZ25Vc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJOYW1lJyAkXy5zYW1hY2NvdW50bmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnblVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXBEb21haW4nICRHcm91cERvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnblVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnR3JvdXBOYW1lJyAkR3JvdXBOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3JlaWduVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdHcm91cEROJyAkTWVtYmVyc2hpcAogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnblVzZXIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgaWYgKCRSZWN1cnNlKSB7CiAgICAgICAgIyBnZXQgYWxsIHJlY2hhYmxlIGRvbWFpbnMgaW4gdGhlIHRydXN0IG1lc2ggYW5kIHVuaXF1aWZ5IHRoZW0KICAgICAgICBpZigkTERBUCAtb3IgJERvbWFpbkNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgJERvbWFpblRydXN0cyA9IEludm9rZS1NYXBEb21haW5UcnVzdCAtTERBUCAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtUGFnZVNpemUgJFBhZ2VTaXplIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5Tb3VyY2VEb21haW4gfSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICREb21haW5UcnVzdHMgPSBJbnZva2UtTWFwRG9tYWluVHJ1c3QgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IEZvckVhY2gtT2JqZWN0IHsgJF8uU291cmNlRG9tYWluIH0gfCBTb3J0LU9iamVjdCAtVW5pcXVlCiAgICAgICAgfQoKICAgICAgICBGb3JFYWNoKCREb21haW5UcnVzdCBpbiAkRG9tYWluVHJ1c3RzKSB7CiAgICAgICAgICAgICMgZ2V0IHRoZSB0cnVzdCBncm91cHMgZm9yIGVhY2ggZG9tYWluIGluIHRoZSB0cnVzdCBtZXNoCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVudW1lcmF0aW5nIHRydXN0IGdyb3VwcyBpbiBkb21haW4gJERvbWFpblRydXN0IgogICAgICAgICAgICBHZXQtRm9yZWlnblVzZXIgLURvbWFpbiAkRG9tYWluVHJ1c3QgLVVzZXJOYW1lICRVc2VyTmFtZSAtUGFnZVNpemUgJFBhZ2VTaXplCiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgR2V0LUZvcmVpZ25Vc2VyIC1Eb21haW4gJERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciAtVXNlck5hbWUgJFVzZXJOYW1lIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgIH0KfQoKCmZ1bmN0aW9uIEZpbmQtRm9yZWlnbkdyb3VwIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBFbnVtZXJhdGVzIGFsbCB0aGUgbWVtYmVycyBvZiBhIGdpdmVuIGRvbWFpbidzIGdyb3VwcwogICAgICAgIGFuZCBmaW5kcyB1c2VycyB0aGF0IGFyZSBub3QgaW4gdGhlIHF1ZXJpZWQgZG9tYWluLgogICAgICAgIFRoZSAtUmVjdXJzZSBmbGFnIHdpbGwgcGVyZm9ybSB0aGlzIGVudW1lcmF0aW9uIGZvciBhbGwKICAgICAgICBlYWNoYWJsZSBkb21haW4gdHJ1c3RzLgoKICAgIC5QQVJBTUVURVIgR3JvdXBOYW1lCgogICAgICAgIEdyb3VwbmFtZSB0byBmaWx0ZXIgcmVzdWx0cyBmb3IsIHdpbGRjYXJkcyBhY2NlcHRlZC4KCiAgICAuUEFSQU1FVEVSIERvbWFpbgoKICAgICAgICBEb21haW4gdG8gcXVlcnkgZm9yIGdyb3VwcywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgTERBUAoKICAgICAgICBTd2l0Y2guIFVzZSBMREFQIHF1ZXJpZXMgdG8gZW51bWVyYXRlIHRoZSB0cnVzdHMgaW5zdGVhZCBvZiBkaXJlY3QgZG9tYWluIGNvbm5lY3Rpb25zLgogICAgICAgIE1vcmUgbGlrZWx5IHRvIGdldCBhcm91bmQgbmV0d29yayBzZWdtZW50YXRpb24sIGJ1dCBub3QgYXMgYWNjdXJhdGUuCgogICAgLlBBUkFNRVRFUiBSZWN1cnNlCgogICAgICAgIFN3aXRjaC4gRW51bWVyYXRlIGFsbCBncm91cCB0cnVzdCB1c2VycyBmcm9tIGFsbCByZWFjaGFibGUgZG9tYWlucyByZWN1cnNpdmVseS4KCiAgICAuUEFSQU1FVEVSIFBhZ2VTaXplCgogICAgICAgIFRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4KCiAgICAuTElOSwoKICAgICAgICBodHRwOi8vYmxvZy5oYXJtajB5Lm5ldC8KIz4KCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkR3JvdXBOYW1lID0gJyonLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJExEQVAsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJlY3Vyc2UsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwCiAgICApCgogICAgZnVuY3Rpb24gR2V0LUZvcmVpZ25Hcm91cCB7CiAgICAgICAgcGFyYW0oCiAgICAgICAgICAgIFtTdHJpbmddCiAgICAgICAgICAgICRHcm91cE5hbWUgPSAnKicsCgogICAgICAgICAgICBbU3RyaW5nXQogICAgICAgICAgICAkRG9tYWluLAoKICAgICAgICAgICAgW1N0cmluZ10KICAgICAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMDAwKV0KICAgICAgICAgICAgW0ludF0KICAgICAgICAgICAgJFBhZ2VTaXplID0gMjAwCiAgICAgICAgKQoKICAgICAgICBpZigtbm90ICREb21haW4pIHsKICAgICAgICAgICAgJERvbWFpbiA9IChHZXQtTmV0RG9tYWluKS5OYW1lCiAgICAgICAgfQoKICAgICAgICAkRG9tYWluRE4gPSAiREM9JCgkRG9tYWluLlJlcGxhY2UoJy4nLCAnLERDPScpKSIKICAgICAgICBXcml0ZS1WZXJib3NlICJEb21haW5ETjogJERvbWFpbkROIgoKICAgICAgICAjIHN0YW5kYXJkIGdyb3VwIG5hbWVzIHRvIGlnbm9yZQogICAgICAgICRFeGNsdWRlR3JvdXBzID0gQCgiVXNlcnMiLCAiRG9tYWluIFVzZXJzIiwgIkd1ZXN0cyIpCgogICAgICAgICMgZ2V0IGFsbCB0aGUgZ3JvdXBuYW1lcyBmb3IgdGhlIGdpdmVuIGRvbWFpbgogICAgICAgIEdldC1OZXRHcm91cCAtR3JvdXBOYW1lICRHcm91cE5hbWUgLUZpbHRlciAnKG1lbWJlcj0qKScgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1GdWxsRGF0YSAtUGFnZVNpemUgJFBhZ2VTaXplIHwgV2hlcmUtT2JqZWN0IHsKICAgICAgICAgICAgIyBleGNsdWRlIGNvbW1vbiBsYXJnZSBncm91cHMKICAgICAgICAgICAgLW5vdCAoJEV4Y2x1ZGVHcm91cHMgLWNvbnRhaW5zICRfLnNhbWFjY291bnRuYW1lKSB9IHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICRHcm91cE5hbWUgPSAkXy5zYW1BY2NvdW50TmFtZQoKICAgICAgICAgICAgICAgICRfLm1lbWJlciB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAjIGZpbHRlciBmb3IgZm9yZWlnbiBTSURzIGluIHRoZSBjbiBmaWVsZCBmb3IgdXNlcnMgaW4gYW5vdGhlciBkb21haW4sCiAgICAgICAgICAgICAgICAgICAgIyAgIG9yIGlmIHRoZSBETiBkb2Vzbid0IGVuZCB3aXRoIHRoZSBwcm9wZXIgRE4gZm9yIHRoZSBxdWVyaWVkIGRvbWFpbgogICAgICAgICAgICAgICAgICAgIGlmICgoJF8gLW1hdGNoICdDTj1TLTEtNS0yMS4qLS4qJykgLW9yICgkRG9tYWluRE4gLW5lICgkXy5zdWJzdHJpbmcoJF8uSW5kZXhPZigiREM9IikpKSkpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyRG9tYWluID0gJF8uc3ViU3RyaW5nKCRfLkluZGV4T2YoIkRDPSIpKSAtcmVwbGFjZSAnREM9JywnJyAtcmVwbGFjZSAnLCcsJy4nCiAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyTmFtZSA9ICRfLnNwbGl0KCIsIilbMF0uc3BsaXQoIj0iKVsxXQoKICAgICAgICAgICAgICAgICAgICAgICAgJEZvcmVpZ25Hcm91cFVzZXIgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICRGb3JlaWduR3JvdXBVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dyb3VwRG9tYWluJyAkRG9tYWluCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3JlaWduR3JvdXBVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0dyb3VwTmFtZScgJEdyb3VwTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnbkdyb3VwVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyRG9tYWluJyAkVXNlckRvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAkRm9yZWlnbkdyb3VwVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyTmFtZScgJFVzZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRGb3JlaWduR3JvdXBVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJETicgJF8KICAgICAgICAgICAgICAgICAgICAgICAgJEZvcmVpZ25Hcm91cFVzZXIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGlmICgkUmVjdXJzZSkgewogICAgICAgICMgZ2V0IGFsbCByZWNoYWJsZSBkb21haW5zIGluIHRoZSB0cnVzdCBtZXNoIGFuZCB1bmlxdWlmeSB0aGVtCiAgICAgICAgaWYoJExEQVAgLW9yICREb21haW5Db250cm9sbGVyKSB7CiAgICAgICAgICAgICREb21haW5UcnVzdHMgPSBJbnZva2UtTWFwRG9tYWluVHJ1c3QgLUxEQVAgLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZSB8IEZvckVhY2gtT2JqZWN0IHsgJF8uU291cmNlRG9tYWluIH0gfCBTb3J0LU9iamVjdCAtVW5pcXVlCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkRG9tYWluVHJ1c3RzID0gSW52b2tlLU1hcERvbWFpblRydXN0IC1QYWdlU2l6ZSAkUGFnZVNpemUgfCBGb3JFYWNoLU9iamVjdCB7ICRfLlNvdXJjZURvbWFpbiB9IHwgU29ydC1PYmplY3QgLVVuaXF1ZQogICAgICAgIH0KCiAgICAgICAgRm9yRWFjaCgkRG9tYWluVHJ1c3QgaW4gJERvbWFpblRydXN0cykgewogICAgICAgICAgICAjIGdldCB0aGUgdHJ1c3QgZ3JvdXBzIGZvciBlYWNoIGRvbWFpbiBpbiB0aGUgdHJ1c3QgbWVzaAogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFbnVtZXJhdGluZyB0cnVzdCBncm91cHMgaW4gZG9tYWluICREb21haW5UcnVzdCIKICAgICAgICAgICAgR2V0LUZvcmVpZ25Hcm91cCAtR3JvdXBOYW1lICRHcm91cE5hbWUgLURvbWFpbiAkRG9tYWluIC1Eb21haW5Db250cm9sbGVyICREb21haW5Db250cm9sbGVyIC1QYWdlU2l6ZSAkUGFnZVNpemUKICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBHZXQtRm9yZWlnbkdyb3VwIC1Hcm91cE5hbWUgJEdyb3VwTmFtZSAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZQogICAgfQp9CgoKZnVuY3Rpb24gRmluZC1NYW5hZ2VkU2VjdXJpdHlHcm91cHMgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFRoaXMgZnVuY3Rpb24gcmV0cmlldmVzIGFsbCBzZWN1cml0eSBncm91cHMgaW4gdGhlIGRvbWFpbiBhbmQgaWRlbnRpZmllcyBvbmVzIHRoYXQKICAgICAgICBoYXZlIGEgbWFuYWdlciBzZXQuIEl0IGFsc28gZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBtYW5hZ2VyIGhhcyB0aGUgYWJpbGl0eSB0byBhZGQKICAgICAgICBvciByZW1vdmUgbWVtYmVycyBmcm9tIHRoZSBncm91cC4KCiAgICAgICAgQXV0aG9yOiBTdHVhcnQgTW9yZ2FuIChAdWtzdHVmdXMpIDxzdHVhcnQubW9yZ2FuQG13cmluZm9zZWN1cml0eS5jb20+CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBGaW5kLU1hbmFnZWRTZWN1cml0eUdyb3VwcyB8IEV4cG9ydC1Qb3dlclZpZXdDU1YgLU5vVHlwZUluZm9ybWF0aW9uIGdyb3VwLW1hbmFnZXJzLmNzdgoKICAgICAgICBTdG9yZSBhIGxpc3Qgb2YgYWxsIHNlY3VyaXR5IGdyb3VwcyB3aXRoIG1hbmFnZXJzIGluIGdyb3VwLW1hbmFnZXJzLmNzdgoKICAgIC5ERVNDUklQVElPTgoKICAgICAgICBBdXRob3JpdHkgdG8gbWFuaXB1bGF0ZSB0aGUgZ3JvdXAgbWVtYmVyc2hpcCBvZiBBRCBzZWN1cml0eSBncm91cHMgYW5kIGRpc3RyaWJ1dGlvbiBncm91cHMKICAgICAgICBjYW4gYmUgZGVsZWdhdGVkIHRvIG5vbi1hZG1pbmlzdHJhdG9ycyBieSBzZXR0aW5nIHRoZSAnbWFuYWdlZEJ5JyBhdHRyaWJ1dGUuIFRoaXMgaXMgdHlwaWNhbGx5CiAgICAgICAgdXNlZCB0byBkZWxlZ2F0ZSBtYW5hZ2VtZW50IGF1dGhvcml0eSB0byBkaXN0cmlidXRpb24gZ3JvdXBzLCBidXQgV2luZG93cyBzdXBwb3J0cyBzZWN1cml0eSBncm91cHMKICAgICAgICBiZWluZyBtYW5hZ2VkIGluIHRoZSBzYW1lIHdheS4KCiAgICAgICAgVGhpcyBmdW5jdGlvbiBzZWFyY2hlcyBmb3IgQUQgZ3JvdXBzIHdoaWNoIGhhdmUgYSBncm91cCBtYW5hZ2VyIHNldCwgYW5kIGRldGVybWluZXMgd2hldGhlciB0aGF0CiAgICAgICAgdXNlciBjYW4gbWFuaXB1bGF0ZSBncm91cCBtZW1iZXJzaGlwLiBUaGlzIGNvdWxkIGJlIGEgdXNlZnVsIG1ldGhvZCBvZiBob3Jpem9udGFsIHByaXZpbGVnZQogICAgICAgIGVzY2FsYXRpb24sIGVzcGVjaWFsbHkgaWYgdGhlIG1hbmFnZXIgY2FuIG1hbmlwdWxhdGUgdGhlIG1lbWJlcnNoaXAgb2YgYSBwcml2aWxlZ2VkIGdyb3VwLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9Qb3dlclNoZWxsRW1waXJlL0VtcGlyZS9wdWxsLzExOQoKIz4KCiAgICAjIEdvIHRocm91Z2ggdGhlIGxpc3Qgb2Ygc2VjdXJpdHkgZ3JvdXBzIG9uIHRoZSBkb21haW4gYW5kIGlkZW50aWZ5IHRob3NlIHdobyBoYXZlIGEgbWFuYWdlcgogICAgR2V0LU5ldEdyb3VwIC1GdWxsRGF0YSAtRmlsdGVyICcoJihtYW5hZ2VkQnk9KikoZ3JvdXBUeXBlOjEuMi44NDAuMTEzNTU2LjEuNC44MDM6PTIxNDc0ODM2NDgpKScgfCBTZWxlY3QtT2JqZWN0IC1VbmlxdWUgZGlzdGluZ3Vpc2hlZE5hbWUsbWFuYWdlZEJ5LGNuIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAjIFJldHJpZXZlIHRoZSBvYmplY3QgdGhhdCB0aGUgbWFuYWdlZEJ5IEROIHJlZmVycyB0bwogICAgICAgICRncm91cF9tYW5hZ2VyID0gR2V0LUFET2JqZWN0IC1BRFNQYXRoICRfLm1hbmFnZWRCeSB8IFNlbGVjdC1PYmplY3QgY24sZGlzdGluZ3Vpc2hlZG5hbWUsbmFtZSxzYW1hY2NvdW50dHlwZSxzYW1hY2NvdW50bmFtZQoKICAgICAgICAjIENyZWF0ZSBhIHJlc3VsdHMgb2JqZWN0IHRvIHN0b3JlIG91ciBmaW5kaW5ncwogICAgICAgICRyZXN1bHRzX29iamVjdCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IC1Qcm9wZXJ0eSBAewogICAgICAgICAgICAnR3JvdXBDTicgPSAkXy5jbgogICAgICAgICAgICAnR3JvdXBETicgPSAkXy5kaXN0aW5ndWlzaGVkbmFtZQogICAgICAgICAgICAnTWFuYWdlckNOJyA9ICRncm91cF9tYW5hZ2VyLmNuCiAgICAgICAgICAgICdNYW5hZ2VyRE4nID0gJGdyb3VwX21hbmFnZXIuZGlzdGluZ3Vpc2hlZE5hbWUKICAgICAgICAgICAgJ01hbmFnZXJTQU4nID0gJGdyb3VwX21hbmFnZXIuc2FtYWNjb3VudG5hbWUKICAgICAgICAgICAgJ01hbmFnZXJUeXBlJyA9ICcnCiAgICAgICAgICAgICdDYW5NYW5hZ2VyV3JpdGUnID0gJEZBTFNFCiAgICAgICAgfQoKICAgICAgICAjIERldGVybWluZSB3aGV0aGVyIHRoZSBtYW5hZ2VyIGlzIGEgdXNlciBvciBhIGdyb3VwCiAgICAgICAgaWYgKCRncm91cF9tYW5hZ2VyLnNhbWFjY291bnR0eXBlIC1lcSAweDEwMDAwMDAwKSB7CiAgICAgICAgICAgICRyZXN1bHRzX29iamVjdC5NYW5hZ2VyVHlwZSA9ICdHcm91cCcKICAgICAgICB9IGVsc2VpZiAoJGdyb3VwX21hbmFnZXIuc2FtYWNjb3VudHR5cGUgLWVxIDB4MzAwMDAwMDApIHsKICAgICAgICAgICAgJHJlc3VsdHNfb2JqZWN0Lk1hbmFnZXJUeXBlID0gJ1VzZXInCiAgICAgICAgfQoKICAgICAgICAjIEZpbmQgdGhlIEFDTHMgdGhhdCByZWxhdGUgdG8gdGhlIGFiaWxpdHkgdG8gd3JpdGUgdG8gdGhlIGdyb3VwCiAgICAgICAgJHhhY2wgPSBHZXQtT2JqZWN0QWNsIC1BRFNQYXRoICRfLmRpc3Rpbmd1aXNoZWRuYW1lIC1SaWdodHMgV3JpdGVNZW1iZXJzCgogICAgICAgICMgRG91YmxlLWNoZWNrIHRoYXQgdGhlIG1hbmFnZXIKICAgICAgICBpZiAoJHhhY2wuT2JqZWN0VHlwZSAtZXEgJ2JmOTY3OWMwLTBkZTYtMTFkMC1hMjg1LTAwYWEwMDMwNDllMicgLWFuZCAkeGFjbC5BY2Nlc3NDb250cm9sVHlwZSAtZXEgJ0FsbG93JyAtYW5kICR4YWNsLklkZW50aXR5UmVmZXJlbmNlLlZhbHVlLkNvbnRhaW5zKCRncm91cF9tYW5hZ2VyLnNhbWFjY291bnRuYW1lKSkgewogICAgICAgICAgICAkcmVzdWx0c19vYmplY3QuQ2FuTWFuYWdlcldyaXRlID0gJFRSVUUKICAgICAgICB9CiAgICAgICAgJHJlc3VsdHNfb2JqZWN0CiAgICB9Cn0KCgpmdW5jdGlvbiBJbnZva2UtTWFwRG9tYWluVHJ1c3Qgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFRoaXMgZnVuY3Rpb24gZ2V0cyBhbGwgdHJ1c3RzIGZvciB0aGUgY3VycmVudCBkb21haW4sCiAgICAgICAgYW5kIHRyaWVzIHRvIGdldCBhbGwgdHJ1c3RzIGZvciBlYWNoIGRvbWFpbiBpdCBmaW5kcy4KCiAgICAuUEFSQU1FVEVSIExEQVAKCiAgICAgICAgU3dpdGNoLiBVc2UgTERBUCBxdWVyaWVzIHRvIGVudW1lcmF0ZSB0aGUgdHJ1c3RzIGluc3RlYWQgb2YgZGlyZWN0IGRvbWFpbiBjb25uZWN0aW9ucy4KICAgICAgICBNb3JlIGxpa2VseSB0byBnZXQgYXJvdW5kIG5ldHdvcmsgc2VnbWVudGF0aW9uLCBidXQgbm90IGFzIGFjY3VyYXRlLgoKICAgIC5QQVJBTUVURVIgRG9tYWluQ29udHJvbGxlcgoKICAgICAgICBEb21haW4gY29udHJvbGxlciB0byByZWZsZWN0IExEQVAgcXVlcmllcyB0aHJvdWdoLgoKICAgIC5QQVJBTUVURVIgUGFnZVNpemUKCiAgICAgICAgVGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0LgoKICAgIC5QQVJBTUVURVIgQ3JlZGVudGlhbAoKICAgICAgICBBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzCiAgICAgICAgZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBJbnZva2UtTWFwRG9tYWluVHJ1c3QgfCBFeHBvcnQtQ1NWIC1Ob1R5cGVJbmZvcm1hdGlvbiB0cnVzdHMuY3N2CgogICAgICAgIE1hcCBhbGwgcmVhY2hhYmxlIGRvbWFpbiB0cnVzdHMgYW5kIG91dHB1dCBldmVyeXRoaW5nIHRvIGEgLmNzdiBmaWxlLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly9ibG9nLmhhcm1qMHkubmV0LwojPgogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJExEQVAsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsMTAwMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJFBhZ2VTaXplID0gMjAwLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgICMga2VlcCB0cmFjayBvZiBkb21haW5zIHNlZW4gc28gd2UgZG9uJ3QgaGl0IGluZmluaXRlIHJlY3Vyc2lvbgogICAgJFNlZW5Eb21haW5zID0gQHt9CgogICAgIyBvdXIgZG9tYWluIHN0YXR1cyB0cmFja2VyCiAgICAkRG9tYWlucyA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLlN0YWNrCgogICAgIyBnZXQgdGhlIGN1cnJlbnQgZG9tYWluIGFuZCBwdXNoIGl0IG9udG8gdGhlIHN0YWNrCiAgICAkQ3VycmVudERvbWFpbiA9IChHZXQtTmV0RG9tYWluIC1DcmVkZW50aWFsICRDcmVkZW50aWFsKS5OYW1lCiAgICAkRG9tYWlucy5wdXNoKCRDdXJyZW50RG9tYWluKQoKICAgIHdoaWxlKCREb21haW5zLkNvdW50IC1uZSAwKSB7CgogICAgICAgICREb21haW4gPSAkRG9tYWlucy5Qb3AoKQoKICAgICAgICAjIGlmIHdlIGhhdmVuJ3Qgc2VlbiB0aGlzIGRvbWFpbiBiZWZvcmUKICAgICAgICBpZiAoJERvbWFpbiAtYW5kICgkRG9tYWluLlRyaW0oKSAtbmUgIiIpIC1hbmQgKC1ub3QgJFNlZW5Eb21haW5zLkNvbnRhaW5zS2V5KCREb21haW4pKSkgewoKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRW51bWVyYXRpbmcgdHJ1c3RzIGZvciBkb21haW4gJyREb21haW4nIgoKICAgICAgICAgICAgIyBtYXJrIGl0IGFzIHNlZW4gaW4gb3VyIGxpc3QKICAgICAgICAgICAgJE51bGwgPSAkU2VlbkRvbWFpbnMuYWRkKCREb21haW4sICIiKQoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICMgZ2V0IGFsbCB0aGUgdHJ1c3RzIGZvciB0aGlzIGRvbWFpbgogICAgICAgICAgICAgICAgaWYoJExEQVAgLW9yICREb21haW5Db250cm9sbGVyKSB7CiAgICAgICAgICAgICAgICAgICAgJFRydXN0cyA9IEdldC1OZXREb21haW5UcnVzdCAtRG9tYWluICREb21haW4gLUxEQVAgLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIgLVBhZ2VTaXplICRQYWdlU2l6ZSAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJFRydXN0cyA9IEdldC1OZXREb21haW5UcnVzdCAtRG9tYWluICREb21haW4gLVBhZ2VTaXplICRQYWdlU2l6ZSAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKCRUcnVzdHMgLWlzbm90IFtTeXN0ZW0uQXJyYXldKSB7CiAgICAgICAgICAgICAgICAgICAgJFRydXN0cyA9IEAoJFRydXN0cykKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIGdldCBhbnkgZm9yZXN0IHRydXN0cywgaWYgdGhleSBleGlzdAogICAgICAgICAgICAgICAgaWYoLW5vdCAoJExEQVAgLW9yICREb21haW5Db250cm9sbGVyKSApIHsKICAgICAgICAgICAgICAgICAgICAkVHJ1c3RzICs9IEdldC1OZXRGb3Jlc3RUcnVzdCAtRm9yZXN0ICREb21haW4gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoJFRydXN0cykgewogICAgICAgICAgICAgICAgICAgIGlmKCRUcnVzdHMgLWlzbm90IFtTeXN0ZW0uQXJyYXldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRUcnVzdHMgPSBAKCRUcnVzdHMpCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAjIGVudW1lcmF0ZSBlYWNoIHRydXN0IGZvdW5kCiAgICAgICAgICAgICAgICAgICAgRm9yRWFjaCAoJFRydXN0IGluICRUcnVzdHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJFRydXN0LlNvdXJjZU5hbWUgLWFuZCAkVHJ1c3QuVGFyZ2V0TmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFNvdXJjZURvbWFpbiA9ICRUcnVzdC5Tb3VyY2VOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWluID0gJFRydXN0LlRhcmdldE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUcnVzdFR5cGUgPSAkVHJ1c3QuVHJ1c3RUeXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVHJ1c3REaXJlY3Rpb24gPSAkVHJ1c3QuVHJ1c3REaXJlY3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRPYmplY3RUeXBlID0gJFRydXN0LlBTT2JqZWN0LlR5cGVOYW1lcyB8IFdoZXJlLU9iamVjdCB7JF8gLW1hdGNoICdQb3dlclZpZXcnfSB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIG1ha2Ugc3VyZSB3ZSBwcm9jZXNzIHRoZSB0YXJnZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICROdWxsID0gJERvbWFpbnMuUHVzaCgkVGFyZ2V0RG9tYWluKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgYnVpbGQgdGhlIG5pY2VseS1wYXJzYWJsZSBjdXN0b20gb3V0cHV0IG9iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0ID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NvdXJjZURvbWFpbicgIiRTb3VyY2VEb21haW4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU291cmNlU0lEJyAkVHJ1c3QuU291cmNlU0lECiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVGFyZ2V0RG9tYWluJyAiJFRhcmdldERvbWFpbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUYXJnZXRTSUQnICRUcnVzdC5UYXJnZXRTSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5UcnVzdCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUcnVzdFR5cGUnICIkVHJ1c3RUeXBlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RydXN0RGlyZWN0aW9uJyAiJFRydXN0RGlyZWN0aW9uIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpblRydXN0LlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJE9iamVjdFR5cGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRG9tYWluVHJ1c3QKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbIV0gRXJyb3I6ICRfIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojIEJsb29kSG91bmQgc3BlY2lmaWMgZnVjdGlvbnMuCiMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmZ1bmN0aW9uIEdldC1CbG9vZEhvdW5kRGF0YSB7CjwjCiAgICAuU1lOT1BTSVMKCiAgICAgICAgVGhpcyBmdW5jdGlvbiBhdXRvbWF0ZXMgdGhlIGNvbGxlY3Rpb24gb2YgdGhlIGRhdGEgbmVlZGVkIGZvciBCbG9vZEhvdW5kLgoKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAgICAgUmVxdWlyZWQgRGVwZW5kZW5jaWVzOiBQb3dlclZpZXcucHMxCiAgICAgICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBOb25lCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFRoaXMgZnVuY3Rpb24gY29sbGVjdHMgdGhlIGluZm9ybWF0aW9uIG5lZWRlZCB0byBwb3B1bGF0ZSB0aGUgQmxvb2RIb3VuZCBncmFwaAogICAgICAgIGRhdGFiYXNlLiBJdCBvZmZlcnMgYSB2YXJpdHkgb2YgdGFyZ2V0aW5nIGFuZCBjb2xsZWN0aW9uIG9wdGlvbnMuCiAgICAgICAgQnkgZGVmYXVsdCwgaXQgd2lsbCBtYXAgYWxsIGRvbWFpbiB0cnVzdHMsIGVudW1lcmF0ZSBhbGwgZ3JvdXBzIGFuZCBhc3NvY2lhdGVkIG1lbWJlcnNoaXBzLAogICAgICAgIGVudW1lcmF0ZSBhbGwgY29tcHV0ZXJzIG9uIHRoZSBkb21haW4gYW5kIGV4ZWN1dGUgc2Vzc2lvbi9sb2dnZWRvbi9sb2NhbCBhZG1pbiBlbnVtZXJhdGlvbgogICAgICAgIHF1ZXJpZXMgYWdhaW5zdCBlYWNoLiBUYXJnZXRpbmcgb3B0aW9ucyBhcmUgbW9kaWZpYWJsZSB3aXRoIC1Db2xsZWN0aW9uTWV0aG9kLiBUaGUKICAgICAgICAtU2VhcmNoRm9yZXN0IHNlYXJjaGVzIGFsbCBkb21haW5zIGluIHRoZSBmb3Jlc3QgaW5zdGVhZCBvZiBqdXN0IHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIENvbXB1dGVyTmFtZQoKICAgICAgICBIb3N0IGFycmF5IHRvIGVudW1lcmF0ZSwgcGFzc2FibGUgb24gdGhlIHBpcGVsaW5lLgoKICAgIC5QQVJBTUVURVIgRG9tYWluCgogICAgICAgIERvbWFpbiB0byBxdWVyeSBmb3IgbWFjaGluZXMsIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgRG9tYWluIGNvbnRyb2xsZXIgdG8gcmVmbGVjdCBMREFQIHF1ZXJpZXMgdGhyb3VnaC4KCiAgICAuUEFSQU1FVEVSIENvbGxlY3Rpb25NZXRob2QKCiAgICAgICAgVGhlIG1ldGhvZCB0byBjb2xsZWN0IGRhdGEuICdHcm91cCcsICdMb2NhbEdyb3VwJywgJ0dQT0xvY2FsR3JvdXAnLCAnU2Vzc3Npb24nLCAnTG9nZ2VkT24nLCAnVHJ1c3RzLCAnVHJ1c3RzTERBUCcsICdTdGVhbHRoJywgb3IgJ0RlZmF1bHQnLgogICAgICAgICdUcnVzdHNMREFQJyB1c2VzIExEQVAgZW51bWVyYXRpb24gZm9yIHRydXN0cywgd2hpbGUgJ1RydXN0cycgdXNpbmcgLk5FVCBtZXRob2RzLgogICAgICAgICdTdGVhbHRoJyB1c2VzICdHcm91cCcgY29sbGVjdGlvbiwgc3RlYWx0aCB1c2VyIGh1bnRpbmcgKCdTZXNzaW9uJyBvbiBjZXJ0YWluIHNlcnZlcnMpLCAnR1BPTG9jYWxHcm91cCcgZW51bWVyYXRpb24sIGFuZCBMREFQIHRydXN0IGVudW1lcmF0aW9uLgogICAgICAgICdEZWZhdWx0JyB1c2VzICdHcm91cCcgY29sbGVjdGlvbiwgcmVndWxhciB1c2VyIGh1bnRpbmcgd2l0aCAnU2Vzc2lvbicvJ0xvZ2dlZE9uJywgJ0xvY2FsR3JvdXAnIGVudW1lcmF0aW9uLCBhbmQgJ1RydXN0cycgZW51bWVyYXRpb24uCgogICAgLlBBUkFNRVRFUiBTZWFyY2hGb3Jlc3QKCiAgICAgICAgU3dpdGNoLiBTZWFyY2ggYWxsIGRvbWFpbnMgaW4gdGhlIGZvcmVzdCBmb3IgdGFyZ2V0IHVzZXJzIGluc3RlYWQgb2YganVzdAogICAgICAgIGEgc2luZ2xlIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIFRocmVhZHMKCiAgICAgICAgVGhlIG1heGltdW0gY29uY3VycmVudCB0aHJlYWRzIHRvIGV4ZWN1dGUuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtQmxvb2RIb3VuZERhdGEgfCBFeHBvcnQtQmxvb2RIb3VuZERhdGEgLVVSSSBodHRwOi8vU0VSVkVSOjc0NzQvIC1Vc2VyUGFzcyAidXNlcjpwYXNzIgoKICAgICAgICBFeGVjdXRlcyBkZWZhdWx0IGNvbGxlY3Rpb24gb3B0aW9ucyBhbmQgZXhwb3J0cyB0aGUgZGF0YSB0byBhIEJsb29kSG91bmQgbmVvNGogUkVTVGZ1bCBBUEkgZW5kcG9pbnQuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtQmxvb2RIb3VuZERhdGEgfCBFeHBvcnQtQmxvb2RIb3VuZERhdGEgLVVSSSBodHRwOi8vU0VSVkVSOjc0NzQvIC1Vc2VyUGFzcyAidXNlcjpwYXNzIiAtVGhyZWFkcyAyMAoKICAgICAgICBFeGVjdXRlcyBkZWZhdWx0IGNvbGxlY3Rpb24gb3B0aW9ucyBhbmQgZXhwb3J0cyB0aGUgZGF0YSB0byBhIEJsb29kSG91bmQgbmVvNGogUkVTVGZ1bCBBUEkgZW5kcG9pbnQsCiAgICAgICAgYW5kIHVzZSAyMCB0aHJlYWRzIGZvciBjb2xsZWN0aW9uIG9wZXJhdGlvbnMuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtQmxvb2RIb3VuZERhdGEgfCBFeHBvcnQtQmxvb2RIb3VuZENTVgoKICAgICAgICBFeGVjdXRlcyBkZWZhdWx0IGNvbGxlY3Rpb24gb3B0aW9ucyBhbmQgZXhwb3J0cyB0aGUgZGF0YSB0byBhIENTVnMgaW4gdGhlIGN1cnJlbnQgZGlyZWN0b3J5LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUJsb29kSG91bmREYXRhIC1Db2xsZWN0aW9uTWV0aG9kICdTdGVhbHRoJyB8IEV4cG9ydC1CbG9vZEhvdW5kRGF0YSAtVVJJIGh0dHA6Ly9TRVJWRVI6NzQ3NC8gLVVzZXJQYXNzICJ1c2VyOnBhc3MiCgogICAgICAgIEV4ZWN1dGVzICdzdGVhbHRoJyBjb2xsZWN0aW9uIG9wdGlvbnMgYW5kIGV4cG9ydHMgdGhlIGRhdGEgdG8gYSBCbG9vZEhvdW5kIG5lbzRqIFJFU1RmdWwgQVBJIGVuZHBvaW50LgogICAgICAgIFRoaXMgaW5jbHVkZXMgJ3N0ZWFsdGgnIHVzZXIgaHVudGluZyBhbmQgR1BPIG9iamVjdCBjb3JyZWxhdGlvbiBmb3IgbG9jYWwgYWRtaW4gbWVtYmVyc2hpcC4KICAgICAgICBUaGlzIGlzIHNpZ25pZmljYW50bHkgZmFzdGVyIGJ1dCB0aGUgaW5mb3JtYXRpb24gaXMgbm90IGFzIGNvbXBsZXRlIGFzIHRoZSBkZWZhdWx0IG9wdGlvbnMuCiM+CgogICAgW0NtZGxldEJpbmRpbmcoRGVmYXVsdFBhcmFtZXRlclNldE5hbWUgPSAnTm9uZScpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdIb3N0cycpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkQ29tcHV0ZXJOYW1lLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJERvbWFpbkNvbnRyb2xsZXIsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgW1ZhbGlkYXRlU2V0KCdHcm91cCcsICdMb2NhbEdyb3VwJywgJ0dQT0xvY2FsR3JvdXAnLCAnU2Vzc2lvbicsICdMb2dnZWRPbicsICdTdGVhbHRoJywgJ1RydXN0cycsICdUcnVzdHNMREFQJywgJ0RlZmF1bHQnKV0KICAgICAgICAkQ29sbGVjdGlvbk1ldGhvZCA9ICdEZWZhdWx0JywKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2VhcmNoRm9yZXN0LAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLDEwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkVGhyZWFkcwogICAgKQoKICAgIGJlZ2luIHsKCiAgICAgICAgU3dpdGNoICgkQ29sbGVjdGlvbk1ldGhvZCkgewogICAgICAgICAgICAnR3JvdXAnICAgICAgICAgeyAkVXNlR3JvdXAgPSAkVHJ1ZTsgJFNraXBDb21wdXRlckVudW1lcmF0aW9uID0gJFRydWUgfQogICAgICAgICAgICAnTG9jYWxHcm91cCcgICAgeyAkVXNlTG9jYWxHcm91cCA9ICRUcnVlIH0KICAgICAgICAgICAgJ0dQT0xvY2FsR3JvdXAnIHsgJFVzZUdQT0dyb3VwID0gJFRydWU7ICRTa2lwQ29tcHV0ZXJFbnVtZXJhdGlvbiA9ICRUcnVlIH0KICAgICAgICAgICAgJ1Nlc3Npb24nICAgICAgIHsgJFVzZVNlc3Npb24gPSAkVHJ1ZSB9CiAgICAgICAgICAgICdMb2dnZWRPbicgICAgICB7ICRVc2VMb2dnZWRPbiA9ICRUcnVlIH0KICAgICAgICAgICAgJ1RydXN0c0xEQVAnICAgIHsgJFVzZURvbWFpblRydXN0c0xEQVAgPSAkVHJ1ZTsgJFNraXBDb21wdXRlckVudW1lcmF0aW9uID0gJFRydWUgfQogICAgICAgICAgICAnVHJ1c3RzJyAgICAgICAgeyAkVXNlRG9tYWluVHJ1c3RzID0gJFRydWU7ICRTa2lwQ29tcHV0ZXJFbnVtZXJhdGlvbiA9ICRUcnVlIH0KICAgICAgICAgICAgJ1N0ZWFsdGgnICAgICAgIHsKICAgICAgICAgICAgICAgICRVc2VHcm91cCA9ICRUcnVlCiAgICAgICAgICAgICAgICAkVXNlR1BPR3JvdXAgPSAkVHJ1ZQogICAgICAgICAgICAgICAgJFVzZVNlc3Npb24gPSAkVHJ1ZQogICAgICAgICAgICAgICAgJFVzZURvbWFpblRydXN0c0xEQVAgPSAkVHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgICdEZWZhdWx0JyAgICAgICB7CiAgICAgICAgICAgICAgICAkVXNlR3JvdXAgPSAkVHJ1ZQogICAgICAgICAgICAgICAgJFVzZUxvY2FsR3JvdXAgPSAkVHJ1ZQogICAgICAgICAgICAgICAgJFVzZVNlc3Npb24gPSAkVHJ1ZQogICAgICAgICAgICAgICAgJFVzZUxvZ2dlZE9uID0gJFRydWUKICAgICAgICAgICAgICAgICRVc2VEb21haW5UcnVzdHMgPSAkVHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZigkRG9tYWluKSB7CiAgICAgICAgICAgICRUYXJnZXREb21haW5zID0gQCgkRG9tYWluKQogICAgICAgIH0KICAgICAgICBlbHNlaWYoJFNlYXJjaEZvcmVzdCkgewogICAgICAgICAgICAjIGdldCBBTEwgdGhlIGRvbWFpbnMgaW4gdGhlIGZvcmVzdCB0byBzZWFyY2gKICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBHZXQtTmV0Rm9yZXN0RG9tYWluIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5OYW1lIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICMgdXNlIHRoZSBsb2NhbCBkb21haW4KICAgICAgICAgICAgJFRhcmdldERvbWFpbnMgPSBAKCAoR2V0LU5ldERvbWFpbikubmFtZSApCiAgICAgICAgfQoKICAgICAgICBpZigkVXNlR3JvdXApIHsKICAgICAgICAgICAgRm9yRWFjaCAoJFRhcmdldERvbWFpbiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgIyBlbnVtZXJhdGUgYWxsIGdyb3VwcyBhbmQgYWxsIG1lbWJlcnMgb2YgZWFjaCBncm91cAogICAgICAgICAgICAgICAgR2V0LU5ldEdyb3VwIC1Eb21haW4gJFRhcmdldERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciB8IEdldC1OZXRHcm91cE1lbWJlciAtRG9tYWluICRUYXJnZXREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgICAgICAgICAjIGVudW1lcmF0ZSBhbGwgdXNlciBvYmplY3RzIHNvIHdlIGNhbiBleHRyYWN0IG91dCB0aGUgcHJpbWFyeSBncm91cCBmb3IgZWFjaAogICAgICAgICAgICAgICAgIyBHZXQtTmV0VXNlciAtRG9tYWluICREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgICAgICREb21haW5TSUQgPSBHZXQtRG9tYWluU0lEIC1Eb21haW4gJFRhcmdldERvbWFpbiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAgICAgJFVzZXJTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluICRUYXJnZXREb21haW4gLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgICAgICRVc2VyU2VhcmNoZXIuZmlsdGVyID0gJyhzYW1BY2NvdW50VHlwZT04MDUzMDYzNjgpJwogICAgICAgICAgICAgICAgJFVzZXJTZWFyY2hlci5Qcm9wZXJ0aWVzVG9Mb2FkLkFkZFJhbmdlKCgnc2FtYWNjb3VudG5hbWUnLCdwcmltYXJ5Z3JvdXBpZCcpKQogICAgICAgICAgICAgICAgJFByaW1hcnlHcm91cHMgPSBAe30KCiAgICAgICAgICAgICAgICBGb3JFYWNoKCRVc2VyUmVzdWx0IGluICRVc2VyU2VhcmNoZXIuRmluZEFsbCgpKSB7CiAgICAgICAgICAgICAgICAgICAgJFVzZXIgPSBDb252ZXJ0LUxEQVBQcm9wZXJ0eSAtUHJvcGVydGllcyAkVXNlclJlc3VsdC5Qcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgJFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVQcm9wZXJ0eSAnRG9tYWluJyAkVGFyZ2V0RG9tYWluCgogICAgICAgICAgICAgICAgICAgICRQcmltYXJ5R3JvdXBTSUQgPSAiJERvbWFpblNJRC0kKCRVc2VyLnByaW1hcnlncm91cGlkKSIKCiAgICAgICAgICAgICAgICAgICAgaWYoJFByaW1hcnlHcm91cHNbJFByaW1hcnlHcm91cFNJRF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFByaW1hcnlHcm91cE5hbWUgPSAkUHJpbWFyeUdyb3Vwc1skUHJpbWFyeUdyb3VwU0lEXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFByaW1hcnlHcm91cE5hbWUgPSBHZXQtQURPYmplY3QgLURvbWFpbiAkRG9tYWluIC1TSUQgJFByaW1hcnlHcm91cFNJRCB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IHNhbWFjY291bnRuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRQcmltYXJ5R3JvdXBzWyRQcmltYXJ5R3JvdXBTSURdID0gJFByaW1hcnlHcm91cE5hbWUKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRVc2VyIHwgQWRkLU1lbWJlciBOb3RlUHJvcGVydHkgJ1ByaW1hcnlHcm91cE5hbWUnICRQcmltYXJ5R3JvdXBOYW1lCiAgICAgICAgICAgICAgICAgICAgJFVzZXIuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LlVzZXInKQogICAgICAgICAgICAgICAgICAgICRVc2VyCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJFVzZXJTZWFyY2hlci5EaXNwb3NlKCkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYoJFVzZURvbWFpblRydXN0cykgewogICAgICAgICAgICBJbnZva2UtTWFwRG9tYWluVHJ1c3QKICAgICAgICB9CgogICAgICAgIGlmKCRVc2VEb21haW5UcnVzdHNMREFQKSB7CiAgICAgICAgICAgIEludm9rZS1NYXBEb21haW5UcnVzdCAtTERBUCAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlcgogICAgICAgIH0KCiAgICAgICAgaWYgKC1ub3QgJFNraXBDb21wdXRlckVudW1lcmF0aW9uKSB7CiAgICAgICAgICAgIGlmKC1ub3QgJENvbXB1dGVyTmFtZSkgewogICAgICAgICAgICAgICAgW0FycmF5XSRUYXJnZXRDb21wdXRlcnMgPSBAKCkKCiAgICAgICAgICAgICAgICBGb3JFYWNoICgkRG9tYWluMiBpbiAkVGFyZ2V0RG9tYWlucykgewogICAgICAgICAgICAgICAgICAgIGlmKCRDb2xsZWN0aW9uTWV0aG9kIC1lcSAnU3RlYWx0aCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiUXVlcnlpbmcgZG9tYWluICREb21haW4yIGZvciBGaWxlIFNlcnZlcnMuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgICRUYXJnZXRDb21wdXRlcnMgKz0gR2V0LU5ldEZpbGVTZXJ2ZXIgLURvbWFpbiAkRG9tYWluMiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlcgoKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiUXVlcnlpbmcgZG9tYWluICREb21haW4yIGZvciBERlMgU2VydmVycy4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgJFRhcmdldENvbXB1dGVycyArPSBHZXQtREZTc2hhcmUgLURvbWFpbiAkRG9tYWluMiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciB8IEZvckVhY2gtT2JqZWN0IHskXy5SZW1vdGVTZXJ2ZXJOYW1lfQoKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiUXVlcnlpbmcgZG9tYWluICREb21haW4yIGZvciBEb21haW4gQ29udHJvbGxlcnMuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgICRUYXJnZXRDb21wdXRlcnMgKz0gR2V0LU5ldERvbWFpbkNvbnRyb2xsZXIgLUxEQVAgLURvbWFpbiAkRG9tYWluMiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciB8IEZvckVhY2gtT2JqZWN0IHsgJF8uZG5zaG9zdG5hbWV9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJRdWVyeWluZyBkb21haW4gJERvbWFpbjIgZm9yIGhvc3RzIgoKICAgICAgICAgICAgICAgICAgICAgICAgJFRhcmdldENvbXB1dGVycyArPSBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiAkRG9tYWluMiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlcgogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYoJFVzZUdQT0dyb3VwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVudW1lcmF0aW5nIEdQTyBsb2NhbCBncm91cCBtZW1iZXJzaGlwcyBmb3IgZG9tYWluICREb21haW4yIgogICAgICAgICAgICAgICAgICAgICAgICBGaW5kLUdQT0xvY2F0aW9uIC1Eb21haW4gJERvbWFpbjIgLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIKCiAgICAgICAgICAgICAgICAgICAgICAgICMgYWRkIGluIGEgbG9jYWwgYWRtaW5pc3RyYXRvciByZWxhdGlvbnNoaXAgZm9yICJEb21haW4gQWRtaW5zIiAtPiBldmVyeSBtYWNoaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICREb21haW5TSUQgPSBHZXQtRG9tYWluU0lEIC1Eb21haW4gJERvbWFpbjIgLURvbWFpbkNvbnRyb2xsZXIgJERvbWFpbkNvbnRyb2xsZXIKICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpbkFkbWluc1NpZCA9ICIkRG9tYWluU0lELTUxMiIKICAgICAgICAgICAgICAgICAgICAgICAgJFRlbXAgPSBDb252ZXJ0LVNpZFRvTmFtZSAtU0lEICREb21haW5BZG1pbnNTaWQKICAgICAgICAgICAgICAgICAgICAgICAgJERvbWFpbkFkbWluc05hbWUgPSAkVGVtcC5TcGxpdCgnXCcpWzFdCgogICAgICAgICAgICAgICAgICAgICAgICBHZXQtTmV0Q29tcHV0ZXIgLURvbWFpbiAkRG9tYWluMiAtRG9tYWluQ29udHJvbGxlciAkRG9tYWluQ29udHJvbGxlciB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbFVzZXIgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWxVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlck5hbWUnICREb21haW5BZG1pbnNOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWxVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ01lbWJlckRvbWFpbicgJERvbWFpbjIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnSXNHcm91cCcgJFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkXwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsVXNlci5QU09iamVjdC5UeXBlTmFtZXMuQWRkKCdQb3dlclZpZXcuTG9jYWxVc2VyU3BlY2lmaWVkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbFVzZXIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIHJlbW92ZSBhbnkgbnVsbCB0YXJnZXQgaG9zdHMsIHVuaXF1aWZ5IHRoZSBsaXN0IGFuZCBzaHVmZmxlIGl0CiAgICAgICAgICAgICAgICAkVGFyZ2V0Q29tcHV0ZXJzID0gJFRhcmdldENvbXB1dGVycyB8IFdoZXJlLU9iamVjdCB7ICRfIH0gfCBTb3J0LU9iamVjdCAtVW5pcXVlIHwgU29ydC1PYmplY3QgeyBHZXQtUmFuZG9tIH0KICAgICAgICAgICAgICAgIGlmKCQoJFRhcmdldENvbXB1dGVycy5Db3VudCkgLWVxIDApIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJObyBob3N0cyBmb3VuZCEiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkVGFyZ2V0Q29tcHV0ZXJzID0gJENvbXB1dGVyTmFtZQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGdldCB0aGUgY3VycmVudCB1c2VyIHNvIHdlIGNhbiBpZ25vcmUgaXQgaW4gdGhlIHJlc3VsdHMKICAgICAgICAkQ3VycmVudFVzZXIgPSAoW0Vudmlyb25tZW50XTo6VXNlck5hbWUpLnRvTG93ZXIoKQoKICAgICAgICAjIHNjcmlwdCBibG9jayB0aGF0IGVudW1lcmF0ZXMgYSBzZXJ2ZXIKICAgICAgICAkSG9zdEVudW1CbG9jayA9IHsKICAgICAgICAgICAgcGFyYW0oJENvbXB1dGVyTmFtZSwgJFBpbmcsICRDdXJyZW50VXNlcjIsICRVc2VMb2NhbEdyb3VwMiwgJFVzZVNlc3Npb24yLCAkVXNlTG9nZ2Vkb24yKQoKICAgICAgICAgICAgJFVwID0gJFRydWUKICAgICAgICAgICAgaWYoJFBpbmcpIHsKICAgICAgICAgICAgICAgICRVcCA9IFRlc3QtQ29ubmVjdGlvbiAtQ291bnQgMSAtUXVpZXQgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJFVwKSB7CgogICAgICAgICAgICAgICAgaWYoJFVzZUxvY2FsR3JvdXAyKSB7CiAgICAgICAgICAgICAgICAgICAgIyBncmFiIHRoZSB1c2VycyBmb3IgdGhlIGxvY2FsIGFkbWlucyBvbiB0aGlzIHNlcnZlcgogICAgICAgICAgICAgICAgICAgIEdldC1OZXRMb2NhbEdyb3VwIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSAtQVBJIHwgV2hlcmUtT2JqZWN0IHskXy5Jc0RvbWFpbn0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkSVBBZGRyZXNzID0gQChHZXQtSVBBZGRyZXNzIC1Db21wdXRlck5hbWUgJENvbXB1dGVyTmFtZSlbMF0uSVBBZGRyZXNzCgogICAgICAgICAgICAgICAgaWYoJFVzZVNlc3Npb24yKSB7CiAgICAgICAgICAgICAgICAgICAgJFNlc3Npb25zID0gR2V0LU5ldFNlc3Npb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgRm9yRWFjaCAoJFNlc3Npb24gaW4gJFNlc3Npb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyTmFtZSA9ICRTZXNzaW9uLnNlc2kxMF91c2VybmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkQ05hbWUgPSAkU2Vzc2lvbi5zZXNpMTBfY25hbWUKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRDTmFtZSAtYW5kICRDTmFtZS5TdGFydHNXaXRoKCJcXCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQ05hbWUgPSAkQ05hbWUuVHJpbVN0YXJ0KCJcIikKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgIyBtYWtlIHN1cmUgd2UgaGF2ZSBhIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCRVc2VyTmFtZSkgLWFuZCAoJFVzZXJOYW1lLnRyaW0oKSAtbmUgJycpIC1hbmQgKCRVc2VyTmFtZSAtbm90bWF0Y2ggJ1wkJykgLWFuZCAoJFVzZXJOYW1lIC1ub3RtYXRjaCAkQ3VycmVudFVzZXIyKSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgPSBOZXctT2JqZWN0IFBTT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJEb21haW4nICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJOYW1lJyAkVXNlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnQ29tcHV0ZXJOYW1lJyAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lQQWRkcmVzcycgJElQQWRkcmVzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTZXNzaW9uRnJvbScgJENOYW1lCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUcnkgdG8gcmVzb2x2ZSB0aGUgRE5TIGhvc3RuYW1lIG9mICRDbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQ05hbWVETlNOYW1lID0gW1N5c3RlbS5OZXQuRG5zXTo6R2V0SG9zdEVudHJ5KCRDTmFtZSkgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBIb3N0TmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDTmFtZUROU05hbWUgPSAkQ05hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVQcm9wZXJ0eSAnU2Vzc2lvbkZyb21OYW1lJyAkQ05hbWVETlNOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0xvY2FsQWRtaW4nICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyLlBTT2JqZWN0LlR5cGVOYW1lcy5BZGQoJ1Bvd2VyVmlldy5Vc2VyU2Vzc2lvbicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoJFVzZUxvZ2dlZG9uMikgewogICAgICAgICAgICAgICAgICAgICRMb2dnZWRPbiA9IEdldC1OZXRMb2dnZWRvbiAtQ29tcHV0ZXJOYW1lICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgICAgICBGb3JFYWNoICgkVXNlciBpbiAkTG9nZ2VkT24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJOYW1lID0gJFVzZXIud2t1aTFfdXNlcm5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJEb21haW4gPSAkVXNlci53a3VpMV9sb2dvbl9kb21haW4KCiAgICAgICAgICAgICAgICAgICAgICAgICMgaWdub3JlIGxvY2FsIGFjY291bnQgbG9nb25zCiAgICAgICAgICAgICAgICAgICAgICAgICMgICBUT0RPOiBiZXR0ZXIgd2F5IHRvIGRldGVybWluZSBpZiBuZXR3b3JrIGxvZ29uIG9yIG5vdAogICAgICAgICAgICAgICAgICAgICAgICBpZigkQ29tcHV0ZXJOYW1lIC1ub3RtYXRjaCAiXiRVc2VyRG9tYWluIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCgkVXNlck5hbWUpIC1hbmQgKCRVc2VyTmFtZS50cmltKCkgLW5lICcnKSAtYW5kICgkVXNlck5hbWUgLW5vdG1hdGNoICdcJCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciA9IE5ldy1PYmplY3QgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1VzZXJEb21haW4nICRVc2VyRG9tYWluCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyTmFtZScgJFVzZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdDb21wdXRlck5hbWUnICRDb21wdXRlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0lQQWRkcmVzcycgJElQQWRkcmVzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU2Vzc2lvbkZyb20nICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTZXNzaW9uRnJvbU5hbWUnICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdMb2NhbEFkbWluJyAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LlVzZXJTZXNzaW9uJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRMb2NhbExvZ2dlZE9uID0gR2V0LUxvZ2dlZE9uTG9jYWwgLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgRm9yRWFjaCAoJFVzZXIgaW4gJExvY2FsTG9nZ2VkT24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJOYW1lID0gJFVzZXIuVXNlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJEb21haW4gPSAkVXNlci5Vc2VyRG9tYWluCgogICAgICAgICAgICAgICAgICAgICAgICAjIGlnbm9yZSBsb2NhbCBhY2NvdW50IGxvZ29ucyA/CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRDb21wdXRlck5hbWUgLW5vdG1hdGNoICJeJFVzZXJEb21haW4iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyID0gTmV3LU9iamVjdCBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyRG9tYWluJyAkVXNlckRvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdVc2VyTmFtZScgJFVzZXJOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0NvbXB1dGVyTmFtZScgJENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZvdW5kVXNlciB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdJUEFkZHJlc3MnICRJUEFkZHJlc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU2Vzc2lvbkZyb20nICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRm91bmRVc2VyIHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1Nlc3Npb25Gcm9tTmFtZScgJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnTG9jYWxBZG1pbicgJE51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIuUFNPYmplY3QuVHlwZU5hbWVzLkFkZCgnUG93ZXJWaWV3LlVzZXJTZXNzaW9uJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGb3VuZFVzZXIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcm9jZXNzIHsKICAgICAgICBpZiAoLW5vdCAkU2tpcENvbXB1dGVyRW51bWVyYXRpb24pIHsKICAgICAgICAgICAgaWYoJFRocmVhZHMpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlVzaW5nIHRocmVhZGluZyB3aXRoIHRocmVhZHMgPSAkVGhyZWFkcyIKCiAgICAgICAgICAgICAgICAjIGlmIHdlJ3JlIHVzaW5nIHRocmVhZGluZywga2ljayBvZmYgdGhlIHNjcmlwdCBibG9jayB3aXRoIEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uCiAgICAgICAgICAgICAgICAkU2NyaXB0UGFyYW1zID0gQHsKICAgICAgICAgICAgICAgICAgICAnUGluZycgPSAkVHJ1ZQogICAgICAgICAgICAgICAgICAgICdDdXJyZW50VXNlcjInID0gJEN1cnJlbnRVc2VyCiAgICAgICAgICAgICAgICAgICAgJ1VzZUxvY2FsR3JvdXAyJyA9ICRVc2VMb2NhbEdyb3VwCiAgICAgICAgICAgICAgICAgICAgJ1VzZVNlc3Npb24yJyA9ICRVc2VTZXNzaW9uCiAgICAgICAgICAgICAgICAgICAgJ1VzZUxvZ2dlZG9uMicgPSAkVXNlTG9nZ2Vkb24KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBJbnZva2UtVGhyZWFkZWRGdW5jdGlvbiAtQ29tcHV0ZXJOYW1lICRUYXJnZXRDb21wdXRlcnMgLVNjcmlwdEJsb2NrICRIb3N0RW51bUJsb2NrIC1TY3JpcHRQYXJhbWV0ZXJzICRTY3JpcHRQYXJhbXMgLVRocmVhZHMgJFRocmVhZHMKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZigkVGFyZ2V0Q29tcHV0ZXJzLkNvdW50IC1uZSAxKSB7CiAgICAgICAgICAgICAgICAgICAgIyBwaW5nIGFsbCBob3N0cyBpbiBwYXJhbGxlbAogICAgICAgICAgICAgICAgICAgICRQaW5nID0ge3BhcmFtKCRDb21wdXRlck5hbWUyKSBpZihUZXN0LUNvbm5lY3Rpb24gLUNvbXB1dGVyTmFtZSAkQ29tcHV0ZXJOYW1lMiAtQ291bnQgMSAtUXVpZXQgLUVycm9yQWN0aW9uIFN0b3ApIHsgJENvbXB1dGVyTmFtZTIgfX0KICAgICAgICAgICAgICAgICAgICAkVGFyZ2V0Q29tcHV0ZXJzMiA9IEludm9rZS1UaHJlYWRlZEZ1bmN0aW9uIC1Ob0ltcG9ydHMgLUNvbXB1dGVyTmFtZSAkVGFyZ2V0Q29tcHV0ZXJzIC1TY3JpcHRCbG9jayAkUGluZyAtVGhyZWFkcyAxMDAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRUYXJnZXRDb21wdXRlcnMyID0gJFRhcmdldENvbXB1dGVycwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlsqXSBUb3RhbCBudW1iZXIgb2YgYWN0aXZlIGhvc3RzOiAkKCRUYXJnZXRDb21wdXRlcnMyLmNvdW50KSIKICAgICAgICAgICAgICAgICRDb3VudGVyID0gMAoKICAgICAgICAgICAgICAgICRUYXJnZXRDb21wdXRlcnMyIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICRDb3VudGVyID0gJENvdW50ZXIgKyAxCiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiWypdIEVudW1lcmF0aW5nIHNlcnZlciAkKCRfKSAoJENvdW50ZXIgb2YgJCgkVGFyZ2V0Q29tcHV0ZXJzMi5jb3VudCkpIgogICAgICAgICAgICAgICAgICAgIEludm9rZS1Db21tYW5kIC1TY3JpcHRCbG9jayAkSG9zdEVudW1CbG9jayAtQXJndW1lbnRMaXN0IEAoJF8sICRGYWxzZSwgJEN1cnJlbnRVc2VyLCAkVXNlTG9jYWxHcm91cCwgJFVzZVNlc3Npb24sICRVc2VMb2dnZWRvbikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCmZ1bmN0aW9uIEdldC1HbG9iYWxDYXRhbG9nVXNlck1hcHBpbmcgewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFJldHVybnMgYSBoYXNodGFibGUgZm9yIGFsbCB1c2VycyBpbiB0aGUgZ2xvYmFsIGNhdGFsb2csIGZvcm1hdCBvZiB7dXNlcm5hbWUtPmRvbWFpbn0uCiAgICAgICAgVGhpcyBpcyB1c2VkIGZvciB1c2VyIHNlc3Npb24gZGVjb25mbGljdGlvbiBpbiB0aGUgRXhwb3J0LUJsb29kSG91bmQqIGZ1bmN0aW9ucyBmb3IKICAgICAgICB3aGVuIGEgdXNlciBzZXNzaW9uIGRvZXNuJ3QgaGF2ZSBhIGxvZ2luIGRvbWFpbi4KCiAgICAuUEFSQU1FVEVSIEdsb2JhbENhdGFsb2cKCiAgICAgICAgVGhlIGdsb2JhbCBjYXRhbG9nIGxvY2F0aW9uIHRvIHJlc29sZSB1c2VyIG1lbWJlcnNoaXBzIGZyb20sIGZvcm0gb2YgR0M6Ly9nbG9iYWwuY2F0YWxvZy4KIz4KICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbVmFsaWRhdGVQYXR0ZXJuKCdeR0M6Ly8nKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRHbG9iYWxDYXRhbG9nCiAgICApCgogICAgaWYoLW5vdCAkUFNCb3VuZFBhcmFtZXRlcnNbJ0dsb2JhbENhdGFsb2cnXSkgewogICAgICAgICRHQ1BhdGggPSAoW0FEU0ldJ0xEQVA6Ly9Sb290RFNFJykuZG5zaG9zdG5hbWUKICAgICAgICAkQURTUGF0aCA9ICJHQzovLyRHQ1BhdGgiCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiRW51bWVyYXRlZCBnbG9iYWwgY2F0YWxvZyBsb2NhdGlvbjogJEFEU1BhdGgiCiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkQURTcGF0aCA9ICRHbG9iYWxDYXRhbG9nCiAgICB9CgogICAgJFVzZXJEb21haW5NYXBwaW5ncyA9IEB7fQoKICAgICRVc2VyU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgLUFEU3BhdGggJEFEU3BhdGgKICAgICRVc2VyU2VhcmNoZXIuZmlsdGVyID0gJyhzYW1BY2NvdW50VHlwZT04MDUzMDYzNjgpJwogICAgJFVzZXJTZWFyY2hlci5Qcm9wZXJ0aWVzVG9Mb2FkLkFkZFJhbmdlKCgnc2FtYWNjb3VudG5hbWUnLCdkaXN0aW5ndWlzaGVkbmFtZScsICdjbicsICdvYmplY3RzaWQnKSkKCiAgICBGb3JFYWNoKCRVc2VyIGluICRVc2VyU2VhcmNoZXIuRmluZEFsbCgpKSB7CiAgICAgICAgJFVzZXJOYW1lID0gJFVzZXIuUHJvcGVydGllc1snc2FtYWNjb3VudG5hbWUnXVswXS5Ub1VwcGVyKCkKICAgICAgICAkVXNlckROID0gJFVzZXIuUHJvcGVydGllc1snZGlzdGluZ3Vpc2hlZG5hbWUnXVswXQoKICAgICAgICBpZigkVXNlckROIC1hbmQgKCRVc2VyRE4gLW5lICcnKSkgewogICAgICAgICAgICBpZiAoKCRVc2VyRE4gLW1hdGNoICdGb3JlaWduU2VjdXJpdHlQcmluY2lwYWxzJykgLWFuZCAoJFVzZXJETiAtbWF0Y2ggJ1MtMS01LTIxJykpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaWYoLW5vdCAkTWVtYmVyU0lEKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJTSUQgPSAkVXNlci5Qcm9wZXJ0aWVzWydjbiddWzBdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRVc2VyU2lkID0gKE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXIoJFVzZXIuUHJvcGVydGllc1snb2JqZWN0c2lkJ11bMF0sMCkpLlZhbHVlCiAgICAgICAgICAgICAgICAgICAgJE1lbWJlclNpbXBsZU5hbWUgPSBDb252ZXJ0LVNpZFRvTmFtZSAtU0lEICRVc2VyU2lkIHwgQ29udmVydC1BRE5hbWUgLUlucHV0VHlwZSAnTlQ0JyAtT3V0cHV0VHlwZSAnQ2Fub25pY2FsJwogICAgICAgICAgICAgICAgICAgIGlmKCRNZW1iZXJTaW1wbGVOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyRG9tYWluID0gJE1lbWJlclNpbXBsZU5hbWUuU3BsaXQoJy8nKVswXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgY29udmVydGluZyAkVXNlckROIgogICAgICAgICAgICAgICAgICAgICAgICAkVXNlckRvbWFpbiA9ICROdWxsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIGNvbnZlcnRpbmcgJFVzZXJETiIKICAgICAgICAgICAgICAgICAgICAkVXNlckRvbWFpbiA9ICROdWxsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAjIGV4dHJhY3QgdGhlIEZRRE4gZnJvbSB0aGUgRGlzdGluZ3Vpc2hlZCBOYW1lCiAgICAgICAgICAgICAgICAkVXNlckRvbWFpbiA9ICgkVXNlckROLnN1YlN0cmluZygkVXNlckROLkluZGV4T2YoJ0RDPScpKSAtcmVwbGFjZSAnREM9JywnJyAtcmVwbGFjZSAnLCcsJy4nKS5Ub1VwcGVyKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkVXNlckRvbWFpbikgewogICAgICAgICAgICAgICAgaWYoLW5vdCAkVXNlckRvbWFpbk1hcHBpbmdzWyRVc2VyTmFtZV0pIHsKICAgICAgICAgICAgICAgICAgICAkVXNlckRvbWFpbk1hcHBpbmdzWyRVc2VyTmFtZV0gPSBAKCRVc2VyRG9tYWluKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmKCRVc2VyRG9tYWluTWFwcGluZ3NbJFVzZXJOYW1lXSAtbm90Y29udGFpbnMgJFVzZXJEb21haW4pIHsKICAgICAgICAgICAgICAgICAgICAkVXNlckRvbWFpbk1hcHBpbmdzWyRVc2VyTmFtZV0gKz0gJFVzZXJEb21haW4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAkVXNlclNlYXJjaGVyLmRpc3Bvc2UoKQogICAgJFVzZXJEb21haW5NYXBwaW5ncwp9CgoKZnVuY3Rpb24gRXhwb3J0LUJsb29kSG91bmREYXRhIHsKPCMKICAgIC5TWU5PUFNJUwoKICAgICAgICBUYWtlcyBjdXN0b20gb2JqZWN0cyBmcm9tIEdldC1CbG9vZEhvdW5kIGRhdGEgYW5kIGV4cG9ydHMgZXZlcnl0aGluZyB0byBhIEJsb29kSG91bmQKICAgICAgICBuZW80aiBSRVNUZnVsIEFQSSBiYXRjaCBpbmdlc3Rpb24gaW50ZXJmYWNlLgoKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAgICAgUmVxdWlyZWQgRGVwZW5kZW5jaWVzOiBQb3dlclZpZXcucHMxCiAgICAgICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBOb25lCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFRoaXMgZnVuY3Rpb24gdGFrZXMgY3VzdG9tIHRhZ2dlZCBQb3dlclZpZXcgb2JqZWN0cyB0eXBlcyBmcm9tIEdldC1CbG9vZEhvdW5kRGF0YSBhbmQgcGFja2FnZXMvaW5nZXN0cwogICAgICAgIHRoZW0gaW50byBhIG5lbzRqIFJFU1RmdWwgQVBJIGJhdGNoIGluZ2VzdGlvbiBpbnRlcmZhY2UuIEZvciB1c2VyIHNlc3Npb24gZGF0YSB3aXRob3V0IGEgbG9nb24KICAgICAgICBkb21haW4sIGJ5IGRlZmF1bHQgdGhlIGdsb2JhbCBjYXRhbG9nIGlzIHVzZWQgdG8gYXR0ZW1wdCB0byBkZWNvbmZsaWN0IHdoYXQgZG9tYWluIHRoZSB1c2VyIG1heSBiZQogICAgICAgIGxvY2F0ZWQgaW4uIElmIHRoZSB1c2VyIGV4aXN0cyBpbiBtb3JlIHRoYW4gb25lIGRvbWFpbiBpbiB0aGUgZm9yZXN0LCBhIHNlcmllcyBvZiB3ZWlnaHRzIGlzIHVzZWQgdG8KICAgICAgICBtb2RpZnkgdGhlIGF0dGFjayBwYXRoIGxpa2VsaWhvb2QuCgogICAgICAgIEN5cGhlciBxdWVyaWVzIGFyZSBidWlsdCBmb3IgZWFjaCBhcHByb3ByaWF0ZSByZWxhdGlvbnNoaXAgdG8gaW5nZXN0LCBhbmQgdGhlIHNldCBvZiBxdWVyaWVzIGlzICdiYXRjaGVkJwogICAgICAgIHNvICctVGhyb3R0bGUgWCcgcXVlcmllcyBhcmUgc2VudCBhdCBhIHRpbWUgaW4gZWFjaCBiYXRjaCByZXF1ZXN0LiBBbGwgb2YgdGhlIEN5cGhlciBxdWVyaWVzIGFyZQogICAgICAgIGpzb25pZmllZCB1c2luZyBTeXN0ZW0uV2ViLlNjcmlwdC5TZXJpYWxpemF0aW9uLmphdmFzY3JpcHRTZXJpYWxpemVyLgoKICAgIC5QQVJBTUVURVIgT2JqZWN0CgogICAgICAgIFRoZSBQb3dlclZpZXcgUFNPYmplY3QgdG8gZXhwb3J0IHRvIHRoZSBSRVNUZnVsIEFQSSBpbnRlcmZhY2UuCgogICAgLlBBUkFNRVRFUiBVUkkKCiAgICAgICAgVGhlIEJsb29kSG91bmQgbmVvNGogVVJMIGxvY2F0aW9uIChodHRwOi8vaG9zdDpwb3J0LykuCgogICAgLlBBUkFNRVRFUiBVc2VyUGFzcwoKICAgICAgICBUaGUgInVzZXI6cGFzc3dvcmQiIGZvciB0aGUgQmxvb2RIb3VuZCBuZW80aiBpbnN0YW5jZS4KCiAgICAuUEFSQU1FVEVSIFNraXBHQ0RlY29uZmxpY3Rpb24KCiAgICAgICAgU3dpdGNoLiBEb24ndCByZXNvbHZlIHVzZXIgZG9tYWluIG1lbWJlcnNoaXBzIGZvciBzZXNzaW9uIGluZm9ybWF0aW9uIHVzaW5nIGEgZ2xvYmFsIGNhdGFsb2cuCgogICAgLlBBUkFNRVRFUiBHbG9iYWxDYXRhbG9nCgogICAgICAgIFRoZSBnbG9iYWwgY2F0YWxvZyBsb2NhdGlvbiB0byByZXNvbGUgdXNlciBtZW1iZXJzaGlwcyBmcm9tLCBmb3JtIG9mIEdDOi8vZ2xvYmFsLmNhdGFsb2cuCgogICAgLlBBUkFNRVRFUiBDcmVkZW50aWFsCgogICAgICAgIEEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCB0aGF0IHN0b3JlcyBhIEJsb29kSG91bmQgdXNlcm5hbWUKICAgICAgICBhbmQgcGFzc3dvcmQgZm9yIHRoZSBuZW80aiBjb25uZWN0aW9uLgoKICAgIC5QQVJBTUVURVIgVGhyb3R0bGUKCiAgICAgICAgVGhlIG51bWJlciBvZiBvYmplY3QgaW5zZXJ0aW9uIHF1ZXJpZXMgdG8gcnVuIGluIGVhY2ggYmF0Y2gsIGRlZmF1bHRzIHRvIDEwMC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1CbG9vZEhvdW5kRGF0YSB8IEV4cG9ydC1CbG9vZEhvdW5kRGF0YSAtVVJJIGh0dHA6Ly9TRVJWRVI6NzQ3NC8gLVVzZXJQYXNzICJ1c2VyOnBhc3MiCgogICAgICAgIEV4ZWN1dGVzIGRlZmF1bHQgY29sbGVjdGlvbiBvcHRpb25zIGFuZCBleHBvcnRzIHRoZSBkYXRhIHRvIGEgQmxvb2RIb3VuZCBuZW80aiBSRVNUZnVsIEFQSSBlbmRwb2ludC4KCiAgICAuRVhBTVBMRQoKICAgICAgICBQUyBDOlw+IEdldC1CbG9vZEhvdW5kRGF0YSB8IEV4cG9ydC1CbG9vZEhvdW5kRGF0YSAtVVJJIGh0dHA6Ly9TRVJWRVI6NzQ3NC8gLVVzZXJQYXNzICJ1c2VyOnBhc3MiIC1Ta2lwR0NEZWNvbmZsaWN0aW9uCgogICAgICAgIEV4ZWN1dGVzIGRlZmF1bHQgY29sbGVjdGlvbiBvcHRpb25zIGFuZCBleHBvcnRzIHRoZSBkYXRhIHRvIGEgQmxvb2RIb3VuZCBuZW80aiBSRVNUZnVsIEFQSSBlbmRwb2ludCwKICAgICAgICBhbmQgc2tpcCB0aGUgZ2xvYmFsIGNhdGFsb2cgZGVjb25mbGljdGlvbiBwcm9jZXNzLgoKICAgIC5MSU5LCgogICAgICAgIGh0dHA6Ly9uZW80ai5jb20vZG9jcy9zdGFibGUvcmVzdC1hcGktYmF0Y2gtb3BzLmh0bWwKICAgICAgICBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE5ODM5NDY5L29wdGltaXppbmctaGlnaC12b2x1bWUtYmF0Y2gtaW5zZXJ0cy1pbnRvLW5lbzRqLXVzaW5nLXJlc3QKCiM+CiAgICBbQ21kbGV0QmluZGluZyhEZWZhdWx0UGFyYW1ldGVyU2V0TmFtZSA9ICdQbGFpbnRleHRQVycpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSwgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtQU09iamVjdF0KICAgICAgICAkT2JqZWN0LAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTEsIE1hbmRhdG9yeSA9ICRUcnVlKV0KICAgICAgICBbVVJJXQogICAgICAgICRVUkksCgogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MiwgTWFuZGF0b3J5ID0gJFRydWUsIFBhcmFtZXRlclNldE5hbWUgPSAnUGxhaW50ZXh0UFcnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZVBhdHRlcm4oJy4qOi4qJyldCiAgICAgICAgJFVzZXJQYXNzLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTIsIE1hbmRhdG9yeSA9ICRUcnVlLCBQYXJhbWV0ZXJTZXROYW1lID0gJ1BTQ3JlZGVudGlhbCcpXQogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTa2lwR0NEZWNvbmZsaWN0aW9uLAoKICAgICAgICBbVmFsaWRhdGVQYXR0ZXJuKCdeR0M6Ly8nKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRHbG9iYWxDYXRhbG9nLAoKICAgICAgICBbSW50XQogICAgICAgICRUaHJvdHRsZSA9IDEwMDAKICAgICkKCiAgICBiZWdpbiB7CiAgICAgICAgJFdlYkNsaWVudCA9IE5ldy1PYmplY3QgU3lzdGVtLk5ldC5XZWJDbGllbnQKCiAgICAgICAgaWYoJFBTQm91bmRQYXJhbWV0ZXJzWydDcmVkZW50aWFsJ10pIHsKICAgICAgICAgICAgJEJsb29kSG91bmRVc2VyTmFtZSA9ICRDcmVkZW50aWFsLlVzZXJOYW1lCiAgICAgICAgICAgICRCbG9vZEhvdW5kUGFzc3dvcmQgPSAkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLlBhc3N3b3JkCiAgICAgICAgICAgICRCYXNlNjRVc2VyUGFzcyA9IFtTeXN0ZW0uQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OlVURjguR2V0Qnl0ZXMoJEJsb29kSG91bmRVc2VyTmFtZSArICc6JyArICRCbG9vZEhvdW5kUGFzc3dvcmQpKQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJEJhc2U2NFVzZXJQYXNzID0gW1N5c3RlbS5Db252ZXJ0XTo6VG9CYXNlNjRTdHJpbmcoW1N5c3RlbS5UZXh0LkVuY29kaW5nXTo6VVRGOC5HZXRCeXRlcygkVXNlclBhc3MpKQogICAgICAgIH0KCiAgICAgICAgIyBhZGQgdGhlIGF1dGggaGVhZGVycwogICAgICAgICRXZWJDbGllbnQuSGVhZGVycy5BZGQoJ0FjY2VwdCcsJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9VVRGLTgnKQogICAgICAgICRXZWJDbGllbnQuSGVhZGVycy5BZGQoJ0F1dGhvcml6YXRpb24nLCJCYXNpYyAkQmFzZTY0VXNlclBhc3MiKQoKICAgICAgICAjIGNoZWNrIGF1dGggdG8gdGhlIEJsb29kSG91bmQgbmVvNGogc2VydmVyCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJE51bGwgPSAkV2ViQ2xpZW50LkRvd25sb2FkU3RyaW5nKCRVUkkuQWJzb2x1dGVVcmkgKyAndXNlci9uZW80aicpCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkNvbm5lY3Rpb24gZXN0YWJsaXNoZWQgd2l0aCBuZW80aiBpbmdlc3Rpb24gaW50ZXJmYWNlIGF0ICQoJFVSSS5BYnNvbHV0ZVVyaSkiCiAgICAgICAgICAgICRBdXRob3JpemVkID0gJFRydWUKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAkQXV0aG9yaXplZCA9ICRGYWxzZQogICAgICAgICAgICB0aHJvdyAiRXJyb3IgY29ubmVjdGluZyB0byBOZW80aiByZXN0IFJFU1Qgc2VydmVyIGF0ICckKCRVUkkuQWJzb2x1dGVVcmkpJyIKICAgICAgICB9CgogICAgICAgIEFkZC1UeXBlIC1Bc3NlbWJseSBTeXN0ZW0uV2ViLkV4dGVuc2lvbnMKCiAgICAgICAgIyBmcm9tIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjgwNzc4NTQvcG93ZXJzaGVsbC0yLTAtY29udmVydGZyb20tanNvbi1hbmQtY29udmVydHRvLWpzb24taW1wbGVtZW50YXRpb24KICAgICAgICBmdW5jdGlvbiBDb252ZXJ0VG8tSnNvbjIwKFtvYmplY3RdICRJdGVtKXsKICAgICAgICAgICAgJHBzX2pzID0gTmV3LU9iamVjdCBTeXN0ZW0uV2ViLlNjcmlwdC5TZXJpYWxpemF0aW9uLmphdmFzY3JpcHRTZXJpYWxpemVyCiAgICAgICAgICAgIHJldHVybiAkcHNfanMuU2VyaWFsaXplKCRpdGVtKQogICAgICAgIH0KCiAgICAgICAgJEF1dGhvcml6ZWQgPSAkVHJ1ZQogICAgICAgICRTdGF0ZW1lbnRzID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0CgogICAgICAgICRVc2VyRG9tYWluTWFwcGluZ3MgPSBAe30KICAgICAgICBpZigtbm90ICRTa2lwR0NEZWNvbmZsaWN0aW9uKSB7CiAgICAgICAgICAgICMgaWYgd2UncmUgZG9pbmcgc2Vzc2lvbiBlbnVtZXJhdGlvbiwgY3JlYXRlIGEge3VzZXIgOiBAKGRvbWFpbiwuLil9IGZyb20gYSBnbG9iYWwgY2F0YWxvZwogICAgICAgICAgICAjICAgaW4gb3JkZXIgdG8gZG8gdXNlciBkb21haW4gZGVjb25mbGljdGlvbiBmb3Igc2Vzc2lvbnMKCiAgICAgICAgICAgIGlmKC1ub3QgJFBTQm91bmRQYXJhbWV0ZXJzWydHbG9iYWxDYXRhbG9nJ10pIHsKICAgICAgICAgICAgICAgICRVc2VyRG9tYWluTWFwcGluZ3MgPSBHZXQtR2xvYmFsQ2F0YWxvZ1VzZXJNYXBwaW5nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkVXNlckRvbWFpbk1hcHBpbmdzID0gR2V0LUdsb2JhbENhdGFsb2dVc2VyTWFwcGluZyAtR2xvYmFsQ2F0YWxvZyAkR2xvYmFsQ2F0YWxvZwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByb2Nlc3MgewogICAgICAgIGlmKCRBdXRob3JpemVkKSB7CgogICAgICAgICAgICAkUXVlcmllcyA9IEAoKQoKICAgICAgICAgICAgaWYoJE9iamVjdC5QU09iamVjdC5UeXBlTmFtZXMgLWNvbnRhaW5zICdQb3dlclZpZXcuVXNlclNlc3Npb24nKSB7CiAgICAgICAgICAgICAgICBpZigkT2JqZWN0LlNlc3Npb25Gcm9tTmFtZSkgewogICAgICAgICAgICAgICAgICAgICMgaW1wbHlpbmcgYSByZXN1bHQgZnJvbSBHZXQtTmV0U2Vzc2lvbgogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyTmFtZSA9ICRPYmplY3QuVXNlck5hbWUuVG9VcHBlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICRTZXNzaW9uRnJvbU5hbWUgPSAkT2JqZWN0LlNlc3Npb25Gcm9tTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkQ29tcHV0ZXJEb21haW4gPSAkT2JqZWN0LlNlc3Npb25Gcm9tTmFtZS5TdWJTdHJpbmcoJE9iamVjdC5TZXNzaW9uRnJvbU5hbWUuSW5kZXhPZignLicpKzEpLlRvVXBwZXIoKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJFVzZXJEb21haW5NYXBwaW5ncykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJEb21haW4gPSAkTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJFVzZXJEb21haW5NYXBwaW5nc1skVXNlck5hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJFVzZXJEb21haW5NYXBwaW5nc1skVXNlck5hbWVdLkNvdW50IC1lcSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyRG9tYWluID0gJFVzZXJEb21haW5NYXBwaW5nc1skVXNlck5hbWVdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2dnZWRPblVzZXIgPSAiJFVzZXJOYW1lQCRVc2VyRG9tYWluIgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFF1ZXJpZXMgKz0gIk1FUkdFICh1c2VyOlVzZXIgeyBuYW1lOiBVUFBFUignJExvZ2dlZE9uVXNlcicpIH0pIE1FUkdFIChjb21wdXRlcjpDb21wdXRlciB7IG5hbWU6IFVQUEVSKCckU2Vzc2lvbkZyb21OYW1lJykgfSkgTUVSR0UgKGNvbXB1dGVyKS1bOkhhc1Nlc3Npb24ge1dlaWdodDogJzEnfV0tPih1c2VyKSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyRG9tYWluTWFwcGluZ3NbJFVzZXJOYW1lXSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRfIC1lcSAkQ29tcHV0ZXJEb21haW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVXNlckRvbWFpbiA9ICRfCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJExvZ2dlZE9uVXNlciA9ICIkVXNlck5hbWVAJFVzZXJEb21haW4iCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRRdWVyaWVzICs9ICJNRVJHRSAodXNlcjpVc2VyIHsgbmFtZTogVVBQRVIoJyRMb2dnZWRPblVzZXInKSB9KSBNRVJHRSAoY29tcHV0ZXI6Q29tcHV0ZXIgeyBuYW1lOiBVUFBFUignJFNlc3Npb25Gcm9tTmFtZScpIH0pIE1FUkdFIChjb21wdXRlciktWzpIYXNTZXNzaW9uIHtXZWlnaHQ6ICcxJ31dLT4odXNlcikiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVXNlckRvbWFpbiA9ICRfCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJExvZ2dlZE9uVXNlciA9ICIkVXNlck5hbWVAJFVzZXJEb21haW4iCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRRdWVyaWVzICs9ICJNRVJHRSAodXNlcjpVc2VyIHsgbmFtZTogVVBQRVIoJyRMb2dnZWRPblVzZXInKSB9KSBNRVJHRSAoY29tcHV0ZXI6Q29tcHV0ZXIgeyBuYW1lOiBVUFBFUignJFNlc3Npb25Gcm9tTmFtZScpIH0pIE1FUkdFIChjb21wdXRlciktWzpIYXNTZXNzaW9uIHtXZWlnaHQ6ICcyJ31dLT4odXNlcikiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIG5vIHVzZXIgb2JqZWN0IGluIHRoZSBHQyB3aXRoIHRoaXMgdXNlcm5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTG9nZ2VkT25Vc2VyID0gIiRVc2VyTmFtZUBVTktOT1dOIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRRdWVyaWVzICs9ICJNRVJHRSAodXNlcjpVc2VyIHsgbmFtZTogVVBQRVIoJyRMb2dnZWRPblVzZXInKSB9KSBNRVJHRSAoY29tcHV0ZXI6Q29tcHV0ZXIgeyBuYW1lOiBVUFBFUignJFNlc3Npb25Gcm9tTmFtZScpIH0pIE1FUkdFIChjb21wdXRlciktWzpIYXNTZXNzaW9uIHtXZWlnaHQ6ICcyJ31dLT4odXNlcikiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTG9nZ2VkT25Vc2VyID0gIiRVc2VyTmFtZUAkQ29tcHV0ZXJEb21haW4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUXVlcmllcyArPSAiTUVSR0UgKHVzZXI6VXNlciB7IG5hbWU6IFVQUEVSKCckTG9nZ2VkT25Vc2VyJykgfSkgTUVSR0UgKGNvbXB1dGVyOkNvbXB1dGVyIHsgbmFtZTogVVBQRVIoJyRTZXNzaW9uRnJvbU5hbWUnKSB9KSBNRVJHRSAoY29tcHV0ZXIpLVs6SGFzU2Vzc2lvbiB7V2VpZ2h0OiAnMid9XS0+KHVzZXIpIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiRXJyb3IgZXh0cmFjdGluZyBkb21haW4gZnJvbSAkKCRPYmplY3QuU2Vzc2lvbkZyb21OYW1lKSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYoJE9iamVjdC5TZXNzaW9uRnJvbSkgewogICAgICAgICAgICAgICAgICAgICRRdWVyaWVzICs9ICJNRVJHRSAodXNlcjpVc2VyIHsgbmFtZTogVVBQRVIoYCIkKCRPYmplY3QuVXNlck5hbWUpYCIpIH0pIE1FUkdFIChjb21wdXRlcjpDb21wdXRlciB7IG5hbWU6IFVQUEVSKGAiJCgkT2JqZWN0LlNlc3Npb25Gcm9tKWAiKSB9KSBNRVJHRSAoY29tcHV0ZXIpLVs6SGFzU2Vzc2lvbiB7V2VpZ2h0OiAnMid9XS0+KHVzZXIpIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgIyBhc3N1bWUgR2V0LU5ldExvZ2dlZE9uIHJlc3VsdAogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJTaW1wbGVOYW1lID0gIiQoJE9iamVjdC5Vc2VyRG9tYWluKVwkKCRPYmplY3QuVXNlck5hbWUpIiB8IENvbnZlcnQtQUROYW1lIC1JbnB1dFR5cGUgJ05UNCcgLU91dHB1dFR5cGUgJ0Nhbm9uaWNhbCcKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRNZW1iZXJTaW1wbGVOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRG9tYWluID0gJE1lbWJlclNpbXBsZU5hbWUuU3BsaXQoJy8nKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEFjY291bnROYW1lID0gIiQoJE9iamVjdC5Vc2VyTmFtZSlAJE1lbWJlckRvbWFpbiIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBY2NvdW50TmFtZSA9ICIkKCRPYmplY3QuVXNlck5hbWUpQFVOS05PV04iCiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICRRdWVyaWVzICs9ICJNRVJHRSAodXNlcjpVc2VyIHsgbmFtZTogVVBQRVIoJyRBY2NvdW50TmFtZScpIH0pIE1FUkdFIChjb21wdXRlcjpDb21wdXRlciB7IG5hbWU6IFVQUEVSKCckKCRPYmplY3QuQ29tcHV0ZXJOYW1lKScpIH0pIE1FUkdFIChjb21wdXRlciktWzpIYXNTZXNzaW9uIHtXZWlnaHQ6ICcxJ31dLT4odXNlcikiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3IgY29udmVydGluZyAkKCRPYmplY3QuVXNlckRvbWFpbilcJCgkT2JqZWN0LlVzZXJOYW1lKSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRPYmplY3QuUFNPYmplY3QuVHlwZU5hbWVzIC1jb250YWlucyAnUG93ZXJWaWV3Lkdyb3VwTWVtYmVyJykgewogICAgICAgICAgICAgICAgJEFjY291bnROYW1lID0gIiQoJE9iamVjdC5NZW1iZXJOYW1lKUAkKCRPYmplY3QuTWVtYmVyRG9tYWluKSIKCiAgICAgICAgICAgICAgICBpZiAoJE9iamVjdC5NZW1iZXJOYW1lIC1NYXRjaCAiXFwiKSB7CiAgICAgICAgICAgICAgICAgICAgIyBpZiB0aGUgbWVtYmVybmFtZSBpdHNlbGYgY29udGFpbnMgYSBiYWNrc2xhc2gsIGdldCB0aGUgdHJhaWxpbmcgc2VjdGlvbgogICAgICAgICAgICAgICAgICAgICMgVE9ETzogbGF0ZXIgcHJlc2VydmUgdGhpcyBvbmNlIEJsb29kSG91bmQgY2FuIHByb3Blcmx5IGRpc3BsYXkgdGhlc2UgY2hhcmFjdGVycwogICAgICAgICAgICAgICAgICAgICRBY2NvdW50TmFtZSA9ICQoJE9iamVjdC5NZW1iZXJuYW1lKS5zcGxpdCgnXCcpWzFdICsgJ0AnICsgJCgkT2JqZWN0Lk1lbWJlckRvbWFpbikKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkR3JvdXBOYW1lID0gIiQoJE9iamVjdC5Hcm91cE5hbWUpQCQoJE9iamVjdC5Hcm91cERvbWFpbikiCgogICAgICAgICAgICAgICAgaWYoJE9iamVjdC5Jc0dyb3VwKSB7CiAgICAgICAgICAgICAgICAgICAgJFF1ZXJpZXMgKz0gIk1FUkdFIChncm91cDE6R3JvdXAgeyBuYW1lOiBVUFBFUignJEFjY291bnROYW1lJykgfSkgTUVSR0UgKGdyb3VwMjpHcm91cCB7IG5hbWU6IFVQUEVSKCckR3JvdXBOYW1lJykgfSkgTUVSR0UgKGdyb3VwMSktWzpNZW1iZXJPZl0tPihncm91cDIpIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYoJE9iamVjdC5PYmplY3RDbGFzcyAtYW5kICgkT2JqZWN0Lk9iamVjdENsYXNzIC1jb250YWlucyAnY29tcHV0ZXInKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkUXVlcmllcyArPSAiTUVSR0UgKGNvbXB1dGVyOkNvbXB1dGVyIHsgbmFtZTogVVBQRVIoJyQoJE9iamVjdC5kbnNob3N0bmFtZSknKSB9KSBNRVJHRSAoZ3JvdXA6R3JvdXAgeyBuYW1lOiBVUFBFUignJEdyb3VwTmFtZScpIH0pIE1FUkdFIChjb21wdXRlciktWzpNZW1iZXJPZl0tPihncm91cCkiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSB0aGVyZSdzIG5vIHdheSB0byBkZXRlcm1pbmUgaWYgdGhpcyBpcyBhIGNvbXB1dGVyIG9iamVjdCBvciBub3QKICAgICAgICAgICAgICAgICAgICAgICAgJFF1ZXJpZXMgKz0gIk1FUkdFICh1c2VyOlVzZXIgeyBuYW1lOiBVUFBFUignJEFjY291bnROYW1lJykgfSkgTUVSR0UgKGdyb3VwOkdyb3VwIHsgbmFtZTogVVBQRVIoJyRHcm91cE5hbWUnKSB9KSBNRVJHRSAodXNlciktWzpNZW1iZXJPZl0tPihncm91cCkiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZigkT2JqZWN0LlBTT2JqZWN0LlR5cGVOYW1lcyAtQ29udGFpbnMgJ1Bvd2VyVmlldy5Vc2VyJykgewogICAgICAgICAgICAgICAgJEFjY291bnREb21haW4gPSAkT2JqZWN0LkRvbWFpbgogICAgICAgICAgICAgICAgJEFjY291bnROYW1lID0gIiQoJE9iamVjdC5TYW1BY2NvdW50TmFtZSlAJEFjY291bnREb21haW4iCgogICAgICAgICAgICAgICAgaWYoJE9iamVjdC5QcmltYXJ5R3JvdXBOYW1lIC1hbmQgKCRPYmplY3QuUHJpbWFyeUdyb3VwTmFtZSAtbmUgJycpKSB7CiAgICAgICAgICAgICAgICAgICAgJFByaW1hcnlHcm91cE5hbWUgPSAiJCgkT2JqZWN0LlByaW1hcnlHcm91cE5hbWUpQCRBY2NvdW50RG9tYWluIgogICAgICAgICAgICAgICAgICAgICRRdWVyaWVzICs9ICJNRVJHRSAodXNlcjpVc2VyIHsgbmFtZTogVVBQRVIoJyRBY2NvdW50TmFtZScpIH0pIE1FUkdFIChncm91cDpHcm91cCB7IG5hbWU6IFVQUEVSKCckUHJpbWFyeUdyb3VwTmFtZScpIH0pIE1FUkdFICh1c2VyKS1bOk1lbWJlck9mXS0+KGdyb3VwKSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICMgVE9ETzogZXh0cmFjdCBwd2RsYXN0c2V0L2V0Yy4gYW5kIGluZ2VzdAogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZigoJE9iamVjdC5QU09iamVjdC5UeXBlTmFtZXMgLWNvbnRhaW5zICdQb3dlclZpZXcuTG9jYWxVc2VyQVBJJykgLW9yICgkT2JqZWN0LlBTT2JqZWN0LlR5cGVOYW1lcyAtY29udGFpbnMgJ1Bvd2VyVmlldy5Mb2NhbFVzZXInKSkgewogICAgICAgICAgICAgICAgJEFjY291bnROYW1lID0gJCgkT2JqZWN0LkFjY291bnROYW1lLnJlcGxhY2UoJy8nLCAnXCcpKS5zcGxpdCgnXCcpWy0xXQoKICAgICAgICAgICAgICAgICRNZW1iZXJTaW1wbGVOYW1lID0gQ29udmVydC1TaWRUb05hbWUgLVNJRCAkT2JqZWN0LlNJRCB8IENvbnZlcnQtQUROYW1lIC1JbnB1dFR5cGUgJ05UNCcgLU91dHB1dFR5cGUgJ0Nhbm9uaWNhbCcKCiAgICAgICAgICAgICAgICBpZigkTWVtYmVyU2ltcGxlTmFtZSkgewogICAgICAgICAgICAgICAgICAgICRNZW1iZXJEb21haW4gPSAkTWVtYmVyU2ltcGxlTmFtZS5TcGxpdCgnLycpWzBdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRG9tYWluID0gIlVOS05PV04iCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJEFjY291bnROYW1lID0gIiRBY2NvdW50TmFtZUAkTWVtYmVyRG9tYWluIgoKICAgICAgICAgICAgICAgIGlmKCRPYmplY3QuSXNHcm91cCkgewogICAgICAgICAgICAgICAgICAgICRRdWVyaWVzICs9ICJNRVJHRSAoZ3JvdXA6R3JvdXAgeyBuYW1lOiBVUFBFUignJEFjY291bnROYW1lJykgfSkgTUVSR0UgKGNvbXB1dGVyOkNvbXB1dGVyIHsgbmFtZTogVVBQRVIoJyQoJE9iamVjdC5Db21wdXRlck5hbWUpJykgfSkgTUVSR0UgKGdyb3VwKS1bOkFkbWluVG9dLT4oY29tcHV0ZXIpIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJFF1ZXJpZXMgKz0gIk1FUkdFICh1c2VyOlVzZXIgeyBuYW1lOiBVUFBFUignJEFjY291bnROYW1lJykgfSkgTUVSR0UgKGNvbXB1dGVyOkNvbXB1dGVyIHsgbmFtZTogVVBQRVIoJyQoJE9iamVjdC5Db21wdXRlck5hbWUpJykgfSkgTUVSR0UgKHVzZXIpLVs6QWRtaW5Ub10tPihjb21wdXRlcikiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRPYmplY3QuUFNPYmplY3QuVHlwZU5hbWVzIC1jb250YWlucyAnUG93ZXJWaWV3LkxvY2FsVXNlclNwZWNpZmllZCcpIHsKICAgICAgICAgICAgICAgICMgbWFudWFsbHkgc3BlY2lmaWVkIGxvY2FsZ3JvdXAgbWVtYmVyc2hpcCB3aGVyZSByZXNvbHV0aW9uIGhhcHBlbnMgYnkgdGhlIGNhbGxlZQoKICAgICAgICAgICAgICAgICRBY2NvdW50TmFtZSA9ICIkKCRPYmplY3QuTWVtYmVyTmFtZSlAJCgkT2JqZWN0Lk1lbWJlckRvbWFpbikiCgogICAgICAgICAgICAgICAgaWYoJE9iamVjdC5Jc0dyb3VwKSB7CiAgICAgICAgICAgICAgICAgICAgJFF1ZXJpZXMgKz0gIk1FUkdFIChncm91cDpHcm91cCB7IG5hbWU6IFVQUEVSKCckQWNjb3VudE5hbWUnKSB9KSBNRVJHRSAoY29tcHV0ZXI6Q29tcHV0ZXIgeyBuYW1lOiBVUFBFUignJCgkT2JqZWN0LkNvbXB1dGVyTmFtZSknKSB9KSBNRVJHRSAoZ3JvdXApLVs6QWRtaW5Ub10tPihjb21wdXRlcikiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkUXVlcmllcyArPSAiTUVSR0UgKHVzZXI6VXNlciB7IG5hbWU6IFVQUEVSKCckQWNjb3VudE5hbWUnKSB9KSBNRVJHRSAoY29tcHV0ZXI6Q29tcHV0ZXIgeyBuYW1lOiBVUFBFUignJCgkT2JqZWN0LkNvbXB1dGVyTmFtZSknKSB9KSBNRVJHRSAodXNlciktWzpBZG1pblRvXS0+KGNvbXB1dGVyKSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoJE9iamVjdC5QU09iamVjdC5UeXBlTmFtZXMgLWNvbnRhaW5zICdQb3dlclZpZXcuR1BPTG9jYWxHcm91cCcpIHsKICAgICAgICAgICAgICAgICBpZighW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJE9iamVjdC5TSUQpKXsKICAgICAgICAgICAgICAgICAgICAkTWVtYmVyU2ltcGxlTmFtZSA9IENvbnZlcnQtU2lkVG9OYW1lIC1TSUQgJE9iamVjdC5TSUQgfCBDb252ZXJ0LUFETmFtZSAtSW5wdXRUeXBlICdOVDQnIC1PdXRwdXRUeXBlICdDYW5vbmljYWwnCiAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKCRNZW1iZXJTaW1wbGVOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgJE1lbWJlckRvbWFpbiA9ICRNZW1iZXJTaW1wbGVOYW1lLlNwbGl0KCcvJylbMF0KICAgICAgICAgICAgICAgICAgICAkQWNjb3VudE5hbWUgPSAiJCgkT2JqZWN0Lk9iamVjdE5hbWUpQCRNZW1iZXJEb21haW4iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkQWNjb3VudE5hbWUgPSAkT2JqZWN0Lk9iamVjdE5hbWUKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBGb3JFYWNoKCRDb21wdXRlciBpbiAkT2JqZWN0LkNvbXB1dGVyTmFtZSkgewogICAgICAgICAgICAgICAgICAgIGlmKCRPYmplY3QuSXNHcm91cCkgewogICAgICAgICAgICAgICAgICAgICAgICAkUXVlcmllcyArPSAiTUVSR0UgKGdyb3VwOkdyb3VwIHsgbmFtZTogVVBQRVIoJyRBY2NvdW50TmFtZScpIH0pIE1FUkdFIChjb21wdXRlcjpDb21wdXRlciB7IG5hbWU6IFVQUEVSKCckQ29tcHV0ZXInKSB9KSBNRVJHRSAoZ3JvdXApLVs6QWRtaW5Ub10tPihjb21wdXRlcikiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkUXVlcmllcyArPSAiTUVSR0UgKHVzZXI6VXNlciB7IG5hbWU6IFVQUEVSKCckQWNjb3VudE5hbWUnKSB9KSBNRVJHRSAoY29tcHV0ZXI6Q29tcHV0ZXIgeyBuYW1lOiBVUFBFUignJENvbXB1dGVyJykgfSkgTUVSR0UgKHVzZXIpLVs6QWRtaW5Ub10tPihjb21wdXRlcikiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZigkT2JqZWN0LlBTT2JqZWN0LlR5cGVOYW1lcyAtY29udGFpbnMgJ1Bvd2VyVmlldy5Eb21haW5UcnVzdExEQVAnKSB7CiAgICAgICAgICAgICAgICAjIFt1aW50MzJdJzB4MDAwMDAwMDEnID0gJ25vbl90cmFuc2l0aXZlJwogICAgICAgICAgICAgICAgIyBbdWludDMyXScweDAwMDAwMDAyJyA9ICd1cGxldmVsX29ubHknCiAgICAgICAgICAgICAgICAjIFt1aW50MzJdJzB4MDAwMDAwMDQnID0gJ3F1YXJhbnRpbmVkX2RvbWFpbicKICAgICAgICAgICAgICAgICMgW3VpbnQzMl0nMHgwMDAwMDAwOCcgPSAnZm9yZXN0X3RyYW5zaXRpdmUnCiAgICAgICAgICAgICAgICAjIFt1aW50MzJdJzB4MDAwMDAwMTAnID0gJ2Nyb3NzX29yZ2FuaXphdGlvbicKICAgICAgICAgICAgICAgICMgW3VpbnQzMl0nMHgwMDAwMDAyMCcgPSAnd2l0aGluX2ZvcmVzdCcKICAgICAgICAgICAgICAgICMgW3VpbnQzMl0nMHgwMDAwMDA0MCcgPSAndHJlYXRfYXNfZXh0ZXJuYWwnCiAgICAgICAgICAgICAgICAjIFt1aW50MzJdJzB4MDAwMDAwODAnID0gJ3RydXN0X3VzZXNfcmM0X2VuY3J5cHRpb24nCiAgICAgICAgICAgICAgICAjIFt1aW50MzJdJzB4MDAwMDAxMDAnID0gJ3RydXN0X3VzZXNfYWVzX2tleXMnCiAgICAgICAgICAgICAgICAjIFt1aW50MzJdJzB4MDAwMDAyMDAnID0gJ2Nyb3NzX29yZ2FuaXphdGlvbl9ub190Z3RfZGVsZWdhdGlvbicKICAgICAgICAgICAgICAgICMgW3VpbnQzMl0nMHgwMDAwMDQwMCcgPSAncGltX3RydXN0JwogICAgICAgICAgICAgICAgaWYoJE9iamVjdC5Tb3VyY2VEb21haW4pIHsKICAgICAgICAgICAgICAgICAgICAkU291cmNlRG9tYWluID0gJE9iamVjdC5Tb3VyY2VEb21haW4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRTb3VyY2VEb21haW4gPSAkT2JqZWN0LlNvdXJjZU5hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCRPYmplY3QuVGFyZ2V0RG9tYWluKSB7CiAgICAgICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbiA9ICRPYmplY3QuVGFyZ2V0RG9tYWluCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWluID0gJE9iamVjdC5UYXJnZXROYW1lCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJFF1ZXJ5ID0gIk1FUkdFIChTb3VyY2VEb21haW46RG9tYWluIHsgbmFtZTogVVBQRVIoJyRTb3VyY2VEb21haW4nKSB9KSBNRVJHRSAoVGFyZ2V0RG9tYWluOkRvbWFpbiB7IG5hbWU6IFVQUEVSKCckVGFyZ2V0RG9tYWluJykgfSkiCgogICAgICAgICAgICAgICAgaWYoJE9iamVjdC5UcnVzdFR5cGUgLW1hdGNoICdjcm9zc19vcmdhbml6YXRpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgJFRydXN0VHlwZSA9ICdDcm9zc0xpbmsnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYgKCRPYmplY3QuVHJ1c3RUeXBlIC1tYXRjaCAnd2l0aGluX2ZvcmVzdCcpIHsKICAgICAgICAgICAgICAgICAgICAkVHJ1c3RUeXBlID0gJ1BhcmVudENoaWxkJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmICgkT2JqZWN0LlRydXN0VHlwZSAtbWF0Y2ggJ2ZvcmVzdF90cmFuc2l0aXZlJykgewogICAgICAgICAgICAgICAgICAgICRUcnVzdFR5cGUgPSAnRm9yZXN0JwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmICgkT2JqZWN0LlRydXN0VHlwZSAtbWF0Y2ggJ3RyZWF0X2FzX2V4dGVybmFsJykgewogICAgICAgICAgICAgICAgICAgICRUcnVzdFR5cGUgPSAnRXh0ZXJuYWwnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJUcnVzdCB0eXBlIHVuaGFuZGxlZC91bmtub3duOiAkKCRPYmplY3QuVHJ1c3RUeXBlKSIKICAgICAgICAgICAgICAgICAgICAkVHJ1c3RUeXBlID0gJ1Vua25vd24nCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCRPYmplY3QuVHJ1c3RUeXBlIC1tYXRjaCAnbm9uX3RyYW5zaXRpdmUnKSB7CiAgICAgICAgICAgICAgICAgICAgJFRyYW5zaXRpdmUgPSAkRmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRUcmFuc2l0aXZlID0gJFRydWUKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBTd2l0Y2ggKCRPYmplY3QuVHJ1c3REaXJlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAnSW5ib3VuZCcgewogICAgICAgICAgICAgICAgICAgICAgICAkUXVlcnkgKz0gIiBNRVJHRSAoVGFyZ2V0RG9tYWluKS1bOlRydXN0ZWRCeXsgVHJ1c3RUeXBlOiBVUFBFUignJFRydXN0VHlwZScpLCBUcmFuc2l0aXZlOiBVUFBFUignJFRyYW5zaXRpdmUnKX1dLT4oU291cmNlRG9tYWluKSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJ091dGJvdW5kJyB7CiAgICAgICAgICAgICAgICAgICAgICAgICRRdWVyeSArPSAiIE1FUkdFIChTb3VyY2VEb21haW4pLVs6VHJ1c3RlZEJ5eyBUcnVzdFR5cGU6IFVQUEVSKCckVHJ1c3RUeXBlJyksIFRyYW5zaXRpdmU6IFVQUEVSKCckVHJhbnNpdGl2ZScpfV0tPihUYXJnZXREb21haW4pIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAnQmlkaXJlY3Rpb25hbCcgewogICAgICAgICAgICAgICAgICAgICAgICAkUXVlcnkgKz0gIiBNRVJHRSAoVGFyZ2V0RG9tYWluKS1bOlRydXN0ZWRCeXsgVHJ1c3RUeXBlOiBVUFBFUignJFRydXN0VHlwZScpLCBUcmFuc2l0aXZlOiBVUFBFUignJFRyYW5zaXRpdmUnKX1dLT4oU291cmNlRG9tYWluKSBNRVJHRSAoU291cmNlRG9tYWluKS1bOlRydXN0ZWRCeXsgVHJ1c3RUeXBlOiBVUFBFUignJFRydXN0VHlwZScpLCBUcmFuc2l0aXZlOiBVUFBFUignJFRyYW5zaXRpdmUnKX1dLT4oVGFyZ2V0RG9tYWluKSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUXVlcmllcyArPSAkUXVlcnkKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoJE9iamVjdC5QU09iamVjdC5UeXBlTmFtZXMgLWNvbnRhaW5zICdQb3dlclZpZXcuRG9tYWluVHJ1c3QnKSB7CiAgICAgICAgICAgICAgICBpZigkT2JqZWN0LlNvdXJjZURvbWFpbikgewogICAgICAgICAgICAgICAgICAgICRTb3VyY2VEb21haW4gPSAkT2JqZWN0LlNvdXJjZURvbWFpbgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJFNvdXJjZURvbWFpbiA9ICRPYmplY3QuU291cmNlTmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoJE9iamVjdC5UYXJnZXREb21haW4pIHsKICAgICAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWluID0gJE9iamVjdC5UYXJnZXREb21haW4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRUYXJnZXREb21haW4gPSAkT2JqZWN0LlRhcmdldE5hbWUKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkUXVlcnkgPSAiTUVSR0UgKFNvdXJjZURvbWFpbjpEb21haW4geyBuYW1lOiBVUFBFUignJFNvdXJjZURvbWFpbicpIH0pIE1FUkdFIChUYXJnZXREb21haW46RG9tYWluIHsgbmFtZTogVVBQRVIoJyRUYXJnZXREb21haW4nKSB9KSIKCiAgICAgICAgICAgICAgICAkVHJ1c3RUeXBlID0gJE9iamVjdC5UcnVzdFR5cGUKICAgICAgICAgICAgICAgICRUcmFuc2l0aXZlID0gJFRydWUKCiAgICAgICAgICAgICAgICBTd2l0Y2ggKCRPYmplY3QuVHJ1c3REaXJlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAnSW5ib3VuZCcgewogICAgICAgICAgICAgICAgICAgICAgICAkUXVlcnkgKz0gIiBNRVJHRSAoU291cmNlRG9tYWluKS1bOlRydXN0ZWRCeXsgVHJ1c3RUeXBlOiBVUFBFUignJFRydXN0VHlwZScpLCBUcmFuc2l0aXZlOiBVUFBFUignJFRyYW5zaXRpdmUnKX1dLT4oVGFyZ2V0RG9tYWluKSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJ091dGJvdW5kJyB7CiAgICAgICAgICAgICAgICAgICAgICAgICRRdWVyeSArPSAiIE1FUkdFIChUYXJnZXREb21haW4pLVs6VHJ1c3RlZEJ5eyBUcnVzdFR5cGU6IFVQUEVSKCckVHJ1c3RUeXBlJyksIFRyYW5zaXRpdmU6IFVQUEVSKCckVHJhbnNpdGl2ZScpfV0tPihTb3VyY2VEb21haW4pIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAnQmlkaXJlY3Rpb25hbCcgewogICAgICAgICAgICAgICAgICAgICAgICAkUXVlcnkgKz0gIiBNRVJHRSAoVGFyZ2V0RG9tYWluKS1bOlRydXN0ZWRCeXsgVHJ1c3RUeXBlOiBVUFBFUignJFRydXN0VHlwZScpLCBUcmFuc2l0aXZlOiBVUFBFUignJFRyYW5zaXRpdmUnKX1dLT4oU291cmNlRG9tYWluKSBNRVJHRSAoU291cmNlRG9tYWluKS1bOlRydXN0ZWRCeXsgVHJ1c3RUeXBlOiBVUFBFUignJFRydXN0VHlwZScpLCBUcmFuc2l0aXZlOiBVUFBFUignJFRyYW5zaXRpdmUnKX1dLT4oVGFyZ2V0RG9tYWluKSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkUXVlcmllcyArPSAkUXVlcnkKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoJE9iamVjdC5QU09iamVjdC5UeXBlTmFtZXMgLWNvbnRhaW5zICdQb3dlclZpZXcuRm9yZXN0VHJ1c3QnKSB7CiAgICAgICAgICAgICAgICBpZigkT2JqZWN0LlNvdXJjZURvbWFpbikgewogICAgICAgICAgICAgICAgICAgICRTb3VyY2VEb21haW4gPSAkT2JqZWN0LlNvdXJjZURvbWFpbgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJFNvdXJjZURvbWFpbiA9ICRPYmplY3QuU291cmNlTmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoJE9iamVjdC5UYXJnZXREb21haW4pIHsKICAgICAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWluID0gJE9iamVjdC5UYXJnZXREb21haW4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRUYXJnZXREb21haW4gPSAkT2JqZWN0LlRhcmdldE5hbWUKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkUXVlcnkgPSAiTUVSR0UgKFNvdXJjZURvbWFpbjpEb21haW4geyBuYW1lOiBVUFBFUignJFNvdXJjZURvbWFpbicpIH0pIE1FUkdFIChUYXJnZXREb21haW46RG9tYWluIHsgbmFtZTogVVBQRVIoJyRUYXJnZXREb21haW4nKSB9KSIKCiAgICAgICAgICAgICAgICAkVHJ1c3RUeXBlID0gJ0ZvcmVzdCcKICAgICAgICAgICAgICAgICRUcmFuc2l0aXZlID0gJFRydWUKCiAgICAgICAgICAgICAgICBTd2l0Y2ggKCRPYmplY3QuVHJ1c3REaXJlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAnSW5ib3VuZCcgewogICAgICAgICAgICAgICAgICAgICAgICAkUXVlcnkgKz0gIiBNRVJHRSAoU291cmNlRG9tYWluKS1bOlRydXN0ZWRCeXsgVHJ1c3RUeXBlOiBVUFBFUignRk9SRVNUJyksIFRyYW5zaXRpdmU6IFVQUEVSKCckVHJhbnNpdGl2ZScpfV0tPihUYXJnZXREb21haW4pIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAnT3V0Ym91bmQnIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFF1ZXJ5ICs9ICIgTUVSR0UgKFRhcmdldERvbWFpbiktWzpUcnVzdGVkQnl7IFRydXN0VHlwZTogVVBQRVIoJ0ZPUkVTVCcpLCBUcmFuc2l0aXZlOiBVUFBFUignJFRyYW5zaXRpdmUnKX1dLT4oU291cmNlRG9tYWluKSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJ0JpZGlyZWN0aW9uYWwnIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFF1ZXJ5ICs9ICIgTUVSR0UgKFRhcmdldERvbWFpbiktWzpUcnVzdGVkQnl7IFRydXN0VHlwZTogVVBQRVIoJ0ZPUkVTVCcpLCBUcmFuc2l0aXZlOiBVUFBFUignJFRyYW5zaXRpdmUnKX1dLT4oU291cmNlRG9tYWluKSBNRVJHRSAoU291cmNlRG9tYWluKS1bOlRydXN0ZWRCeXsgVHJ1c3RUeXBlOiBVUFBFUignRk9SRVNUJyksIFRyYW5zaXRpdmU6IFVQUEVSKCckVHJhbnNpdGl2ZScpfV0tPihUYXJnZXREb21haW4pIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRRdWVyaWVzICs9ICRRdWVyeQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiTm8gbWF0Y2hpbmcgdHlwZSBuYW1lIgogICAgICAgICAgICB9CgogICAgICAgICAgICBGb3JFYWNoKCRRdWVyeSBpbiAkUXVlcmllcykgewogICAgICAgICAgICAgICAgJE51bGwgPSAkU3RhdGVtZW50cy5BZGQoIEB7ICJzdGF0ZW1lbnQiPSRRdWVyeSB9ICkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJFN0YXRlbWVudHMuQ291bnQgLWdlICRUaHJvdHRsZSkgewogICAgICAgICAgICAgICAgJEpzb24gPSBAeyAic3RhdGVtZW50cyI9W1N5c3RlbS5Db2xsZWN0aW9ucy5IYXNodGFibGVbXV0kU3RhdGVtZW50cyB9CiAgICAgICAgICAgICAgICAkSnNvblJlcXVlc3QgPSBDb252ZXJ0VG8tSnNvbjIwICRKc29uCiAgICAgICAgICAgICAgICAkTnVsbCA9ICRXZWJDbGllbnQuVXBsb2FkU3RyaW5nKCRVUkkuQWJzb2x1dGVVcmkgKyAiZGIvZGF0YS90cmFuc2FjdGlvbi9jb21taXQiLCAkSnNvblJlcXVlc3QpCiAgICAgICAgICAgICAgICAkU3RhdGVtZW50cy5DbGVhcigpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHRocm93ICdOb3QgYXV0aG9yaXplZCcKICAgICAgICB9CiAgICB9CiAgICBlbmQgewogICAgICAgIGlmKCRBdXRob3JpemVkKSB7CiAgICAgICAgICAgJEpzb24gPSBAeyAic3RhdGVtZW50cyI9W1N5c3RlbS5Db2xsZWN0aW9ucy5IYXNodGFibGVbXV0kU3RhdGVtZW50cyB9CiAgICAgICAgICAgJEpzb25SZXF1ZXN0ID0gQ29udmVydFRvLUpzb24yMCAkSnNvbgogICAgICAgICAgICROdWxsID0gJFdlYkNsaWVudC5VcGxvYWRTdHJpbmcoJFVSSS5BYnNvbHV0ZVVyaSArICJkYi9kYXRhL3RyYW5zYWN0aW9uL2NvbW1pdCIsICRKc29uUmVxdWVzdCkKICAgICAgICAgICAkU3RhdGVtZW50cy5DbGVhcigpCiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gRXhwb3J0LUJsb29kSG91bmRDU1Ygewo8IwogICAgLlNZTk9QU0lTCgogICAgICAgIFRha2VzIGlucHV0IGZyb20gR2V0LUJsb29kSG91bmQgZGF0YSBhbmQgZXhwb3J0cyB0aGUgb2JqZWN0cyB0byBvbmUgY3VzdG9tIENTViBmaWxlCiAgICAgICAgcGVyIG9iamVjdCB0eXBlIChzZXNzaW9ucywgbG9jYWwgYWRtaW4sIGRvbWFpbiB0cnVzdHMsIGV0Yy4pLgoKICAgICAgICBBdXRob3I6IEBoYXJtajB5CiAgICAgICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAgICAgUmVxdWlyZWQgRGVwZW5kZW5jaWVzOiBQb3dlclZpZXcucHMxCiAgICAgICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBOb25lCgogICAgLkRFU0NSSVBUSU9OCgogICAgICAgIFRoaXMgZnVuY3Rpb24gdGFrZXMgY3VzdG9tIHRhZ2dlZCBQb3dlclZpZXcgb2JqZWN0cyB0eXBlcyBmcm9tIEdldC1CbG9vZEhvdW5kRGF0YSBhbmQgZXhwb3J0cwogICAgICAgIHRoZSBkYXRhIHRvIG9uZSBjdXN0b20gQ1NWIGZpbGUgcGVyIG9iamVjdCB0eXBlIChzZXNzaW9ucywgbG9jYWwgYWRtaW4sIGRvbWFpbiB0cnVzdHMsIGV0Yy4pLgogICAgICAgIEZvciB1c2VyIHNlc3Npb24gZGF0YSB3aXRob3V0IGEgbG9nb24gZG9tYWluLCBieSBkZWZhdWx0IHRoZSBnbG9iYWwgY2F0YWxvZyBpcyB1c2VkIHRvIGF0dGVtcHQgdG8KICAgICAgICBkZWNvbmZsaWN0IHdoYXQgZG9tYWluIHRoZSB1c2VyIG1heSBiZSBsb2NhdGVkIGluLiBJZiB0aGUgdXNlciBleGlzdHMgaW4gbW9yZSB0aGFuIG9uZSBkb21haW4gaW4KICAgICAgICB0aGUgZm9yZXN0LCBhIHNlcmllcyBvZiB3ZWlnaHRzIGlzIHVzZWQgdG8gbW9kaWZ5IHRoZSBhdHRhY2sgcGF0aCBsaWtlbGlob29kLgoKICAgIC5QQVJBTUVURVIgT2JqZWN0CgogICAgICAgIFRoZSBQb3dlclZpZXcgUFNPYmplY3QgdG8gZXhwb3J0IHRvIGNzdi4KCiAgICAuUEFSQU1FVEVSIENTVkZvbGRlcgoKICAgICAgICBUaGUgZm9sZGVyIHRvIG91dHB1dCBhbGwgQ1NWcyB0bywgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgd29ya2luZyBkaXJlY3RvcnkuCgogICAgLlBBUkFNRVRFUiBDU1ZQcmVmaXgKCiAgICAgICAgQSBwcmVmaXggdG8gYXBwZW5kIHRvIGVhY2ggQ1NWIGZpbGUuCgogICAgLlBBUkFNRVRFUiBTa2lwR0NEZWNvbmZsaWN0aW9uCgogICAgICAgIFN3aXRjaC4gRG9uJ3QgcmVzb2x2ZSB1c2VyIGRvbWFpbiBtZW1iZXJzaGlwcyBmb3Igc2Vzc2lvbiBpbmZvcm1hdGlvbiB1c2luZyBhIGdsb2JhbCBjYXRhbG9nLgoKICAgIC5QQVJBTUVURVIgR2xvYmFsQ2F0YWxvZwoKICAgICAgICBUaGUgZ2xvYmFsIGNhdGFsb2cgbG9jYXRpb24gdG8gcmVzb2xlIHVzZXIgbWVtYmVyc2hpcHMgZnJvbSwgZm9ybSBvZiBHQzovL2dsb2JhbC5jYXRhbG9nLgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUJsb29kSG91bmREYXRhIHwgRXhwb3J0LUJsb29kSG91bmRDU1YKCiAgICAgICAgRXhlY3V0ZXMgZGVmYXVsdCBjb2xsZWN0aW9uIG9wdGlvbnMgYW5kIGV4cG9ydHMgdGhlIGRhdGEgdG8gdXNlcl9zZXNzaW9ucy5jc3YsIGdyb3VwX21lbWJlcnNoaXBzLmNzdiwKICAgICAgICBsb2NhbF9hZG1pbnMuY3N2LCBhbmQgdHJ1c3RzLmNzdiBpbiB0aGUgY3VycmVudCBkaXJlY3RvcnkuCgogICAgLkVYQU1QTEUKCiAgICAgICAgUFMgQzpcPiBHZXQtQmxvb2RIb3VuZERhdGEgfCBFeHBvcnQtQmxvb2RIb3VuZENTViAtU2tpcEdDRGVjb25mbGljdGlvbgoKICAgICAgICBFeGVjdXRlcyBkZWZhdWx0IGNvbGxlY3Rpb24gb3B0aW9ucywgc2tpcHMgdGhlIGdsb2JhbCBjYXRhbG9nIGRlY29uZmxpY3Rpb24sIGFuZCBleHBvcnRzIHRoZSBkYXRhCiAgICAgICAgdG8gdXNlcl9zZXNzaW9ucy5jc3YsIGdyb3VwX21lbWJlcnNoaXBzLmNzdiwgbG9jYWxfYWRtaW5zLmNzdiwgYW5kIHRydXN0cy5jc3YgaW4gdGhlIGN1cnJlbnQgZGlyZWN0b3J5LgoKICAgIC5FWEFNUExFCgogICAgICAgIFBTIEM6XD4gR2V0LUJsb29kSG91bmREYXRhIHwgRXhwb3J0LUJsb29kSG91bmRDU1YgLUNTVkZvbGRlciBDOlxUZW1wXCAtQ1NWUHJlZml4ICJkb21haW5YIgoKICAgICAgICBFeGVjdXRlcyBkZWZhdWx0IGNvbGxlY3Rpb24gb3B0aW9ucyBhbmQgZXhwb3J0cyB0aGUgZGF0YSB0byBkb21haW5YX3VzZXJfc2Vzc2lvbnMuY3N2LCBkb21haW5YX2dyb3VwX21lbWJlcnNoaXBzLmNzdiwKICAgICAgICBkb21haW5YX2xvY2FsX2FkbWlucy5jc3YsIGFuZCB0ZG9tYWluWF9ydXN0cy5jc3YgaW4gQzpcVGVtcFwuCgogICAgLk5PVEVTCgogICAgICAgIENTViBmaWxlIHR5cGVzOgoKICAgICAgICAgICAgUG93ZXJWaWV3LlVzZXJTZXNzaW9uIC0+ICQoJENTVkV4cG9ydFByZWZpeCl1c2VyX3Nlc3Npb25zLmNzdgogICAgICAgICAgICAgICAgVXNlck5hbWUsQ29tcHV0ZXJOYW1lLFdlaWdodAogICAgICAgICAgICAgICAgImpvaG5AZG9tYWluLmxvY2FsIiwiY29tcHV0ZXIyLmRvbWFpbi5sb2NhbCIsMQoKICAgICAgICAgICAgUG93ZXJWaWV3Lkdyb3VwTWVtYmVyL1Bvd2VyVmlldy5Vc2VyIC0+ICQoJENTVkV4cG9ydFByZWZpeClncm91cF9tZW1iZXJzaGlwcy5jc3YKICAgICAgICAgICAgICAgIEFjY291bnROYW1lLEFjY291bnRUeXBlLEdyb3VwTmFtZQogICAgICAgICAgICAgICAgImpvaG5AZG9tYWluLmxvY2FsIiwidXNlciIsIkdST1VQMSIKICAgICAgICAgICAgICAgICJjb21wdXRlcjMudGVzdGxhYi5sb2NhbCIsImNvbXB1dGVyIiwiR1JPVVAxIgoKICAgICAgICAgICAgUG93ZXJWaWV3LkxvY2FsVXNlckFQSS9Qb3dlclZpZXcuR1BPTG9jYWxHcm91cCAtPiAkKCRDU1ZFeHBvcnRQcmVmaXgpbG9jYWxfYWRtaW5zLmNzdgogICAgICAgICAgICAgICAgQWNjb3VudE5hbWUsQWNjb3VudFR5cGUsQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICAiam9obkBkb21haW4ubG9jYWwiLCJ1c2VyIiwiY29tcHV0ZXIyLmRvbWFpbi5sb2NhbCIKCiAgICAgICAgICAgIFBvd2VyVmlldy5Eb21haW5UcnVzdExEQVAvUG93ZXJWaWV3LkRvbWFpblRydXN0L1Bvd2VyVmlldy5Gb3Jlc3RUcnVzdCAtPiAkKCRDU1ZFeHBvcnRQcmVmaXgpdHJ1c3RzLmNzdgogICAgICAgICAgICAgICAgU291cmNlRG9tYWluLFRhcmdldERvbWFpbixUcnVzdERpcmVjdGlvbixUcnVzdFR5cGUsVHJhbnNpdGl2ZQogICAgICAgICAgICAgICAgImRvbWFpbi5sb2NhbCIsImRldi5kb21haW4ubG9jYWwiLCJCaWRpcmVjdGlvbmFsIiwiUGFyZW50Q2hpbGQiLCJUcnVlIgojPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCwgVmFsdWVGcm9tUGlwZWxpbmUgPSAkVHJ1ZSwgTWFuZGF0b3J5ID0gJFRydWUpXQogICAgICAgIFtQU09iamVjdF0KICAgICAgICAkT2JqZWN0LAoKICAgICAgICBbUGFyYW1ldGVyKCldCiAgICAgICAgW1ZhbGlkYXRlU2NyaXB0KHsgVGVzdC1QYXRoIC1QYXRoICRfIH0pXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJENTVkZvbGRlciA9ICQoR2V0LUxvY2F0aW9uKSwKCiAgICAgICAgW1BhcmFtZXRlcigpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQ1NWUHJlZml4LAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTa2lwR0NEZWNvbmZsaWN0aW9uLAoKICAgICAgICBbVmFsaWRhdGVQYXR0ZXJuKCdeR0M6Ly8nKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRHbG9iYWxDYXRhbG9nCiAgICApCgogICAgQkVHSU4gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRPdXRwdXRGb2xkZXIgPSAkQ1NWRm9sZGVyIHwgUmVzb2x2ZS1QYXRoIC1FcnJvckFjdGlvbiBTdG9wIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgUGF0aAogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIHRocm93ICJFcnJvcjogJF8iCiAgICAgICAgfQoKICAgICAgICBpZigkQ1NWUHJlZml4KSB7CiAgICAgICAgICAgICRDU1ZFeHBvcnRQcmVmaXggPSAiJCgkQ1NWUHJlZml4KV8iCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkQ1NWRXhwb3J0UHJlZml4ID0gJycKICAgICAgICB9CgogICAgICAgICRVc2VyRG9tYWluTWFwcGluZ3MgPSBAe30KICAgICAgICBpZigtbm90ICRTa2lwR0NEZWNvbmZsaWN0aW9uKSB7CiAgICAgICAgICAgICMgaWYgd2UncmUgZG9pbmcgc2Vzc2lvbiBlbnVtZXJhdGlvbiwgY3JlYXRlIGEge3VzZXIgOiBAKGRvbWFpbiwuLil9IGZyb20gYSBnbG9iYWwgY2F0YWxvZwogICAgICAgICAgICAjICAgaW4gb3JkZXIgdG8gZG8gdXNlciBkb21haW4gZGVjb25mbGljdGlvbiBmb3Igc2Vzc2lvbnMKCiAgICAgICAgICAgIGlmKC1ub3QgJFBTQm91bmRQYXJhbWV0ZXJzWydHbG9iYWxDYXRhbG9nJ10pIHsKICAgICAgICAgICAgICAgICRVc2VyRG9tYWluTWFwcGluZ3MgPSBHZXQtR2xvYmFsQ2F0YWxvZ1VzZXJNYXBwaW5nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkVXNlckRvbWFpbk1hcHBpbmdzID0gR2V0LUdsb2JhbENhdGFsb2dVc2VyTWFwcGluZyAtR2xvYmFsQ2F0YWxvZyAkR2xvYmFsQ2F0YWxvZwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIFBST0NFU1MgewoKICAgICAgICBpZigkT2JqZWN0LlBTT2JqZWN0LlR5cGVOYW1lcyAtY29udGFpbnMgJ1Bvd2VyVmlldy5Vc2VyU2Vzc2lvbicpIHsKCiAgICAgICAgICAgIGlmKCRPYmplY3QuU2Vzc2lvbkZyb21OYW1lKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICRVc2VyTmFtZSA9ICRPYmplY3QuVXNlck5hbWUuVG9VcHBlcigpCiAgICAgICAgICAgICAgICAgICAgJFNlc3Npb25Gcm9tTmFtZSA9ICRPYmplY3QuU2Vzc2lvbkZyb21OYW1lCiAgICAgICAgICAgICAgICAgICAgJENvbXB1dGVyRG9tYWluID0gJE9iamVjdC5TZXNzaW9uRnJvbU5hbWUuU3ViU3RyaW5nKCRPYmplY3QuU2Vzc2lvbkZyb21OYW1lLkluZGV4T2YoJy4nKSsxKS5Ub1VwcGVyKCkKCiAgICAgICAgICAgICAgICAgICAgaWYoJFVzZXJEb21haW5NYXBwaW5ncykgewogICAgICAgICAgICAgICAgICAgICAgICAkVXNlckRvbWFpbiA9ICROdWxsCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRVc2VyRG9tYWluTWFwcGluZ3NbJFVzZXJOYW1lXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJFVzZXJEb21haW5NYXBwaW5nc1skVXNlck5hbWVdLkNvdW50IC1lcSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJEb21haW4gPSAkVXNlckRvbWFpbk1hcHBpbmdzWyRVc2VyTmFtZV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTG9nZ2VkT25Vc2VyID0gIiRVc2VyTmFtZUAkVXNlckRvbWFpbiIKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgPSBAewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2VyTmFtZSA9ICRMb2dnZWRPblVzZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29tcHV0ZXJOYW1lID0gJFNlc3Npb25Gcm9tTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXZWlnaHQgPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5ldy1PYmplY3QgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzIHwgRXhwb3J0LVBvd2VyVmlld0NTViAtT3V0RmlsZSAiJE91dHB1dEZvbGRlclwkKCRDU1ZFeHBvcnRQcmVmaXgpdXNlcl9zZXNzaW9ucy5jc3YiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQ29tcHV0ZXJEb21haW4gPSAkT2JqZWN0LlNlc3Npb25Gcm9tTmFtZS5TdWJTdHJpbmcoJE9iamVjdC5TZXNzaW9uRnJvbU5hbWUuSW5kZXhPZignLicpKzEpLlRvVXBwZXIoKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVXNlckRvbWFpbk1hcHBpbmdzWyRVc2VyTmFtZV0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRfIC1lcSAkQ29tcHV0ZXJEb21haW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyRG9tYWluID0gJF8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2dnZWRPblVzZXIgPSAiJFVzZXJOYW1lQCRVc2VyRG9tYWluIgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2VyTmFtZSA9ICRMb2dnZWRPblVzZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb21wdXRlck5hbWUgPSAkU2Vzc2lvbkZyb21OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV2VpZ2h0ID0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmV3LU9iamVjdCBQU09iamVjdCAtUHJvcGVydHkgJFByb3BlcnRpZXMgfCBFeHBvcnQtUG93ZXJWaWV3Q1NWIC1PdXRGaWxlICIkT3V0cHV0Rm9sZGVyXCQoJENTVkV4cG9ydFByZWZpeCl1c2VyX3Nlc3Npb25zLmNzdiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyRG9tYWluID0gJF8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2dnZWRPblVzZXIgPSAiJFVzZXJOYW1lQCRVc2VyRG9tYWluIgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2VyTmFtZSA9ICRMb2dnZWRPblVzZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb21wdXRlck5hbWUgPSAkU2Vzc2lvbkZyb21OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV2VpZ2h0ID0gMgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmV3LU9iamVjdCBQU09iamVjdCAtUHJvcGVydHkgJFByb3BlcnRpZXMgfCBFeHBvcnQtUG93ZXJWaWV3Q1NWIC1PdXRGaWxlICIkT3V0cHV0Rm9sZGVyXCQoJENTVkV4cG9ydFByZWZpeCl1c2VyX3Nlc3Npb25zLmNzdiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgbm8gdXNlciBvYmplY3QgaW4gdGhlIEdDIHdpdGggdGhpcyB1c2VybmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExvZ2dlZE9uVXNlciA9ICIkVXNlck5hbWVAVU5LTk9XTiIKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUHJvcGVydGllcyA9IEB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXNlck5hbWUgPSAkTG9nZ2VkT25Vc2VyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29tcHV0ZXJOYW1lID0gJFNlc3Npb25Gcm9tTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdlaWdodCA9IDIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5ldy1PYmplY3QgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzIHwgRXhwb3J0LVBvd2VyVmlld0NTViAtT3V0RmlsZSAiJE91dHB1dEZvbGRlclwkKCRDU1ZFeHBvcnRQcmVmaXgpdXNlcl9zZXNzaW9ucy5jc3YiCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRMb2dnZWRPblVzZXIgPSAiJFVzZXJOYW1lQCRDb21wdXRlckRvbWFpbiIKICAgICAgICAgICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgPSBAewogICAgICAgICAgICAgICAgICAgICAgICAgICAgVXNlck5hbWUgPSAkTG9nZ2VkT25Vc2VyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb21wdXRlck5hbWUgPSAkU2Vzc2lvbkZyb21OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXZWlnaHQgPSAyCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgTmV3LU9iamVjdCBQU09iamVjdCAtUHJvcGVydHkgJFByb3BlcnRpZXMgfCBFeHBvcnQtUG93ZXJWaWV3Q1NWIC1PdXRGaWxlICIkT3V0cHV0Rm9sZGVyXCQoJENTVkV4cG9ydFByZWZpeCl1c2VyX3Nlc3Npb25zLmNzdiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiRXJyb3IgZXh0cmFjdGluZyBkb21haW4gZnJvbSAkKCRPYmplY3QuU2Vzc2lvbkZyb21OYW1lKSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoJE9iamVjdC5TZXNzaW9uRnJvbSkgewogICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgPSBAewogICAgICAgICAgICAgICAgICAgIFVzZXJOYW1lID0gIiQoJE9iamVjdC5Vc2VyTmFtZSlAVU5LTk9XTiIKICAgICAgICAgICAgICAgICAgICBDb21wdXRlck5hbWUgPSAkT2JqZWN0LlNlc3Npb25Gcm9tCiAgICAgICAgICAgICAgICAgICAgV2VpZ2h0ID0gMgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgTmV3LU9iamVjdCBQU09iamVjdCAtUHJvcGVydHkgJFByb3BlcnRpZXMgfCBFeHBvcnQtUG93ZXJWaWV3Q1NWIC1PdXRGaWxlICIkT3V0cHV0Rm9sZGVyXCQoJENTVkV4cG9ydFByZWZpeCl1c2VyX3Nlc3Npb25zLmNzdiIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICMgYXNzdW1lIEdldC1OZXRMb2dnZWRPbiByZXN1bHQKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgJE1lbWJlclNpbXBsZU5hbWUgPSAiJCgkT2JqZWN0LlVzZXJEb21haW4pXCQoJE9iamVjdC5Vc2VyTmFtZSkiIHwgQ29udmVydC1BRE5hbWUgLUlucHV0VHlwZSAnTlQ0JyAtT3V0cHV0VHlwZSAnQ2Fub25pY2FsJwoKICAgICAgICAgICAgICAgICAgICBpZigkTWVtYmVyU2ltcGxlTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyRG9tYWluID0gJE1lbWJlclNpbXBsZU5hbWUuU3BsaXQoJy8nKVswXQogICAgICAgICAgICAgICAgICAgICAgICAkQWNjb3VudE5hbWUgPSAiJCgkT2JqZWN0LlVzZXJOYW1lKUAkTWVtYmVyRG9tYWluIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEFjY291bnROYW1lID0gIiQoJE9iamVjdC5Vc2VyTmFtZSlAVU5LTk9XTiIKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICAgICAgICAgVXNlck5hbWUgPSAkQWNjb3VudE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgQ29tcHV0ZXJOYW1lID0gJE9iamVjdC5Db21wdXRlck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgV2VpZ2h0ID0gMQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBOZXctT2JqZWN0IFBTT2JqZWN0IC1Qcm9wZXJ0eSAkUHJvcGVydGllcyB8IEV4cG9ydC1Qb3dlclZpZXdDU1YgLU91dEZpbGUgIiRPdXRwdXRGb2xkZXJcJCgkQ1NWRXhwb3J0UHJlZml4KXVzZXJfc2Vzc2lvbnMuY3N2IgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIGNvbnZlcnRpbmcgJCgkT2JqZWN0LlVzZXJEb21haW4pXCQoJE9iamVjdC5Vc2VyTmFtZSkiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZWlmKCRPYmplY3QuUFNPYmplY3QuVHlwZU5hbWVzIC1jb250YWlucyAnUG93ZXJWaWV3Lkdyb3VwTWVtYmVyJykgewogICAgICAgICAgICAkQWNjb3VudE5hbWUgPSAiJCgkT2JqZWN0Lk1lbWJlck5hbWUpQCQoJE9iamVjdC5NZW1iZXJEb21haW4pIgoKICAgICAgICAgICAgaWYgKCRPYmplY3QuTWVtYmVyTmFtZSAtTWF0Y2ggIlxcIikgewogICAgICAgICAgICAgICAgIyBpZiB0aGUgbWVtYmVybmFtZSBpdHNlbGYgY29udGFpbnMgYSBiYWNrc2xhc2gsIGdldCB0aGUgdHJhaWxpbmcgc2VjdGlvbgogICAgICAgICAgICAgICAgIyBUT0RPOiBsYXRlciBwcmVzZXJ2ZSB0aGlzIG9uY2UgQmxvb2RIb3VuZCBjYW4gcHJvcGVybHkgZGlzcGxheSB0aGVzZSBjaGFyYWN0ZXJzCiAgICAgICAgICAgICAgICAkQWNjb3VudE5hbWUgPSAkKCRPYmplY3QuTWVtYmVybmFtZSkuc3BsaXQoJ1wnKVsxXSArICdAJyArICQoJE9iamVjdC5NZW1iZXJEb21haW4pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRHcm91cE5hbWUgPSAiJCgkT2JqZWN0Lkdyb3VwTmFtZSlAJCgkT2JqZWN0Lkdyb3VwRG9tYWluKSIKCiAgICAgICAgICAgIGlmKCRPYmplY3QuSXNHcm91cCkgewogICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgPSBAewogICAgICAgICAgICAgICAgICAgIEFjY291bnROYW1lID0gJEFjY291bnROYW1lCiAgICAgICAgICAgICAgICAgICAgQWNjb3VudFR5cGUgPSAnZ3JvdXAnCiAgICAgICAgICAgICAgICAgICAgR3JvdXBOYW1lID0gJEdyb3VwTmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgTmV3LU9iamVjdCBQU09iamVjdCAtUHJvcGVydHkgJFByb3BlcnRpZXMgfCBFeHBvcnQtUG93ZXJWaWV3Q1NWIC1PdXRGaWxlICIkT3V0cHV0Rm9sZGVyXCQoJENTVkV4cG9ydFByZWZpeClncm91cF9tZW1iZXJzaGlwcy5jc3YiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIC1GdWxsRGF0YSBvYmplY3RzIGFyZSByZXR1cm5lZCwgYW5kIGlmIHNvIGNoZWNrIGlmIHRoZSBncm91cCBtZW1iZXIgaXMgYSBjb21wdXRlciBvYmplY3QKICAgICAgICAgICAgICAgIGlmKCRPYmplY3QuT2JqZWN0Q2xhc3MgLWFuZCAoJE9iamVjdC5PYmplY3RDbGFzcyAtY29udGFpbnMgJ2NvbXB1dGVyJykpIHsKICAgICAgICAgICAgICAgICAgICAkUHJvcGVydGllcyA9IEB7CiAgICAgICAgICAgICAgICAgICAgICAgIEFjY291bnROYW1lID0gJE9iamVjdC5kbnNob3N0bmFtZQogICAgICAgICAgICAgICAgICAgICAgICBBY2NvdW50VHlwZSA9ICdjb21wdXRlcicKICAgICAgICAgICAgICAgICAgICAgICAgR3JvdXBOYW1lID0gJEdyb3VwTmFtZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBOZXctT2JqZWN0IFBTT2JqZWN0IC1Qcm9wZXJ0eSAkUHJvcGVydGllcyB8IEV4cG9ydC1Qb3dlclZpZXdDU1YgLU91dEZpbGUgIiRPdXRwdXRGb2xkZXJcJCgkQ1NWRXhwb3J0UHJlZml4KWdyb3VwX21lbWJlcnNoaXBzLmNzdiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICMgb3RoZXJ3aXNlIHRoZXJlJ3Mgbm8gd2F5IHRvIGRldGVybWluZSBpZiB0aGlzIGlzIGEgY29tcHV0ZXIgb2JqZWN0IG9yIG5vdAogICAgICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICAgICAgICAgQWNjb3VudE5hbWUgPSAkQWNjb3VudE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgQWNjb3VudFR5cGUgPSAndXNlcicKICAgICAgICAgICAgICAgICAgICAgICAgR3JvdXBOYW1lID0gJEdyb3VwTmFtZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBOZXctT2JqZWN0IFBTT2JqZWN0IC1Qcm9wZXJ0eSAkUHJvcGVydGllcyB8IEV4cG9ydC1Qb3dlclZpZXdDU1YgLU91dEZpbGUgIiRPdXRwdXRGb2xkZXJcJCgkQ1NWRXhwb3J0UHJlZml4KWdyb3VwX21lbWJlcnNoaXBzLmNzdiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYoJE9iamVjdC5QU09iamVjdC5UeXBlTmFtZXMgLUNvbnRhaW5zICdQb3dlclZpZXcuVXNlcicpIHsKICAgICAgICAgICAgJEFjY291bnREb21haW4gPSAkT2JqZWN0LkRvbWFpbgogICAgICAgICAgICAkQWNjb3VudE5hbWUgPSAiJCgkT2JqZWN0LlNhbUFjY291bnROYW1lKUAkQWNjb3VudERvbWFpbiIKCiAgICAgICAgICAgIGlmKCRPYmplY3QuUHJpbWFyeUdyb3VwTmFtZSAtYW5kICgkT2JqZWN0LlByaW1hcnlHcm91cE5hbWUgLW5lICcnKSkgewogICAgICAgICAgICAgICAgJFByaW1hcnlHcm91cE5hbWUgPSAiJCgkT2JqZWN0LlByaW1hcnlHcm91cE5hbWUpQCRBY2NvdW50RG9tYWluIgoKICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICAgICBBY2NvdW50TmFtZSA9ICRBY2NvdW50TmFtZQogICAgICAgICAgICAgICAgICAgIEFjY291bnRUeXBlID0gJ3VzZXInCiAgICAgICAgICAgICAgICAgICAgR3JvdXBOYW1lID0gJFByaW1hcnlHcm91cE5hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIE5ldy1PYmplY3QgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzIHwgRXhwb3J0LVBvd2VyVmlld0NTViAtT3V0RmlsZSAiJE91dHB1dEZvbGRlclwkKCRDU1ZFeHBvcnRQcmVmaXgpZ3JvdXBfbWVtYmVyc2hpcHMuY3N2IgogICAgICAgICAgICB9CiAgICAgICAgICAgICMgVE9ETzogZXh0cmFjdCBwd2RsYXN0c2V0L2V0Yy4gYW5kIGluZ2VzdAogICAgICAgIH0KICAgICAgICBlbHNlaWYoKCRPYmplY3QuUFNPYmplY3QuVHlwZU5hbWVzIC1jb250YWlucyAnUG93ZXJWaWV3LkxvY2FsVXNlckFQSScpIC1vciAoJE9iamVjdC5QU09iamVjdC5UeXBlTmFtZXMgLWNvbnRhaW5zICdQb3dlclZpZXcuTG9jYWxVc2VyJykpIHsKICAgICAgICAgICAgJEFjY291bnROYW1lID0gJCgkT2JqZWN0LkFjY291bnROYW1lLnJlcGxhY2UoJy8nLCAnXCcpKS5zcGxpdCgnXCcpWy0xXQoKICAgICAgICAgICAgJE1lbWJlclNpbXBsZU5hbWUgPSBDb252ZXJ0LVNpZFRvTmFtZSAtU0lEICRPYmplY3QuU0lEIHwgQ29udmVydC1BRE5hbWUgLUlucHV0VHlwZSAnTlQ0JyAtT3V0cHV0VHlwZSAnQ2Fub25pY2FsJwoKICAgICAgICAgICAgaWYoJE1lbWJlclNpbXBsZU5hbWUpIHsKICAgICAgICAgICAgICAgICRNZW1iZXJEb21haW4gPSAkTWVtYmVyU2ltcGxlTmFtZS5TcGxpdCgnLycpWzBdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkTWVtYmVyRG9tYWluID0gIlVOS05PV04iCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRBY2NvdW50TmFtZSA9ICIkQWNjb3VudE5hbWVAJE1lbWJlckRvbWFpbiIKCiAgICAgICAgICAgIGlmKCRPYmplY3QuSXNHcm91cCkgewogICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgPSBAewogICAgICAgICAgICAgICAgICAgIEFjY291bnROYW1lID0gJEFjY291bnROYW1lCiAgICAgICAgICAgICAgICAgICAgQWNjb3VudFR5cGUgPSAnZ3JvdXAnCiAgICAgICAgICAgICAgICAgICAgQ29tcHV0ZXJOYW1lID0gJE9iamVjdC5Db21wdXRlck5hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIE5ldy1PYmplY3QgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzIHwgRXhwb3J0LVBvd2VyVmlld0NTViAtT3V0RmlsZSAiJE91dHB1dEZvbGRlclwkKCRDU1ZFeHBvcnRQcmVmaXgpbG9jYWxfYWRtaW5zLmNzdiIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICAgICBBY2NvdW50TmFtZSA9ICRBY2NvdW50TmFtZQogICAgICAgICAgICAgICAgICAgIEFjY291bnRUeXBlID0gJ3VzZXInCiAgICAgICAgICAgICAgICAgICAgQ29tcHV0ZXJOYW1lID0gJE9iamVjdC5Db21wdXRlck5hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIE5ldy1PYmplY3QgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzIHwgRXhwb3J0LVBvd2VyVmlld0NTViAtT3V0RmlsZSAiJE91dHB1dEZvbGRlclwkKCRDU1ZFeHBvcnRQcmVmaXgpbG9jYWxfYWRtaW5zLmNzdiIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYoJE9iamVjdC5QU09iamVjdC5UeXBlTmFtZXMgLWNvbnRhaW5zICdQb3dlclZpZXcuTG9jYWxVc2VyU3BlY2lmaWVkJykgewogICAgICAgICAgICAjIG1hbnVhbGx5IHNwZWNpZmllZCBsb2NhbGdyb3VwIG1lbWJlcnNoaXAgd2hlcmUgcmVzb2x1dGlvbiBoYXBwZW5zIGJ5IHRoZSBjYWxsZWUKCiAgICAgICAgICAgICRBY2NvdW50TmFtZSA9ICIkKCRPYmplY3QuTWVtYmVyTmFtZSlAJCgkT2JqZWN0Lk1lbWJlckRvbWFpbikiCgogICAgICAgICAgICBpZigkT2JqZWN0LklzR3JvdXApIHsKICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICAgICBBY2NvdW50TmFtZSA9ICRBY2NvdW50TmFtZQogICAgICAgICAgICAgICAgICAgIEFjY291bnRUeXBlID0gJ2dyb3VwJwogICAgICAgICAgICAgICAgICAgIENvbXB1dGVyTmFtZSA9ICRPYmplY3QuQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBOZXctT2JqZWN0IFBTT2JqZWN0IC1Qcm9wZXJ0eSAkUHJvcGVydGllcyB8IEV4cG9ydC1Qb3dlclZpZXdDU1YgLU91dEZpbGUgIiRPdXRwdXRGb2xkZXJcJCgkQ1NWRXhwb3J0UHJlZml4KWxvY2FsX2FkbWlucy5jc3YiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkUHJvcGVydGllcyA9IEB7CiAgICAgICAgICAgICAgICAgICAgQWNjb3VudE5hbWUgPSAkQWNjb3VudE5hbWUKICAgICAgICAgICAgICAgICAgICBBY2NvdW50VHlwZSA9ICd1c2VyJwogICAgICAgICAgICAgICAgICAgIENvbXB1dGVyTmFtZSA9ICRPYmplY3QuQ29tcHV0ZXJOYW1lCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBOZXctT2JqZWN0IFBTT2JqZWN0IC1Qcm9wZXJ0eSAkUHJvcGVydGllcyB8IEV4cG9ydC1Qb3dlclZpZXdDU1YgLU91dEZpbGUgIiRPdXRwdXRGb2xkZXJcJCgkQ1NWRXhwb3J0UHJlZml4KWxvY2FsX2FkbWlucy5jc3YiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZWlmKCRPYmplY3QuUFNPYmplY3QuVHlwZU5hbWVzIC1jb250YWlucyAnUG93ZXJWaWV3LkdQT0xvY2FsR3JvdXAnKSB7CiAgICAgICAgICAgIGlmKCFbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkT2JqZWN0LlNJRCkpewogICAgICAgICAgICAgICAgJE1lbWJlclNpbXBsZU5hbWUgPSBDb252ZXJ0LVNpZFRvTmFtZSAtU0lEICRPYmplY3QuT2JqZWN0U0lEIHwgQ29udmVydC1BRE5hbWUgLUlucHV0VHlwZSAnTlQ0JyAtT3V0cHV0VHlwZSAnQ2Fub25pY2FsJwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkTWVtYmVyU2ltcGxlTmFtZSkgewogICAgICAgICAgICAgICAgJE1lbWJlckRvbWFpbiA9ICRNZW1iZXJTaW1wbGVOYW1lLlNwbGl0KCcvJylbMF0KICAgICAgICAgICAgICAgICRBY2NvdW50TmFtZSA9ICIkKCRPYmplY3QuT2JqZWN0TmFtZSlAJE1lbWJlckRvbWFpbiIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRBY2NvdW50TmFtZSA9ICRPYmplY3QuT2JqZWN0TmFtZQogICAgICAgICAgICB9CgogICAgICAgICAgICBGb3JFYWNoKCRDb21wdXRlciBpbiAkT2JqZWN0LkNvbXB1dGVyTmFtZSkgewogICAgICAgICAgICAgICAgaWYoJE9iamVjdC5Jc0dyb3VwKSB7CiAgICAgICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgPSBAewogICAgICAgICAgICAgICAgICAgICAgICBBY2NvdW50TmFtZSA9ICRBY2NvdW50TmFtZQogICAgICAgICAgICAgICAgICAgICAgICBBY2NvdW50VHlwZSA9ICdncm91cCcKICAgICAgICAgICAgICAgICAgICAgICAgQ29tcHV0ZXJOYW1lID0gJENvbXB1dGVyCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIE5ldy1PYmplY3QgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzIHwgRXhwb3J0LVBvd2VyVmlld0NTViAtT3V0RmlsZSAiJE91dHB1dEZvbGRlclwkKCRDU1ZFeHBvcnRQcmVmaXgpbG9jYWxfYWRtaW5zLmNzdiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRQcm9wZXJ0aWVzID0gQHsKICAgICAgICAgICAgICAgICAgICAgICAgQWNjb3VudE5hbWUgPSAkQWNjb3VudE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgQWNjb3VudFR5cGUgPSAndXNlcicKICAgICAgICAgICAgICAgICAgICAgICAgQ29tcHV0ZXJOYW1lID0gJENvbXB1dGVyCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIE5ldy1PYmplY3QgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzIHwgRXhwb3J0LVBvd2VyVmlld0NTViAtT3V0RmlsZSAiJE91dHB1dEZvbGRlclwkKCRDU1ZFeHBvcnRQcmVmaXgpbG9jYWxfYWRtaW5zLmNzdiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYoJE9iamVjdC5QU09iamVjdC5UeXBlTmFtZXMgLWNvbnRhaW5zICdQb3dlclZpZXcuRG9tYWluVHJ1c3RMREFQJykgewogICAgICAgICAgICAjIFt1aW50MzJdJzB4MDAwMDAwMDEnID0gJ25vbl90cmFuc2l0aXZlJwogICAgICAgICAgICAjIFt1aW50MzJdJzB4MDAwMDAwMDInID0gJ3VwbGV2ZWxfb25seScKICAgICAgICAgICAgIyBbdWludDMyXScweDAwMDAwMDA0JyA9ICdxdWFyYW50aW5lZF9kb21haW4nCiAgICAgICAgICAgICMgW3VpbnQzMl0nMHgwMDAwMDAwOCcgPSAnZm9yZXN0X3RyYW5zaXRpdmUnCiAgICAgICAgICAgICMgW3VpbnQzMl0nMHgwMDAwMDAxMCcgPSAnY3Jvc3Nfb3JnYW5pemF0aW9uJwogICAgICAgICAgICAjIFt1aW50MzJdJzB4MDAwMDAwMjAnID0gJ3dpdGhpbl9mb3Jlc3QnCiAgICAgICAgICAgICMgW3VpbnQzMl0nMHgwMDAwMDA0MCcgPSAndHJlYXRfYXNfZXh0ZXJuYWwnCiAgICAgICAgICAgICMgW3VpbnQzMl0nMHgwMDAwMDA4MCcgPSAndHJ1c3RfdXNlc19yYzRfZW5jcnlwdGlvbicKICAgICAgICAgICAgIyBbdWludDMyXScweDAwMDAwMTAwJyA9ICd0cnVzdF91c2VzX2Flc19rZXlzJwogICAgICAgICAgICAjIFt1aW50MzJdJzB4MDAwMDAyMDAnID0gJ2Nyb3NzX29yZ2FuaXphdGlvbl9ub190Z3RfZGVsZWdhdGlvbicKICAgICAgICAgICAgIyBbdWludDMyXScweDAwMDAwNDAwJyA9ICdwaW1fdHJ1c3QnCiAgICAgICAgICAgIGlmKCRPYmplY3QuU291cmNlRG9tYWluKSB7CiAgICAgICAgICAgICAgICAkU291cmNlRG9tYWluID0gJE9iamVjdC5Tb3VyY2VEb21haW4KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRTb3VyY2VEb21haW4gPSAkT2JqZWN0LlNvdXJjZU5hbWUKICAgICAgICAgICAgfQogICAgICAgICAgICBpZigkT2JqZWN0LlRhcmdldERvbWFpbikgewogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbiA9ICRPYmplY3QuVGFyZ2V0RG9tYWluCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkVGFyZ2V0RG9tYWluID0gJE9iamVjdC5UYXJnZXROYW1lCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRUcnVzdFR5cGUgPSBTd2l0Y2ggKCRPYmplY3QuVHJ1c3RUeXBlKSB7CiAgICAgICAgICAgICAgICAnY3Jvc3Nfb3JnYW5pemF0aW9uJyAgICB7ICdDcm9zc0xpbmsnIH0KICAgICAgICAgICAgICAgICd3aXRoaW5fZm9yZXN0JyAgICAgICAgIHsgJ1BhcmVudENoaWxkJyB9CiAgICAgICAgICAgICAgICAnZm9yZXN0X3RyYW5zaXRpdmUnICAgICB7ICdGb3Jlc3QnIH0KICAgICAgICAgICAgICAgICd0cmVhdF9hc19leHRlcm5hbCcgICAgIHsgJ0V4dGVybmFsJyB9CiAgICAgICAgICAgICAgICAnRGVmYXVsdCcgICAgICAgICAgICAgICB7ICdVbmtub3duJyB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgkT2JqZWN0LlRydXN0VHlwZSAtbWF0Y2ggJ25vbl90cmFuc2l0aXZlJykgewogICAgICAgICAgICAgICAgJFRyYW5zaXRpdmUgPSAkRmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRUcmFuc2l0aXZlID0gJFRydWUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJFByb3BlcnRpZXMgPSBAewogICAgICAgICAgICAgICAgU291cmNlRG9tYWluID0gJFNvdXJjZURvbWFpbgogICAgICAgICAgICAgICAgVGFyZ2V0RG9tYWluID0gJFRhcmdldERvbWFpbgogICAgICAgICAgICAgICAgVHJ1c3REaXJlY3Rpb24gPSAkT2JqZWN0LlRydXN0RGlyZWN0aW9uCiAgICAgICAgICAgICAgICBUcnVzdFR5cGUgPSAkVHJ1c3RUeXBlCiAgICAgICAgICAgICAgICBUcmFuc2l0aXZlID0gIiRUcmFuc2l0aXZlIgogICAgICAgICAgICB9CiAgICAgICAgICAgIE5ldy1PYmplY3QgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzIHwgRXhwb3J0LVBvd2VyVmlld0NTViAtT3V0RmlsZSAiJE91dHB1dEZvbGRlclwkKCRDU1ZFeHBvcnRQcmVmaXgpdHJ1c3RzLmNzdiIKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCRPYmplY3QuUFNPYmplY3QuVHlwZU5hbWVzIC1jb250YWlucyAnUG93ZXJWaWV3LkRvbWFpblRydXN0JykgewogICAgICAgICAgICBpZigkT2JqZWN0LlNvdXJjZURvbWFpbikgewogICAgICAgICAgICAgICAgJFNvdXJjZURvbWFpbiA9ICRPYmplY3QuU291cmNlRG9tYWluCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkU291cmNlRG9tYWluID0gJE9iamVjdC5Tb3VyY2VOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJE9iamVjdC5UYXJnZXREb21haW4pIHsKICAgICAgICAgICAgICAgICRUYXJnZXREb21haW4gPSAkT2JqZWN0LlRhcmdldERvbWFpbgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbiA9ICRPYmplY3QuVGFyZ2V0TmFtZQogICAgICAgICAgICB9CgogICAgICAgICAgICAkUHJvcGVydGllcyA9IEB7CiAgICAgICAgICAgICAgICBTb3VyY2VEb21haW4gPSAkU291cmNlRG9tYWluCiAgICAgICAgICAgICAgICBUYXJnZXREb21haW4gPSAkVGFyZ2V0RG9tYWluCiAgICAgICAgICAgICAgICBUcnVzdERpcmVjdGlvbiA9ICRPYmplY3QuVHJ1c3REaXJlY3Rpb24KICAgICAgICAgICAgICAgIFRydXN0VHlwZSA9ICRPYmplY3QuVHJ1c3RUeXBlCiAgICAgICAgICAgICAgICBUcmFuc2l0aXZlID0gIiRUcnVlIgogICAgICAgICAgICB9CiAgICAgICAgICAgIE5ldy1PYmplY3QgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzIHwgRXhwb3J0LVBvd2VyVmlld0NTViAtT3V0RmlsZSAiJE91dHB1dEZvbGRlclwkKCRDU1ZFeHBvcnRQcmVmaXgpdHJ1c3RzLmNzdiIKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCRPYmplY3QuUFNPYmplY3QuVHlwZU5hbWVzIC1jb250YWlucyAnUG93ZXJWaWV3LkZvcmVzdFRydXN0JykgewogICAgICAgICAgICBpZigkT2JqZWN0LlNvdXJjZURvbWFpbikgewogICAgICAgICAgICAgICAgJFNvdXJjZURvbWFpbiA9ICRPYmplY3QuU291cmNlRG9tYWluCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkU291cmNlRG9tYWluID0gJE9iamVjdC5Tb3VyY2VOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJE9iamVjdC5UYXJnZXREb21haW4pIHsKICAgICAgICAgICAgICAgICRUYXJnZXREb21haW4gPSAkT2JqZWN0LlRhcmdldERvbWFpbgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbiA9ICRPYmplY3QuVGFyZ2V0TmFtZQogICAgICAgICAgICB9CgogICAgICAgICAgICAkUHJvcGVydGllcyA9IEB7CiAgICAgICAgICAgICAgICBTb3VyY2VEb21haW4gPSAkU291cmNlRG9tYWluCiAgICAgICAgICAgICAgICBUYXJnZXREb21haW4gPSAkVGFyZ2V0RG9tYWluCiAgICAgICAgICAgICAgICBUcnVzdERpcmVjdGlvbiA9ICRPYmplY3QuVHJ1c3REaXJlY3Rpb24KICAgICAgICAgICAgICAgIFRydXN0VHlwZSA9ICdGb3Jlc3QnCiAgICAgICAgICAgICAgICBUcmFuc2l0aXZlID0gIiRUcnVlIgogICAgICAgICAgICB9CiAgICAgICAgICAgIE5ldy1PYmplY3QgUFNPYmplY3QgLVByb3BlcnR5ICRQcm9wZXJ0aWVzIHwgRXhwb3J0LVBvd2VyVmlld0NTViAtT3V0RmlsZSAiJE91dHB1dEZvbGRlclwkKCRDU1ZFeHBvcnRQcmVmaXgpdHJ1c3RzLmNzdiIKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIk5vIG1hdGNoaW5nIHR5cGUgbmFtZSIKICAgICAgICB9CiAgICB9Cn0KCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojCiMgRXhwb3NlIHRoZSBXaW4zMkFQSSBmdW5jdGlvbnMgYW5kIGRhdGFzdHJ1Y3R1cmVzIGJlbG93CiMgdXNpbmcgUFNSZWZsZWN0LgojIFdhcm5pbmc6IE9uY2UgdGhlc2UgYXJlIGV4ZWN1dGVkLCB0aGV5IGFyZSBiYWtlZCBpbgojIGFuZCBjYW4ndCBiZSBjaGFuZ2VkIHdoaWxlIHRoZSBzY3JpcHQgaXMgcnVubmluZyEKIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKJE1vZCA9IE5ldy1Jbk1lbW9yeU1vZHVsZSAtTW9kdWxlTmFtZSBXaW4zMgoKIyBhbGwgb2YgdGhlIFdpbjMyIEFQSSBmdW5jdGlvbnMgd2UgbmVlZAokRnVuY3Rpb25EZWZpbml0aW9ucyA9IEAoCiAgICAoZnVuYyBuZXRhcGkzMiBOZXRTaGFyZUVudW0gKFtJbnRdKSBAKFtTdHJpbmddLCBbSW50XSwgW0ludFB0cl0uTWFrZUJ5UmVmVHlwZSgpLCBbSW50XSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpLCBbSW50MzJdLk1ha2VCeVJlZlR5cGUoKSkpLAogICAgKGZ1bmMgbmV0YXBpMzIgTmV0V2tzdGFVc2VyRW51bSAoW0ludF0pIEAoW1N0cmluZ10sIFtJbnRdLCBbSW50UHRyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnRdLCBbSW50MzJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpKSksCiAgICAoZnVuYyBuZXRhcGkzMiBOZXRTZXNzaW9uRW51bSAoW0ludF0pIEAoW1N0cmluZ10sIFtTdHJpbmddLCBbU3RyaW5nXSwgW0ludF0sIFtJbnRQdHJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludF0sIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpLCBbSW50MzJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCkpKSwKICAgIChmdW5jIG5ldGFwaTMyIE5ldExvY2FsR3JvdXBHZXRNZW1iZXJzIChbSW50XSkgQChbU3RyaW5nXSwgW1N0cmluZ10sIFtJbnRdLCBbSW50UHRyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnRdLCBbSW50MzJdLk1ha2VCeVJlZlR5cGUoKSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpKSksCiAgICAoZnVuYyBuZXRhcGkzMiBEc0dldFNpdGVOYW1lIChbSW50XSkgQChbU3RyaW5nXSwgW0ludFB0cl0uTWFrZUJ5UmVmVHlwZSgpKSksCiAgICAoZnVuYyBuZXRhcGkzMiBEc0VudW1lcmF0ZURvbWFpblRydXN0cyAoW0ludF0pIEAoW1N0cmluZ10sIFtVSW50MzJdLCBbSW50UHRyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnRQdHJdLk1ha2VCeVJlZlR5cGUoKSkpLAogICAgKGZ1bmMgbmV0YXBpMzIgTmV0QXBpQnVmZmVyRnJlZSAoW0ludF0pIEAoW0ludFB0cl0pKSwKICAgIChmdW5jIGFkdmFwaTMyIENvbnZlcnRTaWRUb1N0cmluZ1NpZCAoW0ludF0pIEAoW0ludFB0cl0sIFtTdHJpbmddLk1ha2VCeVJlZlR5cGUoKSkgLVNldExhc3RFcnJvciksCiAgICAoZnVuYyBhZHZhcGkzMiBPcGVuU0NNYW5hZ2VyVyAoW0ludFB0cl0pIEAoW1N0cmluZ10sIFtTdHJpbmddLCBbSW50XSkgLVNldExhc3RFcnJvciksCiAgICAoZnVuYyBhZHZhcGkzMiBDbG9zZVNlcnZpY2VIYW5kbGUgKFtJbnRdKSBAKFtJbnRQdHJdKSksCiAgICAoZnVuYyB3dHNhcGkzMiBXVFNPcGVuU2VydmVyRXggKFtJbnRQdHJdKSBAKFtTdHJpbmddKSksCiAgICAoZnVuYyB3dHNhcGkzMiBXVFNFbnVtZXJhdGVTZXNzaW9uc0V4IChbSW50XSkgQChbSW50UHRyXSwgW0ludDMyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnRdLCBbSW50UHRyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpKSAtU2V0TGFzdEVycm9yKSwKICAgIChmdW5jIHd0c2FwaTMyIFdUU1F1ZXJ5U2Vzc2lvbkluZm9ybWF0aW9uIChbSW50XSkgQChbSW50UHRyXSwgW0ludF0sIFtJbnRdLCBbSW50UHRyXS5NYWtlQnlSZWZUeXBlKCksIFtJbnQzMl0uTWFrZUJ5UmVmVHlwZSgpKSAtU2V0TGFzdEVycm9yKSwKICAgIChmdW5jIHd0c2FwaTMyIFdUU0ZyZWVNZW1vcnlFeCAoW0ludF0pIEAoW0ludDMyXSwgW0ludFB0cl0sIFtJbnQzMl0pKSwKICAgIChmdW5jIHd0c2FwaTMyIFdUU0ZyZWVNZW1vcnkgKFtJbnRdKSBAKFtJbnRQdHJdKSksCiAgICAoZnVuYyB3dHNhcGkzMiBXVFNDbG9zZVNlcnZlciAoW0ludF0pIEAoW0ludFB0cl0pKQopCgojIGVudW0gdXNlZCBieSAkV1RTX1NFU1NJT05fSU5GT18xIGJlbG93CiRXVFNDb25uZWN0U3RhdGUgPSBwc2VudW0gJE1vZCBXVFNfQ09OTkVDVFNUQVRFX0NMQVNTIFVJbnQxNiBAewogICAgQWN0aXZlICAgICAgID0gICAgMAogICAgQ29ubmVjdGVkICAgID0gICAgMQogICAgQ29ubmVjdFF1ZXJ5ID0gICAgMgogICAgU2hhZG93ICAgICAgID0gICAgMwogICAgRGlzY29ubmVjdGVkID0gICAgNAogICAgSWRsZSAgICAgICAgID0gICAgNQogICAgTGlzdGVuICAgICAgID0gICAgNgogICAgUmVzZXQgICAgICAgID0gICAgNwogICAgRG93biAgICAgICAgID0gICAgOAogICAgSW5pdCAgICAgICAgID0gICAgOQp9CgojIHRoZSBXVFNFbnVtZXJhdGVTZXNzaW9uc0V4IHJlc3VsdCBzdHJ1Y3R1cmUKJFdUU19TRVNTSU9OX0lORk9fMSA9IHN0cnVjdCAkTW9kIFdUU19TRVNTSU9OX0lORk9fMSBAewogICAgRXhlY0VudklkID0gZmllbGQgMCBVSW50MzIKICAgIFN0YXRlID0gZmllbGQgMSAkV1RTQ29ubmVjdFN0YXRlCiAgICBTZXNzaW9uSWQgPSBmaWVsZCAyIFVJbnQzMgogICAgcFNlc3Npb25OYW1lID0gZmllbGQgMyBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgcEhvc3ROYW1lID0gZmllbGQgNCBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgcFVzZXJOYW1lID0gZmllbGQgNSBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgcERvbWFpbk5hbWUgPSBmaWVsZCA2IFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICBwRmFybU5hbWUgPSBmaWVsZCA3IFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCn0KCiMgdGhlIHBhcnRpY3VsYXIgV1RTUXVlcnlTZXNzaW9uSW5mb3JtYXRpb24gcmVzdWx0IHN0cnVjdHVyZQokV1RTX0NMSUVOVF9BRERSRVNTID0gc3RydWN0ICRtb2QgV1RTX0NMSUVOVF9BRERSRVNTIEB7CiAgICBBZGRyZXNzRmFtaWx5ID0gZmllbGQgMCBVSW50MzIKICAgIEFkZHJlc3MgPSBmaWVsZCAxIEJ5dGVbXSAtTWFyc2hhbEFzIEAoJ0J5VmFsQXJyYXknLCAyMCkKfQoKIyB0aGUgTmV0U2hhcmVFbnVtIHJlc3VsdCBzdHJ1Y3R1cmUKJFNIQVJFX0lORk9fMSA9IHN0cnVjdCAkTW9kIFNIQVJFX0lORk9fMSBAewogICAgc2hpMV9uZXRuYW1lID0gZmllbGQgMCBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgc2hpMV90eXBlID0gZmllbGQgMSBVSW50MzIKICAgIHNoaTFfcmVtYXJrID0gZmllbGQgMiBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQp9CgojIHRoZSBOZXRXa3N0YVVzZXJFbnVtIHJlc3VsdCBzdHJ1Y3R1cmUKJFdLU1RBX1VTRVJfSU5GT18xID0gc3RydWN0ICRNb2QgV0tTVEFfVVNFUl9JTkZPXzEgQHsKICAgIHdrdWkxX3VzZXJuYW1lID0gZmllbGQgMCBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgd2t1aTFfbG9nb25fZG9tYWluID0gZmllbGQgMSBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgd2t1aTFfb3RoX2RvbWFpbnMgPSBmaWVsZCAyIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICB3a3VpMV9sb2dvbl9zZXJ2ZXIgPSBmaWVsZCAzIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCn0KCiMgdGhlIE5ldFNlc3Npb25FbnVtIHJlc3VsdCBzdHJ1Y3R1cmUKJFNFU1NJT05fSU5GT18xMCA9IHN0cnVjdCAkTW9kIFNFU1NJT05fSU5GT18xMCBAewogICAgc2VzaTEwX2NuYW1lID0gZmllbGQgMCBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgc2VzaTEwX3VzZXJuYW1lID0gZmllbGQgMSBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgc2VzaTEwX3RpbWUgPSBmaWVsZCAyIFVJbnQzMgogICAgc2VzaTEwX2lkbGVfdGltZSA9IGZpZWxkIDMgVUludDMyCn0KCiMgZW51bSB1c2VkIGJ5ICRMT0NBTEdST1VQX01FTUJFUlNfSU5GT18yIGJlbG93CiRTSURfTkFNRV9VU0UgPSBwc2VudW0gJE1vZCBTSURfTkFNRV9VU0UgVUludDE2IEB7CiAgICBTaWRUeXBlVXNlciAgICAgICAgICAgICA9IDEKICAgIFNpZFR5cGVHcm91cCAgICAgICAgICAgID0gMgogICAgU2lkVHlwZURvbWFpbiAgICAgICAgICAgPSAzCiAgICBTaWRUeXBlQWxpYXMgICAgICAgICAgICA9IDQKICAgIFNpZFR5cGVXZWxsS25vd25Hcm91cCAgID0gNQogICAgU2lkVHlwZURlbGV0ZWRBY2NvdW50ICAgPSA2CiAgICBTaWRUeXBlSW52YWxpZCAgICAgICAgICA9IDcKICAgIFNpZFR5cGVVbmtub3duICAgICAgICAgID0gOAogICAgU2lkVHlwZUNvbXB1dGVyICAgICAgICAgPSA5Cn0KCiMgdGhlIE5ldExvY2FsR3JvdXBHZXRNZW1iZXJzIHJlc3VsdCBzdHJ1Y3R1cmUKJExPQ0FMR1JPVVBfTUVNQkVSU19JTkZPXzIgPSBzdHJ1Y3QgJE1vZCBMT0NBTEdST1VQX01FTUJFUlNfSU5GT18yIEB7CiAgICBsZ3JtaTJfc2lkID0gZmllbGQgMCBJbnRQdHIKICAgIGxncm1pMl9zaWR1c2FnZSA9IGZpZWxkIDEgJFNJRF9OQU1FX1VTRQogICAgbGdybWkyX2RvbWFpbmFuZG5hbWUgPSBmaWVsZCAyIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCn0KCiMgZW51bXMgdXNlZCBpbiBEU19ET01BSU5fVFJVU1RTCiREc0RvbWFpbkZsYWcgPSBwc2VudW0gJE1vZCBEc0RvbWFpbi5GbGFncyBVSW50MzIgQHsKICAgIElOX0ZPUkVTVCAgICAgICA9IDEKICAgIERJUkVDVF9PVVRCT1VORCA9IDIKICAgIFRSRUVfUk9PVCAgICAgICA9IDQKICAgIFBSSU1BUlkgICAgICAgICA9IDgKICAgIE5BVElWRV9NT0RFICAgICA9IDE2CiAgICBESVJFQ1RfSU5CT1VORCAgPSAzMgp9IC1CaXRmaWVsZAokRHNEb21haW5UcnVzdFR5cGUgPSBwc2VudW0gJE1vZCBEc0RvbWFpbi5UcnVzdFR5cGUgVUludDMyIEB7CiAgICBET1dOTEVWRUwgICA9IDEKICAgIFVQTEVWRUwgICAgID0gMgogICAgTUlUICAgICAgICAgPSAzCiAgICBEQ0UgICAgICAgICA9IDQKfQokRHNEb21haW5UcnVzdEF0dHJpYnV0ZXMgPSBwc2VudW0gJE1vZCBEc0RvbWFpbi5UcnVzdEF0dHJpYnV0ZXMgVUludDMyIEB7CiAgICBOT05fVFJBTlNJVElWRSAgICAgID0gMQogICAgVVBMRVZFTF9PTkxZICAgICAgICA9IDIKICAgIEZJTFRFUl9TSURTICAgICAgICAgPSA0CiAgICBGT1JFU1RfVFJBTlNJVElWRSAgID0gOAogICAgQ1JPU1NfT1JHQU5JWkFUSU9OICA9IDE2CiAgICBXSVRISU5fRk9SRVNUICAgICAgID0gMzIKICAgIFRSRUFUX0FTX0VYVEVSTkFMICAgPSA2NAp9CgojIHRoZSBEc0VudW1lcmF0ZURvbWFpblRydXN0cyByZXN1bHQgc3RydWN0dXJlCiREU19ET01BSU5fVFJVU1RTID0gc3RydWN0ICRNb2QgRFNfRE9NQUlOX1RSVVNUUyBAewogICAgTmV0Ymlvc0RvbWFpbk5hbWUgPSBmaWVsZCAwIFN0cmluZyAtTWFyc2hhbEFzIEAoJ0xQV1N0cicpCiAgICBEbnNEb21haW5OYW1lID0gZmllbGQgMSBTdHJpbmcgLU1hcnNoYWxBcyBAKCdMUFdTdHInKQogICAgRmxhZ3MgPSBmaWVsZCAyICREc0RvbWFpbkZsYWcKICAgIFBhcmVudEluZGV4ID0gZmllbGQgMyBVSW50MzIKICAgIFRydXN0VHlwZSA9IGZpZWxkIDQgJERzRG9tYWluVHJ1c3RUeXBlCiAgICBUcnVzdEF0dHJpYnV0ZXMgPSBmaWVsZCA1ICREc0RvbWFpblRydXN0QXR0cmlidXRlcwogICAgRG9tYWluU2lkID0gZmllbGQgNiBJbnRQdHIKICAgIERvbWFpbkd1aWQgPSBmaWVsZCA3IEd1aWQKfQoKJFR5cGVzID0gJEZ1bmN0aW9uRGVmaW5pdGlvbnMgfCBBZGQtV2luMzJUeXBlIC1Nb2R1bGUgJE1vZCAtTmFtZXNwYWNlICdXaW4zMicKJE5ldGFwaTMyID0gJFR5cGVzWyduZXRhcGkzMiddCiRBZHZhcGkzMiA9ICRUeXBlc1snYWR2YXBpMzInXQokV3RzYXBpMzIgPSAkVHlwZXNbJ3d0c2FwaTMyJ10K
