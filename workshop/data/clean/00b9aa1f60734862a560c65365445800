xPDT.psm1,2ae6fe8985046183e86f8f1a7ffa992b,Scan result is 1. IsMalware: 0,w6/Cu8K/ZGF0YSBMb2NhbGl6ZWREYXRhCnsKICAgIENvbnZlcnRGcm9tLVN0cmluZ0RhdGEgQCcKCkZpbGVOb3RGb3VuZD1GaWxlIG5vdCBmb3VuZCBpbiB0aGUgZW52aXJvbm1lbnQgcGF0aApBYnNvbHV0ZVBhdGhPckZpbGVOYW1lPUFic29sdXRlIHBhdGggb3IgZmlsZSBuYW1lIGV4cGVjdGVkCkludmFsaWRBcmd1bWVudD1JbnZhbGlkIGFyZ3VtZW50OiAnezB9JyB3aXRoIHZhbHVlOiAnezF9JwpJbnZhbGlkQXJndW1lbnRBbmRNZXNzYWdlPXswfSB7MX0KRXJyb3JTdGFydGluZz1GYWlsdXJlIHN0YXJ0aW5nIHByb2Nlc3MgbWF0Y2hpbmcgcGF0aCAnezB9Jy4gTWVzc2FnZTogezF9CkZhaWx1cmVXYWl0aW5nRm9yUHJvY2Vzc2VzVG9TdGFydD1GYWlsZWQgdG8gd2FpdCBmb3IgcHJvY2Vzc2VzIHRvIHN0YXJ0ClByb2Nlc3NTdGFydGVkPVByb2Nlc3MgbWF0Y2hpbmcgcGF0aCAnezB9JyBzdGFydGVkIGluIHByb2Nlc3MgSUQgezF9ClByb2Nlc3NBbHJlYWR5U3RhcnRlZD1Qcm9jZXNzIG1hdGNoaW5nIHBhdGggJ3swfScgYWxyZWFkeSBzdGFydGVkIGluIHByb2Nlc3MgSUQgezF9CidACn0KCkltcG9ydC1Mb2NhbGl6ZWREYXRhIExvY2FsaXplZERhdGEgLWZpbGVuYW1lIHhQRFQuc3RyaW5ncy5wc2QxCgpmdW5jdGlvbiBUaHJvd0ludmFsaWRBcmd1bWVudEVycm9yCnsKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbQogICAgKAogICAgICAgIFtwYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkZXJyb3JJZCwKCiAgICAgICAgW3BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRlcnJvck1lc3NhZ2UKICAgICkKCiAgICAkZXJyb3JDYXRlZ29yeT1bU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5FcnJvckNhdGVnb3J5XTo6SW52YWxpZEFyZ3VtZW50CiAgICAkZXhjZXB0aW9uID0gTmV3LU9iamVjdCBTeXN0ZW0uQXJndW1lbnRFeGNlcHRpb24gJGVycm9yTWVzc2FnZTsKICAgICRlcnJvclJlY29yZCA9IE5ldy1PYmplY3QgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5FcnJvclJlY29yZCAkZXhjZXB0aW9uLCAkZXJyb3JJZCwgJGVycm9yQ2F0ZWdvcnksICRudWxsCiAgICB0aHJvdyAkZXJyb3JSZWNvcmQKfQoKZnVuY3Rpb24gUmVzb2x2ZVBhdGgKewogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtCiAgICAoCiAgICAgICAgW3BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3lzdGVtLlN0cmluZ10KICAgICAgICAkUGF0aAogICAgKQoKICAgICRQYXRoID0gW0Vudmlyb25tZW50XTo6RXhwYW5kRW52aXJvbm1lbnRWYXJpYWJsZXMoJFBhdGgpCiAgICBpZihJc1Jvb3RlZFBhdGggJFBhdGgpCiAgICB7CiAgICAgICAgaWYoIShUZXN0LVBhdGggJFBhdGggLVBhdGhUeXBlIExlYWYpKQogICAgICAgIHsKICAgICAgICAgICAgVGhyb3dJbnZhbGlkQXJndW1lbnRFcnJvciAiQ2Fubm90RmluZFJvb3RlZFBhdGgiICgkTG9jYWxpemVkRGF0YS5JbnZhbGlkQXJndW1lbnRBbmRNZXNzYWdlIC1mICgkTG9jYWxpemVkRGF0YS5JbnZhbGlkQXJndW1lbnQgLWYgIlBhdGgiLCRQYXRoKSwgJExvY2FsaXplZERhdGEuRmlsZU5vdEZvdW5kKQogICAgICAgIH0KICAgICAgICByZXR1cm4gJFBhdGgKICAgIH0KICAgIGlmKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRlbnY6UGF0aCkpCiAgICB7CiAgICAgICAgVGhyb3dJbnZhbGlkQXJndW1lbnRFcnJvciAiRW1wdHlFbnZpcm9ubWVudFBhdGgiICgkTG9jYWxpemVkRGF0YS5JbnZhbGlkQXJndW1lbnRBbmRNZXNzYWdlIC1mICgkTG9jYWxpemVkRGF0YS5JbnZhbGlkQXJndW1lbnQgLWYgIlBhdGgiLCRQYXRoKSwgJExvY2FsaXplZERhdGEuRmlsZU5vdEZvdW5kKQogICAgfQogICAgaWYoKFNwbGl0LVBhdGggJFBhdGggLUxlYWYpIC1uZSAkUGF0aCkKICAgIHsKICAgICAgICBUaHJvd0ludmFsaWRBcmd1bWVudEVycm9yICJOb3RBYnNvbHV0ZVBhdGhPckZpbGVOYW1lIiAoJExvY2FsaXplZERhdGEuSW52YWxpZEFyZ3VtZW50QW5kTWVzc2FnZSAtZiAoJExvY2FsaXplZERhdGEuSW52YWxpZEFyZ3VtZW50IC1mICJQYXRoIiwkUGF0aCksICRMb2NhbGl6ZWREYXRhLkFic29sdXRlUGF0aE9yRmlsZU5hbWUpCiAgICB9CiAgICBmb3JlYWNoKCRyYXdTZWdtZW50IGluICRlbnY6UGF0aC5TcGxpdCgiOyIpKQogICAgewogICAgICAgICRzZWdtZW50ID0gW0Vudmlyb25tZW50XTo6RXhwYW5kRW52aXJvbm1lbnRWYXJpYWJsZXMoJHJhd1NlZ21lbnQpCiAgICAgICAgJHNlZ21lbnRSb290ZWQgPSAkZmFsc2UKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgICRzZWdtZW50Um9vdGVkPVtJTy5QYXRoXTo6SXNQYXRoUm9vdGVkKCRzZWdtZW50KQogICAgICAgIH0KICAgICAgICBjYXRjaCB7fQogICAgICAgIGlmKCEkc2VnbWVudFJvb3RlZCkKICAgICAgICB7CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgfQogICAgICAgICRjYW5kaWRhdGUgPSBqb2luLXBhdGggJHNlZ21lbnQgJFBhdGgKICAgICAgICBpZihUZXN0LVBhdGggJGNhbmRpZGF0ZSAtUGF0aFR5cGUgTGVhZikKICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiAkY2FuZGlkYXRlCiAgICAgICAgfQogICAgfQogICAgVGhyb3dJbnZhbGlkQXJndW1lbnRFcnJvciAiQ2Fubm90RmluZFJlbGF0aXZlUGF0aCIgKCRMb2NhbGl6ZWREYXRhLkludmFsaWRBcmd1bWVudEFuZE1lc3NhZ2UgLWYgKCRMb2NhbGl6ZWREYXRhLkludmFsaWRBcmd1bWVudCAtZiAiUGF0aCIsJFBhdGgpLCAkTG9jYWxpemVkRGF0YS5GaWxlTm90Rm91bmQpCn0KCmZ1bmN0aW9uIElzUm9vdGVkUGF0aAp7CiAgICBwYXJhbQogICAgKAogICAgICAgIFtwYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkUGF0aAogICAgKQoKICAgIHRyeQogICAgewogICAgICAgIHJldHVybiBbSU8uUGF0aF06OklzUGF0aFJvb3RlZCgkUGF0aCkKICAgIH0KICAgIGNhdGNoCiAgICB7CiAgICAgICAgVGhyb3dJbnZhbGlkQXJndW1lbnRFcnJvciAiQ2Fubm90R2V0SXNQYXRoUm9vdGVkIiAoJExvY2FsaXplZERhdGEuSW52YWxpZEFyZ3VtZW50QW5kTWVzc2FnZSAtZiAoJExvY2FsaXplZERhdGEuSW52YWxpZEFyZ3VtZW50IC1mICJQYXRoIiwkUGF0aCksICRfLkV4Y2VwdGlvbi5NZXNzYWdlKQogICAgfQp9CgpmdW5jdGlvbiBFeHRyYWN0QXJndW1lbnRzCnsKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbQogICAgKAogICAgICAgIFtwYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgICRmdW5jdGlvbkJvdW5kUGFyYW1ldGVycywKICAgICAgICAKICAgICAgICBbcGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICBbc3RyaW5nW11dCiAgICAgICAgJGFyZ3VtZW50TmFtZXMsCiAgICAgICAgCiAgICAgICAgW3N0cmluZ1tdXQogICAgICAgICRuZXdBcmd1bWVudE5hbWVzCiAgICApCgogICAgJHJldHVyblZhbHVlPUB7fQoKICAgIGZvcigkaT0wOyRpIC1sdCAkYXJndW1lbnROYW1lcy5Db3VudDskaSsrKQogICAgewogICAgICAgICRhcmd1bWVudE5hbWUgPSAkYXJndW1lbnROYW1lc1skaV0KCiAgICAgICAgaWYoJG5ld0FyZ3VtZW50TmFtZXMgLWVxICRudWxsKQogICAgICAgIHsKICAgICAgICAgICAgJG5ld0FyZ3VtZW50TmFtZSA9ICRhcmd1bWVudE5hbWUKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgJG5ld0FyZ3VtZW50TmFtZSA9ICRuZXdBcmd1bWVudE5hbWVzWyRpXQogICAgICAgIH0KCiAgICAgICAgaWYoJGZ1bmN0aW9uQm91bmRQYXJhbWV0ZXJzLkNvbnRhaW5zS2V5KCRhcmd1bWVudE5hbWUpKQogICAgICAgIHsKICAgICAgICAgICAgJG51bGwgPSAkcmV0dXJuVmFsdWUuQWRkKCRuZXdBcmd1bWVudE5hbWUsJGZ1bmN0aW9uQm91bmRQYXJhbWV0ZXJzWyRhcmd1bWVudE5hbWVdKQogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gJHJldHVyblZhbHVlCn0KCmZ1bmN0aW9uIENhbGxQSW52b2tlCnsKICAgICRzY3JpcHQ6UHJvZ3JhbVNvdXJjZSA9IEAiCnVzaW5nIFN5c3RlbTsKdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7CnVzaW5nIFN5c3RlbS5UZXh0Owp1c2luZyBTeXN0ZW0uU2VjdXJpdHk7CnVzaW5nIFN5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlczsKdXNpbmcgU3lzdGVtLkRpYWdub3N0aWNzOwp1c2luZyBTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsOwp1c2luZyBTeXN0ZW0uQ29tcG9uZW50TW9kZWw7CnVzaW5nIFN5c3RlbS5JTzsKCm5hbWVzcGFjZSBTb3VyY2UKewogICAgW1N1cHByZXNzVW5tYW5hZ2VkQ29kZVNlY3VyaXR5XQogICAgcHVibGljIHN0YXRpYyBjbGFzcyBOYXRpdmVNZXRob2RzCiAgICB7CiAgICAgICAgLy9UaGUgZm9sbG93aW5nIHN0cnVjdHMgYW5kIGVudW1zIGFyZSB1c2VkIGJ5IHRoZSB2YXJpb3VzIFdpbjMyIEFQSSdzIHRoYXQgYXJlIHVzZWQgaW4gdGhlIGNvZGUgYmVsb3cKICAgICAgICAKICAgICAgICBbU3RydWN0TGF5b3V0KExheW91dEtpbmQuU2VxdWVudGlhbCldCiAgICAgICAgcHVibGljIHN0cnVjdCBTVEFSVFVQSU5GTwogICAgICAgIHsKICAgICAgICAgICAgcHVibGljIEludDMyIGNiOwogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGxwUmVzZXJ2ZWQ7CiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgbHBEZXNrdG9wOwogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIGxwVGl0bGU7CiAgICAgICAgICAgIHB1YmxpYyBJbnQzMiBkd1g7CiAgICAgICAgICAgIHB1YmxpYyBJbnQzMiBkd1k7CiAgICAgICAgICAgIHB1YmxpYyBJbnQzMiBkd1hTaXplOwogICAgICAgICAgICBwdWJsaWMgSW50MzIgZHdYQ291bnRDaGFyczsKICAgICAgICAgICAgcHVibGljIEludDMyIGR3WUNvdW50Q2hhcnM7CiAgICAgICAgICAgIHB1YmxpYyBJbnQzMiBkd0ZpbGxBdHRyaWJ1dGU7CiAgICAgICAgICAgIHB1YmxpYyBJbnQzMiBkd0ZsYWdzOwogICAgICAgICAgICBwdWJsaWMgSW50MTYgd1Nob3dXaW5kb3c7CiAgICAgICAgICAgIHB1YmxpYyBJbnQxNiBjYlJlc2VydmVkMjsKICAgICAgICAgICAgcHVibGljIEludFB0ciBscFJlc2VydmVkMjsKICAgICAgICAgICAgcHVibGljIEludFB0ciBoU3RkSW5wdXQ7CiAgICAgICAgICAgIHB1YmxpYyBJbnRQdHIgaFN0ZE91dHB1dDsKICAgICAgICAgICAgcHVibGljIEludFB0ciBoU3RkRXJyb3I7CiAgICAgICAgfQoKICAgICAgICBbU3RydWN0TGF5b3V0KExheW91dEtpbmQuU2VxdWVudGlhbCldCiAgICAgICAgcHVibGljIHN0cnVjdCBQUk9DRVNTX0lORk9STUFUSU9OCiAgICAgICAgewogICAgICAgICAgICBwdWJsaWMgSW50UHRyIGhQcm9jZXNzOwogICAgICAgICAgICBwdWJsaWMgSW50UHRyIGhUaHJlYWQ7CiAgICAgICAgICAgIHB1YmxpYyBJbnQzMiBkd1Byb2Nlc3NJRDsKICAgICAgICAgICAgcHVibGljIEludDMyIGR3VGhyZWFkSUQ7CiAgICAgICAgfQoKICAgICAgICBbRmxhZ3NdCiAgICAgICAgcHVibGljIGVudW0gTG9nb25UeXBlCiAgICAgICAgewogICAgICAgICAgICBMT0dPTjMyX0xPR09OX0lOVEVSQUNUSVZFID0gMiwKICAgICAgICAgICAgTE9HT04zMl9MT0dPTl9ORVRXT1JLID0gMywKICAgICAgICAgICAgTE9HT04zMl9MT0dPTl9CQVRDSCA9IDQsCiAgICAgICAgICAgIExPR09OMzJfTE9HT05fU0VSVklDRSA9IDUsCiAgICAgICAgICAgIExPR09OMzJfTE9HT05fVU5MT0NLID0gNywKICAgICAgICAgICAgTE9HT04zMl9MT0dPTl9ORVRXT1JLX0NMRUFSVEVYVCA9IDgsCiAgICAgICAgICAgIExPR09OMzJfTE9HT05fTkVXX0NSRURFTlRJQUxTID0gOQogICAgICAgIH0KCiAgICAgICAgW0ZsYWdzXQogICAgICAgIHB1YmxpYyBlbnVtIExvZ29uUHJvdmlkZXIKICAgICAgICB7CiAgICAgICAgICAgIExPR09OMzJfUFJPVklERVJfREVGQVVMVCA9IDAsCiAgICAgICAgICAgIExPR09OMzJfUFJPVklERVJfV0lOTlQzNSwKICAgICAgICAgICAgTE9HT04zMl9QUk9WSURFUl9XSU5OVDQwLAogICAgICAgICAgICBMT0dPTjMyX1BST1ZJREVSX1dJTk5UNTAKICAgICAgICB9CiAgICAgICAgW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwpXQogICAgICAgIHB1YmxpYyBzdHJ1Y3QgU0VDVVJJVFlfQVRUUklCVVRFUwogICAgICAgIHsKICAgICAgICAgICAgcHVibGljIEludDMyIExlbmd0aDsKICAgICAgICAgICAgcHVibGljIEludFB0ciBscFNlY3VyaXR5RGVzY3JpcHRvcjsKICAgICAgICAgICAgcHVibGljIGJvb2wgYkluaGVyaXRIYW5kbGU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgZW51bSBTRUNVUklUWV9JTVBFUlNPTkFUSU9OX0xFVkVMCiAgICAgICAgewogICAgICAgICAgICBTZWN1cml0eUFub255bW91cywKICAgICAgICAgICAgU2VjdXJpdHlJZGVudGlmaWNhdGlvbiwKICAgICAgICAgICAgU2VjdXJpdHlJbXBlcnNvbmF0aW9uLAogICAgICAgICAgICBTZWN1cml0eURlbGVnYXRpb24KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBlbnVtIFRPS0VOX1RZUEUKICAgICAgICB7CiAgICAgICAgICAgIFRva2VuUHJpbWFyeSA9IDEsCiAgICAgICAgICAgIFRva2VuSW1wZXJzb25hdGlvbgogICAgICAgIH0KCiAgICAgICAgW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwsIFBhY2sgPSAxKV0KICAgICAgICBpbnRlcm5hbCBzdHJ1Y3QgVG9rUHJpdjFMdWlkCiAgICAgICAgewogICAgICAgICAgICBwdWJsaWMgaW50IENvdW50OwogICAgICAgICAgICBwdWJsaWMgbG9uZyBMdWlkOwogICAgICAgICAgICBwdWJsaWMgaW50IEF0dHI7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgY29uc3QgaW50IEdFTkVSSUNfQUxMX0FDQ0VTUyA9IDB4MTAwMDAwMDA7CiAgICAgICAgcHVibGljIGNvbnN0IGludCBDUkVBVEVfTk9fV0lORE9XID0gMHgwODAwMDAwMDsKICAgICAgICBpbnRlcm5hbCBjb25zdCBpbnQgU0VfUFJJVklMRUdFX0VOQUJMRUQgPSAweDAwMDAwMDAyOwogICAgICAgIGludGVybmFsIGNvbnN0IGludCBUT0tFTl9RVUVSWSA9IDB4MDAwMDAwMDg7CiAgICAgICAgaW50ZXJuYWwgY29uc3QgaW50IFRPS0VOX0FESlVTVF9QUklWSUxFR0VTID0gMHgwMDAwMDAyMDsKICAgICAgICBpbnRlcm5hbCBjb25zdCBzdHJpbmcgU0VfSU5DUkFTRV9RVU9UQSA9ICJTZUluY3JlYXNlUXVvdGFQcml2aWxlZ2UiOwoKICAgICAgICBbRGxsSW1wb3J0KCJrZXJuZWwzMi5kbGwiLAogICAgICAgICAgICAgIEVudHJ5UG9pbnQgPSAiQ2xvc2VIYW5kbGUiLCBTZXRMYXN0RXJyb3IgPSB0cnVlLAogICAgICAgICAgICAgIENoYXJTZXQgPSBDaGFyU2V0LkF1dG8sIENhbGxpbmdDb252ZW50aW9uID0gQ2FsbGluZ0NvbnZlbnRpb24uU3RkQ2FsbCldCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBDbG9zZUhhbmRsZShJbnRQdHIgaGFuZGxlKTsKCiAgICAgICAgW0RsbEltcG9ydCgiYWR2YXBpMzIuZGxsIiwKICAgICAgICAgICAgICBFbnRyeVBvaW50ID0gIkNyZWF0ZVByb2Nlc3NBc1VzZXIiLCBTZXRMYXN0RXJyb3IgPSB0cnVlLAogICAgICAgICAgICAgIENoYXJTZXQgPSBDaGFyU2V0LkFuc2ksIENhbGxpbmdDb252ZW50aW9uID0gQ2FsbGluZ0NvbnZlbnRpb24uU3RkQ2FsbCldCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBDcmVhdGVQcm9jZXNzQXNVc2VyKAogICAgICAgICAgICBJbnRQdHIgaFRva2VuLCAKICAgICAgICAgICAgc3RyaW5nIGxwQXBwbGljYXRpb25OYW1lLCAKICAgICAgICAgICAgc3RyaW5nIGxwQ29tbWFuZExpbmUsCiAgICAgICAgICAgIHJlZiBTRUNVUklUWV9BVFRSSUJVVEVTIGxwUHJvY2Vzc0F0dHJpYnV0ZXMsIAogICAgICAgICAgICByZWYgU0VDVVJJVFlfQVRUUklCVVRFUyBscFRocmVhZEF0dHJpYnV0ZXMsCiAgICAgICAgICAgIGJvb2wgYkluaGVyaXRIYW5kbGUsIAogICAgICAgICAgICBJbnQzMiBkd0NyZWF0aW9uRmxhZ3MsIAogICAgICAgICAgICBJbnRQdHIgbHBFbnZyaW9ubWVudCwKICAgICAgICAgICAgc3RyaW5nIGxwQ3VycmVudERpcmVjdG9yeSwgCiAgICAgICAgICAgIHJlZiBTVEFSVFVQSU5GTyBscFN0YXJ0dXBJbmZvLAogICAgICAgICAgICByZWYgUFJPQ0VTU19JTkZPUk1BVElPTiBscFByb2Nlc3NJbmZvcm1hdGlvbgogICAgICAgICAgICApOwoKICAgICAgICBbRGxsSW1wb3J0KCJhZHZhcGkzMi5kbGwiLCBFbnRyeVBvaW50ID0gIkR1cGxpY2F0ZVRva2VuRXgiKV0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIER1cGxpY2F0ZVRva2VuRXgoCiAgICAgICAgICAgIEludFB0ciBoRXhpc3RpbmdUb2tlbiwgCiAgICAgICAgICAgIEludDMyIGR3RGVzaXJlZEFjY2VzcywKICAgICAgICAgICAgcmVmIFNFQ1VSSVRZX0FUVFJJQlVURVMgbHBUaHJlYWRBdHRyaWJ1dGVzLAogICAgICAgICAgICBJbnQzMiBJbXBlcnNvbmF0aW9uTGV2ZWwsIAogICAgICAgICAgICBJbnQzMiBkd1Rva2VuVHlwZSwKICAgICAgICAgICAgcmVmIEludFB0ciBwaE5ld1Rva2VuCiAgICAgICAgICAgICk7CgogICAgICAgIFtEbGxJbXBvcnQoImFkdmFwaTMyLmRsbCIsIENoYXJTZXQgPSBDaGFyU2V0LlVuaWNvZGUsIFNldExhc3RFcnJvciA9IHRydWUpXQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIEJvb2xlYW4gTG9nb25Vc2VyKAogICAgICAgICAgICBTdHJpbmcgbHBzelVzZXJOYW1lLAogICAgICAgICAgICBTdHJpbmcgbHBzekRvbWFpbiwKICAgICAgICAgICAgU3RyaW5nIGxwc3pQYXNzd29yZCwKICAgICAgICAgICAgTG9nb25UeXBlIGR3TG9nb25UeXBlLAogICAgICAgICAgICBMb2dvblByb3ZpZGVyIGR3TG9nb25Qcm92aWRlciwKICAgICAgICAgICAgb3V0IEludFB0ciBwaFRva2VuCiAgICAgICAgICAgICk7CgogICAgICAgIFtEbGxJbXBvcnQoImFkdmFwaTMyLmRsbCIsIEV4YWN0U3BlbGxpbmcgPSB0cnVlLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgZXh0ZXJuIGJvb2wgQWRqdXN0VG9rZW5Qcml2aWxlZ2VzKAogICAgICAgICAgICBJbnRQdHIgaHRvaywgCiAgICAgICAgICAgIGJvb2wgZGlzYWxsLAogICAgICAgICAgICByZWYgVG9rUHJpdjFMdWlkIG5ld3N0LCAKICAgICAgICAgICAgaW50IGxlbiwgCiAgICAgICAgICAgIEludFB0ciBwcmV2LCAKICAgICAgICAgICAgSW50UHRyIHJlbGVuCiAgICAgICAgICAgICk7CgogICAgICAgIFtEbGxJbXBvcnQoImtlcm5lbDMyLmRsbCIsIEV4YWN0U3BlbGxpbmcgPSB0cnVlKV0KICAgICAgICBpbnRlcm5hbCBzdGF0aWMgZXh0ZXJuIEludFB0ciBHZXRDdXJyZW50UHJvY2VzcygpOwoKICAgICAgICBbRGxsSW1wb3J0KCJhZHZhcGkzMi5kbGwiLCBFeGFjdFNwZWxsaW5nID0gdHJ1ZSwgU2V0TGFzdEVycm9yID0gdHJ1ZSldCiAgICAgICAgaW50ZXJuYWwgc3RhdGljIGV4dGVybiBib29sIE9wZW5Qcm9jZXNzVG9rZW4oCiAgICAgICAgICAgIEludFB0ciBoLCAKICAgICAgICAgICAgaW50IGFjYywgCiAgICAgICAgICAgIHJlZiBJbnRQdHIgcGh0b2sKICAgICAgICAgICAgKTsKCiAgICAgICAgW0RsbEltcG9ydCgiYWR2YXBpMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldCiAgICAgICAgaW50ZXJuYWwgc3RhdGljIGV4dGVybiBib29sIExvb2t1cFByaXZpbGVnZVZhbHVlKAogICAgICAgICAgICBzdHJpbmcgaG9zdCwgCiAgICAgICAgICAgIHN0cmluZyBuYW1lLAogICAgICAgICAgICByZWYgbG9uZyBwbHVpZAogICAgICAgICAgICApOwoKICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgQ3JlYXRlUHJvY2Vzc0FzVXNlcihzdHJpbmcgc3RyQ29tbWFuZCwgc3RyaW5nIHN0ckRvbWFpbiwgc3RyaW5nIHN0ck5hbWUsIHN0cmluZyBzdHJQYXNzd29yZCkKICAgICAgICB7CiAgICAgICAgICAgIHZhciBoVG9rZW4gPSBJbnRQdHIuWmVybzsKICAgICAgICAgICAgdmFyIGhEdXBlZFRva2VuID0gSW50UHRyLlplcm87CiAgICAgICAgICAgIFRva1ByaXYxTHVpZCB0cDsKICAgICAgICAgICAgdmFyIHBpID0gbmV3IFBST0NFU1NfSU5GT1JNQVRJT04oKTsKICAgICAgICAgICAgdmFyIHNhID0gbmV3IFNFQ1VSSVRZX0FUVFJJQlVURVMoKTsKICAgICAgICAgICAgc2EuTGVuZ3RoID0gTWFyc2hhbC5TaXplT2Yoc2EpOwogICAgICAgICAgICBCb29sZWFuIGJSZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGJSZXN1bHQgPSBMb2dvblVzZXIoCiAgICAgICAgICAgICAgICAgICAgc3RyTmFtZSwKICAgICAgICAgICAgICAgICAgICBzdHJEb21haW4sCiAgICAgICAgICAgICAgICAgICAgc3RyUGFzc3dvcmQsCiAgICAgICAgICAgICAgICAgICAgTG9nb25UeXBlLkxPR09OMzJfTE9HT05fQkFUQ0gsCiAgICAgICAgICAgICAgICAgICAgTG9nb25Qcm92aWRlci5MT0dPTjMyX1BST1ZJREVSX0RFRkFVTFQsCiAgICAgICAgICAgICAgICAgICAgb3V0IGhUb2tlbgogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZiAoIWJSZXN1bHQpIAogICAgICAgICAgICAgICAgeyAKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgV2luMzJFeGNlcHRpb24oIlRoZSB1c2VyIGNvdWxkIG5vdCBiZSBsb2dnZWQgb24uIEVuc3VyZSB0aGF0IHRoZSB1c2VyIGhhcyBhbiBleGlzdGluZyBwcm9maWxlIG9uIHRoZSBtYWNoaW5lIGFuZCB0aGF0IGNvcnJlY3QgY3JlZGVudGlhbHMgYXJlIHByb3ZpZGVkLiBMb2dvbiBlcnJvciAjIiArIE1hcnNoYWwuR2V0TGFzdFdpbjMyRXJyb3IoKS5Ub1N0cmluZygpKTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBJbnRQdHIgaHByb2MgPSBHZXRDdXJyZW50UHJvY2VzcygpOwogICAgICAgICAgICAgICAgSW50UHRyIGh0b2sgPSBJbnRQdHIuWmVybzsKICAgICAgICAgICAgICAgIGJSZXN1bHQgPSBPcGVuUHJvY2Vzc1Rva2VuKAogICAgICAgICAgICAgICAgICAgICAgICBocHJvYywgCiAgICAgICAgICAgICAgICAgICAgICAgIFRPS0VOX0FESlVTVF9QUklWSUxFR0VTIHwgVE9LRU5fUVVFUlksIAogICAgICAgICAgICAgICAgICAgICAgICByZWYgaHRvawogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZighYlJlc3VsdCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgV2luMzJFeGNlcHRpb24oIk9wZW4gcHJvY2VzcyB0b2tlbiBlcnJvciAjIiArIE1hcnNoYWwuR2V0TGFzdFdpbjMyRXJyb3IoKS5Ub1N0cmluZygpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRwLkNvdW50ID0gMTsKICAgICAgICAgICAgICAgIHRwLkx1aWQgPSAwOwogICAgICAgICAgICAgICAgdHAuQXR0ciA9IFNFX1BSSVZJTEVHRV9FTkFCTEVEOwogICAgICAgICAgICAgICAgYlJlc3VsdCA9IExvb2t1cFByaXZpbGVnZVZhbHVlKAogICAgICAgICAgICAgICAgICAgIG51bGwsIAogICAgICAgICAgICAgICAgICAgIFNFX0lOQ1JBU0VfUVVPVEEsIAogICAgICAgICAgICAgICAgICAgIHJlZiB0cC5MdWlkCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmKCFiUmVzdWx0KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBXaW4zMkV4Y2VwdGlvbigiRXJyb3IgaW4gbG9va2luZyB1cCBwcml2aWxlZ2Ugb2YgdGhlIHByb2Nlc3MuIFRoaXMgc2hvdWxkIG5vdCBoYXBwZW4gaWYgRFNDIGlzIHJ1bm5pbmcgYXMgTG9jYWxTeXN0ZW0gTG9va3VwIHByaXZpbGVnZSBlcnJvciAjIiArIE1hcnNoYWwuR2V0TGFzdFdpbjMyRXJyb3IoKS5Ub1N0cmluZygpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJSZXN1bHQgPSBBZGp1c3RUb2tlblByaXZpbGVnZXMoCiAgICAgICAgICAgICAgICAgICAgaHRvaywgCiAgICAgICAgICAgICAgICAgICAgZmFsc2UsIAogICAgICAgICAgICAgICAgICAgIHJlZiB0cCwgCiAgICAgICAgICAgICAgICAgICAgMCwgCiAgICAgICAgICAgICAgICAgICAgSW50UHRyLlplcm8sIAogICAgICAgICAgICAgICAgICAgIEludFB0ci5aZXJvCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmKCFiUmVzdWx0KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBXaW4zMkV4Y2VwdGlvbigiVG9rZW4gZWxldmF0aW9uIGVycm9yICMiICsgTWFyc2hhbC5HZXRMYXN0V2luMzJFcnJvcigpLlRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBiUmVzdWx0ID0gRHVwbGljYXRlVG9rZW5FeCgKICAgICAgICAgICAgICAgICAgICBoVG9rZW4sCiAgICAgICAgICAgICAgICAgICAgR0VORVJJQ19BTExfQUNDRVNTLAogICAgICAgICAgICAgICAgICAgIHJlZiBzYSwKICAgICAgICAgICAgICAgICAgICAoaW50KVNFQ1VSSVRZX0lNUEVSU09OQVRJT05fTEVWRUwuU2VjdXJpdHlJZGVudGlmaWNhdGlvbiwKICAgICAgICAgICAgICAgICAgICAoaW50KVRPS0VOX1RZUEUuVG9rZW5QcmltYXJ5LAogICAgICAgICAgICAgICAgICAgIHJlZiBoRHVwZWRUb2tlbgogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZighYlJlc3VsdCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgV2luMzJFeGNlcHRpb24oIkR1cGxpY2F0ZSBUb2tlbiBlcnJvciAjIiArIE1hcnNoYWwuR2V0TGFzdFdpbjMyRXJyb3IoKS5Ub1N0cmluZygpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBzaSA9IG5ldyBTVEFSVFVQSU5GTygpOwogICAgICAgICAgICAgICAgc2kuY2IgPSBNYXJzaGFsLlNpemVPZihzaSk7CiAgICAgICAgICAgICAgICBzaS5scERlc2t0b3AgPSAiIjsKICAgICAgICAgICAgICAgIGJSZXN1bHQgPSBDcmVhdGVQcm9jZXNzQXNVc2VyKAogICAgICAgICAgICAgICAgICAgIGhEdXBlZFRva2VuLAogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgc3RyQ29tbWFuZCwKICAgICAgICAgICAgICAgICAgICByZWYgc2EsIAogICAgICAgICAgICAgICAgICAgIHJlZiBzYSwKICAgICAgICAgICAgICAgICAgICBmYWxzZSwgCiAgICAgICAgICAgICAgICAgICAgMCwgCiAgICAgICAgICAgICAgICAgICAgSW50UHRyLlplcm8sCiAgICAgICAgICAgICAgICAgICAgbnVsbCwgCiAgICAgICAgICAgICAgICAgICAgcmVmIHNpLCAKICAgICAgICAgICAgICAgICAgICByZWYgcGkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYoIWJSZXN1bHQpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFdpbjMyRXhjZXB0aW9uKCJUaGUgcHJvY2VzcyBjb3VsZCBub3QgYmUgY3JlYXRlZC4gQ3JlYXRlIHByb2Nlc3MgYXMgdXNlciBlcnJvciAjIiArIE1hcnNoYWwuR2V0TGFzdFdpbjMyRXJyb3IoKS5Ub1N0cmluZygpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmaW5hbGx5CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChwaS5oVGhyZWFkICE9IEludFB0ci5aZXJvKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIENsb3NlSGFuZGxlKHBpLmhUaHJlYWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHBpLmhQcm9jZXNzICE9IEludFB0ci5aZXJvKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIENsb3NlSGFuZGxlKHBpLmhQcm9jZXNzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICBpZiAoaER1cGVkVG9rZW4gIT0gSW50UHRyLlplcm8pCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgQ2xvc2VIYW5kbGUoaER1cGVkVG9rZW4pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoiQAogICAgQWRkLVR5cGUgLVR5cGVEZWZpbml0aW9uICRQcm9ncmFtU291cmNlIC1SZWZlcmVuY2VkQXNzZW1ibGllcyAiU3lzdGVtLlNlcnZpY2VQcm9jZXNzIgp9CgpmdW5jdGlvbiBHZXRXaW4zMlByb2Nlc3MKewogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtCiAgICAoCiAgICAgICAgW3BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRQYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBcmd1bWVudHMsCgogICAgICAgIFtQU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICAkZmlsZU5hbWUgPSBbaW8ucGF0aF06OkdldEZpbGVOYW1lV2l0aG91dEV4dGVuc2lvbigkUGF0aCkKICAgICRHZXRQcm9jZXNzZXMgPSBAKEdldC1Qcm9jZXNzIC1OYW1lICRmaWxlTmFtZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkKICAgICRQcm9jZXNzZXMgPSBmb3JlYWNoKCRwcm9jZXNzIGluICRHZXRQcm9jZXNzZXMpCiAgICB7CiAgICAgICAgaWYoJFByb2Nlc3MuUGF0aCAtaWVxICRQYXRoKQogICAgICAgIHsKICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFt3bWldIldpbjMyX1Byb2Nlc3MuSGFuZGxlPSckKCRQcm9jZXNzLklkKSciCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2gKICAgICAgICAgICAgewogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgaWYoJFBTQm91bmRQYXJhbWV0ZXJzLkNvbnRhaW5zS2V5KCdDcmVkZW50aWFsJykpCiAgICB7CiAgICAgICAgJFByb2Nlc3NlcyA9ICRQcm9jZXNzZXMgfCBXaGVyZS1PYmplY3QgeyhHZXRXaW4zMlByb2Nlc3NPd25lciAkXykgLWVxICRDcmVkZW50aWFsLlVzZXJOYW1lfQogICAgfQogICAgaWYoJEFyZ3VtZW50cyAtZXEgJG51bGwpIHskQXJndW1lbnRzID0gIiJ9CiAgICAkUHJvY2Vzc2VzID0gJFByb2Nlc3NlcyB8IFdoZXJlLU9iamVjdCB7KEdldFdpbjMyUHJvY2Vzc0FyZ3VtZW50c0Zyb21Db21tYW5kTGluZSAkXy5Db21tYW5kTGluZSkgLWVxICRBcmd1bWVudHN9CgogICAgcmV0dXJuICRQcm9jZXNzZXMKfQoKZnVuY3Rpb24gR2V0V2luMzJQcm9jZXNzT3duZXIKewogICAgcGFyYW0KICAgICgKICAgICAgICBbcGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsKCldCiAgICAgICAgJFByb2Nlc3MKICAgICkKCiAgICB0cnkKICAgIHsKICAgICAgICAkT3duZXIgPSAkUHJvY2Vzcy5HZXRPd25lcigpCiAgICB9CiAgICBjYXRjaAogICAge30KICAgIGlmKCRvd25lci5Eb21haW4gLW5lICRudWxsKQogICAgewogICAgICAgIHJldHVybiAkT3duZXIuRG9tYWluICsgIlwiICsgJE93bmVyLlVzZXIKICAgIH0KICAgIGVsc2UgICAgICAgICAgICAgICAgCiAgICB7CiAgICAgICAgcmV0dXJuICRPd25lci5Vc2VyCiAgICB9Cn0KCmZ1bmN0aW9uIEdldFdpbjMyUHJvY2Vzc0FyZ3VtZW50c0Zyb21Db21tYW5kTGluZQp7CiAgICBwYXJhbQogICAgKAogICAgICAgIFtTdHJpbmddCiAgICAgICAgJGNvbW1hbmRMaW5lCiAgICApCgogICAgaWYoJGNvbW1hbmRMaW5lIC1lcSAkbnVsbCkKICAgIHsKICAgICAgICByZXR1cm4gIiIKICAgIH0KICAgICRjb21tYW5kTGluZT0kY29tbWFuZExpbmUuVHJpbSgpCiAgICBpZigkY29tbWFuZExpbmUuTGVuZ3RoIC1lcSAwKQogICAgewogICAgICAgIHJldHVybiAiIgogICAgfQogICAgaWYoJGNvbW1hbmRMaW5lWzBdIC1lcSAnIicpCiAgICB7CiAgICAgICAgJGNoYXJUb0xvb2tmb3I9W2NoYXJdJyInCiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgJGNoYXJUb0xvb2tmb3I9W2NoYXJdJyAnCiAgICB9CiAgICAkZW5kT2ZDb21tYW5kPSRjb21tYW5kTGluZS5JbmRleE9mKCRjaGFyVG9Mb29rZm9yICwxKQogICAgaWYoJGVuZE9mQ29tbWFuZCAtZXEgLTEpCiAgICB7CiAgICAgICAgcmV0dXJuICIiCiAgICB9CiAgICByZXR1cm4gJGNvbW1hbmRMaW5lLlN1YnN0cmluZygkZW5kT2ZDb21tYW5kKzEpLlRyaW0oKQp9CgpmdW5jdGlvbiBTdGFydFdpbjMyUHJvY2Vzcwp7CiAgICBwYXJhbQogICAgKAogICAgICAgIFtwYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkUGF0aCwKCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkQXJndW1lbnRzLAoKICAgICAgICBbUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRBc1Rhc2sKICAgICkKCiAgICAkR2V0QXJndW1lbnRzID0gRXh0cmFjdEFyZ3VtZW50cyAkUFNCb3VuZFBhcmFtZXRlcnMgKCJQYXRoIiwiQXJndW1lbnRzIiwiQ3JlZGVudGlhbCIpCiAgICAkUHJvY2Vzc2VzID0gQChHZXRXaW4zMlByb2Nlc3MgQGdldEFyZ3VtZW50cykKICAgIGlmICgkcHJvY2Vzc2VzLkNvdW50IC1lcSAwKQogICAgewogICAgICAgIGlmKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgiQ3JlZGVudGlhbCIpKQogICAgICAgIHsKICAgICAgICAgICAgaWYoJEFzVGFzaykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJEFjdGlvbkFyZ3VtZW50cyA9IEV4dHJhY3RBcmd1bWVudHMgJFBTQm91bmRQYXJhbWV0ZXJzIGAKICAgICAgICAgICAgICAgICAgICAgICAgKCJQYXRoIiwgICAgIkFyZ3VtZW50cyIpIGAKICAgICAgICAgICAgICAgICAgICAgICAgKCJFeGVjdXRlIiwgIkFyZ3VtZW50IikKICAgICAgICAgICAgICAgIGlmKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRBcmd1bWVudHMpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRudWxsID0gJEFjdGlvbkFyZ3VtZW50cy5SZW1vdmUoIkFyZ3VtZW50IikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRUYXNrR3VpZCA9IFtndWlkXTo6TmV3R3VpZCgpLlRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICRBY3Rpb24gPSBOZXctU2NoZWR1bGVkVGFza0FjdGlvbiBAQWN0aW9uQXJndW1lbnRzCiAgICAgICAgICAgICAgICAkbnVsbCA9IFJlZ2lzdGVyLVNjaGVkdWxlZFRhc2sgLVRhc2tOYW1lICJ4UERUICRUYXNrR3VpZCIgLUFjdGlvbiAkQWN0aW9uIC1Vc2VyICRDcmVkZW50aWFsLlVzZXJOYW1lIC1QYXNzd29yZCAkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLlBhc3N3b3JkIC1SdW5MZXZlbCBIaWdoZXN0CiAgICAgICAgICAgICAgICAkZXJyID0gU3RhcnQtU2NoZWR1bGVkVGFzayAtVGFza05hbWUgInhQRFQgJFRhc2tHdWlkIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgQ2FsbFBJbnZva2UKICAgICAgICAgICAgICAgICAgICBbU291cmNlLk5hdGl2ZU1ldGhvZHNdOjpDcmVhdGVQcm9jZXNzQXNVc2VyKCgiJFBhdGggIiArICRBcmd1bWVudHMpLCRDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuRG9tYWluLCRDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuVXNlck5hbWUsJENyZWRlbnRpYWwuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5QYXNzd29yZCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJGV4Y2VwdGlvbiA9IE5ldy1PYmplY3QgU3lzdGVtLkFyZ3VtZW50RXhjZXB0aW9uICRfCiAgICAgICAgICAgICAgICAgICAgJGVycm9yQ2F0ZWdvcnkgPSBbU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5FcnJvckNhdGVnb3J5XTo6T3BlcmF0aW9uU3RvcHBlZAogICAgICAgICAgICAgICAgICAgICRlcnJvclJlY29yZCA9IE5ldy1PYmplY3QgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5FcnJvclJlY29yZCAkZXhjZXB0aW9uLCAiV2luMzJFeGNlcHRpb24iLCAkZXJyb3JDYXRlZ29yeSwgJG51bGwKICAgICAgICAgICAgICAgICAgICAkZXJyID0gJGVycm9yUmVjb3JkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgJFN0YXJ0QXJndW1lbnRzID0gRXh0cmFjdEFyZ3VtZW50cyAkUFNCb3VuZFBhcmFtZXRlcnMgYAogICAgICAgICAgICAgICAgICAgICgiUGF0aCIsICAgICAiQXJndW1lbnRzIiwgICAgIkNyZWRlbnRpYWwiKSBgCiAgICAgICAgICAgICAgICAgICAgKCJGaWxlUGF0aCIsICJBcmd1bWVudExpc3QiLCAiQ3JlZGVudGlhbCIpCiAgICAgICAgICAgIGlmKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRBcmd1bWVudHMpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkbnVsbCA9ICRTdGFydEFyZ3VtZW50cy5SZW1vdmUoIkFyZ3VtZW50TGlzdCIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGVyciA9IFN0YXJ0LVByb2Nlc3MgQFN0YXJ0QXJndW1lbnRzCiAgICAgICAgfQogICAgICAgIGlmKCRlcnIgLW5lICRudWxsKQogICAgICAgIHsKICAgICAgICAgICAgdGhyb3cgJGVycgogICAgICAgIH0KICAgICAgICBpZiAoIShXYWl0Rm9yV2luMzJQcm9jZXNzU3RhcnQgQEdldEFyZ3VtZW50cykpCiAgICAgICAgewogICAgICAgICAgICBUaHJvd0ludmFsaWRBcmd1bWVudEVycm9yICJGYWlsdXJlV2FpdGluZ0ZvclByb2Nlc3Nlc1RvU3RhcnQiICgkTG9jYWxpemVkRGF0YS5FcnJvclN0YXJ0aW5nIC1mICRQYXRoLCRMb2NhbGl6ZWREYXRhLkZhaWx1cmVXYWl0aW5nRm9yUHJvY2Vzc2VzVG9TdGFydCkKICAgICAgICB9CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgcmV0dXJuICgkTG9jYWxpemVkRGF0YS5Qcm9jZXNzQWxyZWFkeVN0YXJ0ZWQgLWYgJFBhdGgsJFByb2Nlc3Nlcy5Qcm9jZXNzSWQpCiAgICB9CiAgICAkUHJvY2Vzc2VzID0gQChHZXRXaW4zMlByb2Nlc3MgQGdldEFyZ3VtZW50cykKICAgIHJldHVybiAoJExvY2FsaXplZERhdGEuUHJvY2Vzc1N0YXJ0ZWQgLWYgJFBhdGgsJFByb2Nlc3Nlcy5Qcm9jZXNzSWQpCn0KCmZ1bmN0aW9uIFdhaXRGb3JXaW4zMlByb2Nlc3NTdGFydAp7CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0KICAgICgKICAgICAgICBbcGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFBhdGgsCgogICAgICAgIFtTdHJpbmddCiAgICAgICAgJEFyZ3VtZW50cywKCiAgICAgICAgW1BTQ3JlZGVudGlhbF0KICAgICAgICAkQ3JlZGVudGlhbAogICAgKQoKICAgICRzdGFydCA9IFtEYXRlVGltZV06Ok5vdwogICAgJEdldEFyZ3VtZW50cyA9IEV4dHJhY3RBcmd1bWVudHMgJFBTQm91bmRQYXJhbWV0ZXJzICgiUGF0aCIsIkFyZ3VtZW50cyIsIkNyZWRlbnRpYWwiKQogICAgZG8KICAgIHsKICAgICAgICAkdmFsdWUgPSBAKEdldFdpbjMyUHJvY2VzcyBAR2V0QXJndW1lbnRzKS5Db3VudCAtZ2UgMQogICAgfSB3aGlsZSghJHZhbHVlIC1hbmQgKFtEYXRlVGltZV06Ok5vdyAtICRzdGFydCkuVG90YWxNaWxsaXNlY29uZHMgLWx0IDYwMDAwKQogICAgCiAgICByZXR1cm4gJHZhbHVlCn0KCmZ1bmN0aW9uIFdhaXRGb3JXaW4zMlByb2Nlc3NFbmQKewogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtCiAgICAoCiAgICAgICAgW3BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRQYXRoLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgICRBcmd1bWVudHMsCgogICAgICAgIFtQU0NyZWRlbnRpYWxdCiAgICAgICAgJENyZWRlbnRpYWwKICAgICkKCiAgICAkR2V0QXJndW1lbnRzID0gRXh0cmFjdEFyZ3VtZW50cyAkUFNCb3VuZFBhcmFtZXRlcnMgKCJQYXRoIiwiQXJndW1lbnRzIiwiQ3JlZGVudGlhbCIpCiAgICBXaGlsZSAoV2FpdEZvcldpbjMyUHJvY2Vzc1N0YXJ0IEBHZXRBcmd1bWVudHMpCiAgICB7CiAgICAgICAgU3RhcnQtU2xlZXAgMQogICAgfQogICAgR2V0LVNjaGVkdWxlZFRhc2sgfCBXaGVyZS1PYmplY3QgeygkXy5UYXNrTmFtZS5MZW5ndGggLWdlIDQpIC1hbmQgKCRfLlRhc2tOYW1lLlN1YnN0cmluZygwLDQpIC1lcSAieFBEVCIpIC1hbmQgKCRfLkFjdGlvbnMuRXhlY3V0ZSAtZXEgJFBhdGgpIC1hbmQgKCRfLkFjdGlvbnMuQXJndW1lbnRzIC1lcSAkQXJndW1lbnRzKX0gfCBXaGVyZS1PYmplY3QgeyRfIC1uZSAkbnVsbH0gfCBVbnJlZ2lzdGVyLVNjaGVkdWxlZFRhc2sgLUNvbmZpcm06JGZhbHNlCn0KCmZ1bmN0aW9uIE5ldFVzZQp7CiAgICBwYXJhbQogICAgKCAgIAogICAgICAgIFtwYXJhbWV0ZXIoTWFuZGF0b3J5KV0KICAgICAgICBbc3RyaW5nXQogICAgICAgICRTb3VyY2VQYXRoLAogICAgICAgIAogICAgICAgIFtwYXJhbWV0ZXIoTWFuZGF0b3J5KV0KICAgICAgICBbUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsLAogICAgICAgIAogICAgICAgIFtzdHJpbmddCiAgICAgICAgJEVuc3VyZSA9ICJQcmVzZW50IgogICAgKQoKICAgIGlmKCgkU291cmNlUGF0aC5MZW5ndGggLWdlIDIpIC1hbmQgKCRTb3VyY2VQYXRoLlN1YnN0cmluZygwLDIpIC1lcSAiXFwiKSkKICAgIHsKCiAgICAgICAgaWYgKCRFbnN1cmUgLWVxICJBYnNlbnQiKQogICAgICAgIHsKICAgICAgICAgICAgJGNtZCA9ICJuZXQuZXhlIHVzZSAkU291cmNlUGF0aCAvZGVsIgogICAgICAgIH0KICAgICAgICBlbHNlIAogICAgICAgIHsKICAgICAgICAgICAgJGNtZCA9ICJuZXQuZXhlIHVzZSAkU291cmNlUGF0aCAkKCRDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuUGFzc3dvcmQpIC91c2VyOiQoJENyZWRlbnRpYWwuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5Eb21haW4pXCQoJENyZWRlbnRpYWwuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5Vc2VyTmFtZSkiCiAgICAgICAgfQogICAgICAgIEludm9rZS1FeHByZXNzaW9uICRjbWQKICAgIH0KfQoKRXhwb3J0LU1vZHVsZU1lbWJlciBSZXNvbHZlUGF0aCxTdGFydFdpbjMyUHJvY2VzcyxXYWl0Rm9yV2luMzJQcm9jZXNzRW5kLE5ldFVzZQ==
