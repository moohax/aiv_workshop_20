publish-module.psm1,bd05f19219efb116a4b2e096dac77eb4,Scan result is 1. IsMalware: 0,w6/Cu8K/IyBXQVJOSU5HOiAgRE8gTk9UIE1PRElGWSB0aGlzIGZpbGUuIFZpc3VhbCBTdHVkaW8gd2lsbCBvdmVycmlkZSBpdC4KcGFyYW0oKQoKJHNjcmlwdDpBc3BOZXRQdWJsaXNoSGFuZGxlcnMgPSBAe30KCjwjClRoZXNlIHNldHRpbmdzIGNhbiBiZSBvdmVycmlkZGVuIHdpdGggZW52aXJvbm1lbnQgdmFyaWFibGVzLgpUaGUgbmFtZSBvZiB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGUgc2hvdWxkIHVzZSAiUHVibGlzaCIgYXMgYQpwcmVmaXggYW5kIHRoZSBuYW1lcyBiZWxvdy4gRm9yIGV4YW1wbGU6CgogICAgJGVudjpQdWJsaXNoTVNEZXBsb3lVc2VDaGVja3N1bSA9ICR0cnVlCiM+CiRnbG9iYWw6QXNwTmV0UHVibGlzaFNldHRpbmdzID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNDdXN0b21PYmplY3QgQHsKICAgIE1zZGVwbG95RGVmYXVsdFByb3BlcnRpZXMgPSBAewogICAgICAgICdNU0RlcGxveVVzZUNoZWNrc3VtJz0kZmFsc2UKICAgICAgICAnU2tpcEV4dHJhRmlsZXNPblNlcnZlcic9JHRydWUKICAgICAgICAncmV0cnlBdHRlbXB0cycgPSAyMAogICAgICAgICdFbmFibGVNU0RlcGxveUJhY2t1cCcgPSAkZmFsc2UKICAgICAgICAnRGVsZXRlRXhpc3RpbmdGaWxlcycgPSAkZmFsc2UKICAgICAgICAnQWxsb3dVbnRydXN0ZWRDZXJ0aWZpY2F0ZSc9ICRmYWxzZQogICAgICAgICdNU0RlcGxveVBhY2thZ2VDb250ZW50Rm9sZGVybmFtZSc9J3dlYnNpdGVcJwogICAgICAgICdFbnZpcm9ubWVudE5hbWUnID0gJ1Byb2R1Y3Rpb24nCiAgICAgICAgJ0F1dGhUeXBlJz0nQmFzaWMnCiAgICAgICAgJ01TRGVwbG95UHVibGlzaE1ldGhvZCc9J1dNU1ZDJwogICAgfQp9CgpmdW5jdGlvbiBJbnRlcm5hbE92ZXJyaWRlU2V0dGluZ3NGcm9tRW52ewogICAgW2NtZGxldGJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCldCiAgICAgICAgW29iamVjdFtdXSRzZXR0aW5ncyA9ICgkZ2xvYmFsOkFzcE5ldFB1Ymxpc2hTZXR0aW5ncywkZ2xvYmFsOkFzcE5ldFB1Ymxpc2hTZXR0aW5ncy5Nc2RlcGxveURlZmF1bHRQcm9wZXJ0aWVzKSwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0xKV0KICAgICAgICBbc3RyaW5nXSRwcmVmaXggPSAnUHVibGlzaCcKICAgICkKICAgIHByb2Nlc3N7CiAgICAgICAgZm9yZWFjaCgkc2V0dGluZ3NPYmogaW4gJHNldHRpbmdzKXsKICAgICAgICAgICAgaWYoJHNldHRpbmdzT2JqIC1lcSAkbnVsbCl7CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICB9CgogICAgICAgICAgICAkc2V0dGluZ05hbWVzID0gJG51bGwKICAgICAgICAgICAgaWYoJHNldHRpbmdzT2JqIC1pcyBbaGFzaHRhYmxlXSl7CiAgICAgICAgICAgICAgICAkc2V0dGluZ05hbWVzID0gJHNldHRpbmdzT2JqLktleXMKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgJHNldHRpbmdOYW1lcyA9ICgkc2V0dGluZ3NPYmogfCBHZXQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IE5hbWUpCgogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3JlYWNoKCRuYW1lIGluIEAoJHNldHRpbmdOYW1lcykpewogICAgICAgICAgICAgICAgJGZ1bGxuYW1lID0gKCd7MH17MX0nIC1mICRwcmVmaXgsJG5hbWUpCiAgICAgICAgICAgICAgICBpZihUZXN0LVBhdGggImVudjokZnVsbG5hbWUiKXsKICAgICAgICAgICAgICAgICAgICAkc2V0dGluZ3NPYmouJG5hbWUgPSAoKGdldC1jaGlsZGl0ZW0gImVudjokZnVsbG5hbWUiKS5WYWx1ZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKSW50ZXJuYWxPdmVycmlkZVNldHRpbmdzRnJvbUVudiAtcHJlZml4ICdQdWJsaXNoJyAtc2V0dGluZ3MgJGdsb2JhbDpBc3BOZXRQdWJsaXNoU2V0dGluZ3MsJGdsb2JhbDpBc3BOZXRQdWJsaXNoU2V0dGluZ3MuTXNkZXBsb3lEZWZhdWx0UHJvcGVydGllcwoKZnVuY3Rpb24gUmVnaXN0ZXItQXNwbmV0UHVibGlzaEhhbmRsZXJ7CiAgICBbY21kbGV0YmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JHRydWUsUG9zaXRpb249MCldCiAgICAgICAgJG5hbWUsCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JHRydWUsUG9zaXRpb249MSldCiAgICAgICAgW1NjcmlwdEJsb2NrXSRoYW5kbGVyLAogICAgICAgIFtzd2l0Y2hdJGZvcmNlCiAgICApCiAgICBwcm9jZXNzeyAgICAgICAgCiAgICAgICAgaWYoISgkc2NyaXB0OkFzcE5ldFB1Ymxpc2hIYW5kbGVyc1skbmFtZV0pIC1vciAkZm9yY2UgKXsKICAgICAgICAgICAgJ0FkZGluZyBoYW5kbGVyIGZvciBbezB9XScgLWYgJG5hbWUgfCBXcml0ZS1WZXJib3NlCiAgICAgICAgICAgICRzY3JpcHQ6QXNwTmV0UHVibGlzaEhhbmRsZXJzWyRuYW1lXSA9ICRoYW5kbGVyCiAgICAgICAgfQogICAgICAgIGVsc2VpZighKCRmb3JjZSkpewogICAgICAgICAgICAnSWdub3JpbmcgY2FsbCB0byBSZWdpc3Rlci1Bc3BuZXRQdWJsaXNoSGFuZGxlciBmb3IgW25hbWU9ezB9XSwgYmVjYXVzZSBhIGhhbmRsZXIgd2l0aCB0aGF0IG5hbWUgZXhpc3RzIGFuZCAtZm9yY2Ugd2FzIG5vdCBwYXNzZWQuJyAtZiAkbmFtZSB8IFdyaXRlLVZlcmJvc2UKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIEdldC1Bc3BuZXRQdWJsaXNoSGFuZGxlcnsKICAgIFtjbWRsZXRiaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kdHJ1ZSxQb3NpdGlvbj0wKV0KICAgICAgICAkbmFtZQogICAgKQogICAgcHJvY2Vzc3sKICAgICAgICAkZm91bmRIYW5kbGVyID0gJHNjcmlwdDpBc3BOZXRQdWJsaXNoSGFuZGxlcnNbJG5hbWVdCgogICAgICAgIGlmKCEkZm91bmRIYW5kbGVyKXsKICAgICAgICAgICAgdGhyb3cgKCdBc3BuZXRQdWJsaXNoSGFuZGxlciB3aXRoIG5hbWUgInswfSIgd2FzIG5vdCBmb3VuZCcgLWYgJG5hbWUpCiAgICAgICAgfQoKICAgICAgICAkZm91bmRIYW5kbGVyCiAgICB9Cn0KCmZ1bmN0aW9uIEdldEludGVybmFsLUV4Y2x1ZGVGaWxlc0FyZ3sKICAgIFtjbWRsZXRiaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICAkcHVibGlzaFByb3BlcnRpZXMKICAgICkKICAgIHByb2Nlc3N7CiAgICAgICAgJGV4Y2x1ZGVGaWxlcyA9ICRwdWJsaXNoUHJvcGVydGllc1snRXhjbHVkZUZpbGVzJ10KICAgICAgICBmb3JlYWNoKCRleGNsdWRlIGluICRleGNsdWRlRmlsZXMpewogICAgICAgICAgICBpZigkZXhjbHVkZSl7CiAgICAgICAgICAgICAgICBbc3RyaW5nXSRvYmpOYW1lID0gJGV4Y2x1ZGVbJ29iamVjdG5hbWUnXQoKICAgICAgICAgICAgICAgIGlmKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRvYmpOYW1lKSl7CiAgICAgICAgICAgICAgICAgICAgJG9iak5hbWUgPSAnZmlsZVBhdGgnCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGV4Y2x1ZGVQYXRoID0gJGV4Y2x1ZGVbJ2Fic29sdXRlcGF0aCddCgogICAgICAgICAgICAgICAgIyBvdXRwdXQgdGhlIHJlc3VsdCB0byB0aGUgcmV0dXJuIGxpc3QKICAgICAgICAgICAgICAgICgnLXNraXA6b2JqZWN0TmFtZT17MH0sYWJzb2x1dGVQYXRoPScnezF9JycnIC1mICRvYmpOYW1lLCAkZXhjbHVkZVBhdGgpCiAgICAgICAgICAgIH0gICAKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIEdldEludGVybmFsLVJlcGxhY2VtZW50c01TRGVwbG95QXJnc3sKICAgIFtjbWRsZXRiaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICAkcHVibGlzaFByb3BlcnRpZXMKICAgICkKICAgIHByb2Nlc3N7CiAgICAgICAgZm9yZWFjaCgkcmVwbGFjZSBpbiAoJHB1Ymxpc2hQcm9wZXJ0aWVzWydSZXBsYWNlbWVudHMnXSkpeyAgICAgCiAgICAgICAgICAgIGlmKCRyZXBsYWNlKXsgICAgICAgICAgIAogICAgICAgICAgICAgICAgJHR5cGVWYWx1ZSA9ICRyZXBsYWNlWyd0eXBlJ10KICAgICAgICAgICAgICAgIGlmKCEkdHlwZVZhbHVlKXsgJHR5cGVWYWx1ZSA9ICdUZXh0RmlsZScgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkZmlsZSA9ICRyZXBsYWNlWydmaWxlJ10KICAgICAgICAgICAgICAgICRtYXRjaCA9ICRyZXBsYWNlWydtYXRjaCddCiAgICAgICAgICAgICAgICAkbmV3VmFsdWUgPSAkcmVwbGFjZVsnbmV3VmFsdWUnXQoKICAgICAgICAgICAgICAgIGlmKCRmaWxlIC1hbmQgJG1hdGNoIC1hbmQgJG5ld1ZhbHVlKXsKICAgICAgICAgICAgICAgICAgICAkc2V0UGFyYW0gPSAoJy1zZXRQYXJhbTp0eXBlPXswfSxzY29wZT17MX0sbWF0Y2g9ezJ9LHZhbHVlPXszfScgLWYgJHR5cGVWYWx1ZSwkZmlsZSwgJG1hdGNoLCRuZXdWYWx1ZSkKICAgICAgICAgICAgICAgICAgICAnQWRkaW5nIHNldHBhcmFtIFt7MH1dJyAtZiAkc2V0UGFyYW0gfCBXcml0ZS1WZXJib3NlCgogICAgICAgICAgICAgICAgICAgICMgcmV0dXJuIGl0CiAgICAgICAgICAgICAgICAgICAgJHNldFBhcmFtCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICdTa2lwcGluZyByZXBsYWNlbWVudCBiZWNhdXNlIGl0cyBtaXNzaW5nIGEgcmVxdWlyZWQgdmFsdWUuW2ZpbGU9InswfSIsbWF0Y2g9InsxfSIsbmV3VmFsdWU9InsyfSJdJyAtZiAkZmlsZSwkbWF0Y2gsJG5ld1ZhbHVlIHwgV3JpdGUtVmVyYm9zZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSAgICAgICAKICAgIH0KfQoKPCMKLlNZTk9QU0lTClJldHVybnMgYW4gYXJyYXkgb2YgbXNkZXBsb3kgYXJndW1lbnRzIHRoYXQgYXJlIHVzZWQgYWNyb3NzIGRpZmZlcmVudCBwcm92aWRlcnMuCkZvciBleGFtcGxlIHRoaXMgd2lsbCBoYW5kbGUgdXNlQ2hlY2tzdW0sIEFwcE9mZmxpbmUgZXRjLgpUaGlzIHdpbGwgYWxzbyBhZGQgZGVmYXVsdCBwcm9wZXJ0aWVzIGlmIHRoZXkgYXJlIG1pc3NpbmcuCiM+CmZ1bmN0aW9uIEdldEludGVybmFsLVNoYXJlZE1TRGVwbG95UGFyYW1ldGVyc0Zyb217CiAgICBbY21kbGV0YmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JHRydWUsUG9zaXRpb249MCldCiAgICAgICAgW0hhc2hUYWJsZV0kcHVibGlzaFByb3BlcnRpZXMsCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JHRydWUsUG9zaXRpb249MSldCiAgICAgICAgW1N5c3RlbS5JTy5GaWxlSW5mb10kcGFja091dHB1dAogICAgKQogICAgcHJvY2Vzc3sKICAgICAgICAkc2hhcmVkQXJncyA9IE5ldy1PYmplY3QgcHNvYmplY3QgLVByb3BlcnR5IEB7CiAgICAgICAgICAgIEV4dHJhQXJncyA9IEAoKQogICAgICAgICAgICBEZXN0RnJhZ21lbnQgPSAnJwogICAgICAgICAgICBFRk1pZ3JhdGlvbkRhdGEgPSBAe30KICAgICAgICB9CgogICAgICAgICMgYWRkIGRlZmF1bHQgcHJvcGVydGllcyBpZiB0aGV5IGFyZSBtaXNzaW5nCiAgICAgICAgZm9yZWFjaCgkcHJvcE5hbWUgaW4gJGdsb2JhbDpBc3BOZXRQdWJsaXNoU2V0dGluZ3MuTXNkZXBsb3lEZWZhdWx0UHJvcGVydGllcy5LZXlzKXsKICAgICAgICAgICAgaWYoJHB1Ymxpc2hQcm9wZXJ0aWVzWyIkcHJvcE5hbWUiXSAtZXEgJG51bGwpewogICAgICAgICAgICAgICAgJGRlZlZhbHVlID0gJGdsb2JhbDpBc3BOZXRQdWJsaXNoU2V0dGluZ3MuTXNkZXBsb3lEZWZhdWx0UHJvcGVydGllc1siJHByb3BOYW1lIl0KICAgICAgICAgICAgICAgICdBZGRpbmcgZGVmYXVsdCBwcm9wZXJ0eSB0byBwdWJsaXNoUHJvcGVydGllcyBbInswfSI9InsxfSJdJyAtZiAkcHJvcE5hbWUsJGRlZlZhbHVlIHwgV3JpdGUtVmVyYm9zZQogICAgICAgICAgICAgICAgJHB1Ymxpc2hQcm9wZXJ0aWVzWyIkcHJvcE5hbWUiXSA9ICRkZWZWYWx1ZQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZigkcHVibGlzaFByb3BlcnRpZXNbJ01TRGVwbG95VXNlQ2hlY2tzdW0nXSAtZXEgJHRydWUpewogICAgICAgICAgICAkc2hhcmVkQXJncy5FeHRyYUFyZ3MgKz0gJy11c2VjaGVja3N1bScKICAgICAgICB9CgogICAgICAgIGlmKCRwdWJsaXNoUHJvcGVydGllc1snRW5hYmxlTVNEZXBsb3lBcHBPZmZsaW5lJ10gLWVxICR0cnVlKXsKICAgICAgICAgICAgJHNoYXJlZEFyZ3MuRXh0cmFBcmdzICs9ICctZW5hYmxlcnVsZTpBcHBPZmZsaW5lJwogICAgICAgIH0KCiAgICAgICAgaWYoJHB1Ymxpc2hQcm9wZXJ0aWVzWydXZWJQdWJsaXNoTWV0aG9kJ10gLWVxICdNU0RlcGxveScpeyAgICAgICAgICAgCiAgICAgICAgICAgIGlmKCRwdWJsaXNoUHJvcGVydGllc1snU2tpcEV4dHJhRmlsZXNPblNlcnZlciddIC1lcSAkdHJ1ZSl7CiAgICAgICAgICAgICAgICAkc2hhcmVkQXJncy5FeHRyYUFyZ3MgKz0gJy1lbmFibGVSdWxlOkRvTm90RGVsZXRlUnVsZScKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYoJHB1Ymxpc2hQcm9wZXJ0aWVzWydXZWJQdWJsaXNoTWV0aG9kJ10gLWVxICdGaWxlU3lzdGVtJyl7CiAgICAgICAgICAgIGlmKCRwdWJsaXNoUHJvcGVydGllc1snRGVsZXRlRXhpc3RpbmdGaWxlcyddIC1lcSAkZmFsc2UpewogICAgICAgICAgICAgICAgJHNoYXJlZEFyZ3MuRXh0cmFBcmdzICs9ICctZW5hYmxlUnVsZTpEb05vdERlbGV0ZVJ1bGUnCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmKCRwdWJsaXNoUHJvcGVydGllc1sncmV0cnlBdHRlbXB0cyddKXsKICAgICAgICAgICAgJHNoYXJlZEFyZ3MuRXh0cmFBcmdzICs9ICgnLXJldHJ5QXR0ZW1wdHM6ezB9JyAtZiAoW2ludF0kcHVibGlzaFByb3BlcnRpZXNbJ3JldHJ5QXR0ZW1wdHMnXSkpCiAgICAgICAgfQoKICAgICAgICBpZigkcHVibGlzaFByb3BlcnRpZXNbJ0VuY3J5cHRXZWJDb25maWcnXSAtZXEgJHRydWUpewogICAgICAgICAgICAkc2hhcmVkQXJncy5FeHRyYUFyZ3MgKz0gJy1FbmFibGVSdWxlOkVuY3J5cHRXZWJDb25maWcnCiAgICAgICAgfQoKICAgICAgICBpZigkcHVibGlzaFByb3BlcnRpZXNbJ0VuYWJsZU1TRGVwbG95QmFja3VwJ10gLWVxICRmYWxzZSl7CiAgICAgICAgICAgICRzaGFyZWRBcmdzLkV4dHJhQXJncyArPSAnLWRpc2FibGVydWxlOkJhY2t1cFJ1bGUnCiAgICAgICAgfQoKICAgICAgICBpZigkcHVibGlzaFByb3BlcnRpZXNbJ0FsbG93VW50cnVzdGVkQ2VydGlmaWNhdGUnXSAtZXEgJHRydWUpewogICAgICAgICAgICAkc2hhcmVkQXJncy5FeHRyYUFyZ3MgKz0gJy1hbGxvd1VudHJ1c3RlZCcKICAgICAgICB9CgogICAgICAgICMgYWRkIGV4Y2x1ZGVzCiAgICAgICAgJHNoYXJlZEFyZ3MuRXh0cmFBcmdzICs9IChHZXRJbnRlcm5hbC1FeGNsdWRlRmlsZXNBcmcgLXB1Ymxpc2hQcm9wZXJ0aWVzICRwdWJsaXNoUHJvcGVydGllcykKICAgICAgICAjIGFkZCByZXBsYWNlbWVudHMKICAgICAgICAkc2hhcmVkQXJncy5FeHRyYUFyZ3MgKz0gKEdldEludGVybmFsLVJlcGxhY2VtZW50c01TRGVwbG95QXJncyAtcHVibGlzaFByb3BlcnRpZXMgJHB1Ymxpc2hQcm9wZXJ0aWVzKQoKICAgICAgICAjIGFkZCBFRiBNaWdyYXRpb24KICAgICAgICBpZiAoKCRwdWJsaXNoUHJvcGVydGllc1snRWZNaWdyYXRpb25zJ10gLW5lICRudWxsKSAtYW5kICRwdWJsaXNoUHJvcGVydGllc1snRWZNaWdyYXRpb25zJ10uQ291bnQgLWd0IDApewogICAgICAgICAgICBpZiAoIShUZXN0LVBhdGggLVBhdGggJHB1Ymxpc2hQcm9wZXJ0aWVzWydQcm9qZWN0UGF0aCddKSkgewogICAgICAgICAgICAgICAgdGhyb3cgJ1Byb2plY3RQYXRoIHByb3BlcnR5IG5lZWRzIHRvIGJlIGRlZmluZWQgaW4gdGhlIHB1YnhtbCBmb3IgRUYgbWlncmF0aW9uLicKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgIyBnZW5lcmF0ZSBULVNRTCBmaWxlcwogICAgICAgICAgICAgICAgJEVGU3FsRmlsZXMgPSBHZW5lcmF0ZUludGVybmFsLUVGTWlncmF0aW9uU2NyaXB0cyAtcHJvamVjdFBhdGggJHB1Ymxpc2hQcm9wZXJ0aWVzWydQcm9qZWN0UGF0aCddIC1wYWNrT3V0cHV0ICRwYWNrT3V0cHV0IC1FRk1pZ3JhdGlvbnMgJHB1Ymxpc2hQcm9wZXJ0aWVzWydFZk1pZ3JhdGlvbnMnXQogICAgICAgICAgICAgICAgJHNoYXJlZEFyZ3MuRUZNaWdyYXRpb25EYXRhLkFkZCgnRUZTcWxGaWxlcycsJEVGU3FsRmlsZXMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgdGhyb3cgKCdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBnZW5lcmF0aW5nIEVGIG1pZ3JhdGlvbnMuIHswfSB7MX0nIC1mICRfLkV4Y2VwdGlvbiwoR2V0LVBTQ2FsbFN0YWNrKSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAjIGFkZCBjb25uZWN0aW9uIHN0cmluZyB1cGRhdGUKICAgICAgICBpZiAoKCRwdWJsaXNoUHJvcGVydGllc1snRGVzdGluYXRpb25Db25uZWN0aW9uU3RyaW5ncyddIC1uZSAkbnVsbCkgLWFuZCAkcHVibGlzaFByb3BlcnRpZXNbJ0Rlc3RpbmF0aW9uQ29ubmVjdGlvblN0cmluZ3MnXS5Db3VudCAtZ3QgMCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgIyBjcmVhdGUvdXBkYXRlIGFwcHNldHRpbmdzLltlbnZpcm9ubWVudF0uanNvbgogICAgICAgICAgICAgICAgR2VuZXJhdGVJbnRlcm5hbC1BcHBTZXR0aW5nc0ZpbGUgLXBhY2tPdXRwdXQgJHBhY2tPdXRwdXQgLWVudmlyb25tZW50TmFtZSAkcHVibGlzaFByb3BlcnRpZXNbJ0Vudmlyb25tZW50TmFtZSddIC1jb25uZWN0aW9uU3RyaW5ncyAkcHVibGlzaFByb3BlcnRpZXNbJ0Rlc3RpbmF0aW9uQ29ubmVjdGlvblN0cmluZ3MnXQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIHRocm93ICgnQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgZ2VuZXJhdGluZyB0aGUgcHVibGlzaCBhcHBzZXR0aW5ncyBmaWxlLiB7MH0gezF9JyAtZiAkXy5FeGNlcHRpb24sKEdldC1QU0NhbGxTdGFjaykpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmKC1ub3QgW3N0cmluZ106OklzTnVsbE9yV2hpdGVTcGFjZSgkcHVibGlzaFByb3BlcnRpZXNbJ1Byb2plY3RHdWlkJ10pKSB7CiAgICAgICAgICAgIEFkZEludGVybmFsLVByb2plY3RHdWlkVG9XZWJDb25maWcgLXB1Ymxpc2hQcm9wZXJ0aWVzICRwdWJsaXNoUHJvcGVydGllcyAtcGFja091dHB1dCAkcGFja091dHB1dAogICAgICAgIH0KCiAgICAgICAgIyByZXR1cm4gdGhlIGFyZ3MKICAgICAgICAkc2hhcmVkQXJncwogICAgfQp9Cgo8IwouU1lOT1BTSVMKVGhpcyB3aWxsIHB1Ymxpc2ggdGhlIGZvbGRlciBiYXNlZCBvbiB0aGUgcHJvcGVydGllcyBpbiAkcHVibGlzaFByb3BlcnRpZXMKCi5QQVJBTUVURVIgcHVibGlzaFByb3BlcnRpZXMKVGhpcyBpcyBhIGhhc2h0YWJsZSBjb250YWluaW5nIHRoZSBwdWJsaXNoIHByb3BlcnRpZXMuIFNlZSB0aGUgZXhhbXBsZXMgaGVyZSBmb3IgbW9yZSBpbmZvIG9uIGhvdyB0byB1c2UgdGhpcyBwYXJhbWV0ZXIuCgouUEFSQU1FVEVSIHBhY2tPdXRwdXQKVGhlIGZvbGRlciBwYXRoIHRvIHRoZSBvdXRwdXQgb2YgdGhlIGRudSBwdWJsaXNoIGNvbW1hbmQuIFRoaXMgZm9sZGVyIGNvbnRhaW5zIHRoZSBmaWxlcwp0aGF0IHdpbGwgYmUgcHVibGlzaGVkLgoKLlBBUkFNRVRFUiBwdWJQcm9maWxlUGF0aApQYXRoIHRvIGEgcHVibGlzaCBwcm9maWxlICgucHVieG1sIGZpbGUpIHRvIGltcG9ydCBwdWJsaXNoIHByb3BlcnRpZXMgZnJvbS4gSWYgdGhlIHNhbWUgcHJvcGVydHkgZXhpc3RzIGluCnB1Ymxpc2hQcm9wZXJ0aWVzIGFuZCB0aGUgcHVibGlzaCBwcm9maWxlIHRoZW4gcHVibGlzaFByb3BlcnRpZXMgd2lsbCB3aW4uCgouRVhBTVBMRQogUHVibGlzaC1Bc3BOZXQgLXBhY2tPdXRwdXQgJHBhY2tPdXRwdXQgLXB1Ymxpc2hQcm9wZXJ0aWVzIEB7CiAgICAgJ1dlYlB1Ymxpc2hNZXRob2QnPSdNU0RlcGxveScKICAgICAnTVNEZXBsb3lTZXJ2aWNlVVJMJz0nY29udG9zby5zY20uYXp1cmV3ZWJzaXRlcy5uZXQ6NDQzJztgCiAgICAgJ0RlcGxveUlpc0FwcFBhdGgnPSdjb250b3NvJzsnVXNlcm5hbWUnPSckY29udG9zbyc7J1Bhc3N3b3JkJz0iJGVudjpQdWJsaXNoUHdkIn0KCi5FWEFNUExFClB1Ymxpc2gtQXNwTmV0IC1wYWNrT3V0cHV0ICRwYWNrT3V0cHV0IC1wdWJsaXNoUHJvcGVydGllcyBAewogICAgJ1dlYlB1Ymxpc2hNZXRob2QnPSdGaWxlU3lzdGVtJwogICAgJ3B1Ymxpc2hVcmwnPSIkcHVibGlzaERlc3QiCiAgICB9CgouRVhBTVBMRQpQdWJsaXNoLUFzcE5ldCAtcGFja091dHB1dCAkcGFja091dHB1dCAtcHVibGlzaFByb3BlcnRpZXMgQHsKICAgICAnV2ViUHVibGlzaE1ldGhvZCc9J01TRGVwbG95JwogICAgICdNU0RlcGxveVNlcnZpY2VVUkwnPSdjb250b3NvLnNjbS5henVyZXdlYnNpdGVzLm5ldDo0NDMnO2AKJ0RlcGxveUlpc0FwcFBhdGgnPSdjb250b3NvJzsnVXNlcm5hbWUnPSckY29udG9zbyc7J1Bhc3N3b3JkJz0iJGVudjpQdWJsaXNoUHdkIgogICAgJ0V4Y2x1ZGVGaWxlcyc9QCgKICAgICAgICBAeydhYnNvbHV0ZXBhdGgnPSd0ZXN0LnR4dCd9LAogICAgICAgIEB7J2Fic29sdXRlcGF0aCc9J3JlZmVyZW5jZXMuanMnfQopfSAKCi5FWEFNUExFClB1Ymxpc2gtQXNwTmV0IC1wYWNrT3V0cHV0ICRwYWNrT3V0cHV0IC1wdWJsaXNoUHJvcGVydGllcyBAewogICAgJ1dlYlB1Ymxpc2hNZXRob2QnPSdGaWxlU3lzdGVtJwogICAgJ3B1Ymxpc2hVcmwnPSIkcHVibGlzaERlc3QiCiAgICAnRXhjbHVkZUZpbGVzJz1AKAogICAgICAgIEB7J2Fic29sdXRlcGF0aCc9J3Rlc3QudHh0J30sCiAgICAgICAgQHsnYWJzb2x1dGVwYXRoJz0nX3JlZmVyZW5jZXMuanMnfSkKICAgICdSZXBsYWNlbWVudHMnID0gQCgKICAgICAgICBAeydmaWxlJz0ndGVzdC50eHQkJzsnbWF0Y2gnPSdSRVBMQUNFTUUnOyduZXdWYWx1ZSc9J3VwZGF0ZWRWYWx1ZSd9KQogICAgfQoKUHVibGlzaC1Bc3BOZXQgLXBhY2tPdXRwdXQgJHBhY2tPdXRwdXQgLXB1Ymxpc2hQcm9wZXJ0aWVzIEB7CiAgICAnV2ViUHVibGlzaE1ldGhvZCc9J0ZpbGVTeXN0ZW0nCiAgICAncHVibGlzaFVybCc9IiRwdWJsaXNoRGVzdCIKICAgICdFeGNsdWRlRmlsZXMnPUAoCiAgICAgICAgQHsnYWJzb2x1dGVwYXRoJz0ndGVzdC50eHQnfSwKICAgICAgICBAeydhYnNvbHV0ZXBhdGgnPSdjOlxcZnVsbFxccGF0aFxcb2tcXGFzXFx3ZWxsXFxfcmVmZXJlbmNlcy5qcyd9KQogICAgJ1JlcGxhY2VtZW50cycgPSBAKAogICAgICAgIEB7J2ZpbGUnPSd0ZXN0LnR4dCQnOydtYXRjaCc9J1JFUExBQ0VNRSc7J25ld1ZhbHVlJz0ndXBkYXRlZFZhbHVlJ30pCiAgICB9CgouRVhBTVBMRQpQdWJsaXNoLUFzcE5ldCAtcGFja091dHB1dCAkcGFja091dHB1dCAtcHVibGlzaFByb3BlcnRpZXMgQHsKICAgICdXZWJQdWJsaXNoTWV0aG9kJz0nRmlsZVN5c3RlbScKICAgICdwdWJsaXNoVXJsJz0iJHB1Ymxpc2hEZXN0IgogICAgJ0VuYWJsZU1TRGVwbG95QXBwT2ZmbGluZSc9J3RydWUnCiAgICAnQXBwT2ZmbGluZVRlbXBsYXRlJz0nb2ZmbGluZS10ZW1wbGF0ZS5odG1sJwogICAgJ01TRGVwbG95VXNlQ2hlY2tzdW0nPSd0cnVlJwp9CiM+CmZ1bmN0aW9uIFB1Ymxpc2gtQXNwTmV0ewogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLFZhbHVlRnJvbVBpcGVsaW5lPSR0cnVlLFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JHRydWUpXQogICAgICAgIFtoYXNodGFibGVdJHB1Ymxpc2hQcm9wZXJ0aWVzID0gQHt9LAoKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlLFBvc2l0aW9uPTEsVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZT0kdHJ1ZSldCiAgICAgICAgW1N5c3RlbS5JTy5GaWxlSW5mb10kcGFja091dHB1dCwKCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0yLFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JHRydWUpXQogICAgICAgIFtTeXN0ZW0uSU8uRmlsZUluZm9dJHB1YlByb2ZpbGVQYXRoCiAgICApCiAgICBwcm9jZXNzewogICAgICAgIGlmKCRwdWJsaXNoUHJvcGVydGllc1snV2ViUHVibGlzaE1ldGhvZE92ZXJyaWRlJ10pewogICAgICAgICAgICAnT3ZlcnJpZGluZyBwdWJsaXNoIG1ldGhvZCBmcm9tICRwdWJsaXNoUHJvcGVydGllc1snJ1dlYlB1Ymxpc2hNZXRob2RPdmVycmlkZScnXSB0byBbezB9XScgLWYgICgkcHVibGlzaFByb3BlcnRpZXNbJ1dlYlB1Ymxpc2hNZXRob2RPdmVycmlkZSddKSB8IFdyaXRlLVZlcmJvc2UKICAgICAgICAgICAgJHB1Ymxpc2hQcm9wZXJ0aWVzWydXZWJQdWJsaXNoTWV0aG9kJ10gPSAkcHVibGlzaFByb3BlcnRpZXNbJ1dlYlB1Ymxpc2hNZXRob2RPdmVycmlkZSddCiAgICAgICAgfQoKICAgICAgICBpZigtbm90IFtzdHJpbmddOjpJc051bGxPcldoaXRlU3BhY2UoJHB1YlByb2ZpbGVQYXRoKSl7CiAgICAgICAgICAgICRwcm9maWxlUHJvcGVydGllcyA9IEdldC1Qcm9wZXJ0aWVzRnJvbVB1Ymxpc2hQcm9maWxlIC1maWxlcGF0aCAkcHViUHJvZmlsZVBhdGgKICAgICAgICAgICAgZm9yZWFjaCgka2V5IGluICRwcm9maWxlUHJvcGVydGllcy5LZXlzKXsKICAgICAgICAgICAgICAgIGlmKC1ub3QgKCRwdWJsaXNoUHJvcGVydGllcy5Db250YWluc0tleSgka2V5KSkpewogICAgICAgICAgICAgICAgICAgICdBZGRpbmcgcHJvcGVydGllcyBmcm9tIHB1Ymxpc2ggcHJvZmlsZSBbJyd7MH0nJz0nJ3sxfScnXScgLWYgJGtleSwkcHJvZmlsZVByb3BlcnRpZXNbJGtleV0gfCBXcml0ZS1WZXJib3NlCiAgICAgICAgICAgICAgICAgICAgJHB1Ymxpc2hQcm9wZXJ0aWVzLkFkZCgka2V5LCRwcm9maWxlUHJvcGVydGllc1ska2V5XSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYoIShbU3lzdGVtLklPLlBhdGhdOjpJc1BhdGhSb290ZWQoJHBhY2tPdXRwdXQpKSl7CiAgICAgICAgICAgICRwYWNrT3V0cHV0ID0gW1N5c3RlbS5JTy5QYXRoXTo6R2V0RnVsbFBhdGgoKEpvaW4tUGF0aCAkcHdkICRwYWNrT3V0cHV0KSkKICAgICAgICB9CgogICAgICAgICRwdWJNZXRob2QgPSAkcHVibGlzaFByb3BlcnRpZXNbJ1dlYlB1Ymxpc2hNZXRob2QnXQogICAgICAgICdQdWJsaXNoaW5nIHdpdGggcHVibGlzaCBtZXRob2QgW3swfV0nIC1mICRwdWJNZXRob2QgfCBXcml0ZS1PdXRwdXQKCiAgICAgICAgIyBnZXQgdGhlIGhhbmRsZXIgYmFzZWQgb24gV2ViUHVibGlzaE1ldGhvZCwgYW5kIGNhbGwgaXQuCiAgICAgICAgJihHZXQtQXNwbmV0UHVibGlzaEhhbmRsZXIgLW5hbWUgJHB1Yk1ldGhvZCkgJHB1Ymxpc2hQcm9wZXJ0aWVzICRwYWNrT3V0cHV0CiAgICB9Cn0KCjwjCi5TWU5PUFNJUwoKSW5wdXRzOgoKRXhhbXBsZSBvZiAkeG1sRG9jdW1lbnQ6ICc8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJ1dGYtOCI/PjxzaXRlbWFuaWZlc3Q+PC9zaXRlbWFuaWZlc3Q+JwpFeGFtcGxlIG9mICRwcm92aWRlckRhdGFBcnJheToKCiAgICBbU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdF0kcHJvdmlkZXJEYXRhQXJyYXkgPSBAKCkKCiAgICAkaWlzQXBwU291cmNlS2V5VmFsdWU9QHsiaWlzQXBwIiA9IEB7InBhdGgiPSdjOlx0ZW1wXHBhdGh0b2ZpbGVzJzsiYXBwT2ZmbGluZVRlbXBsYXRlIiA9J29mZmxpbmUtdGVtcGxhdGUuaHRtbCd9fQogICAgJHByb3ZpZGVyRGF0YUFycmF5LkFkZCgkaWlzQXBwU291cmNlS2V5VmFsdWUpCgogICAgJGRiZnVsbHNxbEtleVZhbHVlPUB7ImRiZnVsbHNxbCIgPSBAeyJwYXRoIj0iYzpcVGVtcFxQYXRoVG9TcWxGaWxlIn19CiAgICAkcHJvdmlkZXJEYXRhQXJyYXkuQWRkKCRkYmZ1bGxzcWxLZXlWYWx1ZSkKCiAgICAkZGJmdWxsc3FsS2V5VmFsdWU9QHsiZGJmdWxsc3FsIiA9IEB7InBhdGgiPSJjOlxUZW1wXFBhdGhUb1NxbEZpbGUyIn19CiAgICAkcHJvdmlkZXJEYXRhQXJyYXkuQWRkKCRkYmZ1bGxzcWxLZXlWYWx1ZSkKCiAgICBNYW5pZmVzdCBGaWxlIGNvbnRlbnQ6CiAgICAgICAgICAgIDw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9InV0Zi04Ij8+CiAgICAgICAgICAgIDxzaXRlbWFuaWZlc3Q+CiAgICAgICAgICAgIDxpaXNBcHAgcGF0aD0iYzpcdGVtcFxwYXRodG9maWxlcyIgYXBwT2ZmbGluZVRlbXBsYXRlPcOvwr/CvW9mZmxpbmUtdGVtcGxhdGUuaHRtbCIgLz4KICAgICAgICAgICAgPGRiRnVsbFNxbCBwYXRoPSJjOlxUZW1wXFBhdGhUb1NxbEZpbGUiIC8+CiAgICAgICAgICAgIDxkYkZ1bGxTcWwgcGF0aD0iYzpcVGVtcFxQYXRoVG9TcWxGaWxlMiIgLz4KICAgICAgICAgICAgPC9zaXRlbWFuaWZlc3Q+CiM+CmZ1bmN0aW9uIEFkZEludGVybmFsLVByb3ZpZGVyRGF0YVRvTWFuaWZlc3QgewogICAgW2NtZGxldGJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlLCBQb3NpdGlvbj0wKV0KICAgICAgICBbWE1MXSR4bWxEb2N1bWVudCwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTEpXQogICAgICAgIFtTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0XSRwcm92aWRlckRhdGFBcnJheQogICAgKQogICAgcHJvY2VzcyB7CiAgICAgICAgJHNpdGVOb2RlID0gJHhtbERvY3VtZW50LlNlbGVjdFNpbmdsZU5vZGUoIi9zaXRlbWFuaWZlc3QiKQogICAgICAgIGlmICgkc2l0ZU5vZGUgLWVxICRudWxsKSB7CiAgICAgICAgICAgIHRocm93ICdzaXRlbWFuaWZlc3QgZWxlbWVudCBpcyBtaXNzaW5nIGluIHRoZSB4bWwgb2JqZWN0JwogICAgICAgIH0KICAgICAgICBmb3JlYWNoICgkcHJvdmlkZXJEYXRhIGluICRwcm92aWRlckRhdGFBcnJheSkgewogICAgICAgICAgICBmb3JlYWNoICgkcHJvdmlkZXJOYW1lIGluICRwcm92aWRlckRhdGEuS2V5cykgewogICAgICAgICAgICAgICAgJHByb3ZpZGVyVmFsdWUgPSAkcHJvdmlkZXJEYXRhWyRwcm92aWRlck5hbWVdCiAgICAgICAgICAgICAgICAkeG1sTm9kZSA9ICR4bWxEb2N1bWVudC5DcmVhdGVFbGVtZW50KCRwcm92aWRlck5hbWUpCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkcHJvdmlkZXJWYWx1ZUtleSBpbiAkcHJvdmlkZXJWYWx1ZS5LZXlzKSB7CiAgICAgICAgICAgICAgICAgICAgJHhtbE5vZGUuU2V0QXR0cmlidXRlKCRwcm92aWRlclZhbHVlS2V5LCAkcHJvdmlkZXJWYWx1ZVskcHJvdmlkZXJWYWx1ZUtleV0pIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRzaXRlTm9kZS5BcHBlbmRDaGlsZCgkeG1sTm9kZSkgfCBPdXQtTnVsbCAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfSAKCmZ1bmN0aW9uIEFkZEludGVybmFsLVByb2plY3RHdWlkVG9XZWJDb25maWcgewogICAgW2NtZGxldGJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCldCiAgICAgICAgW0hhc2hUYWJsZV0kcHVibGlzaFByb3BlcnRpZXMsCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0xKV0KICAgICAgICBbU3lzdGVtLklPLkZpbGVJbmZvXSRwYWNrT3V0cHV0CiAgICApCiAgICBwcm9jZXNzIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBbUmVmbGVjdGlvbi5Bc3NlbWJseV06OkxvYWRXaXRoUGFydGlhbE5hbWUoIlN5c3RlbS5YbWwuTGlucSIpIHwgT3V0LU51bGwKICAgICAgICAgICAgJHdlYkNvbmZpZ1BhdGggPSBKb2luLVBhdGggJHBhY2tPdXRwdXQgJ3dlYi5jb25maWcnCiAgICAgICAgICAgICRwcm9qZWN0R3VpZENvbW1lbnRWYWx1ZSA9ICdQcm9qZWN0R3VpZDogezB9JyAtZiAkcHVibGlzaFByb3BlcnRpZXNbJ1Byb2plY3RHdWlkJ10KICAgICAgICAgICAgJHhEb2MgPSBbU3lzdGVtLlhtbC5MaW5xLlhEb2N1bWVudF06OkxvYWQoJHdlYkNvbmZpZ1BhdGgpCiAgICAgICAgICAgICRhbGxOb2RlcyA9ICR4RG9jLkRlc2NlbmRhbnROb2RlcygpIAogICAgICAgICAgICAkcHJvamVjdEd1aWRDb21tZW50ID0gJGFsbE5vZGVzIHwgV2hlcmUtT2JqZWN0IHsgJF8uTm9kZVR5cGUgLWVxIFtTeXN0ZW0uWG1sLlhtbE5vZGVUeXBlXTo6Q29tbWVudCAtYW5kICRfLlZhbHVlIC1lcSAkcHJvamVjdEd1aWRDb21tZW50VmFsdWUgfSB8IFNlbGVjdCAtRmlyc3QgMSAgICAKICAgICAgICAgICAgaWYoJHByb2plY3RHdWlkQ29tbWVudCAtbmUgJG51bGwpIHsKICAgICAgICAgICAgICAgIGlmKCRwdWJsaXNoUHJvcGVydGllc1snSWdub3JlUHJvamVjdEd1aWQnXSAtZXEgJHRydWUpIHsKICAgICAgICAgICAgICAgICAgICRwcm9qZWN0R3VpZENvbW1lbnQuUmVtb3ZlKCkgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgICAgJHhEb2MuU2F2ZSgkd2ViQ29uZmlnUGF0aCkgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYoLW5vdCAoJHB1Ymxpc2hQcm9wZXJ0aWVzWydJZ25vcmVQcm9qZWN0R3VpZCddIC1lcSAkdHJ1ZSkpIHsKICAgICAgICAgICAgICAgICAgICRwcm9qZWN0R3VpZENvbW1lbnQgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBTeXN0ZW0uWG1sLkxpbnEuWENvbW1lbnQgLUFyZ3VtZW50TGlzdCAkcHJvamVjdEd1aWRDb21tZW50VmFsdWUKICAgICAgICAgICAgICAgICAgICR4RG9jLkxhc3ROb2RlLkFkZEFmdGVyU2VsZigkcHJvamVjdEd1aWRDb21tZW50KSB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICAgICAkeERvYy5TYXZlKCR3ZWJDb25maWdQYXRoKSB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgIH0KICAgIH0KfQoKPCMKLlNZTk9QU0lTCgpFeGFtcGxlIG9mICRFRk1pZ3JhdGlvbnM6CiAgICAgICAgICAgICRFRk1pZ3JhdGlvbnMgPSBAeydDYXJDb250ZXh0Jz0nQ2FyIENvbnRleHQgQ29ubmVjdGlvblN0cmluZyc7J01vdmllQ29udGV4dCc9J01vdmllIENvbnRleHQgQ29ubmVjdGlvbiBTdHJpbmcnfQoKIz4KCmZ1bmN0aW9uIEdlbmVyYXRlSW50ZXJuYWwtRUZNaWdyYXRpb25TY3JpcHRzIHsKICAgIFtjbWRsZXRiaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kdHJ1ZSxQb3NpdGlvbj0wKV0KICAgICAgICBbU3lzdGVtLklPLkZpbGVJbmZvXSRwcm9qZWN0UGF0aCwKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kdHJ1ZSxQb3NpdGlvbj0xKV0KICAgICAgICBbU3lzdGVtLklPLkZpbGVJbmZvXSRwYWNrT3V0cHV0LAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MildCiAgICAgICAgW0hhc2hUYWJsZV0kRUZNaWdyYXRpb25zCiAgICApCiAgICBwcm9jZXNzIHsgICAgICAgICAgCiAgICAgICAgJGZpbGVzID0gQHt9CiAgICAgICAgJGRvdG5ldEV4ZVBhdGggPSBHZXRJbnRlcm5hbC1Eb3ROZXRFeGVQYXRoCiAgICAgICAgZm9yZWFjaCAoJGRiQ29udGV4dE5hbWUgaW4gJEVGTWlncmF0aW9ucy5LZXlzKSB7CiAgICAgICAgICAgIHRyeSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJHRlbXBEaXIgPSBHZXRJbnRlcm5hbC1QdWJsaXNoVGVtcFBhdGggLXBhY2tPdXRwdXQgJHBhY2tPdXRwdXQKICAgICAgICAgICAgICAgICRlZlNjcmlwdEZpbGUgPSBKb2luLVBhdGggJHRlbXBEaXIgKCd7MH0uc3FsJyAtZiAkZGJDb250ZXh0TmFtZSkKICAgICAgICAgICAgICAgICRhcmcgPSAoJ2VmIG1pZ3JhdGlvbnMgc2NyaXB0IC0taWRlbXBvdGVudCAtLW91dHB1dCB7MH0gLS1jb250ZXh0IHsxfScgLWYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGVmU2NyaXB0RmlsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRiQ29udGV4dE5hbWUpCgogICAgICAgICAgICAgICAgRXhlY3V0ZS1Db21tYW5kICRkb3RuZXRFeGVQYXRoICRhcmcgJHByb2plY3RQYXRoIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgIGlmIChUZXN0LVBhdGggLVBhdGggJGVmU2NyaXB0RmlsZSkgewogICAgICAgICAgICAgICAgICAgIGlmICghKCRmaWxlcy5Db250YWluc0tleSgkZGJDb250ZXh0TmFtZSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRmaWxlcy5BZGQoJGRiQ29udGV4dE5hbWUsICRlZlNjcmlwdEZpbGUpIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2gKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGhyb3cgJ2Vycm9yIG9jY3VyZWQgd2hlbiBleGVjdXRpbmcgZG90bmV0LmV4ZSB0byBnZW5lcmF0ZSBFRiBULVNRTCBmaWxlJwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICMgcmV0dXJuIGZpbGVzIG9iamVjdAogICAgICAgICRmaWxlcwogICAgfQp9Cgo8IwouU1lOT1BTSVMKCkV4YW1wbGUgb2YgJGNvbm5lY3Rpb25TdHJpbmdzOgogICAgICAgICAgICAkY29ubmVjdGlvblN0cmluZ3MgPSBAeydEZWZhdWx0Q29ubmVjdGlvbic9J0RlZmF1bHQgQ29ubmVjdGlvblN0cmluZyc7J0NhckNvbm5lY3Rpb24nPSdDYXIgQ29ubmVjdGlvbiBTdHJpbmcnfQoKIz4KZnVuY3Rpb24gR2VuZXJhdGVJbnRlcm5hbC1BcHBTZXR0aW5nc0ZpbGUgewogICAgW2NtZGxldGJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUsUG9zaXRpb249MCldCiAgICAgICAgW1N5c3RlbS5JTy5GaWxlSW5mb10kcGFja091dHB1dCwKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlLFBvc2l0aW9uPTEpXQogICAgICAgIFtzdHJpbmddJGVudmlyb25tZW50TmFtZSwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTIpXQogICAgICAgIFtIYXNoVGFibGVdJGNvbm5lY3Rpb25TdHJpbmdzCiAgICApCiAgICBwcm9jZXNzIHsgICAgCiAgICAgICAgJGNvbmZpZ1Byb2RKc29uRmlsZSA9ICdhcHBzZXR0aW5ncy57MH0uanNvbicgLWYgJGVudmlyb25tZW50TmFtZQogICAgICAgICRjb25maWdQcm9kSnNvbkZpbGVQYXRoID0gSm9pbi1QYXRoIC1QYXRoICRwYWNrT3V0cHV0IC1DaGlsZFBhdGggJGNvbmZpZ1Byb2RKc29uRmlsZSAKCiAgICAgICAgaWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRjb25maWdQcm9kSnNvbkZpbGVQYXRoKSkgewogICAgICAgICAgICB0aHJvdyAoJ1RoZSBwYXRoIG9mIHswfSBpcyBlbXB0eScgLWYgJGNvbmZpZ1Byb2RKc29uRmlsZVBhdGgpCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmKCEoVGVzdC1QYXRoIC1QYXRoICRjb25maWdQcm9kSnNvbkZpbGVQYXRoKSkgewogICAgICAgICAgICAjIGNyZWF0ZSBuZXcgZmlsZQogICAgICAgICAgICAne30nIHwgb3V0LWZpbGUgLWVuY29kaW5nIHV0ZjggLWZpbGVQYXRoICRjb25maWdQcm9kSnNvbkZpbGVQYXRoIC1Gb3JjZQogICAgICAgIH0KICAgICAgICAKICAgICAgICAkanNvbk9iaiA9IENvbnZlcnRGcm9tLUpzb24gLUlucHV0T2JqZWN0IChHZXQtQ29udGVudCAtUGF0aCAkY29uZmlnUHJvZEpzb25GaWxlUGF0aCAtUmF3KQogICAgICAgICMgdXBkYXRlIHdoZW4gdGhlcmUgZXhpc3RzIG9uZSBvciBtb3JlIGNvbm5lY3Rpb24gc3RyaW5ncwogICAgICAgIGlmICgkY29ubmVjdGlvblN0cmluZ3MgLW5lICRudWxsKSB7ICAgICAgICAgICAgCiAgICAgICAgICAgIGZvcmVhY2ggKCRuYW1lIGluICRjb25uZWN0aW9uU3RyaW5ncy5LZXlzKSB7CiAgICAgICAgICAgICAgICAjY2hlY2sgZm9yIGhpZXJhcmNoeSBzdHlsZQogICAgICAgICAgICAgICAgaWYgKCRqc29uT2JqLkNvbm5lY3Rpb25TdHJpbmdzLiRuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgJGpzb25PYmouQ29ubmVjdGlvblN0cmluZ3MuJG5hbWUgPSAkY29ubmVjdGlvblN0cmluZ3NbJG5hbWVdCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICNjaGVjayBmb3IgaG9yaXpvbnRhbCBzdHlsZQogICAgICAgICAgICAgICAgJGhvcml6b250YWxOYW1lID0gJ0Nvbm5lY3Rpb25TdHJpbmdzLnswfTonIC1mICRuYW1lCiAgICAgICAgICAgICAgICBpZiAoJGpzb25PYmouJGhvcml6b250YWxOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgJGpzb25PYmouJGhvcml6b250YWxOYW1lID0gJGNvbm5lY3Rpb25TdHJpbmdzWyRuYW1lXQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAjIGNyZWF0ZSBuZXcgb25lCiAgICAgICAgICAgICAgICBpZiAoISgkanNvbk9iai5Db25uZWN0aW9uU3RyaW5ncykpIHsKICAgICAgICAgICAgICAgICAgICAkY29udGVudEZvckRlZmF1bHRDb25uZWN0aW9uID0gJ3t9JwogICAgICAgICAgICAgICAgICAgICRqc29uT2JqIHwgQWRkLU1lbWJlciAtbmFtZSAnQ29ubmVjdGlvblN0cmluZ3MnIC12YWx1ZSAoQ29udmVydEZyb20tSnNvbiAtSW5wdXRPYmplY3QgJGNvbnRlbnRGb3JEZWZhdWx0Q29ubmVjdGlvbikgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IHwgT3V0LU51bGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghKCRqc29uT2JqLkNvbm5lY3Rpb25TdHJpbmdzLiRuYW1lKSkgewogICAgICAgICAgICAgICAgICAgICRqc29uT2JqLkNvbm5lY3Rpb25TdHJpbmdzIHwgQWRkLU1lbWJlciAtbmFtZSAkbmFtZSAtdmFsdWUgJGNvbm5lY3Rpb25TdHJpbmdzWyRuYW1lXSAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIAogICAgICAgICRqc29uT2JqIHwgQ29udmVydFRvLUpzb24gfCBvdXQtZmlsZSAtZW5jb2RpbmcgdXRmOCAtZmlsZVBhdGggJGNvbmZpZ1Byb2RKc29uRmlsZVBhdGggLUZvcmNlCiAgICAgICAgICAKICAgICAgICAjcmV0dXJuIHRoZSBwYXRoIG9mIGNvbmZpZy5bZW52aXJvbm1lbnRdLmpzb24KICAgICAgICAkY29uZmlnUHJvZEpzb25GaWxlUGF0aAogICAgfQp9Cgo8IwouU1lOT1BTSVMKCklucHV0czoKRXhhbXBsZSBvZiAkcHJvdmlkZXJEYXRhQXJyYXk6CgogICAgW1N5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3RdJHByb3ZpZGVyRGF0YUFycmF5ID0gQCgpCgogICAgJGlpc0FwcFNvdXJjZUtleVZhbHVlPUB7Imlpc0FwcCIgPSBAeyJwYXRoIj0nYzpcdGVtcFxwYXRodG9maWxlcyc7ImFwcE9mZmxpbmVUZW1wbGF0ZSIgPSdvZmZsaW5lLXRlbXBsYXRlLmh0bWwnfX0KICAgICRwcm92aWRlckRhdGFBcnJheS5BZGQoJGlpc0FwcFNvdXJjZUtleVZhbHVlKQoKICAgICRkYmZ1bGxzcWxLZXlWYWx1ZT1AeyJkYmZ1bGxzcWwiID0gQHsicGF0aCI9ImM6XFRlbXBcUGF0aFRvU3FsRmlsZSJ9fQogICAgJHByb3ZpZGVyRGF0YUFycmF5LkFkZCgkZGJmdWxsc3FsS2V5VmFsdWUpCgogICAgJGRiZnVsbHNxbEtleVZhbHVlPUB7ImRiZnVsbHNxbCIgPSBAeyJwYXRoIj0iYzpcVGVtcFxQYXRoVG9TcWxGaWxlMiJ9fQogICAgJHByb3ZpZGVyRGF0YUFycmF5LkFkZCgkZGJmdWxsc3FsS2V5VmFsdWUpCgogICAgTWFuaWZlc3QgRmlsZSBjb250ZW50OgogICAgICAgIDw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9InV0Zi04Ij8+CiAgICAgICAgPHNpdGVtYW5pZmVzdD4KICAgICAgICA8aWlzQXBwIHBhdGg9ImM6XHRlbXBccGF0aHRvZmlsZXMiIGFwcE9mZmxpbmVUZW1wbGF0ZT3Dr8K/wr1vZmZsaW5lLXRlbXBsYXRlLmh0bWwiIC8+CiAgICAgICAgPGRiRnVsbFNxbCBwYXRoPSJjOlxUZW1wXFBhdGhUb1NxbEZpbGUiIC8+CiAgICAgICAgPGRiRnVsbFNxbCBwYXRoPSJjOlxUZW1wXFBhdGhUb1NxbEZpbGUyIiAvPgogICAgICAgIDwvc2l0ZW1hbmlmZXN0PgoKIz4KCmZ1bmN0aW9uIEdlbmVyYXRlSW50ZXJuYWwtTWFuaWZlc3RGaWxlIHsKICAgIFtjbWRsZXRiaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kdHJ1ZSxQb3NpdGlvbj0wKV0KICAgICAgICBbU3lzdGVtLklPLkZpbGVJbmZvXSRwYWNrT3V0cHV0LAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlLFBvc2l0aW9uPTEpXQogICAgICAgICRwdWJsaXNoUHJvcGVydGllcywKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kdHJ1ZSxQb3NpdGlvbj0yKV0KICAgICAgICBbU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdF0kcHJvdmlkZXJEYXRhQXJyYXksCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JHRydWUsUG9zaXRpb249MyldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbCgpXQogICAgICAgICRtYW5pZmVzdEZpbGVOYW1lCiAgICApCiAgICBwcm9jZXNzewogICAgICAgICR4bWxEb2N1bWVudCA9IFt4bWxdJzw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9InV0Zi04Ij8+PHNpdGVtYW5pZmVzdD48L3NpdGVtYW5pZmVzdD4nCiAgICAgICAgQWRkSW50ZXJuYWwtUHJvdmlkZXJEYXRhVG9NYW5pZmVzdCAteG1sRG9jdW1lbnQgJHhtbERvY3VtZW50IC1wcm92aWRlckRhdGFBcnJheSAkcHJvdmlkZXJEYXRhQXJyYXkgfCBPdXQtTnVsbAogICAgICAgICRwdWJsaXNoVGVtcERpciA9IEdldEludGVybmFsLVB1Ymxpc2hUZW1wUGF0aCAtcGFja091dHB1dCAkcGFja091dHB1dAogICAgICAgICRYTUxGaWxlID0gSm9pbi1QYXRoICRwdWJsaXNoVGVtcERpciAkbWFuaWZlc3RGaWxlTmFtZQogICAgICAgICR4bWxEb2N1bWVudC5PdXRlclhtbCB8IG91dC1maWxlIC1lbmNvZGluZyB1dGY4IC1maWxlUGF0aCAkWE1MRmlsZSAtRm9yY2UKICAgICAgICAKICAgICAgICAjIHJldHVybiAKICAgICAgICBbU3lzdGVtLklPLkZpbGVJbmZvXSRYTUxGaWxlCiAgICB9Cn0KCmZ1bmN0aW9uIEdldEludGVybmFsLVB1Ymxpc2hUZW1wUGF0aCB7CiAgICBbY21kbGV0YmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JHRydWUsIFBvc2l0aW9uPTApXQogICAgICAgIFtTeXN0ZW0uSU8uRmlsZUluZm9dJHBhY2tPdXRwdXQKICAgICkKICAgIHByb2Nlc3MgewogICAgICAgICR0ZW1wRGlyID0gW2lvLnBhdGhdOjpHZXRUZW1wUGF0aCgpCiAgICAgICAgJHBhY2tPdXRwdXRGb2xkZXJOYW1lID0gU3BsaXQtUGF0aCAkcGFja091dHB1dCAtTGVhZgogICAgICAgICRwdWJsaXNoVGVtcERpciA9IFtpby5wYXRoXTo6Y29tYmluZSgkdGVtcERpciwnUHVibGlzaFRlbXAnLCdvYmonLCRwYWNrT3V0cHV0Rm9sZGVyTmFtZSkKICAgICAgICBpZiAoIShUZXN0LVBhdGggLVBhdGggJHB1Ymxpc2hUZW1wRGlyKSkgewogICAgICAgICAgICBOZXctSXRlbSAtUGF0aCAkcHVibGlzaFRlbXBEaXIgLXR5cGUgZGlyZWN0b3J5IHwgT3V0LU51bGwKICAgICAgICB9CiAgICAgICAgIyByZXR1cm4gCiAgICAgICAgW1N5c3RlbS5JTy5GaWxlSW5mb10kcHVibGlzaFRlbXBEaXIKICAgIH0KfQoKZnVuY3Rpb24gUHVibGlzaC1Bc3BOZXRNU0RlcGxveXsKICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUsUG9zaXRpb249MCxWYWx1ZUZyb21QaXBlbGluZT0kdHJ1ZSxWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSR0cnVlKV0KICAgICAgICAkcHVibGlzaFByb3BlcnRpZXMsCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSxQb3NpdGlvbj0xLFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JHRydWUpXQogICAgICAgICRwYWNrT3V0cHV0CiAgICApCiAgICBwcm9jZXNzewogICAgICAgIGlmKCRwdWJsaXNoUHJvcGVydGllcyl7CiAgICAgICAgICAgICRwdWJsaXNoUHdkID0gJHB1Ymxpc2hQcm9wZXJ0aWVzWydQYXNzd29yZCddCiAgICAgICAgICAgIAogICAgICAgICAgICAkc2hhcmVkQXJncyA9IEdldEludGVybmFsLVNoYXJlZE1TRGVwbG95UGFyYW1ldGVyc0Zyb20gLXB1Ymxpc2hQcm9wZXJ0aWVzICRwdWJsaXNoUHJvcGVydGllcyAtcGFja091dHB1dCAkcGFja091dHB1dAogICAgICAgICAgICAkaWlzQXBwUGF0aCA9ICRwdWJsaXNoUHJvcGVydGllc1snRGVwbG95SWlzQXBwUGF0aCddCiAgICAgICAgICAgIAogICAgICAgICAgICAjIGNyZWF0ZSBzb3VyY2UgbWFuaWZlc3QKCiAgICAgICAgICAgICMgZS5nCiAgICAgICAgICAgICMgPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KICAgICAgICAgICAgIyA8c2l0ZW1hbmlmZXN0PgogICAgICAgICAgICAjIDxpaXNBcHAgcGF0aD0iQzpcVGVtcFxQdWJsaXNoVGVtcFxXZWJBcHBsaWNhdGlvblwiIGFwcE9mZmxpbmVUZW1wbGF0ZT3Dr8K/wr1vZmZsaW5lLXRlbXBsYXRlLmh0bWwiIC8+CiAgICAgICAgICAgICMgPGRiRnVsbFNxbCBwYXRoPSJDOlxUZW1wXFB1Ymxpc2hUZW1wXG9ialxXZWJBcHBsaWNhdGlvbi5EYXRhLkFwcGxpY2F0aW9uRGJDb250ZXh0LnNxbCIgLz4KICAgICAgICAgICAgIyA8ZGJGdWxsU3FsIHBhdGg9IkM6XFRlbXBcUHVibGlzaFRlbXBcb2JqXFdlYkFwcGxpY2F0aW9uLkRhdGEuQ2FyQ29udGV4dC5zcWwiIC8+CiAgICAgICAgICAgICMgPC9zaXRlbWFuaWZlc3Q+CgogICAgICAgICAgICBbU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdF0kcHJvdmlkZXJEYXRhQXJyYXkgPSBAKCkKICAgICAgICAgICAgJGlpc0FwcFZhbHVlcyA9IEB7InBhdGgiPSRwYWNrT3V0cHV0fTsKICAgICAgICAgICAgJGlpc0FwcFNvdXJjZUtleVZhbHVlPUB7Imlpc0FwcCIgPSAkaWlzQXBwVmFsdWVzfQogICAgICAgICAgICAkcHJvdmlkZXJEYXRhQXJyYXkuQWRkKCRpaXNBcHBTb3VyY2VLZXlWYWx1ZSkgfCBPdXQtTnVsbAoKICAgICAgICAgICAgaWYgKCRzaGFyZWRBcmdzLkVGTWlncmF0aW9uRGF0YSAtbmUgJG51bGwgLWFuZCAkc2hhcmVkQXJncy5FRk1pZ3JhdGlvbkRhdGEuQ29udGFpbnMoJ0VGU3FsRmlsZXMnKSkgeyAKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRzcWxGaWxlIGluICRzaGFyZWRBcmdzLkVGTWlncmF0aW9uRGF0YVsnRUZTcWxGaWxlcyddLlZhbHVlcykgeyAKICAgICAgICAgICAgICAgICAgICAkZGJGdWxsU3FsU291cmNlS2V5VmFsdWU9QHsiZGJGdWxsU3FsIiA9IEB7InBhdGgiPSRzcWxGaWxlfX0KICAgICAgICAgICAgICAgICAgICAkcHJvdmlkZXJEYXRhQXJyYXkuQWRkKCRkYkZ1bGxTcWxTb3VyY2VLZXlWYWx1ZSkgfCBPdXQtTnVsbCAgICAgICAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgW1N5c3RlbS5JTy5GaWxlSW5mb10kc291cmNlWE1MRmlsZSA9IEdlbmVyYXRlSW50ZXJuYWwtTWFuaWZlc3RGaWxlIC1wYWNrT3V0cHV0ICRwYWNrT3V0cHV0IC1wdWJsaXNoUHJvcGVydGllcyAkcHVibGlzaFByb3BlcnRpZXMgLXByb3ZpZGVyRGF0YUFycmF5ICRwcm92aWRlckRhdGFBcnJheSAtbWFuaWZlc3RGaWxlTmFtZSAnU291cmNlTWFuaWZlc3QueG1sJwogICAgICAgICAgICAKICAgICAgICAgICAgJHByb3ZpZGVyRGF0YUFycmF5LkNsZWFyKCkgfCBPdXQtTnVsbAogICAgICAgICAgICAjIGNyZWF0ZSBkZXN0aW5hdGlvbiBtYW5pZmVzdCAgIAoKICAgICAgICAgICAgIyBlLmcKICAgICAgICAgICAgIyA8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJ1dGYtOCI/PgogICAgICAgICAgICAjIDxzaXRlbWFuaWZlc3Q+PGlpc0FwcCBwYXRoPSJXZWJBcHBsaWNhdGlvbjgwMjAxNjA2MDkwMTU0MDciIC8+CiAgICAgICAgICAgICMgPGRiRnVsbFNxbCBwYXRoPSJEYXRhIFNvdXJjZT10Y3A6d2ViYXBwbGljYXRpb25kYnNlcnZlci5kYXRhYmFzZS53aW5kb3dzLm5ldCwxNDMzO0luaXRpYWwgQ2F0YWxvZz1XZWJBcHBsaWNhdGlvbl9kYjtVc2VyIElkPXNxbGFkbWluQHdlYmFwcGxpY2F0aW9uZGJzZXJ2ZXI7UGFzc3dvcmQ9PHBhc3N3b3JkPiIgLz4KICAgICAgICAgICAgIyA8ZGJGdWxsU3FsIHBhdGg9IkRhdGEgU291cmNlPXRjcDp3ZWJhcHBsaWNhdGlvbmRic2VydmVyLmRhdGFiYXNlLndpbmRvd3MubmV0LDE0MzM7SW5pdGlhbCBDYXRhbG9nPVdlYkFwcGxpY2F0aW9uX2RiO1VzZXIgSWQ9c3FsYWRtaW5Ad2ViYXBwbGljYXRpb25kYnNlcnZlcjtQYXNzd29yZD08cGFzc3dvcmQ+IiAvPgogICAgICAgICAgICAjIDwvc2l0ZW1hbmlmZXN0PgoKICAgICAgICAgICAgJGlpc0FwcFZhbHVlcyA9IEB7InBhdGgiPSRpaXNBcHBQYXRofTsKICAgICAgICAgICAgaWYoLW5vdCBbc3RyaW5nXTo6SXNOdWxsT3JXaGl0ZVNwYWNlKCRwdWJsaXNoUHJvcGVydGllc1snQXBwT2ZmbGluZVRlbXBsYXRlJ10pKXsKICAgICAgICAgICAgICAgICRpaXNBcHBWYWx1ZXMuQWRkKCJhcHBPZmZsaW5lVGVtcGxhdGUiLCAkcHVibGlzaFByb3BlcnRpZXNbJ0FwcE9mZmxpbmVUZW1wbGF0ZSddKSB8IE91dC1OdWxsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRpaXNBcHBEZXN0aW5hdGlvbktleVZhbHVlPUB7Imlpc0FwcCIgPSAkaWlzQXBwVmFsdWVzfQogICAgICAgICAgICAkcHJvdmlkZXJEYXRhQXJyYXkuQWRkKCRpaXNBcHBEZXN0aW5hdGlvbktleVZhbHVlKSB8IE91dC1OdWxsCgogICAgICAgICAgICBpZiAoJHB1Ymxpc2hQcm9wZXJ0aWVzWydFZk1pZ3JhdGlvbnMnXSAtbmUgJG51bGwgLWFuZCAkcHVibGlzaFByb3BlcnRpZXNbJ0VmTWlncmF0aW9ucyddLkNvdW50IC1ndCAwKSB7IAogICAgICAgICAgICAgICAgZm9yZWFjaCAoJGNvbm5lY3Rpb25TdHJpbmcgaW4gJHB1Ymxpc2hQcm9wZXJ0aWVzWydFZk1pZ3JhdGlvbnMnXS5WYWx1ZXMpIHsgCiAgICAgICAgICAgICAgICAgICAgJGRiRnVsbFNxbERlc3RpbmF0aW9uS2V5VmFsdWU9QHsiZGJGdWxsU3FsIiA9IEB7InBhdGgiPSRjb25uZWN0aW9uU3RyaW5nfX0KICAgICAgICAgICAgICAgICAgICAkcHJvdmlkZXJEYXRhQXJyYXkuQWRkKCRkYkZ1bGxTcWxEZXN0aW5hdGlvbktleVZhbHVlKSB8IE91dC1OdWxsICAgICAgIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgoKICAgICAgICAgICAgW1N5c3RlbS5JTy5GaWxlSW5mb10kZGVzdFhNTEZpbGUgPSBHZW5lcmF0ZUludGVybmFsLU1hbmlmZXN0RmlsZSAtcGFja091dHB1dCAkcGFja091dHB1dCAtcHVibGlzaFByb3BlcnRpZXMgJHB1Ymxpc2hQcm9wZXJ0aWVzIC1wcm92aWRlckRhdGFBcnJheSAkcHJvdmlkZXJEYXRhQXJyYXkgLW1hbmlmZXN0RmlsZU5hbWUgJ0Rlc3RpbmF0aW9uTWFuaWZlc3QueG1sJwogIAogICAgICAgICAgICA8IwogICAgICAgICAgICAiQzpcUHJvZ3JhbSBGaWxlcyAoeDg2KVxJSVNcTWljcm9zb2Z0IFdlYiBEZXBsb3kgVjNcbXNkZXBsb3kuZXhlIiAKICAgICAgICAgICAgICAgIC1zb3VyY2U6bWFuaWZlc3Q9J0M6XFVzZXJzXHRlc3R1c2VyXEFwcERhdGFcTG9jYWxcVGVtcFxQdWJsaXNoVGVtcFxvYmpcU291cmNlTWFuaWZlc3QueG1sJyAKICAgICAgICAgICAgICAgIC1kZXN0Om1hbmlmZXN0PSdDOlxVc2Vyc1x0ZXN0dXNlclxBcHBEYXRhXExvY2FsXFRlbXBcUHVibGlzaFRlbXBcb2JqXERlc3RNYW5pZmVzdC54bWwnLENvbXB1dGVyTmFtZT0naHR0cHM6Ly9jb250b3NvLnNjbS5henVyZXdlYnNpdGVzLm5ldC9tc2RlcGxveS5heGQnLFVzZXJOYW1lPSckY29udG9zbycsUGFzc3dvcmQ9JzxQV0Q+JyxJbmNsdWRlQWNscz0nRmFsc2UnLEF1dGhUeXBlPSdCYXNpYycgCiAgICAgICAgICAgICAgICAtdmVyYjpzeW5jIAogICAgICAgICAgICAgICAgLWVuYWJsZVJ1bGU6RG9Ob3REZWxldGVSdWxlIAogICAgICAgICAgICAgICAgLXJldHJ5QXR0ZW1wdHM9MiIKICAgICAgICAgICAgIz4KCiAgICAgICAgICAgIGlmKC1ub3QgW3N0cmluZ106OklzTnVsbE9yV2hpdGVTcGFjZSgkcHVibGlzaFByb3BlcnRpZXNbJ01TRGVwbG95UHVibGlzaE1ldGhvZCddKSl7CiAgICAgICAgICAgICAgICAkc2VydmljZU1ldGhvZCA9ICRwdWJsaXNoUHJvcGVydGllc1snTVNEZXBsb3lQdWJsaXNoTWV0aG9kJ10KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgJG1zZGVwbG95Q29tcHV0ZXJOYW1lPSBJbnRlcm5hbE5vcm1hbGl6ZS1NU0RlcGxveVVybCAtc2VydmljZVVybCAkcHVibGlzaFByb3BlcnRpZXNbJ01TRGVwbG95U2VydmljZVVSTCddIC1zaXRlTmFtZSAkaWlzQXBwUGF0aCAtc2VydmljZU1ldGhvZCAkcHVibGlzaFByb3BlcnRpZXNbJ01TRGVwbG95UHVibGlzaE1ldGhvZCddCiAgICAgICAgICAgIGlmKCRwdWJsaXNoUHJvcGVydGllc1snVXNlTVNEZXBsb3lTZXJ2aWNlVVJMQXNJcyddIC1lcSAkdHJ1ZSl7CiAgICAgICAgICAgICAgICRtc2RlcGxveUNvbXB1dGVyTmFtZSA9ICRwdWJsaXNoUHJvcGVydGllc1snTVNEZXBsb3lTZXJ2aWNlVVJMJ10KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHB1Ymxpc2hBcmdzID0gQCgpCiAgICAgICAgICAgICN1c2UgbWFuaWZlc3QgdG8gcHVibGlzaAogICAgICAgICAgICAkcHVibGlzaEFyZ3MgKz0gKCctc291cmNlOm1hbmlmZXN0PScnezB9JycnIC1mICRzb3VyY2VYTUxGaWxlLkZ1bGxOYW1lKQogICAgICAgICAgICAkcHVibGlzaEFyZ3MgKz0gKCctZGVzdDptYW5pZmVzdD0nJ3swfScnLENvbXB1dGVyTmFtZT0nJ3sxfScnLFVzZXJOYW1lPScnezJ9JycsUGFzc3dvcmQ9Jyd7M30nJyxJbmNsdWRlQWNscz0nJ0ZhbHNlJycsQXV0aFR5cGU9Jyd7NH0nJ3s1fScgLWYgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkZXN0WE1MRmlsZS5GdWxsTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1zZGVwbG95Q29tcHV0ZXJOYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHVibGlzaFByb3BlcnRpZXNbJ1VzZXJOYW1lJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwdWJsaXNoUHdkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHVibGlzaFByb3BlcnRpZXNbJ0F1dGhUeXBlJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzaGFyZWRBcmdzLkRlc3RGcmFnbWVudCkKICAgICAgICAgICAgJHB1Ymxpc2hBcmdzICs9ICctdmVyYjpzeW5jJwogICAgICAgICAgICAkcHVibGlzaEFyZ3MgKz0gJHNoYXJlZEFyZ3MuRXh0cmFBcmdzCgogICAgICAgICAgICAkY29tbWFuZCA9ICciezB9IiB7MX0nIC1mIChHZXQtTVNEZXBsb3kpLCgkcHVibGlzaEFyZ3MgLWpvaW4gJyAnKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCEgW1N0cmluZ106OklzTnVsbE9yRW1wdHkoJHB1Ymxpc2hQd2QpKSB7CiAgICAgICAgICAgICRjb21tYW5kLlJlcGxhY2UoJHB1Ymxpc2hQd2QsJ3tQQVNTV09SRC1SRU1PVkVELUZST00tTE9HfScpIHwgUHJpbnQtQ29tbWFuZFN0cmluZwogICAgICAgICAgICB9CiAgICAgICAgICAgIEV4ZWN1dGUtQ29tbWFuZCAtZXhlUGF0aCAoR2V0LU1TRGVwbG95KSAtYXJndW1lbnRzICgkcHVibGlzaEFyZ3MgLWpvaW4gJyAnKQogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICB0aHJvdyAncHVibGlzaFByb3BlcnRpZXMgaXMgZW1wdHksIGNhbm5vdCBwdWJsaXNoJwogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gRXNjYXBlLVRleHRGb3JSZWd1bGFyRXhwcmVzc2lvbnN7CiAgICBbY21kbGV0YmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLE1hbmRhdG9yeT0kdHJ1ZSldCiAgICAgICAgW3N0cmluZ10kdGV4dAogICAgKQogICAgcHJvY2Vzc3sKICAgICAgICBbcmVnZXhdOjpFc2NhcGUoJHRleHQpCiAgICB9Cn0KCmZ1bmN0aW9uIFB1Ymxpc2gtQXNwTmV0TVNEZXBsb3lQYWNrYWdlewogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSxQb3NpdGlvbj0wLFZhbHVlRnJvbVBpcGVsaW5lPSR0cnVlLFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JHRydWUpXQogICAgICAgICRwdWJsaXNoUHJvcGVydGllcywKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlLFBvc2l0aW9uPTEsVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZT0kdHJ1ZSldCiAgICAgICAgJHBhY2tPdXRwdXQKICAgICkKICAgIHByb2Nlc3N7CiAgICAgICAgaWYoJHB1Ymxpc2hQcm9wZXJ0aWVzKXsKICAgICAgICAgICAgJHBhY2thZ2VEZXN0aW5hdGlvbkZpbGVwYXRoID0gJHB1Ymxpc2hQcm9wZXJ0aWVzWydEZXNrdG9wQnVpbGRQYWNrYWdlTG9jYXRpb24nXQoKICAgICAgICAgICAgaWYoISRwYWNrYWdlRGVzdGluYXRpb25GaWxlcGF0aCl7CiAgICAgICAgICAgICAgICB0aHJvdyAoJ1RoZSBwYWNrYWdlIGRlc3RpbmF0aW9uIHByb3BlcnR5IChEZXNrdG9wQnVpbGRQYWNrYWdlTG9jYXRpb24pIHdhcyBub3QgZm91bmQgaW4gdGhlIHB1Ymxpc2ggcHJvcGVydGllcycpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCEoW1N5c3RlbS5JTy5QYXRoXTo6SXNQYXRoUm9vdGVkKCRwYWNrYWdlRGVzdGluYXRpb25GaWxlcGF0aCkpKXsKICAgICAgICAgICAgICAgICRwYWNrYWdlRGVzdGluYXRpb25GaWxlcGF0aCA9IFtTeXN0ZW0uSU8uUGF0aF06OkdldEZ1bGxQYXRoKChKb2luLVBhdGggJHB3ZCAkcGFja2FnZURlc3RpbmF0aW9uRmlsZXBhdGgpKQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGlmIHRoZSBkaXIgZG9lc24ndCBleGlzdCBjcmVhdGUgaXQKICAgICAgICAgICAgJHBrZ0RpciA9ICgobmV3LW9iamVjdCAtdHlwZW5hbWUgU3lzdGVtLklPLkZpbGVJbmZvKCRwYWNrYWdlRGVzdGluYXRpb25GaWxlcGF0aCkpLkRpcmVjdG9yeSkKICAgICAgICAgICAgaWYoIShUZXN0LVBhdGggLVBhdGggJHBrZ0RpcikpIHsKICAgICAgICAgICAgICAgIE5ldy1JdGVtICRwa2dEaXIgLXR5cGUgRGlyZWN0b3J5IHwgT3V0LU51bGwKICAgICAgICAgICAgfQoKICAgICAgICAgICAgPCMKICAgICAgICAgICAgIkM6XFByb2dyYW0gRmlsZXMgKHg4NilcSUlTXE1pY3Jvc29mdCBXZWIgRGVwbG95IFYzXG1zZGVwbG95LmV4ZSIgCiAgICAgICAgICAgICAgICAtc291cmNlOm1hbmlmZXN0PSdDOlxVc2Vyc1x0ZXN0dXNlclxBcHBEYXRhXExvY2FsXFRlbXBcUHVibGlzaFRlbXBcb2JqXFNvdXJjZU1hbmlmZXN0LnhtbCcKICAgICAgICAgICAgICAgIC1kZXN0OnBhY2thZ2U9YzpcdGVtcFxwYXRoXGNvbnRvc293ZWIuemlwCiAgICAgICAgICAgICAgICAtdmVyYjpzeW5jIAogICAgICAgICAgICAgICAgLWVuYWJsZVJ1bGU6RG9Ob3REZWxldGVSdWxlICAKICAgICAgICAgICAgICAgIC1yZXRyeUF0dGVtcHRzPTIgCiAgICAgICAgICAgICM+CgogICAgICAgICAgICAkc2hhcmVkQXJncyA9IEdldEludGVybmFsLVNoYXJlZE1TRGVwbG95UGFyYW1ldGVyc0Zyb20gLXB1Ymxpc2hQcm9wZXJ0aWVzICRwdWJsaXNoUHJvcGVydGllcyAtcGFja091dHB1dCAkcGFja091dHB1dAoKICAgICAgICAgICAgIyBjcmVhdGUgc291cmNlIG1hbmlmZXN0CgogICAgICAgICAgICAjIGUuZwogICAgICAgICAgICAjIDw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9InV0Zi04Ij8+CiAgICAgICAgICAgICMgPHNpdGVtYW5pZmVzdD4KICAgICAgICAgICAgIyA8aWlzQXBwIHBhdGg9IkM6XFRlbXBcUHVibGlzaFRlbXBcV2ViQXBwbGljYXRpb25cIiAvPgogICAgICAgICAgICAjIDwvc2l0ZW1hbmlmZXN0PgoKICAgICAgICAgICAgW1N5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3RdJHByb3ZpZGVyRGF0YUFycmF5ID0gQCgpCiAgICAgICAgICAgICRpaXNBcHBTb3VyY2VLZXlWYWx1ZT1AeyJpaXNBcHAiID0gQHsicGF0aCI9JHBhY2tPdXRwdXR9fQogICAgICAgICAgICAkcHJvdmlkZXJEYXRhQXJyYXkuQWRkKCRpaXNBcHBTb3VyY2VLZXlWYWx1ZSkgfCBPdXQtTnVsbAoKICAgICAgICAgICAgW1N5c3RlbS5JTy5GaWxlSW5mb10kc291cmNlWE1MRmlsZSA9IEdlbmVyYXRlSW50ZXJuYWwtTWFuaWZlc3RGaWxlIC1wYWNrT3V0cHV0ICRwYWNrT3V0cHV0IC1wdWJsaXNoUHJvcGVydGllcyAkcHVibGlzaFByb3BlcnRpZXMgLXByb3ZpZGVyRGF0YUFycmF5ICRwcm92aWRlckRhdGFBcnJheSAtbWFuaWZlc3RGaWxlTmFtZSAnU291cmNlTWFuaWZlc3QueG1sJyAKCiAgICAgICAgICAgICRwdWJsaXNoQXJncyA9IEAoKQogICAgICAgICAgICAkcHVibGlzaEFyZ3MgKz0gKCctc291cmNlOm1hbmlmZXN0PScnezB9JycnIC1mICRzb3VyY2VYTUxGaWxlLkZ1bGxOYW1lKQogICAgICAgICAgICAkcHVibGlzaEFyZ3MgKz0gKCctZGVzdDpwYWNrYWdlPScnezB9JycnIC1mICRwYWNrYWdlRGVzdGluYXRpb25GaWxlcGF0aCkKICAgICAgICAgICAgJHB1Ymxpc2hBcmdzICs9ICctdmVyYjpzeW5jJwogICAgICAgICAgICAkcGFja2FnZUNvbnRlbnRGb2xkZXIgPSAkcHVibGlzaFByb3BlcnRpZXNbJ01TRGVwbG95UGFja2FnZUNvbnRlbnRGb2xkZXJuYW1lJ10KICAgICAgICAgICAgaWYoISRwYWNrYWdlQ29udGVudEZvbGRlcil7ICRwYWNrYWdlQ29udGVudEZvbGRlciA9ICd3ZWJzaXRlJyB9CiAgICAgICAgICAgICRwdWJsaXNoQXJncyArPSAoJy1yZXBsYWNlOm1hdGNoPScnezB9JycscmVwbGFjZT0nJ3sxfScnJyAtZiAoRXNjYXBlLVRleHRGb3JSZWd1bGFyRXhwcmVzc2lvbnMgJHBhY2tPdXRwdXQpLCAkcGFja2FnZUNvbnRlbnRGb2xkZXIgKQogICAgICAgICAgICAkcHVibGlzaEFyZ3MgKz0gJHNoYXJlZEFyZ3MuRXh0cmFBcmdzCiAgICAgICAgICAgIAogICAgICAgICAgICAkY29tbWFuZCA9ICciezB9IiB7MX0nIC1mIChHZXQtTVNEZXBsb3kpLCgkcHVibGlzaEFyZ3MgLWpvaW4gJyAnKQogICAgICAgICAgICAkY29tbWFuZCB8IFByaW50LUNvbW1hbmRTdHJpbmcKICAgICAgICAgICAgRXhlY3V0ZS1Db21tYW5kIC1leGVQYXRoIChHZXQtTVNEZXBsb3kpIC1hcmd1bWVudHMgKCRwdWJsaXNoQXJncyAtam9pbiAnICcpCiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIHRocm93ICdwdWJsaXNoUHJvcGVydGllcyBpcyBlbXB0eSwgY2Fubm90IHB1Ymxpc2gnCiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBQdWJsaXNoLUFzcE5ldEZpbGVTeXN0ZW17CiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlLFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JHRydWUsVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZT0kdHJ1ZSldCiAgICAgICAgJHB1Ymxpc2hQcm9wZXJ0aWVzLAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUsUG9zaXRpb249MSxWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSR0cnVlKV0KICAgICAgICAkcGFja091dHB1dAogICAgKQogICAgcHJvY2Vzc3sKICAgICAgICAkcHViT3V0ID0gJHB1Ymxpc2hQcm9wZXJ0aWVzWydwdWJsaXNoVXJsJ10KICAgICAgICAKICAgICAgICBpZihbc3RyaW5nXTo6SXNOdWxsT3JXaGl0ZVNwYWNlKCRwdWJPdXQpKXsKICAgICAgICAgICAgdGhyb3cgKCdwdWJsaXNoVXJsIGlzIGEgcmVxdWlyZWQgcHJvcGVydHkgZm9yIEZpbGVTeXN0ZW0gcHVibGlzaCBidXQgaXQgd2FzIGVtcHR5LicpCiAgICAgICAgfQoKICAgICAgICAjIGlmIGl0J3MgYSByZWxhdGl2ZSBwYXRoIHRoZW4gdXBkYXRlIGl0IHRvIGEgZnVsbCBwYXRoCiAgICAgICAgaWYoIShbU3lzdGVtLklPLlBhdGhdOjpJc1BhdGhSb290ZWQoJHB1Yk91dCkpKXsKICAgICAgICAgICAgJHB1Yk91dCA9IFtTeXN0ZW0uSU8uUGF0aF06OkdldEZ1bGxQYXRoKChKb2luLVBhdGggJHB3ZCAkcHViT3V0KSkKICAgICAgICAgICAgJHB1Ymxpc2hQcm9wZXJ0aWVzWydwdWJsaXNoVXJsJ10gPSAiJHB1Yk91dCIKICAgICAgICB9CgogICAgICAgICdQdWJsaXNoaW5nIGZpbGVzIHRvIHswfScgLWYgJHB1Yk91dCB8IFdyaXRlLU91dHB1dAoKICAgICAgICAjIHdlIHVzZSBtc2RlcGxveS5leGUgYmVjYXVzZSBpdCBzdXBwb3J0cyBpbmNyZW1lbnRhbCBwdWJsaXNoL3NraXBzL3JlcGxhY2VtZW50cy9ldGMKICAgICAgICAjIG1zZGVwbG95LmV4ZSAtdmVyYjpzeW5jIC1zb3VyY2U6bWFuaWZlc3Q9J0M6XFVzZXJzXHRlc3R1c2VyXEFwcERhdGFcTG9jYWxcVGVtcFxQdWJsaXNoVGVtcFxvYmpcU291cmNlTWFuaWZlc3QueG1sJyAtZGVzdDptYW5pZmVzdD0nQzpcVXNlcnNcdGVzdHVzZXJcQXBwRGF0YVxMb2NhbFxUZW1wXFB1Ymxpc2hUZW1wXG9ialxEZXN0TWFuaWZlc3QueG1sJwogICAgICAgIAogICAgICAgICRzaGFyZWRBcmdzID0gR2V0SW50ZXJuYWwtU2hhcmVkTVNEZXBsb3lQYXJhbWV0ZXJzRnJvbSAtcHVibGlzaFByb3BlcnRpZXMgJHB1Ymxpc2hQcm9wZXJ0aWVzIC1wYWNrT3V0cHV0ICRwYWNrT3V0cHV0CgogICAgICAgICMgY3JlYXRlIHNvdXJjZSBtYW5pZmVzdAoKICAgICAgICAjIGUuZwogICAgICAgICMgPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KICAgICAgICAjIDxzaXRlbWFuaWZlc3Q+CiAgICAgICAgIyA8Y29udGVudFBhdGggcGF0aD0iQzpcVGVtcFxQdWJsaXNoVGVtcFxXZWJBcHBsaWNhdGlvblwiIGFwcE9mZmxpbmVUZW1wbGF0ZT3Dr8K/wr1vZmZsaW5lLXRlbXBsYXRlLmh0bWwiIC8+CiAgICAgICAgIyA8L3NpdGVtYW5pZmVzdD4KCiAgICAgICAgW1N5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3RdJHByb3ZpZGVyRGF0YUFycmF5ID0gQCgpCiAgICAgICAgJGNvbnRlbnRQYXRoVmFsdWVzID0gQHsicGF0aCI9JHBhY2tPdXRwdXR9OwogICAgICAgICRjb250ZW50UGF0aFNvdXJjZUtleVZhbHVlPUB7ImNvbnRlbnRQYXRoIiA9ICRjb250ZW50UGF0aFZhbHVlc30KICAgICAgICAkcHJvdmlkZXJEYXRhQXJyYXkuQWRkKCRjb250ZW50UGF0aFNvdXJjZUtleVZhbHVlKSB8IE91dC1OdWxsCiAgICAgICAgICAgIAogICAgICAgIFtTeXN0ZW0uSU8uRmlsZUluZm9dJHNvdXJjZVhNTEZpbGUgPSBHZW5lcmF0ZUludGVybmFsLU1hbmlmZXN0RmlsZSAtcGFja091dHB1dCAkcGFja091dHB1dCAtcHVibGlzaFByb3BlcnRpZXMgJHB1Ymxpc2hQcm9wZXJ0aWVzIC1wcm92aWRlckRhdGFBcnJheSAkcHJvdmlkZXJEYXRhQXJyYXkgLW1hbmlmZXN0RmlsZU5hbWUgJ1NvdXJjZU1hbmlmZXN0LnhtbCcKICAgICAgICAgICAgCiAgICAgICAgJHByb3ZpZGVyRGF0YUFycmF5LkNsZWFyKCkgfCBPdXQtTnVsbAogICAgICAgICMgY3JlYXRlIGRlc3RpbmF0aW9uIG1hbmlmZXN0ICAgCgogICAgICAgICMgZS5nCiAgICAgICAgIyA8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJ1dGYtOCI/PgogICAgICAgICMgPHNpdGVtYW5pZmVzdD48Y29udGVudFBhdGggcGF0aD0iQzpcVGVtcFxQdWJsaXNoVGVtcFxXZWJBcHBsaWNhdGlvbkRlc3RpbmF0aW9uXCIgLz4KICAgICAgICAjIDwvc2l0ZW1hbmlmZXN0PgogICAgICAgICRjb250ZW50UGF0aFZhbHVlcyA9IEB7InBhdGgiPSRwdWJsaXNoUHJvcGVydGllc1sncHVibGlzaFVybCddfTsKICAgICAgICBpZigtbm90IFtzdHJpbmddOjpJc051bGxPcldoaXRlU3BhY2UoJHB1Ymxpc2hQcm9wZXJ0aWVzWydBcHBPZmZsaW5lVGVtcGxhdGUnXSkpewogICAgICAgICAgICAkY29udGVudFBhdGhWYWx1ZXMuQWRkKCJhcHBPZmZsaW5lVGVtcGxhdGUiLCAkcHVibGlzaFByb3BlcnRpZXNbJ0FwcE9mZmxpbmVUZW1wbGF0ZSddKSB8IE91dC1OdWxsCiAgICAgICAgfQogICAgICAgICRjb250ZW50UGF0aERlc3RpbmF0aW9uS2V5VmFsdWU9QHsiY29udGVudFBhdGgiID0gJGNvbnRlbnRQYXRoVmFsdWVzfQogICAgICAgICRwcm92aWRlckRhdGFBcnJheS5BZGQoJGNvbnRlbnRQYXRoRGVzdGluYXRpb25LZXlWYWx1ZSkgfCBPdXQtTnVsbAoKICAgICAgICBbU3lzdGVtLklPLkZpbGVJbmZvXSRkZXN0WE1MRmlsZSA9IEdlbmVyYXRlSW50ZXJuYWwtTWFuaWZlc3RGaWxlIC1wYWNrT3V0cHV0ICRwYWNrT3V0cHV0IC1wdWJsaXNoUHJvcGVydGllcyAkcHVibGlzaFByb3BlcnRpZXMgLXByb3ZpZGVyRGF0YUFycmF5ICRwcm92aWRlckRhdGFBcnJheSAtbWFuaWZlc3RGaWxlTmFtZSAnRGVzdGluYXRpb25NYW5pZmVzdC54bWwnCiAgICAgICAgCiAgICAgICAgJHB1Ymxpc2hBcmdzID0gQCgpCiAgICAgICAgJHB1Ymxpc2hBcmdzICs9ICgnLXNvdXJjZTptYW5pZmVzdD0nJ3swfScnJyAtZiAkc291cmNlWE1MRmlsZS5GdWxsTmFtZSkKICAgICAgICAkcHVibGlzaEFyZ3MgKz0gKCctZGVzdDptYW5pZmVzdD0nJ3swfScnezF9JyAtZiAkZGVzdFhNTEZpbGUuRnVsbE5hbWUsICRzaGFyZWRBcmdzLkRlc3RGcmFnbWVudCkKICAgICAgICAkcHVibGlzaEFyZ3MgKz0gJy12ZXJiOnN5bmMnCiAgICAgICAgJHB1Ymxpc2hBcmdzICs9ICRzaGFyZWRBcmdzLkV4dHJhQXJncwoKICAgICAgICAkY29tbWFuZCA9ICciezB9IiB7MX0nIC1mIChHZXQtTVNEZXBsb3kpLCgkcHVibGlzaEFyZ3MgLWpvaW4gJyAnKQogICAgICAgICRjb21tYW5kIHwgUHJpbnQtQ29tbWFuZFN0cmluZwogICAgICAgIEV4ZWN1dGUtQ29tbWFuZCAtZXhlUGF0aCAoR2V0LU1TRGVwbG95KSAtYXJndW1lbnRzICgkcHVibGlzaEFyZ3MgLWpvaW4gJyAnKQogICAgICAgIAogICAgICAgICMgY29weSBzcWwgc2NyaXB0IHRvIHNjcmlwdCBmb2xkZXIKICAgICAgICBpZiAoKCRzaGFyZWRBcmdzLkVGTWlncmF0aW9uRGF0YVsnRUZTcWxGaWxlcyddIC1uZSAkbnVsbCkgLWFuZCAoJHNoYXJlZEFyZ3MuRUZNaWdyYXRpb25EYXRhWydFRlNxbEZpbGVzJ10uQ291bnQgLWd0IDApKSB7CiAgICAgICAgICAgICRzY3JpcHRzRGlyID0gSm9pbi1QYXRoICRwdWJPdXQgJ2Vmc2NyaXB0cycKCiAgICAgICAgICAgIGlmICghKFRlc3QtUGF0aCAtUGF0aCAkc2NyaXB0c0RpcikpIHsKICAgICAgICAgICAgICAgIE5ldy1JdGVtIC1QYXRoICRzY3JpcHRzRGlyIC10eXBlIGRpcmVjdG9yeSB8IE91dC1OdWxsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvcmVhY2ggKCRzcWxGaWxlIGluICRzaGFyZWRBcmdzLkVGTWlncmF0aW9uRGF0YVsnRUZTcWxGaWxlcyddLlZhbHVlcykgewogICAgICAgICAgICAgICAgQ29weS1JdGVtICRzcWxGaWxlIC1EZXN0aW5hdGlvbiAkc2NyaXB0c0RpciAtRm9yY2UgLVJlY3Vyc2UgfCBPdXQtTnVsbAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9Cgo8IwouU1lOT1BTSVMKICAgIFRoaXMgY2FuIGJlIHVzZWQgdG8gcmVhZCBhIHB1Ymxpc2ggcHJvZmlsZSB0byBleHRyYWN0IHRoZSBwcm9wZXJ0eSB2YWx1ZXMgaW50byBhIGhhc2h0YWJsZS4KCi5QQVJBTUVURVIgZmlsZXBhdGgKICAgIFBhdGggdG8gdGhlIHB1Ymxpc2ggcHJvZmlsZSB0byBnZXQgdGhlIHByb3BlcnRpZXMgZnJvbS4gQ3VycmVubHR5IHRoaXMgb25seSBzdXBwb3J0cyByZWFkaW5nCiAgICAucHVieG1sIGZpbGVzLgoKLkVYQU1QTEUKICAgIEdldC1Qcm9wZXJ0aWVzRnJvbVB1Ymxpc2hQcm9maWxlIC1maWxlcGF0aCBjOlxwcm9qZWN0c1xwdWJsaXNoXGRldnB1Ymxpc2gucHVieG1sCiM+CmZ1bmN0aW9uIEdldC1Qcm9wZXJ0aWVzRnJvbVB1Ymxpc2hQcm9maWxlewogICAgW2NtZGxldGJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxNYW5kYXRvcnk9JHRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGwoKV0KICAgICAgICBbVmFsaWRhdGVTY3JpcHQoe1Rlc3QtUGF0aCAkX30pXQogICAgICAgIFtTeXN0ZW0uSU8uRmlsZUluZm9dJGZpbGVwYXRoCiAgICApCiAgICBiZWdpbnsKICAgICAgICBBZGQtVHlwZSAtQXNzZW1ibHlOYW1lIFN5c3RlbS5Db3JlCiAgICAgICAgQWRkLVR5cGUgLUFzc2VtYmx5TmFtZSBNaWNyb3NvZnQuQnVpbGQKICAgIH0KICAgIHByb2Nlc3N7CiAgICAgICAgJ1JlYWRpbmcgcHVibGlzaCBwcm9wZXJ0aWVzIGZyb20gcHJvZmlsZSBbezB9XScgLWYgJGZpbGVwYXRoIHwgV3JpdGUtVmVyYm9zZQogICAgICAgICMgdXNlIE1TQnVpbGQgdG8gZ2V0IHRoZSBwcm9qZWN0IGFuZCByZWFkIHByb3BlcnRpZXMKICAgICAgICAkcHJvamVjdENvbGxlY3Rpb24gPSAoTmV3LU9iamVjdCBNaWNyb3NvZnQuQnVpbGQuRXZhbHVhdGlvbi5Qcm9qZWN0Q29sbGVjdGlvbikKICAgICAgICBpZighKFtTeXN0ZW0uSU8uUGF0aF06OklzUGF0aFJvb3RlZCgkZmlsZXBhdGgpKSl7CiAgICAgICAgICAgICRmaWxlcGF0aCA9IFtTeXN0ZW0uSU8uUGF0aF06OkdldEZ1bGxQYXRoKChKb2luLVBhdGggJHB3ZCAkZmlsZXBhdGgpKQogICAgICAgIH0KICAgICAgICAkcHJvamVjdCA9IChbTWljcm9zb2Z0LkJ1aWxkLkNvbnN0cnVjdGlvbi5Qcm9qZWN0Um9vdEVsZW1lbnRdOjpPcGVuKFtzdHJpbmddJGZpbGVwYXRoLkZ1bGxuYW1lLCAkcHJvamVjdENvbGxlY3Rpb24pKQoKICAgICAgICAkcHJvcGVydGllcyA9IEB7fQogICAgICAgIGZvcmVhY2goJHByb3BlcnR5IGluICRwcm9qZWN0LlByb3BlcnRpZXMpewogICAgICAgICAgICAkcHJvcGVydGllc1skcHJvcGVydHkuTmFtZV09JHByb3BlcnR5LlZhbHVlCiAgICAgICAgfQoKICAgICAgICAkcHJvcGVydGllcwogICAgfQp9CgpmdW5jdGlvbiBQcmludC1Db21tYW5kU3RyaW5newogICAgW2NtZGxldGJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlLFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JHRydWUpXQogICAgICAgICRjb21tYW5kCiAgICApCiAgICBwcm9jZXNzewogICAgICAgICdFeGVjdXRpbmcgY29tbWFuZCBbezB9XScgLWYgJGNvbW1hbmQgfCBXcml0ZS1PdXRwdXQKICAgIH0KfQoKZnVuY3Rpb24gRXhlY3V0ZS1Db21tYW5kU3RyaW5newogICAgW2NtZGxldGJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlLFBvc2l0aW9uPTAsVmFsdWVGcm9tUGlwZWxpbmU9JHRydWUpXQogICAgICAgIFtzdHJpbmdbXV0kY29tbWFuZCwKICAgICAgICAKICAgICAgICBbc3dpdGNoXQogICAgICAgICR1c2VJbnZva2VFeHByZXNzaW9uLAoKICAgICAgICBbc3dpdGNoXQogICAgICAgICRpZ25vcmVFcnJvcnMKICAgICkKICAgIHByb2Nlc3N7CiAgICAgICAgZm9yZWFjaCgkY21kVG9FeGVjIGluICRjb21tYW5kKXsKICAgICAgICAgICAgJ0V4ZWN1dGluZyBjb21tYW5kIFt7MH1dJyAtZiAkY21kVG9FeGVjIHwgV3JpdGUtVmVyYm9zZQogICAgICAgICAgICBpZigkdXNlSW52b2tlRXhwcmVzc2lvbil7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIEludm9rZS1FeHByZXNzaW9uIC1Db21tYW5kICRjbWRUb0V4ZWMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICBpZigtbm90ICRpZ25vcmVFcnJvcnMpewogICAgICAgICAgICAgICAgICAgICAgICAkbXNnID0gKCdUaGUgY29tbWFuZCBbezB9XSBleGl0ZWQgd2l0aCBleGNlcHRpb24gW3sxfV0nIC1mICRjbWRUb0V4ZWMsICRfLlRvU3RyaW5nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93ICRtc2cKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjbWQuZXhlIC9EIC9DICRjbWRUb0V4ZWMKCiAgICAgICAgICAgICAgICBpZigtbm90ICRpZ25vcmVFcnJvcnMgLWFuZCAoJExBU1RFWElUQ09ERSAtbmUgMCkpewogICAgICAgICAgICAgICAgICAgICRtc2cgPSAoJ1RoZSBjb21tYW5kIFt7MH1dIGV4aXRlZCB3aXRoIGNvZGUgW3sxfV0nIC1mICRjbWRUb0V4ZWMsICRMQVNURVhJVENPREUpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgJG1zZwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBFeGVjdXRlLUNvbW1hbmQgewogICAgW2NtZGxldGJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUsUG9zaXRpb249MCxWYWx1ZUZyb21QaXBlbGluZT0kdHJ1ZSxWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSR0cnVlKV0KICAgICAgICBbU3RyaW5nXSRleGVQYXRoLAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUsUG9zaXRpb249MSxWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSR0cnVlKV0KICAgICAgICBbU3RyaW5nXSRhcmd1bWVudHMsCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0yKV0KICAgICAgICBbU3lzdGVtLklPLkZpbGVJbmZvXSR3b3JraW5nRGlyZWN0b3J5CiAgICAgICAgKQogICAgcHJvY2Vzc3sKICAgICAgICAkcHNpID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgU3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3NTdGFydEluZm8KICAgICAgICAkcHNpLkNyZWF0ZU5vV2luZG93ID0gJHRydWUKICAgICAgICAkcHNpLlVzZVNoZWxsRXhlY3V0ZSA9ICRmYWxzZQogICAgICAgICRwc2kuUmVkaXJlY3RTdGFuZGFyZE91dHB1dCA9ICR0cnVlCiAgICAgICAgJHBzaS5SZWRpcmVjdFN0YW5kYXJkRXJyb3I9JHRydWUKICAgICAgICAkcHNpLkZpbGVOYW1lID0gJGV4ZVBhdGgKICAgICAgICAkcHNpLkFyZ3VtZW50cyA9ICRhcmd1bWVudHMKICAgICAgICBpZigkd29ya2luZ0RpcmVjdG9yeSAtYW5kIChUZXN0LVBhdGggLVBhdGggJHdvcmtpbmdEaXJlY3RvcnkpKSB7CiAgICAgICAgICAgICRwc2kuV29ya2luZ0RpcmVjdG9yeSA9ICR3b3JraW5nRGlyZWN0b3J5CiAgICAgICAgfQoKICAgICAgICAkcHJvY2VzcyA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzCiAgICAgICAgJHByb2Nlc3MuU3RhcnRJbmZvID0gJHBzaQogICAgICAgICRwcm9jZXNzLkVuYWJsZVJhaXNpbmdFdmVudHM9JHRydWUKCiAgICAgICAgIyBSZWdpc3RlciB0aGUgZXZlbnQgaGFuZGxlciBmb3IgZXJyb3IKICAgICAgICAkc3RkRXJyRXZlbnQgPSBSZWdpc3Rlci1PYmplY3RFdmVudCAtSW5wdXRPYmplY3QgJHByb2Nlc3MgIC1FdmVudE5hbWUgJ0Vycm9yRGF0YVJlY2VpdmVkJyAtQWN0aW9uIHsKICAgICAgICAgICAgaWYgKCEgW1N0cmluZ106OklzTnVsbE9yRW1wdHkoJEV2ZW50QXJncy5EYXRhKSkgewogICAgICAgICAgICAgJEV2ZW50QXJncy5EYXRhIHwgV3JpdGUtRXJyb3IgCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgU3RhcnRpbmcgcHJvY2Vzcy4KICAgICAgICAkcHJvY2Vzcy5TdGFydCgpIHwgT3V0LU51bGwKICAgICAgICAkcHJvY2Vzcy5CZWdpbkVycm9yUmVhZExpbmUoKSB8IE91dC1OdWxsCiAgICAgICAgJG91dHB1dCA9ICRwcm9jZXNzLlN0YW5kYXJkT3V0cHV0LlJlYWRUb0VuZCgpCiAgICAgICAgJHByb2Nlc3MuV2FpdEZvckV4aXQoKSB8IE91dC1OdWxsCiAgICAgICAgJG91dHB1dCB8IFdyaXRlLU91dHB1dAogICAgICAgIAogICAgICAgICMgVW5SZWdpc3RlciB0aGUgZXZlbnQgaGFuZGxlciBmb3IgZXJyb3IKICAgICAgICBVbnJlZ2lzdGVyLUV2ZW50IC1Tb3VyY2VJZGVudGlmaWVyICRzdGRFcnJFdmVudC5OYW1lIHwgT3V0LU51bGwKICAgIH0KfQoKCmZ1bmN0aW9uIEdldEludGVybmFsLURvdE5ldEV4ZVBhdGggewogICAgcHJvY2VzcyB7CiAgICAgICAgJGRvdG5ldGluc3RhbGxwYXRoID0gJGVudjpkb3RuZXRpbnN0YWxscGF0aAogICAgICAgIGlmICghJGRvdG5ldGluc3RhbGxwYXRoKSB7CiAgICAgICAgICAgICREb3ROZXRSZWdJdGVtID0gR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAnaGtsbTpcc29mdHdhcmVcZG90bmV0XHNldHVwXCcKICAgICAgICAgICAgaWYgKCRlbnY6RE9UTkVUX0hPTUUpIHsKICAgICAgICAgICAgICAgICRkb3RuZXRpbnN0YWxscGF0aCA9IEpvaW4tUGF0aCAkZW52OkRPVE5FVF9IT01FIC1DaGlsZFBhdGggJ2RvdG5ldC5leGUnCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmICgkRG90TmV0UmVnSXRlbSAtYW5kICREb3ROZXRSZWdJdGVtLkluc3RhbGxEaXIpewogICAgICAgICAgICAgICAgJGRvdG5ldGluc3RhbGxwYXRoID0gSm9pbi1QYXRoICREb3ROZXRSZWdJdGVtLkluc3RhbGxEaXIgLUNoaWxkUGF0aCAnZG90bmV0LmV4ZScKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIShUZXN0LVBhdGggJGRvdG5ldGluc3RhbGxwYXRoKSkgewogICAgICAgICAgICB0aHJvdyAnVW5hYmxlIHRvIGZpbmQgZG90bmV0LmV4ZSwgcGxlYXNlIGluc3RhbGwgaXQgYW5kIHRyeSBhZ2FpbicKICAgICAgICB9CiAgICAgICAgIyByZXR1cm4KICAgICAgICBbU3lzdGVtLklPLkZpbGVJbmZvXSRkb3RuZXRpbnN0YWxscGF0aAogICAgfQp9CgpmdW5jdGlvbiBHZXQtTVNEZXBsb3l7CiAgICBbY21kbGV0YmluZGluZygpXQogICAgcGFyYW0oKQogICAgcHJvY2Vzc3sKICAgICAgICAkaW5zdGFsbFBhdGggPSAkZW52Om1zZGVwbG95aW5zdGFsbHBhdGgKCiAgICAgICAgaWYoISRpbnN0YWxsUGF0aCl7CiAgICAgICAgICAgICRrZXlzVG9DaGVjayA9IEAoJ2hrbG06XFNPRlRXQVJFXE1pY3Jvc29mdFxJSVMgRXh0ZW5zaW9uc1xNU0RlcGxveVwzJywnaGtsbTpcU09GVFdBUkVcTWljcm9zb2Z0XElJUyBFeHRlbnNpb25zXE1TRGVwbG95XDInLCdoa2xtOlxTT0ZUV0FSRVxNaWNyb3NvZnRcSUlTIEV4dGVuc2lvbnNcTVNEZXBsb3lcMScpCgogICAgICAgICAgICBmb3JlYWNoKCRrZXlUb0NoZWNrIGluICRrZXlzVG9DaGVjayl7CiAgICAgICAgICAgICAgICBpZihUZXN0LVBhdGggJGtleVRvQ2hlY2spewogICAgICAgICAgICAgICAgICAgICRpbnN0YWxsUGF0aCA9IChHZXQtaXRlbXByb3BlcnR5ICRrZXlUb0NoZWNrIC1OYW1lIEluc3RhbGxQYXRoIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgc2VsZWN0IC1FeHBhbmRQcm9wZXJ0eSBJbnN0YWxsUGF0aCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigkaW5zdGFsbFBhdGgpewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZighJGluc3RhbGxQYXRoKXsKICAgICAgICAgICAgdGhyb3cgIlVuYWJsZSB0byBmaW5kIG1zZGVwbG95LmV4ZSwgcGxlYXNlIGluc3RhbGwgaXQgYW5kIHRyeSBhZ2FpbiIKICAgICAgICB9CgogICAgICAgIFtzdHJpbmddJG1zZEluc3RhbGxMb2MgPSAoam9pbi1wYXRoICRpbnN0YWxsUGF0aCAnbXNkZXBsb3kuZXhlJykKCiAgICAgICAgIkZvdW5kIG1zZGVwbG95LmV4ZSBhdCBbezB9XSIgLWYgJG1zZEluc3RhbGxMb2MgfCBXcml0ZS1WZXJib3NlCiAgICAgICAgCiAgICAgICAgJG1zZEluc3RhbGxMb2MKICAgIH0KfQoKZnVuY3Rpb24gSW50ZXJuYWxOb3JtYWxpemUtTVNEZXBsb3lVcmx7CiAgICBbY21kbGV0YmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLE1hbmRhdG9yeT0kdHJ1ZSldCiAgICAgICAgW3N0cmluZ10kc2VydmljZVVybCwKCiAgICAgICAgW3N0cmluZ10gJHNpdGVOYW1lLAogICAgICAgIAogICAgICAgIFtWYWxpZGF0ZVNldCgnV01TVkMnLCdSZW1vdGVBZ2VudCcsJ0luUHJvYycpXQogICAgICAgIFtzdHJpbmddJHNlcnZpY2VNZXRob2QgPSAnV01TVkMnCiAgICApCiAgICBwcm9jZXNzewogICAgICAgICR0ZW1wVXJsID0gJHNlcnZpY2VVcmwKICAgICAgICAkcmVzdWx0VXJsID0gJHNlcnZpY2VVcmwKCiAgICAgICAgJGh0dHBzU3RyID0gJ2h0dHBzOi8vJwogICAgICAgICRodHRwU3RyID0gJ2h0dHA6Ly8nCiAgICAgICAgJG1zZGVwbG95QXhkID0gJ21zZGVwbG95LmF4ZCcKCiAgICAgICAgaWYoLW5vdCBbc3RyaW5nXTo6SXNOdWxsT3JXaGl0ZVNwYWNlKCRzZXJ2aWNlVXJsKSl7CiAgICAgICAgICAgIGlmKFtzdHJpbmddOjpDb21wYXJlKCRzZXJ2aWNlTWV0aG9kLCdXTVNWQycsW1N0cmluZ0NvbXBhcmlzb25dOjpPcmRpbmFsSWdub3JlQ2FzZSkgLWVxIDApewogICAgICAgICAgICAgICAgIyBpZiBubyBodHRwIG9yIGh0dHBzIHRoZW4gYWRkIG9uZQogICAgICAgICAgICAgICAgaWYoLW5vdCAoJHNlcnZpY2VVcmwuU3RhcnRzV2l0aCgkaHR0cFN0cixbU3RyaW5nQ29tcGFyaXNvbl06Ok9yZGluYWxJZ25vcmVDYXNlKSAtb3IgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2VydmljZVVybC5TdGFydHNXaXRoKCRodHRwc1N0cixbU3RyaW5nQ29tcGFyaXNvbl06Ok9yZGluYWxJZ25vcmVDYXNlKSkgKXsKCiAgICAgICAgICAgICAgICAgICAgJHNlcnZpY2VVcmwgPSBbc3RyaW5nXTo6Q29uY2F0KCRodHRwc1N0ciwkc2VydmljZVVybC5UcmltU3RhcnQoKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIFtTeXN0ZW0uVXJpXSRzZXJ2aWNlVXJpID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgJ1N5c3RlbS5VcmknICRzZXJ2aWNlVXJsCiAgICAgICAgICAgICAgICBbU3lzdGVtLlVyaUJ1aWxkZXJdJHNlcnZpY2VVcmlCdWlsZGVyID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgJ1N5c3RlbS5VcmlCdWlsZGVyJyAkc2VydmljZVVybAoKICAgICAgICAgICAgICAgICMgaWYgaXQncyBodHRwcyBhbmQgdGhlIHBvcnQgd2FzIG5vdCBwYXNzZWQgaW4gb3ZlcnJpZGUgaXQgdG8gODE3MgogICAgICAgICAgICAgICAgaWYoIChbc3RyaW5nXTo6Q29tcGFyZSgnaHR0cHMnLCRzZXJ2aWNlVXJpQnVpbGRlci5TY2hlbWUsW1N0cmluZ0NvbXBhcmlzb25dOjpPcmRpbmFsSWdub3JlQ2FzZSkgLWVxIDApIC1hbmQKICAgICAgICAgICAgICAgICAgICAgLW5vdCAkc2VydmljZVVybC5Db250YWlucygoJzp7MH0nIC1mICRzZXJ2aWNlVXJpQnVpbGRlci5Qb3J0KSkgKSB7CiAgICAgICAgICAgICAgICAgICAgJHNlcnZpY2VVcmlCdWlsZGVyLlBvcnQgPSA4MTcyCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBpZiBubyBwYXRoIHRoZW4gYWRkIG9uZQogICAgICAgICAgICAgICAgaWYoW3N0cmluZ106OkNvbXBhcmUoJy8nLCRzZXJ2aWNlVXJpQnVpbGRlci5QYXRoLFtTdHJpbmdDb21wYXJpc29uXTo6T3JkaW5hbElnbm9yZUNhc2UpIC1lcSAwKXsKICAgICAgICAgICAgICAgICAgICAkc2VydmljZVVyaUJ1aWxkZXIuUGF0aCA9ICRtc2RlcGxveUF4ZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJHNlcnZpY2VVcmlCdWlsZGVyLlF1ZXJ5KSAtYW5kIC1ub3QoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJHNpdGVOYW1lKSkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJHNlcnZpY2VVcmlCdWlsZGVyLlF1ZXJ5ID0gInNpdGU9IiArICRzaXRlTmFtZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkcmVzdWx0VXJsID0gJHNlcnZpY2VVcmlCdWlsZGVyLlVyaS5BYnNvbHV0ZVVyaQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZihbc3RyaW5nXTo6Q29tcGFyZSgkc2VydmljZU1ldGhvZCwnUmVtb3RlQWdlbnQnLFtTdHJpbmdDb21wYXJpc29uXTo6T3JkaW5hbElnbm9yZUNhc2UpIC1lcSAwKXsKICAgICAgICAgICAgICAgIFtTeXN0ZW0uVXJpQnVpbGRlcl0kc2VydmljZVVyaUJ1aWxkZXIgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSAnU3lzdGVtLlVyaUJ1aWxkZXInICRzZXJ2aWNlVXJsCiAgICAgICAgICAgICAgICAjIGh0dHA6Ly97Y29tcHV0ZXJuYW1lfS9NU0RFUExPWUFHRU5UU0VSVklDRQogICAgICAgICAgICAgICAgIyByZW1vdGUgYWdlbnQgbXVzdCB1c2UgaHR0cAogICAgICAgICAgICAgICAgJHNlcnZpY2VVcmlCdWlsZGVyLlNjaGVtZSA9ICdodHRwJwogICAgICAgICAgICAgICAgJHNlcnZpY2VVcmlCdWlsZGVyLlBhdGggPSAnL01TREVQTE9ZQUdFTlRTRVJWSUNFJwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkcmVzdWx0VXJsID0gJHNlcnZpY2VVcmlCdWlsZGVyLlVyaS5BYnNvbHV0ZVVyaQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAjIHNlZSBpZiBpdCdzIGZvciBsb2NhbGhvc3QKICAgICAgICAgICAgICAgIFtTeXN0ZW0uVXJpXSRzZXJ2aWNlVXJpID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgJ1N5c3RlbS5VcmknICRzZXJ2aWNlVXJsCiAgICAgICAgICAgICAgICAkcmVzdWx0VXJsID0gJHNlcnZpY2VVcmkuQWJzb2x1dGVVcmkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyByZXR1cm4gdGhlIHJlc3VsdCB0byB0aGUgY2FsbGVyCiAgICAgICAgJHJlc3VsdFVybCAgICAgICAgCiAgICB9Cn0KCmZ1bmN0aW9uIEludGVybmFsUmVnaXN0ZXItQXNwTmV0S25vd25QdWJsaXNoSGFuZGxlcnN7CiAgICBbY21kbGV0YmluZGluZygpXQogICAgcGFyYW0oKQogICAgcHJvY2Vzc3sKICAgICAgICAnUmVnaXN0ZXJpbmcgTVNEZXBsb3kgaGFuZGxlcicgfCBXcml0ZS1WZXJib3NlCiAgICAgICAgUmVnaXN0ZXItQXNwbmV0UHVibGlzaEhhbmRsZXIgLW5hbWUgJ01TRGVwbG95JyAtZm9yY2UgLWhhbmRsZXIgewogICAgICAgICAgICBbY21kbGV0YmluZGluZygpXQogICAgICAgICAgICBwYXJhbSgKICAgICAgICAgICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUsUG9zaXRpb249MCxWYWx1ZUZyb21QaXBlbGluZT0kdHJ1ZSxWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSR0cnVlKV0KICAgICAgICAgICAgICAgICRwdWJsaXNoUHJvcGVydGllcywKICAgICAgICAgICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUsUG9zaXRpb249MSxWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSR0cnVlKV0KICAgICAgICAgICAgICAgICRwYWNrT3V0cHV0CiAgICAgICAgICAgICkKCiAgICAgICAgICAgIFB1Ymxpc2gtQXNwTmV0TVNEZXBsb3kgLXB1Ymxpc2hQcm9wZXJ0aWVzICRwdWJsaXNoUHJvcGVydGllcyAtcGFja091dHB1dCAkcGFja091dHB1dAogICAgICAgIH0KCiAgICAgICAgJ1JlZ2lzdGVyaW5nIE1TRGVwbG95IHBhY2thZ2UgaGFuZGxlcicgfCBXcml0ZS1WZXJib3NlCiAgICAgICAgUmVnaXN0ZXItQXNwbmV0UHVibGlzaEhhbmRsZXIgLW5hbWUgJ1BhY2thZ2UnIC1mb3JjZSAtaGFuZGxlciB7CiAgICAgICAgICAgIFtjbWRsZXRiaW5kaW5nKCldCiAgICAgICAgICAgIHBhcmFtKAogICAgICAgICAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSxQb3NpdGlvbj0wLFZhbHVlRnJvbVBpcGVsaW5lPSR0cnVlLFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JHRydWUpXQogICAgICAgICAgICAgICAgJHB1Ymxpc2hQcm9wZXJ0aWVzLAogICAgICAgICAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSxQb3NpdGlvbj0xLFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JHRydWUpXQogICAgICAgICAgICAgICAgJHBhY2tPdXRwdXQKICAgICAgICAgICAgKQoKICAgICAgICAgICAgUHVibGlzaC1Bc3BOZXRNU0RlcGxveVBhY2thZ2UgLXB1Ymxpc2hQcm9wZXJ0aWVzICRwdWJsaXNoUHJvcGVydGllcyAtcGFja091dHB1dCAkcGFja091dHB1dAogICAgICAgIH0KCiAgICAgICAgJ1JlZ2lzdGVyaW5nIEZpbGVTeXN0ZW0gaGFuZGxlcicgfCBXcml0ZS1WZXJib3NlCiAgICAgICAgUmVnaXN0ZXItQXNwbmV0UHVibGlzaEhhbmRsZXIgLW5hbWUgJ0ZpbGVTeXN0ZW0nIC1mb3JjZSAtaGFuZGxlciB7CiAgICAgICAgICAgIFtjbWRsZXRiaW5kaW5nKCldCiAgICAgICAgICAgIHBhcmFtKAogICAgICAgICAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSxQb3NpdGlvbj0wLFZhbHVlRnJvbVBpcGVsaW5lPSR0cnVlLFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JHRydWUpXQogICAgICAgICAgICAgICAgJHB1Ymxpc2hQcm9wZXJ0aWVzLAogICAgICAgICAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSxQb3NpdGlvbj0xLFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JHRydWUpXQogICAgICAgICAgICAgICAgJHBhY2tPdXRwdXQKICAgICAgICAgICAgKQogICAgCiAgICAgICAgICAgIFB1Ymxpc2gtQXNwTmV0RmlsZVN5c3RlbSAtcHVibGlzaFByb3BlcnRpZXMgJHB1Ymxpc2hQcm9wZXJ0aWVzIC1wYWNrT3V0cHV0ICRwYWNrT3V0cHV0CiAgICAgICAgfQogICAgfQp9Cgo8IwouU1lOT1BTSVMKICAgIFVzZWQgZm9yIHRlc3RpbmcgcHVycG9zZXMgb25seS4KIz4KZnVuY3Rpb24gSW50ZXJuYWxSZXNldC1Bc3BOZXRQdWJsaXNoSGFuZGxlcnN7CiAgICBbY21kbGV0YmluZGluZygpXQogICAgcGFyYW0oKQogICAgcHJvY2Vzc3sKICAgICAgICAkc2NyaXB0OkFzcE5ldFB1Ymxpc2hIYW5kbGVycyA9IEB7fQogICAgICAgIEludGVybmFsUmVnaXN0ZXItQXNwTmV0S25vd25QdWJsaXNoSGFuZGxlcnMKICAgIH0KfQoKRXhwb3J0LU1vZHVsZU1lbWJlciAtZnVuY3Rpb24gR2V0LSosUHVibGlzaC0qLFJlZ2lzdGVyLSosRW5hYmxlLSoKaWYoJGVudjpJc0RldmVsb3Blck1hY2hpbmUpewogICAgIyB5b3UgY2FuIHNldCB0aGUgZW52IHZhciB0byBleHBvc2UgYWxsIGZ1bmN0aW9ucyB0byBpbXBvcnRlci4gZWFzeSBmb3IgZGV2ZWxvcG1lbnQuCiAgICAjIHRoaXMgaXMgcmVxdWlyZWQgZm9yIGV4ZWN1dGluZyBwZXN0ZXIgdGVzdCBjYXNlcywgaXQncyBzZXQgYnkgYnVpbGQucHMxCiAgICBFeHBvcnQtTW9kdWxlTWVtYmVyIC1mdW5jdGlvbiAqCn0KCiMgcmVnaXN0ZXIgdGhlIGhhbmRsZXJzIHNvIHRoYXQgUHVibGlzaC1Bc3BOZXQgY2FuIGJlIGNhbGxlZApJbnRlcm5hbFJlZ2lzdGVyLUFzcE5ldEtub3duUHVibGlzaEhhbmRsZXJzCgo=
