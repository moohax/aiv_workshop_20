Make-PS1ExeWrapperWithArgs.ps1,65c77a5686fe5be81939dfa60aaa07af,Scan result is 1. IsMalware: 0,I3JlcXVpcmVzIC12ZXJzaW9uIDIuMAoKPCMKLlNZTk9QU0lTCiAgICBDcmVhdGVzIGFuIEVYRSB3cmFwcGVyIGZyb20gYSBQb3dlclNoZWxsIHNjcmlwdCBieSBjb21wcmVzc2luZyB0aGUgc2NyaXB0IGFuZCBlbWJlZGRpbmcgaW50bwogICAgYSBuZXdseSBnZW5lcmF0ZWQgYXNzZW1ibHkuCi5ERVNDUklQVElPTgogICAgQ3JlYXRlcyBhbiBFWEUgd3JhcHBlciBmcm9tIGEgUG93ZXJTaGVsbCBzY3JpcHQgYnkgY29tcHJlc3NpbmcgdGhlIHNjcmlwdCBhbmQgZW1iZWRkaW5nIGludG8KICAgIGEgbmV3bHkgZ2VuZXJhdGVkIGFzc2VtYmx5LgouUEFSQU1FVEVSIFBhdGgKICAgIFRoZSBwYXRoIHRvIHRoZSAuCi5QQVJBTUVURVIgTGl0ZXJhbFBhdGgKICAgIFNwZWNpZmllcyBhIHBhdGggdG8gb25lIG9yIG1vcmUgbG9jYXRpb25zLiBVbmxpa2UgUGF0aCwgdGhlIHZhbHVlIG9mIExpdGVyYWxQYXRoIGlzIHVzZWQgZXhhY3RseSBhcyBpdCAKICAgIGlzIHR5cGVkLiBObyBjaGFyYWN0ZXJzIGFyZSBpbnRlcnByZXRlZCBhcyB3aWxkY2FyZHMuIElmIHRoZSBwYXRoIGluY2x1ZGVzIGVzY2FwZSBjaGFyYWN0ZXJzLCBlbmNsb3NlIAogICAgaXQgaW4gc2luZ2xlIHF1b3RhdGlvbiBtYXJrcy4gU2luZ2xlIHF1b3RhdGlvbiBtYXJrcyB0ZWxsIFdpbmRvd3MgUG93ZXJTaGVsbCBub3QgdG8gaW50ZXJwcmV0IGFueSAKICAgIGNoYXJhY3RlcnMgYXMgZXNjYXBlIHNlcXVlbmNlcy4KLlBBUkFNRVRFUiBPdXRwdXRBc3NlbWJseQogICAgVGhlIG5hbWUgKGluY2x1ZGluZyBwYXRoKSBvZiB0aGUgRVhFIHRvIGdlbmVyYXRlLgouUEFSQU1FVEVSIEljb25QYXRoCiAgICBUaGUgcGF0aCB0byBhbiBvcHRpb25hbCBpY29uIHRvIGJlIGVtYmVkZGVkIGFzIHRoZSBhcHBsaWNhdGlvbiBpY29uIGZvciB0aGUgRVhFLgouUEFSQU1FVEVSIFNUQQogICAgQnkgZGVmYXVsdCB0aGUgY29uc29sZSBhcHAgY3JlYXRlZCB1c2VzIE1UQVRocmVhZC4gIElmIHRoaXMgc3dpdGNoIGlzIHNwZWNpZmllZCwgdGhlbiBpdCB1c2VzIFNUQVRocmVhZC4KLlBBUkFNRVRFUiBORVQ0MAogICAgQnkgZGVmYXVsdCB0aGUgY29uc29sZSBhcHAgaXMgY29tcGlsZWQgYWdhaW5zdCAuTkVUIDMuNS4gIElmIHRoaXMgc3dpdGNoIGlzIHNwZWNpZmllZCwgdGhlbiBpdCB1c2VzIC5ORVQgNC4wLgouRVhBTVBMRQogICAgQzpcUFM+IC5cTWFrZS1QUzFFeGVXcmFwcGVyLnBzMSAuXE15U2NyaXB0LnBzMSAuXE15U2NyaXB0LmV4ZSAuXGFwcC5pY28gLVN0YQogICAgVGhpcyBjcmVhdGVzIGFuIGNvbnNvbGUgYXBwbGljYXRpb24gY2FsbGVkIE15U2NyaXB0LmV4ZSB0aGF0IGludGVybmFsbHkgaG9zdHMgdGhlIFBvd2VyU2hlbGwKICAgIGVuZ2luZSBhbmQgcnVucyB0aGUgc2NyaXB0IHNwZWNpZmllZCBieSBNeVNjcmlwdC5wczEuICBPcHRpb25hbGx5IHRoZSBmaWxlIGFwcC5pY28gaXMKICAgIGVtYmVkZGVkIGludG8gdGhlIEVYRSBhcyB0aGUgYXBwbGljYXRpb24ncyBpY29uLgouTk9URVMKICAgIEF1dGhvcjogS2VpdGggSGlsbAogICAgRGF0ZTogICBBdWcgNywgMjAxMAogICAgSXNzdWVzOiBUaGlzIGltcGxlbWVudGF0aW9uIGlzIG1vcmUgb2YgYSBmZWFzaWJpbGl0eSB0ZXN0IGFuZCBpc24ndCBmdWxseSBmdW5jdGlvbmFsLiAgSXQgZG9lc24ndAogICAgICAgICAgICBzdXBwb3J0IGFuIG51bWJlciBvZiBQU0hvc3RVc2VySW50ZXJmYWNlIG1lbWJlcnMgYXMgd2VsbCBhcyBhIG51bWJlciBvZiBQU0hvc3RSYXdVc2VySW50ZXJmYWNlCiAgICAgICAgICAgIG1lbWJlcnMuICBUaGlzIGFwcHJvYWNoIGFsc28gc3VmZmVycyBmcm9tIHRoZSBzYW1lIHByb2JsZW0gb2YgcnVubmluZyBzY3JpcHQgImludGVyYWN0aXZlbHkiCiAgICAgICAgICAgIGFuZCBub3QgbG9hZGluZyBpdCBmcm9tIGEgZmlsZS4gVGhhdCBpcywgdGhlIGVudGlyZSBzY3JpcHQgb3V0cHV0IGlzIHJ1biB0aHJvdWdoIE91dC1EZWZhdWx0CiAgICAgICAgICAgIGFuZCBQb3dlclNoZWxsIGdldHMgY29uZnVzZWQuICBJdCBmb3JtYXRzIHRoZSBmaXJzdCB0eXBlcyBpdCBzZWVzIGNvcnJlY3RseSBidXQgYWZ0ZXIgdGhhdCB0aGUKICAgICAgICAgICAgZm9ybWF0dGluZyBpcyBvZmYuICBUbyBjb3JyZWN0IHRoaXMsIHlvdSBoYXZlIHRvIGFwcGVuZCB8IE91dC1EZWZhdWx0IHdoZXJlIHlvdSBzY3JpcHQgb3V0cHV0cwogICAgICAgICAgICB0byB0aGUgaG9zdCB3aXRob3V0IHVzaW5nIGEgV3JpdGUtKiBjbWRsZXQgZS5nLjoKICAgICAgICAgICAgCiAgICAgICAgICAgIE15U2NyaXB0LnBzMToKICAgICAgICAgICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICBHZXQtUHJvY2VzcyBzdmNob3N0CiAgICAgICAgICAgIEdldC1EYXRlIHwgT3V0LURlZmF1bHQKICAgICAgICAgICAgRGlyIEM6XCAgfCBPdXQtRGVmYXVsdAogICAgICAgICAgICBEaXIgYzpcaWRvbnRleGlzdCB8IE91dC1EZWZhdWx0CiAgICAgICAgICAgICREZWJ1Z1ByZWZlcmVuY2UgPSAnQ29udGludWUnCiAgICAgICAgICAgICRWZXJib3NlUHJlZmVyZW5jZSA9ICdDb250aW51ZScKICAgICAgICAgICAgV3JpdGUtSG9zdCAgICAiaG9zdCIKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAid2FybmluZyIKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAidmVyYm9zZSIKICAgICAgICAgICAgV3JpdGUtRGVidWcgICAiZGVidWciCiAgICAgICAgICAgIFdyaXRlLUVycm9yICAgImVycm9yIgojPgpbQ21kbGV0QmluZGluZyhEZWZhdWx0UGFyYW1ldGVyU2V0TmFtZT0iUGF0aCIpXQpwYXJhbSgKICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlLCBQb3NpdGlvbj0wLCBQYXJhbWV0ZXJTZXROYW1lPSJQYXRoIiwKICAgICAgICAgICAgICAgVmFsdWVGcm9tUGlwZWxpbmU9JHRydWUsIFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JHRydWUsCiAgICAgICAgICAgICAgIEhlbHBNZXNzYWdlPSJQYXRoIHRvIGJpdG1hcCBmaWxlIildCiAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgW3N0cmluZ1tdXQogICAgJFBhdGgsCiAgICAKICAgIFtBbGlhcygiUFNQYXRoIildCiAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kdHJ1ZSwgUG9zaXRpb249MCwgUGFyYW1ldGVyU2V0TmFtZT0iTGl0ZXJhbFBhdGgiLCAKICAgICAgICAgICAgICAgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZT0kdHJ1ZSwKICAgICAgICAgICAgICAgSGVscE1lc3NhZ2U9IlBhdGggdG8gYml0bWFwIGZpbGUiKV0KICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICBbc3RyaW5nW11dCiAgICAkTGl0ZXJhbFBhdGgsCgogICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSwgUG9zaXRpb24gPSAxKV0KICAgIFtzdHJpbmddCiAgICAkT3V0cHV0QXNzZW1ibHksCiAgICAKICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAyKV0KICAgIFtzdHJpbmddCiAgICAkSWNvblBhdGgsCiAgICAKICAgIFtQYXJhbWV0ZXIoKV0KICAgIFtzd2l0Y2hdCiAgICAkU1RBLAoKICAgIFtQYXJhbWV0ZXIoKV0KICAgIFtzd2l0Y2hdCiAgICAkTkVUNDAKKQoKQmVnaW4gewogICAgU2V0LVN0cmljdE1vZGUgLVZlcnNpb24gbGF0ZXN0IAogICAgCiAgICAkTWFpbkF0dHJpYnV0ZSA9ICcnCiAgICAkQXBhcnRtZW50U3RhdGUgPSAnU3lzdGVtLlRocmVhZGluZy5BcGFydG1lbnRTdGF0ZS5NVEEnCiAgICBpZiAoJFN0YSkKICAgIHsKICAgICAgICAkTWFpbkF0dHJpYnV0ZSA9ICdbU1RBVGhyZWFkXScKICAgICAgICAkQXBhcnRtZW50U3RhdGUgPSAnU3lzdGVtLlRocmVhZGluZy5BcGFydG1lbnRTdGF0ZS5TVEEnCiAgICB9CiAgICAKICAgICRzcmMgPSBAJwp1c2luZyBTeXN0ZW07CnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOwp1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuT2JqZWN0TW9kZWw7CnVzaW5nIFN5c3RlbS5HbG9iYWxpemF0aW9uOwp1c2luZyBTeXN0ZW0uSU87CnVzaW5nIFN5c3RlbS5JTy5Db21wcmVzc2lvbjsKdXNpbmcgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbjsKdXNpbmcgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5Ib3N0Owp1c2luZyBTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlJ1bnNwYWNlczsKdXNpbmcgU3lzdGVtLlJlZmxlY3Rpb247CnVzaW5nIFN5c3RlbS5TZWN1cml0eTsKdXNpbmcgU3lzdGVtLlRleHQ7CnVzaW5nIFN5c3RlbS5UaHJlYWRpbmc7CgpbYXNzZW1ibHk6IEFzc2VtYmx5VGl0bGUoIiIpXQpbYXNzZW1ibHk6IEFzc2VtYmx5RGVzY3JpcHRpb24oIiIpXQpbYXNzZW1ibHk6IEFzc2VtYmx5Q29uZmlndXJhdGlvbigiIildClthc3NlbWJseTogQXNzZW1ibHlDb21wYW55KCIiKV0KW2Fzc2VtYmx5OiBBc3NlbWJseVByb2R1Y3QoIiIpXQovL1thc3NlbWJseTogQXNzZW1ibHlDb3B5cmlnaHQoIkNvcHlyaWdodCDDgsKpICAyMDEzIildClthc3NlbWJseTogQXNzZW1ibHlWZXJzaW9uKCIxLjAuMC4wIildClthc3NlbWJseTogQXNzZW1ibHlGaWxlVmVyc2lvbigiMS4wLjAuMCIpXQoKbmFtZXNwYWNlIFBTMVRvRXhlVGVtcGxhdGUKewogICAgY2xhc3MgUHJvZ3JhbQogICAgewogICAgICAgIHByaXZhdGUgc3RhdGljIG9iamVjdCBfcG93ZXJTaGVsbExvY2sgPSBuZXcgb2JqZWN0KCk7CiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgSG9zdCBfaG9zdCA9IG5ldyBIb3N0KCk7CiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgUG93ZXJTaGVsbCBfcG93ZXJTaGVsbEVuZ2luZTsKCidAICsgQCIKJE1haW5BdHRyaWJ1dGUKCiJAICsgQCcKICAgICAgICBzdGF0aWMgdm9pZCBNYWluKHN0cmluZ1tdIGFyZ3MpCiAgICAgICAgewogICAgICAgICAgICBDb25zb2xlLkNhbmNlbEtleVByZXNzICs9IENvbnNvbGVfQ2FuY2VsS2V5UHJlc3M7CiAgICAgICAgICAgIENvbnNvbGUuVHJlYXRDb250cm9sQ0FzSW5wdXQgPSBmYWxzZTsKCiAgICAgICAgICAgIHN0cmluZyBzY3JpcHQgPSBHZXRTY3JpcHQoKTsKICAgICAgICAgICAgUnVuU2NyaXB0KHNjcmlwdCwgYXJncywgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgR2V0U2NyaXB0KCkKICAgICAgICB7CiAgICAgICAgICAgIHN0cmluZyBzY3JpcHQgPSBTdHJpbmcuRW1wdHk7CgogICAgICAgICAgICBBc3NlbWJseSBhc3NlbWJseSA9IEFzc2VtYmx5LkdldEV4ZWN1dGluZ0Fzc2VtYmx5KCk7CiAgICAgICAgICAgIHVzaW5nIChTdHJlYW0gc3RyZWFtID0gYXNzZW1ibHkuR2V0TWFuaWZlc3RSZXNvdXJjZVN0cmVhbSgiUmVzb3VyY2VzLlNjcmlwdC5wczEuZ3oiKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdmFyIGdaaXBTdHJlYW0gPSBuZXcgR1ppcFN0cmVhbShzdHJlYW0sIENvbXByZXNzaW9uTW9kZS5EZWNvbXByZXNzLCB0cnVlKTsKICAgICAgICAgICAgICAgIHZhciBzdHJlYW1SZWFkZXIgPSBuZXcgU3RyZWFtUmVhZGVyKGdaaXBTdHJlYW0pOwogICAgICAgICAgICAgICAgc2NyaXB0ID0gc3RyZWFtUmVhZGVyLlJlYWRUb0VuZCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gc2NyaXB0OwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBSdW5TY3JpcHQoc3RyaW5nIHNjcmlwdCwgc3RyaW5nW10gYXJncywgb2JqZWN0IGlucHV0KQogICAgICAgIHsKICAgICAgICAgICAgbG9jayAoX3Bvd2VyU2hlbGxMb2NrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBfcG93ZXJTaGVsbEVuZ2luZSA9IFBvd2VyU2hlbGwuQ3JlYXRlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRyeQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBfcG93ZXJTaGVsbEVuZ2luZS5SdW5zcGFjZSA9IFJ1bnNwYWNlRmFjdG9yeS5DcmVhdGVSdW5zcGFjZShfaG9zdCk7CiAgICAgICAgICAgICAgICBfcG93ZXJTaGVsbEVuZ2luZS5SdW5zcGFjZS5BcGFydG1lbnRTdGF0ZSA9IAonQCArIEAiICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJEFwYXJ0bWVudFN0YXRlOwogICAgICAgICAgICAgICAgCiJAICsgQCcgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfcG93ZXJTaGVsbEVuZ2luZS5SdW5zcGFjZS5PcGVuKCk7CiAgICAgICAgICAgICAgICBfcG93ZXJTaGVsbEVuZ2luZS5BZGRTY3JpcHQoc2NyaXB0KTsKICAgICAgICAgICAgICAgIGlmIChhcmdzLkxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgX3Bvd2VyU2hlbGxFbmdpbmUuQWRkUGFyYW1ldGVycyhhcmdzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9wb3dlclNoZWxsRW5naW5lLkFkZENvbW1hbmQoIk91dC1EZWZhdWx0Iik7CiAgICAgICAgICAgICAgICBfcG93ZXJTaGVsbEVuZ2luZS5Db21tYW5kcy5Db21tYW5kc1swXS5NZXJnZU15UmVzdWx0cyhQaXBlbGluZVJlc3VsdFR5cGVzLkVycm9yLCBQaXBlbGluZVJlc3VsdFR5cGVzLk91dHB1dCk7CgogICAgICAgICAgICAgICAgaWYgKGlucHV0ICE9IG51bGwpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgX3Bvd2VyU2hlbGxFbmdpbmUuSW52b2tlKG5ld1tdIHsgaW5wdXQgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgX3Bvd2VyU2hlbGxFbmdpbmUuSW52b2tlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmluYWxseQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2NrIChfcG93ZXJTaGVsbExvY2spCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgX3Bvd2VyU2hlbGxFbmdpbmUuRGlzcG9zZSgpOwogICAgICAgICAgICAgICAgICAgIF9wb3dlclNoZWxsRW5naW5lID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBDb25zb2xlX0NhbmNlbEtleVByZXNzKG9iamVjdCBzZW5kZXIsIENvbnNvbGVDYW5jZWxFdmVudEFyZ3MgZSkKICAgICAgICB7CiAgICAgICAgICAgIHRyeQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2NrIChfcG93ZXJTaGVsbExvY2spCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9wb3dlclNoZWxsRW5naW5lICE9IG51bGwgJiYgX3Bvd2VyU2hlbGxFbmdpbmUuSW52b2NhdGlvblN0YXRlSW5mby5TdGF0ZSA9PSBQU0ludm9jYXRpb25TdGF0ZS5SdW5uaW5nKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3Bvd2VyU2hlbGxFbmdpbmUuU3RvcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGUuQ2FuY2VsID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBfaG9zdC5VSS5Xcml0ZUVycm9yTGluZShleC5Ub1N0cmluZygpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBjbGFzcyBIb3N0IDogUFNIb3N0CiAgICB7CiAgICAgICAgcHJpdmF0ZSBQU0hvc3RVc2VySW50ZXJmYWNlIF9wc0hvc3RVc2VySW50ZXJmYWNlID0gbmV3IEhvc3RVc2VySW50ZXJmYWNlKCk7CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFNldFNob3VsZEV4aXQoaW50IGV4aXRDb2RlKQogICAgICAgIHsKICAgICAgICAgICAgRW52aXJvbm1lbnQuRXhpdChleGl0Q29kZSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBFbnRlck5lc3RlZFByb21wdCgpCiAgICAgICAgewogICAgICAgICAgICB0aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIEV4aXROZXN0ZWRQcm9tcHQoKQogICAgICAgIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBOb3RpZnlCZWdpbkFwcGxpY2F0aW9uKCkKICAgICAgICB7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBOb3RpZnlFbmRBcHBsaWNhdGlvbigpCiAgICAgICAgewogICAgICAgIH0KCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHN0cmluZyBOYW1lCiAgICAgICAgewogICAgICAgICAgICBnZXQgeyByZXR1cm4gIlBTQ1gtUFMxVG9FeGVIb3N0IjsgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIG92ZXJyaWRlIFZlcnNpb24gVmVyc2lvbgogICAgICAgIHsKICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIG5ldyBWZXJzaW9uKDEsIDApOyB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgR3VpZCBJbnN0YW5jZUlkCiAgICAgICAgewogICAgICAgICAgICBnZXQgeyByZXR1cm4gbmV3IEd1aWQoIkU0NjczQjQyLTg0QjYtNEM0My05NTg5LTk1RkFCOEUwMEVCMiIpOyB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgUFNIb3N0VXNlckludGVyZmFjZSBVSQogICAgICAgIHsKICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9wc0hvc3RVc2VySW50ZXJmYWNlOyB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgQ3VsdHVyZUluZm8gQ3VycmVudEN1bHR1cmUKICAgICAgICB7CiAgICAgICAgICAgIGdldCB7IHJldHVybiBUaHJlYWQuQ3VycmVudFRocmVhZC5DdXJyZW50Q3VsdHVyZTsgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIG92ZXJyaWRlIEN1bHR1cmVJbmZvIEN1cnJlbnRVSUN1bHR1cmUKICAgICAgICB7CiAgICAgICAgICAgIGdldCB7IHJldHVybiBUaHJlYWQuQ3VycmVudFRocmVhZC5DdXJyZW50VUlDdWx0dXJlOyB9CiAgICAgICAgfQogICAgfQoKICAgIGNsYXNzIEhvc3RVc2VySW50ZXJmYWNlIDogUFNIb3N0VXNlckludGVyZmFjZSwgSUhvc3RVSVN1cHBvcnRzTXVsdGlwbGVDaG9pY2VTZWxlY3Rpb24KICAgIHsKICAgICAgICBwcml2YXRlIFBTSG9zdFJhd1VzZXJJbnRlcmZhY2UgX3BzUmF3VXNlckludGVyZmFjZSA9IG5ldyBIb3N0UmF3VXNlckludGVyZmFjZSgpOwoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgUFNIb3N0UmF3VXNlckludGVyZmFjZSBSYXdVSQogICAgICAgIHsKICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIF9wc1Jhd1VzZXJJbnRlcmZhY2U7IH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSBzdHJpbmcgUmVhZExpbmUoKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIENvbnNvbGUuUmVhZExpbmUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSBTZWN1cmVTdHJpbmcgUmVhZExpbmVBc1NlY3VyZVN0cmluZygpCiAgICAgICAgewogICAgICAgICAgICB0aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFdyaXRlKHN0cmluZyB2YWx1ZSkKICAgICAgICB7CiAgICAgICAgICAgIHN0cmluZyBvdXRwdXQgPSB2YWx1ZSA/PyAibnVsbCI7CiAgICAgICAgICAgIENvbnNvbGUuV3JpdGUob3V0cHV0KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFdyaXRlKENvbnNvbGVDb2xvciBmb3JlZ3JvdW5kQ29sb3IsIENvbnNvbGVDb2xvciBiYWNrZ3JvdW5kQ29sb3IsIHN0cmluZyB2YWx1ZSkKICAgICAgICB7CiAgICAgICAgICAgIHN0cmluZyBvdXRwdXQgPSB2YWx1ZSA/PyAibnVsbCI7CiAgICAgICAgICAgIHZhciBvcmlnRmdDb2xvciA9IENvbnNvbGUuRm9yZWdyb3VuZENvbG9yOwogICAgICAgICAgICB2YXIgb3JpZ0JnQ29sb3IgPSBDb25zb2xlLkJhY2tncm91bmRDb2xvcjsKICAgICAgICAgICAgQ29uc29sZS5Gb3JlZ3JvdW5kQ29sb3IgPSBmb3JlZ3JvdW5kQ29sb3I7CiAgICAgICAgICAgIENvbnNvbGUuQmFja2dyb3VuZENvbG9yID0gYmFja2dyb3VuZENvbG9yOwogICAgICAgICAgICBDb25zb2xlLldyaXRlKG91dHB1dCk7CiAgICAgICAgICAgIENvbnNvbGUuRm9yZWdyb3VuZENvbG9yID0gb3JpZ0ZnQ29sb3I7CiAgICAgICAgICAgIENvbnNvbGUuQmFja2dyb3VuZENvbG9yID0gb3JpZ0JnQ29sb3I7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBXcml0ZUxpbmUoc3RyaW5nIHZhbHVlKQogICAgICAgIHsKICAgICAgICAgICAgc3RyaW5nIG91dHB1dCA9IHZhbHVlID8/ICJudWxsIjsKICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUob3V0cHV0KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFdyaXRlRXJyb3JMaW5lKHN0cmluZyB2YWx1ZSkKICAgICAgICB7CiAgICAgICAgICAgIHN0cmluZyBvdXRwdXQgPSB2YWx1ZSA/PyAibnVsbCI7CiAgICAgICAgICAgIHZhciBvcmlnRmdDb2xvciA9IENvbnNvbGUuRm9yZWdyb3VuZENvbG9yOwogICAgICAgICAgICBDb25zb2xlLkZvcmVncm91bmRDb2xvciA9IENvbnNvbGVDb2xvci5SZWQ7CiAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKG91dHB1dCk7CiAgICAgICAgICAgIENvbnNvbGUuRm9yZWdyb3VuZENvbG9yID0gb3JpZ0ZnQ29sb3I7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBXcml0ZURlYnVnTGluZShzdHJpbmcgbWVzc2FnZSkKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlWWVsbG93QW5ub3RhdGVkTGluZShtZXNzYWdlLCAiREVCVUciKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFdyaXRlVmVyYm9zZUxpbmUoc3RyaW5nIG1lc3NhZ2UpCiAgICAgICAgewogICAgICAgICAgICBXcml0ZVllbGxvd0Fubm90YXRlZExpbmUobWVzc2FnZSwgIlZFUkJPU0UiKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFdyaXRlV2FybmluZ0xpbmUoc3RyaW5nIG1lc3NhZ2UpCiAgICAgICAgewogICAgICAgICAgICBXcml0ZVllbGxvd0Fubm90YXRlZExpbmUobWVzc2FnZSwgIldBUk5JTkciKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgdm9pZCBXcml0ZVllbGxvd0Fubm90YXRlZExpbmUoc3RyaW5nIG1lc3NhZ2UsIHN0cmluZyBhbm5vdGF0aW9uKQogICAgICAgIHsKICAgICAgICAgICAgc3RyaW5nIG91dHB1dCA9IG1lc3NhZ2UgPz8gIm51bGwiOwogICAgICAgICAgICB2YXIgb3JpZ0ZnQ29sb3IgPSBDb25zb2xlLkZvcmVncm91bmRDb2xvcjsKICAgICAgICAgICAgdmFyIG9yaWdCZ0NvbG9yID0gQ29uc29sZS5CYWNrZ3JvdW5kQ29sb3I7CiAgICAgICAgICAgIENvbnNvbGUuRm9yZWdyb3VuZENvbG9yID0gQ29uc29sZUNvbG9yLlllbGxvdzsKICAgICAgICAgICAgQ29uc29sZS5CYWNrZ3JvdW5kQ29sb3IgPSBDb25zb2xlQ29sb3IuQmxhY2s7CiAgICAgICAgICAgIFdyaXRlTGluZShTdHJpbmcuRm9ybWF0KEN1bHR1cmVJbmZvLkN1cnJlbnRDdWx0dXJlLCAiezB9OiB7MX0iLCBhbm5vdGF0aW9uLCBvdXRwdXQpKTsKICAgICAgICAgICAgQ29uc29sZS5Gb3JlZ3JvdW5kQ29sb3IgPSBvcmlnRmdDb2xvcjsKICAgICAgICAgICAgQ29uc29sZS5CYWNrZ3JvdW5kQ29sb3IgPSBvcmlnQmdDb2xvcjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFdyaXRlUHJvZ3Jlc3MobG9uZyBzb3VyY2VJZCwgUHJvZ3Jlc3NSZWNvcmQgcmVjb3JkKQogICAgICAgIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgRGljdGlvbmFyeTxzdHJpbmcsIFBTT2JqZWN0PiBQcm9tcHQoc3RyaW5nIGNhcHRpb24sIHN0cmluZyBtZXNzYWdlLCBDb2xsZWN0aW9uPEZpZWxkRGVzY3JpcHRpb24+IGRlc2NyaXB0aW9ucykKICAgICAgICB7CiAgICAgICAgICAgIGlmIChTdHJpbmcuSXNOdWxsT3JFbXB0eShjYXB0aW9uKSAmJiBTdHJpbmcuSXNOdWxsT3JFbXB0eShtZXNzYWdlKSAmJiBkZXNjcmlwdGlvbnMuQ291bnQgPiAwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlKGRlc2NyaXB0aW9uc1swXS5OYW1lICsgIjogIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0aGlzLldyaXRlKENvbnNvbGVDb2xvci5EYXJrQ3lhbiwgQ29uc29sZUNvbG9yLkJsYWNrLCBjYXB0aW9uICsgIlxuIiArIG1lc3NhZ2UgKyAiICIpOyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcmVzdWx0cyA9IG5ldyBEaWN0aW9uYXJ5PHN0cmluZywgUFNPYmplY3Q+KCk7CiAgICAgICAgICAgIGZvcmVhY2ggKEZpZWxkRGVzY3JpcHRpb24gZmQgaW4gZGVzY3JpcHRpb25zKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzdHJpbmdbXSBsYWJlbCA9IEdldEhvdGtleUFuZExhYmVsKGZkLkxhYmVsKTsKICAgICAgICAgICAgICAgIHRoaXMuV3JpdGVMaW5lKGxhYmVsWzFdKTsKICAgICAgICAgICAgICAgIHN0cmluZyB1c2VyRGF0YSA9IENvbnNvbGUuUmVhZExpbmUoKTsKICAgICAgICAgICAgICAgIGlmICh1c2VyRGF0YSA9PSBudWxsKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJlc3VsdHNbZmQuTmFtZV0gPSBQU09iamVjdC5Bc1BTT2JqZWN0KHVzZXJEYXRhKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgUFNDcmVkZW50aWFsIFByb21wdEZvckNyZWRlbnRpYWwoc3RyaW5nIGNhcHRpb24sIHN0cmluZyBtZXNzYWdlLCBzdHJpbmcgdXNlck5hbWUsIHN0cmluZyB0YXJnZXROYW1lKQogICAgICAgIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgUFNDcmVkZW50aWFsIFByb21wdEZvckNyZWRlbnRpYWwoc3RyaW5nIGNhcHRpb24sIHN0cmluZyBtZXNzYWdlLCBzdHJpbmcgdXNlck5hbWUsIHN0cmluZyB0YXJnZXROYW1lLCBQU0NyZWRlbnRpYWxUeXBlcyBhbGxvd2VkQ3JlZGVudGlhbFR5cGVzLCBQU0NyZWRlbnRpYWxVSU9wdGlvbnMgb3B0aW9ucykKICAgICAgICB7CiAgICAgICAgICAgIHRocm93IG5ldyBOb3RJbXBsZW1lbnRlZEV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIG92ZXJyaWRlIGludCBQcm9tcHRGb3JDaG9pY2Uoc3RyaW5nIGNhcHRpb24sIHN0cmluZyBtZXNzYWdlLCBDb2xsZWN0aW9uPENob2ljZURlc2NyaXB0aW9uPiBjaG9pY2VzLCBpbnQgZGVmYXVsdENob2ljZSkKICAgICAgICB7CiAgICAgICAgICAgIC8vIFdyaXRlIHRoZSBjYXB0aW9uIGFuZCBtZXNzYWdlIHN0cmluZ3MgaW4gQmx1ZS4KICAgICAgICAgICAgdGhpcy5Xcml0ZUxpbmUoQ29uc29sZUNvbG9yLkJsdWUsIENvbnNvbGVDb2xvci5CbGFjaywgY2FwdGlvbiArICJcbiIgKyBtZXNzYWdlICsgIlxuIik7CgogICAgICAgICAgICAvLyBDb252ZXJ0IHRoZSBjaG9pY2UgY29sbGVjdGlvbiBpbnRvIHNvbWV0aGluZyB0aGF0IGlzCiAgICAgICAgICAgIC8vIGVhc2llciB0byB3b3JrIHdpdGguIFNlZSB0aGUgQnVpbGRIb3RrZXlzQW5kUGxhaW5MYWJlbHMgCiAgICAgICAgICAgIC8vIG1ldGhvZCBmb3IgZGV0YWlscy4KICAgICAgICAgICAgc3RyaW5nWyxdIHByb21wdERhdGEgPSBCdWlsZEhvdGtleXNBbmRQbGFpbkxhYmVscyhjaG9pY2VzKTsKCiAgICAgICAgICAgIC8vIEZvcm1hdCB0aGUgb3ZlcmFsbCBjaG9pY2UgcHJvbXB0IHN0cmluZyB0byBkaXNwbGF5LgogICAgICAgICAgICB2YXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgICAgICBmb3IgKGludCBlbGVtZW50ID0gMDsgZWxlbWVudCA8IGNob2ljZXMuQ291bnQ7IGVsZW1lbnQrKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc2IuQXBwZW5kKFN0cmluZy5Gb3JtYXQoQ3VsdHVyZUluZm8uQ3VycmVudEN1bHR1cmUsICJ8ezB9PiB7MX0gIiwgcHJvbXB0RGF0YVswLCBlbGVtZW50XSwgcHJvbXB0RGF0YVsxLCBlbGVtZW50XSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzYi5BcHBlbmQoU3RyaW5nLkZvcm1hdChDdWx0dXJlSW5mby5DdXJyZW50Q3VsdHVyZSwgIltEZWZhdWx0IGlzICh7MH1dIiwgcHJvbXB0RGF0YVswLCBkZWZhdWx0Q2hvaWNlXSkpOwoKICAgICAgICAgICAgLy8gUmVhZCBwcm9tcHRzIHVudGlsIGEgbWF0Y2ggaXMgbWFkZSwgdGhlIGRlZmF1bHQgaXMKICAgICAgICAgICAgLy8gY2hvc2VuLCBvciB0aGUgbG9vcCBpcyBpbnRlcnJ1cHRlZCB3aXRoIGN0cmwtQy4KICAgICAgICAgICAgd2hpbGUgKHRydWUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRoaXMuV3JpdGVMaW5lKHNiLlRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgc3RyaW5nIGRhdGEgPSBDb25zb2xlLlJlYWRMaW5lKCkuVHJpbSgpLlRvVXBwZXIoQ3VsdHVyZUluZm8uQ3VycmVudEN1bHR1cmUpOwoKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBjaG9pY2Ugc3RyaW5nIHdhcyBlbXB0eSwgdXNlIHRoZSBkZWZhdWx0IHNlbGVjdGlvbi4KICAgICAgICAgICAgICAgIGlmIChkYXRhLkxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0Q2hvaWNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFNlZSBpZiB0aGUgc2VsZWN0aW9uIG1hdGNoZWQgYW5kIHJldHVybiB0aGUKICAgICAgICAgICAgICAgIC8vIGNvcnJlc3BvbmRpbmcgaW5kZXggaWYgaXQgZGlkLgogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjaG9pY2VzLkNvdW50OyBpKyspCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByb21wdERhdGFbMCwgaV0gPT0gZGF0YSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLldyaXRlRXJyb3JMaW5lKCJJbnZhbGlkIGNob2ljZTogIiArIGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjcmVnaW9uIElIb3N0VUlTdXBwb3J0c011bHRpcGxlQ2hvaWNlU2VsZWN0aW9uIE1lbWJlcnMKCiAgICAgICAgcHVibGljIENvbGxlY3Rpb248aW50PiBQcm9tcHRGb3JDaG9pY2Uoc3RyaW5nIGNhcHRpb24sIHN0cmluZyBtZXNzYWdlLCBDb2xsZWN0aW9uPENob2ljZURlc2NyaXB0aW9uPiBjaG9pY2VzLCBJRW51bWVyYWJsZTxpbnQ+IGRlZmF1bHRDaG9pY2VzKQogICAgICAgIHsKICAgICAgICAgICAgdGhpcy5Xcml0ZUxpbmUoQ29uc29sZUNvbG9yLkJsdWUsIENvbnNvbGVDb2xvci5CbGFjaywgY2FwdGlvbiArICJcbiIgKyBtZXNzYWdlICsgIlxuIik7CgogICAgICAgICAgICBzdHJpbmdbLF0gcHJvbXB0RGF0YSA9IEJ1aWxkSG90a2V5c0FuZFBsYWluTGFiZWxzKGNob2ljZXMpOwoKICAgICAgICAgICAgdmFyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICAgICAgZm9yIChpbnQgZWxlbWVudCA9IDA7IGVsZW1lbnQgPCBjaG9pY2VzLkNvdW50OyBlbGVtZW50KyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHNiLkFwcGVuZChTdHJpbmcuRm9ybWF0KEN1bHR1cmVJbmZvLkN1cnJlbnRDdWx0dXJlLCAifHswfT4gezF9ICIsIHByb21wdERhdGFbMCwgZWxlbWVudF0sIHByb21wdERhdGFbMSwgZWxlbWVudF0pKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGRlZmF1bHRSZXN1bHRzID0gbmV3IENvbGxlY3Rpb248aW50PigpOwogICAgICAgICAgICBpZiAoZGVmYXVsdENob2ljZXMgIT0gbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaW50IGNvdW50RGVmYXVsdHMgPSAwOwogICAgICAgICAgICAgICAgZm9yZWFjaCAoaW50IGRlZmF1bHRDaG9pY2UgaW4gZGVmYXVsdENob2ljZXMpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgKytjb3VudERlZmF1bHRzOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHRSZXN1bHRzLkFkZChkZWZhdWx0Q2hvaWNlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoY291bnREZWZhdWx0cyAhPSAwKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHNiLkFwcGVuZChjb3VudERlZmF1bHRzID09IDEgPyAiW0RlZmF1bHQgY2hvaWNlIGlzICIgOiAiW0RlZmF1bHQgY2hvaWNlcyBhcmUgIik7CiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoaW50IGRlZmF1bHRDaG9pY2UgaW4gZGVmYXVsdENob2ljZXMpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBzYi5BcHBlbmRGb3JtYXQoQ3VsdHVyZUluZm8uQ3VycmVudEN1bHR1cmUsICJcInswfVwiLCIsIHByb21wdERhdGFbMCwgZGVmYXVsdENob2ljZV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzYi5SZW1vdmUoc2IuTGVuZ3RoIC0gMSwgMSk7CiAgICAgICAgICAgICAgICAgICAgc2IuQXBwZW5kKCJdIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuV3JpdGVMaW5lKENvbnNvbGVDb2xvci5DeWFuLCBDb25zb2xlQ29sb3IuQmxhY2ssIHNiLlRvU3RyaW5nKCkpOwoKICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSBuZXcgQ29sbGVjdGlvbjxpbnQ+KCk7CiAgICAgICAgICAgIHdoaWxlICh0cnVlKQogICAgICAgICAgICB7CiAgICAgICAgICAgIFJlYWROZXh0OgogICAgICAgICAgICAgICAgc3RyaW5nIHByb21wdCA9IHN0cmluZy5Gb3JtYXQoQ3VsdHVyZUluZm8uQ3VycmVudEN1bHR1cmUsICJDaG9pY2VbezB9XToiLCByZXN1bHRzLkNvdW50KTsKICAgICAgICAgICAgICAgIHRoaXMuV3JpdGUoQ29uc29sZUNvbG9yLkN5YW4sIENvbnNvbGVDb2xvci5CbGFjaywgcHJvbXB0KTsKICAgICAgICAgICAgICAgIHN0cmluZyBkYXRhID0gQ29uc29sZS5SZWFkTGluZSgpLlRyaW0oKS5Ub1VwcGVyKEN1bHR1cmVJbmZvLkN1cnJlbnRDdWx0dXJlKTsKCiAgICAgICAgICAgICAgICBpZiAoZGF0YS5MZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHJlc3VsdHMuQ291bnQgPT0gMCkgPyBkZWZhdWx0UmVzdWx0cyA6IHJlc3VsdHM7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjaG9pY2VzLkNvdW50OyBpKyspCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByb21wdERhdGFbMCwgaV0gPT0gZGF0YSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuQWRkKGkpOwogICAgICAgICAgICAgICAgICAgICAgICBnb3RvIFJlYWROZXh0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLldyaXRlRXJyb3JMaW5lKCJJbnZhbGlkIGNob2ljZTogIiArIGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjZW5kcmVnaW9uCgogICAgICAgIHByaXZhdGUgc3RhdGljIHN0cmluZ1ssXSBCdWlsZEhvdGtleXNBbmRQbGFpbkxhYmVscyhDb2xsZWN0aW9uPENob2ljZURlc2NyaXB0aW9uPiBjaG9pY2VzKQogICAgICAgIHsKICAgICAgICAgICAgLy8gQWxsb2NhdGUgdGhlIHJlc3VsdCBhcnJheQogICAgICAgICAgICBzdHJpbmdbLF0gaG90a2V5c0FuZFBsYWluTGFiZWxzID0gbmV3IHN0cmluZ1syLCBjaG9pY2VzLkNvdW50XTsKCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2hvaWNlcy5Db3VudDsgKytpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzdHJpbmdbXSBob3RrZXlBbmRMYWJlbCA9IEdldEhvdGtleUFuZExhYmVsKGNob2ljZXNbaV0uTGFiZWwpOwogICAgICAgICAgICAgICAgaG90a2V5c0FuZFBsYWluTGFiZWxzWzAsIGldID0gaG90a2V5QW5kTGFiZWxbMF07CiAgICAgICAgICAgICAgICBob3RrZXlzQW5kUGxhaW5MYWJlbHNbMSwgaV0gPSBob3RrZXlBbmRMYWJlbFsxXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGhvdGtleXNBbmRQbGFpbkxhYmVsczsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgc3RhdGljIHN0cmluZ1tdIEdldEhvdGtleUFuZExhYmVsKHN0cmluZyBpbnB1dCkKICAgICAgICB7CiAgICAgICAgICAgIHN0cmluZ1tdIHJlc3VsdCA9IG5ldyBzdHJpbmdbXSB7IFN0cmluZy5FbXB0eSwgU3RyaW5nLkVtcHR5IH07CiAgICAgICAgICAgIHN0cmluZ1tdIGZyYWdtZW50cyA9IGlucHV0LlNwbGl0KCcmJyk7CiAgICAgICAgICAgIGlmIChmcmFnbWVudHMuTGVuZ3RoID09IDIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChmcmFnbWVudHNbMV0uTGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbMF0gPSBmcmFnbWVudHNbMV1bMF0uVG9TdHJpbmcoKS4KICAgICAgICAgICAgICAgICAgICBUb1VwcGVyKEN1bHR1cmVJbmZvLkN1cnJlbnRDdWx0dXJlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXN1bHRbMV0gPSAoZnJhZ21lbnRzWzBdICsgZnJhZ21lbnRzWzFdKS5UcmltKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZXN1bHRbMV0gPSBpbnB1dDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9CgogICAgY2xhc3MgSG9zdFJhd1VzZXJJbnRlcmZhY2UgOiBQU0hvc3RSYXdVc2VySW50ZXJmYWNlCiAgICB7CiAgICAgICAgcHVibGljIG92ZXJyaWRlIEtleUluZm8gUmVhZEtleShSZWFkS2V5T3B0aW9ucyBvcHRpb25zKQogICAgICAgIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBGbHVzaElucHV0QnVmZmVyKCkKICAgICAgICB7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBTZXRCdWZmZXJDb250ZW50cyhDb29yZGluYXRlcyBvcmlnaW4sIEJ1ZmZlckNlbGxbLF0gY29udGVudHMpCiAgICAgICAgewogICAgICAgICAgICB0aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIFNldEJ1ZmZlckNvbnRlbnRzKFJlY3RhbmdsZSByZWN0YW5nbGUsIEJ1ZmZlckNlbGwgZmlsbCkKICAgICAgICB7CiAgICAgICAgICAgIHRocm93IG5ldyBOb3RJbXBsZW1lbnRlZEV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIG92ZXJyaWRlIEJ1ZmZlckNlbGxbLF0gR2V0QnVmZmVyQ29udGVudHMoUmVjdGFuZ2xlIHJlY3RhbmdsZSkKICAgICAgICB7CiAgICAgICAgICAgIHRocm93IG5ldyBOb3RJbXBsZW1lbnRlZEV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgU2Nyb2xsQnVmZmVyQ29udGVudHMoUmVjdGFuZ2xlIHNvdXJjZSwgQ29vcmRpbmF0ZXMgZGVzdGluYXRpb24sIFJlY3RhbmdsZSBjbGlwLCBCdWZmZXJDZWxsIGZpbGwpCiAgICAgICAgewogICAgICAgICAgICB0aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSBDb25zb2xlQ29sb3IgRm9yZWdyb3VuZENvbG9yCiAgICAgICAgewogICAgICAgICAgICBnZXQgeyByZXR1cm4gQ29uc29sZS5Gb3JlZ3JvdW5kQ29sb3I7IH0KICAgICAgICAgICAgc2V0IHsgQ29uc29sZS5Gb3JlZ3JvdW5kQ29sb3IgPSB2YWx1ZTsgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIG92ZXJyaWRlIENvbnNvbGVDb2xvciBCYWNrZ3JvdW5kQ29sb3IKICAgICAgICB7CiAgICAgICAgICAgIGdldCB7IHJldHVybiBDb25zb2xlLkJhY2tncm91bmRDb2xvcjsgfQogICAgICAgICAgICBzZXQgeyBDb25zb2xlLkJhY2tncm91bmRDb2xvciA9IHZhbHVlOyB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgQ29vcmRpbmF0ZXMgQ3Vyc29yUG9zaXRpb24KICAgICAgICB7CiAgICAgICAgICAgIGdldCB7IHJldHVybiBuZXcgQ29vcmRpbmF0ZXMoQ29uc29sZS5DdXJzb3JMZWZ0LCBDb25zb2xlLkN1cnNvclRvcCk7IH0KICAgICAgICAgICAgc2V0IHsgQ29uc29sZS5TZXRDdXJzb3JQb3NpdGlvbih2YWx1ZS5YLCB2YWx1ZS5ZKTsgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIG92ZXJyaWRlIENvb3JkaW5hdGVzIFdpbmRvd1Bvc2l0aW9uCiAgICAgICAgewogICAgICAgICAgICBnZXQgeyByZXR1cm4gbmV3IENvb3JkaW5hdGVzKENvbnNvbGUuV2luZG93TGVmdCwgQ29uc29sZS5XaW5kb3dUb3ApOyB9CiAgICAgICAgICAgIHNldCB7IENvbnNvbGUuU2V0V2luZG93UG9zaXRpb24odmFsdWUuWCwgdmFsdWUuWSk7IH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSBpbnQgQ3Vyc29yU2l6ZQogICAgICAgIHsKICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIENvbnNvbGUuQ3Vyc29yU2l6ZTsgfQogICAgICAgICAgICBzZXQgeyBDb25zb2xlLkN1cnNvclNpemUgPSB2YWx1ZTsgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIG92ZXJyaWRlIFNpemUgQnVmZmVyU2l6ZQogICAgICAgIHsKICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIG5ldyBTaXplKENvbnNvbGUuQnVmZmVyV2lkdGgsIENvbnNvbGUuQnVmZmVySGVpZ2h0KTsgfQogICAgICAgICAgICBzZXQgeyBDb25zb2xlLlNldEJ1ZmZlclNpemUodmFsdWUuV2lkdGgsIHZhbHVlLkhlaWdodCk7IH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSBTaXplIFdpbmRvd1NpemUKICAgICAgICB7CiAgICAgICAgICAgIGdldCB7IHJldHVybiBuZXcgU2l6ZShDb25zb2xlLldpbmRvd1dpZHRoLCBDb25zb2xlLldpbmRvd0hlaWdodCk7IH0KICAgICAgICAgICAgc2V0IHsgQ29uc29sZS5TZXRXaW5kb3dTaXplKHZhbHVlLldpZHRoLCB2YWx1ZS5IZWlnaHQpOyB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgU2l6ZSBNYXhXaW5kb3dTaXplCiAgICAgICAgewogICAgICAgICAgICBnZXQgeyByZXR1cm4gbmV3IFNpemUoQ29uc29sZS5MYXJnZXN0V2luZG93V2lkdGgsIENvbnNvbGUuTGFyZ2VzdFdpbmRvd0hlaWdodCk7IH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBvdmVycmlkZSBTaXplIE1heFBoeXNpY2FsV2luZG93U2l6ZQogICAgICAgIHsKICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIG5ldyBTaXplKENvbnNvbGUuTGFyZ2VzdFdpbmRvd1dpZHRoLCBDb25zb2xlLkxhcmdlc3RXaW5kb3dIZWlnaHQpOyB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgYm9vbCBLZXlBdmFpbGFibGUKICAgICAgICB7CiAgICAgICAgICAgIGdldCB7IHJldHVybiBDb25zb2xlLktleUF2YWlsYWJsZTsgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIG92ZXJyaWRlIHN0cmluZyBXaW5kb3dUaXRsZQogICAgICAgIHsKICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIENvbnNvbGUuVGl0bGU7IH0KICAgICAgICAgICAgc2V0IHsgQ29uc29sZS5UaXRsZSA9IHZhbHVlOyB9CiAgICAgICAgfQogICAgfQp9CidACn0gICAgCgpQcm9jZXNzIHsKICAgIGlmICgkcHNDbWRsZXQuUGFyYW1ldGVyU2V0TmFtZSAtZXEgIlBhdGgiKQogICAgewogICAgICAgICMgSW4gdGhlIC1QYXRoIChub24tbGl0ZXJhbCkgY2FzZSB3ZSBtYXkgbmVlZCB0byByZXNvbHZlIGEgd2lsZGNhcmRlZCBwYXRoCiAgICAgICAgJHJlc29sdmVkUGF0aHMgPSBAKCRQYXRoIHwgUmVzb2x2ZS1QYXRoIHwgQ29udmVydC1QYXRoKQogICAgfQogICAgZWxzZSAKICAgIHsKICAgICAgICAjIE11c3QgYmUgLUxpdGVyYWxQYXRoCiAgICAgICAgJHJlc29sdmVkUGF0aHMgPSBAKCRMaXRlcmFsUGF0aCB8IENvbnZlcnQtUGF0aCkKICAgIH0KIAogICAgZm9yZWFjaCAoJHJwYXRoIGluICRyZXNvbHZlZFBhdGhzKSAKICAgIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJQcm9jZXNzaW5nICRycGF0aCIKCiAgICAgICAgJGd6SXRlbSA9IEdldC1DaGlsZEl0ZW0gJHJwYXRoIHwgV3JpdGUtR1ppcCAtUXVpZXQgCiAgICAgICAgJHJlc291cmNlUGF0aCA9ICIkKCRnekl0ZW0uRGlyZWN0b3J5KVxSZXNvdXJjZXMuU2NyaXB0LnBzMS5neiIKICAgICAgICBpZiAoVGVzdC1QYXRoICRyZXNvdXJjZVBhdGgpIHsgUmVtb3ZlLUl0ZW0gJHJlc291cmNlUGF0aCB9CiAgICAgICAgUmVuYW1lLUl0ZW0gJGd6SXRlbSAkcmVzb3VyY2VQYXRoCiAgICAgICAgCiAgICAgICAgIyBDb25maWd1cmUgdGhlIGNvbXBpbGVyIHBhcmFtZXRlcnMKICAgICAgICAkY29tcGlsZXJWZXJzaW9uID0gJ3YzLjUnCiAgICAgICAgJHJlZmVyZW5jZUFzc2VtYmxpZXMgPSAnU3lzdGVtLmRsbCcsKFtwc29iamVjdF0uQXNzZW1ibHkuTG9jYXRpb24pCiAgICAgICAgaWYgKCRORVQ0MCkKICAgICAgICB7CiAgICAgICAgICAgICRjb21waWxlclZlcnNpb24gPSAndjQuMCcKICAgICAgICAgICAgJHJlZmVyZW5jZUFzc2VtYmxpZXMgKz0gJ1N5c3RlbS5Db3JlLmRsbCcKICAgICAgICB9CiAgICAgICAgJG91dHB1dFBhdGggPSAkT3V0cHV0QXNzZW1ibHkKICAgICAgICBpZiAoIVtJTy5QYXRoXTo6SXNQYXRoUm9vdGVkKCRvdXRwdXRQYXRoKSkKICAgICAgICB7CiAgICAgICAgICAgICRvdXRwdXRQYXRoID0gW0lPLlBhdGhdOjpHZXRGdWxsUGF0aCgoSm9pbi1QYXRoICRwd2QgJG91dHB1dFBhdGgpKQogICAgICAgIH0KICAgICAgICBpZiAoJHJwYXRoIC1lcSAkb3V0cHV0UGF0aCkKICAgICAgICB7IAogICAgICAgICAgICB0aHJvdyAnT29wcywgeW91IGRvbicndCByZWFsbHkgd2FudCB0byBvdmVyd3JpdGUgeW91ciBzY3JpcHQgd2l0aCBhbiBFWEUuJyAKICAgICAgICB9CgogICAgICAgICRjcCA9IG5ldy1vYmplY3QgU3lzdGVtLkNvZGVEb20uQ29tcGlsZXIuQ29tcGlsZXJQYXJhbWV0ZXJzICRyZWZlcmVuY2VBc3NlbWJsaWVzLCRvdXRwdXRQYXRoLCR0cnVlCiAgICAgICAgJGNwLlRlbXBGaWxlcyA9IG5ldy1vYmplY3QgU3lzdGVtLkNvZGVEb20uQ29tcGlsZXIuVGVtcEZpbGVDb2xsZWN0aW9uIChbSU8uUGF0aF06OkdldFRlbXBQYXRoKCkpCiAgICAgICAgJGNwLkdlbmVyYXRlRXhlY3V0YWJsZSA9ICR0cnVlCiAgICAgICAgJGNwLkdlbmVyYXRlSW5NZW1vcnkgICA9ICRmYWxzZQogICAgICAgICRjcC5JbmNsdWRlRGVidWdJbmZvcm1hdGlvbiA9ICR0cnVlCiAgICAgICAgaWYgKCRJY29uUGF0aCkgCiAgICAgICAgewogICAgICAgICAgICAkckljb25QYXRoID0gUmVzb2x2ZS1QYXRoICRJY29uUGF0aAogICAgICAgICAgICAkY3AuQ29tcGlsZXJPcHRpb25zID0gIiAvd2luMzJpY29uOiRySWNvblBhdGgiCiAgICAgICAgfQogICAgICAgIFt2b2lkXSRjcC5FbWJlZGRlZFJlc291cmNlcy5BZGQoJHJlc291cmNlUGF0aCkKICAgICAgICAKICAgICAgICAjIENyZWF0ZSB0aGUgQyMgY29kZWRvbSBjb21waWxlcgogICAgICAgICRkaWN0ID0gbmV3LW9iamVjdCAnU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuRGljdGlvbmFyeVtzdHJpbmcsc3RyaW5nXScgCiAgICAgICAgJGRpY3QuQWRkKCdDb21waWxlclZlcnNpb24nLCAkY29tcGlsZXJWZXJzaW9uKQogICAgICAgICRwcm92aWRlciA9IG5ldy1vYmplY3QgTWljcm9zb2Z0LkNTaGFycC5DU2hhcnBDb2RlUHJvdmlkZXIgJGRpY3QKICAgICAgICAKICAgICAgICAjIENvbXBpbGUgdGhlIHNvdXJjZSBhbmQgcmVwb3J0IGVycm9ycwogICAgICAgICRyZXN1bHRzID0gJHByb3ZpZGVyLkNvbXBpbGVBc3NlbWJseUZyb21Tb3VyY2UoJGNwLCAkc3JjKQogICAgICAgIGlmICgkcmVzdWx0cy5FcnJvcnMuQ291bnQpCiAgICAgICAgewogICAgICAgICAgICAkZXJyb3JMaW5lcyA9ICIiIAogICAgICAgICAgICBmb3JlYWNoICgkZXJyb3IgaW4gJHJlc3VsdHMuRXJyb3JzKSAKICAgICAgICAgICAgeyAKICAgICAgICAgICAgICAgICRlcnJvckxpbmVzICs9ICJgbmB0IiArICRlcnJvci5MaW5lICsgIjpgdCIgKyAkZXJyb3IuRXJyb3JUZXh0IAogICAgICAgICAgICB9CiAgICAgICAgICAgIFdyaXRlLUVycm9yICRlcnJvckxpbmVzCiAgICAgICAgfQogICAgfSAgCn0=
