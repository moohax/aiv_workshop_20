psake.psm1,bb8d13b7bd458195c0ee09992894f62b,Scan result is 1. IsMalware: 0,IyBwc2FrZQojIENvcHlyaWdodCAoYykgMjAxMiBKYW1lcyBLb3ZhY3MKIyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5CiMgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKIyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAojIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwojIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CiMKIyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgojIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgojCiMgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKIyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKIyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKIyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCiMgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKIyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOCiMgVEhFIFNPRlRXQVJFLgoKI1JlcXVpcmVzIC1WZXJzaW9uIDIuMAoKaWYgKCRQU1ZlcnNpb25UYWJsZS5QU1ZlcnNpb24uTWFqb3IgLWdlIDMpCnsKICAgICRzY3JpcHQ6SWdub3JlRXJyb3IgPSAnSWdub3JlJwp9CmVsc2UKewogICAgJHNjcmlwdDpJZ25vcmVFcnJvciA9ICdTaWxlbnRseUNvbnRpbnVlJwp9CgojLS0gUHVibGljIE1vZHVsZSBGdW5jdGlvbnMgLS0jCgojIC5FeHRlcm5hbEhlbHAgIHBzYWtlLnBzbTEtaGVscC54bWwKZnVuY3Rpb24gSW52b2tlLVRhc2sKewogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxNYW5kYXRvcnk9MSldIFtzdHJpbmddJHRhc2tOYW1lCiAgICApCgogICAgQXNzZXJ0ICR0YXNrTmFtZSAoJG1zZ3MuZXJyb3JfaW52YWxpZF90YXNrX25hbWUpCgogICAgJHRhc2tLZXkgPSAkdGFza05hbWUuVG9Mb3dlcigpCgogICAgaWYgKCRjdXJyZW50Q29udGV4dC5hbGlhc2VzLkNvbnRhaW5zKCR0YXNrS2V5KSkgewogICAgICAgICR0YXNrTmFtZSA9ICRjdXJyZW50Q29udGV4dC5hbGlhc2VzLiR0YXNrS2V5Lk5hbWUKICAgICAgICAkdGFza0tleSA9ICR0YXNrTmFtZS5Ub0xvd2VyKCkKICAgIH0KCiAgICAkY3VycmVudENvbnRleHQgPSAkcHNha2UuY29udGV4dC5QZWVrKCkKCiAgICBBc3NlcnQgKCRjdXJyZW50Q29udGV4dC50YXNrcy5Db250YWlucygkdGFza0tleSkpICgkbXNncy5lcnJvcl90YXNrX25hbWVfZG9lc19ub3RfZXhpc3QgLWYgJHRhc2tOYW1lKQoKICAgIGlmICgkY3VycmVudENvbnRleHQuZXhlY3V0ZWRUYXNrcy5Db250YWlucygkdGFza0tleSkpICB7IHJldHVybiB9CgogICAgQXNzZXJ0ICghJGN1cnJlbnRDb250ZXh0LmNhbGxTdGFjay5Db250YWlucygkdGFza0tleSkpICgkbXNncy5lcnJvcl9jaXJjdWxhcl9yZWZlcmVuY2UgLWYgJHRhc2tOYW1lKQoKICAgICRjdXJyZW50Q29udGV4dC5jYWxsU3RhY2suUHVzaCgkdGFza0tleSkKCiAgICAkdGFzayA9ICRjdXJyZW50Q29udGV4dC50YXNrcy4kdGFza0tleQoKICAgICRwcmVjb25kaXRpb25faXNfdmFsaWQgPSAmICR0YXNrLlByZWNvbmRpdGlvbgoKICAgIGlmICghJHByZWNvbmRpdGlvbl9pc192YWxpZCkgewogICAgICAgIFdyaXRlQ29sb3JlZE91dHB1dCAoJG1zZ3MucHJlY29uZGl0aW9uX3dhc19mYWxzZSAtZiAkdGFza05hbWUpIC1mb3JlZ3JvdW5kY29sb3IgQ3lhbgogICAgfSBlbHNlIHsKICAgICAgICBpZiAoJHRhc2tLZXkgLW5lICdkZWZhdWx0JykgewoKICAgICAgICAgICAgaWYgKCR0YXNrLlByZUFjdGlvbiAtb3IgJHRhc2suUG9zdEFjdGlvbikgewogICAgICAgICAgICAgICAgQXNzZXJ0ICgkdGFzay5BY3Rpb24gLW5lICRudWxsKSAoJG1zZ3MuZXJyb3JfbWlzc2luZ19hY3Rpb25fcGFyYW1ldGVyIC1mICR0YXNrTmFtZSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCR0YXNrLkFjdGlvbikgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRjaGlsZFRhc2sgaW4gJHRhc2suRGVwZW5kc09uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEludm9rZS1UYXNrICRjaGlsZFRhc2sKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRzdG9wd2F0Y2ggPSBbU3lzdGVtLkRpYWdub3N0aWNzLlN0b3B3YXRjaF06OlN0YXJ0TmV3KCkKICAgICAgICAgICAgICAgICAgICAkY3VycmVudENvbnRleHQuY3VycmVudFRhc2tOYW1lID0gJHRhc2tOYW1lCgogICAgICAgICAgICAgICAgICAgICYgJGN1cnJlbnRDb250ZXh0LnRhc2tTZXR1cFNjcmlwdEJsb2NrCgogICAgICAgICAgICAgICAgICAgIGlmICgkdGFzay5QcmVBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJiAkdGFzay5QcmVBY3Rpb24KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICgkY3VycmVudENvbnRleHQuY29uZmlnLnRhc2tOYW1lRm9ybWF0IC1pcyBbU2NyaXB0QmxvY2tdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICYgJGN1cnJlbnRDb250ZXh0LmNvbmZpZy50YXNrTmFtZUZvcm1hdCAkdGFza05hbWUKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZUNvbG9yZWRPdXRwdXQgKCRjdXJyZW50Q29udGV4dC5jb25maWcudGFza05hbWVGb3JtYXQgLWYgJHRhc2tOYW1lKSAtZm9yZWdyb3VuZGNvbG9yIEN5YW4KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR2YXJpYWJsZSBpbiAkdGFzay5yZXF1aXJlZFZhcmlhYmxlcykgewogICAgICAgICAgICAgICAgICAgICAgICBBc3NlcnQgKCh0ZXN0LXBhdGggInZhcmlhYmxlOiR2YXJpYWJsZSIpIC1hbmQgKChnZXQtdmFyaWFibGUgJHZhcmlhYmxlKS5WYWx1ZSAtbmUgJG51bGwpKSAoJG1zZ3MucmVxdWlyZWRfdmFyaWFibGVfbm90X3NldCAtZiAkdmFyaWFibGUsICR0YXNrTmFtZSkKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICYgJHRhc2suQWN0aW9uCgogICAgICAgICAgICAgICAgICAgIGlmICgkdGFzay5Qb3N0QWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICYgJHRhc2suUG9zdEFjdGlvbgogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJiAkY3VycmVudENvbnRleHQudGFza1RlYXJEb3duU2NyaXB0QmxvY2sKICAgICAgICAgICAgICAgICAgICAkdGFzay5EdXJhdGlvbiA9ICRzdG9wd2F0Y2guRWxhcHNlZAogICAgICAgICAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCR0YXNrLkNvbnRpbnVlT25FcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICAiLSIqNzAKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGVDb2xvcmVkT3V0cHV0ICgkbXNncy5jb250aW51ZV9vbl9lcnJvciAtZiAkdGFza05hbWUsJF8pIC1mb3JlZ3JvdW5kY29sb3IgWWVsbG93CiAgICAgICAgICAgICAgICAgICAgICAgICItIio3MAogICAgICAgICAgICAgICAgICAgICAgICAkdGFzay5EdXJhdGlvbiA9ICRzdG9wd2F0Y2guRWxhcHNlZAogICAgICAgICAgICAgICAgICAgIH0gIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyAkXwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICMgbm8gYWN0aW9uIHdhcyBzcGVjaWZpZWQgYnV0IHdlIHN0aWxsIGV4ZWN1dGUgYWxsIHRoZSBkZXBlbmRlbmNpZXMKICAgICAgICAgICAgICAgIGZvcmVhY2goJGNoaWxkVGFzayBpbiAkdGFzay5EZXBlbmRzT24pIHsKICAgICAgICAgICAgICAgICAgICBJbnZva2UtVGFzayAkY2hpbGRUYXNrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3JlYWNoKCRjaGlsZFRhc2sgaW4gJHRhc2suRGVwZW5kc09uKSB7CiAgICAgICAgICAgICAgICBJbnZva2UtVGFzayAkY2hpbGRUYXNrCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIEFzc2VydCAoJiAkdGFzay5Qb3N0Y29uZGl0aW9uKSAoJG1zZ3MucG9zdGNvbmRpdGlvbl9mYWlsZWQgLWYgJHRhc2tOYW1lKQogICAgfQoKICAgICRwb3BwZWRUYXNrS2V5ID0gJGN1cnJlbnRDb250ZXh0LmNhbGxTdGFjay5Qb3AoKQogICAgQXNzZXJ0ICgkcG9wcGVkVGFza0tleSAtZXEgJHRhc2tLZXkpICgkbXNncy5lcnJvcl9jb3JydXB0X2NhbGxzdGFjayAtZiAkdGFza0tleSwkcG9wcGVkVGFza0tleSkKCiAgICAkY3VycmVudENvbnRleHQuZXhlY3V0ZWRUYXNrcy5QdXNoKCR0YXNrS2V5KQp9CgojIC5FeHRlcm5hbEhlbHAgIHBzYWtlLnBzbTEtaGVscC54bWwKZnVuY3Rpb24gRXhlYwp7CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLE1hbmRhdG9yeT0xKV1bc2NyaXB0YmxvY2tdJGNtZCwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTEsTWFuZGF0b3J5PTApXVtzdHJpbmddJGVycm9yTWVzc2FnZSA9ICgkbXNncy5lcnJvcl9iYWRfY29tbWFuZCAtZiAkY21kKSwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTIsTWFuZGF0b3J5PTApXVtpbnRdJG1heFJldHJpZXMgPSAwLAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MyxNYW5kYXRvcnk9MCldW3N0cmluZ10kcmV0cnlUcmlnZ2VyRXJyb3JQYXR0ZXJuID0gJG51bGwKICAgICkKCiAgICAkdHJ5Q291bnQgPSAxCgogICAgZG8gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRnbG9iYWw6bGFzdGV4aXRjb2RlID0gMAogICAgICAgICAgICAmICRjbWQKICAgICAgICAgICAgaWYgKCRsYXN0ZXhpdGNvZGUgLW5lIDApIHsKICAgICAgICAgICAgICAgIHRocm93ICgiRXhlYzogIiArICRlcnJvck1lc3NhZ2UpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggW0V4Y2VwdGlvbl0KICAgICAgICB7CiAgICAgICAgICAgIGlmICgkdHJ5Q291bnQgLWd0ICRtYXhSZXRyaWVzKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAkXwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJHJldHJ5VHJpZ2dlckVycm9yUGF0dGVybiAtbmUgJG51bGwpIHsKICAgICAgICAgICAgICAgICRpc01hdGNoID0gW3JlZ2V4XTo6SXNNYXRjaCgkXy5FeGNlcHRpb24uTWVzc2FnZSwgJHJldHJ5VHJpZ2dlckVycm9yUGF0dGVybikKCiAgICAgICAgICAgICAgICBpZiAoJGlzTWF0Y2ggLWVxICRmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIHRocm93ICRfCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFdyaXRlLUhvc3QgIlRyeSAkdHJ5Q291bnQgZmFpbGVkLCByZXRyeWluZyBhZ2FpbiBpbiAxIHNlY29uZC4uLiIKCiAgICAgICAgICAgICR0cnlDb3VudCsrCgogICAgICAgICAgICBbU3lzdGVtLlRocmVhZGluZy5UaHJlYWRdOjpTbGVlcChbU3lzdGVtLlRpbWVTcGFuXTo6RnJvbVNlY29uZHMoMSkpCiAgICAgICAgfQogICAgfQogICAgd2hpbGUgKCR0cnVlKQp9CgojIC5FeHRlcm5hbEhlbHAgIHBzYWtlLnBzbTEtaGVscC54bWwKZnVuY3Rpb24gQXNzZXJ0CnsKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsTWFuZGF0b3J5PTEpXSRjb25kaXRpb25Ub0NoZWNrLAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MSxNYW5kYXRvcnk9MSldJGZhaWx1cmVNZXNzYWdlCiAgICApCiAgICBpZiAoISRjb25kaXRpb25Ub0NoZWNrKSB7CiAgICAgICAgdGhyb3cgKCJBc3NlcnQ6ICIgKyAkZmFpbHVyZU1lc3NhZ2UpCiAgICB9Cn0KCiMgLkV4dGVybmFsSGVscCAgcHNha2UucHNtMS1oZWxwLnhtbApmdW5jdGlvbiBUYXNrCnsKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsTWFuZGF0b3J5PTEpXVtzdHJpbmddJG5hbWUgPSAkbnVsbCwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTEsTWFuZGF0b3J5PTApXVtzY3JpcHRibG9ja10kYWN0aW9uID0gJG51bGwsCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0yLE1hbmRhdG9yeT0wKV1bc2NyaXB0YmxvY2tdJHByZWFjdGlvbiA9ICRudWxsLAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MyxNYW5kYXRvcnk9MCldW3NjcmlwdGJsb2NrXSRwb3N0YWN0aW9uID0gJG51bGwsCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj00LE1hbmRhdG9yeT0wKV1bc2NyaXB0YmxvY2tdJHByZWNvbmRpdGlvbiA9IHskdHJ1ZX0sCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj01LE1hbmRhdG9yeT0wKV1bc2NyaXB0YmxvY2tdJHBvc3Rjb25kaXRpb24gPSB7JHRydWV9LAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249NixNYW5kYXRvcnk9MCldW3N3aXRjaF0kY29udGludWVPbkVycm9yID0gJGZhbHNlLAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249NyxNYW5kYXRvcnk9MCldW3N0cmluZ1tdXSRkZXBlbmRzID0gQCgpLAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249OCxNYW5kYXRvcnk9MCldW3N0cmluZ1tdXSRyZXF1aXJlZFZhcmlhYmxlcyA9IEAoKSwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTksTWFuZGF0b3J5PTApXVtzdHJpbmddJGRlc2NyaXB0aW9uID0gJG51bGwsCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0xMCxNYW5kYXRvcnk9MCldW3N0cmluZ10kYWxpYXMgPSAkbnVsbAogICAgKQogICAgaWYgKCRuYW1lIC1lcSAnZGVmYXVsdCcpIHsKICAgICAgICBBc3NlcnQgKCEkYWN0aW9uKSAoJG1zZ3MuZXJyb3JfZGVmYXVsdF90YXNrX2Nhbm5vdF9oYXZlX2FjdGlvbikKICAgIH0KCiAgICAkbmV3VGFzayA9IEB7CiAgICAgICAgTmFtZSA9ICRuYW1lCiAgICAgICAgRGVwZW5kc09uID0gJGRlcGVuZHMKICAgICAgICBQcmVBY3Rpb24gPSAkcHJlYWN0aW9uCiAgICAgICAgQWN0aW9uID0gJGFjdGlvbgogICAgICAgIFBvc3RBY3Rpb24gPSAkcG9zdGFjdGlvbgogICAgICAgIFByZWNvbmRpdGlvbiA9ICRwcmVjb25kaXRpb24KICAgICAgICBQb3N0Y29uZGl0aW9uID0gJHBvc3Rjb25kaXRpb24KICAgICAgICBDb250aW51ZU9uRXJyb3IgPSAkY29udGludWVPbkVycm9yCiAgICAgICAgRGVzY3JpcHRpb24gPSAkZGVzY3JpcHRpb24KICAgICAgICBEdXJhdGlvbiA9IFtTeXN0ZW0uVGltZVNwYW5dOjpaZXJvCiAgICAgICAgUmVxdWlyZWRWYXJpYWJsZXMgPSAkcmVxdWlyZWRWYXJpYWJsZXMKICAgICAgICBBbGlhcyA9ICRhbGlhcwogICAgfQoKICAgICR0YXNrS2V5ID0gJG5hbWUuVG9Mb3dlcigpCgogICAgJGN1cnJlbnRDb250ZXh0ID0gJHBzYWtlLmNvbnRleHQuUGVlaygpCgogICAgQXNzZXJ0ICghJGN1cnJlbnRDb250ZXh0LnRhc2tzLkNvbnRhaW5zS2V5KCR0YXNrS2V5KSkgKCRtc2dzLmVycm9yX2R1cGxpY2F0ZV90YXNrX25hbWUgLWYgJG5hbWUpCgogICAgJGN1cnJlbnRDb250ZXh0LnRhc2tzLiR0YXNrS2V5ID0gJG5ld1Rhc2sKCiAgICBpZigkYWxpYXMpCiAgICB7CiAgICAgICAgJGFsaWFzS2V5ID0gJGFsaWFzLlRvTG93ZXIoKQoKICAgICAgICBBc3NlcnQgKCEkY3VycmVudENvbnRleHQuYWxpYXNlcy5Db250YWluc0tleSgkYWxpYXNLZXkpKSAoJG1zZ3MuZXJyb3JfZHVwbGljYXRlX2FsaWFzX25hbWUgLWYgJGFsaWFzKQoKICAgICAgICAkY3VycmVudENvbnRleHQuYWxpYXNlcy4kYWxpYXNLZXkgPSAkbmV3VGFzawogICAgfQp9CgojIC5FeHRlcm5hbEhlbHAgIHBzYWtlLnBzbTEtaGVscC54bWwKZnVuY3Rpb24gUHJvcGVydGllcyB7CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLE1hbmRhdG9yeT0xKV1bc2NyaXB0YmxvY2tdJHByb3BlcnRpZXMKICAgICkKICAgICRwc2FrZS5jb250ZXh0LlBlZWsoKS5wcm9wZXJ0aWVzICs9ICRwcm9wZXJ0aWVzCn0KCiMgLkV4dGVybmFsSGVscCAgcHNha2UucHNtMS1oZWxwLnhtbApmdW5jdGlvbiBJbmNsdWRlIHsKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsTWFuZGF0b3J5PTEpXVtzdHJpbmddJGZpbGVOYW1lUGF0aFRvSW5jbHVkZQogICAgKQogICAgQXNzZXJ0ICh0ZXN0LXBhdGggJGZpbGVOYW1lUGF0aFRvSW5jbHVkZSAtcGF0aFR5cGUgTGVhZikgKCRtc2dzLmVycm9yX2ludmFsaWRfaW5jbHVkZV9wYXRoIC1mICRmaWxlTmFtZVBhdGhUb0luY2x1ZGUpCiAgICAkcHNha2UuY29udGV4dC5QZWVrKCkuaW5jbHVkZXMuRW5xdWV1ZSgoUmVzb2x2ZS1QYXRoICRmaWxlTmFtZVBhdGhUb0luY2x1ZGUpKTsKfQoKIyAuRXh0ZXJuYWxIZWxwICBwc2FrZS5wc20xLWhlbHAueG1sCmZ1bmN0aW9uIEZvcm1hdFRhc2tOYW1lIHsKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsTWFuZGF0b3J5PTEpXSRmb3JtYXQKICAgICkKICAgICRwc2FrZS5jb250ZXh0LlBlZWsoKS5jb25maWcudGFza05hbWVGb3JtYXQgPSAkZm9ybWF0Cn0KCiMgLkV4dGVybmFsSGVscCAgcHNha2UucHNtMS1oZWxwLnhtbApmdW5jdGlvbiBUYXNrU2V0dXAgewogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxNYW5kYXRvcnk9MSldW3NjcmlwdGJsb2NrXSRzZXR1cAogICAgKQogICAgJHBzYWtlLmNvbnRleHQuUGVlaygpLnRhc2tTZXR1cFNjcmlwdEJsb2NrID0gJHNldHVwCn0KCiMgLkV4dGVybmFsSGVscCAgcHNha2UucHNtMS1oZWxwLnhtbApmdW5jdGlvbiBUYXNrVGVhckRvd24gewogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxNYW5kYXRvcnk9MSldW3NjcmlwdGJsb2NrXSR0ZWFyZG93bgogICAgKQogICAgJHBzYWtlLmNvbnRleHQuUGVlaygpLnRhc2tUZWFyRG93blNjcmlwdEJsb2NrID0gJHRlYXJkb3duCn0KCiMgLkV4dGVybmFsSGVscCAgcHNha2UucHNtMS1oZWxwLnhtbApmdW5jdGlvbiBGcmFtZXdvcmsgewogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxNYW5kYXRvcnk9MSldW3N0cmluZ10kZnJhbWV3b3JrCiAgICApCiAgICAkcHNha2UuY29udGV4dC5QZWVrKCkuY29uZmlnLmZyYW1ld29yayA9ICRmcmFtZXdvcmsKICAgIENvbmZpZ3VyZUJ1aWxkRW52aXJvbm1lbnQKfQoKIyAuRXh0ZXJuYWxIZWxwICBwc2FrZS5wc20xLWhlbHAueG1sCmZ1bmN0aW9uIEdldC1QU2FrZVNjcmlwdFRhc2tzIHsKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCwgTWFuZGF0b3J5ID0gMCldW3N0cmluZ10gJGJ1aWxkRmlsZQogICAgKQoKICAgIGlmICghJGJ1aWxkRmlsZSkgewogICAgICAgICRidWlsZEZpbGUgPSAkcHNha2UuY29uZmlnX2RlZmF1bHQuYnVpbGRGaWxlTmFtZQogICAgfQoKICAgIHRyeQogICAgewogICAgICAgIEV4ZWN1dGVJbkJ1aWxkRmlsZVNjb3BlICRidWlsZEZpbGUgJE15SW52b2NhdGlvbi5NeUNvbW1hbmQuTW9kdWxlIHsKICAgICAgICAgICAgcGFyYW0oJGN1cnJlbnRDb250ZXh0LCAkbW9kdWxlKQogICAgICAgICAgICByZXR1cm4gR2V0VGFza3NGcm9tQ29udGV4dCAkY3VycmVudENvbnRleHQKICAgICAgICB9CgogICAgfSBmaW5hbGx5IHsKCiAgICAgICAgQ2xlYW51cEVudmlyb25tZW50CiAgICB9Cn0KCiMgLkV4dGVybmFsSGVscCAgcHNha2UucHNtMS1oZWxwLnhtbApmdW5jdGlvbiBJbnZva2UtcHNha2UgewogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAwLCBNYW5kYXRvcnkgPSAwKV1bc3RyaW5nXSAkYnVpbGRGaWxlLAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAxLCBNYW5kYXRvcnkgPSAwKV1bc3RyaW5nW11dICR0YXNrTGlzdCA9IEAoKSwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMiwgTWFuZGF0b3J5ID0gMCldW3N0cmluZ10gJGZyYW1ld29yaywKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMywgTWFuZGF0b3J5ID0gMCldW3N3aXRjaF0gJGRvY3MgPSAkZmFsc2UsCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDQsIE1hbmRhdG9yeSA9IDApXVtoYXNodGFibGVdICRwYXJhbWV0ZXJzID0gQHt9LAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSA1LCBNYW5kYXRvcnkgPSAwKV1baGFzaHRhYmxlXSAkcHJvcGVydGllcyA9IEB7fSwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gNiwgTWFuZGF0b3J5ID0gMCldW2FsaWFzKCJpbml0IildW3NjcmlwdGJsb2NrXSAkaW5pdGlhbGl6YXRpb24gPSB7fSwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gNywgTWFuZGF0b3J5ID0gMCldW3N3aXRjaF0gJG5vbG9nbyA9ICRmYWxzZSwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gOCwgTWFuZGF0b3J5ID0gMCldW3N3aXRjaF0gJGRldGFpbGVkRG9jcyA9ICRmYWxzZSwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gOSwgTWFuZGF0b3J5ID0gMCldW3N3aXRjaF0gJG5vdHIgPSAkZmFsc2UgIyBkaXNhYmxlIHRpbWUgcmVwb3J0CiAgICApCiAgICB0cnkgewogICAgICAgIGlmICgtbm90ICRub2xvZ28pIHsKICAgICAgICAgICAgInBzYWtlIHZlcnNpb24gezB9YG5Db3B5cmlnaHQgKGMpIDIwMTAtMjAxNCBKYW1lcyBLb3ZhY3MgJiBDb250cmlidXRvcnNgbiIgLWYgJHBzYWtlLnZlcnNpb24KICAgICAgICB9CgogICAgICAgIGlmICghJGJ1aWxkRmlsZSkgewogICAgICAgICAgJGJ1aWxkRmlsZSA9ICRwc2FrZS5jb25maWdfZGVmYXVsdC5idWlsZEZpbGVOYW1lCiAgICAgICAgfQogICAgICAgIGVsc2VpZiAoISh0ZXN0LXBhdGggJGJ1aWxkRmlsZSAtcGF0aFR5cGUgTGVhZikgLWFuZCAodGVzdC1wYXRoICRwc2FrZS5jb25maWdfZGVmYXVsdC5idWlsZEZpbGVOYW1lIC1wYXRoVHlwZSBMZWFmKSkgewogICAgICAgICAgICAjIElmIHRoZSAkY29uZmlnLmJ1aWxkRmlsZU5hbWUgZmlsZSBleGlzdHMgYW5kIHRoZSBnaXZlbiAiYnVpbGRmaWxlIiBpc24gJ3QgZm91bmQgYXNzdW1lIHRoYXQgdGhlIGdpdmVuCiAgICAgICAgICAgICMgJGJ1aWxkRmlsZSBpcyBhY3R1YWxseSB0aGUgdGFyZ2V0IFRhc2tzIHRvIGV4ZWN1dGUgaW4gdGhlICRjb25maWcuYnVpbGRGaWxlTmFtZSBzY3JpcHQuCiAgICAgICAgICAgICR0YXNrTGlzdCA9ICRidWlsZEZpbGUuU3BsaXQoJywgJykKICAgICAgICAgICAgJGJ1aWxkRmlsZSA9ICRwc2FrZS5jb25maWdfZGVmYXVsdC5idWlsZEZpbGVOYW1lCiAgICAgICAgfQoKICAgICAgICBFeGVjdXRlSW5CdWlsZEZpbGVTY29wZSAkYnVpbGRGaWxlICRNeUludm9jYXRpb24uTXlDb21tYW5kLk1vZHVsZSB7CiAgICAgICAgICAgIHBhcmFtKCRjdXJyZW50Q29udGV4dCwgJG1vZHVsZSkgICAgICAgICAgICAKCiAgICAgICAgICAgICRzdG9wd2F0Y2ggPSBbU3lzdGVtLkRpYWdub3N0aWNzLlN0b3B3YXRjaF06OlN0YXJ0TmV3KCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICgkZG9jcyAtb3IgJGRldGFpbGVkRG9jcykgewogICAgICAgICAgICAgICAgV3JpdGVEb2N1bWVudGF0aW9uKCRkZXRhaWxlZERvY3MpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yZWFjaCAoJGtleSBpbiAkcGFyYW1ldGVycy5rZXlzKSB7CiAgICAgICAgICAgICAgICBpZiAodGVzdC1wYXRoICJ2YXJpYWJsZTpcJGtleSIpIHsKICAgICAgICAgICAgICAgICAgICBzZXQtaXRlbSAtcGF0aCAidmFyaWFibGU6XCRrZXkiIC12YWx1ZSAkcGFyYW1ldGVycy4ka2V5IC1XaGF0SWY6JGZhbHNlIC1Db25maXJtOiRmYWxzZSB8IG91dC1udWxsCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG5ldy1pdGVtIC1wYXRoICJ2YXJpYWJsZTpcJGtleSIgLXZhbHVlICRwYXJhbWV0ZXJzLiRrZXkgLVdoYXRJZjokZmFsc2UgLUNvbmZpcm06JGZhbHNlIHwgb3V0LW51bGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaGUgaW5pdGlhbCBkb3QgKC4pIGluZGljYXRlcyB0aGF0IHZhcmlhYmxlcyBpbml0aWFsaXplZC9tb2RpZmllZCBpbiB0aGUgcHJvcGVydHlCbG9jayBhcmUgYXZhaWxhYmxlIGluIHRoZSBwYXJlbnQgc2NvcGUuCiAgICAgICAgICAgIGZvcmVhY2ggKCRwcm9wZXJ0eUJsb2NrIGluICRjdXJyZW50Q29udGV4dC5wcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICAuICRwcm9wZXJ0eUJsb2NrCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGZvcmVhY2ggKCRrZXkgaW4gJHByb3BlcnRpZXMua2V5cykgewogICAgICAgICAgICAgICAgaWYgKHRlc3QtcGF0aCAidmFyaWFibGU6XCRrZXkiKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0LWl0ZW0gLXBhdGggInZhcmlhYmxlOlwka2V5IiAtdmFsdWUgJHByb3BlcnRpZXMuJGtleSAtV2hhdElmOiRmYWxzZSAtQ29uZmlybTokZmFsc2UgfCBvdXQtbnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIFNpbXBsZSBkb3Qgc291cmNpbmcgd2lsbCBub3Qgd29yay4gV2UgaGF2ZSB0byBmb3JjZSB0aGUgc2NyaXB0IGJsb2NrIGludG8gb3VyCiAgICAgICAgICAgICMgbW9kdWxlJ3Mgc2NvcGUgaW4gb3JkZXIgdG8gaW5pdGlhbGl6ZSB2YXJpYWJsZXMgcHJvcGVybHkuCiAgICAgICAgICAgIC4gJG1vZHVsZSAkaW5pdGlhbGl6YXRpb24KICAgICAgICAgICAgCiAgICAgICAgICAgICMgRXhlY3V0ZSB0aGUgbGlzdCBvZiB0YXNrcyBvciB0aGUgZGVmYXVsdCB0YXNrCiAgICAgICAgICAgIGlmICgkdGFza0xpc3QpIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR0YXNrIGluICR0YXNrTGlzdCkgewogICAgICAgICAgICAgICAgICAgIGludm9rZS10YXNrICR0YXNrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZWlmICgkY3VycmVudENvbnRleHQudGFza3MuZGVmYXVsdCkgewogICAgICAgICAgICAgICAgaW52b2tlLXRhc2sgZGVmYXVsdAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgJG1zZ3MuZXJyb3Jfbm9fZGVmYXVsdF90YXNrCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIFdyaXRlQ29sb3JlZE91dHB1dCAoImBuIiArICRtc2dzLmJ1aWxkX3N1Y2Nlc3MgKyAiYG4iKSAtZm9yZWdyb3VuZGNvbG9yIEdyZWVuCiAgICAgICAgICAgIAogICAgICAgICAgICAkc3RvcHdhdGNoLlN0b3AoKQogICAgICAgICAgICBpZiAoLW5vdCAkbm90cikgewogICAgICAgICAgICAgICAgV3JpdGVUYXNrVGltZVN1bW1hcnkgJHN0b3B3YXRjaC5FbGFwc2VkCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRwc2FrZS5idWlsZF9zdWNjZXNzID0gJHRydWUKCiAgICB9IGNhdGNoIHsKICAgICAgICAkY3VycmVudENvbmZpZyA9IEdldEN1cnJlbnRDb25maWd1cmF0aW9uT3JEZWZhdWx0CiAgICAgICAgaWYgKCRjdXJyZW50Q29uZmlnLnZlcmJvc2VFcnJvcikgewogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSA9ICJ7MH06IEFuIEVycm9yIE9jY3VycmVkLiBTZWUgRXJyb3IgRGV0YWlscyBCZWxvdzogYG4iIC1mIChHZXQtRGF0ZSkKICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgKz0gKCItIiAqIDcwKSArICJgbiIKICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgKz0gIkVycm9yOiB7MH1gbiIgLWYgKFJlc29sdmVFcnJvciAkXyAtU2hvcnQpCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlICs9ICgiLSIgKiA3MCkgKyAiYG4iCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlICs9IFJlc29sdmVFcnJvciAkXwogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSArPSAoIi0iICogNzApICsgImBuIgogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSArPSAiU2NyaXB0IFZhcmlhYmxlcyIgKyAiYG4iCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlICs9ICgiLSIgKiA3MCkgKyAiYG4iCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlICs9IGdldC12YXJpYWJsZSAtc2NvcGUgc2NyaXB0IHwgZm9ybWF0LXRhYmxlIHwgb3V0LXN0cmluZwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICMgKCRfIHwgT3V0LVN0cmluZykgZ2V0cyBlcnJvciBtZXNzYWdlcyB3aXRoIHNvdXJjZSBpbmZvcm1hdGlvbiBpbmNsdWRlZC4KICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAiRXJyb3I6IHswfTogYG57MX0iIC1mIChHZXQtRGF0ZSksIChSZXNvbHZlRXJyb3IgJF8gLVNob3J0KQogICAgICAgIH0KCiAgICAgICAgJHBzYWtlLmJ1aWxkX3N1Y2Nlc3MgPSAkZmFsc2UKCiAgICAgICAgIyBpZiB3ZSBhcmUgcnVubmluZyBpbiBhIG5lc3RlZCBzY29wZSAoaS5lLiBydW5uaW5nIGEgcHNha2Ugc2NyaXB0IGZyb20gYSBwc2FrZSBzY3JpcHQpIHRoZW4gd2UgbmVlZCB0byByZS10aHJvdyB0aGUgZXhjZXB0aW9uCiAgICAgICAgIyBzbyB0aGF0IHRoZSBwYXJlbnQgc2NyaXB0IHdpbGwgZmFpbCBvdGhlcndpc2UgdGhlIHBhcmVudCBzY3JpcHQgd2lsbCByZXBvcnQgYSBzdWNjZXNzZnVsIGJ1aWxkCiAgICAgICAgJGluTmVzdGVkU2NvcGUgPSAoJHBzYWtlLmNvbnRleHQuY291bnQgLWd0IDEpCiAgICAgICAgaWYgKCAkaW5OZXN0ZWRTY29wZSApIHsKICAgICAgICAgICAgdGhyb3cgJF8KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoISRwc2FrZS5ydW5fYnlfcHNha2VfYnVpbGRfdGVzdGVyKSB7CiAgICAgICAgICAgICAgICBXcml0ZUNvbG9yZWRPdXRwdXQgJGVycm9yX21lc3NhZ2UgLWZvcmVncm91bmRjb2xvciBSZWQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZmluYWxseSB7CiAgICAgICAgQ2xlYW51cEVudmlyb25tZW50CiAgICB9Cn0KCiMtLSBQcml2YXRlIE1vZHVsZSBGdW5jdGlvbnMgLS0jCmZ1bmN0aW9uIFdyaXRlQ29sb3JlZE91dHB1dCB7CiAgICBwYXJhbSgKICAgICAgICBbc3RyaW5nXSAkbWVzc2FnZSwKICAgICAgICBbU3lzdGVtLkNvbnNvbGVDb2xvcl0gJGZvcmVncm91bmRjb2xvcgogICAgKQoKICAgICRjdXJyZW50Q29uZmlnID0gR2V0Q3VycmVudENvbmZpZ3VyYXRpb25PckRlZmF1bHQKICAgIGlmICgkY3VycmVudENvbmZpZy5jb2xvcmVkT3V0cHV0IC1lcSAkdHJ1ZSkgewogICAgICAgIGlmICgoJEhvc3QuVUkgLW5lICRudWxsKSAtYW5kICgkSG9zdC5VSS5SYXdVSSAtbmUgJG51bGwpIC1hbmQgKCRIb3N0LlVJLlJhd1VJLkZvcmVncm91bmRDb2xvciAtbmUgJG51bGwpKSB7CiAgICAgICAgICAgICRwcmV2aW91c0NvbG9yID0gJEhvc3QuVUkuUmF3VUkuRm9yZWdyb3VuZENvbG9yCiAgICAgICAgICAgICRIb3N0LlVJLlJhd1VJLkZvcmVncm91bmRDb2xvciA9ICRmb3JlZ3JvdW5kY29sb3IKICAgICAgICB9CiAgICB9CgogICAgJG1lc3NhZ2UKCiAgICBpZiAoJHByZXZpb3VzQ29sb3IgLW5lICRudWxsKSB7CiAgICAgICAgJEhvc3QuVUkuUmF3VUkuRm9yZWdyb3VuZENvbG9yID0gJHByZXZpb3VzQ29sb3IKICAgIH0KfQoKZnVuY3Rpb24gTG9hZE1vZHVsZXMgewogICAgJGN1cnJlbnRDb25maWcgPSAkcHNha2UuY29udGV4dC5wZWVrKCkuY29uZmlnCiAgICBpZiAoJGN1cnJlbnRDb25maWcubW9kdWxlcykgewoKICAgICAgICAkc2NvcGUgPSAkY3VycmVudENvbmZpZy5tb2R1bGVTY29wZQoKICAgICAgICAkZ2xvYmFsID0gW3N0cmluZ106OkVxdWFscygkc2NvcGUsICJnbG9iYWwiLCBbU3RyaW5nQ29tcGFyaXNvbl06OkN1cnJlbnRDdWx0dXJlSWdub3JlQ2FzZSkKCiAgICAgICAgJGN1cnJlbnRDb25maWcubW9kdWxlcyB8IGZvcmVhY2ggewogICAgICAgICAgICByZXNvbHZlLXBhdGggJF8gfCBmb3JlYWNoIHsKICAgICAgICAgICAgICAgICJMb2FkaW5nIG1vZHVsZTogJF8iCiAgICAgICAgICAgICAgICAkbW9kdWxlID0gaW1wb3J0LW1vZHVsZSAkXyAtcGFzc3RocnUgLURpc2FibGVOYW1lQ2hlY2tpbmcgLWdsb2JhbDokZ2xvYmFsCiAgICAgICAgICAgICAgICBpZiAoISRtb2R1bGUpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyAoJG1zZ3MuZXJyb3JfbG9hZGluZ19tb2R1bGUgLWYgJF8uTmFtZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAiIgogICAgfQp9CgpmdW5jdGlvbiBMb2FkQ29uZmlndXJhdGlvbiB7CiAgICBwYXJhbSgKICAgICAgICBbc3RyaW5nXSAkY29uZmlnZGlyID0gJFBTU2NyaXB0Um9vdAogICAgKQoKICAgICRwc2FrZUNvbmZpZ0ZpbGVQYXRoID0gKGpvaW4tcGF0aCAkY29uZmlnZGlyICJwc2FrZS1jb25maWcucHMxIikKCiAgICBpZiAodGVzdC1wYXRoICRwc2FrZUNvbmZpZ0ZpbGVQYXRoIC1wYXRoVHlwZSBMZWFmKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGNvbmZpZyA9IEdldEN1cnJlbnRDb25maWd1cmF0aW9uT3JEZWZhdWx0CiAgICAgICAgICAgIC4gJHBzYWtlQ29uZmlnRmlsZVBhdGgKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgdGhyb3cgIkVycm9yIExvYWRpbmcgQ29uZmlndXJhdGlvbiBmcm9tIHBzYWtlLWNvbmZpZy5wczE6ICIgKyAkXwogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gR2V0Q3VycmVudENvbmZpZ3VyYXRpb25PckRlZmF1bHQoKSB7CiAgICBpZiAoJHBzYWtlLmNvbnRleHQuY291bnQgLWd0IDApIHsKICAgICAgICByZXR1cm4gJHBzYWtlLmNvbnRleHQucGVlaygpLmNvbmZpZwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gJHBzYWtlLmNvbmZpZ19kZWZhdWx0CiAgICB9Cn0KCmZ1bmN0aW9uIENyZWF0ZUNvbmZpZ3VyYXRpb25Gb3JOZXdDb250ZXh0IHsKICAgIHBhcmFtKAogICAgICAgIFtzdHJpbmddICRidWlsZEZpbGUsCiAgICAgICAgW3N0cmluZ10gJGZyYW1ld29yawogICAgKQoKICAgICRwcmV2aW91c0NvbmZpZyA9IEdldEN1cnJlbnRDb25maWd1cmF0aW9uT3JEZWZhdWx0CgogICAgJGNvbmZpZyA9IG5ldy1vYmplY3QgcHNvYmplY3QgLXByb3BlcnR5IEB7CiAgICAgICAgYnVpbGRGaWxlTmFtZSA9ICRwcmV2aW91c0NvbmZpZy5idWlsZEZpbGVOYW1lOwogICAgICAgIGZyYW1ld29yayA9ICRwcmV2aW91c0NvbmZpZy5mcmFtZXdvcms7CiAgICAgICAgdGFza05hbWVGb3JtYXQgPSAkcHJldmlvdXNDb25maWcudGFza05hbWVGb3JtYXQ7CiAgICAgICAgdmVyYm9zZUVycm9yID0gJHByZXZpb3VzQ29uZmlnLnZlcmJvc2VFcnJvcjsKICAgICAgICBjb2xvcmVkT3V0cHV0ID0gJHByZXZpb3VzQ29uZmlnLmNvbG9yZWRPdXRwdXQ7CiAgICAgICAgbW9kdWxlcyA9ICRwcmV2aW91c0NvbmZpZy5tb2R1bGVzOwogICAgICAgIG1vZHVsZVNjb3BlID0gICRwcmV2aW91c0NvbmZpZy5tb2R1bGVTY29wZTsKICAgIH0KCiAgICBpZiAoJGZyYW1ld29yaykgewogICAgICAgICRjb25maWcuZnJhbWV3b3JrID0gJGZyYW1ld29yazsKICAgIH0KCiAgICBpZiAoJGJ1aWxkRmlsZSkgewogICAgICAgICRjb25maWcuYnVpbGRGaWxlTmFtZSA9ICRidWlsZEZpbGU7CiAgICB9CgogICAgcmV0dXJuICRjb25maWcKfQoKZnVuY3Rpb24gQ29uZmlndXJlQnVpbGRFbnZpcm9ubWVudCB7CiAgICAkZnJhbWV3b3JrID0gJHBzYWtlLmNvbnRleHQucGVlaygpLmNvbmZpZy5mcmFtZXdvcmsKICAgIGlmICgkZnJhbWV3b3JrIC1jbWF0Y2ggJ14oKD86XGQrXC5cZCspKD86XC5cZCspezAsMX0pKHg4Nnx4NjQpezAsMX0kJykgewogICAgICAgICR2ZXJzaW9uUGFydCA9ICRtYXRjaGVzWzFdCiAgICAgICAgJGJpdG5lc3NQYXJ0ID0gJG1hdGNoZXNbMl0KICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgKCRtc2dzLmVycm9yX2ludmFsaWRfZnJhbWV3b3JrIC1mICRmcmFtZXdvcmspCiAgICB9CiAgICAkdmVyc2lvbnMgPSAkbnVsbAogICAgJGJ1aWxkVG9vbHNWZXJzaW9ucyA9ICRudWxsCiAgICBzd2l0Y2ggKCR2ZXJzaW9uUGFydCkgewogICAgICAgICcxLjAnIHsKICAgICAgICAgICAgJHZlcnNpb25zID0gQCgndjEuMC4zNzA1JykKICAgICAgICB9CiAgICAgICAgJzEuMScgewogICAgICAgICAgICAkdmVyc2lvbnMgPSBAKCd2MS4xLjQzMjInKQogICAgICAgIH0KICAgICAgICAnMi4wJyB7CiAgICAgICAgICAgICR2ZXJzaW9ucyA9IEAoJ3YyLjAuNTA3MjcnKQogICAgICAgIH0KICAgICAgICAnMy4wJyB7CiAgICAgICAgICAgICR2ZXJzaW9ucyA9IEAoJ3YyLjAuNTA3MjcnKQogICAgICAgIH0KICAgICAgICAnMy41JyB7CiAgICAgICAgICAgICR2ZXJzaW9ucyA9IEAoJ3YzLjUnLCAndjIuMC41MDcyNycpCiAgICAgICAgfQogICAgICAgICc0LjAnIHsKICAgICAgICAgICAgJHZlcnNpb25zID0gQCgndjQuMC4zMDMxOScpCiAgICAgICAgfQogICAgICAgIHsoJF8gLWVxICc0LjUuMScpIC1vciAoJF8gLWVxICc0LjUuMicpfSB7CiAgICAgICAgICAgICR2ZXJzaW9ucyA9IEAoJ3Y0LjAuMzAzMTknKQogICAgICAgICAgICAkYnVpbGRUb29sc1ZlcnNpb25zID0gQCgnMTQuMCcsICcxMi4wJykKICAgICAgICB9CiAgICAgICAgeygkXyAtZXEgJzQuNicpIC1vciAoJF8gLWVxICc0LjYuMScpfSB7CiAgICAgICAgICAgICR2ZXJzaW9ucyA9IEAoJ3Y0LjAuMzAzMTknKQogICAgICAgICAgICAkYnVpbGRUb29sc1ZlcnNpb25zID0gQCgnMTQuMCcpCiAgICAgICAgfQoKICAgICAgICBkZWZhdWx0IHsKICAgICAgICAgICAgdGhyb3cgKCRtc2dzLmVycm9yX3Vua25vd25fZnJhbWV3b3JrIC1mICR2ZXJzaW9uUGFydCwgJGZyYW1ld29yaykKICAgICAgICB9CiAgICB9CgogICAgJGJpdG5lc3MgPSAnRnJhbWV3b3JrJwogICAgaWYgKCR2ZXJzaW9uUGFydCAtbmUgJzEuMCcgLWFuZCAkdmVyc2lvblBhcnQgLW5lICcxLjEnKSB7CiAgICAgICAgc3dpdGNoICgkYml0bmVzc1BhcnQpIHsKICAgICAgICAgICAgJ3g4NicgewogICAgICAgICAgICAgICAgJGJpdG5lc3MgPSAnRnJhbWV3b3JrJwogICAgICAgICAgICAgICAgJGJ1aWxkVG9vbHNLZXkgPSAnTVNCdWlsZFRvb2xzUGF0aDMyJwogICAgICAgICAgICB9CiAgICAgICAgICAgICd4NjQnIHsKICAgICAgICAgICAgICAgICRiaXRuZXNzID0gJ0ZyYW1ld29yazY0JwogICAgICAgICAgICAgICAgJGJ1aWxkVG9vbHNLZXkgPSAnTVNCdWlsZFRvb2xzUGF0aCcKICAgICAgICAgICAgfQogICAgICAgICAgICB7IFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRfKSB9IHsKICAgICAgICAgICAgICAgICRwdHJTaXplID0gW1N5c3RlbS5JbnRQdHJdOjpTaXplCiAgICAgICAgICAgICAgICBzd2l0Y2ggKCRwdHJTaXplKSB7CiAgICAgICAgICAgICAgICAgICAgNCB7CiAgICAgICAgICAgICAgICAgICAgICAgICRiaXRuZXNzID0gJ0ZyYW1ld29yaycKICAgICAgICAgICAgICAgICAgICAgICAgJGJ1aWxkVG9vbHNLZXkgPSAnTVNCdWlsZFRvb2xzUGF0aDMyJwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICA4IHsKICAgICAgICAgICAgICAgICAgICAgICAgJGJpdG5lc3MgPSAnRnJhbWV3b3JrNjQnCiAgICAgICAgICAgICAgICAgICAgICAgICRidWlsZFRvb2xzS2V5ID0gJ01TQnVpbGRUb29sc1BhdGgnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyAoJG1zZ3MuZXJyb3JfdW5rbm93bl9wb2ludGVyc2l6ZSAtZiAkcHRyU2l6ZSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVmYXVsdCB7CiAgICAgICAgICAgICAgICB0aHJvdyAoJG1zZ3MuZXJyb3JfdW5rbm93bl9iaXRuZXNzcGFydCAtZiAkYml0bmVzc1BhcnQsICRmcmFtZXdvcmspCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAkZnJhbWV3b3JrRGlycyA9IEAoKQogICAgaWYgKCRidWlsZFRvb2xzVmVyc2lvbnMgLW5lICRudWxsKSB7CiAgICAgICAgZm9yZWFjaCgkdmVyIGluICRidWlsZFRvb2xzVmVyc2lvbnMpIHsKICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAiSEtMTTpcU09GVFdBUkVcTWljcm9zb2Z0XE1TQnVpbGRcVG9vbHNWZXJzaW9uc1wkdmVyIikgewogICAgICAgICAgICAgICAgJGZyYW1ld29ya0RpcnMgKz0gKEdldC1JdGVtUHJvcGVydHkgLVBhdGggIkhLTE06XFNPRlRXQVJFXE1pY3Jvc29mdFxNU0J1aWxkXFRvb2xzVmVyc2lvbnNcJHZlciIgLU5hbWUgJGJ1aWxkVG9vbHNLZXkpLiRidWlsZFRvb2xzS2V5CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAkZnJhbWV3b3JrRGlycyA9ICRmcmFtZXdvcmtEaXJzICsgQCgkdmVyc2lvbnMgfCBmb3JlYWNoIHsgIiRlbnY6d2luZGlyXE1pY3Jvc29mdC5ORVRcJGJpdG5lc3NcJF9cIiB9KQoKICAgIGZvciAoJGkgPSAwOyAkaSAtbHQgJGZyYW1ld29ya0RpcnMuQ291bnQ7ICRpKyspIHsKICAgICAgICAkZGlyID0gJGZyYW1ld29ya0RpcnNbJGldCiAgICAgICAgaWYgKCRkaXIgLU1hdGNoICJcJFwoUmVnaXN0cnk6SEtFWV9MT0NBTF9NQUNISU5FKC4qPylAKC4qKVwpIikgewogICAgICAgICAgICAka2V5ID0gIkhLTE06IiArICRtYXRjaGVzWzFdCiAgICAgICAgICAgICRuYW1lID0gJG1hdGNoZXNbMl0KICAgICAgICAgICAgJGRpciA9IChHZXQtSXRlbVByb3BlcnR5IC1QYXRoICRrZXkgLU5hbWUgJG5hbWUpLiRuYW1lCiAgICAgICAgICAgICRmcmFtZXdvcmtEaXJzWyRpXSA9ICRkaXIKICAgICAgICB9CiAgICB9CgogICAgJGZyYW1ld29ya0RpcnMgfCBmb3JlYWNoIHsgQXNzZXJ0ICh0ZXN0LXBhdGggJF8gLXBhdGhUeXBlIENvbnRhaW5lcikgKCRtc2dzLmVycm9yX25vX2ZyYW1ld29ya19pbnN0YWxsX2Rpcl9mb3VuZCAtZiAkXyl9CgogICAgJGVudjpwYXRoID0gKCRmcmFtZXdvcmtEaXJzIC1qb2luICI7IikgKyAiOyRlbnY6cGF0aCIKICAgICMgaWYgYW55IGVycm9yIG9jY3VycyBpbiBhIFBTIGZ1bmN0aW9uIHRoZW4gInN0b3AiIHByb2Nlc3NpbmcgaW1tZWRpYXRlbHkKICAgICMgdGhpcyBkb2VzIG5vdCBlZmZlY3QgYW55IGV4dGVybmFsIHByb2dyYW1zIHRoYXQgcmV0dXJuIGEgbm9uLXplcm8gZXhpdCBjb2RlCiAgICAkZ2xvYmFsOkVycm9yQWN0aW9uUHJlZmVyZW5jZSA9ICJTdG9wIgp9CgpmdW5jdGlvbiBFeGVjdXRlSW5CdWlsZEZpbGVTY29wZSB7ICAgIAogICAgcGFyYW0oW3N0cmluZ10kYnVpbGRGaWxlLCAkbW9kdWxlLCBbc2NyaXB0YmxvY2tdJHNiKQogICAgCiAgICAjIEV4ZWN1dGUgdGhlIGJ1aWxkIGZpbGUgdG8gc2V0IHVwIHRoZSB0YXNrcyBhbmQgZGVmYXVsdHMKICAgIEFzc2VydCAodGVzdC1wYXRoICRidWlsZEZpbGUgLXBhdGhUeXBlIExlYWYpICgkbXNncy5lcnJvcl9idWlsZF9maWxlX25vdF9mb3VuZCAtZiAkYnVpbGRGaWxlKQoKICAgICRwc2FrZS5idWlsZF9zY3JpcHRfZmlsZSA9IGdldC1pdGVtICRidWlsZEZpbGUKICAgICRwc2FrZS5idWlsZF9zY3JpcHRfZGlyID0gJHBzYWtlLmJ1aWxkX3NjcmlwdF9maWxlLkRpcmVjdG9yeU5hbWUKICAgICRwc2FrZS5idWlsZF9zdWNjZXNzID0gJGZhbHNlCgogICAgJHBzYWtlLmNvbnRleHQucHVzaChAewogICAgICAgICJ0YXNrU2V0dXBTY3JpcHRCbG9jayIgPSB7fTsKICAgICAgICAidGFza1RlYXJEb3duU2NyaXB0QmxvY2siID0ge307CiAgICAgICAgImV4ZWN1dGVkVGFza3MiID0gbmV3LW9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuU3RhY2s7CiAgICAgICAgImNhbGxTdGFjayIgPSBuZXctb2JqZWN0IFN5c3RlbS5Db2xsZWN0aW9ucy5TdGFjazsKICAgICAgICAib3JpZ2luYWxFbnZQYXRoIiA9ICRlbnY6cGF0aDsKICAgICAgICAib3JpZ2luYWxEaXJlY3RvcnkiID0gZ2V0LWxvY2F0aW9uOwogICAgICAgICJvcmlnaW5hbEVycm9yQWN0aW9uUHJlZmVyZW5jZSIgPSAkZ2xvYmFsOkVycm9yQWN0aW9uUHJlZmVyZW5jZTsKICAgICAgICAidGFza3MiID0gQHt9OwogICAgICAgICJhbGlhc2VzIiA9IEB7fTsKICAgICAgICAicHJvcGVydGllcyIgPSBAKCk7CiAgICAgICAgImluY2x1ZGVzIiA9IG5ldy1vYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLlF1ZXVlOwogICAgICAgICJjb25maWciID0gQ3JlYXRlQ29uZmlndXJhdGlvbkZvck5ld0NvbnRleHQgJGJ1aWxkRmlsZSAkZnJhbWV3b3JrCiAgICB9KQoKICAgIExvYWRDb25maWd1cmF0aW9uICRwc2FrZS5idWlsZF9zY3JpcHRfZGlyCgogICAgc2V0LWxvY2F0aW9uICRwc2FrZS5idWlsZF9zY3JpcHRfZGlyCgogICAgTG9hZE1vZHVsZXMKCiAgICAkZnJhbWV3b3JrT2xkVmFsdWUgPSAkZnJhbWV3b3JrCiAgICAuICRwc2FrZS5idWlsZF9zY3JpcHRfZmlsZS5GdWxsTmFtZQoKICAgICRjdXJyZW50Q29udGV4dCA9ICRwc2FrZS5jb250ZXh0LlBlZWsoKQoKICAgIGlmICgkZnJhbWV3b3JrIC1uZSAkZnJhbWV3b3JrT2xkVmFsdWUpIHsKICAgICAgICB3cml0ZWNvbG9yZWRvdXRwdXQgJG1zZ3Mud2FybmluZ19kZXByZWNhdGVkX2ZyYW1ld29ya192YXJpYWJsZSAtZm9yZWdyb3VuZGNvbG9yIFllbGxvdwogICAgICAgICRjdXJyZW50Q29udGV4dC5jb25maWcuZnJhbWV3b3JrID0gJGZyYW1ld29yawogICAgfQoKICAgIENvbmZpZ3VyZUJ1aWxkRW52aXJvbm1lbnQKCiAgICB3aGlsZSAoJGN1cnJlbnRDb250ZXh0LmluY2x1ZGVzLkNvdW50IC1ndCAwKSB7CiAgICAgICAgJGluY2x1ZGVGaWxlbmFtZSA9ICRjdXJyZW50Q29udGV4dC5pbmNsdWRlcy5EZXF1ZXVlKCkKICAgICAgICAuICRpbmNsdWRlRmlsZW5hbWUKICAgIH0KCiAgICAmICRzYiAkY3VycmVudENvbnRleHQgJG1vZHVsZQp9CgpmdW5jdGlvbiBDbGVhbnVwRW52aXJvbm1lbnQgewogICAgaWYgKCRwc2FrZS5jb250ZXh0LkNvdW50IC1ndCAwKSB7CiAgICAgICAgJGN1cnJlbnRDb250ZXh0ID0gJHBzYWtlLmNvbnRleHQuUGVlaygpCiAgICAgICAgJGVudjpwYXRoID0gJGN1cnJlbnRDb250ZXh0Lm9yaWdpbmFsRW52UGF0aAogICAgICAgIFNldC1Mb2NhdGlvbiAkY3VycmVudENvbnRleHQub3JpZ2luYWxEaXJlY3RvcnkKICAgICAgICAkZ2xvYmFsOkVycm9yQWN0aW9uUHJlZmVyZW5jZSA9ICRjdXJyZW50Q29udGV4dC5vcmlnaW5hbEVycm9yQWN0aW9uUHJlZmVyZW5jZQogICAgICAgIFt2b2lkXSAkcHNha2UuY29udGV4dC5Qb3AoKQogICAgfQp9CgpmdW5jdGlvbiBTZWxlY3RPYmplY3RXaXRoRGVmYXVsdAp7CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kdHJ1ZSldCiAgICAgICAgW1BTT2JqZWN0XQogICAgICAgICRJbnB1dE9iamVjdCwKICAgICAgICBbc3RyaW5nXQogICAgICAgICROYW1lLAogICAgICAgICRWYWx1ZQogICAgKQoKICAgIHByb2Nlc3MgewogICAgICAgIGlmICgkXyAtZXEgJG51bGwpIHsgJFZhbHVlIH0KICAgICAgICBlbHNlaWYgKCRfIHwgR2V0LU1lbWJlciAtTmFtZSAkTmFtZSkgewogICAgICAgICAgJF8uJE5hbWUKICAgICAgICB9CiAgICAgICAgZWxzZWlmICgoJF8gLWlzIFtIYXNodGFibGVdKSAtYW5kICgkXy5LZXlzIC1jb250YWlucyAkTmFtZSkpIHsKICAgICAgICAgICRfLiROYW1lCiAgICAgICAgfQogICAgICAgIGVsc2UgeyAkVmFsdWUgfQogICAgfQp9CgojIGJvcnJvd2VkIGZyb20gSmVmZnJleSBTbm92ZXIgaHR0cDovL2Jsb2dzLm1zZG4uY29tL3Bvd2Vyc2hlbGwvYXJjaGl2ZS8yMDA2LzEyLzA3L3Jlc29sdmUtZXJyb3IuYXNweAojIG1vZGlmaWVkIHRvIGJldHRlciBoYW5kbGUgU1FMIGVycm9ycwpmdW5jdGlvbiBSZXNvbHZlRXJyb3IKewogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmU9JHRydWUpXQogICAgICAgICRFcnJvclJlY29yZD0kRXJyb3JbMF0sCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkU2hvcnQKICAgICkKCiAgICBwcm9jZXNzIHsKICAgICAgICBpZiAoJF8gLWVxICRudWxsKSB7ICRfID0gJEVycm9yUmVjb3JkIH0KICAgICAgICAkZXggPSAkXy5FeGNlcHRpb24KCiAgICAgICAgaWYgKC1ub3QgJFNob3J0KSB7CiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gImBuRXJyb3JSZWNvcmQ6ezB9RXJyb3JSZWNvcmQuSW52b2NhdGlvbkluZm86ezF9RXhjZXB0aW9uOmBuezJ9IgogICAgICAgICAgICAkZm9ybWF0dGVkX2Vycm9yUmVjb3JkID0gJF8gfCBmb3JtYXQtbGlzdCAqIC1mb3JjZSB8IG91dC1zdHJpbmcKICAgICAgICAgICAgJGZvcm1hdHRlZF9pbnZvY2F0aW9uSW5mbyA9ICRfLkludm9jYXRpb25JbmZvIHwgZm9ybWF0LWxpc3QgKiAtZm9yY2UgfCBvdXQtc3RyaW5nCiAgICAgICAgICAgICRmb3JtYXR0ZWRfZXhjZXB0aW9uID0gJycKCiAgICAgICAgICAgICRpID0gMAogICAgICAgICAgICB3aGlsZSAoJGV4IC1uZSAkbnVsbCkgewogICAgICAgICAgICAgICAgJGkrKwogICAgICAgICAgICAgICAgJGZvcm1hdHRlZF9leGNlcHRpb24gKz0gKCIkaSIgKiA3MCkgKyAiYG4iICsKICAgICAgICAgICAgICAgICAgICAoJGV4IHwgZm9ybWF0LWxpc3QgKiAtZm9yY2UgfCBvdXQtc3RyaW5nKSArICJgbiIKICAgICAgICAgICAgICAgICRleCA9ICRleCB8IFNlbGVjdE9iamVjdFdpdGhEZWZhdWx0IC1OYW1lICdJbm5lckV4Y2VwdGlvbicgLVZhbHVlICRudWxsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAkZXJyb3JfbWVzc2FnZSAtZiAkZm9ybWF0dGVkX2Vycm9yUmVjb3JkLCAkZm9ybWF0dGVkX2ludm9jYXRpb25JbmZvLCAkZm9ybWF0dGVkX2V4Y2VwdGlvbgogICAgICAgIH0KCiAgICAgICAgJGxhc3RFeGNlcHRpb24gPSBAKCkKICAgICAgICB3aGlsZSAoJGV4IC1uZSAkbnVsbCkgewogICAgICAgICAgICAkbGFzdE1lc3NhZ2UgPSAkZXggfCBTZWxlY3RPYmplY3RXaXRoRGVmYXVsdCAtTmFtZSAnTWVzc2FnZScgLVZhbHVlICcnCiAgICAgICAgICAgICRsYXN0RXhjZXB0aW9uICs9ICgkbGFzdE1lc3NhZ2UgLXJlcGxhY2UgImBuIiwgJycpCiAgICAgICAgICAgIGlmICgkZXggLWlzIFtEYXRhLlNxbENsaWVudC5TcWxFeGNlcHRpb25dKSB7CiAgICAgICAgICAgICAgICAkbGFzdEV4Y2VwdGlvbiArPSAiKExpbmUgWyQoJGV4LkxpbmVOdW1iZXIpXSAiICsKICAgICAgICAgICAgICAgICAgICAiUHJvY2VkdXJlIFskKCRleC5Qcm9jZWR1cmUpXSBDbGFzcyBbJCgkZXguQ2xhc3MpXSAiICsKICAgICAgICAgICAgICAgICAgICAiIE51bWJlciBbJCgkZXguTnVtYmVyKV0gU3RhdGUgWyQoJGV4LlN0YXRlKV0gKSIKICAgICAgICAgICAgfQogICAgICAgICAgICAkZXggPSAkZXggfCBTZWxlY3RPYmplY3RXaXRoRGVmYXVsdCAtTmFtZSAnSW5uZXJFeGNlcHRpb24nIC1WYWx1ZSAkbnVsbAogICAgICAgIH0KICAgICAgICAkc2hvcnRFeGNlcHRpb24gPSAkbGFzdEV4Y2VwdGlvbiAtam9pbiAnIC0tPiAnCgogICAgICAgICRoZWFkZXIgPSAkbnVsbAogICAgICAgICRjdXJyZW50ID0gJF8KICAgICAgICAkaGVhZGVyID0gKCgkXy5JbnZvY2F0aW9uSW5mbyB8CiAgICAgICAgICAgIFNlbGVjdE9iamVjdFdpdGhEZWZhdWx0IC1OYW1lICdQb3NpdGlvbk1lc3NhZ2UnIC1WYWx1ZSAnJykgLXJlcGxhY2UgImBuIiwgJyAnKSwKICAgICAgICAgICAgKCRfIHwgU2VsZWN0T2JqZWN0V2l0aERlZmF1bHQgLU5hbWUgJ01lc3NhZ2UnIC1WYWx1ZSAnJyksCiAgICAgICAgICAgICgkXyB8IFNlbGVjdE9iamVjdFdpdGhEZWZhdWx0IC1OYW1lICdFeGNlcHRpb24nIC1WYWx1ZSAnJykgfAogICAgICAgICAgICAgICAgPyB7IC1ub3QgW1N0cmluZ106OklzTnVsbE9yRW1wdHkoJF8pIH0gfAogICAgICAgICAgICAgICAgU2VsZWN0IC1GaXJzdCAxCgogICAgICAgICRkZWxpbWl0ZXIgPSAnJwogICAgICAgIGlmICgoLW5vdCBbU3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkaGVhZGVyKSkgLWFuZAogICAgICAgICAgICAoLW5vdCBbU3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkc2hvcnRFeGNlcHRpb24pKSkKICAgICAgICAgICAgeyAkZGVsaW1pdGVyID0gJyBbPDw9PT4+XSAnIH0KCiAgICAgICAgcmV0dXJuICIkKCRoZWFkZXIpJCgkZGVsaW1pdGVyKUV4Y2VwdGlvbjogJCgkc2hvcnRFeGNlcHRpb24pIgogICAgfQp9CgpmdW5jdGlvbiBHZXRUYXNrc0Zyb21Db250ZXh0KCRjdXJyZW50Q29udGV4dCkgeyAgICAKCiAgICAkZG9jcyA9ICRjdXJyZW50Q29udGV4dC50YXNrcy5LZXlzIHwgZm9yZWFjaC1vYmplY3QgewoKICAgICAgICAkdGFzayA9ICRjdXJyZW50Q29udGV4dC50YXNrcy4kXwogICAgICAgIG5ldy1vYmplY3QgUFNPYmplY3QgLXByb3BlcnR5IEB7CiAgICAgICAgICAgIE5hbWUgPSAkdGFzay5OYW1lOwogICAgICAgICAgICBBbGlhcyA9ICR0YXNrLkFsaWFzOwogICAgICAgICAgICBEZXNjcmlwdGlvbiA9ICR0YXNrLkRlc2NyaXB0aW9uOwogICAgICAgICAgICBEZXBlbmRzT24gPSAkdGFzay5EZXBlbmRzT247CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAkZG9jcwp9CgpmdW5jdGlvbiBXcml0ZURvY3VtZW50YXRpb24oJHNob3dEZXRhaWxlZCkgewoKICAgICRjdXJyZW50Q29udGV4dCA9ICRwc2FrZS5jb250ZXh0LlBlZWsoKQoKICAgIGlmICgkY3VycmVudENvbnRleHQudGFza3MuZGVmYXVsdCkgewogICAgICAgICRkZWZhdWx0VGFza0RlcGVuZGVuY2llcyA9ICRjdXJyZW50Q29udGV4dC50YXNrcy5kZWZhdWx0LkRlcGVuZHNPbgogICAgfSBlbHNlIHsKICAgICAgICAkZGVmYXVsdFRhc2tEZXBlbmRlbmNpZXMgPSBAKCkKICAgIH0KICAgIAogICAgJGRvY3MgPSBHZXRUYXNrc0Zyb21Db250ZXh0ICRjdXJyZW50Q29udGV4dCB8IAogICAgICAgICAgICAgICAgV2hlcmUgICB7JF8uTmFtZSAtbmUgJ2RlZmF1bHQnfSB8IAogICAgICAgICAgICAgICAgRm9yRWFjaCB7CiAgICAgICAgICAgICAgICAgICAgJGlzRGVmYXVsdCA9ICRudWxsCiAgICAgICAgICAgICAgICAgICAgaWYgKCRkZWZhdWx0VGFza0RlcGVuZGVuY2llcyAtY29udGFpbnMgJF8uTmFtZSkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgJGlzRGVmYXVsdCA9ICR0cnVlIAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gQWRkLU1lbWJlciAtSW5wdXRPYmplY3QgJF8gJ0RlZmF1bHQnICRpc0RlZmF1bHQgLVBhc3NUaHJ1CiAgICAgICAgICAgICAgICB9CgogICAgaWYgKCRzaG93RGV0YWlsZWQpIHsKICAgICAgICAkZG9jcyB8IHNvcnQgJ05hbWUnIHwgZm9ybWF0LWxpc3QgLXByb3BlcnR5IE5hbWUsQWxpYXMsRGVzY3JpcHRpb24sQHtMYWJlbD0iRGVwZW5kcyBPbiI7RXhwcmVzc2lvbj17JF8uRGVwZW5kc09uIC1qb2luICcsICd9fSxEZWZhdWx0CiAgICB9IGVsc2UgewogICAgICAgICRkb2NzIHwgc29ydCAnTmFtZScgfCBmb3JtYXQtdGFibGUgLWF1dG9TaXplIC13cmFwIC1wcm9wZXJ0eSBOYW1lLEFsaWFzLEB7TGFiZWw9IkRlcGVuZHMgT24iO0V4cHJlc3Npb249eyRfLkRlcGVuZHNPbiAtam9pbiAnLCAnfX0sRGVmYXVsdCxEZXNjcmlwdGlvbgogICAgfQp9CgpmdW5jdGlvbiBXcml0ZVRhc2tUaW1lU3VtbWFyeSgkaW52b2tlUHNha2VEdXJhdGlvbikgewogICAgaWYgKCRwc2FrZS5jb250ZXh0LmNvdW50IC1ndCAwKSB7CiAgICAgICAgIi0iICogNzAKICAgICAgICAiQnVpbGQgVGltZSBSZXBvcnQiCiAgICAgICAgIi0iICogNzAKICAgICAgICAkbGlzdCA9IEAoKQogICAgICAgICRjdXJyZW50Q29udGV4dCA9ICRwc2FrZS5jb250ZXh0LlBlZWsoKQogICAgICAgIHdoaWxlICgkY3VycmVudENvbnRleHQuZXhlY3V0ZWRUYXNrcy5Db3VudCAtZ3QgMCkgewogICAgICAgICAgICAkdGFza0tleSA9ICRjdXJyZW50Q29udGV4dC5leGVjdXRlZFRhc2tzLlBvcCgpCiAgICAgICAgICAgICR0YXNrID0gJGN1cnJlbnRDb250ZXh0LnRhc2tzLiR0YXNrS2V5CiAgICAgICAgICAgIGlmICgkdGFza0tleSAtZXEgImRlZmF1bHQiKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICB9CiAgICAgICAgICAgICRsaXN0ICs9IG5ldy1vYmplY3QgUFNPYmplY3QgLXByb3BlcnR5IEB7CiAgICAgICAgICAgICAgICBOYW1lID0gJHRhc2suTmFtZTsKICAgICAgICAgICAgICAgIER1cmF0aW9uID0gJHRhc2suRHVyYXRpb24KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBbQXJyYXldOjpSZXZlcnNlKCRsaXN0KQogICAgICAgICRsaXN0ICs9IG5ldy1vYmplY3QgUFNPYmplY3QgLXByb3BlcnR5IEB7CiAgICAgICAgICAgIE5hbWUgPSAiVG90YWw6IjsKICAgICAgICAgICAgRHVyYXRpb24gPSAkaW52b2tlUHNha2VEdXJhdGlvbgogICAgICAgIH0KICAgICAgICAjIHVzaW5nICJvdXQtc3RyaW5nIHwgd2hlcmUtb2JqZWN0IiB0byBmaWx0ZXIgb3V0IHRoZSBibGFuayBsaW5lIHRoYXQgZm9ybWF0LXRhYmxlIHByZXBlbmRzCiAgICAgICAgJGxpc3QgfCBmb3JtYXQtdGFibGUgLWF1dG9TaXplIC1wcm9wZXJ0eSBOYW1lLER1cmF0aW9uIHwgb3V0LXN0cmluZyAtc3RyZWFtIHwgd2hlcmUtb2JqZWN0IHsgJF8gfQogICAgfQp9CgpEQVRBIG1zZ3Mgewpjb252ZXJ0ZnJvbS1zdHJpbmdkYXRhIEAnCiAgICBlcnJvcl9pbnZhbGlkX3Rhc2tfbmFtZSA9IFRhc2sgbmFtZSBzaG91bGQgbm90IGJlIG51bGwgb3IgZW1wdHkgc3RyaW5nLgogICAgZXJyb3JfdGFza19uYW1lX2RvZXNfbm90X2V4aXN0ID0gVGFzayB7MH0gZG9lcyBub3QgZXhpc3QuCiAgICBlcnJvcl9jaXJjdWxhcl9yZWZlcmVuY2UgPSBDaXJjdWxhciByZWZlcmVuY2UgZm91bmQgZm9yIHRhc2sgezB9LgogICAgZXJyb3JfbWlzc2luZ19hY3Rpb25fcGFyYW1ldGVyID0gQWN0aW9uIHBhcmFtZXRlciBtdXN0IGJlIHNwZWNpZmllZCB3aGVuIHVzaW5nIFByZUFjdGlvbiBvciBQb3N0QWN0aW9uIHBhcmFtZXRlcnMgZm9yIHRhc2sgezB9LgogICAgZXJyb3JfY29ycnVwdF9jYWxsc3RhY2sgPSBDYWxsIHN0YWNrIHdhcyBjb3JydXB0LiBFeHBlY3RlZCB7MH0sIGJ1dCBnb3QgezF9LgogICAgZXJyb3JfaW52YWxpZF9mcmFtZXdvcmsgPSBJbnZhbGlkIC5ORVQgRnJhbWV3b3JrIHZlcnNpb24sIHswfSBzcGVjaWZpZWQuCiAgICBlcnJvcl91bmtub3duX2ZyYW1ld29yayA9IFVua25vd24gLk5FVCBGcmFtZXdvcmsgdmVyc2lvbiwgezB9IHNwZWNpZmllZCBpbiB7MX0uCiAgICBlcnJvcl91bmtub3duX3BvaW50ZXJzaXplID0gVW5rbm93biBwb2ludGVyIHNpemUgKHswfSkgcmV0dXJuZWQgZnJvbSBTeXN0ZW0uSW50UHRyLgogICAgZXJyb3JfdW5rbm93bl9iaXRuZXNzcGFydCA9IFVua25vd24gLk5FVCBGcmFtZXdvcmsgYml0bmVzcywgezB9LCBzcGVjaWZpZWQgaW4gezF9LgogICAgZXJyb3Jfbm9fZnJhbWV3b3JrX2luc3RhbGxfZGlyX2ZvdW5kID0gTm8gLk5FVCBGcmFtZXdvcmsgaW5zdGFsbGF0aW9uIGRpcmVjdG9yeSBmb3VuZCBhdCB7MH0uCiAgICBlcnJvcl9iYWRfY29tbWFuZCA9IEVycm9yIGV4ZWN1dGluZyBjb21tYW5kIHswfS4KICAgIGVycm9yX2RlZmF1bHRfdGFza19jYW5ub3RfaGF2ZV9hY3Rpb24gPSAnZGVmYXVsdCcgdGFzayBjYW5ub3Qgc3BlY2lmeSBhbiBhY3Rpb24uCiAgICBlcnJvcl9kdXBsaWNhdGVfdGFza19uYW1lID0gVGFzayB7MH0gaGFzIGFscmVhZHkgYmVlbiBkZWZpbmVkLgogICAgZXJyb3JfZHVwbGljYXRlX2FsaWFzX25hbWUgPSBBbGlhcyB7MH0gaGFzIGFscmVhZHkgYmVlbiBkZWZpbmVkLgogICAgZXJyb3JfaW52YWxpZF9pbmNsdWRlX3BhdGggPSBVbmFibGUgdG8gaW5jbHVkZSB7MH0uIEZpbGUgbm90IGZvdW5kLgogICAgZXJyb3JfYnVpbGRfZmlsZV9ub3RfZm91bmQgPSBDb3VsZCBub3QgZmluZCB0aGUgYnVpbGQgZmlsZSB7MH0uCiAgICBlcnJvcl9ub19kZWZhdWx0X3Rhc2sgPSAnZGVmYXVsdCcgdGFzayByZXF1aXJlZC4KICAgIGVycm9yX2xvYWRpbmdfbW9kdWxlID0gRXJyb3IgbG9hZGluZyBtb2R1bGUgezB9LgogICAgd2FybmluZ19kZXByZWNhdGVkX2ZyYW1ld29ya192YXJpYWJsZSA9IFdhcm5pbmc6IFVzaW5nIGdsb2JhbCB2YXJpYWJsZSAkZnJhbWV3b3JrIHRvIHNldCAuTkVUIGZyYW1ld29yayB2ZXJzaW9uIHVzZWQgaXMgZGVwcmVjYXRlZC4gSW5zdGVhZCB1c2UgRnJhbWV3b3JrIGZ1bmN0aW9uIG9yIGNvbmZpZ3VyYXRpb24gZmlsZSBwc2FrZS1jb25maWcucHMxLgogICAgcmVxdWlyZWRfdmFyaWFibGVfbm90X3NldCA9IFZhcmlhYmxlIHswfSBtdXN0IGJlIHNldCB0byBydW4gdGFzayB7MX0uCiAgICBwb3N0Y29uZGl0aW9uX2ZhaWxlZCA9IFBvc3Rjb25kaXRpb24gZmFpbGVkIGZvciB0YXNrIHswfS4KICAgIHByZWNvbmRpdGlvbl93YXNfZmFsc2UgPSBQcmVjb25kaXRpb24gd2FzIGZhbHNlLCBub3QgZXhlY3V0aW5nIHRhc2sgezB9LgogICAgY29udGludWVfb25fZXJyb3IgPSBFcnJvciBpbiB0YXNrIHswfS4gezF9CiAgICBidWlsZF9zdWNjZXNzID0gQnVpbGQgU3VjY2VlZGVkIQonQAp9CgpJbXBvcnQtTG9jYWxpemVkRGF0YSAtQmluZGluZ1ZhcmlhYmxlIG1zZ3MgLUZpbGVOYW1lIG1lc3NhZ2VzLnBzZDEgLUVycm9yQWN0aW9uICRzY3JpcHQ6SWdub3JlRXJyb3IKCiRzY3JpcHREaXIgPSBTcGxpdC1QYXRoICRNeUludm9jYXRpb24uTXlDb21tYW5kLlBhdGgKJG1hbmlmZXN0UGF0aCA9IEpvaW4tUGF0aCAkc2NyaXB0RGlyIHBzYWtlLnBzZDEKJG1hbmlmZXN0ID0gVGVzdC1Nb2R1bGVNYW5pZmVzdCAtUGF0aCAkbWFuaWZlc3RQYXRoIC1XYXJuaW5nQWN0aW9uIFNpbGVudGx5Q29udGludWUKCiRzY3JpcHQ6cHNha2UgPSBAe30KCiRwc2FrZS52ZXJzaW9uID0gJG1hbmlmZXN0LlZlcnNpb24uVG9TdHJpbmcoKQokcHNha2UuY29udGV4dCA9IG5ldy1vYmplY3Qgc3lzdGVtLmNvbGxlY3Rpb25zLnN0YWNrICMgaG9sZHMgb250byB0aGUgY3VycmVudCBzdGF0ZSBvZiBhbGwgdmFyaWFibGVzCiRwc2FrZS5ydW5fYnlfcHNha2VfYnVpbGRfdGVzdGVyID0gJGZhbHNlICMgaW5kaWNhdGVzIHRoYXQgYnVpbGQgaXMgYmVpbmcgcnVuIGJ5IHBzYWtlLUJ1aWxkVGVzdGVyCiRwc2FrZS5jb25maWdfZGVmYXVsdCA9IG5ldy1vYmplY3QgcHNvYmplY3QgLXByb3BlcnR5IEB7CiAgICBidWlsZEZpbGVOYW1lID0gImRlZmF1bHQucHMxIjsKICAgIGZyYW1ld29yayA9ICI0LjAiOwogICAgdGFza05hbWVGb3JtYXQgPSAiRXhlY3V0aW5nIHswfSI7CiAgICB2ZXJib3NlRXJyb3IgPSAkZmFsc2U7CiAgICBjb2xvcmVkT3V0cHV0ID0gJHRydWU7CiAgICBtb2R1bGVzID0gJG51bGw7CiAgICBtb2R1bGVTY29wZSA9ICIiOwp9ICMgY29udGFpbnMgZGVmYXVsdCBjb25maWd1cmF0aW9uLCBjYW4gYmUgb3ZlcnJpZGVuIGluIHBzYWtlLWNvbmZpZy5wczEgaW4gZGlyZWN0b3J5IHdpdGggcHNha2UucHNtMSBvciBpbiBkaXJlY3Rvcnkgd2l0aCBjdXJyZW50IGJ1aWxkIHNjcmlwdAoKJHBzYWtlLmJ1aWxkX3N1Y2Nlc3MgPSAkZmFsc2UgIyBpbmRpY2F0ZXMgdGhhdCB0aGUgY3VycmVudCBidWlsZCB3YXMgc3VjY2Vzc2Z1bAokcHNha2UuYnVpbGRfc2NyaXB0X2ZpbGUgPSAkbnVsbCAjIGNvbnRhaW5zIGEgU3lzdGVtLklPLkZpbGVJbmZvIGZvciB0aGUgY3VycmVudCBidWlsZCBzY3JpcHQKJHBzYWtlLmJ1aWxkX3NjcmlwdF9kaXIgPSAiIiAjIGNvbnRhaW5zIGEgc3RyaW5nIHdpdGggZnVsbHktcXVhbGlmaWVkIHBhdGggdG8gY3VycmVudCBidWlsZCBzY3JpcHQKCkxvYWRDb25maWd1cmF0aW9uCgpleHBvcnQtbW9kdWxlbWVtYmVyIC1mdW5jdGlvbiBJbnZva2UtcHNha2UsIEludm9rZS1UYXNrLCBHZXQtUFNha2VTY3JpcHRUYXNrcywgVGFzaywgUHJvcGVydGllcywgSW5jbHVkZSwgRm9ybWF0VGFza05hbWUsIFRhc2tTZXR1cCwgVGFza1RlYXJEb3duLCBGcmFtZXdvcmssIEFzc2VydCwgRXhlYyAtdmFyaWFibGUgcHNha2UK
