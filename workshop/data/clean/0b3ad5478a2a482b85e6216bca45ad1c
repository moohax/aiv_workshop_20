Invoke-SessionGopher.ps1,5f23986d98ef7c93ac903a2c1b833aef,Scan result is 1. IsMalware: 0,PCMKICAuU1lOUE9TSVMKICBFeHRyYWN0cyBhbmQgZGVjcnlwdHMgc2F2ZWQgc2Vzc2lvbiBpbmZvcm1hdGlvbiBmb3Igc29mdHdhcmUgdHlwaWNhbGx5IHVzZWQgdG8gYWNjZXNzIFVuaXggc3lzdGVtcy4KCiAgLkRFU0NSSVBUSU9OCiAgUXVlcmllcyBIS0VZX1VTRVJTIGZvciBQdVRUWSwgV2luU0NQLCBhbmQgUmVtb3RlIERlc2t0b3Agc2F2ZWQgc2Vzc2lvbnMuIERlY3J5cHRzIHNhdmVkIHBhc3N3b3JkcyBmb3IgV2luU0NQLgogIEV4dHJhY3RzIEZpbGVaaWxsYSwgU3VwZXJQdVRUWSdzIHNhdmVkIHNlc3Npb24gaW5mb3JtYXRpb24gaW4gdGhlIHNpdGVtYW5hZ2VyLnhtbCBmaWxlIGFuZCBkZWNvZGVzIHNhdmVkIHBhc3N3b3Jkcy4KICBJbiBUaG9yb3VnaCBtb2RlLCBpZGVudGlmaWVzIFB1VFRZIHByaXZhdGUga2V5ICgucHBrKSwgUmVtb3RlIERlc2t0b3AgQ29ubmVjdGlvbiAoLnJkcCksIGFuZCBSU0EgdG9rZW4gKC5zZHRpZCkgZmlsZXMsIGFuZCBleHRyYWN0cyBwcml2YXRlIGtleSBhbmQgc2Vzc2lvbiBpbmZvcm1hdGlvbi4KICBDYW4gYmUgcnVuIHJlbW90ZWx5IHVzaW5nIHRoZSAtaUwgKHN1cHBseSBpbnB1dCBsaXN0IG9mIGNvbXB1dGVycykgb3IgLUFsbERvbWFpbiAocnVuIGFnYWluc3QgYWxsIEFELWpvaW5lZCBjb21wdXRlcnMpIGZsYWdzLgogIE11c3QgZWl0aGVyIHByb3ZpZGUgY3JlZGVudGlhbHMgKC11IGFuZCAtcCBmb3IgdXNlcm5hbWUgYW5kIHBhc3N3b3JkKSBvZiBhbiBhZG1pbiBvbiB0YXJnZXQgYm94ZXMsIG9yIHJ1biBzY3JpcHQgaW4gdGhlIGNvbnRleHQgb2YKICBhIHByaXZpbGVnZWQgdXNlciBvbiB0aGUgdGFyZ2V0IGJveGVzLCBpbiB3aGljaCBjYXNlIG5vIGNyZWRlbnRpYWxzIGFyZSBuZWVkZWQuCgogIC5Ob3RlcwogIEF1dGhvcjogQnJhbmRvbiBBcnZhbmFnaGkKICBUaGFua3M6IAogICAgQnJpY2UgRGFuaWVscywgUGFuIENoYW4gLSBjb2xsYWJvcmF0aW5nIG9uIGlkZWEKICAgIENocmlzdG9waGVyIFRydW5jZXIgLSBoZWxwaW5nIHdpdGggV01JCgogIC5QQVJBTUVURVIgbwogIEdlbmVyYXRlcyBDU1Ygb3V0cHV0LgogICAgCiAgLlBBUkFNRVRFUiBUaG9yb3VnaAogIFNlYXJjaGVzIGVudGlyZSBmaWxlc3lzdGVtIGZvciBjZXJ0YWluIGZpbGUgZXh0ZW5zaW9ucy4KCiAgLlBBUkFNRVRFUiB1CiAgRG9tYWluXHVzZXJuYW1lIChlLmcuIHN1cGVyZHVwZXIuY29tXGEtamVycnkpLgoKICAuUEFSQU1FVEVSIHAKICBQYXNzd29yZCBmb3IgZG9tYWluIHVzZXIgKGlmIHVzZXJuYW1lIHByb3ZpZGVkKS4KICAgIAogIC5QQVJBTUVURVIgaUwKICBJZiB5b3Ugd2FudCB0byBzdXBwbHkgYSBsaXN0IG9mIGhvc3RzIHRvIHJ1biBTZXNzaW9uR29waGVyIGFnYWluc3QsIHByb3ZpZGUgdGhlIHBhdGggdG8gdGhhdCBmaWxlIGhlcmUuIEVhY2ggaG9zdCBzaG91bGQgYmUgc2VwYXJhdGVkIGJ5IGEgbmV3bGluZSBpbiB0aGUgZmlsZS4KCiAgLlBBUkFNRVRFUiBUYXJnZXQKICBJZiB5b3Ugb25seSB3YW50IHRvIHJ1biBTZXNzaW9uR29waGVyIGFnYWluc3Qgb25jZSBzcGVjaWZpYyBob3N0LgogICAgCiAgLlBBUkFNRVRFUiBBbGxEb21haW4KICBRdWVyaWVzIEFjdGl2ZSBEaXJlY290cnkgZm9yIGEgbGlzdCBvZiBhbGwgZG9tYWluLWpvaW5lZCBjb21wdXRlcnMgYW5kIHJ1bnMgU2Vzc2lvbkdvcGhlciBhZ2FpbnN0IGFsbCBvZiB0aGVtLgojPgpmdW5jdGlvbiBJbnZva2UtU2Vzc2lvbkdvcGhlciB7CiAgcGFyYW0gKAogICAgICBbc3dpdGNoXSRvLCAjIEdlbmVyYXRlIENTViBvdXRwdXQKICAgICAgW3N3aXRjaF0kVGhvcm91Z2gsICMgU2VhcmNoZXMgZW50aXJlIGZpbGVzeXN0ZW0gZm9yIGNlcnRhaW4gZmlsZSBleHRlbnNpb25zCiAgICAgIFtzdHJpbmddJHUsICMgRG9tYWluXHVzZXJuYW1lIChlLmcuIHN1cGVyZHVwZXIuY29tXGEtamVycnkpCiAgICAgIFtzdHJpbmddJHAsICMgUGFzc3dvcmQgb2YgZG9tYWluIGFjY291bnQKICAgICAgW3N0cmluZ10kaUwsICMgQSBmaWxlIG9mIGhvc3RzIHRvIHJ1biBTZXNzaW9uR29waGVyIGFnYWluc3QgcmVtb3RlbHksIGVhY2ggaG9zdCBzZXBhcmF0ZWQgYnkgYSBuZXdsaW5lIGluIHRoZSBmaWxlCiAgICAgIFtzdHJpbmddJFRhcmdldCwgIyBJZiB5b3Ugd2FudCB0byBydW4gU2Vzc2lvbkdvcGhlciBhZ2FpbnN0IG9uZSBzcGVjaWZpYyBob3N0CiAgICAgIFtzd2l0Y2hdJEFsbERvbWFpbiAjIFJ1biBhY3Jvc3MgYWxsIGFjdGl2ZSBkaXJlY3RvcnkKICApCgogIFdyaXRlLU91dHB1dCAnCiAgICAgICAgICBvXyAgICAgICAKICAgICAgICAgLyAgIi4gICBTZXNzaW9uR29waGVyIC0gUkRQLCBXaW5TQ1AsIEZpbGVaaWxsYSwgUHVUVFksIFN1cGVyUHVUVFksIAogICAgICAgLCIgIF8tIiAgICAgIC5zZHRpZCwgLnJkcCwgLnBwayBzYXZlZCBzZXNzaW9uICYgcGFzc3dvcmQgZXh0cmFjdG9yCiAgICAgLCIgICBtIG0gICAgICAgICAKICAuLisgICAgICkgICAgICBCcmFuZG9uIEFydmFuYWdoaQogICAgIGBtLi5tICAgICAgIFR3aXR0ZXI6IEBhcnZhbmFnaGkgfCBhcnZhbmFnaGkuY29tCiAgJwoKICBpZiAoJG8pIHsKICAgICRPdXRwdXREaXJlY3RvcnkgPSAiU2Vzc2lvbkdvcGhlciAoIiArIChHZXQtRGF0ZSAtRm9ybWF0ICJISC5tbS5zcyIpICsgIikiCiAgICBOZXctSXRlbSAtSXRlbVR5cGUgRGlyZWN0b3J5ICRPdXRwdXREaXJlY3RvcnkgfCBPdXQtTnVsbAogICAgTmV3LUl0ZW0gKCRPdXRwdXREaXJlY3RvcnkgKyAiXFB1VFRZLmNzdiIpIC1UeXBlIEZpbGUgfCBPdXQtTnVsbAogICAgTmV3LUl0ZW0gKCRPdXRwdXREaXJlY3RvcnkgKyAiXFN1cGVyUHVUVFkuY3N2IikgLVR5cGUgRmlsZSB8IE91dC1OdWxsCiAgICBOZXctSXRlbSAoJE91dHB1dERpcmVjdG9yeSArICJcV2luU0NQLmNzdiIpIC1UeXBlIEZpbGUgfCBPdXQtTnVsbAogICAgTmV3LUl0ZW0gKCRPdXRwdXREaXJlY3RvcnkgKyAiXEZpbGVaaWxsYS5jc3YiKSAtVHlwZSBGaWxlIHwgT3V0LU51bGwKICAgIE5ldy1JdGVtICgkT3V0cHV0RGlyZWN0b3J5ICsgIlxSRFAuY3N2IikgLVR5cGUgRmlsZSB8IE91dC1OdWxsCiAgICBpZiAoJFRob3JvdWdoKSB7CiAgICAgICAgTmV3LUl0ZW0gKCRPdXRwdXREaXJlY3RvcnkgKyAiXFB1VFRZIHBwayBGaWxlcy5jc3YiKSAtVHlwZSBGaWxlIHwgT3V0LU51bGwKICAgICAgICBOZXctSXRlbSAoJE91dHB1dERpcmVjdG9yeSArICJcTWljcm9zb2Z0IHJkcCBGaWxlcy5jc3YiKSAtVHlwZSBGaWxlIHwgT3V0LU51bGwKICAgICAgICBOZXctSXRlbSAoJE91dHB1dERpcmVjdG9yeSArICJcUlNBIHNkdGlkIEZpbGVzLmNzdiIpIC1UeXBlIEZpbGUgfCBPdXQtTnVsbAogICAgfQogIH0KCiAgaWYgKCR1IC1hbmQgJHApIHsKICAgICRQYXNzd29yZCA9IENvbnZlcnRUby1TZWN1cmVTdHJpbmcgJHAgLUFzUGxhaW5UZXh0IC1Gb3JjZQogICAgJENyZWRlbnRpYWxzID0gTmV3LU9iamVjdCAtVHlwZW5hbWUgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWwgLUFyZ3VtZW50TGlzdCAkdSwgJFBhc3N3b3JkCiAgfQoKICAjIFZhbHVlIGZvciBIS0VZX1VTRVJTIGhpdmUKICAkSEtVID0gMjE0NzQ4MzY1MQogICMgVmFsdWUgZm9yIEhLRVlfTE9DQUxfTUFDSElORSBoaXZlCiAgJEhLTE0gPSAyMTQ3NDgzNjUwCgogICRQdVRUWVBhdGhFbmRpbmcgPSAiXFNPRlRXQVJFXFNpbW9uVGF0aGFtXFB1VFRZXFNlc3Npb25zIgogICRXaW5TQ1BQYXRoRW5kaW5nID0gIlxTT0ZUV0FSRVxNYXJ0aW4gUHJpa3J5bFxXaW5TQ1AgMlxTZXNzaW9ucyIKICAkUkRQUGF0aEVuZGluZyA9ICJcU09GVFdBUkVcTWljcm9zb2Z0XFRlcm1pbmFsIFNlcnZlciBDbGllbnRcU2VydmVycyIKCiAgaWYgKCRpTCAtb3IgJEFsbERvbWFpbiAtb3IgJFRhcmdldCkgewoKICAgICMgV2hldGhlciB3ZSByZWFkIGZyb20gYW4gaW5wdXQgZmlsZSBvciBxdWVyeSBhY3RpdmUgZGlyZWN0b3J5CiAgICAkUmVhZGVyID0gIiIKCiAgICBpZiAoJEFsbERvbWFpbikgewogICAgICAkUmVhZGVyID0gR2V0Q29tcHV0ZXJzRnJvbUFjdGl2ZURpcmVjdG9yeQogICAgfSBlbHNlaWYgKCRpTCkgeyAKICAgICAgJFJlYWRlciA9IEdldC1Db250ZW50ICgoUmVzb2x2ZS1QYXRoICRpTCkuUGF0aCkKICAgIH0gZWxzZWlmICgkVGFyZ2V0KSB7CiAgICAgICRSZWFkZXIgPSAkVGFyZ2V0CiAgICB9CgogICAgJG9wdGlvbmFsQ3JlZHMgPSBAe30KICAgIGlmICgkQ3JlZGVudGlhbHMpIHsKICAgICAgJG9wdGlvbmFsQ3JlZHNbJ0NyZWRlbnRpYWwnXSA9ICRDcmVkZW50aWFscwogICAgfQoKICAgIGZvcmVhY2ggKCRSZW1vdGVDb21wdXRlciBpbiAkUmVhZGVyKSB7CgogICAgICBpZiAoJEFsbERvbWFpbikgewogICAgICAgICMgRXh0cmFjdCBqdXN0IHRoZSBuYW1lIGZyb20gdGhlIFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5TZWFyY2hSZXN1bHQgb2JqZWN0CiAgICAgICAgJFJlbW90ZUNvbXB1dGVyID0gJFJlbW90ZUNvbXB1dGVyLlByb3BlcnRpZXMubmFtZQoJaWYgKCEkUmVtb3RlQ29tcHV0ZXIpIHsgQ29udGludWUgfQogICAgICB9CgogICAgICBXcml0ZS1PdXRwdXQgIlsrXSBEaWdnaW5nIG9uICRSZW1vdGVDb21wdXRlci4uLiIKCiAgICAgICRTSURTID0gSW52b2tlLVdtaU1ldGhvZCAtQ2xhc3MgJ1N0ZFJlZ1Byb3YnIC1OYW1lICdFbnVtS2V5JyAtQXJndW1lbnRMaXN0ICRIS1UsJycgLUNvbXB1dGVyTmFtZSAkUmVtb3RlQ29tcHV0ZXIgQG9wdGlvbmFsQ3JlZHMgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBzTmFtZXMgfCBXaGVyZS1PYmplY3QgeyRfIC1tYXRjaCAnUy0xLTUtMjEtW1xkXC1dKyQnfQoKICAgICAgZm9yZWFjaCAoJFNJRCBpbiAkU0lEcykgewoKICAgICAgICAjIEdldCB0aGUgdXNlcm5hbWUgZm9yIFNJRCB3ZSBkaXNjb3ZlcmVkIGhhcyBzYXZlZCBzZXNzaW9ucwogICAgICAgICRNYXBwZWRVc2VyTmFtZSA9IHRyeSB7IChTcGxpdC1QYXRoIC1MZWFmIChTcGxpdC1QYXRoIC1MZWFmIChHZXRNYXBwZWRTSUQpKSkgfSBjYXRjaCB7fQogICAgICAgICRTb3VyY2UgPSAoKCRSZW1vdGVDb21wdXRlciArICJcIiArICRNYXBwZWRVc2VyTmFtZSkgLUpvaW4gIiIpCgogICAgICAgICMgQ3JlYXRlZCBmb3IgZWFjaCB1c2VyIGZvdW5kLiBDb250YWlucyBhbGwgc2Vzc2lvbnMgaW5mb3JtYXRpb24gZm9yIHRoYXQgdXNlci4gCiAgICAgICAgJFVzZXJPYmplY3QgPSBOZXctT2JqZWN0IFBTT2JqZWN0CgogICAgICAgIDwjCiAgICAgICAgUHVUVFk6IGNvbnRhaW5zIGhvc3RuYW1lIGFuZCB1c2VybmFtZXMKICAgICAgICBTdXBlclB1VFRZOiBjb250YWlucyB1c2VybmFtZSwgaG9zdG5hbWUsIHJlbGV2YW50IHByb3RvY29sIGluZm9ybWF0aW9uLCBkZWNyeXB0ZWQgcGFzc3dvcmRzIGlmIHN0b3JlZAogICAgICAgIFJEUDogY29udGFpbnMgaG9zdG5hbWUgYW5kIHVzZXJuYW1lIG9mIHNlc3Npb25zCiAgICAgICAgRmlsZVppbGxhOiBob3N0bmFtZSwgdXNlcm5hbWUsIHJlbGV2YW50IHByb3RvY29sIGluZm9ybWF0aW9uLCBkZWNvZGVkIHBhc3N3b3JkcyBpZiBzdG9yZWQKICAgICAgICBXaW5TQ1A6IGNvbnRhaW5zIGhvc3RuYW1lLCB1c2VybmFtZSwgcHJvdG9jb2wsIGRlb2JmdXNjYXRlZCBwYXNzd29yZCBpZiBzdG9yZWQgYW5kIG5vIG1hc3RlciBwYXNzd29yZCB1c2VkCiAgICAgICAgIz4KICAgICAgICAkQXJyYXlPZlB1VFRZU2Vzc2lvbnMgPSBOZXctT2JqZWN0IFN5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3QKICAgICAgICAkQXJyYXlPZlN1cGVyUHVUVFlTZXNzaW9ucyA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAogICAgICAgICRBcnJheU9mUkRQU2Vzc2lvbnMgPSBOZXctT2JqZWN0IFN5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3QKICAgICAgICAkQXJyYXlPZkZpbGVaaWxsYVNlc3Npb25zID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0CiAgICAgICAgJEFycmF5T2ZXaW5TQ1BTZXNzaW9ucyA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAoKICAgICAgICAjIENvbnN0cnVjdCB0b29sIHJlZ2lzdHJ5L2ZpbGVzeXN0ZW0gcGF0aHMgZnJvbSBTSUQgb3IgdXNlcm5hbWUKICAgICAgICAkUkRQUGF0aCA9ICRTSUQgKyAkUkRQUGF0aEVuZGluZwogICAgICAgICRQdVRUWVBhdGggPSAkU0lEICsgJFB1VFRZUGF0aEVuZGluZwogICAgICAgICRXaW5TQ1BQYXRoID0gJFNJRCArICRXaW5TQ1BQYXRoRW5kaW5nCiAgICAgICAgJFN1cGVyUHVUVFlGaWx0ZXIgPSAiRHJpdmU9J0M6JyBBTkQgUGF0aD0nXFxVc2Vyc1xcJE1hcHBlZFVzZXJOYW1lXFxEb2N1bWVudHNcXFN1cGVyUHVUVFlcXCcgQU5EIEZpbGVOYW1lPSdTZXNzaW9ucycgQU5EIEV4dGVuc2lvbj0nWE1MJyIKICAgICAgICAkRmlsZVppbGxhRmlsdGVyID0gIkRyaXZlPSdDOicgQU5EIFBhdGg9J1xcVXNlcnNcXCRNYXBwZWRVc2VyTmFtZVxcQXBwRGF0YVxcUm9hbWluZ1xcRmlsZVppbGxhXFwnIEFORCBGaWxlTmFtZT0nc2l0ZW1hbmFnZXInIEFORCBFeHRlbnNpb249J1hNTCciCgogICAgICAgICRSRFBTZXNzaW9ucyA9IEludm9rZS1XbWlNZXRob2QgLUNvbXB1dGVyTmFtZSAkUmVtb3RlQ29tcHV0ZXIgLUNsYXNzICdTdGRSZWdQcm92JyAtTmFtZSBFbnVtS2V5IC1Bcmd1bWVudExpc3QgJEhLVSwkUkRQUGF0aCBAb3B0aW9uYWxDcmVkcwogICAgICAgICRQdVRUWVNlc3Npb25zID0gSW52b2tlLVdtaU1ldGhvZCAtQ29tcHV0ZXJOYW1lICRSZW1vdGVDb21wdXRlciAtQ2xhc3MgJ1N0ZFJlZ1Byb3YnIC1OYW1lIEVudW1LZXkgLUFyZ3VtZW50TGlzdCAkSEtVLCRQdVRUWVBhdGggQG9wdGlvbmFsQ3JlZHMKICAgICAgICAkV2luU0NQU2Vzc2lvbnMgPSBJbnZva2UtV21pTWV0aG9kIC1Db21wdXRlck5hbWUgJFJlbW90ZUNvbXB1dGVyIC1DbGFzcyAnU3RkUmVnUHJvdicgLU5hbWUgRW51bUtleSAtQXJndW1lbnRMaXN0ICRIS1UsJFdpblNDUFBhdGggQG9wdGlvbmFsQ3JlZHMKICAgICAgICAkU3VwZXJQdVRUWVBhdGggPSAoR2V0LVdtaU9iamVjdCAtQ2xhc3MgJ0NJTV9EYXRhRmlsZScgLUZpbHRlciAkU3VwZXJQdVRUWUZpbHRlciAtQ29tcHV0ZXJOYW1lICRSZW1vdGVDb21wdXRlciBAb3B0aW9uYWxDcmVkcyB8IFNlbGVjdCBOYW1lKQogICAgICAgICRGaWxlWmlsbGFQYXRoID0gKEdldC1XbWlPYmplY3QgLUNsYXNzICdDSU1fRGF0YUZpbGUnIC1GaWx0ZXIgJEZpbGVaaWxsYUZpbHRlciAtQ29tcHV0ZXJOYW1lICRSZW1vdGVDb21wdXRlciBAb3B0aW9uYWxDcmVkcyB8IFNlbGVjdCBOYW1lKQoKICAgICAgICAjIElmIGFueSBXaW5TQ1Agc2F2ZWQgc2Vzc2lvbnMgZXhpc3Qgb24gdGhpcyBib3guLi4KICAgICAgICBpZiAoKCRXaW5TQ1BTZXNzaW9ucyB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnQgUmV0dXJuVmFsdWUpIC1lcSAwKSB7CgogICAgICAgICAgIyBHZXQgYWxsIHNlc3Npb25zCiAgICAgICAgICAkV2luU0NQU2Vzc2lvbnMgPSAkV2luU0NQU2Vzc2lvbnMgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBzTmFtZXMKICAgICAgICAgIAogICAgICAgICAgZm9yZWFjaCAoJFdpblNDUFNlc3Npb24gaW4gJFdpblNDUFNlc3Npb25zKSB7CiAgICAgIAogICAgICAgICAgICAkV2luU0NQU2Vzc2lvbk9iamVjdCA9ICIiIHwgU2VsZWN0LU9iamVjdCAtUHJvcGVydHkgU291cmNlLFNlc3Npb24sSG9zdG5hbWUsVXNlcm5hbWUsUGFzc3dvcmQKICAgICAgICAgICAgJFdpblNDUFNlc3Npb25PYmplY3QuU291cmNlID0gJFNvdXJjZQogICAgICAgICAgICAkV2luU0NQU2Vzc2lvbk9iamVjdC5TZXNzaW9uID0gJFdpblNDUFNlc3Npb24KCiAgICAgICAgICAgICRMb2NhdGlvbiA9ICRXaW5TQ1BQYXRoICsgIlwiICsgJFdpblNDUFNlc3Npb24KCiAgICAgICAgICAgICRXaW5TQ1BTZXNzaW9uT2JqZWN0Lkhvc3RuYW1lID0gKEludm9rZS1XbWlNZXRob2QgLUNvbXB1dGVyTmFtZSAkUmVtb3RlQ29tcHV0ZXIgLUNsYXNzICdTdGRSZWdQcm92JyAtTmFtZSBHZXRTdHJpbmdWYWx1ZSAtQXJndW1lbnRMaXN0ICRIS1UsJExvY2F0aW9uLCJIb3N0TmFtZSIgQG9wdGlvbmFsQ3JlZHMpLnNWYWx1ZQogICAgICAgICAgICAkV2luU0NQU2Vzc2lvbk9iamVjdC5Vc2VybmFtZSA9IChJbnZva2UtV21pTWV0aG9kIC1Db21wdXRlck5hbWUgJFJlbW90ZUNvbXB1dGVyIC1DbGFzcyAnU3RkUmVnUHJvdicgLU5hbWUgR2V0U3RyaW5nVmFsdWUgLUFyZ3VtZW50TGlzdCAkSEtVLCRMb2NhdGlvbiwiVXNlck5hbWUiIEBvcHRpb25hbENyZWRzKS5zVmFsdWUKICAgICAgICAgICAgJFdpblNDUFNlc3Npb25PYmplY3QuUGFzc3dvcmQgPSAoSW52b2tlLVdtaU1ldGhvZCAtQ29tcHV0ZXJOYW1lICRSZW1vdGVDb21wdXRlciAtQ2xhc3MgJ1N0ZFJlZ1Byb3YnIC1OYW1lIEdldFN0cmluZ1ZhbHVlIC1Bcmd1bWVudExpc3QgJEhLVSwkTG9jYXRpb24sIlBhc3N3b3JkIiBAb3B0aW9uYWxDcmVkcykuc1ZhbHVlCgogICAgICAgICAgICBpZiAoJFdpblNDUFNlc3Npb25PYmplY3QuUGFzc3dvcmQpIHsKCiAgICAgICAgICAgICAgJE1hc3RlclBhc3NQYXRoID0gJFNJRCArICJcU29mdHdhcmVcTWFydGluIFByaWtyeWxcV2luU0NQIDJcQ29uZmlndXJhdGlvblxTZWN1cml0eSIKICAgICAgICAgIAogICAgICAgICAgICAgICRNYXN0ZXJQYXNzVXNlZCA9IChJbnZva2UtV21pTWV0aG9kIC1Db21wdXRlck5hbWUgJFJlbW90ZUNvbXB1dGVyIC1DbGFzcyAnU3RkUmVnUHJvdicgLU5hbWUgR2V0RFdvcmRWYWx1ZSAtQXJndW1lbnRMaXN0ICRIS1UsJE1hc3RlclBhc3NQYXRoLCJVc2VNYXN0ZXJQYXNzd29yZCIgQG9wdGlvbmFsQ3JlZHMpLnVWYWx1ZQogICAgICAgICAgICAgIAogICAgICAgICAgICAgIGlmICghJE1hc3RlclBhc3NVc2VkKSB7CiAgICAgICAgICAgICAgICAgICRXaW5TQ1BTZXNzaW9uT2JqZWN0LlBhc3N3b3JkID0gKERlY3J5cHRXaW5TQ1BQYXNzd29yZCAkV2luU0NQU2Vzc2lvbk9iamVjdC5Ib3N0bmFtZSAkV2luU0NQU2Vzc2lvbk9iamVjdC5Vc2VybmFtZSAkV2luU0NQU2Vzc2lvbk9iamVjdC5QYXNzd29yZCkKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAkV2luU0NQU2Vzc2lvbk9iamVjdC5QYXNzd29yZCA9ICJTYXZlZCBpbiBzZXNzaW9uLCBidXQgbWFzdGVyIHBhc3N3b3JkIHByZXZlbnRzIHBsYWludGV4dCByZWNvdmVyeSIKICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgICAgICAKICAgICAgICAgICAgW3ZvaWRdJEFycmF5T2ZXaW5TQ1BTZXNzaW9ucy5BZGQoJFdpblNDUFNlc3Npb25PYmplY3QpCiAgICAgIAogICAgICAgICAgfSAjIEZvciBFYWNoIFdpblNDUCBTZXNzaW9uCgogICAgICAgICAgaWYgKCRBcnJheU9mV2luU0NQU2Vzc2lvbnMuY291bnQgLWd0IDApIHsKCiAgICAgICAgICAgICRVc2VyT2JqZWN0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgIldpblNDUCBTZXNzaW9ucyIgLVZhbHVlICRBcnJheU9mV2luU0NQU2Vzc2lvbnMKCiAgICAgICAgICAgIGlmICgkbykgewogICAgICAgICAgICAgICRBcnJheU9mV2luU0NQU2Vzc2lvbnMgfCBTZWxlY3QtT2JqZWN0ICogfCBFeHBvcnQtQ1NWIC1BcHBlbmQgLVBhdGggKCRPdXRwdXREaXJlY3RvcnkgKyAiXFdpblNDUC5jc3YiKSAtTm9UeXBlSW5mb3JtYXRpb24KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBXcml0ZS1PdXRwdXQgIldpblNDUCBTZXNzaW9ucyIKICAgICAgICAgICAgICAkQXJyYXlPZldpblNDUFNlc3Npb25zIHwgU2VsZWN0LU9iamVjdCAqIHwgRm9ybWF0LUxpc3QgfCBPdXQtU3RyaW5nCiAgICAgICAgICAgIH0KCiAgICAgICAgICB9CiAgICAgICAgCiAgICAgICAgfSAjIElmIHBhdGggdG8gV2luU0NQIGV4aXN0cwoKICAgICAgICBpZiAoKCRQdVRUWVNlc3Npb25zIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydCBSZXR1cm5WYWx1ZSkgLWVxIDApIHsKCiAgICAgICAgICAjIEdldCBhbGwgc2Vzc2lvbnMKICAgICAgICAgICRQdVRUWVNlc3Npb25zID0gJFB1VFRZU2Vzc2lvbnMgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBzTmFtZXMKCiAgICAgICAgICBmb3JlYWNoICgkUHVUVFlTZXNzaW9uIGluICRQdVRUWVNlc3Npb25zKSB7CiAgICAgIAogICAgICAgICAgICAkUHVUVFlTZXNzaW9uT2JqZWN0ID0gIiIgfCBTZWxlY3QtT2JqZWN0IC1Qcm9wZXJ0eSBTb3VyY2UsU2Vzc2lvbixIb3N0bmFtZQoKICAgICAgICAgICAgJExvY2F0aW9uID0gJFB1VFRZUGF0aCArICJcIiArICRQdVRUWVNlc3Npb24KCiAgICAgICAgICAgICRQdVRUWVNlc3Npb25PYmplY3QuU291cmNlID0gJFNvdXJjZQogICAgICAgICAgICAkUHVUVFlTZXNzaW9uT2JqZWN0LlNlc3Npb24gPSAkUHVUVFlTZXNzaW9uCiAgICAgICAgICAgICRQdVRUWVNlc3Npb25PYmplY3QuSG9zdG5hbWUgPSAoSW52b2tlLVdtaU1ldGhvZCAtQ29tcHV0ZXJOYW1lICRSZW1vdGVDb21wdXRlciAtQ2xhc3MgJ1N0ZFJlZ1Byb3YnIC1OYW1lIEdldFN0cmluZ1ZhbHVlIC1Bcmd1bWVudExpc3QgJEhLVSwkTG9jYXRpb24sIkhvc3ROYW1lIiBAb3B0aW9uYWxDcmVkcykuc1ZhbHVlCiAgICAgICAgICAgICAKICAgICAgICAgICAgW3ZvaWRdJEFycmF5T2ZQdVRUWVNlc3Npb25zLkFkZCgkUHVUVFlTZXNzaW9uT2JqZWN0KQogICAgICAKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoJEFycmF5T2ZQdVRUWVNlc3Npb25zLmNvdW50IC1ndCAwKSB7CgogICAgICAgICAgICAkVXNlck9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lICJQdVRUWSBTZXNzaW9ucyIgLVZhbHVlICRBcnJheU9mUHVUVFlTZXNzaW9ucwoKICAgICAgICAgICAgaWYgKCRvKSB7CiAgICAgICAgICAgICAgJEFycmF5T2ZQdVRUWVNlc3Npb25zIHwgU2VsZWN0LU9iamVjdCAqIHwgRXhwb3J0LUNTViAtQXBwZW5kIC1QYXRoICgkT3V0cHV0RGlyZWN0b3J5ICsgIlxQdVRUWS5jc3YiKSAtTm9UeXBlSW5mb3JtYXRpb24KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBXcml0ZS1PdXRwdXQgIlB1VFRZIFNlc3Npb25zIgogICAgICAgICAgICAgICRBcnJheU9mUHVUVFlTZXNzaW9ucyB8IFNlbGVjdC1PYmplY3QgKiB8IEZvcm1hdC1MaXN0IHwgT3V0LVN0cmluZwogICAgICAgICAgICB9CgogICAgICAgICAgfQoKICAgICAgICB9ICMgSWYgUHVUVFkgc2Vzc2lvbiBleGlzdHMKCiAgICAgICAgaWYgKCgkUkRQU2Vzc2lvbnMgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0IFJldHVyblZhbHVlKSAtZXEgMCkgewoKICAgICAgICAgICMgR2V0IGFsbCBzZXNzaW9ucwogICAgICAgICAgJFJEUFNlc3Npb25zID0gJFJEUFNlc3Npb25zIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgc05hbWVzCgogICAgICAgICAgZm9yZWFjaCAoJFJEUFNlc3Npb24gaW4gJFJEUFNlc3Npb25zKSB7CiAgICAgIAogICAgICAgICAgICAkUkRQU2Vzc2lvbk9iamVjdCA9ICIiIHwgU2VsZWN0LU9iamVjdCAtUHJvcGVydHkgU291cmNlLEhvc3RuYW1lLFVzZXJuYW1lCiAgICAgICAgICAgIAogICAgICAgICAgICAkTG9jYXRpb24gPSAkUkRQUGF0aCArICJcIiArICRSRFBTZXNzaW9uCgogICAgICAgICAgICAkUkRQU2Vzc2lvbk9iamVjdC5Tb3VyY2UgPSAkU291cmNlCiAgICAgICAgICAgICRSRFBTZXNzaW9uT2JqZWN0Lkhvc3RuYW1lID0gJFJEUFNlc3Npb24KICAgICAgICAgICAgJFJEUFNlc3Npb25PYmplY3QuVXNlcm5hbWUgPSAoSW52b2tlLVdtaU1ldGhvZCAtQ29tcHV0ZXJOYW1lICRSZW1vdGVDb21wdXRlciAtQ2xhc3MgJ1N0ZFJlZ1Byb3YnIC1OYW1lIEdldFN0cmluZ1ZhbHVlIC1Bcmd1bWVudExpc3QgJEhLVSwkTG9jYXRpb24sIlVzZXJOYW1lSGludCIgQG9wdGlvbmFsQ3JlZHMpLnNWYWx1ZQoKICAgICAgICAgICAgW3ZvaWRdJEFycmF5T2ZSRFBTZXNzaW9ucy5BZGQoJFJEUFNlc3Npb25PYmplY3QpCiAgICAgIAogICAgICAgICAgfQoKICAgICAgICAgIGlmICgkQXJyYXlPZlJEUFNlc3Npb25zLmNvdW50IC1ndCAwKSB7CgogICAgICAgICAgICAkVXNlck9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lICJSRFAgU2Vzc2lvbnMiIC1WYWx1ZSAkQXJyYXlPZlJEUFNlc3Npb25zCgogICAgICAgICAgICBpZiAoJG8pIHsKICAgICAgICAgICAgICAkQXJyYXlPZlJEUFNlc3Npb25zIHwgU2VsZWN0LU9iamVjdCAqIHwgRXhwb3J0LUNTViAtQXBwZW5kIC1QYXRoICgkT3V0cHV0RGlyZWN0b3J5ICsgIlxSRFAuY3N2IikgLU5vVHlwZUluZm9ybWF0aW9uCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICJNaWNyb3NvZnQgUkRQIFNlc3Npb25zIgogICAgICAgICAgICAgICRBcnJheU9mUkRQU2Vzc2lvbnMgfCBTZWxlY3QtT2JqZWN0ICogfCBGb3JtYXQtTGlzdCB8IE91dC1TdHJpbmcKICAgICAgICAgICAgfQoKICAgICAgICAgIH0KCiAgICAgICAgfSAjIElmIFJEUCBzZXNzaW9ucyBleGlzdAoKICAgICAgICAjIElmIHdlIGZpbmQgdGhlIFN1cGVyUHVUVFkgU2Vzc2lvbnMueG1sIGZpbGUgd2hlcmUgd2Ugd291bGQgZXhwZWN0IGl0CiAgICAgICAgaWYgKCRTdXBlclB1VFRZUGF0aC5OYW1lKSB7CgogICAgICAgICAgJEZpbGUgPSAiQzpcVXNlcnNcJE1hcHBlZFVzZXJOYW1lXERvY3VtZW50c1xTdXBlclB1VFRZXFNlc3Npb25zLnhtbCIKICAgICAgICAgICRGaWxlQ29udGVudHMgPSBEb3dubG9hZEFuZEV4dHJhY3RGcm9tUmVtb3RlUmVnaXN0cnkgJEZpbGUKCiAgICAgICAgICBbeG1sXSRTdXBlclB1VFRZWE1MID0gJEZpbGVDb250ZW50cwogICAgICAgICAgKFByb2Nlc3NTdXBlclB1VFRZRmlsZSAkU3VwZXJQdVRUWVhNTCkKCiAgICAgICAgfQoKICAgICAgICAjIElmIHdlIGZpbmQgdGhlIEZpbGVaaWxsYSBzaXRlbWFuYWdlci54bWwgZmlsZSB3aGVyZSB3ZSB3b3VsZCBleHBlY3QgaXQKICAgICAgICBpZiAoJEZpbGVaaWxsYVBhdGguTmFtZSkgewoKICAgICAgICAgICRGaWxlID0gIkM6XFVzZXJzXCRNYXBwZWRVc2VyTmFtZVxBcHBEYXRhXFJvYW1pbmdcRmlsZVppbGxhXHNpdGVtYW5hZ2VyLnhtbCIKICAgICAgICAgICRGaWxlQ29udGVudHMgPSBEb3dubG9hZEFuZEV4dHJhY3RGcm9tUmVtb3RlUmVnaXN0cnkgJEZpbGUKCiAgICAgICAgICBbeG1sXSRGaWxlWmlsbGFYTUwgPSAkRmlsZUNvbnRlbnRzCiAgICAgICAgICAoUHJvY2Vzc0ZpbGVaaWxsYUZpbGUgJEZpbGVaaWxsYVhNTCkKCiAgICAgICAgfSAjIEZpbGVaaWxsYQoKICAgICAgfSAjIGZvciBlYWNoIFNJRAoKICAgICAgaWYgKCRUaG9yb3VnaCkgewoKICAgICAgICAkQXJyYXlvZlBQS0ZpbGVzID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0CiAgICAgICAgJEFycmF5b2ZSRFBGaWxlcyA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAogICAgICAgICRBcnJheW9mc2R0aWRGaWxlcyA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAoKICAgICAgICAkRmlsZVBhdGhzRm91bmQgPSAoR2V0LVdtaU9iamVjdCAtQ2xhc3MgJ0NJTV9EYXRhRmlsZScgLUZpbHRlciAiRHJpdmU9J0M6JyBBTkQgZXh0ZW5zaW9uPSdwcGsnIE9SIGV4dGVuc2lvbj0ncmRwJyBPUiBleHRlbnNpb249Jy5zZHRpZCciIC1Db21wdXRlck5hbWUgJFJlbW90ZUNvbXB1dGVyIEBvcHRpb25hbENyZWRzIHwgU2VsZWN0IE5hbWUpCgogICAgICAgIChQcm9jZXNzVGhvcm91Z2hSZW1vdGUgJEZpbGVQYXRoc0ZvdW5kKQogICAgICAgIAogICAgICB9IAoKICAgIH0gIyBmb3IgZWFjaCByZW1vdGUgY29tcHV0ZXIKCiAgIyBFbHNlLCB3ZSBydW4gU2Vzc2lvbkdvcGhlciBsb2NhbGx5CiAgfSBlbHNlIHsgCiAgICAKICAgIFdyaXRlLUhvc3QgLU5vTmV3TGluZSAtRm9yZWdyb3VuZENvbG9yICJEYXJrR3JlZW4iICJbK10gIgogICAgV3JpdGUtSG9zdCAiRGlnZ2luZyBvbiIoSG9zdG5hbWUpIi4uLiIKCiAgICAjIEFnZ3JlZ2F0ZSBhbGwgdXNlciBoaXZlcyBpbiBIS0VZX1VTRVJTIGludG8gYSB2YXJpYWJsZQogICAgJFVzZXJIaXZlcyA9IEdldC1DaGlsZEl0ZW0gUmVnaXN0cnk6OkhLRVlfVVNFUlNcIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgV2hlcmUtT2JqZWN0IHskXy5OYW1lIC1tYXRjaCAnXkhLRVlfVVNFUlNcXFMtMS01LTIxLVtcZFwtXSskJ30KCiAgICAjIEZvciBlYWNoIFNJRCBiZWdpbm5pbmcgaW4gUy0xNS0yMS0uIExvb3BzIHRocm91Z2ggZWFjaCB1c2VyIGhpdmUgaW4gSEtFWV9VU0VSUy4KICAgIGZvcmVhY2goJEhpdmUgaW4gJFVzZXJIaXZlcykgewoKICAgICAgIyBDcmVhdGVkIGZvciBlYWNoIHVzZXIgZm91bmQuIENvbnRhaW5zIGFsbCBQdVRUWSwgV2luU0NQLCBGaWxlWmlsbGEsIFJEUCBpbmZvcm1hdGlvbi4gCiAgICAgICRVc2VyT2JqZWN0ID0gTmV3LU9iamVjdCBQU09iamVjdAoKICAgICAgJEFycmF5T2ZXaW5TQ1BTZXNzaW9ucyA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAogICAgICAkQXJyYXlPZlB1VFRZU2Vzc2lvbnMgPSBOZXctT2JqZWN0IFN5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3QKICAgICAgJEFycmF5T2ZQUEtGaWxlcyA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAogICAgICAkQXJyYXlPZlN1cGVyUHVUVFlTZXNzaW9ucyA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAogICAgICAkQXJyYXlPZlJEUFNlc3Npb25zID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0CiAgICAgICRBcnJheU9mUkRQRmlsZXMgPSBOZXctT2JqZWN0IFN5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3QKICAgICAgJEFycmF5T2ZGaWxlWmlsbGFTZXNzaW9ucyA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAoKICAgICAgJG9ialVzZXIgPSAoR2V0TWFwcGVkU0lEKQogICAgICAkU291cmNlID0gKEhvc3RuYW1lKSArICJcIiArIChTcGxpdC1QYXRoICRvYmpVc2VyLlZhbHVlIC1MZWFmKQoKICAgICAgJFVzZXJPYmplY3QgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSAiU291cmNlIiAtVmFsdWUgJG9ialVzZXIuVmFsdWUKCiAgICAgICMgQ29uc3RydWN0IFB1VFRZLCBXaW5TQ1AsIFJEUCwgRmlsZVppbGxhIHNlc3Npb24gcGF0aHMgZnJvbSBiYXNlIGtleQogICAgICAkUHVUVFlQYXRoID0gSm9pbi1QYXRoICRIaXZlLlBTUGF0aCAiXCRQdVRUWVBhdGhFbmRpbmciCiAgICAgICRXaW5TQ1BQYXRoID0gSm9pbi1QYXRoICRIaXZlLlBTUGF0aCAiXCRXaW5TQ1BQYXRoRW5kaW5nIgogICAgICAkTWljcm9zb2Z0UkRQUGF0aCA9IEpvaW4tUGF0aCAkSGl2ZS5QU1BhdGggIlwkUkRQUGF0aEVuZGluZyIKICAgICAgJEZpbGVaaWxsYVBhdGggPSAiQzpcVXNlcnNcIiArIChTcGxpdC1QYXRoIC1MZWFmICRVc2VyT2JqZWN0LiJTb3VyY2UiKSArICJcQXBwRGF0YVxSb2FtaW5nXEZpbGVaaWxsYVxzaXRlbWFuYWdlci54bWwiCiAgICAgICRTdXBlclB1VFRZUGF0aCA9ICJDOlxVc2Vyc1wiICsgKFNwbGl0LVBhdGggLUxlYWYgJFVzZXJPYmplY3QuIlNvdXJjZSIpICsgIlxEb2N1bWVudHNcU3VwZXJQdVRUWVxTZXNzaW9ucy54bWwiCgogICAgICBpZiAoVGVzdC1QYXRoICRGaWxlWmlsbGFQYXRoKSB7CgogICAgICAgIFt4bWxdJEZpbGVaaWxsYVhNTCA9IEdldC1Db250ZW50ICRGaWxlWmlsbGFQYXRoCiAgICAgICAgKFByb2Nlc3NGaWxlWmlsbGFGaWxlICRGaWxlWmlsbGFYTUwpCgogICAgICB9CgogICAgICBpZiAoVGVzdC1QYXRoICRTdXBlclB1VFRZUGF0aCkgewoKICAgICAgICBbeG1sXSRTdXBlclB1VFRZWE1MID0gR2V0LUNvbnRlbnQgJFN1cGVyUHVUVFlQYXRoCiAgICAgICAgKFByb2Nlc3NTdXBlclB1VFRZRmlsZSAkU3VwZXJQdVRUWVhNTCkKCiAgICAgIH0KCiAgICAgIGlmIChUZXN0LVBhdGggJE1pY3Jvc29mdFJEUFBhdGgpIHsKCiAgICAgICAgIyBBZ2dyZWdhdGVzIGFsbCBzYXZlZCBzZXNzaW9ucyBmcm9tIHRoYXQgdXNlcidzIFJEUCBjbGllbnQKICAgICAgICAkQWxsUkRQU2Vzc2lvbnMgPSBHZXQtQ2hpbGRJdGVtICRNaWNyb3NvZnRSRFBQYXRoCgogICAgICAgIChQcm9jZXNzUkRQTG9jYWwgJEFsbFJEUFNlc3Npb25zKQoKICAgICAgfSAjIElmIChUZXN0LVBhdGggTWljcm9zb2Z0UkRQUGF0aCkKCiAgICAgIGlmIChUZXN0LVBhdGggJFdpblNDUFBhdGgpIHsKCiAgICAgICAgIyBBZ2dyZWdhdGVzIGFsbCBzYXZlZCBzZXNzaW9ucyBmcm9tIHRoYXQgdXNlcidzIFdpblNDUCBjbGllbnQKICAgICAgICAkQWxsV2luU0NQU2Vzc2lvbnMgPSBHZXQtQ2hpbGRJdGVtICRXaW5TQ1BQYXRoCgogICAgICAgIChQcm9jZXNzV2luU0NQTG9jYWwgJEFsbFdpblNDUFNlc3Npb25zKQoKICAgICAgfSAjIElmIChUZXN0LVBhdGggV2luU0NQUGF0aCkKICAgICAgCiAgICAgIGlmIChUZXN0LVBhdGggJFB1VFRZUGF0aCkgewoKICAgICAgICAjIEFnZ3JlZ2F0ZXMgYWxsIHNhdmVkIHNlc3Npb25zIGZyb20gdGhhdCB1c2VyJ3MgUHVUVFkgY2xpZW50CiAgICAgICAgJEFsbFB1VFRZU2Vzc2lvbnMgPSBHZXQtQ2hpbGRJdGVtICRQdVRUWVBhdGgKCiAgICAgICAgKFByb2Nlc3NQdVRUWUxvY2FsICRBbGxQdVRUWVNlc3Npb25zKQoKICAgICAgfSAjIElmIChUZXN0LVBhdGggUHVUVFlQYXRoKQoKICAgIH0gIyBGb3IgZWFjaCBIaXZlIGluIFVzZXJIaXZlcwoKICAgICMgSWYgcnVuIGluIFRob3JvdWdoIE1vZGUKICAgIGlmICgkVGhvcm91Z2gpIHsKCiAgICAgICMgQ29udGFpbnMgcmF3IGktbm9kZSBkYXRhIGZvciBmaWxlcyB3aXRoIGV4dGVuc2lvbiAucHBrLCAucmRwLCBhbmQgc2R0aWQgcmVzcGVjdGl2ZWx5LCBmb3VuZCBieSBHZXQtQ2hpbGRJdGVtCiAgICAgICRQUEtFeHRlbnNpb25GaWxlc0lOb2RlcyA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAogICAgICAkUkRQRXh0ZW5zaW9uRmlsZXNJTm9kZXMgPSBOZXctT2JqZWN0IFN5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3QKICAgICAgJHNkdGlkRXh0ZW5zaW9uRmlsZXNJTm9kZXMgPSBOZXctT2JqZWN0IFN5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3QKCiAgICAgICMgQWxsIGRyaXZlcyBmb3VuZCBvbiBzeXN0ZW0gaW4gb25lIHZhcmlhYmxlCiAgICAgICRBbGxEcml2ZXMgPSBHZXQtUFNEcml2ZQoKICAgICAgKFByb2Nlc3NUaG9yb3VnaExvY2FsICRBbGxEcml2ZXMpCiAgICAgIAogICAgICAoUHJvY2Vzc1BQS0ZpbGUgJFBQS0V4dGVuc2lvbkZpbGVzSU5vZGVzKQogICAgICAoUHJvY2Vzc1JEUEZpbGUgJFJEUEV4dGVuc2lvbkZpbGVzSU5vZGVzKQogICAgICAoUHJvY2Vzc3NkdGlkRmlsZSAkc2R0aWRFeHRlbnNpb25GaWxlc0lOb2RlcykKCiAgICB9ICMgSWYgVGhvcm91Z2gKCiAgfSAjIEVsc2UgLS0gcnVuIFNlc3Npb25Hb3BoZXIgbG9jYWxseQoKfSAjIEludm9rZS1TZXNzaW9uR29waGVyCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjIFJlZ2lzdHJ5IFF1ZXJ5aW5nIEhlbHBlciBGdW5jdGlvbnMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKIyBNYXBzIHRoZSBTSUQgZnJvbSBIS0VZX1VTRVJTIHRvIGEgdXNlcm5hbWUgdGhyb3VnaCB0aGUgSEtFWV9MT0NBTF9NQUNISU5FIGhpdmUKZnVuY3Rpb24gR2V0TWFwcGVkU0lEIHsKCiAgIyBJZiBnZXR0aW5nIFNJRCBmcm9tIHJlbW90ZSBjb21wdXRlcgogIGlmICgkaUwgLW9yICRUYXJnZXQgLW9yICRBbGxEb21haW4pIHsKICAgICMgR2V0IHRoZSB1c2VybmFtZSBmb3IgU0lEIHdlIGRpc2NvdmVyZWQgaGFzIHNhdmVkIHNlc3Npb25zCiAgICAkU0lEUGF0aCA9ICJTT0ZUV0FSRVxNaWNyb3NvZnRcV2luZG93cyBOVFxDdXJyZW50VmVyc2lvblxQcm9maWxlTGlzdFwkU0lEIgogICAgJFZhbHVlID0gIlByb2ZpbGVJbWFnZVBhdGgiCgogICAgcmV0dXJuIChJbnZva2UtV21pTWV0aG9kIC1Db21wdXRlck5hbWUgJFJlbW90ZUNvbXB1dGVyIC1DbGFzcyAnU3RkUmVnUHJvdicgLU5hbWUgJ0dldFN0cmluZ1ZhbHVlJyAtQXJndW1lbnRMaXN0ICRIS0xNLCRTSURQYXRoLCRWYWx1ZSBAb3B0aW9uYWxDcmVkcykuc1ZhbHVlCiAgIyBFbHNlLCBnZXQgbG9jYWwgU0lEcwogIH0gZWxzZSB7CiAgICAjIENvbnZlcnRzIHVzZXIgU0lEIGluIEhLRVlfVVNFUlMgdG8gdXNlcm5hbWUKICAgICRTSUQgPSAoU3BsaXQtUGF0aCAkSGl2ZS5OYW1lIC1MZWFmKQogICAgJG9ialNJRCA9IE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXIoIiRTSUQiKQogICAgcmV0dXJuICRvYmpTSUQuVHJhbnNsYXRlKCBbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5OVEFjY291bnRdKQogIH0KCn0KCmZ1bmN0aW9uIERvd25sb2FkQW5kRXh0cmFjdEZyb21SZW1vdGVSZWdpc3RyeSgkRmlsZSkgewogICMgVGhlIGZvbGxvd2luZyBjb2RlIGlzIHRha2VuIGZyb20gQ2hyaXN0b3BoZXIgVHJ1bmNlcidzIFdNSU9wcyBzY3JpcHQgb24gR2l0SHViLiBJdCBnZXRzIGZpbGUgY29udGVudHMgdGhyb3VnaCBXTUkgYnkKICAjIGRvd25sb2FkaW5nIHRoZSBmaWxlJ3MgY29udGVudHMgdG8gdGhlIHJlbW90ZSBjb21wdXRlcidzIHJlZ2lzdHJ5LCBhbmQgdGhlbiBleHRyYWN0aW5nIHRoZSB2YWx1ZSBmcm9tIHRoYXQgcmVnaXN0cnkgbG9jYXRpb24KICAkZnVsbHJlZ2lzdHJ5cGF0aCA9ICJIS0xNOlxTb2Z0d2FyZVxNaWNyb3NvZnRcRFJNIgogICRyZWdpc3RyeWRvd25uYW1lID0gIlJlYWRNZSIKICAkcmVncGF0aCA9ICJTT0ZUV0FSRVxNaWNyb3NvZnRcRFJNIgogICAgICAgICAgCiAgIyBPbiByZW1vdGUgc3lzdGVtLCBzYXZlIGZpbGUgdG8gcmVnaXN0cnkKICBXcml0ZS1WZXJib3NlICJSZWFkaW5nIHJlbW90ZSBmaWxlIGFuZCB3cml0aW5nIG9uIHJlbW90ZSByZWdpc3RyeSIKICAkcmVtb3RlX2NvbW1hbmQgPSAnJGZjdCA9IEdldC1Db250ZW50IC1FbmNvZGluZyBieXRlIC1QYXRoICcnJyArICIkRmlsZSIgKyAnJyc7ICRmY3RlbmMgPSBbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkZmN0KTsgTmV3LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAnICsgIickZnVsbHJlZ2lzdHJ5cGF0aCciICsgJyAtTmFtZSAnICsgIickcmVnaXN0cnlkb3dubmFtZSciICsgJyAtVmFsdWUgJGZjdGVuYyAtUHJvcGVydHlUeXBlIFN0cmluZyAtRm9yY2UnCiAgJHJlbW90ZV9jb21tYW5kID0gJ3Bvd2Vyc2hlbGwgLW5vcCAtZXhlYyBieXBhc3MgLWMgIicgKyAkcmVtb3RlX2NvbW1hbmQgKyAnIicKCiAgJG51bGwgPSBJbnZva2UtV21pTWV0aG9kIC1jbGFzcyB3aW4zMl9wcm9jZXNzIC1OYW1lIENyZWF0ZSAtQXJndW1lbnRsaXN0ICRyZW1vdGVfY29tbWFuZCAtQ29tcHV0ZXJOYW1lICRSZW1vdGVDb21wdXRlciBAb3B0aW9uYWxDcmVkcwoKICAjIFNsZWVwaW5nIHRvIGxldCByZW1vdGUgc3lzdGVtIHJlYWQgYW5kIHN0b3JlIGZpbGUKICBTdGFydC1TbGVlcCAtcyAxNQoKICAkcmVtb3RlX3JlZyA9ICIiCgogICMgR3JhYiBmaWxlIGZyb20gcmVtb3RlIHN5c3RlbSdzIHJlZ2lzdHJ5CiAgJHJlbW90ZV9yZWcgPSBJbnZva2UtV21pTWV0aG9kIC1OYW1lc3BhY2UgJ3Jvb3RcZGVmYXVsdCcgLUNsYXNzICdTdGRSZWdQcm92JyAtTmFtZSAnR2V0U3RyaW5nVmFsdWUnIC1Bcmd1bWVudExpc3QgJEhLTE0sICRyZWdwYXRoLCAkcmVnaXN0cnlkb3dubmFtZSAtQ29tcHV0ZXIgJFJlbW90ZUNvbXB1dGVyIEBvcHRpb25hbENyZWRzCiAgCiAgJGRlY29kZWQgPSBbU3lzdGVtLkNvbnZlcnRdOjpGcm9tQmFzZTY0U3RyaW5nKCRyZW1vdGVfcmVnLnNWYWx1ZSkKICAkVVRGOGRlY29kZWQgPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVVEY4LkdldFN0cmluZygkZGVjb2RlZCkgCiAgICAKICAjIFJlbW92aW5nIFJlZ2lzdHJ5IHZhbHVlIGZyb20gcmVtb3RlIHN5c3RlbQogICRudWxsID0gSW52b2tlLVdtaU1ldGhvZCAtTmFtZXNwYWNlICdyb290XGRlZmF1bHQnIC1DbGFzcyAnU3RkUmVnUHJvdicgLU5hbWUgJ0RlbGV0ZVZhbHVlJyAtQXJndW1lbnRsaXN0ICRyZWdoaXZlLCAkcmVncGF0aCwgJHJlZ2lzdHJ5ZG93bm5hbWUgLUNvbXB1dGVyTmFtZSAkUmVtb3RlQ29tcHV0ZXIgQG9wdGlvbmFsQ3JlZHMKICAKICByZXR1cm4gJFVURjhkZWNvZGVkCgp9CgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjIEZpbGUgUHJvY2Vzc2luZyBIZWxwZXIgRnVuY3Rpb25zCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmZ1bmN0aW9uIFByb2Nlc3NUaG9yb3VnaExvY2FsKCRBbGxEcml2ZXMpIHsKICAKICBmb3JlYWNoICgkRHJpdmUgaW4gJEFsbERyaXZlcykgewogICAgIyBJZiB0aGUgZHJpdmUgaG9sZHMgYSBmaWxlc3lzdGVtCiAgICBpZiAoJERyaXZlLlByb3ZpZGVyLk5hbWUgLWVxICJGaWxlU3lzdGVtIikgewogICAgICAkRGlycyA9IEdldC1DaGlsZEl0ZW0gJERyaXZlLlJvb3QgLVJlY3Vyc2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgZm9yZWFjaCAoJERpciBpbiAkRGlycykgewogICAgICAgIFN3aXRjaCAoJERpci5FeHRlbnNpb24pIHsKICAgICAgICAgICIucHBrIiB7W3ZvaWRdJFBQS0V4dGVuc2lvbkZpbGVzSU5vZGVzLkFkZCgkRGlyKX0KICAgICAgICAgICIucmRwIiB7W3ZvaWRdJFJEUEV4dGVuc2lvbkZpbGVzSU5vZGVzLkFkZCgkRGlyKX0KICAgICAgICAgICIuc2R0aWQiIHtbdm9pZF0kc2R0aWRFeHRlbnNpb25GaWxlc0lOb2Rlcy5BZGQoJERpcil9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKfQoKZnVuY3Rpb24gUHJvY2Vzc1Rob3JvdWdoUmVtb3RlKCRGaWxlUGF0aHNGb3VuZCkgewoKICBmb3JlYWNoICgkRmlsZVBhdGggaW4gJEZpbGVQYXRoc0ZvdW5kKSB7CiAgICAgICMgRWFjaCBvYmplY3Qgd2UgY3JlYXRlIGZvciB0aGUgZmlsZSBleHRlbnNpb24gZm91bmQgZnJvbSBhIC1UaG9yb3VnaCBzZWFyY2ggd2lsbCBoYXZlIHRoZSBzYW1lIHByb3BlcnRpZXMgKFNvdXJjZSwgUGF0aCB0byBGaWxlKQogICAgICAkVGhvcm91Z2hPYmplY3QgPSAiIiB8IFNlbGVjdC1PYmplY3QgLVByb3BlcnR5IFNvdXJjZSxQYXRoCiAgICAgICRUaG9yb3VnaE9iamVjdC5Tb3VyY2UgPSAkUmVtb3RlQ29tcHV0ZXIKCiAgICAgICRFeHRlbnNpb24gPSBbSU8uUGF0aF06OkdldEV4dGVuc2lvbigkRmlsZVBhdGguTmFtZSkKCiAgICAgIGlmICgkRXh0ZW5zaW9uIC1lcSAiLnBwayIpIHsKICAgICAgICAkVGhvcm91Z2hPYmplY3QuUGF0aCA9ICRGaWxlUGF0aC5OYW1lCiAgICAgICAgW3ZvaWRdJEFycmF5b2ZQUEtGaWxlcy5BZGQoJFRob3JvdWdoT2JqZWN0KQogICAgICB9IGVsc2VpZiAoJEV4dGVuc2lvbiAtZXEgIi5yZHAiKSB7CiAgICAgICAgJFRob3JvdWdoT2JqZWN0LlBhdGggPSAkRmlsZVBhdGguTmFtZQogICAgICAgIFt2b2lkXSRBcnJheW9mUkRQRmlsZXMuQWRkKCRUaG9yb3VnaE9iamVjdCkKICAgICAgfSBlbHNlaWYgKCRFeHRlbnNpb24gLWVxICIuc2R0aWQiKSB7CiAgICAgICAgJFRob3JvdWdoT2JqZWN0LlBhdGggPSAkRmlsZVBhdGguTmFtZQogICAgICAgIFt2b2lkXSRBcnJheW9mc2R0aWRGaWxlcy5BZGQoJFRob3JvdWdoT2JqZWN0KQogICAgICB9CgogIH0KCiAgaWYgKCRBcnJheU9mUFBLRmlsZXMuY291bnQgLWd0IDApIHsKCiAgICAkVXNlck9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lICJQUEsgRmlsZXMiIC1WYWx1ZSAkQXJyYXlPZlJEUEZpbGVzCgogICAgaWYgKCRvKSB7CiAgICAgICRBcnJheU9mUFBLRmlsZXMgfCBFeHBvcnQtQ1NWIC1BcHBlbmQgLVBhdGggKCRPdXRwdXREaXJlY3RvcnkgKyAiXFB1VFRZIHBwayBGaWxlcy5jc3YiKSAtTm9UeXBlSW5mb3JtYXRpb24KICAgIH0gZWxzZSB7CiAgICAgIFdyaXRlLU91dHB1dCAiUHVUVFkgUHJpdmF0ZSBLZXkgRmlsZXMgKC5wcGspIgogICAgICAkQXJyYXlPZlBQS0ZpbGVzIHwgRm9ybWF0LUxpc3QgfCBPdXQtU3RyaW5nCiAgICB9CiAgfQoKICBpZiAoJEFycmF5T2ZSRFBGaWxlcy5jb3VudCAtZ3QgMCkgewoKICAgICRVc2VyT2JqZWN0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgIlJEUCBGaWxlcyIgLVZhbHVlICRBcnJheU9mUkRQRmlsZXMKCiAgICBpZiAoJG8pIHsKICAgICAgJEFycmF5T2ZSRFBGaWxlcyB8IEV4cG9ydC1DU1YgLUFwcGVuZCAtUGF0aCAoJE91dHB1dERpcmVjdG9yeSArICJcTWljcm9zb2Z0IHJkcCBGaWxlcy5jc3YiKSAtTm9UeXBlSW5mb3JtYXRpb24KICAgIH0gZWxzZSB7CiAgICAgIFdyaXRlLU91dHB1dCAiTWljcm9zb2Z0IFJEUCBDb25uZWN0aW9uIEZpbGVzICgucmRwKSIKICAgICAgJEFycmF5T2ZSRFBGaWxlcyB8IEZvcm1hdC1MaXN0IHwgT3V0LVN0cmluZwogICAgfQogIH0KICBpZiAoJEFycmF5T2ZzZHRpZEZpbGVzLmNvdW50IC1ndCAwKSB7CgogICAgJFVzZXJPYmplY3QgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSAic2R0aWQgRmlsZXMiIC1WYWx1ZSAkQXJyYXlPZnNkdGlkRmlsZXMKCiAgICBpZiAoJG8pIHsKICAgICAgJEFycmF5T2ZzZHRpZEZpbGVzIHwgRXhwb3J0LUNTViAtQXBwZW5kIC1QYXRoICgkT3V0cHV0RGlyZWN0b3J5ICsgIlxSU0Egc2R0aWQgRmlsZXMuY3N2IikgLU5vVHlwZUluZm9ybWF0aW9uCiAgICB9IGVsc2UgewogICAgICBXcml0ZS1PdXRwdXQgIlJTQSBUb2tlbnMgKHNkdGlkKSIKICAgICAgJEFycmF5T2ZzZHRpZEZpbGVzIHwgRm9ybWF0LUxpc3QgfCBPdXQtU3RyaW5nCiAgICB9CgogIH0KCn0gIyBQcm9jZXNzVGhvcm91Z2hSZW1vdGUKCmZ1bmN0aW9uIFByb2Nlc3NQdVRUWUxvY2FsKCRBbGxQdVRUWVNlc3Npb25zKSB7CiAgCiAgIyBGb3IgZWFjaCBQdVRUWSBzYXZlZCBzZXNzaW9uLCBleHRyYWN0IHRoZSBpbmZvcm1hdGlvbiB3ZSB3YW50IAogIGZvcmVhY2goJFNlc3Npb24gaW4gJEFsbFB1VFRZU2Vzc2lvbnMpIHsKCiAgICAkUHVUVFlTZXNzaW9uT2JqZWN0ID0gIiIgfCBTZWxlY3QtT2JqZWN0IC1Qcm9wZXJ0eSBTb3VyY2UsU2Vzc2lvbixIb3N0bmFtZQoKICAgICRQdVRUWVNlc3Npb25PYmplY3QuU291cmNlID0gJFNvdXJjZQogICAgJFB1VFRZU2Vzc2lvbk9iamVjdC5TZXNzaW9uID0gKFNwbGl0LVBhdGggJFNlc3Npb24gLUxlYWYpCiAgICAkUHVUVFlTZXNzaW9uT2JqZWN0Lkhvc3RuYW1lID0gKChHZXQtSXRlbVByb3BlcnR5IC1QYXRoICgiTWljcm9zb2Z0LlBvd2VyU2hlbGwuQ29yZVxSZWdpc3RyeTo6IiArICRTZXNzaW9uKSAtTmFtZSAiSG9zdG5hbWUiIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKS5Ib3N0bmFtZSkKCiAgICAjIEFycmF5TGlzdC5BZGQoKSBieSBkZWZhdWx0IHByaW50cyB0aGUgaW5kZXggdG8gd2hpY2ggaXQgYWRkcyB0aGUgZWxlbWVudC4gQ2FzdGluZyB0byBbdm9pZF0gc2lsZW5jZXMgdGhpcy4KICAgIFt2b2lkXSRBcnJheU9mUHVUVFlTZXNzaW9ucy5BZGQoJFB1VFRZU2Vzc2lvbk9iamVjdCkKCiAgfQoKICBpZiAoJG8pIHsKICAgICRBcnJheU9mUHVUVFlTZXNzaW9ucyB8IEV4cG9ydC1DU1YgLUFwcGVuZCAtUGF0aCAoJE91dHB1dERpcmVjdG9yeSArICJcUHVUVFkuY3N2IikgLU5vVHlwZUluZm9ybWF0aW9uCiAgfSBlbHNlIHsKICAgIFdyaXRlLU91dHB1dCAiUHVUVFkgU2Vzc2lvbnMiCiAgICAkQXJyYXlPZlB1VFRZU2Vzc2lvbnMgfCBGb3JtYXQtTGlzdCB8IE91dC1TdHJpbmcKICB9CgogICMgQWRkIHRoZSBhcnJheSBvZiBQdVRUWSBzZXNzaW9uIG9iamVjdHMgdG8gVXNlck9iamVjdAogICRVc2VyT2JqZWN0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgIlB1VFRZIFNlc3Npb25zIiAtVmFsdWUgJEFycmF5T2ZQdVRUWVNlc3Npb25zCgp9ICMgUHJvY2Vzc1B1VFRZTG9jYWwKCmZ1bmN0aW9uIFByb2Nlc3NSRFBMb2NhbCgkQWxsUkRQU2Vzc2lvbnMpIHsKCiAgIyBGb3IgZWFjaCBSRFAgc2F2ZWQgc2Vzc2lvbiwgZXh0cmFjdCB0aGUgaW5mb3JtYXRpb24gd2Ugd2FudAogIGZvcmVhY2goJFNlc3Npb24gaW4gJEFsbFJEUFNlc3Npb25zKSB7CgogICAgJFBhdGhUb1JEUFNlc3Npb24gPSAiTWljcm9zb2Z0LlBvd2VyU2hlbGwuQ29yZVxSZWdpc3RyeTo6IiArICRTZXNzaW9uCgogICAgJE1pY3Jvc29mdFJEUFNlc3Npb25PYmplY3QgPSAiIiB8IFNlbGVjdC1PYmplY3QgLVByb3BlcnR5IFNvdXJjZSxIb3N0bmFtZSxVc2VybmFtZQoKICAgICRNaWNyb3NvZnRSRFBTZXNzaW9uT2JqZWN0LlNvdXJjZSA9ICRTb3VyY2UKICAgICRNaWNyb3NvZnRSRFBTZXNzaW9uT2JqZWN0Lkhvc3RuYW1lID0gKFNwbGl0LVBhdGggJFNlc3Npb24gLUxlYWYpCiAgICAkTWljcm9zb2Z0UkRQU2Vzc2lvbk9iamVjdC5Vc2VybmFtZSA9ICgoR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkUGF0aFRvUkRQU2Vzc2lvbiAtTmFtZSAiVXNlcm5hbWVIaW50IiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkuVXNlcm5hbWVIaW50KQoKICAgICMgQXJyYXlMaXN0LkFkZCgpIGJ5IGRlZmF1bHQgcHJpbnRzIHRoZSBpbmRleCB0byB3aGljaCBpdCBhZGRzIHRoZSBlbGVtZW50LiBDYXN0aW5nIHRvIFt2b2lkXSBzaWxlbmNlcyB0aGlzLgogICAgW3ZvaWRdJEFycmF5T2ZSRFBTZXNzaW9ucy5BZGQoJE1pY3Jvc29mdFJEUFNlc3Npb25PYmplY3QpCgogIH0gIyBGb3IgZWFjaCBTZXNzaW9uIGluIEFsbFJEUFNlc3Npb25zCgogIGlmICgkbykgewogICAgJEFycmF5T2ZSRFBTZXNzaW9ucyB8IEV4cG9ydC1DU1YgLUFwcGVuZCAtUGF0aCAoJE91dHB1dERpcmVjdG9yeSArICJcUkRQLmNzdiIpIC1Ob1R5cGVJbmZvcm1hdGlvbgogIH0gZWxzZSB7CiAgICBXcml0ZS1PdXRwdXQgIk1pY3Jvc29mdCBSZW1vdGUgRGVza3RvcCAoUkRQKSBTZXNzaW9ucyIKICAgICRBcnJheU9mUkRQU2Vzc2lvbnMgfCBGb3JtYXQtTGlzdCB8IE91dC1TdHJpbmcKICB9CgogICMgQWRkIHRoZSBhcnJheSBvZiBSRFAgc2Vzc2lvbiBvYmplY3RzIHRvIFVzZXJPYmplY3QKICAkVXNlck9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lICJSRFAgU2Vzc2lvbnMiIC1WYWx1ZSAkQXJyYXlPZlJEUFNlc3Npb25zCgp9ICNQcm9jZXNzUkRQTG9jYWwKCmZ1bmN0aW9uIFByb2Nlc3NXaW5TQ1BMb2NhbCgkQWxsV2luU0NQU2Vzc2lvbnMpIHsKICAKICAjIEZvciBlYWNoIFdpblNDUCBzYXZlZCBzZXNzaW9uLCBleHRyYWN0IHRoZSBpbmZvcm1hdGlvbiB3ZSB3YW50CiAgZm9yZWFjaCgkU2Vzc2lvbiBpbiAkQWxsV2luU0NQU2Vzc2lvbnMpIHsKCiAgICAkUGF0aFRvV2luU0NQU2Vzc2lvbiA9ICJNaWNyb3NvZnQuUG93ZXJTaGVsbC5Db3JlXFJlZ2lzdHJ5OjoiICsgJFNlc3Npb24KCiAgICAkV2luU0NQU2Vzc2lvbk9iamVjdCA9ICIiIHwgU2VsZWN0LU9iamVjdCAtUHJvcGVydHkgU291cmNlLFNlc3Npb24sSG9zdG5hbWUsVXNlcm5hbWUsUGFzc3dvcmQKCiAgICAkV2luU0NQU2Vzc2lvbk9iamVjdC5Tb3VyY2UgPSAkU291cmNlCiAgICAkV2luU0NQU2Vzc2lvbk9iamVjdC5TZXNzaW9uID0gKFNwbGl0LVBhdGggJFNlc3Npb24gLUxlYWYpCiAgICAkV2luU0NQU2Vzc2lvbk9iamVjdC5Ib3N0bmFtZSA9ICgoR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkUGF0aFRvV2luU0NQU2Vzc2lvbiAtTmFtZSAiSG9zdG5hbWUiIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKS5Ib3N0bmFtZSkKICAgICRXaW5TQ1BTZXNzaW9uT2JqZWN0LlVzZXJuYW1lID0gKChHZXQtSXRlbVByb3BlcnR5IC1QYXRoICRQYXRoVG9XaW5TQ1BTZXNzaW9uIC1OYW1lICJVc2VybmFtZSIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpLlVzZXJuYW1lKQogICAgJFdpblNDUFNlc3Npb25PYmplY3QuUGFzc3dvcmQgPSAoKEdldC1JdGVtUHJvcGVydHkgLVBhdGggJFBhdGhUb1dpblNDUFNlc3Npb24gLU5hbWUgIlBhc3N3b3JkIiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkuUGFzc3dvcmQpCgogICAgaWYgKCRXaW5TQ1BTZXNzaW9uT2JqZWN0LlBhc3N3b3JkKSB7CiAgICAgICRNYXN0ZXJQYXNzVXNlZCA9ICgoR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAoSm9pbi1QYXRoICRIaXZlLlBTUGF0aCAiU09GVFdBUkVcTWFydGluIFByaWtyeWxcV2luU0NQIDJcQ29uZmlndXJhdGlvblxTZWN1cml0eSIpIC1OYW1lICJVc2VNYXN0ZXJQYXNzd29yZCIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpLlVzZU1hc3RlclBhc3N3b3JkKQoKICAgICAgIyBJZiB0aGUgdXNlciBpcyBub3QgdXNpbmcgYSBtYXN0ZXIgcGFzc3dvcmQsIHdlIGNhbiBjcmFjayBpdDoKICAgICAgaWYgKCEkTWFzdGVyUGFzc1VzZWQpIHsKICAgICAgICAgICRXaW5TQ1BTZXNzaW9uT2JqZWN0LlBhc3N3b3JkID0gKERlY3J5cHRXaW5TQ1BQYXNzd29yZCAkV2luU0NQU2Vzc2lvbk9iamVjdC5Ib3N0bmFtZSAkV2luU0NQU2Vzc2lvbk9iamVjdC5Vc2VybmFtZSAkV2luU0NQU2Vzc2lvbk9iamVjdC5QYXNzd29yZCkKICAgICAgIyBFbHNlLCB0aGUgdXNlciBpcyB1c2luZyBhIG1hc3RlciBwYXNzd29yZC4gV2UgY2FuJ3QgcmV0cmlldmUgcGxhaW50ZXh0IGNyZWRlbnRpYWxzIGZvciBpdC4KICAgICAgfSBlbHNlIHsKICAgICAgICAgICRXaW5TQ1BTZXNzaW9uT2JqZWN0LlBhc3N3b3JkID0gIlNhdmVkIGluIHNlc3Npb24sIGJ1dCBtYXN0ZXIgcGFzc3dvcmQgcHJldmVudHMgcGxhaW50ZXh0IHJlY292ZXJ5IgogICAgICB9CiAgICB9CgogICAgIyBBcnJheUxpc3QuQWRkKCkgYnkgZGVmYXVsdCBwcmludHMgdGhlIGluZGV4IHRvIHdoaWNoIGl0IGFkZHMgdGhlIGVsZW1lbnQuIENhc3RpbmcgdG8gW3ZvaWRdIHNpbGVuY2VzIHRoaXMuCiAgICBbdm9pZF0kQXJyYXlPZldpblNDUFNlc3Npb25zLkFkZCgkV2luU0NQU2Vzc2lvbk9iamVjdCkKCiAgfSAjIEZvciBlYWNoIFNlc3Npb24gaW4gQWxsV2luU0NQU2Vzc2lvbnMKCiAgaWYgKCRvKSB7CiAgICAkQXJyYXlPZldpblNDUFNlc3Npb25zIHwgRXhwb3J0LUNTViAtQXBwZW5kIC1QYXRoICgkT3V0cHV0RGlyZWN0b3J5ICsgIlxXaW5TQ1AuY3N2IikgLU5vVHlwZUluZm9ybWF0aW9uCiAgfSBlbHNlIHsKICAgIFdyaXRlLU91dHB1dCAiV2luU0NQIFNlc3Npb25zIgogICAgJEFycmF5T2ZXaW5TQ1BTZXNzaW9ucyB8IEZvcm1hdC1MaXN0IHwgT3V0LVN0cmluZwogIH0KCiAgIyBBZGQgdGhlIGFycmF5IG9mIFdpblNDUCBzZXNzaW9uIG9iamVjdHMgdG8gdGhlIHRhcmdldCB1c2VyIG9iamVjdAogICRVc2VyT2JqZWN0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgIldpblNDUCBTZXNzaW9ucyIgLVZhbHVlICRBcnJheU9mV2luU0NQU2Vzc2lvbnMKCn0gIyBQcm9jZXNzV2luU0NQTG9jYWwKCmZ1bmN0aW9uIFByb2Nlc3NzZHRpZEZpbGUoJHNkdGlkRXh0ZW5zaW9uRmlsZXNJTm9kZXMpIHsKCiAgZm9yZWFjaCAoJFBhdGggaW4gJHNkdGlkRXh0ZW5zaW9uRmlsZXNJTm9kZXMuVmVyc2lvbkluZm8uRmlsZU5hbWUpIHsKCiAgICAkc2R0aWRGaWxlT2JqZWN0ID0gIiIgfCBTZWxlY3QtT2JqZWN0IC1Qcm9wZXJ0eSAiU291cmNlIiwiUGF0aCIKCiAgICAkc2R0aWRGaWxlT2JqZWN0LiJTb3VyY2UiID0gJFNvdXJjZQogICAgJHNkdGlkRmlsZU9iamVjdC4iUGF0aCIgPSAkUGF0aAoKICAgIFt2b2lkXSRBcnJheU9mc2R0aWRGaWxlcy5BZGQoJHNkdGlkRmlsZU9iamVjdCkKCiAgfQoKICBpZiAoJEFycmF5T2ZzZHRpZEZpbGVzLmNvdW50IC1ndCAwKSB7CgogICAgJFVzZXJPYmplY3QgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSAic2R0aWQgRmlsZXMiIC1WYWx1ZSAkQXJyYXlPZnNkdGlkRmlsZXMKCiAgICBpZiAoJG8pIHsKICAgICAgJEFycmF5T2ZzZHRpZEZpbGVzIHwgU2VsZWN0LU9iamVjdCAqIHwgRXhwb3J0LUNTViAtQXBwZW5kIC1QYXRoICgkT3V0cHV0RGlyZWN0b3J5ICsgIlxSU0Egc2R0aWQgRmlsZXMuY3N2IikgLU5vVHlwZUluZm9ybWF0aW9uCiAgICB9IGVsc2UgewogICAgICBXcml0ZS1PdXRwdXQgIlJTQSBUb2tlbnMgKHNkdGlkKSIKICAgICAgJEFycmF5T2ZzZHRpZEZpbGVzIHwgU2VsZWN0LU9iamVjdCAqIHwgRm9ybWF0LUxpc3QgfCBPdXQtU3RyaW5nCiAgICB9CgogIH0KCn0gIyBQcm9jZXNzIHNkdGlkIEZpbGUKCmZ1bmN0aW9uIFByb2Nlc3NSRFBGaWxlKCRSRFBFeHRlbnNpb25GaWxlc0lOb2RlcykgewogIAogICMgRXh0cmFjdGluZyB0aGUgZmlsZXBhdGggZnJvbSB0aGUgaS1ub2RlIGluZm9ybWF0aW9uIHN0b3JlZCBpbiBSRFBFeHRlbnNpb25GaWxlc0lOb2RlcwogIGZvcmVhY2ggKCRQYXRoIGluICRSRFBFeHRlbnNpb25GaWxlc0lOb2Rlcy5WZXJzaW9uSW5mby5GaWxlTmFtZSkgewogICAgCiAgICAkUkRQRmlsZU9iamVjdCA9ICIiIHwgU2VsZWN0LU9iamVjdCAtUHJvcGVydHkgIlNvdXJjZSIsIlBhdGgiLCJIb3N0bmFtZSIsIkdhdGV3YXkiLCJQcm9tcHRzIGZvciBDcmVkZW50aWFscyIsIkFkbWluaXN0cmF0aXZlIFNlc3Npb24iCgogICAgJFJEUEZpbGVPYmplY3QuIlNvdXJjZSIgPSAoSG9zdG5hbWUpCgogICAgIyBUaGUgbmV4dCBzZXZlcmFsIGxpbmVzIHVzZSByZWdleCBwYXR0ZXJuIG1hdGNoaW5nIHRvIHN0b3JlIHJlbGV2YW50IGluZm8gZnJvbSB0aGUgLnJkcCBmaWxlIGludG8gb3VyIG9iamVjdAogICAgJFJEUEZpbGVPYmplY3QuIlBhdGgiID0gJFBhdGggCiAgICAkUkRQRmlsZU9iamVjdC4iSG9zdG5hbWUiID0gdHJ5IHsgKFNlbGVjdC1TdHJpbmcgLVBhdGggJFBhdGggLVBhdHRlcm4gImZ1bGwgYWRkcmVzczpbYS16XTooLiopIikuTWF0Y2hlcy5Hcm91cHNbMV0uVmFsdWUgfSBjYXRjaCB7fQogICAgJFJEUEZpbGVPYmplY3QuIkdhdGV3YXkiID0gdHJ5IHsgKFNlbGVjdC1TdHJpbmcgLVBhdGggJFBhdGggLVBhdHRlcm4gImdhdGV3YXlob3N0bmFtZTpbYS16XTooLiopIikuTWF0Y2hlcy5Hcm91cHNbMV0uVmFsdWUgfSBjYXRjaCB7fQogICAgJFJEUEZpbGVPYmplY3QuIkFkbWluaXN0cmF0aXZlIFNlc3Npb24iID0gdHJ5IHsgKFNlbGVjdC1TdHJpbmcgLVBhdGggJFBhdGggLVBhdHRlcm4gImFkbWluaXN0cmF0aXZlIHNlc3Npb246W2Etel06KC4qKSIpLk1hdGNoZXMuR3JvdXBzWzFdLlZhbHVlIH0gY2F0Y2gge30KICAgICRSRFBGaWxlT2JqZWN0LiJQcm9tcHRzIGZvciBDcmVkZW50aWFscyIgPSB0cnkgeyAoU2VsZWN0LVN0cmluZyAtUGF0aCAkUGF0aCAtUGF0dGVybiAicHJvbXB0IGZvciBjcmVkZW50aWFsczpbYS16XTooLiopIikuTWF0Y2hlcy5Hcm91cHNbMV0uVmFsdWUgfSBjYXRjaCB7fQoKICAgIGlmICghJFJEUEZpbGVPYmplY3QuIkFkbWluaXN0cmF0aXZlIFNlc3Npb24iIC1vciAhJFJEUEZpbGVPYmplY3QuIkFkbWluaXN0cmF0aXZlIFNlc3Npb24iIC1lcSAwKSB7CiAgICAgICRSRFBGaWxlT2JqZWN0LiJBZG1pbmlzdHJhdGl2ZSBTZXNzaW9uIiA9ICJEb2VzIG5vdCBjb25uZWN0IHRvIGFkbWluIHNlc3Npb24gb24gcmVtb3RlIGhvc3QiCiAgICB9IGVsc2UgewogICAgICAkUkRQRmlsZU9iamVjdC4iQWRtaW5pc3RyYXRpdmUgU2Vzc2lvbiIgPSAiQ29ubmVjdHMgdG8gYWRtaW4gc2Vzc2lvbiBvbiByZW1vdGUgaG9zdCIKICAgIH0KICAgIGlmICghJFJEUEZpbGVPYmplY3QuIlByb21wdHMgZm9yIENyZWRlbnRpYWxzIiAtb3IgJFJEUEZpbGVPYmplY3QuIlByb21wdHMgZm9yIENyZWRlbnRpYWxzIiAtZXEgMCkgewogICAgICAkUkRQRmlsZU9iamVjdC4iUHJvbXB0cyBmb3IgQ3JlZGVudGlhbHMiID0gIk5vIgogICAgfSBlbHNlIHsKICAgICAgJFJEUEZpbGVPYmplY3QuIlByb21wdHMgZm9yIENyZWRlbnRpYWxzIiA9ICJZZXMiCiAgICB9CgogICAgW3ZvaWRdJEFycmF5T2ZSRFBGaWxlcy5BZGQoJFJEUEZpbGVPYmplY3QpCgogIH0KCiAgaWYgKCRBcnJheU9mUkRQRmlsZXMuY291bnQgLWd0IDApIHsKCiAgICAkVXNlck9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lICJSRFAgRmlsZXMiIC1WYWx1ZSAkQXJyYXlPZlJEUEZpbGVzCgogICAgaWYgKCRvKSB7CiAgICAgICRBcnJheU9mUkRQRmlsZXMgfCBTZWxlY3QtT2JqZWN0ICogfCBFeHBvcnQtQ1NWIC1BcHBlbmQgLVBhdGggKCRPdXRwdXREaXJlY3RvcnkgKyAiXE1pY3Jvc29mdCByZHAgRmlsZXMuY3N2IikgLU5vVHlwZUluZm9ybWF0aW9uCiAgICB9IGVsc2UgewogICAgICBXcml0ZS1PdXRwdXQgIk1pY3Jvc29mdCBSRFAgQ29ubmVjdGlvbiBGaWxlcyAoLnJkcCkiCiAgICAgICRBcnJheU9mUkRQRmlsZXMgfCBTZWxlY3QtT2JqZWN0ICogfCBGb3JtYXQtTGlzdCB8IE91dC1TdHJpbmcKICAgIH0KCiAgfQoKfSAjIFByb2Nlc3MgUkRQIEZpbGUKCmZ1bmN0aW9uIFByb2Nlc3NQUEtGaWxlKCRQUEtFeHRlbnNpb25GaWxlc0lOb2RlcykgewoKICAjIEV4dHJhY3RpbmcgdGhlIGZpbGVwYXRoIGZyb20gdGhlIGktbm9kZSBpbmZvcm1hdGlvbiBzdG9yZWQgaW4gUFBLRXh0ZW5zaW9uRmlsZXNJTm9kZXMKICBmb3JlYWNoICgkUGF0aCBpbiAkUFBLRXh0ZW5zaW9uRmlsZXNJTm9kZXMuVmVyc2lvbkluZm8uRmlsZU5hbWUpIHsKCiAgICAjIFByaXZhdGUgS2V5IEVuY3J5cHRpb24gcHJvcGVydHkgaWRlbnRpZmllcyB3aGV0aGVyIHRoZSBwcml2YXRlIGtleSBpbiB0aGlzIGZpbGUgaXMgZW5jcnlwdGVkIG9yIGlmIGl0IGNhbiBiZSB1c2VkIGFzIGlzCiAgICAkUFBLRmlsZU9iamVjdCA9ICIiIHwgU2VsZWN0LU9iamVjdCAtUHJvcGVydHkgIlNvdXJjZSIsIlBhdGgiLCJQcm90b2NvbCIsIkNvbW1lbnQiLCJQcml2YXRlIEtleSBFbmNyeXB0aW9uIiwiUHJpdmF0ZSBLZXkiLCJQcml2YXRlIE1BQyIKCiAgICAkUFBLRmlsZU9iamVjdC4iU291cmNlIiA9IChIb3N0bmFtZSkKCiAgICAjIFRoZSBuZXh0IHNldmVyYWwgbGluZXMgdXNlIHJlZ2V4IHBhdHRlcm4gbWF0Y2hpbmcgdG8gc3RvcmUgcmVsZXZhbnQgaW5mbyBmcm9tIHRoZSAucHBrIGZpbGUgaW50byBvdXIgb2JqZWN0CiAgICAkUFBLRmlsZU9iamVjdC4iUGF0aCIgPSAkUGF0aAoKICAgICRQUEtGaWxlT2JqZWN0LiJQcm90b2NvbCIgPSB0cnkgeyAoU2VsZWN0LVN0cmluZyAtUGF0aCAkUGF0aCAtUGF0dGVybiAiOiAoLiopIiAtQ29udGV4dCAwLDApLk1hdGNoZXMuR3JvdXBzWzFdLlZhbHVlIH0gY2F0Y2gge30KICAgICRQUEtGaWxlT2JqZWN0LiJQcml2YXRlIEtleSBFbmNyeXB0aW9uIiA9IHRyeSB7IChTZWxlY3QtU3RyaW5nIC1QYXRoICRQYXRoIC1QYXR0ZXJuICJFbmNyeXB0aW9uOiAoLiopIikuTWF0Y2hlcy5Hcm91cHNbMV0uVmFsdWUgfSBjYXRjaCB7fQogICAgJFBQS0ZpbGVPYmplY3QuIkNvbW1lbnQiID0gdHJ5IHsgKFNlbGVjdC1TdHJpbmcgLVBhdGggJFBhdGggLVBhdHRlcm4gIkNvbW1lbnQ6ICguKikiKS5NYXRjaGVzLkdyb3Vwc1sxXS5WYWx1ZSB9IGNhdGNoIHt9CiAgICAkTnVtYmVyT2ZQcml2YXRlS2V5TGluZXMgPSB0cnkgeyAoU2VsZWN0LVN0cmluZyAtUGF0aCAkUGF0aCAtUGF0dGVybiAiUHJpdmF0ZS1MaW5lczogKC4qKSIpLk1hdGNoZXMuR3JvdXBzWzFdLlZhbHVlIH0gY2F0Y2gge30KICAgICRQUEtGaWxlT2JqZWN0LiJQcml2YXRlIEtleSIgPSB0cnkgeyAoU2VsZWN0LVN0cmluZyAtUGF0aCAkUGF0aCAtUGF0dGVybiAiUHJpdmF0ZS1MaW5lczogKC4qKSIgLUNvbnRleHQgMCwkTnVtYmVyT2ZQcml2YXRlS2V5TGluZXMpLkNvbnRleHQuUG9zdENvbnRleHQgLUpvaW4gIiIgfSBjYXRjaCB7fQogICAgJFBQS0ZpbGVPYmplY3QuIlByaXZhdGUgTUFDIiA9IHRyeSB7IChTZWxlY3QtU3RyaW5nIC1QYXRoICRQYXRoIC1QYXR0ZXJuICJQcml2YXRlLU1BQzogKC4qKSIpLk1hdGNoZXMuR3JvdXBzWzFdLlZhbHVlIH0gY2F0Y2gge30KCiAgICAjIEFkZCB0aGUgb2JqZWN0IHdlIGp1c3QgY3JlYXRlZCB0byB0aGUgYXJyYXkgb2YgLnBwayBmaWxlIG9iamVjdHMKICAgIFt2b2lkXSRBcnJheU9mUFBLRmlsZXMuQWRkKCRQUEtGaWxlT2JqZWN0KQoKICB9CgogIGlmICgkQXJyYXlPZlBQS0ZpbGVzLmNvdW50IC1ndCAwKSB7CgogICAgJFVzZXJPYmplY3QgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSAiUFBLIEZpbGVzIiAtVmFsdWUgJEFycmF5T2ZQUEtGaWxlcwoKICAgIGlmICgkbykgewogICAgICAkQXJyYXlPZlBQS0ZpbGVzIHwgU2VsZWN0LU9iamVjdCAqIHwgRXhwb3J0LUNTViAtQXBwZW5kIC1QYXRoICgkT3V0cHV0RGlyZWN0b3J5ICsgIlxQdVRUWSBwcGsgRmlsZXMuY3N2IikgLU5vVHlwZUluZm9ybWF0aW9uCiAgICB9IGVsc2UgewogICAgICBXcml0ZS1PdXRwdXQgIlB1VFRZIFByaXZhdGUgS2V5IEZpbGVzICgucHBrKSIKICAgICAgJEFycmF5T2ZQUEtGaWxlcyB8IFNlbGVjdC1PYmplY3QgKiB8IEZvcm1hdC1MaXN0IHwgT3V0LVN0cmluZwogICAgfQoKICB9Cgp9ICMgUHJvY2VzcyBQUEsgRmlsZQoKZnVuY3Rpb24gUHJvY2Vzc0ZpbGVaaWxsYUZpbGUoJEZpbGVaaWxsYVhNTCkgewoKICAjIExvY2F0ZSBhbGwgPFNlcnZlcj4gbm9kZXMgKGFrYSBzZXNzaW9uIG5vZGVzKSwgaXRlcmF0ZSBvdmVyIHRoZW0KICBmb3JlYWNoKCRGaWxlWmlsbGFTZXNzaW9uIGluICRGaWxlWmlsbGFYTUwuU2VsZWN0Tm9kZXMoJy8vRmlsZVppbGxhMy9TZXJ2ZXJzL1NlcnZlcicpKSB7CiAgICAgICMgSGFzaHRhYmxlIHRvIHN0b3JlIGVhY2ggc2Vzc2lvbidzIGRhdGEKICAgICAgJEZpbGVaaWxsYVNlc3Npb25IYXNoID0gQHt9CgogICAgICAjIEl0ZXJhdGVzIG92ZXIgZWFjaCBjaGlsZCBub2RlIHVuZGVyIDxTZXJ2ZXI+IChha2Egc2Vzc2lvbikKICAgICAgJEZpbGVaaWxsYVNlc3Npb24uQ2hpbGROb2RlcyB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAkRmlsZVppbGxhU2Vzc2lvbkhhc2hbIlNvdXJjZSJdID0gJFNvdXJjZQogICAgICAgICAgIyBJZiB2YWx1ZSBleGlzdHMsIG1ha2UgYSBrZXktdmFsdWUgcGFpciBmb3IgaXQgaW4gdGhlIGhhc2ggdGFibGUKICAgICAgICAgIGlmICgkXy5Jbm5lclRleHQpIHsKICAgICAgICAgICAgICBpZiAoJF8uTmFtZSAtZXEgIlBhc3MiKSB7CiAgICAgICAgICAgICAgICAgICRGaWxlWmlsbGFTZXNzaW9uSGFzaFsiUGFzc3dvcmQiXSA9ICRfLklubmVyVGV4dAogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICMgUG9wdWxhdGUgc2Vzc2lvbiBkYXRhIGJhc2VkIG9uIHRoZSBub2RlIG5hbWUKICAgICAgICAgICAgICAgICAgJEZpbGVaaWxsYVNlc3Npb25IYXNoWyRfLk5hbWVdID0gJF8uSW5uZXJUZXh0CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIAogICAgICAgICAgfQoKICAgICAgfQoKICAgICMgQ3JlYXRlIG9iamVjdCBmcm9tIGNvbGxlY3RlZCBkYXRhLCBleGNsdWRpbmcgc29tZSB0cml2aWFsIGluZm9ybWF0aW9uCiAgICBbdm9pZF0kQXJyYXlPZkZpbGVaaWxsYVNlc3Npb25zLkFkZCgoTmV3LU9iamVjdCBQU09iamVjdCAtUHJvcGVydHkgJEZpbGVaaWxsYVNlc3Npb25IYXNoIHwgU2VsZWN0LU9iamVjdCAtUHJvcGVydHkgKiAtRXhjbHVkZVByb3BlcnR5ICIjdGV4dCIsTG9nb25UeXBlLFR5cGUsQnlwYXNzUHJveHksU3luY0Jyb3dzaW5nLFBhc3ZNb2RlLERpcmVjdG9yeUNvbXBhcmlzb24sTWF4aW11bU11bHRpcGxlQ29ubmVjdGlvbnMsRW5jb2RpbmdUeXBlLFRpbWV6b25lT2Zmc2V0LENvbG91cikpCiAgICAgCiAgfSAjIEZvckVhY2ggRmlsZVppbGxhU2Vzc2lvbiBpbiBGaWxlWmlsbGFYTUwuU2VsZWN0Tm9kZXMoKQogIAogICMgYmFzZTY0X2RlY29kZSB0aGUgc3RvcmVkIGVuY29kZWQgc2Vzc2lvbiBwYXNzd29yZHMsIGFuZCBkZWNvZGUgcHJvdG9jb2wKICBmb3JlYWNoICgkU2Vzc2lvbiBpbiAkQXJyYXlPZkZpbGVaaWxsYVNlc3Npb25zKSB7CiAgICAgICRTZXNzaW9uLlBhc3N3b3JkID0gW1N5c3RlbS5UZXh0LkVuY29kaW5nXTo6QVNDSUkuR2V0U3RyaW5nKFtTeXN0ZW0uQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmcoJFNlc3Npb24uUGFzc3dvcmQpKQogICAgICBpZiAoJFNlc3Npb24uUHJvdG9jb2wgLWVxICIwIikgewogICAgICAgICRTZXNzaW9uLlByb3RvY29sID0gIlVzZSBGVFAgb3ZlciBUTFMgaWYgYXZhaWxhYmxlIgogICAgICB9IGVsc2VpZiAoJFNlc3Npb24uUHJvdG9jb2wgLWVxIDEpIHsKICAgICAgICAkU2Vzc2lvbi5Qcm90b2NvbCA9ICJVc2UgU0ZUUCIKICAgICAgfSBlbHNlaWYgKCRTZXNzaW9uLlByb3RvY29sIC1lcSAzKSB7CiAgICAgICAgJFNlc3Npb24uUHJvdG9jb2wgPSAiUmVxdWlyZSBpbXBsaWNpdCBGVFAgb3ZlciBUTFMiCiAgICAgIH0gZWxzZWlmICgkU2Vzc2lvbi5Qcm90b2NvbCAtZXEgNCkgewogICAgICAgICRTZXNzaW9uLlByb3RvY29sID0gIlJlcXVpcmUgZXhwbGljaXQgRlRQIG92ZXIgVExTIgogICAgICB9IGVsc2VpZiAoJFNlc3Npb24uUHJvdG9jb2wgLWVxIDYpIHsKICAgICAgICAkU2Vzc2lvbi5Qcm90b2NvbCA9ICJPbmx5IHVzZSBwbGFpbiBGVFAgKGluc2VjdXJlKSIKICAgICAgfSAKICB9CgogIGlmICgkbykgewogICAgJEFycmF5T2ZGaWxlWmlsbGFTZXNzaW9ucyB8IEV4cG9ydC1DU1YgLUFwcGVuZCAtUGF0aCAoJE91dHB1dERpcmVjdG9yeSArICJcRmlsZVppbGxhLmNzdiIpIC1Ob1R5cGVJbmZvcm1hdGlvbgogIH0gZWxzZSB7CiAgICBXcml0ZS1PdXRwdXQgIkZpbGVaaWxsYSBTZXNzaW9ucyIKICAgICRBcnJheU9mRmlsZVppbGxhU2Vzc2lvbnMgfCBGb3JtYXQtTGlzdCB8IE91dC1TdHJpbmcKICB9CgogICMgQWRkIHRoZSBhcnJheSBvZiBGaWxlWmlsbGEgc2Vzc2lvbiBvYmplY3RzIHRvIHRoZSB0YXJnZXQgdXNlciBvYmplY3QKICAkVXNlck9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lICJGaWxlWmlsbGEgU2Vzc2lvbnMiIC1WYWx1ZSAkQXJyYXlPZkZpbGVaaWxsYVNlc3Npb25zCgp9ICMgUHJvY2Vzc0ZpbGVaaWxsYUZpbGUKCmZ1bmN0aW9uIFByb2Nlc3NTdXBlclB1VFRZRmlsZSgkU3VwZXJQdVRUWVhNTCkgewoKICBmb3JlYWNoKCRTdXBlclB1VFRZU2Vzc2lvbnMgaW4gJFN1cGVyUHVUVFlYTUwuQXJyYXlPZlNlc3Npb25EYXRhLlNlc3Npb25EYXRhKSB7CgogICAgZm9yZWFjaCAoJFN1cGVyUHVUVFlTZXNzaW9uIGluICRTdXBlclB1VFRZU2Vzc2lvbnMpIHsgCiAgICAgIGlmICgkU3VwZXJQdVRUWVNlc3Npb24gLW5lICRudWxsKSB7CgogICAgICAgICRTdXBlclB1VFRZU2Vzc2lvbk9iamVjdCA9ICIiIHwgU2VsZWN0LU9iamVjdCAtUHJvcGVydHkgIlNvdXJjZSIsIlNlc3Npb25JZCIsIlNlc3Npb25OYW1lIiwiSG9zdCIsIlVzZXJuYW1lIiwiRXh0cmFBcmdzIiwiUG9ydCIsIlB1dHR5IFNlc3Npb24iCgogICAgICAgICRTdXBlclB1VFRZU2Vzc2lvbk9iamVjdC4iU291cmNlIiA9ICRTb3VyY2UKICAgICAgICAkU3VwZXJQdVRUWVNlc3Npb25PYmplY3QuIlNlc3Npb25JZCIgPSAkU3VwZXJQdVRUWVNlc3Npb24uU2Vzc2lvbklkCiAgICAgICAgJFN1cGVyUHVUVFlTZXNzaW9uT2JqZWN0LiJTZXNzaW9uTmFtZSIgPSAkU3VwZXJQdVRUWVNlc3Npb24uU2Vzc2lvbk5hbWUKICAgICAgICAkU3VwZXJQdVRUWVNlc3Npb25PYmplY3QuIkhvc3QiID0gJFN1cGVyUHVUVFlTZXNzaW9uLkhvc3QKICAgICAgICAkU3VwZXJQdVRUWVNlc3Npb25PYmplY3QuIlVzZXJuYW1lIiA9ICRTdXBlclB1VFRZU2Vzc2lvbi5Vc2VybmFtZQogICAgICAgICRTdXBlclB1VFRZU2Vzc2lvbk9iamVjdC4iRXh0cmFBcmdzIiA9ICRTdXBlclB1VFRZU2Vzc2lvbi5FeHRyYUFyZ3MKICAgICAgICAkU3VwZXJQdVRUWVNlc3Npb25PYmplY3QuIlBvcnQiID0gJFN1cGVyUHVUVFlTZXNzaW9uLlBvcnQKICAgICAgICAkU3VwZXJQdVRUWVNlc3Npb25PYmplY3QuIlB1VFRZIFNlc3Npb24iID0gJFN1cGVyUHVUVFlTZXNzaW9uLlB1dHR5U2Vzc2lvbgoKICAgICAgICBbdm9pZF0kQXJyYXlPZlN1cGVyUHVUVFlTZXNzaW9ucy5BZGQoJFN1cGVyUHVUVFlTZXNzaW9uT2JqZWN0KQogICAgICB9IAogICAgfQoKICB9ICMgRm9yRWFjaCBTdXBlclB1VFRZU2Vzc2lvbnMKCiAgaWYgKCRvKSB7CiAgICAkQXJyYXlPZlN1cGVyUHVUVFlTZXNzaW9ucyB8IEV4cG9ydC1DU1YgLUFwcGVuZCAtUGF0aCAoJE91dHB1dERpcmVjdG9yeSArICJcU3VwZXJQdVRUWS5jc3YiKSAtTm9UeXBlSW5mb3JtYXRpb24KICB9IGVsc2UgewogICAgV3JpdGUtT3V0cHV0ICJTdXBlclB1VFRZIFNlc3Npb25zIgogICAgJEFycmF5T2ZTdXBlclB1VFRZU2Vzc2lvbnMgfCBPdXQtU3RyaW5nCiAgfQoKICAjIEFkZCB0aGUgYXJyYXkgb2YgU3VwZXJQdVRUWSBzZXNzaW9uIG9iamVjdHMgdG8gdGhlIHRhcmdldCB1c2VyIG9iamVjdAogICRVc2VyT2JqZWN0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgIlN1cGVyUHVUVFkgU2Vzc2lvbnMiIC1WYWx1ZSAkQXJyYXlPZlN1cGVyUHVUVFlTZXNzaW9ucwoKfSAjIFByb2Nlc3NTdXBlclB1VFRZRmlsZQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyBXaW5TQ1AgRGVvYmZ1c2NhdGlvbiBIZWxwZXIgRnVuY3Rpb25zCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiMgR2V0cyBhbGwgZG9tYWluLWpvaW5lZCBjb21wdXRlciBuYW1lcyBhbmQgcHJvcGVydGllcyBpbiBvbmUgb2JqZWN0CmZ1bmN0aW9uIEdldENvbXB1dGVyc0Zyb21BY3RpdmVEaXJlY3RvcnkgewoKICAkc3RyQ2F0ZWdvcnkgPSAiY29tcHV0ZXIiCiAgJG9iakRvbWFpbiA9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkRpcmVjdG9yeUVudHJ5CiAgJG9ialNlYXJjaGVyID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuRGlyZWN0b3J5U2VhcmNoZXIKICAkb2JqU2VhcmNoZXIuU2VhcmNoUm9vdCA9ICRvYmpEb21haW4KICAkb2JqU2VhcmNoZXIuRmlsdGVyID0gKCIob2JqZWN0Q2F0ZWdvcnk9JHN0ckNhdGVnb3J5KSIpCgogICRjb2xQcm9wbGlzdCA9ICJuYW1lIgoKICBmb3JlYWNoICgkaSBpbiAkY29sUHJvcExpc3QpeyRvYmpTZWFyY2hlci5Qcm9wZXJ0aWVzVG9Mb2FkLkFkZCgkaSl9CgogIHJldHVybiAkb2JqU2VhcmNoZXIuRmluZEFsbCgpCgp9CgpmdW5jdGlvbiBEZWNyeXB0TmV4dENoYXJhY3RlcldpblNDUCgkcmVtYWluaW5nUGFzcykgewoKICAjIENyZWF0ZXMgYW4gb2JqZWN0IHdpdGggZmxhZyBhbmQgcmVtYWluaW5nUGFzcyBwcm9wZXJ0aWVzCiAgJGZsYWdBbmRQYXNzID0gIiIgfCBTZWxlY3QtT2JqZWN0IC1Qcm9wZXJ0eSBmbGFnLHJlbWFpbmluZ1Bhc3MKCiAgIyBTaGlmdCBsZWZ0IDQgYml0cyBlcXVpdmFsZW50IGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSB3aXRoIG9sZGVyIFBvd2VyU2hlbGwgdmVyc2lvbnMKICAkZmlyc3R2YWwgPSAoIjAxMjM0NTY3ODlBQkNERUYiLmluZGV4T2YoJHJlbWFpbmluZ1Bhc3NbMF0pICogMTYpCiAgJHNlY29uZHZhbCA9ICIwMTIzNDU2Nzg5QUJDREVGIi5pbmRleE9mKCRyZW1haW5pbmdQYXNzWzFdKQoKICAkQWRkZWQgPSAkZmlyc3R2YWwgKyAkc2Vjb25kdmFsCgogICRkZWNyeXB0ZWRSZXN1bHQgPSAoKCgtYm5vdCAoJEFkZGVkIC1ieG9yICRNYWdpYykpICUgMjU2KSArIDI1NikgJSAyNTYKCiAgJGZsYWdBbmRQYXNzLmZsYWcgPSAkZGVjcnlwdGVkUmVzdWx0CiAgJGZsYWdBbmRQYXNzLnJlbWFpbmluZ1Bhc3MgPSAkcmVtYWluaW5nUGFzcy5TdWJzdHJpbmcoMikKCiAgcmV0dXJuICRmbGFnQW5kUGFzcwoKfQoKZnVuY3Rpb24gRGVjcnlwdFdpblNDUFBhc3N3b3JkKCRTZXNzaW9uSG9zdG5hbWUsICRTZXNzaW9uVXNlcm5hbWUsICRQYXNzd29yZCkgewoKICAkQ2hlY2tGbGFnID0gMjU1CiAgJE1hZ2ljID0gMTYzCgogICRsZW4gPSAwCiAgJGtleSA9ICAkU2Vzc2lvbkhvc3RuYW1lICsgJFNlc3Npb25Vc2VybmFtZQogICR2YWx1ZXMgPSBEZWNyeXB0TmV4dENoYXJhY3RlcldpblNDUCgkUGFzc3dvcmQpCgogICRzdG9yZWRGbGFnID0gJHZhbHVlcy5mbGFnIAoKICBpZiAoJHZhbHVlcy5mbGFnIC1lcSAkQ2hlY2tGbGFnKSB7CiAgICAkdmFsdWVzLnJlbWFpbmluZ1Bhc3MgPSAkdmFsdWVzLnJlbWFpbmluZ1Bhc3MuU3Vic3RyaW5nKDIpCiAgICAkdmFsdWVzID0gRGVjcnlwdE5leHRDaGFyYWN0ZXJXaW5TQ1AoJHZhbHVlcy5yZW1haW5pbmdQYXNzKQogIH0KCiAgJGxlbiA9ICR2YWx1ZXMuZmxhZwoKICAkdmFsdWVzID0gRGVjcnlwdE5leHRDaGFyYWN0ZXJXaW5TQ1AoJHZhbHVlcy5yZW1haW5pbmdQYXNzKQogICR2YWx1ZXMucmVtYWluaW5nUGFzcyA9ICR2YWx1ZXMucmVtYWluaW5nUGFzcy5TdWJzdHJpbmcoKCR2YWx1ZXMuZmxhZyAqIDIpKQoKICAkZmluYWxPdXRwdXQgPSAiIgogIGZvciAoJGk9MDsgJGkgLWx0ICRsZW47ICRpKyspIHsKICAgICR2YWx1ZXMgPSAoRGVjcnlwdE5leHRDaGFyYWN0ZXJXaW5TQ1AoJHZhbHVlcy5yZW1haW5pbmdQYXNzKSkKICAgICRmaW5hbE91dHB1dCArPSBbY2hhcl0kdmFsdWVzLmZsYWcKICB9CgogIGlmICgkc3RvcmVkRmxhZyAtZXEgJENoZWNrRmxhZykgewogICAgcmV0dXJuICRmaW5hbE91dHB1dC5TdWJzdHJpbmcoJGtleS5sZW5ndGgpCiAgfQoKICByZXR1cm4gJGZpbmFsT3V0cHV0Cgp9Cg==
