MSFT_xGroupResource.psm1,7e5855d339db9d990629264eb3ff8126,Scan result is 1. IsMalware: 0,IyBBIGdsb2JhbCB2YXJpYWJsZSB0aGF0IGNvbnRhaW5zIGxvY2FsaXplZCBtZXNzYWdlcy4KZGF0YSBMb2NhbGl6ZWREYXRhCnsKIyBjdWx0dXJlPSJlbi1VUyIKQ29udmVydEZyb20tU3RyaW5nRGF0YSBAJwpHcm91cFdpdGhOYW1lPUdyb3VwOiB7MH0KUmVtb3ZlT3BlcmF0aW9uPVJlbW92ZQpBZGRPcGVyYXRpb249QWRkClNldE9wZXJhdGlvbj1TZXQKQ29uZmlndXJhdGlvblN0YXJ0ZWQ9Q29uZmlndXJhdGlvbiBvZiBncm91cCB7MH0gc3RhcnRlZC4KQ29uZmlndXJhdGlvbkNvbXBsZXRlZD1Db25maWd1cmF0aW9uIG9mIGdyb3VwIHswfSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LgpHcm91cENyZWF0ZWQ9R3JvdXAgezB9IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5LgpHcm91cFVwZGF0ZWQ9R3JvdXAgezB9IHByb3BlcnRpZXMgdXBkYXRlZCBzdWNjZXNzZnVsbHkuCkdyb3VwUmVtb3ZlZD1Hcm91cCB7MH0gcmVtb3ZlZCBzdWNjZXNzZnVsbHkuCk5vQ29uZmlndXJhdGlvblJlcXVpcmVkPUdyb3VwIHswfSBleGlzdHMgb24gdGhpcyBub2RlIHdpdGggdGhlIGRlc2lyZWQgcHJvcGVydGllcy4gTm8gYWN0aW9uIHJlcXVpcmVkLgpOb0NvbmZpZ3VyYXRpb25SZXF1aXJlZEdyb3VwRG9lc05vdEV4aXN0PUdyb3VwIHswfSBkb2VzIG5vdCBleGlzdCBvbiB0aGlzIG5vZGUuIE5vIGFjdGlvbiByZXF1aXJlZC4KQ291bGROb3RGaW5kUHJpbmNpcGFsPUNvdWxkIG5vdCBmaW5kIGEgcHJpbmNpcGFsIHdpdGggdGhlIHByb3ZpZGVkIG5hbWUgW3swfV0KTWVtYmVyc0FuZEluY2x1ZGVFeGNsdWRlQ29uZmxpY3Q9VGhlIHswfSBhbmQgezF9IGFuZC9vciB7Mn0gcGFyYW1ldGVycyBjb25mbGljdC4gVGhlIHswfSBwYXJhbWV0ZXIgc2hvdWxkIG5vdCBiZSB1c2VkIGluIGFueSBjb21iaW5hdGlvbiB3aXRoIHRoZSB7MX0gYW5kIHsyfSBwYXJhbWV0ZXJzLgpNZW1iZXJzSXNOdWxsPVRoZSBNZW1iZXJzIHBhcmFtZXRlciB2YWx1ZSBpcyBudWxsLiBUaGUgezB9IHBhcmFtZXRlciBtdXN0IGJlIHByb3ZpZGVkIGlmIG5laXRoZXIgezF9IG5vciB7Mn0gaXMgcHJvdmlkZWQuCkluY2x1ZGVBbmRFeGNsdWRlQ29uZmxpY3Q9VGhlIHByaW5jaXBhbCB7MH0gaXMgaW5jbHVkZWQgaW4gYm90aCB7MX0gYW5kIHsyfSBwYXJhbWV0ZXIgdmFsdWVzLiBUaGUgc2FtZSBwcmluY2lwYWwgbXVzdCBub3QgYmUgaW5jbHVkZWQgaW4gYm90aCB7MX0gYW5kIHsyfSBwYXJhbWV0ZXIgdmFsdWVzLgpJbnZhbGlkR3JvdXBOYW1lPVRoZSBuYW1lIHswfSBjYW5ub3QgYmUgdXNlZC4gTmFtZXMgbWF5IG5vdCBjb25zaXN0IGVudGlyZWx5IG9mIHBlcmlvZHMgYW5kL29yIHNwYWNlcywgb3IgY29udGFpbiB0aGVzZSBjaGFyYWN0ZXJzOiB7MX0KR3JvdXBFeGlzdHM9QSBncm91cCB3aXRoIHRoZSBuYW1lIHswfSBleGlzdHMuCkdyb3VwRG9lc05vdEV4aXN0PUEgZ3JvdXAgd2l0aCB0aGUgbmFtZSB7MH0gZG9lcyBub3QgZXhpc3QuClByb3BlcnR5TWlzbWF0Y2g9VGhlIHZhbHVlIG9mIHRoZSB7MH0gcHJvcGVydHkgaXMgZXhwZWN0ZWQgdG8gYmUgezF9IGJ1dCBpdCBpcyB7Mn0uCk1lbWJlcnNOdW1iZXJNaXNtYXRjaD1Qcm9wZXJ0eSB7MH0uIFRoZSBudW1iZXIgb2YgcHJvdmlkZWQgdW5pcXVlIGdyb3VwIG1lbWJlcnMgezF9IGlzIGRpZmZlcmVudCBmcm9tIHRoZSBudW1iZXIgb2YgYWN0dWFsIGdyb3VwIG1lbWJlcnMgezJ9LgpNZW1iZXJzTWVtYmVyTWlzbWF0Y2g9QXQgbGVhc3Qgb25lIG1lbWJlciB7MH0gb2YgdGhlIHByb3ZpZGVkIHsxfSBwYXJhbWV0ZXIgZG9lcyBub3QgaGF2ZSBhIG1hdGNoIGluIHRoZSBleGlzdGluZyBncm91cCB7Mn0uCk1lbWJlclRvRXhjbHVkZU1hdGNoPUF0IGxlYXN0IG9uZSBtZW1iZXIgezB9IG9mIHRoZSBwcm92aWRlZCB7MX0gcGFyYW1ldGVyIGhhcyBhIG1hdGNoIGluIHRoZSBleGlzdGluZyBncm91cCB7Mn0uClJlc29sdmluZ0xvY2FsQWNjb3VudD1SZXNvbHZpbmcgezB9IGFzIGEgbG9jYWwgYWNjb3VudC4KUmVkaXJlY3REb21haW49UmVkaXJlY3RpbmcgdG8gZG9tYWluIHswfSBmb3IgYWNjb3VudCB7MX0uClJlc29sdmluZ0RvbWFpbkFjY291bnQ9UmVzb2x2aW5nIHswfSBpbiB0aGUgezF9IGRvbWFpbi4KUmVzb2x2aW5nVXNlcj1SZXNvbHZpbmcgezB9IGFzIGEgdXNlci4KUmVzb2x2aW5nR3JvdXA9UmVzb2x2aW5nIHswfSBhcyBhIGdyb3VwLgpSZXNvbHZpbmdDb21wdXRlcj1SZXNvbHZpbmcgezB9IGFzIGEgY29tcHV0ZXIuCkRvbWFpbkNyZWRlbnRpYWxzUmVxdWlyZWQ9Q3JlZGVudGlhbHMgYXJlIHJlcXVpcmVkIHRvIHJlc29sdmUgdGhlIGRvbWFpbiBhY2NvdW50IHswfS4KJ0AKfQoKQWRkLVR5cGUgLUFzc2VtYmx5TmFtZSAnU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50JwpJbXBvcnQtTG9jYWxpemVkRGF0YSBMb2NhbGl6ZWREYXRhIC1GaWxlTmFtZSBNU0ZUX3hHcm91cFJlc291cmNlLnN0cmluZ3MucHNkMQoKPCMKLlN5bm9wc2lzClRoZSBHZXQtVGFyZ2V0UmVzb3VyY2UgY21kbGV0LgojPgpmdW5jdGlvbiBHZXQtVGFyZ2V0UmVzb3VyY2UKewogICAgW091dHB1dFR5cGUoW1N5c3RlbS5Db2xsZWN0aW9ucy5IYXNodGFibGVdKV0KICAgIHBhcmFtCgkoCgkJW3BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCgkJW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KCQlbU3lzdGVtLlN0cmluZ10KCQkkR3JvdXBOYW1lCgkpCgogICAgU2V0LVN0cmljdE1vZGUgLVZlcnNpb24gTGF0ZXN0CgogICAgVmFsaWRhdGVHcm91cE5hbWUgLUdyb3VwTmFtZSAkR3JvdXBOYW1lCgogICAgIyBUcnkgdG8gZmluZCBhIGdyb3VwIGJ5IGl0cyBuYW1lLgogICAgJHByaW5jaXBhbENvbnRleHQgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5QcmluY2lwYWxDb250ZXh0IC1Bcmd1bWVudExpc3QgKFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuQ29udGV4dFR5cGVdOjpNYWNoaW5lKQogICAgJGdyb3VwID0gJG51bGwKCiAgICB0cnkKICAgIHsKICAgICAgICAkZ3JvdXAgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50Lkdyb3VwUHJpbmNpcGFsXTo6RmluZEJ5SWRlbnRpdHkoJHByaW5jaXBhbENvbnRleHQsICRHcm91cE5hbWUpOwogICAgICAgIGlmKCRncm91cCAtbmUgJG51bGwpCiAgICAgICAgewogICAgICAgICAgICAjIFRoZSBncm91cCBpcyBmb3VuZC4gRW51bWVyYXRlIGFsbCBncm91cCBtZW1iZXJzLgogICAgICAgICAgICAkbWVtYmVycyA9IFtTdHJpbmdbXV1AKEVudW1lcmF0ZU1lbWJlcnMgLUdyb3VwICRncm91cCkKCiAgICAgICAgICAgICMgUmV0dXJuIGFsbCBncm91cCBwcm9wZXJ0aWVzIGFuZCBFbnN1cmU9IlByZXNlbnQiLgogICAgICAgICAgICAkcmV0dXJuVmFsdWUgPSBAewogICAgCSAgICAgICAgICAgICAgICAgICAgICAgIEdyb3VwTmFtZSA9ICRncm91cC5OYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVuc3VyZSA9ICJQcmVzZW50IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZXNjcmlwdGlvbiA9ICRncm91cC5EZXNjcmlwdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZW1iZXJzID0gW1N5c3RlbS5TdHJpbmdbXV0gJG1lbWJlcnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gJHJldHVyblZhbHVlOwogICAgICAgIH0KCiAgICAgICAgIyBUaGUgZ3JvdXAgaXMgbm90IGZvdW5kLiBSZXR1cm4gRW5zdXJlPUFic2VudC4KICAgICAgICByZXR1cm4gQHsKICAgIAkgICAgICAgICAgICBHcm91cE5hbWUgPSAkR3JvdXBOYW1lOwogICAgICAgICAgICAgICAgICAgIEVuc3VyZSA9ICJBYnNlbnQiOwogICAgICAgICAgICAgICAgfQogICAgfQogICAgZmluYWxseQogICAgewogICAgICAgIGlmKCRncm91cCAtbmUgJG51bGwpCiAgICAgICAgewogICAgICAgICAgICAkZ3JvdXAuRGlzcG9zZSgpOwogICAgICAgIH0KCiAgICAgICAgJHByaW5jaXBhbENvbnRleHQuRGlzcG9zZSgpOwogICAgfQp9Cgo8IwouU3lub3BzaXMKVGhlIFNldC1UYXJnZXRSZXNvdXJjZSBjbWRsZXQuCiM+CmZ1bmN0aW9uIFNldC1UYXJnZXRSZXNvdXJjZQp7CiAgICBbQ21kbGV0QmluZGluZyhTdXBwb3J0c1Nob3VsZFByb2Nlc3M9JHRydWUpXQogICAgcGFyYW0KICAgICgKICAgICAgICBbcGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTeXN0ZW0uU3RyaW5nXQogICAgICAgICRHcm91cE5hbWUsCgogICAgICAgIFtWYWxpZGF0ZVNldCgiUHJlc2VudCIsICJBYnNlbnQiKV0KICAgICAgICBbU3lzdGVtLlN0cmluZ10KICAgICAgICAkRW5zdXJlID0gIlByZXNlbnQiLAoKICAgICAgICBbU3lzdGVtLlN0cmluZ10KICAgICAgICAkRGVzY3JpcHRpb24sCgogICAgICAgIFtTeXN0ZW0uU3RyaW5nW11dCiAgICAgICAgJE1lbWJlcnMsCgogICAgICAgIFtTeXN0ZW0uU3RyaW5nW11dCiAgICAgICAgJE1lbWJlcnNUb0luY2x1ZGUsCgogICAgICAgIFtTeXN0ZW0uU3RyaW5nW11dCiAgICAgICAgJE1lbWJlcnNUb0V4Y2x1ZGUsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgICRDcmVkZW50aWFsCgkpCgogICAgU2V0LVN0cmljdE1vZGUgLVZlcnNpb24gTGF0ZXN0CgogICAgVmFsaWRhdGVHcm91cE5hbWUgLUdyb3VwTmFtZSAkR3JvdXBOYW1lCgoKICAgICMgc3RvcmUgZGlzcG9zYWJsZSBvYmplY3RzIGluIGEgbGlzdCBmb3IgY2xlYW51cCBsYXRlci4KICAgICMgVGhpcyBpcyBuZWVkZWQgZm9yIHRoZSBjYXNlIHdoZXJlIGRvbWFpbiByZWRpcmVjdGlvbiBpcyByZXF1aXJlZAogICAgIyB0byByZXNvbHZlIGFuIGFjY291bnQuICBTaW5jZSB0aGUgbGlmZXRpbWUgb2YgdGhlIHJlc29sdmVkCiAgICAjIHByaW5jaXBhbCBpcyB0aGUgc2FtZSBhcyB0aGUgUHJpbmNpcGFsQ29udGV4dCwgd2UgbmVlZCB0bwogICAgIyBlbnN1cmUgIHRoZSBQcmluY2lwYWxDb250ZXh0IHJlbWFpbnMgbGl2ZSB1bnRpbCB3ZSdyZSBkb25lLgogICAgJGRpc3Bvc2FibGVzID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0CgogICAgdHJ5CiAgICB7CiAgICAgICAgIyBQcmluY2lwYWxDb250ZXh0IGZvciBkb21haW4gYWNjb3VudCByZXNvbHV0aW9uCiAgICAgICAgJGNyZWRlbnRpYWxQcmluY2lwYWxDb250ZXh0ID0gJG51bGwKICAgICAgICAjIFByaW5jaXBhbENvbnRleHQgZm9yIGxvY2FsIGFjY291bnQgcmVzb2x1dGlvbgogICAgICAgICRsb2NhbFByaW5jaXBhbENvbnRleHQgPSAkbnVsbAogICAgICAgICRncm91cCA9ICRudWxsCiAgICAgICAgW1N5c3RlbS5OZXQuTmV0d29ya0NyZWRlbnRpYWxdICRuZXR3b3JrQ3JlZGVudGlhbCA9ICRudWxsCgogICAgICAgIGlmKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgnQ3JlZGVudGlhbCcpKQogICAgICAgIHsKICAgICAgICAgICAgJG5ldHdvcmtDcmVkZW50aWFsID0gJENyZWRlbnRpYWwuR2V0TmV0d29ya0NyZWRlbnRpYWwoKTsKICAgICAgICAgICAgJGNyZWRlbnRpYWxQcmluY2lwYWxDb250ZXh0ID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuUHJpbmNpcGFsQ29udGV4dCAtQXJndW1lbnRMaXN0IChbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LkNvbnRleHRUeXBlXTo6RG9tYWluLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG5ldHdvcmtDcmVkZW50aWFsLkRvbWFpbiwgJG5ldHdvcmtDcmVkZW50aWFsLlVzZXJOYW1lLCAkbmV0d29ya0NyZWRlbnRpYWwuUGFzc3dvcmQpCiAgICAgICAgICAgICRkaXNwb3NhYmxlcy5BZGQoJGNyZWRlbnRpYWxQcmluY2lwYWxDb250ZXh0KSB8IG91dC1udWxsCiAgICAgICAgfQoKICAgICAgICAjIENyZWF0ZSBsb2NhbCBtYWNoaW5lIGNvbnRleHQuCiAgICAgICAgJGxvY2FsUHJpbmNpcGFsQ29udGV4dCA9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LlByaW5jaXBhbENvbnRleHQgLUFyZ3VtZW50TGlzdCAoW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5Db250ZXh0VHlwZV06Ok1hY2hpbmUpCiAgICAgICAgJGRpc3Bvc2FibGVzLkFkZCgkbG9jYWxQcmluY2lwYWxDb250ZXh0KSB8IG91dC1udWxsCgogICAgICAgICMgVHJ5IHRvIGZpbmQgYSBncm91cCBieSBpdHMgbmFtZS4KICAgICAgICAkZ3JvdXAgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50Lkdyb3VwUHJpbmNpcGFsXTo6RmluZEJ5SWRlbnRpdHkoJGxvY2FsUHJpbmNpcGFsQ29udGV4dCwgJEdyb3VwTmFtZSk7CiAgICAgICAgJGRpc3Bvc2FibGVzLkFkZCgkZ3JvdXApIHwgb3V0LW51bGwKCiAgICAgICAgaWYoJEVuc3VyZSAtZXEgIlByZXNlbnQiKQogICAgICAgIHsKICAgICAgICAgICAgIyBFbnN1cmUgaXMgc2V0IHRvICJQcmVzZW50Ii4KCiAgICAgICAgICAgIFtib29sXSAkd2hhdElmU2hvdWxkUHJvY2VzcyA9ICR0cnVlOwogICAgICAgICAgICBbYm9vbF0gJGdyb3VwRXhpc3RzID0gJGZhbHNlOwogICAgICAgICAgICBbYm9vbF0gJHNhdmVDaGFuZ2VzID0gJGZhbHNlOwoKICAgICAgICAgICAgaWYoJGdyb3VwIC1lcSAkbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIyBBIGdyb3VwIGRvZXMgbm90IGV4aXN0LiBDaGVjayBXaGF0SWYgZm9yIGFkZGluZyBhIGdyb3VwLgogICAgICAgICAgICAgICAgJHdoYXRJZlNob3VsZFByb2Nlc3MgPSAkcHNjbWRsZXQuU2hvdWxkUHJvY2VzcygkTG9jYWxpemVkRGF0YS5Hcm91cFdpdGhOYW1lIC1mICRHcm91cE5hbWUsICRMb2NhbGl6ZWREYXRhLkFkZE9wZXJhdGlvbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIEEgZ3JvdXAgZXhpc3RzLgogICAgICAgICAgICAgICAgJGdyb3VwRXhpc3RzID0gJHRydWU7CgogICAgICAgICAgICAgICAgIyBDaGVjayBXaGF0SWYgZm9yIHNldHRpbmcgYSBncm91cC4KICAgICAgICAgICAgICAgICR3aGF0SWZTaG91bGRQcm9jZXNzID0gJHBzY21kbGV0LlNob3VsZFByb2Nlc3MoJExvY2FsaXplZERhdGEuR3JvdXBXaXRoTmFtZSAtZiAkR3JvdXBOYW1lLCAkTG9jYWxpemVkRGF0YS5TZXRPcGVyYXRpb24pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkd2hhdElmU2hvdWxkUHJvY2VzcykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYoLW5vdCAkZ3JvdXBFeGlzdHMpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIyBUaGUgZ3JvdXAgd2l0aCB0aGUgcHJvdmlkZWQgbmFtZSBkb2VzIG5vdCBleGlzdC4gQWRkIGEgbmV3IGdyb3VwLgogICAgICAgICAgICAgICAgICAgICRncm91cCA9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50Lkdyb3VwUHJpbmNpcGFsIC1Bcmd1bWVudExpc3QgJGxvY2FsUHJpbmNpcGFsQ29udGV4dAogICAgICAgICAgICAgICAgICAgICRncm91cC5OYW1lID0gJEdyb3VwTmFtZTsKICAgICAgICAgICAgICAgICAgICAkZ3JvdXAuU2F2ZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgU2V0IGdyb3VwIHByb3BlcnRpZXMuCgogICAgICAgICAgICAgICAgaWYoJFBTQm91bmRQYXJhbWV0ZXJzLkNvbnRhaW5zS2V5KCdEZXNjcmlwdGlvbicpIC1hbmQgKC1ub3QgJGdyb3VwRXhpc3RzIC1vciAkRGVzY3JpcHRpb24gLW5lICRncm91cC5EZXNjcmlwdGlvbikpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJGdyb3VwLkRlc2NyaXB0aW9uID0gJERlc2NyaXB0aW9uOwogICAgICAgICAgICAgICAgICAgICRzYXZlQ2hhbmdlcyA9ICR0cnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgnTWVtYmVycycpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGlmKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgnTWVtYmVyc1RvSW5jbHVkZScpIC1vciAkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ01lbWJlcnNUb0V4Y2x1ZGUnKSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgSWYgTWVtYmVycyBhcmUgcHJvdmlkZWQsIEluY2x1ZGUgYW5kIEV4Y2x1ZGUgYXJlIG5vdCBhbGxvd2VkLgogICAgICAgICAgICAgICAgICAgICAgICBUaHJvd0ludmFsaWRBcmd1bWVudEVycm9yIC1FcnJvcklkICJHcm91cFRlc3RDbWRsZXRfTWVtYmVyc1BsdXNJbmNsdWRlT3JFeGNsdWRlQ29uZmxpY3QiIC1FcnJvck1lc3NhZ2UgKCRMb2NhbGl6ZWREYXRhLk1lbWJlcnNBbmRJbmNsdWRlRXhjbHVkZUNvbmZsaWN0IC1mICJNZW1iZXJzIiwiTWVtYmVyc1RvSW5jbHVkZSIsIk1lbWJlcnNUb0V4Y2x1ZGUiKQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYoJE1lbWJlcnMgLWVxICRudWxsKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgVGhyb3dJbnZhbGlkQXJndW1lbnRFcnJvciAtRXJyb3JJZCAiR3JvdXBUZXN0Q21kbGV0X01lbWJlcnNJc051bGwiIC1FcnJvck1lc3NhZ2UgKCRMb2NhbGl6ZWREYXRhLk1lbWJlcnNJc051bGwgLWYgIk1lbWJlcnMiLCJNZW1iZXJzVG9JbmNsdWRlIiwiTWVtYmVyc1RvRXhjbHVkZSIpCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAjIFJlbW92ZSBkdXBsaWNhdGUgbmFtZXMgYXMgc3RyaW5ncy4KICAgICAgICAgICAgICAgICAgICAkTWVtYmVycyA9IFtTdHJpbmdbXV1AKFJlbW92ZUR1cGxpY2F0ZXMgLU1lbWJlcnMgJE1lbWJlcnMpOwoKICAgICAgICAgICAgICAgICAgICAjIFJlc29sdmUgdGhlIG5hbWVzIHRvIGFjdHVhbCBwcmluY2lwYWwgb2JqZWN0cy4KICAgICAgICAgICAgICAgICAgICBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LlByaW5jaXBhbFtdXSRtZW1iZXJzUHJpbmNpcGFscyA9IFJlc29sdmVOYW1lc1RvUHJpbmNpcGFscyAtTG9jYWxQcmluY2lwYWxDb250ZXh0ICRsb2NhbFByaW5jaXBhbENvbnRleHQgLUNyZWRlbnRpYWxQcmluY2lwYWxDb250ZXh0ICRjcmVkZW50aWFsUHJpbmNpcGFsQ29udGV4dCAtT2JqZWN0TmFtZXMgJE1lbWJlcnMgLU5ldHdvcmtDcmVkZW50aWFsICRuZXR3b3JrQ3JlZGVudGlhbCAtRGlzcG9zYWJsZXMgJGRpc3Bvc2FibGVzCgogICAgICAgICAgICAgICAgICAgICMgUmVtb3ZlIGFsbCBwb3NzaWJsZSBkdXBsaWNhdGVzLgogICAgICAgICAgICAgICAgICAgIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuUHJpbmNpcGFsW11dJG1lbWJlcnNQcmluY2lwYWxzID0gUmVtb3ZlRHVwbGljYXRlUHJpbmNpcGFscyAtTWVtYmVycyAkbWVtYmVyc1ByaW5jaXBhbHMKCiAgICAgICAgICAgICAgICAgICAgIyBGaW5kIHdoYXQgZ3JvdXAgbWVtYmVycyBtdXN0IGJlIGRlbGV0ZWQuCiAgICAgICAgICAgICAgICAgICAgJG9iamVjdHNUb1JlbW92ZSA9IEAoKTsKCiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkZ3JvdXBNZW1iZXIgaW4gJGdyb3VwLk1lbWJlcnMpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkZ3JvdXBNZW1iZXJGb3VuZCA9ICRmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yKCRtID0gMDsgJG0gLWx0ICRtZW1iZXJzUHJpbmNpcGFscy5Db3VudDsgJG0rKykKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGdyb3VwTWVtYmVyIC1lcSAkbWVtYmVyc1ByaW5jaXBhbHNbJG1dKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRncm91cE1lbWJlckZvdW5kID0gJHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKC1ub3QgJGdyb3VwTWVtYmVyRm91bmQpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgU2VsZWN0IHRoaXMgZ3JvdXAgZm9yIGRlbGV0aW9uLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9iamVjdHNUb1JlbW92ZSArPSAkZ3JvdXBNZW1iZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICMgRmluZCB3aGF0IGdyb3VwIG1lbWJlcnMgbXVzdCBiZSBhZGRlZC4KICAgICAgICAgICAgICAgICAgICAkb2JqZWN0c1RvQWRkID0gQCgpOwoKICAgICAgICAgICAgICAgICAgICBmb3IoJG0gPSAwOyAkbSAtbHQgJG1lbWJlcnNQcmluY2lwYWxzLkNvdW50OyAkbSsrKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG1lbWJlcnNGb3VuZCA9ICRmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkZ3JvdXBNZW1iZXIgaW4gJGdyb3VwLk1lbWJlcnMpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRncm91cE1lbWJlciAtZXEgJG1lbWJlcnNQcmluY2lwYWxzWyRtXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWVtYmVyc0ZvdW5kID0gJHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKC1ub3QgJG1lbWJlcnNGb3VuZCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBTZWxlY3QgdGhpcyBncm91cCBmb3IgYWRkaXRpb24uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqZWN0c1RvQWRkICs9ICRtZW1iZXJzUHJpbmNpcGFsc1skbV07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKCRvYmplY3RzVG9BZGQuTGVuZ3RoIC1ndCAwKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBNYWtlIGNoYW5nZXMgdG8gdGhlIGdyb3VwLgogICAgICAgICAgICAgICAgICAgICAgICBBZGRHcm91cE1lbWJlcnMgLUdyb3VwICRncm91cCAtUHJpbmNpcGFscyAkb2JqZWN0c1RvQWRkCiAgICAgICAgICAgICAgICAgICAgICAgICRzYXZlQ2hhbmdlcyA9ICR0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYoJG9iamVjdHNUb1JlbW92ZS5MZW5ndGggLWd0IDApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAjIE1ha2UgY2hhbmdlcyB0byB0aGUgZ3JvdXAuCiAgICAgICAgICAgICAgICAgICAgICAgIFJlbW92ZUdyb3VwTWVtYmVycyAtR3JvdXAgJGdyb3VwIC1QcmluY2lwYWxzICRvYmplY3RzVG9SZW1vdmUKCiAgICAgICAgICAgICAgICAgICAgICAgICRzYXZlQ2hhbmdlcyA9ICR0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LlByaW5jaXBhbFtdXSRtZW1iZXJzVG9JbmNsdWRlUHJpbmNpcGFscyA9ICRudWxsOwogICAgICAgICAgICAgICAgICAgIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuUHJpbmNpcGFsW11dJG1lbWJlcnNUb0V4Y2x1ZGVQcmluY2lwYWxzID0gJG51bGw7CgogICAgICAgICAgICAgICAgICAgIGlmKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgnTWVtYmVyc1RvSW5jbHVkZScpKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlcnNUb0luY2x1ZGUgPSBbU3RyaW5nW11dQChSZW1vdmVEdXBsaWNhdGVzIC1NZW1iZXJzICRNZW1iZXJzVG9JbmNsdWRlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICMgUmVzb2x2ZSB0aGUgbmFtZXMgdG8gYWN0dWFsIHByaW5jaXBhbCBvYmplY3RzLgogICAgICAgICAgICAgICAgICAgICAgICAkbWVtYmVyc1RvSW5jbHVkZVByaW5jaXBhbHMgPSBSZXNvbHZlTmFtZXNUb1ByaW5jaXBhbHMgLUxvY2FsUHJpbmNpcGFsQ29udGV4dCAkbG9jYWxQcmluY2lwYWxDb250ZXh0IC1DcmVkZW50aWFsUHJpbmNpcGFsQ29udGV4dCAkY3JlZGVudGlhbFByaW5jaXBhbENvbnRleHQgLU9iamVjdE5hbWVzICRNZW1iZXJzVG9JbmNsdWRlIC1OZXR3b3JrQ3JlZGVudGlhbCAkbmV0d29ya0NyZWRlbnRpYWwgLURpc3Bvc2FibGVzICRkaXNwb3NhYmxlcwoKICAgICAgICAgICAgICAgICAgICAgICAgIyBSZW1vdmUgYWxsIHBvc3NpYmxlIGR1cGxpY2F0ZXMuCiAgICAgICAgICAgICAgICAgICAgICAgIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuUHJpbmNpcGFsW11dJG1lbWJlcnNUb0luY2x1ZGVQcmluY2lwYWxzID0gUmVtb3ZlRHVwbGljYXRlUHJpbmNpcGFscyAtTWVtYmVycyAkbWVtYmVyc1RvSW5jbHVkZVByaW5jaXBhbHMKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgnTWVtYmVyc1RvRXhjbHVkZScpKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlcnNUb0V4Y2x1ZGUgPSBbU3RyaW5nW11dQChSZW1vdmVEdXBsaWNhdGVzIC1NZW1iZXJzICRNZW1iZXJzVG9FeGNsdWRlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICMgUmVzb2x2ZSB0aGUgbmFtZXMgdG8gYWN0dWFsIHByaW5jaXBhbCBvYmplY3RzLgogICAgICAgICAgICAgICAgICAgICAgICAkbWVtYmVyc1RvRXhjbHVkZVByaW5jaXBhbHMgPSBSZXNvbHZlTmFtZXNUb1ByaW5jaXBhbHMgLUxvY2FsUHJpbmNpcGFsQ29udGV4dCAkbG9jYWxQcmluY2lwYWxDb250ZXh0IC1DcmVkZW50aWFsUHJpbmNpcGFsQ29udGV4dCAkY3JlZGVudGlhbFByaW5jaXBhbENvbnRleHQgLU9iamVjdE5hbWVzICRNZW1iZXJzVG9FeGNsdWRlIC1OZXR3b3JrQ3JlZGVudGlhbCAkbmV0d29ya0NyZWRlbnRpYWwgLURpc3Bvc2FibGVzICRkaXNwb3NhYmxlcwoKICAgICAgICAgICAgICAgICAgICAgICAgIyBSZW1vdmUgYWxsIHBvc3NpYmxlIGR1cGxpY2F0ZXMuCiAgICAgICAgICAgICAgICAgICAgICAgIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuUHJpbmNpcGFsW11dJG1lbWJlcnNUb0V4Y2x1ZGVQcmluY2lwYWxzID0gUmVtb3ZlRHVwbGljYXRlUHJpbmNpcGFscyAtTWVtYmVycyAkbWVtYmVyc1RvRXhjbHVkZVByaW5jaXBhbHMKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKCRtZW1iZXJzVG9JbmNsdWRlUHJpbmNpcGFscyAtbmUgJG51bGwgLWFuZCAkbWVtYmVyc1RvRXhjbHVkZVByaW5jaXBhbHMgLW5lICRudWxsKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBCb3RoIE1lbWJlcnNUb0luY2x1ZGUgYW5kIE1lbWJlcnNUb0V4bHVkZSB3ZXJlIHByb3ZpZGVkLiBDaGVjayBpZiB0aGV5IGhhdmUgY29tbW9uIHByaW5jaXBhbHMuCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJGluY2x1ZGVQcmluY2lwYWwgaW4gJG1lbWJlcnNUb0luY2x1ZGVQcmluY2lwYWxzKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRleGNsdWRlUHJpbmNpcGFsIGluICRtZW1iZXJzVG9FeGNsdWRlUHJpbmNpcGFscykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkaW5jbHVkZVByaW5jaXBhbCAtZXEgJGV4Y2x1ZGVQcmluY2lwYWwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaHJvd0ludmFsaWRBcmd1bWVudEVycm9yIC1FcnJvcklkICJHcm91cFNldENtZGxldF9JbmNsdWRlQW5kRXhjbHVkZUNvbmZsaWN0IiAtRXJyb3JNZXNzYWdlICgkTG9jYWxpemVkRGF0YS5JbmNsdWRlQW5kRXhjbHVkZUNvbmZsaWN0IC1mICRpbmNsdWRlUHJpbmNpcGFsLlNhbUFjY291bnROYW1lLCJNZW1iZXJzVG9JbmNsdWRlIiwgIk1lbWJlcnNUb0V4Y2x1ZGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYoJG1lbWJlcnNUb0luY2x1ZGVQcmluY2lwYWxzIC1uZSAkbnVsbCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgRmluZCB3aGF0IGdyb3VwIG1lbWJlcnMgbXVzdCBiZSBhZGRlZC4KICAgICAgICAgICAgICAgICAgICAgICAgJG9iamVjdHNUb0FkZCA9IEAoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yKCRtID0gMDsgJG0gLWx0ICRtZW1iZXJzVG9JbmNsdWRlUHJpbmNpcGFscy5Db3VudDsgJG0rKykKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lbWJlcnNGb3VuZCA9ICRmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJGdyb3VwTWVtYmVyIGluICRncm91cC5NZW1iZXJzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRncm91cE1lbWJlciAtZXEgJG1lbWJlcnNUb0luY2x1ZGVQcmluY2lwYWxzWyRtXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZW1iZXJzRm91bmQgPSAkdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKC1ub3QgJG1lbWJlcnNGb3VuZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFNlbGVjdCB0aGlzIGdyb3VwIGZvciBhZGRpdGlvbi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqZWN0c1RvQWRkICs9ICRtZW1iZXJzVG9JbmNsdWRlUHJpbmNpcGFsc1skbV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRvYmplY3RzVG9BZGQuTGVuZ3RoIC1ndCAwKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE1ha2UgY2hhbmdlcyB0byB0aGUgZ3JvdXAuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBZGRHcm91cE1lbWJlcnMgLUdyb3VwICRncm91cCAtUHJpbmNpcGFscyAkb2JqZWN0c1RvQWRkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2F2ZUNoYW5nZXMgPSAkdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYoJG1lbWJlcnNUb0V4Y2x1ZGVQcmluY2lwYWxzIC1uZSAkbnVsbCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgRmluZCB3aGF0IGdyb3VwIG1lbWJlcnMgbXVzdCBiZSBkZWxldGVkLgogICAgICAgICAgICAgICAgICAgICAgICAkb2JqZWN0c1RvUmVtb3ZlID0gQCgpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IoJG0gPSAwOyAkbSAtbHQgJG1lbWJlcnNUb0V4Y2x1ZGVQcmluY2lwYWxzLkNvdW50OyAkbSsrKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZ3JvdXBNZW1iZXJGb3VuZCA9ICRmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJGdyb3VwTWVtYmVyIGluICRncm91cC5NZW1iZXJzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRtZW1iZXJzVG9FeGNsdWRlUHJpbmNpcGFsc1skbV0gLWVxICRncm91cE1lbWJlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgU2VsZWN0IHRoaXMgZ3JvdXAgZm9yIGRlbGV0aW9uLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqZWN0c1RvUmVtb3ZlICs9ICRncm91cE1lbWJlcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZigkb2JqZWN0c1RvUmVtb3ZlLkxlbmd0aCAtZ3QgMCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBNYWtlIGNoYW5nZXMgdG8gdGhlIGdyb3VwLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVtb3ZlR3JvdXBNZW1iZXJzIC1Hcm91cCAkZ3JvdXAgLVByaW5jaXBhbHMgJG9iamVjdHNUb1JlbW92ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNhdmVDaGFuZ2VzID0gJHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoJHNhdmVDaGFuZ2VzKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRncm91cC5TYXZlKCk7CgogICAgICAgICAgICAgICAgICAgICMgU2VuZCBhbiBvcGVyYXRpb24gc3VjY2VzcyB2ZXJib3NlIG1lc3NhZ2UuCiAgICAgICAgICAgICAgICAgICAgaWYoJGdyb3VwRXhpc3RzKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAoJExvY2FsaXplZERhdGEuR3JvdXBVcGRhdGVkIC1mICRHcm91cE5hbWUpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgKCRMb2NhbGl6ZWREYXRhLkdyb3VwQ3JlYXRlZCAtZiAkR3JvdXBOYW1lKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICgkTG9jYWxpemVkRGF0YS5Ob0NvbmZpZ3VyYXRpb25SZXF1aXJlZCAtZiAkR3JvdXBOYW1lKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgICMgRW5zdXJlIGlzIHNldCB0byAiQWJzZW50Ii4KICAgICAgICAgICAgaWYoJGdyb3VwIC1uZSAkbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIyBUaGUgZ3JvdXAgZXhpc3RzLgogICAgICAgICAgICAgICAgaWYoJHBzY21kbGV0LlNob3VsZFByb2Nlc3MoJExvY2FsaXplZERhdGEuR3JvdXBXaXRoTmFtZSAtZiAkR3JvdXBOYW1lLCAkTG9jYWxpemVkRGF0YS5SZW1vdmVPcGVyYXRpb24pKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICMgUmVtb3ZlIHRoZSBncm91cCBieSB0aGUgcHJvdmlkZWQgbmFtZS4KICAgICAgICAgICAgICAgICAgICAkZ3JvdXAuRGVsZXRlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAoJExvY2FsaXplZERhdGEuR3JvdXBSZW1vdmVkIC1mICRHcm91cE5hbWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICgkTG9jYWxpemVkRGF0YS5Ob0NvbmZpZ3VyYXRpb25SZXF1aXJlZEdyb3VwRG9lc05vdEV4aXN0IC1mICRHcm91cE5hbWUpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBmaW5hbGx5CiAgICB7CiAgICAgICAgZm9yZWFjaCAoJGRpc3Bvc2FibGUgaW4gJGRpc3Bvc2FibGVzKQogICAgICAgIHsKICAgICAgICAgICAgJGRpc3Bvc2FibGUuRGlzcG9zZSgpCiAgICAgICAgfQogICAgfQp9Cgo8IwouU3lub3BzaXMKVGhlIFRlc3QtVGFyZ2V0UmVzb3VyY2UgY21kbGV0IGlzIHVzZWQgdG8gdmFsaWRhdGUgaWYgdGhlIHJlc291cmNlIGlzIGluIGEgc3RhdGUgYXMgZXhwZWN0ZWQgaW4gdGhlIGluc3RhbmNlIGRvY3VtZW50LgojPgpmdW5jdGlvbiBUZXN0LVRhcmdldFJlc291cmNlCnsKICAgIFtPdXRwdXRUeXBlKFtTeXN0ZW0uQm9vbGVhbl0pXQogICAgcGFyYW0KCSgKCQlbcGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KCQlbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQoJCVtTeXN0ZW0uU3RyaW5nXQoJCSRHcm91cE5hbWUsCgogICAgICAgIFtWYWxpZGF0ZVNldCgiUHJlc2VudCIsICJBYnNlbnQiKV0KICAgICAgICBbU3lzdGVtLlN0cmluZ10KICAgICAgICAkRW5zdXJlID0gIlByZXNlbnQiLAoKCQlbU3lzdGVtLlN0cmluZ10KCQkkRGVzY3JpcHRpb24sCgoJCVtTeXN0ZW0uU3RyaW5nW11dCgkJJE1lbWJlcnMsCgoJCVtTeXN0ZW0uU3RyaW5nW11dCgkJJE1lbWJlcnNUb0luY2x1ZGUsCgoJCVtTeXN0ZW0uU3RyaW5nW11dCgkJJE1lbWJlcnNUb0V4Y2x1ZGUsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCgkJW1N5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQoJCSRDcmVkZW50aWFsCgkpCgogICAgU2V0LVN0cmljdE1vZGUgLVZlcnNpb24gTGF0ZXN0CgogICAgVmFsaWRhdGVHcm91cE5hbWUgLUdyb3VwTmFtZSAkR3JvdXBOYW1lCgogICAgIyBzdG9yZSBkaXNwb3NhYmxlIG9iamVjdHMgaW4gYSBsaXN0IGZvciBjbGVhbnVwIGxhdGVyLgogICAgIyBUaGlzIGlzIG5lZWRlZCBmb3IgdGhlIGNhc2Ugd2hlcmUgZG9tYWluIHJlZGlyZWN0aW9uIGlzIHJlcXVpcmVkCiAgICAjIHRvIHJlc29sdmUgYW4gYWNjb3VudC4gIFNpbmNlIHRoZSBsaWZldGltZSBvZiB0aGUgcmVzb2x2ZWQKICAgICMgcHJpbmNpcGFsIGlzIHRoZSBzYW1lIGFzIHRoZSBQcmluY2lwYWxDb250ZXh0LCB3ZSBuZWVkIHRvCiAgICAjIGVuc3VyZSAgdGhlIFByaW5jaXBhbENvbnRleHQgcmVtYWlucyBsaXZlIHVudGlsIHdlJ3JlIGRvbmUuCiAgICAkZGlzcG9zYWJsZXMgPSBOZXctT2JqZWN0IFN5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3QKCiAgICB0cnkKICAgIHsKICAgICAgICAjIFByaW5jaXBhbENvbnRleHQgZm9yIGRvbWFpbiBhY2NvdW50IHJlc29sdXRpb24KICAgICAgICAkY3JlZGVudGlhbFByaW5jaXBhbENvbnRleHQgPSAkbnVsbAogICAgICAgICMgUHJpbmNpcGFsQ29udGV4dCBmb3IgbG9jYWwgYWNjb3VudCByZXNvbHV0aW9uCiAgICAgICAgJGxvY2FsUHJpbmNpcGFsQ29udGV4dCA9ICRudWxsCiAgICAgICAgJGdyb3VwID0gJG51bGwKICAgICAgICBbU3lzdGVtLk5ldC5OZXR3b3JrQ3JlZGVudGlhbF0gJG5ldHdvcmtDcmVkZW50aWFsID0gJG51bGwKCiAgICAgICAgaWYoJFBTQm91bmRQYXJhbWV0ZXJzLkNvbnRhaW5zS2V5KCdDcmVkZW50aWFsJykpCiAgICAgICAgewogICAgICAgICAgICAkbmV0d29ya0NyZWRlbnRpYWwgPSAkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpOwogICAgICAgICAgICAkY3JlZGVudGlhbFByaW5jaXBhbENvbnRleHQgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5QcmluY2lwYWxDb250ZXh0IC1Bcmd1bWVudExpc3QgKFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuQ29udGV4dFR5cGVdOjpEb21haW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbmV0d29ya0NyZWRlbnRpYWwuRG9tYWluLCAkbmV0d29ya0NyZWRlbnRpYWwuVXNlck5hbWUsICRuZXR3b3JrQ3JlZGVudGlhbC5QYXNzd29yZCkKICAgICAgICAgICAgJGRpc3Bvc2FibGVzLkFkZCgkY3JlZGVudGlhbFByaW5jaXBhbENvbnRleHQpIHwgb3V0LW51bGwKICAgICAgICB9CgkKICAgICAgICAjIENyZWF0ZSBsb2NhbCBtYWNoaW5lIGNvbnRleHQuCiAgICAgICAgJGxvY2FsUHJpbmNpcGFsQ29udGV4dCA9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LlByaW5jaXBhbENvbnRleHQgLUFyZ3VtZW50TGlzdCAoW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5Db250ZXh0VHlwZV06Ok1hY2hpbmUpCiAgICAgICAgJGRpc3Bvc2FibGVzLkFkZCgkbG9jYWxQcmluY2lwYWxDb250ZXh0KSB8IG91dC1udWxsCgogICAgICAgICRncm91cCA9IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuR3JvdXBQcmluY2lwYWxdOjpGaW5kQnlJZGVudGl0eSgkbG9jYWxQcmluY2lwYWxDb250ZXh0LCAkR3JvdXBOYW1lKTsKICAgICAgICBpZigkZ3JvdXAgLWVxICRudWxsKQogICAgICAgIHsKICAgICAgICAgICAgIyBBIGdyb3VwIHdpdGggdGhlIHByb3ZpZGVkIG5hbWUgZG9lcyBub3QgZXhpc3QuCiAgICAgICAgICAgIFdyaXRlLUxvZyAtTWVzc2FnZSAoJExvY2FsaXplZERhdGEuR3JvdXBEb2VzTm90RXhpc3QgLWYgJEdyb3VwTmFtZSkKCiAgICAgICAgICAgIGlmKCRFbnN1cmUgLWVxICJBYnNlbnQiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHRydWUKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJldHVybiAkZmFsc2UKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJGRpc3Bvc2FibGVzLkFkZCgkZ3JvdXApIHwgb3V0LW51bGwKCiAgICAgICAgIyBBIGdyb3VwIHdpdGggdGhlIHByb3ZpZGVkIG5hbWUgZXhpc3RzLgogICAgICAgIFdyaXRlLUxvZyAtTWVzc2FnZSAoJExvY2FsaXplZERhdGEuR3JvdXBFeGlzdHMgLWYgJEdyb3VwTmFtZSkKCiAgICAgICAgIyBWYWxpZGF0ZSBzZXBhcmF0ZSBwcm9wZXJ0aWVzLgogICAgICAgIGlmKCRFbnN1cmUgLWVxICJBYnNlbnQiKQogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtTG9nIC1NZXNzYWdlICgkTG9jYWxpemVkRGF0YS5Qcm9wZXJ0eU1pc21hdGNoIC1mICJFbnN1cmUiLCAiQWJzZW50IiwgIlByZXNlbnQiKQogICAgICAgICAgICByZXR1cm4gJGZhbHNlOyAjIFRoZSBFbnN1cmUgcHJvcGVydHkgZG9lcyBub3QgbWF0Y2guIFJldHVybiAkZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZigkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ0dyb3VwTmFtZScpIC1hbmQgJEdyb3VwTmFtZSAtbmUgJGdyb3VwLlNhbUFjY291bnROYW1lIC1hbmQgJEdyb3VwTmFtZSAtbmUgJGdyb3VwLlNpZC5WYWx1ZSkKICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiAkZmFsc2U7ICMgVGhlIE5hbWUgcHJvcGVydHkgZG9lcyBub3QgbWF0Y2guIFJldHVybiAkZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZigkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ0Rlc2NyaXB0aW9uJykgLWFuZCAkRGVzY3JpcHRpb24gLW5lICRncm91cC5EZXNjcmlwdGlvbikKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlLUxvZyAtTWVzc2FnZSAoJExvY2FsaXplZERhdGEuUHJvcGVydHlNaXNtYXRjaCAtZiAiRGVzY3JpcHRpb24iLCAkRGVzY3JpcHRpb24sICRncm91cC5EZXNjcmlwdGlvbikKICAgICAgICAgICAgcmV0dXJuICRmYWxzZTsgIyBUaGUgRGVzY3JpcHRpb24gcHJvcGVydHkgZG9lcyBub3QgbWF0Y2guIFJldHVybiAkZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZigkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ01lbWJlcnMnKSkKICAgICAgICB7CiAgICAgICAgICAgIGlmKCRQU0JvdW5kUGFyYW1ldGVycy5Db250YWluc0tleSgnTWVtYmVyc1RvSW5jbHVkZScpIC1vciAkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ01lbWJlcnNUb0V4Y2x1ZGUnKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIyBJZiBNZW1iZXJzIGFyZSBwcm92aWRlZCwgSW5jbHVkZSBhbmQgRXhjbHVkZSBhcmUgbm90IGFsbG93ZWQuCiAgICAgICAgICAgICAgICBUaHJvd0ludmFsaWRBcmd1bWVudEVycm9yIC1FcnJvcklkICJHcm91cFRlc3RDbWRsZXRfTWVtYmVyc1BsdXNJbmNsdWRlT3JFeGNsdWRlQ29uZmxpY3QiIC1FcnJvck1lc3NhZ2UgKCRMb2NhbGl6ZWREYXRhLk1lbWJlcnNBbmRJbmNsdWRlRXhjbHVkZUNvbmZsaWN0IC1mICJNZW1iZXJzIiwiTWVtYmVyc1RvSW5jbHVkZSIsIk1lbWJlcnNUb0V4Y2x1ZGUiKQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkTWVtYmVycyAtZXEgJG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFRocm93SW52YWxpZEFyZ3VtZW50RXJyb3IgLUVycm9ySWQgIkdyb3VwVGVzdENtZGxldF9NZW1iZXJzSXNOdWxsIiAtRXJyb3JNZXNzYWdlICgkTG9jYWxpemVkRGF0YS5NZW1iZXJzSXNOdWxsIC1mICJNZW1iZXJzIiwiTWVtYmVyc1RvSW5jbHVkZSIsIk1lbWJlcnNUb0V4Y2x1ZGUiKQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIFJlbW92ZSBkdXBsaWNhdGUgbmFtZXMgYXMgc3RyaW5ncy4KICAgICAgICAgICAgJE1lbWJlcnMgPSBbU3RyaW5nW11dQChSZW1vdmVEdXBsaWNhdGVzIC1NZW1iZXJzICRNZW1iZXJzKTsKCiAgICAgICAgICAgICMgUmVzb2x2ZSB0aGUgbmFtZXMgdG8gYWN0dWFsIHByaW5jaXBhbCBvYmplY3RzLgogICAgICAgICAgICAkbWVtYmVyc1ByaW5jaXBhbHMgPSBSZXNvbHZlTmFtZXNUb1ByaW5jaXBhbHMgLUxvY2FsUHJpbmNpcGFsQ29udGV4dCAkbG9jYWxQcmluY2lwYWxDb250ZXh0IC1DcmVkZW50aWFsUHJpbmNpcGFsQ29udGV4dCAkY3JlZGVudGlhbFByaW5jaXBhbENvbnRleHQgLU9iamVjdE5hbWVzICRNZW1iZXJzIC1DcmVkZW50aWFscyAkQ3JlZGVudGlhbCAtRGlzcG9zYWJsZXMgJGRpc3Bvc2FibGVzCgogICAgICAgICAgICAjIFJlbW92ZSBhbGwgcG9zc2libGUgZHVwbGljYXRlcy4KICAgICAgICAgICAgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5QcmluY2lwYWxbXV0kbWVtYmVyc1ByaW5jaXBhbHMgPSBSZW1vdmVEdXBsaWNhdGVQcmluY2lwYWxzIC1NZW1iZXJzICRtZW1iZXJzUHJpbmNpcGFscwoKICAgICAgICAgICAgaWYoJG1lbWJlcnNQcmluY2lwYWxzLkNvdW50IC1uZSAkZ3JvdXAuTWVtYmVycy5Db3VudCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgV3JpdGUtTG9nIC1NZXNzYWdlICgkTG9jYWxpemVkRGF0YS5NZW1iZXJzTnVtYmVyTWlzbWF0Y2ggLWYgIk1lbWJlcnMiLCAkbWVtYmVyc1ByaW5jaXBhbHMuQ291bnQsICRncm91cC5NZW1iZXJzLkNvdW50KQogICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZTsgIyBUaGUgbnVtYmVyIG9mIHByb3ZpZGVkIHVuaXF1ZSBncm91cCBtZW1iZXJzIGlzIGRpZmZlcmVudCBmcm9tIHRoZSBudW1iZXIgb2YgYWN0dWFsIGdyb3VwIG1lbWJlcnMuIFJldHVybiAkZmFsc2UuCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgQ29tcGFyZSB0d28gbWVtYmVycyBsaXN0cy4KICAgICAgICAgICAgZm9yKCRtID0gMDsgJG0gLWx0ICRtZW1iZXJzUHJpbmNpcGFscy5Db3VudDsgJG0rKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICRtYXRjaEZvdW5kID0gJGZhbHNlOwogICAgICAgICAgICAgICAgIGZvcmVhY2goJGdyb3VwTWVtYmVyIGluICRncm91cC5NZW1iZXJzKQogICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZigkbWVtYmVyc1ByaW5jaXBhbHNbJG1dIC1lcSAkZ3JvdXBNZW1iZXIpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkbWF0Y2hGb3VuZCA9ICR0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICBpZighJG1hdGNoRm91bmQpCiAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLUxvZyAtTWVzc2FnZSAoJExvY2FsaXplZERhdGEuTWVtYmVyc01lbWJlck1pc21hdGNoIC1mICRtZW1iZXJzUHJpbmNpcGFsc1skbV0uU2FtQWNjb3VudE5hbWUsICJNZW1iZXJzIiwgJGdyb3VwLlNhbUFjY291bnROYW1lKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkZmFsc2U7ICMgQXQgbGVhc3Qgb25lIGVsZW1lbnQgZG9lcyBub3QgaGF2ZSBhIG1hdGNoLiBSZXR1cm4gJGZhbHNlOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBpZigkUFNCb3VuZFBhcmFtZXRlcnMuQ29udGFpbnNLZXkoJ01lbWJlcnNUb0luY2x1ZGUnKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJE1lbWJlcnNUb0luY2x1ZGUgPSBbU3RyaW5nW11dQChSZW1vdmVEdXBsaWNhdGVzIC1NZW1iZXJzICRNZW1iZXJzVG9JbmNsdWRlKTsKCiAgICAgICAgICAgICAgICAjIFJlc29sdmUgdGhlIG5hbWVzIHRvIGFjdHVhbCBwcmluY2lwYWwgb2JqZWN0cy4KICAgICAgICAgICAgICAgICRtZW1iZXJzVG9JbmNsdWRlUHJpbmNpcGFscyA9IFJlc29sdmVOYW1lc1RvUHJpbmNpcGFscyAtTG9jYWxQcmluY2lwYWxDb250ZXh0ICRsb2NhbFByaW5jaXBhbENvbnRleHQgLUNyZWRlbnRpYWxQcmluY2lwYWxDb250ZXh0ICRjcmVkZW50aWFsUHJpbmNpcGFsQ29udGV4dCAtT2JqZWN0TmFtZXMgJE1lbWJlcnNUb0luY2x1ZGUgLU5ldHdvcmtDcmVkZW50aWFsICRuZXR3b3JrQ3JlZGVudGlhbCAtRGlzcG9zYWJsZXMgJGRpc3Bvc2FibGVzCgogICAgICAgICAgICAgICAgIyBSZW1vdmUgYWxsIHBvc3NpYmxlIGR1cGxpY2F0ZXMuCiAgICAgICAgICAgICAgICBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LlByaW5jaXBhbFtdXSRtZW1iZXJzVG9JbmNsdWRlUHJpbmNpcGFscyA9IFJlbW92ZUR1cGxpY2F0ZVByaW5jaXBhbHMgLU1lbWJlcnMgJG1lbWJlcnNUb0luY2x1ZGVQcmluY2lwYWxzCgogICAgICAgICAgICAgICAgIyBDaGVjayBpZiBldmVyeSBlbGVtZW50IGluICRtZW1iZXJzVG9JbmNsdWRlUHJpbmNpcGFscyBoYXMgYSBtYXRjaCBpbiAkZ3JvdXAuTWVtYmVycy4KICAgICAgICAgICAgICAgIGZvcigkbSA9IDA7ICRtIC1sdCAkbWVtYmVyc1RvSW5jbHVkZVByaW5jaXBhbHMuQ291bnQ7ICRtKyspCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICRtYXRjaEZvdW5kID0gJGZhbHNlOwogICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRncm91cE1lbWJlciBpbiAkZ3JvdXAuTWVtYmVycykKICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBpZigkbWVtYmVyc1RvSW5jbHVkZVByaW5jaXBhbHNbJG1dIC1lcSAkZ3JvdXBNZW1iZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtYXRjaEZvdW5kID0gJHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICBpZighJG1hdGNoRm91bmQpCiAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtTG9nIC1NZXNzYWdlICgkTG9jYWxpemVkRGF0YS5NZW1iZXJzTWVtYmVyTWlzbWF0Y2ggLWYgJG1lbWJlcnNUb0luY2x1ZGVQcmluY2lwYWxzWyRtXS5TYW1BY2NvdW50TmFtZSwgIk1lbWJlcnNUb0luY2x1ZGUiLCAkZ3JvdXAuU2FtQWNjb3VudE5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZmFsc2U7ICMgQXQgbGVhc3Qgb25lIGVsZW1lbnQgZnJvbSAkTWVtYmVyc1RvSW5jbHVkZSBkb2VzIG5vdCBoYXZlIGEgbWF0Y2guIFJldHVybiAkZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoJFBTQm91bmRQYXJhbWV0ZXJzLkNvbnRhaW5zS2V5KCdNZW1iZXJzVG9FeGNsdWRlJykpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRNZW1iZXJzVG9FeGNsdWRlID0gW1N0cmluZ1tdXUAoUmVtb3ZlRHVwbGljYXRlcyAtTWVtYmVycyAkTWVtYmVyc1RvRXhjbHVkZSk7CgogICAgICAgICAgICAgICAgIyBSZXNvbHZlIHRoZSBuYW1lcyB0byBhY3R1YWwgcHJpbmNpcGFsIG9iamVjdHMuCiAgICAgICAgICAgICAgICAkbWVtYmVyc1RvRXhjbHVkZVByaW5jaXBhbHMgPSBSZXNvbHZlTmFtZXNUb1ByaW5jaXBhbHMgLUxvY2FsUHJpbmNpcGFsQ29udGV4dCAkbG9jYWxQcmluY2lwYWxDb250ZXh0IC1DcmVkZW50aWFsUHJpbmNpcGFsQ29udGV4dCAkY3JlZGVudGlhbFByaW5jaXBhbENvbnRleHQgLU9iamVjdE5hbWVzICRNZW1iZXJzVG9FeGNsdWRlIC1OZXR3b3JrQ3JlZGVudGlhbCAkbmV0d29ya0NyZWRlbnRpYWwgLURpc3Bvc2FibGVzICRkaXNwb3NhYmxlcwoKICAgICAgICAgICAgICAgICMgUmVtb3ZlIGFsbCBwb3NzaWJsZSBkdXBsaWNhdGVzLgogICAgICAgICAgICAgICAgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5QcmluY2lwYWxbXV0kbWVtYmVyc1RvRXhjbHVkZVByaW5jaXBhbHMgPSBSZW1vdmVEdXBsaWNhdGVQcmluY2lwYWxzIC1NZW1iZXJzICRtZW1iZXJzVG9FeGNsdWRlUHJpbmNpcGFscwoKICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgYW55IGVsZW1lbnQgaW4gJG1lbWJlcnNUb0V4Y2x1ZGVQcmluY2lwYWxzIGhhcyBhIG1hdGNoIGluICRncm91cC5NZW1iZXJzLgogICAgICAgICAgICAgICAgZm9yKCRtID0gMDsgJG0gLWx0ICRtZW1iZXJzVG9FeGNsdWRlUHJpbmNpcGFscy5Db3VudDsgJG0rKykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRncm91cE1lbWJlciBpbiAkZ3JvdXAuTWVtYmVycykKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgaWYoJG1lbWJlcnNUb0V4Y2x1ZGVQcmluY2lwYWxzWyRtXSAtZXEgJGdyb3VwTWVtYmVyKQogICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtTG9nIC1NZXNzYWdlICgkTG9jYWxpemVkRGF0YS5NZW1iZXJUb0V4Y2x1ZGVNYXRjaCAtZiAkbWVtYmVyc1RvRXhjbHVkZVByaW5jaXBhbHNbJG1dLlNhbUFjY291bnROYW1lLCAiTWVtYmVyc1RvRXhjbHVkZSIsICRncm91cC5TYW1BY2NvdW50TmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZTsgIyBBdCBsZWFzdCBvbmUgZWxlbWVudCBmcm9tICRNZW1iZXJzVG9FeGNsdWRlIGhhcyBhIG1hdGNoLiBSZXR1cm4gJGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBmaW5hbGx5CiAgICB7CiAgICAgICAgZm9yZWFjaCAoJGRpc3Bvc2FibGUgaW4gJGRpc3Bvc2FibGVzKQogICAgICAgIHsKICAgICAgICAgICAgJGRpc3Bvc2FibGUuRGlzcG9zZSgpCiAgICAgICAgfQogICAgfQoKICAgICMgQWxsIHByb3BlcnRpZXMgbWF0Y2guIFJldHVybiAkdHJ1ZS4KICAgIHJldHVybiAkdHJ1ZTsKfQoKZnVuY3Rpb24gUmVtb3ZlRHVwbGljYXRlcwp7CiAgICBwYXJhbQogICAgKAogICAgICAgIFtTeXN0ZW0uU3RyaW5nW11dICRNZW1iZXJzCiAgICApCgogICAgU2V0LVN0cmljdE1vZGUgLVZlcnNpb24gTGF0ZXN0CgogICAgJGRlc3RJbmRleCA9IDA7CiAgICBmb3IoW2ludF0gJHNvdXJjZUluZGV4ID0gMCA7ICRzb3VyY2VJbmRleCAtbHQgJE1lbWJlcnMuQ291bnQ7ICRzb3VyY2VJbmRleCsrKQogICAgewogICAgICAgICRtYXRjaEZvdW5kID0gJGZhbHNlOwogICAgICAgIGZvcihbaW50XSAkbWF0Y2hJbmRleCA9IDA7ICRtYXRjaEluZGV4IC1sdCAkZGVzdEluZGV4OyAkbWF0Y2hJbmRleCsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYoJE1lbWJlcnNbJHNvdXJjZUluZGV4XSAtZXEgJE1lbWJlcnNbJG1hdGNoSW5kZXhdKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIEEgZHVwbGljYXRlIGlzIGZvdW5kLiBEaXNjYXJkIHRoZSBkdXBsaWNhdGUuCiAgICAgICAgICAgICAgICAkbWF0Y2hGb3VuZCA9ICR0cnVlOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmKCEkbWF0Y2hGb3VuZCkKICAgICAgICB7CiAgICAgICAgICAgICRNZW1iZXJzWyRkZXN0SW5kZXgrK10gPSAkTWVtYmVyc1skc291cmNlSW5kZXhdLlRvTG93ZXJJbnZhcmlhbnQoKTsKICAgICAgICB9CiAgICB9CgogICAgIyBDcmVhdGUgdGhlIG91dHB1dCBhcnJheS4KICAgICRkZXN0aW5hdGlvbiA9IE5ldy1PYmplY3QgU3lzdGVtLlN0cmluZ1tdIC1Bcmd1bWVudExpc3QgJGRlc3RJbmRleAoKICAgICMgQ29weSBvbmx5IGRpc3RpbmN0IGVsZW1lbnRzIGZyb20gdGhlIG9yaWdpbmFsIGFycmF5IHRvIHRoZSBkZXN0aW5hdGlvbiBhcnJheS4KICAgIFtTeXN0ZW0uQXJyYXldOjpDb3B5KCRNZW1iZXJzLCAkZGVzdGluYXRpb24sICRkZXN0SW5kZXgpOwoKICAgIHJldHVybiAkZGVzdGluYXRpb247Cn0KCmZ1bmN0aW9uIFJlbW92ZUR1cGxpY2F0ZVByaW5jaXBhbHMKewogICAgcGFyYW0KICAgICgKICAgICAgICBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LlByaW5jaXBhbFtdXSAkTWVtYmVycwogICAgKQoKICAgIFNldC1TdHJpY3RNb2RlIC1WZXJzaW9uIExhdGVzdAoKICAgICRkZXN0SW5kZXggPSAwOwogICAgZm9yKFtpbnRdICRzb3VyY2VJbmRleCA9IDAgOyAkc291cmNlSW5kZXggLWx0ICRNZW1iZXJzLkNvdW50OyAkc291cmNlSW5kZXgrKykKICAgIHsKICAgICAgICAkbWF0Y2hGb3VuZCA9ICRmYWxzZTsKICAgICAgICBmb3IoW2ludF0gJG1hdGNoSW5kZXggPSAwOyAkbWF0Y2hJbmRleCAtbHQgJGRlc3RJbmRleDsgJG1hdGNoSW5kZXgrKykKICAgICAgICB7CiAgICAgICAgICAgIGlmKCRNZW1iZXJzWyRzb3VyY2VJbmRleF0uQ29udGV4dFR5cGUgLWVxICRNZW1iZXJzWyRtYXRjaEluZGV4XS5Db250ZXh0VHlwZSAtYW5kCiAgICAgICAgICAgICAgICRNZW1iZXJzWyRzb3VyY2VJbmRleF0uU2FtQWNjb3VudE5hbWUgLWVxICRNZW1iZXJzWyRtYXRjaEluZGV4XS5TYW1BY2NvdW50TmFtZSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIyBBIGR1cGxpY2F0ZSBpcyBmb3VuZC4gRGlzY2FyZCB0aGUgZHVwbGljYXRlLgogICAgICAgICAgICAgICAgJG1hdGNoRm91bmQgPSAkdHJ1ZTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZighJG1hdGNoRm91bmQpCiAgICAgICAgewogICAgICAgICAgICAkTWVtYmVyc1skZGVzdEluZGV4KytdID0gJE1lbWJlcnNbJHNvdXJjZUluZGV4XTsKICAgICAgICB9CiAgICB9CgogICAgIyBDcmVhdGUgdGhlIG91dHB1dCBhcnJheS4KICAgICRkZXN0aW5hdGlvbiA9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LlByaW5jaXBhbFtdIC1Bcmd1bWVudExpc3QgJGRlc3RJbmRleAoKICAgICMgQ29weSBvbmx5IGRpc3RpbmN0IGVsZW1lbnRzIGZyb20gdGhlIG9yaWdpbmFsIGFycmF5IHRvIHRoZSBkZXN0aW5hdGlvbiBhcnJheS4KICAgIFtTeXN0ZW0uQXJyYXldOjpDb3B5KCRNZW1iZXJzLCAkZGVzdGluYXRpb24sICRkZXN0SW5kZXgpOwoKICAgIGlmKCRkZXN0aW5hdGlvbiAtbmUgJG51bGwpCiAgICB7CiAgICAgICAgcmV0dXJuIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuUHJpbmNpcGFsW11dJGRlc3RpbmF0aW9uOwogICAgfQoKICAgICMgUmV0dXJuIGFuIGVtcHR5IGFycmF5LgogICAgcmV0dXJuICxAKCRkZXN0aW5hdGlvbikKfQoKZnVuY3Rpb24gRW51bWVyYXRlTWVtYmVycwp7CiAgICBwYXJhbQogICAgKAogICAgICAgIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuR3JvdXBQcmluY2lwYWxdICRHcm91cAogICAgKQoKICAgIFNldC1TdHJpY3RNb2RlIC1WZXJzaW9uIExhdGVzdAoKICAgICMgQ3JlYXRlIHRoZSBvdXRwdXQgYXJyYXkuCiAgICAkbWVtYmVycyA9IEAoKTsKICAgIGZvcmVhY2goJG1lbWJlciBpbiAkZ3JvdXAuTWVtYmVycykKICAgIHsKICAgICAgICBpZigkbWVtYmVyLkNvbnRleHRUeXBlIC1lcSAiRG9tYWluIikKICAgICAgICB7CiAgICAgICAgICAgICMgU2VsZWN0IG9ubHkgdGhlIGZpcnN0IHBhcnQgb2YgdGhlIGZ1bGwgZG9tYWluIG5hbWUuCiAgICAgICAgICAgIFtTdHJpbmddJGRvbWFpbk5hbWUgPSAkbWVtYmVyLkNvbnRleHQuTmFtZTsKICAgICAgICAgICAgJGRvbWFpbk5hbWUgPSAkZG9tYWluTmFtZS5TdWJzdHJpbmcoMCwgJGRvbWFpbk5hbWUuSW5kZXhPZignLicpKTsKCiAgICAgICAgICAgIGlmKCRtZW1iZXIuU3RydWN0dXJhbE9iamVjdENsYXNzIC1lcSAiY29tcHV0ZXIiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkbWVtYmVycyArPSAoJGRvbWFpbk5hbWUrJ1wnKyRtZW1iZXIuTmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkbWVtYmVycyArPSAoJGRvbWFpbk5hbWUrJ1wnKyRtZW1iZXIuU2FtQWNjb3VudE5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgICRtZW1iZXJzICs9ICRtZW1iZXIuTmFtZTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICRtZW1iZXJzOwp9CgpmdW5jdGlvbiBJc1NhbWVEb21haW4KewogICAgW091dHB1dFR5cGUoW2Jvb2xdKV0KICAgIHBhcmFtCiAgICAoCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LlByaW5jaXBhbENvbnRleHRdICRQcmluY2lwYWxDb250ZXh0LAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsKCldCiAgICAgICAgW1N0cmluZ10gJERvbWFpbgogICAgKQoKICAgICMgQ29tcGFyZSBhZ2FpbnN0IE5hbWUgb2YgJHByaW5jaXBhbENvbnRleHQgLSB0eXBpY2FsbHkgdGhlIHVuZGVjb3JhdGVkIGRvbWFpbiBuYW1lCiAgICBbYm9vbF0gJGlzU2FtZURvbWFpbiA9IFtTeXN0ZW0uU3RyaW5nXTo6Q29tcGFyZSgkRG9tYWluLCAkUHJpbmNpcGFsQ29udGV4dC5OYW1lLCBbU3lzdGVtLlN0cmluZ0NvbXBhcmlzb25dOjpPcmRpbmFsSWdub3JlQ2FzZSkgLWVxIDAKCiAgICBpZiAoJGlzU2FtZURvbWFpbiAtZXEgJGZhbHNlKQogICAgewogICAgICAgICRkb3RJbmRleCA9ICRQcmluY2lwYWxDb250ZXh0LkNvbm5lY3RlZFNlcnZlci5JbmRleE9mKCIuIikKICAgICAgICBpZiAoJGRvdEluZGV4IC1uZSAtMSkKICAgICAgICB7CiAgICAgICAgICAgICRwcmluY2lwYWxEb21haW4gPSAkUHJpbmNpcGFsQ29udGV4dC5Db25uZWN0ZWRTZXJ2ZXIuU3Vic3RyaW5nKCRkb3RJbmRleCArIDEpCiAgICAgICAgICAgICRpc1NhbWVEb21haW4gPSBbU3lzdGVtLlN0cmluZ106OkNvbXBhcmUoJERvbWFpbiwgJHByaW5jaXBhbERvbWFpbiwgW1N5c3RlbS5TdHJpbmdDb21wYXJpc29uXTo6T3JkaW5hbElnbm9yZUNhc2UpIC1lcSAwCiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAkaXNTYW1lRG9tYWluCgp9CgpmdW5jdGlvbiBSZXNvbHZlTmFtZXNUb1ByaW5jaXBhbHMKewogICAgcGFyYW0KICAgICgKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuUHJpbmNpcGFsQ29udGV4dF0gJExvY2FsUHJpbmNpcGFsQ29udGV4dCwKCiAgICAgICAgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5QcmluY2lwYWxDb250ZXh0XSAkQ3JlZGVudGlhbFByaW5jaXBhbENvbnRleHQsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGwoKV0KICAgICAgICBbU3RyaW5nW11dICRPYmplY3ROYW1lcywKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbCgpXQogICAgICAgIFtTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0XSAkRGlzcG9zYWJsZXMsCgoJCVtTeXN0ZW0uTmV0Lk5ldHdvcmtDcmVkZW50aWFsXQoJCSROZXR3b3JrQ3JlZGVudGlhbAogICAgKQoKICAgIFNldC1TdHJpY3RNb2RlIC1WZXJzaW9uIExhdGVzdAoKICAgICRwcmluY2lwYWxzID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0CgogICAgZm9yZWFjaCgkb2JqZWN0TmFtZSBpbiAkT2JqZWN0TmFtZXMpCiAgICB7CiAgICAgICAgIyB0cnVlIGlmIHRoZSBuYW1lIHdhcyBxdWFsaWZpZWQgcmVsYXRpdmUgdG8gdGhlIGxvY2FsIG1hY2hpbmUKICAgICAgICAjIG9yIG5vIHNjb3BlIHdhcyBwcm92aWRlZCAoZS5nLiwgYSBzaW1wbGUgbmFtZSkKICAgICAgICAkaXNMb2NhbE1hY2hpbmVRdWFsaWZpZWQgPSAkdHJ1ZQoKICAgICAgICAjIHRoZSB1c2VyIG5hbWUgcGFyc2VkIGZyb20gYSBzY29wZWQgbmFtZS4KICAgICAgICAjIGRlZmF1bHQgdG8gdGhlIHBhc3NlZCBpbiB2YWx1ZS4KICAgICAgICAkdXNlck5hbWUgPSAkb2JqZWN0TmFtZQoKICAgICAgICAjIFRoZSBxdWFsaWZpZXIgZm9yIHRoZSBuYW1lIGluIHRoZSBmb3JtIG9mIHNjb3BlXG5hbWUgb3IgbmFtZUBkb21haW4uLi4KICAgICAgICAkc2NvcGUgPSAkbnVsbAoKICAgICAgICAjIENoZWNrIGZvciBtYWNoaW5lXG5hbWUgb3IgZG9tYWluXG5hbWUKICAgICAgICAkc2VwYXJhdG9ySW5kZXggPSAkb2JqZWN0TmFtZS5JbmRleE9mQW55KCdcJykKICAgICAgICBpZiAoJHNlcGFyYXRvckluZGV4IC1uZSAtMSkKICAgICAgICB7CiAgICAgICAgICAgICRzY29wZSA9ICRvYmplY3ROYW1lLlN1YnN0cmluZygwLCAkc2VwYXJhdG9ySW5kZXgpCiAgICAgICAgICAgICR1c2VyTmFtZSA9ICR1c2VyTmFtZSA9ICRvYmplY3ROYW1lLlN1YnN0cmluZygkc2VwYXJhdG9ySW5kZXgrMSkKICAgICAgICAgICAgJGlzTG9jYWxNYWNoaW5lUXVhbGlmaWVkID0gJG9iamVjdE5hbWUuU3RhcnRzV2l0aCgnLlwnKSAtb3IgW1N5c3RlbS5TdHJpbmddOjpDb21wYXJlKCRzY29wZSwgW0Vudmlyb25tZW50XTo6TWFjaGluZU5hbWUsIFtTeXN0ZW0uU3RyaW5nQ29tcGFyaXNvbl06Ok9yZGluYWxJZ25vcmVDYXNlKSAtZXEgMAogICAgICAgIH0KICAgICAgICAjIENoZWNrIGZvciBVUE4gKG5hbWVAZG9tYWluKQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgICRzZXBhcmF0b3JJbmRleCA9ICRvYmplY3ROYW1lLkluZGV4T2ZBbnkoIkAiKQogICAgICAgICAgICBpZiAoJHNlcGFyYXRvckluZGV4IC1uZSAtMSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJHNjb3BlID0gJG9iamVjdE5hbWUuU3Vic3RyaW5nKCRzZXBhcmF0b3JJbmRleCsxKQogICAgICAgICAgICAgICAgJHVzZXJOYW1lID0gJHVzZXJOYW1lID0gJG9iamVjdE5hbWUuU3Vic3RyaW5nKDAsICRzZXBhcmF0b3JJbmRleCkKICAgICAgICAgICAgICAgICRpc0xvY2FsTWFjaGluZVF1YWxpZmllZCA9ICRmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIFRoZSBhY2NvdW50IGlzIGVpdGhlciBxdWFsaWZpZWQgdG8gdGhlIGxvY2FsIG1hY2hpbmUgb3IgaXMgdW5xdWFsaWZpZWQuCiAgICAgICAgaWYgKCRpc0xvY2FsTWFjaGluZVF1YWxpZmllZCAtZXEgJHRydWUpCiAgICAgICAgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICgkTG9jYWxpemVkRGF0YS5SZXNvbHZpbmdMb2NhbEFjY291bnQgLWYgJG9iamVjdE5hbWUpCgogICAgICAgICAgICAjIFJlc29sdmUgYWdhaW5zdCB0aGUgbG9jYWwgY29udGV4dCBhbmQgZmFpbCBpZiBub3QgcmVzb2x2ZWQuCiAgICAgICAgICAgICRwcmluY2lwYWwgPSBSZXNvbHZlTmFtZVRvUHJpbmNpcGFsIC1QcmluY2lwYWxDb250ZXh0ICRMb2NhbFByaW5jaXBhbENvbnRleHQgLU9iamVjdE5hbWUgJHVzZXJOYW1lCiAgICAgICAgICAgIGlmKCRwcmluY2lwYWwgLW5lICRudWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkbnVsbCA9ICRwcmluY2lwYWxzLkFkZCgkcHJpbmNpcGFsKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgfQogICAgICAgICAgICAjIFRoZSBwcm92aWRlZCBuYW1lIGRvZXMgbm90IG1hdGNoIGFueSBsb2NhbCBVc2VyLCBHcm91cCwgb3IgQ29tcHV0ZXIuIFRocm93IGFuIGV4Y2VwdGlvbi4KICAgICAgICAgICAgVGhyb3dJbnZhbGlkQXJndW1lbnRFcnJvciAtRXJyb3JJZCAiUHJpbmNpcGFsTm90Rm91bmRfTG9jYWxNYWNoaW5lIiAtRXJyb3JNZXNzYWdlICgkTG9jYWxpemVkRGF0YS5Db3VsZE5vdEZpbmRQcmluY2lwYWwgLWYgJG9iamVjdE5hbWUpCiAgICAgICAgfQoKICAgICAgICAjIFRoZSBhY2NvdW50IGhhcyBhIHF1YWxpZmllciB0aGF0IGlzIG5vdCB0aGUgbG9jYWwgbWFjaGluZS4KICAgICAgICAjIEF0dGVtcHQgdG8gcmVzb2x2ZSBpdCByZWxhdGl2ZSB0byBhIGRvbWFpbi4KICAgICAgICAjIE5PVEU6IElmIG5vIGNyZWRlbnRpYWxzIGFyZSBwcm92aWRlZCwgYW4gSW52YWxpZEFyZ3VtZW50IGVycm9yIGlzIHJlcG9ydGVkLgogICAgICAgIGlmICgkQ3JlZGVudGlhbFByaW5jaXBhbENvbnRleHQgLW5lICRudWxsKQogICAgICAgIHsKICAgICAgICAgICAgIyBUaGUgUHJpbmNpcGFsQ29udGV4dCBjcmVhdGVkIHdoZW4gdGhlIGFjY291bnQgZG9tYWluIGRvZXNuJ3QgbWF0Y2ggdGhlIGNyZWRlbnRpYWwncyBkb21haW4uCiAgICAgICAgICAgIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuUHJpbmNpcGFsQ29udGV4dF0gJHJlZGlyZWN0UHJpbmNpcGFsQ29udGV4dCA9ICRudWxsCiAgICAgICAgICAgICMgVGhlIFByaW5jaXBhbENvbnRleHQgdG8gdXNlIHRvIHJlc29sdmUgdGhlIGFjY291bnQKICAgICAgICAgICAgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5QcmluY2lwYWxDb250ZXh0XSAkZG9tYWluUHJpbmNpcGFsY29udGV4dCA9ICAkQ3JlZGVudGlhbFByaW5jaXBhbENvbnRleHQKCiAgICAgICAgICAgICMgSWYgdGhlIGFjY291bnQgaXMgaW4gYSBkb21haW4gdGhhdCBkb2VzIG5vdCBtYXRjaCB0aGUgZG9tYWluIGluIHRoZSBwYXNzZWQgY3JlZGVudGlhbHMsIGF0dGVtcHQgdG8gY29ubmVjdCB0byB0aGUKICAgICAgICAgICAgIyBhY2NvdW50J3MgZG9tYWluIHVzaW5nIHRoZSBwYXNzZWQgaW4gY3JlZGVudGlhbHMuICBUaGlzIG1lYW5zIHRoZSBwYXNzZWQgaW4gY3JlZGVudGlhbHMgbXVzdCBoYXZlCiAgICAgICAgICAgICMgcmlnaHRzIGluIHRoZSBvdGhlciBkb21haW4gdG8gcmVzb2x2ZSB0aGUgcHJpbmNpcGFsLgogICAgICAgICAgICBpZiAoKElzU2FtZURvbWFpbiAtUHJpbmNpcGFsQ29udGV4dCAkQ3JlZGVudGlhbFByaW5jaXBhbENvbnRleHQgLURvbWFpbiAkc2NvcGUpIC1lcSAkZmFsc2UpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgKCRMb2NhbGl6ZWREYXRhLlJlZGlyZWN0RG9tYWluIC1mICAkc2NvcGUsICRPYmplY3ROYW1lKQoKICAgICAgICAgICAgICAgICRuZXR3b3JrVXNlciA9IFtTeXN0ZW0uU3RyaW5nXTo6Rm9ybWF0KCJ7MH1cezF9IiwgJE5ldHdvcmtDcmVkZW50aWFsLkRvbWFpbiwgJE5ldHdvcmtDcmVkZW50aWFsLlVzZXJOYW1lKQogICAgICAgICAgICAgICAgIyBVc2UgdGhlIG5ldyBQcmluY2lwYWxDb250ZXh0IGZvciB0aGUgcmVzb2x2ZSBjYWxsLgogICAgICAgICAgICAgICAgJGRvbWFpblByaW5jaXBhbENvbnRleHQgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5QcmluY2lwYWxDb250ZXh0IC1Bcmd1bWVudExpc3QgKFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuQ29udGV4dFR5cGVdOjpEb21haW4sICRzY29wZSwgJG5ldHdvcmtVc2VyLCAkTmV0d29ya0NyZWRlbnRpYWwuUGFzc3dvcmQpCiAgICAgICAgICAgICAgICAjIHRoZSBjYWxsZXIgd2lsbCBkaXNwb3NlIHRoZSBQcmluY2lwYWxDb250ZXh0IHdoZW4gaXQgaXMgZG9uZSB3aXRoIHRoZSByZXNvbHZlZCBwcmluY2lwYWwgaW5zdGFuY2UuCiAgICAgICAgICAgICAgICAkZGlzcG9zYWJsZXMuQWRkKCRkb21haW5QcmluY2lwYWxDb250ZXh0KSB8IG91dC1udWxsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgKCRMb2NhbGl6ZWREYXRhLlJlc29sdmluZ0RvbWFpbkFjY291bnQgLWYgJG9iamVjdE5hbWUsJGRvbWFpblByaW5jaXBhbGNvbnRleHQuTmFtZSkKICAgICAgICAgICAgJHByaW5jaXBhbCA9IFJlc29sdmVOYW1lVG9QcmluY2lwYWwgLVByaW5jaXBhbENvbnRleHQgJGRvbWFpblByaW5jaXBhbGNvbnRleHQgLU9iamVjdE5hbWUgJHVzZXJOYW1lCgogICAgICAgICAgICBpZiAoJHByaW5jaXBhbCAtbmUgJG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRudWxsID0gJHByaW5jaXBhbHMuQWRkKCRwcmluY2lwYWwpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIFRoZSBwcm92aWRlZCBuYW1lIGRvZXMgbm90IG1hdGNoIGFueSBVc2VyLCBHcm91cCwgb3IgQ29tcHV0ZXIgaW4gdGhlIGRlZmluZWQgc2NvcGUuCiAgICAgICAgICAgIFRocm93SW52YWxpZEFyZ3VtZW50RXJyb3IgLUVycm9ySWQgIlByaW5jaXBhbE5vdEZvdW5kX1Byb3ZpZGVkQ3JlZGVudGlhbCIgLUVycm9yTWVzc2FnZSAoJExvY2FsaXplZERhdGEuQ291bGROb3RGaW5kUHJpbmNpcGFsIC1mICRvYmplY3ROYW1lKQogICAgICAgIH0KCiAgICAgICAgIyBUaGUgcHJvdmlkZWQgbmFtZSBpcyBub3Qgc2NvcGVkIHRvIHRoZSBsb2NhbCBtYWNoaW5lIGFuZCBubyBjcmVkZW50aWFscyB3ZXJlIHByb3ZpZGVkLgogICAgICAgICMgVGhpcyBpcyBhbiB1bnN1cHBvcnRlZCB1c2UgY2FzZSBzaW5jZSB3ZSdyZSBydW5uaW5nIGFzIFNZU1RFTSBhbmQgY3JlZGVudGlhbHMgYXJlIHJlcXVpcmVkIHRvIHJlc29sdmUgb2ZmLWJveC4KICAgICAgICBUaHJvd0ludmFsaWRBcmd1bWVudEVycm9yIC1FcnJvcklkICJQcmluY2lwYWxOb3RGb3VuZE5vQ3JlZGVudGlhbCIgLUVycm9yTWVzc2FnZSAoJExvY2FsaXplZERhdGEuRG9tYWluQ3JlZGVudGlhbHNSZXF1aXJlZCAtZiAkb2JqZWN0TmFtZSkKICAgIH0KCiAgICBpZigkcHJpbmNpcGFscyAtbmUgJG51bGwpCiAgICB7CiAgICAgICAgcmV0dXJuICRwcmluY2lwYWxzCiAgICB9CgogICAgIyBSZXR1cm4gYW4gZW1wdHkgYXJyYXkuCiAgICByZXR1cm4gLEAoJHByaW5jaXBhbHMpCn0KCmZ1bmN0aW9uIFJlc29sdmVOYW1lVG9QcmluY2lwYWwKewogICAgcGFyYW0KICAgICgKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuUHJpbmNpcGFsQ29udGV4dF0gJFByaW5jaXBhbENvbnRleHQsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGwoKV0KICAgICAgICBbU3RyaW5nXSAkT2JqZWN0TmFtZQogICAgKQoKICAgIFNldC1TdHJpY3RNb2RlIC1WZXJzaW9uIExhdGVzdAoKICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgKCRMb2NhbGl6ZWREYXRhLlJlc29sdmluZ1VzZXIgLWYgJE9iamVjdE5hbWUpCgogICAgIyBUcnkgdG8gZmluZCBhIG1hdGNoaW5nIHVzZXIgcHJpbmNpcGFsLgogICAgJHByaW5jaXBhbCA9IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuVXNlclByaW5jaXBhbF06OkZpbmRCeUlkZW50aXR5KCRQcmluY2lwYWxDb250ZXh0LCAkT2JqZWN0TmFtZSkKCiAgICBpZigkcHJpbmNpcGFsIC1uZSAkbnVsbCkKICAgIHsKICAgICAgICByZXR1cm4gJHByaW5jaXBhbAogICAgfQoKICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgKCRMb2NhbGl6ZWREYXRhLlJlc29sdmluZ0dyb3VwIC1mICRPYmplY3ROYW1lKQoKICAgICMgVHJ5IHRvIGZpbmQgYSBtYXRjaGluZyBncm91cCBwcmluY2lwYWwuCiAgICAkcHJpbmNpcGFsID0gW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5Hcm91cFByaW5jaXBhbF06OkZpbmRCeUlkZW50aXR5KCRQcmluY2lwYWxDb250ZXh0LCAkT2JqZWN0TmFtZSkKCiAgICBpZigkcHJpbmNpcGFsIC1uZSAkbnVsbCkKICAgIHsKICAgICAgICByZXR1cm4gJHByaW5jaXBhbAogICAgfQoKICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgKCRMb2NhbGl6ZWREYXRhLlJlc29sdmluZ0NvbXB1dGVyIC1mICRPYmplY3ROYW1lKQoKICAgICMgVHJ5IHRvIGZpbmQgYSBtYXRjaGluZyBtYWNoaW5lIHByaW5jaXBhbC4KICAgICRwcmluY2lwYWwgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LkNvbXB1dGVyUHJpbmNpcGFsXTo6RmluZEJ5SWRlbnRpdHkoJFByaW5jaXBhbENvbnRleHQsICRPYmplY3ROYW1lKQoKICAgIFtib29sXSAkaXNEb21haW4gPSAkUHJpbmNpcGFsQ29udGV4dC5Db250ZXh0VHlwZSAtZXEgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5Db250ZXh0VHlwZV06OkRvbWFpbgogICAgaWYgKCRpc0RvbWFpbiAtZXEgJGZhbHNlKQogICAgewogICAgICAgIHRyeQogICAgICAgIHsKICAgICAgICAgICAgJHByaW5jaXBhbCA9IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuQ29tcHV0ZXJQcmluY2lwYWxdOjpGaW5kQnlJZGVudGl0eSgkUHJpbmNpcGFsQ29udGV4dCwgJE9iamVjdE5hbWUpOwogICAgICAgIH0KICAgICAgICBjYXRjaCBbRXhjZXB0aW9uXQogICAgICAgIHsKICAgICAgICAgICAgIyBUaGlzIG1ldGhvZCBjYW4gdGhyb3cgd2l0aCBhIHBhcnRpY3VsYXIgZXJyb3IgY29kZSBpZiBhIGNvbXB1dGVyIGlzIG5vdCBmb3VuZC4KICAgICAgICAgICAgaWYoJF8uRXhjZXB0aW9uLkVycm9yQ29kZSAtbmUgLTIxNDc0NjcyNTkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRocm93ICRfLkV4Y2VwdGlvbgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJHByaW5jaXBhbCA9ICRudWxsICMgRmFpbHVyZSB0byBmaW5kIGEgY29tcHV0ZXIgcHJpbmNpcGFsLgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgICRwcmluY2lwYWwgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50LkNvbXB1dGVyUHJpbmNpcGFsXTo6RmluZEJ5SWRlbnRpdHkoJFByaW5jaXBhbENvbnRleHQsICRPYmplY3ROYW1lKQogICAgfQoKICAgIGlmKCRwcmluY2lwYWwgLW5lICRudWxsKQogICAgewogICAgICAgIHJldHVybiAkcHJpbmNpcGFsCiAgICB9CgogICAgcmV0dXJuICRudWxsCn0KCmZ1bmN0aW9uIEFkZEdyb3VwTWVtYmVycwp7CiAgICBwYXJhbQogICAgKAogICAgICAgIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuR3JvdXBQcmluY2lwYWxdICRHcm91cCwKCiAgICAgICAgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY2NvdW50TWFuYWdlbWVudC5QcmluY2lwYWxbXV0gJFByaW5jaXBhbHMKICAgICkKCiAgICBTZXQtU3RyaWN0TW9kZSAtVmVyc2lvbiBMYXRlc3QKCiAgICAjIE1ha2UgY2hhbmdlcyB0byB0aGUgZ3JvdXAuCiAgICBmb3JlYWNoKCRwcmluY2lwYWwgaW4gJFByaW5jaXBhbHMpCiAgICB7CiAgICAgICAgJGdyb3VwLk1lbWJlcnMuQWRkKCRwcmluY2lwYWwpOwogICAgfQp9CgpmdW5jdGlvbiBSZW1vdmVHcm91cE1lbWJlcnMKewogICAgcGFyYW0KICAgICgKICAgICAgICBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjY291bnRNYW5hZ2VtZW50Lkdyb3VwUHJpbmNpcGFsXSAkR3JvdXAsCgogICAgICAgIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWNjb3VudE1hbmFnZW1lbnQuUHJpbmNpcGFsW11dICRQcmluY2lwYWxzCiAgICApCgogICAgU2V0LVN0cmljdE1vZGUgLVZlcnNpb24gTGF0ZXN0CgogICAgIyBNYWtlIGNoYW5nZXMgdG8gdGhlIGdyb3VwLgogICAgZm9yZWFjaCgkcHJpbmNpcGFsIGluICRQcmluY2lwYWxzKQogICAgewogICAgICAgICRudWxsID0gJGdyb3VwLk1lbWJlcnMuUmVtb3ZlKCRwcmluY2lwYWwpOwogICAgfQp9Cgo8IwouU3lub3BzaXMKVmFsaWRhdGVzIHRoZSBHcm91cCBuYW1lIGZvciBpbnZhbGlkIGNoYXJhY3RlcnMuCiM+CmZ1bmN0aW9uIFZhbGlkYXRlR3JvdXBOYW1lCnsKICAgIHBhcmFtCiAgICAoCiAgICAgICAgW3BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3lzdGVtLlN0cmluZ10KICAgICAgICAkR3JvdXBOYW1lCiAgICApCgogICAgIyBDaGVjayBpZiB0aGUgbmFtZSBjb25zaXN0cyBvZiBvbmx5IHBlcmlvZHMgYW5kL29yIHdoaXRlIHNwYWNlcy4KICAgIFtib29sXSAkd3JvbmdOYW1lID0gJHRydWU7CgogICAgZm9yKCRpID0gMDsgJGkgLWx0ICRHcm91cE5hbWUuTGVuZ3RoOyAkaSsrKQogICAgewogICAgICAgIGlmKC1ub3QgW0NoYXJdOjpJc1doaXRlU3BhY2UoJEdyb3VwTmFtZSwgJGkpIC1hbmQgJEdyb3VwTmFtZVskaV0gLW5lICcuJykKICAgICAgICB7CiAgICAgICAgICAgICR3cm9uZ05hbWUgPSAkZmFsc2U7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICAkaW52YWxpZENoYXJzID0gQCgnXCcsJy8nLCciJywnWycsJ10nLCc6JywnfCcsJzwnLCc+JywnKycsJz0nLCc7JywnLCcsJz8nLCcqJywnQCcpCgogICAgaWYoJHdyb25nTmFtZSkKICAgIHsKICAgICAgICBUaHJvd0ludmFsaWRBcmd1bWVudEVycm9yIC1FcnJvcklkICJHcm91cE5hbWVIYXNPbmx5V2hpdGVTcGFjZXNBbmREb3RzIiAtRXJyb3JNZXNzYWdlICgkTG9jYWxpemVkRGF0YS5JbnZhbGlkR3JvdXBOYW1lIC1mICRHcm91cE5hbWUsIFtzdHJpbmddOjpKb2luKCIgIiwgJGludmFsaWRDaGFycykpCiAgICB9CgogICAgaWYoJEdyb3VwTmFtZS5JbmRleE9mQW55KCRpbnZhbGlkQ2hhcnMpIC1uZSAtMSkKICAgIHsKICAgICAgICBUaHJvd0ludmFsaWRBcmd1bWVudEVycm9yIC1FcnJvcklkICJHcm91cE5hbWVIYXNJbnZhbGlkQ2hhcmFjaHRlciIgLUVycm9yTWVzc2FnZSAoJExvY2FsaXplZERhdGEuSW52YWxpZEdyb3VwTmFtZSAtZiAkR3JvdXBOYW1lLCBbc3RyaW5nXTo6Sm9pbigiICIsICRpbnZhbGlkQ2hhcnMpKQogICAgfQp9Cgo8IwouU3lub3BzaXMKVGhyb3dzIGFuIGFyZ3VtZW50IGVycm9yLgojPgpmdW5jdGlvbiBUaHJvd0ludmFsaWRBcmd1bWVudEVycm9yCnsKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbQogICAgKAoKICAgICAgICBbcGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTeXN0ZW0uU3RyaW5nXQogICAgICAgICRFcnJvcklkLAoKICAgICAgICBbcGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTeXN0ZW0uU3RyaW5nXQogICAgICAgICRFcnJvck1lc3NhZ2UKICAgICkKCiAgICAkZXJyb3JDYXRlZ29yeT1bU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5FcnJvckNhdGVnb3J5XTo6SW52YWxpZEFyZ3VtZW50CiAgICAkZXhjZXB0aW9uID0gTmV3LU9iamVjdCBTeXN0ZW0uQXJndW1lbnRFeGNlcHRpb24gJEVycm9yTWVzc2FnZTsKICAgICRlcnJvclJlY29yZCA9IE5ldy1PYmplY3QgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5FcnJvclJlY29yZCAkZXhjZXB0aW9uLCAkRXJyb3JJZCwgJGVycm9yQ2F0ZWdvcnksICRudWxsCiAgICB0aHJvdyAkZXJyb3JSZWNvcmQKfQoKPCMKLlN5bm9wc2lzCldyaXRlcyBlaXRoZXIgdG8gVmVyYm9zZSBvciBTaG91bGRQcm9jZXNzIGNoYW5uZWwuCiM+CmZ1bmN0aW9uIFdyaXRlLUxvZwp7CiAgICBbQ21kbGV0QmluZGluZyhTdXBwb3J0c1Nob3VsZFByb2Nlc3M9JHRydWUpXQogICAgcGFyYW0KICAgICgKICAgICAgICBbcGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTeXN0ZW0uU3RyaW5nXQogICAgICAgICRNZXNzYWdlCiAgICApCgogICAgaWYgKCRQU0NtZGxldC5TaG91bGRQcm9jZXNzKCRNZXNzYWdlLCAkbnVsbCwgJG51bGwpKQogICAgewogICAgICAgIFdyaXRlLVZlcmJvc2UgJE1lc3NhZ2UKICAgIH0KfQoKRXhwb3J0LU1vZHVsZU1lbWJlciAtZnVuY3Rpb24gR2V0LVRhcmdldFJlc291cmNlLCBTZXQtVGFyZ2V0UmVzb3VyY2UsIFRlc3QtVGFyZ2V0UmVzb3VyY2UK
