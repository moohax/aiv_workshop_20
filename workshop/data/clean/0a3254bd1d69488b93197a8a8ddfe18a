SPSD_Deployment.ps1,7c7c4e2996326ea2a355cb8df019748b,Scan result is 1. IsMalware: 0,IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIFNoYXJlUG9pbnQgU29sdXRpb24gRGVwbG95ZXIgKFNQU0QpCiMgVmVyc2lvbiAgICAgICAgICA6IDUuMC4zLjY0MzgKIyBVcmwgICAgICAgICAgICAgIDogaHR0cDovL3Nwc2QuY29kZXBsZXguY29tCiMgQ3JlYXRvciAgICAgICAgICA6IE1hdHRoaWFzIEVpbmlnLCBodHRwOi8vdHdpdHRlci5jb20vbWF0dGVpbgojIExpY2Vuc2UgICAgICAgICAgOiBNUy1QTAojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgojcmVnaW9uIERlcGxveW1lbnQKICAgICNyZWdpb24gRGVwbG95bWVudC5BY3Rpb25zCgkgICAgI3JlZ2lvbiBSZWN5Y2xlQXBwUG9vbHMKCSAgICAjIERlc2M6IFJlY3ljbGVzIElJUyBhcHBsaWNhdGlvbiBwb29scyAoZWl0aGVyIG9ubHkgU2hhcmVQb2ludCByZWxhdGVkIG9yIGFsbCkKICAgICAgICBGdW5jdGlvbiBSZWN5Y2xlQXBwUG9vbHMoW2Jvb2xdJGFsbCl7CiAgICAgICAgICAgICMgSW5zcGlyZWQgYnkgaHR0cDovL2Jsb2cubWlqYWxrby5jb20vMjAxMS8xMS91c2luZy1wb3dlcnNoZWxsLXRvLWdldC1paXMtd29ya2VyLmh0bWwKICAgICAgICAgICAgZm9yZWFjaCAoJHNlcnZlciBpbiAkc2VydmVycykKICAgICAgICAgICAgeyAgICAgICAgICAgCiAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgIlJlY3ljbGluZyBJSVMgYXBwbGljYXRpb24gcG9vbHMgb24gc2VydmVyICQoJHNlcnZlcikiIC10eXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQKICAgICAgICAgICAgICAgIEN1c3RvbUVudGVyLVBTU2Vzc2lvbiAkc2VydmVyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgICAgICAkYXBwUG9vbHMgPSAkbnVsbAogICAgICAgICAgICAgICAgICAgIGlmKCRhbGwpewogICAgICAgICAgICAgICAgICAgICAgICAkYXBwUG9vbHMgPSBkaXIgSUlTOlxBcHBQb29scyB8IEZvckVhY2gtT2JqZWN0IHsgJF8uTmFtZSB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICMgZ2V0IGFwcHBvb2xzIGZyb20gd2ViIGFwcGxpY2F0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICAkYXBwUG9vbHMgPSBHZXQtc3B3ZWJhcHBsaWNhdGlvbiAtaW5jbHVkZWNlbnRyYWxhZG1pbmlzdHJhdGlvbiB8IEZvckVhY2gtT2JqZWN0IHsgR2V0LUl0ZW0gIklJUzpcU2l0ZXNcJCgkXy5EaXNwbGF5TmFtZSkifSB8IEZvckVhY2gtT2JqZWN0IHskXy5hcHBsaWNhdGlvblBvb2x9CiAgICAgICAgICAgICAgICAgICAgICAgICMgZ2V0IGFwcHBvb2xzIGZyb20gc2VydmljZSBhcHBsaWNhdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcFBvb2xzICs9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvblBvb2wgfCBGb3JFYWNoLU9iamVjdCB7JF8uTmFtZX0KICAgICAgICAgICAgICAgICAgICB9CgkJCSAgICAgICAgaWYoJGFwcFBvb2xzKXsKCSAgICAgICAgICAgICAgICAgICAgJGFwcFBvb2xzIHwgRm9yRWFjaC1PYmplY3QgewoJICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1tZXNzYWdlICJSZWN5Y2xpbmcgJyQoJF8pJyIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudCAtTm9OZXdsaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcG9vbCA9ICRfCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBpZiBhcHBwb29sIGV4aXN0cyB1bmRlciBkaXNwbGF5IG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHZXQtV2ViQXBwUG9vbFN0YXRlIC1OYW1lICRhcHBwb29sIHwgT3V0LU51bGwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1tZXNzYWdlICIiIC1Ob0luZGVudCAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgR2V0IHNlcnZpY2UgYXBwcG9vbCBiYXNlZCBvbiBHdWlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHBvb2wgPSBHZXQtU1BTZXJ2aWNlQXBwbGljYXRpb25Qb29sIHwgV2hlcmUtT2JqZWN0IHskXy5OYW1lIC1lcSAkYXBwcG9vbH0gfCBGb3JFYWNoLU9iamVjdCB7JF8uSUQgLXJlcGxhY2UgIi0iLCAiIn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgIiAoJGFwcHBvb2wpIiAtdHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0JICAgICAgICAgICAgICAgICAgICAgICAgCgkgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgIlJlY3ljbGluZy4uLiIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1Ob05ld2xpbmUKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiggKEdldC1XZWJBcHBQb29sU3RhdGUgLU5hbWUgJGFwcHBvb2wpLlZhbHVlIC1lcSAiU3RhcnRlZCIpewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlc3RhcnQtV2ViQXBwUG9vbCAtTmFtZSAkYXBwcG9vbAoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnQtV2ViQXBwUG9vbCAtTmFtZSAkYXBwcG9vbAoJICAgICAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtbWVzc2FnZSAiRG9uZSIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuU3VjY2VzcyAtTm9JbmRlbnQKCSAgICAgICAgICAgICAgICAgICAgICAgIEVuc3VyZUFwcFBvb2xSdW5uaW5nIC1hcHBQb29sTmFtZSAkXwoJICAgICAgICAgICAgICAgICAgICAgICAgTG9nT3V0ZGVudAoJICAgICAgICAgICAgICAgICAgICB9CgkJCSAgICAgICAgfQoJCQkgICAgICAgIGVsc2V7CgkgICAgICAgICAgICAgICAgICAgIExvZyAtbWVzc2FnZSAiTm90IGFwcGxpY2F0aW9uIHBvb2xzIGZvdW5kISIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZwoJCQkgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZpbmFsbHl7CiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tRXhpdC1QU1Nlc3Npb24gJHNlcnZlcgogICAgICAgICAgICAgICAgICAgIExvZ091dGRlbnQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAjZW5kcmVnaW9uCgkgICAgI3JlZ2lvbiBQcmludElJU1N0YXR1cwoJICAgICMgRGVzYzogQmVhdXR5ZmllcyB0aGUgSUlTIHN0YXR1cwogICAgICAgIEZ1bmN0aW9uIFByaW50SUlTU3RhdHVzKFtBcnJheV0kc3RhdHVzTGluZXMpewogICAgICAgICAgJHN0YXR1c0xpbmVzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgaWYoJF8uVHJpbSgpKXsKICAgICAgICAgICAgICAgICAgICAkc3RhdHVzTGluZSA9ICRfLlNwbGl0KCI6IikKICAgICAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgKCRzdGF0dXNMaW5lWzBdLlRyaW0oKSsgIi4uLiIpIC10eXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9OZXdsaW5lCiAgICAgICAgICAgICAgICAgICAgaWYoJHN0YXR1c0xpbmVbMV0uQ29udGFpbnMoIlJ1bm5pbmciKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtbWVzc2FnZSAoJHN0YXR1c0xpbmVbMV0uVHJpbSgpKSAtdHlwZSAkU1BTRC5Mb2dUeXBlcy5TdWNjZXNzIC1Ob0luZGVudAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlaWYoJHN0YXR1c0xpbmVbMV0uQ29udGFpbnMoIlN0b3BwZWQiKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtbWVzc2FnZSAoJHN0YXR1c0xpbmVbMV0uVHJpbSgpKSAtdHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1tZXNzYWdlICgkc3RhdHVzTGluZVsxXS5UcmltKCkpIC10eXBlICRTUFNELkxvZ1R5cGVzLldhcm5pbmcgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICNlbmRyZWdpb24KCSAgICAjcmVnaW9uIFJlc2V0SUlTCgkgICAgIyBEZXNjOiBSdW5zIElJUyByZXNldCBvbiBhbGwgc2VydmVycyBpbiB0aGUgZmFybSAKICAgICAgICAjICBSZWY6IGh0dHA6Ly93ZWxseXRvbmlhbi5jb20vMjAxMi8wNC9paXMtcmVzZXQteW91ci13aG9sZS1zaGFyZXBvaW50LWZhcm0vCiAgICAgICAgRnVuY3Rpb24gUmVzZXRJSVMoW2Jvb2xdJGZvcmNlKXsKICAgICAgICAgICAgTG9nIC1tZXNzYWdlICJSZXNldHRpbmcgSW50ZXJuZXQgSW5mb3JtYXRpb24gU2VydmVycyAoSUlTKSBpbiBmYXJtIiAtdHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50CiAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRzZXJ2ZXIgaW4gJHNlcnZlcnMpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTG9nIC1tZXNzYWdlICJSZXNldHRpbmcgSUlTIG9uICRzZXJ2ZXIiIC10eXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQKICAgICAgICAgICAgICAgICAgICBpZigkZm9yY2UpewogICAgICAgICAgICAgICAgICAgICAgICBSdW5Qcm9jZXNzIC1maWxlbmFtZSAiaWlzcmVzZXQiIC1hcmd1bWVudHMgIiRzZXJ2ZXIgL3Jlc3RhcnQgXFwiJHNlcnZlcgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICBSdW5Qcm9jZXNzIC1maWxlbmFtZSAiaWlzcmVzZXQiIC1hcmd1bWVudHMgIiRzZXJ2ZXIgL3Jlc3RhcnQgL25vZm9yY2UgXFwiJHNlcnZlcgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBMb2dPdXRkZW50CiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQgPSAkRGVmYXVsdFRpbWVvdXQKICAgICAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgIkdldHRpbmcgc3RhdHVzIGZvciBJSVMgb24gJHNlcnZlci4uLiIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudCAtTm9OZXdsaW5lCiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQgPSAkRGVmYXVsdFRpbWVvdXQKICAgICAgICAgICAgICAgICAgICAkaWlzc3RhdHVzID0gKGlpc3Jlc2V0ICRzZXJ2ZXIgL3N0YXR1cyAiXFwiJHNlcnZlcikKCQkgICAgICAgICAgICBXaGlsZSgoJGlpc3N0YXR1cyAtbWF0Y2ggIlN0b3BwZWQiIC1vciAkaWlzc3RhdHVzIC1tYXRjaCAiU3RhcnQgcGVuZGluZyIpIC1hbmQgJHRpbWVvdXQgKXsKCQkgICAgICAgICAgICAgICAgTG9nIC1tZXNzYWdlICIuIiAtdHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtTm9OZXdsaW5lIC1Ob0luZGVudAoJCSAgICAgICAgICAgICAgICAkdGltZW91dC09MTAwMAoJCSAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAtTWlsbGlzZWNvbmRzIDEwMDAKICAgICAgICAgICAgICAgICAgICAgICAgJGlpc3N0YXR1cyA9IChpaXNyZXNldCAkc2VydmVyIC9zdGF0dXMgIlxcIiRzZXJ2ZXIpCgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIExvZyAtbWVzc2FnZSAiRG9uZSIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuU3VjY2VzcyAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICBQcmludElJU1N0YXR1cyAtc3RhdHVzTGluZXMgJGlpc3N0YXR1cwogICAgICAgICAgICAgICAgICAgIGlmKCRpaXNzdGF0dXMgLW1hdGNoICJTdG9wcGVkIiAtb3IgJGlpc3N0YXR1cyAtbWF0Y2ggIlN0YXJ0IHBlbmRpbmciKXsKICAgICAgICAgICAgICAgICAgICAgICAgVGhyb3cgIklJUyBvbiAnJHNlcnZlcicgZGlkIG5vdCByZXN0YXJ0IHdpdGhpbiB0aGUgdGltZW91dCBvZiAkKCREZWZhdWx0VGltZW91dCltcyIKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIExvZ091dGRlbnQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmaW5hbGx5ewogICAgICAgICAgICAgICAgTG9nT3V0ZGVudAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICNlbmRyZWdpb24KCSAgICAjcmVnaW9uIFJlc3RhcnRTZXJ2aWNlCgkgICAgIyBEZXNjOiBSZXN0YXJ0cyBhIFdpbmRvd3Mgc2VydmljZSBvbiBhbGwgc2VydmVycyBpbiB0aGUgZmFybQogICAgICAgICMgIFJlZjogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy80MzA0ODIxL2dldC1zdGFydHVwLXR5cGUtb2Ytd2luZG93cy1zZXJ2aWNlLXVzaW5nLXBvd2Vyc2hlbGwKICAgICAgICBGdW5jdGlvbiBSZXN0YXJ0U2VydmljZShbc3RyaW5nXSRzZXJ2aWNlTmFtZSwgW2Jvb2xdJGZvcmNlKXsKICAgICAgICAgICAgaWYoJGZvcmNlKXsKICAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgIkZvcmNlICIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLU5vTmV3bGluZQogICAgICAgICAgICB9CiAgICAgICAgICAgIExvZyAtbWVzc2FnZSAiUmVzdGFydGluZyAkKCRzZXJ2aWNlLkRpc3BsYXlOYW1lKSAoJHNlcnZpY2VOYW1lKSBpbiBmYXJtIiAtdHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50CgkgICAgICAgIHRyeSB7CSAgICAgICAgCgkgICAgICAgICAgICBmb3JlYWNoICgkc2VydmVyIGluICRzZXJ2ZXJzKQoJICAgICAgICAgICAgewogICAgICAgICAgICAgICAgCgkJCQkgICAgJHNlcnZpY2UgPSBHZXQtU2VydmljZSAtQ29tcHV0ZXJOYW1lICRzZXJ2ZXIgLU5hbWUgJHNlcnZpY2VOYW1lIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCgkJICAgICAgICAgICAgaWYoJHNlcnZpY2UpewoJICAgICAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgIlJlc3RhcnRpbmcgb24gJHNlcnZlci4uLiIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1Ob05ld2xpbmUKCSAgICAgICAgICAgICAgICAgICAgJHN0YXJ0dXBNb2RlID0gKEdldC1XbWlPYmplY3QgLUNvbXB1dGVyTmFtZSAkc2VydmVyIC1RdWVyeSAiU2VsZWN0IFN0YXJ0TW9kZSBGcm9tIFdpbjMyX1NlcnZpY2UgV2hlcmUgTmFtZT0nJHNlcnZpY2VOYW1lJyIpLlN0YXJ0TW9kZQoJICAgICAgICAgICAgICAgICAgICBpZigkc3RhcnR1cE1vZGUgLWllcSAiRGlzYWJsZWQiKXsKCSAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtbWVzc2FnZSAiU2VydmljZSBpcyBkaXNhYmxlZCIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZyAtTm9JbmRlbnQKCSAgICAgICAgICAgICAgICAgICAgfQoJCQkJCSAgICBlbHNlewoJCSAgICAgICAgICAgICAgICAgICAgaWYoJGZvcmNlKXsgUmVzdGFydC1TZXJ2aWNlIC1JbnB1dE9iamVjdCAkc2VydmljZSAtZm9yY2UgfQoJCSAgICAgICAgICAgICAgICAgICAgZWxzZXsgUmVzdGFydC1TZXJ2aWNlIC1JbnB1dE9iamVjdCAkc2VydmljZSB9CgkJICAgICAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgIkRvbmUiIC10eXBlICRTUFNELkxvZ1R5cGVzLlN1Y2Nlc3MgLU5vSW5kZW50CgkJICAgICAgICAgICAgICAgICAgICBFbnN1cmVTZXJ2aWNlUnVubmluZyAtc2VydmljZU5hbWUgJHNlcnZpY2VOYW1lIC1jb21wdXRlciAkc2VydmVyCgkJCQkJICAgIH0KCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgZWxzZQoJCSAgICAgICAgICAgIHsKCQkgICAgICAgICAgICAgICAgTG9nIC1tZXNzYWdlICJTZXJ2aWNlIG5vdCBmb3VuZC4iIC10eXBlICRTUFNELkxvZ1R5cGVzLldhcm5pbmcKCQkgICAgICAgICAgICB9CgkJCSAgICB9CgkJICAgIH0gCgkJICAgIGZpbmFsbHl7CiAgICAgICAgICAgICAgICBMb2dPdXRkZW50CiAgICAgICAgICAgIH0KCSAgICB9CiAgICAgICAgI2VuZHJlZ2lvbgoJICAgICNyZWdpb24gV2FybVVwV2ViQXBwcwoJICAgICMgRGVzYzogV2FybXMgdXAgYWxsIHdlYiBhcHBsaWNhdGlvbiB1cmxzIGluIHRoZSBmYXJtIChleGNsdWRpbmcgQ2VudHJhbCBBZG1pbikKICAgICAgICBGdW5jdGlvbiBXYXJtVXBXZWJBcHBzKCl7CiAgICAgICAgICAgIExvZyAtbWVzc2FnZSAiV2FybWluZyB1cCB3ZWIgYXBwbGljYXRpb24gdXJscyIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudAogICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICBHZXQtU1BBbHRlcm5hdGVVcmwgLVpvbmUgRGVmYXVsdCB8IGZvcmVhY2gtb2JqZWN0IHsgV2FybVVwVXJsIC11cmwgJF8uSW5jb21pbmdVcmx9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmluYWxseXsKICAgICAgICAgICAgICAgIExvZ091dGRlbnQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAjZW5kcmVnaW9uCgkgICAgI3JlZ2lvbiBXYXJtVXBBbGxTaXRlcwoJICAgICMgRGVzYzogV2FybXMgdXAgYWxsIFNQU2l0ZXMgaW4gdGhlIGZhcm0gKFdhcm5pbmchIFVzZSB3aXRoIGNhdXRpb24gd2hlbiBoYXZpbmcgYSBsb3Qgb2Ygc2l0ZXMpCiAgICAgICAgRnVuY3Rpb24gV2FybVVwQWxsU2l0ZXMoKXsKICAgICAgICAgICAgTG9nIC1tZXNzYWdlICJXYXJtaW5nIHVwIGFsbCBzaXRlcyBpbiB0aGUgZmFybSIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudAogICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICBHZXQtU1BTaXRlIC1MaW1pdCBBTEwgfCBmb3JlYWNoLW9iamVjdCB7IFdhcm1VcFVybCAtdXJsICRfLnVybCB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmluYWxseXsKICAgICAgICAgICAgICAgIExvZ091dGRlbnQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAjZW5kcmVnaW9uCgkgICAgI3JlZ2lvbiBXYXJtVXBVcmxzCgkgICAgIyBEZXNjOiBXYXJtcyBhIGxpc3Qgb2YgVXJscwogICAgICAgIEZ1bmN0aW9uIFdhcm1VcFVybHMoW0FycmF5XSR1cmxzKXsKICAgICAgICAgICAgTG9nIC1tZXNzYWdlICJXYXJtaW5nIHVwIGN1c3RvbSB1cmxzIiAtdHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50CiAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJHVybCBpbiAkdXJscyl7CiAgICAgICAgICAgICAgICAgICAgV2FybVVwVXJsIC11cmwgJHVybAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZpbmFsbHl7CiAgICAgICAgICAgICAgICBMb2dPdXRkZW50CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgI2VuZHJlZ2lvbgoJICAgICNyZWdpb24gV2FybVVwVXJsCgkgICAgIyBEZXNjOiBXYXJtcyBhIGEgc3BlY2lmaWMgVXJsLCB1c2VzIGEgbG9jYWwgd2ViIHByb3h5IHRvIG92ZXJyaWRlIGxvYWQgYmFsYW5jZXJzCiAgICAgICAgIyAgICAgICBSdW5zIG9uIGFsbCBzZXJ2ZXJzIGluIHRoZSBmYXJtLCByZXF1aXJlcyB0byBoYXZlIHRoZSBMb29wQmFja0NoZWNrIGRpc2FibGVkIG9uIHRoZSBzZXJ2ZXIKICAgICAgICAjICBSZWY6IGJ5IGh0dHA6Ly93d3cuam9udGhlbmVyZC5jb20vMjAxMS8wNC8xOS9lYXN5LXNoYXJlcG9pbnQtMjAxMC13YXJtdXAtc2NyaXB0LXVzaW5nLXBvd2Vyc2hlbGwvCiAgICAgICAgIyAgUmVmOiBodHRwOi8vc2hhcmVwaW50YmxvZy5jb20vMjAxMS8xMC8yMy93YXJtLXVwLWEtc2hhcmVwb2ludC13ZWItYXBwbGljYXRpb24td2l0aC1wb3dlcnNoZWxsLwogICAgICAgICMgIFJlZjovL2JyYW1udXl0cy5iZS8yMDExLzA4LzE4L3NoYXJlcG9pbnQtd2FybXVwLXNjcmlwdC1mb3ItbG9hZGJsYW5jZWQtd2Zlcy8KICAgICAgICBGdW5jdGlvbiBXYXJtVXBVcmwoW3N0cmluZ10kdXJsKXsKICAgICAgICAgICAgaWYoISR1cmwpeyByZXR1cm4gfQogICAgICAgICAgICBMb2cgLW1lc3NhZ2UgIkhpdHRpbmcgdXJsOiAkdXJsLi4uIiAtdHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vTmV3bGluZQogICAgICAgICAgICAjIHNldCB1cCBhIGxvY2FsIHByb3h5IAogICAgICAgICAgICAjIHRoZSBsb29wYmFjayBoYXMgdG8gYmUgZGlzYWJsZWQgdG8gbWFrZSB0aGF0IHdvcmsKICAgICAgICAgICAgJGJ5cGFzc29ubG9jYWwgPSAkZmFsc2UKICAgICAgICAgICAgJHByb3h5dXJpID0gImh0dHA6Ly8iICsgJHNlcnZlcgogICAgICAgICAgICAkcHJveHkgPSBOZXctT2JqZWN0IHN5c3RlbS5OZXQuV2ViUHJveHkoJHByb3h5dXJpLCAkYnlwYXNzb25sb2NhbCkKICAgICAgICAgICAgJFJlcXVlc3QgPSBbU3lzdGVtLk5ldC5IdHRwV2ViUmVxdWVzdF06OkNyZWF0ZSgkdXJsKTsgCiAgICAgICAgICAgICRSZXF1ZXN0LlByb3h5ID0gJHByb3h5CgogICAgICAgICAgICAkUmVxdWVzdC5Vc2VEZWZhdWx0Q3JlZGVudGlhbHMgPSAkdHJ1ZSAKICAgICAgICAgICAgJFJlcXVlc3QuVXNlckFnZW50ICAgICA9ICJTUFNEIFdhcm11cCBzY3JpcHQiCiAgICAgICAgICAgICRSZXF1ZXN0LkNhY2hlUG9saWN5ICAgPSBbU3lzdGVtLk5ldC5DYWNoZS5SZXF1ZXN0Q2FjaGVMZXZlbF06OkJ5cGFzc0NhY2hlCiAgICAgICAgICAgICRSZXF1ZXN0LlRpbWVvdXQgICAgICAgPSAkRGVmYXVsdFRpbWVvdXQKCiAgICAgICAgICAgIHRyeSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIyMgTWFrZSB0aGUgcmVxdWVzdCAKICAgICAgICAgICAgICAgICRSZXNwb25zZSA9ICRSZXF1ZXN0LkdldFJlc3BvbnNlKCk7IAogICAgICAgIAogICAgICAgICAgICAgICAgIyMgUHJvY2VzcyB0aGUgcmVzcG9uc2UgCiAgICAgICAgICAgICAgICBpZigkUmVzcG9uc2UuU3RhdHVzQ29kZSAtZXEgMjAwKSB7IAogICAgICAgICAgICAgICAgICAgIFtpbnRdJExlbmd0aCA9ICRSZXNwb25zZS5Db250ZW50TGVuZ3RoIAogICAgICAgICAgICAgICAgICAgICRTdHJlYW0gPSAkUmVzcG9uc2UuR2V0UmVzcG9uc2VTdHJlYW0oKQogICAgICAgICAgICAgICAgICAgIFtieXRlW11dJENodW5rID0gbmV3LW9iamVjdCBieXRlW10gMTAyNCAKICAgICAgICAgICAgICAgICAgICBbaW50XSRUb3RhbEJ5dGVzUmVhZCA9IDAgCiAgICAgICAgICAgICAgICAgICAgW2ludF0kQnl0ZXNSZWFkID0gMCAKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyMgTG9vcCB0aHJvdWdoIHRoZSBzdHJlYW0gcmVhZGluZyBhIENodW5rICgxMDI0IGJ5dGVzKSBhdCBhIHRpbWUgCiAgICAgICAgICAgICAgICAgICAgZG8geyAKICAgICAgICAgICAgICAgICAgICAgICAgJEJ5dGVzUmVhZCA9ICRTdHJlYW0uUmVhZCgkQ2h1bmssIDAsICRDaHVuay5MZW5ndGgpIAogICAgICAgICAgICAgICAgICAgICAgICAkVG90YWxCeXRlc1JlYWQgKz0gJEJ5dGVzUmVhZCAKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJExlbmd0aCAtZ3QgMCkgCiAgICAgICAgICAgICAgICAgICAgICAgIHsgV3JpdGUtUHJvZ3Jlc3MgIkdFVCAkdXJsIiAiQnl0ZXMgcmVhZDogJFRvdGFsQnl0ZXNSZWFkIG9mICRMZW5ndGgiIC1wZXJjZW50Q29tcGxldGUgKCgkVG90YWxCeXRlc1JlYWQvJExlbmd0aCkqMTAwKSB9IAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsgV3JpdGUtUHJvZ3Jlc3MgIkdFVCAkdXJsIiAiVG90YWwgYnl0ZXMgcmVhZDogJFRvdGFsQnl0ZXNSZWFkIGJ5dGVzIiB9IAogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCRCeXRlc1JlYWQgLWd0IDApCiAgICAgICAgICAgICAgICAgICAgJFN0cmVhbS5DbG9zZSgpIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFJlc3BvbnNlLkNsb3NlKCk7IAogICAgICAgICAgICAgICAgV3JpdGUtUHJvZ3Jlc3MgIkdFVCAkdXJsIiAiQnl0ZXMgcmVhZDogJFRvdGFsQnl0ZXNSZWFkIG9mICRMZW5ndGgiIC1Db21wbGV0ZWQKICAgICAgICAgICAgICAgIExvZyAtbWVzc2FnZSAiRG9uZSIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuU3VjY2VzcyAtTm9JbmRlbnQKICAgICAgICAgICAgfSAKICAgICAgICAgICAgY2F0Y2ggCiAgICAgICAgICAgIHsgCiAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgIkZhaWxlZCIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IgLU5vSW5kZW50CiAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgKCRlcnJvclswXS5Ub1N0cmluZygpLlN1YnN0cmluZyg1NCkpIC10eXBlICRTUFNELkxvZ1R5cGVzLkVycm9yCiAgICAgICAgICAgIH0gCiAgICAgICAgfQogICAgICAgICNlbmRyZWdpb24KCSAgICAjcmVnaW9uIFJ1bkFjdGlvbgoJICAgICMgRGVzYzogUnVucyBhIHBvc3QgZGVwbG95bWVudCBhY3Rpb24gc3BlY2lmaWVkIGluIHRoZSBjb25maWd1cmF0aW9uIG5vZGUKICAgICAgICBGdW5jdGlvbiBSdW5BY3Rpb24oW1N5c3RlbS5YbWwuWE1MRWxlbWVudF0kYWN0aW9uKXsKICAgICAgICAgICAgaWYoISRhY3Rpb24pewogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGFjdGlvblR5cGUgPSAkYWN0aW9uLkxvY2FsTmFtZQogICAgICAgICAgICBzd2l0Y2ggKCRhY3Rpb25UeXBlLlRvTG93ZXIoKSl7CiAgICAgICAgICAgICAgICAicmVzdGFydHNlcnZpY2UiIHsKICAgICAgICAgICAgICAgICAgICAkbmFtZSAgPSAkYWN0aW9uLk5hbWUKICAgICAgICAgICAgICAgICAgICAkZm9yY2UgPSBbU3lzdGVtLkNvbnZlcnRdOjpUb0Jvb2xlYW4oJGFjdGlvbi5Gb3JjZSkgCiAgICAgICAgICAgICAgICAgICBSZXN0YXJ0U2VydmljZSAtc2VydmljZU5hbWUgJG5hbWUgLWZvcmNlICRmb3JjZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgInJlc2V0aWlzIiB7CiAgICAgICAgICAgICAgICAgICAgJGZvcmNlID0gW1N5c3RlbS5Db252ZXJ0XTo6VG9Cb29sZWFuKCRhY3Rpb24uRm9yY2UpIAogICAgICAgICAgICAgICAgICAgIFJlc2V0SUlTIC1mb3JjZSAkZm9yY2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICJyZWN5Y2xlYXBwcG9vbHMiewogICAgICAgICAgICAgICAgICAgICRhbGwgPSBbU3lzdGVtLkNvbnZlcnRdOjpUb0Jvb2xlYW4oJGFjdGlvbi5BbGwpIAogICAgICAgICAgICAgICAgICAgIFJlY3ljbGVBcHBQb29scyAtYWxsICRhbGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICJ3YXJtdXB1cmxzInsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkc2VydmVyIGluICRzZXJ2ZXJzKXsgCiAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtbWVzc2FnZSAiV2FybWluZyB1cCB1cmxzIGZyb20gc2VydmVyICRzZXJ2ZXIiIC10eXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ3VzdG9tRW50ZXItUFNTZXNzaW9uICRzZXJ2ZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoKEdldEJvb2xBdHRyaWJ1dGUgLW5vZGUgJGFjdGlvbiAtYXR0cmlidXRlICJBbGxXZWJBcHBzIikpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdhcm1VcFdlYkFwcHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKChHZXRCb29sQXR0cmlidXRlIC1ub2RlICRhY3Rpb24gLWF0dHJpYnV0ZSAiQWxsU2l0ZXMiKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV2FybVVwQWxsU2l0ZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdhcm1VcFVybHMgLXVybHMgKCRhY3Rpb24uV2FybVVwIHwgRm9yRWFjaC1PYmplY3QgeyRfLlVybH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxseXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEN1c3RvbUV4aXQtUFNTZXNzaW9uICRzZXJ2ZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ091dGRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkZWZhdWx0ewogICAgICAgICAgICAgICAgICAgIExvZyAtbWVzc2FnZSAiVGhlIGFjdGlvbiB0eXBlICckYWN0aW9uVHlwZScgaXMgbm90IHJlY29nbml6ZWQuIFZhbGlkIHR5cGVzIGFyZSBSZXN0YXJ0U2VydmljZSwgUmVzZXRJSVMsIFJlY3ljbGVBcHBQb29scyIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICNlbmRyZWdpb24KCSAgICAjcmVnaW9uIFJ1bkFjdGlvbnMKCSAgICAjIERlc2M6IFJ1bnMgYWxsIHBvc3QgZGVwbG95bWVudCBhY3Rpb25zIGluIHRoZSBjb25maWd1cmF0aW9uIG5vZGUKICAgICAgICBGdW5jdGlvbiBSdW5BY3Rpb25zKFtpbnRdJGFjdGlvbkNtZCwgW3N3aXRjaF0kc2tpcFdhcm11cCwgW3N3aXRjaF0kb25seVdhcm11cCl7CiAgICAgICAgICAgICRlbGFwc2VkVGltZSA9IFtTeXN0ZW0uRGlhZ25vc3RpY3MuU3RvcHdhdGNoXTo6U3RhcnROZXcoKQogICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAkYWN0aW9uc05vZGVzID0gJG51bGwKICAgICAgICAgICAgICAgIHN3aXRjaCAoJGFjdGlvbkNtZCkgewogICAgICAgICAgICAgICAgICAgICRTUFNELkNvbW1hbmRzLkRlcGxveSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgIlJ1bm5pbmcgJ0RlcGxveW1lbnQnIGFjdGlvbnMiIC10eXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9uc05vZGVzICA9IChTZWxlY3QtWG1sIC1YbWwgJFNjcmlwdDpjb25mIC1YUGF0aCAiQWN0aW9uc1tAQWZ0ZXJEZXBsb3k9J3RydWUnXSIpIHwgRm9yRWFjaC1PYmplY3QgeyAkXy5Ob2RlIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRTUFNELkNvbW1hbmRzLlJldHJhY3QgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1tZXNzYWdlICJSdW5uaW5nICdSZXRyYWN0aW9uJyBhY3Rpb25zIiAtdHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnNOb2RlcyAgPSAoU2VsZWN0LVhtbCAtWG1sICRTY3JpcHQ6Y29uZiAtWFBhdGggIkFjdGlvbnNbQEFmdGVyUmV0cmFjdD0ndHJ1ZSddIikgfCBGb3JFYWNoLU9iamVjdCB7ICRfLk5vZGUgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJFNQU0QuQ29tbWFuZHMuVXBkYXRlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgIlJ1bm5pbmcgJ1VwZGF0ZScgYWN0aW9ucyIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnNOb2RlcyAgPSAoU2VsZWN0LVhtbCAtWG1sICRTY3JpcHQ6Y29uZiAtWFBhdGggIkFjdGlvbnNbQEFmdGVyVXBkYXRlPSd0cnVlJ10iKSB8IEZvckVhY2gtT2JqZWN0IHsgJF8uTm9kZSB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigkYWN0aW9uc05vZGVzKXsKICAgICAgICAgICAgICAgICAgICAkcmVzdGFydGluZ1NlcnZpY2VzID0gJGZhbHNlCiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAoU2VsZWN0LVhtbCAtWG1sICRhY3Rpb25zTm9kZXMgLVhQYXRoICIqIikgfCBGb3JFYWNoLU9iamVjdCB7ICRfLk5vZGUgfQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZigkc2tpcFdhcm11cCl7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJGFjdGlvbnMgfCBXaGVyZS1PYmplY3QgeyRfLkxvY2FsTmFtZSAtaW5lICJ3YXJtdXB1cmxzIn0KICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgICAgIGlmKCRvbmx5V2FybXVwKXsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAkYWN0aW9ucyB8IFdoZXJlLU9iamVjdCB7JF8uTG9jYWxOYW1lIC1pZXEgIndhcm11cHVybHMifQogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgfCBGb3JFYWNoLU9iamVjdCB7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoISRfKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgIk5vIGFjdGlvbnMgc3BlY2lmaWVkIGZvciB0aGlzIHR5cGUiIC10eXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvblR5cGUgID0gJF8uTG9jYWxOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGNyZWF0ZSBhIGhlYWRpbmcgZm9yIGFsbCBzZXJ2aWNlcyB0byBiZSByZXN0YXJ0ZWQgaW4gYSByb3cKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRhY3Rpb25UeXBlIC1pZXEgInJlc3RhcnRzZXJ2aWNlIiAtYW5kICEkcmVzdGFydGluZ1NlcnZpY2VzKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtbWVzc2FnZSAiUmVzdGFydGluZyBzZXJ2aWNlcyIgLXR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlc3RhcnRpbmdTZXJ2aWNlcyA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYoJGFjdGlvblR5cGUgLWluZSAicmVzdGFydHNlcnZpY2UiIC1hbmQgJHJlc3RhcnRpbmdTZXJ2aWNlcyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nT3V0ZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXN0YXJ0aW5nU2VydmljZXMgPSAkZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJ1bkFjdGlvbiAtYWN0aW9uICRfIAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgIk5vIGFjdGlvbnMgc3BlY2lmaWVkIGZvciB0aGlzIHR5cGUiIC10eXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZpbmFsbHl7CiAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgKCIoIiskZWxhcHNlZFRpbWUuRWxhcHNlZCsgIikiKSAtdHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwKICAgICAgICAgICAgICAgIExvZ091dGRlbnQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAjZW5kcmVnaW9uCiAgICAjZW5kcmVnaW9uCgkjcmVnaW9uIERlcGxveW1lbnQuVXRpbGl0aWVzCgkgICAgI3JlZ2lvbiBXYWl0Rm9ySm9iVG9GaW5pc2gKCSAgICAjIERlc2M6IFdhaXRzIGZvciBhIGRlcGxveW1lbi9yZXRyYWN0aW9uIGpvYiB0byBiZSBmaW5pc2hlZAogICAgICAgICMgICAgICAgV29ya3MgYm90aCBmb3IgZmFybSBhbmQgc2FuZGJveGVkIHNvbHV0aW9ucwoJCSMgIFJlZjogaHR0cDovL2dhbGxlcnkudGVjaG5ldC5taWNyb3NvZnQuY29tL29mZmljZS9BZGQtSW5zdGFsbC1hbmQtRW5hYmxlLWZlOGM5NDVjCgkJRnVuY3Rpb24gV2FpdEZvckpvYlRvRmluaXNoKFtzdHJpbmddJHNvbHV0aW9uRmlsZU5hbWUsIFtzdHJpbmddJFNpdGUsIFtzd2l0Y2hdJHJldHJhY3QpIHsgCiAgICAgICAgICAgIGlmKCEkc2l0ZSl7CiAgICAgICAgICAgICAgICAjIEZhcm0gU29sdWlvbgogICAgICAgICAgICAgICAgJHRpbWVvdXQgPSAkRGVmYXVsdFRpbWVvdXQgKiA1CiAgICAgICAgICAgICAgICB3aGlsZSghKEdldC1TUEZhcm0pIC1vciAoR2V0LVNQRmFybSkuU3RhdHVzIC1uZSAiT25saW5lIil7CiAgICAgICAgICAgICAgICAgICAgaWYoJHRpbWVvdXQgLWxlIDApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBUaHJvdyAiRmFybSBub3Qgb25saW5lIGFmdGVyICIrICgkRGVmYXVsdFRpbWVvdXQgKiA1IC8gNjAwMDApICsgIiBtaW51dGVzIiAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgNQogICAgICAgICAgICAgICAgICAgICR0aW1lb3V0IC09IDUwMDAKICAgICAgICAgICAgICAgIH0KIAkJICAgICAgICAkdGltZW91dCA9ICREZWZhdWx0VGltZW91dCAqIDIKICAgICAgICAgICAgICAgIGlmKCEkcmV0cmFjdCl7ICMgRGVwbG95bWVudCAvIFVwZGF0ZQogICAgICAgICAgICAgICAgICAgICRzb2x1dGlvbiA9IEdldC1TUFNvbHV0aW9uIC1JZGVudGl0eSAkc29sdXRpb25OYW1lIC1FcnJvckFjdGlvbjpTaWxlbnRseUNvbnRpbnVlCgkJICAgICAgICAgICAgJGpvYk5hbWUgPSAiKnNvbHV0aW9uLWRlcGxveW1lbnQqJHNvbHV0aW9uRmlsZU5hbWUqIiAKCQkgICAgICAgICAgICAkam9iID0gR2V0LVNQVGltZXJKb2IgfCA/eyAkXy5OYW1lIC1saWtlICRqb2JOYW1lIH0gCgkJICAgICAgICAgICAgaWYgKCRqb2IgLWVxICRudWxsKSAKCQkgICAgICAgICAgICB7IAoJCSAgICAgICAgICAgICAgICBUaHJvdyAiVGltZXIgam9iIGZvciAnJHNvbHV0aW9uRmlsZU5hbWUnIG5vdCBmb3VuZCwgbWF5YmUgZmlsZSBuYW1lIGlzIHRvbyBsb25nIGFuZCBkb2VzIG5vdCBmaXQgaW50byB0aGUgam9ibmFtZS4gUGxlYXNlIHJlcG9ydCB0byBodHRwczovL3Nwc2QuY29kZXBsZXguY29tL3dvcmtpdGVtLzE2NDUxICIKCQkgICAgICAgICAgICB9IAoJCSAgICAgICAgICAgICRqb2JGdWxsTmFtZSA9ICRqb2IuTmFtZSAKCQkgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIldhaXRpbmcgdG8gZmluaXNoIGpvYiAnJGpvYkZ1bGxOYW1lJy4uLiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1Ob05ld2xpbmUKCQkgICAgICAgICAgICBkbwogICAgICAgICAgICAgICAgICAgIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCR0aW1lb3V0IC1sZSAwKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAJICAgICAgICBMb2cgLU1lc3NhZ2UgIkZhaWxlZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaHJvdyAiSm9iICckam9iRnVsbE5hbWUnIG5vdCBmaW5pc2hlZCBhZnRlciAiKyAoJERlZmF1bHRUaW1lb3V0ICogMiAvIDEwMDApICsgIiBzZWNvbmRzIiAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAtU2Vjb25kcyAyCgkJICAgICAgICAgICAgICAgIExvZyAgLiAtTm9OZXdMaW5lIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQgLT0gMjAwMAoJCSAgICAgICAgICAgIH0gd2hpbGUgKChHZXQtU1BUaW1lckpvYiAkam9iRnVsbE5hbWUpIC1uZSAkbnVsbCkgCgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZXsgIyBSZXRyYWN0aW9uCiAgICAgICAgICAgIAkgICAgTG9nIC1NZXNzYWdlICJXYWl0aW5nIHRvIGZpbmlzaCByZXRyYWN0aW9uLi4uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vTmV3bGluZQoJCSAgICAgICAgICAgICRzb2x1dGlvbiA9IEdldC1TUFNvbHV0aW9uIC1JZGVudGl0eSAkc29sdXRpb25OYW1lIC1FcnJvckFjdGlvbjpTaWxlbnRseUNvbnRpbnVlCgkJICAgICAgICAgICAgZG97IAogICAgICAgICAgICAgICAgICAgICAgICBpZigkdGltZW91dCAtbGUgMCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgCSAgICAgICAgTG9nIC1NZXNzYWdlICJGYWlsZWQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkVycm9yIC1Ob0luZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhyb3cgIlNvbHV0aW9uIHN0aWxsIG5vdCByZXRyYWN0ZWQgYWZ0ZXIgIisgKCREZWZhdWx0VGltZW91dCAqIDIgLyAxMDAwKSArICIgc2Vjb25kcyIgCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgMgoJCSAgICAgICAgICAgICAgICBMb2cgIC4gLU5vTmV3TGluZSAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0IC09IDIwMDAKCQkgICAgICAgICAgICB9IHdoaWxlICgkc29sdXRpb24uRGVwbG95ZWQgLW9yICRzb2x1dGlvbi5Kb2JFeGlzdHMpIAoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgIyBTYW5kYm94ZWQgU29sdXRpb24KIAkJICAgICAgICAkdGltZW91dCA9ICREZWZhdWx0VGltZW91dCAqIDIKICAgICAgICAgICAgICAgICRzb2x1dGlvbiA9IEdldC1TUFVzZXJTb2x1dGlvbiAtSWRlbnRpdHkgJHNvbHV0aW9uRmlsZU5hbWUgLVNpdGUgJHVybAogICAgICAgICAgICAgICAgaWYoISRyZXRyYWN0KXsgIyBEZXBsb3ltZW50IC8gVXBkYXRlCiAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJXYWl0aW5nIHRvIGZpbmlzaCBkZXBsb3ltZW50Li4uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vTmV3bGluZQoJCSAgICAgICAgICAgIGRvCiAgICAgICAgICAgICAgICAgICAgeyAKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCR0aW1lb3V0IC1sZSAwKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAJICAgICAgICBMb2cgLU1lc3NhZ2UgIkZhaWxlZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaHJvdyAiU2FuZGJveGVkIHNvbHV0aW9uIG5vdCBhY3RpdmF0ZWQgYWZ0ZXIgIisgKCREZWZhdWx0VGltZW91dCAqIDIgLyAxMDAwKSArICIgc2Vjb25kcyIgCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgMgoJCSAgICAgICAgICAgICAgICBMb2cgIC4gLU5vTmV3TGluZSAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0IC09IDIwMDAKCQkgICAgICAgICAgICB9IHdoaWxlICgkc29sdXRpb24uU3RhdHVzIC1uZSBbTWljcm9zb2Z0LlNoYXJlUG9pbnQuU1BVc2VyU29sdXRpb25TdGF0dXNdOjpBY3RpdmF0ZWQpIAoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2V7ICMgUmV0cmFjdGlvbgogICAgICAgICAgICAJICAgIExvZyAtTWVzc2FnZSAiV2FpdGluZyB0byBmaW5pc2ggcmV0cmFjdGlvbi4uLiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1Ob05ld2xpbmUKCQkgICAgICAgICAgICBkb3sgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCR0aW1lb3V0IC1sZSAwKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAJICAgICAgICBMb2cgLU1lc3NhZ2UgIkZhaWxlZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaHJvdyAiU2FuZGJveGVkIHNvbHV0aW9uIHN0aWxsIG5vdCByZXRyYWN0ZWQgYWZ0ZXIgIisgKCREZWZhdWx0VGltZW91dCAqIDIgLyAxMDAwKSArICIgc2Vjb25kcyIgCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgMgoJCSAgICAgICAgICAgICAgICBMb2cgIC4gLU5vTmV3TGluZSAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0IC09IDIwMDAKCQkgICAgICAgICAgICB9IHdoaWxlICgkc29sdXRpb24uU3RhdHVzIC1uZSBbTWljcm9zb2Z0LlNoYXJlUG9pbnQuU1BVc2VyU29sdXRpb25TdGF0dXNdOjpEZWFjdGl2YXRlZCkgCgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgkJICAgIExvZyAtTWVzc2FnZSAiRmluaXNoZWQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLlN1Y2Nlc3MgLU5vSW5kZW50CgkJfSAKICAgICAgICAjZW5kcmVnaW9uCgkgICAgI3JlZ2lvbiBGYXJtU29sdXRpb25EZXBsb3llZFN1Y2Nlc3NmdWwKCSAgICAjIERlc2M6IENoZWNrcyBpZiBhIGZhcm0gc29sdXRpb24gaGFzIGJlZW4gZGVwbG95ZWQgc3VjY2Vzc2Z1bGx5CiAgICAgICAgRnVuY3Rpb24gRmFybVNvbHV0aW9uRGVwbG95ZWRTdWNjZXNzZnVsKFtzdHJpbmddJHNvbHV0aW9uTmFtZSApewogICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJDaGVja2luZyBkZXBsb3ltZW50Li4uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vTmV3bGluZQoKICAgICAgICAgICAgJHNvbHV0aW9uID0gR2V0LVNQU29sdXRpb24gLUlkZW50aXR5ICRzb2x1dGlvbk5hbWUgLUVycm9yQWN0aW9uOlNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgaWYoJHNvbHV0aW9uKXsKICAgICAgICAgICAgICAgIGlmKCRzb2x1dGlvbi5MYXN0T3BlcmF0aW9uUmVzdWx0IC1lcSBbTWljcm9zb2Z0LlNoYXJlUG9pbnQuQWRtaW5pc3RyYXRpb24uU1BTb2x1dGlvbk9wZXJhdGlvblJlc3VsdF06OkRlcGxveW1lbnRTdWNjZWVkZWQpewogICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiT2siIC1UeXBlICRTUFNELkxvZ1R5cGVzLlN1Y2Nlc3MgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZigkc29sdXRpb24uRGVwbG95ZWQpewogICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiT2siIC1UeXBlICRTUFNELkxvZ1R5cGVzLlN1Y2Nlc3MgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIk5vdCBkZXBsb3llZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IgLU5vSW5kZW50CiAgICAgICAgICAgICAgICByZXR1cm4gJGZhbHNlCgogICAgICAgICAgICB9CiAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiU29sdXRpb24gbm90IGZvdW5kIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKCiAgICAgICAgICAgIHJldHVybiAkZmFsc2UKCSAgICB9CiAgICAgICAgI2VuZHJlZ2lvbgoJICAgICNyZWdpb24gRmFybVNvbHV0aW9uUmV0cmFjdGVkU3VjY2Vzc2Z1bAoJICAgICMgRGVzYzogQ2hlY2tzIGlmIGEgZmFybSBzb2x1dGlvbiBoYXMgYmVlbiByZXRyYWN0ZWQgc3VjY2Vzc2Z1bGx5CiAgICAgICAgRnVuY3Rpb24gRmFybVNvbHV0aW9uUmV0cmFjdGVkU3VjY2Vzc2Z1bChbc3RyaW5nXSRzb2x1dGlvbk5hbWUgKXsKICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiQ2hlY2tpbmcgcmV0cmFjdGlvbi4uLiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1Ob05ld2xpbmUKCiAgICAgICAgICAgICRzb2x1dGlvbiA9IEdldC1TUFNvbHV0aW9uIC1JZGVudGl0eSAkc29sdXRpb25OYW1lIC1FcnJvckFjdGlvbjpTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgIGlmKCRzb2x1dGlvbil7CiAgICAgICAgICAgICAgICBpZigkc29sdXRpb24uRGVwbG95ZWQpewogICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiRmFpbGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlNvbHV0aW9uIHN0aWxsIGRlcGxveWVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvcgogICAgICAgICAgICAgICAgICAgIHJldHVybiAkZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiRmFpbGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiU29sdXRpb24gbm90IGRlcGxveWVkLCBidXQgc3RpbGwgaW5zdGFsbGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvcgogICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZQoKICAgICAgICAgICAgfQogICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIk9rIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5TdWNjZXNzIC1Ob0luZGVudAogICAgICAgICAgICByZXR1cm4gJHRydWUKCSAgICB9CiAgICAgICAgI2VuZHJlZ2lvbgoJICAgICNyZWdpb24gU2FuZGJveGVkU29sdXRpb25EZXBsb3llZFN1Y2Nlc3NmdWwKCSAgICAjIERlc2M6IENoZWNrcyBpZiBhIHNhbmRib3hlZCBzb2x1dGlvbiBoYXMgYmVlbiBkZXBsb3llZCBzdWNjZXNzZnVsbHkKICAgICAgICBGdW5jdGlvbiBTYW5kYm94ZWRTb2x1dGlvbkRlcGxveWVkU3VjY2Vzc2Z1bChbc3RyaW5nXSRzb2x1dGlvbk5hbWUsIFtzdHJpbmddJFNpdGUgKXsKICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiQ2hlY2tpbmcgZGVwbG95bWVudC4uLiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1Ob05ld2xpbmUKCiAgICAgICAgICAgICRzb2x1dGlvbiA9IEdldC1TUFVzZXJTb2x1dGlvbiAtSWRlbnRpdHkgJHNvbHV0aW9uTmFtZSAtU2l0ZSAkU2l0ZSAtRXJyb3JBY3Rpb246U2lsZW50bHlDb250aW51ZQogICAgICAgICAgICBpZigkc29sdXRpb24pewogICAgICAgICAgICAgICAgaWYoJHNvbHV0aW9uLlN0YXR1cyAtZXEgW01pY3Jvc29mdC5TaGFyZVBvaW50LlNQVXNlclNvbHV0aW9uU3RhdHVzXTo6QWN0aXZhdGVkKXsKICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIk9rIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5TdWNjZXNzIC1Ob0luZGVudAogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICgkc29sdXRpb24uU3RhdHVzKSAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKICAgICAgICAgICAgICAgIHJldHVybiAkZmFsc2UKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJTb2x1dGlvbiBub3QgZm91bmQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkVycm9yIC1Ob0luZGVudAoKICAgICAgICAgICAgcmV0dXJuICRmYWxzZQoJICAgIH0KICAgICAgICAjZW5kcmVnaW9uCgkgICAgI3JlZ2lvbiBTYW5kYm94ZWRTb2x1dGlvblJldHJhY3RlZFN1Y2Nlc3NmdWwKCSAgICAjIERlc2M6IENoZWNrcyBpZiBhIHNhbmRib3hlZCBzb2x1dGlvbiBoYXMgYmVlbiByZXRyYWN0ZWQgc3VjY2Vzc2Z1bGx5CiAgICAgICAgRnVuY3Rpb24gU2FuZGJveGVkU29sdXRpb25SZXRyYWN0ZWRTdWNjZXNzZnVsKFtzdHJpbmddJHNvbHV0aW9uTmFtZSwgW3N0cmluZ10kU2l0ZSl7CiAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIkNoZWNraW5nIHJldHJhY3Rpb24uLi4iIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9OZXdsaW5lCgogICAgICAgICAgICAkc29sdXRpb24gPSBHZXQtU1BVc2VyU29sdXRpb24gLUlkZW50aXR5ICRzb2x1dGlvbk5hbWUgLVNpdGUgJFNpdGUgLUVycm9yQWN0aW9uOlNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgaWYoJHNvbHV0aW9uKXsKICAgICAgICAgICAgICAgIGlmKCRzb2x1dGlvbi5TdGF0dXMgLWVxIFtNaWNyb3NvZnQuU2hhcmVQb2ludC5TUFVzZXJTb2x1dGlvblN0YXR1c106OkFjdGl2YXRlZCl7CiAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJGYWlsZWQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkVycm9yIC1Ob0luZGVudAogICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiU2FuZGJveGVkIHNvbHV0aW9uIHN0aWxsIGFjdGl2YXRlZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIkZhaWxlZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IgLU5vSW5kZW50CiAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlNhbmRib3hlZCBzb2x1dGlvbiBub3QgZGVwbG95ZWQsIGJ1dCBzdGlsbCBpbnN0YWxsZWQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkVycm9yCiAgICAgICAgICAgICAgICByZXR1cm4gJGZhbHNlCgogICAgICAgICAgICB9CiAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiT2siIC1UeXBlICRTUFNELkxvZ1R5cGVzLlN1Y2Nlc3MgLU5vSW5kZW50CiAgICAgICAgICAgIHJldHVybiAkdHJ1ZQoJICAgIH0KICAgICAgICAjZW5kcmVnaW9uCgkjZW5kcmVnaW9uCiAgICAjcmVnaW9uIERlcGxveW1lbnQuUHJlQ29uZGl0aW9ucwoJICAgICNyZWdpb24gUHJlQ29uZGl0aW9ucwoJICAgICMgRGVzYzogQ2hlY2tzIHByZWNvbmRpdGlvbnMgYmVmb3JlIHRoZSBkZXBsb3ltZW50CiAgICAgICAgIyAgICAgICB0aGlzIHRhcmdldCBzaG91bGQgYmUgY2FsbGVkIGJlZm9yZSBldmVyeSBkZXBsb3ltZW50CgkgICAgIyAgICAgICBkZXBsb3ltZW50IHdpbGwgbm90IGNvbnRpbnVlIGlmIGEgcHJlY29uZGl0aW9uIGZhaWxzCgkgICAgRnVuY3Rpb24gUHJlQ29uZGl0aW9ucygpewoJICAgICAgICBMb2cgLU1lc3NhZ2UgIkNoZWNraW5nIFN5c3RlbSBQcmVjb25kaXRpb25zIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50CiAgICAgICAgICAgIENoZWNrUFNSZW1vdGluZ0VuYWJsZWQKCSAgICAgICAgQ2hlY2tVc2VySXNBZG1pbmlzdHJhdG9yCgkgICAgICAgIENoZWNrU1BNaW5pbWFsVmVyc2lvbgoJICAgICAgICBDaGVja1NQTWluaW1hbExpY2Vuc2UKICAgICAgICAgICAgQ2hlY2tTUExhbmd1YWdlUGFja3MKICAgICAgICAgICAgQ2hlY2tTZXJ2aWNlc1J1bm5pbmcKICAgICAgICAgICAgQ2hlY2tMb29wYmFja0NoZWNrRGlzYWJsZWQKCSAgICAgICAgQ2hlY2tQcmVyZXF1aXNpdGVTb2x1dGlvbnMKCSAgICAgICAgTG9nIC1NZXNzYWdlICJTdGFydCBDaGVja2luZyBDdXN0b20gUHJlY29uZGl0aW9ucyIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1JbmRlbnQKICAgICAgICAgICAgQ2hlY2tDdXN0b21QcmVjb25kaXRpb25zICR2YXJzCiAgICAgICAgICAgIEV4ZWN1dGUtRXh0ZW5zaW9ucyAkZXZlbnRzLlByZWNvbmRpdGlvbnMKICAgCSAgICAgICAgTG9nIC1NZXNzYWdlICJDdXN0b20gUHJlY29uZGl0aW9ucyBmaW5pc2hlZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1PdXRkZW50CgkgICAgICAgIExvZyAtTWVzc2FnZSAiQ2hlY2tpbmcgU3lzdGVtIFByZWNvbmRpdGlvbnMgZmluaXNoZWQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1PdXRkZW50CgkgICAgfQogICAgICAgICNlbmRyZWdpb24KCSAgICAjcmVnaW9uIENoZWNrU2VydmljZXNSdW5uaW5nCgkgICAgIyBEZXNjOiBDaGVja3MgaWYgYWxsIHJlcXVpcmVkIHNlcnZpY2VzIGZvciBkZXBsb3ltZW50IGFyZSBydW5uaW5nCiAgICAgICAgRnVuY3Rpb24gQ2hlY2tTZXJ2aWNlc1J1bm5pbmcoKXsKIAkJICAgIExvZyAtTWVzc2FnZSAiQ2hlY2tpbmcgc2VydmljZXMgZm9yIGRlcGxveW1lbnQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQKICAgICAgICAgICAgIyBvbmx5IHRlc3RpbmcgY3VycmVudCBzZXJ2ZXIgYXMgd2UgbmVlZCB0aGVzZSBvbmx5IGZvciB0aGUgZGVsb3ltZW50CiAgICAgCSAgICBFbnN1cmVTZXJ2aWNlUnVubmluZyAtc2VydmljZU5hbWUgIlNQQWRtaW5WNCIgLWNvbXB1dGVyICRlbnY6Q09NUFVURVJOQU1FCgkgICAgICAgIEVuc3VyZVNlcnZpY2VSdW5uaW5nIC1zZXJ2aWNlTmFtZSAiU1BUaW1lclY0IiAtY29tcHV0ZXIgJGVudjpDT01QVVRFUk5BTUUKICAgICAgICAgICAgTG9nT3V0ZGVudAoJCX0KICAgICAgICAjZW5kcmVnaW9uCgkgICAgI3JlZ2lvbiBDaGVja0xvb3BiYWNrQ2hlY2tEaXNhYmxlZAoJICAgICMgRGVzYzogQ2hlY2tzIGlmIHRoZSBsb29wYmFjayBjaGVjayBpcyBkaXNhYmxlZCBvbiBhbGwgc2VydmVycyBvbiB0aGUgZmFybQogICAgICAgICMgICAgICAgUmVxdWlyZWQgZm9yIHRoZSB3YXJtdXAgZnVuY3Rpb25zCiAgICAgICAgIyAgICAgICBUbyBkaXNhYmxlIGxvb3BiYWNrIGNoZWNrIG9uIGEgc2VydmVyIHJ1bjoKICAgICAgICAjICAgICAgIE5ldy1JdGVtUHJvcGVydHkgSEtMTTpcU3lzdGVtXEN1cnJlbnRDb250cm9sU2V0XENvbnRyb2xcTHNhIC1OYW1lICJEaXNhYmxlTG9vcGJhY2tDaGVjayIgLVZhbHVlICIxIiAtUHJvcGVydHlUeXBlIGR3b3JkCiAgICAgICAgIyAgICAgICBhbmQgcmVib290LgogICAgICAgIEZ1bmN0aW9uIENoZWNrTG9vcGJhY2tDaGVja0Rpc2FibGVkKCl7CiAgICAgICAgICAgIGZvcmVhY2ggKCRzZXJ2ZXIgaW4gJHNlcnZlcnMpCiAgICAgICAgICAgIHsKCQkgICAgICAgIExvZyAtTWVzc2FnZSAiQ2hlY2tpbmcgaWYgTG9vcGJhY2tDaGVjayBpcyBkaXNhYmxlZCBvbiBzZXJ2ZXIgJyRzZXJ2ZXInLi4uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vTmV3bGluZQogICAgICAgICAgICAgICAgIyBydW5uaW5nIG9uIHJlbW90ZSBzZXJ2ZXIKICAgICAgICAgICAgICAgIEN1c3RvbUVudGVyLVBTU2Vzc2lvbiAkc2VydmVyCiAgICAgICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAgICAgJGxvb3BiYWNrQ2hlY2tEaXNhYmxlZCA9IChHZXQtSXRlbVByb3BlcnR5IEhLTE06XFN5c3RlbVxDdXJyZW50Q29udHJvbFNldFxDb250cm9sXExzYSkuRGlzYWJsZUxvb3BiYWNrQ2hlY2sKCQkgICAgICAgICAgICBpZigkbG9vcGJhY2tDaGVja0Rpc2FibGVkKXsKCQkgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJEaXNhYmxlZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuU3VjY2VzcyAtTm9JbmRlbnQKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgZWxzZQoJCSAgICAgICAgICAgIHsKCQkgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJFbmFibGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5XYXJuaW5nICAtTm9JbmRlbnQKCQkgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJMb29wYmFja0NoZWNrIGhhcyB0byBiZSBkaXNhYmxlZCBpbiBvcmRlciB0byBydW4gdGhlIHdhcm11cCBhY3Rpb24uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5XYXJuaW5nICAKCQkgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJUbyBkaXNhYmxlIExvb3BiYWNrQ2hlY2sgcnVuOiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZyAgCgkJICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiICBOZXctSXRlbVByb3BlcnR5IEhLTE06XFN5c3RlbVxDdXJyZW50Q29udHJvbFNldFxDb250cm9sXExzYSAtTmFtZSBgIkRpc2FibGVMb29wYmFja0NoZWNrYCIgLVZhbHVlIGAiMWAiIC1Qcm9wZXJ0eVR5cGUgZHdvcmQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLldhcm5pbmcgIAoJCSAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIiAgQW5kIHJlYm9vdCB0aGUgc2VydmVyIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5XYXJuaW5nICAKCQkgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJUaGlzIGlzIG5vdCByZWNvbW1lbmRlZCBpbiBQcm9kdWN0aW9uIGVudmlyb25tZW50ISIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZyAgCgkJICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2h7CgkJICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiRXJyb3IiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkVycm9yICAtTm9JbmRlbnQKCQkgICAgICAgICAgICAgICAgVGhyb3cgJF8udG9TdHJpbmcoKSAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZpbmFsbHl7CiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tRXhpdC1QU1Nlc3Npb24gJHNlcnZlcgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgkJfQogICAgICAgICNlbmRyZWdpb24KCSAgICAjcmVnaW9uIENoZWNrUFNSZW1vdGluZ0VuYWJsZWQKCSAgICAjIERlc2M6IENoZWNrcyBpZiBwb3dlcnNoZWxsIHJlbW90aW5nIGlzIGVuYWJsZWQgb24gYWxsIHNlcnZlcnMKICAgICAgICAjICAgICAgIFRoaXMgaXMgcmVxdWlyZWQgZm9yIHNvbWUgcG9zdC1kZXBsb3ltZW50IGFjdGlvbnMgaWYgeW91IHdhbnQgdG8gcnVuIHRoZW0gb24gYWxsIHNlcnZlcnMgaW4gdGhlIGZhcm0KICAgICAgICAjICAgICAgIFJ1bgogICAgICAgICMgICAgICAgRW5hYmxlLVBTUmVtb3RpbmcgLUNvbmZpcm06JGZhbHNlIAogICAgICAgICMgICAgICAgb24gZWFjaCBzZXJ2ZXIgb3IgcmVzdHJpY3QgZGVwbG95bWVudCB0byB0aGUgY3VycmVudCBtYWNoaW5lIGJ5IHNldHRpbmcgCiAgICAgICAgIyAgICAgICA8SW5jbHVkZUFsbFNlcnZlcnNJbkZhcm0+IHRvYCJmYWxzZWAiIGluIHRoZSA8U2V0dGluZ3M+IG5vZGUKICAgICAgICBGdW5jdGlvbiBDaGVja1BTUmVtb3RpbmdFbmFibGVkKCl7CiAgICAgICAgICAgIGZvcmVhY2ggKCRzZXJ2ZXIgaW4gJHNlcnZlcnMpCiAgICAgICAgICAgIHsKCQkgICAgICAgIExvZyAtTWVzc2FnZSAiQ2hlY2tpbmcgaWYgUG93ZXJTaGVsbCBSZW1vdGluZyBpcyBlbmFibGVkIG9uIHNlcnZlciAnJHNlcnZlciciIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQKICAgICAgICAgICAgICAgICMgcnVubmluZyBvbiByZW1vdGUgc2VydmVyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRyeXsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRzZXJ2ZXIgLW5lICRlbnY6Q09NUFVURVJOQU1FKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVuc3VyZVNlcnZpY2VSdW5uaW5nIC1zZXJ2aWNlTmFtZSAid2lucm0iIC1jb21wdXRlciAkc2VydmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlJlbW90aW5nIGludG8gJyRzZXJ2ZXInLi4uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vTmV3bGluZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRW50ZXItUFNTZXNzaW9uIC1Db21wdXRlck5hbWUgJHNlcnZlciAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSAtRXJyb3JWYXJpYWJsZSBQU0Vycm9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighJFBTRXJyb3IpewoJCSAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiT2siIC1UeXBlICRTUFNELkxvZ1R5cGVzLlN1Y2Nlc3MgIC1Ob0luZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7IFRocm93ICRQU0Vycm9yIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlewoJCSAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJQb3dlclNoZWxsIFJlbW90aW5nIG5vdCByZXF1aXJlZCBvbiBsb2NhbCBtYWNoaW5lLi4uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vTmV3bGluZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJTa2lwcGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5XYXJuaW5nIC1Ob0luZGVudAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaHsKCQkgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJGYWlsZWQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkVycm9yICAtTm9JbmRlbnQKCQkgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJQb3dlclNoZWxsIFJlbW90aW5nIGlzIGRpc2FibGVkIG9uIHRoZSByZW1vdGUgc2VydmVyIG9yIGFjY2VzcyBpcyBkZW5pZWQgdG8gY3VycmVudCB1c2VyISIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IKCQkgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJSdW4gJ0VuYWJsZS1QU1JlbW90aW5nIC1Db25maXJtOmAkZmFsc2UnIG9uIGVhY2ggc2VydmVyIG9yIHJlc3RyaWN0IGRlcGxveW1lbnQgdG8gdGhlIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvcgoJCSAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgImN1cnJlbnQgbWFjaGluZSBieSBzZXR0aW5nIDxSdW5Pbk11bHRpcGxlU2VydmVyc0luRmFybT4gdG9gIk9ubHlMb2NhbGAiIGluIHRoZSA8U2V0dGluZ3M+IG5vZGUiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkVycm9yCgkJICAgICAgICAgICAgICAgIFRocm93ICRfLnRvU3RyaW5nKCkgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmaW5hbGx5ewogICAgICAgICAgICAgICAgICAgIGlmKCRzZXJ2ZXIgLW5lICRlbnY6Q09NUFVURVJOQU1FKXsKICAgICAgICAgICAgICAgICAgICAgICAgRXhpdC1QU1Nlc3Npb24KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgTG9nT3V0ZGVudAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICNlbmRyZWdpb24KCSAgICAjcmVnaW9uIENoZWNrVXNlcklzQWRtaW5pc3RyYXRvcgoJICAgICMgRGVzYzogQ2hlY2tzIGlmIHVzZXIgaXMgZmFybSBhZG1pbiBhbmQgbG9jYWwgYWRtaW4gb24gYWxsIHNlcnZlcnMgaW4gdGhlIGZhcm0KCQlGdW5jdGlvbiBDaGVja1VzZXJJc0FkbWluaXN0cmF0b3IoKXsKCQkgICAgTG9nIC1NZXNzYWdlICJDaGVja2luZyBwZXJtaXNzaW9ucyIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudAoJCSAgICBMb2cgLU1lc3NhZ2UgIkNoZWNraW5nIGlmIHVzZXIgJyRlbnY6VVNFUkRPTUFJTlwkZW52OlVTRVJOQU1FJyBpcyBmYXJtIGFkbWluaXN0cmF0b3IuLi4iIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9OZXdsaW5lCgkJICAgICRmYXJtID0gR2V0LVNQRmFybQoJCSAgICBpZigkZmFybS5DdXJyZW50VXNlcklzQWRtaW5pc3RyYXRvcigpKXsKCQkgICAgICAgIExvZyAtTWVzc2FnZSAiT2siIC1UeXBlICRTUFNELkxvZ1R5cGVzLlN1Y2Nlc3MgLU5vSW5kZW50CgkJICAgIH0KCQkgICAgZWxzZQoJCSAgICB7CgkJICAgICAgICBMb2cgLU1lc3NhZ2UgIkZhaWxlZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IgIC1Ob0luZGVudAoJCSAgICAgICAgVGhyb3cgIlVzZXIgJyRlbnY6VVNFUkRPTUFJTlwkZW52OlVTRVJOQU1FJyBoYXMgdG8gYmUgZmFybSBhZG1pbmlzdHJhdG9yIHRvIGNvbnRpbnVlIGRlcGxveW1lbnQhIgoJCSAgICB9CiAgICAgICAgICAgIGZvcmVhY2ggKCRzZXJ2ZXIgaW4gJHNlcnZlcnMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIAoJCSAgICAgICAgTG9nIC1NZXNzYWdlICJDaGVja2luZyBpZiB1c2VyICckZW52OlVTRVJET01BSU5cJGVudjpVU0VSTkFNRScgaXMgbG9jYWwgYWRtaW5pc3RyYXRvciBvbiAnJHNlcnZlcicuLi4iIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9OZXdsaW5lCiAgICAgICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAgICAgIyBydW5uaW5nIG9uIHJlbW90ZSBzZXJ2ZXIKICAgICAgICAgICAgICAgICAgICBDdXN0b21FbnRlci1QU1Nlc3Npb24gJHNlcnZlcgogICAgICAgICAgICAgICAgICAgICRpc0xvY2FsQWRtaW4gPSAoW1NlY3VyaXR5LlByaW5jaXBhbC5XaW5kb3dzUHJpbmNpcGFsXSBbU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NJZGVudGl0eV06OkdldEN1cnJlbnQoKSkuSXNJblJvbGUoW1NlY3VyaXR5LlByaW5jaXBhbC5XaW5kb3dzQnVpbHRJblJvbGVdICJBZG1pbmlzdHJhdG9yIikKCQkgICAgICAgICAgICBpZigkaXNMb2NhbEFkbWluKXsKCQkgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJPayIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuU3VjY2VzcyAtTm9JbmRlbnQKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgZWxzZQoJCSAgICAgICAgICAgIHsKCQkgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJGYWlsZWQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkVycm9yICAtTm9JbmRlbnQKCQkgICAgICAgICAgICAgICAgVGhyb3cgIlVzZXIgJyRlbnY6VVNFUkRPTUFJTlwkZW52OlVTRVJOQU1FJyBoYXMgdG8gYmUgbG9jYWwgYWRtaW5pc3RyYXRvciBvbiAnJHNlcnZlcichIgoJCSAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoewoJCSAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIkVycm9yIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAgLU5vSW5kZW50CgkJICAgICAgICAgICAgICAgIFRocm93ICRfLnRvU3RyaW5nKCkgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmaW5hbGx5ewogICAgICAgICAgICAgICAgICAgIEN1c3RvbUV4aXQtUFNTZXNzaW9uICRzZXJ2ZXIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBMb2dPdXRkZW50CgkJfQogICAgICAgICNlbmRyZWdpb24KCSAgICAjcmVnaW9uIENoZWNrU1BNaW5pbWFsVmVyc2lvbgoJICAgICMgRGVzYzogQ2hlY2tzIGlmIHRoZSBjb25maWd1cmVkIG1pbmltYWwgU2hhcmVQb2ludCB2ZXJzaW9uIGlzIGluc3RhbGxlZCBvbiB0aGUgc2VydmVyCgkJRnVuY3Rpb24gQ2hlY2tTUE1pbmltYWxWZXJzaW9uKCl7CgkJICAgIExvZyAtTWVzc2FnZSAiQ2hlY2tpbmcgbWluaW1hbCByZXF1aXJlZCBTaGFyZVBvaW50IHZlcnNpb24uLi4iIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQgLU5vTmV3bGluZQoJCSAgICB0cnkKCQkgICAgewoJCSAgICAgICAgJG1pbmltYWxWZXJzaW9uID0gW1N5c3RlbS5WZXJzaW9uXSRjb25mLlJlc3RyaWN0aW9ucy5NaW5pbWFsU2hhcmVQb2ludFZlcnNpb24KCQkgICAgICAgIGlmKCRtaW5pbWFsVmVyc2lvbil7CiAgICAgICAgICAgICAgICAgICAgIyBsb2FkIGV4dGVybmFsIFNoYXJlUG9pbnQgdmVyc2lvbnMgbG9va3VwIGRhdGEKICAgICAgICAgICAgICAgICAgICBbeG1sXSRTUFNEU2hhcmVQb2ludCA9IExvYWRYTUxGaWxlKCRzY3JpcHREaXIrIlxTaGFyZVBvaW50VmVyc2lvbnMueG1sIikKCQkgICAgICAgICAgICAkaW5zdGFsbGVkVmVyc2lvbiA9IChHZXQtU1BGYXJtKS5CdWlsZFZlcnNpb24KICAgICAgICAgICAgICAgICAgICAjIHNldCBzY3JpcHQgdmFyaWFibGUgZm9yIGRlcGxveW1lbnQgYWN0aW9ucwoJCQkJCSRTUFNELkluc3RhbGxlZFZlcnNpb24gPSAkaW5zdGFsbGVkVmVyc2lvbi5NYWpvcgoKCQkgICAgICAgICAgICAkU1BWZXJzaW9uTmFtZSA9ICgkU1BTRFNoYXJlUG9pbnQuU1BTRC5TaGFyZVBvaW50LlZlcnNpb25zLlZlcnNpb24gfCBXaGVyZS1PYmplY3QgeyRfLk51bWJlciAtZXEgJGluc3RhbGxlZFZlcnNpb259KS5OYW1lIAoJCQkJCWlmKCRTUFZlcnNpb25OYW1lIC1lcSAkbnVsbCAtb3IgJFNQVmVyc2lvbk5hbWUgLWVxICIiKQoJCQkJCXsKCQkJCQkJJFNQVmVyc2lvbk5hbWUgPSJ1bmtub3duLCBwbGVhc2UgdXBkYXRlIFNoYXJlUG9pbnRWZXJzaW9ucy54bWwgZnJvbSBodHRwOi8vd3d3Lm1hdHRoaWFzZWluaWcuZGUvZmlsZXMvU2hhcmVQb2ludFZlcnNpb25zLnhtbCIKCQkJCQl9CgoJCSAgICAgICAgICAgIGlmKCRpbnN0YWxsZWRWZXJzaW9uIC1nZSAkbWluaW1hbFZlcnNpb24pCgkJICAgICAgICAgICAgewoJCSAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIk9rIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5TdWNjZXNzIC1Ob0luZGVudAoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBlbHNlewoJCSAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIkZhaWxlZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IgLU5vSW5kZW50CgkJICAgICAgICAgICAgICAgIFRocm93ICJUaGUgaW5zdGFsbGVkIFNoYXJlUG9pbnQgdmVyc2lvbiAnJGluc3RhbGxlZFZlcnNpb24nIGRvZXMgbm90IG1lZXQgdGhlIHZlcnNpb24gcmVxdWlyZW1lbnQgJyRtaW5pbWFsVmVyc2lvbiciCgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIAoJCSAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiTWluaW1hbCB2ZXJzaW9uICAgOiAkbWluaW1hbFZlcnNpb24iIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbAoJCSAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiSW5zdGFsbGVkIHZlcnNpb24gOiAkaW5zdGFsbGVkVmVyc2lvbiAoJFNQVmVyc2lvbk5hbWUpIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwKCQkgICAgICAgIH0KCQkgICAgICAgIEVsc2V7CgkJICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJTa2lwcGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5XYXJuaW5nICAtTm9JbmRlbnQKCQkgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlZhbHVlIG5vdCBzcGVjaWZpZWQgaW4gY29uZmlndXJhdGlvbiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZwoJCSAgICAgICAgfQoJCSAgIH0KCQkgICAgZmluYWxseXsKCQkgICAgICAgIExvZ091dGRlbnQKCQkgICAgfQoJCX0KICAgICAgICAjZW5kcmVnaW9uCgkgICAgI3JlZ2lvbiBDaGVja1NQTGFuZ3VhZ2VQYWNrCgkgICAgIyBEZXNjOiBDaGVja3MgaWYgdGhlIGNvbmZpZ3VyZWQgU2hhcmVQb2ludCBsYW5ndWFnZSBwYWNrcyBhcmUgaW5zdGFsbGVkIG9uIHRoZSBzZXJ2ZXIKCQlGdW5jdGlvbiBDaGVja1NQTGFuZ3VhZ2VQYWNrcygpewogICAgICAgICAgICB0cnkKCQkgICAgewoJCSAgICAgICAgJHJlcXVpcmVkTGFuZ3VhZ2VzID0gJGNvbmYuUmVzdHJpY3Rpb25zLlJlcXVpcmVkU2hhcmVQb2ludExhbmd1YWdlcwoJCSAgICAgICAgaWYoJHJlcXVpcmVkTGFuZ3VhZ2VzIC1hbmQgJHJlcXVpcmVkTGFuZ3VhZ2VzLlNoYXJlUG9pbnRMYW5ndWFnZSl7CiAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJDaGVja2luZyByZXF1aXJlZCBTaGFyZVBvaW50IGxhbmd1YWdlIHBhY2tzIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50ICAKCiAgICAgICAgICAgICAgICAgICAgIyBnZXQgaW5zdGFsbGVkIGxhbmd1YWdlcyBmcm9tIGNlbnRyYWwgYWRtaW4gcm9vdHdlYgogICAgICAgICAgICAgICAgICAgICRzaXRlID0gR2V0LVNQU2l0ZSAoR2V0LVNQV2ViQXBwbGljYXRpb24gLUluY2x1ZGVDZW50cmFsQWRtaW5pc3RyYXRpb24gfCB3aGVyZSB7JF8uSXNBZG1pbmlzdHJhdGlvbldlYkFwcGxpY2F0aW9ufSkuVXJsCiAgICAgICAgICAgICAgICAgICAgJGluc3RhbGxlZExhbmd1YWdlcyA9ICRzaXRlLlJvb3RXZWIuUmVnaW9uYWxTZXR0aW5ncy5JbnN0YWxsZWRMYW5ndWFnZXMKCiAgICAgICAgICAgICAgICAgICAgJG91dHB1dCA9IEAoKQogICAgICAgICAgICAgICAgICAgICRvdXRwdXQrPSBbUFNDdXN0b21PYmplY3RdQHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEaXNwbGF5TmFtZSA9ICJEaXNwbGF5TmFtZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMYW5ndWFnZVRhZyA9ICJMYW5ndWFnZVRhZyIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTENJRCA9ICJMQ0lEIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbnN0YWxsZWQgPSAiSW5zdGFsbGVkIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkbGFuZ01pc3NpbmcgPSAkZmFsc2UKICAgICAgICAgICAgICAgICAgICAjZmluZCBtYXRjaGVzIGluIHRoZSBpbnN0YWxsZWQgbGFuZ3VhZ2VzCiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkbGFuZyBpbiAkcmVxdWlyZWRMYW5ndWFnZXMuU2hhcmVQb2ludExhbmd1YWdlKXsKICAgICAgICAgICAgICAgICAgICAgICAgJGluc3RMYW5nID0gJGluc3RhbGxlZExhbmd1YWdlcyB8ID8geyAkXy5MQ0lEIC1lcSAkbGFuZy5MQ0lEIC1vciAkXy5MYW5ndWFnZVRhZyAtaWVxICRsYW5nLkxhbmd1YWdlVGFnIC1vciAkXy5EaXNwbGF5TmFtZSAtaWVxICRsYW5nLkRpc3BsYXlOYW1lIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGluc3RMYW5nKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvdXRwdXQrPSBbUFNDdXN0b21PYmplY3RdQHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEaXNwbGF5TmFtZSA9ICRpbnN0TGFuZy5EaXNwbGF5TmFtZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMYW5ndWFnZVRhZyA9ICRpbnN0TGFuZy5MYW5ndWFnZVRhZyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMQ0lEID0gJGluc3RMYW5nLkxDSUQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5zdGFsbGVkID0gIlRydWUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG91dHB1dCs9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW1BTQ3VzdG9tT2JqZWN0XUB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGlzcGxheU5hbWUgPSAgJGxhbmcuRGlzcGxheU5hbWUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGFuZ3VhZ2VUYWcgPSAkbGFuZy5MYW5ndWFnZVRhZyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMQ0lEID0gJGxhbmcuTENJRCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbnN0YWxsZWQgPSAiRmFsc2UiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsYW5nTWlzc2luZyA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJG91dHB1dCB8IGZ0IC1BdXRvU2l6ZSAtSGlkZVRhYmxlSGVhZGVycyB8IE91dC1TdHJpbmcgfCBDb2xvclBhdHRlcm4gLUVycm9yUGF0dGVybiAiRmFsc2UiIC1TdWNjZXNzUGF0dGVybiAiVHJ1ZSIKICAgICAgICAgICAgICAgICAgICBpZigkbGFuZ01pc3NpbmcpewoJCSAgICAgICAgICAgICAgICBUaHJvdyAiTm90IGFsbCByZXF1aXJlZCBTaGFyZVBvaW50IGxhbmd1YWdlIHBhY2tzIGFyZSBpbnN0YWxsZWQgb24gdGhpcyBmYXJtIgoJCSAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CgkJICAgICAgICBFbHNlewoJCSAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiQ2hlY2tpbmcgcmVxdWlyZWQgU2hhcmVQb2ludCBsYW5ndWFnZSBwYWNrcy4uLi4iIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQgLU5vTmV3bGluZQoJCSAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiU2tpcHBlZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZyAgLU5vSW5kZW50CgkJICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJWYWx1ZSBub3Qgc3BlY2lmaWVkIGluIGNvbmZpZ3VyYXRpb24iIC1UeXBlICRTUFNELkxvZ1R5cGVzLldhcm5pbmcKCQkgICAgICAgIH0KCQkgICAgfQoJCSAgICBmaW5hbGx5ewoJCSAgICAgICAgTG9nT3V0ZGVudAoJCSAgICB9CgkJfQoKICAgICAgICAjZW5kcmVnaW9uCgkgICAgI3JlZ2lvbiBDaGVja1NQTWluaW1hbExpY2Vuc2UKCSAgICAjIERlc2M6IENoZWNrcyBpZiB0aGUgY29uZmlndXJlZCBtaW5pbWFsIFNoYXJlUG9pbnQgbGljZW5zZSBpcyBpbnN0YWxsZWQgb24gdGhlIHNlcnZlcgoJCSMgIFJlZjogaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2ZmNzIxOTY5LmFzcHgKCQlGdW5jdGlvbiBDaGVja1NQTWluaW1hbExpY2Vuc2UoKXsKCQkgICAgTG9nIC1NZXNzYWdlICJDaGVja2luZyBtaW5pbWFsIHJlcXVpcmVkIFNoYXJlUG9pbnQgbGljZW5zZS4uLiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudCAtTm9OZXdsaW5lICAKICAgICAgICAgICAgdHJ5CgkJICAgIHsKCQkgICAgICAgICRtaW5pbWFsTGljZW5zZSA9ICRjb25mLlJlc3RyaWN0aW9ucy5NaW5pbWFsU2hhcmVQb2ludExpY2Vuc2UKCQkgICAgICAgIGlmKCRtaW5pbWFsTGljZW5zZSl7CiAgICAgICAgICAgICAgICAgICAgIyBsb2FkIGV4dGVybmFsIFNoYXJlUG9pbnQgcmVsZWFzZXMgbG9va3VwIGRhdGEKICAgICAgICAgICAgICAgICAgICBbeG1sXSRTUFNEU2hhcmVQb2ludCA9IExvYWRYTUxGaWxlKCRzY3JpcHREaXIrIlxTaGFyZVBvaW50VmVyc2lvbnMueG1sIikKCQkgICAgICAgICAgICAkaW5zdGFsbGVkUHJvZHVjdHMgPSAgR2V0LVNQRmFybSB8IHNlbGVjdCBQcm9kdWN0cwoJCSAgICAgICAgICAgICRpbnN0YWxsZWRMaWNlbmNlcyA9ICRTUFNEU2hhcmVQb2ludC5TUFNELlNoYXJlUG9pbnQuTGljZW5zZXMuTGljZW5zZSAgfCBXaGVyZS1PYmplY3QgeyAkaW5zdGFsbGVkUHJvZHVjdHMuUHJvZHVjdHMgLWljb250YWlucyAkXy5HdWlkfQoJCSAgICAgICAgICAgIGlmKCRpbnN0YWxsZWRMaWNlbmNlcyAtYW5kICgoJGluc3RhbGxlZExpY2VuY2VzIHwgRm9yRWFjaC1PYmplY3QgeyRfLlR5cGV9KSB8IFdoZXJlLU9iamVjdCB7ICRfIC1pZXEgJG1pbmltYWxMaWNlbnNlIC1vciAoJG1pbmltYWxMaWNlbnNlIC1pZXEgIlN0YW5kYXJkIiAtYW5kICRfIC1pZXEgIkVudGVycHJpc2UiKSB9KSkKCQkgICAgICAgICAgICB7CgkJICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiT2siIC1UeXBlICRTUFNELkxvZ1R5cGVzLlN1Y2Nlc3MgLU5vSW5kZW50CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGVsc2V7CgkJICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiRmFpbGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKCQkJCQkJSWYgKCRpbnN0YWxsZWRMaWNlbmNlcy5Db3VudCAtZXEgMCl7CgkJCQkJCQlMb2cgLU1lc3NhZ2UgKCJJbnN0YWxsZWQgTGljZW5zZXMgOiB1bmtub3duLCBwbGVhc2UgdXBkYXRlIFNoYXJlUG9pbnRWZXJzaW9ucy54bWwgZnJvbSBodHRwOi8vd3d3Lm1hdHRoaWFzZWluaWcuZGUvZmlsZXMvU2hhcmVQb2ludFZlcnNpb25zLnhtbCIpIC1UeXBlICRTUFNELkxvZ1R5cGVzLldhcm5pbmcKCQkJCQkJfQoJCSAgICAgICAgICAgICAgICBUaHJvdyAiVGhlIGluc3RhbGxlZCBTaGFyZVBvaW50IGxpY2Vuc2UgZG9lcyBub3QgbWVldCB0aGUgbGljZW5zZSByZXF1aXJlbWVudCAnJG1pbmltYWxMaWNlbnNlJyIKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJNaW5pbWFsIExpY2Vuc2UgICAgOiAkbWluaW1hbExpY2Vuc2UiIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbAogICAgICAgICAgICAgICAgICAgICRmaXJzdEl0ZW0gPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJGxpY2Vuc2UgaW4gJGluc3RhbGxlZExpY2VuY2VzKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoISRmaXJzdEl0ZW0pewoJCSAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICgoIiAiKjIxKSskbGljZW5zZS5OYW1lKSAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlewoJCSAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICgiSW5zdGFsbGVkIExpY2Vuc2VzIDogIiArICRsaWNlbnNlLk5hbWUpIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZpcnN0SXRlbSA9ICAkZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIEVsc2V7CgkJICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJTa2lwcGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5XYXJuaW5nICAtTm9JbmRlbnQKCQkgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlZhbHVlIG5vdCBzcGVjaWZpZWQgaW4gY29uZmlndXJhdGlvbiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZwoJCSAgICAgICAgfQoJCSAgICB9CgkJICAgIGZpbmFsbHl7CgkJICAgICAgICBMb2dPdXRkZW50CgkJICAgIH0KCQl9CiAgICAgICAgI2VuZHJlZ2lvbgoKCSAgICAjcmVnaW9uIENoZWNrUHJlcmVxdWlzaXRlU29sdXRpb25zCgkgICAgIyBEZXNjOiBDaGVja3MgaWYgdGhlIGNvbmZpZ3VyZWQgcHJlcmVxdWlzaXRlIHNvbHV0aW9ucyBhcmUgZGVwbG95ZWQgKHdpbGwgYmUgc2tpcHBlZCBvbiByZXRyYWN0aW9uKQoJCUZ1bmN0aW9uIENoZWNrUHJlcmVxdWlzaXRlU29sdXRpb25zKCl7CgkJICAgIHN3aXRjaCgkRGVwbG95bWVudENvbW1hbmQpewoJCSAgICAgICAkU1BTRC5Db21tYW5kcy5EZXBsb3kgICB7ICB9CgkJICAgICAgICRTUFNELkNvbW1hbmRzLlJldHJhY3QgIHsgcmV0dXJuICB9CgkJICAgICAgICRTUFNELkNvbW1hbmRzLlJlZGVwbG95IHsgIH0KCQkgICAgICAgJFNQU0QuQ29tbWFuZHMuVXBkYXRlICB7ICB9CgkJICAgIH0KCQkgICAgTG9nIC1NZXNzYWdlICJDaGVja2luZyBwcmVyZXF1aXNpdGUgc29sdXRpb25zIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50CgkJICAgIHRyeXsKCQkgICAgICAgIGlmKCEkZW52LlByZVJlcXVpc2l0ZVNvbHV0aW9ucyAtb3IgJGVudi5QcmVSZXF1aXNpdGVTb2x1dGlvbnMuU29sdXRpb24uQ291bnQgLWVxIDApewoJCSAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiTm90IGNvbmZpZ3VyZWQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbAoJCSAgICAgICAgICAgIHJldHVybgoJCSAgICAgICAgfQogICAgICAgICAgICAgICAgJHByZVJlcU9rID0gJHRydWUKICAgICAgICAgICAgICAgICRzb2x1dGlvbnMgPSAkZW52LlByZVJlcXVpc2l0ZVNvbHV0aW9ucy5Tb2x1dGlvbgoJCSAgICAgICAgaWYoJHNvbHV0aW9ucykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkc29sdXRpb25zIHwgRm9yRWFjaC1PYmplY3QgewoJCSAgICAgICAgICAgICAgICAkc29sdXRpb25OYW1lID0gJF8uTmFtZQogICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlNvbHV0aW9uICckc29sdXRpb25OYW1lJyIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudAogICAgICAgICAgICAgICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBvbiBTaXRlQ29sbGVjdGlvbnMgKHNhbmRib3hlZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzaXRlQ29sbHMgPSAoU2VsZWN0LVhtbCAteG1sICRfIC1YUGF0aCAiU2l0ZUNvbGxlY3Rpb24iKSB8IEZvckVhY2gtT2JqZWN0IHskXy5Ob2RlfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHNpdGVDb2xscyl7CiAgICAgICAgICAgICAgICAJCSAgICAgICAgTG9nIC1NZXNzYWdlICJDaGVja2luZyBzYW5kYm94ZWQgZGVwbG95bWVudCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1JbmRlbnQKCiAgICAgICAgICAgICAgICAgICAgCSAgICAgICAgaWYoKEdldC1TZXJ2aWNlICJTUFVzZXJDb2RlVjQiKS5TdGF0dXMgLW5lICJSdW5uaW5nIil7CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiU2VydmljZSAnU1BVc2VyQ29kZVY0JyBub3QgcnVubmluZy4gQ2Fubm90IGNoZWNrIHNhbmRib3hlZCBzb2x1dGlvbnMuIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5XYXJuaW5nIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJlUmVxT2sgPSAkZmFsc2UKCQkgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNpdGVDb2xscyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR1cmwgPSAkXy5VcmwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJlUmVxT2sgPSAoSXNTb2x1dGlvbkRlcGxveWVkIC1zb2x1dGlvbk5hbWUgJHNvbHV0aW9uTmFtZSAtdXJsICR1cmwgLXNhbmRib3hlZCkgLWFuZCAkcHJlUmVxT2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nT3V0ZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgY2hlY2sgb24gV2ViQXBwbGljYXRpb25zIChmYXJtKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdlYkFwcHMgPSAoU2VsZWN0LVhtbCAteG1sICRfIC1YUGF0aCAiV2ViQXBwbGljYXRpb24iKSB8IEZvckVhY2gtT2JqZWN0IHskXy5Ob2RlfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHdlYkFwcHMpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiQ2hlY2tpbmcgV2ViQXBwbGljYXRpb24gZGVwbG95bWVudCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd2ViQXBwcyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR1cmwgPSAkXy5VcmwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJlUmVxT2sgPSAoSXNTb2x1dGlvbkRlcGxveWVkIC1zb2x1dGlvbk5hbWUgJHNvbHV0aW9uTmFtZSAtdXJsICR1cmwpIC1hbmQgJHByZVJlcU9rCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dPdXRkZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgI0NoZWNrIEdsb2JhbCAoZmFybSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRfLkNoaWxkTm9kZXMuQ291bnQgLWVxIDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiQ2hlY2tpbmcgR0FDIGRlcGxveW1lbnQuLi4iIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9OZXdsaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByZVJlcU9rID0gKElzU29sdXRpb25EZXBsb3llZCAtc29sdXRpb25OYW1lICRzb2x1dGlvbk5hbWUpIC1hbmQgJHByZVJlcU9rCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxseXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ091dGRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCQkgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCEkcHJlUmVxT2spewogICAgICAgICAgICAgICAgICAgVGhyb3cgIlByZXJlcXVpc2l0ZSBjaGVjayBmYWlsZWQhIE9uZSBvciBtb3JlIHByZXJlcWlzaXRlIHNvbHV0aW9ucyBhcmUgbm90IGRlcGxveWVkLiIKICAgICAgICAgICAgICAgIH0KCQkgICAgfQoJCSAgICBmaW5hbGx5ewoJCSAgICAgICAgTG9nT3V0ZGVudAoJCSAgICB9CgkJfQogICAgICAgICNlbmRyZWdpb24KCSAgICAjcmVnaW9uIElzU29sdXRpb25EZXBsb3llZAoJICAgICMgRGVzYzogQ2hlY2tzIGlmIGEgc29sdXRpb24gaXMgZGVwbG95ZWQsIAogICAgICAgICMgICAgICAgVmFsaWRhdGVzIGlmIFNQVXNlckNvZGVWNCBpcyBydW5uaW5nIGlmIGl0IGlzIGEgc2FuZGJveGVkIHNvbHV0aW9uCiAgICAgICAgIyAgICAgICBWYWxpZGF0ZXMgaWYgV2ViYXBwbGljYXRpb24gc29sdXRpb25zIGFyZSBkZXBsb3llZCB0byB0aGUgc3BlY2lmaWMgdXJsCgkJRnVuY3Rpb24gSXNTb2x1dGlvbkRlcGxveWVkKFtzdHJpbmddJHNvbHV0aW9uTmFtZSwgW3N0cmluZ10kdXJsLCBbc3dpdGNoXSRzYW5kYm94ZWQpewogICAgICAgICAgICBTdGFydC1TUEFzc2lnbm1lbnQgLUdsb2JhbAogICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICBpZighJHNvbHV0aW9uTmFtZSl7CiAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJTb2x1dGlvbiBuYW1lIG5vdCBzcGVjaWZpZWQgaW4gY29uZmlndXJhdGlvbi4iIC1UeXBlICRTUFNELkxvZ1R5cGVzLldhcm5pbmcgCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZQogICAgICAgICAgICAgICAgfQoKCQkgICAgICAgICMgY2hlY2sgc2FuZGJveGVkIHNvbHV0aW9uCgkJICAgICAgICBpZigkc2FuZGJveGVkKXsKICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlVybDogJyR1cmwnLi4uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vTmV3bGluZQogICAgICAgICAgICAgICAgICAgIGlmKCEkdXJsIC1vciAoR2V0LVNQU2l0ZSAkdXJsIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSAtZXEgJG51bGwpewogICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlVybCBpbnZhbGlkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZigoR2V0LVNlcnZpY2UgIlNQVXNlckNvZGVWNCIpLlN0YXR1cyAtbmUgIlJ1bm5pbmciKXsKCQkgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJJbnZhbGlkISBTZXJ2aWNlICdTUFVzZXJDb2RlVjQnIG5vdCBydW5uaW5nLiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IgLU5vSW5kZW50CgkJICAgICAgICAgICAgICAgIHJldHVybiAkZmFsc2UKCQkgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICMgZ2V0IHNhbmJveGVkIHNvbHV0aW9uCgkJICAgICAgICAgICAgJHNvbHV0aW9uID0gR2V0LVNQVXNlclNvbHV0aW9uIC1JZGVudGl0eSAkc29sdXRpb25OYW1lIC1TaXRlICR1cmwgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgICAgICBpZighJHNvbHV0aW9uKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJOb3QgaW5zdGFsbGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkZGVwbG95ZWQgPSAkc29sdXRpb24uU3RhdHVzIC1pZXEgJ0FjdGl2YXRlZCcKICAgICAgICAgICAgICAgICAgICBpZigkZGVwbG95ZWQpeyBMb2cgLU1lc3NhZ2UgKCRzb2x1dGlvbi5TdGF0dXMpIC1UeXBlICRTUFNELkxvZ1R5cGVzLlN1Y2Nlc3MgLU5vSW5kZW50IH0KICAgICAgICAgICAgICAgICAgICBlbHNleyBMb2cgLU1lc3NhZ2UgKCRzb2x1dGlvbi5TdGF0dXMpIC1UeXBlICRTUFNELkxvZ1R5cGVzLkVycm9yIC1Ob0luZGVudCB9CgkJICAgICAgICAgICAgcmV0dXJuICRkZXBsb3llZAoJCSAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgZ2V0IGZhcm0gc29sdXRpb24KCQkgICAgICAgICRzb2x1dGlvbiA9IEdldC1TUFNvbHV0aW9uIC1JZGVudGl0eSAkc29sdXRpb25OYW1lIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCgkJICAgICAgICAkaXNHQUMgPSAkc29sdXRpb24uQ29udGFpbnNHbG9iYWxBc3NlbWJseQoJCSAgICAgICAgJGRlcGxveWVkID0gJHNvbHV0aW9uLkRlcGxveWVkCgkJICAgICAgICAkd2ViQXBwcyA9ICRzb2x1dGlvbi5EZXBsb3llZFdlYkFwcGxpY2F0aW9ucwoKCQkgICAgICAgICMgY2hlY2sgc29sdXRpb24gZGVwbG95ZWQgdG8gd2ViIGFwcGxpY2F0aW9uCgkJICAgICAgICBpZigkdXJsKXsKICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlVybDogJyR1cmwnLi4uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vTmV3bGluZQogICAgICAgICAgICAgICAgICAgIGlmKChHZXQtU1BXZWJBcHBsaWNhdGlvbiAkdXJsIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSAtZXEgJG51bGwpewogICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlVybCBpbnZhbGlkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZighJHNvbHV0aW9uKXsKICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJOb3QgaW5zdGFsbGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRmYWxzZQogICAgICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBpZigkaXNHQUMpewogICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIkludmFsaWQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkVycm9yIC1Ob0luZGVudAoJCSAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIiAgICAgU29sdXRpb24gJyRzb2x1dGlvbk5hbWUnIGlzIGEgR0FDIHNvbHV0aW9uLiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZyAKCQkgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICIgICAgIENoZWNraW5nIEdBQyBpbnN0ZWFkLi4uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vTmV3bGluZSAKCQkgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZWlmKCRkZXBsb3llZCAtYW5kICgkd2ViQXBwcyB8IFdoZXJlLU9iamVjdCB7ICRfLlVybCAtbWF0Y2ggIig/aSkkdXJsIiB9KS5jb3VudCl7CiAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiRGVwbG95ZWQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLlN1Y2Nlc3MgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdHJ1ZSAKCQkgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIk5vdCBEZXBsb3llZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZmFsc2UKICAgICAgICAgICAgICAgICAgICB9CgkJICAgICAgICB9CiAgICAgICAgICAgICAgICBpZighJHNvbHV0aW9uKXsKICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIk5vdCBpbnN0YWxsZWQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkVycm9yIC1Ob0luZGVudAogICAgICAgICAgICAgICAgICAgIHJldHVybiAkZmFsc2UKICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICMgY2hlY2sgc29sdXRpb24gZGVwbG95ZWQgdG8gYWxsIGNvbnRlbnQgdXJscwoJCSAgICAgICAgaWYoISRpc0dBQyl7CiAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJJbnZhbGlkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKCQkgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlNvbHV0aW9uICckc29sdXRpb25OYW1lJyBpcyBhIFdlYkFwcGxpY2F0aW9uIHNvbHV0aW9uLiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZyAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGZhbHNlCgkJICAgICAgICB9CiAgICAgICAgICAgICAgICBpZigkZGVwbG95ZWQpeyBMb2cgLU1lc3NhZ2UgIkRlcGxveWVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5TdWNjZXNzIC1Ob0luZGVudCB9CiAgICAgICAgICAgICAgICBlbHNleyBMb2cgLU1lc3NhZ2UgIk5vdCBEZXBsb3llZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IgLU5vSW5kZW50IH0KCQkgICAgICAgIHJldHVybiAkZGVwbG95ZWQKICAgICAgICAgICAgfQogICAgICAgICAgICBmaW5hbGx5ewogICAgICAgICAgICAgICAgU3RvcC1TUEFzc2lnbm1lbnQgLUdsb2JhbAogICAgICAgICAgICB9CgkJfQogICAgICAgICNlbmRyZWdpb24KCSAgICAjcmVnaW9uIEdldFNvbHV0aW9ucwoJICAgICMgRGVzYzogQ3JlYXRlcyBhIEhhc2h0YWJsZSB3aXQgZmFybSBhbmQgc2FuZGJveGVkIHNvbHV0aW9ucyBvdXQgb2YgdGhlIGVudmlyb25tZW50IGNvbmZpZ3VyYXRpb24KICAgICAgICAjICAgICAgIEl0IHBhcnNlcyB0aGUgaW5wdXQgeG1sIGFuIGFzc3VyZXMgdGhhdCBzb2x1dGlvbnMgYXJlIG5vdCBkZXBsb3llZCBtdWx0aXBsZSB0aW1lcwogICAgICAgICMgICAgICAgSWYgbm8gc29sdXRpb25zIGFyZSBjb25maWd1cmVkIGFsbCBXU1BzIGluIHRoZSBzb2x1dGlvbnMgZm9sZGVyIGFyZSByZXR1cm5lZCBhcyBmYXJtIHNvbHV0aW9ucwogICAgICAgIEZ1bmN0aW9uIEdldFNvbHV0aW9ucygpewogICAgICAgICAgICAkcmVzdWx0ID0gQHsgCiAgICAgICAgICAgICAgICAgICAgICAgIFNpdGVTb2x1dGlvbnMgPSBAeyB9CiAgICAgICAgICAgICAgICAgICAgICAgIEZhcm1Tb2x1dGlvbnMgPSBAeyB9CiAgICAgICAgICAgICAgICAgICAgICAgfQoJCSAgICBMb2cgLU1lc3NhZ2UgIkdldHRpbmcgc29sdXRpb24gZmlsZXMgdG8gJCgkQ29tbWFuZC5Ub0xvd2VyKCkpIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50CgkJICAgIHRyeXsKICAgICAgICAgICAgICAgICMgZ2V0IG92ZXJhbGwgYXR0cmlidXRlcyAoaWYgcHJlc2VudCkKICAgICAgICAgICAgICAgICRnRm9yY2UgPSBHZXRCb29sQXR0cmlidXRlIC1ub2RlICRlbnYuU29sdXRpb25zIC1hdHRyaWJ1dGUgIkZvcmNlIgogICAgICAgICAgICAgICAgJGdPdmVyd3JpdGUgPSBHZXRCb29sQXR0cmlidXRlIC1ub2RlICRlbnYuU29sdXRpb25zIC1hdHRyaWJ1dGUgIk92ZXJ3cml0ZSIKICAgICAgICAgICAgICAgICRnQ29tcExldmVsID0gJGVudi5Tb2x1dGlvbnMuQ29tcGF0aWJpbGl0eUxldmVsCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTm8gc29sdXRpb25zIGNvbmZpZ3VyZWQgaW4gU29sdXRpb25zIG5vZGUsIHRha2luZyBhbGwgaW4gc29sdXRpb25zIGZvbGRlcgoJCSAgICAgICAgaWYoISRlbnYuU29sdXRpb25zIC1vciAhJGVudi5Tb2x1dGlvbnMuU29sdXRpb24pewoJCSAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiU29sdXRpb25zIG5vZGUgbm90IGNvbmZpZ3VyZWQuIFVzaW5nIGFsbCBzb2x1dGlvbnMgaW4gJy5cU29sdXRpb25zJyBmb2xkZXIiIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbAogICAgICAgICAgICAgICAgICAgICRmaWxlRW50cmllcyA9IEdldC1DaGlsZEl0ZW0gJHNvbERpci5UcmltRW5kKCJcXCIpICoud3NwIHwgU2VsZWN0IE5hbWUKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRmaWxlIGluICRmaWxlRW50cmllcykgCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBpZighJHJlc3VsdC5GYXJtU29sdXRpb25zLkNvbnRhaW5zS2V5KCRmaWxlLk5hbWUpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXN1bHQuRmFybVNvbHV0aW9ucy5BZGQoJGZpbGUuTmFtZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQHsgTmFtZSA9ICRmaWxlLk5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb3JjZSA9ICRnRm9yY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxVcmxzID0gJHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPdmVyd3JpdGUgPSAkZ092ZXJ3cml0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbXBhdGliaWxpdHlMZXZlbCA9ICRnQ29tcExldmVsIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRyZXN1bHQKCQkgICAgICAgIH0KICAgICAgICAgICAgICAgICMgdmFsaWRhdGluZyBjb25maWd1cmVkIHNvbHV0aW9ucyBpbiBzb2x1dGlvbnMgbm9kZQogICAgICAgICAgICAgICAgJHNvbHV0aW9ucyA9ICRlbnYuU29sdXRpb25zLlNvbHV0aW9uCiAgICAgICAgICAgICAgICBpZigkc29sdXRpb25zKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRzb2x1dGlvbnMgfCBGb3JFYWNoLU9iamVjdCB7CgkJICAgICAgICAgICAgICAgICRzb2x1dGlvbk5hbWUgPSAkXy5OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRmb3JjZSA9IEdldEJvb2xBdHRyaWJ1dGUgLW5vZGUgJF8gLWF0dHJpYnV0ZSAiRm9yY2UiIC1kZWZhdWx0SWZOb3RFeGlzdGluZyAkZ0ZvcmNlCiAgICAgICAgICAgICAgICAgICAgICAgICRvdmVyd3JpdGUgPSBHZXRCb29sQXR0cmlidXRlIC1ub2RlICRfIC1hdHRyaWJ1dGUgIk92ZXJ3cml0ZSIgLWRlZmF1bHRJZk5vdEV4aXN0aW5nICRnT3ZlcndyaXRlCiAgICAgICAgICAgICAgICAgICAgICAgICRjb21wTGV2ZWwgPSAkXy5Db21wYXRpYmlsaXR5TGV2ZWwKICAgICAgICAgICAgICAgICAgICAgICAgaWYoLW5vdCgkY29tcExldmVsKSAtYW5kICRnQ29tcExldmVsKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21wTGV2ZWwgPSAkZ0NvbXBMZXZlbAogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAjIENoZWNrIG9uIFNpdGVDb2xsZWN0aW9ucyAoc2FuZGJveGVkKQogICAgICAgICAgICAgICAgICAgICAgICAkc2l0ZUNvbGxzID0gKFNlbGVjdC1YbWwgLXhtbCAkXyAtWFBhdGggIlNpdGVDb2xsZWN0aW9uIikgfCBGb3JFYWNoLU9iamVjdCB7JF8uTm9kZX0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHNpdGVDb2xscyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2l0ZUNvbGxzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgYWRkIGEgbmV3IHNvbHV0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoISRyZXN1bHQuU2l0ZVNvbHV0aW9ucy5Db250YWluc0tleSgkc29sdXRpb25OYW1lKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXN1bHQuU2l0ZVNvbHV0aW9ucy5BZGQoJHNvbHV0aW9uTmFtZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAeyAgTmFtZSA9ICRzb2x1dGlvbk5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvcmNlID0gJGZvcmNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPdmVyd3JpdGUgPSAkb3ZlcndyaXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVcmxzID0gQCgkXy5VcmwpfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMganVzdCBhZGQgYW5vdGhlciB1cmwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlc3VsdC5TaXRlU29sdXRpb25zWyRzb2x1dGlvbk5hbWVdWyJVcmxzIl0gKz0gJF8uVXJsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBjaGVjayBvbiBXZWJBcHBsaWNhdGlvbnMgKGZhcm0pCiAgICAgICAgICAgICAgICAgICAgICAgICR3ZWJBcHBzID0gKFNlbGVjdC1YbWwgLXhtbCAkXyAtWFBhdGggIldlYkFwcGxpY2F0aW9uIikgfCBGb3JFYWNoLU9iamVjdCB7JF8uTm9kZX0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHdlYkFwcHMpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdlYkFwcHMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBhZGQgYSBuZXcgc29sdXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighJHJlc3VsdC5GYXJtU29sdXRpb25zLkNvbnRhaW5zS2V5KCRzb2x1dGlvbk5hbWUpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlc3VsdC5GYXJtU29sdXRpb25zLkFkZCgkc29sdXRpb25OYW1lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEB7ICBOYW1lID0gJHNvbHV0aW9uTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9yY2UgPSAkZm9yY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE92ZXJ3cml0ZSA9ICRvdmVyd3JpdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbXBhdGliaWxpdHlMZXZlbCA9ICRjb21wTGV2ZWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVybHMgPSBAKCRfLlVybCl9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBqdXN0IGFkZCBhbm90aGVyIHVybAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVzdWx0LkZhcm1Tb2x1dGlvbnNbJHNvbHV0aW9uTmFtZV1bIlVybHMiXSArPSAkXy5VcmwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICNDaGVjayBHbG9iYWwgKGZhcm0pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRfLkNoaWxkTm9kZXMuQ291bnQgLWVxIDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoISRyZXN1bHQuRmFybVNvbHV0aW9ucy5Db250YWluc0tleSgkc29sdXRpb25OYW1lKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlc3VsdC5GYXJtU29sdXRpb25zLkFkZCgkc29sdXRpb25OYW1lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQHsgTmFtZSA9ICRzb2x1dGlvbk5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9yY2UgPSAkZm9yY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29tcGF0aWJpbGl0eUxldmVsID0gJGNvbXBMZXZlbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxVcmxzID0gJHRydWUgIyB3aWxsIG92ZXJyaWRlIGFkZGl0b25hbCB3ZWIgYXBwbGljYXRpb24gZGVwbG95bWVudHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT3ZlcndyaXRlID0gJG92ZXJ3cml0ZSB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXN1bHQuRmFybVNvbHV0aW9uc1skc29sdXRpb25OYW1lXVsiQWxsVXJscyJdID0gJHRydWUgIyB3aWxsIG92ZXJyaWRlIGFkZGl0b25hbCB3ZWIgYXBwbGljYXRpb24gZGVwbG95bWVudHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgfQoJCSAgICBmaW5hbGx5ewoJCSAgICAgICAgTG9nT3V0ZGVudAoJCSAgICB9CiAgICAgICAgICAgIHJldHVybiAkcmVzdWx0CiAgICAgICAgfQogICAgICAgICNlbmRyZWdpb24KCSAgICAjcmVnaW9uIENoZWNrSWZTb2x1dGlvbkZpbGVzRXhpc3QKCSAgICAjIERlc2M6IENoZWNrcyBpZiBhbGwgY29uZmlndXJlZCBzb2x1dGlvbnMgZmlsZSBkbyBleGlzdCBpbiB0aGUgc29sdXRpb25zIGZvbGRlcgogICAgICAgIEZ1bmN0aW9uIENoZWNrSWZTb2x1dGlvbkZpbGVzRXhpc3QoW1N5c3RlbS5Db2xsZWN0aW9ucy5IYXNodGFibGVdJHNvbHV0aW9ucyl7CiAgICAgICAgICAgICRhbGxTb2x1dGlvbnMgPSAoJHNvbHV0aW9ucy5GYXJtU29sdXRpb25zICsgJHNvbHV0aW9ucy5TaXRlU29sdXRpb25zKS5LZXlzIHwgR2V0LVVuaXF1ZQogICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIkNoZWNraW5nIGlmIHNvbHV0aW9uIGZpbGVzIGV4aXN0IGluICcuXFNvbHV0aW9ucycgZm9sZGVyIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50CiAgICAgICAgICAgIGlmKCRhbGxTb2x1dGlvbnMpewogICAgICAgICAgICAgICAgJGVycm9ycyA9ICRmYWxzZQogICAgICAgICAgICAgICAgJGFsbFNvbHV0aW9ucyB8IEZvckVhY2gtT2JqZWN0ewogICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAoJF8rIi4uLiIpIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9OZXdsaW5lCiAgICAgICAgICAgICAgICAgICAgaWYoKFRlc3QtUGF0aCAtUGF0aCAoJHNvbERpciArICJcIiArICRfKSkpewogICAgICAgICAgICAgICAgICAgIAlMb2cgLU1lc3NhZ2UgIkV4aXN0cyIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuU3VjY2VzcyAtTm9JbmRlbnQKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgZWxzZXsKCQkgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJNaXNzaW5nIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgJGVycm9ycyA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoJGVycm9ycyl7CiAgICAgICAgICAgICAgICAgICAgVGhyb3cgIk9uZSBvciBtb3JlIGNvbmZpZ3VyZWQgc29sdXRpb25zIGZpbGVzIHdlcmUgbm90IGZvdW5kIGluIHRoZSAnLlxTb2x1dGlvbnMnIGZvbGRlciIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJObyBzb2x1dGlvbnMgY29uZmlndXJlZCB0byAkKCRDb21tYW5kLlRvTG93ZXIoKSkiIC1UeXBlICRTUFNELkxvZ1R5cGVzLldhcm5pbmcKICAgICAgICAgICAgfQogICAgICAgICAgICBMb2dPdXRkZW50CiAgICAgICAgfQogICAgICAgICNlbmRyZWdpb24KCSAgICAjcmVnaW9uIENoZWNrSWZTaXRlRXhpc3RzCgkgICAgIyBEZXNjOiBDaGVja3MgaWYgYSBTUFNpdGUgb2JqZWN0IGV4aXN0cyBhdCBhIGdpdmVuIHVybAogICAgICAgIEZ1bmN0aW9uIENoZWNrSWZTaXRlRXhpc3RzKFtzdHJpbmddJHVybCl7CiAgICAgICAgICAgIGlmKCEkdXJsKXsgcmV0dXJuICR0cnVlIH0KICAgICAgICAgICAgU3RhcnQtU1BBc3NpZ25tZW50IC1HbG9iYWwKICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJTaXRlOiAnJHVybCcuLi4iIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9OZXdsaW5lCiAgICAgICAgICAgIGlmKCEkdXJsIC1vciAoR2V0LVNQU2l0ZSAkdXJsIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSAtZXEgJG51bGwpewogICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJObyBGb3VuZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IgLU5vSW5kZW50CiAgICAgICAgICAgICAgICByZXR1cm4gJGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJPayIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuU3VjY2VzcyAtTm9JbmRlbnQKICAgICAgICAgICAgU3RvcC1TUEFzc2lnbm1lbnQgLUdsb2JhbAogICAgICAgICAgICByZXR1cm4gJHRydWUKICAgICAgICB9CiAgICAgICAgI2VuZHJlZ2lvbgoJICAgICNyZWdpb24gQ2hlY2tJZldlYkFwcEV4aXN0cwoJICAgICMgRGVzYzogQ2hlY2tzIGlmIGEgV2ViQXBwbGljYXRpb24gb2JqZWN0IGV4aXN0cyBhdCBhIGdpdmVuIHVybAogICAgICAgIEZ1bmN0aW9uIENoZWNrSWZXZWJBcHBFeGlzdHMoW3N0cmluZ10kdXJsKXsKICAgICAgICAgICAgaWYoISR1cmwpeyByZXR1cm4gJHRydWUgfQogICAgICAgICAgICBTdGFydC1TUEFzc2lnbm1lbnQgLUdsb2JhbAogICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIldlYkFwcGxpY2F0aW9uOiAnJHVybCcuLi4iIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9OZXdsaW5lCiAgICAgICAgICAgIGlmKCEkdXJsIC1vcihHZXQtU1BXZWJBcHBsaWNhdGlvbiAkdXJsIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSAtZXEgJG51bGwpewogICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJObyBGb3VuZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IgLU5vSW5kZW50CiAgICAgICAgICAgICAgICByZXR1cm4gJGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJPayIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuU3VjY2VzcyAtTm9JbmRlbnQKICAgICAgICAgICAgU3RvcC1TUEFzc2lnbm1lbnQgLUdsb2JhbAogICAgICAgICAgICByZXR1cm4gJHRydWUKICAgICAgICB9CiAgICAgICAgI2VuZHJlZ2lvbgoJICAgICNyZWdpb24gQ2hlY2tJZlVybHNFeGlzdHMKCSAgICAjIERlc2M6IENoZWNrcyBpZiBhbGwgY29uZmlndXJlZCB1cmxzIGZvciBzb2x1dGlvbnMgZGVwbG95bWVudCBkbyBleGlzdAogICAgICAgIEZ1bmN0aW9uIENoZWNrSWZVcmxzRXhpc3RzKFtTeXN0ZW0uQ29sbGVjdGlvbnMuSGFzaHRhYmxlXSRzb2x1dGlvbnMpewogICAgICAgICAgIExvZyAtTWVzc2FnZSAiQ2hlY2tpbmcgaWYgc3BlY2lmaWVkIFNpdGVzIGFuZCBXZWIgQXBwbGljYXRpb25zIGV4aXN0IiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50CiAgICAgICAgICAgJHVybEV4aXN0cyA9ICR0cnVlCgogICAgICAgICAgICMgY2hlY2tpbmcgd2ViIGFwcGxpY2F0aW9ucyBzb2x1dGlvbnMKICAgICAgICAgICBpZigkc29sdXRpb25zLkZhcm1Tb2x1dGlvbnMuVmFsdWVzLlVybHMuQ291bnQgLWd0IDApewogICAgICAgICAgICAgICAkc29sdXRpb25zLkZhcm1Tb2x1dGlvbnMuVmFsdWVzLlVybHMgfCBHZXQtVW5pcXVlIHwgRm9yRWFjaC1PYmplY3QgeyR1cmxFeGlzdHMgPSAgKENoZWNrSWZXZWJBcHBFeGlzdHMgJF8pIC1hbmQgJHVybEV4aXN0c30gCiAgICAgICAgICAgfQogICAgICAgICAgIGVsc2UgeyBMb2cgLU1lc3NhZ2UgIk5vIHRhcmdldCBXZWJBcHBsaWNhdGlvbnMgY29uZmlndXJlZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsfQoKICAgICAgICAgICAjIGNoZWNraW5nIHNpdGUgY29sbGVjdGlvbnMKICAgICAgICAgICBpZigkc29sdXRpb25zLlNpdGVTb2x1dGlvbnMuVmFsdWVzLlVybHMuQ291bnQgLWd0IDApewogICAgICAgICAgICAgICAkc29sdXRpb25zLlNpdGVTb2x1dGlvbnMuVmFsdWVzLlVybHMgfCBHZXQtVW5pcXVlIHwgRm9yRWFjaC1PYmplY3QgeyR1cmxFeGlzdHMgPSAgKENoZWNrSWZTaXRlRXhpc3RzICRfKSAtYW5kICR1cmxFeGlzdHN9IAogICAgICAgICAgIH0KICAgICAgICAgICBlbHNlIHsgTG9nIC1NZXNzYWdlICJObyB0YXJnZXQgU2l0ZXMgY29uZmlndXJlZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsfQoKICAgICAgICAgICBpZighJHVybEV4aXN0cyl7CiAgICAgICAgICAgICAgICBUaHJvdyAiT25lIG9yIG1vcmUgdGFyZ2V0IFNpdGVzL1dlYkFwcGxpY2F0aW9ucyBkbyBub3QgZXhpc3RzIgogICAgICAgICAgIH0KICAgICAgICAgICBMb2dPdXRkZW50CiAgICAgICAgfQogICAgICAgICNlbmRyZWdpb24KICAgICNlbmRyZWdpb24KICAgICNyZWdpb24gRGVwbG95bWVudC5Db21tYW5kcwoJICAgICNyZWdpb24gUnVuRGVwbG95bWVudAoJICAgICMgRGVzYzogUnVucyB0aGUgZGVwbG95bWVudCB0YXNrcyBiYXNlZCBvbiB0aGUgdXNlciBpbnB1dAoJCUZ1bmN0aW9uIFJ1bigpewoJCSAgICBQcmVDb25kaXRpb25zCgkJCUluaXRpYWxpemUgJHZhcnMKICAgICAgICAgICAgRXhlY3V0ZS1FeHRlbnNpb25zICRldmVudHMuSW5pdGlhbGl6ZQoKCQkgICAgc3dpdGNoKCREZXBsb3ltZW50Q29tbWFuZCl7CgkJICAgICAgICRTUFNELkNvbW1hbmRzLkRlcGxveSAgIHsgRGVwbG95ICAgfQoJCSAgICAgICAkU1BTRC5Db21tYW5kcy5SZXRyYWN0ICB7IFJldHJhY3QgIH0KCQkgICAgICAgJFNQU0QuQ29tbWFuZHMuUmVkZXBsb3kgeyBSZWRlcGxveSB9CgkJICAgICAgICRTUFNELkNvbW1hbmRzLlVwZGF0ZSAgeyBVcGRhdGUgIH0KCQkgICAgfQoJCX0KICAgICAgICAjZW5kcmVnaW9uCiAgICAgICAgI3JlZ2lvbiBEZXBsb3ltZW50LkNvbW1hbmRzLkRlcGxveQoJICAgICAgICAjcmVnaW9uIERlcGxveQoJICAgICAgICAjIERlc2M6IERlcGxveXMgYWxsIGNvbmZpZ3VyZWQgc29sdXRpb25zIGFuZCBwZXJmb3JtcyBwcmUgYW5kIHBvc3QgZGVwbG95IGN1c3RvbSBjb2RlCgkgICAgICAgIEZ1bmN0aW9uIERlcGxveSgpeyAKICAgICAgICAgICAgICAgICRkZXBsb3lFbGFwc2VkVGltZSA9IFtTeXN0ZW0uRGlhZ25vc3RpY3MuU3RvcHdhdGNoXTo6U3RhcnROZXcoKQogICAKCSAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiQmVnaW4gc29sdXRpb24gZGVwbG95bWVudCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudAoKICAgICAgICAgICAgICAgIEV4ZWN1dGUtRXh0ZW5zaW9ucyAkZXZlbnRzLkJlZm9yZURlcGxveQoKCSAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiQmVnaW4gY3VzdG9tIEJlZm9yZURlcGxveSB0YXJnZXQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQKCSAgICAgICAgICAgIEJlZm9yZURlcGxveSAkdmFycwogICAgICAgICAgICAgICAgTG9nT3V0ZGVudAoKCSAgICAgICAgICAgIGlmKCREZXBsb3ltZW50VHlwZSAtbmUgJFNQU0QuRGVwbG95bWVudFR5cGVzLkV4dGVuc2lvbnMpewoJICAgICAgICAgICAgICAgIERlcGxveVNvbHV0aW9ucwoJICAgICAgICAgICAgICAgIFJ1bkFjdGlvbnMgLWFjdGlvbkNtZCAkU1BTRC5Db21tYW5kcy5EZXBsb3kgLXNraXBXYXJtdXAKCSAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBFeGVjdXRlLUV4dGVuc2lvbnMgJGV2ZW50cy5BZnRlckRlcGxveQoKICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiQmVnaW4gY3VzdG9tIEFmdGVyRGVwbG95IHRhcmdldCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudAoJICAgICAgICAgICAgQWZ0ZXJEZXBsb3kgJHZhcnMKICAgICAgICAgICAgICAgIExvZ091dGRlbnQKCgogICAgICAgICAgICAgICAgUnVuQWN0aW9ucyAtYWN0aW9uQ21kICRTUFNELkNvbW1hbmRzLkRlcGxveSAtb25seVdhcm11cAoJICAgICAgICAgICAgTG9nIC1NZXNzYWdlICgiU29sdXRpb24gZGVwbG95bWVudCBmaW5pc2hlZCAoIiskZGVwbG95RWxhcHNlZFRpbWUuRWxhcHNlZCsgIikiKSAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtT3V0ZGVudAoJICAgICAgICB9CiAgICAgICAgICAgICNlbmRyZWdpb24KCSAgICAgICAgI3JlZ2lvbiBEZXBsb3lTb2x1dGlvbnMKCSAgICAgICAgIyBEZXNjOiBEZXBsb3lzIHRoZSBzb2x1dGlvbnMKCSAgICAgICAgRnVuY3Rpb24gRGVwbG95U29sdXRpb25zKCl7CiAgICAgICAgICAgICAgICRzb2x1dGlvbnMgPSBHZXRTb2x1dGlvbnMKICAgICAgICAgICAgICAgQ2hlY2tJZlNvbHV0aW9uRmlsZXNFeGlzdCAtc29sdXRpb25zICRzb2x1dGlvbnMKICAgICAgICAgICAgICAgQ2hlY2tJZlVybHNFeGlzdHMgLXNvbHV0aW9ucyAkc29sdXRpb25zCiAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiRGVwbG95aW5nOiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudAogICAgICAgICAgICAgICAkc29sdXRpb25zLkZhcm1Tb2x1dGlvbnMuVmFsdWVzIHwgRm9yRWFjaC1PYmplY3R7IERlcGxveUZhcm1Tb2x1dGlvbiAtc29sdXRpb25EZWZpbml0aW9uICRffQogICAgICAgICAgICAgICAkc29sdXRpb25zLlNpdGVTb2x1dGlvbnMuVmFsdWVzIHwgRm9yRWFjaC1PYmplY3R7IERlcGxveVNhbmRib3hlZFNvbHV0aW9uIC1zb2x1dGlvbkRlZmluaXRpb24gJF8gfQogICAgICAgICAgICAgICBMb2dPdXRkZW50CgkgICAgICAgIH0KICAgICAgICAgICAgI2VuZHJlZ2lvbgoJICAgICAgICAjcmVnaW9uIERlcGxveUZhcm1Tb2x1dGlvbgoJICAgICAgICAjIERlc2M6IERlcGxveXMgZmFybSBzb2x1dGlvbnMgZWl0aGVyIHRvIEdBQyBvciB0byBXZWJBcHBsaWNhdGlvbiB1cmxzCgkgICAgICAgIEZ1bmN0aW9uIERlcGxveUZhcm1Tb2x1dGlvbihbU3lzdGVtLkNvbGxlY3Rpb25zLkhhc2h0YWJsZV0kc29sdXRpb25EZWZpbml0aW9uKXsKICAgICAgICAgICAgICAgICRlbGFwc2VkVGltZSA9IFtTeXN0ZW0uRGlhZ25vc3RpY3MuU3RvcHdhdGNoXTo6U3RhcnROZXcoKQoKICAgICAgICAgICAgICAgIGlmKCRzb2x1dGlvbkRlZmluaXRpb24pewogICAgICAgICAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgICAgICAgICAgJHNvbHV0aW9uTmFtZSA9ICRzb2x1dGlvbkRlZmluaXRpb25bIk5hbWUiXQogICAgICAgICAgICAgICAgICAgICAgICAkZm9yY2UgPSAkc29sdXRpb25EZWZpbml0aW9uWyJGb3JjZSJdCiAgICAgICAgICAgICAgICAgICAgICAgICRvdmVyd3JpdGUgPSAkc29sdXRpb25EZWZpbml0aW9uWyJPdmVyd3JpdGUiXQogICAgICAgICAgICAgICAgICAgICAgICAkY29tcExldmVsID0gJHNvbHV0aW9uRGVmaW5pdGlvblsiQ29tcGF0aWJpbGl0eUxldmVsIl0KICAgICAgICAgICAgICAgICAgICAgICAgJEFsbFVybHMgPSAkc29sdXRpb25EZWZpbml0aW9uWyJBbGxVcmxzIl0KICAgICAgICAgICAgICAgICAgICAgICAgJFVybHMgPSAkc29sdXRpb25EZWZpbml0aW9uWyJVcmxzIl0gfCBHZXQtVW5pcXVlCgogICAgICAgICAgICAJICAgICAgICBMb2cgLU1lc3NhZ2UgIickc29sdXRpb25OYW1lJyAoZmFybSBzb2x1dGlvbikiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQKCQkJCQkJCgkJCQkJCSRwcm9jZXNzU29sdXRpb24gPSAoUHJvY2Vzc1NvbHV0aW9uICR2YXJzICRzb2x1dGlvbk5hbWUgJFNQU0QuQ29tbWFuZHMuRGVwbG95ICRmYWxzZSkgLW9yICRmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBFeGVjdXRlLUV4dGVuc2lvbnMgJGV2ZW50cy5Qcm9jZXNzU29sdXRpb25zCgoJCQkJCQlpZigkcHJvY2Vzc1NvbHV0aW9uKXsKCQkJCQkJCUxvZyAtTWVzc2FnZSAiJyRzb2x1dGlvbk5hbWUnIChmYXJtIHNvbHV0aW9uKSBza2lwcGVkIGJ5IGN1c3RvbSB0YXJnZXQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLldhcm5pbmcKCQkJCQkJCXJldHVybgoJCQkJCQl9CgkJCQkJCQogICAgICAgICAgICAgICAgICAgICAgICAkc29sdXRpb24gPSBHZXQtU1BTb2x1dGlvbiAtSWRlbnRpdHkgJHNvbHV0aW9uTmFtZSAtRXJyb3JBY3Rpb246U2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNvbHV0aW9uIC1uZSAkbnVsbCAtYW5kICRvdmVyd3JpdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiU29sdXRpb24gYWxyZWFkeSBleGlzdCBhbmQgb3ZlcndyaXRpbmcgc2V0IHRvIHRydWUiIC1UeXBlICRTUFNELkxvZ1R5cGVzLndhcm5pbmcgLUluZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmV0cmFjdEZhcm1Tb2x1dGlvbiAtc29sdXRpb25EZWZpbml0aW9uICRzb2x1dGlvbkRlZmluaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ091dGRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKCRzb2x1dGlvbiAtbmUgJG51bGwpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJTb2x1dGlvbiBhbHJlYWR5IGV4aXN0IGFuZCBvdmVyd3JpdGUgaXMgc2V0IHRvIGZhbHNlLCAiIC1UeXBlICRTUFNELkxvZ1R5cGVzLldhcm5pbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiU2tpcHBpbmcgdGhpcyBzb2x1dGlvbiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICMgQWRkaW5nIFNvbHV0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiQWRkaW5nIHNvbHV0aW9uLi4uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vTmV3TGluZQogICAgICAgICAgICAgICAgICAgICAgICBBZGQtU1BTb2x1dGlvbiAtTGl0ZXJhbFBhdGggIiRzb2xEaXJcJHNvbHV0aW9uTmFtZSIgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAkc29sdXRpb24gPSBHZXQtU1BTb2x1dGlvbiAtSWRlbnRpdHkgJHNvbHV0aW9uTmFtZSAtRXJyb3JBY3Rpb246U2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBpZigkc29sdXRpb24peyBMb2cgLU1lc3NhZ2UgIk9rIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5TdWNjZXNzIC1Ob0luZGVudCB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2V7IExvZyAtTWVzc2FnZSAiRmFpbGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhyb3cgIkZhcm0gc29sdXRpb24gJyRzb2x1dGlvbk5hbWUnIGNvdWxkIG5vdCBiZSBhZGRlZCIKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJFNQU0QuSW5zdGFsbGVkVmVyc2lvbiAtZXEgMTQgLWFuZCAhJEFsbG93Q0FTUG9saWNpZXMgLWFuZCAkc29sdXRpb24uQ29udGFpbnNDYXNQb2xpY3kpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJTb2x1dGlvbiBjb250YWlucyBDQVMgcG9saWN5IHdoaWNoIGlzIHJlc3RyaWN0ZWQgaW4gdGhlIGRlcGxveW1lbnRjb25maWd1cmF0aW9uLiBTb2x1dGlvbiBza2lwcGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5XYXJuaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZW1vdmUtU1BTb2x1dGlvbiAtSWRlbnRpdHkgJHNvbHV0aW9uTmFtZSAtQ29uZmlybTokZmFsc2UgLUVycm9yQWN0aW9uOlNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCEkQWxsb3dHQUNEZXBsb3ltZW50IC1hbmQgJHNvbHV0aW9uLkNvbnRhaW5zR2xvYmFsQXNzZW1ibHkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJTb2x1dGlvbiBjb250YWlucyBHQUMgYXNzZW1sYnkgd2hpY2ggaXMgcmVzdHJpY3RlZCBpbiB0aGUgZGVwbG95bWVudCBjb25maWd1cmF0aW9uLiBTb2x1dGlvbiBza2lwcGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5XYXJuaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZW1vdmUtU1BTb2x1dGlvbiAtSWRlbnRpdHkgJHNvbHV0aW9uTmFtZSAtQ29uZmlybTokZmFsc2UgLUVycm9yQWN0aW9uOlNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAjIERlcGxveWluZwogICAgICAgICAgICAgICAgICAgICAgICAkcnVuQ291bnQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIFdoaWxlKCRydW5Db3VudCAtbGUgJERlcGxveW1lbnRSZXRyaWVzKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRydW5Db3VudCsrCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzb2x1dGlvbi5Db250YWluc1dlYkFwcGxpY2F0aW9uUmVzb3VyY2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRBbGxVcmxzIC1vciAkVXJscy5Db3VudCAtZXEgMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiRGVwbG95aW5nIHRvIGFsbCBjb250ZW50IHVybHMuLi4iIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9OZXdsaW5lCgkJCQkJCQkJCWlmICgkU1BTRC5JbnN0YWxsZWRWZXJzaW9uIC1lcSAxNCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAlJbnN0YWxsLVNQU29sdXRpb24gLUlkZW50aXR5ICRzb2x1dGlvbk5hbWUgLWFsbHdlYmFwcGxpY2F0aW9uIC1DQVNQb2xpY2llczokQWxsb3dDQVNQb2xpY2llcyAtR0FDRGVwbG95bWVudDokQWxsb3dHQUNEZXBsb3ltZW50IC1mb3JjZTokZm9yY2UKCQkJCQkJCQkJfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKCRTUFNELkluc3RhbGxlZFZlcnNpb24gLWVxIDE1KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRjb21wTGV2ZWwpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAJICAgIEluc3RhbGwtU1BTb2x1dGlvbiAtSWRlbnRpdHkgJHNvbHV0aW9uTmFtZSAtYWxsd2ViYXBwbGljYXRpb24gLUZ1bGxUcnVzdEJpbkRlcGxveW1lbnQ6JEFsbG93RnVsbFRydXN0QmluRGVwbG95bWVudCAtR0FDRGVwbG95bWVudDokQWxsb3dHQUNEZXBsb3ltZW50IC1Db21wYXRpYmlsaXR5TGV2ZWwgJGNvbXBMZXZlbCAtZm9yY2U6JGZvcmNlIAoJCQkJCQkJCQkgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbnN0YWxsLVNQU29sdXRpb24gLUlkZW50aXR5ICRzb2x1dGlvbk5hbWUgLWFsbHdlYmFwcGxpY2F0aW9uIC1GdWxsVHJ1c3RCaW5EZXBsb3ltZW50OiRBbGxvd0Z1bGxUcnVzdEJpbkRlcGxveW1lbnQgLUdBQ0RlcGxveW1lbnQ6JEFsbG93R0FDRGVwbG95bWVudCAtZm9yY2U6JGZvcmNlIAoJCQkJCQkJCQkgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkJCQkJCQkJCUxvZyAtTWVzc2FnZSAiRG9uZSIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuU3VjY2VzcyAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFVybHMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHByZXZpb3VzIGRlcGxveW1lbnQgam9iIHRvIG90aGVyIFVSTCBpcyBzdGlsbCBydW5uaW5nLCB3YWl0IDUgc2VjcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBmaXggcHJvdmlkZWQgYnkgRWxpbyBTdHJ1eWYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAoIkRlcGxveWluZyB0byAnIiskXysiJy4uLiIpIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9OZXdsaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJFVybHMuQ291bnQgLWd0IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc29sdXRpb24gPSBHZXQtU1BTb2x1dGlvbiAtSWRlbnRpdHkgJHNvbHV0aW9uTmFtZSAtRXJyb3JBY3Rpb246U2lsZW50bHlDb250aW51ZQogCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dCA9ICREZWZhdWx0VGltZW91dCAqIDIKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoJHNvbHV0aW9uLkpvYkV4aXN0cykgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHRpbWVvdXQgLWxlIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIAkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiRmFpbGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRocm93ICJQcmV2aW91cyBkZXBsb3ltZW50IGpvYiBub3QgZmluaXNoZWQgYWZ0ZXIgIisgKCREZWZhdWx0VGltZW91dCAqIDIgLyAxMDAwKSArICIgc2Vjb25kcyIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgMgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgIC4gLU5vTmV3TGluZSAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0IC09IDIwMDAKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRTUFNELkluc3RhbGxlZFZlcnNpb24gLWVxIDE0KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbnN0YWxsLVNQU29sdXRpb24gLUlkZW50aXR5ICRzb2x1dGlvbk5hbWUgLXdlYmFwcGxpY2F0aW9uICRfIC1DQVNQb2xpY2llczokQWxsb3dDQVNQb2xpY2llcyAtR0FDRGVwbG95bWVudDokQWxsb3dHQUNEZXBsb3ltZW50IC1mb3JjZTokZm9yY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoJFNQU0QuSW5zdGFsbGVkVmVyc2lvbiAtZXEgMTUpewoJCQkJCQkJCQkJCWlmKCRjb21wTGV2ZWwpewoJCQkJCQkJCQkJCQlJbnN0YWxsLVNQU29sdXRpb24gLUlkZW50aXR5ICRzb2x1dGlvbk5hbWUgLXdlYmFwcGxpY2F0aW9uICRfIC1GdWxsVHJ1c3RCaW5EZXBsb3ltZW50OiRBbGxvd0Z1bGxUcnVzdEJpbkRlcGxveW1lbnQgLUdBQ0RlcGxveW1lbnQ6JEFsbG93R0FDRGVwbG95bWVudCAtQ29tcGF0aWJpbGl0eUxldmVsICRjb21wTGV2ZWwgLWZvcmNlOiRmb3JjZQoJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQllbHNlIHsKCQkJCQkJCQkJCQkJSW5zdGFsbC1TUFNvbHV0aW9uIC1JZGVudGl0eSAkc29sdXRpb25OYW1lIC13ZWJhcHBsaWNhdGlvbiAkXyAtRnVsbFRydXN0QmluRGVwbG95bWVudDokQWxsb3dGdWxsVHJ1c3RCaW5EZXBsb3ltZW50IC1HQUNEZXBsb3ltZW50OiRBbGxvd0dBQ0RlcGxveW1lbnQgLWZvcmNlOiRmb3JjZQoJCQkJCQkJCQkJCX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiRG9uZSIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuU3VjY2VzcyAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIkRlcGxveWluZyBnbG9iYWxseS4uLiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1Ob05ld0xpbmUKCQkJCQkJCQlpZiAoJFNQU0QuSW5zdGFsbGVkVmVyc2lvbiAtZXEgMTQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAlJbnN0YWxsLVNQU29sdXRpb24gLUlkZW50aXR5ICRzb2x1dGlvbk5hbWUgLUdBQ0RlcGxveW1lbnQ6JEFsbG93R0FDRGVwbG95bWVudCAtZm9yY2U6JGZvcmNlCgkJCQkJCQkJfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoJFNQU0QuSW5zdGFsbGVkVmVyc2lvbiAtZXEgMTUpewoJCQkJCQkJCQlpZigkY29tcExldmVsKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAJCUluc3RhbGwtU1BTb2x1dGlvbiAtSWRlbnRpdHkgJHNvbHV0aW9uTmFtZSAtR0FDRGVwbG95bWVudDokQWxsb3dHQUNEZXBsb3ltZW50IC1Db21wYXRpYmlsaXR5TGV2ZWwgJGNvbXBMZXZlbCAtZm9yY2U6JGZvcmNlCgkJCQkJCQkJCX0KCQkJCQkJCQkJZWxzZSB7CgkJCQkJCQkJCQlJbnN0YWxsLVNQU29sdXRpb24gLUlkZW50aXR5ICRzb2x1dGlvbk5hbWUgLUdBQ0RlcGxveW1lbnQ6JEFsbG93R0FDRGVwbG95bWVudCAtZm9yY2U6JGZvcmNlCgkJCQkJCQkJCX0KCQkJCQkJCQl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJEb25lIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5TdWNjZXNzIC1Ob0luZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdhaXRGb3JKb2JUb0ZpbmlzaCAkc29sdXRpb25OYW1lCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoRmFybVNvbHV0aW9uRGVwbG95ZWRTdWNjZXNzZnVsIC1zb2x1dGlvbk5hbWUgJHNvbHV0aW9uTmFtZSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAoIk1lc3NhZ2U6ICIgKyAkc29sdXRpb24uTGFzdE9wZXJhdGlvbkRldGFpbHMpIC1UeXBlICRTUFNELkxvZ1R5cGVzLldhcm5pbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRydW5Db3VudCAtZ3QgJERlcGxveW1lbnRSZXRyaWVzKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaHJvdyAoIkNvdWxkIG5vdCBkZXBsb3kgc29sdXRpb24gJyRzb2x1dGlvbk5hbWUnYG5NZXNzYWdlOiAiICsgJHNvbHV0aW9uLkxhc3RPcGVyYXRpb25EZXRhaWxzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXsgTG9nIC1NZXNzYWdlICJSZXRyeWluZyIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZpbmFsbHl7CiAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtbWVzc2FnZSAoIigiKyRlbGFwc2VkVGltZS5FbGFwc2VkKyAiKSIpIC10eXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbAogICAgICAgICAgICAgICAgICAgICAgICBMb2dPdXRkZW50CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICNlbmRyZWdpb24KCSAgICAgICAgI3JlZ2lvbiBEZXBsb3lTYW5kYm94ZWRTb2x1dGlvbgoJICAgICAgICAjIERlc2M6IERlcGxveXMgc2FuZGJveGVkIHNvbHV0aW9ucyB0byB0aGUgZ2l2ZW4gdXJscwoJICAgICAgICBGdW5jdGlvbiBEZXBsb3lTYW5kYm94ZWRTb2x1dGlvbihbU3lzdGVtLkNvbGxlY3Rpb25zLkhhc2h0YWJsZV0kc29sdXRpb25EZWZpbml0aW9uKXsKICAgICAgICAgICAgICAgICRlbGFwc2VkVGltZSA9IFtTeXN0ZW0uRGlhZ25vc3RpY3MuU3RvcHdhdGNoXTo6U3RhcnROZXcoKQoKICAgICAgICAgICAgICAgIGlmKCRzb2x1dGlvbkRlZmluaXRpb24pewogICAgICAgICAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgICAgICAgICAgJHNvbHV0aW9uTmFtZSA9ICRzb2x1dGlvbkRlZmluaXRpb25bIk5hbWUiXQogICAgICAgICAgICAgICAgICAgICAgICAkb3ZlcndyaXRlID0gJHNvbHV0aW9uRGVmaW5pdGlvblsiT3ZlcndyaXRlIl0KICAgICAgICAgICAgICAgICAgICAgICAgJFVybHMgPSAkc29sdXRpb25EZWZpbml0aW9uWyJVcmxzIl0gfCBHZXQtVW5pcXVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIAkgICAgICAgIExvZyAtTWVzc2FnZSAiJyRzb2x1dGlvbk5hbWUnIChzYW5kYm94ZWQgc29sdXRpb24pIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50CgkJCQkJCQoJCQkJCQkkcHJvY2Vzc1NvbHV0aW9uID0gKFByb2Nlc3NTb2x1dGlvbiAkdmFycyAkc29sdXRpb25OYW1lICRTUFNELkNvbW1hbmRzLkRlcGxveSAkdHJ1ZSkgLW9yICRmYWxzZQoJCQkJCQlpZigkcHJvY2Vzc1NvbHV0aW9uKXsKCQkJCQkJCUxvZyAtTWVzc2FnZSAiJyRzb2x1dGlvbk5hbWUnIChzYW5kYm94ZWQgc29sdXRpb24pIHNraXBwZWQgYnkgY3VzdG9tIHRhcmdldCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZwoJCQkJCQkJcmV0dXJuCgkJCQkJCX0KCQkJCQkJCiAgICAgICAgICAgICAgICAgICAgICAgICRVcmxzIHwgRm9yZWFjaC1vYmplY3R7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdXJsID0gJF8KCiAgICAgICAgICAgICAgIAkgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIkRlcGxveSB0byAnJHVybCciIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtSW5kZW50CiAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNvbHV0aW9uID0gR2V0LVNQVXNlclNvbHV0aW9uIC1JZGVudGl0eSAkc29sdXRpb25OYW1lIC1TaXRlICR1cmwgLUVycm9yQWN0aW9uOlNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNvbHV0aW9uIC1uZSAkbnVsbCAtYW5kICRvdmVyd3JpdGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlNhbmRib3hlZCBzb2x1dGlvbiBhbHJlYWR5IGV4aXN0IGFuZCBvdmVyd3JpdGluZyBzZXQgdG8gdHJ1ZSIgLVR5cGUgJFNQU0QuTG9nVHlwZXMud2FybmluZyAtSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzb2x1dGlvbkRlZmluaXRpb25SZXRyYWN0ID0gQHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAkc29sdXRpb25OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPdmVyd3JpdGUgPSRvdmVyd3JpdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVybHMgPSAkdXJsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmV0cmFjdFNhbmRib3hlZFNvbHV0aW9uIC1zb2x1dGlvbkRlZmluaXRpb24gJHNvbHV0aW9uRGVmaW5pdGlvblJldHJhY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nT3V0ZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKCRzb2x1dGlvbiAtbmUgJG51bGwpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlNhbmRib3hlZCBzb2x1dGlvbiBhbHJlYWR5IGV4aXN0IGFuZCBvdmVyd3JpdGUgaXMgc2V0IHRvIGZhbHNlLCAiIC1UeXBlICRTUFNELkxvZ1R5cGVzLldhcm5pbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJTa2lwcGluZyB0aGlzIHNvbHV0aW9uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5XYXJuaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc29sdXRpb24gPSBHZXQtU1BVc2VyU29sdXRpb24gLUlkZW50aXR5ICRzb2x1dGlvbk5hbWUgLVNpdGUgJHVybCAtRXJyb3JBY3Rpb246U2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc29sdXRpb24gLWVxICRudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBBZGRpbmcgVXNlciBTb2x1dGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIkFkZGluZyBzb2x1dGlvbi4uLiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1Ob05ld0xpbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkLVNQVXNlclNvbHV0aW9uIC1MaXRlcmFsUGF0aCAiJHNvbERpclwkc29sdXRpb25OYW1lIiAtU2l0ZSAkdXJsIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNvbHV0aW9uID0gR2V0LVNQVXNlclNvbHV0aW9uIC1JZGVudGl0eSAkc29sdXRpb25OYW1lIC1TaXRlICR1cmwgLUVycm9yQWN0aW9uOlNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHNvbHV0aW9uKXsgTG9nIC1NZXNzYWdlICJPayIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuU3VjY2VzcyAtTm9JbmRlbnQgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNleyBMb2cgLU1lc3NhZ2UgIkZhaWxlZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuRXJyb3IgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRocm93ICJTYW5kYm94ZWQgc29sdXRpb24gJyRzb2x1dGlvbk5hbWUnIGNvdWxkIG5vdCBiZSBhZGRlZCB0byAkdXJsIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIERlcGxveWluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcnVuQ291bnQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdoaWxlKCRydW5Db3VudCAtbGUgJERlcGxveW1lbnRSZXRyaWVzKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRydW5Db3VudCsrCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJEZXBsb3lpbmcuLi4iIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9OZXdMaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbnN0YWxsLVNQVXNlclNvbHV0aW9uIC1JZGVudGl0eSAkc29sdXRpb25OYW1lIC1TaXRlICR1cmwgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJEb25lIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5TdWNjZXNzIC1Ob0luZGVudAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdhaXRGb3JKb2JUb0ZpbmlzaCAkc29sdXRpb25OYW1lIC1TaXRlICR1cmwKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihTYW5kYm94ZWRTb2x1dGlvbkRlcGxveWVkU3VjY2Vzc2Z1bCAtc29sdXRpb25OYW1lICRzb2x1dGlvbk5hbWUgLVNpdGUgJHVybCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcnVuQ291bnQgLWd0ICREZXBsb3ltZW50UmV0cmllcyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhyb3cgIkNvdWxkIG5vdCBkZXBsb3kgc2FuZGJveGVkIHNvbHV0aW9uICckc29sdXRpb25OYW1lJyB0byAnJHVybCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2V7IExvZyAtTWVzc2FnZSAiUmV0cnlpbmciIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsbHl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nT3V0ZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZpbmFsbHl7CiAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtbWVzc2FnZSAoIigiKyRlbGFwc2VkVGltZS5FbGFwc2VkKyAiKSIpIC10eXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbAogICAgICAgICAgICAgICAgICAgICAgICBMb2dPdXRkZW50CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoJICAgICAgICB9CiAgICAgICAgICAgICNlbmRyZWdpb24KICAgICAgICAjZW5kcmVnaW9uCiAgICAgICAgI3JlZ2lvbiBEZXBsb3ltZW50LkNvbW1hbmRzLlVwZGF0ZQoJICAgICAgICAjcmVnaW9uIFVwZGF0ZQoJICAgICAgICAjIERlc2M6IFVwZGF0ZXMgYWxsIGNvbmZpZ3VyZWQgc29sdXRpb25zIGFuZCBwZXJmb3JtcyBwcmUgYW5kIHBvc3QgdXBkYXRlIGN1c3RvbSBjb2RlCgkgICAgICAgIEZ1bmN0aW9uIFVwZGF0ZSgpewogICAgICAgICAgICAgICAgJHVwZGF0ZUVsYXBzZWRUaW1lID0gW1N5c3RlbS5EaWFnbm9zdGljcy5TdG9wd2F0Y2hdOjpTdGFydE5ldygpCgkgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIkJlZ2luIHNvbHV0aW9uIHVwZGF0ZSIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBFeGVjdXRlLUV4dGVuc2lvbnMgJGV2ZW50cy5CZWZvcmVVcGRhdGUKCiAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIkJlZ2luIGN1c3RvbSBCZWZvcmVVcGRhdGUgdGFyZ2V0IiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50CgkgICAgICAgICAgICBCZWZvcmVVcGRhdGUgJHZhcnMKCSAgICAgICAgICAgIExvZ091dGRlbnQKCSAgICAgICAgCgkgICAgICAgICAgICBpZigkRGVwbG95bWVudFR5cGUgLW5lICRTUFNELkRlcGxveW1lbnRUeXBlcy5FeHRlbnNpb25zKXsKCSAgICAgICAgICAgICAgICBVcGRhdGVTb2x1dGlvbnMKCSAgICAgICAgICAgICAgICBSdW5BY3Rpb25zIC1hY3Rpb25DbWQgJFNQU0QuQ29tbWFuZHMuVXBncmFkZSAtc2tpcFdhcm11cAoJICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEV4ZWN1dGUtRXh0ZW5zaW9ucyAkZXZlbnRzLkFmdGVyVXBkYXRlCgogICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJCZWdpbiBjdXN0b20gQWZ0ZXJVcGRhdGUgdGFyZ2V0IiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50CgkgICAgICAgICAgICBBZnRlclVwZGF0ZSAkdmFycwogICAgICAgICAgICAgICAgTG9nT3V0ZGVudAogICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgICBSdW5BY3Rpb25zIC1hY3Rpb25DbWQgJFNQU0QuQ29tbWFuZHMuVXBkYXRlIC1vbmx5V2FybXVwCgkgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgKCJTb2x1dGlvbiB1cGRhdGUgZmluaXNoZWQgKCIrJHVwZGF0ZUVsYXBzZWRUaW1lLkVsYXBzZWQrICIpIikgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLU91dGRlbnQKCSAgICAgICAgfQogICAgICAgICAgICAjZW5kcmVnaW9uCgkgICAgICAgICNyZWdpb24gVXBkYXRlU29sdXRpb25zCgkgICAgICAgICMgRGVzYzogVXBkYXRlcyB0aGUgc29sdXRpb25zCgkgICAgICAgIEZ1bmN0aW9uIFVwZGF0ZVNvbHV0aW9ucygpewogICAgICAgICAgICAgICAkc29sdXRpb25zID0gR2V0U29sdXRpb25zCiAgICAgICAgICAgICAgIENoZWNrSWZTb2x1dGlvbkZpbGVzRXhpc3QgLXNvbHV0aW9ucyAkc29sdXRpb25zCiAgICAgICAgICAgICAgIENoZWNrSWZVcmxzRXhpc3RzIC1zb2x1dGlvbnMgJHNvbHV0aW9ucwogICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlVwZGF0aW5nOiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudAogICAgICAgICAgICAgICAkc29sdXRpb25zLkZhcm1Tb2x1dGlvbnMuVmFsdWVzIHwgRm9yRWFjaC1PYmplY3R7IFVwZGF0ZUZhcm1Tb2x1dGlvbnMgLXNvbHV0aW9uICRffQogICAgICAgICAgICAgICAkc29sdXRpb25zLlNpdGVTb2x1dGlvbnMuVmFsdWVzIHwgRm9yRWFjaC1PYmplY3R7IFVwZGF0ZVNhbmRib3hlZFNvbHV0aW9ucyAtc29sdXRpb24gJF8gfQogICAgICAgICAgICAgICBMb2dPdXRkZW50CgkgICAgICAgIH0KICAgICAgICAgICAgI2VuZHJlZ2lvbgoJICAgICAgICAjcmVnaW9uIFVwZGF0ZUZhcm1Tb2x1dGlvbnMKCSAgICAgICAgIyBEZXNjOiBVcGRhdGVzIGZhcm0gc29sdXRpb25zIGVpdGhlciB0byBHQUMgb3IgdG8gV2ViQXBwbGljYXRpb24gdXJscwoJICAgICAgICBGdW5jdGlvbiBVcGRhdGVGYXJtU29sdXRpb25zKFtTeXN0ZW0uQ29sbGVjdGlvbnMuSGFzaHRhYmxlXSRzb2x1dGlvbkRlZmluaXRpb24pewogICAgICAgICAgICAgICAgJGVsYXBzZWRUaW1lID0gW1N5c3RlbS5EaWFnbm9zdGljcy5TdG9wd2F0Y2hdOjpTdGFydE5ldygpCiAgICAgICAgICAgICAgICBpZigkc29sdXRpb25EZWZpbml0aW9uKXsKICAgICAgICAgICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAgICAgICAgICRzb2x1dGlvbk5hbWUgPSAkc29sdXRpb25EZWZpbml0aW9uWyJOYW1lIl0KICAgICAgICAgICAgICAgICAgICAgICAgJGZvcmNlID0gJHNvbHV0aW9uRGVmaW5pdGlvblsiRm9yY2UiXQogICAgICAgICAgICAgICAgICAgICAgICAkb3ZlcndyaXRlID0gJHNvbHV0aW9uRGVmaW5pdGlvblsiT3ZlcndyaXRlIl0KCiAgICAgICAgICAgIAkgICAgICAgIExvZyAtTWVzc2FnZSAiJyRzb2x1dGlvbk5hbWUnIChmYXJtIHNvbHV0aW9uKSIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudAoKCQkJCQkJJHByb2Nlc3NTb2x1dGlvbiA9IChQcm9jZXNzU29sdXRpb24gJHZhcnMgJHNvbHV0aW9uTmFtZSAkU1BTRC5Db21tYW5kcy5VcGRhdGUgJGZhbHNlKSAtb3IgJGZhbHNlCgkJCQkJCWlmKCRwcm9jZXNzU29sdXRpb24pewoJCQkJCQkJTG9nIC1NZXNzYWdlICInJHNvbHV0aW9uTmFtZScgKGZhcm0gc29sdXRpb24pIHNraXBwZWQgYnkgY3VzdG9tIHRhcmdldCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZwoJCQkJCQkJcmV0dXJuCgkJCQkJCX0KCQkJCQkJCiAgICAgICAgICAgICAgICAgICAgICAgICRzb2x1dGlvbiA9IEdldC1TUFNvbHV0aW9uIC1JZGVudGl0eSAkc29sdXRpb25OYW1lIC1FcnJvckFjdGlvbjpTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc29sdXRpb24gLWVxICRudWxsKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlNvbHV0aW9uIGRvZXMgbm90IGV4aXN0LCBkZXBsb3lpbmcgaW5zdGVhZCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMud2FybmluZyAtSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZXBsb3lGYXJtU29sdXRpb24gLXNvbHV0aW9uRGVmaW5pdGlvbiAkc29sdXRpb25EZWZpbml0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dPdXRkZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgIyBVcGRhdGluZwogICAgICAgICAgICAgICAgICAgICAgICAkcnVuQ291bnQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIFdoaWxlKCRydW5Db3VudCAtbGUgJERlcGxveW1lbnRSZXRyaWVzKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRydW5Db3VudCsrCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJVcGRhdGluZy4uLiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1Ob05ld2xpbmUKCQkJCQkJCWlmICgkU1BTRC5JbnN0YWxsZWRWZXJzaW9uIC1lcSAxNCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAJVXBkYXRlLVNQU29sdXRpb24gLUxpdGVyYWxQYXRoICIkc29sRGlyXCRzb2x1dGlvbk5hbWUiIC1JZGVudGl0eSAkc29sdXRpb25OYW1lIC1DQVNQb2xpY2llczokQWxsb3dDQVNQb2xpY2llcyAtR0FDRGVwbG95bWVudDokQWxsb3dHQUNEZXBsb3ltZW50IC1mb3JjZTokZm9yY2UgLUNvbmZpcm06JGZhbHNlCgkJCQkJCQl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKCRTUFNELkluc3RhbGxlZFZlcnNpb24gLWVxIDE1KXsKCQkJCQkJCQlpZigkc29sdXRpb24uQ29udGFpbnNXZWJBcHBsaWNhdGlvblJlc291cmNlKXsKCQkJCQkJCQkJVXBkYXRlLVNQU29sdXRpb24gLUxpdGVyYWxQYXRoICIkc29sRGlyXCRzb2x1dGlvbk5hbWUiIC1JZGVudGl0eSAkc29sdXRpb25OYW1lIC1GdWxsVHJ1c3RCaW5EZXBsb3ltZW50OiRBbGxvd0Z1bGxUcnVzdEJpbkRlcGxveW1lbnQgLUdBQ0RlcGxveW1lbnQ6JEFsbG93R0FDRGVwbG95bWVudCAtZm9yY2U6JGZvcmNlIC1Db25maXJtOiRmYWxzZQoJCQkJCQkJCX0KCQkJCQkJCQllbHNlewoJCQkJCQkJCQlVcGRhdGUtU1BTb2x1dGlvbiAtTGl0ZXJhbFBhdGggIiRzb2xEaXJcJHNvbHV0aW9uTmFtZSIgLUlkZW50aXR5ICRzb2x1dGlvbk5hbWUgLUdBQ0RlcGxveW1lbnQ6JEFsbG93R0FDRGVwbG95bWVudCAtZm9yY2U6JGZvcmNlIC1Db25maXJtOiRmYWxzZQoJCQkJCQkJCX0KCQkJCQkJCX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiRG9uZSIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuU3VjY2VzcyAtTm9JbmRlbnQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXYWl0Rm9ySm9iVG9GaW5pc2ggJHNvbHV0aW9uTmFtZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKEZhcm1Tb2x1dGlvbkRlcGxveWVkU3VjY2Vzc2Z1bCAtc29sdXRpb25OYW1lICRzb2x1dGlvbk5hbWUpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgKCJNZXNzYWdlOiAiICsgJHNvbHV0aW9uLkxhc3RPcGVyYXRpb25EZXRhaWxzKSAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5XYXJuaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcnVuQ291bnQgLWd0ICREZXBsb3ltZW50UmV0cmllcyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhyb3cgKCJDb3VsZCBub3QgdXBkYXRlIHNvbHV0aW9uICckc29sdXRpb25OYW1lJ2BuTWVzc2FnZTogIiArICRzb2x1dGlvbi5MYXN0T3BlcmF0aW9uRGV0YWlscykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2V7IExvZyAtTWVzc2FnZSAiUmV0cnlpbmciIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmaW5hbGx5ewogICAgICAgICAgICAgICAgICAgICAgICBMb2cgLW1lc3NhZ2UgKCIoIiskZWxhcHNlZFRpbWUuRWxhcHNlZCsgIikiKSAtdHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwKICAgICAgICAgICAgICAgICAgICAgICAgTG9nT3V0ZGVudAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCSAgICAgICAgfQogICAgICAgICAgICAjZW5kcmVnaW9uCgkgICAgICAgICNyZWdpb24gVXBkYXRlU2FuZGJveGVkU29sdXRpb25zCgkgICAgICAgICMgRGVzYzogVXBkYXRlcyBzYW5kYm94ZWQgc29sdXRpb25zIHRvIHRoZSBnaXZlbiB1cmxzLCByZW5hbWVzIHRoZSB0YXJnZXQgc29sdXRpb24gd2l0aCB0aGUgY3VycmVudCBkYXRlCiAgICAgICAgICAgICMgICAgICAgdXBkYXRlcyB0aGUgY3VycmVudGx5IGFjdGl2YXRlZCBzb2x1dGlvbiB3aXRoIHRoZSBzYW1lIG5hbWUKCSAgICAgICAgRnVuY3Rpb24gVXBkYXRlU2FuZGJveGVkU29sdXRpb25zKFtTeXN0ZW0uQ29sbGVjdGlvbnMuSGFzaHRhYmxlXSRzb2x1dGlvbkRlZmluaXRpb24pewogICAgICAgICAgICAgICAgJGVsYXBzZWRUaW1lID0gW1N5c3RlbS5EaWFnbm9zdGljcy5TdG9wd2F0Y2hdOjpTdGFydE5ldygpCiAgICAgICAgICAgICAgICBpZigkc29sdXRpb25EZWZpbml0aW9uKXsKICAgICAgICAgICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAgICAgICAgICRzb2x1dGlvbk5hbWUgPSAkc29sdXRpb25EZWZpbml0aW9uWyJOYW1lIl0KICAgICAgICAgICAgICAgICAgICAgICAgJG92ZXJ3cml0ZSA9ICRzb2x1dGlvbkRlZmluaXRpb25bIk92ZXJ3cml0ZSJdCiAgICAgICAgICAgICAgICAgICAgICAgICRVcmxzID0gJHNvbHV0aW9uRGVmaW5pdGlvblsiVXJscyJdIHwgR2V0LVVuaXF1ZQoKCQkJCQkJCiAgICAgICAgICAgIAkgICAgICAgIExvZyAtTWVzc2FnZSAiJyRzb2x1dGlvbk5hbWUnIChzYW5kYm94ZWQgc29sdXRpb24pIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50CgkJCQkJCQoJCQkJCQkkcHJvY2Vzc1NvbHV0aW9uID0gKFByb2Nlc3NTb2x1dGlvbiAkdmFycyAkc29sdXRpb25OYW1lICRTUFNELkNvbW1hbmRzLlVwZGF0ZSAkdHJ1ZSkgLW9yICRmYWxzZQoJCQkJCQlpZigkcHJvY2Vzc1NvbHV0aW9uKXsKCQkJCQkJCUxvZyAtTWVzc2FnZSAiJyRzb2x1dGlvbk5hbWUnIChzYW5kYm94ZWQgc29sdXRpb24pIHNraXBwZWQgYnkgY3VzdG9tIHRhcmdldCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZwoJCQkJCQkJcmV0dXJuCgkJCQkJCX0KCQkJCQkJCiAgICAgICAgICAgICAgICAgICAgICAgICRVcmxzIHwgRm9yZWFjaC1vYmplY3R7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdXJsID0gJF8KCiAgICAgICAgICAgICAgIAkgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlVwZGF0ZSB0byAnJHVybCciIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGdldCB0aGUgZmlyc3QgYWN0aXZhdGVkICghKSBzb2x1dGlvbiBvZiB0aGF0IG5hbWUgKHRoZXJlIHNob3VsZCBiZSBvbmx5IG9uZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc29sdXRpb25zID0gKChHZXQtU1BVc2VyU29sdXRpb24gLVNpdGUgJHVybCkgfCBXaGVyZS1PYmplY3QgeyRfLk5hbWUgLWltYXRjaCAkc29sdXRpb25OYW1lIC1hbmQgJF8uU3RhdHVzIC1lcSBbTWljcm9zb2Z0LlNoYXJlUG9pbnQuU1BVc2VyU29sdXRpb25TdGF0dXNdOjpBY3RpdmF0ZWR9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc29sdXRpb25zIC1lcSAkbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiQWN0aXZhdGVkIHNhbmRib3hlZCBkb2VzIG5vdCBleGlzdCwgZGVwbG95aW5nIGluc3RlYWQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLndhcm5pbmcgLUluZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZXBsb3lTYW5kYm94ZWRTb2x1dGlvbiAtc29sdXRpb25EZWZpbml0aW9uICRzb2x1dGlvbkRlZmluaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nT3V0ZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQWRkaW5nIFVzZXIgU29sdXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJBZGRpbmcgc29sdXRpb24uLi4iIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9OZXdMaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuZXdTb2x1dGlvbk5hbWUgPSAiJExvZ1RpbWUtIitbU3lzdGVtLklPLlBhdGhdOjpHZXRGaWxlTmFtZVdpdGhvdXRFeHRlbnNpb24oIiRzb2xEaXJcJHNvbHV0aW9uTmFtZSIpKyIud3NwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3B5LUl0ZW0gLUxpdGVyYWxQYXRoICIkc29sRGlyXCRzb2x1dGlvbk5hbWUiIC1EZXN0aW5hdGlvbiAiJHNvbERpclwkbmV3U29sdXRpb25OYW1lIiAtRm9yY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkLVNQVXNlclNvbHV0aW9uIC1MaXRlcmFsUGF0aCAiJHNvbERpclwkbmV3U29sdXRpb25OYW1lIiAtU2l0ZSAkdXJsIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG5ld1NvbHV0aW9uID0gR2V0LVNQVXNlclNvbHV0aW9uIC1JZGVudGl0eSAiJG5ld1NvbHV0aW9uTmFtZSIgLVNpdGUgJHVybCAtRXJyb3JBY3Rpb246U2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkbmV3U29sdXRpb24peyBMb2cgLU1lc3NhZ2UgIk9rIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5TdWNjZXNzIC1Ob0luZGVudCB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2V7IExvZyAtTWVzc2FnZSAiRmFpbGVkIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5FcnJvciAtTm9JbmRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhyb3cgIlNhbmRib3hlZCBzb2x1dGlvbiAnJG5ld1NvbHV0aW9uJyBjb3VsZCBub3QgYmUgYWRkZWQgdG8gJHVybCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZW1vdmUtSXRlbSAtUGF0aCAiJHNvbERpclwkbmV3U29sdXRpb25OYW1lIiAtRm9yY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBVcGRhdGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcnVuQ291bnQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzb2x1dGlvbiA9ICRzb2x1dGlvbnNbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9sZFNvbHV0aW9uTmFtZSA9ICRzb2x1dGlvbi5OYW1lICMgdXNlIHJlYWxuYW1lIG9mIHNvbHV0aW9uIHRvIHVwZGF0ZSBmcm9tIG5vdyBvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXaGlsZSgkcnVuQ291bnQgLWxlICREZXBsb3ltZW50UmV0cmllcyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcnVuQ291bnQrKwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiVXBkYXRpbmcgJyRvbGRTb2x1dGlvbk5hbWUnIHRvICckbmV3U29sdXRpb25OYW1lJy4uLiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1Ob05ld2xpbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVwZGF0ZS1TUFVzZXJTb2x1dGlvbiAtSWRlbnRpdHkgJHNvbHV0aW9uIC1Ub1NvbHV0aW9uICRuZXdTb2x1dGlvbk5hbWUgLVNpdGUgJHVybCAtQ29uZmlybTokZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiRG9uZSIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuU3VjY2VzcyAtTm9JbmRlbnQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXYWl0Rm9ySm9iVG9GaW5pc2ggJG5ld1NvbHV0aW9uTmFtZSAtU2l0ZSAkdXJsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoU2FuZGJveGVkU29sdXRpb25EZXBsb3llZFN1Y2Nlc3NmdWwgLXNvbHV0aW9uTmFtZSAkbmV3U29sdXRpb25OYW1lIC1TaXRlICR1cmwpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHJ1bkNvdW50IC1ndCAkRGVwbG95bWVudFJldHJpZXMpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRocm93ICJDb3VsZCBub3QgdXBkYXRlIHNhbmRib3hlZCBzb2x1dGlvbiAnJG9sZFNvbHV0aW9uTmFtZScgYXQgKiR1cmwnIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXsgTG9nIC1NZXNzYWdlICJSZXRyeWluZyIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsbHl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nT3V0ZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZpbmFsbHl7CiAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtbWVzc2FnZSAoIigiKyRlbGFwc2VkVGltZS5FbGFwc2VkKyAiKSIpIC10eXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbAogICAgICAgICAgICAgICAgICAgICAgICBMb2dPdXRkZW50CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoJICAgICAgICB9CiAgICAgICAgICAgICNlbmRyZWdpb24KICAgICAgICAjZW5kcmVnaW9uCiAgICAgICAgI3JlZ2lvbiBEZXBsb3ltZW50LkNvbW1hbmRzLlJldHJhY3QKCSAgICAgICAgI3JlZ2lvbiBSZXRyYWN0CgkgICAgICAgICMgRGVzYzogUmV0cmFjdHMgYWxsIGNvbmZpZ3VyZWQgc29sdXRpb25zIGFuZCBwZXJmb3JtcyBwcmUgYW5kIHBvc3QgcmV0cmFjdGlvbiBjdXN0b20gY29kZQoJICAgICAgICBGdW5jdGlvbiBSZXRyYWN0KCl7CiAgICAgICAgICAgICAgICAkcmV0cmFjdEVsYXBzZWRUaW1lID0gW1N5c3RlbS5EaWFnbm9zdGljcy5TdG9wd2F0Y2hdOjpTdGFydE5ldygpCgkgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIkJlZ2luIHNvbHV0aW9uIHJldHJhY3Rpb24iIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQKCiAgICAgICAgICAgICAgICBFeGVjdXRlLUV4dGVuc2lvbnMgJGV2ZW50cy5CZWZvcmVSZXRyYWN0CgogICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJCZWdpbiBjdXN0b20gQmVmb3JlUmV0cmFjdCB0YXJnZXQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQKCSAgICAgICAgICAgIEJlZm9yZVJldHJhY3QgJHZhcnMKCSAgICAgICAgICAgIExvZ091dGRlbnQKCSAgICAgICAgCgkgICAgICAgICAgICBpZigkRGVwbG95bWVudFR5cGUgLW5lICRTUFNELkRlcGxveW1lbnRUeXBlcy5FeHRlbnNpb25zKXsKCSAgICAgICAgICAgICAgICBSZXRyYWN0U29sdXRpb25zCgkgICAgICAgICAgICAgICAgUnVuQWN0aW9ucyAtYWN0aW9uQ21kICRTUFNELkNvbW1hbmRzLlJldHJhY3QgLXNraXBXYXJtdXAKCSAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBFeGVjdXRlLUV4dGVuc2lvbnMgJGV2ZW50cy5BZnRlclJldHJhY3QKCiAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIkJlZ2luIGN1c3RvbSBBZnRlclJldHJhY3QgdGFyZ2V0IiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtSW5kZW50CgkgICAgICAgICAgICBBZnRlclJldHJhY3QgJHZhcnMKCgoJICAgICAgICAgICAgTG9nT3V0ZGVudAoJICAgICAgICAgICAgTG9nIC1NZXNzYWdlICgiU29sdXRpb24gcmV0cmFjdGlvbiBmaW5pc2hlZCgiKyRyZXRyYWN0RWxhcHNlZFRpbWUuRWxhcHNlZCsgIikiKSAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiAtT3V0ZGVudAoJICAgICAgICB9CiAgICAgICAgICAgICNlbmRyZWdpb24KCSAgICAgICAgI3JlZ2lvbiBSZXRyYWN0U29sdXRpb25zCgkgICAgICAgICMgRGVzYzogUmV0cmFjdHMgdGhlIHNvbHV0aW9ucwoJICAgICAgICBGdW5jdGlvbiBSZXRyYWN0U29sdXRpb25zKCl7CiAgICAgICAgICAgICAgICRzb2x1dGlvbnMgPSBHZXRTb2x1dGlvbnMKICAgICAgICAgICAgICAgIyBleGlzdGFuY2Ugb2YgZmlsZXMgaW4gL1NvbHV0aW9ucyBmb2xkZXIgbm90IG5lY2Nlc2FyeSBvbiByZXRyYWN0aW9uCgogICAgICAgICAgICAgICBDaGVja0lmVXJsc0V4aXN0cyAtc29sdXRpb25zICRzb2x1dGlvbnMKICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJSZXRyYWN0aW5nOiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudAogICAgICAgICAgICAgICAkc29sdXRpb25zLkZhcm1Tb2x1dGlvbnMuVmFsdWVzIHwgRm9yRWFjaC1PYmplY3R7IFJldHJhY3RGYXJtU29sdXRpb24gLXNvbHV0aW9uICRffQogICAgICAgICAgICAgICAkc29sdXRpb25zLlNpdGVTb2x1dGlvbnMuVmFsdWVzIHwgRm9yRWFjaC1PYmplY3R7IFJldHJhY3RTYW5kYm94ZWRTb2x1dGlvbiAtc29sdXRpb24gJF8gfQogICAgICAgICAgICAgICBMb2dPdXRkZW50CgoJICAgICAgICB9CiAgICAgICAgICAgICNlbmRyZWdpb24KCSAgICAgICAgI3JlZ2lvbiBSZXRyYWN0RmFybVNvbHV0aW9uCgkgICAgICAgICMgRGVzYzogUmV0cmFjdHMgZmFybSBzb2x1dGlvbnMgZnJvbSBlaXRoZXIgR0FDIG9yIFdlYkFwcGxpY2F0aW9uIHVybHMKCSAgICAgICAgRnVuY3Rpb24gUmV0cmFjdEZhcm1Tb2x1dGlvbihbU3lzdGVtLkNvbGxlY3Rpb25zLkhhc2h0YWJsZV0kc29sdXRpb25EZWZpbml0aW9uKXsKICAgICAgICAgICAgICAgICRlbGFwc2VkVGltZSA9IFtTeXN0ZW0uRGlhZ25vc3RpY3MuU3RvcHdhdGNoXTo6U3RhcnROZXcoKQogICAgICAgICAgICAgICAgaWYoJHNvbHV0aW9uRGVmaW5pdGlvbil7CiAgICAgICAgICAgICAgICAgICAgdHJ5ewogICAgICAgICAgICAgICAgICAgICAgICAkc29sdXRpb25OYW1lID0gJHNvbHV0aW9uRGVmaW5pdGlvblsiTmFtZSJdCiAgICAgICAgICAgICAgICAgICAgICAgICRmb3JjZSA9ICRzb2x1dGlvbkRlZmluaXRpb25bIkZvcmNlIl0KCiAgICAgICAgICAgIAkgICAgICAgIExvZyAtTWVzc2FnZSAiJyRzb2x1dGlvbk5hbWUnIChmYXJtIHNvbHV0aW9uKSIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gLUluZGVudAoKCQkJCQkJJHByb2Nlc3NTb2x1dGlvbiA9IChQcm9jZXNzU29sdXRpb24gJHZhcnMgJHNvbHV0aW9uTmFtZSAkU1BTRC5Db21tYW5kcy5SZXRyYWN0ICRmYWxzZSkgLW9yICRmYWxzZQoJCQkJCQlpZigkcHJvY2Vzc1NvbHV0aW9uKXsKCQkJCQkJCUxvZyAtTWVzc2FnZSAiJyRzb2x1dGlvbk5hbWUnIChmYXJtIHNvbHV0aW9uKSBza2lwcGVkIGJ5IGN1c3RvbSB0YXJnZXQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLldhcm5pbmcKCQkJCQkJCXJldHVybgoJCQkJCQl9CgkJCQkJCQogICAgICAgICAgICAgICAgICAgICAgICAkc29sdXRpb24gPSBHZXQtU1BTb2x1dGlvbiAtSWRlbnRpdHkgJHNvbHV0aW9uTmFtZSAtRXJyb3JBY3Rpb246U2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNvbHV0aW9uIC1lcSAkbnVsbCAtYW5kICRvdmVyd3JpdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiU29sdXRpb24gaXMgbm90IGluc3RhbGxlZCwgc2tpcHBpbmcgcmV0cmFjdGlvbiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgIyBSZXRyYWN0aW5nCiAgICAgICAgICAgICAgICAgICAgICAgICRydW5Db3VudCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgV2hpbGUoJHJ1bkNvdW50IC1sZSAkRGVwbG95bWVudFJldHJpZXMpewogCQkgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0ID0gJERlZmF1bHRUaW1lb3V0ICogMgoJCSAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCRzb2x1dGlvbi5Kb2JFeGlzdHMpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkdGltZW91dCAtbGUgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRocm93ICJQcmV2aW91cyBkZXBsb3ltZW50IGpvYiBub3QgZmluaXNoZWQgYWZ0ZXIgIisgKCREZWZhdWx0VGltZW91dCAqIDIgLyAxMDAwKSArICIgc2Vjb25kcyIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzIDIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dCAtPSAyMDAwCgkJICAgICAgICAgICAgICAgICAgICB9CgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRydW5Db3VudCsrCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHNvbHV0aW9uLkRlcGxveWVkKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlJldHJhY3RpbmcuLi4iIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9OZXdsaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzb2x1dGlvbi5Db250YWluc1dlYkFwcGxpY2F0aW9uUmVzb3VyY2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewoKCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNhVXJsID0gKEdldC1zcHdlYmFwcGxpY2F0aW9uIC1pbmNsdWRlY2VudHJhbGFkbWluaXN0cmF0aW9uIHwgd2hlcmUgeyRfLklzQWRtaW5pc3RyYXRpb25XZWJBcHBsaWNhdGlvbn0pLlVybAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoKCRzb2x1dGlvbi5EZXBsb3llZFdlYkFwcGxpY2F0aW9ucyB8ID8geyAkXy5VcmwgLWVxICRjYVVybH0pIC1uZSAkbnVsbCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFNvbHV0aW9uIGFsc28gZGVwbG95ZWQgdG8gY2VudHJhbCBhZG1pbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcmVtb3ZlIHRoZXJlIGZpcnN0IGFzIHRoaXMgaXMgbm90IGRvbmUgd2l0aCB0aGUgLWFsbHdlYmFwcGxpY2F0aW9uIHN3aXRjaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVW5pbnN0YWxsLVNQU29sdXRpb24gLUlkZW50aXR5ICRzb2x1dGlvbk5hbWUgLVdlYkFwcGxpY2F0aW9uICRjYVVybCAtQ29uZmlybTokZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiRG9uZSAoQ2VudHJhbCBBZG1pbikiIC1UeXBlICRTUFNELkxvZ1R5cGVzLlN1Y2Nlc3MgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXYWl0Rm9ySm9iVG9GaW5pc2ggJHNvbHV0aW9uTmFtZSAtUmV0cmFjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJSZXRyYWN0aW5nIChhbGwgb3RoZXIgd2ViIGFwcGxpY2F0aW9ucykuLi4iIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtTm9OZXdsaW5lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVbmluc3RhbGwtU1BTb2x1dGlvbiAtSWRlbnRpdHkgJHNvbHV0aW9uTmFtZSAtYWxsd2ViYXBwbGljYXRpb24gLUNvbmZpcm06JGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVbmluc3RhbGwtU1BTb2x1dGlvbiAtaWRlbnRpdHkgJHNvbHV0aW9uTmFtZSAtY29uZmlybTokZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJEb25lIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5TdWNjZXNzIC1Ob0luZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgV2FpdEZvckpvYlRvRmluaXNoICRzb2x1dGlvbk5hbWUgLVJldHJhY3QKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFJlbW92aW5nIFNvbHV0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlJlbW92aW5nIHNvbHV0aW9uLi4uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vTmV3TGluZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVtb3ZlLVNQU29sdXRpb24gLUlkZW50aXR5ICRzb2x1dGlvbk5hbWUgLUNvbmZpcm06JGZhbHNlIC1FcnJvckFjdGlvbjpTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIk9rIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5TdWNjZXNzIC1Ob0luZGVudAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKEZhcm1Tb2x1dGlvblJldHJhY3RlZFN1Y2Nlc3NmdWwgLXNvbHV0aW9uTmFtZSAkc29sdXRpb25OYW1lKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRydW5Db3VudCAtZ3QgJERlcGxveW1lbnRSZXRyaWVzKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaHJvdyAoIkNvdWxkIG5vdCByZXRyYWN0IHNvbHV0aW9uICckc29sdXRpb25OYW1lJyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNleyBMb2cgLU1lc3NhZ2UgIlJldHJ5aW5nIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5JbmZvcm1hdGlvbiB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZmluYWxseXsKICAgICAgICAgICAgICAgICAgICAgICAgTG9nIC1tZXNzYWdlICgiKCIrJGVsYXBzZWRUaW1lLkVsYXBzZWQrICIpIikgLXR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsCiAgICAgICAgICAgICAgICAgICAgICAgIExvZ091dGRlbnQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgkgICAgICAgIH0KICAgICAgICAgICAgI2VuZHJlZ2lvbgoJICAgICAgICAjcmVnaW9uIFJldHJhY3RTYW5kYm94ZWRTb2x1dGlvbgoJICAgICAgICAjIERlc2M6IFJldHJhY3RzIHNhbmRib3hlZCBzb2x1dGlvbnMgdG8gdGhlIGdpdmVuIHVybHMKCSAgICAgICAgRnVuY3Rpb24gUmV0cmFjdFNhbmRib3hlZFNvbHV0aW9uKFtTeXN0ZW0uQ29sbGVjdGlvbnMuSGFzaHRhYmxlXSRzb2x1dGlvbkRlZmluaXRpb24pewogICAgICAgICAgICAgICAgJGVsYXBzZWRUaW1lID0gW1N5c3RlbS5EaWFnbm9zdGljcy5TdG9wd2F0Y2hdOjpTdGFydE5ldygpCiAgICAgICAgICAgICAgICBpZigkc29sdXRpb25EZWZpbml0aW9uKXsKICAgICAgICAgICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAgICAgICAgICRzb2x1dGlvbk5hbWUgPSAkc29sdXRpb25EZWZpbml0aW9uWyJOYW1lIl0KICAgICAgICAgICAgICAgICAgICAgICAgJGZvcmNlID0gJHNvbHV0aW9uRGVmaW5pdGlvblsiRm9yY2UiXQogICAgICAgICAgICAgICAgICAgICAgICAkVXJscyA9ICRzb2x1dGlvbkRlZmluaXRpb25bIlVybHMiXSB8IEdldC1VbmlxdWUKICAgICAgICAgICAgCSAgICAgICAgTG9nIC1NZXNzYWdlICInJHNvbHV0aW9uTmFtZScgKHNhbmRib3hlZCBzb2x1dGlvbikiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQKCQkJCQkJCgkJCQkJCSRwcm9jZXNzU29sdXRpb24gPSAoUHJvY2Vzc1NvbHV0aW9uICR2YXJzICRzb2x1dGlvbk5hbWUgJFNQU0QuQ29tbWFuZHMuUmV0cmFjdCAkdHJ1ZSkgLW9yICRmYWxzZQoJCQkJCQlpZigkcHJvY2Vzc1NvbHV0aW9uKXsKCQkJCQkJCUxvZyAtTWVzc2FnZSAiJyRzb2x1dGlvbk5hbWUnIChzYW5kYm94ZWQgc29sdXRpb24pIHNraXBwZWQgYnkgY3VzdG9tIHRhcmdldCIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuV2FybmluZwoJCQkJCQkJcmV0dXJuCgkJCQkJCX0KCQkJCQkJCiAgICAgICAgICAgICAgICAgICAgICAgICRVcmxzIHwgRm9yZWFjaC1vYmplY3R7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdXJsID0gJF8KCiAgICAgICAgICAgICAgIAkgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlJldHJhY3QgZnJvbSAnJHVybCciIC1UeXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbCAtSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNvbHV0aW9ucyA9ICgoR2V0LVNQVXNlclNvbHV0aW9uIC1TaXRlICR1cmwpIHwgV2hlcmUtT2JqZWN0IHskXy5OYW1lIC1pbWF0Y2ggJHNvbHV0aW9uTmFtZSAtYW5kICRfLlN0YXR1cyAtZXEgW01pY3Jvc29mdC5TaGFyZVBvaW50LlNQVXNlclNvbHV0aW9uU3RhdHVzXTo6QWN0aXZhdGVkfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNvbHV0aW9ucyAtZXEgJG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIlNhbmRib3hlZCBzb2x1dGlvbiBpcyBub3QgaW5zdGFsbGVkLCBza2lwcGluZyByZXRyYWN0aW9uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBSZXRyYWN0aW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRydW5Db3VudCA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV2hpbGUoJHJ1bkNvdW50IC1sZSAkRGVwbG95bWVudFJldHJpZXMpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJ1bkNvdW50KysKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzb2x1dGlvbnMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJF8pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzb2x1dGlvbiA9ICRfCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2FsU29sdXRpb25OYW1lID0gJHNvbHV0aW9uLk5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHNvbHV0aW9uLlN0YXR1cyAtbmUgW01pY3Jvc29mdC5TaGFyZVBvaW50LlNQVXNlclNvbHV0aW9uU3RhdHVzXTo6RGVhY3RpdmF0ZWQgKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiUmV0cmFjdGluZyAnJGxvY2FsU29sdXRpb25OYW1lJy4uLiIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuTm9ybWFsIC1Ob05ld2xpbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVuaW5zdGFsbC1TUFVzZXJTb2x1dGlvbiAtSWRlbnRpdHkgJGxvY2FsU29sdXRpb25OYW1lIC1TaXRlICR1cmwgLUNvbmZpcm06JGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIkRvbmUiIC1UeXBlICRTUFNELkxvZ1R5cGVzLlN1Y2Nlc3MgLU5vSW5kZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV2FpdEZvckpvYlRvRmluaXNoICRsb2NhbFNvbHV0aW9uTmFtZSAtUmV0cmFjdCAtU2l0ZSAkdXJsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFJlbW92aW5nIFNvbHV0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtTWVzc2FnZSAiUmVtb3Zpbmcgc2FuZGJveGVkIHNvbHV0aW9uLi4uIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5Ob3JtYWwgLU5vTmV3TGluZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZW1vdmUtU1BVc2VyU29sdXRpb24gLUlkZW50aXR5ICRsb2NhbFNvbHV0aW9uTmFtZSAtU2l0ZSAkdXJsIC1Db25maXJtOiRmYWxzZSAtRXJyb3JBY3Rpb246U2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2cgLU1lc3NhZ2UgIk9rIiAtVHlwZSAkU1BTRC5Mb2dUeXBlcy5TdWNjZXNzIC1Ob0luZGVudAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoU2FuZGJveGVkU29sdXRpb25SZXRyYWN0ZWRTdWNjZXNzZnVsIC1zb2x1dGlvbk5hbWUgJGxvY2FsU29sdXRpb25OYW1lIC1TaXRlICR1cmwpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcnVuQ291bnQgLWd0ICREZXBsb3ltZW50UmV0cmllcyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaHJvdyAoIkNvdWxkIG5vdCByZXRyYWN0IHNhbmRib3hlZCBzb2x1dGlvbiAnJGxvY2FsU29sdXRpb25OYW1lJyBmcm9tICckdXJsJyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXsgTG9nIC1NZXNzYWdlICJSZXRyeWluZyIgLVR5cGUgJFNQU0QuTG9nVHlwZXMuSW5mb3JtYXRpb24gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsbHl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nT3V0ZGVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZpbmFsbHl7CiAgICAgICAgICAgICAgICAgICAgICAgIExvZyAtbWVzc2FnZSAoIigiKyRlbGFwc2VkVGltZS5FbGFwc2VkKyAiKSIpIC10eXBlICRTUFNELkxvZ1R5cGVzLk5vcm1hbAogICAgICAgICAgICAgICAgICAgICAgICBMb2dPdXRkZW50CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoJICAgICAgICB9CiAgICAgICAgICAgICNlbmRyZWdpb24KICAgICAgICAjZW5kcmVnaW9uCiAgICAgICAgI3JlZ2lvbiBEZXBsb3ltZW50LkNvbW1hbmRzLlJlZGVwbG95CgkgICAgICAgICNyZWdpb24gUmVkZXBsb3kKCSAgICAgICAgIyBEZXNjOiBSZWRlcGxveXMgdGhlIHNvbHV0aW9ucy4gUnVucyBmaXJzdCBSZXRyYWN0IGFuZCB0aGVuIERlcGxveQoJICAgICAgICBGdW5jdGlvbiBSZWRlcGxveSgpewoJICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJCZWdpbiBzb2x1dGlvbiByZWRlcGxveW1lbnQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1JbmRlbnQKCSAgICAgICAgICAgIFJldHJhY3QKCSAgICAgICAgICAgIERlcGxveQoJICAgICAgICAgICAgTG9nIC1NZXNzYWdlICJTb2x1dGlvbiByZWRlcGxveW1lbnQgZmluaXNoZWQiIC1UeXBlICRTUFNELkxvZ1R5cGVzLkluZm9ybWF0aW9uIC1PdXRkZW50CgkgICAgICAgIH0KICAgICAgICAgICAgI2VuZHJlZ2lvbgogICAgICAgICNlbmRyZWdpb24KICAgICNlbmRyZWdpb24KI2VuZHJlZ2lvbg==
