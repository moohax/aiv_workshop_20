psake.psm1,3f28958c19676c287c127549e3bb69bc,Scan result is 1. IsMalware: 0,IyBwc2FrZQojIENvcHlyaWdodCAoYykgMjAxMiBKYW1lcyBLb3ZhY3MKIyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5CiMgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKIyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAojIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwojIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CiMKIyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgojIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgojCiMgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKIyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKIyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKIyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCiMgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKIyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOCiMgVEhFIFNPRlRXQVJFLgoKI1JlcXVpcmVzIC1WZXJzaW9uIDIuMAoKIy0tIFB1YmxpYyBNb2R1bGUgRnVuY3Rpb25zIC0tIwoKIyAuRXh0ZXJuYWxIZWxwICBwc2FrZS5wc20xLWhlbHAueG1sCmZ1bmN0aW9uIEludm9rZS1UYXNrCnsKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsTWFuZGF0b3J5PTEpXSBbc3RyaW5nXSR0YXNrTmFtZQogICAgKQoKICAgIEFzc2VydCAkdGFza05hbWUgKCRtc2dzLmVycm9yX2ludmFsaWRfdGFza19uYW1lKQoKICAgICR0YXNrS2V5ID0gJHRhc2tOYW1lLlRvTG93ZXIoKQoKICAgIGlmICgkY3VycmVudENvbnRleHQuYWxpYXNlcy5Db250YWlucygkdGFza0tleSkpIHsKICAgICAgICAkdGFza05hbWUgPSAkY3VycmVudENvbnRleHQuYWxpYXNlcy4kdGFza0tleS5OYW1lCiAgICAgICAgJHRhc2tLZXkgPSAkdGFza05hbWUuVG9Mb3dlcigpCiAgICB9CgogICAgJGN1cnJlbnRDb250ZXh0ID0gJHBzYWtlLmNvbnRleHQuUGVlaygpCgogICAgQXNzZXJ0ICgkY3VycmVudENvbnRleHQudGFza3MuQ29udGFpbnMoJHRhc2tLZXkpKSAoJG1zZ3MuZXJyb3JfdGFza19uYW1lX2RvZXNfbm90X2V4aXN0IC1mICR0YXNrTmFtZSkKCiAgICBpZiAoJGN1cnJlbnRDb250ZXh0LmV4ZWN1dGVkVGFza3MuQ29udGFpbnMoJHRhc2tLZXkpKSAgeyByZXR1cm4gfQoKICAgIEFzc2VydCAoISRjdXJyZW50Q29udGV4dC5jYWxsU3RhY2suQ29udGFpbnMoJHRhc2tLZXkpKSAoJG1zZ3MuZXJyb3JfY2lyY3VsYXJfcmVmZXJlbmNlIC1mICR0YXNrTmFtZSkKCiAgICAkY3VycmVudENvbnRleHQuY2FsbFN0YWNrLlB1c2goJHRhc2tLZXkpCgogICAgJHRhc2sgPSAkY3VycmVudENvbnRleHQudGFza3MuJHRhc2tLZXkKCiAgICAkcHJlY29uZGl0aW9uX2lzX3ZhbGlkID0gJiAkdGFzay5QcmVjb25kaXRpb24KCiAgICBpZiAoISRwcmVjb25kaXRpb25faXNfdmFsaWQpIHsKICAgICAgICBXcml0ZUNvbG9yZWRPdXRwdXQgKCRtc2dzLnByZWNvbmRpdGlvbl93YXNfZmFsc2UgLWYgJHRhc2tOYW1lKSAtZm9yZWdyb3VuZGNvbG9yIEN5YW4KICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCR0YXNrS2V5IC1uZSAnZGVmYXVsdCcpIHsKCiAgICAgICAgICAgIGlmICgkdGFzay5QcmVBY3Rpb24gLW9yICR0YXNrLlBvc3RBY3Rpb24pIHsKICAgICAgICAgICAgICAgIEFzc2VydCAoJHRhc2suQWN0aW9uIC1uZSAkbnVsbCkgKCRtc2dzLmVycm9yX21pc3NpbmdfYWN0aW9uX3BhcmFtZXRlciAtZiAkdGFza05hbWUpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgkdGFzay5BY3Rpb24pIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkY2hpbGRUYXNrIGluICR0YXNrLkRlcGVuZHNPbikgewogICAgICAgICAgICAgICAgICAgICAgICBJbnZva2UtVGFzayAkY2hpbGRUYXNrCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkc3RvcHdhdGNoID0gW1N5c3RlbS5EaWFnbm9zdGljcy5TdG9wd2F0Y2hdOjpTdGFydE5ldygpCiAgICAgICAgICAgICAgICAgICAgJGN1cnJlbnRDb250ZXh0LmN1cnJlbnRUYXNrTmFtZSA9ICR0YXNrTmFtZQoKICAgICAgICAgICAgICAgICAgICAmICRjdXJyZW50Q29udGV4dC50YXNrU2V0dXBTY3JpcHRCbG9jawoKICAgICAgICAgICAgICAgICAgICBpZiAoJHRhc2suUHJlQWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICYgJHRhc2suUHJlQWN0aW9uCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoJGN1cnJlbnRDb250ZXh0LmNvbmZpZy50YXNrTmFtZUZvcm1hdCAtaXMgW1NjcmlwdEJsb2NrXSkgewogICAgICAgICAgICAgICAgICAgICAgICAmICRjdXJyZW50Q29udGV4dC5jb25maWcudGFza05hbWVGb3JtYXQgJHRhc2tOYW1lCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGVDb2xvcmVkT3V0cHV0ICgkY3VycmVudENvbnRleHQuY29uZmlnLnRhc2tOYW1lRm9ybWF0IC1mICR0YXNrTmFtZSkgLWZvcmVncm91bmRjb2xvciBDeWFuCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkdmFyaWFibGUgaW4gJHRhc2sucmVxdWlyZWRWYXJpYWJsZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgQXNzZXJ0ICgodGVzdC1wYXRoICJ2YXJpYWJsZTokdmFyaWFibGUiKSAtYW5kICgoZ2V0LXZhcmlhYmxlICR2YXJpYWJsZSkuVmFsdWUgLW5lICRudWxsKSkgKCRtc2dzLnJlcXVpcmVkX3ZhcmlhYmxlX25vdF9zZXQgLWYgJHZhcmlhYmxlLCAkdGFza05hbWUpCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAmICR0YXNrLkFjdGlvbgoKICAgICAgICAgICAgICAgICAgICBpZiAoJHRhc2suUG9zdEFjdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAmICR0YXNrLlBvc3RBY3Rpb24KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICYgJGN1cnJlbnRDb250ZXh0LnRhc2tUZWFyRG93blNjcmlwdEJsb2NrCiAgICAgICAgICAgICAgICAgICAgJHRhc2suRHVyYXRpb24gPSAkc3RvcHdhdGNoLkVsYXBzZWQKICAgICAgICAgICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICAgICAgICAgIGlmICgkdGFzay5Db250aW51ZU9uRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIi0iKjcwCiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlQ29sb3JlZE91dHB1dCAoJG1zZ3MuY29udGludWVfb25fZXJyb3IgLWYgJHRhc2tOYW1lLCRfKSAtZm9yZWdyb3VuZGNvbG9yIFllbGxvdwogICAgICAgICAgICAgICAgICAgICAgICAiLSIqNzAKICAgICAgICAgICAgICAgICAgICAgICAgJHRhc2suRHVyYXRpb24gPSAkc3RvcHdhdGNoLkVsYXBzZWQKICAgICAgICAgICAgICAgICAgICB9ICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgJF8KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAjIG5vIGFjdGlvbiB3YXMgc3BlY2lmaWVkIGJ1dCB3ZSBzdGlsbCBleGVjdXRlIGFsbCB0aGUgZGVwZW5kZW5jaWVzCiAgICAgICAgICAgICAgICBmb3JlYWNoKCRjaGlsZFRhc2sgaW4gJHRhc2suRGVwZW5kc09uKSB7CiAgICAgICAgICAgICAgICAgICAgSW52b2tlLVRhc2sgJGNoaWxkVGFzawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yZWFjaCgkY2hpbGRUYXNrIGluICR0YXNrLkRlcGVuZHNPbikgewogICAgICAgICAgICAgICAgSW52b2tlLVRhc2sgJGNoaWxkVGFzawogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBBc3NlcnQgKCYgJHRhc2suUG9zdGNvbmRpdGlvbikgKCRtc2dzLnBvc3Rjb25kaXRpb25fZmFpbGVkIC1mICR0YXNrTmFtZSkKICAgIH0KCiAgICAkcG9wcGVkVGFza0tleSA9ICRjdXJyZW50Q29udGV4dC5jYWxsU3RhY2suUG9wKCkKICAgIEFzc2VydCAoJHBvcHBlZFRhc2tLZXkgLWVxICR0YXNrS2V5KSAoJG1zZ3MuZXJyb3JfY29ycnVwdF9jYWxsc3RhY2sgLWYgJHRhc2tLZXksJHBvcHBlZFRhc2tLZXkpCgogICAgJGN1cnJlbnRDb250ZXh0LmV4ZWN1dGVkVGFza3MuUHVzaCgkdGFza0tleSkKfQoKIyAuRXh0ZXJuYWxIZWxwICBwc2FrZS5wc20xLWhlbHAueG1sCmZ1bmN0aW9uIEV4ZWMKewogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxNYW5kYXRvcnk9MSldW3NjcmlwdGJsb2NrXSRjbWQsCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0xLE1hbmRhdG9yeT0wKV1bc3RyaW5nXSRlcnJvck1lc3NhZ2UgPSAoJG1zZ3MuZXJyb3JfYmFkX2NvbW1hbmQgLWYgJGNtZCksCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0yLE1hbmRhdG9yeT0wKV1baW50XSRtYXhSZXRyaWVzID0gMCwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTMsTWFuZGF0b3J5PTApXVtzdHJpbmddJHJldHJ5VHJpZ2dlckVycm9yUGF0dGVybiA9ICRudWxsCiAgICApCgogICAgJHRyeUNvdW50ID0gMQoKICAgIGRvIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkZ2xvYmFsOmxhc3RleGl0Y29kZSA9IDAKICAgICAgICAgICAgJiAkY21kCiAgICAgICAgICAgIGlmICgkbGFzdGV4aXRjb2RlIC1uZSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAoIkV4ZWM6ICIgKyAkZXJyb3JNZXNzYWdlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgICAgIGNhdGNoIFtFeGNlcHRpb25dCiAgICAgICAgewogICAgICAgICAgICBpZiAoJHRyeUNvdW50IC1ndCAkbWF4UmV0cmllcykgewogICAgICAgICAgICAgICAgdGhyb3cgJF8KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCRyZXRyeVRyaWdnZXJFcnJvclBhdHRlcm4gLW5lICRudWxsKSB7CiAgICAgICAgICAgICAgICAkaXNNYXRjaCA9IFtyZWdleF06OklzTWF0Y2goJF8uRXhjZXB0aW9uLk1lc3NhZ2UsICRyZXRyeVRyaWdnZXJFcnJvclBhdHRlcm4pCgogICAgICAgICAgICAgICAgaWYgKCRpc01hdGNoIC1lcSAkZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyAkXwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBXcml0ZS1Ib3N0ICJUcnkgJHRyeUNvdW50IGZhaWxlZCwgcmV0cnlpbmcgYWdhaW4gaW4gMSBzZWNvbmQuLi4iCgogICAgICAgICAgICAkdHJ5Q291bnQrKwoKICAgICAgICAgICAgW1N5c3RlbS5UaHJlYWRpbmcuVGhyZWFkXTo6U2xlZXAoW1N5c3RlbS5UaW1lU3Bhbl06OkZyb21TZWNvbmRzKDEpKQogICAgICAgIH0KICAgIH0KICAgIHdoaWxlICgkdHJ1ZSkKfQoKIyAuRXh0ZXJuYWxIZWxwICBwc2FrZS5wc20xLWhlbHAueG1sCmZ1bmN0aW9uIEFzc2VydAp7CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLE1hbmRhdG9yeT0xKV0kY29uZGl0aW9uVG9DaGVjaywKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTEsTWFuZGF0b3J5PTEpXSRmYWlsdXJlTWVzc2FnZQogICAgKQogICAgaWYgKCEkY29uZGl0aW9uVG9DaGVjaykgewogICAgICAgIHRocm93ICgiQXNzZXJ0OiAiICsgJGZhaWx1cmVNZXNzYWdlKQogICAgfQp9CgojIC5FeHRlcm5hbEhlbHAgIHBzYWtlLnBzbTEtaGVscC54bWwKZnVuY3Rpb24gVGFzawp7CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLE1hbmRhdG9yeT0xKV1bc3RyaW5nXSRuYW1lID0gJG51bGwsCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0xLE1hbmRhdG9yeT0wKV1bc2NyaXB0YmxvY2tdJGFjdGlvbiA9ICRudWxsLAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MixNYW5kYXRvcnk9MCldW3NjcmlwdGJsb2NrXSRwcmVhY3Rpb24gPSAkbnVsbCwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTMsTWFuZGF0b3J5PTApXVtzY3JpcHRibG9ja10kcG9zdGFjdGlvbiA9ICRudWxsLAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249NCxNYW5kYXRvcnk9MCldW3NjcmlwdGJsb2NrXSRwcmVjb25kaXRpb24gPSB7JHRydWV9LAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249NSxNYW5kYXRvcnk9MCldW3NjcmlwdGJsb2NrXSRwb3N0Y29uZGl0aW9uID0geyR0cnVlfSwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTYsTWFuZGF0b3J5PTApXVtzd2l0Y2hdJGNvbnRpbnVlT25FcnJvciA9ICRmYWxzZSwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTcsTWFuZGF0b3J5PTApXVtzdHJpbmdbXV0kZGVwZW5kcyA9IEAoKSwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTgsTWFuZGF0b3J5PTApXVtzdHJpbmdbXV0kcmVxdWlyZWRWYXJpYWJsZXMgPSBAKCksCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj05LE1hbmRhdG9yeT0wKV1bc3RyaW5nXSRkZXNjcmlwdGlvbiA9ICRudWxsLAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MTAsTWFuZGF0b3J5PTApXVtzdHJpbmddJGFsaWFzID0gJG51bGwsCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0xMSxNYW5kYXRvcnk9MCldW3N0cmluZ10kbWF4UmV0cmllcyA9IDAsCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0xMixNYW5kYXRvcnk9MCldW3N0cmluZ10kcmV0cnlUcmlnZ2VyRXJyb3JQYXR0ZXJuID0gJG51bGwKICAgICkKICAgIGlmICgkbmFtZSAtZXEgJ2RlZmF1bHQnKSB7CiAgICAgICAgQXNzZXJ0ICghJGFjdGlvbikgKCRtc2dzLmVycm9yX2RlZmF1bHRfdGFza19jYW5ub3RfaGF2ZV9hY3Rpb24pCiAgICB9CgogICAgJG5ld1Rhc2sgPSBAewogICAgICAgIE5hbWUgPSAkbmFtZQogICAgICAgIERlcGVuZHNPbiA9ICRkZXBlbmRzCiAgICAgICAgUHJlQWN0aW9uID0gJHByZWFjdGlvbgogICAgICAgIEFjdGlvbiA9ICRhY3Rpb24KICAgICAgICBQb3N0QWN0aW9uID0gJHBvc3RhY3Rpb24KICAgICAgICBQcmVjb25kaXRpb24gPSAkcHJlY29uZGl0aW9uCiAgICAgICAgUG9zdGNvbmRpdGlvbiA9ICRwb3N0Y29uZGl0aW9uCiAgICAgICAgQ29udGludWVPbkVycm9yID0gJGNvbnRpbnVlT25FcnJvcgogICAgICAgIERlc2NyaXB0aW9uID0gJGRlc2NyaXB0aW9uCiAgICAgICAgRHVyYXRpb24gPSBbU3lzdGVtLlRpbWVTcGFuXTo6WmVybwogICAgICAgIFJlcXVpcmVkVmFyaWFibGVzID0gJHJlcXVpcmVkVmFyaWFibGVzCiAgICAgICAgQWxpYXMgPSAkYWxpYXMKICAgICAgICBNYXhSZXRyaWVzID0gJG1heFJldHJpZXMKICAgICAgICBSZXRyeVRyaWdnZXJFcnJvclBhdHRlcm4gPSAkcmV0cnlUcmlnZ2VyRXJyb3JQYXR0ZXJuCiAgICB9CgogICAgJHRhc2tLZXkgPSAkbmFtZS5Ub0xvd2VyKCkKCiAgICAkY3VycmVudENvbnRleHQgPSAkcHNha2UuY29udGV4dC5QZWVrKCkKCiAgICBBc3NlcnQgKCEkY3VycmVudENvbnRleHQudGFza3MuQ29udGFpbnNLZXkoJHRhc2tLZXkpKSAoJG1zZ3MuZXJyb3JfZHVwbGljYXRlX3Rhc2tfbmFtZSAtZiAkbmFtZSkKCiAgICAkY3VycmVudENvbnRleHQudGFza3MuJHRhc2tLZXkgPSAkbmV3VGFzawoKICAgIGlmKCRhbGlhcykKICAgIHsKICAgICAgICAkYWxpYXNLZXkgPSAkYWxpYXMuVG9Mb3dlcigpCgogICAgICAgIEFzc2VydCAoISRjdXJyZW50Q29udGV4dC5hbGlhc2VzLkNvbnRhaW5zS2V5KCRhbGlhc0tleSkpICgkbXNncy5lcnJvcl9kdXBsaWNhdGVfYWxpYXNfbmFtZSAtZiAkYWxpYXMpCgogICAgICAgICRjdXJyZW50Q29udGV4dC5hbGlhc2VzLiRhbGlhc0tleSA9ICRuZXdUYXNrCiAgICB9Cn0KCiMgLkV4dGVybmFsSGVscCAgcHNha2UucHNtMS1oZWxwLnhtbApmdW5jdGlvbiBQcm9wZXJ0aWVzIHsKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsTWFuZGF0b3J5PTEpXVtzY3JpcHRibG9ja10kcHJvcGVydGllcwogICAgKQogICAgJHBzYWtlLmNvbnRleHQuUGVlaygpLnByb3BlcnRpZXMgKz0gJHByb3BlcnRpZXMKfQoKIyAuRXh0ZXJuYWxIZWxwICBwc2FrZS5wc20xLWhlbHAueG1sCmZ1bmN0aW9uIEluY2x1ZGUgewogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxNYW5kYXRvcnk9MSldW3N0cmluZ10kZmlsZU5hbWVQYXRoVG9JbmNsdWRlCiAgICApCiAgICBBc3NlcnQgKHRlc3QtcGF0aCAkZmlsZU5hbWVQYXRoVG9JbmNsdWRlIC1wYXRoVHlwZSBMZWFmKSAoJG1zZ3MuZXJyb3JfaW52YWxpZF9pbmNsdWRlX3BhdGggLWYgJGZpbGVOYW1lUGF0aFRvSW5jbHVkZSkKICAgICRwc2FrZS5jb250ZXh0LlBlZWsoKS5pbmNsdWRlcy5FbnF1ZXVlKChSZXNvbHZlLVBhdGggJGZpbGVOYW1lUGF0aFRvSW5jbHVkZSkpOwp9CgojIC5FeHRlcm5hbEhlbHAgIHBzYWtlLnBzbTEtaGVscC54bWwKZnVuY3Rpb24gRm9ybWF0VGFza05hbWUgewogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb249MCxNYW5kYXRvcnk9MSldJGZvcm1hdAogICAgKQogICAgJHBzYWtlLmNvbnRleHQuUGVlaygpLmNvbmZpZy50YXNrTmFtZUZvcm1hdCA9ICRmb3JtYXQKfQoKIyAuRXh0ZXJuYWxIZWxwICBwc2FrZS5wc20xLWhlbHAueG1sCmZ1bmN0aW9uIFRhc2tTZXR1cCB7CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLE1hbmRhdG9yeT0xKV1bc2NyaXB0YmxvY2tdJHNldHVwCiAgICApCiAgICAkcHNha2UuY29udGV4dC5QZWVrKCkudGFza1NldHVwU2NyaXB0QmxvY2sgPSAkc2V0dXAKfQoKIyAuRXh0ZXJuYWxIZWxwICBwc2FrZS5wc20xLWhlbHAueG1sCmZ1bmN0aW9uIFRhc2tUZWFyRG93biB7CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLE1hbmRhdG9yeT0xKV1bc2NyaXB0YmxvY2tdJHRlYXJkb3duCiAgICApCiAgICAkcHNha2UuY29udGV4dC5QZWVrKCkudGFza1RlYXJEb3duU2NyaXB0QmxvY2sgPSAkdGVhcmRvd24KfQoKIyAuRXh0ZXJuYWxIZWxwICBwc2FrZS5wc20xLWhlbHAueG1sCmZ1bmN0aW9uIEZyYW1ld29yayB7CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLE1hbmRhdG9yeT0xKV1bc3RyaW5nXSRmcmFtZXdvcmsKICAgICkKICAgICRwc2FrZS5jb250ZXh0LlBlZWsoKS5jb25maWcuZnJhbWV3b3JrID0gJGZyYW1ld29yawogICAgQ29uZmlndXJlQnVpbGRFbnZpcm9ubWVudAp9CgojIC5FeHRlcm5hbEhlbHAgIHBzYWtlLnBzbTEtaGVscC54bWwKZnVuY3Rpb24gSW52b2tlLXBzYWtlIHsKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCwgTWFuZGF0b3J5ID0gMCldW3N0cmluZ10gJGJ1aWxkRmlsZSwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMSwgTWFuZGF0b3J5ID0gMCldW3N0cmluZ1tdXSAkdGFza0xpc3QgPSBAKCksCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDIsIE1hbmRhdG9yeSA9IDApXVtzdHJpbmddICRmcmFtZXdvcmssCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDMsIE1hbmRhdG9yeSA9IDApXVtzd2l0Y2hdICRkb2NzID0gJGZhbHNlLAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSA0LCBNYW5kYXRvcnkgPSAwKV1baGFzaHRhYmxlXSAkcGFyYW1ldGVycyA9IEB7fSwKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gNSwgTWFuZGF0b3J5ID0gMCldW2hhc2h0YWJsZV0gJHByb3BlcnRpZXMgPSBAe30sCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDYsIE1hbmRhdG9yeSA9IDApXVthbGlhcygiaW5pdCIpXVtzY3JpcHRibG9ja10gJGluaXRpYWxpemF0aW9uID0ge30sCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDcsIE1hbmRhdG9yeSA9IDApXVtzd2l0Y2hdICRub2xvZ28gPSAkZmFsc2UsCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDgsIE1hbmRhdG9yeSA9IDApXVtzd2l0Y2hdICRkZXRhaWxlZERvY3MgPSAkZmFsc2UKICAgICkKICAgIHRyeSB7CiAgICAgICAgaWYgKC1ub3QgJG5vbG9nbykgewogICAgICAgICAgICAicHNha2UgdmVyc2lvbiB7MH1gbkNvcHlyaWdodCAoYykgMjAxMC0yMDE0IEphbWVzIEtvdmFjcyAmIENvbnRyaWJ1dG9yc2BuIiAtZiAkcHNha2UudmVyc2lvbgogICAgICAgIH0KCiAgICAgICAgaWYgKCEkYnVpbGRGaWxlKSB7CiAgICAgICAgICAkYnVpbGRGaWxlID0gJHBzYWtlLmNvbmZpZ19kZWZhdWx0LmJ1aWxkRmlsZU5hbWUKICAgICAgICB9CiAgICAgICAgZWxzZWlmICghKHRlc3QtcGF0aCAkYnVpbGRGaWxlIC1wYXRoVHlwZSBMZWFmKSAtYW5kICh0ZXN0LXBhdGggJHBzYWtlLmNvbmZpZ19kZWZhdWx0LmJ1aWxkRmlsZU5hbWUgLXBhdGhUeXBlIExlYWYpKSB7CiAgICAgICAgICAgICMgSWYgdGhlICRjb25maWcuYnVpbGRGaWxlTmFtZSBmaWxlIGV4aXN0cyBhbmQgdGhlIGdpdmVuICJidWlsZGZpbGUiIGlzbiAndCBmb3VuZCBhc3N1bWUgdGhhdCB0aGUgZ2l2ZW4KICAgICAgICAgICAgIyAkYnVpbGRGaWxlIGlzIGFjdHVhbGx5IHRoZSB0YXJnZXQgVGFza3MgdG8gZXhlY3V0ZSBpbiB0aGUgJGNvbmZpZy5idWlsZEZpbGVOYW1lIHNjcmlwdC4KICAgICAgICAgICAgJHRhc2tMaXN0ID0gJGJ1aWxkRmlsZS5TcGxpdCgnLCAnKQogICAgICAgICAgICAkYnVpbGRGaWxlID0gJHBzYWtlLmNvbmZpZ19kZWZhdWx0LmJ1aWxkRmlsZU5hbWUKICAgICAgICB9CgogICAgICAgICMgRXhlY3V0ZSB0aGUgYnVpbGQgZmlsZSB0byBzZXQgdXAgdGhlIHRhc2tzIGFuZCBkZWZhdWx0cwogICAgICAgIEFzc2VydCAodGVzdC1wYXRoICRidWlsZEZpbGUgLXBhdGhUeXBlIExlYWYpICgkbXNncy5lcnJvcl9idWlsZF9maWxlX25vdF9mb3VuZCAtZiAkYnVpbGRGaWxlKQoKICAgICAgICAkcHNha2UuYnVpbGRfc2NyaXB0X2ZpbGUgPSBnZXQtaXRlbSAkYnVpbGRGaWxlCiAgICAgICAgJHBzYWtlLmJ1aWxkX3NjcmlwdF9kaXIgPSAkcHNha2UuYnVpbGRfc2NyaXB0X2ZpbGUuRGlyZWN0b3J5TmFtZQogICAgICAgICRwc2FrZS5idWlsZF9zdWNjZXNzID0gJGZhbHNlCgogICAgICAgICRwc2FrZS5jb250ZXh0LnB1c2goQHsKICAgICAgICAgICAgInRhc2tTZXR1cFNjcmlwdEJsb2NrIiA9IHt9OwogICAgICAgICAgICAidGFza1RlYXJEb3duU2NyaXB0QmxvY2siID0ge307CiAgICAgICAgICAgICJleGVjdXRlZFRhc2tzIiA9IG5ldy1vYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLlN0YWNrOwogICAgICAgICAgICAiY2FsbFN0YWNrIiA9IG5ldy1vYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLlN0YWNrOwogICAgICAgICAgICAib3JpZ2luYWxFbnZQYXRoIiA9ICRlbnY6cGF0aDsKICAgICAgICAgICAgIm9yaWdpbmFsRGlyZWN0b3J5IiA9IGdldC1sb2NhdGlvbjsKICAgICAgICAgICAgIm9yaWdpbmFsRXJyb3JBY3Rpb25QcmVmZXJlbmNlIiA9ICRnbG9iYWw6RXJyb3JBY3Rpb25QcmVmZXJlbmNlOwogICAgICAgICAgICAidGFza3MiID0gQHt9OwogICAgICAgICAgICAiYWxpYXNlcyIgPSBAe307CiAgICAgICAgICAgICJwcm9wZXJ0aWVzIiA9IEAoKTsKICAgICAgICAgICAgImluY2x1ZGVzIiA9IG5ldy1vYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLlF1ZXVlOwogICAgICAgICAgICAiY29uZmlnIiA9IENyZWF0ZUNvbmZpZ3VyYXRpb25Gb3JOZXdDb250ZXh0ICRidWlsZEZpbGUgJGZyYW1ld29yawogICAgICAgIH0pCgogICAgICAgIExvYWRDb25maWd1cmF0aW9uICRwc2FrZS5idWlsZF9zY3JpcHRfZGlyCgogICAgICAgICRzdG9wd2F0Y2ggPSBbU3lzdGVtLkRpYWdub3N0aWNzLlN0b3B3YXRjaF06OlN0YXJ0TmV3KCkKCiAgICAgICAgc2V0LWxvY2F0aW9uICRwc2FrZS5idWlsZF9zY3JpcHRfZGlyCgogICAgICAgIExvYWRNb2R1bGVzCgogICAgICAgICRmcmFtZXdvcmtPbGRWYWx1ZSA9ICRmcmFtZXdvcmsKICAgICAgICAuICRwc2FrZS5idWlsZF9zY3JpcHRfZmlsZS5GdWxsTmFtZQoKICAgICAgICAkY3VycmVudENvbnRleHQgPSAkcHNha2UuY29udGV4dC5QZWVrKCkKCiAgICAgICAgaWYgKCRmcmFtZXdvcmsgLW5lICRmcmFtZXdvcmtPbGRWYWx1ZSkgewogICAgICAgICAgICB3cml0ZWNvbG9yZWRvdXRwdXQgJG1zZ3Mud2FybmluZ19kZXByZWNhdGVkX2ZyYW1ld29ya192YXJpYWJsZSAtZm9yZWdyb3VuZGNvbG9yIFllbGxvdwogICAgICAgICAgICAkY3VycmVudENvbnRleHQuY29uZmlnLmZyYW1ld29yayA9ICRmcmFtZXdvcmsKICAgICAgICB9CgogICAgICAgIENvbmZpZ3VyZUJ1aWxkRW52aXJvbm1lbnQKCiAgICAgICAgd2hpbGUgKCRjdXJyZW50Q29udGV4dC5pbmNsdWRlcy5Db3VudCAtZ3QgMCkgewogICAgICAgICAgICAkaW5jbHVkZUZpbGVuYW1lID0gJGN1cnJlbnRDb250ZXh0LmluY2x1ZGVzLkRlcXVldWUoKQogICAgICAgICAgICAuICRpbmNsdWRlRmlsZW5hbWUKICAgICAgICB9CgogICAgICAgIGlmICgkZG9jcyAtb3IgJGRldGFpbGVkRG9jcykgewogICAgICAgICAgICBXcml0ZURvY3VtZW50YXRpb24oJGRldGFpbGVkRG9jcykKICAgICAgICAgICAgQ2xlYW51cEVudmlyb25tZW50CiAgICAgICAgICAgIHJldHVybgogICAgICAgIH0KCiAgICAgICAgZm9yZWFjaCAoJGtleSBpbiAkcGFyYW1ldGVycy5rZXlzKSB7CiAgICAgICAgICAgIGlmICh0ZXN0LXBhdGggInZhcmlhYmxlOlwka2V5IikgewogICAgICAgICAgICAgICAgc2V0LWl0ZW0gLXBhdGggInZhcmlhYmxlOlwka2V5IiAtdmFsdWUgJHBhcmFtZXRlcnMuJGtleSAtV2hhdElmOiRmYWxzZSAtQ29uZmlybTokZmFsc2UgfCBvdXQtbnVsbAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbmV3LWl0ZW0gLXBhdGggInZhcmlhYmxlOlwka2V5IiAtdmFsdWUgJHBhcmFtZXRlcnMuJGtleSAtV2hhdElmOiRmYWxzZSAtQ29uZmlybTokZmFsc2UgfCBvdXQtbnVsbAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIFRoZSBpbml0aWFsIGRvdCAoLikgaW5kaWNhdGVzIHRoYXQgdmFyaWFibGVzIGluaXRpYWxpemVkL21vZGlmaWVkIGluIHRoZSBwcm9wZXJ0eUJsb2NrIGFyZSBhdmFpbGFibGUgaW4gdGhlIHBhcmVudCBzY29wZS4KICAgICAgICBmb3JlYWNoICgkcHJvcGVydHlCbG9jayBpbiAkY3VycmVudENvbnRleHQucHJvcGVydGllcykgewogICAgICAgICAgICAuICRwcm9wZXJ0eUJsb2NrCiAgICAgICAgfQoKICAgICAgICBmb3JlYWNoICgka2V5IGluICRwcm9wZXJ0aWVzLmtleXMpIHsKICAgICAgICAgICAgaWYgKHRlc3QtcGF0aCAidmFyaWFibGU6XCRrZXkiKSB7CiAgICAgICAgICAgICAgICBzZXQtaXRlbSAtcGF0aCAidmFyaWFibGU6XCRrZXkiIC12YWx1ZSAkcHJvcGVydGllcy4ka2V5IC1XaGF0SWY6JGZhbHNlIC1Db25maXJtOiRmYWxzZSB8IG91dC1udWxsCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgU2ltcGxlIGRvdCBzb3VyY2luZyB3aWxsIG5vdCB3b3JrLiBXZSBoYXZlIHRvIGZvcmNlIHRoZSBzY3JpcHQgYmxvY2sgaW50byBvdXIKICAgICAgICAjIG1vZHVsZSdzIHNjb3BlIGluIG9yZGVyIHRvIGluaXRpYWxpemUgdmFyaWFibGVzIHByb3Blcmx5LgogICAgICAgIC4gJE15SW52b2NhdGlvbi5NeUNvbW1hbmQuTW9kdWxlICRpbml0aWFsaXphdGlvbgoKICAgICAgICAjIEV4ZWN1dGUgdGhlIGxpc3Qgb2YgdGFza3Mgb3IgdGhlIGRlZmF1bHQgdGFzawogICAgICAgIGlmICgkdGFza0xpc3QpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHRhc2sgaW4gJHRhc2tMaXN0KSB7CiAgICAgICAgICAgICAgICBpbnZva2UtdGFzayAkdGFzawogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlaWYgKCRjdXJyZW50Q29udGV4dC50YXNrcy5kZWZhdWx0KSB7CiAgICAgICAgICAgIGludm9rZS10YXNrIGRlZmF1bHQKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyAkbXNncy5lcnJvcl9ub19kZWZhdWx0X3Rhc2sKICAgICAgICB9CgogICAgICAgIFdyaXRlQ29sb3JlZE91dHB1dCAoImBuIiArICRtc2dzLmJ1aWxkX3N1Y2Nlc3MgKyAiYG4iKSAtZm9yZWdyb3VuZGNvbG9yIEdyZWVuCgogICAgICAgIFdyaXRlVGFza1RpbWVTdW1tYXJ5ICRzdG9wd2F0Y2guRWxhcHNlZAoKICAgICAgICAkcHNha2UuYnVpbGRfc3VjY2VzcyA9ICR0cnVlCiAgICB9IGNhdGNoIHsKICAgICAgICAkY3VycmVudENvbmZpZyA9IEdldEN1cnJlbnRDb25maWd1cmF0aW9uT3JEZWZhdWx0CiAgICAgICAgaWYgKCRjdXJyZW50Q29uZmlnLnZlcmJvc2VFcnJvcikgewogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSA9ICJ7MH06IEFuIEVycm9yIE9jY3VycmVkLiBTZWUgRXJyb3IgRGV0YWlscyBCZWxvdzogYG4iIC1mIChHZXQtRGF0ZSkKICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgKz0gKCItIiAqIDcwKSArICJgbiIKICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgKz0gIkVycm9yOiB7MH1gbiIgLWYgKFJlc29sdmVFcnJvciAkXyAtU2hvcnQpCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlICs9ICgiLSIgKiA3MCkgKyAiYG4iCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlICs9IFJlc29sdmVFcnJvciAkXwogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSArPSAoIi0iICogNzApICsgImBuIgogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSArPSAiU2NyaXB0IFZhcmlhYmxlcyIgKyAiYG4iCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlICs9ICgiLSIgKiA3MCkgKyAiYG4iCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlICs9IGdldC12YXJpYWJsZSAtc2NvcGUgc2NyaXB0IHwgZm9ybWF0LXRhYmxlIHwgb3V0LXN0cmluZwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICMgKCRfIHwgT3V0LVN0cmluZykgZ2V0cyBlcnJvciBtZXNzYWdlcyB3aXRoIHNvdXJjZSBpbmZvcm1hdGlvbiBpbmNsdWRlZC4KICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAiRXJyb3I6IHswfTogYG57MX0iIC1mIChHZXQtRGF0ZSksIChSZXNvbHZlRXJyb3IgJF8gLVNob3J0KQogICAgICAgIH0KCiAgICAgICAgJHBzYWtlLmJ1aWxkX3N1Y2Nlc3MgPSAkZmFsc2UKCiAgICAgICAgIyBpZiB3ZSBhcmUgcnVubmluZyBpbiBhIG5lc3RlZCBzY29wZSAoaS5lLiBydW5uaW5nIGEgcHNha2Ugc2NyaXB0IGZyb20gYSBwc2FrZSBzY3JpcHQpIHRoZW4gd2UgbmVlZCB0byByZS10aHJvdyB0aGUgZXhjZXB0aW9uCiAgICAgICAgIyBzbyB0aGF0IHRoZSBwYXJlbnQgc2NyaXB0IHdpbGwgZmFpbCBvdGhlcndpc2UgdGhlIHBhcmVudCBzY3JpcHQgd2lsbCByZXBvcnQgYSBzdWNjZXNzZnVsIGJ1aWxkCiAgICAgICAgJGluTmVzdGVkU2NvcGUgPSAoJHBzYWtlLmNvbnRleHQuY291bnQgLWd0IDEpCiAgICAgICAgaWYgKCAkaW5OZXN0ZWRTY29wZSApIHsKICAgICAgICAgICAgdGhyb3cgJF8KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoISRwc2FrZS5ydW5fYnlfcHNha2VfYnVpbGRfdGVzdGVyKSB7CiAgICAgICAgICAgICAgICBXcml0ZUNvbG9yZWRPdXRwdXQgJGVycm9yX21lc3NhZ2UgLWZvcmVncm91bmRjb2xvciBSZWQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZmluYWxseSB7CiAgICAgICAgQ2xlYW51cEVudmlyb25tZW50CiAgICB9Cn0KCiMtLSBQcml2YXRlIE1vZHVsZSBGdW5jdGlvbnMgLS0jCmZ1bmN0aW9uIFdyaXRlQ29sb3JlZE91dHB1dCB7CiAgICBwYXJhbSgKICAgICAgICBbc3RyaW5nXSAkbWVzc2FnZSwKICAgICAgICBbU3lzdGVtLkNvbnNvbGVDb2xvcl0gJGZvcmVncm91bmRjb2xvcgogICAgKQoKICAgICRjdXJyZW50Q29uZmlnID0gR2V0Q3VycmVudENvbmZpZ3VyYXRpb25PckRlZmF1bHQKICAgIGlmICgkY3VycmVudENvbmZpZy5jb2xvcmVkT3V0cHV0IC1lcSAkdHJ1ZSkgewogICAgICAgIGlmICgoJEhvc3QuVUkgLW5lICRudWxsKSAtYW5kICgkSG9zdC5VSS5SYXdVSSAtbmUgJG51bGwpIC1hbmQgKCRIb3N0LlVJLlJhd1VJLkZvcmVncm91bmRDb2xvciAtbmUgJG51bGwpKSB7CiAgICAgICAgICAgICRwcmV2aW91c0NvbG9yID0gJEhvc3QuVUkuUmF3VUkuRm9yZWdyb3VuZENvbG9yCiAgICAgICAgICAgICRIb3N0LlVJLlJhd1VJLkZvcmVncm91bmRDb2xvciA9ICRmb3JlZ3JvdW5kY29sb3IKICAgICAgICB9CiAgICB9CgogICAgJG1lc3NhZ2UKCiAgICBpZiAoJHByZXZpb3VzQ29sb3IgLW5lICRudWxsKSB7CiAgICAgICAgJEhvc3QuVUkuUmF3VUkuRm9yZWdyb3VuZENvbG9yID0gJHByZXZpb3VzQ29sb3IKICAgIH0KfQoKZnVuY3Rpb24gTG9hZE1vZHVsZXMgewogICAgJGN1cnJlbnRDb25maWcgPSAkcHNha2UuY29udGV4dC5wZWVrKCkuY29uZmlnCiAgICBpZiAoJGN1cnJlbnRDb25maWcubW9kdWxlcykgewoKICAgICAgICAkc2NvcGUgPSAkY3VycmVudENvbmZpZy5tb2R1bGVTY29wZQoKICAgICAgICAkZ2xvYmFsID0gW3N0cmluZ106OkVxdWFscygkc2NvcGUsICJnbG9iYWwiLCBbU3RyaW5nQ29tcGFyaXNvbl06OkN1cnJlbnRDdWx0dXJlSWdub3JlQ2FzZSkKCiAgICAgICAgJGN1cnJlbnRDb25maWcubW9kdWxlcyB8IGZvcmVhY2ggewogICAgICAgICAgICByZXNvbHZlLXBhdGggJF8gfCBmb3JlYWNoIHsKICAgICAgICAgICAgICAgICJMb2FkaW5nIG1vZHVsZTogJF8iCiAgICAgICAgICAgICAgICAkbW9kdWxlID0gaW1wb3J0LW1vZHVsZSAkXyAtcGFzc3RocnUgLURpc2FibGVOYW1lQ2hlY2tpbmcgLWdsb2JhbDokZ2xvYmFsCiAgICAgICAgICAgICAgICBpZiAoISRtb2R1bGUpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyAoJG1zZ3MuZXJyb3JfbG9hZGluZ19tb2R1bGUgLWYgJF8uTmFtZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAiIgogICAgfQp9CgpmdW5jdGlvbiBMb2FkQ29uZmlndXJhdGlvbiB7CiAgICBwYXJhbSgKICAgICAgICBbc3RyaW5nXSAkY29uZmlnZGlyID0gJFBTU2NyaXB0Um9vdAogICAgKQoKICAgICRwc2FrZUNvbmZpZ0ZpbGVQYXRoID0gKGpvaW4tcGF0aCAkY29uZmlnZGlyICJwc2FrZS1jb25maWcucHMxIikKCiAgICBpZiAodGVzdC1wYXRoICRwc2FrZUNvbmZpZ0ZpbGVQYXRoIC1wYXRoVHlwZSBMZWFmKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGNvbmZpZyA9IEdldEN1cnJlbnRDb25maWd1cmF0aW9uT3JEZWZhdWx0CiAgICAgICAgICAgIC4gJHBzYWtlQ29uZmlnRmlsZVBhdGgKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgdGhyb3cgIkVycm9yIExvYWRpbmcgQ29uZmlndXJhdGlvbiBmcm9tIHBzYWtlLWNvbmZpZy5wczE6ICIgKyAkXwogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gR2V0Q3VycmVudENvbmZpZ3VyYXRpb25PckRlZmF1bHQoKSB7CiAgICBpZiAoJHBzYWtlLmNvbnRleHQuY291bnQgLWd0IDApIHsKICAgICAgICByZXR1cm4gJHBzYWtlLmNvbnRleHQucGVlaygpLmNvbmZpZwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gJHBzYWtlLmNvbmZpZ19kZWZhdWx0CiAgICB9Cn0KCmZ1bmN0aW9uIENyZWF0ZUNvbmZpZ3VyYXRpb25Gb3JOZXdDb250ZXh0IHsKICAgIHBhcmFtKAogICAgICAgIFtzdHJpbmddICRidWlsZEZpbGUsCiAgICAgICAgW3N0cmluZ10gJGZyYW1ld29yawogICAgKQoKICAgICRwcmV2aW91c0NvbmZpZyA9IEdldEN1cnJlbnRDb25maWd1cmF0aW9uT3JEZWZhdWx0CgogICAgJGNvbmZpZyA9IG5ldy1vYmplY3QgcHNvYmplY3QgLXByb3BlcnR5IEB7CiAgICAgICAgYnVpbGRGaWxlTmFtZSA9ICRwcmV2aW91c0NvbmZpZy5idWlsZEZpbGVOYW1lOwogICAgICAgIGZyYW1ld29yayA9ICRwcmV2aW91c0NvbmZpZy5mcmFtZXdvcms7CiAgICAgICAgdGFza05hbWVGb3JtYXQgPSAkcHJldmlvdXNDb25maWcudGFza05hbWVGb3JtYXQ7CiAgICAgICAgdmVyYm9zZUVycm9yID0gJHByZXZpb3VzQ29uZmlnLnZlcmJvc2VFcnJvcjsKICAgICAgICBjb2xvcmVkT3V0cHV0ID0gJHByZXZpb3VzQ29uZmlnLmNvbG9yZWRPdXRwdXQ7CiAgICAgICAgbW9kdWxlcyA9ICRwcmV2aW91c0NvbmZpZy5tb2R1bGVzOwogICAgICAgIG1vZHVsZVNjb3BlID0gICRwcmV2aW91c0NvbmZpZy5tb2R1bGVTY29wZTsKICAgIH0KCiAgICBpZiAoJGZyYW1ld29yaykgewogICAgICAgICRjb25maWcuZnJhbWV3b3JrID0gJGZyYW1ld29yazsKICAgIH0KCiAgICBpZiAoJGJ1aWxkRmlsZSkgewogICAgICAgICRjb25maWcuYnVpbGRGaWxlTmFtZSA9ICRidWlsZEZpbGU7CiAgICB9CgogICAgcmV0dXJuICRjb25maWcKfQoKZnVuY3Rpb24gQ29uZmlndXJlQnVpbGRFbnZpcm9ubWVudCB7CiAgICAkZnJhbWV3b3JrID0gJHBzYWtlLmNvbnRleHQucGVlaygpLmNvbmZpZy5mcmFtZXdvcmsKICAgIGlmICgkZnJhbWV3b3JrIC1jbWF0Y2ggJ14oKD86XGQrXC5cZCspKD86XC5cZCspezAsMX0pKHg4Nnx4NjQpezAsMX0kJykgewogICAgICAgICR2ZXJzaW9uUGFydCA9ICRtYXRjaGVzWzFdCiAgICAgICAgJGJpdG5lc3NQYXJ0ID0gJG1hdGNoZXNbMl0KICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgKCRtc2dzLmVycm9yX2ludmFsaWRfZnJhbWV3b3JrIC1mICRmcmFtZXdvcmspCiAgICB9CiAgICAkdmVyc2lvbnMgPSAkbnVsbAogICAgJGJ1aWxkVG9vbHNWZXJzaW9ucyA9ICRudWxsCiAgICBzd2l0Y2ggKCR2ZXJzaW9uUGFydCkgewogICAgICAgICcxLjAnIHsKICAgICAgICAgICAgJHZlcnNpb25zID0gQCgndjEuMC4zNzA1JykKICAgICAgICB9CiAgICAgICAgJzEuMScgewogICAgICAgICAgICAkdmVyc2lvbnMgPSBAKCd2MS4xLjQzMjInKQogICAgICAgIH0KICAgICAgICAnMi4wJyB7CiAgICAgICAgICAgICR2ZXJzaW9ucyA9IEAoJ3YyLjAuNTA3MjcnKQogICAgICAgIH0KICAgICAgICAnMy4wJyB7CiAgICAgICAgICAgICR2ZXJzaW9ucyA9IEAoJ3YyLjAuNTA3MjcnKQogICAgICAgIH0KICAgICAgICAnMy41JyB7CiAgICAgICAgICAgICR2ZXJzaW9ucyA9IEAoJ3YzLjUnLCAndjIuMC41MDcyNycpCiAgICAgICAgfQogICAgICAgICc0LjAnIHsKICAgICAgICAgICAgJHZlcnNpb25zID0gQCgndjQuMC4zMDMxOScpCiAgICAgICAgfQogICAgICAgICc0LjUuMScgewogICAgICAgICAgICAkdmVyc2lvbnMgPSBAKCd2NC4wLjMwMzE5JykKICAgICAgICAgICAgJGJ1aWxkVG9vbHNWZXJzaW9ucyA9IEAoJzE0LjAnLCAnMTIuMCcpCiAgICAgICAgfQogICAgICAgIGRlZmF1bHQgewogICAgICAgICAgICB0aHJvdyAoJG1zZ3MuZXJyb3JfdW5rbm93bl9mcmFtZXdvcmsgLWYgJHZlcnNpb25QYXJ0LCAkZnJhbWV3b3JrKQogICAgICAgIH0KICAgIH0KCiAgICAkYml0bmVzcyA9ICdGcmFtZXdvcmsnCiAgICBpZiAoJHZlcnNpb25QYXJ0IC1uZSAnMS4wJyAtYW5kICR2ZXJzaW9uUGFydCAtbmUgJzEuMScpIHsKICAgICAgICBzd2l0Y2ggKCRiaXRuZXNzUGFydCkgewogICAgICAgICAgICAneDg2JyB7CiAgICAgICAgICAgICAgICAkYml0bmVzcyA9ICdGcmFtZXdvcmsnCiAgICAgICAgICAgICAgICAkYnVpbGRUb29sc0tleSA9ICdNU0J1aWxkVG9vbHNQYXRoMzInCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJ3g2NCcgewogICAgICAgICAgICAgICAgJGJpdG5lc3MgPSAnRnJhbWV3b3JrNjQnCiAgICAgICAgICAgICAgICAkYnVpbGRUb29sc0tleSA9ICdNU0J1aWxkVG9vbHNQYXRoJwogICAgICAgICAgICB9CiAgICAgICAgICAgIHsgW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJF8pIH0gewogICAgICAgICAgICAgICAgJHB0clNpemUgPSBbU3lzdGVtLkludFB0cl06OlNpemUKICAgICAgICAgICAgICAgIHN3aXRjaCAoJHB0clNpemUpIHsKICAgICAgICAgICAgICAgICAgICA0IHsKICAgICAgICAgICAgICAgICAgICAgICAgJGJpdG5lc3MgPSAnRnJhbWV3b3JrJwogICAgICAgICAgICAgICAgICAgICAgICAkYnVpbGRUb29sc0tleSA9ICdNU0J1aWxkVG9vbHNQYXRoMzInCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIDggewogICAgICAgICAgICAgICAgICAgICAgICAkYml0bmVzcyA9ICdGcmFtZXdvcms2NCcKICAgICAgICAgICAgICAgICAgICAgICAgJGJ1aWxkVG9vbHNLZXkgPSAnTVNCdWlsZFRvb2xzUGF0aCcKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93ICgkbXNncy5lcnJvcl91bmtub3duX3BvaW50ZXJzaXplIC1mICRwdHJTaXplKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBkZWZhdWx0IHsKICAgICAgICAgICAgICAgIHRocm93ICgkbXNncy5lcnJvcl91bmtub3duX2JpdG5lc3NwYXJ0IC1mICRiaXRuZXNzUGFydCwgJGZyYW1ld29yaykKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgICRmcmFtZXdvcmtEaXJzID0gQCgpCiAgICBpZiAoJGJ1aWxkVG9vbHNWZXJzaW9ucyAtbmUgJG51bGwpIHsKICAgICAgICBmb3JlYWNoKCR2ZXIgaW4gJGJ1aWxkVG9vbHNWZXJzaW9ucykgewogICAgICAgICAgICBpZiAoVGVzdC1QYXRoICJIS0xNOlxTT0ZUV0FSRVxNaWNyb3NvZnRcTVNCdWlsZFxUb29sc1ZlcnNpb25zXCR2ZXIiKSB7CiAgICAgICAgICAgICAgICAkZnJhbWV3b3JrRGlycyArPSAoR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiSEtMTTpcU09GVFdBUkVcTWljcm9zb2Z0XE1TQnVpbGRcVG9vbHNWZXJzaW9uc1wkdmVyIiAtTmFtZSAkYnVpbGRUb29sc0tleSkuJGJ1aWxkVG9vbHNLZXkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgICRmcmFtZXdvcmtEaXJzID0gJGZyYW1ld29ya0RpcnMgKyBAKCR2ZXJzaW9ucyB8IGZvcmVhY2ggeyAiJGVudjp3aW5kaXJcTWljcm9zb2Z0Lk5FVFwkYml0bmVzc1wkX1wiIH0pCgogICAgZm9yICgkaSA9IDA7ICRpIC1sdCAkZnJhbWV3b3JrRGlycy5Db3VudDsgJGkrKykgewogICAgICAgICRkaXIgPSAkZnJhbWV3b3JrRGlyc1skaV0KICAgICAgICBpZiAoJGRpciAtTWF0Y2ggIlwkXChSZWdpc3RyeTpIS0VZX0xPQ0FMX01BQ0hJTkUoLio/KUAoLiopXCkiKSB7CiAgICAgICAgICAgICRrZXkgPSAiSEtMTToiICsgJG1hdGNoZXNbMV0KICAgICAgICAgICAgJG5hbWUgPSAkbWF0Y2hlc1syXQogICAgICAgICAgICAkZGlyID0gKEdldC1JdGVtUHJvcGVydHkgLVBhdGggJGtleSAtTmFtZSAkbmFtZSkuJG5hbWUKICAgICAgICAgICAgJGZyYW1ld29ya0RpcnNbJGldID0gJGRpcgogICAgICAgIH0KICAgIH0KCiAgICAkZnJhbWV3b3JrRGlycyB8IGZvcmVhY2ggeyBBc3NlcnQgKHRlc3QtcGF0aCAkXyAtcGF0aFR5cGUgQ29udGFpbmVyKSAoJG1zZ3MuZXJyb3Jfbm9fZnJhbWV3b3JrX2luc3RhbGxfZGlyX2ZvdW5kIC1mICRfKX0KCiAgICAkZW52OnBhdGggPSAoJGZyYW1ld29ya0RpcnMgLWpvaW4gIjsiKSArICI7JGVudjpwYXRoIgogICAgIyBpZiBhbnkgZXJyb3Igb2NjdXJzIGluIGEgUFMgZnVuY3Rpb24gdGhlbiAic3RvcCIgcHJvY2Vzc2luZyBpbW1lZGlhdGVseQogICAgIyB0aGlzIGRvZXMgbm90IGVmZmVjdCBhbnkgZXh0ZXJuYWwgcHJvZ3JhbXMgdGhhdCByZXR1cm4gYSBub24temVybyBleGl0IGNvZGUKICAgICRnbG9iYWw6RXJyb3JBY3Rpb25QcmVmZXJlbmNlID0gIlN0b3AiCn0KCmZ1bmN0aW9uIENsZWFudXBFbnZpcm9ubWVudCB7CiAgICBpZiAoJHBzYWtlLmNvbnRleHQuQ291bnQgLWd0IDApIHsKICAgICAgICAkY3VycmVudENvbnRleHQgPSAkcHNha2UuY29udGV4dC5QZWVrKCkKICAgICAgICAkZW52OnBhdGggPSAkY3VycmVudENvbnRleHQub3JpZ2luYWxFbnZQYXRoCiAgICAgICAgU2V0LUxvY2F0aW9uICRjdXJyZW50Q29udGV4dC5vcmlnaW5hbERpcmVjdG9yeQogICAgICAgICRnbG9iYWw6RXJyb3JBY3Rpb25QcmVmZXJlbmNlID0gJGN1cnJlbnRDb250ZXh0Lm9yaWdpbmFsRXJyb3JBY3Rpb25QcmVmZXJlbmNlCiAgICAgICAgW3ZvaWRdICRwc2FrZS5jb250ZXh0LlBvcCgpCiAgICB9Cn0KCmZ1bmN0aW9uIFNlbGVjdE9iamVjdFdpdGhEZWZhdWx0CnsKICAgIFtDbWRsZXRCaW5kaW5nKCldCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFZhbHVlRnJvbVBpcGVsaW5lPSR0cnVlKV0KICAgICAgICBbUFNPYmplY3RdCiAgICAgICAgJElucHV0T2JqZWN0LAogICAgICAgIFtzdHJpbmddCiAgICAgICAgJE5hbWUsCiAgICAgICAgJFZhbHVlCiAgICApCgogICAgcHJvY2VzcyB7CiAgICAgICAgaWYgKCRfIC1lcSAkbnVsbCkgeyAkVmFsdWUgfQogICAgICAgIGVsc2VpZiAoJF8gfCBHZXQtTWVtYmVyIC1OYW1lICROYW1lKSB7CiAgICAgICAgICAkXy4kTmFtZQogICAgICAgIH0KICAgICAgICBlbHNlaWYgKCgkXyAtaXMgW0hhc2h0YWJsZV0pIC1hbmQgKCRfLktleXMgLWNvbnRhaW5zICROYW1lKSkgewogICAgICAgICAgJF8uJE5hbWUKICAgICAgICB9CiAgICAgICAgZWxzZSB7ICRWYWx1ZSB9CiAgICB9Cn0KCiMgYm9ycm93ZWQgZnJvbSBKZWZmcmV5IFNub3ZlciBodHRwOi8vYmxvZ3MubXNkbi5jb20vcG93ZXJzaGVsbC9hcmNoaXZlLzIwMDYvMTIvMDcvcmVzb2x2ZS1lcnJvci5hc3B4CiMgbW9kaWZpZWQgdG8gYmV0dGVyIGhhbmRsZSBTUUwgZXJyb3JzCmZ1bmN0aW9uIFJlc29sdmVFcnJvcgp7CiAgICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZT0kdHJ1ZSldCiAgICAgICAgJEVycm9yUmVjb3JkPSRFcnJvclswXSwKICAgICAgICBbU3dpdGNoXQogICAgICAgICRTaG9ydAogICAgKQoKICAgIHByb2Nlc3MgewogICAgICAgIGlmICgkXyAtZXEgJG51bGwpIHsgJF8gPSAkRXJyb3JSZWNvcmQgfQogICAgICAgICRleCA9ICRfLkV4Y2VwdGlvbgoKICAgICAgICBpZiAoLW5vdCAkU2hvcnQpIHsKICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAiYG5FcnJvclJlY29yZDp7MH1FcnJvclJlY29yZC5JbnZvY2F0aW9uSW5mbzp7MX1FeGNlcHRpb246YG57Mn0iCiAgICAgICAgICAgICRmb3JtYXR0ZWRfZXJyb3JSZWNvcmQgPSAkXyB8IGZvcm1hdC1saXN0ICogLWZvcmNlIHwgb3V0LXN0cmluZwogICAgICAgICAgICAkZm9ybWF0dGVkX2ludm9jYXRpb25JbmZvID0gJF8uSW52b2NhdGlvbkluZm8gfCBmb3JtYXQtbGlzdCAqIC1mb3JjZSB8IG91dC1zdHJpbmcKICAgICAgICAgICAgJGZvcm1hdHRlZF9leGNlcHRpb24gPSAnJwoKICAgICAgICAgICAgJGkgPSAwCiAgICAgICAgICAgIHdoaWxlICgkZXggLW5lICRudWxsKSB7CiAgICAgICAgICAgICAgICAkaSsrCiAgICAgICAgICAgICAgICAkZm9ybWF0dGVkX2V4Y2VwdGlvbiArPSAoIiRpIiAqIDcwKSArICJgbiIgKwogICAgICAgICAgICAgICAgICAgICgkZXggfCBmb3JtYXQtbGlzdCAqIC1mb3JjZSB8IG91dC1zdHJpbmcpICsgImBuIgogICAgICAgICAgICAgICAgJGV4ID0gJGV4IHwgU2VsZWN0T2JqZWN0V2l0aERlZmF1bHQgLU5hbWUgJ0lubmVyRXhjZXB0aW9uJyAtVmFsdWUgJG51bGwKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuICRlcnJvcl9tZXNzYWdlIC1mICRmb3JtYXR0ZWRfZXJyb3JSZWNvcmQsICRmb3JtYXR0ZWRfaW52b2NhdGlvbkluZm8sICRmb3JtYXR0ZWRfZXhjZXB0aW9uCiAgICAgICAgfQoKICAgICAgICAkbGFzdEV4Y2VwdGlvbiA9IEAoKQogICAgICAgIHdoaWxlICgkZXggLW5lICRudWxsKSB7CiAgICAgICAgICAgICRsYXN0TWVzc2FnZSA9ICRleCB8IFNlbGVjdE9iamVjdFdpdGhEZWZhdWx0IC1OYW1lICdNZXNzYWdlJyAtVmFsdWUgJycKICAgICAgICAgICAgJGxhc3RFeGNlcHRpb24gKz0gKCRsYXN0TWVzc2FnZSAtcmVwbGFjZSAiYG4iLCAnJykKICAgICAgICAgICAgaWYgKCRleCAtaXMgW0RhdGEuU3FsQ2xpZW50LlNxbEV4Y2VwdGlvbl0pIHsKICAgICAgICAgICAgICAgICRsYXN0RXhjZXB0aW9uICs9ICIoTGluZSBbJCgkZXguTGluZU51bWJlcildICIgKwogICAgICAgICAgICAgICAgICAgICJQcm9jZWR1cmUgWyQoJGV4LlByb2NlZHVyZSldIENsYXNzIFskKCRleC5DbGFzcyldICIgKwogICAgICAgICAgICAgICAgICAgICIgTnVtYmVyIFskKCRleC5OdW1iZXIpXSBTdGF0ZSBbJCgkZXguU3RhdGUpXSApIgogICAgICAgICAgICB9CiAgICAgICAgICAgICRleCA9ICRleCB8IFNlbGVjdE9iamVjdFdpdGhEZWZhdWx0IC1OYW1lICdJbm5lckV4Y2VwdGlvbicgLVZhbHVlICRudWxsCiAgICAgICAgfQogICAgICAgICRzaG9ydEV4Y2VwdGlvbiA9ICRsYXN0RXhjZXB0aW9uIC1qb2luICcgLS0+ICcKCiAgICAgICAgJGhlYWRlciA9ICRudWxsCiAgICAgICAgJGN1cnJlbnQgPSAkXwogICAgICAgICRoZWFkZXIgPSAoKCRfLkludm9jYXRpb25JbmZvIHwKICAgICAgICAgICAgU2VsZWN0T2JqZWN0V2l0aERlZmF1bHQgLU5hbWUgJ1Bvc2l0aW9uTWVzc2FnZScgLVZhbHVlICcnKSAtcmVwbGFjZSAiYG4iLCAnICcpLAogICAgICAgICAgICAoJF8gfCBTZWxlY3RPYmplY3RXaXRoRGVmYXVsdCAtTmFtZSAnTWVzc2FnZScgLVZhbHVlICcnKSwKICAgICAgICAgICAgKCRfIHwgU2VsZWN0T2JqZWN0V2l0aERlZmF1bHQgLU5hbWUgJ0V4Y2VwdGlvbicgLVZhbHVlICcnKSB8CiAgICAgICAgICAgICAgICA/IHsgLW5vdCBbU3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkXykgfSB8CiAgICAgICAgICAgICAgICBTZWxlY3QgLUZpcnN0IDEKCiAgICAgICAgJGRlbGltaXRlciA9ICcnCiAgICAgICAgaWYgKCgtbm90IFtTdHJpbmddOjpJc051bGxPckVtcHR5KCRoZWFkZXIpKSAtYW5kCiAgICAgICAgICAgICgtbm90IFtTdHJpbmddOjpJc051bGxPckVtcHR5KCRzaG9ydEV4Y2VwdGlvbikpKQogICAgICAgICAgICB7ICRkZWxpbWl0ZXIgPSAnIFs8PD09Pj5dICcgfQoKICAgICAgICByZXR1cm4gIiQoJGhlYWRlcikkKCRkZWxpbWl0ZXIpRXhjZXB0aW9uOiAkKCRzaG9ydEV4Y2VwdGlvbikiCiAgICB9Cn0KCmZ1bmN0aW9uIFdyaXRlRG9jdW1lbnRhdGlvbigkc2hvd0RldGFpbGVkKSB7CiAgICAkY3VycmVudENvbnRleHQgPSAkcHNha2UuY29udGV4dC5QZWVrKCkKCiAgICBpZiAoJGN1cnJlbnRDb250ZXh0LnRhc2tzLmRlZmF1bHQpIHsKICAgICAgICAkZGVmYXVsdFRhc2tEZXBlbmRlbmNpZXMgPSAkY3VycmVudENvbnRleHQudGFza3MuZGVmYXVsdC5EZXBlbmRzT24KICAgIH0gZWxzZSB7CiAgICAgICAgJGRlZmF1bHRUYXNrRGVwZW5kZW5jaWVzID0gQCgpCiAgICB9CgogICAgJGRvY3MgPSAkY3VycmVudENvbnRleHQudGFza3MuS2V5cyB8IGZvcmVhY2gtb2JqZWN0IHsKICAgICAgICBpZiAoJF8gLWVxICJkZWZhdWx0IikgewogICAgICAgICAgICByZXR1cm4KICAgICAgICB9CgogICAgICAgICR0YXNrID0gJGN1cnJlbnRDb250ZXh0LnRhc2tzLiRfCiAgICAgICAgbmV3LW9iamVjdCBQU09iamVjdCAtcHJvcGVydHkgQHsKICAgICAgICAgICAgTmFtZSA9ICR0YXNrLk5hbWU7CiAgICAgICAgICAgIEFsaWFzID0gJHRhc2suQWxpYXM7CiAgICAgICAgICAgIERlc2NyaXB0aW9uID0gJHRhc2suRGVzY3JpcHRpb247CiAgICAgICAgICAgICJEZXBlbmRzIE9uIiA9ICR0YXNrLkRlcGVuZHNPbiAtam9pbiAiLCAiCiAgICAgICAgICAgIERlZmF1bHQgPSBpZiAoJGRlZmF1bHRUYXNrRGVwZW5kZW5jaWVzIC1jb250YWlucyAkdGFzay5OYW1lKSB7ICR0cnVlIH0KICAgICAgICB9CiAgICB9CiAgICBpZiAoJHNob3dEZXRhaWxlZCkgewogICAgICAgICRkb2NzIHwgc29ydCAnTmFtZScgfCBmb3JtYXQtbGlzdCAtcHJvcGVydHkgTmFtZSxBbGlhcyxEZXNjcmlwdGlvbiwiRGVwZW5kcyBPbiIsRGVmYXVsdAogICAgfSBlbHNlIHsKICAgICAgICAkZG9jcyB8IHNvcnQgJ05hbWUnIHwgZm9ybWF0LXRhYmxlIC1hdXRvU2l6ZSAtd3JhcCAtcHJvcGVydHkgTmFtZSxBbGlhcywiRGVwZW5kcyBPbiIsRGVmYXVsdCxEZXNjcmlwdGlvbgogICAgfQoKfQoKZnVuY3Rpb24gV3JpdGVUYXNrVGltZVN1bW1hcnkoJGludm9rZVBzYWtlRHVyYXRpb24pIHsKICAgIGlmICgkcHNha2UuY29udGV4dC5jb3VudCAtZ3QgMCkgewogICAgICAgICItIiAqIDcwCiAgICAgICAgIkJ1aWxkIFRpbWUgUmVwb3J0IgogICAgICAgICItIiAqIDcwCiAgICAgICAgJGxpc3QgPSBAKCkKICAgICAgICAkY3VycmVudENvbnRleHQgPSAkcHNha2UuY29udGV4dC5QZWVrKCkKICAgICAgICB3aGlsZSAoJGN1cnJlbnRDb250ZXh0LmV4ZWN1dGVkVGFza3MuQ291bnQgLWd0IDApIHsKICAgICAgICAgICAgJHRhc2tLZXkgPSAkY3VycmVudENvbnRleHQuZXhlY3V0ZWRUYXNrcy5Qb3AoKQogICAgICAgICAgICAkdGFzayA9ICRjdXJyZW50Q29udGV4dC50YXNrcy4kdGFza0tleQogICAgICAgICAgICBpZiAoJHRhc2tLZXkgLWVxICJkZWZhdWx0IikgewogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgfQogICAgICAgICAgICAkbGlzdCArPSBuZXctb2JqZWN0IFBTT2JqZWN0IC1wcm9wZXJ0eSBAewogICAgICAgICAgICAgICAgTmFtZSA9ICR0YXNrLk5hbWU7CiAgICAgICAgICAgICAgICBEdXJhdGlvbiA9ICR0YXNrLkR1cmF0aW9uCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgW0FycmF5XTo6UmV2ZXJzZSgkbGlzdCkKICAgICAgICAkbGlzdCArPSBuZXctb2JqZWN0IFBTT2JqZWN0IC1wcm9wZXJ0eSBAewogICAgICAgICAgICBOYW1lID0gIlRvdGFsOiI7CiAgICAgICAgICAgIER1cmF0aW9uID0gJGludm9rZVBzYWtlRHVyYXRpb24KICAgICAgICB9CiAgICAgICAgIyB1c2luZyAib3V0LXN0cmluZyB8IHdoZXJlLW9iamVjdCIgdG8gZmlsdGVyIG91dCB0aGUgYmxhbmsgbGluZSB0aGF0IGZvcm1hdC10YWJsZSBwcmVwZW5kcwogICAgICAgICRsaXN0IHwgZm9ybWF0LXRhYmxlIC1hdXRvU2l6ZSAtcHJvcGVydHkgTmFtZSxEdXJhdGlvbiB8IG91dC1zdHJpbmcgLXN0cmVhbSB8IHdoZXJlLW9iamVjdCB7ICRfIH0KICAgIH0KfQoKREFUQSBtc2dzIHsKY29udmVydGZyb20tc3RyaW5nZGF0YSBAJwogICAgZXJyb3JfaW52YWxpZF90YXNrX25hbWUgPSBUYXNrIG5hbWUgc2hvdWxkIG5vdCBiZSBudWxsIG9yIGVtcHR5IHN0cmluZy4KICAgIGVycm9yX3Rhc2tfbmFtZV9kb2VzX25vdF9leGlzdCA9IFRhc2sgezB9IGRvZXMgbm90IGV4aXN0LgogICAgZXJyb3JfY2lyY3VsYXJfcmVmZXJlbmNlID0gQ2lyY3VsYXIgcmVmZXJlbmNlIGZvdW5kIGZvciB0YXNrIHswfS4KICAgIGVycm9yX21pc3NpbmdfYWN0aW9uX3BhcmFtZXRlciA9IEFjdGlvbiBwYXJhbWV0ZXIgbXVzdCBiZSBzcGVjaWZpZWQgd2hlbiB1c2luZyBQcmVBY3Rpb24gb3IgUG9zdEFjdGlvbiBwYXJhbWV0ZXJzIGZvciB0YXNrIHswfS4KICAgIGVycm9yX2NvcnJ1cHRfY2FsbHN0YWNrID0gQ2FsbCBzdGFjayB3YXMgY29ycnVwdC4gRXhwZWN0ZWQgezB9LCBidXQgZ290IHsxfS4KICAgIGVycm9yX2ludmFsaWRfZnJhbWV3b3JrID0gSW52YWxpZCAuTkVUIEZyYW1ld29yayB2ZXJzaW9uLCB7MH0gc3BlY2lmaWVkLgogICAgZXJyb3JfdW5rbm93bl9mcmFtZXdvcmsgPSBVbmtub3duIC5ORVQgRnJhbWV3b3JrIHZlcnNpb24sIHswfSBzcGVjaWZpZWQgaW4gezF9LgogICAgZXJyb3JfdW5rbm93bl9wb2ludGVyc2l6ZSA9IFVua25vd24gcG9pbnRlciBzaXplICh7MH0pIHJldHVybmVkIGZyb20gU3lzdGVtLkludFB0ci4KICAgIGVycm9yX3Vua25vd25fYml0bmVzc3BhcnQgPSBVbmtub3duIC5ORVQgRnJhbWV3b3JrIGJpdG5lc3MsIHswfSwgc3BlY2lmaWVkIGluIHsxfS4KICAgIGVycm9yX25vX2ZyYW1ld29ya19pbnN0YWxsX2Rpcl9mb3VuZCA9IE5vIC5ORVQgRnJhbWV3b3JrIGluc3RhbGxhdGlvbiBkaXJlY3RvcnkgZm91bmQgYXQgezB9LgogICAgZXJyb3JfYmFkX2NvbW1hbmQgPSBFcnJvciBleGVjdXRpbmcgY29tbWFuZCB7MH0uCiAgICBlcnJvcl9kZWZhdWx0X3Rhc2tfY2Fubm90X2hhdmVfYWN0aW9uID0gJ2RlZmF1bHQnIHRhc2sgY2Fubm90IHNwZWNpZnkgYW4gYWN0aW9uLgogICAgZXJyb3JfZHVwbGljYXRlX3Rhc2tfbmFtZSA9IFRhc2sgezB9IGhhcyBhbHJlYWR5IGJlZW4gZGVmaW5lZC4KICAgIGVycm9yX2R1cGxpY2F0ZV9hbGlhc19uYW1lID0gQWxpYXMgezB9IGhhcyBhbHJlYWR5IGJlZW4gZGVmaW5lZC4KICAgIGVycm9yX2ludmFsaWRfaW5jbHVkZV9wYXRoID0gVW5hYmxlIHRvIGluY2x1ZGUgezB9LiBGaWxlIG5vdCBmb3VuZC4KICAgIGVycm9yX2J1aWxkX2ZpbGVfbm90X2ZvdW5kID0gQ291bGQgbm90IGZpbmQgdGhlIGJ1aWxkIGZpbGUgezB9LgogICAgZXJyb3Jfbm9fZGVmYXVsdF90YXNrID0gJ2RlZmF1bHQnIHRhc2sgcmVxdWlyZWQuCiAgICBlcnJvcl9sb2FkaW5nX21vZHVsZSA9IEVycm9yIGxvYWRpbmcgbW9kdWxlIHswfS4KICAgIHdhcm5pbmdfZGVwcmVjYXRlZF9mcmFtZXdvcmtfdmFyaWFibGUgPSBXYXJuaW5nOiBVc2luZyBnbG9iYWwgdmFyaWFibGUgJGZyYW1ld29yayB0byBzZXQgLk5FVCBmcmFtZXdvcmsgdmVyc2lvbiB1c2VkIGlzIGRlcHJlY2F0ZWQuIEluc3RlYWQgdXNlIEZyYW1ld29yayBmdW5jdGlvbiBvciBjb25maWd1cmF0aW9uIGZpbGUgcHNha2UtY29uZmlnLnBzMS4KICAgIHJlcXVpcmVkX3ZhcmlhYmxlX25vdF9zZXQgPSBWYXJpYWJsZSB7MH0gbXVzdCBiZSBzZXQgdG8gcnVuIHRhc2sgezF9LgogICAgcG9zdGNvbmRpdGlvbl9mYWlsZWQgPSBQb3N0Y29uZGl0aW9uIGZhaWxlZCBmb3IgdGFzayB7MH0uCiAgICBwcmVjb25kaXRpb25fd2FzX2ZhbHNlID0gUHJlY29uZGl0aW9uIHdhcyBmYWxzZSwgbm90IGV4ZWN1dGluZyB0YXNrIHswfS4KICAgIGNvbnRpbnVlX29uX2Vycm9yID0gRXJyb3IgaW4gdGFzayB7MH0uIHsxfQogICAgYnVpbGRfc3VjY2VzcyA9IEJ1aWxkIFN1Y2NlZWRlZCEKJ0AKfQoKaW1wb3J0LWxvY2FsaXplZGRhdGEgLWJpbmRpbmd2YXJpYWJsZSBtc2dzIC1lcnJvcmFjdGlvbiBzaWxlbnRseWNvbnRpbnVlCgokc2NyaXB0OnBzYWtlID0gQHt9CiRwc2FrZS52ZXJzaW9uID0gIjQuNC4xIiAjIGNvbnRhaW5zIHRoZSBjdXJyZW50IHZlcnNpb24gb2YgcHNha2UKJHBzYWtlLmNvbnRleHQgPSBuZXctb2JqZWN0IHN5c3RlbS5jb2xsZWN0aW9ucy5zdGFjayAjIGhvbGRzIG9udG8gdGhlIGN1cnJlbnQgc3RhdGUgb2YgYWxsIHZhcmlhYmxlcwokcHNha2UucnVuX2J5X3BzYWtlX2J1aWxkX3Rlc3RlciA9ICRmYWxzZSAjIGluZGljYXRlcyB0aGF0IGJ1aWxkIGlzIGJlaW5nIHJ1biBieSBwc2FrZS1CdWlsZFRlc3RlcgokcHNha2UuY29uZmlnX2RlZmF1bHQgPSBuZXctb2JqZWN0IHBzb2JqZWN0IC1wcm9wZXJ0eSBAewogICAgYnVpbGRGaWxlTmFtZSA9ICJkZWZhdWx0LnBzMSI7CiAgICBmcmFtZXdvcmsgPSAiNC4wIjsKICAgIHRhc2tOYW1lRm9ybWF0ID0gIkV4ZWN1dGluZyB7MH0iOwogICAgdmVyYm9zZUVycm9yID0gJGZhbHNlOwogICAgY29sb3JlZE91dHB1dCA9ICR0cnVlOwogICAgbW9kdWxlcyA9ICRudWxsOwogICAgbW9kdWxlU2NvcGUgPSAiIjsKfSAjIGNvbnRhaW5zIGRlZmF1bHQgY29uZmlndXJhdGlvbiwgY2FuIGJlIG92ZXJyaWRlbiBpbiBwc2FrZS1jb25maWcucHMxIGluIGRpcmVjdG9yeSB3aXRoIHBzYWtlLnBzbTEgb3IgaW4gZGlyZWN0b3J5IHdpdGggY3VycmVudCBidWlsZCBzY3JpcHQKCiRwc2FrZS5idWlsZF9zdWNjZXNzID0gJGZhbHNlICMgaW5kaWNhdGVzIHRoYXQgdGhlIGN1cnJlbnQgYnVpbGQgd2FzIHN1Y2Nlc3NmdWwKJHBzYWtlLmJ1aWxkX3NjcmlwdF9maWxlID0gJG51bGwgIyBjb250YWlucyBhIFN5c3RlbS5JTy5GaWxlSW5mbyBmb3IgdGhlIGN1cnJlbnQgYnVpbGQgc2NyaXB0CiRwc2FrZS5idWlsZF9zY3JpcHRfZGlyID0gIiIgIyBjb250YWlucyBhIHN0cmluZyB3aXRoIGZ1bGx5LXF1YWxpZmllZCBwYXRoIHRvIGN1cnJlbnQgYnVpbGQgc2NyaXB0CgpMb2FkQ29uZmlndXJhdGlvbgoKZXhwb3J0LW1vZHVsZW1lbWJlciAtZnVuY3Rpb24gSW52b2tlLXBzYWtlLCBJbnZva2UtVGFzaywgVGFzaywgUHJvcGVydGllcywgSW5jbHVkZSwgRm9ybWF0VGFza05hbWUsIFRhc2tTZXR1cCwgVGFza1RlYXJEb3duLCBGcmFtZXdvcmssIEFzc2VydCwgRXhlYyAtdmFyaWFibGUgcHNha2UK
