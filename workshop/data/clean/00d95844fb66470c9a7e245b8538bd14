MSFT_xFileUpload.schema.psm1,37948304b2083c3f5a685206243db10a,Scan result is 1. IsMalware: 0,Q29uZmlndXJhdGlvbiB4RmlsZVVwbG9hZAp7CiAgICA8IyAKICAgIC5TWU5PUFNJUyAKICAgICAgICBDb25maWd1cmF0aW9uIHVwbG9hZHMgZmlsZSBvciBmb2xkZXIgdG8gdGhlIHNtYiBzaGFyZQogICAgLkRFU0NSSVBUSU9OCiAgICAuRVhBTVBMRSAKICAgICAgICB4RmlsZVVwbG9hZCAtZGVzdGluYXRpb25QYXRoICJcXG1hY2hpbmVcc2hhcmUiIC1zb3VyY2VQYXRoICJDOlxmb2xkZXJcZmlsZSIgLXVzZXJuYW1lICJkb21haW5cdXNlciIgLXBhc3N3b3JkICJwYXNzd29yZCIKICAgIC5QQVJBTUVURVIgZGVzdGluYXRpb25QYXRoCiAgICAgICAgVXBsb2FkIGRlc3RpbmF0aW9uIChoYXMgdG8gcG9pbnQgdG8gYSBzaGFyZSBvciBpdCdzIGV4aXN0aW5nIHN1YmZvbGRlcikgZS5nLiBcXG1hY2hpbmVuYW1lXHNoYXJlbmFtZVxkZXN0aW5hdGlvbmZvbGRlcgogICAgLlBBUkFNRVRFUiBzb3VyY2VQYXRoCiAgICAgICAgVXBsb2FkIHNvdXJjZSBlLmcuIEM6XGZvbGRlclxmaWxlLnR4dAogICAgLlBBUkFNRVRFUiBjcmVkZW50aWFsCiAgICAgICAgQ3JlZGVudGlhbHMgdG8gYWNjZXNzIHNoYXJlIHdoZXJlIGZpbGUvZm9sZGVyIHNob3VsZCBiZSB1cGxvYWRlZAogICAgLlBBUkFNRVRFUiBjZXJ0aWZpY2F0ZVRodW1icHJpbnQKICAgICAgICBUaHVtYnByaW50IG9mIHRoZSBjZXJ0aWZpY2F0ZSB3aGljaCBzaG91bGQgYmUgdXNlZCBmb3IgZW5jcnlwdGlvbi9kZWNyeXB0aW9uCiAgICAuTk9URVMKICAgICM+CgogICAgcGFyYW0gKAogICAgICAgIFtwYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCgkJW1N0cmluZ10KICAgICAgICAkZGVzdGluYXRpb25QYXRoLAogICAgICAgIFtwYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCgkJW1N0cmluZ10gICAgICAgIAogICAgICAgICRzb3VyY2VQYXRoLAogICAgICAgIFtQU0NyZWRlbnRpYWxdCiAgICAgICAgJGNyZWRlbnRpYWwsCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkY2VydGlmaWNhdGVUaHVtYnByaW50CiAgICApCgogICAgJGNhY2hlTG9jYXRpb24gPSAiJGVudjpQcm9ncmFtRGF0YVxNaWNyb3NvZnRcV2luZG93c1xQb3dlclNoZWxsXENvbmZpZ3VyYXRpb25cQnVpbHRpblByb3ZDYWNoZVxNU0ZUX3hGaWxlVXBsb2FkIgogICAgCiAgICBpZiAoJGNyZWRlbnRpYWwpCiAgICB7CiAgICAgICAgJHVzZXJuYW1lID0gJGNyZWRlbnRpYWwuVXNlck5hbWUKCiAgICAgICAgIyBFbmNyeXB0IHBhc3N3b3JkCiAgICAgICAgJHBhc3N3b3JkID0gSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrIChbU2NyaXB0QmxvY2tdOjpDcmVhdGUoJGdldEVuY3J5cHRlZFBhc3N3b3JkKSkgLUFyZ3VtZW50TGlzdCAkY3JlZGVudGlhbCwgJGNlcnRpZmljYXRlVGh1bWJwcmludAoKICAgIH0KICAgIAogICAgU2NyaXB0IEZpbGVVcGxvYWQgCiAgICB7CiAgICAgICAgIyBHZXQgc2NyaXB0IGlzIG5vdCBpbXBsZW1lbnRlZCBjYXVzZSByZXVzaW5nIFNjcmlwdCByZXNvdXJjZSdzIHNjaGVtYSBkb2VzIG5vdCBtYWtlIHNlbnNlCiAgICAgICAgR2V0U2NyaXB0ID0geyAKICAgICAgICAgICAgJHJldHVyblZhbHVlID0gQHsKICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CgogICAgICAgICAgICAkcmV0dXJuVmFsdWUKICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICBTZXRTY3JpcHQgPSB7IAoKICAgICAgICAgICAgIyBHZW5lcmF0aW5nIGNyZWRlbnRpYWwgb2JqZWN0IGlmIHBhc3N3b3JkIGFuZCB1c2VybmFtZSBhcmUgc3BlY2lmaWVkCiAgICAgICAgICAgICRjcmVkZW50aWFsID0gJG51bGwKICAgICAgICAgICAgaWYgKCgkdXNpbmc6cGFzc3dvcmQpIC1hbmQgKCR1c2luZzp1c2VybmFtZSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICMgVmFsaWRhdGUgdGhhdCBjZXJ0aWZpY2F0ZSB0aHVtYnByaW50IGlzIHNwZWNpZmllZAogICAgICAgICAgICAgICAgaWYoLW5vdCAkdXNpbmc6Y2VydGlmaWNhdGVUaHVtYnByaW50KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRlcnJvck1lc3NhZ2UgPSAiQ2VydGlmaWNhdGUgdGh1bWJwcmludCBoYXMgdG8gYmUgc3BlY2lmaWVkIGlmIGNyZWRlbnRpYWxzIGFyZSBwcmVzZW50LiIKICAgICAgICAgICAgICAgICAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgKFtTY3JpcHRCbG9ja106OkNyZWF0ZSgkdXNpbmc6dGhyb3dUZXJtaW5hdGluZ0Vycm9yKSkgLUFyZ3VtZW50TGlzdCAiQ2VydGlmaWNhdGVUaHVtYnByaW50SXNSZXF1aXJlZCIsICRlcnJvck1lc3NhZ2UsICJJbnZhbGlkRGF0YSIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBXcml0ZS1EZWJ1ZyAiVXNlcm5hbWUgYW5kIHBhc3N3b3JkIHNwZWNpZmllZC4iCgogICAgICAgICAgICAgICAgIyBEZWNyeXB0IHBhc3N3b3JkCiAgICAgICAgICAgICAgICAkZGVjcnlwdGVkUGFzc3dvcmQgPSBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgKFtTY3JpcHRCbG9ja106OkNyZWF0ZSgkdXNpbmc6Z2V0RGVjcnlwdGVkUGFzc3dvcmQpKSAtQXJndW1lbnRMaXN0ICR1c2luZzpwYXNzd29yZCwgJHVzaW5nOmNlcnRpZmljYXRlVGh1bWJwcmludAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEdlbmVyYXRlIGNyZWRlbnRpYWwKICAgICAgICAgICAgICAgICRzZWN1cmVQYXNzd29yZCA9IENvbnZlcnRUby1TZWN1cmVTdHJpbmcgJGRlY3J5cHRlZFBhc3N3b3JkIC1Bc1BsYWluVGV4dCAtRm9yY2UKICAgICAgICAgICAgICAgICRjcmVkZW50aWFsID0gTmV3LU9iamVjdCBTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbCAoJHVzaW5nOnVzZXJuYW1lLCAkc2VjdXJlUGFzc3dvcmQpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgVmFsaWRhdGUgRGVzdGluYXRpb25QYXRoIGlzIFVOQyBwYXRoCiAgICAgICAgICAgIGlmICghKCR1c2luZzpkZXN0aW5hdGlvblBhdGggLWFzIFtTeXN0ZW0uVXJpXSkuaXNVbmMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRlcnJvck1lc3NhZ2UgPSAiRGVzdGluYXRpb24gcGF0aCAkdXNpbmc6ZGVzdGluYXRpb25QYXRoIGlzIG5vdCBhIHZhbGlkIFVOQyBwYXRoLiIKICAgICAgICAgICAgICAgIEludm9rZS1Db21tYW5kIC1TY3JpcHRCbG9jayAoW1NjcmlwdEJsb2NrXTo6Q3JlYXRlKCR1c2luZzp0aHJvd1Rlcm1pbmF0aW5nRXJyb3IpKSAtQXJndW1lbnRMaXN0ICJEZXN0aW5hdGlvblBhdGhJc05vdFVOQ0ZhaWx1cmUiLCAkZXJyb3JNZXNzYWdlLCAiSW52YWxpZERhdGEiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgVmVyaWZ5IHNvdXJjZSBpcyBsb2NhbHBhdGgKICAgICAgICAgICAgaWYgKCEoKCR1c2luZzpzb3VyY2VQYXRoIC1hcyBbU3lzdGVtLlVyaV0pLlNjaGVtZSAtbWF0Y2ggImZpbGUiKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJGVycm9yTWVzc2FnZSA9ICJTb3VyY2UgcGF0aCAkdXNpbmc6c291cmNlUGF0aCBoYXMgdG8gYmUgbG9jYWwgcGF0aC4iCiAgICAgICAgICAgICAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgKFtTY3JpcHRCbG9ja106OkNyZWF0ZSgkdXNpbmc6dGhyb3dUZXJtaW5hdGluZ0Vycm9yKSkgLUFyZ3VtZW50TGlzdCAiU291cmNlUGF0aElzTm90TG9jYWxGYWlsdXJlIiwgJGVycm9yTWVzc2FnZSwgIkludmFsaWREYXRhIgogICAgICAgICAgICB9CgogICAgICAgICAgICAjIENoZWNrIHdoZXRoZXIgc291cmNlIHBhdGggaXMgZXhpc3RpbmcgZmlsZSBvciBkaXJlY3RvcnkKICAgICAgICAgICAgJHNvdXJjZVBhdGhUeXBlID0gJG51bGwKICAgICAgICAgICAgaWYgKCEoVGVzdC1QYXRoICR1c2luZzpzb3VyY2VQYXRoKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJGVycm9yTWVzc2FnZSA9ICJTb3VyY2UgcGF0aCAkdXNpbmc6c291cmNlUGF0aCBkb2VzIG5vdCBleGlzdC4iCiAgICAgICAgICAgICAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgKFtTY3JpcHRCbG9ja106OkNyZWF0ZSgkdXNpbmc6dGhyb3dUZXJtaW5hdGluZ0Vycm9yKSkgLUFyZ3VtZW50TGlzdCAiU291cmNlUGF0aERvZXNOb3RFeGlzdEZhaWx1cmUiLCAkZXJyb3JNZXNzYWdlLCAiSW52YWxpZERhdGEiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkaXRlbSA9IEdldC1JdGVtICR1c2luZzpzb3VyY2VQYXRoCiAgICAgICAgICAgICAgICBzd2l0Y2ggKCRpdGVtLkdldFR5cGUoKS5OYW1lKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJGaWxlSW5mbyIgewogICAgICAgICAgICAgICAgICAgICAgICAkc291cmNlUGF0aFR5cGUgPSAiRmlsZSIKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICJEaXJlY3RvcnlJbmZvIiB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzb3VyY2VQYXRoVHlwZSA9ICJEaXJlY3RvcnkiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIFdyaXRlLURlYnVnICJTb3VyY2VQYXRoICR1c2luZzpzb3VyY2VQYXRoIGlzIG9mIHR5cGU6ICRzb3VyY2VQYXRoVHlwZSIKCiAgICAgICAgICAgICRwc0RyaXZlID0gJG51bGwKCiAgICAgICAgICAgICMgTW91bnQgdGhlIGRyaXZlIG9ubHkgaWYgY3JlZGVudGlhbHMgYXJlIHNwZWNpZmllZCBhbmQgaXQncyBjdXJyZW50bHkgbm90IGFjY2Vzc2libGUKICAgICAgICAgICAgaWYgKCRjcmVkZW50aWFsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoVGVzdC1QYXRoICR1c2luZzpkZXN0aW5hdGlvblBhdGggLUVycm9yQWN0aW9uIElnbm9yZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1EZWJ1ZyAiRGVzdGluYXRpb24gcGF0aCAkdXNpbmc6ZGVzdGluYXRpb25QYXRoIGlzIGFscmVhZHkgYWNjZXNzaWJsZS4gTm8gbW91bnQgbmVlZGVkLiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkcHNEcml2ZUFyZ3MgPSBAeyBOYW1lID0gKFtndWlkXTo6TmV3R3VpZCgpKTsgUFNQcm92aWRlciA9ICJGaWxlU3lzdGVtIjsgUm9vdCA9ICR1c2luZzpkZXN0aW5hdGlvblBhdGg7IFNjb3BlID0gIlByaXZhdGUiOyBDcmVkZW50aWFsID0gJGNyZWRlbnRpYWwgfQogICAgICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtRGVidWcgIkNyZWF0ZSBwc2RyaXZlIHdpdGggZGVzdGluYXRpb24gcGF0aCAkdXNpbmc6ZGVzdGluYXRpb25QYXRoLi4uIgogICAgICAgICAgICAgICAgICAgICAgICAkcHNEcml2ZSA9IE5ldy1QU0RyaXZlIEBwc0RyaXZlQXJncyAtRXJyb3JBY3Rpb24gU3RvcAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXRjaAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGVycm9yTWVzc2FnZSA9ICJDYW5ub3QgYWNjZXNzIGRlc3RpbmF0aW9uIHBhdGggJHVzaW5nOmRlc3RpbmF0aW9uUGF0aCB3aXRoIGdpdmVuIENyZWRlbnRpYWwiCiAgICAgICAgICAgICAgICAgICAgICAgIEludm9rZS1Db21tYW5kIC1TY3JpcHRCbG9jayAoW1NjcmlwdEJsb2NrXTo6Q3JlYXRlKCR1c2luZzp0aHJvd1Rlcm1pbmF0aW5nRXJyb3IpKSAtQXJndW1lbnRMaXN0ICJEZXN0aW5hdGlvblBhdGhOb3RBY2Nlc3NpYmxlRmFpbHVyZSIsICRlcnJvck1lc3NhZ2UsICJJbnZhbGlkRGF0YSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRyeQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIEdldCBleHBlY3RlZCBkZXN0aW5hdGlvbiBwYXRoCiAgICAgICAgICAgICAgICAkZXhwZWN0ZWREZXN0aW5hdGlvblBhdGggPSAkbnVsbAogICAgICAgICAgICAgICAgaWYgKCEoVGVzdC1QYXRoICR1c2luZzpkZXN0aW5hdGlvblBhdGgpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICMgRGVzdGluYXRpb25QYXRoIGhhcyB0byBleGlzdAogICAgICAgICAgICAgICAgICAgICRlcnJvck1lc3NhZ2UgPSAiSW52YWxpZCBwYXJhbWV0ZXIgdmFsdWVzOiBEZXN0aW5hdGlvblBhdGggZG9lc24ndCBleGlzdCwgYnV0IGhhcyB0byBiZSBleGlzdGluZyBkaXJlY3RvcnkuIgogICAgICAgICAgICAgICAgICAgIFRocm93LVRlcm1pbmF0aW5nRXJyb3IgLWVycm9yTWVzc2FnZSAkZXJyb3JNZXNzYWdlIC1lcnJvckNhdGVnb3J5ICJJbnZhbGlkRGF0YSIgLWVycm9ySWQgIkRlc3RpbmF0aW9uUGF0aERvZXNOb3RFeGlzdEZhaWx1cmUiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJGl0ZW0gPSBHZXQtSXRlbSAkdXNpbmc6ZGVzdGluYXRpb25QYXRoCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICgkaXRlbS5HZXRUeXBlKCkuTmFtZSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJGaWxlSW5mbyIgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBEZXN0aW5hdGlvblBhdGggY2Fubm90IGJlIGZpbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlcnJvck1lc3NhZ2UgPSAiSW52YWxpZCBwYXJhbWV0ZXIgdmFsdWVzOiBEZXN0aW5hdGlvblBhdGggaXMgZmlsZSwgYnV0IGhhcyB0byBiZSBleGlzdGluZyBkaXJlY3RvcnkuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrIChbU2NyaXB0QmxvY2tdOjpDcmVhdGUoJHVzaW5nOnRocm93VGVybWluYXRpbmdFcnJvcikpIC1Bcmd1bWVudExpc3QgIkRlc3RpbmF0aW9uUGF0aENhbm5vdEJlRmlsZUZhaWx1cmUiLCAkZXJyb3JNZXNzYWdlLCAiSW52YWxpZERhdGEiCiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICJEaXJlY3RvcnlJbmZvIiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXhwZWN0ZWREZXN0aW5hdGlvblBhdGggPSBKb2luLVBhdGggJHVzaW5nOmRlc3RpbmF0aW9uUGF0aCAoU3BsaXQtUGF0aCAkdXNpbmc6c291cmNlUGF0aCAtTGVhZikKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBXcml0ZS1EZWJ1ZyAiRXhwZWN0ZWREZXN0aW5hdGlvblBhdGggaXMgJGV4cGVjdGVkRGVzdGluYXRpb25QYXRoIgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgQ29weSBkZXN0aW5hdGlvbiBwYXRoCiAgICAgICAgICAgICAgICB0cnkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1EZWJ1ZyAiQ29weWluZyAkdXNpbmc6c291cmNlUGF0aCB0byAkdXNpbmc6ZGVzdGluYXRpb25QYXRoIgogICAgICAgICAgICAgICAgICAgIENvcHktSXRlbSAtcGF0aCAkdXNpbmc6c291cmNlUGF0aCAtRGVzdGluYXRpb24gJHVzaW5nOmRlc3RpbmF0aW9uUGF0aCAtUmVjdXJzZSAtRm9yY2UgLUVycm9yQWN0aW9uIFN0b3AKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJGVycm9yTWVzc2FnZSA9ICJDb3VsZG4ndCBjb3B5IHNvdXJjZSBwYXRoICR1c2luZzpzb3VyY2VQYXRoIHRvICR1c2luZzpkZXN0aW5hdGlvblBhdGggOiAkKCRfLkV4Y2VwdGlvbikiCiAgICAgICAgICAgICAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrIChbU2NyaXB0QmxvY2tdOjpDcmVhdGUoJHVzaW5nOnRocm93VGVybWluYXRpbmdFcnJvcikpIC1Bcmd1bWVudExpc3QgIkNvcHlEaXJlY3RvcnlPdmVyRmlsZUZhaWx1cmUiLCAkZXJyb3JNZXNzYWdlLCAiSW52YWxpZERhdGEiCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBWZXJpZnkgd2hldGhlciBleHBlY3RlZERlc3RpbmF0aW9uUGF0aCB3YXMgY3JlYXRlZAogICAgICAgICAgICAgICAgaWYgKCEoVGVzdC1QYXRoICRleHBlY3RlZERlc3RpbmF0aW9uUGF0aCkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJGVycm9yTWVzc2FnZSA9ICJEZXN0aW5hdGlvbiBwYXRoICR1c2luZzpkZXN0aW5hdGlvblBhdGggY291bGQgbm90IGJlIGNyZWF0ZWQiCiAgICAgICAgICAgICAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrIChbU2NyaXB0QmxvY2tdOjpDcmVhdGUoJHVzaW5nOnRocm93VGVybWluYXRpbmdFcnJvcikpIC1Bcmd1bWVudExpc3QgIkRlc3RpbmF0aW9uUGF0aE5vdENyZWF0ZWRGYWlsdXJlIiwgJGVycm9yTWVzc2FnZSwgIkludmFsaWREYXRhIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIyBJZiBleHBlY3RlZERlc3RpbmF0aW9uUGF0aCBleGlzdHMKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICIkc291cmNlUGF0aFR5cGUgJGV4cGVjdGVkRGVzdGluYXRpb25QYXRoIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBjcmVhdGVkIgoKICAgICAgICAgICAgICAgICAgICAjIFVwZGF0ZSBjYWNoZQogICAgICAgICAgICAgICAgICAgICR1cGxvYWRlZEl0ZW0gPSBHZXQtSXRlbSAkZXhwZWN0ZWREZXN0aW5hdGlvblBhdGgKICAgICAgICAgICAgICAgICAgICAkbGFzdFdyaXRlVGltZSA9ICR1cGxvYWRlZEl0ZW0uTGFzdFdyaXRlVGltZVV0YwogICAgICAgICAgICAgICAgICAgICRpbnB1dE9iamVjdCA9IEB7fQogICAgICAgICAgICAgICAgICAgICRpbnB1dE9iamVjdFsiTGFzdFdyaXRlVGltZVV0YyJdID0gJGxhc3RXcml0ZVRpbWUKICAgICAgICAgICAgICAgICAgICAka2V5ID0gW3N0cmluZ106OkpvaW4oIiIsIEAoJHVzaW5nOmRlc3RpbmF0aW9uUGF0aCwgJHVzaW5nOnNvdXJjZVBhdGgsICRleHBlY3RlZERlc3RpbmF0aW9uUGF0aCkpLkdldEhhc2hDb2RlKCkuVG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgICRwYXRoID0gSm9pbi1QYXRoICR1c2luZzpjYWNoZUxvY2F0aW9uICRrZXkKICAgICAgICAgICAgICAgICAgICBpZigtbm90IChUZXN0LVBhdGggJHVzaW5nOmNhY2hlTG9jYXRpb24pKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWtkaXIgJHVzaW5nOmNhY2hlTG9jYXRpb24gfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgV3JpdGUtRGVidWcgIlVwZGF0aW5nIGNhY2hlIGZvciBEZXN0aW5hdGlvblBhdGggPSAkdXNpbmc6ZGVzdGluYXRpb25QYXRoIGFuZCBTb3VyY2VQYXRoID0gJHVzaW5nOnNvdXJjZVBhdGguIENhY2hlS2V5ID0gJGtleSIKICAgICAgICAgICAgICAgICAgICBFeHBvcnQtQ2xpWG1sIC1QYXRoICRwYXRoIC1JbnB1dE9iamVjdCAkaW5wdXRPYmplY3QgLUZvcmNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmluYWxseQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIFJlbW92ZSBQU0RyaXZlCiAgICAgICAgICAgICAgICBpZigkcHNEcml2ZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1EZWJ1ZyAiUmVtb3ZpbmcgUFNEcml2ZSBvbiByb290ICQoJHBzRHJpdmUuUm9vdCkiCiAgICAgICAgICAgICAgICAgICAgUmVtb3ZlLVBTRHJpdmUgJHBzRHJpdmUgLUZvcmNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICBUZXN0U2NyaXB0ID0geyAKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR2VuZXJhdGluZyBjcmVkZW50aWFsIG9iamVjdCBpZiBwYXNzd29yZCBhbmQgdXNlcm5hbWUgYXJlIHNwZWNpZmllZAogICAgICAgICAgICAkY3JlZGVudGlhbCA9ICRudWxsCiAgICAgICAgICAgIGlmICgoJHVzaW5nOnBhc3N3b3JkKSAtYW5kICgkdXNpbmc6dXNlcm5hbWUpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIFZhbGlkYXRlIHRoYXQgY2VydGlmaWNhdGUgdGh1bWJwcmludCBpcyBzcGVjaWZpZWQKICAgICAgICAgICAgICAgIGlmKC1ub3QgJHVzaW5nOmNlcnRpZmljYXRlVGh1bWJwcmludCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkZXJyb3JNZXNzYWdlID0gIkNlcnRpZmljYXRlIHRodW1icHJpbnQgaGFzIHRvIGJlIHNwZWNpZmllZCBpZiBjcmVkZW50aWFscyBhcmUgcHJlc2VudC4iCiAgICAgICAgICAgICAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrIChbU2NyaXB0QmxvY2tdOjpDcmVhdGUoJHVzaW5nOnRocm93VGVybWluYXRpbmdFcnJvcikpIC1Bcmd1bWVudExpc3QgIkNlcnRpZmljYXRlVGh1bWJwcmludElzUmVxdWlyZWQiLCAkZXJyb3JNZXNzYWdlLCAiSW52YWxpZERhdGEiCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgV3JpdGUtRGVidWcgIlVzZXJuYW1lIGFuZCBwYXNzd29yZCBzcGVjaWZpZWQuIEdlbmVyYXRpbmcgY3JlZGVudGlhbCIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBEZWNyeXB0IHBhc3N3b3JkCiAgICAgICAgICAgICAgICAkZGVjcnlwdGVkUGFzc3dvcmQgPSBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgKFtTY3JpcHRCbG9ja106OkNyZWF0ZSgkdXNpbmc6Z2V0RGVjcnlwdGVkUGFzc3dvcmQpKSAtQXJndW1lbnRMaXN0ICR1c2luZzpwYXNzd29yZCwgJHVzaW5nOmNlcnRpZmljYXRlVGh1bWJwcmludAoKICAgICAgICAgICAgICAgICMgR2VuZXJhdGUgY3JlZGVudGlhbAogICAgICAgICAgICAgICAgJHNlY3VyZVBhc3N3b3JkID0gQ29udmVydFRvLVNlY3VyZVN0cmluZyAkZGVjcnlwdGVkUGFzc3dvcmQgLUFzUGxhaW5UZXh0IC1Gb3JjZQogICAgICAgICAgICAgICAgJGNyZWRlbnRpYWwgPSBOZXctT2JqZWN0IFN5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsICgkdXNpbmc6dXNlcm5hbWUsICRzZWN1cmVQYXNzd29yZCkKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFdyaXRlLURlYnVnICJObyBjcmVkZW50aWFscyBzcGVjaWZpZWQiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgVmFsaWRhdGUgRGVzdGluYXRpb25QYXRoIGlzIFVOQyBwYXRoCiAgICAgICAgICAgIGlmICghKCR1c2luZzpkZXN0aW5hdGlvblBhdGggLWFzIFtTeXN0ZW0uVXJpXSkuaXNVbmMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRlcnJvck1lc3NhZ2UgPSAiRGVzdGluYXRpb24gcGF0aCAkdXNpbmc6ZGVzdGluYXRpb25QYXRoIGlzIG5vdCBhIHZhbGlkIFVOQyBwYXRoLiIKICAgICAgICAgICAgICAgIEludm9rZS1Db21tYW5kIC1TY3JpcHRCbG9jayAoW1NjcmlwdEJsb2NrXTo6Q3JlYXRlKCR1c2luZzp0aHJvd1Rlcm1pbmF0aW5nRXJyb3IpKSAtQXJndW1lbnRMaXN0ICJEZXN0aW5hdGlvblBhdGhJc05vdFVOQ0ZhaWx1cmUiLCAkZXJyb3JNZXNzYWdlLCAiSW52YWxpZERhdGEiCgogICAgICAgICAgICB9CgogICAgICAgICAgICAjIENoZWNrIHdoZXRoZXIgc291cmNlIHBhdGggaXMgZXhpc3RpbmcgZmlsZSBvciBkaXJlY3RvcnkgKG5lZWRlZCBmb3IgZXhwZWN0ZWREZXN0aW5hdGlvblBhdGgpCiAgICAgICAgICAgICRzb3VyY2VQYXRoVHlwZSA9ICRudWxsCiAgICAgICAgICAgIGlmICghKFRlc3QtUGF0aCAkdXNpbmc6c291cmNlUGF0aCkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRlcnJvck1lc3NhZ2UgPSAiU291cmNlIHBhdGggJHVzaW5nOnNvdXJjZVBhdGggZG9lcyBub3QgZXhpc3QuIgogICAgICAgICAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrIChbU2NyaXB0QmxvY2tdOjpDcmVhdGUoJHVzaW5nOnRocm93VGVybWluYXRpbmdFcnJvcikpIC1Bcmd1bWVudExpc3QgIlNvdXJjZVBhdGhEb2VzTm90RXhpc3RGYWlsdXJlIiwgJGVycm9yTWVzc2FnZSwgIkludmFsaWREYXRhIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJGl0ZW0gPSBHZXQtSXRlbSAkdXNpbmc6c291cmNlUGF0aAogICAgICAgICAgICAgICAgc3dpdGNoICgkaXRlbS5HZXRUeXBlKCkuTmFtZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAiRmlsZUluZm8iIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNvdXJjZVBhdGhUeXBlID0gIkZpbGUiCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAiRGlyZWN0b3J5SW5mbyIgewogICAgICAgICAgICAgICAgICAgICAgICAkc291cmNlUGF0aFR5cGUgPSAiRGlyZWN0b3J5IgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBXcml0ZS1EZWJ1ZyAiU291cmNlUGF0aCAkdXNpbmc6c291cmNlUGF0aCBpcyBvZiB0eXBlOiAkc291cmNlUGF0aFR5cGUiCgogICAgICAgICAgICAkcHNEcml2ZSA9ICRudWxsCgogICAgICAgICAgICAjIE1vdW50IHRoZSBkcml2ZSBvbmx5IGlmIGNyZWRlbnRpYWxzIGFyZSBzcGVjaWZpZWQgYW5kIGl0J3MgY3VycmVudGx5IG5vdCBhY2Nlc3NpYmxlCiAgICAgICAgICAgIGlmICgkY3JlZGVudGlhbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAkdXNpbmc6ZGVzdGluYXRpb25QYXRoIC1FcnJvckFjdGlvbiBJZ25vcmUpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtRGVidWcgIkRlc3RpbmF0aW9uIHBhdGggJHVzaW5nOmRlc3RpbmF0aW9uUGF0aCBpcyBhbHJlYWR5IGFjY2Vzc2libGUuIE5vIG1vdW50IG5lZWRlZC4iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJHBzRHJpdmVBcmdzID0gQHsgTmFtZSA9IChbZ3VpZF06Ok5ld0d1aWQoKSk7IFBTUHJvdmlkZXIgPSAiRmlsZVN5c3RlbSI7IFJvb3QgPSAkdXNpbmc6ZGVzdGluYXRpb25QYXRoOyBTY29wZSA9ICJQcml2YXRlIjsgQ3JlZGVudGlhbCA9ICRjcmVkZW50aWFsIH0KICAgICAgICAgICAgICAgICAgICB0cnkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLURlYnVnICJDcmVhdGUgcHNkcml2ZSB3aXRoIGRlc3RpbmF0aW9uIHBhdGggJHVzaW5nOmRlc3RpbmF0aW9uUGF0aC4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgJHBzRHJpdmUgPSBOZXctUFNEcml2ZSBAcHNEcml2ZUFyZ3MgLUVycm9yQWN0aW9uIFN0b3AKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2gKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICRlcnJvck1lc3NhZ2UgPSAiQ2Fubm90IGFjY2VzcyBkZXN0aW5hdGlvbiBwYXRoICR1c2luZzpkZXN0aW5hdGlvblBhdGggd2l0aCBnaXZlbiBDcmVkZW50aWFsIgogICAgICAgICAgICAgICAgICAgICAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgKFtTY3JpcHRCbG9ja106OkNyZWF0ZSgkdXNpbmc6dGhyb3dUZXJtaW5hdGluZ0Vycm9yKSkgLUFyZ3VtZW50TGlzdCAiRGVzdGluYXRpb25QYXRoTm90QWNjZXNzaWJsZUZhaWx1cmUiLCAkZXJyb3JNZXNzYWdlLCAiSW52YWxpZERhdGEiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB0cnkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIyBHZXQgZXhwZWN0ZWQgZGVzdGluYXRpb24gcGF0aAogICAgICAgICAgICAgICAgJGV4cGVjdGVkRGVzdGluYXRpb25QYXRoID0gJG51bGwKICAgICAgICAgICAgICAgIGlmICghKFRlc3QtUGF0aCAkdXNpbmc6ZGVzdGluYXRpb25QYXRoKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAjIERlc3RpbmF0aW9uUGF0aCBoYXMgdG8gZXhpc3QKICAgICAgICAgICAgICAgICAgICAkZXJyb3JNZXNzYWdlID0gIkludmFsaWQgcGFyYW1ldGVyIHZhbHVlczogRGVzdGluYXRpb25QYXRoIGRvZXNuJ3QgZXhpc3Qgb3IgaXMgbm90IGFjY2Vzc2libGUuIERlc3RpbmF0aW9uUGF0aCBoYXMgdG8gYmUgZXhpc3RpbmcgZGlyZWN0b3J5LiIKICAgICAgICAgICAgICAgICAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgKFtTY3JpcHRCbG9ja106OkNyZWF0ZSgkdXNpbmc6dGhyb3dUZXJtaW5hdGluZ0Vycm9yKSkgLUFyZ3VtZW50TGlzdCAiRGVzdGluYXRpb25QYXRoRG9lc05vdEV4aXN0RmFpbHVyZSIsICRlcnJvck1lc3NhZ2UsICJJbnZhbGlkRGF0YSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkaXRlbSA9IEdldC1JdGVtICR1c2luZzpkZXN0aW5hdGlvblBhdGgKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKCRpdGVtLkdldFR5cGUoKS5OYW1lKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIkZpbGVJbmZvIiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIERlc3RpbmF0aW9uUGF0aCBjYW5ub3QgYmUgZmlsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGVycm9yTWVzc2FnZSA9ICJJbnZhbGlkIHBhcmFtZXRlciB2YWx1ZXM6IERlc3RpbmF0aW9uUGF0aCBpcyBmaWxlLCBidXQgaGFzIHRvIGJlIGV4aXN0aW5nIGRpcmVjdG9yeS4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgKFtTY3JpcHRCbG9ja106OkNyZWF0ZSgkdXNpbmc6dGhyb3dUZXJtaW5hdGluZ0Vycm9yKSkgLUFyZ3VtZW50TGlzdCAiRGVzdGluYXRpb25QYXRoQ2Fubm90QmVGaWxlRmFpbHVyZSIsICRlcnJvck1lc3NhZ2UsICJJbnZhbGlkRGF0YSIKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgIkRpcmVjdG9yeUluZm8iIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleHBlY3RlZERlc3RpbmF0aW9uUGF0aCA9IEpvaW4tUGF0aCAkdXNpbmc6ZGVzdGluYXRpb25QYXRoIChTcGxpdC1QYXRoICR1c2luZzpzb3VyY2VQYXRoIC1MZWFmKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIFdyaXRlLURlYnVnICJFeHBlY3RlZERlc3RpbmF0aW9uUGF0aCBpcyAkZXhwZWN0ZWREZXN0aW5hdGlvblBhdGgiCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBDaGVjayB3aGV0aGVyIEV4cGVjdGVkRGVzdGluYXRpb25QYXRoIGV4aXN0cyBhbmQgaGFzIGV4cGVjdGVkIHR5cGUKICAgICAgICAgICAgICAgICRpdGVtRXhpc3RzID0gJGZhbHNlCiAgICAgICAgICAgICAgICBpZiAoIShUZXN0LVBhdGggJGV4cGVjdGVkRGVzdGluYXRpb25QYXRoKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1EZWJ1ZyAiRXhwZWN0ZWQgZGVzdGluYXRpb24gcGF0aCBkb2Vzbid0IGV4aXN0IG9yIGlzIG5vdCBhY2Nlc3NpYmxlIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIyBJZiBleHBlY3RlZERlc3RpbmF0aW9uUGF0aCBleGlzdHMKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkZXhwZWN0ZWRJdGVtID0gR2V0LUl0ZW0gJGV4cGVjdGVkRGVzdGluYXRpb25QYXRoCiAgICAgICAgICAgICAgICAgICAgJGV4cGVjdGVkSXRlbVR5cGUgPSAkZXhwZWN0ZWRJdGVtLkdldFR5cGUoKS5OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgSWYgZXhwZWN0ZWREZXN0aW5hdGlvblBhdGggaGFzIHNhbWUgdHlwZSBhcyBzb3VyY2VQYXRoVHlwZSwgd2UgbmVlZCB0byB2ZXJpZnkgY2FjaGUgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgbm8gdXBsb2FkIGlzIG5lZWRlZAogICAgICAgICAgICAgICAgICAgIGlmICgoKCRleHBlY3RlZEl0ZW1UeXBlIC1lcSAiRmlsZUluZm8iKSAtYW5kICgkc291cmNlUGF0aFR5cGUgLWVxICJGaWxlIikpIC1vciAoKCRleHBlY3RlZEl0ZW1UeXBlIC1lcSAiRGlyZWN0b3J5SW5mbyIpIC1hbmQgKCRzb3VyY2VQYXRoVHlwZSAtZXEgIkRpcmVjdG9yeSIpKSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgR2V0IGNhY2hlCiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLURlYnVnICJHZXR0aW5nIGNhY2hlIGZvciAkZXhwZWN0ZWREZXN0aW5hdGlvblBhdGgiCiAgICAgICAgICAgICAgICAgICAgICAgICRjYWNoZUNvbnRlbnQgPSAkbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAka2V5ID0gW3N0cmluZ106OkpvaW4oIiIsIEAoJHVzaW5nOmRlc3RpbmF0aW9uUGF0aCwgJHVzaW5nOnNvdXJjZVBhdGgsICRleHBlY3RlZERlc3RpbmF0aW9uUGF0aCkpLkdldEhhc2hDb2RlKCkuVG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgICAgICAkcGF0aCA9IEpvaW4tUGF0aCAkdXNpbmc6Y2FjaGVMb2NhdGlvbiAka2V5CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLURlYnVnICJMb29raW5nIGZvciBjYWNoZSB1bmRlciAkcGF0aCIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoVGVzdC1QYXRoICRwYXRoKSkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtRGVidWcgIk5vIGNhY2hlIGZvdW5kIGZvciBEZXN0aW5hdGlvblBhdGggPSAkdXNpbmc6ZGVzdGluYXRpb25QYXRoIGFuZCBTb3VyY2VQYXRoID0gJHVzaW5nOnNvdXJjZVBhdGguIENhY2hlS2V5ID0gJGtleSIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjYWNoZUNvbnRlbnQgPSBJbXBvcnQtQ2xpWG1sICRwYXRoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1EZWJ1ZyAiRm91bmQgY2FjaGUgZm9yIERlc3RpbmF0aW9uUGF0aCA9ICR1c2luZzpkZXN0aW5hdGlvblBhdGggYW5kIFNvdXJjZVBhdGggPSAkdXNpbmc6c291cmNlUGF0aC4gQ2FjaGVLZXkgPSAka2V5IgogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAjIFZlcmlmeSB3aGV0aGVyIGNhY2hlIHJlZmxlY3RzIGN1cnJlbnQgc3RhdGUgb3IgdXBsb2FkIGlzIG5lZWRlZAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNhY2hlQ29udGVudCAtbmUgJG51bGwgLWFuZCAoJGNhY2hlQ29udGVudC5MYXN0V3JpdGVUaW1lVXRjIC1lcSAkZXhwZWN0ZWRJdGVtLkxhc3RXcml0ZVRpbWVVdGMpKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE5vIHVwbG9hZCBuZWVkZWQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtRGVidWcgIkNhY2hlIHJlZmxlY3RzIGN1cnJlbnQgc3RhdGUuIE5vIG5lZWQgZm9yIHVwbG9hZC4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaXRlbUV4aXN0cyA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1EZWJ1ZyAiQ2FjaGUgaXMgZW1wdHkgb3IgaXQgZG9lc24ndCByZWZsZWN0IGN1cnJlbnQgc3RhdGUuIFVwbG9hZCB3aWxsIGJlIHBlcmZvcm1lZC4iCiAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLURlYnVnICJFeHBlY3RlZCBkZXN0aW5hdGlvbiBwYXRoOiAkZXhwZWN0ZWREZXN0aW5hdGlvblBhdGggaXMgb2YgdHlwZSAkZXhwZWN0ZWRJdGVtVHlwZSwgYWx0aG91Z2ggc291cmNlIHBhdGggaXMgJHNvdXJjZVBhdGhUeXBlIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmaW5hbGx5CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICMgUmVtb3ZlIFBTRHJpdmUKICAgICAgICAgICAgICAgIGlmKCRwc0RyaXZlKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLURlYnVnICJSZW1vdmluZyBQU0RyaXZlIG9uIHJvb3QgJCgkcHNEcml2ZS5Sb290KSIKICAgICAgICAgICAgICAgICAgICBSZW1vdmUtUFNEcml2ZSAkcHNEcml2ZSAtRm9yY2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuICRpdGVtRXhpc3RzCgogICAgICAgIH07CiAgICB9Cn0KCiMgRW5jcnlwdHMgcGFzc3dvcmQgdXNpbmcgdGhlIGRlZmluZWQgcHVibGljIGtleQokZ2V0RW5jcnlwdGVkUGFzc3dvcmQgPSBAJwogICAgcGFyYW0gKAogICAgICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICAgICAgW1BTQ3JlZGVudGlhbF0gJGNyZWRlbnRpYWwsCiAgICAgICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgICAgICBbU3RyaW5nXSAkY2VydGlmaWNhdGVUaHVtYnByaW50CiAgICAgICAgKQoKICAgICR2YWx1ZSA9ICRjcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuUGFzc3dvcmQKICAgIAogICAgJGNlcnQgPSBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgKFtTY3JpcHRCbG9ja106OkNyZWF0ZSgkZ2V0Q2VydGlmaWNhdGUpKSAtQXJndW1lbnRMaXN0ICRjZXJ0aWZpY2F0ZVRodW1icHJpbnQKICAgIAogICAgJGVuY3J5cHRlZFBhc3N3b3JkID0gJG51bGwKCiAgICBpZigkY2VydCkKICAgIHsKICAgICAgICAjIENhc3QgdGhlIHB1YmxpYyBrZXkgY29ycmVjdGx5CiAgICAgICAgJHJzYVByb3ZpZGVyID0gW1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuUlNBQ3J5cHRvU2VydmljZVByb3ZpZGVyXSRjZXJ0LlB1YmxpY0tleS5LZXkKICAgICAgICAKICAgICAgICBpZigkcnNhUHJvdmlkZXIgLWVxICRudWxsKQogICAgICAgIHsKICAgICAgICAgICAgJGVycm9yTWVzc2FnZSA9ICJDb3VsZCBub3QgZ2V0IHB1YmxpYyBrZXkgZnJvbSBjZXJ0aWZpY2F0ZSB3aXRoIHRodW1icHJpbnQ6ICRjZXJ0aWZpY2F0ZVRodW1icHJpbnQgLiBQbGVhc2UgdmVyaWZ5IGNlcnRpZmljYXRlIGlzIHZhbGlkIGZvciBlbmNyeXB0aW9uLiIKICAgICAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrIChbU2NyaXB0QmxvY2tdOjpDcmVhdGUoJHRocm93VGVybWluYXRpbmdFcnJvcikpIC1Bcmd1bWVudExpc3QgIkRlY3J5cHRpb25DZXJ0aWZpY2F0ZU5vdEZvdW5kIiwgJGVycm9yTWVzc2FnZSwgIkludmFsaWRPcGVyYXRpb24iCiAgICAgICAgfQoKICAgICAgICAjIENvbnZlcnQgdG8gYSBieXRlIGFycmF5CiAgICAgICAgJGtleWJ5dGVzID0gW1N5c3RlbS5UZXh0LkVuY29kaW5nXTo6VU5JQ09ERS5HZXRCeXRlcygkdmFsdWUpCgogICAgICAgICMgQWRkIGEgbnVsbCB0ZXJtaW5hdG9yIHRvIHRoZSBieXRlIGFycmF5CiAgICAgICAgJGtleWJ5dGVzICs9IDAKICAgICAgICAka2V5Ynl0ZXMgKz0gMAoKICAgICAgICAjIEVuY3J5cHQgdXNpbmcgdGhlIHB1YmxpYyBrZXkKICAgICAgICAkZW5jYnl0ZXMgPSAkcnNhUHJvdmlkZXIuRW5jcnlwdCgka2V5Ynl0ZXMsICRmYWxzZSkKCiAgICAgICAgIyBSZXR1cm4gYSBzdHJpbmcKICAgICAgICAkZW5jcnlwdGVkUGFzc3dvcmQgPSBbQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKCRlbmNieXRlcykKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICAkZXJyb3JNZXNzYWdlID0gIkNvdWxkIG5vdCBmaW5kIGNlcnRpZmljYXRlIHdoaWNoIG1hdGNoZXMgdGh1bWJwcmludDogJGNlcnRpZmljYXRlVGh1bWJwcmludCAuIENvdWxkIG5vdCBlbmNyeXB0IHBhc3N3b3JkIgogICAgICAgIEludm9rZS1Db21tYW5kIC1TY3JpcHRCbG9jayAoW1NjcmlwdEJsb2NrXTo6Q3JlYXRlKCR0aHJvd1Rlcm1pbmF0aW5nRXJyb3IpKSAtQXJndW1lbnRMaXN0ICJFbmNyeXB0aW9uQ2VydGlmaWNhdGVOb3QiLCAkZXJyb3JNZXNzYWdlLCAiSW52YWxpZE9wZXJhdGlvbiIKICAgIH0KCiAgICByZXR1cm4gJGVuY3J5cHRlZFBhc3N3b3JkCidACgojIFJldHJpZXZlcyBjZXJ0aWZpY2F0ZSBieSB0aHVtYnByaW50CiRnZXRDZXJ0aWZpY2F0ZSA9IEAnCiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICBbc3RyaW5nXSAkY2VydGlmaWNhdGVUaHVtYnByaW50CiAgICApCgogICAgJGNlcnQgPSAkbnVsbAoKICAgIGZvcmVhY2goJGNlcnRJbmRleCBpbiBHZXQtQ2hpbGRpdGVtIGNlcnQ6XExvY2FsTWFjaGluZVxNeSkKICAgIHsKICAgICAgICBpZigkY2VydEluZGV4LlRodW1icHJpbnQgLW1hdGNoICRjZXJ0aWZpY2F0ZVRodW1icHJpbnQpCiAgICAgICAgewogICAgICAgICAgICAkY2VydCA9ICRjZXJ0SW5kZXgKICAgICAgICAgICAgYnJlYWsKICAgICAgICB9CiAgICB9CgogICAgaWYoLW5vdCAkY2VydCkKICAgIHsgICAgICAgIAogICAgICAgICRlcnJvck1lc3NhZ2UgPSAiRXJyb3IgUmVhZGluZyBjZXJ0aWZpY2F0ZSBzdG9yZSBmb3IgezB9LiBQbGVhc2UgdmVyaWZ5IHRodW1icHJpbnQgaXMgY29ycmVjdCBhbmQgY2VydGlmaWNhdGUgYmVsb25ncyB0byBjZXJ0OlxMb2NhbE1hY2hpbmVcTXkgc3RvcmUuIiAtZiAke2NlcnRpZmljYXRlVGh1bWJwcmludH07CiAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrIChbU2NyaXB0QmxvY2tdOjpDcmVhdGUoJHRocm93VGVybWluYXRpbmdFcnJvcikpIC1Bcmd1bWVudExpc3QgIkludmFsaWRQYXRoU3BlY2lmaWVkIiwgJGVycm9yTWVzc2FnZSwgIkludmFsaWRPcGVyYXRpb24iIAogICAgfQogICAgZWxzZQogICAgewogICAgICAgICRjZXJ0CiAgICB9CidACgojIFRocm93cyB0ZXJtaW5hdGluZyBlcnJvciBzcGVjaWZpZWQgZXJyb3JDYXRlZ29yeSwgZXJyb3JJZCBhbmQgZXJyb3JNZXNzYWdlCiR0aHJvd1Rlcm1pbmF0aW5nRXJyb3IgPSBAJwogICAgcGFyYW0oCiAgICAgICAgW3BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgW1N5c3RlbS5TdHJpbmddIAogICAgICAgICRlcnJvcklkLAogICAgICAgIFtwYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgIFtTeXN0ZW0uU3RyaW5nXQogICAgICAgICRlcnJvck1lc3NhZ2UsCiAgICAgICAgW3BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgJGVycm9yQ2F0ZWdvcnkKICAgICkKCiAgICAkZXhjZXB0aW9uID0gTmV3LU9iamVjdCBTeXN0ZW0uSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbiAkZXJyb3JNZXNzYWdlIAogICAgJGVycm9yUmVjb3JkID0gTmV3LU9iamVjdCBTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLkVycm9yUmVjb3JkICRleGNlcHRpb24sICRlcnJvcklkLCAkZXJyb3JDYXRlZ29yeSwgJG51bGwKICAgIHRocm93ICRlcnJvclJlY29yZAonQAoKIyBEZWNyeXB0cyBwYXNzd29yZCB1c2luZyB0aGUgZGVmaW5lZCBwcml2YXRlIGtleQokZ2V0RGVjcnlwdGVkUGFzc3dvcmQgPSBAJwogICAgcGFyYW0gKAogICAgICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICAgICAgW1N0cmluZ10gJHZhbHVlLAogICAgICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICAgICAgW1N0cmluZ10gJGNlcnRpZmljYXRlVGh1bWJwcmludAogICAgICAgICkKCiAgICAkY2VydCA9ICRudWxsCgogICAgZm9yZWFjaCgkY2VydEluZGV4IGluIEdldC1DaGlsZGl0ZW0gY2VydDpcTG9jYWxNYWNoaW5lXE15KQogICAgewogICAgICAgIGlmKCRjZXJ0SW5kZXguVGh1bWJwcmludCAtbWF0Y2ggJGNlcnRpZmljYXRlVGh1bWJwcmludCkKICAgICAgICB7CiAgICAgICAgICAgICRjZXJ0ID0gJGNlcnRJbmRleAogICAgICAgICAgICBicmVhawogICAgICAgIH0KICAgIH0KCiAgICBpZigtbm90ICRjZXJ0KQogICAgeyAgICAgICAgCiAgICAgICAgJGVycm9yTWVzc2FnZSA9ICJFcnJvciBSZWFkaW5nIGNlcnRpZmljYXRlIHN0b3JlIGZvciB7MH0uIFBsZWFzZSB2ZXJpZnkgdGh1bWJwcmludCBpcyBjb3JyZWN0IGFuZCBjZXJ0aWZpY2F0ZSBiZWxvbmdzIHRvIGNlcnQ6XExvY2FsTWFjaGluZVxNeSBzdG9yZS4iIC1mICR7Y2VydGlmaWNhdGVUaHVtYnByaW50fTsKICAgICAgICAkZXhjZXB0aW9uID0gTmV3LU9iamVjdCBTeXN0ZW0uSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbiAkZXJyb3JNZXNzYWdlIAogICAgICAgICRlcnJvclJlY29yZCA9IE5ldy1PYmplY3QgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5FcnJvclJlY29yZCAkZXhjZXB0aW9uLCAiSW52YWxpZFBhdGhTcGVjaWZpZWQiLCAiSW52YWxpZE9wZXJhdGlvbiIsICRudWxsCiAgICAgICAgdGhyb3cgJGVycm9yUmVjb3JkCiAgICB9CgogICAgJGRlY3J5cHRlZFBhc3N3b3JkID0gJG51bGwKCiAgICAjIEdldCBSU0EgcHJvdmlkZXIKICAgICRyc2FQcm92aWRlciA9IFtTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LlJTQUNyeXB0b1NlcnZpY2VQcm92aWRlcl0kY2VydC5Qcml2YXRlS2V5CgogICAgaWYoJHJzYVByb3ZpZGVyIC1lcSAkbnVsbCkKICAgIHsKICAgICAgICAkZXJyb3JNZXNzYWdlID0gIkNvdWxkIG5vdCBnZXQgcHJpdmF0ZSBrZXkgZnJvbSBjZXJ0aWZpY2F0ZSB3aXRoIHRodW1icHJpbnQ6ICRjZXJ0aWZpY2F0ZVRodW1icHJpbnQgLiBQbGVhc2UgdmVyaWZ5IGNlcnRpZmljYXRlIGlzIHZhbGlkIGZvciBkZWNyeXB0aW9uLiIKICAgICAgICAkZXhjZXB0aW9uID0gTmV3LU9iamVjdCBTeXN0ZW0uSW52YWxpZE9wZXJhdGlvbkV4Y2VwdGlvbiAkZXJyb3JNZXNzYWdlIAogICAgICAgICRlcnJvclJlY29yZCA9IE5ldy1PYmplY3QgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5FcnJvclJlY29yZCAkZXhjZXB0aW9uLCAiRGVjcnlwdGlvbkNlcnRpZmljYXRlTm90Rm91bmQiLCAiSW52YWxpZE9wZXJhdGlvbiIsICRudWxsCiAgICAgICAgdGhyb3cgJGVycm9yUmVjb3JkCiAgICB9CgogICAgIyBDb252ZXJ0IHRvIGJ5dGVzIGFycmF5CiAgICAkZW5jQnl0ZXMgPSBbQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmcoJHZhbHVlKQoKICAgICMgRGVjcnlwdCBieXRlcwogICAgJGRlY3J5cHRlZEJ5dGVzID0gJHJzYVByb3ZpZGVyLkRlY3J5cHQoJGVuY0J5dGVzLCAkZmFsc2UpCiAgICAgICAgCiAgICAjIENvbnZlcnQgdG8gc3RyaW5nCiAgICAkZGVjcnlwdGVkUGFzc3dvcmQgPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVbmljb2RlLkdldFN0cmluZygkZGVjcnlwdGVkQnl0ZXMpCgogICAgcmV0dXJuICRkZWNyeXB0ZWRQYXNzd29yZAonQA==
