Configure-SP2016-Functions.ps1,fb14d77a45e3567f679fc7a97367a412,Scan result is 1. IsMalware: 0,w6/Cu8K/IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIE1LOiBzZWFyY2ggZm9yIE1LIHRvIHNlZSB3aGF0IHdhcyBjaGFuZ2VkCiMgICAgIFJlcGxhY2VkIGFsbCBXcml0ZS1Ib3N0IHdpdGggbG9nCiMgICAgIFJlbW92ZWQgY29kZSB0aGF0IGlzIE5PVCByZWxhdGVkIHRvIFdpbmRvd3MgMjAxMiBvciAyMDEyIFIyCiMgICAgIGVnOiBJZiAoISgkcmVtb3RlUXVlcnlPUy5WZXJzaW9uLkNvbnRhaW5zKCI2LjIiKSkgLWFuZCAhKCRyZW1vdGVRdWVyeU9TLlZlcnNpb24uQ29udGFpbnMoIjYuMyIpKSkgIyBPbmx5IHBlcmZvcm0gdGhlIHN0dWZmIGJlbG93IGlmIHdlIGFyZW4ndCBvbiBXaW5kb3dzIDIwMTIgb3IgMjAxMiBSMgoKIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgojIE1LIHN0YXJ0CiRzcFllYXJzID0gQHsiMTUiID0gIjIwMTMiOyAiMTYiID0gIjIwMTYifQokc3BWZXJzaW9ucyA9IEB7IjIwMTMiID0gIjE1IjsgIjIwMTYiID0gIjE2In0KCiRlbnY6c3BWZXIgPSAkc3BWZXJzaW9ucy4oIjIwMTYiKQokc3BZZWFyID0gJHNwWWVhcnMuJGVudjpzcFZlcgokUFNDb25maWcgPSAiJGVudjpDb21tb25Qcm9ncmFtRmlsZXNcTWljcm9zb2Z0IFNoYXJlZFxXZWIgU2VydmVyIEV4dGVuc2lvbnNcJGVudjpzcFZlclxCSU5ccHNjb25maWcuZXhlIgokUFNDb25maWdVSSA9ICIkZW52OkNvbW1vblByb2dyYW1GaWxlc1xNaWNyb3NvZnQgU2hhcmVkXFdlYiBTZXJ2ZXIgRXh0ZW5zaW9uc1wkZW52OnNwVmVyXEJJTlxwc2NvbmZpZ3VpLmV4ZSIKIyBNSyBlbmQKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBFWFRFUk5BTCBGVU5DVElPTlMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKIyBDaGVjayB0aGF0IHRoZSB2ZXJzaW9uIG9mIHRoZSBzY3JpcHQgbWF0Y2hlcyB0aGUgVmVyc2lvbiAoZXNzZW50aWFsbHkgdGhlIHNjaGVtYSkgb2YgdGhlIGlucHV0IFhNTCBzbyB3ZSBkb24ndCBoYXZlIGFueSB1bmV4cGVjdGVkIGJlaGF2aW9yCkZ1bmN0aW9uIENoZWNrWE1MVmVyc2lvbiAoW3htbF0keG1saW5wdXQpCnsKICAgICRnZXRYTUxWZXJzaW9uID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uVmVyc2lvbgogICAgIyBUaGUgdmFsdWUgYmVsb3cgd2lsbCBpbmNyZW1lbnQgd2hlbmV2ZXIgdGhlcmUgaXMgYW4gdXBkYXRlIHRvIHRoZSBmb3JtYXQgb2YgdGhlIEF1dG9TUEluc3RhbGxlcklucHV0IFhNTCBmaWxlCiAgICAkc2NyaXB0Q3VycmVudFZlcnNpb24gPSAiMy45OS41MSIKICAgICRzY3JpcHRQcmV2aW91c1ZlcnNpb24gPSAiMy45OS41IgogICAgaWYgKCRnZXRYTUxWZXJzaW9uIC1uZSAkc2NyaXB0Q3VycmVudFZlcnNpb24pCiAgICB7CiAgICAgICAgaWYgKCRnZXRYTUxWZXJzaW9uIC1lcSAkc2NyaXB0UHJldmlvdXNWZXJzaW9uKQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSBXYXJuaW5nISBZb3VyIGlucHV0IFhNTCB2ZXJzaW9uICgkZ2V0WE1MVmVyc2lvbikgaXMgb25lIGxldmVsIGJlaGluZCB0aGUgc2NyaXB0J3MgdmVyc2lvbi4iCiAgICAgICAgICAgIGxvZyAiIC0gVmlzaXQgaHR0cHM6Ly9hdXRvc3BpbnN0YWxsZXIuY29tIHRvIHVwZGF0ZSBpdCB0byB0aGUgY3VycmVudCB2ZXJzaW9uIGJlZm9yZSBwcm9jZWVkaW5nLiIgICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSBXYXJuaW5nISBZb3VyIHZlcnNpb25zIG9mIHRoZSBYTUwgKCRnZXRYTUxWZXJzaW9uKSBhbmQgc2NyaXB0ICgkc2NyaXB0Q3VycmVudFZlcnNpb24pIGFyZSBtaXNtYXRjaGVkLiIKICAgICAgICAgICAgbG9nICIgLSBZb3Ugc2hvdWxkIGNvbXBhcmUgYWdhaW5zdCB0aGUgbGF0ZXN0IEF1dG9TUEluc3RhbGxlcklucHV0LlhNTCBmb3IgbWlzc2luZy91cGRhdGVkIGVsZW1lbnRzLiIKICAgICAgICAgICAgbG9nICIgLSBPciwgdHJ5IHRvIHZhbGlkYXRlL3VwZGF0ZSB5b3VyIFhNTCBpbnB1dCBhdCBodHRwczovL2F1dG9zcGluc3RhbGxlci5jb20iCiAgICAgICAgfQogICAgICAgIFBhdXNlICJwcm9jZWVkIHdpdGggcnVubmluZyBBdXRvU1BJbnN0YWxsZXIgaWYgeW91IGFyZSBzdXJlIHRoaXMgaXMgT0ssIG9yIEN0cmwtQyB0byBleGl0IiAieSIKICAgIH0KfQoKI1JlZ2lvbiBWYWxpZGF0ZSBQYXNzcGhyYXNlCkZ1bmN0aW9uIFZhbGlkYXRlUGFzc3BocmFzZShbeG1sXSR4bWxpbnB1dCkKewogICAgIyBDaGVjayBpZiBwYXNzcGhyYXNlIGlzIHN1cHBsaWVkCiAgICAkZmFybVBhc3NwaHJhc2UgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlBhc3NwaHJhc2UKICAgIElmICghKCRmYXJtUGFzc3BocmFzZSkgLW9yICgkZmFybVBhc3NwaHJhc2UgLWVxICIiKSkKICAgIHsKICAgICAgICBSZXR1cm4KICAgIH0KICAgICRncm91cHM9MAogICAgSWYgKCRmYXJtUGFzc3BocmFzZSAtY21hdGNoICJbYS16XSIpIHsgJGdyb3VwcyA9ICRncm91cHMgKyAxIH0KICAgIElmICgkZmFybVBhc3NwaHJhc2UgLWNtYXRjaCAiW0EtWl0iKSB7ICRncm91cHMgPSAkZ3JvdXBzICsgMSB9CiAgICBJZiAoJGZhcm1QYXNzcGhyYXNlIC1tYXRjaCAiWzAtOV0iKSB7ICRncm91cHMgPSAkZ3JvdXBzICsgMSB9CiAgICBJZiAoJGZhcm1QYXNzcGhyYXNlIC1tYXRjaCAiW15hLXpBLVowLTldIikgeyAkZ3JvdXBzID0gJGdyb3VwcyArIDEgfQoKICAgIElmICgoJGdyb3VwcyAtbHQgMykgLW9yICgkZmFybVBhc3NwaHJhc2UubGVuZ3RoIC1sdCA4KSkKICAgIHsKICAgICAgICBsb2cgIiAtIEZhcm0gcGFzc3BocmFzZSBkb2VzIG5vdCBtZWV0IGNvbXBsZXhpdHkgcmVxdWlyZW1lbnRzLiIKICAgICAgICBsb2cgIiAtIEl0IG11c3QgYmUgYXQgbGVhc3QgOCBjaGFyYWN0ZXJzIGxvbmcgYW5kIGNvbnRhaW4gdGhyZWUgb2YgdGhlc2UgdHlwZXM6IgogICAgICAgIGxvZyAiICAtIFVwcGVyIGNhc2UgbGV0dGVycyIKICAgICAgICBsb2cgIiAgLSBMb3dlciBjYXNlIGxldHRlcnMiCiAgICAgICAgbG9nICIgIC0gRGlnaXRzIgogICAgICAgIGxvZyAiICAtIE90aGVyIGNoYXJhY3RlcnMiCiAgICAgICAgVGhyb3cgIiAtIEZhcm0gcGFzc3BocmFzZSBkb2VzIG5vdCBtZWV0IGNvbXBsZXhpdHkgcmVxdWlyZW1lbnRzLiIKICAgIH0KfQojRW5kUmVnaW9uCgojUmVnaW9uIFZhbGlkYXRlIENyZWRlbnRpYWxzCkZ1bmN0aW9uIFZhbGlkYXRlQ3JlZGVudGlhbHMoW3htbF0keG1saW5wdXQpCnsKICAgIFdyaXRlTGluZQogICAgbG9nICIgLSBWYWxpZGF0aW5nIHVzZXIgYWNjb3VudHMgYW5kIHBhc3N3b3Jkcy4uLiIKICAgIElmICgkZW52OkNPTVBVVEVSTkFNRSAtZXEgJGVudjpVU0VSRE9NQUlOKQogICAgewogICAgICAgIFRocm93ICIgLSBZb3UgYXJlIHJ1bm5pbmcgdGhpcyBzY3JpcHQgdW5kZXIgYSBsb2NhbCBtYWNoaW5lIHVzZXIgYWNjb3VudC4gWW91IG11c3QgYmUgYSBkb21haW4gdXNlciIKICAgIH0KCiAgICBGb3JFYWNoKCRub2RlIGluICR4bWxpbnB1dC5TZWxlY3ROb2RlcygiLy8qW0BQYXNzd29yZF18Ly8qW0BwYXNzd29yZF18Ly8qW0BDb250ZW50QWNjZXNzQWNjb3VudFBhc3N3b3JkXXwvLypbQFVuYXR0ZW5kZWRJRFBhc3N3b3JkXXwvLypbQFN5bmNDb25uZWN0aW9uQWNjb3VudFBhc3N3b3JkXXwvLypbUGFzc3dvcmRdfC8vKltwYXNzd29yZF18Ly8qW0NvbnRlbnRBY2Nlc3NBY2NvdW50UGFzc3dvcmRdfC8vKltVbmF0dGVuZGVkSURQYXNzd29yZF18Ly8qW1N5bmNDb25uZWN0aW9uQWNjb3VudFBhc3N3b3JkXSIpKQogICAgewogICAgICAgICR1c2VyID0gKEdldEZyb21Ob2RlICRub2RlICJ1c2VybmFtZSIpCiAgICAgICAgSWYgKCR1c2VyIC1lcSAiIikgeyAkdXNlciA9IChHZXRGcm9tTm9kZSAkbm9kZSAiVXNlcm5hbWUiKSB9CiAgICAgICAgSWYgKCR1c2VyIC1lcSAiIikgeyAkdXNlciA9IChHZXRGcm9tTm9kZSAkbm9kZSAiQWNjb3VudCIpIH0KICAgICAgICBJZiAoJHVzZXIgLWVxICIiKSB7ICR1c2VyID0gKEdldEZyb21Ob2RlICRub2RlICJDb250ZW50QWNjZXNzQWNjb3VudCIpIH0KICAgICAgICBJZiAoJHVzZXIgLWVxICIiKSB7ICR1c2VyID0gKEdldEZyb21Ob2RlICRub2RlICJVbmF0dGVuZGVkSURVc2VyIikgfQogICAgICAgIElmICgkdXNlciAtZXEgIiIpIHsgJHVzZXIgPSAoR2V0RnJvbU5vZGUgJG5vZGUgIlN5bmNDb25uZWN0aW9uQWNjb3VudCIpIH0KCiAgICAgICAgJHBhc3N3b3JkID0gKEdldEZyb21Ob2RlICRub2RlICJwYXNzd29yZCIpCiAgICAgICAgSWYgKCRwYXNzd29yZCAtZXEgIiIpIHsgJHBhc3N3b3JkID0gKEdldEZyb21Ob2RlICRub2RlICJQYXNzd29yZCIpIH0KICAgICAgICBJZiAoJHBhc3N3b3JkIC1lcSAiIikgeyAkcGFzc3dvcmQgPSAoR2V0RnJvbU5vZGUgJG5vZGUgIkNvbnRlbnRBY2Nlc3NBY2NvdW50UGFzc3dvcmQiKSB9CiAgICAgICAgSWYgKCRwYXNzd29yZCAtZXEgIiIpIHsgJHBhc3N3b3JkID0gKEdldEZyb21Ob2RlICRub2RlICJVbmF0dGVuZGVkSURQYXNzd29yZCIpIH0KICAgICAgICBJZiAoJHBhc3N3b3JkIC1lcSAiIikgeyAkcGFzc3dvcmQgPSAoR2V0RnJvbU5vZGUgJG5vZGUgIlN5bmNDb25uZWN0aW9uQWNjb3VudFBhc3N3b3JkIikgfQoKICAgICAgICBJZiAoKCRwYXNzd29yZCAtbmUgIiIpIC1hbmQgKCR1c2VyIC1uZSAiIikpCiAgICAgICAgewogICAgICAgICAgICAkY3VycmVudERvbWFpbiA9ICJMREFQOi8vIiArIChbQURTSV0iIikuZGlzdGluZ3Vpc2hlZE5hbWUKICAgICAgICAgICAgbG9nICIgLSBBY2NvdW50IGAiJHVzZXJgIiAoJCgkbm9kZS5OYW1lKSkuLi4iIAogICAgICAgICAgICAkZG9tID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuRGlyZWN0b3J5RW50cnkoJGN1cnJlbnREb21haW4sJHVzZXIsJHBhc3N3b3JkKQogICAgICAgICAgICBJZiAoJGRvbS5QYXRoIC1lcSAkbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICJJbnZhbGlkISIKICAgICAgICAgICAgICAgICRhY2N0SW52YWxpZCA9ICR0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgRWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIlZlcmlmaWVkLiIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGlmICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5XZWJBcHBsaWNhdGlvbnMpCiAgICB7CiAgICAgICAgIyBHZXQgYXBwbGljYXRpb24gcG9vbCBhY2NvdW50cwogICAgICAgIGZvcmVhY2ggKCR3ZWJBcHAgaW4gJCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5XZWJBcHBsaWNhdGlvbnMuV2ViQXBwbGljYXRpb24pKQogICAgICAgIHsKICAgICAgICAgICAgJGFwcFBvb2xBY2NvdW50cyA9IEAoJGFwcFBvb2xBY2NvdW50cyskd2ViQXBwLmFwcGxpY2F0aW9uUG9vbEFjY291bnQpCiAgICAgICAgICAgICMgR2V0IHNpdGUgY29sbGVjdGlvbiBvd25lcnMgIwogICAgICAgICAgICBmb3JlYWNoICgkc2l0ZUNvbGxlY3Rpb24gaW4gJCgkd2ViQXBwLlNpdGVDb2xsZWN0aW9ucy5TaXRlQ29sbGVjdGlvbikpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICghKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRzaXRlQ29sbGVjdGlvbi5Pd25lcikpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRzaXRlQ29sbGVjdGlvbk93bmVycyA9IEAoJHNpdGVDb2xsZWN0aW9uT3duZXJzKyRzaXRlQ29sbGVjdGlvbi5Pd25lcikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgICRhcHBQb29sQWNjb3VudHMgPSAkYXBwUG9vbEFjY291bnRzIHwgU2VsZWN0LU9iamVjdCAtVW5pcXVlCiAgICAkc2l0ZUNvbGxlY3Rpb25Pd25lcnMgPSAkc2l0ZUNvbGxlY3Rpb25Pd25lcnMgfCBTZWxlY3QtT2JqZWN0IC1VbmlxdWUKICAgICMgQ2hlY2sgZm9yIHRoZSBleGlzdGVuY2Ugb2Ygb2JqZWN0IGNhY2hlIGFjY291bnRzIGFuZCBvdGhlciBvbmVzIGZvciB3aGljaCB3ZSBkb24ndCBuZWVkIHRvIHNwZWNpZnkgcGFzc3dvcmRzCiAgICAkYWNjb3VudHNUb0NoZWNrID0gQCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLk9iamVjdENhY2hlQWNjb3VudHMuU3VwZXJVc2VyLCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uT2JqZWN0Q2FjaGVBY2NvdW50cy5TdXBlclJlYWRlcikrJGFwcFBvb2xBY2NvdW50cyskc2l0ZUNvbGxlY3Rpb25Pd25lcnMgfCBTZWxlY3QtT2JqZWN0IC1VbmlxdWUKICAgIGZvcmVhY2ggKCRhY2NvdW50IGluICRhY2NvdW50c1RvQ2hlY2spCiAgICB7CiAgICAgICAgJGRvbWFpbiwkYWNjb3VudE5hbWUgPSAkYWNjb3VudCAtc3BsaXQgIlxcIgogICAgICAgIGxvZyAiIC0gQWNjb3VudCBgIiRhY2NvdW50YCIuLi4iIAogICAgICAgIGlmICghKHVzZXJFeGlzdHMgJGFjY291bnROYW1lKSkKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAiSW52YWxpZCEiCiAgICAgICAgICAgICRhY2N0SW52YWxpZCA9ICR0cnVlCiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAiVmVyaWZpZWQuIgogICAgICAgIH0KICAgIH0KICAgIElmICgkYWNjdEludmFsaWQpIHtUaHJvdyAiIC0gQXQgbGVhc3Qgb25lIHNldCBvZiBjcmVkZW50aWFscyBpcyBpbnZhbGlkLmBuIC0gQ2hlY2sgdXNlcm5hbWVzIGFuZCBwYXNzd29yZHMgaW4gZWFjaCBwbGFjZSB0aGV5IGFyZSB1c2VkLiJ9CiAgICBXcml0ZUxpbmUKfQojRW5kUmVnaW9uCgojUmVnaW9uIFVuYmxvY2sgRmlsZXMgLyBUcnVzdCBTb3VyY2UgUGF0aCAmIFJlbW92ZSBJRSBFbmhhbmNlZCBTZWN1cml0eQpGdW5jdGlvbiBVbmJsb2NrRmlsZXMgKCRwYXRoKQp7CiAgICAjIEVuc3VyZSB0aGF0IGlmIHdlJ3JlIHJ1bm5pbmcgZnJvbSBhIFVOQyBwYXRoLCB0aGUgaG9zdCBwb3J0aW9uIGlzIGFkZGVkIHRvIHRoZSBMb2NhbCBJbnRyYW5ldCB6b25lIHNvIHdlIGRvbid0IGdldCB0aGUgIk9wZW4gRmlsZSAtIFNlY3VyaXR5IFdhcm5pbmciCiAgICBJZiAoJGVudjpkcDAgLWxpa2UgIlxcKiIpCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgaWYgKEdldC1Db21tYW5kIC1OYW1lICJVbmJsb2NrLUZpbGUiIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSBVbmJsb2NraW5nIGV4ZWN1dGFibGUgZmlsZXMgaW4gJHBhdGggdG8gcHJldmVudCBzZWN1cml0eSBwcm9tcHRzLi4uIiAKICAgICAgICAgICAgIyBMZXZlcmFnZSB0aGUgVW5ibG9jay1GaWxlIGNtZGxldCwgaWYgYXZhaWxhYmxlIHRvIHByZXZlbnQgc2VjdXJpdHkgd2FybmluZ3Mgd2hlbiB3b3JraW5nIHdpdGggbGFuZ3VhZ2UgcGFja3MsIENVcyBldGMuCiAgICAgICAgICAgIEdldC1DaGlsZEl0ZW0gLVBhdGggJHBhdGggLVJlY3Vyc2UgfCBXaGVyZS1PYmplY3QgeygkXy5OYW1lIC1saWtlICIqLmV4ZSIpIC1vciAoJF8uTmFtZSAtbGlrZSAiKi5tcyoiKSAtb3IgKCRfLk5hbWUgLWxpa2UgIiouemlwIikgLW9yICgkXy5OYW1lIC1saWtlICIqLmNhYiIpfSB8IFVuYmxvY2stRmlsZSAtQ29uZmlybTokZmFsc2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgbG9nICJEb25lLiIKICAgICAgICB9CiAgICAgICAgJHNhZmVIb3N0ID0gKCRlbnY6ZHAwIC1zcGxpdCAiXFwiKVsyXQogICAgICAgIGxvZyAiIC0gQWRkaW5nIGxvY2F0aW9uIGAiJHNhZmVIb3N0YCIgdG8gbG9jYWwgSW50cmFuZXQgc2VjdXJpdHkgem9uZSB0byBwcmV2ZW50IHNlY3VyaXR5IHByb21wdHMuLi4iIAogICAgICAgIE5ldy1JdGVtIC1QYXRoICJIS0NVOlxTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxJbnRlcm5ldCBTZXR0aW5nc1xab25lTWFwXERvbWFpbnMiIC1OYW1lICRzYWZlSG9zdCAtSXRlbVR5cGUgTGVhZiAtRm9yY2UgfCBPdXQtTnVsbAogICAgICAgIE5ldy1JdGVtUHJvcGVydHkgLVBhdGggIkhLQ1U6XFNvZnR3YXJlXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXEludGVybmV0IFNldHRpbmdzXFpvbmVNYXBcRG9tYWluc1wkc2FmZUhvc3QiIC1OYW1lICJmaWxlIiAtdmFsdWUgIjEiIC1Qcm9wZXJ0eVR5cGUgZHdvcmQgLUZvcmNlIHwgT3V0LU51bGwKICAgICAgICBsb2cgIkRvbmUuIgogICAgICAgIFdyaXRlTGluZQogICAgfQp9CgpGdW5jdGlvbiBSZW1vdmVJRUVuaGFuY2VkU2VjdXJpdHkoW3htbF0keG1saW5wdXQpCnsKICAgIFdyaXRlTGluZQogICAgSWYgKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkluc3RhbGwuRGlzYWJsZS5JRUVuaGFuY2VkU2VjdXJpdHkgLWVxICJUcnVlIikKICAgIHsKICAgICAgICBsb2cgIiAtIERpc2FibGluZyBJRSBFbmhhbmNlZCBTZWN1cml0eS4uLiIKICAgICAgICBTZXQtSXRlbVByb3BlcnR5IC1QYXRoICJIS0xNOlxTT0ZUV0FSRVxNaWNyb3NvZnRcQWN0aXZlIFNldHVwXEluc3RhbGxlZCBDb21wb25lbnRzXHtBNTA5QjFBNy0zN0VGLTRiM2YtOENGQy00RjNBNzQ3MDQwNzN9IiAtTmFtZSBpc2luc3RhbGxlZCAtVmFsdWUgMCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIFNldC1JdGVtUHJvcGVydHkgLVBhdGggIkhLTE06XFNPRlRXQVJFXE1pY3Jvc29mdFxBY3RpdmUgU2V0dXBcSW5zdGFsbGVkIENvbXBvbmVudHNce0E1MDlCMUE4LTM3RUYtNGIzZi04Q0ZDLTRGM0E3NDcwNDA3M30iIC1OYW1lIGlzaW5zdGFsbGVkIC1WYWx1ZSAwIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgUnVuZGxsMzIgaWVzZXR1cC5kbGwsIElFSGFyZGVuTE1TZXR0aW5ncywxLFRydWUKICAgICAgICBSdW5kbGwzMiBpZXNldHVwLmRsbCwgSUVIYXJkZW5Vc2VyLDEsVHJ1ZQogICAgICAgIFJ1bmRsbDMyIGllc2V0dXAuZGxsLCBJRUhhcmRlbkFkbWluLDEsVHJ1ZQogICAgICAgIElmIChUZXN0LVBhdGggIkhLQ1U6XFNPRlRXQVJFXE1pY3Jvc29mdFxBY3RpdmUgU2V0dXBcSW5zdGFsbGVkIENvbXBvbmVudHNce0E1MDlCMUE3LTM3RUYtNGIzZi04Q0ZDLTRGM0E3NDcwNDA3M30iIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKQogICAgICAgIHsKICAgICAgICAgICAgUmVtb3ZlLUl0ZW0gLVBhdGggIkhLQ1U6XFNPRlRXQVJFXE1pY3Jvc29mdFxBY3RpdmUgU2V0dXBcSW5zdGFsbGVkIENvbXBvbmVudHNce0E1MDlCMUE3LTM3RUYtNGIzZi04Q0ZDLTRGM0E3NDcwNDA3M30iCiAgICAgICAgfQogICAgICAgIElmIChUZXN0LVBhdGggIkhLQ1U6XFNPRlRXQVJFXE1pY3Jvc29mdFxBY3RpdmUgU2V0dXBcSW5zdGFsbGVkIENvbXBvbmVudHNce0E1MDlCMUE4LTM3RUYtNGIzZi04Q0ZDLTRGM0E3NDcwNDA3M30iIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKQogICAgICAgIHsKICAgICAgICAgICAgUmVtb3ZlLUl0ZW0gLVBhdGggIkhLQ1U6XFNPRlRXQVJFXE1pY3Jvc29mdFxBY3RpdmUgU2V0dXBcSW5zdGFsbGVkIENvbXBvbmVudHNce0E1MDlCMUE4LTM3RUYtNGIzZi04Q0ZDLTRGM0E3NDcwNDA3M30iCiAgICAgICAgfQoKICAgICAgICAjVGhpcyBkb2Vzbid0IGFsd2F5cyBleGlzdAogICAgICAgIFJlbW92ZS1JdGVtUHJvcGVydHkgIkhLQ1U6XFNPRlRXQVJFXE1pY3Jvc29mdFxJbnRlcm5ldCBFeHBsb3JlclxNYWluIiAiRmlyc3QgSG9tZSBQYWdlIiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgfQogICAgRWxzZQogICAgewogICAgICAgIGxvZyAiIC0gTm90IGNvbmZpZ3VyZWQgdG8gY2hhbmdlIElFIEVuaGFuY2VkIFNlY3VyaXR5LiIKICAgIH0KICAgIFdyaXRlTGluZQp9CiNFbmRSZWdpb24KCiNSZWdpb24gRGlzYWJsZSBDZXJ0aWZpY2F0ZSBSZXZvY2F0aW9uIExpc3QgY2hlY2tzCkZ1bmN0aW9uIERpc2FibGVDUkxDaGVjayhbeG1sXSR4bWxpbnB1dCkKewogICAgV3JpdGVMaW5lCiAgICBJZiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uSW5zdGFsbC5EaXNhYmxlLkNlcnRpZmljYXRlUmV2b2NhdGlvbkxpc3RDaGVjayAtZXEgIlRydWUiKQogICAgewogICAgICAgIGxvZyAiIC0gRGlzYWJsaW5nIENlcnRpZmljYXRlIFJldm9jYXRpb24gTGlzdCAoQ1JMKSBjaGVjay4uLiIKICAgICAgICBsb2cgIiAgLSBSZWdpc3RyeS4uLiIKICAgICAgICBOZXctUFNEcml2ZSAtTmFtZSBIS1UgLVBTUHJvdmlkZXIgUmVnaXN0cnkgLVJvb3QgSEtFWV9VU0VSUyAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IE91dC1OdWxsCiAgICAgICAgTmV3LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiSEtVOlwuREVGQVVMVFxTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxXaW5UcnVzdFxUcnVzdCBQcm92aWRlcnNcU29mdHdhcmUgUHVibGlzaGluZyIgLU5hbWUgU3RhdGUgLVByb3BlcnR5VHlwZSBEV29yZCAtVmFsdWUgMTQ2OTQ0IC1Gb3JjZSB8IE91dC1OdWxsCiAgICAgICAgTmV3LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiSEtDVTpcU29mdHdhcmVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cV2luVHJ1c3RcVHJ1c3QgUHJvdmlkZXJzXFNvZnR3YXJlIFB1Ymxpc2hpbmciIC1OYW1lIFN0YXRlIC1Qcm9wZXJ0eVR5cGUgRFdvcmQgLVZhbHVlIDE0Njk0NCAtRm9yY2UgfCBPdXQtTnVsbAogICAgICAgIGxvZyAiICAtIE1hY2hpbmUuY29uZmlnIGZpbGVzLi4uIgogICAgICAgIFthcnJheV0kZnJhbWV3b3JrVmVyc2lvbnMgPSAidjIuMC41MDcyNyIsInY0LjAuMzAzMTkiICMgRm9yIC5OZXQgMi4wIGFuZCAuTmV0IDQuMAogICAgICAgIEZvckVhY2goJGJpdHNpemUgaW4gKCIiLCI2NCIpKQogICAgICAgIHsKICAgICAgICAgICAgZm9yZWFjaCAoJGZyYW1ld29ya1ZlcnNpb24gaW4gJGZyYW1ld29ya1ZlcnNpb25zKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIEFkZGVkIGEgY2hlY2sgYmVsb3cgZm9yICR4bWwgYmVjYXVzZSBvbiBXaW5kb3dzIFNlcnZlciAyMDEyIG1hY2hpbmVzLCB0aGUgcGF0aCB0byAkeG1sIGRvZXNuJ3QgZXhpc3QgdW50aWwgdGhlIC5OZXQgRnJhbWV3b3JrIGlzIGluc3RhbGxlZCwgc28gdGhlIHN0ZXBzIGJlbG93IHdlcmUgZmFpbGluZwogICAgICAgICAgICAgICAgJHhtbCA9IFt4bWxdKEdldC1Db250ZW50ICIkZW52OndpbmRpclxNaWNyb3NvZnQuTkVUXEZyYW1ld29yayRiaXRzaXplXCRmcmFtZXdvcmtWZXJzaW9uXENPTkZJR1xNYWNoaW5lLmNvbmZpZyIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpCiAgICAgICAgICAgICAgICBpZiAoJHhtbCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJGJpdHNpemUgLWVxICI2NCIpIHtsb2cgIiAgIC0gJGZyYW1ld29ya1ZlcnNpb24uLi4iIH0KICAgICAgICAgICAgICAgICAgICBJZiAoISR4bWwuRG9jdW1lbnRFbGVtZW50LlNlbGVjdFNpbmdsZU5vZGUoInJ1bnRpbWUiKSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICRydW50aW1lID0gJHhtbC5DcmVhdGVFbGVtZW50KCJydW50aW1lIikKICAgICAgICAgICAgICAgICAgICAgICAgJHhtbC5Eb2N1bWVudEVsZW1lbnQuQXBwZW5kQ2hpbGQoJHJ1bnRpbWUpIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgSWYgKCEkeG1sLkRvY3VtZW50RWxlbWVudC5TZWxlY3RTaW5nbGVOb2RlKCJydW50aW1lL2dlbmVyYXRlUHVibGlzaGVyRXZpZGVuY2UiKSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICRncGUgPSAkeG1sLkNyZWF0ZUVsZW1lbnQoImdlbmVyYXRlUHVibGlzaGVyRXZpZGVuY2UiKQogICAgICAgICAgICAgICAgICAgICAgICAkeG1sLkRvY3VtZW50RWxlbWVudC5TZWxlY3RTaW5nbGVOb2RlKCJydW50aW1lIikuQXBwZW5kQ2hpbGQoJGdwZSkgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkeG1sLkRvY3VtZW50RWxlbWVudC5TZWxlY3RTaW5nbGVOb2RlKCJydW50aW1lL2dlbmVyYXRlUHVibGlzaGVyRXZpZGVuY2UiKS5TZXRBdHRyaWJ1dGUoImVuYWJsZWQiLCJmYWxzZSIpIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgICAgICAkeG1sLlNhdmUoIiRlbnY6d2luZGlyXE1pY3Jvc29mdC5ORVRcRnJhbWV3b3JrJGJpdHNpemVcJGZyYW1ld29ya1ZlcnNpb25cQ09ORklHXE1hY2hpbmUuY29uZmlnIikKICAgICAgICAgICAgICAgICAgICBpZiAoJGJpdHNpemUgLWVxICI2NCIpIHtsb2cgIk9LLiJ9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRiaXRzaXplIC1lcSAiIikgeyRiaXRzaXplID0gIjMyIn0KICAgICAgICAgICAgICAgICAgICBsb2cgIldBUk5JTkc6JGJpdHNpemUtYml0IG1hY2hpbmUuY29uZmlnIG5vdCBmb3VuZCAtIGNvdWxkIG5vdCBkaXNhYmxlIENSTCBjaGVjay4iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbG9nICIgLSBEb25lLiIKICAgIH0KICAgIEVsc2UKICAgIHsKICAgICAgICBsb2cgIiAtIE5vdCBjaGFuZ2luZyBDUkwgY2hlY2sgYmVoYXZpb3IuIgogICAgfQogICAgV3JpdGVMaW5lCn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBTdGFydCBsb2dnaW5nIHRvIHVzZXIncyBkZXNrdG9wCkZ1bmN0aW9uIFN0YXJ0VHJhY2luZyAoJHNlcnZlcikKewogICAgSWYgKCEkaXNUcmFjaW5nKQogICAgewogICAgICAgICMgTG9vayBmb3IgYW4gZXhpc3RpbmcgbG9nIGZpbGUgc3RhcnQgdGltZSBpbiB0aGUgcmVnaXN0cnkgc28gd2UgY2FuIHJlLXVzZSB0aGUgc2FtZSBsb2cgZmlsZQoJCSRyZWdLZXkgPSBHZXQtSXRlbSAtUGF0aCAiSEtMTTpcU09GVFdBUkVcQXV0b1NQSW5zdGFsbGVyXCIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKCQlJZiAoJHJlZ0tleSkgeyRzY3JpcHQ6TG9ndGltZSA9ICRyZWdrZXkuR2V0VmFsdWUoIkxvZ1RpbWUiKX0KCQlJZiAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJGxvZ3RpbWUpKSB7JHNjcmlwdDpMb2d0aW1lID0gR2V0LURhdGUgLUZvcm1hdCB5eXl5LU1NLWRkX2gtbW19CiAgICAgICAgSWYgKCRzZXJ2ZXIpIHskc2NyaXB0OkxvZ0ZpbGUgPSAiJGVudjpVU0VSUFJPRklMRVxEZXNrdG9wXEF1dG9TUEluc3RhbGxlci0kc2VydmVyLSRzY3JpcHQ6TG9ndGltZS5ydGYifQogICAgICAgIGVsc2UgeyRzY3JpcHQ6TG9nRmlsZSA9ICIkZW52OlVTRVJQUk9GSUxFXERlc2t0b3BcQXV0b1NQSW5zdGFsbGVyLSRzY3JpcHQ6TG9ndGltZS5ydGYifQogICAgICAgIFN0YXJ0LVRyYW5zY3JpcHQgLVBhdGggJGxvZ0ZpbGUgLUFwcGVuZCAtRm9yY2UKICAgICAgICBJZiAoJD8pIHskc2NyaXB0OmlzVHJhY2luZyA9ICR0cnVlfQogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ2hlY2sgSW5wdXQgRmlsZQpGdW5jdGlvbiBDaGVja0lucHV0CnsKICAgICMgQ2hlY2sgdGhhdCB0aGUgY29uZmlnIGZpbGUgZXhpc3RzLgogICAgSWYgKC1ub3QgJChUZXN0LVBhdGggLVBhdGggJGlucHV0RmlsZSAtVHlwZSBMZWFmKSkKICAgIHsKICAgICAgICBXcml0ZS1FcnJvciAtbWVzc2FnZSAoIiAtIElucHV0IGZpbGUgJyIgKyAkaW5wdXRGaWxlICsgIicgZG9lcyBub3QgZXhpc3QuIikKICAgIH0KfQojRW5kUmVnaW9uCgojUmVnaW9uIENoZWNrIEZvciBvciBDcmVhdGUgQ29uZmlnIEZpbGVzCkZ1bmN0aW9uIENoZWNrQ29uZmlnRmlsZXMoW3htbF0keG1saW5wdXQpCnsKICAgICNSZWdpb24gU2hhcmVQb2ludCBjb25maWcgZmlsZQogICAgaWYgKFRlc3QtUGF0aCAtUGF0aCAoSm9pbi1QYXRoIC1QYXRoICRlbnY6ZHAwIC1DaGlsZFBhdGggJCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5JbnN0YWxsLkNvbmZpZ0ZpbGUpKSkKICAgIHsKICAgICAgICAjIEp1c3QgdXNlIHRoZSBleGlzdGluZyBjb25maWcgZmlsZSB3ZSBmb3VuZAogICAgICAgICRzY3JpcHQ6Y29uZmlnRmlsZSA9IEpvaW4tUGF0aCAtUGF0aCAkZW52OmRwMCAtQ2hpbGRQYXRoICQoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uSW5zdGFsbC5Db25maWdGaWxlKQogICAgICAgIGxvZyAiIC0gVXNpbmcgZXhpc3RpbmcgY29uZmlnIGZpbGU6YG4gLSAkY29uZmlnRmlsZSIKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBHZXQtTWFqb3JWZXJzaW9uTnVtYmVyICR4bWxpbnB1dAogICAgICAgICMgV3JpdGUgb3V0IGEgbmV3IGNvbmZpZyBmaWxlIGJhc2VkIG9uIGRlZmF1bHRzIGFuZCB0aGUgdmFsdWVzIHByb3ZpZGVkIGluICRpbnB1dEZpbGUKICAgICAgICAkcGlkS2V5ID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uSW5zdGFsbC5QSURLZXkKICAgICAgICAjIERvIGEgcnVkaW1lbnRhcnkgY2hlY2sgb24gdGhlIHByZXNlbmNlIGFuZCBmb3JtYXQgb2YgdGhlIHByb2R1Y3Qga2V5CiAgICAgICAgaWYgKCRwaWRLZXkgLW5vdGxpa2UgIj8/Pz8/LT8/Pz8/LT8/Pz8/LT8/Pz8/LT8/Pz8/IikKICAgICAgICB7CiAgICAgICAgICAgIHRocm93ICIgLSBUaGUgUHJvZHVjdCBJRCAoUElES2V5KSBpcyBtaXNzaW5nIG9yIGJhZGx5IGZvcm1hdHRlZC5gbiAtIENoZWNrIHRoZSB2YWx1ZSBvZiA8UElES2V5PiBpbiBgIiQoU3BsaXQtUGF0aCAtUGF0aCAkaW5wdXRGaWxlIC1MZWFmKWAiIGFuZCB0cnkgYWdhaW4uIgogICAgICAgIH0KICAgICAgICAkb2ZmaWNlU2VydmVyUHJlbWl1bSA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkluc3RhbGwuU0tVIC1yZXBsYWNlICJFbnRlcnByaXNlIiwiMSIgLXJlcGxhY2UgIlN0YW5kYXJkIiwiMCIKICAgICAgICAkaW5zdGFsbERpciA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkluc3RhbGwuSW5zdGFsbERpcgogICAgICAgICMgU2V0ICRpbnN0YWxsRGlyIHRvIHRoZSBkZWZhdWx0IHZhbHVlIGlmIGl0J3Mgbm90IHNwZWNpZmllZCBpbiAkeG1saW5wdXQKICAgICAgICBpZiAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJGluc3RhbGxEaXIpKSB7JGluc3RhbGxEaXIgPSAiJVBST0dSQU1GSUxFUyVcTWljcm9zb2Z0IE9mZmljZSBTZXJ2ZXJzXCJ9CiAgICAgICAgJGRhdGFEaXIgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5JbnN0YWxsLkRhdGFEaXIKICAgICAgICAjIFNldCAkZGF0YURpciB0byB0aGUgZGVmYXVsdCB2YWx1ZSBpZiBpdCdzIG5vdCBzcGVjaWZpZWQgaW4gJHhtbGlucHV0CiAgICAgICAgaWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRkYXRhRGlyKSkgeyRkYXRhRGlyID0gIiVQUk9HUkFNRklMRVMlXE1pY3Jvc29mdCBPZmZpY2UgU2VydmVyc1wkZW52OnNwVmVyLjBcRGF0YSJ9CiAgICAgICAgJGRhdGFEaXIgPSAkZGF0YURpci5UcmltRW5kKCJcIikKICAgICAgICAkeG1sQ29uZmlnID0gQCIKPENvbmZpZ3VyYXRpb24+CiAgPFBhY2thZ2UgSWQ9InN0cyI+CiAgICA8U2V0dGluZyBJZD0iTEFVTkNIRURGUk9NU0VUVVBTVFMiIFZhbHVlPSJZZXMiLz4KICA8L1BhY2thZ2U+CiAgPFBhY2thZ2UgSWQ9InNwc3dmZSI+CiAgICA8U2V0dGluZyBJZD0iU0VUVVBDQUxMRUQiIFZhbHVlPSIxIi8+CiAgICA8U2V0dGluZyBJZD0iT0ZGSUNFU0VSVkVSUFJFTUlVTSIgVmFsdWU9IiRvZmZpY2VTZXJ2ZXJQcmVtaXVtIiAvPgogIDwvUGFja2FnZT4KICA8QVJQIEFSUENPTU1FTlRTPSJJbnN0YWxsZWQgd2l0aCBBdXRvU1BJbnN0YWxsZXIgKGh0dHA6Ly9hdXRvc3BpbnN0YWxsZXIuY29tKSIgQVJQQ09OVEFDVD0iYnJpYW5AYXV0b3NwaW5zdGFsbGVyLmNvbSIgLz4KICA8TG9nZ2luZyBUeXBlPSJ2ZXJib3NlIiBQYXRoPSIldGVtcCUiIFRlbXBsYXRlPSJTaGFyZVBvaW50IFNlcnZlciBTZXR1cCgqKS5sb2ciLz4KICA8RGlzcGxheSBMZXZlbD0iYmFzaWMiIENvbXBsZXRpb25Ob3RpY2U9Ik5vIiBBY2NlcHRFdWxhPSJZZXMiLz4KICA8SU5TVEFMTExPQ0FUSU9OIFZhbHVlPSIkaW5zdGFsbERpciIvPgogIDxEQVRBRElSIFZhbHVlPSIkZGF0YURpciIvPgogIDxQSURLRVkgVmFsdWU9IiRwaWRLZXkiLz4KICA8U2V0dGluZyBJZD0iU0VSVkVSUk9MRSIgVmFsdWU9IkFQUExJQ0FUSU9OIi8+CiAgPFNldHRpbmcgSWQ9IlVTSU5HVUlJTlNUQUxMTU9ERSIgVmFsdWU9IjEiLz4KICA8U2V0dGluZyBJZD0iU0VUVVBUWVBFIiBWYWx1ZT0iQ0xFQU5fSU5TVEFMTCIvPgogIDxTZXR0aW5nIElkPSJTRVRVUF9SRUJPT1QiIFZhbHVlPSJOZXZlciIvPgogIDxTZXR0aW5nIElkPSJBbGxvd1dpbmRvd3NDbGllbnRJbnN0YWxsIiBWYWx1ZT0iVHJ1ZSIvPgo8L0NvbmZpZ3VyYXRpb24+CiJACiAgICAgICAgJHNjcmlwdDpjb25maWdGaWxlID0gSm9pbi1QYXRoIC1QYXRoIChHZXQtSXRlbSAkZW52OlRFTVApLkZ1bGxOYW1lIC1DaGlsZFBhdGggJCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5JbnN0YWxsLkNvbmZpZ0ZpbGUpCiAgICAgICAgbG9nICIgLSBXcml0aW5nICQoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uSW5zdGFsbC5Db25maWdGaWxlKSB0byAkKChHZXQtSXRlbSAkZW52OlRFTVApLkZ1bGxOYW1lKS4uLiIKICAgICAgICBTZXQtQ29udGVudCAtUGF0aCAiJGNvbmZpZ0ZpbGUiIC1Gb3JjZSAtVmFsdWUgJHhtbENvbmZpZwogICAgfQogICAgI0VuZFJlZ2lvbgoKICAgICNSZWdpb24gT1dBIGNvbmZpZyBmaWxlCiAgICBpZiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uT2ZmaWNlV2ViQXBwcy5JbnN0YWxsIC1lcSAkdHJ1ZSkKICAgIHsKICAgICAgICBpZiAoVGVzdC1QYXRoIC1QYXRoIChKb2luLVBhdGggLVBhdGggJGVudjpkcDAgLUNoaWxkUGF0aCAkKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLk9mZmljZVdlYkFwcHMuQ29uZmlnRmlsZSkpKQogICAgICAgIHsKICAgICAgICAgICAgIyBKdXN0IHVzZSB0aGUgZXhpc3RpbmcgY29uZmlnIGZpbGUgd2UgZm91bmQKICAgICAgICAgICAgJHNjcmlwdDpjb25maWdGaWxlT1dBID0gSm9pbi1QYXRoIC1QYXRoICRlbnY6ZHAwIC1DaGlsZFBhdGggJCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5PZmZpY2VXZWJBcHBzLkNvbmZpZ0ZpbGUpCiAgICAgICAgICAgIGxvZyAiIC0gVXNpbmcgZXhpc3RpbmcgT1dBIGNvbmZpZyBmaWxlOmBuIC0gJGNvbmZpZ0ZpbGVPV0EiCiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgICMgV3JpdGUgb3V0IGEgbmV3IGNvbmZpZyBmaWxlIGJhc2VkIG9uIGRlZmF1bHRzIGFuZCB0aGUgdmFsdWVzIHByb3ZpZGVkIGluICRpbnB1dEZpbGUKICAgICAgICAgICAgJHBpZEtleU9XQSA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLk9mZmljZVdlYkFwcHMuUElES2V5T1dBCiAgICAgICAgICAgICMgRG8gYSBydWRpbWVudGFyeSBjaGVjayBvbiB0aGUgcHJlc2VuY2UgYW5kIGZvcm1hdCBvZiB0aGUgcHJvZHVjdCBrZXkKICAgICAgICAgICAgaWYgKCRwaWRLZXlPV0EgLW5vdGxpa2UgIj8/Pz8/LT8/Pz8/LT8/Pz8/LT8/Pz8/LT8/Pz8/IikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGhyb3cgIiAtIFRoZSBPV0EgUHJvZHVjdCBJRCAoUElES2V5KSBpcyBtaXNzaW5nIG9yIGJhZGx5IGZvcm1hdHRlZC5gbiAtIENoZWNrIHRoZSB2YWx1ZSBvZiA8UElES2V5T1dBPiBpbiBgIiQoU3BsaXQtUGF0aCAtUGF0aCAkaW5wdXRGaWxlIC1MZWFmKWAiIGFuZCB0cnkgYWdhaW4uIgogICAgICAgICAgICB9CiAgICAgICAgICAgICR4bWxDb25maWdPV0EgPSBAIgo8Q29uZmlndXJhdGlvbj4KCTxQYWNrYWdlIElkPSJzdHMiPgoJCTxTZXR0aW5nIElkPSJMQVVOQ0hFREZST01TRVRVUFNUUyIgVmFsdWU9IlllcyIvPgoJPC9QYWNrYWdlPgogICAgPEFSUCBBUlBDT01NRU5UUz0iSW5zdGFsbGVkIHdpdGggQXV0b1NQSW5zdGFsbGVyIChodHRwOi8vYXV0b3NwaW5zdGFsbGVyLmNvbSkiIEFSUENPTlRBQ1Q9ImJyaWFuQGF1dG9zcGluc3RhbGxlci5jb20iIC8+Cgk8TG9nZ2luZyBUeXBlPSJ2ZXJib3NlIiBQYXRoPSIldGVtcCUiIFRlbXBsYXRlPSJXYWMgU2VydmVyIFNldHVwKCopLmxvZyIvPgoJPERpc3BsYXkgTGV2ZWw9ImJhc2ljIiBDb21wbGV0aW9uTm90aWNlPSJubyIgLz4KCTxTZXR0aW5nIElkPSJTRVJWRVJST0xFIiBWYWx1ZT0iQVBQTElDQVRJT04iLz4KCTxQSURLRVkgVmFsdWU9IiRwaWRLZXlPV0EiLz4KCTxTZXR0aW5nIElkPSJVU0lOR1VJSU5TVEFMTE1PREUiIFZhbHVlPSIxIi8+Cgk8U2V0dGluZyBJZD0iU0VUVVBUWVBFIiBWYWx1ZT0iQ0xFQU5fSU5TVEFMTCIvPgoJPFNldHRpbmcgSWQ9IlNFVFVQX1JFQk9PVCIgVmFsdWU9Ik5ldmVyIi8+Cgk8U2V0dGluZyBJZD0iQWxsb3dXaW5kb3dzQ2xpZW50SW5zdGFsbCIgVmFsdWU9IlRydWUiLz4KPC9Db25maWd1cmF0aW9uPgoiQAogICAgICAgICAgICAkc2NyaXB0OmNvbmZpZ0ZpbGVPV0EgPSBKb2luLVBhdGggLVBhdGggKEdldC1JdGVtICRlbnY6VEVNUCkuRnVsbE5hbWUgLUNoaWxkUGF0aCAkKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLk9mZmljZVdlYkFwcHMuQ29uZmlnRmlsZSkKICAgICAgICAgICAgbG9nICIgLSBXcml0aW5nICQoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uT2ZmaWNlV2ViQXBwcy5Db25maWdGaWxlKSB0byAkKChHZXQtSXRlbSAkZW52OlRFTVApLkZ1bGxOYW1lKS4uLiIKICAgICAgICAgICAgU2V0LUNvbnRlbnQgLVBhdGggIiRjb25maWdGaWxlT1dBIiAtRm9yY2UgLVZhbHVlICR4bWxDb25maWdPV0EKICAgICAgICB9CiAgICB9CiAgICAjRW5kUmVnaW9uCgogICAgI1JlZ2lvbiBQcm9qZWN0IFNlcnZlciBjb25maWcgZmlsZQogICAgaWYgKCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5Qcm9qZWN0U2VydmVyLkluc3RhbGwgLWVxICR0cnVlKSAtYW5kICgkZW52OnNwVmVyIC1lcSAiMTUiKSkgIyBXZSBvbmx5IG5lZWQgdGhpcyBjb25maWcgZmlsZSBmb3IgUHJvamVjdCBTZXJ2ZXIgMjAxMyAvIFNQMjAxMwogICAgewogICAgICAgIGlmIChUZXN0LVBhdGggLVBhdGggKEpvaW4tUGF0aCAtUGF0aCAkZW52OmRwMCAtQ2hpbGRQYXRoICQoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uUHJvamVjdFNlcnZlci5Db25maWdGaWxlKSkpCiAgICAgICAgewogICAgICAgICAgICAjIEp1c3QgdXNlIHRoZSBleGlzdGluZyBjb25maWcgZmlsZSB3ZSBmb3VuZAogICAgICAgICAgICAkc2NyaXB0OmNvbmZpZ0ZpbGVQcm9qZWN0U2VydmVyID0gSm9pbi1QYXRoIC1QYXRoICRlbnY6ZHAwIC1DaGlsZFBhdGggJCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5Qcm9qZWN0U2VydmVyLkNvbmZpZ0ZpbGUpCiAgICAgICAgICAgIGxvZyAiIC0gVXNpbmcgZXhpc3RpbmcgUHJvamVjdFNlcnZlciBjb25maWcgZmlsZTpgbiAtICRjb25maWdGaWxlUHJvamVjdFNlcnZlciIKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgIyBXcml0ZSBvdXQgYSBuZXcgY29uZmlnIGZpbGUgYmFzZWQgb24gZGVmYXVsdHMgYW5kIHRoZSB2YWx1ZXMgcHJvdmlkZWQgaW4gJGlucHV0RmlsZQogICAgICAgICAgICAkcGlkS2V5UHJvamVjdFNlcnZlciA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlByb2plY3RTZXJ2ZXIuUElES2V5UHJvamVjdFNlcnZlcgogICAgICAgICAgICAjIERvIGEgcnVkaW1lbnRhcnkgY2hlY2sgb24gdGhlIHByZXNlbmNlIGFuZCBmb3JtYXQgb2YgdGhlIHByb2R1Y3Qga2V5CiAgICAgICAgICAgIGlmICgkcGlkS2V5UHJvamVjdFNlcnZlciAtbm90bGlrZSAiPz8/Pz8tPz8/Pz8tPz8/Pz8tPz8/Pz8tPz8/Pz8iKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0aHJvdyAiIC0gVGhlIFByb2plY3QgU2VydmVyIFByb2R1Y3QgSUQgKFBJREtleSkgaXMgbWlzc2luZyBvciBiYWRseSBmb3JtYXR0ZWQuYG4gLSBDaGVjayB0aGUgdmFsdWUgb2YgPFBJREtleVByb2plY3RTZXJ2ZXI+IGluIGAiJChTcGxpdC1QYXRoIC1QYXRoICRpbnB1dEZpbGUgLUxlYWYpYCIgYW5kIHRyeSBhZ2Fpbi4iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHhtbENvbmZpZ1Byb2plY3RTZXJ2ZXIgPSBAIgo8Q29uZmlndXJhdGlvbj4KICAgIDxQYWNrYWdlIElkPSJzdHMiPgogICAgICA8U2V0dGluZyBJZD0iTEFVTkNIRURGUk9NU0VUVVBTVFMiIFZhbHVlPSJZZXMiLz4KICAgIDwvUGFja2FnZT4KICAgICAgPFBhY2thZ2UgSWQ9IlBKU1JWV0ZFIj4KICAgICAgICA8U2V0dGluZyBJZD0iUFNFUlZFUiIgVmFsdWU9IjEiLz4KICAgICAgPC9QYWNrYWdlPgogICAgPEFSUCBBUlBDT01NRU5UUz0iSW5zdGFsbGVkIHdpdGggQXV0b1NQSW5zdGFsbGVyIChodHRwOi8vYXV0b3NwaW5zdGFsbGVyLmNvbSkiIEFSUENPTlRBQ1Q9ImJyaWFuQGF1dG9zcGluc3RhbGxlci5jb20iIC8+CiAgICA8TG9nZ2luZyBUeXBlPSJ2ZXJib3NlIiBQYXRoPSIldGVtcCUiIFRlbXBsYXRlPSJQcm9qZWN0IFNlcnZlciBTZXR1cCgqKS5sb2ciLz4KICAgIDxEaXNwbGF5IExldmVsPSJiYXNpYyIgQ29tcGxldGlvbk5vdGljZT0iTm8iIEFjY2VwdEV1bGE9IlllcyIvPgoJPFNldHRpbmcgSWQ9IlNFUlZFUlJPTEUiIFZhbHVlPSJBUFBMSUNBVElPTiIvPgoJPFBJREtFWSBWYWx1ZT0iJHBpZEtleVByb2plY3RTZXJ2ZXIiLz4KCTxTZXR0aW5nIElkPSJVU0lOR1VJSU5TVEFMTE1PREUiIFZhbHVlPSIxIi8+Cgk8U2V0dGluZyBJZD0iU0VUVVBUWVBFIiBWYWx1ZT0iQ0xFQU5fSU5TVEFMTCIvPgoJPFNldHRpbmcgSWQ9IlNFVFVQX1JFQk9PVCIgVmFsdWU9Ik5ldmVyIi8+Cgk8U2V0dGluZyBJZD0iQWxsb3dXaW5kb3dzQ2xpZW50SW5zdGFsbCIgVmFsdWU9IlRydWUiLz4KPC9Db25maWd1cmF0aW9uPgoiQAogICAgICAgICAgICAkc2NyaXB0OmNvbmZpZ0ZpbGVQcm9qZWN0U2VydmVyID0gSm9pbi1QYXRoIC1QYXRoIChHZXQtSXRlbSAkZW52OlRFTVApLkZ1bGxOYW1lIC1DaGlsZFBhdGggJCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5Qcm9qZWN0U2VydmVyLkNvbmZpZ0ZpbGUpCiAgICAgICAgICAgIGxvZyAiIC0gV3JpdGluZyAkKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlByb2plY3RTZXJ2ZXIuQ29uZmlnRmlsZSkgdG8gJCgoR2V0LUl0ZW0gJGVudjpURU1QKS5GdWxsTmFtZSkuLi4iCiAgICAgICAgICAgIFNldC1Db250ZW50IC1QYXRoICIkY29uZmlnRmlsZVByb2plY3RTZXJ2ZXIiIC1Gb3JjZSAtVmFsdWUgJHhtbENvbmZpZ1Byb2plY3RTZXJ2ZXIKICAgICAgICB9CiAgICB9CiAgICAjRW5kUmVnaW9uCgogICAgI1JlZ2lvbiBGb3JlRnJvbnQgYW5zd2VyIGZpbGUKICAgIGlmIChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZvcmVGcm9udCAtZXEgJHRydWUpCiAgICB7CiAgICAgICAgaWYgKFRlc3QtUGF0aCAtUGF0aCAoSm9pbi1QYXRoIC1QYXRoICRlbnY6ZHAwIC1DaGlsZFBhdGggJCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5Gb3JlRnJvbnQuQ29uZmlnRmlsZSkpKQogICAgICAgIHsKICAgICAgICAgICAgIyBKdXN0IHVzZSB0aGUgZXhpc3RpbmcgYW5zd2VyIGZpbGUgd2UgZm91bmQKICAgICAgICAgICAgJHNjcmlwdDpjb25maWdGaWxlRm9yZUZyb250ID0gSm9pbi1QYXRoIC1QYXRoICRlbnY6ZHAwIC1DaGlsZFBhdGggJCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5Gb3JlRnJvbnQuQ29uZmlnRmlsZSkKICAgICAgICAgICAgbG9nICIgLSBVc2luZyBleGlzdGluZyBGb3JlRnJvbnQgYW5zd2VyIGZpbGU6YG4gLSAkY29uZmlnRmlsZUZvcmVGcm9udCIKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgJGZhcm1BY2N0ID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5BY2NvdW50LlVzZXJuYW1lCiAgICAgICAgICAgICRmYXJtQWNjdFBXRCA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uQWNjb3VudC5QYXNzd29yZAogICAgICAgICAgICAjIFdyaXRlIG91dCBhIG5ldyBhbnN3ZXIgZmlsZSBiYXNlZCBvbiBkZWZhdWx0cyBhbmQgdGhlIHZhbHVlcyBwcm92aWRlZCBpbiAkaW5wdXRGaWxlCiAgICAgICAgICAgICR4bWxDb25maWdGb3JlRnJvbnQgPSBAIgo8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJ1dGYtOCI/Pgo8RlNTQW5zd2VyRmlsZT4KICA8QWNjZXB0TGljZW5zZT50cnVlPC9BY2NlcHRMaWNlbnNlPgogIDxBY2NlcHRSZXN0YXJ0PnRydWU8L0FjY2VwdFJlc3RhcnQ+CiAgPEFjY2VwdFJlcGxhY2VQcmV2aW91c1ZTPnRydWU8L0FjY2VwdFJlcGxhY2VQcmV2aW91c1ZTPgogIDxJbnN0YWxsVHlwZT5GdWxsPC9JbnN0YWxsVHlwZT4KICA8Rm9sZGVycz4KICAgIDwhLS1MZWF2ZSB0aGVzZSBlbXB0eSB0byB1c2UgdGhlIGRlZmF1bHQgdmFsdWVzLS0+CiAgICA8UHJvZ3JhbUZvbGRlcj48L1Byb2dyYW1Gb2xkZXI+CiAgICA8RGF0YUZvbGRlcj48L0RhdGFGb2xkZXI+CiAgPC9Gb2xkZXJzPgogIDxQcm94eUluZm9ybWF0aW9uPgogICAgPFVzZVByb3h5PmZhbHNlPC9Vc2VQcm94eT4KICAgIDxTZXJ2ZXJOYW1lPjwvU2VydmVyTmFtZT4KICAgIDxQb3J0PjgwPC9Qb3J0PgogICAgPFVzZXJOYW1lPjwvVXNlck5hbWU+CiAgICA8UGFzc3dvcmQ+PC9QYXNzd29yZD4KICA8L1Byb3h5SW5mb3JtYXRpb24+CiAgPFNoYXJlUG9pbnRJbmZvcm1hdGlvbj4KICAgIDxVc2VyTmFtZT4kZmFybUFjY3Q8L1VzZXJOYW1lPgogICAgPFBhc3N3b3JkPiRmYXJtQWNjdFBXRDwvUGFzc3dvcmQ+CiAgPC9TaGFyZVBvaW50SW5mb3JtYXRpb24+CiAgPEVuYWJsZUFudGlTcGFtTm93PmZhbHNlPC9FbmFibGVBbnRpU3BhbU5vdz4KICA8RW5hYmxlQ3VzdG9tZXJFeHBlcmllbmNlSW1wcm92ZW1lbnRQcm9ncmFtPmZhbHNlPC9FbmFibGVDdXN0b21lckV4cGVyaWVuY2VJbXByb3ZlbWVudFByb2dyYW0+CjwvRlNTQW5zd2VyRmlsZT4KIkAKICAgICAgICAgICAgJHNjcmlwdDpjb25maWdGaWxlRm9yZUZyb250ID0gSm9pbi1QYXRoIC1QYXRoIChHZXQtSXRlbSAkZW52OlRFTVApLkZ1bGxOYW1lIC1DaGlsZFBhdGggJCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5Gb3JlRnJvbnQuQ29uZmlnRmlsZSkKICAgICAgICAgICAgbG9nICIgLSBXcml0aW5nICQoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRm9yZUZyb250LkNvbmZpZ0ZpbGUpIHRvICQoKEdldC1JdGVtICRlbnY6VEVNUCkuRnVsbE5hbWUpLi4uIgogICAgICAgICAgICBTZXQtQ29udGVudCAtUGF0aCAiJGNvbmZpZ0ZpbGVGb3JlRnJvbnQiIC1Gb3JjZSAtVmFsdWUgJHhtbENvbmZpZ0ZvcmVGcm9udAogICAgICAgIH0KICAgIH0KICAgICNFbmRSZWdpb24KfQojRW5kUmVnaW9uCgojUmVnaW9uIENoZWNrIEluc3RhbGxhdGlvbiBBY2NvdW50CiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBDaGVja0luc3RhbGxBY2NvdW50CiMgRGVzYzogQ2hlY2sgdGhlIGluc3RhbGwgYWNjb3VudCBhbmQKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBDaGVja0luc3RhbGxBY2NvdW50KFt4bWxdJHhtbGlucHV0KQp7CiAgICAjIENoZWNrIGlmIHdlIGFyZSBydW5uaW5nIHVuZGVyIEZhcm0gQWNjb3VudCBjcmVkZW50aWFscwogICAgJGZhcm1BY2N0ID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5BY2NvdW50LlVzZXJuYW1lCiAgICBJZiAoJGVudjpVU0VSRE9NQUlOKyJcIiskZW52OlVTRVJOQU1FIC1lcSAkZmFybUFjY3QpCiAgICB7CiAgICAgICAgbG9nICIgLSBXQVJOSU5HOiBSdW5uaW5nIGluc3RhbGwgdXNpbmcgRmFybSBBY2NvdW50OiAkZmFybUFjY3QiCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBEaXNhYmxlIExvb3BiYWNrIENoZWNrIGFuZCBTZXJ2aWNlcwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogRGlzYWJsZUxvb3BiYWNrQ2hlY2sKIyBEZXNjOiBEaXNhYmxlIExvb3BiYWNrIENoZWNrCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gRGlzYWJsZUxvb3BiYWNrQ2hlY2soW3htbF0keG1saW5wdXQpCnsKICAgICMgRGlzYWJsZSB0aGUgTG9vcGJhY2sgQ2hlY2sgb24gc3RhbmQgYWxvbmUgZGVtbyBzZXJ2ZXJzLgogICAgIyBUaGlzIHNldHRpbmcgdXN1YWxseSBraWNrcyBvdXQgYSA0MDEgZXJyb3Igd2hlbiB5b3UgdHJ5IHRvIG5hdmlnYXRlIHRvIHNpdGVzIHRoYXQgcmVzb2x2ZSB0byBhIGxvb3BiYWNrIGFkZHJlc3MgZS5nLiAgMTI3LjAuMC4xCiAgICBJZiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uSW5zdGFsbC5EaXNhYmxlLkxvb3BiYWNrQ2hlY2sgLWVxICR0cnVlKQogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgIGxvZyAiIC0gRGlzYWJsaW5nIExvb3BiYWNrIENoZWNrLi4uIgoKICAgICAgICAkbHNhUGF0aCA9ICJIS0xNOlxTeXN0ZW1cQ3VycmVudENvbnRyb2xTZXRcQ29udHJvbFxMc2EiCiAgICAgICAgJGxzYVBhdGhWYWx1ZSA9IEdldC1JdGVtUHJvcGVydHkgLXBhdGggJGxzYVBhdGgKICAgICAgICBJZiAoLW5vdCAoJGxzYVBhdGhWYWx1ZS5EaXNhYmxlTG9vcGJhY2tDaGVjayAtZXEgIjEiKSkKICAgICAgICB7CiAgICAgICAgICAgIE5ldy1JdGVtUHJvcGVydHkgSEtMTTpcU3lzdGVtXEN1cnJlbnRDb250cm9sU2V0XENvbnRyb2xcTHNhIC1OYW1lICJEaXNhYmxlTG9vcGJhY2tDaGVjayIgLXZhbHVlICIxIiAtUHJvcGVydHlUeXBlIGR3b3JkIC1Gb3JjZSB8IE91dC1OdWxsCiAgICAgICAgfQogICAgICAgIFdyaXRlTGluZQogICAgfQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogRGlzYWJsZVNlcnZpY2VzCiMgRGVzYzogRGlzYWJsZSBVbnVzZWQgU2VydmljZXMgb3Igc2V0IHN0YXR1cyB0byBNYW51YWwKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBEaXNhYmxlU2VydmljZXMoW3htbF0keG1saW5wdXQpCnsKICAgIElmICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5JbnN0YWxsLkRpc2FibGUuVW51c2VkU2VydmljZXMgLWVxICR0cnVlKQogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgIGxvZyAiIC0gU2V0dGluZyBzZXJ2aWNlcyBTcG9vbGVyLCBBdWRpb1NydiBhbmQgVGFibGV0SW5wdXRTZXJ2aWNlIHRvIE1hbnVhbC4uLiIKCiAgICAgICAgJHNlcnZpY2VzVG9TZXRNYW51YWwgPSAiU3Bvb2xlciIsIkF1ZGlvU3J2IiwiVGFibGV0SW5wdXRTZXJ2aWNlIgogICAgICAgIEZvckVhY2ggKCRzdmNOYW1lIGluICRzZXJ2aWNlc1RvU2V0TWFudWFsKQogICAgICAgIHsKICAgICAgICAgICAgJHN2YyA9IGdldC13bWlvYmplY3Qgd2luMzJfc2VydmljZSB8IHdoZXJlLW9iamVjdCB7JF8uTmFtZSAtZXEgJHN2Y05hbWV9CiAgICAgICAgICAgICRzdmNTdGFydE1vZGUgPSAkc3ZjLlN0YXJ0TW9kZQogICAgICAgICAgICAkc3ZjU3RhdGUgPSAkc3ZjLlN0YXRlCiAgICAgICAgICAgIElmICgoJHN2Y1N0YXRlIC1lcSAiUnVubmluZyIpIC1hbmQgKCRzdmNTdGFydE1vZGUgLWVxICJBdXRvIikpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFN0b3AtU2VydmljZSAtTmFtZSAkc3ZjTmFtZQogICAgICAgICAgICAgICAgU2V0LVNlcnZpY2UgLW5hbWUgJHN2Y05hbWUgLVN0YXJ0dXBUeXBlIE1hbnVhbAogICAgICAgICAgICAgICAgbG9nICIgLSBTZXJ2aWNlICRzdmNOYW1lIGlzIG5vdyBzZXQgdG8gTWFudWFsIHN0YXJ0IgogICAgICAgICAgICB9CiAgICAgICAgICAgIEVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgLSAkc3ZjTmFtZSBpcyBhbHJlYWR5IHN0b3BwZWQgYW5kIHNldCBNYW51YWwsIG5vIGFjdGlvbiByZXF1aXJlZC4iCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGxvZyAiIC0gU2V0dGluZyB1bnVzZWQgc2VydmljZXMgV2VyU3ZjIHRvIERpc2FibGVkLi4uIgogICAgICAgICRzZXJ2aWNlc1RvRGlzYWJsZSA9ICJXZXJTdmMiCiAgICAgICAgRm9yRWFjaCAoJHN2Y05hbWUgaW4gJHNlcnZpY2VzVG9EaXNhYmxlKQogICAgICAgIHsKICAgICAgICAgICAgJHN2YyA9IGdldC13bWlvYmplY3Qgd2luMzJfc2VydmljZSB8IHdoZXJlLW9iamVjdCB7JF8uTmFtZSAtZXEgJHN2Y05hbWV9CiAgICAgICAgICAgICRzdmNTdGFydE1vZGUgPSAkc3ZjLlN0YXJ0TW9kZQogICAgICAgICAgICAkc3ZjU3RhdGUgPSAkc3ZjLlN0YXRlCiAgICAgICAgICAgIElmICgoJHN2Y1N0YXRlIC1lcSAiUnVubmluZyIpIC1hbmQgKCgkc3ZjU3RhcnRNb2RlIC1lcSAiQXV0byIpIC1vciAoJHN2Y1N0YXJ0TW9kZSAtZXEgIk1hbnVhbCIpKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgU3RvcC1TZXJ2aWNlIC1OYW1lICRzdmNOYW1lCiAgICAgICAgICAgICAgICBTZXQtU2VydmljZSAtbmFtZSAkc3ZjTmFtZSAtU3RhcnR1cFR5cGUgRGlzYWJsZWQKICAgICAgICAgICAgICAgIGxvZyAiIC0gU2VydmljZSAkc3ZjTmFtZSBpcyBub3cgc3RvcHBlZCBhbmQgZGlzYWJsZWQuIgogICAgICAgICAgICB9CiAgICAgICAgICAgIEVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgLSAkc3ZjTmFtZSBpcyBhbHJlYWR5IHN0b3BwZWQgYW5kIGRpc2FibGVkLCBubyBhY3Rpb24gcmVxdWlyZWQuIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxvZyAiIC0gRmluaXNoZWQgZGlzYWJsaW5nIHNlcnZpY2VzLiIKICAgICAgICBXcml0ZUxpbmUKICAgIH0KfQojRW5kUmVnaW9uCgojUmVnaW9uIEluc3RhbGwgUHJlcmVxdWlzaXRlcwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogSW5zdGFsbFByZXJlcXVpc2l0ZXMKIyBEZXNjOiBJZiBTaGFyZVBvaW50IGlzIG5vdCBhbHJlYWR5IGluc3RhbGxlZCBpbnN0YWxsIHRoZSBQcmVyZXF1aXNpdGVzCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gSW5zdGFsbFByZXJlcXVpc2l0ZXMoW3htbF0keG1saW5wdXQpCnsKICAgIFdyaXRlTGluZQogICAgIyBSZW1vdmUgYW55IGxpbmdlcmluZyBwb3N0LXJlYm9vdCByZWdpc3RyeSB2YWx1ZXMgZmlyc3QKICAgIFJlbW92ZS1JdGVtUHJvcGVydHkgLVBhdGggIkhLTE06XFNPRlRXQVJFXEF1dG9TUEluc3RhbGxlclwiIC1OYW1lICJSZXN0YXJ0UmVxdWlyZWQiIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICBSZW1vdmUtSXRlbVByb3BlcnR5IC1QYXRoICJIS0xNOlxTT0ZUV0FSRVxBdXRvU1BJbnN0YWxsZXJcIiAtTmFtZSAiQ2FuY2VsUmVtb3RlSW5zdGFsbCIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICMgQ2hlY2sgZm9yIHdoZXRoZXIgVUFDIHdhcyBwcmV2aW91c2x5IGVuYWJsZWQgYW5kIHNob3VsZCB0aGVyZWZvcmUgYmUgcmUtZW5hYmxlZCBhZnRlciBhbiBhdXRvbWF0aWMgcmVzdGFydAoJJHJlZ0tleSA9IEdldC1JdGVtIC1QYXRoICJIS0xNOlxTT0ZUV0FSRVxBdXRvU1BJbnN0YWxsZXJcIiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQoJSWYgKCRyZWdLZXkpIHskVUFDV2FzRW5hYmxlZCA9ICRyZWdrZXkuR2V0VmFsdWUoIlVBQ1dhc0VuYWJsZWQiKX0KCUlmICgkVUFDV2FzRW5hYmxlZCAtZXEgMSkge1NldC1Vc2VyQWNjb3VudENvbnRyb2wgMX0KICAgICMgTm93LCByZW1vdmUgdGhlIGxpbmdlcmluZyByZWdpc3RyeSBVQUMgZmxhZwogICAgUmVtb3ZlLUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiSEtMTTpcU09GVFdBUkVcQXV0b1NQSW5zdGFsbGVyXCIgLU5hbWUgIlVBQ1dhc0VuYWJsZWQiIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICBHZXQtTWFqb3JWZXJzaW9uTnVtYmVyICR4bWxpbnB1dAogICAgIyBDcmVhdGUgYSBoYXNoIHRhYmxlIHdpdGggbWFqb3IgdmVyc2lvbiB0byBwcm9kdWN0IHllYXIgbWFwcGluZ3MKICAgICRzcFllYXJzID0gQHsiMTQiID0gIjIwMTAiOyAiMTUiID0gIjIwMTMiOyAiMTYiID0gIjIwMTYifQogICAgJHNwWWVhciA9ICRzcFllYXJzLiRlbnY6c3BWZXIKICAgICRzcEluc3RhbGxlZCA9IEdldC1TaGFyZVBvaW50SW5zdGFsbAogICAgSWYgKCRzcEluc3RhbGxlZCkKICAgIHsKICAgICAgICBsb2cgIiAtIFNoYXJlUG9pbnQgJHNwWWVhciBwcmVyZXF1aXNpdGVzIGFwcGVhciBiZSBhbHJlYWR5IGluc3RhbGxlZCAtIHNraXBwaW5nIGluc3RhbGwuIgogICAgfQogICAgRWxzZQogICAgewogICAgICAgIGxvZyAiIC0gSW5zdGFsbGluZyBQcmVyZXF1aXNpdGUgU29mdHdhcmU6IgogICAgICAgIElmICgoR3dtaSBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0pLlZlcnNpb24gLWVxICI2LjEuNzYwMSIpICMgV2luMjAwOCBSMiBTUDEKICAgICAgICB7CiAgICAgICAgICAgICMgRHVlIHRvIHRoZSBTaGFyZVBvaW50IDIwMTAgaXNzdWUgZGVzY3JpYmVkIGluIGh0dHA6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20va2IvMjU4MTkwMyAocmVsYXRlZCB0byBpbnN0YWxsaW5nIHRoZSBLQjk3NjQ2MiBob3RmaXgpCiAgICAgICAgICAgICMgKGFuZCBzaW1wbHkgdG8gc3BlZWQgdGhpbmdzIHVwIGZvciBTaGFyZVBvaW50IDIwMTMpIHdlIGluc3RhbGwgdGhlIC5OZXQgMy41LjEgZmVhdHVyZXMgcHJpb3IgdG8gYXR0ZW1wdGluZyB0aGUgUHJlcmVxdWlzaXRlSW5zdGFsbGVyIG9uIFdpbjIwMDggUjIgU1AxCiAgICAgICAgICAgIGxvZyAiICAtIC5OZXQgRnJhbWV3b3JrIDMuNS4xLi4uIiAKICAgICAgICAgICAgIyBHZXQgdGhlIGN1cnJlbnQgcHJvZ3Jlc3MgcHJlZmVyZW5jZQogICAgICAgICAgICAkcHJlZiA9ICRQcm9ncmVzc1ByZWZlcmVuY2UKICAgICAgICAgICAgIyBIaWRlIHRoZSBwcm9ncmVzcyBiYXIgc2luY2UgaXQgdGVuZHMgdG8gbm90IGRpc2FwcGVhcgogICAgICAgICAgICAkUHJvZ3Jlc3NQcmVmZXJlbmNlID0gIlNpbGVudGx5Q29udGludWUiCiAgICAgICAgICAgIEltcG9ydC1Nb2R1bGUgU2VydmVyTWFuYWdlcgogICAgICAgICAgICBJZiAoIShHZXQtV2luZG93c0ZlYXR1cmUgLU5hbWUgTkVULUZyYW1ld29yaykuSW5zdGFsbGVkKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBBZGQtV2luZG93c0ZlYXR1cmUgLU5hbWUgTkVULUZyYW1ld29yayB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICBsb2cgIkRvbmUuIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2Uge2xvZyAiQWxyZWFkeSBpbnN0YWxsZWQuIn0KICAgICAgICAgICAgIyBSZXN0b3JlIHByb2dyZXNzIHByZWZlcmVuY2UKICAgICAgICAgICAgJFByb2dyZXNzUHJlZmVyZW5jZSA9ICRwcmVmCgogICAgICAgIH0KICAgICAgICBUcnkKICAgICAgICB7CiAgICAgICAgICAgICMgRGV0ZWN0IGlmIHdlJ3JlIGluc3RhbGxpbmcgU1AyMDEwIG9uIFdpbmRvd3MgU2VydmVyIDIwMTIgKFIyKQogICAgICAgICAgICBpZiAoKEdldC1XbWlPYmplY3QgV2luMzJfT3BlcmF0aW5nU3lzdGVtKS5WZXJzaW9uIC1saWtlICI2LjIqIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJG9zTmFtZSA9ICJXaW5kb3dzIFNlcnZlciAyMDEyIgogICAgICAgICAgICAgICAgJHdpbjIwMTIgPSAkdHJ1ZQogICAgICAgICAgICAgICAgJHByZXJlcUluc3RhbGxlclJlcXVpcmVkQnVpbGQgPSAiNzAwOSIgIyBpLmUuIG1pbmltdW0gcmVxdWlyZWQgdmVyc2lvbiBvZiBQcmVyZXF1aXNpdGVJbnN0YWxsZXIuZXhlIGZvciBXaW5kb3dzIFNlcnZlciAyMDEyIGlzIDE0LjAuNzAwOS4xMDAwCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmICgoR2V0LVdtaU9iamVjdCBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0pLlZlcnNpb24gLWxpa2UgIjYuMyoiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkb3NOYW1lID0gIldpbmRvd3MgU2VydmVyIDIwMTIgUjIiCiAgICAgICAgICAgICAgICAkd2luMjAxMiA9ICR0cnVlCiAgICAgICAgICAgICAgICAkcHJlcmVxSW5zdGFsbGVyUmVxdWlyZWRCdWlsZCA9ICI3MTA0IiAjIGkuZS4gbWluaW11bSByZXF1aXJlZCB2ZXJzaW9uIG9mIFByZXJlcXVpc2l0ZUluc3RhbGxlci5leGUgZm9yIFdpbmRvd3MgU2VydmVyIDIwMTIgUjIgaXMgMTQuMC43MTA0LjUwMDAKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHskd2luMjAxMiA9ICRmYWxzZX0KICAgICAgICAgICAgaWYgKCR3aW4yMDEyIC1hbmQgKCRlbnY6c3BWZXIgLWVxICIxNCIpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAtIENoZWNraW5nIGZvciByZXF1aXJlZCB2ZXJzaW9uIG9mIFByZXJlcXVpc2l0ZUluc3RhbGxlci5leGUuLi4iIAogICAgICAgICAgICAgICAgJHByZXJlcUluc3RhbGxlclZlciA9IChHZXQtQ29tbWFuZCAkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXIuZXhlKS5GaWxlVmVyc2lvbkluZm8uUHJvZHVjdFZlcnNpb24KICAgICAgICAgICAgICAgICRudWxsLCRudWxsLCRwcmVyZXFJbnN0YWxsZXJCdWlsZCwkbnVsbCA9ICRwcmVyZXFJbnN0YWxsZXJWZXIgLXNwbGl0ICJcLiIKICAgICAgICAgICAgICAgICMgQ2hlY2sgdGhhdCB0aGUgdmVyc2lvbiBvZiBQcmVyZXF1aXNpdGVJbnN0YWxsZXIuZXhlIGluY2x1ZGVkIGluIHRoZSBNUy1wcm92aWRlZCBTaGFyZVBvaW50IDIwMTAgU1AyLWludGVncmF0ZWQgcGFja2FnZSBtZWV0cyB0aGUgbWluaW11bSByZXF1aXJlZCB2ZXJzaW9uIGZvciB0aGUgZGV0ZWN0ZWQgT1MKICAgICAgICAgICAgICAgIGlmICgkcHJlcmVxSW5zdGFsbGVyQnVpbGQgLWx0ICRwcmVyZXFJbnN0YWxsZXJSZXF1aXJlZEJ1aWxkKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiLiIKICAgICAgICAgICAgICAgICAgICBUaHJvdyAiIC0gU2hhcmVQb2ludCAyMDEwIGlzIG9mZmljaWFsbHkgdW5zdXBwb3J0ZWQgb24gJG9zTmFtZSB3aXRob3V0IGFuIHVwZGF0ZWQgc2V0IG9mIFNQMi1pbnRlZ3JhdGVkIGJpbmFyaWVzIC0gc2VlIGh0dHA6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20va2IvMjcyNDQ3MSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2Uge2xvZyAiT0suIn0KICAgICAgICAgICAgfQogICAgICAgICAgICAjIEluc3RhbGwgdXNpbmcgUHJlcmVxdWlzaXRlSW5zdGFsbGVyIGFzIHVzdWFsCiAgICAgICAgICAgIElmICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5JbnN0YWxsLk9mZmxpbmVJbnN0YWxsIC1lcSAkdHJ1ZSkgIyBJbnN0YWxsIGFsbCBwcmVyZXF1aXNpdGVzIGZyb20gbG9jYWwgZm9sZGVyCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICMgVHJ5IHRvIHByZS1pbnN0YWxsIC5OZXQgRnJhbWV3b3JrIDMuNS4xIG9uIFdpbmRvd3MgU2VydmVyIDIwMTIgb3IgMjAxMiBSMgogICAgICAgICAgICAgICAgaWYgKChHZXQtV21pT2JqZWN0IFdpbjMyX09wZXJhdGluZ1N5c3RlbSkuVmVyc2lvbiAtbGlrZSAiNi4yKiIgLW9yIChHZXQtV21pT2JqZWN0IFdpbjMyX09wZXJhdGluZ1N5c3RlbSkuVmVyc2lvbiAtbGlrZSAiNi4zKiIgLW9yIChHZXQtV21pT2JqZWN0IFdpbjMyX09wZXJhdGluZ1N5c3RlbSkuVmVyc2lvbiAtbGlrZSAiNi40KiIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAtUGF0aCAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcc3hzIikKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiICAtIC5OZXQgRnJhbWV3b3JrIDMuNS4xIGZyb20gYCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xzeHNgIi4uLiIgCiAgICAgICAgICAgICAgICAgICAgICAgICMgR2V0IHRoZSBjdXJyZW50IHByb2dyZXNzIHByZWZlcmVuY2UKICAgICAgICAgICAgICAgICAgICAgICAgJHByZWYgPSAkUHJvZ3Jlc3NQcmVmZXJlbmNlCiAgICAgICAgICAgICAgICAgICAgICAgICMgSGlkZSB0aGUgcHJvZ3Jlc3MgYmFyIHNpbmNlIGl0IHRlbmRzIHRvIG5vdCBkaXNhcHBlYXIKICAgICAgICAgICAgICAgICAgICAgICAgJFByb2dyZXNzUHJlZmVyZW5jZSA9ICJTaWxlbnRseUNvbnRpbnVlIgogICAgICAgICAgICAgICAgICAgICAgICBJbXBvcnQtTW9kdWxlIFNlcnZlck1hbmFnZXIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoR2V0LVdpbmRvd3NGZWF0dXJlIC1OYW1lIE5FVC1GcmFtZXdvcmstQ29yZSkuSW5zdGFsbGVkKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1Qcm9jZXNzIC1GaWxlUGF0aCBESVNNLmV4ZSAtQXJndW1lbnRMaXN0ICIvT25saW5lIC9FbmFibGUtRmVhdHVyZSAvRmVhdHVyZU5hbWU6TmV0RngzIC9BbGwgL0xpbWl0QWNjZXNzIC9Tb3VyY2U6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xzeHNgIiIgLU5vTmV3V2luZG93IC1XYWl0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjI0luc3RhbGwtV2luZG93c0ZlYXR1cmUgTkVULUZyYW1ld29yay1Db3JlIMOi4oKs4oCcU291cmNlICIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xzeHMiIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiRG9uZS4iCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7bG9nICJBbHJlYWR5IGluc3RhbGxlZC4ifQogICAgICAgICAgICAgICAgICAgICAgICAjIFJlc3RvcmUgcHJvZ3Jlc3MgcHJlZmVyZW5jZQogICAgICAgICAgICAgICAgICAgICAgICAkUHJvZ3Jlc3NQcmVmZXJlbmNlID0gJHByZWYKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7bG9nICIgLSBDb3VsZCBub3QgbG9jYXRlIHNvdXJjZSBmb3IgLk5ldCBGcmFtZXdvcmsgMy41LjFgbiAtIFRoZSBQcmVyZXF1aXNpdGVJbnN0YWxsZXIgd2lsbCBhdHRlbXB0IHRvIGRvd25sb2FkIGl0LiJ9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoJGVudjpzcFZlciAtZXEgIjE0IikgIyBTUDIwMTAKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSBTUUwgTmF0aXZlIENsaWVudC4uLiIKICAgICAgICAgICAgICAgICAgICAjIEluc3RhbGwgU1FMIG5hdGl2ZSBjbGllbnQgYmVmb3JlIHJ1bm5pbmcgcHJlLXJlcXVpc2l0ZSBpbnN0YWxsZXIgYXMgbmV3ZXN0IHZlcnNpb25zIHJlcXVpcmUgYW4gSUFDQ0VQVFNRTE5DTElMSUNFTlNFVEVSTVM9WUVTIGFyZ3VtZW50CiAgICAgICAgICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcc3FsbmNsaS5tc2kiIC1XYWl0IC1Bcmd1bWVudExpc3QgIi9wYXNzaXZlIC9ub3Jlc3RhcnQgSUFDQ0VQVFNRTE5DTElMSUNFTlNFVEVSTVM9WUVTIgogICAgICAgICAgICAgICAgICAgIGxvZyAiICAtIFJ1bm5pbmcgUHJlcmVxdWlzaXRlIEluc3RhbGxlciAob2ZmbGluZSBtb2RlKS4uLiIgCiAgICAgICAgICAgICAgICAgICAgJHN0YXJ0VGltZSA9IEdldC1EYXRlCiAgICAgICAgICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyLmV4ZSIgLUFyZ3VtZW50TGlzdCAiL3VuYXR0ZW5kZWQgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL1NRTE5DbGk6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xzcWxuY2xpLm1zaWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9DaGFydENvbnRyb2w6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xNU0NoYXJ0LmV4ZWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9ORVRGWDM1U1AxOmAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcZG90bmV0ZngzNS5leGVgIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvUG93ZXJTaGVsbDpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXFdpbmRvd3M2LjAtS0I5Njg5MzAteDY0Lm1zdWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9LQjk3NjM5NDpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXFdpbmRvd3M2LjAtS0I5NzYzOTQteDY0Lm1zdWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9LQjk3NjQ2MjpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXFdpbmRvd3M2LjEtS0I5NzY0NjItdjIteDY0Lm1zdWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9JREZYOmAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcV2luZG93czYuMC1LQjk3NDQwNS14NjQubXN1YCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL0lERlhSMjpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXFdpbmRvd3M2LjEtS0I5NzQ0MDUteDY0Lm1zdWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9TeW5jOmAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcU3luY2hyb25pemF0aW9uLm1zaWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9GaWx0ZXJQYWNrOmAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcRmlsdGVyUGFja1xGaWx0ZXJQYWNrLm1zaWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9BRE9NRDpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXFNRTFNFUlZFUjIwMDhfQVNBRE9NRDEwLm1zaWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9SZXBvcnRpbmdTZXJ2aWNlczpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXHJzU2hhcmVQb2ludC5tc2lgIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvU3BlZWNoOmAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcU3BlZWNoUGxhdGZvcm1SdW50aW1lLm1zaWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9TcGVlY2hMUEs6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xNU1NwZWVjaF9TUl9lbi1VU19URUxFLm1zaWAiIgogICAgICAgICAgICAgICAgICAgIElmICgtbm90ICQ/KSB7VGhyb3d9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYgKCRlbnY6c3BWZXIgLWVxICIxNSIpICNTUDIwMTMKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSBSdW5uaW5nIFByZXJlcXVpc2l0ZSBJbnN0YWxsZXIgKG9mZmxpbmUgbW9kZSkuLi4iIAogICAgICAgICAgICAgICAgICAgICRzdGFydFRpbWUgPSBHZXQtRGF0ZQogICAgICAgICAgICAgICAgICAgIGlmIChDaGVja0ZvcjIwMTNTUDEpICMgSW5jbHVkZSBXQ0ZEYXRhU2VydmljZXM1NiBhcyByZXF1aXJlZCBieSB1cGRhdGVkIFNQMSBwcmVyZXF1aXNpdGVpbnN0YWxsZXIuZXhlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1Qcm9jZXNzICIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXIuZXhlIiAtQXJndW1lbnRMaXN0ICIvdW5hdHRlbmRlZCBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9TUUxOQ2xpOmAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcc3FsbmNsaS5tc2lgIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9Qb3dlclNoZWxsOmAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcV2luZG93czYuMS1LQjI1MDYxNDMteDY0Lm1zdWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL05FVEZYOmAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcZG90TmV0Rng0NV9GdWxsX3g4Nl94NjQuZXhlYCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvSURGWDpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXFdpbmRvd3M2LjEtS0I5NzQ0MDUteDY0Lm1zdWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL0lERlgxMTpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXE1pY3Jvc29mdElkZW50aXR5RXh0ZW5zaW9ucy02NC5tc2lgIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9TeW5jOmAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcU3luY2hyb25pemF0aW9uLm1zaWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL0FwcEZhYnJpYzpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXFdpbmRvd3NTZXJ2ZXJBcHBGYWJyaWNTZXR1cF94NjQuZXhlYCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvS0IyNjcxNzYzOmAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcQXBwRmFicmljMS4xLVJUTS1LQjI2NzE3NjMteDY0LUVOVS5leGVgIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9NU0lQQ0NsaWVudDpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXHNldHVwX21zaXBjX3g2NC5tc2lgIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9XQ0ZEYXRhU2VydmljZXM6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xXY2ZEYXRhU2VydmljZXMuZXhlYCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvV0NGRGF0YVNlcnZpY2VzNTY6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xXY2ZEYXRhU2VydmljZXM1Ni5leGVgIiIKICAgICAgICAgICAgICAgICAgICAgICAgSWYgKC1ub3QgJD8pIHtUaHJvd30KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSAjIEp1c3QgaW5zdGFsbCB0aGUgcHJlLVNQMSBzZXQgb2YgcHJlcmVxdWlzaXRlcwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyLmV4ZSIgLUFyZ3VtZW50TGlzdCAiL3VuYXR0ZW5kZWQgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvU1FMTkNsaTpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXHNxbG5jbGkubXNpYCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvUG93ZXJTaGVsbDpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXFdpbmRvd3M2LjEtS0IyNTA2MTQzLXg2NC5tc3VgIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9ORVRGWDpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXGRvdE5ldEZ4NDVfRnVsbF94ODZfeDY0LmV4ZWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL0lERlg6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xXaW5kb3dzNi4xLUtCOTc0NDA1LXg2NC5tc3VgIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9JREZYMTE6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xNaWNyb3NvZnRJZGVudGl0eUV4dGVuc2lvbnMtNjQubXNpYCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvU3luYzpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXFN5bmNocm9uaXphdGlvbi5tc2lgIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9BcHBGYWJyaWM6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xXaW5kb3dzU2VydmVyQXBwRmFicmljU2V0dXBfeDY0LmV4ZWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL0tCMjY3MTc2MzpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXEFwcEZhYnJpYzEuMS1SVE0tS0IyNjcxNzYzLXg2NC1FTlUuZXhlYCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvTVNJUENDbGllbnQ6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xzZXR1cF9tc2lwY194NjQubXNpYCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvV0NGRGF0YVNlcnZpY2VzOmAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcV2NmRGF0YVNlcnZpY2VzLmV4ZWAiIgogICAgICAgICAgICAgICAgICAgICAgICBJZiAoLW5vdCAkPykge1Rocm93fQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2VpZiAoJGVudjpzcFZlciAtZXEgIjE2IikgI1NQMjAxNgogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiICAtIFJ1bm5pbmcgUHJlcmVxdWlzaXRlIEluc3RhbGxlciAob2ZmbGluZSBtb2RlKS4uLiIgCiAgICAgICAgICAgICAgICAgICAgJHN0YXJ0VGltZSA9IEdldC1EYXRlCiAgICAgICAgICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyLmV4ZSIgLUFyZ3VtZW50TGlzdCAiL3VuYXR0ZW5kZWQgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9TUUxOQ2xpOmAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcc3FsbmNsaS5tc2lgIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL1N5bmM6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xTeW5jaHJvbml6YXRpb24ubXNpYCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9BcHBGYWJyaWM6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xXaW5kb3dzU2VydmVyQXBwRmFicmljU2V0dXBfeDY0LmV4ZWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvSURGWDExOmAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcTWljcm9zb2Z0SWRlbnRpdHlFeHRlbnNpb25zLTY0Lm1zaWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvTVNJUENDbGllbnQ6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xzZXR1cF9tc2lwY194NjQuZXhlYCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9LQjMwOTI0MjM6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xBcHBGYWJyaWMtS0IzMDkyNDIzLXg2NC1FTlUuZXhlYCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9XQ0ZEYXRhU2VydmljZXM1NjpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXFdjZkRhdGFTZXJ2aWNlcy5leGVgIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL09EQkM6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1xtc29kYmNzcWwubXNpYCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC9Eb3ROZXRGeDpgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXE5EUDQ2LUtCMzA0NTU1Ny14ODYteDY0LUFsbE9TLUVOVS5leGVgIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL01TVkNSVDExOmAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcdmNyZWRpc3RfeDY0LmV4ZWAiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvTVNWQ1JUMTQ6YCIkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1x2Y19yZWRpc3QueDY0LmV4ZWAiIgogICAgICAgICAgICAgICAgICAgIElmICgtbm90ICQ/KSB7VGhyb3d9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSAjIFJlZ3VsYXIgcHJlcmVxdWlzaXRlIGluc3RhbGwgLSBkb3dubG9hZCByZXF1aXJlZCBmaWxlcwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAgLSBSdW5uaW5nIFByZXJlcXVpc2l0ZSBJbnN0YWxsZXIgKG9ubGluZSBtb2RlKS4uLiIgCiAgICAgICAgICAgICAgICAkc3RhcnRUaW1lID0gR2V0LURhdGUKICAgICAgICAgICAgICAgIFN0YXJ0LVByb2Nlc3MgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlci5leGUiIC1Bcmd1bWVudExpc3QgIi91bmF0dGVuZGVkIiAtV2luZG93U3R5bGUgTWluaW1pemVkCiAgICAgICAgICAgICAgICBJZiAoLW5vdCAkPykge1Rocm93fQogICAgICAgICAgICB9CiAgICAgICAgICAgIFNob3ctUHJvZ3Jlc3MgLVByb2Nlc3MgUHJlcmVxdWlzaXRlSW5zdGFsbGVyIC1Db2xvciBDeWFuIC1JbnRlcnZhbCA1CiAgICAgICAgICAgICRkZWx0YSwkbnVsbCA9IChOZXctVGltZVNwYW4gLVN0YXJ0ICRzdGFydFRpbWUgLUVuZCAoR2V0LURhdGUpKS5Ub1N0cmluZygpIC1zcGxpdCAiXC4iCiAgICAgICAgICAgIGxvZyAiICAtIFByZXJlcXVpc2l0ZSBJbnN0YWxsZXIgY29tcGxldGVkIGluICRkZWx0YS4iCiAgICAgICAgICAgIElmICgkZW52OnNwVmVyIC1lcSAiMTUiKSAjIFNQMjAxMwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIEluc3RhbGwgdGhlICJtaXNzaW5nIHByZXJlcXVpc2l0ZXMiIGZvciBTUDIwMTMgcGVyIGh0dHA6Ly93d3cudG9kZGtsaW5kdC5jb20vYmxvZy9MaXN0cy9Qb3N0cy9Qb3N0LmFzcHg/SUQ9MzQ5CiAgICAgICAgICAgICAgICAjIEV4cGFuZCBob3RmaXggZXhlY3V0YWJsZSB0byAkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlc1wKICAgICAgICAgICAgICAgIGlmICgoR3dtaSBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0pLlZlcnNpb24gLWVxICI2LjEuNzYwMSIpICMgV2luMjAwOCBSMiBTUDEKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkbWlzc2luZ0hvdGZpeGVzID0gQHsiV2luZG93czYuMS1LQjI1NTQ4NzYtdjIteDY0Lm1zdSIgPSAiaHR0cDovL2hvdGZpeHY0Lm1pY3Jvc29mdC5jb20vV2luZG93cyUyMDcvV2luZG93cyUyMFNlcnZlcjIwMDglMjBSMiUyMFNQMS9zcDIvRml4MzY4MDUxLzc2MDAvZnJlZS80MzMzODVfaW50bF94NjRfemlwLmV4ZSI7CgkJCQkJICAgIAkJCSAgICAgIldpbmRvd3M2LjEtS0IyNzA4MDc1LXg2NC5tc3UiID0gImh0dHA6Ly9ob3RmaXh2NC5taWNyb3NvZnQuY29tL1dpbmRvd3MlMjA3L1dpbmRvd3MlMjBTZXJ2ZXIyMDA4JTIwUjIlMjBTUDEvc3AyL0ZpeDQwMjU2OC83NjAwL2ZyZWUvNDQ3Njk4X2ludGxfeDY0X3ppcC5leGUiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJXaW5kb3dzNi4xLUtCMjQ3MjI2NC12My14NjQubXN1IiA9ICJodHRwOi8vaG90Zml4djQubWljcm9zb2Z0LmNvbS9XaW5kb3dzJTIwNy9XaW5kb3dzJTIwU2VydmVyMjAwOCUyMFIyJTIwU1AxL3NwMi9GaXgzNTQ0MDAvNzYwMC9mcmVlLzQyNzA4N19pbnRsX3g2NF96aXAuZXhlIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiV2luZG93czYuMS1LQjI1Njc2ODAteDY0Lm1zdSIgPSAiaHR0cDovL2Rvd25sb2FkLm1pY3Jvc29mdC5jb20vZG93bmxvYWQvQy9EL0EvQ0RBRjVERDgtM0I5QS00RjhELUE0OEYtQkVGRTUzQzVCMjQ5L1dpbmRvd3M2LjEtS0IyNTY3NjgwLXg2NC5tc3UiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJORFA0NS1LQjI3NTkxMTIteDY0LmV4ZSIgPSAiaHR0cDovL2Rvd25sb2FkLm1pY3Jvc29mdC5jb20vZG93bmxvYWQvNS82LzMvNTYzMUI3NTMtQTAwOS00OEFGLTgyNkMtMkQyQzI5Qjk0MTcyL05EUDQ1LUtCMjc1OTExMi14NjQuZXhlIn0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2VpZiAoKEdldC1XbWlPYmplY3QgV2luMzJfT3BlcmF0aW5nU3lzdGVtKS5WZXJzaW9uIC1saWtlICI2LjIqIikgIyBXaW4yMDEyCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJG1pc3NpbmdIb3RmaXhlcyA9IEB7IldpbmRvd3M4LVJULUtCMjc2NTMxNy14NjQubXN1IiA9ICJodHRwOi8vZG93bmxvYWQubWljcm9zb2Z0LmNvbS9kb3dubG9hZC8wLzIvRS8wMkU5RTU2OS01NDYyLTQ4RUItQUY1Ny04RENDRjg1MkU2RjQvV2luZG93czgtUlQtS0IyNzY1MzE3LXg2NC5tc3UifQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7fSAjIFJlc2VydmVkIGZvciBXaW4yMDEyIFIyCiAgICAgICAgICAgICAgICBpZiAoJG1pc3NpbmdIb3RmaXhlcy5Db3VudCAtZ2UgMSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSBTaGFyZVBvaW50IDIwMTMgYCJtaXNzaW5nIGhvdGZpeGAiIHByZXJlcXVpc2l0ZXMuLi4iCiAgICAgICAgICAgICAgICAgICAgJGhvdGZpeExvY2F0aW9uID0gJGVudjpTUGJpdHMrIlxQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlcyIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEZvckVhY2ggKCRob3RmaXhQYXRjaCBpbiAkbWlzc2luZ0hvdGZpeGVzLktleXMpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJGhvdGZpeEtCID0gJGhvdGZpeFBhdGNoLlNwbGl0KCctJykgfCBXaGVyZS1PYmplY3QgeyRfIC1saWtlICJLQioifQogICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGhvdGZpeCBpcyBhbHJlYWR5IGluc3RhbGxlZAogICAgICAgICAgICAgICAgICAgIGxvZyAiICAgLSBDaGVja2luZyBmb3IgJGhvdGZpeEtCLi4uIiAKICAgICAgICAgICAgICAgICAgICBJZiAoIShHZXQtSG90Rml4IC1JZCAkaG90Zml4S0IgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJNaXNzaW5nOyBhdHRlbXB0aW5nIHRvIGluc3RhbGwuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgICRob3RmaXhVcmwgPSAkbWlzc2luZ0hvdGZpeGVzLiRob3RmaXhQYXRjaAogICAgICAgICAgICAgICAgICAgICAgICAkaG90Zml4RmlsZSA9ICRob3RmaXhVcmwuU3BsaXQoJy8nKVstMV0KICAgICAgICAgICAgICAgICAgICAgICAgJGhvdGZpeEZpbGVaaXAgPSAkaG90Zml4RmlsZSsiLnppcCIKICAgICAgICAgICAgICAgICAgICAgICAgJGhvdGZpeFppcFBhdGggPSBKb2luLVBhdGggLVBhdGggJGhvdGZpeExvY2F0aW9uIC1DaGlsZFBhdGggJGhvdGZpeEZpbGVaaXAKICAgICAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBpZiB0aGUgLm1zdS8uZXhlIGZpbGUgaXMgYWxyZWFkeSBwcmVzZW50CiAgICAgICAgICAgICAgICAgICAgICAgIElmIChUZXN0LVBhdGggIiRob3RmaXhMb2NhdGlvblwkaG90Zml4UGF0Y2giKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAgICAtIEhvdGZpeCBmaWxlIGAiJGhvdGZpeFBhdGNoYCIgZm91bmQuIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIEVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBpZiB0aGUgZG93bmxvYWRlZCBwYWNrYWdlIGV4aXN0cyB3aXRoIGEgLnppcCBleHRlbnNpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmICghKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRob3RmaXhGaWxlWmlwKSkgLWFuZCAoVGVzdC1QYXRoICIkaG90Zml4TG9jYXRpb25cJGhvdGZpeEZpbGVaaXAiKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAgICAtIEZpbGUgJGhvdGZpeEZpbGUgKHppcCkgZm91bmQuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAJRWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGRvd25sb2FkZWQgcGFja2FnZSBleGlzdHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJZiAoVGVzdC1QYXRoICIkaG90Zml4TG9jYXRpb25cJGhvdGZpeEZpbGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAkJbG9nICIgICAgLSBGaWxlICRob3RmaXhGaWxlIGZvdW5kLiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRWxzZSAjIEdvIGFoZWFkIGFuZCBkb3dubG9hZCB0aGUgbWlzc2luZyBwYWNrYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAJewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcnkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAkJIyBCZWdpbiBkb3dubG9hZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgICAgLSBIb3RmaXggJGhvdGZpeFBhdGNoIG5vdCBmb3VuZCBpbiAkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlcyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiICAgIC0gQXR0ZW1wdGluZyB0byBkb3dubG9hZC4uLiIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbXBvcnQtTW9kdWxlIEJpdHNUcmFuc2ZlciB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1CaXRzVHJhbnNmZXIgLVNvdXJjZSAkaG90Zml4VXJsIC1EZXN0aW5hdGlvbiAiJGhvdGZpeExvY2F0aW9uXCRob3RmaXhGaWxlIiAtRGlzcGxheU5hbWUgIkRvd25sb2FkaW5nIGAnJGhvdGZpeEZpbGVgJyB0byAkaG90Zml4TG9jYXRpb24iIC1Qcmlvcml0eSBGb3JlZ3JvdW5kIC1EZXNjcmlwdGlvbiAiRnJvbSAkaG90Zml4VXJsLi4uIiAtRXJyb3JWYXJpYWJsZSBlcnIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZXJyKSB7bG9nICIuIjsgVGhyb3cgIiAgLSBDb3VsZCBub3QgZG93bmxvYWQgZnJvbSAkaG90Zml4VXJsISJ9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIkRvbmUhIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhdGNoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCWxvZyAiV0FSTklORzogIC0gQW4gZXJyb3Igb2NjdXJyZWQgYXR0ZW1wdGluZyB0byBkb3dubG9hZCBgIiRob3RmaXhGaWxlYCIuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAJYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGhvdGZpeEZpbGUgLWxpa2UgIip6aXAuZXhlIikgIyBUaGUgaG90Zml4IGlzIHByb2JhYmx5IGEgc2VsZi1leHRyYWN0aW5nIGV4ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBHaXZlIHRoZSBmaWxlIGEgLnppcCBleHRlbnNpb24gc28gd2UgY2FuIHdvcmsgd2l0aCBpdCBsaWtlIGEgY29tcHJlc3NlZCBmb2xkZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgICAgLSBSZW5hbWluZyAkaG90Zml4RmlsZSB0byAkaG90Zml4RmlsZVppcC4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVuYW1lLUl0ZW0gLVBhdGggIiRob3RmaXhMb2NhdGlvblwkaG90Zml4RmlsZSIgLU5ld05hbWUgJGhvdGZpeEZpbGVaaXAgLUZvcmNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgKFRlc3QtUGF0aCAiJGhvdGZpeExvY2F0aW9uXCRob3RmaXhGaWxlWmlwIikgIyBUaGUgemlwcGVkIGhvdGZpeCBleGlzdHMsIGFuZHMgbmVlZHMgdG8gYmUgZXh0cmFjdGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgICAgLSBFeHRyYWN0aW5nIGAiJGhvdGZpeFBhdGNoYCIgZnJvbSBgIiRob3RmaXhGaWxlYCIuLi4iIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzaGVsbCA9IE5ldy1PYmplY3QgLUNvbU9iamVjdCBTaGVsbC5BcHBsaWNhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRob3RmaXhGaWxlWmlwTnMgPSAkc2hlbGwuTmFtZXNwYWNlKCRob3RmaXhaaXBQYXRoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRob3RmaXhMb2NhdGlvbk5zID0gJHNoZWxsLk5hbWVzcGFjZSgkaG90Zml4TG9jYXRpb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGhvdGZpeExvY2F0aW9uTnMuQ29weWhlcmUoJGhvdGZpeEZpbGVaaXBOcy5pdGVtcygpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiRG9uZS4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgIyBJbnN0YWxsIHRoZSBob3RmaXgKICAgICAgICAgICAgICAgICAgICAgICAgJGV4dHJhY3RlZEhvdGZpeFBhdGggPSBKb2luLVBhdGggLVBhdGggJGhvdGZpeExvY2F0aW9uIC1DaGlsZFBhdGggJGhvdGZpeFBhdGNoCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiICAgIC0gSW5zdGFsbGluZyBob3RmaXggJGhvdGZpeFBhdGNoLi4uIiAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRob3RmaXhQYXRjaCAtbGlrZSAiKi5tc3UiKSAjIFRyZWF0IGFzIGEgV2luZG93cyBVcGRhdGUgcGF0Y2gKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAtRmlsZVBhdGggInd1c2EuZXhlIiAtQXJndW1lbnRMaXN0ICJgIiRleHRyYWN0ZWRIb3RmaXhQYXRoYCIgL3F1aWV0IC9ub3Jlc3RhcnQiIC1XYWl0IC1Ob05ld1dpbmRvdwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgIyBUcmVhdCBhcyBhbiBleGVjdXRhYmxlICguZXhlKSBwYXRjaAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1Qcm9jZXNzIC1GaWxlUGF0aCAiJGV4dHJhY3RlZEhvdGZpeFBhdGgiIC1Bcmd1bWVudExpc3QgIi9wYXNzaXZlIC9ub3Jlc3RhcnQiIC1XYWl0IC1Ob05ld1dpbmRvdwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiRG9uZS4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIEVsc2Uge2xvZyAiQWxyZWFkeSBpbnN0YWxsZWQuIn0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBDYXRjaAogICAgICAgIHsKICAgICAgICAgICAgbG9nICIuIgogICAgICAgICAgICBsb2cgIiAtIEVycm9yOiAkXyAkTEFTVEVYSVRDT0RFIgogICAgICAgICAgICBJZiAoJExBU1RFWElUQ09ERSAtZXEgIjEiKSB7VGhyb3cgIiAtIEFub3RoZXIgaW5zdGFuY2Ugb2YgdGhpcyBhcHBsaWNhdGlvbiBpcyBhbHJlYWR5IHJ1bm5pbmcifQogICAgICAgICAgICBFbHNlSWYgKCRMQVNURVhJVENPREUgLWVxICIyIikge1Rocm93ICIgLSBJbnZhbGlkIGNvbW1hbmQgbGluZSBwYXJhbWV0ZXIocykifQogICAgICAgICAgICBFbHNlSWYgKCRMQVNURVhJVENPREUgLWVxICIxMDAxIikge1Rocm93ICIgLSBBIHBlbmRpbmcgcmVzdGFydCBibG9ja3MgaW5zdGFsbGF0aW9uIn0KICAgICAgICAgICAgRWxzZUlmICgkTEFTVEVYSVRDT0RFIC1lcSAiMzAxMCIpIHtUaHJvdyAiIC0gQSByZXN0YXJ0IGlzIG5lZWRlZCJ9CiAgICAgICAgICAgIEVsc2VJZiAoJExBU1RFWElUQ09ERSAtZXEgIi0yMTQ1MTI0MzI5Iikge2xvZyAiIC0gQSBrbm93biBpc3N1ZSBvY2N1cnJlZCBpbnN0YWxsaW5nIG9uZSBvZiB0aGUgcHJlcmVxdWlzaXRlcyI7IEluc3RhbGxQcmVSZXF1aXNpdGVzIChbeG1sXSR4bWxpbnB1dCl9CiAgICAgICAgICAgIEVsc2Uge1Rocm93ICIgLSBBbiB1bmtub3duIGVycm9yIG9jY3VycmVkIGluc3RhbGxpbmcgcHJlcmVxdWlzaXRlcyJ9CiAgICAgICAgfQogICAgICAgICMgUGFyc2luZyBtb3N0IHJlY2VudCBQcmVSZXF1aXNpdGVJbnN0YWxsZXIgbG9nIGZvciBlcnJvcnMgb3IgcmVzdGFydCByZXF1aXJlbWVudHMsIHNpbmNlICRMQVNURVhJVENPREUgZG9lc24ndCBzZWVtIHRvIHdvcmsuLi4KICAgICAgICAkcHJlUmVxTG9nID0gR2V0LUNoaWxkSXRlbSAtUGF0aCAoR2V0LUl0ZW0gJGVudjpURU1QKS5GdWxsTmFtZSB8ID8geyRfLk5hbWUgLWxpa2UgIlByZXJlcXVpc2l0ZUluc3RhbGxlci4qIn0gfCBTb3J0LU9iamVjdCAtRGVzY2VuZGluZyAtUHJvcGVydHkgIkxhc3RXcml0ZVRpbWUiIHwgU2VsZWN0LU9iamVjdCAtZmlyc3QgMQogICAgICAgIElmICgkcHJlUmVxTG9nIC1lcSAkbnVsbCkKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAiV0FSTklORzpDb3VsZCBub3QgZmluZCBQcmVyZXF1aXNpdGVJbnN0YWxsZXIgbG9nIGZpbGUiCiAgICAgICAgfQogICAgICAgIEVsc2UKICAgICAgICB7CiAgICAgICAgICAgICMgR2V0IGVycm9yKHMpIGZyb20gbG9nCiAgICAgICAgICAgICRwcmVSZXFMYXN0RXJyb3IgPSAkcHJlUmVxTG9nIHwgU2VsZWN0LVN0cmluZyAtU2ltcGxlTWF0Y2ggLVBhdHRlcm4gIkVycm9yIiAtRW5jb2RpbmcgVW5pY29kZSB8ID8geyRfLkxpbmUgIC1ub3RsaWtlICIqU3RhcnR1cCB0YXNrKiJ9CiAgICAgICAgICAgIElmICgkcHJlUmVxTGFzdEVycm9yKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBGb3JFYWNoICgkcHJlUmVxRXJyb3IgaW4gKCRwcmVSZXFMYXN0RXJyb3IgfCBGb3JFYWNoIHskXy5MaW5lfSkpIHtsb2cgJHByZVJlcUVycm9yfQogICAgICAgICAgICAgICAgJHByZVJlcUxhc3RSZXR1cm5jb2RlID0gJHByZVJlcUxvZyB8IFNlbGVjdC1TdHJpbmcgLVNpbXBsZU1hdGNoIC1QYXR0ZXJuICJMYXN0IHJldHVybiBjb2RlIiAtRW5jb2RpbmcgVW5pY29kZSB8IFNlbGVjdC1PYmplY3QgLUxhc3QgMQogICAgICAgICAgICAgICAgSWYgKCRwcmVSZXFMYXN0UmV0dXJuQ29kZSkge1dyaXRlLVZlcmJvc2UgJHByZVJlcUxhc3RSZXR1cm5jb2RlLkxpbmV9CiAgICAgICAgICAgICAgICBJZiAoISgkcHJlUmVxTGFzdFJldHVybmNvZGUgLWxpa2UgIiooMCkiKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgJHByZVJlcUxhc3RSZXR1cm5jb2RlLkxpbmUKICAgICAgICAgICAgICAgICAgICBJZiAoKCRwcmVSZXFMYXN0UmV0dXJuY29kZSAtbGlrZSAiKi0yMTQ1MTI0MzI5KiIpIC1vciAoJHByZVJlcUxhc3RSZXR1cm5jb2RlIC1saWtlICIqMjM1OTMwMioiKSAtb3IgKCRwcmVSZXFMYXN0UmV0dXJuY29kZSAtZXEgIjUiKSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gQSBrbm93biBpc3N1ZSBvY2N1cnJlZCBpbnN0YWxsaW5nIG9uZSBvZiB0aGUgcHJlcmVxdWlzaXRlcyAtIHJldHJ5aW5nLi4uIgogICAgICAgICAgICAgICAgICAgICAgICBJbnN0YWxsUHJlUmVxdWlzaXRlcyAoW3htbF0keG1saW5wdXQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIEVsc2VJZiAoKCRwcmVSZXFMb2cgfCBTZWxlY3QtU3RyaW5nIC1TaW1wbGVNYXRjaCAtUGF0dGVybiAiRXJyb3Igd2hlbiBlbmFibGluZyBBU1AuTkVUIHY0LjAuMzAzMTkiIC1FbmNvZGluZyBVbmljb2RlKSAtb3IgKCRwcmVSZXFMb2cgfCBTZWxlY3QtU3RyaW5nIC1TaW1wbGVNYXRjaCAtUGF0dGVybiAiRXJyb3Igd2hlbiBlbmFibGluZyBBU1AuTkVUIHY0LjUgd2l0aCBJSVMiIC1FbmNvZGluZyBVbmljb2RlKSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgQWNjb3VudCBmb3IgbmV3IGlzc3VlIHdpdGggV2luMjAxMiBSQyAvIFIyIGFuZCBTUDIwMTMKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBBIGtub3duIGlzc3VlIG9jY3VycmVkIGNvbmZpZ3VyaW5nIC5ORVQgNCAvIElJUy4iCiAgICAgICAgICAgICAgICAgICAgICAgICRwcmVSZXFLbm93bklzc3VlUmVzdGFydCA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIEVsc2VJZiAoJHByZVJlcUxvZyB8IFNlbGVjdC1TdHJpbmcgLVNpbXBsZU1hdGNoIC1QYXR0ZXJuICJwZW5kaW5nIHJlc3RhcnQgYmxvY2tzIHRoZSBpbnN0YWxsYXRpb24iIC1FbmNvZGluZyBVbmljb2RlKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBBIHBlbmRpbmcgcmVzdGFydCBibG9ja3MgdGhlIGluc3RhbGxhdGlvbi4iCiAgICAgICAgICAgICAgICAgICAgICAgICRwcmVSZXFLbm93bklzc3VlUmVzdGFydCA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIEVsc2VJZiAoJHByZVJlcUxvZyB8IFNlbGVjdC1TdHJpbmcgLVNpbXBsZU1hdGNoIC1QYXR0ZXJuICJFcnJvcjogVGhpcyB0b29sIHN1cHBvcnRzIFdpbmRvd3MgU2VydmVyIHZlcnNpb24gNi4xIGFuZCB2ZXJzaW9uIDYuMiIgLUVuY29kaW5nIFVuaWNvZGUpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIEEga25vd24gaXNzdWUgb2NjdXJyZWQgKGR1ZSB0byBXaW4yMDEyIFIyKSwgY29udGludWluZy4iCiAgICAgICAgICAgICAgICAgICAgICAgICMjJHByZVJlcUtub3duSXNzdWVSZXN0YXJ0ID0gJHRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgRWxzZQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgSW52b2tlLUl0ZW0gLVBhdGggIiQoKEdldC1JdGVtICRlbnY6VEVNUCkuRnVsbE5hbWUpXCRwcmVSZXFMb2ciCiAgICAgICAgICAgICAgICAgICAgICAgIFRocm93ICIgLSBSZXZpZXcgdGhlIGxvZyBmaWxlIGFuZCB0cnkgdG8gY29ycmVjdCBhbnkgZXJyb3IgY29uZGl0aW9ucy4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICMgTG9vayBmb3IgcmVzdGFydCByZXF1aXJlbWVudCBpbiBsb2cKICAgICAgICAgICAgJHByZVJlcVJlc3RhcnROZWVkZWQgPSAoJHByZVJlcUxvZyB8IFNlbGVjdC1TdHJpbmcgLVNpbXBsZU1hdGNoIC1QYXR0ZXJuICIwWEJDMj0zMDEwIiAtRW5jb2RpbmcgVW5pY29kZSkgLW9yICgkcHJlUmVxTG9nIHwgU2VsZWN0LVN0cmluZyAtU2ltcGxlTWF0Y2ggLVBhdHRlcm4gIjBYM0U5PTEwMDEiIC1FbmNvZGluZyBVbmljb2RlKQogICAgICAgICAgICBJZiAoJHByZVJlcVJlc3RhcnROZWVkZWQgLW9yICRwcmVSZXFLbm93bklzc3VlUmVzdGFydCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgLSBTZXR0aW5nIEF1dG9TUEluc3RhbGxlciBpbmZvcm1hdGlvbiBpbiB0aGUgcmVnaXN0cnkuLi4iCiAgICAgICAgICAgICAgICBOZXctSXRlbSAtUGF0aCAiSEtMTTpcU09GVFdBUkVcQXV0b1NQSW5zdGFsbGVyXCIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgfCBPdXQtTnVsbAoJCQkJJHJlZ0tleSA9IEdldC1JdGVtIC1QYXRoICJIS0xNOlxTT0ZUV0FSRVxBdXRvU1BJbnN0YWxsZXJcIgogICAgICAgICAgICAgICAgJHJlZ0tleSB8IE5ldy1JdGVtUHJvcGVydHkgLU5hbWUgIlJlc3RhcnRSZXF1aXJlZCIgLVByb3BlcnR5VHlwZSBTdHJpbmcgLVZhbHVlICIxIiAtRm9yY2UgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgIyBXZSBub3cgYWxzbyB3YW50IHRvIGRpc2FibGUgcmVtb3RlIGluc3RhbGxzLCBvciBlbHNlIGVhY2ggc2VydmVyIHdpbGwgYXR0ZW1wdCB0byByZW1vdGUgaW5zdGFsbCB0byBldmVyeSAqb3RoZXIqIHNlcnZlciBhZnRlciBpdCByZWJvb3RzIQogICAgICAgICAgICAgICAgJHJlZ0tleSB8IE5ldy1JdGVtUHJvcGVydHkgLU5hbWUgIkNhbmNlbFJlbW90ZUluc3RhbGwiIC1Qcm9wZXJ0eVR5cGUgU3RyaW5nIC1WYWx1ZSAiMSIgLUZvcmNlIHwgT3V0LU51bGwKCQkJCSRyZWdLZXkgfCBOZXctSXRlbVByb3BlcnR5IC1OYW1lICJMb2dUaW1lIiAtUHJvcGVydHlUeXBlIFN0cmluZyAtVmFsdWUgJHNjcmlwdDpMb2d0aW1lIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgIFRocm93ICIgLSBPbmUgb3IgbW9yZSBvZiB0aGUgcHJlcmVxdWlzaXRlcyByZXF1aXJlcyBhIHJlc3RhcnQuIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGxvZyAiIC0gQWxsIFByZXJlcXVpc2l0ZSBTb2Z0d2FyZSBpbnN0YWxsZWQgc3VjY2Vzc2Z1bGx5LiIKICAgICAgICB9CiAgICB9CiAgICBXcml0ZUxpbmUKfQojRW5kUmVnaW9uCgojUmVnaW9uIEluc3RhbGwgU2hhcmVQb2ludAojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogSW5zdGFsbFNoYXJlUG9pbnQKIyBEZXNjOiBJbnN0YWxscyB0aGUgU2hhcmVQb2ludCBiaW5hcmllcyBpbiB1bmF0dGVuZGVkIG1vZGUKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBJbnN0YWxsU2hhcmVQb2ludChbeG1sXSR4bWxpbnB1dCkKewogICAgV3JpdGVMaW5lCiAgICBHZXQtTWFqb3JWZXJzaW9uTnVtYmVyICR4bWxpbnB1dAogICAgIyBDcmVhdGUgYSBoYXNoIHRhYmxlIHdpdGggbWFqb3IgdmVyc2lvbiB0byBwcm9kdWN0IHllYXIgbWFwcGluZ3MKICAgICRzcFllYXJzID0gQHsiMTQiID0gIjIwMTAiOyAiMTUiID0gIjIwMTMiOyAiMTYiID0gIjIwMTYifQogICAgJHNwWWVhciA9ICRzcFllYXJzLiRlbnY6c3BWZXIKICAgICRzcEluc3RhbGxlZCA9IEdldC1TaGFyZVBvaW50SW5zdGFsbAogICAgSWYgKCRzcEluc3RhbGxlZCkKICAgIHsKICAgICAgICBsb2cgIiAtIFNoYXJlUG9pbnQgJHNwWWVhciBiaW5hcmllcyBhcHBlYXIgdG8gYmUgYWxyZWFkeSBpbnN0YWxsZWQgLSBza2lwcGluZyBpbnN0YWxsYXRpb24uIgogICAgfQogICAgRWxzZQogICAgewogICAgICAgICMgSW5zdGFsbCBTaGFyZVBvaW50IEJpbmFyaWVzCiAgICAgICAgSWYgKFRlc3QtUGF0aCAiJGVudjpTUGJpdHNcc2V0dXAuZXhlIikKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAiIC0gSW5zdGFsbGluZyBTaGFyZVBvaW50ICRzcFllYXIgYmluYXJpZXMuLi4iIAogICAgICAgICAgICAkc3RhcnRUaW1lID0gR2V0LURhdGUKICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAiJGVudjpTUGJpdHNcc2V0dXAuZXhlIiAtQXJndW1lbnRMaXN0ICIvY29uZmlnIGAiJGNvbmZpZ0ZpbGVgIiIgLVdpbmRvd1N0eWxlIE1pbmltaXplZAogICAgICAgICAgICBTaG93LVByb2dyZXNzIC1Qcm9jZXNzIHNldHVwIC1Db2xvciBDeWFuIC1JbnRlcnZhbCA1CiAgICAgICAgICAgICRkZWx0YSwkbnVsbCA9IChOZXctVGltZVNwYW4gLVN0YXJ0ICRzdGFydFRpbWUgLUVuZCAoR2V0LURhdGUpKS5Ub1N0cmluZygpIC1zcGxpdCAiXC4iCiAgICAgICAgICAgIGxvZyAiIC0gU2hhcmVQb2ludCAkc3BZZWFyIHNldHVwIGNvbXBsZXRlZCBpbiAkZGVsdGEuIgogICAgICAgICAgICBJZiAoLW5vdCAkPykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgVGhyb3cgIiAtIEVycm9yICRMQVNURVhJVENPREUgb2NjdXJyZWQgcnVubmluZyAkZW52OlNQYml0c1xzZXR1cC5leGUiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgUGFyc2luZyBtb3N0IHJlY2VudCBTaGFyZVBvaW50IFNlcnZlciBTZXR1cCBsb2cgZm9yIGVycm9ycyBvciByZXN0YXJ0IHJlcXVpcmVtZW50cywgc2luY2UgJExBU1RFWElUQ09ERSBkb2Vzbid0IHNlZW0gdG8gd29yay4uLgogICAgICAgICAgICAkc2V0dXBMb2cgPSBHZXQtQ2hpbGRJdGVtIC1QYXRoIChHZXQtSXRlbSAkZW52OlRFTVApLkZ1bGxOYW1lIHwgPyB7JF8uTmFtZSAtbGlrZSAiKlNoYXJlUG9pbnQgKiBTZXR1cCoifSB8IFNvcnQtT2JqZWN0IC1EZXNjZW5kaW5nIC1Qcm9wZXJ0eSAiTGFzdFdyaXRlVGltZSIgfCBTZWxlY3QtT2JqZWN0IC1maXJzdCAxCiAgICAgICAgICAgIElmICgkc2V0dXBMb2cgLWVxICRudWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBUaHJvdyAiIC0gQ291bGQgbm90IGZpbmQgU2hhcmVQb2ludCBTZXJ2ZXIgU2V0dXAgbG9nIGZpbGUhIgogICAgICAgICAgICB9CgogICAgICAgICAgICAjIEdldCBlcnJvcihzKSBmcm9tIGxvZwogICAgICAgICAgICAkc2V0dXBMYXN0RXJyb3IgPSAkc2V0dXBMb2cgfCBTZWxlY3QtU3RyaW5nIC1TaW1wbGVNYXRjaCAtUGF0dGVybiAiRXJyb3I6IiB8IFNlbGVjdC1PYmplY3QgLUxhc3QgMQogICAgICAgICAgICAkc2V0dXBTdWNjZXNzID0gJHNldHVwTG9nIHwgU2VsZWN0LVN0cmluZyAtU2ltcGxlTWF0Y2ggLVBhdHRlcm4gIlN1Y2Nlc3NmdWxseSBpbnN0YWxsZWQgcGFja2FnZTogb3NlcnZlciIKICAgICAgICAgICAgIyBMb29rIGZvciBhIGRpZmZlcmVudCBzdWNjZXNzIG1lc3NhZ2UgaWYgd2UgYXJlIG9ubHkgaW5zdGFsbGluZyBGb3VuZGF0aW9uCiAgICAgICAgICAgIGlmICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5JbnN0YWxsLlNLVSAtZXEgIkZvdW5kYXRpb24iKSB7JHNldHVwU3VjY2VzcyA9ICRzZXR1cExvZyB8IFNlbGVjdC1TdHJpbmcgLVNpbXBsZU1hdGNoIC1QYXR0ZXJuICJTdWNjZXNzZnVsbHkgaW5zdGFsbGVkIHBhY2thZ2U6IHdzcyJ9CiAgICAgICAgICAgIElmICgkc2V0dXBMYXN0RXJyb3IgLWFuZCAhJHNldHVwU3VjY2VzcykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICRzZXR1cExhc3RFcnJvci5MaW5lCiAgICAgICAgICAgICAgICBJbnZva2UtSXRlbSAtUGF0aCAiJCgoR2V0LUl0ZW0gJGVudjpURU1QKS5GdWxsTmFtZSlcJHNldHVwTG9nIgogICAgICAgICAgICAgICAgVGhyb3cgIiAtIFJldmlldyB0aGUgbG9nIGZpbGUgYW5kIHRyeSB0byBjb3JyZWN0IGFueSBlcnJvciBjb25kaXRpb25zLiIKICAgICAgICAgICAgfQogICAgICAgICAgICAjIExvb2sgZm9yIHJlc3RhcnQgcmVxdWlyZW1lbnQgaW4gbG9nCiAgICAgICAgICAgICRzZXR1cFJlc3RhcnROb3ROZWVkZWQgPSAkc2V0dXBMb2cgfCBzZWxlY3Qtc3RyaW5nIC1TaW1wbGVNYXRjaCAtUGF0dGVybiAiU3lzdGVtIHJlYm9vdCBpcyBub3QgcGVuZGluZy4iCiAgICAgICAgICAgIElmICghKCRzZXR1cFJlc3RhcnROb3ROZWVkZWQpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBUaHJvdyAiIC0gU2hhcmVQb2ludCBzZXR1cCByZXF1aXJlcyBhIHJlc3RhcnQuIFJ1biB0aGUgc2NyaXB0IGFnYWluIGFmdGVyIHJlc3RhcnRpbmcgdG8gY29udGludWUuIgogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2cgIiAtIFdhaXRpbmcgZm9yIFNoYXJlUG9pbnQgUHJvZHVjdHMgYW5kIFRlY2hub2xvZ2llcyBXaXphcmQgdG8gbGF1bmNoLi4uIiAKICAgICAgICAgICAgV2hpbGUgKChHZXQtUHJvY2VzcyB8P3skXy5Qcm9jZXNzTmFtZSAtbGlrZSAicHNjb25maWd1aSoifSkgLWVxICRudWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIi4iIAogICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgMQogICAgICAgICAgICB9CiAgICAgICAgICAgIGxvZyAiRG9uZS4iCiAgICAgICAgICAgIGxvZyAiIC0gRXhpdGluZyBQcm9kdWN0cyBhbmQgVGVjaG5vbG9naWVzIFdpemFyZCAtIHVzaW5nIFBvd2VyU2hlbGwgaW5zdGVhZCEiCiAgICAgICAgICAgIFN0b3AtUHJvY2VzcyAtTmFtZSBwc2NvbmZpZ3VpCiAgICAgICAgfQogICAgICAgIEVsc2UKICAgICAgICB7CiAgICAgICAgICAgIFRocm93ICIgLSBJbnN0YWxsIHBhdGggJGVudjpTUGJpdHMgbm90IGZvdW5kISEiCiAgICAgICAgfQogICAgfQogICAgV3JpdGVMaW5lCn0KI0VuZFJlZ2lvbgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogSW5zdGFsbC1BcHBGYWJyaWNDVQojIERlc2M6IEF0dGVtcHRzIHRvIGluc3RhbGwgYSByZWNlbnRseS1yZWxlYXNlZCBjdW11bGF0aXZlIHVwZGF0ZSBmb3IgQXBwRmFicmljLCBpZiBmb3VuZCBpbiAkZW52OlNQYml0c1xQcmVyZXF1aXNpdGVJbnN0YWxsZXJGaWxlcwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmZ1bmN0aW9uIEluc3RhbGwtQXBwRmFicmljQ1UKewogICAgV3JpdGVMaW5lCiAgICAjIENyZWF0ZSBhIGhhc2ggdGFibGUgd2l0aCBtYWpvciB2ZXJzaW9uIHRvIHByb2R1Y3QgeWVhciBtYXBwaW5ncwogICAgJHNwWWVhcnMgPSBAeyIxNCIgPSAiMjAxMCI7ICIxNSIgPSAiMjAxMyI7ICIxNiIgPSAiMjAxNiJ9CiAgICAkc3BZZWFyID0gJHNwWWVhcnMuJGVudjpzcFZlcgogICAgW2hhc2h0YWJsZV0kdXBkYXRlcyA9IEB7IkNVNyIgPSAiQXBwRmFicmljLUtCMzA5MjQyMy14NjQtRU5VLmV4ZSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ1U2IiA9ICJBcHBGYWJyaWMtS0IzMDQyMDk5LXg2NC1FTlUuZXhlIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDVTUiID0gIkFwcEZhYnJpYzEuMS1LQjI5MzI2NzgteDY0LUVOVS5leGUiO2AKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDVTQiID0gIkFwcEZhYnJpYzEuMS1SVE0tS0IyODAwNzI2LXg2NC1FTlUuZXhlIn0KICAgICRpbnN0YWxsU3VjY2VlZGVkID0gJGZhbHNlCiAgICBsb2cgIiAtIENoZWNraW5nIGZvciBBcHBGYWJyaWMgQ1U0IG9yIG5ld2VyLi4uIgogICAgJGFwcEZhYnJpY0tCID0gKCgoR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiSEtMTTpcU09GVFdBUkVcV293NjQzMk5vZGVcTWljcm9zb2Z0XFVwZGF0ZXNcQXBwRmFicmljIDEuMSBmb3IgV2luZG93cyBTZXJ2ZXJcS0IyODAwNzI2IiAtTmFtZSAiSXNJbnN0YWxsZWQiIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKS5Jc0luc3RhbGxlZCAtZXEgMSkgLW9yIGAKICAgICAgICAgICAgICAgICAgICAoKEdldC1JdGVtUHJvcGVydHkgLVBhdGggIkhLTE06XFNPRlRXQVJFXFdvdzY0MzJOb2RlXE1pY3Jvc29mdFxVcGRhdGVzXEFwcEZhYnJpYyAxLjEgZm9yIFdpbmRvd3MgU2VydmVyXEtCMjkzMjY3OCIgLU5hbWUgIklzSW5zdGFsbGVkIiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkuSXNJbnN0YWxsZWQgLWVxIDEpIC1vcgogICAgICAgICAgICAgICAgICAgICgoR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiSEtMTTpcU09GVFdBUkVcV293NjQzMk5vZGVcTWljcm9zb2Z0XFVwZGF0ZXNcQXBwRmFicmljIDEuMSBmb3IgV2luZG93cyBTZXJ2ZXJcS0IzMDQyMDk5IiAtTmFtZSAiSXNJbnN0YWxsZWQiIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKS5Jc0luc3RhbGxlZCAtZXEgMSkgLW9yCiAgICAgICAgICAgICAgICAgICAgKChHZXQtSXRlbVByb3BlcnR5IC1QYXRoICJIS0xNOlxTT0ZUV0FSRVxXb3c2NDMyTm9kZVxNaWNyb3NvZnRcVXBkYXRlc1xBcHBGYWJyaWMgMS4xIGZvciBXaW5kb3dzIFNlcnZlclxLQjMwOTI0MjMiIC1OYW1lICJJc0luc3RhbGxlZCIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpLklzSW5zdGFsbGVkIC1lcSAxKSkKICAgICAgICBpZiAoISRhcHBGYWJyaWNLQikgIyBUcnkgdG8gaW5zdGFsbCB0aGUgQXBwRmFicmljIHVwZGF0ZSBpZiBpdCBpc24ndCBkZXRlY3RlZAogICAgICAgIHsKICAgICAgICAgICAgZm9yZWFjaCAoJENVIGluICgkdXBkYXRlcy5LZXlzIHwgU29ydC1PYmplY3QgLURlc2NlbmRpbmcpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0cnkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkY3VycmVudFVwZGF0ZSA9ICR1cGRhdGVzLiRDVQogICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgdGhhdCB3ZSBoYXZlbid0IGFscmVhZHkgc3VjY2VkZWQgd2l0aCBvbmUgb2YgdGhlIENVcwogICAgICAgICAgICAgICAgICAgIGlmICghJGluc3RhbGxTdWNjZWVkZWQpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHRoZSBjdXJyZW50IENVIGV4aXN0cyBpbiB0aGUgY3VycmVudCBwYXRoCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiQ1U0IG9yIG5ld2VyIHdhcyBub3QgZm91bmQuIgogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSBMb29raW5nIGZvciB1cGRhdGU6IGAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcJGN1cnJlbnRVcGRhdGVgIi4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAtUGF0aCAiJGVudjpTUGJpdHNcUHJlcmVxdWlzaXRlSW5zdGFsbGVyRmlsZXNcJGN1cnJlbnRVcGRhdGUiIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSBJbnN0YWxsaW5nICRjdXJyZW50VXBkYXRlLi4uIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAtRmlsZVBhdGggIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXCRjdXJyZW50VXBkYXRlIiAtQXJndW1lbnRMaXN0ICIvcGFzc2l2ZSAvcHJvbXB0cmVzdGFydCIgLVdhaXQgLU5vTmV3V2luZG93CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJD8pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGluc3RhbGxTdWNjZWVkZWQgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gRG9uZS4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSBBcHBGYWJyaWMgQ1UgJGN1cnJlbnRVcGRhdGUgd2Fzbid0IGZvdW5kLCBsb29raW5nIGZvciBvdGhlciB1cGRhdGUgZmlsZXMuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRpbnN0YWxsU3VjY2VlZGVkID0gJGZhbHNlCiAgICAgICAgICAgICAgICAgICAgbG9nICJXQVJOSU5HOiAgLSBTb21ldGhpbmcgd2VudCB3cm9uZyB3aXRoIHRoZSBpbnN0YWxsYXRpb24gb2YgJGN1cnJlbnRVcGRhdGUuIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgICRpbnN0YWxsU3VjY2VlZGVkID0gJHRydWUKICAgICAgICAgICAgbG9nICIgLSBBbHJlYWR5IGluc3RhbGxlZC4iCiAgICAgICAgfQogICAgaWYgKCEkaW5zdGFsbFN1Y2NlZWRlZCkKICAgIHsKICAgICAgICBsb2cgIiAtIEVpdGhlciBubyByZXF1aXJlZCBBcHBGYWJyaWMgdXBkYXRlcyB3ZXJlIGZvdW5kIGluICRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzLCBvciB0aGUgaW5zdGFsbGF0aW9uIGZhaWxlZC4iCiAgICB9CiAgICBXcml0ZUxpbmUKfQoKI1JlZ2lvbiBJbnN0YWxsIE9mZmljZSBXZWIgQXBwcyAyMDEwCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBJbnN0YWxsT2ZmaWNlV2ViQXBwczIwMTAKIyBEZXNjOiBJbnN0YWxscyB0aGUgT1dBIGJpbmFyaWVzIGluIHVuYXR0ZW5kZWQgbW9kZQojIEZyb206IFBvcnRlZCBvdmVyIGJ5IHVzZXIgaHR0cDovL3d3dy5jb2RlcGxleC5jb20vc2l0ZS91c2Vycy92aWV3L2N5Z29oIG9yaWdpbmFsbHkgZnJvbSB0aGUgSW5zdGFsbFNoYXJlUG9pbnQgZnVuY3Rpb24sIGZpeGVkIHVwIGJ5IGJyaWFubGFsYQojIE9yaWdpbmFsbHkgcG9zdGVkIG9uOiBodHRwOi8vYXV0b3NwaW5zdGFsbGVyLmNvZGVwbGV4LmNvbS9kaXNjdXNzaW9ucy8yMzM1MzAKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBJbnN0YWxsT2ZmaWNlV2ViQXBwczIwMTAoW3htbF0keG1saW5wdXQpCnsKICAgIEdldC1NYWpvclZlcnNpb25OdW1iZXIgJHhtbGlucHV0CiAgICBJZiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uT2ZmaWNlV2ViQXBwcy5JbnN0YWxsIC1lcSAkdHJ1ZSAtYW5kICRlbnY6c3BWZXIgLWVxICIxNCIpICMgQ2hlY2sgZm9yIFNQMjAxMAogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgIElmIChUZXN0LVBhdGggIiRlbnY6Q29tbW9uUHJvZ3JhbUZpbGVzXE1pY3Jvc29mdCBTaGFyZWRcV2ViIFNlcnZlciBFeHRlbnNpb25zXCRlbnY6c3BWZXJcVEVNUExBVEVcRkVBVFVSRVNcT2ZmaWNlV2ViQXBwc1xmZWF0dXJlLnhtbCIpICMgQ3J1ZGUgd2F5IG9mIGNoZWNraW5nIGlmIE9mZmljZSBXZWIgQXBwcyBpcyBhbHJlYWR5IGluc3RhbGxlZAogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSBPZmZpY2UgV2ViIEFwcHMgYmluYXJpZXMgYXBwZWFyIHRvIGJlIGFscmVhZHkgaW5zdGFsbGVkIC0gc2tpcHBpbmcgaW5zdGFsbC4iCiAgICAgICAgfQogICAgICAgIEVsc2UKICAgICAgICB7CiAgICAgICAgICAgICRzcFllYXJzID0gQHsiMTQiID0gIjIwMTAiOyAiMTUiID0gIjIwMTMiOyAiMTYiID0gIjIwMTYifQogICAgICAgICAgICAkc3BZZWFyID0gJHNwWWVhcnMuJGVudjpzcFZlcgogICAgICAgICAgICAjIEluc3RhbGwgT2ZmaWNlIFdlYiBBcHBzIEJpbmFyaWVzCiAgICAgICAgICAgIElmIChUZXN0LVBhdGggIiRiaXRzXCRzcFllYXJcT2ZmaWNlV2ViQXBwc1xzZXR1cC5leGUiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAtIEluc3RhbGxpbmcgT2ZmaWNlIFdlYiBBcHBzIGJpbmFyaWVzLi4uIiAKICAgICAgICAgICAgICAgICRzdGFydFRpbWUgPSBHZXQtRGF0ZQogICAgICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAiJGJpdHNcJHNwWWVhclxPZmZpY2VXZWJBcHBzXHNldHVwLmV4ZSIgLUFyZ3VtZW50TGlzdCAiL2NvbmZpZyBgIiRjb25maWdGaWxlT1dBYCIiIC1XaW5kb3dTdHlsZSBNaW5pbWl6ZWQKICAgICAgICAgICAgICAgIFNob3ctUHJvZ3Jlc3MgLVByb2Nlc3Mgc2V0dXAgLUNvbG9yIEN5YW4gLUludGVydmFsIDUKICAgICAgICAgICAgICAgICRkZWx0YSwkbnVsbCA9IChOZXctVGltZVNwYW4gLVN0YXJ0ICRzdGFydFRpbWUgLUVuZCAoR2V0LURhdGUpKS5Ub1N0cmluZygpIC1zcGxpdCAiXC4iCiAgICAgICAgICAgICAgICBsb2cgIiAtIE9mZmljZSBXZWIgQXBwcyBzZXR1cCBjb21wbGV0ZWQgaW4gJGRlbHRhLiIKICAgICAgICAgICAgICAgIElmICgtbm90ICQ/KSB7CiAgICAgICAgICAgICAgICAgICAgVGhyb3cgIiAtIEVycm9yICRMQVNURVhJVENPREUgb2NjdXJyZWQgcnVubmluZyAkYml0c1wkc3BZZWFyXE9mZmljZVdlYkFwcHNcc2V0dXAuZXhlIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIyBQYXJzaW5nIG1vc3QgcmVjZW50IE9mZmljZSBXZWIgQXBwcyBTZXR1cCBsb2cgZm9yIGVycm9ycyBvciByZXN0YXJ0IHJlcXVpcmVtZW50cywgc2luY2UgJExBU1RFWElUQ09ERSBkb2Vzbid0IHNlZW0gdG8gd29yay4uLgogICAgICAgICAgICAgICAgJHNldHVwTG9nID0gR2V0LUNoaWxkSXRlbSAtUGF0aCAoR2V0LUl0ZW0gJGVudjpURU1QKS5GdWxsTmFtZSB8ID8geyRfLk5hbWUgLWxpa2UgIldhYyBTZXJ2ZXIgU2V0dXAqIn0gfCBTb3J0LU9iamVjdCAtRGVzY2VuZGluZyAtUHJvcGVydHkgIkxhc3RXcml0ZVRpbWUiIHwgU2VsZWN0LU9iamVjdCAtZmlyc3QgMQogICAgICAgICAgICAgICAgSWYgKCRzZXR1cExvZyAtZXEgJG51bGwpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgVGhyb3cgIiAtIENvdWxkIG5vdCBmaW5kIE9mZmljZSBXZWIgQXBwcyBTZXR1cCBsb2cgZmlsZSEiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAjIEdldCBlcnJvcihzKSBmcm9tIGxvZwogICAgICAgICAgICAgICAgJHNldHVwTGFzdEVycm9yID0gJHNldHVwTG9nIHwgc2VsZWN0LXN0cmluZyAtU2ltcGxlTWF0Y2ggLVBhdHRlcm4gIkVycm9yOiIgfCBTZWxlY3QtT2JqZWN0IC1MYXN0IDEgI3wgPyB7JF8uTGluZSAtbm90bGlrZSAiKlN0YXJ0dXAgdGFzayoifQogICAgICAgICAgICAgICAgSWYgKCRzZXR1cExhc3RFcnJvcikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgJHNldHVwTGFzdEVycm9yLkxpbmUKICAgICAgICAgICAgICAgICAgICBJbnZva2UtSXRlbSAtUGF0aCAiJCgoR2V0LUl0ZW0gJGVudjpURU1QKS5GdWxsTmFtZSlcJHNldHVwTG9nIgogICAgICAgICAgICAgICAgICAgIFRocm93ICIgLSBSZXZpZXcgdGhlIGxvZyBmaWxlIGFuZCB0cnkgdG8gY29ycmVjdCBhbnkgZXJyb3IgY29uZGl0aW9ucy4iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAjIExvb2sgZm9yIHJlc3RhcnQgcmVxdWlyZW1lbnQgaW4gbG9nCiAgICAgICAgICAgICAgICAkc2V0dXBSZXN0YXJ0Tm90TmVlZGVkID0gJHNldHVwTG9nIHwgc2VsZWN0LXN0cmluZyAtU2ltcGxlTWF0Y2ggLVBhdHRlcm4gIlN5c3RlbSByZWJvb3QgaXMgbm90IHBlbmRpbmcuIgogICAgICAgICAgICAgICAgSWYgKCEoJHNldHVwUmVzdGFydE5vdE5lZWRlZCkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgVGhyb3cgIiAtIE9mZmljZSBXZWJhcHBzIHNldHVwIHJlcXVpcmVzIGEgcmVzdGFydC4gUnVuIHRoZSBzY3JpcHQgYWdhaW4gYWZ0ZXIgcmVzdGFydGluZyB0byBjb250aW51ZS4iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2cgIiAtIFdhaXRpbmcgZm9yIFNoYXJlUG9pbnQgUHJvZHVjdHMgYW5kIFRlY2hub2xvZ2llcyBXaXphcmQgdG8gbGF1bmNoLi4uIiAKICAgICAgICAgICAgICAgIFdoaWxlICgoR2V0LVByb2Nlc3MgfD97JF8uUHJvY2Vzc05hbWUgLWxpa2UgInBzY29uZmlndWkqIn0pIC1lcSAkbnVsbCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIi4iIAogICAgICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIDEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICMgVGhlIENvbm5lY3QtU1BDb25maWd1cmF0aW9uRGF0YWJhc2UgY21kbGV0IHRocm93cyBhbiBlcnJvciBhYm91dCBhbiAidXBncmFkZSByZXF1aXJlZCIgaWYgd2UgZG9uJ3QgYXQgbGVhc3QgKmxhdW5jaCogdGhlIFdpemFyZCwgc28gd2Ugd2FpdCB0byBsZXQgaXQgbGF1bmNoLCB0aGVuIGtpbGwgaXQuCiAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAxMAogICAgICAgICAgICAgICAgbG9nICJPSy4iCiAgICAgICAgICAgICAgICBsb2cgIiAtIEV4aXRpbmcgUHJvZHVjdHMgYW5kIFRlY2hub2xvZ2llcyBXaXphcmQgLSB1c2luZyBQb3dlclNoZWxsIGluc3RlYWQhIgogICAgICAgICAgICAgICAgU3RvcC1Qcm9jZXNzIC1OYW1lIHBzY29uZmlndWkKICAgICAgICAgICAgfQogICAgICAgICAgICBFbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFRocm93ICIgLSBJbnN0YWxsIHBhdGggJGJpdHNcJHNwWWVhclxPZmZpY2VXZWJBcHBzIG5vdCBmb3VuZCEhIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFdyaXRlTGluZQogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gSW5zdGFsbCBQcm9qZWN0IFNlcnZlcgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogSW5zdGFsbFByb2plY3RTZXJ2ZXIKIyBEZXNjOiBJbnN0YWxscyB0aGUgUHJvamVjdCBTZXJ2ZXIgYmluYXJpZXMgaW4gdW5hdHRlbmRlZCBtb2RlCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gSW5zdGFsbFByb2plY3RTZXJ2ZXIoW3htbF0keG1saW5wdXQpCnsKICAgIEdldC1NYWpvclZlcnNpb25OdW1iZXIgJHhtbGlucHV0CiAgICBJZiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uUHJvamVjdFNlcnZlci5JbnN0YWxsIC1lcSAkdHJ1ZSAtYW5kICRlbnY6U1BWZXIgLWVxICIxNSIpICMgQ2hlY2sgZm9yIFNQMjAxMyBzaW5jZSB3ZSBkb24ndCBzdXBwb3J0IGluc3RhbGxpbmcgUHJvamVjdCBTZXJ2ZXIgMjAxMCBhdCB0aGlzIHBvaW50LCBhbmQgaXQncyBpbmNsdWRlZCB3aXRoIFNQMjAxNgogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgICMgQ3JlYXRlIGEgaGFzaCB0YWJsZSB3aXRoIG1ham9yIHZlcnNpb24gdG8gcHJvZHVjdCB5ZWFyIG1hcHBpbmdzCiAgICAgICAgJHNwWWVhcnMgPSBAeyIxNCIgPSAiMjAxMCI7ICIxNSIgPSAiMjAxMyI7ICIxNiIgPSAiMjAxNiJ9CiAgICAgICAgJHNwWWVhciA9ICRzcFllYXJzLiRlbnY6c3BWZXIKICAgICAgICAjIFRoZXJlIGhhcyB0byBiZSBhIGJldHRlciB3YXkgdG8gY2hlY2sgd2hldGhlciBQcm9qZWN0IFNlcnZlciBpcyBpbnN0YWxsZWQuLi4KICAgICAgICAkcHJvamVjdFNlcnZlckluc3RhbGxlZCA9IFRlc3QtUGF0aCAtUGF0aCAiJGVudjpDb21tb25Qcm9ncmFtRmlsZXNcTWljcm9zb2Z0IFNoYXJlZFxXZWIgU2VydmVyIEV4dGVuc2lvbnNcJGVudjpzcFZlclxDT05GSUdcQklOXE1pY3Jvc29mdC5Qcm9qZWN0U2VydmVyLmRsbCIKICAgICAgICBJZiAoJHByb2plY3RTZXJ2ZXJJbnN0YWxsZWQpCiAgICAgICAgewogICAgICAgICAgICBsb2cgIiAtIFByb2plY3QgU2VydmVyICRzcFllYXIgYmluYXJpZXMgYXBwZWFyIHRvIGJlIGFscmVhZHkgaW5zdGFsbGVkIC0gc2tpcHBpbmcgaW5zdGFsbGF0aW9uLiIKICAgICAgICB9CiAgICAgICAgRWxzZQogICAgICAgIHsKICAgICAgICAgICAgIyBJbnN0YWxsIFByb2plY3QgU2VydmVyIEJpbmFyaWVzCiAgICAgICAgICAgIElmIChUZXN0LVBhdGggIiRiaXRzXCRzcFllYXJcUHJvamVjdFNlcnZlclxzZXR1cC5leGUiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAtIEluc3RhbGxpbmcgUHJvamVjdCBTZXJ2ZXIgJHNwWWVhciBiaW5hcmllcy4uLiIgCiAgICAgICAgICAgICAgICAkc3RhcnRUaW1lID0gR2V0LURhdGUKICAgICAgICAgICAgICAgIFN0YXJ0LVByb2Nlc3MgIiRiaXRzXCRzcFllYXJcUHJvamVjdFNlcnZlclxzZXR1cC5leGUiIC1Bcmd1bWVudExpc3QgIi9jb25maWcgYCIkY29uZmlnRmlsZVByb2plY3RTZXJ2ZXJgIiIgLVdpbmRvd1N0eWxlIE1pbmltaXplZAogICAgICAgICAgICAgICAgU2hvdy1Qcm9ncmVzcyAtUHJvY2VzcyBzZXR1cCAtQ29sb3IgQ3lhbiAtSW50ZXJ2YWwgNQogICAgICAgICAgICAgICAgJGRlbHRhLCRudWxsID0gKE5ldy1UaW1lU3BhbiAtU3RhcnQgJHN0YXJ0VGltZSAtRW5kIChHZXQtRGF0ZSkpLlRvU3RyaW5nKCkgLXNwbGl0ICJcLiIKICAgICAgICAgICAgICAgIGxvZyAiIC0gUHJvamVjdCBTZXJ2ZXIgJHNwWWVhciBzZXR1cCBjb21wbGV0ZWQgaW4gJGRlbHRhLiIKICAgICAgICAgICAgICAgIElmICgtbm90ICQ/KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFRocm93ICIgLSBFcnJvciAkTEFTVEVYSVRDT0RFIG9jY3VycmVkIHJ1bm5pbmcgJGJpdHNcJHNwWWVhclxQcm9qZWN0U2VydmVyXHNldHVwLmV4ZSIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIFBhcnNpbmcgbW9zdCByZWNlbnQgUHJvamVjdCBTZXJ2ZXIgU2V0dXAgbG9nIGZvciBlcnJvcnMgb3IgcmVzdGFydCByZXF1aXJlbWVudHMsIHNpbmNlICRMQVNURVhJVENPREUgZG9lc24ndCBzZWVtIHRvIHdvcmsuLi4KICAgICAgICAgICAgICAgICRzZXR1cExvZyA9IEdldC1DaGlsZEl0ZW0gLVBhdGggKEdldC1JdGVtICRlbnY6VEVNUCkuRnVsbE5hbWUgfCA/IHskXy5OYW1lIC1saWtlICJQcm9qZWN0IFNlcnZlciBTZXR1cCoifSB8IFNvcnQtT2JqZWN0IC1EZXNjZW5kaW5nIC1Qcm9wZXJ0eSAiTGFzdFdyaXRlVGltZSIgfCBTZWxlY3QtT2JqZWN0IC1maXJzdCAxCiAgICAgICAgICAgICAgICBJZiAoJHNldHVwTG9nIC1lcSAkbnVsbCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBUaHJvdyAiIC0gQ291bGQgbm90IGZpbmQgUHJvamVjdCBTZXJ2ZXIgU2V0dXAgbG9nIGZpbGUhIgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgR2V0IGVycm9yKHMpIGZyb20gbG9nCiAgICAgICAgICAgICAgICAkc2V0dXBMYXN0RXJyb3IgPSAkc2V0dXBMb2cgfCBTZWxlY3QtU3RyaW5nIC1TaW1wbGVNYXRjaCAtUGF0dGVybiAiRXJyb3I6IiB8IFNlbGVjdC1PYmplY3QgLUxhc3QgMQogICAgICAgICAgICAgICAgJHNldHVwU3VjY2VzcyA9ICRzZXR1cExvZyB8IFNlbGVjdC1TdHJpbmcgLVNpbXBsZU1hdGNoIC1QYXR0ZXJuICJTdWNjZXNzZnVsbHkgaW5zdGFsbGVkIHBhY2thZ2U6IHBzZXJ2ZXIiCiAgICAgICAgICAgICAgICBpZiAoISRzZXR1cFN1Y2Nlc3MpIHskc2V0dXBTdWNjZXNzID0gJHNldHVwTG9nIHwgU2VsZWN0LVN0cmluZyAtU2ltcGxlTWF0Y2ggLVBhdHRlcm4gIlN1Y2Nlc3NmdWxseSBjb25maWd1cmVkIHBhY2thZ2U6IHBzZXJ2ZXIifSAjIEluIGNhc2Ugd2UgYXJlIGp1c3QgY29uZmlndXJpbmcgcHJlLWluc3RhbGxlZCBvciBwYXJ0aWFsbHktaW5zdGFsbGVkIHByb2R1Y3QKICAgICAgICAgICAgICAgIElmICgkc2V0dXBMYXN0RXJyb3IgLWFuZCAhJHNldHVwU3VjY2VzcykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgJHNldHVwTGFzdEVycm9yLkxpbmUKICAgICAgICAgICAgICAgICAgICBJbnZva2UtSXRlbSAtUGF0aCAiJCgoR2V0LUl0ZW0gJGVudjpURU1QKS5GdWxsTmFtZSlcJHNldHVwTG9nIgogICAgICAgICAgICAgICAgICAgIFRocm93ICIgLSBSZXZpZXcgdGhlIGxvZyBmaWxlIGFuZCB0cnkgdG8gY29ycmVjdCBhbnkgZXJyb3IgY29uZGl0aW9ucy4iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAjIExvb2sgZm9yIHJlc3RhcnQgcmVxdWlyZW1lbnQgaW4gbG9nLCBidXQgb25seSBpZiB3ZSBpbnN0YWxsZWQgZnJlc2ggdnMuIGp1c3QgY29uZmlndXJpbmcKICAgICAgICAgICAgICAgIGlmICgkc2V0dXBTdWNjZXNzIC1saWtlICIqaW5zdGFsbGVkKiIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJHNldHVwUmVzdGFydE5vdE5lZWRlZCA9ICRzZXR1cExvZyB8IHNlbGVjdC1zdHJpbmcgLVNpbXBsZU1hdGNoIC1QYXR0ZXJuICJTeXN0ZW0gcmVib290IGlzIG5vdCBwZW5kaW5nLiIKICAgICAgICAgICAgICAgICAgICBJZiAoISRzZXR1cFJlc3RhcnROb3ROZWVkZWQpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBUaHJvdyAiIC0gUHJvamVjdCBTZXJ2ZXIgc2V0dXAgcmVxdWlyZXMgYSByZXN0YXJ0LiBSdW4gdGhlIHNjcmlwdCBhZ2FpbiBhZnRlciByZXN0YXJ0aW5nIHRvIGNvbnRpbnVlLiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2cgIiAtIFdhaXRpbmcgZm9yIFNoYXJlUG9pbnQgUHJvZHVjdHMgYW5kIFRlY2hub2xvZ2llcyBXaXphcmQgdG8gbGF1bmNoLi4uIiAKICAgICAgICAgICAgICAgIFdoaWxlICgoR2V0LVByb2Nlc3MgfD97JF8uUHJvY2Vzc05hbWUgLWxpa2UgInBzY29uZmlndWkqIn0pIC1lcSAkbnVsbCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIi4iIAogICAgICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIDEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxvZyAiT0suIgogICAgICAgICAgICAgICAgbG9nICIgLSBFeGl0aW5nIFByb2R1Y3RzIGFuZCBUZWNobm9sb2dpZXMgV2l6YXJkIC0gdXNpbmcgUG93ZXJTaGVsbCBpbnN0ZWFkISIKICAgICAgICAgICAgICAgIFN0b3AtUHJvY2VzcyAtTmFtZSBwc2NvbmZpZ3VpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgRWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIldBUk5JTkc6UHJvamVjdCBTZXJ2ZXIgaW5zdGFsbGF0aW9uIHJlcXVlc3RlZCwgYnV0IGluc3RhbGwgcGF0aCAkYml0c1wkc3BZZWFyXFByb2plY3RTZXJ2ZXIgbm90IGZvdW5kISEiCiAgICAgICAgICAgICAgICBQYXVzZSAiY29udGludWUiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBDb25maWd1cmUgT2ZmaWNlIFdlYiBBcHBzIDIwMTAKRnVuY3Rpb24gQ29uZmlndXJlT2ZmaWNlV2ViQXBwcyhbeG1sXSR4bWxpbnB1dCkKewogICAgR2V0LU1ham9yVmVyc2lvbk51bWJlciAkeG1saW5wdXQKICAgIElmICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5PZmZpY2VXZWJBcHBzLkluc3RhbGwgLWVxICR0cnVlIC1hbmQgJGVudjpzcFZlciAtZXEgIjE0IikgIyBDaGVjayBmb3IgU1AyMDEwCiAgICB7CiAgICAgICAgV3JpdGVsaW5lCiAgICAgICAgVHJ5CiAgICAgICAgewogICAgICAgICAgICBsb2cgIiAtIENvbmZpZ3VyaW5nIE9mZmljZSBXZWIgQXBwcy4uLiIKICAgICAgICAgICAgIyBJbnN0YWxsIEhlbHAgRmlsZXMKICAgICAgICAgICAgbG9nICIgLSBJbnN0YWxsaW5nIEhlbHAgQ29sbGVjdGlvbi4uLiIKICAgICAgICAgICAgSW5zdGFsbC1TUEhlbHBDb2xsZWN0aW9uIC1BbGwKICAgICAgICAgICAgIyNXYWl0Rm9ySGVscEluc3RhbGxUb0ZpbmlzaAogICAgICAgICAgICAjIEluc3RhbGwgYXBwbGljYXRpb24gY29udGVudAogICAgICAgICAgICBsb2cgIiAtIEluc3RhbGxpbmcgQXBwbGljYXRpb24gQ29udGVudC4uLiIKICAgICAgICAgICAgSW5zdGFsbC1TUEFwcGxpY2F0aW9uQ29udGVudAogICAgICAgICAgICAjIFNlY3VyZSByZXNvdXJjZXMKICAgICAgICAgICAgbG9nICIgLSBTZWN1cmluZyBSZXNvdXJjZXMuLi4iCiAgICAgICAgICAgIEluaXRpYWxpemUtU1BSZXNvdXJjZVNlY3VyaXR5CiAgICAgICAgICAgICMgSW5zdGFsbCBTZXJ2aWNlcwogICAgICAgICAgICBsb2cgIiAtIEluc3RhbGxpbmcgU2VydmljZXMuLi4iCiAgICAgICAgICAgIEluc3RhbGwtU1BTZXJ2aWNlCiAgICAgICAgICAgIElmICghJD8pIHtUaHJvd30KICAgICAgICAgICAgIyBJbnN0YWxsIChhbGwpIGZlYXR1cmVzCiAgICAgICAgICAgIGxvZyAiIC0gSW5zdGFsbGluZyBGZWF0dXJlcy4uLiIKICAgICAgICAgICAgSW5zdGFsbC1TUEZlYXR1cmUgLUFsbEV4aXN0aW5nRmVhdHVyZXMgfCBPdXQtTnVsbAogICAgICAgIH0KICAgICAgICBDYXRjaAogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICRfCiAgICAgICAgICAgIFRocm93ICIgLSBFcnJvciBjb25maWd1cmluZyBPZmZpY2UgV2ViIEFwcHMhIgogICAgICAgIH0KICAgICAgICBXcml0ZWxpbmUKICAgIH0KfQojRW5kUmVnaW9uCgojUmVnaW9uIEluc3RhbGwgTGFuZ3VhZ2UgUGFja3MKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IEluc3RhbGwgTGFuZ3VhZ2UgUGFja3MKIyBEZXNjOiBJbnN0YWxsIGxhbmd1YWdlIHBhY2tzIGFuZCByZXBvcnQgb24gYW55IGxhbmd1YWdlcyBpbnN0YWxsZWQKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBJbnN0YWxsTGFuZ3VhZ2VQYWNrcyhbeG1sXSR4bWxpbnB1dCkKewogICAgV3JpdGVMaW5lCiAgICBHZXQtTWFqb3JWZXJzaW9uTnVtYmVyICR4bWxpbnB1dAogICAgJHNwWWVhcnMgPSBAeyIxNCIgPSAiMjAxMCI7ICIxNSIgPSAiMjAxMyI7ICIxNiIgPSAiMjAxNiJ9CiAgICAkc3BZZWFyID0gJHNwWWVhcnMuJGVudjpzcFZlcgogICAgIyBHZXQgaW5zdGFsbGVkIGxhbmd1YWdlcyBmcm9tIHJlZ2lzdHJ5IChIS0VZX0xPQ0FMX01BQ0hJTkVcU09GVFdBUkVcTWljcm9zb2Z0XE9mZmljZSBTZXJ2ZXJcJGVudjpzcFZlci4wXEluc3RhbGxlZExhbmd1YWdlcykKICAgICRpbnN0YWxsZWRPZmZpY2VTZXJ2ZXJMYW5ndWFnZXMgPSAoR2V0LUl0ZW0gIkhLTE06XFNvZnR3YXJlXE1pY3Jvc29mdFxPZmZpY2UgU2VydmVyXCRlbnY6c3BWZXIuMFxJbnN0YWxsZWRMYW5ndWFnZXMiKS5HZXRWYWx1ZU5hbWVzKCkgfCA/IHskXyAtbmUgIiJ9CiAgICAjIExvb2sgZm9yIGV4dHJhY3RlZCBsYW5ndWFnZSBwYWNrcwogICAgJGV4dHJhY3RlZExhbmd1YWdlUGFja3MgPSAoR2V0LUNoaWxkSXRlbSAtUGF0aCAiJGJpdHNcJHNwWWVhclxMYW5ndWFnZVBhY2tzIiAtTmFtZSAtSW5jbHVkZSAiPz8tPz8iIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKQogICAgJHNlcnZlckxhbmd1YWdlUGFja3MgPSAoR2V0LUNoaWxkSXRlbSAtUGF0aCAiJGJpdHNcJHNwWWVhclxMYW5ndWFnZVBhY2tzIiAtTmFtZSAtSW5jbHVkZSBTZXJ2ZXJMYW5ndWFnZVBhY2tfKi5leGUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpCiAgICBJZiAoJGV4dHJhY3RlZExhbmd1YWdlUGFja3MgLWFuZCAoR2V0LUNoaWxkSXRlbSAtUGF0aCAiJGJpdHNcJHNwWWVhclxMYW5ndWFnZVBhY2tzIiAtTmFtZSAtSW5jbHVkZSAic2V0dXAuZXhlIiAtUmVjdXJzZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkpCiAgICB7CiAgICAgICAgbG9nICIgLSBJbnN0YWxsaW5nIFNoYXJlUG9pbnQgTGFuZ3VhZ2UgUGFja3M6IgogICAgICAgIEZvckVhY2ggKCRsYW5ndWFnZVBhY2tGb2xkZXIgaW4gJGV4dHJhY3RlZExhbmd1YWdlUGFja3MpCiAgICAgICAgewogICAgICAgICAgICAkbGFuZ3VhZ2UgPSAkaW5zdGFsbGVkT2ZmaWNlU2VydmVyTGFuZ3VhZ2VzIHwgPyB7JF8gLWVxICRsYW5ndWFnZVBhY2tGb2xkZXJ9CiAgICAgICAgICAgIElmICghJGxhbmd1YWdlKQogICAgICAgICAgICB7CiMgICAgICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAtUGF0aCAiJGJpdHNcJHNwWWVhclxMYW5ndWFnZVBhY2tzXCRsYW5ndWFnZVBhY2tGb2xkZXJcc2V0dXAuZXhlIiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkKIyAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAgLSBJbnN0YWxsaW5nIGV4dHJhY3RlZCBsYW5ndWFnZSBwYWNrICRsYW5ndWFnZVBhY2tGb2xkZXIuLi4iIAogICAgICAgICAgICAgICAgJHN0YXJ0VGltZSA9IEdldC1EYXRlCiAgICAgICAgICAgICAgICBTdGFydC1Qcm9jZXNzIC1Xb3JraW5nRGlyZWN0b3J5ICIkYml0c1wkc3BZZWFyXExhbmd1YWdlUGFja3NcJGxhbmd1YWdlUGFja0ZvbGRlclwiIC1GaWxlUGF0aCAic2V0dXAuZXhlIiAtQXJndW1lbnRMaXN0ICIvY29uZmlnICRiaXRzXCRzcFllYXJcTGFuZ3VhZ2VQYWNrc1wkbGFuZ3VhZ2VQYWNrRm9sZGVyXEZpbGVzXFNldHVwU2lsZW50XGNvbmZpZy54bWwiCiAgICAgICAgICAgICAgICBTaG93LVByb2dyZXNzIC1Qcm9jZXNzIHNldHVwIC1Db2xvciBDeWFuIC1JbnRlcnZhbCA1CiAgICAgICAgICAgICAgICAkZGVsdGEsJG51bGwgPSAoTmV3LVRpbWVTcGFuIC1TdGFydCAkc3RhcnRUaW1lIC1FbmQgKEdldC1EYXRlKSkuVG9TdHJpbmcoKSAtc3BsaXQgIlwuIgogICAgICAgICAgICAgICAgbG9nICIgIC0gTGFuZ3VhZ2UgcGFjayAkbGFuZ3VhZ2VQYWNrRm9sZGVyIHNldHVwIGNvbXBsZXRlZCBpbiAkZGVsdGEuIgojICAgICAgICAgICAgICAgIH0KIyAgICAgICAgICAgICAgICBlbHNlIHtsb2cgIiAtIE5vbmUgZm91bmQuIn0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsb2cgIiAtIExhbmd1YWdlIFBhY2sgaW5zdGFsbGF0aW9uIGNvbXBsZXRlLiIKICAgIH0KICAgICMgTG9vayBmb3IgU2VydmVyIGxhbmd1YWdlIHBhY2sgaW5zdGFsbGVycwogICAgRWxzZUlmICgkc2VydmVyTGFuZ3VhZ2VQYWNrcykKICAgIHsKICAgICAgICBsb2cgIiAtIEluc3RhbGxpbmcgU2hhcmVQb2ludCBMYW5ndWFnZSBQYWNrczoiCiAgICAgICAgRm9yRWFjaCAoJGxhbmd1YWdlUGFjayBpbiAkc2VydmVyTGFuZ3VhZ2VQYWNrcykKICAgICAgICB7CiAgICAgICAgICAgICMgU2xpZ2h0bHkgY29udm9sdXRlZCBjaGVjayB0byBzZWUgaWYgbGFuZ3VhZ2UgcGFjayBpcyBhbHJlYWR5IGluc3RhbGxlZCwgYmFzZWQgb24gbmFtZSBvZiBsYW5ndWFnZSBwYWNrIGZpbGUuCiAgICAgICAgICAgICMgVGhpcyBvbmx5IHdvcmtzIGlmIHlvdSd2ZSByZW5hbWVkIHlvdXIgbGFuZ3VhZ2UgcGFjayhzKSB0byBmb2xsb3cgdGhlIGNvbnZlbnRpb24gIlNlcnZlckxhbmd1YWdlUGFja19YWC1YWC5leGUiIHdoZXJlIDxYWC1YWD4gaXMgYSBjdWx0dXJlIHN1Y2ggYXMgPGVuLXVzPi4KICAgICAgICAgICAgJGxhbmd1YWdlID0gJGluc3RhbGxlZE9mZmljZVNlcnZlckxhbmd1YWdlcyB8ID8geyRfIC1lcSAoKCRsYW5ndWFnZVBhY2sgLXJlcGxhY2UgIlNlcnZlckxhbmd1YWdlUGFja18iLCIiKSAtcmVwbGFjZSAiLmV4ZSIsIiIpfQogICAgICAgICAgICBJZiAoISRsYW5ndWFnZSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgLSBJbnN0YWxsaW5nICRsYW5ndWFnZVBhY2suLi4iIAogICAgICAgICAgICAgICAgJHN0YXJ0VGltZSA9IEdldC1EYXRlCiAgICAgICAgICAgICAgICBTdGFydC1Qcm9jZXNzIC1GaWxlUGF0aCAiJGJpdHNcJHNwWWVhclxMYW5ndWFnZVBhY2tzXCRsYW5ndWFnZVBhY2siIC1Bcmd1bWVudExpc3QgIi9xdWlldCAvbm9yZXN0YXJ0IgogICAgICAgICAgICAgICAgU2hvdy1Qcm9ncmVzcyAtUHJvY2VzcyAkKCRsYW5ndWFnZVBhY2sgLXJlcGxhY2UgIi5leGUiLCAiIikgLUNvbG9yIEN5YW4gLUludGVydmFsIDUKICAgICAgICAgICAgICAgICRkZWx0YSwkbnVsbCA9IChOZXctVGltZVNwYW4gLVN0YXJ0ICRzdGFydFRpbWUgLUVuZCAoR2V0LURhdGUpKS5Ub1N0cmluZygpIC1zcGxpdCAiXC4iCiAgICAgICAgICAgICAgICBsb2cgIiAtIExhbmd1YWdlIHBhY2sgJGxhbmd1YWdlUGFjayBzZXR1cCBjb21wbGV0ZWQgaW4gJGRlbHRhLiIKICAgICAgICAgICAgICAgICRsYW5ndWFnZSA9ICgoJGxhbmd1YWdlUGFjayAtcmVwbGFjZSAiU2VydmVyTGFuZ3VhZ2VQYWNrXyIsIiIpIC1yZXBsYWNlICIuZXhlIiwiIikKICAgICAgICAgICAgICAgICMgSW5zdGFsbCBGb3VuZGF0aW9uIExhbmd1YWdlIFBhY2sgU1AxLCB0aGVuIFNlcnZlciBMYW5ndWFnZSBQYWNrIFNQMSwgaWYgZm91bmQKICAgICAgICAgICAgICAgIElmIChHZXQtQ2hpbGRJdGVtIC1QYXRoICIkYml0c1wkc3BZZWFyXExhbmd1YWdlUGFja3MiIC1OYW1lIC1JbmNsdWRlIHNwZmxhbmd1YWdlcGFjazIwMTBzcDEta2IyNDYwMDU5LXg2NC1mdWxsZmlsZS0kbGFuZ3VhZ2UuZXhlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gSW5zdGFsbGluZyBGb3VuZGF0aW9uIGxhbmd1YWdlIHBhY2sgU1AxIGZvciAkbGFuZ3VhZ2UuLi4iIAogICAgICAgICAgICAgICAgICAgIFN0YXJ0LVByb2Nlc3MgLVdvcmtpbmdEaXJlY3RvcnkgIiRiaXRzXCRzcFllYXJcTGFuZ3VhZ2VQYWNrc1wiIC1GaWxlUGF0aCAic3BmbGFuZ3VhZ2VwYWNrMjAxMHNwMS1rYjI0NjAwNTkteDY0LWZ1bGxmaWxlLSRsYW5ndWFnZS5leGUiIC1Bcmd1bWVudExpc3QgIi9xdWlldCAvbm9yZXN0YXJ0IgogICAgICAgICAgICAgICAgICAgIFNob3ctUHJvZ3Jlc3MgLVByb2Nlc3Mgc3BmbGFuZ3VhZ2VwYWNrMjAxMHNwMS1rYjI0NjAwNTkteDY0LWZ1bGxmaWxlLSRsYW5ndWFnZSAtQ29sb3IgQ3lhbiAtSW50ZXJ2YWwgNQogICAgICAgICAgICAgICAgICAgICMgSW5zdGFsbCBTZXJ2ZXIgTGFuZ3VhZ2UgUGFjayBTUDEsIGlmIGZvdW5kCiAgICAgICAgICAgICAgICAgICAgSWYgKEdldC1DaGlsZEl0ZW0gLVBhdGggIiRiaXRzXCRzcFllYXJcTGFuZ3VhZ2VQYWNrcyIgLU5hbWUgLUluY2x1ZGUgc2VydmVybGFuZ3VhZ2VwYWNrMjAxMHNwMS1rYjI0NjAwNTYteDY0LWZ1bGxmaWxlLSRsYW5ndWFnZS5leGUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIEluc3RhbGxpbmcgU2VydmVyIGxhbmd1YWdlIHBhY2sgU1AxIGZvciAkbGFuZ3VhZ2UuLi4iIAogICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1Qcm9jZXNzIC1Xb3JraW5nRGlyZWN0b3J5ICIkYml0c1wkc3BZZWFyXExhbmd1YWdlUGFja3NcIiAtRmlsZVBhdGggInNlcnZlcmxhbmd1YWdlcGFjazIwMTBzcDEta2IyNDYwMDU2LXg2NC1mdWxsZmlsZS0kbGFuZ3VhZ2UuZXhlIiAtQXJndW1lbnRMaXN0ICIvcXVpZXQgL25vcmVzdGFydCIKICAgICAgICAgICAgICAgICAgICAgICAgU2hvdy1Qcm9ncmVzcyAtUHJvY2VzcyBzZXJ2ZXJsYW5ndWFnZXBhY2syMDEwc3AxLWtiMjQ2MDA1Ni14NjQtZnVsbGZpbGUtJGxhbmd1YWdlIC1Db2xvciBDeWFuIC1JbnRlcnZhbCA1CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIEVsc2UKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiV0FSTklORzpTZXJ2ZXIgTGFuZ3VhZ2UgUGFjayBTUDEgbm90IGZvdW5kIGZvciAkbGFuZ3VhZ2UhIgogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIldBUk5JTkc6WW91IG11c3QgaW5zdGFsbCBpdCBmb3IgdGhlIGxhbmd1YWdlIHNlcnZpY2UgcGFjayBwYXRjaGluZyBwcm9jZXNzIHRvIGJlIGNvbXBsZXRlLiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBFbHNlIHtsb2cgIiAtIE5vIExhbmd1YWdlIFBhY2sgc2VydmljZSBwYWNrcyBmb3VuZC4ifQogICAgICAgICAgICB9CiAgICAgICAgICAgIEVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgLSBMYW5ndWFnZSAkbGFuZ3VhZ2UgYWxyZWFkeSBhcHBlYXJzIHRvIGJlIGluc3RhbGxlZCwgc2tpcHBpbmcuIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxvZyAiIC0gTGFuZ3VhZ2UgUGFjayBpbnN0YWxsYXRpb24gY29tcGxldGUuIgogICAgfQogICAgRWxzZQogICAgewogICAgICAgIGxvZyAiIC0gTm8gbGFuZ3VhZ2UgcGFjayBpbnN0YWxsZXJzIGZvdW5kIGluICRiaXRzXCRzcFllYXJcTGFuZ3VhZ2VQYWNrcywgc2tpcHBpbmcuIgogICAgfQoKICAgICMgR2V0IGFuZCBub3RlIGluc3RhbGxlZCBsYW5ndWFnZXMKICAgICRpbnN0YWxsZWRPZmZpY2VTZXJ2ZXJMYW5ndWFnZXMgPSAoR2V0LUl0ZW0gIkhLTE06XFNvZnR3YXJlXE1pY3Jvc29mdFxPZmZpY2UgU2VydmVyXCRlbnY6c3BWZXIuMFxJbnN0YWxsZWRMYW5ndWFnZXMiKS5HZXRWYWx1ZU5hbWVzKCkgfCA/IHskXyAtbmUgIiJ9CiAgICBsb2cgIiAtIEN1cnJlbnRseSBpbnN0YWxsZWQgbGFuZ3VhZ2VzOiIKICAgIEZvckVhY2ggKCRsYW5ndWFnZSBpbiAkaW5zdGFsbGVkT2ZmaWNlU2VydmVyTGFuZ3VhZ2VzKQogICAgewogICAgICAgIGxvZyAiICAtIiAoW1N5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvXTo6R2V0Q3VsdHVyZUluZm8oJGxhbmd1YWdlKS5EaXNwbGF5TmFtZSkKICAgIH0KICAgIFdyaXRlTGluZQp9CiNFbmRSZWdpb24KCiNSZWdpb24gSW5zdGFsbCBVcGRhdGVzCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBJbnN0YWxsVXBkYXRlcwojIERlc2M6IEluc3RhbGwgU2hhcmVQb2ludCBVcGRhdGVzIChDVXMgYW5kIFNlcnZpY2UgUGFja3MpIHRvIHdvcmsgYXJvdW5kIHNsaXBzdHJlYW1pbmcgaXNzdWVzCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gSW5zdGFsbFVwZGF0ZXMKewogICAgV3JpdGVMaW5lCiAgICBsb2cgIiAtIExvb2tpbmcgZm9yIFNoYXJlUG9pbnQgdXBkYXRlcyB0byBpbnN0YWxsLi4uIgogICAgR2V0LU1ham9yVmVyc2lvbk51bWJlciAkeG1saW5wdXQKICAgICRzcFllYXJzID0gQHsiMTQiID0gIjIwMTAiOyAiMTUiID0gIjIwMTMiOyAiMTYiID0gIjIwMTYifQogICAgJHNwWWVhciA9ICRzcFllYXJzLiRlbnY6c3BWZXIKICAgICMgUmVzdWx0IGNvZGVzIGJlbG93IGFyZSBmcm9tIGh0dHA6Ly90ZWNobmV0Lm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9jYzE3OTA1OCh2PW9mZmljZS4xNCkuYXNweAogICAgJG9QYXRjaEluc3RhbGxSZXN1bHRDb2RlcyA9IEB7IjE3MzAxIiA9ICJFcnJvcjogR2VuZXJhbCBEZXRlY3Rpb24gZXJyb3IiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjE3MzAyIiA9ICJFcnJvcjogQXBwbHlpbmcgcGF0Y2giOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjE3MzAzIiA9ICJFcnJvcjogRXh0cmFjdGluZyBmaWxlIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIxNzAyMSIgPSAiRXJyb3I6IENyZWF0aW5nIHRlbXAgZm9sZGVyIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIxNzAyMiIgPSAiU3VjY2VzczogUmVib290IGZsYWcgc2V0IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIxNzAyMyIgPSAiRXJyb3I6IFVzZXIgY2FuY2VsbGVkIGluc3RhbGxhdGlvbiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiMTcwMjQiID0gIkVycm9yOiBDcmVhdGluZyBmb2xkZXIgZmFpbGVkIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIxNzAyNSIgPSAiUGF0Y2ggYWxyZWFkeSBpbnN0YWxsZWQiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjE3MDI2IiA9ICJQYXRjaCBhbHJlYWR5IGluc3RhbGxlZCB0byBhZG1pbiBpbnN0YWxsYXRpb24iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjE3MDI3IiA9ICJJbnN0YWxsYXRpb24gc291cmNlIHJlcXVpcmVzIGZ1bGwgZmlsZSB1cGRhdGUiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjE3MDI4IiA9ICJObyBwcm9kdWN0IGluc3RhbGxlZCBmb3IgY29udGFpbmVkIHBhdGNoIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIxNzAyOSIgPSAiUGF0Y2ggZmFpbGVkIHRvIGluc3RhbGwiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjE3MDMwIiA9ICJEZXRlY3Rpb246IEludmFsaWQgQ0lGIGZvcm1hdCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiMTcwMzEiID0gIkRldGVjdGlvbjogSW52YWxpZCBiYXNlbGluZSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiMTcwMzQiID0gIkVycm9yOiBSZXF1aXJlZCBwYXRjaCBkb2VzIG5vdCBhcHBseSB0byB0aGUgbWFjaGluZSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiMTcwMzgiID0gIllvdSBkbyBub3QgaGF2ZSBzdWZmaWNpZW50IHByaXZpbGVnZXMgdG8gY29tcGxldGUgdGhpcyBpbnN0YWxsYXRpb24gZm9yIGFsbCB1c2VycyBvZiB0aGUgbWFjaGluZS4gTG9nIG9uIGFzIGFkbWluaXN0cmF0b3IgYW5kIHRoZW4gcmV0cnkgdGhpcyBpbnN0YWxsYXRpb24iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjE3MDQ0IiA9ICJJbnN0YWxsZXIgd2FzIHVuYWJsZSB0byBydW4gZGV0ZWN0aW9uIGZvciB0aGlzIHBhY2thZ2UifQogICAgaWYgKCRzcFllYXIgLWVxICIyMDEwIikKICAgIHsKICAgICAgICAkc3AyMDEwU1AxID0gR2V0LUNoaWxkSXRlbSAtUGF0aCAiJGJpdHNcJHNwWWVhclxVcGRhdGVzIiAtTmFtZSAtSW5jbHVkZSAib2ZmaWNlc2VydmVyMjAxMHNwMS1rYjI0NjAwNDUteDY0LWZ1bGxmaWxlLWVuLXVzLmV4ZSIgLVJlY3Vyc2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAjIEluIGNhc2Ugd2UgZmluZCBtb3JlIHRoYW4gb25lIChlLmcuIGluIHN1YmZvbGRlcnMpLCBncmFiIHRoZSBmaXJzdCBvbmUKICAgICAgICBpZiAoJHNwMjAxMFNQMSAtaXMgW3N5c3RlbS5hcnJheV0pIHskc3AyMDEwU1AxID0gJHNwMjAxMFNQMVswXX0KICAgICAgICAkc3AyMDEwSnVuZTIwMTNDVSA9IEdldC1DaGlsZEl0ZW0gLVBhdGggIiRiaXRzXCRzcFllYXJcVXBkYXRlcyIgLU5hbWUgLUluY2x1ZGUgInViZXJzcnYyMDEwLWtiMjgxNzUyNy1mdWxsZmlsZS14NjQtZ2xiLmV4ZSIgLVJlY3Vyc2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAjIEluIGNhc2Ugd2UgZmluZCBtb3JlIHRoYW4gb25lIChlLmcuIGluIHN1YmZvbGRlcnMpLCBncmFiIHRoZSBmaXJzdCBvbmUKICAgICAgICBpZiAoJHNwMjAxMEp1bmUyMDEzQ1UgLWlzIFtzeXN0ZW0uYXJyYXldKSB7JHNwMjAxMEp1bmUyMDEzQ1UgPSAkc3AyMDEwSnVuZTIwMTNDVVswXX0KICAgICAgICAkc3AyMDEwU1AyID0gR2V0LUNoaWxkSXRlbSAtUGF0aCAiJGJpdHNcJHNwWWVhclxVcGRhdGVzIiAtTmFtZSAtSW5jbHVkZSAib3NlcnZlcnNwMjAxMC1rYjI2ODc0NTMtZnVsbGZpbGUteDY0LWVuLXVzLmV4ZSIgLVJlY3Vyc2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAjIEluIGNhc2Ugd2UgZmluZCBtb3JlIHRoYW4gb25lIChlLmcuIGluIHN1YmZvbGRlcnMpLCBncmFiIHRoZSBmaXJzdCBvbmUKICAgICAgICBpZiAoJHNwMjAxMFNQMiAtaXMgW3N5c3RlbS5hcnJheV0pIHskc3AyMDEwU1AyID0gJHNwMjAxMFNQMlswXX0KICAgICAgICAjIEdldCBpbnN0YWxsZWQgU2hhcmVQb2ludCBsYW5ndWFnZXMsIHNvIHdlIGNhbiBkZXRlcm1pbmUgd2hpY2ggbGFuZ3VhZ2UgcGFjayB1cGRhdGVzIHRvIGFwcGx5CiAgICAgICAgJGluc3RhbGxlZE9mZmljZVNlcnZlckxhbmd1YWdlcyA9IChHZXQtSXRlbSAiSEtMTTpcU29mdHdhcmVcTWljcm9zb2Z0XE9mZmljZSBTZXJ2ZXJcJGVudjpzcFZlci4wXEluc3RhbGxlZExhbmd1YWdlcyIpLkdldFZhbHVlTmFtZXMoKSB8ID8geyRfIC1uZSAiIn0KICAgICAgICAjIEZpcnN0ICYgZm9yZW1vc3QsIGluc3RhbGwgU1AyIGlmIGl0J3MgdGhlcmUKICAgICAgICBpZiAoJHNwMjAxMFNQMikKICAgICAgICB7CiAgICAgICAgICAgIEluc3RhbGxTcGVjaWZpZWRVcGRhdGUgJHNwMjAxMFNQMiAiU2VydmljZSBQYWNrIDIiCiAgICAgICAgfQogICAgICAgICMgT3RoZXJ3aXNlLCBpbnN0YWxsIFNQMSBhcyBpdCBpcyBhIHJlcXVpcmVkIGJhc2VsaW5lIGZvciBhbnkgcG9zdC1KdW5lIDIwMTIgQ1VzCiAgICAgICAgZWxzZWlmICgkc3AyMDEwU1AxKQogICAgICAgIHsKICAgICAgICAgICAgSW5zdGFsbFNwZWNpZmllZFVwZGF0ZSAkc3AyMDEwU1AxICJTZXJ2aWNlIFBhY2sgMSIKICAgICAgICB9CiAgICAgICAgIyBOZXh0LCBpbnN0YWxsIHRoZSBKdW5lIDIwMTMgQ1UgaWYgaXQncyBmb3VuZCBpbiBcVXBkYXRlcwogICAgICAgIGlmICgkc3AyMDEwSnVuZTIwMTNDVSkKICAgICAgICB7CiAgICAgICAgICAgIEluc3RhbGxTcGVjaWZpZWRVcGRhdGUgJHNwMjAxMEp1bmUyMDEzQ1UgIkp1bmUgMjAxMyBDVSIKICAgICAgICB9CiAgICAgICAgIyBOb3cgZmluZCBhbnkgbGFuZ3VhZ2UgcGFjayBzZXJ2aWNlIHBhY2tzLCB1c2luZyB0aGUgbmFtaW5nIGNvbnZlbnRpb25zIGZvciBib3RoIFNQMSBhbmQgU1AyCiAgICAgICAgJHNwMjAxMExQU2VydmljZVBhY2tzID0gR2V0LUNoaWxkSXRlbSAtUGF0aCAiJGJpdHNcJHNwWWVhclxVcGRhdGVzIiAtTmFtZSAtSW5jbHVkZSBzZXJ2ZXJsYW5ndWFnZXBhY2syMDEwc3AqLmV4ZSxvc2xwa3NwMjAxMCouZXhlIC1SZWN1cnNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgU29ydC1PYmplY3QgLURlc2NlbmRpbmcKICAgICAgICAjIE5vdyBpbnN0YWxsIGxhbmd1YWdlIHBhY2sgc2VydmljZSBwYWNrcyAtIG9ubHkgaWYgdGhleSBtYXRjaCBhIGN1cnJlbnRseS1pbnN0YWxsZWQgU2hhcmVQb2ludCBsYW5ndWFnZQogICAgICAgIGZvcmVhY2ggKCRpbnN0YWxsZWRPZmZpY2VTZXJ2ZXJMYW5ndWFnZSBpbiAkaW5zdGFsbGVkT2ZmaWNlU2VydmVyTGFuZ3VhZ2VzKQogICAgICAgIHsKICAgICAgICAgICAgW2FycmF5XSRzcDIwMTBMUFNlcnZpY2VQYWNrc1RvSW5zdGFsbCArPSAkc3AyMDEwTFBTZXJ2aWNlUGFja3MgfCBXaGVyZS1PYmplY3QgeyRfIC1saWtlICIqJGluc3RhbGxlZE9mZmljZVNlcnZlckxhbmd1YWdlKiJ9CiAgICAgICAgfQogICAgICAgIGlmICgkc3AyMDEwTFBTZXJ2aWNlUGFja3NUb0luc3RhbGwpCiAgICAgICAgewogICAgICAgICAgICBmb3JlYWNoICgkc3AyMDEwTFBTZXJ2aWNlUGFjayBpbiAkc3AyMDEwTFBTZXJ2aWNlUGFja3NUb0luc3RhbGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIEluc3RhbGxTcGVjaWZpZWRVcGRhdGUgJHNwMjAxMExQU2VydmljZVBhY2sgIkxhbmd1YWdlIFBhY2sgU2VydmljZSBQYWNrIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5PZmZpY2VXZWJBcHBzLkluc3RhbGwgLWVxICR0cnVlKQogICAgICAgIHsKICAgICAgICAgICAgJHNwMjAxME9XQVVwZGF0ZXMgPSBHZXQtQ2hpbGRJdGVtIC1QYXRoICIkYml0c1wkc3BZZWFyXFVwZGF0ZXMiIC1OYW1lIC1JbmNsdWRlIHdhYyouZXhlIC1SZWN1cnNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgU29ydC1PYmplY3QgLURlc2NlbmRpbmcKICAgICAgICAgICAgaWYgKCRzcDIwMTBPV0FVcGRhdGVzLkNvdW50IC1nZSAxKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkc3AyMDEwT1dBVXBkYXRlIGluICRzcDIwMTBPV0FVcGRhdGVzKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIEluc3RhbGxTcGVjaWZpZWRVcGRhdGUgJHNwMjAxME9XQVVwZGF0ZSAiT2ZmaWNlIFdlYiBBcHBzIFVwZGF0ZSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGlmICgkc3BZZWFyIC1lcSAiMjAxMyIpCiAgICB7CiAgICAgICAgIyBEbyBTUDEgZmlyc3QsIGlmIGl0J3MgZm91bmQKICAgICAgICAkc3AyMDEzU1AxID0gR2V0LUNoaWxkSXRlbSAtUGF0aCAiJGJpdHNcJHNwWWVhclxVcGRhdGVzIiAtTmFtZSAtSW5jbHVkZSAib2ZmaWNlc2VydmVyc3AyMDEzLWtiMjg4MDU1Mi1mdWxsZmlsZS14NjQtZW4tdXMuZXhlIiAtUmVjdXJzZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIGlmICgkc3AyMDEzU1AxKQogICAgICAgIHsKICAgICAgICAgICAgIyBJbiBjYXNlIHdlIGZpbmQgbW9yZSB0aGFuIG9uZSAoZS5nLiBpbiBzdWJmb2xkZXJzKSwgZ3JhYiB0aGUgZmlyc3Qgb25lCiAgICAgICAgICAgIGlmICgkc3AyMDEzU1AxIC1pcyBbc3lzdGVtLmFycmF5XSkgeyRzcDIwMTNTUDEgPSAkc3AyMDEzU1AxWzBdfQogICAgICAgICAgICBJbnN0YWxsU3BlY2lmaWVkVXBkYXRlICRzcDIwMTNTUDEgIlNlcnZpY2UgUGFjayAxIgogICAgICAgIH0KICAgICAgICBpZiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uUHJvamVjdFNlcnZlci5JbnN0YWxsIC1lcSAkdHJ1ZSkKICAgICAgICB7CiAgICAgICAgICAgIGlmICgkc3AyMDEzU1AxKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIExvb2sgZm9yIFByb2plY3QgU2VydmVyIDIwMTMgU1AxLCBzaW5jZSB3ZSBoYXZlIFNoYXJlUG9pbnQgU2VydmVyIFNQMQogICAgICAgICAgICAgICAgJHNwMjAxM1Byb2plY3RTUDEgPSBHZXQtQ2hpbGRJdGVtIC1QYXRoICIkYml0c1wkc3BZZWFyXFVwZGF0ZXMiIC1OYW1lIC1JbmNsdWRlICJwcm9qZWN0c2VydmVyc3AyMDEzLWtiMjgxNzQzNC1mdWxsZmlsZS14NjQtZW4tdXMuZXhlIiAtUmVjdXJzZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgaWYgKCRzcDIwMTNQcm9qZWN0U1AxKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICMgSW4gY2FzZSB3ZSBmaW5kIG1vcmUgdGhhbiBvbmUgKGUuZy4gaW4gc3ViZm9sZGVycyksIGdyYWIgdGhlIGZpcnN0IG9uZQogICAgICAgICAgICAgICAgICAgIGlmICgkc3AyMDEzUHJvamVjdFNQMSAtaXMgW3N5c3RlbS5hcnJheV0pIHskc3AyMDEzUHJvamVjdFNQMSA9ICRzcDIwMTNQcm9qZWN0U1AxWzBdfQogICAgICAgICAgICAgICAgICAgIEluc3RhbGxTcGVjaWZpZWRVcGRhdGUgJHNwMjAxM1Byb2plY3RTUDEgIlByb2plY3QgU2VydmVyIFNlcnZpY2UgUGFjayAxIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiV0FSTklORzpQcm9qZWN0IFNlcnZlciBTZXJ2aWNlIFBhY2sgMSB3YXNuJ3QgZm91bmQuIFNpbmNlIFNoYXJlUG9pbnQgaXRzZWxmIHdpbGwgYmUgdXBkYXRlZCB0byBTUDEsIHlvdSBzaG91bGQgZG93bmxvYWQgYW5kIGluc3RhbGwgUHJvamVjdCBTZXJ2ZXIgMjAxMyBTUDEgZm9yIHlvdXIgc2VydmVyL2Zhcm0gdG8gYmUgY29tcGxldGVseSBwYXRjaGVkLiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICMgTG9vayBmb3IgYSBQcm9qZWN0IFNlcnZlciBNYXJjaCBQVQogICAgICAgICAgICAgICAgJG1hcmNoUHVibGljVXBkYXRlID0gR2V0LUNoaWxkSXRlbSAtUGF0aCAiJGJpdHNcJHNwWWVhclxVcGRhdGVzIiAtTmFtZSAtSW5jbHVkZSAidWJlcnNydnByanNwMjAxMy1rYjI3NjgwMDEtZnVsbGZpbGUteDY0LWdsYi5leGUiIC1SZWN1cnNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgICAgICBpZiAoISRtYXJjaFB1YmxpY1VwZGF0ZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAjIEluIGNhc2Ugd2UgZm9yZ290IHRvIGluY2x1ZGUgdGhlIFByb2plY3QgU2VydmVyIE1hcmNoIFBVLCBqdXN0IGxvb2sgZm9yIHRoZSBTaGFyZVBvaW50IFNlcnZlciBNYXJjaCBQVQogICAgICAgICAgICAgICAgICAgICRtYXJjaFB1YmxpY1VwZGF0ZSA9IEdldC1DaGlsZEl0ZW0gLVBhdGggIiRiaXRzXCRzcFllYXJcVXBkYXRlcyIgLU5hbWUgLUluY2x1ZGUgInViZXJzcnZzcDIwMTMta2IyNzY3OTk5LWZ1bGxmaWxlLXg2NC1nbGIuZXhlIiAtUmVjdXJzZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmICgkbWFyY2hQdWJsaWNVcGRhdGUpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIldBUk5JTkc6VGhlIFByb2plY3QgU2VydmVyIE1hcmNoIFBVIHdhc24ndCBmb3VuZCwgYnV0IHRoZSByZWd1bGFyIFNoYXJlUG9pbnQgU2VydmVyIE1hcmNoIFBVIHdhcywgYW5kIHdpbGwgYmUgYXBwbGllZC4gSG93ZXZlciB5b3Ugc2hvdWxkIGRvd25sb2FkIGFuZCBpbnN0YWxsIHRoZSBmdWxsIFByb2plY3QgU2VydmVyIE1hcmNoIFBVIGFuZCBhbnkgc3Vic2VxdWVudCB1cGRhdGVzIGFmdGVyd2FyZHMgZm9yIHlvdXIgc2VydmVyL2Zhcm0gdG8gYmUgY29tcGxldGVseSBwYXRjaGVkLiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgaWYgKCEkc3AyMDEzU1AxKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIExvb2sgZm9yIHRoZSBTaGFyZVBvaW50IFNlcnZlciBNYXJjaCBQVQogICAgICAgICAgICAgICAgJG1hcmNoUHVibGljVXBkYXRlID0gR2V0LUNoaWxkSXRlbSAtUGF0aCAiJGJpdHNcJHNwWWVhclxVcGRhdGVzIiAtTmFtZSAtSW5jbHVkZSAidWJlcnNydnNwMjAxMy1rYjI3Njc5OTktZnVsbGZpbGUteDY0LWdsYi5leGUiIC1SZWN1cnNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCRtYXJjaFB1YmxpY1VwZGF0ZSkKICAgICAgICB7CiAgICAgICAgICAgICMgSW4gY2FzZSB3ZSBmaW5kIG1vcmUgdGhhbiBvbmUgKGUuZy4gaW4gc3ViZm9sZGVycyksIGdyYWIgdGhlIGZpcnN0IG9uZQogICAgICAgICAgICBpZiAoJG1hcmNoUHVibGljVXBkYXRlIC1pcyBbc3lzdGVtLmFycmF5XSkgeyRtYXJjaFB1YmxpY1VwZGF0ZSA9ICRtYXJjaFB1YmxpY1VwZGF0ZVswXX0KICAgICAgICAgICAgSW5zdGFsbFNwZWNpZmllZFVwZGF0ZSAkbWFyY2hQdWJsaWNVcGRhdGUgIk1hcmNoIDIwMTMgUHVibGljIFVwZGF0ZSIKICAgICAgICB9CiAgICB9CiAgICAjIEdldCBhbGwgQ1VzIGV4Y2VwdCB0aGUgTWFyY2ggMjAxMyBQVSBmb3IgU2hhcmVQb2ludCAvIFByb2plY3QgU2VydmVyIDIwMTMgYW5kIHRoZSBKdW5lIDIwMTMgQ1UgZm9yIFNoYXJlUG9pbnQgMjAxMAogICAgJGN1bXVsYXRpdmVVcGRhdGVzID0gR2V0LUNoaWxkSXRlbSAtUGF0aCAiJGJpdHNcJHNwWWVhclxVcGRhdGVzIiAtTmFtZSAtSW5jbHVkZSBvZmZpY2UyMDEwKi5leGUsdWJlcnNydiouZXhlLHViZXJzdHMqLmV4ZSwqcGpzcnYqLmV4ZSxzaGFyZXBvaW50c3AyMDEzKi5leGUsY29yZXNlcnZlcjIwMSouZXhlIC1SZWN1cnNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgV2hlcmUtT2JqZWN0IHskXyAtbm90bGlrZSAiKnViZXJzcnZzcDIwMTMta2IyNzY3OTk5LWZ1bGxmaWxlLXg2NC1nbGIuZXhlIiAtYW5kICRfIC1ub3RsaWtlICIqdWJlcnNydnByanNwMjAxMy1rYjI3NjgwMDEtZnVsbGZpbGUteDY0LWdsYi5leGUiIC1hbmQgJF8gLW5vdGxpa2UgIip1YmVyc3J2MjAxMC1rYjI4MTc1MjctZnVsbGZpbGUteDY0LWdsYi5leGUifSB8IFNvcnQtT2JqZWN0IC1EZXNjZW5kaW5nCiAgICAjIEZpbHRlciBvdXQgUHJvamVjdCBTZXJ2ZXIgdXBkYXRlcyBpZiB3ZSBhcmVuJ3QgaW5zdGFsbGluZyBQcm9qZWN0IFNlcnZlcgogICAgaWYgKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlByb2plY3RTZXJ2ZXIuSW5zdGFsbCAtbmUgJHRydWUpCiAgICB7CiAgICAgICAgJGN1bXVsYXRpdmVVcGRhdGVzID0gJGN1bXVsYXRpdmVVcGRhdGVzIHwgV2hlcmUtT2JqZWN0IHsoJF8gLW5vdGxpa2UgIipwcmoqLmV4ZSIpIC1hbmQgKCRfIC1ub3RsaWtlICIqcGpzcnYqLmV4ZSIpfQogICAgfQogICAgIyBMb29rIGZvciBTZXJ2ZXIgQ3VtdWxhdGl2ZSBVcGRhdGUgaW5zdGFsbGVycwogICAgaWYgKCRjdW11bGF0aXZlVXBkYXRlcykKICAgIHsKICAgICAgICAjIERpc3BsYXkgd2FybmluZyBhYm91dCBtaXNzaW5nIE1hcmNoIDIwMTMgUFUgb25seSBpZiB3ZSBhcmUgYWN0dWFsbHkgaW5zdGFsbGluZyBTUDIwMTMgYW5kIFNQMSBpc24ndCBhbHJlYWR5IGluc3RhbGxlZCBhbmQgdGhlIFNQMSBpbnN0YWxsZXIgaXNuJ3QgZm91bmQKICAgICAgICBpZiAoJHNwWWVhciAtZXEgIjIwMTMiIC1hbmQgISgkc3AyMDEzU1AxIC1vciAoQ2hlY2tGb3IyMDEzU1AxKSkgLWFuZCAhJG1hcmNoUHVibGljVXBkYXRlKQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgIC0gTm90ZTogdGhlIE1hcmNoIDIwMTMgUFUgcGFja2FnZSB3YXNuJ3QgZm91bmQgaW4gLi5cJHNwWWVhclxVcGRhdGVzOyBpdCBtYXkgbmVlZCB0byBiZSBpbnN0YWxsZWQgZmlyc3QgaWYgaXQgd2Fzbid0IHNsaXBzdHJlYW1lZC4iCiAgICAgICAgfQogICAgICAgICMgTm93IGF0dGVtcHQgdG8gaW5zdGFsbCBhbnkgb3RoZXIgQ1VzIGZvdW5kIGluIHRoZSBcVXBkYXRlcyBmb2xkZXIKICAgICAgICBsb2cgIiAgLSBJbnN0YWxsaW5nIFNoYXJlUG9pbnQgQ3VtdWxhdGl2ZSBVcGRhdGVzOiIKICAgICAgICBGb3JFYWNoICgkY3VtdWxhdGl2ZVVwZGF0ZSBpbiAkY3VtdWxhdGl2ZVVwZGF0ZXMpCiAgICAgICAgewogICAgICAgICAgICAjIEdldCB0aGUgZmlsZSBuYW1lIG9ubHksIGluIGNhc2UgJGN1bXVsYXRpdmVVcGRhdGUgaW5jbHVkZXMgcGFydCBvZiBhIHBhdGggKGUuZy4gaXMgaW4gYSBzdWJmb2xkZXIpCiAgICAgICAgICAgICRzcGxpdEN1bXVsYXRpdmVVcGRhdGUgPSBTcGxpdC1QYXRoIC1QYXRoICRjdW11bGF0aXZlVXBkYXRlIC1MZWFmCiAgICAgICAgICAgIGxvZyAiICAgLSBJbnN0YWxsaW5nICRzcGxpdEN1bXVsYXRpdmVVcGRhdGUuLi4iIAogICAgICAgICAgICAkc3RhcnRUaW1lID0gR2V0LURhdGUKICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAtRmlsZVBhdGggIiRiaXRzXCRzcFllYXJcVXBkYXRlc1wkY3VtdWxhdGl2ZVVwZGF0ZSIgLUFyZ3VtZW50TGlzdCAiL3Bhc3NpdmUgL25vcmVzdGFydCIKICAgICAgICAgICAgU2hvdy1Qcm9ncmVzcyAtUHJvY2VzcyAkKCRzcGxpdEN1bXVsYXRpdmVVcGRhdGUgLXJlcGxhY2UgIi5leGUiLCAiIikgLUNvbG9yIEN5YW4gLUludGVydmFsIDUKICAgICAgICAgICAgJGRlbHRhLCRudWxsID0gKE5ldy1UaW1lU3BhbiAtU3RhcnQgJHN0YXJ0VGltZSAtRW5kIChHZXQtRGF0ZSkpLlRvU3RyaW5nKCkgLXNwbGl0ICJcLiIKICAgICAgICAgICAgJG9QYXRjaEluc3RhbGxMb2cgPSBHZXQtQ2hpbGRJdGVtIC1QYXRoIChHZXQtSXRlbSAkZW52OlRFTVApLkZ1bGxOYW1lIHwgPyB7JF8uTmFtZSAtbGlrZSAib3BhdGNoaW5zdGFsbCoubG9nIn0gfCBTb3J0LU9iamVjdCAtRGVzY2VuZGluZyAtUHJvcGVydHkgIkxhc3RXcml0ZVRpbWUiIHwgU2VsZWN0LU9iamVjdCAtZmlyc3QgMQogICAgICAgICAgICAjIEdldCBpbnN0YWxsIHJlc3VsdCBmcm9tIGxvZwogICAgICAgICAgICAkb1BhdGNoSW5zdGFsbFJlc3VsdE1lc3NhZ2UgPSAkb1BhdGNoSW5zdGFsbExvZyB8IFNlbGVjdC1TdHJpbmcgLVNpbXBsZU1hdGNoIC1QYXR0ZXJuICJPUGF0Y2hJbnN0YWxsOiBQcm9wZXJ0eSAnU1lTLlBST0MuUkVTVUxUJyB2YWx1ZSIgfCBTZWxlY3QtT2JqZWN0IC1MYXN0IDEKICAgICAgICAgICAgSWYgKCEoJG9QYXRjaEluc3RhbGxSZXN1bHRNZXNzYWdlIC1saWtlICIqdmFsdWUgJzAnKiIpKSAjIEFueXRoaW5nIG90aGVyIHRoYW4gMCBtZWFucyB1bnN1Y2Nlc3NmdWwgYnV0IHRoYXQncyBub3QgbmVjZXNzYXJpbHkgYSBiYWQgdGhpbmcKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJG51bGwsJG9QYXRjaEluc3RhbGxSZXN1bHRDb2RlID0gJG9QYXRjaEluc3RhbGxSZXN1bHRNZXNzYWdlLkxpbmUgLXNwbGl0ICJPUGF0Y2hJbnN0YWxsOiBQcm9wZXJ0eSAnU1lTLlBST0MuUkVTVUxUJyB2YWx1ZSAnIgogICAgICAgICAgICAgICAgJG9QYXRjaEluc3RhbGxSZXN1bHRDb2RlID0gJG9QYXRjaEluc3RhbGxSZXN1bHRDb2RlLlRyaW1FbmQoIiciKQogICAgICAgICAgICAgICAgIyBPUGF0Y2hJbnN0YWxsOiBQcm9wZXJ0eSAnU1lTLlBST0MuUkVTVUxUJyB2YWx1ZSAnMTcwMjgnIG1lYW5zIHRoZSBwYXRjaCB3YXMgbm90IG5lZWRlZCBvciBpbnN0YWxsZWQgcHJvZHVjdCB3YXMgbmV3ZXIKICAgICAgICAgICAgICAgIGlmICgkb1BhdGNoSW5zdGFsbFJlc3VsdENvZGUgLWVxICIxNzAyOCIpIHtsb2cgIiAgIC0gUGF0Y2ggbm90IHJlcXVpcmVkOyBpbnN0YWxsZWQgcHJvZHVjdCBpcyBzYW1lIG9yIG5ld2VyLiJ9CiAgICAgICAgICAgICAgICBlbHNlaWYgKCRvUGF0Y2hJbnN0YWxsUmVzdWx0Q29kZSAtZXEgIjE3MDMxIikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIldBUk5JTkc6RXJyb3IgMTcwMzE6IERldGVjdGlvbjogSW52YWxpZCBiYXNlbGluZSIKICAgICAgICAgICAgICAgICAgICBsb2cgIldBUk5JTkc6QSBiYXNlbGluZSBwYXRjaCAoZS5nLiBNYXJjaCAyMDEzIFBVIGZvciBTUDIwMTMsIFNQMSBmb3IgU1AyMDEwKSBpcyBtaXNzaW5nISIKICAgICAgICAgICAgICAgICAgICBsb2cgIiAgIC0gRWl0aGVyIHNsaXBzdHJlYW0gdGhlIG1pc3NpbmcgcGF0Y2ggZmlyc3QsIG9yIGluY2x1ZGUgdGhlIHBhdGNoIHBhY2thZ2UgaW4gdGhlIC4uXCRzcFllYXJcVXBkYXRlcyBmb2xkZXIuIgogICAgICAgICAgICAgICAgICAgIFBhdXNlICJjb250aW51ZSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2Uge2xvZyAiICAgLSAkKCRvUGF0Y2hJbnN0YWxsUmVzdWx0Q29kZXMuJG9QYXRjaEluc3RhbGxSZXN1bHRDb2RlKSJ9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbG9nICIgICAtICRzcGxpdEN1bXVsYXRpdmVVcGRhdGUgaW5zdGFsbCBjb21wbGV0ZWQgaW4gJGRlbHRhLiIKICAgICAgICB9CiAgICAgICAgbG9nICIgIC0gQ3VtdWxhdGl2ZSBVcGRhdGUgaW5zdGFsbGF0aW9uIGNvbXBsZXRlLiIKICAgIH0KICAgICMgRmluYWxseSwgaW5zdGFsbCBTUDIgbGFzdCBpbiBjYXNlIHdlIGFwcGxpZWQgdGhlIEp1bmUgMjAxMyBDVSB3aGljaCB3b3VsZCBub3QgaGF2ZSBwcm9wZXJseSBkZXRlY3RlZCBTUDIuLi4KICAgIGlmICgkc3AyMDEwU1AyIC1hbmQgJHNwMjAxMEp1bmUyMDEzQ1UgLWFuZCAkc3BZZWFyIC1lcSAiMjAxMCIpCiAgICB7CiAgICAgICAgSW5zdGFsbFNwZWNpZmllZFVwZGF0ZSAkc3AyMDEwU1AyICJTZXJ2aWNlIFBhY2sgMiIKICAgIH0KICAgIGlmICghJG1hcmNoUHVibGljVXBkYXRlIC1hbmQgISRjdW11bGF0aXZlVXBkYXRlcykKICAgIHsKICAgICAgICBsb2cgIiAtIE5vIG90aGVyIHVwZGF0ZXMgZm91bmQgaW4gJGJpdHNcJHNwWWVhclxVcGRhdGVzLCBwcm9jZWVkaW5nLi4uIgogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxvZyAiIC0gRmluaXNoZWQgaW5zdGFsbGluZyBTaGFyZVBvaW50IHVwZGF0ZXMuIgogICAgfQogICAgV3JpdGVMaW5lCn0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IEluc3RhbGxTcGVjaWZpZWRVcGRhdGUKIyBEZXNjOiBJbnN0YWxscyBhIHNwZWNpZmllZCBTaGFyZVBvaW50IFVwZGF0ZXMgKENVIG9yIFNlcnZpY2UgUGFjaykKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBJbnN0YWxsU3BlY2lmaWVkVXBkYXRlICgkdXBkYXRlRmlsZSwgJHVwZGF0ZU5hbWUpCnsKICAgICMgR2V0IHRoZSBmaWxlIG5hbWUgb25seSwgaW4gY2FzZSAkdXBkYXRlRmlsZSBpbmNsdWRlcyBwYXJ0IG9mIGEgcGF0aCAoZS5nLiBpcyBpbiBhIHN1YmZvbGRlcikKICAgICRzcGxpdFVwZGF0ZUZpbGUgPSBTcGxpdC1QYXRoIC1QYXRoICR1cGRhdGVGaWxlIC1MZWFmCiAgICBsb2cgIiAgLSBJbnN0YWxsaW5nIFNQJHNwWWVhciAkdXBkYXRlTmFtZSAkc3BsaXRVcGRhdGVGaWxlLi4uIiAKICAgICRzdGFydFRpbWUgPSBHZXQtRGF0ZQogICAgU3RhcnQtUHJvY2VzcyAtRmlsZVBhdGggIiRiaXRzXCRzcFllYXJcVXBkYXRlc1wkdXBkYXRlRmlsZSIgLUFyZ3VtZW50TGlzdCAiL3Bhc3NpdmUgL25vcmVzdGFydCIKICAgIFNob3ctUHJvZ3Jlc3MgLVByb2Nlc3MgJCgkc3BsaXRVcGRhdGVGaWxlIC1yZXBsYWNlICIuZXhlIiwgIiIpIC1Db2xvciBDeWFuIC1JbnRlcnZhbCA1CiAgICAkZGVsdGEsJG51bGwgPSAoTmV3LVRpbWVTcGFuIC1TdGFydCAkc3RhcnRUaW1lIC1FbmQgKEdldC1EYXRlKSkuVG9TdHJpbmcoKSAtc3BsaXQgIlwuIgogICAgJG9QYXRjaEluc3RhbGxMb2cgPSBHZXQtQ2hpbGRJdGVtIC1QYXRoIChHZXQtSXRlbSAkZW52OlRFTVApLkZ1bGxOYW1lIHwgPyB7JF8uTmFtZSAtbGlrZSAib3BhdGNoaW5zdGFsbCoubG9nIn0gfCBTb3J0LU9iamVjdCAtRGVzY2VuZGluZyAtUHJvcGVydHkgIkxhc3RXcml0ZVRpbWUiIHwgU2VsZWN0LU9iamVjdCAtZmlyc3QgMQogICAgIyBHZXQgaW5zdGFsbCByZXN1bHQgZnJvbSBsb2cKICAgICRvUGF0Y2hJbnN0YWxsUmVzdWx0TWVzc2FnZSA9ICRvUGF0Y2hJbnN0YWxsTG9nIHwgU2VsZWN0LVN0cmluZyAtU2ltcGxlTWF0Y2ggLVBhdHRlcm4gIk9QYXRjaEluc3RhbGw6IFByb3BlcnR5ICdTWVMuUFJPQy5SRVNVTFQnIHZhbHVlIiB8IFNlbGVjdC1PYmplY3QgLUxhc3QgMQogICAgSWYgKCEoJG9QYXRjaEluc3RhbGxSZXN1bHRNZXNzYWdlIC1saWtlICIqdmFsdWUgJzAnKiIpKSAjIEFueXRoaW5nIG90aGVyIHRoYW4gMCBtZWFucyB1bnN1Y2Nlc3NmdWwgYnV0IHRoYXQncyBub3QgbmVjZXNzYXJpbHkgYSBiYWQgdGhpbmcKICAgIHsKICAgICAgICAkbnVsbCwkb1BhdGNoSW5zdGFsbFJlc3VsdENvZGUgPSAkb1BhdGNoSW5zdGFsbFJlc3VsdE1lc3NhZ2UuTGluZSAtc3BsaXQgIk9QYXRjaEluc3RhbGw6IFByb3BlcnR5ICdTWVMuUFJPQy5SRVNVTFQnIHZhbHVlICciCiAgICAgICAgJG9QYXRjaEluc3RhbGxSZXN1bHRDb2RlID0gJG9QYXRjaEluc3RhbGxSZXN1bHRDb2RlLlRyaW1FbmQoIiciKQogICAgICAgICMgT1BhdGNoSW5zdGFsbDogUHJvcGVydHkgJ1NZUy5QUk9DLlJFU1VMVCcgdmFsdWUgJzE3MDI4JyBtZWFucyB0aGUgcGF0Y2ggd2FzIG5vdCBuZWVkZWQgb3IgaW5zdGFsbGVkIHByb2R1Y3Qgd2FzIG5ld2VyCiAgICAgICAgaWYgKCRvUGF0Y2hJbnN0YWxsUmVzdWx0Q29kZSAtZXEgIjE3MDI4Iikge2xvZyAiICAgLSBQYXRjaCBub3QgcmVxdWlyZWQ7IGluc3RhbGxlZCBwcm9kdWN0IGlzIHNhbWUgb3IgbmV3ZXIuIn0KICAgICAgICBlbHNlaWYgKCRvUGF0Y2hJbnN0YWxsUmVzdWx0Q29kZSAtZXEgIjE3MDMxIikKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAiV0FSTklORzpFcnJvciAxNzAzMTogRGV0ZWN0aW9uOiBJbnZhbGlkIGJhc2VsaW5lIgogICAgICAgICAgICBsb2cgIldBUk5JTkc6QSBiYXNlbGluZSBwYXRjaCAoZS5nLiBNYXJjaCAyMDEzIFBVIGZvciBTUDIwMTMsIFNQMSBmb3IgU1AyMDEwKSBpcyBtaXNzaW5nISIKICAgICAgICAgICAgbG9nICIgICAtIEVpdGhlciBzbGlwc3RyZWFtIHRoZSBtaXNzaW5nIHBhdGNoIGZpcnN0LCBvciBpbmNsdWRlIHRoZSBwYXRjaCBwYWNrYWdlIGluIHRoZSAuLlwkc3BZZWFyXFVwZGF0ZXMgZm9sZGVyLiIKICAgICAgICAgICAgUGF1c2UgImNvbnRpbnVlIgogICAgICAgIH0KICAgICAgICBlbHNlIHtsb2cgIiAgLSAkKCRvUGF0Y2hJbnN0YWxsUmVzdWx0Q29kZXMuJG9QYXRjaEluc3RhbGxSZXN1bHRDb2RlKSJ9CiAgICB9CiAgICBsb2cgIiAgLSAkdXBkYXRlTmFtZSBpbnN0YWxsIGNvbXBsZXRlZCBpbiAkZGVsdGEuIgp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ29uZmlndXJlIEZhcm0gQWNjb3VudAojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogQ29uZmlndXJlRmFybUFkbWluCiMgRGVzYzogU2V0cyB1cCB0aGUgZmFybSBhY2NvdW50IGFuZCBhZGRzIHRvIExvY2FsIGFkbWlucyBpZiBuZWVkZWQKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBDb25maWd1cmVGYXJtQWRtaW4oW3htbF0keG1saW5wdXQpCnsKICAgICMgUGVyIFNwZW5jZXIgSGFyYmFyLCB0aGUgZmFybSBhY2NvdW50IG5lZWRzIHRvIGJlIGEgbG9jYWwgYWRtaW4gd2hlbiBwcm92aXNpb25pbmcgZGlzdHJpYnV0ZWQgY2FjaGUsIHNvIGlmIGl0J3MgYmVpbmcgcmVxdWVzdGVkIGZvciBwcm92aXNpb25pbmcgd2UnbGwgYWRkIGl0IHRvIEFkbWluaXN0cmF0b3JzIGhlcmUKICAgIElmICgoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5BY2NvdW50LkFkZFRvTG9jYWxBZG1pbnNEdXJpbmdTZXR1cCAtZXEgJHRydWUpIC1vciAoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5Vc2VyUHJvZmlsZVNlcnZpY2VBcHAgLWVxICR0cnVlKSAtb3IgKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2aWNlcy5EaXN0cmlidXRlZENhY2hlIC1lcSAkdHJ1ZSkpCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgIyBBZGQgdG8gQWRtaW5zIEdyb3VwCiAgICAgICAgJGZhcm1BY2N0ID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5BY2NvdW50LlVzZXJuYW1lCiAgICAgICAgbG9nICIgLSBBZGRpbmcgJGZhcm1BY2N0IHRvIGxvY2FsIEFkbWluaXN0cmF0b3JzIiAKICAgICAgICBJZiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5BY2NvdW50LkxlYXZlSW5Mb2NhbEFkbWlucyAtbmUgJHRydWUpIHtsb2cgIiAob25seSBmb3IgaW5zdGFsbCkuLi4ifQogICAgICAgIEVsc2Uge2xvZyAiIC4uLiJ9CiAgICAgICAgJGZhcm1BY2N0RG9tYWluLCRmYXJtQWNjdFVzZXIgPSAkZmFybUFjY3QgLVNwbGl0ICJcXCIKICAgICAgICBUcnkKICAgICAgICB7CiAgICAgICAgICAgICRidWlsdGluQWRtaW5Hcm91cCA9IEdldC1BZG1pbmlzdHJhdG9yc0dyb3VwCiAgICAgICAgICAgIChbQURTSV0iV2luTlQ6Ly8kZW52OkNPTVBVVEVSTkFNRS8kYnVpbHRpbkFkbWluR3JvdXAsZ3JvdXAiKS5BZGQoIldpbk5UOi8vJGZhcm1BY2N0RG9tYWluLyRmYXJtQWNjdFVzZXIiKQogICAgICAgICAgICBJZiAoLW5vdCAkPykge1Rocm93fQogICAgICAgICAgICAjIFJlc3RhcnQgdGhlIFNQVGltZXJWNCBzZXJ2aWNlIGlmIGl0J3MgcnVubmluZywgc28gaXQgd2lsbCBwaWNrIHVwIHRoZSBuZXcgY3JlZGVudGlhbAogICAgICAgICAgICBJZiAoKEdldC1TZXJ2aWNlIC1OYW1lIFNQVGltZXJWNCkuU3RhdHVzIC1lcSAiUnVubmluZyIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiIC0gUmVzdGFydGluZyBTaGFyZVBvaW50IFRpbWVyIFNlcnZpY2UuLi4iCiAgICAgICAgICAgICAgICBSZXN0YXJ0LVNlcnZpY2UgU1BUaW1lclY0CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQ2F0Y2gge2xvZyAiIC0gJGZhcm1BY2N0IGlzIGFscmVhZHkgYSBtZW1iZXIgb2YgYCIkYnVpbHRpbkFkbWluR3JvdXBgIi4ifQogICAgICAgIFdyaXRlTGluZQogICAgfQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogR2V0RmFybUNyZWRlbnRpYWxzCiMgRGVzYzogUmV0dXJuIHRoZSBjcmVkZW50aWFscyBmb3IgdGhlIGZhcm0gYWNjb3VudCwgcHJvbXB0IHRoZSB1c2VyIGlmIG5lZWQgbW9yZSBpbmZvCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gR2V0RmFybUNyZWRlbnRpYWxzKFt4bWxdJHhtbGlucHV0KQp7CiAgICAkZmFybUFjY3QgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkFjY291bnQuVXNlcm5hbWUKICAgICRmYXJtQWNjdFBXRCA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uQWNjb3VudC5QYXNzd29yZAogICAgSWYgKCEoJGZhcm1BY2N0KSAtb3IgJGZhcm1BY2N0IC1lcSAiIiAtb3IgISgkZmFybUFjY3RQV0QpIC1vciAkZmFybUFjY3RQV0QgLWVxICIiKQogICAgewogICAgICAgIFdyaXRlLUhvc3QgLUJhY2tncm91bmRDb2xvciBHcmF5IC1Gb3JlZ3JvdW5kQ29sb3IgRGFya0N5YW4gIiAtIFByb21wdGluZyBmb3IgRmFybSBBY2NvdW50OiIKICAgICAgICAkc2NyaXB0OmZhcm1DcmVkZW50aWFsID0gJGhvc3QudWkuUHJvbXB0Rm9yQ3JlZGVudGlhbCgiRmFybSBTZXR1cCIsICJFbnRlciBGYXJtIEFjY291bnQgQ3JlZGVudGlhbHM6IiwgIiRmYXJtQWNjdCIsICJOZXRCaW9zVXNlck5hbWUiICkKICAgIH0KICAgIEVsc2UKICAgIHsKICAgICAgICAkc2VjUGFzc3dvcmQgPSBDb252ZXJ0VG8tU2VjdXJlU3RyaW5nICIkZmFybUFjY3RQV0QiIC1Bc1BsYWludGV4dCAtRm9yY2UKICAgICAgICAkc2NyaXB0OmZhcm1DcmVkZW50aWFsID0gTmV3LU9iamVjdCBTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBzQ3JlZGVudGlhbCAkZmFybUFjY3QsJHNlY1Bhc3N3b3JkCiAgICB9CiAgICBSZXR1cm4gJGZhcm1DcmVkZW50aWFsCn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBHZXQgRmFybSBQYXNzcGhyYXNlCkZ1bmN0aW9uIEdldEZhcm1QYXNzcGhyYXNlKFt4bWxdJHhtbGlucHV0KQp7CiAgICAkZmFybVBhc3NwaHJhc2UgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlBhc3NwaHJhc2UKICAgIElmICghKCRmYXJtUGFzc3BocmFzZSkgLW9yICgkZmFybVBhc3NwaHJhc2UgLWVxICIiKSkKICAgIHsKICAgICAgICAkZmFybVBhc3NwaHJhc2UgPSBSZWFkLUhvc3QgLVByb21wdCAiIC0gUGxlYXNlIGVudGVyIHRoZSBmYXJtIHBhc3NwaHJhc2Ugbm93IiAtQXNTZWN1cmVTdHJpbmcKICAgICAgICBJZiAoISgkZmFybVBhc3NwaHJhc2UpIC1vciAoJGZhcm1QYXNzcGhyYXNlIC1lcSAiIikpIHsgVGhyb3cgIiAtIEZhcm0gcGFzc3BocmFzZSBpcyByZXF1aXJlZCEiIH0KICAgIH0KICAgIFJldHVybiAkZmFybVBhc3NwaHJhc2UKfQojRW5kUmVnaW9uCgojUmVnaW9uIEdldCBTZWN1cmUgRmFybSBQYXNzcGhyYXNlCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBHZXRTZWN1cmVGYXJtUGFzc3BocmFzZQojIERlc2M6IFJldHVybiB0aGUgRmFybSBQaHJhc2UgYXMgYSBzZWN1cmUgc3RyaW5nCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gR2V0U2VjdXJlRmFybVBhc3NwaHJhc2UoW3htbF0keG1saW5wdXQpCnsKICAgIElmICghKCRmYXJtUGFzc3BocmFzZSkgLW9yICgkZmFybVBhc3NwaHJhc2UgLWVxICIiKSkKICAgIHsKICAgICAgICAkZmFybVBhc3NwaHJhc2UgPSBHZXRGYXJtUGFzc1BocmFzZSAkeG1saW5wdXQKICAgIH0KICAgIElmICgkZmFybVBhc3NQaHJhc2UuR2V0VHlwZSgpLk5hbWUgLW5lICJTZWN1cmVTdHJpbmciKQogICAgewogICAgICAgICRzZWNQaHJhc2UgPSBDb252ZXJ0VG8tU2VjdXJlU3RyaW5nICRmYXJtUGFzc3BocmFzZSAtQXNQbGFpbnRleHQgLUZvcmNlCiAgICB9CiAgICBFbHNlIHskc2VjUGhyYXNlID0gJGZhcm1QYXNzcGhyYXNlfQogICAgUmV0dXJuICRzZWNQaHJhc2UKfQojRW5kUmVnaW9uCgojUmVnaW9uIFVwZGF0ZSBTZXJ2aWNlIFByb2Nlc3MgSWRlbnRpdHkKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogVXBkYXRlUHJvY2Vzc0lkZW50aXR5CiMgRGVzYzogVXBkYXRlcyB0aGUgYWNjb3VudCBhIHNwZWNpZmllZCBzZXJ2aWNlIHJ1bnMgdW5kZXIgdG8gdGhlIGdlbmVyYWwgYXBwIHBvb2wgYWNjb3VudAojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBVcGRhdGVQcm9jZXNzSWRlbnRpdHkgKCRzZXJ2aWNlVG9VcGRhdGUpCnsKICAgICRzcHNlcnZpY2UgPSBHZXQtU1BNYW5hZ2VkQWNjb3VudFhNTCAkeG1saW5wdXQgLUNvbW1vbk5hbWUgInNwc2VydmljZSIKICAgICMgTWFuYWdlZCBBY2NvdW50CiAgICAkbWFuYWdlZEFjY291bnRHZW4gPSBHZXQtU1BNYW5hZ2VkQWNjb3VudCB8IFdoZXJlLU9iamVjdCB7JF8uVXNlck5hbWUgLWVxICQoJHNwc2VydmljZS51c2VybmFtZSl9CiAgICBpZiAoJG1hbmFnZWRBY2NvdW50R2VuIC1lcSAkbnVsbCkgeyBUaHJvdyAiIC0gTWFuYWdlZCBBY2NvdW50ICQoJHNwc2VydmljZS51c2VybmFtZSkgbm90IGZvdW5kIiB9CiAgICBpZiAoJHNlcnZpY2VUb1VwZGF0ZS5TZXJ2aWNlKSB7JHNlcnZpY2VUb1VwZGF0ZSA9ICRzZXJ2aWNlVG9VcGRhdGUuU2VydmljZX0KICAgIGlmICgkc2VydmljZVRvVXBkYXRlLlByb2Nlc3NJZGVudGl0eS5Vc2VybmFtZSAtbmUgJG1hbmFnZWRBY2NvdW50R2VuLlVzZXJOYW1lKQogICAgewogICAgICAgIGxvZyAiIC0gVXBkYXRpbmcgJCgkc2VydmljZVRvVXBkYXRlLlR5cGVOYW1lKSB0byBydW4gYXMgJCgkbWFuYWdlZEFjY291bnRHZW4uVXNlck5hbWUpLi4uIiAKICAgICAgICAjIFNldCB0aGUgUHJvY2VzcyBJZGVudGl0eSB0byBvdXIgZ2VuZXJhbCBBcHAgUG9vbCBBY2NvdW50OyBvdGhlcndpc2UgaXQncyBzZXQgYnkgZGVmYXVsdCB0byB0aGUgRmFybSBBY2NvdW50IGFuZCBnaXZlcyB3YXJuaW5ncyBpbiB0aGUgSGVhbHRoIEFuYWx5emVyCiAgICAgICAgJHNlcnZpY2VUb1VwZGF0ZS5Qcm9jZXNzSWRlbnRpdHkuQ3VycmVudElkZW50aXR5VHlwZSA9ICJTcGVjaWZpY1VzZXIiCiAgICAgICAgJHNlcnZpY2VUb1VwZGF0ZS5Qcm9jZXNzSWRlbnRpdHkuTWFuYWdlZEFjY291bnQgPSAkbWFuYWdlZEFjY291bnRHZW4KICAgICAgICAkc2VydmljZVRvVXBkYXRlLlByb2Nlc3NJZGVudGl0eS5VcGRhdGUoKQogICAgICAgICRzZXJ2aWNlVG9VcGRhdGUuUHJvY2Vzc0lkZW50aXR5LkRlcGxveSgpCiAgICAgICAgbG9nICJEb25lLiIKICAgIH0KICAgIGVsc2Uge2xvZyAiIC0gJCgkc2VydmljZVRvVXBkYXRlLlR5cGVOYW1lKSBpcyBhbHJlYWR5IGNvbmZpZ3VyZWQgdG8gcnVuIGFzICQoJG1hbmFnZWRBY2NvdW50R2VuLlVzZXJOYW1lKS4ifQp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ3JlYXRlIG9yIEpvaW4gRmFybQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogQ3JlYXRlT3JKb2luRmFybQojIERlc2M6IENoZWNrIGlmIHRoZSBmYXJtIGlzIGNyZWF0ZWQKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBDcmVhdGVPckpvaW5GYXJtKFt4bWxdJHhtbGlucHV0LCAkc2VjUGhyYXNlLCAkZmFybUNyZWRlbnRpYWwpCnsKICAgIFdyaXRlTGluZQogICAgR2V0LU1ham9yVmVyc2lvbk51bWJlciAkeG1saW5wdXQKICAgICRkYlByZWZpeCA9IEdldC1EQlByZWZpeCAkeG1saW5wdXQKICAgICRjb25maWdEQiA9ICRkYlByZWZpeCskeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkRhdGFiYXNlLkNvbmZpZ0RCCgogICAgIyBMb29rIGZvciBhbiBleGlzdGluZyBmYXJtIGFuZCBqb2luIHRoZSBmYXJtIGlmIG5vdCBhbHJlYWR5IGpvaW5lZCwgb3IgY3JlYXRlIGEgbmV3IGZhcm0KICAgIFRyeQogICAgewogICAgICAgIGxvZyAiIC0gQ2hlY2tpbmcgZmFybSBtZW1iZXJzaGlwIGZvciAkZW52OkNPTVBVVEVSTkFNRSBpbiBgIiRjb25maWdEQmAiLi4uIiAKICAgICAgICAkc3BGYXJtID0gR2V0LVNQRmFybSB8IFdoZXJlLU9iamVjdCB7JF8uTmFtZSAtZXEgJGNvbmZpZ0RCfSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIGxvZyAiLiIKICAgIH0KICAgIENhdGNoIHtsb2cgIk5vdCBqb2luZWQgeWV0LiJ9CiAgICBJZiAoJHNwRmFybSAtZXEgJG51bGwpCiAgICB7CiAgICAgICAgJGRiU2VydmVyID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5EYXRhYmFzZS5EQlNlcnZlcgogICAgICAgICRjZW50cmFsQWRtaW5Db250ZW50REIgPSAkZGJQcmVmaXgrJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5DZW50cmFsQWRtaW4uRGF0YWJhc2UKICAgICAgICAjIElmIHRoZSBTaGFyZVBvaW50IHZlcnNpb24gaXMgbmV3ZXIgdGhhbiAyMDEwLCBzZXQgdGhlIG5ldyAtU2tpcFJlZ2lzdGVyQXNEaXN0cmlidXRlZENhY2hlSG9zdCBwYXJhbWV0ZXIgd2hlbiBjcmVhdGluZy9qb2luaW5nIHRoZSBmYXJtIAogICAgICAgICMgaWYgd2UgYXJlbid0IHJlcXVlc3RpbmcgaXQgZm9yIHRoZSBjdXJyZW50IHNlcnZlcgogICAgICAgIGlmICgoJGVudjpzcFZlciAtZ2UgIjE1IikgLWFuZCAhKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2aWNlcy5EaXN0cmlidXRlZENhY2hlIC1lcSAkdHJ1ZSkpCiAgICAgICAgewogICAgICAgICAgICAkZGlzdENhY2hlU3dpdGNoID0gQHtTa2lwUmVnaXN0ZXJBc0Rpc3RyaWJ1dGVkQ2FjaGVIb3N0ID0gJHRydWV9CiAgICAgICAgICAgIGxvZyAiIC0gVGhpcyBzZXJ2ZXIgKCRlbnY6Q09NUFVURVJOQU1FKSBoYXMgYmVlbiByZXF1ZXN0ZWQgdG8gYmUgZXhjbHVkZWQgZnJvbSB0aGUgRGlzdHJpYnV0ZWQgQ2FjaGUgY2x1c3Rlci4iCiAgICAgICAgfQogICAgICAgIGVsc2UgeyRkaXN0Q2FjaGVTd2l0Y2ggPSBAe319CiAgICAgICAgaWYgKCRlbnY6c3BWZXIgLWdlICIxNiIpCiAgICAgICAgewogICAgICAgICAgICBpZiAoU2hvdWxkSVByb3Zpc2lvbiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2ZXJSb2xlcy5DdXN0b20pKSB7JHNlcnZlclJvbGUgPSAiQ3VzdG9tIn0KICAgICAgICAgICAgZWxzZWlmIChTaG91bGRJUHJvdmlzaW9uICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZlclJvbGVzLldlYkZyb250RW5kKSkgeyRzZXJ2ZXJSb2xlID0gIldlYkZyb250RW5kIn0KICAgICAgICAgICAgZWxzZWlmIChTaG91bGRJUHJvdmlzaW9uICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZlclJvbGVzLlNlYXJjaCkpIHskc2VydmVyUm9sZSA9ICJTZWFyY2gifQogICAgICAgICAgICBlbHNlaWYgKFNob3VsZElQcm92aXNpb24gKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmVyUm9sZXMuQXBwbGljYXRpb24pKSB7JHNlcnZlclJvbGUgPSAiQXBwbGljYXRpb24ifQogICAgICAgICAgICBlbHNlaWYgKFNob3VsZElQcm92aXNpb24gKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmVyUm9sZXMuRGlzdHJpYnV0ZWRDYWNoZSkpIHskc2VydmVyUm9sZSA9ICJEaXN0cmlidXRlZENhY2hlIn0KICAgICAgICAgICAgZWxzZWlmIChTaG91bGRJUHJvdmlzaW9uICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZlclJvbGVzLlNpbmdsZVNlcnZlckZhcm0pKSB7JHNlcnZlclJvbGUgPSAiU2luZ2xlU2VydmVyRmFybSJ9CiAgICAgICAgICAgIGlmICgkc2VydmVyUm9sZSkgIyBJZiB0aGUgcm9sZSBoYXMgYmVlbiBzcGVjaWZpZWQsIGxldCdzIGFwcGx5IGl0CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRzZXJ2ZXJSb2xlU3dpdGNoID0gQHtMb2NhbFNlcnZlclJvbGUgPSAkc2VydmVyUm9sZX0KICAgICAgICAgICAgICAgICRzZXJ2ZXJSb2xlT3B0aW9uYWxTd2l0Y2ggPSBAe30KICAgICAgICAgICAgICAgIGxvZyAiIC0gVGhpcyBzZXJ2ZXIgKCRlbnY6Q09NUFVURVJOQU1FKSBoYXMgYmVlbiByZXF1ZXN0ZWQgdG8gaGF2ZSB0aGUgYCIkc2VydmVyUm9sZWAiIExvY2FsU2VydmVyUm9sZS4iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSAjIE90aGVyd2lzZSB3ZSdsbCBqdXN0IGdvIHdpdGggQ3VzdG9tL1NwZWNpYWxMb2FkCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRzZXJ2ZXJSb2xlU3dpdGNoID0gQHt9CiAgICAgICAgICAgICAgICAkc2VydmVyUm9sZU9wdGlvbmFsU3dpdGNoID0gQHtTZXJ2ZXJSb2xlT3B0aW9uYWwgPSAkdHJ1ZX0KICAgICAgICAgICAgICAgIGxvZyAiIC0gU2VydmVyUm9sZSB3YXMgbm90IHNwZWNpZmllZDsgYXNzdW1pbmcgYCJDdXN0b20vU3BlY2lhbExvYWRgIi4iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgJHNlcnZlclJvbGVTd2l0Y2ggPSBAe30KICAgICAgICAgICAgJHNlcnZlclJvbGVPcHRpb25hbFN3aXRjaCA9IEB7fQogICAgICAgIH0KICAgICAgICBsb2cgIiAtIEF0dGVtcHRpbmcgdG8gam9pbiBmYXJtIG9uIGAiJGNvbmZpZ0RCYCIuLi4iCiAgICAgICAgJGNvbm5lY3RGYXJtID0gQ29ubmVjdC1TUENvbmZpZ3VyYXRpb25EYXRhYmFzZSAtRGF0YWJhc2VOYW1lICIkY29uZmlnREIiIC1QYXNzcGhyYXNlICRzZWNQaHJhc2UgLURhdGFiYXNlU2VydmVyICIkZGJTZXJ2ZXIiIEBkaXN0Q2FjaGVTd2l0Y2ggQHNlcnZlclJvbGVTd2l0Y2ggLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICBJZiAoLW5vdCAkPykKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAiIC0gTm8gZXhpc3RpbmcgZmFybSBmb3VuZC5gbiAtIENyZWF0aW5nIGNvbmZpZyBkYXRhYmFzZSBgIiRjb25maWdEQmAiLi4uIgogICAgICAgICAgICAjIFdhaXRpbmcgYSBmZXcgc2Vjb25kcyBzZWVtcyB0byBoZWxwIHdpdGggdGhlIENvbm5lY3QtU1BDb25maWd1cmF0aW9uRGF0YWJhc2UgYmFyZ2luZyBpbiBvbiB0aGUgTmV3LVNQQ29uZmlndXJhdGlvbkRhdGFiYXNlIGNvbW1hbmQ7IG5vdCBzdXJlIHdoeS4uLgogICAgICAgICAgICBTdGFydC1TbGVlcCA1CiAgICAgICAgICAgIE5ldy1TUENvbmZpZ3VyYXRpb25EYXRhYmFzZSAtRGF0YWJhc2VOYW1lICIkY29uZmlnREIiIC1EYXRhYmFzZVNlcnZlciAiJGRiU2VydmVyIiAtQWRtaW5pc3RyYXRpb25Db250ZW50RGF0YWJhc2VOYW1lICIkY2VudHJhbEFkbWluQ29udGVudERCIiAtUGFzc3BocmFzZSAkc2VjUGhyYXNlIC1GYXJtQ3JlZGVudGlhbHMgJGZhcm1DcmVkZW50aWFsIEBkaXN0Q2FjaGVTd2l0Y2ggQHNlcnZlclJvbGVTd2l0Y2ggQHNlcnZlclJvbGVPcHRpb25hbFN3aXRjaAoKICAgICAgICAgICAgSWYgKC1ub3QgJD8pIHtUaHJvdyAiIC0gRXJyb3IgY3JlYXRpbmcgbmV3IGZhcm0gY29uZmlndXJhdGlvbiBkYXRhYmFzZSJ9CiAgICAgICAgICAgIEVsc2UgeyRmYXJtTWVzc2FnZSA9ICIgLSBEb25lIGNyZWF0aW5nIGNvbmZpZ3VyYXRpb24gZGF0YWJhc2UgZm9yIGZhcm0uIn0KICAgICAgICB9CiAgICAgICAgRWxzZQogICAgICAgIHsKICAgICAgICAgICAgJGZhcm1NZXNzYWdlID0gIiAtIERvbmUgam9pbmluZyBmYXJtLiIKICAgICAgICAgICAgW2Jvb2xdJHNjcmlwdDpGYXJtRXhpc3RzID0gJHRydWUKCiAgICAgICAgfQogICAgfQogICAgRWxzZQogICAgewogICAgICAgIFtib29sXSRzY3JpcHQ6RmFybUV4aXN0cyA9ICR0cnVlCiAgICAgICAgJGZhcm1NZXNzYWdlID0gIiAtICRlbnY6Q09NUFVURVJOQU1FIGlzIGFscmVhZHkgam9pbmVkIHRvIGZhcm0gb24gYCIkY29uZmlnREJgIi4iCiAgICB9CgogICAgbG9nICRmYXJtTWVzc2FnZQogICAgV3JpdGVMaW5lCn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBQU0NvbmZpZwpGdW5jdGlvbiBSdW4tUFNDb25maWcKewogICAgU3RhcnQtUHJvY2VzcyAtRmlsZVBhdGggJFBTQ29uZmlnIC1Bcmd1bWVudExpc3QgIi1jbWQgdXBncmFkZSAtaW5wbGFjZSBiMmIgLWZvcmNlIC1jbWQgYXBwbGljYXRpb25jb250ZW50IC1pbnN0YWxsIC1jbWQgaW5zdGFsbGZlYXR1cmVzIC1jbWQgc2VjdXJlcmVzb3VyY2VzIiAtTm9OZXdXaW5kb3cgLVdhaXQKfQpGdW5jdGlvbiBDaGVjay1QU0NvbmZpZwp7CiAgICAkUFNDb25maWdMb2dMb2NhdGlvbiA9ICQoKEdldC1TUERpYWdub3N0aWNDb25maWcpLkxvZ0xvY2F0aW9uKSAtcmVwbGFjZSAiJUNvbW1vblByb2dyYW1GaWxlcyUiLCIkZW52OkNvbW1vblByb2dyYW1GaWxlcyIKICAgICRQU0NvbmZpZ0xvZyA9IEdldC1DaGlsZEl0ZW0gLVBhdGggJFBTQ29uZmlnTG9nTG9jYXRpb24gfCA/IHskXy5OYW1lIC1saWtlICJQU0NEaWFnbm9zdGljcyoifSB8IFNvcnQtT2JqZWN0IC1EZXNjZW5kaW5nIC1Qcm9wZXJ0eSAiTGFzdFdyaXRlVGltZSIgfCBTZWxlY3QtT2JqZWN0IC1maXJzdCAxCiAgICBJZiAoJFBTQ29uZmlnTG9nIC1lcSAkbnVsbCkKICAgIHsKICAgICAgICBUaHJvdyAiIC0gQ291bGQgbm90IGZpbmQgUFNDb25maWcgbG9nIGZpbGUhIgogICAgfQogICAgRWxzZQogICAgewogICAgICAgICMgR2V0IGVycm9yKHMpIGZyb20gbG9nCiAgICAgICAgJFBTQ29uZmlnTGFzdEVycm9yID0gJFBTQ29uZmlnTG9nIHwgc2VsZWN0LXN0cmluZyAtU2ltcGxlTWF0Y2ggLUNhc2VTZW5zaXRpdmUgLVBhdHRlcm4gIkVSUiIgfCBTZWxlY3QtT2JqZWN0IC1MYXN0IDEKICAgICAgICByZXR1cm4gJFBTQ29uZmlnTGFzdEVycm9yCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBDb25maWd1cmUgRmFybQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogQ3JlYXRlQ2VudHJhbEFkbWluCiMgRGVzYzogU2V0dXAgQ2VudHJhbCBBZG1pbiBXZWIgU2l0ZSwgQ2hlY2sgdGhlIHRvcG9sb2d5IG9mIGFuIGV4aXN0aW5nIGZhcm0sIGFuZCBjb25maWd1cmUgdGhlIGZhcm0gYXMgcmVxdWlyZWQuCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gQ3JlYXRlQ2VudHJhbEFkbWluKFt4bWxdJHhtbGlucHV0KQp7CiAgICBHZXQtTWFqb3JWZXJzaW9uTnVtYmVyICR4bWxpbnB1dAogICAgIyBHZXQgYWxsIENlbnRyYWwgQWRtaW4gc2VydmljZSBpbnN0YW5jZXMgaW4gdGhlIGZhcm0KICAgICRjZW50cmFsQWRtaW5TZXJ2aWNlcyA9IEdldC1TUFNlcnZpY2VJbnN0YW5jZSB8ID8geyRfLkdldFR5cGUoKS5Ub1N0cmluZygpIC1lcSAiTWljcm9zb2Z0LlNoYXJlUG9pbnQuQWRtaW5pc3RyYXRpb24uU1BXZWJTZXJ2aWNlSW5zdGFuY2UiIC1hbmQgJF8uTmFtZSAtZXEgIldTU19BZG1pbmlzdHJhdGlvbiJ9CiAgICAjIEdldCB0aG9zZSBDZW50cmFsIEFkbWluIHNlcnZpY2VzIHRoYXQgYXJlIE9ubGluZQogICAgJGNlbnRyYWxBZG1pblNlcnZpY2VzT25saW5lID0gJGNlbnRyYWxBZG1pblNlcnZpY2VzIHwgPyB7JF8uU3RhdHVzIC1lcSAiT25saW5lIn0KICAgICMgR2V0IHRoZSBsb2NhbCBDZW50cmFsIEFkbWluIHNlcnZpY2UKICAgICRsb2NhbENlbnRyYWxBZG1pblNlcnZpY2UgPSAkY2VudHJhbEFkbWluU2VydmljZXMgfCA/IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXIuQWRkcmVzcyAkZW52OkNPTVBVVEVSTkFNRX0KICAgIElmICgoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkNlbnRyYWxBZG1pbiAtZXEgJHRydWUpIC1hbmQgKCRsb2NhbENlbnRyYWxBZG1pblNlcnZpY2UuU3RhdHVzIC1uZSAiT25saW5lIikpCiAgICB7CiAgICAgICAgVHJ5CiAgICAgICAgewogICAgICAgICAgICAjIENoZWNrIGlmIHRoZXJlIGlzIGFscmVhZHkgYSBDZW50cmFsIEFkbWluIHByb3Zpc2lvbmVkIGluIHRoZSBmYXJtOyBpZiBub3QsIGNyZWF0ZSBvbmUKICAgICAgICAgICAgSWYgKCEoR2V0LVNQV2ViQXBwbGljYXRpb24gLUluY2x1ZGVDZW50cmFsQWRtaW5pc3RyYXRpb24gfCA/IHskXy5Jc0FkbWluaXN0cmF0aW9uV2ViQXBwbGljYXRpb259KSAtb3IgJGNlbnRyYWxBZG1pblNlcnZpY2VzT25saW5lLkNvdW50IC1sdCAxKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIENyZWF0ZSBDZW50cmFsIEFkbWluIGZvciBmYXJtCiAgICAgICAgICAgICAgICBsb2cgIiAtIENyZWF0aW5nIENlbnRyYWwgQWRtaW4gc2l0ZS4uLiIKICAgICAgICAgICAgICAgICRjZW50cmFsQWRtaW5Qb3J0ID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5DZW50cmFsQWRtaW4uUG9ydAogICAgICAgICAgICAgICAgaWYgKCgkZW52OnNwVmVyIC1nZSAiMTYiKSAtYW5kICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkNlbnRyYWxBZG1pbi5Vc2VTU0wgLWVxICR0cnVlKSkgIyBVc2UgdXBkYXRlZCBjbWRsZXQgc3dpdGNoIGZvciBTUDIwMTYgZm9yIFNTTCBpbiBDZW50cmFsIEFkbWluCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJGNlbnRyYWxBZG1pblNTTFN3aXRjaCA9IEB7U2VjdXJlU29ja2V0c0xheWVyID0gJHRydWV9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHskY2VudHJhbEFkbWluU1NMU3dpdGNoID0gQHt9fQogICAgICAgICAgICAgICAgTmV3LVNQQ2VudHJhbEFkbWluaXN0cmF0aW9uIC1Qb3J0ICRjZW50cmFsQWRtaW5Qb3J0IC1XaW5kb3dzQXV0aFByb3ZpZGVyICJOVExNIiBAY2VudHJhbEFkbWluU1NMU3dpdGNoCiAgICAgICAgICAgICAgICBJZiAoLW5vdCAkPykge1Rocm93ICIgLSBFcnJvciBjcmVhdGluZyBjZW50cmFsIGFkbWluaXN0cmF0aW9uIGFwcGxpY2F0aW9uIn0KICAgICAgICAgICAgICAgIGxvZyAiIC0gV2FpdGluZyBmb3IgQ2VudHJhbCBBZG1pbiBzaXRlLi4uIiAKICAgICAgICAgICAgICAgIFdoaWxlICgkbG9jYWxDZW50cmFsQWRtaW5TZXJ2aWNlLlN0YXR1cyAtbmUgIk9ubGluZSIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIuIiAKICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAxCiAgICAgICAgICAgICAgICAgICAgJGNlbnRyYWxBZG1pblNlcnZpY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuU2hhcmVQb2ludC5BZG1pbmlzdHJhdGlvbi5TUFdlYlNlcnZpY2VJbnN0YW5jZSIgLWFuZCAkXy5OYW1lIC1lcSAiV1NTX0FkbWluaXN0cmF0aW9uIn0KICAgICAgICAgICAgICAgICAgICAkbG9jYWxDZW50cmFsQWRtaW5TZXJ2aWNlID0gJGNlbnRyYWxBZG1pblNlcnZpY2VzIHwgPyB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyLkFkZHJlc3MgJGVudjpDT01QVVRFUk5BTUV9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2cgJCgkbG9jYWxDZW50cmFsQWRtaW5TZXJ2aWNlLlN0YXR1cykKICAgICAgICAgICAgICAgIElmICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkNlbnRyYWxBZG1pbi5Vc2VTU0wgLWVxICR0cnVlKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gRW5hYmxpbmcgU1NMIGZvciBDZW50cmFsIEFkbWluLi4uIgogICAgICAgICAgICAgICAgICAgICRjZW50cmFsQWRtaW4gPSBHZXQtU1BXZWJBcHBsaWNhdGlvbiAtSW5jbHVkZUNlbnRyYWxBZG1pbmlzdHJhdGlvbiB8ID8geyRfLklzQWRtaW5pc3RyYXRpb25XZWJBcHBsaWNhdGlvbn0KICAgICAgICAgICAgICAgICAgICAkU1NMSG9zdEhlYWRlciA9ICRlbnY6Q09NUFVURVJOQU1FCiAgICAgICAgICAgICAgICAgICAgJFNTTFBvcnQgPSAkY2VudHJhbEFkbWluUG9ydAogICAgICAgICAgICAgICAgICAgICRTU0xTaXRlTmFtZSA9ICRjZW50cmFsQWRtaW4uRGlzcGxheU5hbWUKICAgICAgICAgICAgICAgICAgICBpZiAoJGVudjpzcFZlciAtbGUgIjE1IikgIyBVc2UgdGhlIG9sZCBwcmUtMjAxNiB3YXkgdG8gZW5hYmxlIFNTTCBmb3IgQ2VudHJhbCBBZG1pbgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgTmV3LVNQQWx0ZXJuYXRlVVJMIC1VcmwgImh0dHBzOi8vJCgkZW52OkNPTVBVVEVSTkFNRSk6JGNlbnRyYWxBZG1pblBvcnQiIC1ab25lIERlZmF1bHQgLVdlYkFwcGxpY2F0aW9uICRjZW50cmFsQWRtaW4gfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoKChHZXQtV21pT2JqZWN0IFdpbjMyX09wZXJhdGluZ1N5c3RlbSkuVmVyc2lvbiAtbGlrZSAiNi4yKiIgLW9yIChHZXQtV21pT2JqZWN0IFdpbjMyX09wZXJhdGluZ1N5c3RlbSkuVmVyc2lvbiAtbGlrZSAiNi4zKiIpIC1hbmQgKCRlbnY6c3BWZXIgLWVxICIxNCIpKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBBc3NpZ25pbmcgY2VydGlmaWNhdGUocykgaW4gYSBzZXBhcmF0ZSBQb3dlclNoZWxsIHdpbmRvdy4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAtRmlsZVBhdGggIiRQU0hPTUVccG93ZXJzaGVsbC5leGUiIC1WZXJiIFJ1bkFzIC1Bcmd1bWVudExpc3QgIi1Db21tYW5kIGAiLiAkZW52OmRwMFxBdXRvU1BJbnN0YWxsZXJGdW5jdGlvbnMucHMxYDsgQXNzaWduQ2VydCAkU1NMSG9zdEhlYWRlciAkU1NMUG9ydCAkU1NMU2l0ZU5hbWU7IFN0YXJ0LVNsZWVwIDEwYCIiIC1XYWl0CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2Uge0Fzc2lnbkNlcnQgJFNTTEhvc3RIZWFkZXIgJFNTTFBvcnQgJFNTTFNpdGVOYW1lfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICMgT3RoZXJ3aXNlIGNyZWF0ZSBhIENlbnRyYWwgQWRtaW4gc2l0ZSBsb2NhbGx5LCB3aXRoIGFuIEFBTSB0byB0aGUgZXhpc3RpbmcgQ2VudHJhbCBBZG1pbgogICAgICAgICAgICBFbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgbG9jYWwgQ2VudHJhbCBBZG1pbiBzaXRlLi4uIgogICAgICAgICAgICAgICAgTmV3LVNQQ2VudHJhbEFkbWluaXN0cmF0aW9uCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQ2F0Y2gKICAgICAgICB7CiAgICAgICAgICAgIElmICgkZXJyIC1saWtlICIqdXBkYXRlIGNvbmZsaWN0KiIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiV0FSTklORzpBIGNvbmN1cnJlbmN5IGVycm9yIG9jY3VyZWQsIHRyeWluZyBhZ2Fpbi4iCiAgICAgICAgICAgICAgICBDcmVhdGVDZW50cmFsQWRtaW4gJHhtbGlucHV0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgRWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBUaHJvdyAkXwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogQ2hlY2tGYXJtVG9wb2xvZ3kKIyBEZXNjOiBDaGVjayBpZiB0aGVyZSBpcyBhbHJlYWR5IG1vcmUgdGhhbiBvbmUgc2VydmVyIGluIHRoZSBmYXJtIChub3QgaW5jbHVkaW5nIHRoZSBkYXRhYmFzZSBzZXJ2ZXIpCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gQ2hlY2tGYXJtVG9wb2xvZ3koW3htbF0keG1saW5wdXQpCnsKICAgICRkYlByZWZpeCA9IEdldC1EQlByZWZpeCAkeG1saW5wdXQKICAgICRjb25maWdEQiA9ICRkYlByZWZpeCskeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkRhdGFiYXNlLkNvbmZpZ0RCCiAgICAkZGJTZXJ2ZXIgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkRhdGFiYXNlLkRCU2VydmVyCiAgICAkc3BGYXJtID0gR2V0LVNQRmFybSB8IFdoZXJlLU9iamVjdCB7JF8uTmFtZSAtZXEgJGNvbmZpZ0RCfQogICAgRm9yRWFjaCAoJHNydiBpbiAkc3BGYXJtLlNlcnZlcnMpIHtJZiAoKCRzcnYgLWxpa2UgIiokZGJTZXJ2ZXIqIikgLWFuZCAoJGRiU2VydmVyIC1uZSAkZW52OkNPTVBVVEVSTkFNRSkpIHtbYm9vbF0kZGJMb2NhbCA9ICRmYWxzZX19CiAgICBJZiAoKCQoJHNwRmFybS5TZXJ2ZXJzLkNvdW50KSAtZ3QgMSkgLWFuZCAoJGRiTG9jYWwgLWVxICRmYWxzZSkpIHtbYm9vbF0kc2NyaXB0OkZpcnN0U2VydmVyID0gJGZhbHNlfQogICAgRWxzZSB7W2Jvb2xdJHNjcmlwdDpGaXJzdFNlcnZlciA9ICR0cnVlfQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogV2FpdEZvckhlbHBJbnN0YWxsVG9GaW5pc2gKIyBEZXNjOiBXYWl0cyBmb3IgdGhlIEhlbHAgQ29sbGVjdGlvbiB0aW1lciBqb2IgdG8gY29tcGxldGUgYmVmb3JlIHByb2NlZWRpbmcsIGluIG9yZGVyIHRvIGF2b2lkIGNvbmN1cnJlbmN5IGVycm9ycwojIEZyb206IEFkYXB0ZWQgZnJvbSBhIGZ1bmN0aW9uIHN1Ym1pdHRlZCBieSBDb2RlUGxleCB1c2VyIGp3dGhvbXBzb245OAojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIFdhaXRGb3JIZWxwSW5zdGFsbFRvRmluaXNoCnsKICAgIGxvZyAiICAtIFdhaXRpbmcgZm9yIEhlbHAgQ29sbGVjdGlvbiBJbnN0YWxsYXRpb24gdGltZXIgam9iLi4uIiAKICAgICMgV2FpdCBmb3IgdGhlIHRpbWVyIGpvYiB0byBzdGFydAogICAgRG8KICAgIHsKICAgICAgICBsb2cgIi4iIAogICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzIDEKICAgIH0KICAgIFVudGlsCiAgICAoCiAgICAgICAgKEdldC1TUEZhcm0pLlRpbWVyU2VydmljZS5SdW5uaW5nSm9icyB8IFdoZXJlLU9iamVjdCB7JF8uSm9iRGVmaW5pdGlvbi5UeXBlTmFtZSAtZXEgIk1pY3Jvc29mdC5TaGFyZVBvaW50LkhlbHAuSGVscENvbGxlY3Rpb25JbnN0YWxsZXJKb2IifQogICAgKQogICAgbG9nICJTdGFydGVkLiIKICAgIGxvZyAiICAtIFdhaXRpbmcgZm9yIEhlbHAgQ29sbGVjdGlvbiBJbnN0YWxsYXRpb24gdGltZXIgam9iIHRvIGNvbXBsZXRlOiAiIAogICAgIyBNb25pdG9yIHRoZSB0aW1lciBqb2IgYW5kIGRpc3BsYXkgcHJvZ3Jlc3MKICAgICRoZWxwSm9iID0gKEdldC1TUEZhcm0pLlRpbWVyU2VydmljZS5SdW5uaW5nSm9icyB8IFdoZXJlLU9iamVjdCB7JF8uSm9iRGVmaW5pdGlvbi5UeXBlTmFtZSAtZXEgIk1pY3Jvc29mdC5TaGFyZVBvaW50LkhlbHAuSGVscENvbGxlY3Rpb25JbnN0YWxsZXJKb2IifSB8IFNvcnQgU3RhcnRUaW1lIHwgU2VsZWN0IC1MYXN0IDEKICAgIFdoaWxlICgkaGVscEpvYiAtbmUgJG51bGwpCiAgICB7CiAgICAgICAgbG9nICIkKCRoZWxwSm9iLlBlcmNlbnRhZ2VEb25lKSUiIAogICAgICAgIFN0YXJ0LVNsZWVwIC1NaWxsaXNlY29uZHMgMjUwCiAgICAgICAgZm9yICgkaSA9IDA7ICRpIC1sdCAzOyAkaSsrKQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIuIiAKICAgICAgICAgICAgU3RhcnQtU2xlZXAgLU1pbGxpc2Vjb25kcyAyNTAKICAgICAgICB9CiAgICAgICAgJGJhY2tzcGFjZUNvdW50ID0gKCgkaGVscEpvYi5QZXJjZW50YWdlRG9uZSkuVG9TdHJpbmcoKSkuTGVuZ3RoICsgMwogICAgICAgIGZvciAoJGNvdW50ID0gMDsgJGNvdW50IC1sZSAkYmFja3NwYWNlQ291bnQ7ICRjb3VudCsrKSB7bG9nICJgYiBgYiIgfQogICAgICAgICRoZWxwSm9iID0gKEdldC1TUEZhcm0pLlRpbWVyU2VydmljZS5SdW5uaW5nSm9icyB8IFdoZXJlLU9iamVjdCB7JF8uSm9iRGVmaW5pdGlvbi5UeXBlTmFtZSAtZXEgIk1pY3Jvc29mdC5TaGFyZVBvaW50LkhlbHAuSGVscENvbGxlY3Rpb25JbnN0YWxsZXJKb2IifSB8IFNvcnQgU3RhcnRUaW1lIHwgU2VsZWN0IC1MYXN0IDEKICAgIH0KICAgIGxvZyAiT0suIgp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogQ29uZmlndXJlRmFybQojIERlc2M6IFNldHVwIENlbnRyYWwgQWRtaW4gV2ViIFNpdGUsIENoZWNrIHRoZSB0b3BvbG9neSBvZiBhbiBleGlzdGluZyBmYXJtLCBhbmQgY29uZmlndXJlIHRoZSBmYXJtIGFzIHJlcXVpcmVkLgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIENvbmZpZ3VyZUZhcm0oW3htbF0keG1saW5wdXQpCnsKICAgIFdyaXRlTGluZQogICAgR2V0LU1ham9yVmVyc2lvbk51bWJlciAkeG1saW5wdXQKICAgIGxvZyAiIC0gQ29uZmlndXJpbmcgdGhlIFNoYXJlUG9pbnQgZmFybS9zZXJ2ZXIuLi4iCiAgICAjIEZvcmNlIGEgZnVsbCBjb25maWd1cmF0aW9uIGlmIHRoaXMgaXMgdGhlIGZpcnN0IHdlYi9hcHAgc2VydmVyIGluIHRoZSBmYXJtCiAgICBJZiAoKCEoJGZhcm1FeGlzdHMpKSAtb3IgKCRmaXJzdFNlcnZlciAtZXEgJHRydWUpIC1vciAoQ2hlY2tJZlVwZ3JhZGVOZWVkZWQgLWVxICR0cnVlKSkge1tib29sXSRkb0Z1bGxDb25maWcgPSAkdHJ1ZX0KICAgIFRyeQogICAgewogICAgICAgIElmICgkZG9GdWxsQ29uZmlnKQogICAgICAgIHsKICAgICAgICAgICAgIyBJbnN0YWxsIEhlbHAgRmlsZXMKICAgICAgICAgICAgbG9nICIgLSBJbnN0YWxsaW5nIEhlbHAgQ29sbGVjdGlvbi4uLiIKICAgICAgICAgICAgSW5zdGFsbC1TUEhlbHBDb2xsZWN0aW9uIC1BbGwKICAgICAgICAgICAgIyNXYWl0Rm9ySGVscEluc3RhbGxUb0ZpbmlzaAogICAgICAgIH0KICAgICAgICAjIFNlY3VyZSByZXNvdXJjZXMKICAgICAgICBsb2cgIiAtIFNlY3VyaW5nIFJlc291cmNlcy4uLiIKICAgICAgICBJbml0aWFsaXplLVNQUmVzb3VyY2VTZWN1cml0eQogICAgICAgICMgSW5zdGFsbCBTZXJ2aWNlcwogICAgICAgIGxvZyAiIC0gSW5zdGFsbGluZyBTZXJ2aWNlcy4uLiIKICAgICAgICBJbnN0YWxsLVNQU2VydmljZQogICAgICAgIElmICgkZG9GdWxsQ29uZmlnKQogICAgICAgIHsKICAgICAgICAgICAgIyBJbnN0YWxsIChhbGwpIGZlYXR1cmVzCiAgICAgICAgICAgIGxvZyAiIC0gSW5zdGFsbGluZyBGZWF0dXJlcy4uLiIKICAgICAgICAgICAgSW5zdGFsbC1TUEZlYXR1cmUgLUFsbEV4aXN0aW5nRmVhdHVyZXMgfCBPdXQtTnVsbAogICAgICAgIH0KICAgICAgICBDcmVhdGVDZW50cmFsQWRtaW4gJHhtbGlucHV0CiAgICAgICAgIyBVcGRhdGUgQ2VudHJhbCBBZG1pbiBicmFuZGluZyB0ZXh0IGZvciBTaGFyZVBvaW50IDIwMTMgYmFzZWQgb24gdGhlIFhNTCBpbnB1dCBFbnZpcm9ubWVudCBhdHRyaWJ1dGUKICAgICAgICBpZiAoJGVudjpzcFZlciAtZ2UgIjE1IiAtYW5kICEoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW52aXJvbm1lbnQpKSkKICAgICAgICB7CiAgICAgICAgICAgICMgRnJvbSBodHRwOi8vd3d3LndpY3RvcndpbGVuLnNlL3NoYXJlcG9pbnQtMjAxMy1jZW50cmFsLWFkbWluaXN0cmF0aW9uLXByb2R1Y3Rpdml0eS10aXA/dXRtX3NvdXJjZT1mZWVkYnVybmVyJnV0bV9tZWRpdW09ZmVlZCZ1dG1fY2FtcGFpZ249RmVlZCUzQStXaWN0b3JXaWxlbislMjhXaWN0b3IrV2lsJUMzJUE5bistK1NoYXJlUG9pbnQrTUNBJTJDK01DTSthbmQrTVZQJTI5CiAgICAgICAgICAgIGxvZyAiIC0gVXBkYXRpbmcgQ2VudHJhbCBBZG1pbiBicmFuZGluZyB0ZXh0IHRvIGAiJCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnZpcm9ubWVudClgIi4uLiIKICAgICAgICAgICAgJHN1aXRlQmFyQnJhbmRpbmdFbGVtZW50ID0gIlNoYXJlUG9pbnQgLSAiICsgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW52aXJvbm1lbnQKICAgICAgICAgICAgJGNhID0gR2V0LVNQV2ViQXBwbGljYXRpb24gLUluY2x1ZGVDZW50cmFsQWRtaW5pc3RyYXRpb24gfCA/IHskXy5Jc0FkbWluaXN0cmF0aW9uV2ViQXBwbGljYXRpb259CiAgICAgICAgICAgICRjYS5TdWl0ZUJhckJyYW5kaW5nRWxlbWVudEh0bWwgPSAiPGRpdiBjbGFzcz0nbXMtY29yZS1icmFuZGluZ1RleHQnPiRzdWl0ZUJhckJyYW5kaW5nRWxlbWVudDwvZGl2PiIKICAgICAgICAgICAgJGNhLlVwZGF0ZSgpCiAgICAgICAgfQogICAgICAgICMgSW5zdGFsbCBhcHBsaWNhdGlvbiBjb250ZW50IGlmIHRoaXMgaXMgYSBuZXcgZmFybQogICAgICAgIElmICgkZG9GdWxsQ29uZmlnKQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSBJbnN0YWxsaW5nIEFwcGxpY2F0aW9uIENvbnRlbnQuLi4iCiAgICAgICAgICAgIEluc3RhbGwtU1BBcHBsaWNhdGlvbkNvbnRlbnQKICAgICAgICB9CiAgICB9CiAgICBDYXRjaAogICAgewogICAgICAgIElmICgkZXJyIC1saWtlICIqdXBkYXRlIGNvbmZsaWN0KiIpCiAgICAgICAgewogICAgICAgICAgICBsb2cgIldBUk5JTkc6QSBjb25jdXJyZW5jeSBlcnJvciBvY2N1cmVkLCB0cnlpbmcgYWdhaW4uIgogICAgICAgICAgICBDcmVhdGVDZW50cmFsQWRtaW4gJHhtbGlucHV0CiAgICAgICAgfQogICAgICAgIEVsc2UKICAgICAgICB7CiAgICAgICAgICAgIFRocm93ICRfCiAgICAgICAgfQogICAgfQogICAgIyBDaGVjayBhZ2FpbiBpZiB3ZSBuZWVkIHRvIHJ1biBQU0NvbmZpZywgaW4gY2FzZSBhIENVIHdhcyBpbnN0YWxsZWQgb24gYSBzdWJzZXF1ZW50IHBhc3Mgb2YgQXV0b1NQSW5zdGFsbGVyCiAgICBpZiAoQ2hlY2tJZlVwZ3JhZGVOZWVkZWQgLWVxICR0cnVlKQogICAgewogICAgICAgICRyZXRyeU51bSA9IDEKICAgICAgICBSdW4tUFNDb25maWcKICAgICAgICAkUFNDb25maWdMYXN0RXJyb3IgPSBDaGVjay1QU0NvbmZpZwogICAgICAgIHdoaWxlICghKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRQU0NvbmZpZ0xhc3RFcnJvcikpIC1hbmQgJHJldHJ5TnVtIC1sZSA0KQogICAgICAgIHsKICAgICAgICAgICAgbG9nICRQU0NvbmZpZ0xhc3RFcnJvci5MaW5lCiAgICAgICAgICAgIGxvZyAiIC0gQW4gZXJyb3Igb2NjdXJyZWQgcnVubmluZyBQU0NvbmZpZywgdHJ5aW5nIGFnYWluICgkcmV0cnlOdW0pLi4uIgogICAgICAgICAgICBTdGFydC1TbGVlcCAtU2Vjb25kcyA1CiAgICAgICAgICAgICRyZXRyeU51bSArPSAxCiAgICAgICAgICAgIFJ1bi1QU0NvbmZpZwogICAgICAgICAgICAkUFNDb25maWdMYXN0RXJyb3IgPSBDaGVjay1QU0NvbmZpZwogICAgICAgIH0KICAgICAgICBJZiAoJHJldHJ5TnVtIC1nZSA1KQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSBBZnRlciAkcmV0cnlOdW0gcmV0cmllcyB0byBydW4gUFNDb25maWcsIHRyeWluZyBHVUktYmFzZWQuLi4iCiAgICAgICAgICAgIFN0YXJ0LVByb2Nlc3MgLUZpbGVQYXRoICRQU0NvbmZpZ1VJIC1Ob05ld1dpbmRvdyAtV2FpdAogICAgICAgIH0KICAgICAgICBDbGVhci1WYXJpYWJsZSAtTmFtZSBQU0NvbmZpZ0xhc3RFcnJvciAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIENsZWFyLVZhcmlhYmxlIC1OYW1lIFBTQ29uZmlnTG9nIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgQ2xlYXItVmFyaWFibGUgLU5hbWUgcmV0cnlOdW0gLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgIH0KICAgICRzcFJlZ1ZlcnNpb24gPSAoR2V0LUl0ZW0gLVBhdGggIkhLTE06XFNPRlRXQVJFXE1pY3Jvc29mdFxTaGFyZWQgVG9vbHNcV2ViIFNlcnZlciBFeHRlbnNpb25zXCRlbnY6c3BWZXIuMFwiKS5HZXRWYWx1ZSgiVmVyc2lvbiIpCiAgICBJZiAoISgkc3BSZWdWZXJzaW9uKSkKICAgIHsKICAgICAgICBsb2cgIiAtIENyZWF0aW5nIFZlcnNpb24gcmVnaXN0cnkgdmFsdWUgKHdvcmthcm91bmQgZm9yIGJ1ZyBpbiBQUy1iYXNlZCBpbnN0YWxsKSIKICAgICAgICBsb2cgICIgLSBHZXR0aW5nIHZlcnNpb24gbnVtYmVyLi4uICIKICAgICAgICAkc3BCdWlsZCA9ICIkKCQoR2V0LVNQRmFybSkuQnVpbGRWZXJzaW9uLk1ham9yKS4wLjAuJCgkKEdldC1TUEZhcm0pLkJ1aWxkVmVyc2lvbi5CdWlsZCkiCiAgICAgICAgbG9nICIkc3BCdWlsZCIKICAgICAgICBOZXctSXRlbVByb3BlcnR5IC1QYXRoICJIS0xNOlxTT0ZUV0FSRVxNaWNyb3NvZnRcU2hhcmVkIFRvb2xzXFdlYiBTZXJ2ZXIgRXh0ZW5zaW9uc1wkZW52OnNwVmVyLjBcIiAtTmFtZSBWZXJzaW9uIC1WYWx1ZSAkc3BCdWlsZCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IE91dC1OdWxsCiAgICB9CiAgICAjIFNldCBhbiBlbnZpcm9ubWVudCB2YXJpYWJsZSBmb3IgdGhlIDE0LzE1IGhpdmUgKFNoYXJlUG9pbnQgcm9vdCkKICAgIFtFbnZpcm9ubWVudF06OlNldEVudmlyb25tZW50VmFyaWFibGUoJGVudjpzcFZlciwgIiRlbnY6Q29tbW9uUHJvZ3JhbUZpbGVzXE1pY3Jvc29mdCBTaGFyZWRcV2ViIFNlcnZlciBFeHRlbnNpb25zXCRlbnY6c3BWZXIiLCAiTWFjaGluZSIpCgogICAgIyBMZXQncyBtYWtlIHN1cmUgdGhlIFNoYXJlUG9pbnQgVGltZXIgU2VydmljZSAoU1BUaW1lclY0KSBpcyBydW5uaW5nCiAgICAjIFBlciB3b3JrYXJvdW5kIGluIGh0dHA6Ly93d3cucGF1bGdyaW1sZXkuY29tLzIwMTAvMTEvc2lkZS1lZmZlY3RzLW9mLWF0dGFjaGluZy1hZGRpdGlvbmFsLmh0bWwKICAgIElmICgoR2V0LVNlcnZpY2UgU1BUaW1lclY0KS5TdGF0dXMgLWVxICJTdG9wcGVkIikKICAgIHsKICAgICAgICBsb2cgIiAtIFN0YXJ0aW5nICQoKEdldC1TZXJ2aWNlIFNQVGltZXJWNCkuRGlzcGxheU5hbWUpIFNlcnZpY2UuLi4iCiAgICAgICAgU3RhcnQtU2VydmljZSBTUFRpbWVyVjQKICAgICAgICBJZiAoISQ/KSB7VGhyb3cgIiAtIENvdWxkIG5vdCBzdGFydCBUaW1lciBzZXJ2aWNlISJ9CiAgICB9CiAgICBpZiAoKChHZXQtV21pT2JqZWN0IFdpbjMyX09wZXJhdGluZ1N5c3RlbSkuVmVyc2lvbiAtbGlrZSAiNi4yKiIgLW9yIChHZXQtV21pT2JqZWN0IFdpbjMyX09wZXJhdGluZ1N5c3RlbSkuVmVyc2lvbiAtbGlrZSAiNi4zKiIpIC1hbmQgKCRlbnY6c3BWZXIgLWVxICIxNCIpKQogICAgewogICAgICAgIGxvZyAiIC0gU3RvcHBpbmcgRGVmYXVsdCBXZWIgU2l0ZSBpbiBhIHNlcGFyYXRlIFBvd2VyU2hlbGwgd2luZG93Li4uIgogICAgICAgIFN0YXJ0LVByb2Nlc3MgLUZpbGVQYXRoICIkUFNIT01FXHBvd2Vyc2hlbGwuZXhlIiAtVmVyYiBSdW5BcyAtQXJndW1lbnRMaXN0ICItQ29tbWFuZCBgIi4gJGVudjpkcDBcQXV0b1NQSW5zdGFsbGVyRnVuY3Rpb25zLnBzMWA7IFN0b3AtRGVmYXVsdFdlYnNpdGU7IFN0YXJ0LVNsZWVwIDEwYCIiIC1XYWl0CiAgICB9CiAgICBlbHNlIHtTdG9wLURlZmF1bHRXZWJzaXRlfQogICAgbG9nICIgLSBEb25lIGluaXRpYWwgZmFybS9zZXJ2ZXIgY29uZmlnLiIKICAgIFdyaXRlTGluZQp9CgojRW5kUmVnaW9uCgojUmVnaW9uIENvbmZpZ3VyZSBMYW5ndWFnZSBQYWNrcwpGdW5jdGlvbiBDb25maWd1cmVMYW5ndWFnZVBhY2tzKFt4bWxdJHhtbGlucHV0KQp7CiAgICBHZXQtTWFqb3JWZXJzaW9uTnVtYmVyICR4bWxpbnB1dAogICAgJGluc3RhbGxlZE9mZmljZVNlcnZlckxhbmd1YWdlcyA9IChHZXQtSXRlbSAiSEtMTTpcU29mdHdhcmVcTWljcm9zb2Z0XE9mZmljZSBTZXJ2ZXJcJGVudjpzcFZlci4wXEluc3RhbGxlZExhbmd1YWdlcyIpLkdldFZhbHVlTmFtZXMoKSB8ID8geyRfIC1uZSAiIn0KICAgICRsYW5ndWFnZVBhY2tJbnN0YWxsZWQgPSAoR2V0LUl0ZW0gLVBhdGggIkhLTE06XFNPRlRXQVJFXE1pY3Jvc29mdFxTaGFyZWQgVG9vbHNcV2ViIFNlcnZlciBFeHRlbnNpb25zXCRlbnY6c3BWZXIuMFxXU1NcIikuR2V0VmFsdWUoIkxhbmd1YWdlUGFja0luc3RhbGxlZCIpCiAgICAjIElmIHRoZXJlIHdlcmUgbGFuZ3VhZ2UgcGFja3MgaW5zdGFsbGVkIHdlIG5lZWQgdG8gcnVuIHBzY29uZmlnIHRvIGNvbmZpZ3VyZSB0aGVtCiAgICBJZiAoKCRsYW5ndWFnZVBhY2tJbnN0YWxsZWQgLWVxICIxIikgLWFuZCAoJGluc3RhbGxlZE9mZmljZVNlcnZlckxhbmd1YWdlcy5Db3VudCAtZ3QgMSkpCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgbG9nICIgLSBDb25maWd1cmluZyBsYW5ndWFnZSBwYWNrcy4uLiIKICAgICAgICAjIExldCdzIHNsZWVwIGZvciBhIHdoaWxlIHRvIGxldCB0aGUgZmFybSBjb25maWcgY2F0Y2ggdXAuLi4KICAgICAgICBTdGFydC1TbGVlcCAyMAogICAgICAgICRyZXRyeU51bSArPSAxCiAgICAgICAgIyBSdW4gUFNDb25maWcuZXhlIHBlciBodHRwOi8vc2hhcmVwb2ludC5zdGFja2V4Y2hhbmdlLmNvbS9xdWVzdGlvbnMvOTkyNy9zcDIwMTAtcHNjb25maWctZmFpbHMtdHJ5aW5nLXRvLWNvbmZpZ3VyZS1mYXJtLWFmdGVyLWluc3RhbGxpbmctbGFuZ3VhZ2UtcGFja3MKICAgICAgICAjIE5vdGUgdGhpcyB3YXMgY2hhbmdlZCBmcm9tIHYydiB0byBiMmIgYXMgc3VnZ2VzdGVkIGJ5IENvZGVQbGV4IHVzZXIgand0aG9tcHNvbjk4CiAgICAgICAgUnVuLVBTQ29uZmlnCiAgICAgICAgJFBTQ29uZmlnTGFzdEVycm9yID0gQ2hlY2stUFNDb25maWcKICAgICAgICB3aGlsZSAoIShbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkUFNDb25maWdMYXN0RXJyb3IpKSAtYW5kICRyZXRyeU51bSAtbGUgNCkKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAkUFNDb25maWdMYXN0RXJyb3IuTGluZQogICAgICAgICAgICBsb2cgIiAtIEFuIGVycm9yIG9jY3VycmVkIHJ1bm5pbmcgUFNDb25maWcsIHRyeWluZyBhZ2FpbiAoJHJldHJ5TnVtKS4uLiIKICAgICAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgNQogICAgICAgICAgICAkcmV0cnlOdW0gKz0gMQogICAgICAgICAgICBSdW4tUFNDb25maWcKICAgICAgICAgICAgJFBTQ29uZmlnTGFzdEVycm9yID0gQ2hlY2stUFNDb25maWcKICAgICAgICB9CiAgICAgICAgSWYgKCRyZXRyeU51bSAtZ2UgNSkKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAiIC0gQWZ0ZXIgJHJldHJ5TnVtIHJldHJpZXMgdG8gcnVuIFBTQ29uZmlnLCB0cnlpbmcgR1VJLWJhc2VkLi4uIgogICAgICAgICAgICBTdGFydC1Qcm9jZXNzIC1GaWxlUGF0aCAkUFNDb25maWdVSSAtTm9OZXdXaW5kb3cgLVdhaXQKICAgICAgICB9CiAgICAgICAgQ2xlYXItVmFyaWFibGUgLU5hbWUgUFNDb25maWdMYXN0RXJyb3IgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICBDbGVhci1WYXJpYWJsZSAtTmFtZSBQU0NvbmZpZ0xvZyAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIENsZWFyLVZhcmlhYmxlIC1OYW1lIHJldHJ5TnVtIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBBZGQgTWFuYWdlZCBBY2NvdW50cwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRlVOQzogQWRkTWFuYWdlZEFjY291bnRzCiMgREVTQzogQWRkcyBleGlzdGluZyBhY2NvdW50cyB0byBTaGFyZVBvaW50IG1hbmFnZWQgYWNjb3VudHMgYW5kIGNyZWF0ZXMgbG9jYWwgcHJvZmlsZXMgZm9yIGVhY2gKIyBUT0RPOiBNYWtlIHRoaXMgbW9yZSByb2J1c3QsIHByb21wdCBmb3IgYmxhbmsgdmFsdWVzIGV0Yy4KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBBZGRNYW5hZ2VkQWNjb3VudHMoW3htbF0keG1saW5wdXQpCnsKICAgIFdyaXRlTGluZQogICAgbG9nICIgLSBBZGRpbmcgTWFuYWdlZCBBY2NvdW50cy4uLiIKICAgIElmICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLk1hbmFnZWRBY2NvdW50cykKICAgIHsKICAgICAgICAjIEdldCB0aGUgbWVtYmVycyBvZiB0aGUgbG9jYWwgQWRtaW5pc3RyYXRvcnMgZ3JvdXAKICAgICAgICAkYnVpbHRpbkFkbWluR3JvdXAgPSBHZXQtQWRtaW5pc3RyYXRvcnNHcm91cAogICAgICAgICRhZG1pbkdyb3VwID0gKFtBRFNJXSJXaW5OVDovLyRlbnY6Q09NUFVURVJOQU1FLyRidWlsdGluQWRtaW5Hcm91cCxncm91cCIpCiAgICAgICAgIyBUaGlzIHN5bnRheCBjb21lcyBmcm9tIFlpbmcgTGkgKGh0dHA6Ly9teWl0Zm9ydW0uY29tL2NzMi9ibG9ncy95bGk2MjgvYXJjaGl2ZS8yMDA3LzA4LzMwL3Bvd2Vyc2hlbGwtc2NyaXB0LXRvLWFkZC1yZW1vdmUtYS1kb21haW4tdXNlci10by10aGUtbG9jYWwtYWRtaW5pc3RyYXRvcnMtZ3JvdXAtb24tYS1yZW1vdGUtbWFjaGluZS5hc3B4KQogICAgICAgICRsb2NhbEFkbWlucyA9ICRhZG1pbkdyb3VwLnBzYmFzZS5pbnZva2UoIk1lbWJlcnMiKSB8IEZvckVhY2gtT2JqZWN0IHskXy5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCJOYW1lIiwgJ0dldFByb3BlcnR5JywgJG51bGwsICRfLCAkbnVsbCl9CiAgICAgICAgIyBFbnN1cmUgU2Vjb25kYXJ5IExvZ29uIHNlcnZpY2UgaXMgZW5hYmxlZCBhbmQgc3RhcnRlZAogICAgICAgIElmICghKChHZXQtU2VydmljZSAtTmFtZSBzZWNsb2dvbikuU3RhdHVzIC1lcSAiUnVubmluZyIpKQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSBFbmFibGluZyBTZWNvbmRhcnkgTG9nb24gc2VydmljZS4uLiIKICAgICAgICAgICAgU2V0LVNlcnZpY2UgLU5hbWUgc2VjbG9nb24gLVN0YXJ0dXBUeXBlIE1hbnVhbAogICAgICAgICAgICBsb2cgIiAtIFN0YXJ0aW5nIFNlY29uZGFyeSBMb2dvbiBzZXJ2aWNlLi4uIgogICAgICAgICAgICBTdGFydC1TZXJ2aWNlIC1OYW1lIHNlY2xvZ29uCiAgICAgICAgfQoKICAgICAgICBGb3JFYWNoICgkYWNjb3VudCBpbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLk1hbmFnZWRBY2NvdW50cy5NYW5hZ2VkQWNjb3VudCkKICAgICAgICB7CiAgICAgICAgICAgICR1c2VybmFtZSA9ICRhY2NvdW50LnVzZXJuYW1lCiAgICAgICAgICAgICRwYXNzd29yZCA9ICRhY2NvdW50LlBhc3N3b3JkCiAgICAgICAgICAgICRwYXNzd29yZCA9IENvbnZlcnRUby1TZWN1cmVTdHJpbmcgIiRwYXNzd29yZCIgLUFzUGxhaW50ZXh0IC1Gb3JjZQogICAgICAgICAgICAkYWxyZWFkeUFkbWluID0gJGZhbHNlCiAgICAgICAgICAgICMgVGhlIGZvbGxvd2luZyB3YXMgc3VnZ2VzdGVkIGJ5IE1hdHRoaWFzIEVpbmlnIChodHRwOi8vd3d3LmNvZGVwbGV4LmNvbS9zaXRlL3VzZXJzL3ZpZXcvbWF0ZWluNzgpCiAgICAgICAgICAgICMgQW5kIGluc3BpcmVkIGJ5IGh0dHA6Ly90b2RkLWNhcnRlci5jb20vcG9zdC8yMDEwLzA1LzAzL0dpdmUteW91ci1BcHBsaWNhdGlvbi1Qb29sLUFjY291bnRzLUEtUHJvZmlsZS5hc3B4ICYgaHR0cDovL2Jsb2cuYnJhaW5saXR0ZXIuY29tL2FyY2hpdmUvMjAxMC8wNi8wOC9ob3ctdG8tcmV2b2x2ZS1ldmVudC1pZC0xNTExLXdpbmRvd3MtY2Fubm90LWZpbmQtdGhlLWxvY2FsLXByb2ZpbGUtb24td2luZG93cy1zZXJ2ZXItMjAwOC5hc3B4CiAgICAgICAgICAgIFRyeQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkY3JlZEFjY291bnQgPSBOZXctT2JqZWN0IFN5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUHNDcmVkZW50aWFsICR1c2VybmFtZSwkcGFzc3dvcmQKICAgICAgICAgICAgICAgICRtYW5hZ2VkQWNjb3VudERvbWFpbiwkbWFuYWdlZEFjY291bnRVc2VyID0gJHVzZXJuYW1lIC1TcGxpdCAiXFwiCiAgICAgICAgICAgICAgICBsb2cgIiAgLSBBY2NvdW50IGAiJG1hbmFnZWRBY2NvdW50RG9tYWluXCRtYW5hZ2VkQWNjb3VudFVzZXJgOiIKICAgICAgICAgICAgICAgIGxvZyAiICAgLSBDcmVhdGluZyBsb2NhbCBwcm9maWxlIGZvciAkdXNlcm5hbWUuLi4iCiAgICAgICAgICAgICAgICAjIEFkZCBtYW5hZ2VkIGFjY291bnQgdG8gbG9jYWwgYWRtaW5zICh2ZXJ5KSB0ZW1wb3JhcmlseSBzbyBpdCBjYW4gbG9nIGluIGFuZCBjcmVhdGUgaXRzIHByb2ZpbGUKICAgICAgICAgICAgICAgIElmICghKCRsb2NhbEFkbWlucyAtY29udGFpbnMgJG1hbmFnZWRBY2NvdW50VXNlcikpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJGJ1aWx0aW5BZG1pbkdyb3VwID0gR2V0LUFkbWluaXN0cmF0b3JzR3JvdXAKICAgICAgICAgICAgICAgICAgICBsb2cgIiAgIC0gQWRkaW5nIHRvIGxvY2FsIEFkbWlucyAoKnRlbXBvcmFyaWx5KikuLi4iIAogICAgICAgICAgICAgICAgICAgIChbQURTSV0iV2luTlQ6Ly8kZW52OkNPTVBVVEVSTkFNRS8kYnVpbHRpbkFkbWluR3JvdXAsZ3JvdXAiKS5BZGQoIldpbk5UOi8vJG1hbmFnZWRBY2NvdW50RG9tYWluLyRtYW5hZ2VkQWNjb3VudFVzZXIiKQogICAgICAgICAgICAgICAgICAgIGxvZyAiT0suIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgRWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRhbHJlYWR5QWRtaW4gPSAkdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIyBTcGF3biBhIGNvbW1hbmQgd2luZG93IHVzaW5nIHRoZSBtYW5hZ2VkIGFjY291bnQncyBjcmVkZW50aWFscywgY3JlYXRlIHRoZSBwcm9maWxlLCBhbmQgZXhpdCBpbW1lZGlhdGVseQogICAgICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAtV29ya2luZ0RpcmVjdG9yeSAiJGVudjpTWVNURU1ST09UXFN5c3RlbTMyXCIgLUZpbGVQYXRoICJjbWQuZXhlIiAtQXJndW1lbnRMaXN0ICIvQyIgLUxvYWRVc2VyUHJvZmlsZSAtTm9OZXdXaW5kb3cgLUNyZWRlbnRpYWwgJGNyZWRBY2NvdW50CiAgICAgICAgICAgICAgICAjIFJlbW92ZSBtYW5hZ2VkIGFjY291bnQgZnJvbSBsb2NhbCBhZG1pbnMgdW5sZXNzIGl0IHdhcyBhbHJlYWR5IHRoZXJlCiAgICAgICAgICAgICAgICAkYnVpbHRpbkFkbWluR3JvdXAgPSBHZXQtQWRtaW5pc3RyYXRvcnNHcm91cAogICAgICAgICAgICAgICAgSWYgKC1ub3QgJGFscmVhZHlBZG1pbikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAgIC0gUmVtb3ZpbmcgZnJvbSBsb2NhbCBBZG1pbnMuLi4iIAogICAgICAgICAgICAgICAgICAgIChbQURTSV0iV2luTlQ6Ly8kZW52OkNPTVBVVEVSTkFNRS8kYnVpbHRpbkFkbWluR3JvdXAsZ3JvdXAiKS5SZW1vdmUoIldpbk5UOi8vJG1hbmFnZWRBY2NvdW50RG9tYWluLyRtYW5hZ2VkQWNjb3VudFVzZXIiKQogICAgICAgICAgICAgICAgICAgIGlmICghJD8pCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIi4iCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiICAgLSBDb3VsZCBub3QgcmVtb3ZlIGAiJG1hbmFnZWRBY2NvdW50RG9tYWluXCRtYW5hZ2VkQWNjb3VudFVzZXJgIiBmcm9tIGxvY2FsIEFkbWlucy4iCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiICAgLSBQbGVhc2UgcmVtb3ZlIGl0IG1hbnVhbGx5LiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7bG9nICJPSy4ifQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbG9nICIgIC0gRG9uZS4iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgQ2F0Y2gKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJF8KICAgICAgICAgICAgICAgIGxvZyAiLiIKICAgICAgICAgICAgICAgIGxvZyAiV0FSTklORzpDb3VsZCBub3QgY3JlYXRlIGxvY2FsIHVzZXIgcHJvZmlsZSBmb3IgJHVzZXJuYW1lIgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgICAgICAkbWFuYWdlZEFjY291bnQgPSBHZXQtU1BNYW5hZ2VkQWNjb3VudCB8IFdoZXJlLU9iamVjdCB7JF8uVXNlck5hbWUgLWVxICR1c2VybmFtZX0KICAgICAgICAgICAgSWYgKCRtYW5hZ2VkQWNjb3VudCAtZXEgJG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiICAgLSBSZWdpc3RlcmluZyBtYW5hZ2VkIGFjY291bnQgJHVzZXJuYW1lLi4uIgogICAgICAgICAgICAgICAgSWYgKCR1c2VybmFtZSAtZXEgJG51bGwgLW9yICRwYXNzd29yZCAtZXEgJG51bGwpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtSG9zdCAtQmFja2dyb3VuZENvbG9yIEdyYXkgLUZvcmVncm91bmRDb2xvciBEYXJrQ3lhbiAiICAgLSBQcm9tcHRpbmcgZm9yIEFjY291bnQ6ICIKICAgICAgICAgICAgICAgICAgICAkY3JlZEFjY291bnQgPSAkaG9zdC51aS5Qcm9tcHRGb3JDcmVkZW50aWFsKCJNYW5hZ2VkIEFjY291bnQiLCAiRW50ZXIgQWNjb3VudCBDcmVkZW50aWFsczoiLCAiIiwgIk5ldEJpb3NVc2VyTmFtZSIgKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgRWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRjcmVkQWNjb3VudCA9IE5ldy1PYmplY3QgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5Qc0NyZWRlbnRpYWwgJHVzZXJuYW1lLCRwYXNzd29yZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgTmV3LVNQTWFuYWdlZEFjY291bnQgLUNyZWRlbnRpYWwgJGNyZWRBY2NvdW50IHwgT3V0LU51bGwKICAgICAgICAgICAgICAgIElmICgtbm90ICQ/KSB7IFRocm93ICIgICAtIEZhaWxlZCB0byBjcmVhdGUgbWFuYWdlZCBhY2NvdW50IiB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgRWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAgIC0gTWFuYWdlZCBhY2NvdW50ICR1c2VybmFtZSBhbHJlYWR5IGV4aXN0cy4iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBsb2cgIiAtIERvbmUgQWRkaW5nIE1hbmFnZWQgQWNjb3VudHMuIgogICAgV3JpdGVMaW5lCn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBSZXR1cm4gU1AgTWFuYWdlZCBBY2NvdW50CkZ1bmN0aW9uIEdldC1TUE1hbmFnZWRBY2NvdW50WE1MKFt4bWxdJHhtbGlucHV0LCAkY29tbW9uTmFtZSkKewogICAgJG1hbmFnZWRBY2NvdW50WE1MID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5NYW5hZ2VkQWNjb3VudHMuTWFuYWdlZEFjY291bnQgfCBXaGVyZS1PYmplY3QgeyAkXy5Db21tb25OYW1lIC1lcSAkY29tbW9uTmFtZSB9CiAgICBSZXR1cm4gJG1hbmFnZWRBY2NvdW50WE1MCn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBHZXQgb3IgQ3JlYXRlIEhvc3RlZCBTZXJ2aWNlcyBBcHBsaWNhdGlvbiBQb29sCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogR2V0LUhvc3RlZFNlcnZpY2VzQXBwUG9vbAojIERlc2M6IENyZWF0ZXMgYW5kL29yIHJldHVybnMgdGhlIEhvc3RlZCBTZXJ2aWNlcyBBcHBsaWNhdGlvbiBQb29sCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIEdldC1Ib3N0ZWRTZXJ2aWNlc0FwcFBvb2wgKFt4bWxdJHhtbGlucHV0KQp7CiAgICAkc3BzZXJ2aWNlID0gR2V0LVNQTWFuYWdlZEFjY291bnRYTUwgJHhtbGlucHV0IC1Db21tb25OYW1lICJzcHNlcnZpY2UiCiAgICAjIE1hbmFnZWQgQWNjb3VudAogICAgJG1hbmFnZWRBY2NvdW50R2VuID0gR2V0LVNQTWFuYWdlZEFjY291bnQgfCBXaGVyZS1PYmplY3QgeyRfLlVzZXJOYW1lIC1lcSAkKCRzcHNlcnZpY2UudXNlcm5hbWUpfQogICAgSWYgKCRtYW5hZ2VkQWNjb3VudEdlbiAtZXEgJG51bGwpIHsgVGhyb3cgIiAtIE1hbmFnZWQgQWNjb3VudCAkKCRzcHNlcnZpY2UudXNlcm5hbWUpIG5vdCBmb3VuZCIgfQogICAgIyBBcHAgUG9vbAogICAgJGFwcGxpY2F0aW9uUG9vbCA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvblBvb2wgIlNoYXJlUG9pbnQgSG9zdGVkIFNlcnZpY2VzIiAtZWEgU2lsZW50bHlDb250aW51ZQogICAgSWYgKCRhcHBsaWNhdGlvblBvb2wgLWVxICRudWxsKQogICAgewogICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgU2hhcmVQb2ludCBIb3N0ZWQgU2VydmljZXMgQXBwbGljYXRpb24gUG9vbC4uLiIKICAgICAgICAkYXBwbGljYXRpb25Qb29sID0gTmV3LVNQU2VydmljZUFwcGxpY2F0aW9uUG9vbCAtTmFtZSAiU2hhcmVQb2ludCBIb3N0ZWQgU2VydmljZXMiIC1hY2NvdW50ICRtYW5hZ2VkQWNjb3VudEdlbgogICAgICAgIElmICgtbm90ICQ/KSB7IFRocm93ICJGYWlsZWQgdG8gY3JlYXRlIHRoZSBhcHBsaWNhdGlvbiBwb29sIiB9CiAgICB9CiAgICBSZXR1cm4gJGFwcGxpY2F0aW9uUG9vbAp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ3JlYXRlIEdlbmVyaWMgU2VydmljZSBBcHBsaWNhdGlvbgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogQ3JlYXRlR2VuZXJpY1NlcnZpY2VBcHBsaWNhdGlvbgojIERlc2M6IEdlbmVyYWwgZnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgYnJvYWQgcmFuZ2Ugb2Ygc2VydmljZSBhcHBsaWNhdGlvbnMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBDcmVhdGVHZW5lcmljU2VydmljZUFwcGxpY2F0aW9uKCkKewogICAgcGFyYW0KICAgICgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kdHJ1ZSldW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXSRzZXJ2aWNlQ29uZmlnLAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlKV1bVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddJHNlcnZpY2VJbnN0YW5jZVR5cGUsCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JHRydWUpXVtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10kc2VydmljZU5hbWUsCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JGZhbHNlKV0KICAgICAgICBbU3RyaW5nXSRzZXJ2aWNlUHJveHlOYW1lLAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlKV1bVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddJHNlcnZpY2VHZXRDbWRsZXQsCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JGZhbHNlKV1bVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddJHNlcnZpY2VQcm94eUdldENtZGxldCwKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kdHJ1ZSldW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXSRzZXJ2aWNlTmV3Q21kbGV0LAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRmYWxzZSldW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXSRzZXJ2aWNlUHJveHlOZXdDbWRsZXQsCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JGZhbHNlKV1bVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddJHNlcnZpY2VQcm94eU5ld1BhcmFtcwogICAgKQoKICAgIFRyeQogICAgewogICAgICAgICRhcHBsaWNhdGlvblBvb2wgPSBHZXQtSG9zdGVkU2VydmljZXNBcHBQb29sICR4bWxpbnB1dAogICAgICAgIGxvZyAiIC0gUHJvdmlzaW9uaW5nICRzZXJ2aWNlTmFtZS4uLiIKICAgICAgICAjIGdldCB0aGUgc2VydmljZSBpbnN0YW5jZQogICAgICAgICRzZXJ2aWNlSW5zdGFuY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICRzZXJ2aWNlSW5zdGFuY2VUeXBlfQogICAgICAgICRzZXJ2aWNlSW5zdGFuY2UgPSAkc2VydmljZUluc3RhbmNlcyB8ID8ge01hdGNoQ29tcHV0ZXJOYW1lICRfLlNlcnZlci5BZGRyZXNzICRlbnY6Q09NUFVURVJOQU1FfQogICAgICAgIElmICghJHNlcnZpY2VJbnN0YW5jZSkgeyBUaHJvdyAiIC0gRmFpbGVkIHRvIGdldCBzZXJ2aWNlIGluc3RhbmNlIC0gY2hlY2sgcHJvZHVjdCB2ZXJzaW9uIChTdGFuZGFyZCB2cy4gRW50ZXJwcmlzZSkiIH0KICAgICAgICAjIFN0YXJ0IFNlcnZpY2UgaW5zdGFuY2UKICAgICAgICBsb2cgIiAtIENoZWNraW5nICQoJHNlcnZpY2VJbnN0YW5jZS5UeXBlTmFtZSkgaW5zdGFuY2UuLi4iCiAgICAgICAgSWYgKCgkc2VydmljZUluc3RhbmNlLlN0YXR1cyAtZXEgIkRpc2FibGVkIikgLW9yICgkc2VydmljZUluc3RhbmNlLlN0YXR1cyAtbmUgIk9ubGluZSIpKQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSBTdGFydGluZyAkKCRzZXJ2aWNlSW5zdGFuY2UuVHlwZU5hbWUpIGluc3RhbmNlLi4uIgogICAgICAgICAgICAkc2VydmljZUluc3RhbmNlLlByb3Zpc2lvbigpCiAgICAgICAgICAgIElmICgtbm90ICQ/KSB7IFRocm93ICIgLSBGYWlsZWQgdG8gc3RhcnQgJCgkc2VydmljZUluc3RhbmNlLlR5cGVOYW1lKSBpbnN0YW5jZSIgfQogICAgICAgICAgICAjIFdhaXQKICAgICAgICAgICAgbG9nICIgLSBXYWl0aW5nIGZvciAkKCRzZXJ2aWNlSW5zdGFuY2UuVHlwZU5hbWUpIGluc3RhbmNlLi4uIiAKICAgICAgICAgICAgV2hpbGUgKCRzZXJ2aWNlSW5zdGFuY2UuU3RhdHVzIC1uZSAiT25saW5lIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIuIiAKICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIDEKICAgICAgICAgICAgICAgICRzZXJ2aWNlSW5zdGFuY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICRzZXJ2aWNlSW5zdGFuY2VUeXBlfQogICAgICAgICAgICAgICAgJHNlcnZpY2VJbnN0YW5jZSA9ICRzZXJ2aWNlSW5zdGFuY2VzIHwgPyB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyLkFkZHJlc3MgJGVudjpDT01QVVRFUk5BTUV9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxvZyAkKCRzZXJ2aWNlSW5zdGFuY2UuU3RhdHVzKQogICAgICAgIH0KICAgICAgICBFbHNlCiAgICAgICAgewogICAgICAgICAgICBsb2cgIiAtICQoJHNlcnZpY2VJbnN0YW5jZS5UeXBlTmFtZSkgaW5zdGFuY2UgYWxyZWFkeSBzdGFydGVkLiIKICAgICAgICB9CiAgICAgICAgIyBDaGVjayBpZiBvdXIgbmV3IGNtZGxldHMgYXJlIGF2YWlsYWJsZSB5ZXQsICBpZiBub3QsIHJlLWxvYWQgdGhlIFNoYXJlUG9pbnQgUFMgU25hcGluCiAgICAgICAgSWYgKCEoR2V0LUNvbW1hbmQgJHNlcnZpY2VHZXRDbWRsZXQgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpKQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSBSZS1pbXBvcnRpbmcgU1AgUG93ZXJTaGVsbCBTbmFwaW4gdG8gZW5hYmxlIG5ldyBjbWRsZXRzLi4uIgogICAgICAgICAgICBSZW1vdmUtUFNTbmFwaW4gTWljcm9zb2Z0LlNoYXJlUG9pbnQuUG93ZXJTaGVsbAogICAgICAgICAgICBMb2FkLVNoYXJlUG9pbnQtUG93ZXJTaGVsbAogICAgICAgIH0KICAgICAgICAkZ2V0U2VydmljZUFwcGxpY2F0aW9uID0gSW52b2tlLUV4cHJlc3Npb24gIiRzZXJ2aWNlR2V0Q21kbGV0IHwgPyB7YCRfLk5hbWUgLWVxIGAiJHNlcnZpY2VOYW1lYCJ9IgogICAgICAgIElmICgkZ2V0U2VydmljZUFwcGxpY2F0aW9uIC1lcSAkbnVsbCkKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgJHNlcnZpY2VOYW1lLi4uIgogICAgICAgICAgICAjIEEgYml0IGtsdWRnZXkgdG8gYWNjb21vZGF0ZSB0aGUgbmV3IFBlcmZvcm1hbmNlUG9pbnQgY21kbGV0IGluIFNlcnZpY2UgUGFjayAxLCBhbmQgc29tZSBuZXcgU1AyMDEwIHNlcnZpY2UgYXBwcyAoYW5kIHN0aWxsIGJlIGFibGUgdG8gdXNlIHRoZSBDcmVhdGVHZW5lcmljU2VydmljZUFwcGxpY2F0aW9uIGZ1bmN0aW9uKQogICAgICAgICAgICBJZiAoKENoZWNrRm9yMjAxMFNQMSkgLWFuZCAoJHNlcnZpY2VJbnN0YW5jZVR5cGUgLWVxICJNaWNyb3NvZnQuUGVyZm9ybWFuY2VQb2ludC5TY29yZWNhcmRzLkJJTW9uaXRvcmluZ1NlcnZpY2VJbnN0YW5jZSIpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkbmV3U2VydmljZUFwcGxpY2F0aW9uID0gSW52b2tlLUV4cHJlc3Npb24gIiRzZXJ2aWNlTmV3Q21kbGV0IC1OYW1lIGAiJHNlcnZpY2VOYW1lYCIgLUFwcGxpY2F0aW9uUG9vbCBgJGFwcGxpY2F0aW9uUG9vbCAtRGF0YWJhc2VTZXJ2ZXIgYCRkYlNlcnZlciAtRGF0YWJhc2VOYW1lIGAkc2VydmljZURCIgogICAgICAgICAgICB9CiAgICAgICAgICAgIEVsc2UgIyBKdXN0IGRvIHRoZSByZWd1bGFyIG5vbi1kYXRhYmFzZS1ib3VuZCBzZXJ2aWNlIGFwcCBjcmVhdGlvbgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkbmV3U2VydmljZUFwcGxpY2F0aW9uID0gSW52b2tlLUV4cHJlc3Npb24gIiRzZXJ2aWNlTmV3Q21kbGV0IC1OYW1lIGAiJHNlcnZpY2VOYW1lYCIgLUFwcGxpY2F0aW9uUG9vbCBgJGFwcGxpY2F0aW9uUG9vbCIKICAgICAgICAgICAgfQogICAgICAgICAgICAkZ2V0U2VydmljZUFwcGxpY2F0aW9uID0gSW52b2tlLUV4cHJlc3Npb24gIiRzZXJ2aWNlR2V0Q21kbGV0IHwgPyB7YCRfLk5hbWUgLWVxIGAiJHNlcnZpY2VOYW1lYCJ9IgogICAgICAgICAgICBpZiAoJGdldFNlcnZpY2VBcHBsaWNhdGlvbikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgLSBQcm92aXNpb25pbmcgJHNlcnZpY2VOYW1lIFByb3h5Li4uIgogICAgICAgICAgICAgICAgIyBCZWNhdXNlIGFwcGFyZW50bHkgdGhlIHRlYW1zIGRldmVsb3BpbmcgdGhlIGNtZGxldHMgZm9yIHRoZSB2YXJpb3VzIHNlcnZpY2UgYXBwcyBkaWRuJ3QgY29tbXVuaWNhdGUgd2l0aCBlYWNoIG90aGVyLCB3ZSBoYXZlIHRvIGFjY291bnQgZm9yIHRoZSBkaWZmZXJlbnQgd2F5cyBlYWNoIHByb3h5IGlzIHByb3Zpc2lvbmVkIQogICAgICAgICAgICAgICAgU3dpdGNoICgkc2VydmljZUluc3RhbmNlVHlwZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAiTWljcm9zb2Z0Lk9mZmljZS5TZXJ2ZXIuUG93ZXJQb2ludC5TaGFyZVBvaW50LkFkbWluaXN0cmF0aW9uLlBvd2VyUG9pbnRXZWJTZXJ2aWNlSW5zdGFuY2UiIHsmICRzZXJ2aWNlUHJveHlOZXdDbWRsZXQgLU5hbWUgIiRzZXJ2aWNlUHJveHlOYW1lIiAtU2VydmljZUFwcGxpY2F0aW9uICRuZXdTZXJ2aWNlQXBwbGljYXRpb24gLUFkZFRvRGVmYXVsdEdyb3VwIHwgT3V0LU51bGx9CiAgICAgICAgICAgICAgICAgICAgIk1pY3Jvc29mdC5PZmZpY2UuVmlzaW8uU2VydmVyLkFkbWluaXN0cmF0aW9uLlZpc2lvR3JhcGhpY3NTZXJ2aWNlSW5zdGFuY2UiIHsmICRzZXJ2aWNlUHJveHlOZXdDbWRsZXQgLU5hbWUgIiRzZXJ2aWNlUHJveHlOYW1lIiAtU2VydmljZUFwcGxpY2F0aW9uICRuZXdTZXJ2aWNlQXBwbGljYXRpb24uTmFtZSB8IE91dC1OdWxsfQogICAgICAgICAgICAgICAgICAgICJNaWNyb3NvZnQuUGVyZm9ybWFuY2VQb2ludC5TY29yZWNhcmRzLkJJTW9uaXRvcmluZ1NlcnZpY2VJbnN0YW5jZSIgeyYgJHNlcnZpY2VQcm94eU5ld0NtZGxldCAtTmFtZSAiJHNlcnZpY2VQcm94eU5hbWUiIC1TZXJ2aWNlQXBwbGljYXRpb24gJG5ld1NlcnZpY2VBcHBsaWNhdGlvbiAtRGVmYXVsdCB8IE91dC1OdWxsfQogICAgICAgICAgICAgICAgICAgICJNaWNyb3NvZnQuT2ZmaWNlLkV4Y2VsLlNlcnZlci5Nb3NzSG9zdC5FeGNlbFNlcnZlcldlYlNlcnZpY2VJbnN0YW5jZSIge30gIyBEbyBub3RoaW5nIGJlY2F1c2UgdGhlcmUgaXMgbm8gY21kbGV0IHRvIGNyZWF0ZSB0aGlzIHNlcnZpY2VzIHByb3h5CiAgICAgICAgICAgICAgICAgICAgIk1pY3Jvc29mdC5PZmZpY2UuQWNjZXNzLlNlcnZlci5Nb3NzSG9zdC5BY2Nlc3NTZXJ2ZXJXZWJTZXJ2aWNlSW5zdGFuY2UiIHt9ICMgRG8gbm90aGluZyBiZWNhdXNlIHRoZXJlIGlzIG5vIGNtZGxldCB0byBjcmVhdGUgdGhpcyBzZXJ2aWNlcyBwcm94eQogICAgICAgICAgICAgICAgICAgICJNaWNyb3NvZnQuT2ZmaWNlLldvcmQuU2VydmVyLlNlcnZpY2UuV29yZFNlcnZpY2VJbnN0YW5jZSIge30gIyBEbyBub3RoaW5nIGJlY2F1c2UgdGhlcmUgaXMgbm8gY21kbGV0IHRvIGNyZWF0ZSB0aGlzIHNlcnZpY2VzIHByb3h5CiAgICAJCQkJIk1pY3Jvc29mdC5TaGFyZVBvaW50LlNQU3Vic2NyaXB0aW9uU2V0dGluZ3NTZXJ2aWNlSW5zdGFuY2UiIHsmICRzZXJ2aWNlUHJveHlOZXdDbWRsZXQgLVNlcnZpY2VBcHBsaWNhdGlvbiAkbmV3U2VydmljZUFwcGxpY2F0aW9uIHwgT3V0LU51bGx9CiAgICAgICAgICAgICAgICAgICAgIk1pY3Jvc29mdC5PZmZpY2UuU2VydmVyLldvcmtNYW5hZ2VtZW50LldvcmtNYW5hZ2VtZW50U2VydmljZUluc3RhbmNlIiB7JiAkc2VydmljZVByb3h5TmV3Q21kbGV0IC1OYW1lICIkc2VydmljZVByb3h5TmFtZSIgLVNlcnZpY2VBcHBsaWNhdGlvbiAkbmV3U2VydmljZUFwcGxpY2F0aW9uIC1EZWZhdWx0UHJveHlHcm91cCB8IE91dC1OdWxsfQogICAgICAgICAgICAgICAgICAgICJNaWNyb3NvZnQuT2ZmaWNlLlRyYW5zbGF0aW9uU2VydmljZXMuVHJhbnNsYXRpb25TZXJ2aWNlSW5zdGFuY2UiIHt9ICMgRG8gbm90aGluZyBiZWNhdXNlIHRoZSBzZXJ2aWNlIGFwcCBjbWRsZXQgYXV0b21hdGljYWxseSBjcmVhdGVzIGEgcHJveHkgd2l0aCB0aGUgZGVmYXVsdCBuYW1lCiAgICAgICAgICAgICAgICAgICAgIk1pY3Jvc29mdC5PZmZpY2UuQWNjZXNzLlNlcnZpY2VzLk1vc3NIb3N0LkFjY2Vzc1NlcnZpY2VzV2ViU2VydmljZUluc3RhbmNlIiB7JiAkc2VydmljZVByb3h5TmV3Q21kbGV0IC1hcHBsaWNhdGlvbiAkbmV3U2VydmljZUFwcGxpY2F0aW9uIHwgT3V0LU51bGx9CiAgICAgICAgICAgICAgICAgICAgIk1pY3Jvc29mdC5PZmZpY2UuU2VydmVyLlBvd2VyUG9pbnQuQWRtaW5pc3RyYXRpb24uUG93ZXJQb2ludENvbnZlcnNpb25TZXJ2aWNlSW5zdGFuY2UiIHsmICRzZXJ2aWNlUHJveHlOZXdDbWRsZXQgLU5hbWUgIiRzZXJ2aWNlUHJveHlOYW1lIiAtU2VydmljZUFwcGxpY2F0aW9uICRuZXdTZXJ2aWNlQXBwbGljYXRpb24gLUFkZFRvRGVmYXVsdEdyb3VwIHwgT3V0LU51bGx9CiAgICAgICAgICAgICAgICAgICAgIk1pY3Jvc29mdC5PZmZpY2UuUHJvamVjdC5TZXJ2ZXIuQWRtaW5pc3RyYXRpb24uUHNpU2VydmljZUluc3RhbmNlIiB7fSAjIERvIG5vdGhpbmcgYmVjYXVzZSB0aGUgc2VydmljZSBhcHAgY21kbGV0IGF1dG9tYXRpY2FsbHkgY3JlYXRlcyBhIHByb3h5IHdpdGggdGhlIGRlZmF1bHQgbmFtZQogICAgICAgICAgICAgICAgICAgIERlZmF1bHQgeyYgJHNlcnZpY2VQcm94eU5ld0NtZGxldCAtTmFtZSAiJHNlcnZpY2VQcm94eU5hbWUiIC1TZXJ2aWNlQXBwbGljYXRpb24gJG5ld1NlcnZpY2VBcHBsaWNhdGlvbiB8IE91dC1OdWxsfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbG9nICIgLSBEb25lIHByb3Zpc2lvbmluZyAkc2VydmljZU5hbWUuICIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHtsb2cgIldBUk5JTkc6QW4gZXJyb3Igb2NjdXJyZWQgcHJvdmlzaW9uaW5nICRzZXJ2aWNlTmFtZSEgQ2hlY2sgdGhlIGxvZyBmb3IgYW55IGRldGFpbHMsIHRoZW4gdHJ5IGFnYWluLiJ9CiAgICAgICAgfQogICAgICAgIEVsc2UKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAiIC0gJHNlcnZpY2VOYW1lIGFscmVhZHkgY3JlYXRlZC4iCiAgICAgICAgfQogICAgfQogICAgQ2F0Y2gKICAgIHsKICAgICAgICAjIE1LOiAKICAgICAgICAjIFdyaXRlLU91dHB1dCAkXwogICAgICAgIGxvZyAiRVJST1I6ICQoJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIgogICAgICAgIFBhdXNlICJleGl0IgogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gU2FuZGJveGVkIENvZGUgU2VydmljZQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogQ29uZmlndXJlU2FuZGJveGVkQ29kZVNlcnZpY2UKIyBEZXNjOiBDb25maWd1cmVzIHRoZSBTaGFyZVBvaW50IEZvdW5kYXRpb24gU2FuZGJveGVkIChVc2VyKSBDb2RlIFNlcnZpY2UKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBDb25maWd1cmVTYW5kYm94ZWRDb2RlU2VydmljZQp7CiAgICBJZiAoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZpY2VzLlNhbmRib3hlZENvZGVTZXJ2aWNlIC1lcSAkdHJ1ZSkKICAgIHsKICAgICAgICBXcml0ZUxpbmUKICAgICAgICBsb2cgIiAtIFN0YXJ0aW5nIFNhbmRib3hlZCBDb2RlIFNlcnZpY2UiCiAgICAgICAgJHNhbmRib3hlZENvZGVTZXJ2aWNlcyA9IEdldC1TUFNlcnZpY2VJbnN0YW5jZSB8ID8geyRfLkdldFR5cGUoKS5Ub1N0cmluZygpIC1lcSAiTWljcm9zb2Z0LlNoYXJlUG9pbnQuQWRtaW5pc3RyYXRpb24uU1BVc2VyQ29kZVNlcnZpY2VJbnN0YW5jZSJ9CiAgICAgICAgJHNhbmRib3hlZENvZGVTZXJ2aWNlID0gJHNhbmRib3hlZENvZGVTZXJ2aWNlcyB8ID8ge01hdGNoQ29tcHV0ZXJOYW1lICRfLlNlcnZlci5BZGRyZXNzICRlbnY6Q09NUFVURVJOQU1FfQogICAgICAgIElmICgkc2FuZGJveGVkQ29kZVNlcnZpY2UuU3RhdHVzIC1uZSAiT25saW5lIikKICAgICAgICB7CiAgICAgICAgICAgIFRyeQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAtIFN0YXJ0aW5nIE1pY3Jvc29mdCBTaGFyZVBvaW50IEZvdW5kYXRpb24gU2FuZGJveGVkIENvZGUgU2VydmljZS4uLiIKICAgICAgICAgICAgICAgIFVwZGF0ZVByb2Nlc3NJZGVudGl0eSAkc2FuZGJveGVkQ29kZVNlcnZpY2UKICAgICAgICAgICAgICAgICRzYW5kYm94ZWRDb2RlU2VydmljZS5VcGRhdGUoKQogICAgICAgICAgICAgICAgJHNhbmRib3hlZENvZGVTZXJ2aWNlLlByb3Zpc2lvbigpCiAgICAgICAgICAgICAgICBJZiAoLW5vdCAkPykge1Rocm93ICIgLSBGYWlsZWQgdG8gc3RhcnQgU2FuZGJveGVkIENvZGUgU2VydmljZSJ9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQ2F0Y2gKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgVGhyb3cgIiAtIEFuIGVycm9yIG9jY3VycmVkIHN0YXJ0aW5nIHRoZSBNaWNyb3NvZnQgU2hhcmVQb2ludCBGb3VuZGF0aW9uIFNhbmRib3hlZCBDb2RlIFNlcnZpY2UiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgI1dhaXQKICAgICAgICAgICAgbG9nICIgLSBXYWl0aW5nIGZvciBTYW5kYm94ZWQgQ29kZSBzZXJ2aWNlLi4uIiAKICAgICAgICAgICAgV2hpbGUgKCRzYW5kYm94ZWRDb2RlU2VydmljZS5TdGF0dXMgLW5lICJPbmxpbmUiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIi4iIAogICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgMQogICAgICAgICAgICAgICAgJHNhbmRib3hlZENvZGVTZXJ2aWNlcyA9IEdldC1TUFNlcnZpY2VJbnN0YW5jZSB8ID8geyRfLkdldFR5cGUoKS5Ub1N0cmluZygpIC1lcSAiTWljcm9zb2Z0LlNoYXJlUG9pbnQuQWRtaW5pc3RyYXRpb24uU1BVc2VyQ29kZVNlcnZpY2VJbnN0YW5jZSJ9CiAgICAgICAgICAgICAgICAkc2FuZGJveGVkQ29kZVNlcnZpY2UgPSAkc2FuZGJveGVkQ29kZVNlcnZpY2VzIHwgPyB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyLkFkZHJlc3MgJGVudjpDT01QVVRFUk5BTUV9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbG9nICQoJHNhbmRib3hlZENvZGVTZXJ2aWNlLlN0YXR1cykKICAgICAgICB9CiAgICAgICAgRWxzZQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSBTYW5kYm94ZWQgQ29kZSBTZXJ2aWNlIGFscmVhZHkgc3RhcnRlZC4iCiAgICAgICAgfQogICAgICAgIFdyaXRlTGluZQogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ3JlYXRlIE1ldGFkYXRhIFNlcnZpY2UgQXBwbGljYXRpb24KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IENyZWF0ZU1ldGFkYXRhU2VydmljZUFwcAojIERlc2M6IE1hbmFnZWQgTWV0YWRhdGEgU2VydmljZSBBcHBsaWNhdGlvbgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIENyZWF0ZU1ldGFkYXRhU2VydmljZUFwcChbeG1sXSR4bWxpbnB1dCkKewogICAgSWYgKChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLk1hbmFnZWRNZXRhZGF0YVNlcnZpY2VBcHAgLWVxICR0cnVlKSAtYW5kIChHZXQtQ29tbWFuZCAtTmFtZSBOZXctU1BNZXRhZGF0YVNlcnZpY2VBcHBsaWNhdGlvbiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkpCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgVHJ5CiAgICAgICAgewogICAgICAgICAgICBHZXQtTWFqb3JWZXJzaW9uTnVtYmVyICR4bWxpbnB1dAogICAgICAgICAgICAkZGJQcmVmaXggPSBHZXQtREJQcmVmaXggJHhtbGlucHV0CiAgICAgICAgICAgICRtZXRhRGF0YURCID0gJGRiUHJlZml4KyR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLk1hbmFnZWRNZXRhZGF0YVNlcnZpY2VBcHAuRGF0YWJhc2UuTmFtZQogICAgICAgICAgICAkZGJTZXJ2ZXIgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5NYW5hZ2VkTWV0YWRhdGFTZXJ2aWNlQXBwLkRhdGFiYXNlLkRCU2VydmVyCiAgICAgICAgICAgICMgSWYgd2UgaGF2ZW4ndCBzcGVjaWZpZWQgYSBEQiBTZXJ2ZXIgdGhlbiBqdXN0IHVzZSB0aGUgZGVmYXVsdCB1c2VkIGJ5IHRoZSBGYXJtCiAgICAgICAgICAgIElmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkZGJTZXJ2ZXIpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkZGJTZXJ2ZXIgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkRhdGFiYXNlLkRCU2VydmVyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGZhcm1BY2N0ID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5BY2NvdW50LlVzZXJuYW1lCiAgICAgICAgICAgICRtZXRhZGF0YVNlcnZpY2VOYW1lID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuTWFuYWdlZE1ldGFkYXRhU2VydmljZUFwcC5OYW1lCiAgICAgICAgICAgICRtZXRhZGF0YVNlcnZpY2VQcm94eU5hbWUgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5NYW5hZ2VkTWV0YWRhdGFTZXJ2aWNlQXBwLlByb3h5TmFtZQogICAgICAgICAgICBJZigkbWV0YWRhdGFTZXJ2aWNlTmFtZSAtZXEgJG51bGwpIHskbWV0YWRhdGFTZXJ2aWNlTmFtZSA9ICJNZXRhZGF0YSBTZXJ2aWNlIEFwcGxpY2F0aW9uIn0KICAgICAgICAgICAgSWYoJG1ldGFkYXRhU2VydmljZVByb3h5TmFtZSAtZXEgJG51bGwpIHskbWV0YWRhdGFTZXJ2aWNlUHJveHlOYW1lID0gJG1ldGFkYXRhU2VydmljZU5hbWV9CiAgICAgICAgICAgIGxvZyAiIC0gUHJvdmlzaW9uaW5nIE1hbmFnZWQgTWV0YWRhdGEgU2VydmljZSBBcHBsaWNhdGlvbiIKICAgICAgICAgICAgJGFwcGxpY2F0aW9uUG9vbCA9IEdldC1Ib3N0ZWRTZXJ2aWNlc0FwcFBvb2wgJHhtbGlucHV0CiAgICAgICAgICAgIGxvZyAiIC0gU3RhcnRpbmcgTWFuYWdlZCBNZXRhZGF0YSBTZXJ2aWNlOiIKICAgICAgICAgICAgIyBHZXQgdGhlIHNlcnZpY2UgaW5zdGFuY2UKICAgICAgICAgICAgJG1ldGFkYXRhU2VydmljZUluc3RhbmNlcyA9IEdldC1TUFNlcnZpY2VJbnN0YW5jZSB8ID8geyRfLkdldFR5cGUoKS5Ub1N0cmluZygpIC1lcSAiTWljcm9zb2Z0LlNoYXJlUG9pbnQuVGF4b25vbXkuTWV0YWRhdGFXZWJTZXJ2aWNlSW5zdGFuY2UifQogICAgICAgICAgICAkbWV0YWRhdGFTZXJ2aWNlSW5zdGFuY2UgPSAkbWV0YWRhdGFTZXJ2aWNlSW5zdGFuY2VzIHwgPyB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyLkFkZHJlc3MgJGVudjpDT01QVVRFUk5BTUV9CiAgICAgICAgICAgIElmICgtbm90ICQ/KSB7IFRocm93ICIgLSBGYWlsZWQgdG8gZmluZCBNZXRhZGF0YSBzZXJ2aWNlIGluc3RhbmNlIiB9CiAgICAgICAgICAgICMgU3RhcnQgU2VydmljZSBpbnN0YW5jZXMKICAgICAgICAgICAgSWYoJG1ldGFkYXRhU2VydmljZUluc3RhbmNlLlN0YXR1cyAtZXEgIkRpc2FibGVkIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgLSBTdGFydGluZyBNZXRhZGF0YSBTZXJ2aWNlIEluc3RhbmNlLi4uIgogICAgICAgICAgICAgICAgJG1ldGFkYXRhU2VydmljZUluc3RhbmNlLlByb3Zpc2lvbigpCiAgICAgICAgICAgICAgICBJZiAoLW5vdCAkPykgeyBUaHJvdyAiIC0gRmFpbGVkIHRvIHN0YXJ0IE1ldGFkYXRhIHNlcnZpY2UgaW5zdGFuY2UiIH0KICAgICAgICAgICAgICAgICMgV2FpdAogICAgICAgICAgICAgICAgbG9nICIgLSBXYWl0aW5nIGZvciBNZXRhZGF0YSBzZXJ2aWNlLi4uIiAKICAgICAgICAgICAgICAgIFdoaWxlICgkbWV0YWRhdGFTZXJ2aWNlSW5zdGFuY2UuU3RhdHVzIC1uZSAiT25saW5lIikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIi4iIAogICAgICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIDEKICAgICAgICAgICAgICAgICAgICAkbWV0YWRhdGFTZXJ2aWNlSW5zdGFuY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuU2hhcmVQb2ludC5UYXhvbm9teS5NZXRhZGF0YVdlYlNlcnZpY2VJbnN0YW5jZSJ9CiAgICAgICAgICAgICAgICAgICAgJG1ldGFkYXRhU2VydmljZUluc3RhbmNlID0gJG1ldGFkYXRhU2VydmljZUluc3RhbmNlcyB8ID8ge01hdGNoQ29tcHV0ZXJOYW1lICRfLlNlcnZlci5BZGRyZXNzICRlbnY6Q09NUFVURVJOQU1FfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbG9nICgkbWV0YWRhdGFTZXJ2aWNlSW5zdGFuY2UuU3RhdHVzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEVsc2Uge2xvZyAiIC0gTWFuYWdlZCBNZXRhZGF0YSBTZXJ2aWNlIGFscmVhZHkgc3RhcnRlZC4ifQoKICAgICAgICAgICAgJG1ldGFEYXRhU2VydmljZUFwcCA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8ID8geyRfLkdldFR5cGUoKS5Ub1N0cmluZygpIC1lcSAiTWljcm9zb2Z0LlNoYXJlUG9pbnQuVGF4b25vbXkuTWV0YWRhdGFXZWJTZXJ2aWNlQXBwbGljYXRpb24ifQogICAgICAgICAgICAjIENyZWF0ZSBhIE1ldGFkYXRhIFNlcnZpY2UgQXBwbGljYXRpb24gaWYgd2UgZG9uJ3QgYWxyZWFkeSBoYXZlIG9uZQogICAgICAgICAgICBJZiAoJG1ldGFEYXRhU2VydmljZUFwcCAtZXEgJG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICMgQ3JlYXRlIFNlcnZpY2UgQXBwCiAgICAgICAgICAgICAgICBsb2cgIiAtIENyZWF0aW5nIE1ldGFkYXRhIFNlcnZpY2UgQXBwbGljYXRpb24uLi4iCiAgICAgICAgICAgICAgICAkbWV0YURhdGFTZXJ2aWNlQXBwID0gTmV3LVNQTWV0YWRhdGFTZXJ2aWNlQXBwbGljYXRpb24gLU5hbWUgJG1ldGFkYXRhU2VydmljZU5hbWUgLUFwcGxpY2F0aW9uUG9vbCAkYXBwbGljYXRpb25Qb29sIC1EYXRhYmFzZVNlcnZlciAkZGJTZXJ2ZXIgLURhdGFiYXNlTmFtZSAkbWV0YURhdGFEQgogICAgICAgICAgICAgICAgSWYgKC1ub3QgJD8pIHsgVGhyb3cgIiAtIEZhaWxlZCB0byBjcmVhdGUgTWV0YWRhdGEgU2VydmljZSBBcHBsaWNhdGlvbiIgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIEVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgLSBNYW5hZ2VkIE1ldGFkYXRhIFNlcnZpY2UgQXBwbGljYXRpb24gYWxyZWFkeSBwcm92aXNpb25lZC4iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG1ldGFEYXRhU2VydmljZUFwcFByb3h5ID0gR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uUHJveHkgfCA/IHskXy5HZXRUeXBlKCkuVG9TdHJpbmcoKSAtZXEgIk1pY3Jvc29mdC5TaGFyZVBvaW50LlRheG9ub215Lk1ldGFkYXRhV2ViU2VydmljZUFwcGxpY2F0aW9uUHJveHkifQogICAgICAgICAgICBpZiAoJG1ldGFEYXRhU2VydmljZUFwcFByb3h5IC1lcSAkbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIyBjcmVhdGUgcHJveHkKICAgICAgICAgICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgTWV0YWRhdGEgU2VydmljZSBBcHBsaWNhdGlvbiBQcm94eS4uLiIKICAgICAgICAgICAgICAgICRtZXRhRGF0YVNlcnZpY2VBcHBQcm94eSA9IE5ldy1TUE1ldGFkYXRhU2VydmljZUFwcGxpY2F0aW9uUHJveHkgLU5hbWUgJG1ldGFkYXRhU2VydmljZVByb3h5TmFtZSAtU2VydmljZUFwcGxpY2F0aW9uICRtZXRhRGF0YVNlcnZpY2VBcHAgLURlZmF1bHRQcm94eUdyb3VwIC1Db250ZW50VHlwZVB1c2hkb3duRW5hYmxlZCAtRGVmYXVsdEtleXdvcmRUYXhvbm9teSAtRGVmYXVsdFNpdGVDb2xsZWN0aW9uVGF4b25vbXkKICAgICAgICAgICAgICAgIElmICgtbm90ICQ/KSB7IFRocm93ICIgLSBGYWlsZWQgdG8gY3JlYXRlIE1ldGFkYXRhIFNlcnZpY2UgQXBwbGljYXRpb24gUHJveHkiIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiIC0gTWFuYWdlZCBNZXRhZGF0YSBTZXJ2aWNlIEFwcGxpY2F0aW9uIFByb3h5IGFscmVhZHkgcHJvdmlzaW9uZWQuIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkbWV0YURhdGFTZXJ2aWNlQXBwIC1vciAkbWV0YURhdGFTZXJ2aWNlQXBwUHJveHkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICMgQWRkZWQgdG8gZW5hYmxlIE1ldGFkYXRhIFNlcnZpY2UgTmF2aWdhdGlvbiBmb3IgU1AyMDEzLCBwZXIgaHR0cDovL3d3dy50b2Rka2xpbmR0LmNvbS9ibG9nL0xpc3RzL1Bvc3RzL1Bvc3QuYXNweD9JRD0zNTQKICAgICAgICAgICAgICAgIElmICgkZW52OnNwVmVyIC1lcSAiMTUiKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIElmICgkbWV0YURhdGFTZXJ2aWNlQXBwUHJveHkuUHJvcGVydGllcy5Jc0RlZmF1bHRTaXRlQ29sbGVjdGlvblRheG9ub215IC1uZSAkdHJ1ZSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gQ29uZmlndXJpbmcgTWV0YWRhdGEgU2VydmljZSBBcHBsaWNhdGlvbiBQcm94eS4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgJG1ldGFEYXRhU2VydmljZUFwcFByb3h5LlByb3BlcnRpZXMuSXNEZWZhdWx0U2l0ZUNvbGxlY3Rpb25UYXhvbm9teSA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICRtZXRhRGF0YVNlcnZpY2VBcHBQcm94eS5VcGRhdGUoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxvZyAiIC0gR3JhbnRpbmcgcmlnaHRzIHRvIE1ldGFkYXRhIFNlcnZpY2UgQXBwbGljYXRpb246IgogICAgICAgICAgICAgICAgIyBHZXQgSUQgb2YgIk1hbmFnZWQgTWV0YWRhdGEgU2VydmljZSIKICAgICAgICAgICAgICAgICRtZXRhZGF0YVNlcnZpY2VBcHBUb1NlY3VyZSA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8ID8geyRfLkdldFR5cGUoKS5Ub1N0cmluZygpIC1lcSAiTWljcm9zb2Z0LlNoYXJlUG9pbnQuVGF4b25vbXkuTWV0YWRhdGFXZWJTZXJ2aWNlQXBwbGljYXRpb24ifQogICAgICAgICAgICAgICAgJG1ldGFkYXRhU2VydmljZUFwcElEVG9TZWN1cmUgPSAkbWV0YWRhdGFTZXJ2aWNlQXBwVG9TZWN1cmUuSWQKICAgICAgICAgICAgICAgICMgQ3JlYXRlIGEgdmFyaWFibGUgdGhhdCBjb250YWlucyB0aGUgbGlzdCBvZiBhZG1pbmlzdHJhdG9ycyBmb3IgdGhlIHNlcnZpY2UgYXBwbGljYXRpb24KICAgICAgICAgICAgICAgICRtZXRhZGF0YVNlcnZpY2VBcHBTZWN1cml0eSA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvblNlY3VyaXR5ICRtZXRhZGF0YVNlcnZpY2VBcHBJRFRvU2VjdXJlCiAgICAgICAgICAgICAgICBGb3JFYWNoICgkYWNjb3VudCBpbiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5NYW5hZ2VkQWNjb3VudHMuTWFuYWdlZEFjY291bnQpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICMgQ3JlYXRlIGEgdmFyaWFibGUgdGhhdCBjb250YWlucyB0aGUgY2xhaW1zIHByaW5jaXBhbCBmb3IgdGhlIHNlcnZpY2UgYWNjb3VudHMKICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSAkKCRhY2NvdW50LnVzZXJuYW1lKS4uLiIKICAgICAgICAgICAgICAgICAgICAkYWNjb3VudFByaW5jaXBhbCA9IE5ldy1TUENsYWltc1ByaW5jaXBhbCAtSWRlbnRpdHkgJGFjY291bnQudXNlcm5hbWUgLUlkZW50aXR5VHlwZSBXaW5kb3dzU2FtQWNjb3VudE5hbWUKICAgICAgICAgICAgICAgICAgICAjIEdpdmUgcGVybWlzc2lvbnMgdG8gdGhlIGNsYWltcyBwcmluY2lwYWwgeW91IGp1c3QgY3JlYXRlZAogICAgICAgICAgICAgICAgICAgIEdyYW50LVNQT2JqZWN0U2VjdXJpdHkgJG1ldGFkYXRhU2VydmljZUFwcFNlY3VyaXR5IC1QcmluY2lwYWwgJGFjY291bnRQcmluY2lwYWwgLVJpZ2h0cyAiRnVsbCBBY2Nlc3MgdG8gVGVybSBTdG9yZSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICMgQXBwbHkgdGhlIGNoYW5nZXMgdG8gdGhlIE1ldGFkYXRhIFNlcnZpY2UgYXBwbGljYXRpb24KICAgICAgICAgICAgICAgIFNldC1TUFNlcnZpY2VBcHBsaWNhdGlvblNlY3VyaXR5ICRtZXRhZGF0YVNlcnZpY2VBcHBJRFRvU2VjdXJlIC1vYmplY3RTZWN1cml0eSAkbWV0YWRhdGFTZXJ2aWNlQXBwU2VjdXJpdHkKICAgICAgICAgICAgICAgIGxvZyAiIC0gRG9uZSBncmFudGluZyByaWdodHMuIgogICAgICAgICAgICAgICAgbG9nICIgLSBEb25lIGNyZWF0aW5nIE1hbmFnZWQgTWV0YWRhdGEgU2VydmljZSBBcHBsaWNhdGlvbi4iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQ2F0Y2gKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAkXwogICAgICAgICAgICBUaHJvdyAiIC0gRXJyb3IgcHJvdmlzaW9uaW5nIHRoZSBNYW5hZ2VkIE1ldGFkYXRhIFNlcnZpY2UgQXBwbGljYXRpb24iCiAgICAgICAgfQogICAgICAgIFdyaXRlTGluZQogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gQXNzaWduIENlcnRpZmljYXRlCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBBc3NpZ25DZXJ0CiMgRGVzYzogQ3JlYXRlIGFuZCBhc3NpZ24gU1NMIENlcnRpZmljYXRlCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gQXNzaWduQ2VydCgkU1NMSG9zdEhlYWRlciwgJFNTTFBvcnQsICRTU0xTaXRlTmFtZSkKewogICAgSW1wb3J0V2ViQWRtaW5pc3RyYXRpb24KICAgIGlmICghJGVudjpzcFZlcikge0dldC1NYWpvclZlcnNpb25OdW1iZXIgJHhtbGlucHV0fQogICAgbG9nICIgLSBBc3NpZ25pbmcgY2VydGlmaWNhdGUgdG8gc2l0ZSBgImh0dHBzOi8vJFNTTEhvc3RIZWFkZXJgOiRTU0xQb3J0YCIiCiAgICAjIElmIG91ciBTU0wgaG9zdCBoZWFkZXIgaXMgYSBGUUROIChjb250YWlucyBhIGRvdCksIGxvb2sgZm9yIGFuIGV4aXN0aW5nIHdpbGRjYXJkIGNlcnQKICAgIElmICgkU1NMSG9zdEhlYWRlciAtbGlrZSAiKi4qIikKICAgIHsKICAgICAgICAjIFJlbW92ZSB0aGUgaG9zdCBwb3J0aW9uIG9mIHRoZSBVUkwgYW5kIHRoZSBsZWFkaW5nIGRvdAogICAgICAgICRzcGxpdFNTTEhvc3RIZWFkZXIgPSAkU1NMSG9zdEhlYWRlciAgLXNwbGl0ICJcLiIKICAgICAgICAkdG9wRG9tYWluID0gJFNTTEhvc3RIZWFkZXIuU3Vic3RyaW5nKCRzcGxpdFNTTEhvc3RIZWFkZXJbMF0uTGVuZ3RoICsgMSkKICAgICAgICAjIENyZWF0ZSBhIG5ldyB3aWxkY2FyZCBjZXJ0IHNvIHdlIGNhbiBwb3RlbnRpYWxseSB1c2UgaXQgb24gb3RoZXIgc2l0ZXMgdG9vCiAgICAgICAgaWYgKCRTU0xIb3N0SGVhZGVyIC1saWtlICIqLiRlbnY6VVNFUkROU0RPTUFJTiIpCiAgICAgICAgewogICAgICAgICAgICAkY2VydENvbW1vbk5hbWUgPSAiKi4kZW52OlVTRVJETlNET01BSU4iCiAgICAgICAgfQogICAgICAgIGVsc2VpZiAoJFNTTEhvc3RIZWFkZXIgLWxpa2UgIiouJHRvcERvbWFpbiIpCiAgICAgICAgewogICAgICAgICAgICAkY2VydENvbW1vbk5hbWUgPSAiKi4kdG9wRG9tYWluIgogICAgICAgIH0KICAgICAgICBsb2cgIiAtIExvb2tpbmcgZm9yIGV4aXN0aW5nIGAiJGNlcnRDb21tb25OYW1lYCIgd2lsZGNhcmQgY2VydGlmaWNhdGUuLi4iCiAgICAgICAgJGNlcnQgPSBHZXQtQ2hpbGRJdGVtIGNlcnQ6XExvY2FsTWFjaGluZVxNeSB8ID8geyRfLlN1YmplY3QgLWVxICJDTj0kY2VydENvbW1vbk5hbWUifQogICAgfQogICAgRWxzZQogICAgewogICAgICAgICMgSnVzdCBjcmVhdGUgYSBjZXJ0IHRoYXQgbWF0Y2hlcyB0aGUgU1NMIGhvc3QgaGVhZGVyCiAgICAgICAgJGNlcnRDb21tb25OYW1lID0gJFNTTEhvc3RIZWFkZXIKICAgICAgICBsb2cgIiAtIExvb2tpbmcgZm9yIGV4aXN0aW5nIGAiJGNlcnRDb21tb25OYW1lYCIgY2VydGlmaWNhdGUuLi4iCiAgICAgICAgJGNlcnQgPSBHZXQtQ2hpbGRJdGVtIGNlcnQ6XExvY2FsTWFjaGluZVxNeSB8ID8geyRfLlN1YmplY3QgLWVxICJDTj0kY2VydENvbW1vbk5hbWUifQogICAgfQogICAgSWYgKCEkY2VydCkKICAgIHsKICAgICAgICBsb2cgIiAtIE5vbmUgZm91bmQuIgogICAgICAgICMgTUs6IHRoZSBjZXJ0aWZpY2F0ZXMgaGF2ZSBiZWVuIGNyZWF0ZWQgYW5kIHNob2xkIGJlIGF2YWlsYWJsZQogICAgICAgICMgTUs6IHN0YXJ0CiAgICAgICAgPCMgCiAgICAgICAgaWYgKEdldC1Db21tYW5kIC1OYW1lIE5ldy1TZWxmU2lnbmVkQ2VydGlmaWNhdGUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpICMgU1AyMDE2IG5vIGxvbmdlciBzZWVtcyB0byBzaGlwIHdpdGggbWFrZWNlcnQuZXhlLCBidXQgd2Ugc2hvdWxkIGJlIGFibGUgdG8gdXNlIFBvd2VyU2hlbGwgbmF0aXZlIGNvbW1hbmRzIGluc3RlYWQgaW4gV2luZG93cyAyMDEyIFIyIC8gUG93ZXJTaGVsbCA0LjAgYW5kIGhpZ2hlcgogICAgICAgIHsKICAgICAgICAgICAgIyBOZXcgUG93ZXJTaGVsbHkgd2F5IHRvIGNyZWF0ZSBzZWxmLXNpZ25lZCBjZXJ0cywgc28gd2UgZG9uJ3QgbmVlZCBtYWtlY2VydC5leGUKICAgICAgICAgICAgIyBGcm9tIGh0dHA6Ly93aW5kb3dzaXRwcm8uY29tL2Jsb2cvY3JlYXRpbmctc2VsZi1zaWduZWQtY2VydGlmaWNhdGVzLXBvd2Vyc2hlbGwKICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyBuZXcgc2VsZi1zaWduZWQgY2VydGlmaWNhdGUgJGNlcnRDb21tb25OYW1lLi4uIgogICAgICAgICAgICAkY2VydCA9IE5ldy1TZWxmU2lnbmVkQ2VydGlmaWNhdGUgLWNlcnRzdG9yZWxvY2F0aW9uIGNlcnQ6XGxvY2FsbWFjaGluZVxteSAtZG5zbmFtZSAkY2VydENvbW1vbk5hbWUKICAgICAgICAgICAgIyMkY2VydCA9IEdldC1DaGlsZEl0ZW0gY2VydDpcTG9jYWxNYWNoaW5lXE15IHwgPyB7JF8uU3ViamVjdCAtbGlrZSAiQ049YGAqJGNlcnRDb21tb25OYW1lIn0KICAgICAgICB9CiAgICAgICAgZWxzZSAjIFRyeSB0byBjcmVhdGUgdGhlIGNlcnQgdXNpbmcgbWFrZWNlcnQuZXhlIGluc3RlYWQKICAgICAgICB7CiAgICAgICAgICAgICMgR2V0IHRoZSBhY3R1YWwgbG9jYXRpb24gb2YgbWFrZWNlcnQuZXhlIGluIGNhc2Ugd2UgaW5zdGFsbGVkIFNoYXJlUG9pbnQgaW4gdGhlIG5vbi1kZWZhdWx0IGxvY2F0aW9uCiAgICAgICAgICAgICRzcEluc3RhbGxQYXRoID0gKEdldC1JdGVtIC1QYXRoICJIS0xNOlxTT0ZUV0FSRVxNaWNyb3NvZnRcT2ZmaWNlIFNlcnZlclwkZW52OnNwVmVyLjAiKS5HZXRWYWx1ZSgiSW5zdGFsbFBhdGgiKQogICAgICAgICAgICAkbWFrZUNlcnQgPSAiJHNwSW5zdGFsbFBhdGhcVG9vbHNcbWFrZWNlcnQuZXhlIgogICAgICAgICAgICBJZiAoVGVzdC1QYXRoICIkbWFrZUNlcnQiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAtIENyZWF0aW5nIG5ldyBzZWxmLXNpZ25lZCBjZXJ0aWZpY2F0ZSAkY2VydENvbW1vbk5hbWUuLi4iCiAgICAgICAgICAgICAgICBTdGFydC1Qcm9jZXNzIC1Ob05ld1dpbmRvdyAtV2FpdCAtRmlsZVBhdGggIiRtYWtlQ2VydCIgLUFyZ3VtZW50TGlzdCAiLXIgLXBlIC1uIGAiQ049JGNlcnRDb21tb25OYW1lYCIgLWVrdSAxLjMuNi4xLjUuNS43LjMuMSAtc3MgTXkgLXNyIGxvY2FsTWFjaGluZSAtc2t5IGV4Y2hhbmdlIC1zcCBgIk1pY3Jvc29mdCBSU0EgU0NoYW5uZWwgQ3J5cHRvZ3JhcGhpYyBQcm92aWRlcmAiIC1zeSAxMiIKICAgICAgICAgICAgICAgICRjZXJ0ID0gR2V0LUNoaWxkSXRlbSBjZXJ0OlxMb2NhbE1hY2hpbmVcTXkgfCA/IHskXy5TdWJqZWN0IC1saWtlICJDTj1gYCokY2VydENvbW1vbk5hbWUifQogICAgICAgICAgICAgICAgaWYgKCEkY2VydCkgeyRjZXJ0ID0gR2V0LUNoaWxkSXRlbSBjZXJ0OlxMb2NhbE1hY2hpbmVcTXkgfCA/IHskXy5TdWJqZWN0IC1lcSAiQ049JFNTTEhvc3RIZWFkZXIifX0KICAgICAgICAgICAgfQogICAgICAgICAgICBFbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiIC0gYCIkbWFrZUNlcnRgIiBub3QgZm91bmQuIgogICAgICAgICAgICAgICAgbG9nICIgLSBMb29raW5nIGZvciBhbnkgbWFjaGluZS1uYW1lZCBjZXJ0aWZpY2F0ZXMgd2UgY2FuIHVzZS4uLiIKICAgICAgICAgICAgICAgICMgU2VsZWN0IHRoZSBmaXJzdCBjZXJ0aWZpY2F0ZSB3aXRoIHRoZSBtb3N0IHJlY2VudCB2YWxpZCBkYXRlCiAgICAgICAgICAgICAgICAkY2VydCA9IEdldC1DaGlsZEl0ZW0gY2VydDpcTG9jYWxNYWNoaW5lXE15IHwgPyB7JF8uU3ViamVjdCAtbGlrZSAiKiRlbnY6Q09NUFVURVJOQU1FIn0gfCBTb3J0LU9iamVjdCBOb3RCZWZvcmUgLURlc2MgfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxCiAgICAgICAgICAgICAgICBJZiAoISRjZXJ0KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gTm9uZSBmb3VuZCwgc2tpcHBpbmcgY2VydGlmaWNhdGUgY3JlYXRpb24uIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICM+CiAgICAgICAgIyBNSzogZW5kCiAgICB9CiAgICBJZiAoJGNlcnQpCiAgICB7CiAgICAgICAgJGNlcnRTdWJqZWN0ID0gJGNlcnQuU3ViamVjdAogICAgICAgIGxvZyAiIC0gQ2VydGlmaWNhdGUgYCIkY2VydFN1YmplY3RgIiBmb3VuZC4iCgogICAgICAgICMgTUs6IHRoZSBmb2xsb3dpbmcgaGFzIGJlZW4gZG9uZSBkdXJpbmcgY2VydGlmaWNhdGVzIGltcG9ydAogICAgICAgICMgTUs6IHN0cmF0CiAgICAgICAgPCMKICAgICAgICAjIEZpeCB1cCB0aGUgY2VydCBzdWJqZWN0IG5hbWUgdG8gYSBmaWxlLWZyaWVuZGx5IGZvcm1hdAogICAgICAgICRjZXJ0U3ViamVjdE5hbWUgPSAkY2VydFN1YmplY3QuU3BsaXQoIiwiKVswXSAtcmVwbGFjZSAiQ049IiwiIiAtcmVwbGFjZSAiXCoiLCJ3aWxkY2FyZCIKICAgICAgICAkY2VydHN1YmplY3RuYW1lID0gJGNlcnRzdWJqZWN0bmFtZS5UcmltRW5kKMOi4oKsxZMvw6LigqwpIAogICAgICAgICMgRXhwb3J0IG91ciBjZXJ0aWZpY2F0ZSB0byBhIGZpbGUsIHRoZW4gaW1wb3J0IGl0IHRvIHRoZSBUcnVzdGVkIFJvb3QgQ2VydGlmaWNhdGlvbiBBdXRob3JpdGVzIHN0b3JlIHNvIHdlIGRvbid0IGdldCBuYXN0eSBicm93c2VyIHdhcm5pbmdzCiAgICAgICAgIyBUaGlzIHdpbGwgYWN0dWFsbHkgb25seSB3b3JrIGlmIHRoZSBTdWJqZWN0IGFuZCB0aGUgaG9zdCBwYXJ0IG9mIHRoZSBVUkwgYXJlIHRoZSBzYW1lCiAgICAgICAgIyBCb3Jyb3dlZCBmcm9tIGh0dHBzOi8vd3d3Lm9yY3N3ZWIuY29tL2Jsb2cvamFtZXMvcG93ZXJzaGVsbC1pbmctb24td2luZG93cy1zZXJ2ZXItaG93LXRvLWltcG9ydC1jZXJ0aWZpY2F0ZXMtdXNpbmctcG93ZXJzaGVsbC8KICAgICAgICBsb2cgIiAtIEV4cG9ydGluZyBgIiRjZXJ0U3ViamVjdGAiIHRvIGAiJGNlcnRTdWJqZWN0TmFtZS5jZXJgIi4uLiIKICAgICAgICAkY2VydC5FeHBvcnQoIkNlcnQiKSB8IFNldC1Db250ZW50IC1QYXRoICIkKChHZXQtSXRlbSAkZW52OlRFTVApLkZ1bGxOYW1lKVwkY2VydFN1YmplY3ROYW1lLmNlciIgLUVuY29kaW5nIGJ5dGUKICAgICAgICAkcGZ4ID0gTmV3LU9iamVjdCBTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5Llg1MDlDZXJ0aWZpY2F0ZXMuWDUwOUNlcnRpZmljYXRlMgogICAgICAgIGxvZyAiIC0gSW1wb3J0aW5nIGAiJGNlcnRTdWJqZWN0TmFtZS5jZXJgIiB0byBMb2NhbCBNYWNoaW5lXFJvb3QuLi4iCiAgICAgICAgJHBmeC5JbXBvcnQoIiQoKEdldC1JdGVtICRlbnY6VEVNUCkuRnVsbE5hbWUpXCRjZXJ0U3ViamVjdE5hbWUuY2VyIikKICAgICAgICAkc3RvcmUgPSBOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuWDUwOUNlcnRpZmljYXRlcy5YNTA5U3RvcmUoIlJvb3QiLCJMb2NhbE1hY2hpbmUiKQogICAgICAgICRzdG9yZS5PcGVuKCJNYXhBbGxvd2VkIikKICAgICAgICAkc3RvcmUuQWRkKCRwZngpCiAgICAgICAgJHN0b3JlLkNsb3NlKCkKICAgICAgICAjPgogICAgICAgICMgTUs6IGVuZAoKICAgICAgICBsb2cgIiAtIEFzc2lnbmluZyBjZXJ0aWZpY2F0ZSBgIiRjZXJ0U3ViamVjdGAiIHRvIFNTTC1lbmFibGVkIHNpdGUuLi4iCiAgICAgICAgI1NldC1Mb2NhdGlvbiBJSVM6XFNzbEJpbmRpbmdzIC1FcnJvckFjdGlvbiBJbnF1aXJlCiAgICAgICAgaWYgKCEoR2V0LUl0ZW0gSUlTOlxTc2xCaW5kaW5nc1wwLjAuMC4wISRTU0xQb3J0IC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSkKICAgICAgICB7CiAgICAgICAgICAgICRjZXJ0IHwgTmV3LUl0ZW0gSUlTOlxTc2xCaW5kaW5nc1wwLjAuMC4wISRTU0xQb3J0IC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgT3V0LU51bGwKICAgICAgICB9CiAgICAgICAgIyBDaGVjayBpZiB3ZSBoYXZlIHNwZWNpZmllZCBubyBob3N0IGhlYWRlcgogICAgICAgIGlmICghKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCR3ZWJBcHAuVXNlSG9zdEhlYWRlcikpIC1hbmQgJHdlYkFwcC5Vc2VIb3N0SGVhZGVyIC1lcSAkZmFsc2UpCiAgICAgICAgewogICAgICAgICAgICBTZXQtSXRlbVByb3BlcnR5IElJUzpcU2l0ZXNcJFNTTFNpdGVOYW1lIC1OYW1lIGJpbmRpbmdzIC1WYWx1ZSBAe3Byb3RvY29sPSJodHRwcyI7YmluZGluZ0luZm9ybWF0aW9uPSIqOiQoJFNTTFBvcnQpOiJ9IC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgfQogICAgICAgIGVsc2UgIyBTZXQgdGhlIGJpbmRpbmcgdG8gdGhlIGhvc3QgaGVhZGVyCiAgICAgICAgewogICAgICAgICAgICBTZXQtSXRlbVByb3BlcnR5IElJUzpcU2l0ZXNcJFNTTFNpdGVOYW1lIC1OYW1lIGJpbmRpbmdzIC1WYWx1ZSBAe3Byb3RvY29sPSJodHRwcyI7YmluZGluZ0luZm9ybWF0aW9uPSIqOiQoJFNTTFBvcnQpOiQoJFNTTEhvc3RIZWFkZXIpIn0gLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICB9CiAgICAgICAgIyMgU2V0LVdlYkJpbmRpbmcgLU5hbWUgJFNTTFNpdGVOYW1lIC1CaW5kaW5nSW5mb3JtYXRpb24gIjokKCRTU0xQb3J0KToiIC1Qcm9wZXJ0eU5hbWUgUG9ydCAtVmFsdWUgJFNTTFBvcnQgLVByb3BlcnR5TmFtZSBQcm90b2NvbCAtVmFsdWUgaHR0cHMKICAgICAgICBsb2cgIiAtIENlcnRpZmljYXRlIGhhcyBiZWVuIGFzc2lnbmVkIHRvIHNpdGUgYCJodHRwczovLyRTU0xIb3N0SGVhZGVyYDokU1NMUG9ydGAiIgogICAgfQogICAgRWxzZSB7bG9nICIgLSBObyBjZXJ0aWZpY2F0ZXMgd2VyZSBmb3VuZCwgYW5kIG5vbmUgY291bGQgYmUgY3JlYXRlZC4ifQogICAgJGNlcnQgPSAkbnVsbAp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ3JlYXRlIFdlYiBBcHBsaWNhdGlvbnMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IENyZWF0ZVdlYkFwcGxpY2F0aW9ucwojIERlc2M6IENyZWF0ZSBhbmQgIGNvbmZpZ3VyZSB0aGUgcmVxdWlyZWQgd2ViIGFwcGxpY2F0aW9ucwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIENyZWF0ZVdlYkFwcGxpY2F0aW9ucyhbeG1sXSR4bWxpbnB1dCkKewogICAgV3JpdGVMaW5lCiAgICBJZiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uV2ViQXBwbGljYXRpb25zKQogICAgewogICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgd2ViIGFwcGxpY2F0aW9ucy4uLiIKICAgICAgICBGb3JFYWNoICgkd2ViQXBwIGluICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLldlYkFwcGxpY2F0aW9ucy5XZWJBcHBsaWNhdGlvbikKICAgICAgICB7CiAgICAgICAgICAgIENyZWF0ZVdlYkFwcCAkd2ViQXBwCiAgICAgICAgICAgIENvbmZpZ3VyZU9ubGluZVdlYlBhcnRDYXRhbG9nICR3ZWJBcHAKICAgICAgICAgICAgQWRkLUxvY2FsSW50cmFuZXRVUkwgJHdlYkFwcC5VUkwKICAgICAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgfQogICAgICAgICMgVXBkYXRlZCBzbyB0aGF0IHdlIGRvbid0IGFkZCBVUkxzIHRvIHRoZSBsb2NhbCBob3N0cyBmaWxlIG9mIGEgc2VydmVyIHRoYXQncyBub3QgYmVlbiBzcGVjaWZpZWQgdG8gcnVuIHRoZSBGb3VuZGF0aW9uIFdlYiBBcHBsaWNhdGlvbiBzZXJ2aWNlLCBvciB0aGUgU2VhcmNoIE1pblJvbGUKICAgICAgICBJZiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uV2ViQXBwbGljYXRpb25zLkFkZFVSTHNUb0hPU1RTIC1lcSAkdHJ1ZSAtYW5kICEoU2hvdWxkSVByb3Zpc2lvbiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2ZXJSb2xlcy5TZWFyY2gpKSAtYW5kICEoKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuU2VsZWN0U2luZ2xlTm9kZSgiRm91bmRhdGlvbldlYkFwcGxpY2F0aW9uIikpIC1hbmQgIShTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuRm91bmRhdGlvbldlYkFwcGxpY2F0aW9uIC1lcSAkdHJ1ZSkpKQogICAgICAgIHtBZGRUb0hPU1RTfQogICAgfQogICAgV3JpdGVMaW5lCn0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IENyZWF0ZVdlYkFwcAojIERlc2M6IENyZWF0ZSB0aGUgd2ViIGFwcGxpY2F0aW9uCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gQ3JlYXRlV2ViQXBwKFtTeXN0ZW0uWG1sLlhtbEVsZW1lbnRdJHdlYkFwcCkKewogICAgR2V0LU1ham9yVmVyc2lvbk51bWJlciAkeG1saW5wdXQKICAgICMgTG9vayBmb3IgYSBtYW5hZ2VkIGFjY291bnQgdGhhdCBtYXRjaGVzIHRoZSB3ZWIgYXBwIHR5cGUsIGUuZy4gIlBvcnRhbCIgb3IgIk15U2l0ZUhvc3QiCiAgICAkd2ViQXBwUG9vbEFjY291bnQgPSBHZXQtU1BNYW5hZ2VkQWNjb3VudFhNTCAkeG1saW5wdXQgJHdlYkFwcC5UeXBlCiAgICAjIElmIG5vIG1hbmFnZWQgYWNjb3VudCBpcyBmb3VuZCBtYXRjaGluZyB0aGUgd2ViIGFwcCB0eXBlLCBqdXN0IHVzZSB0aGUgUG9ydGFsIG1hbmFnZWQgYWNjb3VudAogICAgaWYgKCEkd2ViQXBwUG9vbEFjY291bnQpCiAgICB7CiAgICAgICAgJHdlYkFwcFBvb2xBY2NvdW50ID0gR2V0LVNQTWFuYWdlZEFjY291bnRYTUwgJHhtbGlucHV0IC1Db21tb25OYW1lICJQb3J0YWwiCiAgICAgICAgaWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCR3ZWJBcHBQb29sQWNjb3VudC51c2VybmFtZSkpIHt0aHJvdyAiIC0gYCJQb3J0YWxgIiBtYW5hZ2VkIGFjY291bnQgbm90IGZvdW5kISBDaGVjayB5b3VyIFhNTC4ifQogICAgfQogICAgJHdlYkFwcE5hbWUgPSAkd2ViQXBwLm5hbWUKICAgICRhcHBQb29sID0gJHdlYkFwcC5hcHBsaWNhdGlvblBvb2wKICAgICRkYlByZWZpeCA9IEdldC1EQlByZWZpeCAkeG1saW5wdXQKICAgICRkYXRhYmFzZSA9ICRkYlByZWZpeCskd2ViQXBwLkRhdGFiYXNlLk5hbWUKICAgICRkYlNlcnZlciA9ICR3ZWJBcHAuRGF0YWJhc2UuREJTZXJ2ZXIKICAgICMgQ2hlY2sgZm9yIGFuIGV4aXN0aW5nIEFwcCBQb29sCiAgICAkZXhpc3RpbmdXZWJBcHAgPSBHZXQtU1BXZWJBcHBsaWNhdGlvbiB8IFdoZXJlLU9iamVjdCB7ICgkXy5BcHBsaWNhdGlvblBvb2wpLk5hbWUgLWVxICRhcHBQb29sIH0KICAgICRhcHBQb29sRXhpc3RzID0gKCRleGlzdGluZ1dlYkFwcCAtbmUgJG51bGwpCiAgICAjIElmIHdlIGhhdmVuJ3Qgc3BlY2lmaWVkIGEgREIgU2VydmVyIHRoZW4ganVzdCB1c2UgdGhlIGRlZmF1bHQgdXNlZCBieSB0aGUgRmFybQogICAgSWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRkYlNlcnZlcikpCiAgICB7CiAgICAgICAgJGRiU2VydmVyID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5EYXRhYmFzZS5EQlNlcnZlcgogICAgfQogICAgJHVybCA9ICgkd2ViQXBwLnVybCkuVHJpbUVuZCgiLyIpCiAgICAkcG9ydCA9ICR3ZWJBcHAucG9ydAogICAgJHVzZVNTTCA9ICRmYWxzZQogICAgJGluc3RhbGxlZE9mZmljZVNlcnZlckxhbmd1YWdlcyA9IChHZXQtSXRlbSAiSEtMTTpcU29mdHdhcmVcTWljcm9zb2Z0XE9mZmljZSBTZXJ2ZXJcJGVudjpzcFZlci4wXEluc3RhbGxlZExhbmd1YWdlcyIpLkdldFZhbHVlTmFtZXMoKSB8ID8geyRfIC1uZSAiIn0KICAgICMgU3RyaXAgb3V0IGFueSBwcm90b2NvbCB2YWx1ZQogICAgSWYgKCR1cmwgLWxpa2UgImh0dHBzOi8vKiIpIHskdXNlU1NMID0gJHRydWV9CiAgICAkaG9zdEhlYWRlciA9ICR1cmwgLXJlcGxhY2UgImh0dHA6Ly8iLCIiIC1yZXBsYWNlICJodHRwczovLyIsIiIKICAgIGlmICgoKEdldC1XbWlPYmplY3QgV2luMzJfT3BlcmF0aW5nU3lzdGVtKS5WZXJzaW9uIC1saWtlICI2LjIqIiAtb3IgKEdldC1XbWlPYmplY3QgV2luMzJfT3BlcmF0aW5nU3lzdGVtKS5WZXJzaW9uIC1saWtlICI2LjMqIikgLWFuZCAoJGVudjpzcFZlciAtZXEgIjE0IikpCiAgICB7CiAgICAgICAgbG9nICIgLSBTa2lwcGluZyBzZXR0aW5nIHRoZSB3ZWIgYXBwIGRpcmVjdG9yeSBwYXRoIG5hbWUgKG5vdCBjdXJyZW50bHkgd29ya2luZyBvbiBXaW5kb3dzIDIwMTIgdy9TUDIwMTApLi4uIgogICAgICAgICRwYXRoU3dpdGNoID0gQHt9CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgIyBTZXQgdGhlIGRpcmVjdG9yeSBwYXRoIGZvciB0aGUgd2ViIGFwcCB0byBzb21ldGhpbmcgYSBiaXQgbW9yZSBmcmllbmRseQogICAgICAgIEltcG9ydFdlYkFkbWluaXN0cmF0aW9uCiAgICAgICAgIyBHZXQgdGhlIGRlZmF1bHQgcm9vdCBsb2NhdGlvbiBmb3Igd2ViIGFwcHMgKGZpcnN0IGZyb20gSUlTIGl0c2VsZiwgdGhlbiBmYWlsaW5nIHRoYXQsIGZyb20gdGhlIHJlZ2lzdHJ5KQogICAgICAgICRpaXNXZWJEaXIgPSAoR2V0LUl0ZW1Qcm9wZXJ0eSAiSUlTOlxTaXRlc1xEZWZhdWx0IFdlYiBTaXRlXCIgLU5hbWUgcGh5c2ljYWxQYXRoIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSAtcmVwbGFjZSAoIiVTeXN0ZW1Ecml2ZSUiLCIkZW52OlN5c3RlbURyaXZlIikKICAgICAgICBpZiAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJGlpc1dlYkRpcikpCiAgICAgICAgewogICAgICAgICAgICAkaWlzV2ViRGlyID0gKEdldC1JdGVtIC1QYXRoIEhLTE06XFNPRlRXQVJFXE1pY3Jvc29mdFxJbmV0U3RwKS5HZXRWYWx1ZSgiUGF0aFdXV1Jvb3QiKSAtcmVwbGFjZSAoIiVTeXN0ZW1Ecml2ZSUiLCIkZW52OlN5c3RlbURyaXZlIikKICAgICAgICB9CiAgICAgICAgaWYgKCEoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJGlpc1dlYkRpcikpKQogICAgICAgIHsKICAgICAgICAgICAgJHBhdGhTd2l0Y2ggPSBAe1BhdGggPSAiJGlpc1dlYkRpclx3c3NcVmlydHVhbERpcmVjdG9yaWVzXCR3ZWJBcHBOYW1lLSRwb3J0In0KICAgICAgICB9CiAgICAgICAgZWxzZSB7JHBhdGhTd2l0Y2ggPSBAe319CiAgICB9CiAgICAjIE9ubHkgc2V0ICRob3N0SGVhZGVyU3dpdGNoIHRvIGJsYW5rIGlmIHRoZSBVc2VIb3N0SGVhZGVyIHZhbHVlIGV4aXN0cyBoYXMgZXhwbGljaXRseSBiZWVuIHNldCB0byBmYWxzZQogICAgaWYgKCEoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJHdlYkFwcC5Vc2VIb3N0SGVhZGVyKSkgLWFuZCAkd2ViQXBwLlVzZUhvc3RIZWFkZXIgLWVxICRmYWxzZSkKICAgIHsKICAgICAgICAkaG9zdEhlYWRlclN3aXRjaCA9IEB7fQogICAgfQogICAgZWxzZSB7JGhvc3RIZWFkZXJTd2l0Y2ggPSBAe0hvc3RIZWFkZXIgPSAkaG9zdEhlYWRlcn19CiAgICBpZiAoIShbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkd2ViQXBwLnVzZUNsYWltcykpIC1hbmQgJHdlYkFwcC51c2VDbGFpbXMgLWVxICRmYWxzZSkKICAgIHsKICAgICAgICAjIENyZWF0ZSB0aGUgd2ViIGFwcCB1c2luZyBDbGFzc2ljIG1vZGUgYXV0aGVudGljYXRpb24KICAgICAgICAkYXV0aFByb3ZpZGVyU3dpdGNoID0gQHt9CiAgICB9CiAgICBlbHNlICMgQ29uZmlndXJlIG5ldyB3ZWIgYXBwIHRvIHVzZSBDbGFpbXMtYmFzZWQgYXV0aGVudGljYXRpb24KICAgIHsKICAgICAgICBJZiAoJCgkd2ViQXBwLnVzZUJhc2ljQXV0aGVudGljYXRpb24pIC1lcSAkdHJ1ZSkKICAgICAgICB7CiAgICAgICAgICAgICRhdXRoUHJvdmlkZXIgPSBOZXctU1BBdXRoZW50aWNhdGlvblByb3ZpZGVyIC1Vc2VXaW5kb3dzSW50ZWdyYXRlZEF1dGhlbnRpY2F0aW9uIC1Vc2VCYXNpY0F1dGhlbnRpY2F0aW9uCiAgICAgICAgfQogICAgICAgIEVsc2UKICAgICAgICB7CiAgICAgICAgICAgICRhdXRoUHJvdmlkZXIgPSBOZXctU1BBdXRoZW50aWNhdGlvblByb3ZpZGVyIC1Vc2VXaW5kb3dzSW50ZWdyYXRlZEF1dGhlbnRpY2F0aW9uCiAgICAgICAgfQogICAgICAgICRhdXRoUHJvdmlkZXJTd2l0Y2ggPSBAe0F1dGhlbnRpY2F0aW9uUHJvdmlkZXIgPSAkYXV0aFByb3ZpZGVyfQogICAgICAgIElmICgoR3dtaSBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0pLlZlcnNpb24gLWxpa2UgIjYuMCoiKSAjIElmIHdlIGFyZSBydW5uaW5nIFdpbjIwMDggKG5vbi1SMiksIHdlIG1heSBuZWVkIHRoZSBjbGFpbXMgaG90Zml4CiAgICAgICAgewogICAgICAgICAgICBbYm9vbF0kY2xhaW1zSG90Zml4UmVxdWlyZWQgPSAkdHJ1ZQogICAgICAgICAgICBsb2cgIiAtIFdlYiBBcHBsaWNhdGlvbnMgdXNpbmcgQ2xhaW1zIGF1dGhlbnRpY2F0aW9uIHJlcXVpcmUgYW4gdXBkYXRlIgogICAgICAgICAgICBsb2cgIiAtIEFwcGx5IHRoZSBodHRwOi8vZ28ubWljcm9zb2Z0LmNvbS9md2xpbmsvP0xpbmtJRD0xODQ3MDUgdXBkYXRlIGFmdGVyIHNldHVwLiIKICAgICAgICB9CiAgICB9CiAgICBpZiAoJGFwcFBvb2xFeGlzdHMpCiAgICB7CiAgICAgICAgJGFwcFBvb2xBY2NvdW50U3dpdGNoID0gQHt9CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgJGFwcFBvb2xBY2NvdW50U3dpdGNoID0gQHtBcHBsaWNhdGlvblBvb2xBY2NvdW50ID0gJCgkd2ViQXBwUG9vbEFjY291bnQudXNlcm5hbWUpfQogICAgfQogICAgJGdldFNQV2ViQXBwbGljYXRpb24gPSBHZXQtU1BXZWJBcHBsaWNhdGlvbiB8IFdoZXJlLU9iamVjdCB7JF8uRGlzcGxheU5hbWUgLWVxICR3ZWJBcHBOYW1lfQogICAgSWYgKCRnZXRTUFdlYkFwcGxpY2F0aW9uIC1lcSAkbnVsbCkKICAgIHsKICAgICAgICBsb2cgIiAtIENyZWF0aW5nIFdlYiBBcHAgYCIkd2ViQXBwTmFtZWAiIgogICAgICAgIE5ldy1TUFdlYkFwcGxpY2F0aW9uIC1OYW1lICR3ZWJBcHBOYW1lIC1BcHBsaWNhdGlvblBvb2wgJGFwcFBvb2wgLURhdGFiYXNlU2VydmVyICRkYlNlcnZlciAtRGF0YWJhc2VOYW1lICRkYXRhYmFzZSAtVXJsICR1cmwgLVBvcnQgJHBvcnQgLVNlY3VyZVNvY2tldHNMYXllcjokdXNlU1NMIEBob3N0SGVhZGVyU3dpdGNoIEBhcHBQb29sQWNjb3VudFN3aXRjaCBAYXV0aFByb3ZpZGVyU3dpdGNoIEBwYXRoU3dpdGNoIHwgT3V0LU51bGwKICAgICAgICBJZiAoLW5vdCAkPykgeyBUaHJvdyAiIC0gRmFpbGVkIHRvIGNyZWF0ZSB3ZWIgYXBwbGljYXRpb24iIH0KICAgIH0KICAgIEVsc2Uge2xvZyAiIC0gV2ViIGFwcCBgIiR3ZWJBcHBOYW1lYCIgYWxyZWFkeSBwcm92aXNpb25lZC4ifQogICAgU2V0dXBNYW5hZ2VkUGF0aHMgJHdlYkFwcAogICAgSWYgKCR1c2VTU0wpCiAgICB7CiAgICAgICAgJFNTTEhvc3RIZWFkZXIgPSAkaG9zdEhlYWRlcgogICAgICAgICRTU0xQb3J0ID0gJHBvcnQKICAgICAgICAkU1NMU2l0ZU5hbWUgPSAkd2ViQXBwTmFtZQogICAgICAgIGlmICgoKEdldC1XbWlPYmplY3QgV2luMzJfT3BlcmF0aW5nU3lzdGVtKS5WZXJzaW9uIC1saWtlICI2LjIqIiAtb3IgKEdldC1XbWlPYmplY3QgV2luMzJfT3BlcmF0aW5nU3lzdGVtKS5WZXJzaW9uIC1saWtlICI2LjMqIikgLWFuZCAoJGVudjpzcFZlciAtZXEgIjE0IikpCiAgICAgICAgewogICAgICAgICAgICBsb2cgIiAtIEFzc2lnbmluZyBjZXJ0aWZpY2F0ZShzKSBpbiBhIHNlcGFyYXRlIFBvd2VyU2hlbGwgd2luZG93Li4uIgogICAgICAgICAgICBTdGFydC1Qcm9jZXNzIC1GaWxlUGF0aCAiJFBTSE9NRVxwb3dlcnNoZWxsLmV4ZSIgLVZlcmIgUnVuQXMgLUFyZ3VtZW50TGlzdCAiLUNvbW1hbmQgYCIuICRlbnY6ZHAwXEF1dG9TUEluc3RhbGxlckZ1bmN0aW9ucy5wczFgOyBBc3NpZ25DZXJ0ICRTU0xIb3N0SGVhZGVyICRTU0xQb3J0ICRTU0xTaXRlTmFtZTsgU3RhcnQtU2xlZXAgMTBgIiIgLVdhaXQKICAgICAgICB9CiAgICAgICAgZWxzZSB7QXNzaWduQ2VydCAkU1NMSG9zdEhlYWRlciAkU1NMUG9ydCAkU1NMU2l0ZU5hbWV9CiAgICB9CgogICAgIyBJZiB3ZSBhcmUgcHJvdmlzaW9uaW5nIGFueSBPZmZpY2UgV2ViIEFwcHMsIFZpc2lvLCBFeGNlbCwgQWNjZXNzIG9yIFBlcmZvcm1hbmNlUG9pbnQgc2VydmljZXMsIHdlIG5lZWQgdG8gZ3JhbnQgdGhlIGdlbmVyaWMgYXBwIHBvb2wgYWNjb3VudCBhY2Nlc3MgdG8gdGhlIG5ld2x5LWNyZWF0ZWQgY29udGVudCBkYXRhYmFzZQogICAgIyBQZXIgaHR0cDovL3RlY2huZXQubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2ZmODI5ODM3LmFzcHggYW5kIGh0dHA6Ly9hdXRvc3BpbnN0YWxsZXIuY29kZXBsZXguY29tL3dvcmtpdGVtLzE2MjI0ICh0aGFua3Mgb2NlYW5mbHkhKQogICAgSWYgKChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLk9mZmljZVdlYkFwcHMuRXhjZWxTZXJ2aWNlIC1lcSAkdHJ1ZSkgLW9yIGAKICAgICAgICAoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5PZmZpY2VXZWJBcHBzLlBvd2VyUG9pbnRTZXJ2aWNlIC1lcSAkdHJ1ZSkgLW9yIGAKICAgICAgICAoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5PZmZpY2VXZWJBcHBzLldvcmRWaWV3aW5nU2VydmljZSAtZXEgJHRydWUpIC1vciBgCiAgICAgICAgKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLlZpc2lvU2VydmljZSAtZXEgJHRydWUpIC1vciBgCiAgICAgICAgKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLkV4Y2VsU2VydmljZXMgLWVxICR0cnVlKSAtb3IgYAogICAgICAgIChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5BY2Nlc3NTZXJ2aWNlIC1lcSAkdHJ1ZSkgLW9yIGAKICAgICAgICAoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuQWNjZXNzU2VydmljZXMgLWVxICR0cnVlKSAtb3IgYAogICAgICAgIChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5QZXJmb3JtYW5jZVBvaW50U2VydmljZSAtZXEgJHRydWUpKQogICAgewogICAgICAgICRzcHNlcnZpY2UgPSBHZXQtU1BNYW5hZ2VkQWNjb3VudFhNTCAkeG1saW5wdXQgLUNvbW1vbk5hbWUgInNwc2VydmljZSIKICAgICAgICBsb2cgIiAtIEdyYW50aW5nICQoJHNwc2VydmljZS51c2VybmFtZSkgcmlnaHRzIHRvIGAiJHdlYkFwcE5hbWVgIi4uLiIgCiAgICAgICAgJHdhID0gR2V0LVNQV2ViQXBwbGljYXRpb24gfCBXaGVyZS1PYmplY3QgeyRfLkRpc3BsYXlOYW1lIC1lcSAkd2ViQXBwTmFtZX0KICAgICAgICAkd2EuR3JhbnRBY2Nlc3NUb1Byb2Nlc3NJZGVudGl0eSgiJCgkc3BzZXJ2aWNlLnVzZXJuYW1lKSIpCiAgICAgICAgbG9nICJPSy4iCiAgICB9CiAgICBpZiAoJHdlYkFwcC5HcmFudEN1cnJlbnRVc2VyRnVsbENvbnRyb2wgLWVxICR0cnVlKQogICAgewogICAgICAgICRjdXJyZW50VXNlciA9ICIkZW52OlVTRVJET01BSU5cJGVudjpVU0VSTkFNRSIKICAgICAgICAkd2EgPSBHZXQtU1BXZWJBcHBsaWNhdGlvbiB8IFdoZXJlLU9iamVjdCB7JF8uRGlzcGxheU5hbWUgLWVxICR3ZWJBcHBOYW1lfQogICAgICAgIGlmICgkd2EuVXNlQ2xhaW1zQXV0aGVudGljYXRpb24gLWVxICR0cnVlKSB7JGN1cnJlbnRVc2VyID0gJ2k6MCMud3wnICsgJGN1cnJlbnRVc2VyfQogICAgICAgIFNldC1XZWJBcHBVc2VyUG9saWN5ICR3YSAkY3VycmVudFVzZXIgIiRlbnY6VVNFUk5BTUUiICJGdWxsIENvbnRyb2wiCiAgICB9CiAgICBXcml0ZUxpbmUKICAgIENvbmZpZ3VyZU9iamVjdENhY2hlICR3ZWJBcHAKCiAgICBpZiAoJHdlYkFwcC5TaXRlQ29sbGVjdGlvbnMuU2VsZWN0U2luZ2xlTm9kZSgiU2l0ZUNvbGxlY3Rpb24iKSkgIyBPbmx5IGdvIHRocm91Z2ggdGhlc2Ugc3RlcHMgaWYgd2UgYWN0dWFsbHkgaGF2ZSBhIHNpdGUgY29sbGVjdGlvbiB0byBjcmVhdGUKICAgIHsKICAgICAgICBGb3JFYWNoICgkc2l0ZUNvbGxlY3Rpb24gaW4gJHdlYkFwcC5TaXRlQ29sbGVjdGlvbnMuU2l0ZUNvbGxlY3Rpb24pCiAgICAgICAgewogICAgICAgICAgICAkZGJQcmVmaXggPSBHZXQtREJQcmVmaXggJHhtbGlucHV0CiAgICAgICAgICAgICRnZXRTUFNpdGVDb2xsZWN0aW9uID0gJG51bGwKICAgICAgICAgICAgJHNpdGVDb2xsZWN0aW9uTmFtZSA9ICRzaXRlQ29sbGVjdGlvbi5OYW1lCiAgICAgICAgICAgICRzaXRlVVJMID0gKCRzaXRlQ29sbGVjdGlvbi5zaXRlVVJMKS5UcmltRW5kKCIvIikKICAgICAgICAgICAgJENvbXBhdGliaWxpdHlMZXZlbCA9ICRzaXRlQ29sbGVjdGlvbi5Db21wYXRpYmlsaXR5TGV2ZWwKICAgICAgICAgICAgaWYgKCEoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJENvbXBhdGliaWxpdHlMZXZlbCkpKSAjIENoZWNrIHRoZSBDb21wYXRpYmlsaXR5IExldmVsIGlmIGl0J3MgYmVlbiBzcGVjaWZpZWQKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJENvbXBhdGliaWxpdHlMZXZlbFN3aXRjaCA9IEB7Q29tcGF0aWJpbGl0eUxldmVsID0gJENvbXBhdGliaWxpdHlMZXZlbH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHskQ29tcGF0aWJpbGl0eUxldmVsU3dpdGNoID0gQHt9fQogICAgICAgICAgICBpZiAoIShbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkKCRzaXRlQ29sbGVjdGlvbi5DdXN0b21EYXRhYmFzZSkpKSkgIyBDaGVjayBpZiB3ZSBoYXZlIHNwZWNpZmllZCBhIG5vbi1kZWZhdWx0IGNvbnRlbnQgZGF0YWJhc2UgZm9yIHRoaXMgc2l0ZSBjb2xsZWN0aW9uCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRzaXRlRGF0YWJhc2UgPSAkZGJQcmVmaXgrJHNpdGVDb2xsZWN0aW9uLkN1c3RvbURhdGFiYXNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSAjIEp1c3QgdXNlIHRoZSBmaXJzdCwgZGVmYXVsdCBjb250ZW50IGRhdGFiYXNlIGZvciB0aGUgd2ViIGFwcGxpY2F0aW9uCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRzaXRlRGF0YWJhc2UgPSAkZGF0YWJhc2UKICAgICAgICAgICAgfQogICAgICAgICAgICAjIElmIGFuIE93bmVyQWxpYXMgaGFzIGJlZW4gc3BlY2lmaWVkLCBtYWtlIGl0IHRoZSBwcmltYXJ5LCBhbmQgdGhlIGN1cnJlbnRseSBsb2dnZWQtaW4gYWNjb3VudCB0aGUgc2Vjb25kYXJ5LiBPdGhlcndpc2UsIG1ha2UgdGhlIGFwcCBwb29sIGFjY291bnQgZm9yIHRoZSB3ZWIgYXBwIHRoZSBwcmltYXJ5IG93bmVyCiAgICAgICAgICAgIGlmICghKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCQoJHNpdGVDb2xsZWN0aW9uLk93bmVyKSkpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkb3duZXJBbGlhcyA9ICRzaXRlQ29sbGVjdGlvbi5Pd25lcgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJG93bmVyQWxpYXMgPSAkd2ViQXBwUG9vbEFjY291bnQudXNlcm5hbWUKICAgICAgICAgICAgfQogICAgICAgICAgICAkTENJRCA9ICRzaXRlQ29sbGVjdGlvbi5MQ0lECiAgICAgICAgICAgICRzaXRlQ29sbGVjdGlvbkxvY2FsZSA9ICRzaXRlQ29sbGVjdGlvbi5Mb2NhbGUKICAgICAgICAgICAgJHNpdGVDb2xsZWN0aW9uVGltZTI0ID0gJHNpdGVDb2xsZWN0aW9uLlRpbWUyNAogICAgICAgICAgICAjIElmIGEgdGVtcGxhdGUgaGFzIGJlZW4gcHJlLXNwZWNpZmllZCwgdXNlIGl0IHdoZW4gY3JlYXRpbmcgdGhlIFBvcnRhbCBzaXRlIGNvbGxlY3Rpb247IG90aGVyd2lzZSwgbGVhdmUgaXQgYmxhbmsgc28gd2UgY2FuIHNlbGVjdCBvbmUgd2hlbiB0aGUgcG9ydGFsIGZpcnN0IGxvYWRzCiAgICAgICAgICAgICR0ZW1wbGF0ZSA9ICRzaXRlQ29sbGVjdGlvbi50ZW1wbGF0ZQogICAgICAgICAgICBJZiAoKCR0ZW1wbGF0ZSAtbmUgJG51bGwpIC1hbmQgKCR0ZW1wbGF0ZSAtbmUgIiIpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkdGVtcGxhdGVTd2l0Y2ggPSBAe1RlbXBsYXRlID0gJHRlbXBsYXRlfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgeyR0ZW1wbGF0ZVN3aXRjaCA9IEB7fX0KICAgICAgICAgICAgaWYgKCRzaXRlQ29sbGVjdGlvbi5Ib3N0TmFtZWRTaXRlQ29sbGVjdGlvbiAtZXEgJHRydWUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRob3N0SGVhZGVyV2ViQXBwU3dpdGNoID0gQHtIb3N0SGVhZGVyV2ViQXBwbGljYXRpb24gPSAkKCR3ZWJBcHAudXJsKSsiOiIrJCgkd2ViQXBwLnBvcnQpfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgeyRob3N0SGVhZGVyV2ViQXBwU3dpdGNoID0gQHt9fQogICAgICAgICAgICBsb2cgIiAtIENoZWNraW5nIGZvciBTaXRlIENvbGxlY3Rpb24gYCIkc2l0ZVVSTGAiLi4uIgogICAgICAgICAgICAkZ2V0U1BTaXRlQ29sbGVjdGlvbiA9IEdldC1TUFNpdGUgLUlkZW50aXR5ICRzaXRlVVJMIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgIElmICgoJGdldFNQU2l0ZUNvbGxlY3Rpb24gLWVxICRudWxsKSAtYW5kICgkc2l0ZVVSTCAtbmUgJG51bGwpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIFZlcmlmeSB0aGF0IHRoZSBMYW5ndWFnZSB3ZSdyZSB0cnlpbmcgdG8gY3JlYXRlIHRoZSBzaXRlIGluIGlzIGN1cnJlbnRseSBpbnN0YWxsZWQgb24gdGhlIHNlcnZlcgogICAgICAgICAgICAgICAgJGN1bHR1cmUgPSBbU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm9dOjpHZXRDdWx0dXJlSW5mbygoW2NvbnZlcnRdOjpUb0ludDMyKCRMQ0lEKSkpCiAgICAgICAgICAgICAgICAkY3VsdHVyZURpc3BsYXlOYW1lID0gJGN1bHR1cmUuRGlzcGxheU5hbWUKICAgICAgICAgICAgICAgIElmICghKCRpbnN0YWxsZWRPZmZpY2VTZXJ2ZXJMYW5ndWFnZXMgfCBXaGVyZS1PYmplY3QgeyRfIC1lcSAkY3VsdHVyZS5OYW1lfSkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICJXQVJOSU5HOllvdSBtdXN0IGluc3RhbGwgdGhlIGAiJGN1bHR1cmUgKCRjdWx0dXJlRGlzcGxheU5hbWUpYCIgTGFuZ3VhZ2UgUGFjayBiZWZvcmUgeW91IGNhbiBjcmVhdGUgYSBzaXRlIHVzaW5nIExDSUQgJExDSUQiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBFbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJHNpdGVEYXRhYmFzZUV4aXN0cyA9IEdldC1TUENvbnRlbnREYXRhYmFzZSAtSWRlbnRpdHkgJHNpdGVEYXRhYmFzZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmICghJHNpdGVEYXRhYmFzZUV4aXN0cykKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgbmV3IGNvbnRlbnQgZGF0YWJhc2UgYCIkc2l0ZURhdGFiYXNlYCIuLi4iCgogICAgICAgICAgICAgICAgICAgICAgICAjIE1LOiBhZGRlZCAtRGF0YWJhc2VTZXJ2ZXIgdG8gZW5zdXJlIHNpdGUgY29sIGRiIGlzIGNyZWF0ZWQgaW4gY29ycmVjdCBwbGFjZQogICAgICAgICAgICAgICAgICAgICAgICAjIE5ldy1TUENvbnRlbnREYXRhYmFzZSAtTmFtZSAkc2l0ZURhdGFiYXNlIC1XZWJBcHBsaWNhdGlvbiAoR2V0LVNQV2ViQXBwbGljYXRpb24gJHdlYkFwcC51cmwpIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgICAgICAgICAgTmV3LVNQQ29udGVudERhdGFiYXNlIC1OYW1lICRzaXRlRGF0YWJhc2UgLURhdGFiYXNlU2VydmVyICRkYlNlcnZlciAtV2ViQXBwbGljYXRpb24gKEdldC1TUFdlYkFwcGxpY2F0aW9uICR3YS51cmwpIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyBTaXRlIENvbGxlY3Rpb24gYCIkc2l0ZVVSTGAiLi4uIgogICAgICAgICAgICAgICAgICAgICRzaXRlID0gTmV3LVNQU2l0ZSAtVXJsICRzaXRlVVJMIC1Pd25lckFsaWFzICRvd25lckFsaWFzIC1TZWNvbmRhcnlPd25lciAkZW52OlVTRVJET01BSU5cJGVudjpVU0VSTkFNRSAtQ29udGVudERhdGFiYXNlICRzaXRlRGF0YWJhc2UgLURlc2NyaXB0aW9uICRzaXRlQ29sbGVjdGlvbk5hbWUgLU5hbWUgJHNpdGVDb2xsZWN0aW9uTmFtZSAtTGFuZ3VhZ2UgJExDSUQgQHRlbXBsYXRlU3dpdGNoIEBob3N0SGVhZGVyV2ViQXBwU3dpdGNoIEBDb21wYXRpYmlsaXR5TGV2ZWxTd2l0Y2ggLUVycm9yQWN0aW9uIFN0b3AKCiAgICAgICAgICAgICAgICAgICAgIyBKRE0gTm90IGFsbCBXZWIgVGVtcGxhdGVzIGdyZWF0ZSB0aGUgZGVmYXVsdCBTaGFyZVBvaW50IENyb3VwcyB0aGF0IGFyZSBtYWRlIGJ5IHRoZSBVSQogICAgICAgICAgICAgICAgICAgICMgSkRNIFRoZXNlIGxpbmVzIHdpbGwgaW5zdXJlIHRoYXQgdGhlIHRoZSBhcHByb3Byb3ByYXRlIFNoYXJlUG9pbnQgR3JvdXBzLCBPd25lcnMsIE1lbWJlcnMsIFZpc2l0b3JzIGFyZSBjcmVhdGVkCiAgICAgICAgICAgICAgICAgICAgJHByaW1hcnlVc2VyID0gJHNpdGUuUm9vdFdlYi5FbnN1cmVVc2VyKCRvd25lckFsaWFzKQogICAgICAgICAgICAgICAgICAgICRzZWNvbmRhcnlVc2VyID0gJHNpdGUuUm9vdFdlYi5FbnN1cmVVc2VyKCIkZW52OlVTRVJET01BSU5cJGVudjpVU0VSTkFNRSIpCiAgICAgICAgICAgICAgICAgICAgJHRpdGxlID0gJHNpdGUuUm9vdFdlYi50aXRsZQogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gRW5zdXJpbmcgZGVmYXVsdCBncm91cHMgYXJlIGNyZWF0ZWQuLi4iCiAgICAgICAgICAgICAgICAgICAgJHNpdGUuUm9vdFdlYi5DcmVhdGVEZWZhdWx0QXNzb2NpYXRlZEdyb3VwcygkcHJpbWFyeVVzZXIsICRzZWNvbmRhcnlVc2VyLCAkdGl0bGUpCgogICAgICAgICAgICAgICAgICAgICMgQWRkIHRoZSBQb3J0YWwgU2l0ZSBDb25uZWN0aW9uIHRvIHRoZSB3ZWIgYXBwLCB1bmxlc3Mgb2YgY291cnNlIHRoZSBjdXJyZW50IHdlYiBhcHAgKmlzKiB0aGUgcG9ydGFsCiAgICAgICAgICAgICAgICAgICAgIyBJbnNwaXJlZCBieSBodHRwOi8vd3d3LnRvZGRrbGluZHQuY29tL2Jsb2cvTGlzdHMvUG9zdHMvUG9zdC5hc3B4P0lEPTI2NAogICAgICAgICAgICAgICAgICAgICRwb3J0YWxXZWJBcHAgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5XZWJBcHBsaWNhdGlvbnMuV2ViQXBwbGljYXRpb24gfCBXaGVyZSB7JF8uVHlwZSAtZXEgIlBvcnRhbCJ9IHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgMQogICAgICAgICAgICAgICAgICAgICRwb3J0YWxTaXRlQ29sbCA9ICRwb3J0YWxXZWJBcHAuU2l0ZUNvbGxlY3Rpb25zLlNpdGVDb2xsZWN0aW9uIHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgMQogICAgICAgICAgICAgICAgICAgIElmICgkc2l0ZS5VUkwgLW5lICRwb3J0YWxTaXRlQ29sbC5zaXRlVVJMKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBTZXR0aW5nIHRoZSBQb3J0YWwgU2l0ZSBDb25uZWN0aW9uIGZvciBgIiRzaXRlQ29sbGVjdGlvbk5hbWVgIi4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgJHNpdGUuUG9ydGFsTmFtZSA9ICRwb3J0YWxTaXRlQ29sbC5OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRzaXRlLlBvcnRhbFVybCA9ICRwb3J0YWxTaXRlQ29sbC5zaXRlVXJsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIElmICgkc2l0ZUNvbGxlY3Rpb25Mb2NhbGUpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFVwZGF0aW5nIHRoZSBsb2NhbGUgZm9yIGAiJHNpdGVDb2xsZWN0aW9uTmFtZWAiIHRvIGAiJHNpdGVDb2xsZWN0aW9uTG9jYWxlYCIuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgICRzaXRlLlJvb3RXZWIuTG9jYWxlID0gW1N5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvXTo6Q3JlYXRlU3BlY2lmaWNDdWx0dXJlKCRzaXRlQ29sbGVjdGlvbkxvY2FsZSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgSWYgKCRzaXRlQ29sbGVjdGlvblRpbWUyNCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gVXBkYXRpbmcgMjQgaG91ciB0aW1lIGZvcm1hdCBmb3IgYCIkc2l0ZUNvbGxlY3Rpb25OYW1lYCIgdG8gYCIkc2l0ZUNvbGxlY3Rpb25UaW1lMjRgIi4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgJHNpdGUuUm9vdFdlYi5SZWdpb25hbFNldHRpbmdzLlRpbWUyNCA9ICQoW1N5c3RlbS5Db252ZXJ0XTo6VG9Cb29sZWFuKCRzaXRlQ29sbGVjdGlvblRpbWUyNCkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRzaXRlLlJvb3RXZWIuVXBkYXRlKCkKCiAgICAgICAgICAgICAgICAgICAgIyBNSzogc3RhcnQKICAgICAgICAgICAgICAgICAgICBpZiAoKCRUUlVTVEVEX0RPTUFJTi5Ub1VwcGVyKCkgLW5lICRGT1JXQVJEX0xPT0tVUF9aT05FLlRvVXBwZXIoKSkgLWFuZCAoJHNpdGVDb2xsZWN0aW9uLkhvc3ROYW1lZFNpdGVDb2xsZWN0aW9uIC1lcSAkdHJ1ZSkpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNpdGVDb2wgPSBnZXQtc3BzaXRlICRzaXRlVVJMCiAgICAgICAgICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAoIklORk86IGdldHRpbmcgc2l0ZUNvbCBmb3IgdXJsICIgKyAkc2l0ZVVSTCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwdWJsaWNVcmwgPSAoW3N0cmluZ10kc2l0ZVVSTCkuVG9Mb3dlcigpLlJlcGxhY2UoJGVudjpVU0VSRE5TRE9NQUlOLlRvTG93ZXIoKSwgJFRSVVNURURfRE9NQUlOLlRvTG93ZXIoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAoIklORk86IHB1YmxpY1VybCAiICsgJHB1YmxpY1VybCkKICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0LXNwc2l0ZXVybCAtaWRlbnRpdHkgJHNpdGVDb2wgLXVybCAkcHVibGljVXJsIC16b25lIEludHJhbmV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgKCJJTkZPOiBzZXR0aW5nIHpvbmUgIikKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjYXRjaAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXggPSAkXy5FeGNlcHRpb24gfCBmb3JtYXQtbGlzdCB8IE91dC1TdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiRVJST1I6IEV4Y2VwdGlvbiBvY2N1cnJlZCBgbkV4Y2VwdGlvbiBNZXNzYWdlOiAkZXguIENvbnRpbnVlLi4uIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICMgTUs6IGVuZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIEVsc2Uge2xvZyAiIC0gU2tpcHBpbmcgY3JlYXRpb24gb2Ygc2l0ZSBgIiRzaXRlQ29sbGVjdGlvbk5hbWVgIiAtIGFscmVhZHkgcHJvdmlzaW9uZWQuIn0KICAgICAgICAgICAgaWYgKCRzaXRlQ29sbGVjdGlvbi5Ib3N0TmFtZWRTaXRlQ29sbGVjdGlvbiAtZXEgJHRydWUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIEFkZC1Mb2NhbEludHJhbmV0VVJMICgkc2l0ZVVSTCkKICAgICAgICAgICAgICAgICMgVXBkYXRlZCBzbyB0aGF0IHdlIGRvbid0IGFkZCBVUkxzIHRvIHRoZSBsb2NhbCBob3N0cyBmaWxlIG9mIGEgc2VydmVyIHRoYXQncyBub3QgYmVlbiBzcGVjaWZpZWQgdG8gcnVuIHRoZSBGb3VuZGF0aW9uIFdlYiBBcHBsaWNhdGlvbiBzZXJ2aWNlLCBvciB0aGUgU2VhcmNoIE1pblJvbGUKICAgICAgICAgICAgICAgIGlmICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5XZWJBcHBsaWNhdGlvbnMuQWRkVVJMc1RvSE9TVFMgLWVxICR0cnVlIC1hbmQgIShTaG91bGRJUHJvdmlzaW9uICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZlclJvbGVzLlNlYXJjaCkpIC1hbmQgISgoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2aWNlcy5TZWxlY3RTaW5nbGVOb2RlKCJGb3VuZGF0aW9uV2ViQXBwbGljYXRpb24iKSkgLWFuZCAhKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2aWNlcy5Gb3VuZGF0aW9uV2ViQXBwbGljYXRpb24gLWVxICR0cnVlKSkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIyBBZGQgdGhlIGhvc3RuYW1lIG9mIHRoaXMgaG9zdCBoZWFkZXItYmFzZWQgc2l0ZSBjb2xsZWN0aW9uIHRvIHRoZSBsb2NhbCBIT1NUUyBzbyBpdCdzIGltbWVkaWF0ZWx5IHJlc29sdmFibGUgbG9jYWxseQogICAgICAgICAgICAgICAgICAgICMgU3RyaXAgb3V0IGFueSBwcm90b2NvbCBhbmQvb3IgcG9ydCB2YWx1ZXMKICAgICAgICAgICAgICAgICAgICAkaG9zdG5hbWUsJG51bGwgPSAkc2l0ZVVSTCAtcmVwbGFjZSAiaHR0cDovLyIsIiIgLXJlcGxhY2UgImh0dHBzOi8vIiwiIiAtc3BsaXQgIjoiCiAgICAgICAgICAgICAgICAgICAgQWRkVG9IT1NUUyAkaG9zdG5hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBXcml0ZUxpbmUKICAgICAgICB9CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgbG9nICIgLSBObyBzaXRlIGNvbGxlY3Rpb25zIHNwZWNpZmllZCBmb3IgJCgkd2ViYXBwLnVybCkgLSBza2lwcGluZy4iCiAgICB9Cn0KCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBTZXQtV2ViQXBwVXNlclBvbGljeQojIEFNVyAxLjcuMgojIERlc2M6IFNldCB0aGUgd2ViIGFwcGxpY2F0aW9uIHVzZXIgcG9saWN5CiMgUmVmZXIgdG8gaHR0cDovL3RlY2huZXQubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2ZmNzU4NjU2LmFzcHgKIyBVcGRhdGVkIGJhc2VkIG9uIEdhcnkgTGFwb2ludGUgZXhhbXBsZSBzY3JpcHQgdG8gaW5jbHVkZSBQb2xpY3kgc2V0dGluZ3MgMTgvMTAvMjAxMAojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIFNldC1XZWJBcHBVc2VyUG9saWN5KCR3YSwgJHVzZXJOYW1lLCAkZGlzcGxheU5hbWUsICRwZXJtKQp7CiAgICBbTWljcm9zb2Z0LlNoYXJlUG9pbnQuQWRtaW5pc3RyYXRpb24uU1BQb2xpY3lDb2xsZWN0aW9uXSRwb2xpY2llcyA9ICR3YS5Qb2xpY2llcwogICAgW01pY3Jvc29mdC5TaGFyZVBvaW50LkFkbWluaXN0cmF0aW9uLlNQUG9saWN5XSRwb2xpY3kgPSAkcG9saWNpZXMuQWRkKCR1c2VyTmFtZSwgJGRpc3BsYXlOYW1lKQogICAgW01pY3Jvc29mdC5TaGFyZVBvaW50LkFkbWluaXN0cmF0aW9uLlNQUG9saWN5Um9sZV0kcG9saWN5Um9sZSA9ICR3YS5Qb2xpY3lSb2xlcyB8IHdoZXJlIHskXy5OYW1lIC1lcSAkcGVybX0KICAgIElmICgkcG9saWN5Um9sZSAtbmUgJG51bGwpCiAgICB7CiAgICAgICAgbG9nICIgLSBHcmFudGluZyAkdXNlck5hbWUgJHBlcm0gdG8gJCgkd2EuVXJsKS4uLiIKICAgICAgICAkcG9saWN5LlBvbGljeVJvbGVCaW5kaW5ncy5BZGQoJHBvbGljeVJvbGUpCiAgICB9CiAgICAkd2EuVXBkYXRlKCkKfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IENvbmZpZ3VyZU9iamVjdENhY2hlCiMgRGVzYzogQXBwbGllcyB0aGUgcG9ydGFsIHN1cGVyIGFjY291bnRzIHRvIHRoZSBvYmplY3QgY2FjaGUgZm9yIGEgd2ViIGFwcGxpY2F0aW9uCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gQ29uZmlndXJlT2JqZWN0Q2FjaGUoW1N5c3RlbS5YbWwuWG1sRWxlbWVudF0kd2ViQXBwKQp7CiAgICBUcnkKICAgIHsKICAgICAgICAkdXJsID0gJHdlYkFwcC5VcmwgKyAiOiIgKyAkd2ViQXBwLlBvcnQKICAgICAgICAkd2EgPSBHZXQtU1BXZWJBcHBsaWNhdGlvbiB8IFdoZXJlLU9iamVjdCB7JF8uRGlzcGxheU5hbWUgLWVxICR3ZWJBcHAuTmFtZX0KICAgICAgICAkc3VwZXJVc2VyQWNjID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5PYmplY3RDYWNoZUFjY291bnRzLlN1cGVyVXNlcgogICAgICAgICRzdXBlclJlYWRlckFjYyA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uT2JqZWN0Q2FjaGVBY2NvdW50cy5TdXBlclJlYWRlcgogICAgICAgICMgSWYgdGhlIHdlYiBhcHAgaXMgdXNpbmcgQ2xhaW1zIGF1dGgsIGNoYW5nZSB0aGUgdXNlciBhY2NvdW50cyB0byB0aGUgcHJvcGVyIHN5bnRheAogICAgICAgIElmICgkd2EuVXNlQ2xhaW1zQXV0aGVudGljYXRpb24gLWVxICR0cnVlKQogICAgICAgIHsKICAgICAgICAgICAgJHN1cGVyVXNlckFjYyA9ICdpOjAjLnd8JyArICRzdXBlclVzZXJBY2MKICAgICAgICAgICAgJHN1cGVyUmVhZGVyQWNjID0gJ2k6MCMud3wnICsgJHN1cGVyUmVhZGVyQWNjCiAgICAgICAgfQogICAgICAgIGxvZyAiIC0gQXBwbHlpbmcgb2JqZWN0IGNhY2hlIGFjY291bnRzIHRvIGAiJHVybGAiLi4uIgogICAgICAgICR3YS5Qcm9wZXJ0aWVzWyJwb3J0YWxzdXBlcnVzZXJhY2NvdW50Il0gPSAkc3VwZXJVc2VyQWNjCiAgICAgICAgU2V0LVdlYkFwcFVzZXJQb2xpY3kgJHdhICRzdXBlclVzZXJBY2MgIlN1cGVyIFVzZXIgKE9iamVjdCBDYWNoZSkiICJGdWxsIENvbnRyb2wiCiAgICAgICAgJHdhLlByb3BlcnRpZXNbInBvcnRhbHN1cGVycmVhZGVyYWNjb3VudCJdID0gJHN1cGVyUmVhZGVyQWNjCiAgICAgICAgU2V0LVdlYkFwcFVzZXJQb2xpY3kgJHdhICRzdXBlclJlYWRlckFjYyAiU3VwZXIgUmVhZGVyIChPYmplY3QgQ2FjaGUpIiAiRnVsbCBSZWFkIgogICAgICAgICR3YS5VcGRhdGUoKQogICAgICAgIGxvZyAiIC0gRG9uZSBhcHBseWluZyBvYmplY3QgY2FjaGUgYWNjb3VudHMgdG8gYCIkdXJsYCIiCiAgICB9CiAgICBDYXRjaAogICAgewogICAgICAgICMgTUs6IAogICAgICAgICMgJF8KICAgICAgICBsb2cgIldBUk5JTkc6QW4gZXJyb3Igb2NjdXJyZWQgYXBwbHlpbmcgb2JqZWN0IGNhY2hlIHRvIGAiJHVybGAiIgogICAgICAgIGxvZyAiRVJST1I6ICQoJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIgogICAgICAgIFBhdXNlICJleGl0IgoKICAgIH0KfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IENvbmZpZ3VyZU9ubGluZVdlYlBhcnRDYXRhbG9nCiMgRGVzYzogRW5hYmxlcyAvIERpc2FibGVzIGFjY2VzcyB0byB0aGUgb25saW5lIHdlYiBwYXJ0cyBjYXRhbG9nIGZvciBlYWNoIHdlYiBhcHBsaWNhdGlvbgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIENvbmZpZ3VyZU9ubGluZVdlYlBhcnRDYXRhbG9nKFtTeXN0ZW0uWG1sLlhtbEVsZW1lbnRdJHdlYkFwcCkKewogICAgSWYgKCR3ZWJhcHAuVXNlT25saW5lV2ViUGFydENhdGFsb2cgLW5lICIiKQogICAgewogICAgICAgICR1cmwgPSAkd2ViQXBwLlVybCArICI6IiArICR3ZWJBcHAuUG9ydAogICAgICAgIElmICgkdXJsIC1saWtlICIqbG9jYWxob3N0KiIpIHskdXJsID0gJHVybCAtcmVwbGFjZSAibG9jYWxob3N0IiwiJGVudjpDT01QVVRFUk5BTUUifQogICAgICAgIGxvZyAiIC0gU2V0dGluZyBvbmxpbmUgd2VicGFydCBjYXRhbG9nIGFjY2VzcyBmb3IgYCIkdXJsYCIiCgogICAgICAgICR3YSA9IEdldC1TUFdlYkFwcGxpY2F0aW9uIHwgV2hlcmUtT2JqZWN0IHskXy5EaXNwbGF5TmFtZSAtZXEgJHdlYkFwcC5OYW1lfQogICAgICAgIElmICgkd2ViYXBwLlVzZU9ubGluZVdlYlBhcnRDYXRhbG9nIC1lcSAiVHJ1ZSIpCiAgICAgICAgewogICAgICAgICAgICAkd2EuQWxsb3dBY2Nlc3NUb1dlYnBhcnRDYXRhbG9nPSR0cnVlCiAgICAgICAgfQogICAgICAgIEVsc2UKICAgICAgICB7CiAgICAgICAgICAgICR3YS5BbGxvd0FjY2Vzc1RvV2VicGFydENhdGFsb2c9JGZhbHNlCiAgICAgICAgfQogICAgICAgICR3YS5VcGRhdGUoKQogICAgfQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogU2V0dXBNYW5hZ2VkUGF0aHMKIyBEZXNjOiBTZXRzIHVwIG1hbmFnZWQgcGF0aHMgZm9yIGEgZ2l2ZW4gd2ViIGFwcGxpY2F0aW9uCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gU2V0dXBNYW5hZ2VkUGF0aHMoW1N5c3RlbS5YbWwuWG1sRWxlbWVudF0kd2ViQXBwKQp7CiAgICAkdXJsID0gJHdlYkFwcC5VcmwgKyAiOiIgKyAkd2ViQXBwLlBvcnQKICAgIElmICgkdXJsIC1saWtlICIqbG9jYWxob3N0KiIpIHskdXJsID0gJHVybCAtcmVwbGFjZSAibG9jYWxob3N0IiwiJGVudjpDT01QVVRFUk5BTUUifQogICAgbG9nICIgLSBTZXR0aW5nIHVwIG1hbmFnZWQgcGF0aHMgZm9yIGAiJHVybGAiIgoKICAgIElmICgkd2ViQXBwLk1hbmFnZWRQYXRocykKICAgIHsKICAgICAgICBGb3JFYWNoICgkbWFuYWdlZFBhdGggaW4gJHdlYkFwcC5NYW5hZ2VkUGF0aHMuTWFuYWdlZFBhdGgpCiAgICAgICAgewogICAgICAgICAgICBJZiAoJG1hbmFnZWRQYXRoLkRlbGV0ZSAtZXEgInRydWUiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAgLSBEZWxldGluZyBtYW5hZ2VkIHBhdGggYCIkKCRtYW5hZ2VkUGF0aC5SZWxhdGl2ZVVybClgIiBhdCBgIiR1cmxgIiIKICAgICAgICAgICAgICAgIFJlbW92ZS1TUE1hbmFnZWRQYXRoIC1JZGVudGl0eSAkbWFuYWdlZFBhdGguUmVsYXRpdmVVcmwgLVdlYkFwcGxpY2F0aW9uICR1cmwgLUNvbmZpcm06JGZhbHNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgT3V0LU51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICBFbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIElmICgkbWFuYWdlZFBhdGguRXhwbGljaXQgLWVxICJ0cnVlIikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSBTZXR0aW5nIHVwIGV4cGxpY2l0IG1hbmFnZWQgcGF0aCBgIiQoJG1hbmFnZWRQYXRoLlJlbGF0aXZlVXJsKWAiIGF0IGAiJHVybGAiIGFuZCBITlNDcy4uLiIKICAgICAgICAgICAgICAgICAgICBOZXctU1BNYW5hZ2VkUGF0aCAtUmVsYXRpdmVVcmwgJG1hbmFnZWRQYXRoLlJlbGF0aXZlVXJsIC1XZWJBcHBsaWNhdGlvbiAkdXJsIC1FeHBsaWNpdCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICAgICAgIyBMZXQncyBjcmVhdGUgaXQgZm9yIGhvc3QtbmFtZWQgc2l0ZSBjb2xsZWN0aW9ucyB0b28sIGluIGNhc2Ugd2UgaGF2ZSBhbnkKICAgICAgICAgICAgICAgICAgICBOZXctU1BNYW5hZ2VkUGF0aCAtUmVsYXRpdmVVcmwgJG1hbmFnZWRQYXRoLlJlbGF0aXZlVXJsIC1Ib3N0SGVhZGVyIC1FeHBsaWNpdCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBFbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgIC0gU2V0dGluZyB1cCBtYW5hZ2VkIHBhdGggYCIkKCRtYW5hZ2VkUGF0aC5SZWxhdGl2ZVVybClgIiBhdCBgIiR1cmxgIiBhbmQgSE5TQ3MuLi4iCiAgICAgICAgICAgICAgICAgICAgTmV3LVNQTWFuYWdlZFBhdGggLVJlbGF0aXZlVXJsICRtYW5hZ2VkUGF0aC5SZWxhdGl2ZVVybCAtV2ViQXBwbGljYXRpb24gJHVybCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICAgICAgIyBMZXQncyBjcmVhdGUgaXQgZm9yIGhvc3QtbmFtZWQgc2l0ZSBjb2xsZWN0aW9ucyB0b28sIGluIGNhc2Ugd2UgaGF2ZSBhbnkKICAgICAgICAgICAgICAgICAgICBOZXctU1BNYW5hZ2VkUGF0aCAtUmVsYXRpdmVVcmwgJG1hbmFnZWRQYXRoLlJlbGF0aXZlVXJsIC1Ib3N0SGVhZGVyIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBsb2cgIiAtIERvbmUgc2V0dGluZyB1cCBtYW5hZ2VkIHBhdGhzIGF0IGAiJHVybGAiIgp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ3JlYXRlIFVzZXIgUHJvZmlsZSBTZXJ2aWNlIEFwcGxpY2F0aW9uCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBDcmVhdGVVc2VyUHJvZmlsZVNlcnZpY2VBcHBsaWNhdGlvbgojIERlc2M6IENyZWF0ZSB0aGUgVXNlciBQcm9maWxlIFNlcnZpY2UgQXBwbGljYXRpb24KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBDcmVhdGVVc2VyUHJvZmlsZVNlcnZpY2VBcHBsaWNhdGlvbihbeG1sXSR4bWxpbnB1dCkKewogICAgIyBCYXNlZCBvbiBodHRwOi8vc2hhcmVwb2ludC5taWNyb3NvZnQuY29tL2Jsb2dzL3phY2gvTGlzdHMvUG9zdHMvUG9zdC5hc3B4P0lEPTUwCiAgICBUcnkKICAgIHsKICAgICAgICBHZXQtTWFqb3JWZXJzaW9uTnVtYmVyICR4bWxpbnB1dAogICAgICAgICR1c2VyUHJvZmlsZSA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlVzZXJQcm9maWxlU2VydmljZUFwcAogICAgICAgICRteVNpdGVXZWJBcHAgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5XZWJBcHBsaWNhdGlvbnMuV2ViQXBwbGljYXRpb24gfCBXaGVyZSB7JF8uVHlwZSAtZXEgIk15U2l0ZUhvc3QifQogICAgICAgICRkYlByZWZpeCA9IEdldC1EQlByZWZpeCAkeG1saW5wdXQKICAgICAgICAjIElmIHdlIGhhdmUgYXNrZWQgdG8gY3JlYXRlIGEgTXlTaXRlIEhvc3Qgd2ViIGFwcCwgdXNlIHRoYXQgYXMgdGhlIE15U2l0ZSBob3N0IGxvY2F0aW9uCiAgICAgICAgaWYgKCRteVNpdGVXZWJBcHApCiAgICAgICAgewogICAgICAgICAgICAkbXlTaXRlTmFtZSA9ICRteVNpdGVXZWJBcHAubmFtZQogICAgICAgICAgICAkbXlTaXRlVVJMID0gKCRteVNpdGVXZWJBcHAudXJsKS5UcmltRW5kKCIvIikKICAgICAgICAgICAgJG15U2l0ZVBvcnQgPSAkbXlTaXRlV2ViQXBwLnBvcnQKICAgICAgICAgICAgJG15U2l0ZURCU2VydmVyID0gJG15U2l0ZVdlYkFwcC5EYXRhYmFzZS5EQlNlcnZlcgogICAgICAgICAgICAjIElmIHdlIGhhdmVuJ3Qgc3BlY2lmaWVkIGEgREIgU2VydmVyIHRoZW4ganVzdCB1c2UgdGhlIGRlZmF1bHQgdXNlZCBieSB0aGUgRmFybQogICAgICAgICAgICBJZiAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJG15U2l0ZURCU2VydmVyKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJG15U2l0ZURCU2VydmVyID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5EYXRhYmFzZS5EQlNlcnZlcgogICAgICAgICAgICB9CiAgICAgICAgICAgICRteVNpdGVEQiA9ICRkYlByZWZpeCskbXlTaXRlV2ViQXBwLkRhdGFiYXNlLk5hbWUKICAgICAgICAgICAgJG15U2l0ZUFwcFBvb2xBY2N0ID0gR2V0LVNQTWFuYWdlZEFjY291bnRYTUwgJHhtbGlucHV0IC1Db21tb25OYW1lICJNeVNpdGVIb3N0IgogICAgICAgICAgICBpZiAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJG15U2l0ZUFwcFBvb2xBY2N0LnVzZXJuYW1lKSkge3Rocm93ICIgLSBgIk15U2l0ZUhvc3RgIiBtYW5hZ2VkIGFjY291bnQgbm90IGZvdW5kISBDaGVjayB5b3VyIFhNTC4ifQogICAgICAgIH0KICAgICAgICAkcG9ydGFsV2ViQXBwID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uV2ViQXBwbGljYXRpb25zLldlYkFwcGxpY2F0aW9uIHwgV2hlcmUgeyRfLlR5cGUgLWVxICJQb3J0YWwifSB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEKICAgICAgICAkcG9ydGFsQXBwUG9vbEFjY3QgPSBHZXQtU1BNYW5hZ2VkQWNjb3VudFhNTCAkeG1saW5wdXQgLUNvbW1vbk5hbWUgIlBvcnRhbCIKICAgICAgICBpZiAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJHBvcnRhbEFwcFBvb2xBY2N0LnVzZXJuYW1lKSkge3Rocm93ICIgLSBgIlBvcnRhbGAiIG1hbmFnZWQgYWNjb3VudCBub3QgZm91bmQhIENoZWNrIHlvdXIgWE1MLiJ9CiAgICAgICAgJGZhcm1BY2N0ID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5BY2NvdW50LlVzZXJuYW1lCiAgICAgICAgJGZhcm1BY2N0UFdEID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5BY2NvdW50LlBhc3N3b3JkCiAgICAgICAgIyBHZXQgdGhlIGNvbnRlbnQgYWNjZXNzIGFjY291bnRzIG9mIGVhY2ggU2VhcmNoIFNlcnZpY2UgQXBwbGljYXRpb24gaW4gdGhlIFhNTCAoaW4gY2FzZSB0aGVyZSBhcmUgbXVsdGlwbGUpCiAgICAgICAgZm9yZWFjaCAoJHNlYXJjaFNlcnZpY2VBcHBsaWNhdGlvbiBpbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5FbnRlcnByaXNlU2VhcmNoU2VydmljZS5FbnRlcnByaXNlU2VhcmNoU2VydmljZUFwcGxpY2F0aW9ucy5FbnRlcnByaXNlU2VhcmNoU2VydmljZUFwcGxpY2F0aW9uKQogICAgICAgIHsKICAgICAgICAgICAgW2FycmF5XSRjb250ZW50QWNjZXNzQWNjb3VudHMgKz0gJHNlYXJjaFNlcnZpY2VBcHBsaWNhdGlvbi5Db250ZW50QWNjZXNzQWNjb3VudAogICAgICAgIH0KICAgICAgICBJZiAoKCRmYXJtQWNjdFBXRCAtbmUgIiIpIC1hbmQgKCRmYXJtQWNjdFBXRCAtbmUgJG51bGwpKSB7JGZhcm1BY2N0UFdEID0gKENvbnZlcnRUby1TZWN1cmVTdHJpbmcgJGZhcm1BY2N0UFdEIC1Bc1BsYWluVGV4dCAtZm9yY2UpfQogICAgICAgICRteVNpdGVUZW1wbGF0ZSA9ICRteVNpdGVXZWJBcHAuU2l0ZUNvbGxlY3Rpb25zLlNpdGVDb2xsZWN0aW9uLlRlbXBsYXRlCiAgICAgICAgJG15U2l0ZUxDSUQgPSAkbXlTaXRlV2ViQXBwLlNpdGVDb2xsZWN0aW9ucy5TaXRlQ29sbGVjdGlvbi5MQ0lECiAgICAgICAgJHVzZXJQcm9maWxlU2VydmljZU5hbWUgPSAkdXNlclByb2ZpbGUuTmFtZQogICAgICAgICR1c2VyUHJvZmlsZVNlcnZpY2VQcm94eU5hbWUgPSAkdXNlclByb2ZpbGUuUHJveHlOYW1lCiAgICAgICAgJHNwc2VydmljZSA9IEdldC1TUE1hbmFnZWRBY2NvdW50WE1MICR4bWxpbnB1dCAtQ29tbW9uTmFtZSAic3BzZXJ2aWNlIgogICAgICAgIElmKCR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lIC1lcSAkbnVsbCkgeyR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lID0gIlVzZXIgUHJvZmlsZSBTZXJ2aWNlIEFwcGxpY2F0aW9uIn0KICAgICAgICBJZigkdXNlclByb2ZpbGVTZXJ2aWNlUHJveHlOYW1lIC1lcSAkbnVsbCkgeyR1c2VyUHJvZmlsZVNlcnZpY2VQcm94eU5hbWUgPSAkdXNlclByb2ZpbGVTZXJ2aWNlTmFtZX0KICAgICAgICBJZiAoISRmYXJtQ3JlZGVudGlhbCkge1tTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBzQ3JlZGVudGlhbF0kZmFybUNyZWRlbnRpYWwgPSBHZXRGYXJtQ3JlZGVudGlhbHMgJHhtbGlucHV0fQogICAgICAgIGlmICgoKEdldC1XbWlPYmplY3QgV2luMzJfT3BlcmF0aW5nU3lzdGVtKS5WZXJzaW9uIC1saWtlICI2LjIqIiAtb3IgKEdldC1XbWlPYmplY3QgV2luMzJfT3BlcmF0aW5nU3lzdGVtKS5WZXJzaW9uIC1saWtlICI2LjMqIikgLWFuZCAoJGVudjpzcFZlciAtZXEgIjE0IikpCiAgICAgICAgewogICAgICAgICAgICBsb2cgIiAtIFNraXBwaW5nIHNldHRpbmcgdGhlIHdlYiBhcHAgZGlyZWN0b3J5IHBhdGggbmFtZSAobm90IGN1cnJlbnRseSB3b3JraW5nIG9uIFdpbmRvd3MgMjAxMiB3L1NQMjAxMCkuLi4iCiAgICAgICAgICAgICRwYXRoU3dpdGNoID0gQHt9CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgICMgU2V0IHRoZSBkaXJlY3RvcnkgcGF0aCBmb3IgdGhlIHdlYiBhcHAgdG8gc29tZXRoaW5nIGEgYml0IG1vcmUgZnJpZW5kbHkKICAgICAgICAgICAgSW1wb3J0V2ViQWRtaW5pc3RyYXRpb24KICAgICAgICAgICAgIyBHZXQgdGhlIGRlZmF1bHQgcm9vdCBsb2NhdGlvbiBmb3Igd2ViIGFwcHMgKGZpcnN0IGZyb20gSUlTIGl0c2VsZiwgdGhlbiBmYWlsaW5nIHRoYXQsIGZyb20gdGhlIHJlZ2lzdHJ5KQogICAgICAgICAgICAkaWlzV2ViRGlyID0gKEdldC1JdGVtUHJvcGVydHkgIklJUzpcU2l0ZXNcRGVmYXVsdCBXZWIgU2l0ZVwiIC1OYW1lIHBoeXNpY2FsUGF0aCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkgLXJlcGxhY2UgKCIlU3lzdGVtRHJpdmUlIiwiJGVudjpTeXN0ZW1Ecml2ZSIpCiAgICAgICAgICAgIGlmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkaWlzV2ViRGlyKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJGlpc1dlYkRpciA9IChHZXQtSXRlbSAtUGF0aCBIS0xNOlxTT0ZUV0FSRVxNaWNyb3NvZnRcSW5ldFN0cCkuR2V0VmFsdWUoIlBhdGhXV1dSb290IikgLXJlcGxhY2UgKCIlU3lzdGVtRHJpdmUlIiwiJGVudjpTeXN0ZW1Ecml2ZSIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgSWYgKCEoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJGlpc1dlYkRpcikpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkcGF0aFN3aXRjaCA9IEB7UGF0aCA9ICIkaWlzV2ViRGlyXHdzc1xWaXJ0dWFsRGlyZWN0b3JpZXNcJHdlYkFwcE5hbWUtJHBvcnQifQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgeyRwYXRoU3dpdGNoID0gQHt9fQogICAgICAgIH0KICAgICAgICAjIE9ubHkgc2V0ICRob3N0SGVhZGVyU3dpdGNoIHRvIGJsYW5rIGlmIHRoZSBVc2VIb3N0SGVhZGVyIHZhbHVlIGV4aXN0cyBoYXMgZXhwbGljaXRseSBiZWVuIHNldCB0byBmYWxzZQogICAgICAgIGlmICghKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCR3ZWJBcHAuVXNlSG9zdEhlYWRlcikpIC1hbmQgJHdlYkFwcC5Vc2VIb3N0SGVhZGVyIC1lcSAkZmFsc2UpCiAgICAgICAgewogICAgICAgICAgICAkaG9zdEhlYWRlclN3aXRjaCA9IEB7fQogICAgICAgIH0KICAgICAgICBlbHNlIHskaG9zdEhlYWRlclN3aXRjaCA9IEB7SG9zdEhlYWRlciA9ICRob3N0SGVhZGVyfX0KCiAgICAgICAgSWYgKChTaG91bGRJUHJvdmlzaW9uICR1c2VyUHJvZmlsZSAtZXEgJHRydWUpIC1hbmQgKEdldC1Db21tYW5kIC1OYW1lIE5ldy1TUFByb2ZpbGVTZXJ2aWNlQXBwbGljYXRpb24gLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpKQogICAgICAgIHsKICAgICAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgICAgIGxvZyAiIC0gUHJvdmlzaW9uaW5nICQoJHVzZXJQcm9maWxlLk5hbWUpIgogICAgICAgICAgICAkYXBwbGljYXRpb25Qb29sID0gR2V0LUhvc3RlZFNlcnZpY2VzQXBwUG9vbCAkeG1saW5wdXQKICAgICAgICAgICAgIyBnZXQgdGhlIHNlcnZpY2UgaW5zdGFuY2UKICAgICAgICAgICAgJHByb2ZpbGVTZXJ2aWNlSW5zdGFuY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLlNlcnZlci5BZG1pbmlzdHJhdGlvbi5Vc2VyUHJvZmlsZVNlcnZpY2VJbnN0YW5jZSJ9CiAgICAgICAgICAgICRwcm9maWxlU2VydmljZUluc3RhbmNlID0gJHByb2ZpbGVTZXJ2aWNlSW5zdGFuY2VzIHwgPyB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyLkFkZHJlc3MgJGVudjpDT01QVVRFUk5BTUV9CiAgICAgICAgICAgIElmICgtbm90ICQ/KSB7IFRocm93ICIgLSBGYWlsZWQgdG8gZmluZCBVc2VyIFByb2ZpbGUgU2VydmljZSBpbnN0YW5jZSIgfQogICAgICAgICAgICAjIFN0YXJ0IFNlcnZpY2UgaW5zdGFuY2UKICAgICAgICAgICAgbG9nICIgLSBTdGFydGluZyBVc2VyIFByb2ZpbGUgU2VydmljZSBpbnN0YW5jZS4uLiIKICAgICAgICAgICAgSWYgKCgkcHJvZmlsZVNlcnZpY2VJbnN0YW5jZS5TdGF0dXMgLWVxICJEaXNhYmxlZCIpIC1vciAoJHByb2ZpbGVTZXJ2aWNlSW5zdGFuY2UuU3RhdHVzIC1uZSAiT25saW5lIikpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRwcm9maWxlU2VydmljZUluc3RhbmNlLlByb3Zpc2lvbigpCiAgICAgICAgICAgICAgICBJZiAoLW5vdCAkPykgeyBUaHJvdyAiIC0gRmFpbGVkIHRvIHN0YXJ0IFVzZXIgUHJvZmlsZSBTZXJ2aWNlIGluc3RhbmNlIiB9CiAgICAgICAgICAgICAgICAjIFdhaXQKICAgICAgICAgICAgICAgIGxvZyAiIC0gV2FpdGluZyBmb3IgVXNlciBQcm9maWxlIFNlcnZpY2UuLi4iIAogICAgICAgICAgICAgICAgV2hpbGUgKCRwcm9maWxlU2VydmljZUluc3RhbmNlLlN0YXR1cyAtbmUgIk9ubGluZSIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIuIiAKICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAxCiAgICAgICAgICAgICAgICAgICAgJHByb2ZpbGVTZXJ2aWNlSW5zdGFuY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLlNlcnZlci5BZG1pbmlzdHJhdGlvbi5Vc2VyUHJvZmlsZVNlcnZpY2VJbnN0YW5jZSJ9CiAgICAgICAgICAgICAgICAgICAgJHByb2ZpbGVTZXJ2aWNlSW5zdGFuY2UgPSAkcHJvZmlsZVNlcnZpY2VJbnN0YW5jZXMgfCA/IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXIuQWRkcmVzcyAkZW52OkNPTVBVVEVSTkFNRX0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxvZyAkKCRwcm9maWxlU2VydmljZUluc3RhbmNlLlN0YXR1cykKICAgICAgICAgICAgfQogICAgICAgICAgICAjIENyZWF0ZSBhIFByb2ZpbGUgU2VydmljZSBBcHBsaWNhdGlvbgogICAgICAgICAgICBJZiAoKEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8ID8geyRfLkdldFR5cGUoKS5Ub1N0cmluZygpIC1lcSAiTWljcm9zb2Z0Lk9mZmljZS5TZXJ2ZXIuQWRtaW5pc3RyYXRpb24uVXNlclByb2ZpbGVBcHBsaWNhdGlvbiJ9KSAtZXEgJG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICMgQ3JlYXRlIE15U2l0ZXMgV2ViIEFwcGxpY2F0aW9uIGlmIGl0IGRvZXNuJ3QgYWxyZWFkeSBleGlzdCwgYW5kIHdlJ3ZlIHNwZWNpZmllZCB0byBjcmVhdGUgb25lCiAgICAgICAgICAgICAgICAkZ2V0U1BXZWJBcHBsaWNhdGlvbiA9IEdldC1TUFdlYkFwcGxpY2F0aW9uIHwgV2hlcmUtT2JqZWN0IHskXy5EaXNwbGF5TmFtZSAtZXEgJG15U2l0ZU5hbWV9CiAgICAgICAgICAgICAgICBJZiAoJGdldFNQV2ViQXBwbGljYXRpb24gLWVxICRudWxsIC1hbmQgKCRteVNpdGVXZWJBcHApKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgV2ViIEFwcCBgIiRteVNpdGVOYW1lYCIuLi4iCiAgICAgICAgICAgICAgICAgICAgIyBNSyBzdGFydAogICAgICAgICAgICAgICAgICAgICRteVNpdGVXZWJBcHAgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5XZWJBcHBsaWNhdGlvbnMuV2ViQXBwbGljYXRpb24gfCBXaGVyZSB7JF8uVHlwZSAtZXEgIk15U2l0ZUhvc3QifQogICAgICAgICAgICAgICAgICAgIENyZWF0ZVdlYkFwcCAkbXlTaXRlV2ViQXBwCiAgICAgICAgICAgICAgICAgICAgIyBOZXctU1BXZWJBcHBsaWNhdGlvbiAtTmFtZSAkbXlTaXRlTmFtZSAtQXBwbGljYXRpb25Qb29sQWNjb3VudCAkKCRteVNpdGVBcHBQb29sQWNjdC51c2VybmFtZSkgLUFwcGxpY2F0aW9uUG9vbCAkbXlTaXRlQXBwUG9vbCAtRGF0YWJhc2VTZXJ2ZXIgJG15U2l0ZURCU2VydmVyIC1EYXRhYmFzZU5hbWUgJG15U2l0ZURCIC1VcmwgJG15U2l0ZVVSTCAtUG9ydCAkbXlTaXRlUG9ydCAtU2VjdXJlU29ja2V0c0xheWVyOiRteVNpdGVVc2VTU0wgQGhvc3RIZWFkZXJTd2l0Y2ggQHBhdGhTd2l0Y2ggfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgICAgICMgTUsgZW5kCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBFbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBNeSBTaXRlIGhvc3QgYWxyZWFkeSBwcm92aXNpb25lZC4iCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBDcmVhdGUgTXlTaXRlcyBTaXRlIENvbGxlY3Rpb24KICAgICAgICAgICAgICAgIElmICgoR2V0LVNQQ29udGVudERhdGFiYXNlIHwgV2hlcmUtT2JqZWN0IHskXy5OYW1lIC1lcSAkbXlTaXRlREJ9KS1lcSAkbnVsbCAtYW5kICgkbXlTaXRlV2ViQXBwKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIENyZWF0aW5nIE15IFNpdGVzIGNvbnRlbnQgREIuLi4iCiAgICAgICAgICAgICAgICAgICAgJG5ld015U2l0ZXNEQiA9IE5ldy1TUENvbnRlbnREYXRhYmFzZSAtRGF0YWJhc2VTZXJ2ZXIgJG15U2l0ZURCU2VydmVyIC1OYW1lICRteVNpdGVEQiAtV2ViQXBwbGljYXRpb24gIiRteVNpdGVVUkxgOiRteVNpdGVQb3J0IgogICAgICAgICAgICAgICAgICAgIElmICgtbm90ICQ/KSB7IFRocm93ICIgLSBGYWlsZWQgdG8gY3JlYXRlIE15IFNpdGVzIGNvbnRlbnQgREIiIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIElmICghKEdldC1TUFNpdGUgLUxpbWl0IEFMTCB8IFdoZXJlLU9iamVjdCB7KCgkXy5VcmwgLWxpa2UgIiRteVNpdGVVUkwqIikgLWFuZCAoJF8uUG9ydCAtZXEgIiRteVNpdGVQb3J0IikpfSkgLWFuZCAoJG15U2l0ZVdlYkFwcCkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyBNeSBTaXRlcyBzaXRlIGNvbGxlY3Rpb24gJG15U2l0ZVVSTGA6JG15U2l0ZVBvcnQuLi4iCiAgICAgICAgICAgICAgICAgICAgIyBWZXJpZnkgdGhhdCB0aGUgTGFuZ3VhZ2Ugd2UncmUgdHJ5aW5nIHRvIGNyZWF0ZSB0aGUgc2l0ZSBpbiBpcyBjdXJyZW50bHkgaW5zdGFsbGVkIG9uIHRoZSBzZXJ2ZXIKICAgICAgICAgICAgICAgICAgICAkbXlTaXRlQ3VsdHVyZSA9IFtTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mb106OkdldEN1bHR1cmVJbmZvKChbY29udmVydF06OlRvSW50MzIoJG15U2l0ZUxDSUQpKSkKICAgICAgICAgICAgICAgICAgICAkbXlTaXRlQ3VsdHVyZURpc3BsYXlOYW1lID0gJG15U2l0ZUN1bHR1cmUuRGlzcGxheU5hbWUKICAgICAgICAgICAgICAgICAgICAkaW5zdGFsbGVkT2ZmaWNlU2VydmVyTGFuZ3VhZ2VzID0gKEdldC1JdGVtICJIS0xNOlxTb2Z0d2FyZVxNaWNyb3NvZnRcT2ZmaWNlIFNlcnZlclwkZW52OnNwVmVyLjBcSW5zdGFsbGVkTGFuZ3VhZ2VzIikuR2V0VmFsdWVOYW1lcygpIHwgPyB7JF8gLW5lICIifQogICAgICAgICAgICAgICAgICAgIElmICghKCRpbnN0YWxsZWRPZmZpY2VTZXJ2ZXJMYW5ndWFnZXMgfCBXaGVyZS1PYmplY3QgeyRfIC1lcSAkbXlTaXRlQ3VsdHVyZS5OYW1lfSkpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBUaHJvdyAiIC0gWW91IG11c3QgaW5zdGFsbCB0aGUgYCIkbXlTaXRlQ3VsdHVyZSAoJG15U2l0ZUN1bHR1cmVEaXNwbGF5TmFtZSlgIiBMYW5ndWFnZSBQYWNrIGJlZm9yZSB5b3UgY2FuIGNyZWF0ZSBhIHNpdGUgdXNpbmcgTENJRCAkbXlTaXRlTENJRCIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgRWxzZQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG5ld015U2l0ZXNDb2xsZWN0aW9uID0gTmV3LVNQU2l0ZSAtVXJsICIkbXlTaXRlVVJMYDokbXlTaXRlUG9ydCIgLU93bmVyQWxpYXMgJGZhcm1BY2N0IC1TZWNvbmRhcnlPd25lckFsaWFzICRlbnY6VVNFUkRPTUFJTlwkZW52OlVTRVJOQU1FIC1Db250ZW50RGF0YWJhc2UgJG15U2l0ZURCIC1EZXNjcmlwdGlvbiAkbXlTaXRlTmFtZSAtTmFtZSAkbXlTaXRlTmFtZSAtVGVtcGxhdGUgJG15U2l0ZVRlbXBsYXRlIC1MYW5ndWFnZSAkbXlTaXRlTENJRCB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICAgICAgICAgIElmICgtbm90ICQ/KSB7VGhyb3cgIiAtIEZhaWxlZCB0byBjcmVhdGUgTXkgU2l0ZXMgc2l0ZSBjb2xsZWN0aW9uIn0KICAgICAgICAgICAgICAgICAgICAgICAgIyBBc3NpZ24gU1NMIGNlcnRpZmljYXRlLCBpZiByZXF1aXJlZAogICAgICAgICAgICAgICAgICAgICAgICBJZiAoJG15U2l0ZVVzZVNTTCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBTdHJpcCBvdXQgYW55IHByb3RvY29sIGFuZC9vciBwb3J0IHZhbHVlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFNTTEhvc3RIZWFkZXIsJG51bGwgPSAkbXlTaXRlSG9zdExvY2F0aW9uIC1yZXBsYWNlICJodHRwOi8vIiwiIiAtcmVwbGFjZSAiaHR0cHM6Ly8iLCIiIC1zcGxpdCAiOiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTU0xQb3J0ID0gJG15U2l0ZVBvcnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTU0xTaXRlTmFtZSA9ICRteVNpdGVOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKChHZXQtV21pT2JqZWN0IFdpbjMyX09wZXJhdGluZ1N5c3RlbSkuVmVyc2lvbiAtbGlrZSAiNi4yKiIgLW9yIChHZXQtV21pT2JqZWN0IFdpbjMyX09wZXJhdGluZ1N5c3RlbSkuVmVyc2lvbiAtbGlrZSAiNi4zKiIpIC1hbmQgKCRlbnY6c3BWZXIgLWVxICIxNCIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gQXNzaWduaW5nIGNlcnRpZmljYXRlKHMpIGluIGEgc2VwYXJhdGUgUG93ZXJTaGVsbCB3aW5kb3cuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAtRmlsZVBhdGggIiRQU0hPTUVccG93ZXJzaGVsbC5leGUiIC1WZXJiIFJ1bkFzIC1Bcmd1bWVudExpc3QgIi1Db21tYW5kIGAiLiAkZW52OmRwMFxBdXRvU1BJbnN0YWxsZXJGdW5jdGlvbnMucHMxYDsgQXNzaWduQ2VydCAkU1NMSG9zdEhlYWRlciAkU1NMUG9ydCAkU1NMU2l0ZU5hbWU7IFN0YXJ0LVNsZWVwIDEwYCIiIC1XYWl0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtBc3NpZ25DZXJ0ICRTU0xIb3N0SGVhZGVyICRTU0xQb3J0ICRTU0xTaXRlTmFtZX0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIENyZWF0ZSBTZXJ2aWNlIEFwcAogICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyAkdXNlclByb2ZpbGVTZXJ2aWNlTmFtZS4uLiIKICAgICAgICAgICAgICAgIENyZWF0ZVVQU0FzQWRtaW4gJHhtbGlucHV0CiAgICAgICAgICAgICAgICBsb2cgIiAtIFdhaXRpbmcgZm9yICR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lLi4uIiAKICAgICAgICAgICAgICAgICRwcm9maWxlU2VydmljZUFwcCA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8P3skXy5EaXNwbGF5TmFtZSAtZXEgJHVzZXJQcm9maWxlU2VydmljZU5hbWV9CiAgICAgICAgICAgICAgICBXaGlsZSAoJHByb2ZpbGVTZXJ2aWNlQXBwLlN0YXR1cyAtbmUgIk9ubGluZSIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgW2ludF0kVVBTV2FpdFRpbWUgPSAwCiAgICAgICAgICAgICAgICAgICAgIyBXYWl0IDIgbWludXRlcyBmb3IgZWl0aGVyIHRoZSBVUFMgdG8gYmUgY3JlYXRlZCwgb3IgdGhlIFVBQyBwcm9tcHQgdG8gdGltZSBvdXQKICAgICAgICAgICAgICAgICAgICBXaGlsZSAoKCRVUFNXYWl0VGltZSAtbHQgMTIwKSAtYW5kICgkcHJvZmlsZVNlcnZpY2VBcHAuU3RhdHVzIC1uZSAiT25saW5lIikpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIi4iIAogICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAxCiAgICAgICAgICAgICAgICAgICAgICAgICRwcm9maWxlU2VydmljZUFwcCA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8P3skXy5EaXNwbGF5TmFtZSAtZXEgJHVzZXJQcm9maWxlU2VydmljZU5hbWV9CiAgICAgICAgICAgICAgICAgICAgICAgIFtpbnRdJFVQU1dhaXRUaW1lICs9IDEKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgIyBJZiBpdCBzdGlsbCBpc24ndCBPbmxpbmUgYWZ0ZXIgMiBtaW51dGVzLCBwcm9tcHQgdG8gdHJ5IGFnYWluCiAgICAgICAgICAgICAgICAgICAgSWYgKCEoJHByb2ZpbGVTZXJ2aWNlQXBwKSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiLiIKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJXQVJOSU5HOlRpbWVkIG91dCB3YWl0aW5nIGZvciBzZXJ2aWNlIGNyZWF0aW9uIChtYXliZSBhIFVBQyBwcm9tcHQ/KSIKICAgICAgICAgICAgICAgICAgICAgICAgIyBNSzogCiAgICAgICAgICAgICAgICAgICAgICAgICMgV3JpdGUtSG9zdCAiYGFgYWBhIiAjIFN5c3RlbSBiZWVwcwogICAgICAgICAgICAgICAgICAgICAgICBQYXVzZSAidHJ5IGFnYWluIgogICAgICAgICAgICAgICAgICAgICAgICBDcmVhdGVVUFNBc0FkbWluICR4bWxpbnB1dAogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFdhaXRpbmcgZm9yICR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lLi4uIiAKICAgICAgICAgICAgICAgICAgICAgICAgJHByb2ZpbGVTZXJ2aWNlQXBwID0gR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uIHw/eyRfLkRpc3BsYXlOYW1lIC1lcSAkdXNlclByb2ZpbGVTZXJ2aWNlTmFtZX0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgRWxzZSB7YnJlYWt9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2cgJCgkcHJvZmlsZVNlcnZpY2VBcHAuU3RhdHVzKQogICAgICAgICAgICAgICAgIyBXYWl0IGEgZmV3IHNlY29uZHMgZm9yIHRoZSBDcmVhdGVVUFNBc0FkbWluIGZ1bmN0aW9uIHRvIGNvbXBsZXRlCiAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAzMAoKICAgICAgICAgICAgICAgICMgR2V0IG91ciBuZXcgUHJvZmlsZSBTZXJ2aWNlIEFwcAogICAgICAgICAgICAgICAgJHByb2ZpbGVTZXJ2aWNlQXBwID0gR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uIHw/eyRfLkRpc3BsYXlOYW1lIC1lcSAkdXNlclByb2ZpbGVTZXJ2aWNlTmFtZX0KICAgICAgICAgICAgICAgIElmICghKCRwcm9maWxlU2VydmljZUFwcCkpIHtUaHJvdyAiIC0gQ291bGQgbm90IGdldCAkdXNlclByb2ZpbGVTZXJ2aWNlTmFtZSEiO30KCiAgICAgICAgICAgICAgICAjIENyZWF0ZSBQcm94eQogICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyAkdXNlclByb2ZpbGVTZXJ2aWNlTmFtZSBQcm94eS4uLiIKICAgICAgICAgICAgICAgICRwcm9maWxlU2VydmljZUFwcFByb3h5ID0gTmV3LVNQUHJvZmlsZVNlcnZpY2VBcHBsaWNhdGlvblByb3h5IC1OYW1lICIkdXNlclByb2ZpbGVTZXJ2aWNlUHJveHlOYW1lIiAtU2VydmljZUFwcGxpY2F0aW9uICRwcm9maWxlU2VydmljZUFwcCAtRGVmYXVsdFByb3h5R3JvdXAKICAgICAgICAgICAgICAgIElmICgtbm90ICQ/KSB7IFRocm93ICIgLSBGYWlsZWQgdG8gY3JlYXRlICR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lIFByb3h5IiB9CgogICAgICAgICAgICAgICAgbG9nICIgLSBHcmFudGluZyByaWdodHMgdG8gKCR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lKToiCiAgICAgICAgICAgICAgICAjIENyZWF0ZSBhIHZhcmlhYmxlIHRoYXQgY29udGFpbnMgdGhlIGd1aWQgZm9yIHRoZSBVc2VyIFByb2ZpbGUgc2VydmljZSBmb3Igd2hpY2ggeW91IHdhbnQgdG8gZGVsZWdhdGUgcGVybWlzc2lvbnMKICAgICAgICAgICAgICAgICRzZXJ2aWNlQXBwSURUb1NlY3VyZSA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiAkKCRwcm9maWxlU2VydmljZUFwcC5JZCkKCiAgICAgICAgICAgICAgICAjIENyZWF0ZSBhIHZhcmlhYmxlIHRoYXQgY29udGFpbnMgdGhlIGxpc3Qgb2YgYWRtaW5pc3RyYXRvcnMgZm9yIHRoZSBzZXJ2aWNlIGFwcGxpY2F0aW9uCiAgICAgICAgICAgICAgICAkcHJvZmlsZVNlcnZpY2VBcHBTZWN1cml0eSA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvblNlY3VyaXR5ICRzZXJ2aWNlQXBwSURUb1NlY3VyZSAtQWRtaW4KICAgICAgICAgICAgICAgICMgQ3JlYXRlIGEgdmFyaWFibGUgdGhhdCBjb250YWlucyB0aGUgcGVybWlzc2lvbnMgZm9yIHRoZSBzZXJ2aWNlIGFwcGxpY2F0aW9uCiAgICAgICAgICAgICAgICAkcHJvZmlsZVNlcnZpY2VBcHBQZXJtaXNzaW9ucyA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvblNlY3VyaXR5ICRzZXJ2aWNlQXBwSURUb1NlY3VyZQoKICAgICAgICAgICAgICAgICMgQ3JlYXRlIHZhcmlhYmxlcyB0aGF0IGNvbnRhaW5zIHRoZSBjbGFpbXMgcHJpbmNpcGFscyBmb3IgY3VycmVudCAoU2V0dXApIHVzZXIsIGdlbnJhbCBzZXJ2aWNlIGFjY291bnQsIE15U2l0ZSBBcHAgUG9vbCwgUG9ydGFsIEFwcCBQb29sIGFuZCBDb250ZW50IEFjY2VzcyBhY2NvdW50cwogICAgICAgICAgICAgICAgIyBUaGVuIGdpdmUgJ0Z1bGwgQ29udHJvbCcgcGVybWlzc2lvbnMgdG8gdGhlIGN1cnJlbnQgKFNldHVwKSB1c2VyLCBnZW5lcmFsIHNlcnZpY2UgYWNjb3VudCwgTXlTaXRlIEFwcCBQb29sLCBQb3J0YWwgQXBwIFBvb2wgYWNjb3VudCBhbmQgY29udGVudCBhY2Nlc3MgYWNjb3VudCBjbGFpbXMgcHJpbmNpcGFscwogICAgICAgICAgICAgICAgJGN1cnJlbnRVc2VyQWNjdFByaW5jaXBhbCA9IE5ldy1TUENsYWltc1ByaW5jaXBhbCAtSWRlbnRpdHkgJGVudjpVU0VSRE9NQUlOXCRlbnY6VVNFUk5BTUUgLUlkZW50aXR5VHlwZSBXaW5kb3dzU2FtQWNjb3VudE5hbWUKICAgICAgICAgICAgICAgICRzcFNlcnZpY2VBY2N0UHJpbmNpcGFsID0gTmV3LVNQQ2xhaW1zUHJpbmNpcGFsIC1JZGVudGl0eSAkKCRzcHNlcnZpY2UudXNlcm5hbWUpIC1JZGVudGl0eVR5cGUgV2luZG93c1NhbUFjY291bnROYW1lCiAgICAgICAgICAgICAgICBHcmFudC1TUE9iamVjdFNlY3VyaXR5ICRwcm9maWxlU2VydmljZUFwcFNlY3VyaXR5IC1QcmluY2lwYWwgJGN1cnJlbnRVc2VyQWNjdFByaW5jaXBhbCAtUmlnaHRzICJGdWxsIENvbnRyb2wiCiAgICAgICAgICAgICAgICBHcmFudC1TUE9iamVjdFNlY3VyaXR5ICRwcm9maWxlU2VydmljZUFwcFBlcm1pc3Npb25zIC1QcmluY2lwYWwgJGN1cnJlbnRVc2VyQWNjdFByaW5jaXBhbCAtUmlnaHRzICJGdWxsIENvbnRyb2wiCiAgICAgICAgICAgICAgICBHcmFudC1TUE9iamVjdFNlY3VyaXR5ICRwcm9maWxlU2VydmljZUFwcFBlcm1pc3Npb25zIC1QcmluY2lwYWwgJHNwU2VydmljZUFjY3RQcmluY2lwYWwgLVJpZ2h0cyAiRnVsbCBDb250cm9sIgogICAgICAgICAgICAgICAgSWYgKCRteVNpdGVBcHBQb29sQWNjdCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSAkKCRteVNpdGVBcHBQb29sQWNjdC51c2VybmFtZSkuLi4iCiAgICAgICAgICAgICAgICAgICAgJG15U2l0ZUFwcFBvb2xBY2N0UHJpbmNpcGFsID0gTmV3LVNQQ2xhaW1zUHJpbmNpcGFsIC1JZGVudGl0eSAkKCRteVNpdGVBcHBQb29sQWNjdC51c2VybmFtZSkgLUlkZW50aXR5VHlwZSBXaW5kb3dzU2FtQWNjb3VudE5hbWUKICAgICAgICAgICAgICAgICAgICBHcmFudC1TUE9iamVjdFNlY3VyaXR5ICRwcm9maWxlU2VydmljZUFwcFNlY3VyaXR5IC1QcmluY2lwYWwgJG15U2l0ZUFwcFBvb2xBY2N0UHJpbmNpcGFsIC1SaWdodHMgIkZ1bGwgQ29udHJvbCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIElmICgkcG9ydGFsQXBwUG9vbEFjY3QpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgIC0gJCgkcG9ydGFsQXBwUG9vbEFjY3QudXNlcm5hbWUpLi4uIgogICAgICAgICAgICAgICAgICAgICRwb3J0YWxBcHBQb29sQWNjdFByaW5jaXBhbCA9IE5ldy1TUENsYWltc1ByaW5jaXBhbCAtSWRlbnRpdHkgJCgkcG9ydGFsQXBwUG9vbEFjY3QudXNlcm5hbWUpIC1JZGVudGl0eVR5cGUgV2luZG93c1NhbUFjY291bnROYW1lCiAgICAgICAgICAgICAgICAgICAgR3JhbnQtU1BPYmplY3RTZWN1cml0eSAkcHJvZmlsZVNlcnZpY2VBcHBTZWN1cml0eSAtUHJpbmNpcGFsICRwb3J0YWxBcHBQb29sQWNjdFByaW5jaXBhbCAtUmlnaHRzICJGdWxsIENvbnRyb2wiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBJZiAoJGNvbnRlbnRBY2Nlc3NBY2NvdW50cykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkY29udGVudEFjY2Vzc0FjY3QgaW4gJGNvbnRlbnRBY2Nlc3NBY2NvdW50cykKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgR2l2ZSAnUmV0cmlldmUgUGVvcGxlIERhdGEgZm9yIFNlYXJjaCBDcmF3bGVycycgcGVybWlzc2lvbnMgdG8gdGhlIENvbnRlbnQgQWNjZXNzIGNsYWltcyBwcmluY2lwYWwKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgIC0gJGNvbnRlbnRBY2Nlc3NBY2N0Li4uIgogICAgICAgICAgICAgICAgICAgICAgICAkY29udGVudEFjY2Vzc0FjY3RQcmluY2lwYWwgPSBOZXctU1BDbGFpbXNQcmluY2lwYWwgLUlkZW50aXR5ICRjb250ZW50QWNjZXNzQWNjdCAtSWRlbnRpdHlUeXBlIFdpbmRvd3NTYW1BY2NvdW50TmFtZQogICAgICAgICAgICAgICAgICAgICAgICBHcmFudC1TUE9iamVjdFNlY3VyaXR5ICRwcm9maWxlU2VydmljZUFwcFNlY3VyaXR5IC1QcmluY2lwYWwgJGNvbnRlbnRBY2Nlc3NBY2N0UHJpbmNpcGFsIC1SaWdodHMgIlJldHJpZXZlIFBlb3BsZSBEYXRhIGZvciBTZWFyY2ggQ3Jhd2xlcnMiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgQXBwbHkgdGhlIGNoYW5nZXMgdG8gdGhlIFVzZXIgUHJvZmlsZSBzZXJ2aWNlIGFwcGxpY2F0aW9uCiAgICAgICAgICAgICAgICBTZXQtU1BTZXJ2aWNlQXBwbGljYXRpb25TZWN1cml0eSAkc2VydmljZUFwcElEVG9TZWN1cmUgLW9iamVjdFNlY3VyaXR5ICRwcm9maWxlU2VydmljZUFwcFNlY3VyaXR5IC1BZG1pbgogICAgICAgICAgICAgICAgU2V0LVNQU2VydmljZUFwcGxpY2F0aW9uU2VjdXJpdHkgJHNlcnZpY2VBcHBJRFRvU2VjdXJlIC1vYmplY3RTZWN1cml0eSAkcHJvZmlsZVNlcnZpY2VBcHBQZXJtaXNzaW9ucwogICAgICAgICAgICAgICAgbG9nICIgLSBEb25lIGdyYW50aW5nIHJpZ2h0cy4iCgogICAgICAgICAgICAgICAgIyBBZGQgbGluayB0byByZXNvdXJjZXMgbGlzdAogICAgICAgICAgICAgICAgQWRkUmVzb3VyY2VzTGluayAiVXNlciBQcm9maWxlIEFkbWluaXN0cmF0aW9uIiAoIl9sYXlvdXRzL01hbmFnZVVzZXJQcm9maWxlU2VydmljZUFwcGxpY2F0aW9uLmFzcHg/QXBwbGljYXRpb25JRD0iICsgICRwcm9maWxlU2VydmljZUFwcC5JZCkKCiAgICAgICAgICAgICAgICBJZiAoJHBvcnRhbEFwcFBvb2xBY2N0KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICMgR3JhbnQgdGhlIFBvcnRhbCBBcHAgUG9vbCBhY2NvdW50IHJpZ2h0cyB0byB0aGUgUHJvZmlsZSBhbmQgU29jaWFsIERCcwogICAgICAgICAgICAgICAgICAgICRwcm9maWxlREIgPSAkZGJQcmVmaXgrJHVzZXJQcm9maWxlLkRhdGFiYXNlLlByb2ZpbGVEQgogICAgICAgICAgICAgICAgICAgICRzb2NpYWxEQiA9ICRkYlByZWZpeCskdXNlclByb2ZpbGUuRGF0YWJhc2UuU29jaWFsREIKICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIEdyYW50aW5nICQoJHBvcnRhbEFwcFBvb2xBY2N0LnVzZXJuYW1lKSByaWdodHMgdG8gJG15U2l0ZURCLi4uIgogICAgICAgICAgICAgICAgICAgIEdldC1TUERhdGFiYXNlIHwgPyB7JF8uTmFtZSAtZXEgJG15U2l0ZURCfSB8IEFkZC1TUFNoZWxsQWRtaW4gLVVzZXJOYW1lICQoJHBvcnRhbEFwcFBvb2xBY2N0LnVzZXJuYW1lKQogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gR3JhbnRpbmcgJCgkcG9ydGFsQXBwUG9vbEFjY3QudXNlcm5hbWUpIHJpZ2h0cyB0byAkcHJvZmlsZURCLi4uIgogICAgICAgICAgICAgICAgICAgIEdldC1TUERhdGFiYXNlIHwgPyB7JF8uTmFtZSAtZXEgJHByb2ZpbGVEQn0gfCBBZGQtU1BTaGVsbEFkbWluIC1Vc2VyTmFtZSAkKCRwb3J0YWxBcHBQb29sQWNjdC51c2VybmFtZSkKICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIEdyYW50aW5nICQoJHBvcnRhbEFwcFBvb2xBY2N0LnVzZXJuYW1lKSByaWdodHMgdG8gJHNvY2lhbERCLi4uIgogICAgICAgICAgICAgICAgICAgIEdldC1TUERhdGFiYXNlIHwgPyB7JF8uTmFtZSAtZXEgJHNvY2lhbERCfSB8IEFkZC1TUFNoZWxsQWRtaW4gLVVzZXJOYW1lICQoJHBvcnRhbEFwcFBvb2xBY2N0LnVzZXJuYW1lKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbG9nICIgLSBFbmFibGluZyB0aGUgQWN0aXZpdHkgRmVlZCBUaW1lciBKb2IuLiIKICAgICAgICAgICAgICAgIElmICgkcHJvZmlsZVNlcnZpY2VBcHApIHtHZXQtU1BUaW1lckpvYiB8ID8geyRfLlR5cGVOYW1lIC1lcSAiTWljcm9zb2Z0Lk9mZmljZS5TZXJ2ZXIuQWN0aXZpdHlGZWVkLkFjdGl2aXR5RmVlZFVQQUpvYiJ9IHwgRW5hYmxlLVNQVGltZXJKb2J9CgogICAgICAgICAgICAgICAgbG9nICIgLSBEb25lIGNyZWF0aW5nICR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lLiIKICAgICAgICAgICAgfQogICAgICAgICAgICAjIFN0YXJ0IFVzZXIgUHJvZmlsZSBTeW5jaHJvbml6YXRpb24gU2VydmljZQogICAgICAgICAgICAjIEdldCBVc2VyIFByb2ZpbGUgU2VydmljZQogICAgICAgICAgICAkcHJvZmlsZVNlcnZpY2VBcHAgPSBHZXQtU1BTZXJ2aWNlQXBwbGljYXRpb24gfD97JF8uRGlzcGxheU5hbWUgLWVxICR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lfQogICAgICAgICAgICBJZiAoJHByb2ZpbGVTZXJ2aWNlQXBwIC1hbmQgKCR1c2VyUHJvZmlsZS5TdGFydFByb2ZpbGVTeW5jIC1lcSAkdHJ1ZSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIElmICgkdXNlclByb2ZpbGUuRW5hYmxlTmV0QklPU0RvbWFpbk5hbWVzIC1lcSAkdHJ1ZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIEVuYWJsaW5nIE5ldEJJT1MgZG9tYWluIG5hbWVzIGZvciAkdXNlclByb2ZpbGVTZXJ2aWNlTmFtZS4uLiIKICAgICAgICAgICAgICAgICAgICAkcHJvZmlsZVNlcnZpY2VBcHAuTmV0QklPU0RvbWFpbk5hbWVzRW5hYmxlZCA9IDEKICAgICAgICAgICAgICAgICAgICAkcHJvZmlsZVNlcnZpY2VBcHAuVXBkYXRlKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICMgR2V0IFVzZXIgUHJvZmlsZSBTeW5jaHJvbml6YXRpb24gU2VydmljZQogICAgICAgICAgICAgICAgbG9nICIgLSBDaGVja2luZyBVc2VyIFByb2ZpbGUgU3luY2hyb25pemF0aW9uIFNlcnZpY2UuLi4iIAogICAgICAgICAgICAgICAgaWYgKCRlbnY6U1BWZXIgLWx0ICIxNiIpICMgU2luY2UgVXNlciBQcm9maWxlIFN5bmMgc2VlbXMgdG8gb25seSBhcHBseSB0byBTUDIwMTAvMjAxMwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRwcm9maWxlU3luY1NlcnZpY2VzID0gQChHZXQtU1BTZXJ2aWNlSW5zdGFuY2UgfCA/IHskXy5HZXRUeXBlKCkuVG9TdHJpbmcoKSAtZXEgIk1pY3Jvc29mdC5PZmZpY2UuU2VydmVyLkFkbWluaXN0cmF0aW9uLlByb2ZpbGVTeW5jaHJvbml6YXRpb25TZXJ2aWNlSW5zdGFuY2UifSkKICAgICAgICAgICAgICAgICAgICAkcHJvZmlsZVN5bmNTZXJ2aWNlID0gJHByb2ZpbGVTeW5jU2VydmljZXMgfCA/IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5QYXJlbnQuQWRkcmVzcyAkZW52OkNPTVBVVEVSTkFNRX0KICAgICAgICAgICAgICAgICAgICAjIEF0dGVtcHQgdG8gc3RhcnQgb25seSBpZiB0aGVyZSBhcmUgbm8gb25saW5lIFByb2ZpbGUgU3luYyBTZXJ2aWNlIGluc3RhbmNlcyBpbiB0aGUgZmFybSBhcyB3ZSBkb24ndCB3YW50IHRvIHN0YXJ0IG11bHRpcGxlIFN5bmMgaW5zdGFuY2VzIChydW5uaW5nIGFnYWluc3QgdGhlIHNhbWUgUHJvZmlsZSBTZXJ2aWNlIGF0IGxlYXN0KQogICAgICAgICAgICAgICAgICAgIElmICghKCRwcm9maWxlU3luY1NlcnZpY2VzIHwgPyB7JF8uU3RhdHVzIC1lcSAiT25saW5lIn0pKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBJbnNwaXJlZCBieSBodHRwOi8vdGVjaG5ldC5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvZWU3MjEwNDkuYXNweAogICAgICAgICAgICAgICAgICAgICAgICBJZiAoISgkZmFybUFjY3QpKSB7JGZhcm1BY2N0ID0gKEdldC1TUEZhcm0pLkRlZmF1bHRTZXJ2aWNlQWNjb3VudH0KICAgICAgICAgICAgICAgICAgICAgICAgSWYgKCEoJGZhcm1BY2N0UFdEKSkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJgbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmYXJtQWNjdFBXRCA9IFJlYWQtSG9zdCAtUHJvbXB0ICIgLSBQbGVhc2UgKHJlLSllbnRlciB0aGUgRmFybSBBY2NvdW50IFBhc3N3b3JkIiAtQXNTZWN1cmVTdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBsb2cgImBuIgogICAgICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGZvciBhbiBleGlzdGluZyBVUFMgY3JlZGVudGlhbHMgdGltZXIgam9iIChlLmcuIGZyb20gYSBwcmlvciBwcm92aXNpb25pbmcgYXR0ZW1wdCksIGFuZCBkZWxldGUgaXQKICAgICAgICAgICAgICAgICAgICAgICAgJFVQU0NyZWRlbnRpYWxzSm9iID0gR2V0LVNQVGltZXJKb2IgfCA/IHskXy5OYW1lIC1lcSAid2luZG93cy1zZXJ2aWNlLWNyZWRlbnRpYWxzLUZJTVN5bmNocm9uaXphdGlvblNlcnZpY2UifQogICAgICAgICAgICAgICAgICAgICAgICBJZiAoJFVQU0NyZWRlbnRpYWxzSm9iLlN0YXR1cyAtZXEgIk9ubGluZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gRGVsZXRpbmcgZXhpc3Rpbmcgc3luYyBjcmVkZW50aWFscyB0aW1lciBqb2IuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVVBTQ3JlZGVudGlhbHNKb2IuRGVsZXRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBNSzogc3RhcnQgc3luY2ggc2VydmljZSBtdXN0IHJ1biB1bmRlciBmYXJtIGFjY291bnQgaWRlbnRpdHkKICAgICAgICAgICAgICAgICAgICAgICAgJGZhcm1BY2N0ID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5BY2NvdW50LlVzZXJuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICMgVXBkYXRlUHJvY2Vzc0lkZW50aXR5ICRwcm9maWxlU3luY1NlcnZpY2UKICAgICAgICAgICAgICAgICAgICAgICAgVXBkYXRlUHJvY2Vzc0lkZW50aXR5VG9SdW5BcyAgJHByb2ZpbGVTeW5jU2VydmljZSAkZmFybUFjY3QKICAgICAgICAgICAgICAgICAgICAgICAgIyBNSzogZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAkcHJvZmlsZVN5bmNTZXJ2aWNlLlVwZGF0ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gV2FpdGluZyBmb3IgVXNlciBQcm9maWxlIFN5bmNocm9uaXphdGlvbiBTZXJ2aWNlLi4uIiAKICAgICAgICAgICAgICAgICAgICAgICAgIyBQcm92aXNpb24gdGhlIFVzZXIgUHJvZmlsZSBTeW5jIFNlcnZpY2UKICAgICAgICAgICAgICAgICAgICAgICAgJHByb2ZpbGVTZXJ2aWNlQXBwLlNldFN5bmNocm9uaXphdGlvbk1hY2hpbmUoJGVudjpDT01QVVRFUk5BTUUsICRwcm9maWxlU3luY1NlcnZpY2UuSWQsICRmYXJtQWNjdCwgKENvbnZlcnRUby1QbGFpblRleHQgJGZhcm1BY2N0UFdEKSkKICAgICAgICAgICAgICAgICAgICAgICAgSWYgKCgkcHJvZmlsZVN5bmNTZXJ2aWNlLlN0YXR1cyAtbmUgIlByb3Zpc2lvbmluZyIpIC1hbmQgKCRwcm9maWxlU3luY1NlcnZpY2UuU3RhdHVzIC1uZSAiT25saW5lIikpIHtsb2cgImBuIC0gV2FpdGluZyBmb3IgVXNlciBQcm9maWxlIFN5bmNocm9uaXphdGlvbiBTZXJ2aWNlIHRvIHN0YXJ0Li4uIiB9CiAgICAgICAgICAgICAgICAgICAgICAgICMgTW9uaXRvciBVc2VyIFByb2ZpbGUgU3luYyBzZXJ2aWNlIHN0YXR1cwogICAgICAgICAgICAgICAgICAgICAgICBXaGlsZSAoJHByb2ZpbGVTeW5jU2VydmljZS5TdGF0dXMgLW5lICJPbmxpbmUiKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXaGlsZSAoJHByb2ZpbGVTeW5jU2VydmljZS5TdGF0dXMgLW5lICJQcm92aXNpb25pbmciKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiLiIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwcm9maWxlU3luY1NlcnZpY2UgPSBAKEdldC1TUFNlcnZpY2VJbnN0YW5jZSB8ID8geyRfLkdldFR5cGUoKS5Ub1N0cmluZygpIC1lcSAiTWljcm9zb2Z0Lk9mZmljZS5TZXJ2ZXIuQWRtaW5pc3RyYXRpb24uUHJvZmlsZVN5bmNocm9uaXphdGlvblNlcnZpY2VJbnN0YW5jZSJ9KSB8ID8ge01hdGNoQ29tcHV0ZXJOYW1lICRfLlBhcmVudC5BZGRyZXNzICRlbnY6Q09NUFVURVJOQU1FfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgKCRwcm9maWxlU3luY1NlcnZpY2UuU3RhdHVzIC1lcSAiUHJvdmlzaW9uaW5nIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgJCgkcHJvZmlsZVN5bmNTZXJ2aWNlLlN0YXR1cykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFByb3Zpc2lvbmluZyBVc2VyIFByb2ZpbGUgU3luYyBTZXJ2aWNlLCBwbGVhc2Ugd2FpdC4uLiIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXaGlsZSgkcHJvZmlsZVN5bmNTZXJ2aWNlLlN0YXR1cyAtZXEgIlByb3Zpc2lvbmluZyIgLWFuZCAkcHJvZmlsZVN5bmNTZXJ2aWNlLlN0YXR1cyAtbmUgIkRpc2FibGVkIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIi4iIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJvZmlsZVN5bmNTZXJ2aWNlID0gQChHZXQtU1BTZXJ2aWNlSW5zdGFuY2UgfCA/IHskXy5HZXRUeXBlKCkuVG9TdHJpbmcoKSAtZXEgIk1pY3Jvc29mdC5PZmZpY2UuU2VydmVyLkFkbWluaXN0cmF0aW9uLlByb2ZpbGVTeW5jaHJvbml6YXRpb25TZXJ2aWNlSW5zdGFuY2UifSkgfCA/IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5QYXJlbnQuQWRkcmVzcyAkZW52OkNPTVBVVEVSTkFNRX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmICgkcHJvZmlsZVN5bmNTZXJ2aWNlLlN0YXR1cyAtbmUgIk9ubGluZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIuYGFgYSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFVzZXIgUHJvZmlsZSBTeW5jaHJvbml6YXRpb24gU2VydmljZSBjb3VsZCBub3QgYmUgc3RhcnRlZCEiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgJCgkcHJvZmlsZVN5bmNTZXJ2aWNlLlN0YXR1cykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE5lZWQgdG8gcmVjeWNsZSB0aGUgQ2VudHJhbCBBZG1pbiBhcHAgcG9vbCBiZWZvcmUgd2UgY2FuIGRvIGFueXRoaW5nIHdpdGggdGhlIFVzZXIgUHJvZmlsZSBTeW5jIFNlcnZpY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFJlY3ljbGluZyBDZW50cmFsIEFkbWluIGFwcCBwb29sLi4uIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgRnJvbSBodHRwOi8vc2hhcmVwb2ludC5uYXVwbGl1cy5uZXQvMjAxMS8wOS9paXNyZXNldC1ub3QtcmVxdWlyZWQtYWZ0ZXItc3RhcnRpbmcuaHRtbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHBQb29sID0gZ3dtaSAtTmFtZXNwYWNlICJyb290XE1pY3Jvc29mdElJU3YyIiAtY2xhc3MgIklJc0FwcGxpY2F0aW9uUG9vbCIgfCB3aGVyZSB7JF8uTmFtZSAtZXEgIlczU1ZDL0FQUFBPT0xTL1NoYXJlUG9pbnQgQ2VudHJhbCBBZG1pbmlzdHJhdGlvbiB2NCJ9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgKCRhcHBQb29sKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcFBvb2wuUmVjeWNsZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuZXdseVByb3Zpc2lvbmVkU3luYyA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICMgQXR0ZW1wdCB0byBjcmVhdGUgYSBzeW5jIGNvbm5lY3Rpb24gb25seSBvbiBhIHN1Y2Nlc3NmdWwsIG5ld2x5LXByb3Zpc2lvbmVkIFVzZXIgUHJvZmlsZSBTeW5jIHNlcnZpY2UKICAgICAgICAgICAgICAgICAgICAgICAgIyBXZSBkb24ndCBoYXZlIHRoZSBhYmlsaXR5IHRvIGNoZWNrIGZvciBleGlzdGluZyBjb25uZWN0aW9ucyBhbmQgd2UgZG9uJ3Qgd2FudCB0byBvdmVyd3JpdGUvZHVwbGljYXRlIGFueSBleGlzdGluZyBzeW5jIGNvbm5lY3Rpb25zCiAgICAgICAgICAgICAgICAgICAgICAgICMgTm90ZSB0aGF0IHRoaXMgaXNuJ3QgcmVhbGx5IHN1cHBvcnRlZCBhbnlob3csIGFuZCB0aGF0IG9ubHkgU2hhcmVQb2ludCAyMDEwIFNlcnZpY2UgUGFjayAxIGFuZCBhYm92ZSBpbmNsdWRlcyB0aGUgQWRkLVNQUHJvZmlsZVN5bmNDb25uZWN0aW9uIGNtZGxldAogICAgICAgICAgICAgICAgICAgICAgICBJZiAoKENoZWNrRm9yMjAxMFNQMSkgLWFuZCAoJHVzZXJQcm9maWxlLkNyZWF0ZURlZmF1bHRTeW5jQ29ubmVjdGlvbiAtZXEgJHRydWUpIC1hbmQgKCRuZXdseVByb3Zpc2lvbmVkU3luYyAtZXEgJHRydWUpKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIENyZWF0aW5nIGEgZGVmYXVsdCBQcm9maWxlIFN5bmMgY29ubmVjdGlvbi4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwcm9maWxlU2VydmljZUFwcCA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8P3skXy5EaXNwbGF5TmFtZSAtZXEgJHVzZXJQcm9maWxlU2VydmljZU5hbWV9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFRoYW5rcyB0byBDb2RlcGxleCB1c2VyIFJlc2hldGtvdiBmb3IgdGhpcyBpbmdlbmlvdXMgb25lLWxpbmVyIHRvIGJ1aWxkIHRoZSBkZWZhdWx0IGRvbWFpbiBPVQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbm5lY3Rpb25TeW5jT1UgPSAiREM9IiskZW52OlVTRVJETlNET01BSU4gLXJlcGxhY2UgIlwuIiwiLERDPSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzeW5jQ29ubmVjdGlvbkRvbWFpbiwkc3luY0Nvbm5lY3Rpb25BY2N0ID0gKCR1c2VyUHJvZmlsZS5TeW5jQ29ubmVjdGlvbkFjY291bnQpIC1zcGxpdCAiXFwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWRkUHJvZmlsZVN5bmNDbWQgPSBAIgpBZGQtUHNTbmFwaW4gTWljcm9zb2Z0LlNoYXJlUG9pbnQuUG93ZXJTaGVsbApsb2cgIiAtIENyZWF0aW5nIGRlZmF1bHQgU3luYyBjb25uZWN0aW9uLi4uIgpgJHN5bmNDb25uZWN0aW9uQWNjdFBXRCA9IChDb252ZXJ0VG8tU2VjdXJlU3RyaW5nIC1TdHJpbmcgYCckKCR1c2VyUHJvZmlsZS5TeW5jQ29ubmVjdGlvbkFjY291bnRQYXNzd29yZClgJyAtQXNQbGFpblRleHQgLUZvcmNlKQpBZGQtU1BQcm9maWxlU3luY0Nvbm5lY3Rpb24gLVByb2ZpbGVTZXJ2aWNlQXBwbGljYXRpb24gJCgkcHJvZmlsZVNlcnZpY2VBcHAuSWQpIC1Db25uZWN0aW9uRm9yZXN0TmFtZSAkZW52OlVTRVJETlNET01BSU4gLUNvbm5lY3Rpb25Eb21haW4gJHN5bmNDb25uZWN0aW9uRG9tYWluIC1Db25uZWN0aW9uVXNlck5hbWUgIiRzeW5jQ29ubmVjdGlvbkFjY3QiIC1Db25uZWN0aW9uU3luY2hyb25pemF0aW9uT1UgIiRjb25uZWN0aW9uU3luY09VIiAtQ29ubmVjdGlvblBhc3N3b3JkIGAkc3luY0Nvbm5lY3Rpb25BY2N0UFdECklmICghYCQ/KQp7CldyaXRlLUhvc3QgIlByZXNzIGFueSBrZXkgdG8gZXhpdC4uLiIKYCRudWxsID0gYCRob3N0LlVJLlJhd1VJLlJlYWRLZXkoYCJOb0VjaG8sSW5jbHVkZUtleURvd25gIikKfQpFbHNlIHtsb2cgIiAtIERvbmUuIjtTdGFydC1TbGVlcCAxNX0KIkAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhZGRQcm9maWxlU2NyaXB0RmlsZSA9ICIkKChHZXQtSXRlbSAkZW52OlRFTVApLkZ1bGxOYW1lKVxBdXRvU1BJbnN0YWxsZXItQWRkUHJvZmlsZVN5bmNDbWQucHMxIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFkZFByb2ZpbGVTeW5jQ21kIHwgT3V0LUZpbGUgJGFkZFByb2ZpbGVTY3JpcHRGaWxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKChHZXQtV21pT2JqZWN0IFdpbjMyX09wZXJhdGluZ1N5c3RlbSkuVmVyc2lvbiAtbGlrZSAiNi4yKiIgLW9yIChHZXQtV21pT2JqZWN0IFdpbjMyX09wZXJhdGluZ1N5c3RlbSkuVmVyc2lvbiAtbGlrZSAiNi4zKiIpIC1hbmQgKCRlbnY6c3BWZXIgLWVxICIxNCIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2ZXJzaW9uU3dpdGNoID0gIi1WZXJzaW9uIDIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHskdmVyc2lvblN3aXRjaCA9ICIifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBSdW4gb3VyIEFkZC1TUFByb2ZpbGVTeW5jQ29ubmVjdGlvbiBzY3JpcHQgYXMgdGhlIEZhcm0gQWNjb3VudCAtIGRvZXNuJ3Qgc2VlbSB0byB3b3JrIG90aGVyd2lzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAtV29ya2luZ0RpcmVjdG9yeSAkUFNIT01FIC1GaWxlUGF0aCAicG93ZXJzaGVsbC5leGUiIC1DcmVkZW50aWFsICRmYXJtQ3JlZGVudGlhbCAtQXJndW1lbnRMaXN0ICItRXhlY3V0aW9uUG9saWN5IEJ5cGFzcyAtQ29tbWFuZCBTdGFydC1Qcm9jZXNzIC1Xb3JraW5nRGlyZWN0b3J5IGAiJyRQU0hPTUUnYCIgLUZpbGVQYXRoIGAiJ3Bvd2Vyc2hlbGwuZXhlJ2AiIC1Bcmd1bWVudExpc3QgYCInJHZlcnNpb25Td2l0Y2ggLUV4ZWN1dGlvblBvbGljeSBCeXBhc3MgJGFkZFByb2ZpbGVTY3JpcHRGaWxlJ2AiIC1WZXJiIFJ1bmFzIiAtV2FpdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBHaXZlIEFkZC1TUFByb2ZpbGVTeW5jQ29ubmVjdGlvbiB0aW1lIHRvIGNvbXBsZXRlIGJlZm9yZSBjb250aW51aW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAxMjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlbW92ZS1JdGVtIC1MaXRlcmFsUGF0aCAkYWRkUHJvZmlsZVNjcmlwdEZpbGUgLUZvcmNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgRWxzZSB7bG9nICJBbHJlYWR5IHN0YXJ0ZWQuIn0KICAgICAgICAgICAgICAgICAgICAjIE1ha2UgdGhlIEZJTSBzZXJ2aWNlcyBkZXBlbmRlbnQgb24gdGhlIFNRTCBTZXJ2ZXIgc2VydmljZSBpZiB3ZSBhcmUgcHJvdmlzaW9uaW5nIFVzZXIgUHJvZmlsZSBTeW5jIGFuZCBTUUwgaXMgY28tbG9jYXRlZCB3aXRoIFNoYXJlUG9pbnQgb24gdGhpcyBtYWNoaW5lCiAgICAgICAgICAgICAgICAgICAgJGRiU2VydmVyVVBTQSA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlVzZXJQcm9maWxlU2VydmljZUFwcC5EYXRhYmFzZS5EQlNlcnZlcgogICAgICAgICAgICAgICAgICAgIGlmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkZGJTZXJ2ZXJVUFNBKSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICRkYlNlcnZlclVQU0EgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkRhdGFiYXNlLkRCU2VydmVyCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICR1cEFsaWFzID0gR2V0LUl0ZW1Qcm9wZXJ0eSAiSEtMTTpcU09GVFdBUkVcTWljcm9zb2Z0XE1TU1FMU2VydmVyXENsaWVudFxDb25uZWN0VG8iIC1OYW1lICRkYlNlcnZlclVQU0EgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgICAgICAjIEdyYWIgdGhlIHZhbHVlcyBmb3IgdGhlIFNRTCBhbGlhcywgaWYgb25lIGV4aXN0cwogICAgICAgICAgICAgICAgICAgICR1cERCSW5zdGFuY2UgPSAkdXBBbGlhcy4kZGJTZXJ2ZXJVUFNBCiAgICAgICAgICAgICAgICAgICAgaWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCR1cERCSW5zdGFuY2UpKSAjIEFsaWFzIG5vdCBmb3VuZDsgbWF5YmUgd2UgYXJlIHVzaW5nIGFuIGFjdHVhbCBtYWNoaW5lIG5hbWUKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICR1cERCSW5zdGFuY2UgPSAkZGJTZXJ2ZXJVUFNBCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICMgUHJvY2VlZCBpZiB0aGUgZGF0YWJhc2UgaW5zdGFuY2Ugc3BlY2lmaWVkIGZvciB0aGUgVVBTQSBtYXBzIHRvIHRoZSBsb2NhbCBtYWNoaW5lIG5hbWUgYW5kIHRoZSBzZXJ2aWNlIHdhcyBwcm92aXNpb25lZCBzdWNjZXNzZnVsbHkKICAgICAgICAgICAgICAgICAgICAkcHJvZmlsZVN5bmNTZXJ2aWNlcyA9IEAoR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLlNlcnZlci5BZG1pbmlzdHJhdGlvbi5Qcm9maWxlU3luY2hyb25pemF0aW9uU2VydmljZUluc3RhbmNlIn0pCiAgICAgICAgICAgICAgICAgICAgaWYgKCR1cERCSW5zdGFuY2UgLWxpa2UgIiokZW52OkNPTVBVVEVSTkFNRSoiIC1hbmQgKCRwcm9maWxlU3luY1NlcnZpY2VzIHwgPyB7JF8uU3RhdHVzIC1lcSAiT25saW5lIn0pKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBTZXRzIHRoZSBGb3JlZnJvbnQgSWRlbnRpdHkgTWFuYWdlciBTZXJ2aWNlcyB0byBkZXBlbmQgb24gdGhlIFNRTCBTZXJ2ZXIgc2VydmljZQogICAgICAgICAgICAgICAgICAgICAgICAjIEZvciBhbGwtaW4tb25lIGVudmlyb25tZW50cyB3aGVyZSBGSU0gbWF5IG5vdCBzdGFydCBhdXRvbWF0aWNhbGx5LCBlLmcuIERldmVsb3BtZW50IFZNcwogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFNldHRpbmcgRm9yZWZyb250IElkZW50aXR5IE1hbmFnZXIgc2VydmljZXMgdG8gZGVwZW5kIG9uIFNRTCBTZXJ2ZXIuIgogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFRoaXMgaXMgaGVscGZ1bCB3aGVuIHRoZSBTUUwgaW5zdGFuY2UgZm9yIHRoZSBVc2VyIFByb2ZpbGUgU2VydmljZSBpcyBjby1sb2NhdGVkLiIKICAgICAgICAgICAgICAgICAgICAgICAgJiAiJGVudjp3aW5kaXJcU3lzdGVtMzJcc2MuZXhlIiBjb25maWcgRklNU2VydmljZSBkZXBlbmQ9IE1TU1FMU0VSVkVSCiAgICAgICAgICAgICAgICAgICAgICAgICYgIiRlbnY6d2luZGlyXFN5c3RlbTMyXHNjLmV4ZSIgY29uZmlnIEZJTVNlcnZpY2Ugc3RhcnQ9IGRlbGF5ZWQtYXV0bwogICAgICAgICAgICAgICAgICAgICAgICAmICIkZW52OndpbmRpclxTeXN0ZW0zMlxzYy5leGUiIGNvbmZpZyBGSU1TeW5jaHJvbml6YXRpb25TZXJ2aWNlIGRlcGVuZD0gV2lubWdtdC9GSU1TZXJ2aWNlCiAgICAgICAgICAgICAgICAgICAgICAgICYgIiRlbnY6d2luZGlyXFN5c3RlbTMyXHNjLmV4ZSIgY29uZmlnIEZJTVN5bmNocm9uaXphdGlvblNlcnZpY2Ugc3RhcnQ9IGRlbGF5ZWQtYXV0bwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2Uge2xvZyAiTm90IGFwcGxpY2FibGUgdG8gU2hhcmVQb2ludCAyMDE2LiJ9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgRWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAtIENvdWxkIG5vdCBnZXQgVXNlciBQcm9maWxlIFNlcnZpY2UsIG9yIFN0YXJ0UHJvZmlsZVN5bmMgaXMgRmFsc2UuIgogICAgICAgICAgICB9CiAgICAgICAgICAgIFdyaXRlTGluZQogICAgICAgIH0KICAgIH0KICAgIENhdGNoCiAgICB7CiAgICAgICAgV3JpdGUtT3V0cHV0ICRfCiAgICAgICAgVGhyb3cgIiAtIEVycm9yIFByb3Zpc2lvbmluZyB0aGUgVXNlciBQcm9maWxlIFNlcnZpY2UgQXBwbGljYXRpb24iCiAgICB9Cn0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IENyZWF0ZVVQU0FzQWRtaW4KIyBEZXNjOiBDcmVhdGUgdGhlIFVzZXIgUHJvZmlsZSBTZXJ2aWNlIEFwcGxpY2F0aW9uIGl0c2VsZiBhcyB0aGUgRmFybSBBZG1pbiBhY2NvdW50LCBpbiBhIHNlc3Npb24gd2l0aCBlbGV2YXRlZCBwcml2aWxlZ2VzCiMgICAgICAgVGhpcyBpbmNvcnBvcmF0ZXMgdGhlIHdvcmthcm91bmQgYnkgQGhhcmJhcnMgJiBAZ2xhcG9pbnRlIGh0dHA6Ly93d3cuaGFyYmFyLm5ldC9hcmNoaXZlLzIwMTAvMTAvMzAvYXZvaWRpbmctdGhlLWRlZmF1bHQtc2NoZW1hLWlzc3VlLXdoZW4tY3JlYXRpbmctdGhlLXVzZXItcHJvZmlsZS5hc3B4CiMgICAgICAgTW9kaWZpZWQgdG8gd29yayB3aXRoaW4gQXV0b1NQSW5zdGFsbGVyICh0byBwYXNzIG91ciBzY3JpcHQgdmFyaWFibGVzIHRvIHRoZSBGYXJtIEFjY291bnQgY3JlZGVudGlhbCdzIFBvd2VyU2hlbGwgc2Vzc2lvbikKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKRnVuY3Rpb24gQ3JlYXRlVVBTQXNBZG1pbihbeG1sXSR4bWxpbnB1dCkKewogICAgVHJ5CiAgICB7CiAgICAgICAgJG15U2l0ZVdlYkFwcCA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLldlYkFwcGxpY2F0aW9ucy5XZWJBcHBsaWNhdGlvbiB8IFdoZXJlIHskXy5UeXBlIC1lcSAiTXlTaXRlSG9zdCJ9CiAgICAgICAgJG15U2l0ZU1hbmFnZWRQYXRoID0gJHVzZXJQcm9maWxlLk15U2l0ZU1hbmFnZWRQYXRoCiAgICAgICAgIyBJZiB3ZSBoYXZlIGFza2VkIHRvIGNyZWF0ZSBhIE15U2l0ZSBIb3N0IHdlYiBhcHAsIHVzZSB0aGF0IGFzIHRoZSBNeVNpdGUgaG9zdCBsb2NhdGlvbgogICAgICAgIGlmICgkbXlTaXRlV2ViQXBwKQogICAgICAgIHsKICAgICAgICAgICAgJG15U2l0ZVVSTCA9ICgkbXlTaXRlV2ViQXBwLnVybCkuVHJpbUVuZCgiLyIpCiAgICAgICAgICAgICRteVNpdGVQb3J0ID0gJG15U2l0ZVdlYkFwcC5wb3J0CiAgICAgICAgICAgICRteVNpdGVIb3N0TG9jYXRpb24gPSAkbXlTaXRlVVJMKyI6IiskbXlTaXRlUG9ydAogICAgICAgIH0KICAgICAgICBlbHNlICMgVXNlIHRoZSB2YWx1ZSBwcm92aWRlZCBpbiB0aGUgJHVzZXJQcm9maWxlIG5vZGUKICAgICAgICB7CiAgICAgICAgICAgICRteVNpdGVIb3N0TG9jYXRpb24gPSAkdXNlclByb2ZpbGUuTXlTaXRlSG9zdExvY2F0aW9uCiAgICAgICAgfQogICAgICAgIGlmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkbXlTaXRlTWFuYWdlZFBhdGgpKQogICAgICAgIHsKICAgICAgICAgICAgIyBEb24ndCBzcGVjaWZ5IHRoZSBNeVNpdGVNYW5hZ2VkUGF0aCBzd2l0Y2ggaWYgaXQgd2FzIGxlZnQgYmxhbmsuIFRoaXMgd2lsbCBlZmZlY3RpdmVseSB1c2UgdGhlIGRlZmF1bHQgcGF0aCBvZiAicGVyc29uYWwvc2l0ZXMiCiAgICAgICAgICAgICMgTm90ZSB0aGF0IGFuIGVtcHR5IGhhc2h0YWJsZSBkb2Vzbid0IHNlZW0gdG8gd29yayBoZXJlIHNvIHdlIGp1c3QgcHV0IGFuIGVtcHR5IHN0cmluZwogICAgICAgICAgICAkbXlTaXRlTWFuYWdlZFBhdGhTd2l0Y2ggPSAiIgogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICAjIEF0dGVtcHQgdG8gdXNlIHRoZSBwYXRoIHdlIHNwZWNpZmllZCBpbiB0aGUgWE1MCiAgICAgICAgICAgICRteVNpdGVNYW5hZ2VkUGF0aFN3aXRjaCA9ICItTXlTaXRlTWFuYWdlZFBhdGggYCIkbXlTaXRlTWFuYWdlZFBhdGhgIiIgIyBUaGlzIGZvcm1hdCByZXF1aXJlZCB0byBwYXJzZSBwcm9wZXJseSBpbiB0aGUgc2NyaXB0IGJsb2NrIGJlbG93CiAgICAgICAgfQogICAgICAgICRmYXJtQWNjdCA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uQWNjb3VudC5Vc2VybmFtZQogICAgICAgICR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lID0gJHVzZXJQcm9maWxlLk5hbWUKICAgICAgICAkZGJTZXJ2ZXIgPSAkdXNlclByb2ZpbGUuRGF0YWJhc2UuREJTZXJ2ZXIKICAgICAgICAjIElmIHdlIGhhdmVuJ3Qgc3BlY2lmaWVkIGEgREIgU2VydmVyIHRoZW4ganVzdCB1c2UgdGhlIGRlZmF1bHQgdXNlZCBieSB0aGUgRmFybQogICAgICAgIElmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkZGJTZXJ2ZXIpKQogICAgICAgIHsKICAgICAgICAgICAgJGRiU2VydmVyID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5EYXRhYmFzZS5EQlNlcnZlcgogICAgICAgIH0KICAgICAgICAjIFNldCB0aGUgUHJvZmlsZURCU2VydmVyLCBTeW5jREJTZXJ2ZXIgYW5kIFNvY2lhbERCU2VydmVyIHRvIHRoZSBzYW1lIHZhbHVlICgkZGJTZXJ2ZXIpLiBNYXliZSBpbiB0aGUgZnV0dXJlIHdlJ2xsIHdhbnQgdG8gZ2V0IG1vcmUgZ3JhbnVsYXIuLi4/CiAgICAgICAgJHByb2ZpbGVEQlNlcnZlciA9ICRkYlNlcnZlcgogICAgICAgICRzeW5jREJTZXJ2ZXIgPSAkZGJTZXJ2ZXIKICAgICAgICAkc29jaWFsREJTZXJ2ZXIgPSAkZGJTZXJ2ZXIKICAgICAgICAkZGJQcmVmaXggPSBHZXQtREJQcmVmaXggJHhtbGlucHV0CiAgICAgICAgJHByb2ZpbGVEQiA9ICRkYlByZWZpeCskdXNlclByb2ZpbGUuRGF0YWJhc2UuUHJvZmlsZURCCiAgICAgICAgJHN5bmNEQiA9ICRkYlByZWZpeCskdXNlclByb2ZpbGUuRGF0YWJhc2UuU3luY0RCCiAgICAgICAgJHNvY2lhbERCID0gJGRiUHJlZml4KyR1c2VyUHJvZmlsZS5EYXRhYmFzZS5Tb2NpYWxEQgogICAgICAgICRhcHBsaWNhdGlvblBvb2wgPSBHZXQtSG9zdGVkU2VydmljZXNBcHBQb29sICR4bWxpbnB1dAogICAgICAgIElmICghJGZhcm1DcmVkZW50aWFsKSB7W1N5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUHNDcmVkZW50aWFsXSRmYXJtQ3JlZGVudGlhbCA9IEdldEZhcm1DcmVkZW50aWFscyAkeG1saW5wdXR9CiAgICAgICAgJHNjcmlwdEZpbGUgPSAiJCgoR2V0LUl0ZW0gJGVudjpURU1QKS5GdWxsTmFtZSlcQXV0b1NQSW5zdGFsbGVyLVNjcmlwdEJsb2NrLnBzMSIKICAgICAgICAjIFdyaXRlIHRoZSBzY3JpcHQgYmxvY2ssIHdpdGggZXhwYW5kZWQgdmFyaWFibGVzIHRvIGEgdGVtcG9yYXJ5IHNjcmlwdCBmaWxlIHRoYXQgdGhlIEZhcm0gQWNjb3VudCBjYW4gZ2V0IGF0CiAgICAgICAgV3JpdGUtT3V0cHV0ICJXcml0ZS1Ib3N0IGAiQ3JlYXRpbmcgJHVzZXJQcm9maWxlU2VydmljZU5hbWUgYXMgJGZhcm1BY2N0Li4uYCIiIHwgT3V0LUZpbGUgJHNjcmlwdEZpbGUgLVdpZHRoIDQwMAogICAgICAgIFdyaXRlLU91dHB1dCAiQWRkLVBzU25hcGluIE1pY3Jvc29mdC5TaGFyZVBvaW50LlBvd2VyU2hlbGwiIHwgT3V0LUZpbGUgJHNjcmlwdEZpbGUgLVdpZHRoIDQwMCAtQXBwZW5kCiAgICAgICAgV3JpdGUtT3V0cHV0ICJgJG5ld1Byb2ZpbGVTZXJ2aWNlQXBwID0gTmV3LVNQUHJvZmlsZVNlcnZpY2VBcHBsaWNhdGlvbiAtTmFtZSBgIiR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lYCIgLUFwcGxpY2F0aW9uUG9vbCBgIiQoJGFwcGxpY2F0aW9uUG9vbC5OYW1lKWAiIC1Qcm9maWxlREJTZXJ2ZXIgJHByb2ZpbGVEQlNlcnZlciAtUHJvZmlsZURCTmFtZSAkcHJvZmlsZURCIC1Qcm9maWxlU3luY0RCU2VydmVyICRzeW5jREJTZXJ2ZXIgLVByb2ZpbGVTeW5jREJOYW1lICRzeW5jREIgLVNvY2lhbERCU2VydmVyICRzb2NpYWxEQlNlcnZlciAtU29jaWFsREJOYW1lICRzb2NpYWxEQiAtTXlTaXRlSG9zdExvY2F0aW9uICRteVNpdGVIb3N0TG9jYXRpb24gJG15U2l0ZU1hbmFnZWRQYXRoU3dpdGNoIiB8IE91dC1GaWxlICRzY3JpcHRGaWxlIC1XaWR0aCA0MDAgLUFwcGVuZAogICAgICAgIFdyaXRlLU91dHB1dCAiSWYgKC1ub3QgYCQ/KSB7V3JpdGUtRXJyb3IgYCIgLSBGYWlsZWQgdG8gY3JlYXRlICR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lYCI7IFdyaXRlLUhvc3QgYCJQcmVzcyBhbnkga2V5IHRvIGV4aXQuLi5gIjsgYCRudWxsID0gYCRob3N0LlVJLlJhd1VJLlJlYWRLZXlgKGAiTm9FY2hvLEluY2x1ZGVLZXlEb3duYCJgKX0iIHwgT3V0LUZpbGUgJHNjcmlwdEZpbGUgLVdpZHRoIDQwMCAtQXBwZW5kCiAgICAgICAgIyBHcmFudCB0aGUgY3VycmVudCBpbnN0YWxsIGFjY291bnQgcmlnaHRzIHRvIHRoZSBuZXdseS1jcmVhdGVkIFByb2ZpbGUgREIgLSBuZWVkZWQgc2luY2UgaXQncyBnb2luZyB0byBiZSBydW5uaW5nIFBvd2VyU2hlbGwgY29tbWFuZHMgYWdhaW5zdCBpdAogICAgICAgIFdyaXRlLU91dHB1dCAiYCRwcm9maWxlREJJZCA9IEdldC1TUERhdGFiYXNlIHwgPyB7YCRfLk5hbWUgLWVxIGAiJHByb2ZpbGVEQmAifSIgfCBPdXQtRmlsZSAkc2NyaXB0RmlsZSAtV2lkdGggNDAwIC1BcHBlbmQKICAgICAgICBXcml0ZS1PdXRwdXQgIkFkZC1TUFNoZWxsQWRtaW4gLVVzZXJOYW1lIGAiJGVudjpVU0VSRE9NQUlOXCRlbnY6VVNFUk5BTUVgIiAtZGF0YWJhc2UgYCRwcm9maWxlREJJZCIgfCBPdXQtRmlsZSAkc2NyaXB0RmlsZSAtV2lkdGggNDAwIC1BcHBlbmQKICAgICAgICAjIEdyYW50IHRoZSBjdXJyZW50IGluc3RhbGwgYWNjb3VudCByaWdodHMgdG8gdGhlIG5ld2x5LWNyZWF0ZWQgU29jaWFsIERCIGFzIHdlbGwKICAgICAgICBXcml0ZS1PdXRwdXQgImAkc29jaWFsREJJZCA9IEdldC1TUERhdGFiYXNlIHwgPyB7YCRfLk5hbWUgLWVxIGAiJHNvY2lhbERCYCJ9IiB8IE91dC1GaWxlICRzY3JpcHRGaWxlIC1XaWR0aCA0MDAgLUFwcGVuZAogICAgICAgIFdyaXRlLU91dHB1dCAiQWRkLVNQU2hlbGxBZG1pbiAtVXNlck5hbWUgYCIkZW52OlVTRVJET01BSU5cJGVudjpVU0VSTkFNRWAiIC1kYXRhYmFzZSBgJHNvY2lhbERCSWQiIHwgT3V0LUZpbGUgJHNjcmlwdEZpbGUgLVdpZHRoIDQwMCAtQXBwZW5kCiAgICAgICAgIyBBZGQgdGhlIC1WZXJzaW9uIDIgc3dpdGNoIGluIGNhc2Ugd2UgYXJlIGluc3RhbGxpbmcgU1AyMDEwIG9uIFdpbmRvd3MgU2VydmVyIDIwMTIgb3IgMjAxMiBSMgogICAgICAgIGlmICgoKEdldC1XbWlPYmplY3QgV2luMzJfT3BlcmF0aW5nU3lzdGVtKS5WZXJzaW9uIC1saWtlICI2LjIqIiAtb3IgKEdldC1XbWlPYmplY3QgV2luMzJfT3BlcmF0aW5nU3lzdGVtKS5WZXJzaW9uIC1saWtlICI2LjMqIikgLWFuZCAoJGVudjpzcFZlciAtZXEgIjE0IikpCiAgICAgICAgewogICAgICAgICAgICAkdmVyc2lvblN3aXRjaCA9ICItVmVyc2lvbiAyIgogICAgICAgIH0KICAgICAgICBlbHNlIHskdmVyc2lvblN3aXRjaCA9ICIifQoKICAgICAgICAjIE1LOiB3ZSBhcmUgbm90IHVzaW5nIHJlbW90ZSBpbnN0YWxsCiAgICAgICAgSWYgKENvbmZpcm0tTG9jYWxTZXNzaW9uKSAjIENyZWF0ZSB0aGUgVVBBIGFzIHVzdWFsIGlmIHRoaXMgaXNuJ3QgYSByZW1vdGUgc2Vzc2lvbgogICAgICAgIHsKICAgICAgICAgICAgIyBNSzogc3RhcnRpbmcgYSBuZXcgcHJvY2VzcyBjYXVzZXMgVUFDIHRvIHBvcCB1cCB3aGljaCBkb2VzbnQgd29yayBpbiBhdXRvbWF0ZWQgZGVwbG95bWVudAogICAgICAgICAgICAjIFN0YXJ0IGEgcHJvY2VzcyB1bmRlciB0aGUgRmFybSBBY2NvdW50J3MgY3JlZGVudGlhbHMsIHRoZW4gc3Bhd24gYW4gZWxldmF0ZWQgcHJvY2VzcyB3aXRoaW4gdG8gZmluYWxseSBleGVjdXRlIHRoZSBzY3JpcHQgZmlsZSB0aGF0IGFjdHVhbGx5IGNyZWF0ZXMgdGhlIFVQUwogICAgICAgICAgICAjU3RhcnQtUHJvY2VzcyAtV29ya2luZ0RpcmVjdG9yeSAkUFNIT01FIC1GaWxlUGF0aCAicG93ZXJzaGVsbC5leGUiIC1DcmVkZW50aWFsICRmYXJtQ3JlZGVudGlhbCAtQXJndW1lbnRMaXN0ICItRXhlY3V0aW9uUG9saWN5IEJ5cGFzcyAtQ29tbWFuZCBTdGFydC1Qcm9jZXNzIC1Xb3JraW5nRGlyZWN0b3J5IGAiJyRQU0hPTUUnYCIgLUZpbGVQYXRoIGAiJ3Bvd2Vyc2hlbGwuZXhlJ2AiIC1Bcmd1bWVudExpc3QgYCInJHZlcnNpb25Td2l0Y2ggLUV4ZWN1dGlvblBvbGljeSBCeXBhc3MgJHNjcmlwdEZpbGUnYCIgLVZlcmIgUnVuYXMiIC1XYWl0CgogICAgICAgICAgICAjIE1LIC0gc3RhcnQKICAgICAgICAgICAgJG5ld1Byb2ZpbGVTZXJ2aWNlQXBwID0gTmV3LVNQUHJvZmlsZVNlcnZpY2VBcHBsaWNhdGlvbiAtTmFtZSAkdXNlclByb2ZpbGVTZXJ2aWNlTmFtZSAtQXBwbGljYXRpb25Qb29sICRhcHBsaWNhdGlvblBvb2wuTmFtZSAtUHJvZmlsZURCU2VydmVyICRwcm9maWxlREJTZXJ2ZXIgLVByb2ZpbGVEQk5hbWUgJHByb2ZpbGVEQiAtUHJvZmlsZVN5bmNEQlNlcnZlciAkc3luY0RCU2VydmVyIC1Qcm9maWxlU3luY0RCTmFtZSAkc3luY0RCIC1Tb2NpYWxEQlNlcnZlciAkc29jaWFsREJTZXJ2ZXIgLVNvY2lhbERCTmFtZSAkc29jaWFsREIgLU15U2l0ZUhvc3RMb2NhdGlvbiAkbXlTaXRlSG9zdExvY2F0aW9uIC1NeVNpdGVNYW5hZ2VkUGF0aCAicGVyc29uYWwiCiAgICAgICAgICAgIElmICgtbm90ICQ/KSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGhyb3cgIkVSUk9SIC0gRmFpbGVkIHRvIGNyZWF0ZSBVc2VyIFByb2ZpbGUgU2VydmljZSBBcHBsaWNhdGlvbiI7IAogICAgICAgICAgICB9CgogICAgICAgICAgICAkcHJvZmlsZURCSWQgPSBHZXQtU1BEYXRhYmFzZSB8ID8geyRfLk5hbWUgLWVxICRwcm9maWxlREJ9CiAgICAgICAgICAgIEFkZC1TUFNoZWxsQWRtaW4gLVVzZXJOYW1lICRmYXJtQWNjdCAtZGF0YWJhc2UgJHByb2ZpbGVEQklkCgogICAgICAgICAgICAkc29jaWFsREJJZCA9IEdldC1TUERhdGFiYXNlIHwgPyB7JF8uTmFtZSAtZXEgJHNvY2lhbERCfQogICAgICAgICAgICBBZGQtU1BTaGVsbEFkbWluIC1Vc2VyTmFtZSAkZmFybUFjY3QgLWRhdGFiYXNlICRzb2NpYWxEQklkCiAgICAgICAgICAgICMgTUsgLSBlbmQKICAgICAgICB9CiAgICAgICAgRWxzZSAjIERvIHNvbWUgZmFuY3kgc3R1ZmYgdG8gZ2V0IHRoaXMgdG8gd29yayBvdmVyIGEgcmVtb3RlIHNlc3Npb24KICAgICAgICB7CiAgICAgICAgICAgIGxvZyAiIC0gRW5hYmxpbmcgcmVtb3RpbmcgdG8gJGVudjpDT01QVVRFUk5BTUUuLi4iCiAgICAgICAgICAgIEVuYWJsZS1XU01hbkNyZWRTU1AgLVJvbGUgQ2xpZW50IC1Gb3JjZSAtRGVsZWdhdGVDb21wdXRlciAkZW52OkNPTVBVVEVSTkFNRSB8IE91dC1OdWxsICMgWWVzIHRoYXQncyByaWdodCwgd2UncmUgZ29pbmcgdG8gInJlbW90ZSIgaW50byB0aGUgbG9jYWwgY29tcHV0ZXIuLi4KICAgICAgICAgICAgU3RhcnQtU2xlZXAgMTAKICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyB0ZW1wb3JhcnkgYCJyZW1vdGVgIiBzZXNzaW9uIHRvICRlbnY6Q09NUFVURVJOQU1FLi4uIgogICAgICAgICAgICAkVVBTZXNzaW9uID0gTmV3LVBTU2Vzc2lvbiAtTmFtZSAiVVBTLVNlc3Npb24iIC1BdXRoZW50aWNhdGlvbiBDcmVkc3NwIC1DcmVkZW50aWFsICRmYXJtQ3JlZGVudGlhbCAtQ29tcHV0ZXJOYW1lICRlbnY6Q09NUFVURVJOQU1FIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgIElmICghJFVQU2Vzc2lvbikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIyBUcnkgYWdhaW4KICAgICAgICAgICAgICAgIGxvZyAiV0FSTklORzpDb3VsZG4ndCBjcmVhdGUgcmVtb3RlIHNlc3Npb24gdG8gJGVudjpDT01QVVRFUk5BTUU7IHRyeWluZyBhZ2Fpbi4uLiIKICAgICAgICAgICAgICAgIENyZWF0ZVVQU0FzQWRtaW4gJHhtbGlucHV0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgIyBQYXNzIHRoZSB2YWx1ZSBvZiAkc2NyaXB0RmlsZSB0byB0aGUgbmV3IHNlc3Npb24KICAgICAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrIHtwYXJhbSAoJHZhbHVlKSBTZXQtVmFyaWFibGUgLU5hbWUgU2NyaXB0RmlsZSAtVmFsdWUgJHZhbHVlfSAtQXJndW1lbnRMaXN0ICRzY3JpcHRGaWxlIC1TZXNzaW9uICRVUFNlc3Npb24KICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyAkdXNlclByb2ZpbGVTZXJ2aWNlTmFtZSB1bmRlciBgInJlbW90ZWAiIHNlc3Npb24uLi4iCiAgICAgICAgICAgICMgU3RhcnQgYSAobG9jYWwpIHByb2Nlc3MgKG9uIG91ciAicmVtb3RlIiBzZXNzaW9uKSwgdGhlbiBzcGF3biBhbiBlbGV2YXRlZCBwcm9jZXNzIHdpdGhpbiB0byBmaW5hbGx5IGV4ZWN1dGUgdGhlIHNjcmlwdCBmaWxlIHRoYXQgYWN0dWFsbHkgY3JlYXRlcyB0aGUgVVBTCiAgICAgICAgICAgIEludm9rZS1Db21tYW5kIC1TY3JpcHRCbG9jayB7U3RhcnQtUHJvY2VzcyAtRmlsZVBhdGggIiRQU0hPTUVccG93ZXJzaGVsbC5leGUiIC1Bcmd1bWVudExpc3QgIi1FeGVjdXRpb25Qb2xpY3kgQnlwYXNzICRzY3JpcHRGaWxlIiAtVmVyYiBSdW5hc30gLVNlc3Npb24gJFVQU2Vzc2lvbgogICAgICAgIH0KICAgIH0KICAgIENhdGNoCiAgICB7CiAgICAgICAgIyBNSzogCiAgICAgICAgIyBXcml0ZS1PdXRwdXQgJF8KICAgICAgICBsb2cgIkVSUk9SOiAkKCRfLkV4Y2VwdGlvbi5NZXNzYWdlKSIKICAgICAgICBQYXVzZSAiZXhpdCIKICAgIH0KICAgIGZpbmFsbHkKICAgIHsKICAgICAgICAjIERlbGV0ZSB0aGUgdGVtcG9yYXJ5IHNjcmlwdCBmaWxlIGlmIHdlIHdlcmUgc3VjY2Vzc2Z1bCBpbiBjcmVhdGluZyB0aGUgVVBBCiAgICAgICAgJHByb2ZpbGVTZXJ2aWNlQXBwID0gR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uIHwgPyB7JF8uRGlzcGxheU5hbWUgLWVxICR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lfQogICAgICAgIElmICgkcHJvZmlsZVNlcnZpY2VBcHApIHtSZW1vdmUtSXRlbSAtTGl0ZXJhbFBhdGggJHNjcmlwdEZpbGUgLUZvcmNlfQogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ3JlYXRlIFN0YXRlIFNlcnZpY2UgQXBwbGljYXRpb24KRnVuY3Rpb24gQ3JlYXRlU3RhdGVTZXJ2aWNlQXBwKFt4bWxdJHhtbGlucHV0KQp7CiAgICBJZiAoKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuU3RhdGVTZXJ2aWNlIC1lcSAkdHJ1ZSkgLW9yIGAKICAgICAgICAoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuQWNjZXNzU2VydmljZSAtZXEgJHRydWUpIC1vciBgCiAgICAgICAgKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLlZpc2lvU2VydmljZSAtZXEgJHRydWUpIC1vciBgCiAgICAgICAgKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLkFjY2Vzc1NlcnZpY2VzIC1lcSAkdHJ1ZSkgLW9yIGAKICAgICAgICAoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5XZWJBbmFseXRpY3NTZXJ2aWNlIC1lcSAkdHJ1ZSkpCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgVHJ5CiAgICAgICAgewogICAgICAgICAgICAkc3RhdGVTZXJ2aWNlID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuU3RhdGVTZXJ2aWNlCiAgICAgICAgICAgICRkYlNlcnZlciA9ICRzdGF0ZVNlcnZpY2UuRGF0YWJhc2UuREJTZXJ2ZXIKICAgICAgICAgICAgIyBJZiB3ZSBoYXZlbid0IHNwZWNpZmllZCBhIERCIFNlcnZlciB0aGVuIGp1c3QgdXNlIHRoZSBkZWZhdWx0IHVzZWQgYnkgdGhlIEZhcm0KICAgICAgICAgICAgSWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRkYlNlcnZlcikpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRkYlNlcnZlciA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uRGF0YWJhc2UuREJTZXJ2ZXIKICAgICAgICAgICAgfQogICAgICAgICAgICAkZGJQcmVmaXggPSBHZXQtREJQcmVmaXggJHhtbGlucHV0CiAgICAgICAgICAgICRzdGF0ZVNlcnZpY2VEQiA9ICRkYlByZWZpeCskc3RhdGVTZXJ2aWNlLkRhdGFiYXNlLk5hbWUKICAgICAgICAgICAgJHN0YXRlU2VydmljZU5hbWUgPSAkc3RhdGVTZXJ2aWNlLk5hbWUKICAgICAgICAgICAgJHN0YXRlU2VydmljZVByb3h5TmFtZSA9ICRzdGF0ZVNlcnZpY2UuUHJveHlOYW1lCiAgICAgICAgICAgIElmICgkc3RhdGVTZXJ2aWNlTmFtZSAtZXEgJG51bGwpIHskc3RhdGVTZXJ2aWNlTmFtZSA9ICJTdGF0ZSBTZXJ2aWNlIEFwcGxpY2F0aW9uIn0KICAgICAgICAgICAgSWYgKCRzdGF0ZVNlcnZpY2VQcm94eU5hbWUgLWVxICRudWxsKSB7JHN0YXRlU2VydmljZVByb3h5TmFtZSA9ICRzdGF0ZVNlcnZpY2VOYW1lfQogICAgICAgICAgICAkZ2V0U1BTdGF0ZVNlcnZpY2VBcHBsaWNhdGlvbiA9IEdldC1TUFN0YXRlU2VydmljZUFwcGxpY2F0aW9uCiAgICAgICAgICAgIElmICgkZ2V0U1BTdGF0ZVNlcnZpY2VBcHBsaWNhdGlvbiAtZXEgJG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiIC0gUHJvdmlzaW9uaW5nIFN0YXRlIFNlcnZpY2UgQXBwbGljYXRpb24uLi4iCiAgICAgICAgICAgICAgICBOZXctU1BTdGF0ZVNlcnZpY2VEYXRhYmFzZSAtRGF0YWJhc2VTZXJ2ZXIgJGRiU2VydmVyIC1OYW1lICRzdGF0ZVNlcnZpY2VEQiB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICBOZXctU1BTdGF0ZVNlcnZpY2VBcHBsaWNhdGlvbiAtTmFtZSAkc3RhdGVTZXJ2aWNlTmFtZSAtRGF0YWJhc2UgJHN0YXRlU2VydmljZURCIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgIEdldC1TUFN0YXRlU2VydmljZURhdGFiYXNlIHwgSW5pdGlhbGl6ZS1TUFN0YXRlU2VydmljZURhdGFiYXNlIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgU3RhdGUgU2VydmljZSBBcHBsaWNhdGlvbiBQcm94eS4uLiIKICAgICAgICAgICAgICAgIEdldC1TUFN0YXRlU2VydmljZUFwcGxpY2F0aW9uIHwgTmV3LVNQU3RhdGVTZXJ2aWNlQXBwbGljYXRpb25Qcm94eSAtTmFtZSAkc3RhdGVTZXJ2aWNlUHJveHlOYW1lIC1EZWZhdWx0UHJveHlHcm91cCB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICBsb2cgIiAtIERvbmUgY3JlYXRpbmcgU3RhdGUgU2VydmljZSBBcHBsaWNhdGlvbi4iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgRWxzZSB7bG9nICIgLSBTdGF0ZSBTZXJ2aWNlIEFwcGxpY2F0aW9uIGFscmVhZHkgcHJvdmlzaW9uZWQuIn0KICAgICAgICB9CiAgICAgICAgQ2F0Y2gKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAkXwogICAgICAgICAgICBUaHJvdyAiIC0gRXJyb3IgcHJvdmlzaW9uaW5nIHRoZSBzdGF0ZSBzZXJ2aWNlIGFwcGxpY2F0aW9uIgogICAgICAgIH0KICAgICAgICBXcml0ZUxpbmUKICAgIH0KfQojRW5kUmVnaW9uCgojUmVnaW9uIENyZWF0ZSBTUCBVc2FnZSBBcHBsaWNhdGlvbgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogQ3JlYXRlU1BVc2FnZUFwcAojIERlc2M6IENyZWF0ZXMgdGhlIFVzYWdlIGFuZCBIZWFsdGggRGF0YSBDb2xsZWN0aW9uIHNlcnZpY2UgYXBwbGljYXRpb24KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBDcmVhdGVTUFVzYWdlQXBwKFt4bWxdJHhtbGlucHV0KQp7CiAgICBJZiAoKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuU1BVc2FnZVNlcnZpY2UgLWVxICR0cnVlKSAtYW5kIChHZXQtQ29tbWFuZCAtTmFtZSBOZXctU1BVc2FnZUFwcGxpY2F0aW9uIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSkKICAgIHsKICAgICAgICBXcml0ZUxpbmUKICAgICAgICBUcnkKICAgICAgICB7CiAgICAgICAgICAgICRkYlNlcnZlciA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlNQVXNhZ2VTZXJ2aWNlLkRhdGFiYXNlLkRCU2VydmVyCiAgICAgICAgICAgICMgSWYgd2UgaGF2ZW4ndCBzcGVjaWZpZWQgYSBEQiBTZXJ2ZXIgdGhlbiBqdXN0IHVzZSB0aGUgZGVmYXVsdCB1c2VkIGJ5IHRoZSBGYXJtCiAgICAgICAgICAgIElmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkZGJTZXJ2ZXIpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkZGJTZXJ2ZXIgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkRhdGFiYXNlLkRCU2VydmVyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHNwVXNhZ2VBcHBsaWNhdGlvbk5hbWUgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TUFVzYWdlU2VydmljZS5OYW1lCiAgICAgICAgICAgICRkYlByZWZpeCA9IEdldC1EQlByZWZpeCAkeG1saW5wdXQKICAgICAgICAgICAgJHNwVXNhZ2VEQiA9ICRkYlByZWZpeCskeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TUFVzYWdlU2VydmljZS5EYXRhYmFzZS5OYW1lCiAgICAgICAgICAgICRnZXRTUFVzYWdlQXBwbGljYXRpb24gPSBHZXQtU1BVc2FnZUFwcGxpY2F0aW9uCiAgICAgICAgICAgIElmICgkZ2V0U1BVc2FnZUFwcGxpY2F0aW9uIC1lcSAkbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgLSBQcm92aXNpb25pbmcgU1AgVXNhZ2UgQXBwbGljYXRpb24uLi4iCiAgICAgICAgICAgICAgICBOZXctU1BVc2FnZUFwcGxpY2F0aW9uIC1OYW1lICRzcFVzYWdlQXBwbGljYXRpb25OYW1lIC1EYXRhYmFzZVNlcnZlciAkZGJTZXJ2ZXIgLURhdGFiYXNlTmFtZSAkc3BVc2FnZURCIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgICMgTmVlZCB0aGlzIHRvIHJlc29sdmUgYSBrbm93biBpc3N1ZSB3aXRoIHRoZSBVc2FnZSBBcHBsaWNhdGlvbiBQcm94eSBub3QgYXV0b21hdGljYWxseSBzdGFydGluZy9wcm92aXNpb25pbmcKICAgICAgICAgICAgICAgICMgVGhhbmtzIGFuZCBjcmVkaXQgdG8gSmVzcGVyIE55Z2FhcmQgU2NoaT90dCAoamVzcGVyQHNjaGlvZXR0LmRrKSBwZXIgaHR0cDovL2F1dG9zcGluc3RhbGxlci5jb2RlcGxleC5jb20vVGhyZWFkL1ZpZXcuYXNweD9UaHJlYWRJZD0yMzc1NzggIQogICAgICAgICAgICAgICAgbG9nICIgLSBGaXhpbmcgVXNhZ2UgYW5kIEhlYWx0aCBEYXRhIENvbGxlY3Rpb24gUHJveHkuLi4iCiAgICAgICAgICAgICAgICAkc3BVc2FnZUFwcGxpY2F0aW9uUHJveHkgPSBHZXQtU1BTZXJ2aWNlQXBwbGljYXRpb25Qcm94eSB8IHdoZXJlIHskXy5EaXNwbGF5TmFtZSAtZXEgJHNwVXNhZ2VBcHBsaWNhdGlvbk5hbWV9CiAgICAgICAgICAgICAgICAkc3BVc2FnZUFwcGxpY2F0aW9uUHJveHkuUHJvdmlzaW9uKCkKICAgICAgICAgICAgICAgICMgRW5kIFVzYWdlIFByb3h5IEZpeAogICAgICAgICAgICAgICAgbG9nICIgLSBFbmFibGluZyB1c2FnZSBwcm9jZXNzaW5nIHRpbWVyIGpvYi4uLiIKICAgICAgICAgICAgICAgICR1c2FnZVByb2Nlc3NpbmdKb2IgPSBHZXQtU1BUaW1lckpvYiB8ID8geyRfLlR5cGVOYW1lIC1lcSAiTWljcm9zb2Z0LlNoYXJlUG9pbnQuQWRtaW5pc3RyYXRpb24uU1BVc2FnZVByb2Nlc3NpbmdKb2JEZWZpbml0aW9uIn0KICAgICAgICAgICAgICAgICR1c2FnZVByb2Nlc3NpbmdKb2IuSXNEaXNhYmxlZCA9ICRmYWxzZQogICAgICAgICAgICAgICAgJHVzYWdlUHJvY2Vzc2luZ0pvYi5VcGRhdGUoKQogICAgICAgICAgICAgICAgbG9nICIgLSBEb25lIHByb3Zpc2lvbmluZyBTUCBVc2FnZSBBcHBsaWNhdGlvbi4iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgRWxzZSB7bG9nICIgLSBTUCBVc2FnZSBBcHBsaWNhdGlvbiBhbHJlYWR5IHByb3Zpc2lvbmVkLiJ9CiAgICAgICAgfQogICAgICAgIENhdGNoCiAgICAgICAgewogICAgICAgICAgICBXcml0ZS1PdXRwdXQgJF8KICAgICAgICAgICAgVGhyb3cgIiAtIEVycm9yIHByb3Zpc2lvbmluZyB0aGUgU1AgVXNhZ2UgQXBwbGljYXRpb24iCiAgICAgICAgfQogICAgICAgIFdyaXRlTGluZQogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ29uZmlndXJlIExvZ2dpbmcKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBDb25maWd1cmVJSVNMb2dnaW5nCiMgRGVzYzogQ29uZmlndXJlcyBJSVMgTG9nZ2luZyBmb3IgdGhlIGxvY2FsIHNlcnZlcgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIENvbmZpZ3VyZUlJU0xvZ2dpbmcoW3htbF0keG1saW5wdXQpCnsKICAgIFdyaXRlTGluZQogICAgJElJU0xvZ0NvbmZpZyA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uTG9nZ2luZy5JSVNMb2dzCiAgICBsb2cgIiAtIENvbmZpZ3VyaW5nIElJUyBsb2dnaW5nLi4uIgogICAgIyBOZXc6IENoZWNrIGZvciBQb3dlclNoZWxsIHZlcnNpb24gPiAyIGluIGNhc2UgdGhpcyBpcyBiZWluZyBydW4gb24gV2luZG93cyBTZXJ2ZXIgMjAxMgogICAgSWYgKCEoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJElJU0xvZ0NvbmZpZy5QYXRoKSkgLWFuZCAkaG9zdC5WZXJzaW9uLk1ham9yIC1ndCAyKQogICAgewogICAgICAgICRJSVNMb2dEaXIgPSAkSUlTTG9nQ29uZmlnLlBhdGgKICAgICAgICBFbnN1cmVGb2xkZXIgJElJU0xvZ0RpcgogICAgICAgIEltcG9ydFdlYkFkbWluaXN0cmF0aW9uCiAgICAgICAgJG9sZElJU0xvZ0RpciA9IEdldC1XZWJDb25maWd1cmF0aW9uUHJvcGVydHkgIi9zeXN0ZW0uYXBwbGljYXRpb25Ib3N0L3NpdGVzL3NpdGVEZWZhdWx0cyIgLW5hbWUgbG9nZmlsZS5kaXJlY3RvcnkuVmFsdWUKICAgICAgICAkb2xkSUlTTG9nRGlyID0gJG9sZElJU0xvZ0RpciAtcmVwbGFjZSAoIiVTeXN0ZW1Ecml2ZSUiLCIkZW52OlN5c3RlbURyaXZlIikKICAgICAgICBJZiAoJElJU0xvZ0RpciAtbmUgJG9sZElJU0xvZ0RpcikgIyBPbmx5IGNoYW5nZSB0aGUgZ2xvYmFsIElJUyBsb2dnaW5nIGxvY2F0aW9uIGlmIHRoZSBkZXNpcmVkIGxvY2F0aW9uIGlzIGRpZmZlcmVudCB0aGFuIHRoZSBjdXJyZW50CiAgICAgICAgewogICAgICAgICAgICBsb2cgIiAtIFNldHRpbmcgdGhlIGdsb2JhbCBJSVMgbG9nZ2luZyBsb2NhdGlvbi4uLiIKICAgICAgICAgICAgIyBUaGUgbGluZSBiZWxvdyBpcyBmcm9tIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNDYyNjc5MS9wb3dlcnNoZWxsLWNvbW1hbmQtdG8tc2V0LWlpcy1sb2dnaW5nLXNldHRpbmdzCiAgICAgICAgICAgIFNldC1XZWJDb25maWd1cmF0aW9uUHJvcGVydHkgIi9zeXN0ZW0uYXBwbGljYXRpb25Ib3N0L3NpdGVzL3NpdGVEZWZhdWx0cyIgLW5hbWUgbG9nZmlsZS5kaXJlY3RvcnkgLXZhbHVlICRJSVNMb2dEaXIKICAgICAgICAgICAgIyBUT0RPOiBGaXggdGhpcyBzbyBpdCBhY3R1YWxseSBtb3ZlcyBhbGwgZmlsZXMgd2l0aGluIHN1YmZvbGRlcnMKICAgICAgICAgICAgSWYgKFRlc3QtUGF0aCAtUGF0aCAkb2xkSUlTTG9nRGlyKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAtIE1vdmluZyBhbnkgY29udGVudHMgaW4gb2xkIGxvY2F0aW9uICRvbGRJSVNMb2dEaXIgdG8gJElJU0xvZ0Rpci4uLiIKICAgICAgICAgICAgICAgIEZvckVhY2ggKCRpdGVtIGluICQoR2V0LUNoaWxkSXRlbSAtUGF0aCAkb2xkSUlTTG9nRGlyKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBNb3ZlLUl0ZW0gLVBhdGggJG9sZElJU0xvZ0RpclwkaXRlbSAtRGVzdGluYXRpb24gJElJU0xvZ0RpciAtRm9yY2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIEVsc2UgIyBBc3N1bWUgZGVmYXVsdCB2YWx1ZSBpZiBub25lIHdhcyBzcGVjaWZpZWQgaW4gdGhlIFhNTCBpbnB1dCBmaWxlCiAgICB7CiAgICAgICAgJElJU0xvZ0RpciA9ICIkZW52OlN5c3RlbURyaXZlXEluZXRwdWJcbG9ncyIgIyBXZSBvbWl0IHRoZSB0cmFpbGluZyBcTG9nRmlsZXMgc28gd2UgY2FuIGNvbXByZXNzIHRoZSBlbnRpcmUgXGxvZ3NcIGZvbGRlciBpbmNsdWRpbmcgRmFpbGVkIFJlcXVlc3RzIGV0Yy4KICAgIH0KICAgICMgRmluYWxseSwgZW5hYmxlIE5URlMgY29tcHJlc3Npb24gb24gdGhlIElJUyBsb2cgbG9jYXRpb24gdG8gc2F2ZSBkaXNrIHNwYWNlCiAgICBJZiAoJElJU0xvZ0NvbmZpZy5Db21wcmVzcyAtZXEgJHRydWUpCiAgICB7CiAgICAgICAgQ29tcHJlc3NGb2xkZXIgJElJU0xvZ0RpcgogICAgfQogICAgV3JpdGVMaW5lCn0KCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBDb25maWd1cmVEaWFnbm9zdGljTG9nZ2luZwojIERlc2M6IENvbmZpZ3VyZXMgRGlhZ25vc3RpYyAoVUxTKSBMb2dnaW5nIGZvciB0aGUgZmFybQojIEZyb206IE9yaWdpbmFsbHkgc3VnZ2VzdGVkIGJ5IENvZGVwbGV4IHVzZXIgbGVvd3U3MDogaHR0cDovL2F1dG9zcGluc3RhbGxlci5jb2RlcGxleC5jb20vZGlzY3Vzc2lvbnMvMjU0NDk5CiMgICAgICAgQW5kIENvZGVwbGV4IHVzZXIgdGltaXVuOiBodHRwOi8vYXV0b3NwaW5zdGFsbGVyLmNvZGVwbGV4LmNvbS9kaXNjdXNzaW9ucy8yNjE1OTgKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBDb25maWd1cmVEaWFnbm9zdGljTG9nZ2luZyhbeG1sXSR4bWxpbnB1dCkKewogICAgV3JpdGVMaW5lCiAgICBHZXQtTWFqb3JWZXJzaW9uTnVtYmVyICR4bWxpbnB1dAogICAgJFVMU0xvZ0NvbmZpZyA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uTG9nZ2luZy5VTFNMb2dzCiAgICAkVUxTTG9nRGlyID0gJFVMU0xvZ0NvbmZpZy5Mb2dMb2NhdGlvbgogICAgJFVMU0xvZ0Rpc2tTcGFjZSA9ICRVTFNMb2dDb25maWcuTG9nRGlza1NwYWNlVXNhZ2VHQgogICAgJFVMU0xvZ1JldGVudGlvbiA9ICRVTFNMb2dDb25maWcuRGF5c1RvS2VlcExvZ3MKICAgICRVTFNMb2dDdXRJbnRlcnZhbCA9ICRVTFNMb2dDb25maWcuTG9nQ3V0SW50ZXJ2YWwKICAgIGxvZyAiIC0gQ29uZmlndXJpbmcgU2hhcmVQb2ludCBkaWFnbm9zdGljIChVTFMpIGxvZ2dpbmcuLi4iCiAgICBJZiAoIShbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkVUxTTG9nRGlyKSkpCiAgICB7CiAgICAgICAgJGRvQ29uZmlnID0gJHRydWUKICAgICAgICBFbnN1cmVGb2xkZXIgJFVMU0xvZ0RpcgogICAgICAgICRvbGRVTFNMb2dEaXIgPSAkKEdldC1TUERpYWdub3N0aWNDb25maWcpLkxvZ0xvY2F0aW9uCiAgICAgICAgJG9sZFVMU0xvZ0RpciA9ICRvbGRVTFNMb2dEaXIgLXJlcGxhY2UgKCIlQ29tbW9uUHJvZ3JhbUZpbGVzJSIsIiRlbnY6Q29tbW9uUHJvZ3JhbUZpbGVzIikKICAgIH0KICAgIEVsc2UgIyBBc3N1bWUgZGVmYXVsdCB2YWx1ZSBpZiBub25lIHdhcyBzcGVjaWZpZWQgaW4gdGhlIFhNTCBpbnB1dCBmaWxlCiAgICB7CiAgICAgICAgJFVMU0xvZ0RpciA9ICIkZW52OkNvbW1vblByb2dyYW1GaWxlc1xNaWNyb3NvZnQgU2hhcmVkXFdlYiBTZXJ2ZXIgRXh0ZW5zaW9uc1wkZW52OnNwVmVyXExPR1MiCiAgICB9CiAgICBJZiAoIShbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkVUxTTG9nRGlza1NwYWNlKSkpCiAgICB7CiAgICAgICAgJGRvQ29uZmlnID0gJHRydWUKICAgICAgICAkVUxTTG9nTWF4RGlza1NwYWNlVXNhZ2VFbmFibGVkID0gJHRydWUKICAgIH0KICAgIEVsc2UgIyBBc3N1bWUgZGVmYXVsdCB2YWx1ZXMgaWYgbm9uZSB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgWE1MIGlucHV0IGZpbGUKICAgIHsKICAgICAgICAkVUxTTG9nRGlza1NwYWNlID0gMTAwMAogICAgICAgICRVTFNMb2dNYXhEaXNrU3BhY2VVc2FnZUVuYWJsZWQgPSAkZmFsc2UKICAgIH0KICAgIElmICghKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRVTFNMb2dSZXRlbnRpb24pKSkKICAgIHskZG9Db25maWcgPSAkdHJ1ZX0KICAgIEVsc2UgIyBBc3N1bWUgZGVmYXVsdCB2YWx1ZSBpZiBub25lIHdhcyBzcGVjaWZpZWQgaW4gdGhlIFhNTCBpbnB1dCBmaWxlCiAgICB7CiAgICAgICAgJFVMU0xvZ1JldGVudGlvbiA9IDE0CiAgICB9CiAgICBJZiAoIShbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkVUxTTG9nQ3V0SW50ZXJ2YWwpKSkKICAgIHskZG9Db25maWcgPSAkdHJ1ZX0KICAgIEVsc2UgIyBBc3N1bWUgZGVmYXVsdCB2YWx1ZSBpZiBub25lIHdhcyBzcGVjaWZpZWQgaW4gdGhlIFhNTCBpbnB1dCBmaWxlCiAgICB7CiAgICAgICAgJFVMU0xvZ0N1dEludGVydmFsID0gMzAKICAgIH0KICAgICMgT25seSBtb2RpZnkgdGhlIERpYWdub3N0aWMgQ29uZmlnIGlmIHdlIGhhdmUgc3BlY2lmaWVkIGF0IGxlYXN0IG9uZSB2YWx1ZSBpbiB0aGUgWE1MIGlucHV0IGZpbGUKICAgIElmICgkZG9Db25maWcpCiAgICB7CiAgICAgICAgbG9nICIgLSBTZXR0aW5nIFNoYXJlUG9pbnQgZGlhZ25vc3RpYyAoVUxTKSBsb2dnaW5nIG9wdGlvbnM6IgogICAgICAgIGxvZyAiICAtIERheXNUb0tlZXBMb2dzOiAkVUxTTG9nUmV0ZW50aW9uIgogICAgICAgIGxvZyAiICAtIExvZ01heERpc2tTcGFjZVVzYWdlRW5hYmxlZDogJFVMU0xvZ01heERpc2tTcGFjZVVzYWdlRW5hYmxlZCIKICAgICAgICBsb2cgIiAgLSBMb2dEaXNrU3BhY2VVc2FnZUdCOiAkVUxTTG9nRGlza1NwYWNlIgogICAgICAgIGxvZyAiICAtIExvZ0xvY2F0aW9uOiAkVUxTTG9nRGlyIgogICAgICAgIGxvZyAiICAtIExvZ0N1dEludGVydmFsOiAkVUxTTG9nQ3V0SW50ZXJ2YWwiCiAgICAgICAgU2V0LVNQRGlhZ25vc3RpY0NvbmZpZyAtRGF5c1RvS2VlcExvZ3MgJFVMU0xvZ1JldGVudGlvbiAtTG9nTWF4RGlza1NwYWNlVXNhZ2VFbmFibGVkOiRVTFNMb2dNYXhEaXNrU3BhY2VVc2FnZUVuYWJsZWQgLUxvZ0Rpc2tTcGFjZVVzYWdlR0IgJFVMU0xvZ0Rpc2tTcGFjZSAtTG9nTG9jYXRpb24gJFVMU0xvZ0RpciAtTG9nQ3V0SW50ZXJ2YWwgJFVMU0xvZ0N1dEludGVydmFsCiAgICAgICAgIyBPbmx5IG1vdmUgbG9nIGZpbGVzIGlmIHRoZSBvbGQgJiBuZXcgbG9jYXRpb25zIGFyZSBkaWZmZXJlbnQsIGFuZCBpZiB0aGUgb2xkIGxvY2F0aW9uIGFjdHVhbGx5IGhhZCBhIHZhbHVlCiAgICAgICAgSWYgKCgkVUxTTG9nRGlyIC1uZSAkb2xkVUxTTG9nRGlyKSAtYW5kICghKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRvbGRVTFNMb2dEaXIpKSkpCiAgICAgICAgewogICAgICAgICAgICBsb2cgIiAtIE1vdmluZyBhbnkgY29udGVudHMgaW4gb2xkIGxvY2F0aW9uICRvbGRVTFNMb2dEaXIgdG8gJFVMU0xvZ0Rpci4uLiIKICAgICAgICAgICAgRm9yRWFjaCAoJGl0ZW0gaW4gJChHZXQtQ2hpbGRJdGVtIC1QYXRoICRvbGRVTFNMb2dEaXIpIHwgV2hlcmUtT2JqZWN0IHskXy5OYW1lIC1saWtlICIqLmxvZyJ9KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBNb3ZlLUl0ZW0gLVBhdGggJG9sZFVMU0xvZ0RpclwkaXRlbSAtRGVzdGluYXRpb24gJFVMU0xvZ0RpciAtRm9yY2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgICMgRmluYWxseSwgZW5hYmxlIE5URlMgY29tcHJlc3Npb24gb24gdGhlIFVMUyBsb2cgbG9jYXRpb24gdG8gc2F2ZSBkaXNrIHNwYWNlCiAgICBJZiAoJFVMU0xvZ0NvbmZpZy5Db21wcmVzcyAtZXEgJHRydWUpCiAgICB7CiAgICAgICAgQ29tcHJlc3NGb2xkZXIgJFVMU0xvZ0RpcgogICAgfQogICAgV3JpdGVMaW5lCn0KCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBDb25maWd1cmVVc2FnZUxvZ2dpbmcKIyBEZXNjOiBDb25maWd1cmVzIFVzYWdlIExvZ2dpbmcgZm9yIHRoZSBmYXJtCiMgRnJvbTogU3VibWl0dGVkIGJ5IENvZGVwbGV4IHVzZXIgZGVlZHVieWEgKGh0dHA6Ly93d3cuY29kZXBsZXguY29tL3NpdGUvdXNlcnMvdmlldy9kZWVkdWJ5YSk7IGFkZGl0aW9uYWwgdHdlYWtzIGJ5IEBicmlhbmxhbGEKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBDb25maWd1cmVVc2FnZUxvZ2dpbmcoW3htbF0keG1saW5wdXQpCnsKICAgIFdyaXRlTGluZQogICAgSWYgKEdldC1TUFVzYWdlU2VydmljZSkKICAgIHsKICAgICAgICBHZXQtTWFqb3JWZXJzaW9uTnVtYmVyICR4bWxpbnB1dAogICAgICAgICR1c2FnZUxvZ0NvbmZpZyA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uTG9nZ2luZy5Vc2FnZUxvZ3MKICAgICAgICAkdXNhZ2VMb2dEaXIgPSAkdXNhZ2VMb2dDb25maWcuVXNhZ2VMb2dEaXIKICAgICAgICAkdXNhZ2VMb2dNYXhTcGFjZUdCID0gJHVzYWdlTG9nQ29uZmlnLlVzYWdlTG9nTWF4U3BhY2VHQgogICAgICAgICR1c2FnZUxvZ0N1dFRpbWUgPSAkdXNhZ2VMb2dDb25maWcuVXNhZ2VMb2dDdXRUaW1lCiAgICAgICAgbG9nICIgLSBDb25maWd1cmluZyBVc2FnZSBMb2dnaW5nLi4uIgogICAgICAgICMgU3ludGF4IGZvciBjb21tYW5kOiBTZXQtU1BVc2FnZVNlcnZpY2UgWy1Mb2dnaW5nRW5hYmxlZCB7MSB8IDB9XSBbLVVzYWdlTG9nTG9jYXRpb24gPFBhdGg+XSBbLVVzYWdlTG9nTWF4U3BhY2VHQiA8MS0yMD5dIFstVmVyYm9zZV0KICAgICAgICAjIFRoZXNlIGFyZSBhIHBlci1mYXJtIHNldHRpbmdzLCBub3QgcGVyIFdTUyBVc2FnZSBzZXJ2aWNlIGFwcGxpY2F0aW9uLCBhcyB0aGVyZSBjYW4gb25seSBiZSBvbmUgcGVyIGZhcm0uCiAgICAgICAgVHJ5CiAgICAgICAgewogICAgICAgICAgICBJZiAoIShbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkdXNhZ2VMb2dEaXIpKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgRW5zdXJlRm9sZGVyICR1c2FnZUxvZ0RpcgogICAgICAgICAgICAgICAgJG9sZFVzYWdlTG9nRGlyID0gJChHZXQtU1BVc2FnZVNlcnZpY2UpLlVzYWdlTG9nRGlyCiAgICAgICAgICAgICAgICAkb2xkVXNhZ2VMb2dEaXIgPSAkb2xkVXNhZ2VMb2dEaXIgLXJlcGxhY2UgKCIlQ29tbW9uUHJvZ3JhbUZpbGVzJSIsIiRlbnY6Q29tbW9uUHJvZ3JhbUZpbGVzIikKICAgICAgICAgICAgfQogICAgICAgICAgICBFbHNlICMgQXNzdW1lIGRlZmF1bHQgdmFsdWUgaWYgbm9uZSB3YXMgc3BlY2lmaWVkIGluIHRoZSBYTUwgaW5wdXQgZmlsZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkdXNhZ2VMb2dEaXIgPSAiJGVudjpDb21tb25Qcm9ncmFtRmlsZXNcTWljcm9zb2Z0IFNoYXJlZFxXZWIgU2VydmVyIEV4dGVuc2lvbnNcJGVudjpzcFZlclxMT0dTIgogICAgICAgICAgICB9CiAgICAgICAgICAgICMgVXNhZ2VMb2dNYXhTcGFjZUdCIG11c3QgYmUgYmV0d2VlbiAxIGFuZCAyMC4KICAgICAgICAgICAgSWYgKCgkdXNhZ2VMb2dNYXhTcGFjZUdCIC1sdCAxKSAtb3IgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCR1c2FnZUxvZ01heFNwYWNlR0IpKSkgeyR1c2FnZUxvZ01heFNwYWNlR0IgPSA1fSAjIERlZmF1bHQgdmFsdWUKICAgICAgICAgICAgSWYgKCR1c2FnZUxvZ01heFNwYWNlR0IgLWd0IDIwKSB7JHVzYWdlTG9nTWF4U3BhY2VHQiA9IDIwfSAjIE1heGltdW0gdmFsdWUKICAgICAgICAgICAgIyBVc2FnZUxvZ0N1dFRpbWUgbXVzdCBiZSBiZXR3ZWVuIDEgYW5kIDE0NDAKICAgICAgICAgICAgSWYgKCgkdXNhZ2VMb2dDdXRUaW1lIC1sdCAxKSAtb3IgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCR1c2FnZUxvZ0N1dFRpbWUpKSkgeyR1c2FnZUxvZ0N1dFRpbWUgPSAzMH0gIyBEZWZhdWx0IHZhbHVlCiAgICAgICAgICAgIElmICgkdXNhZ2VMb2dDdXRUaW1lIC1ndCAxNDQwKSB7JHVzYWdlTG9nQ3V0VGltZSA9IDE0NDB9ICMgTWF4aW11bSB2YWx1ZQogICAgICAgICAgICAjIFNldC1TUFVzYWdlU2VydmljZSdzIExvZ2dpbmdFbmFibGVkIGlzIDAgZm9yIGRpc2FibGVkLCBhbmQgMSBmb3IgZW5hYmxlZAogICAgICAgICAgICAkbG9nZ2luZ0VuYWJsZWQgPSAxCiAgICAgICAgICAgIFNldC1TUFVzYWdlU2VydmljZSAtTG9nZ2luZ0VuYWJsZWQgJGxvZ2dpbmdFbmFibGVkIC1Vc2FnZUxvZ0xvY2F0aW9uICIkdXNhZ2VMb2dEaXIiIC1Vc2FnZUxvZ01heFNwYWNlR0IgJHVzYWdlTG9nTWF4U3BhY2VHQiAtVXNhZ2VMb2dDdXRUaW1lICR1c2FnZUxvZ0N1dFRpbWUgfCBPdXQtTnVsbAogICAgICAgICAgICAjIE9ubHkgbW92ZSBsb2cgZmlsZXMgaWYgdGhlIG9sZCAmIG5ldyBsb2NhdGlvbnMgYXJlIGRpZmZlcmVudCwgYW5kIGlmIHRoZSBvbGQgbG9jYXRpb24gYWN0dWFsbHkgaGFkIGEgdmFsdWUKICAgICAgICAgICAgSWYgKCgkdXNhZ2VMb2dEaXIgLW5lICRvbGRVc2FnZUxvZ0RpcikgLWFuZCAoIShbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkb2xkVXNhZ2VMb2dEaXIpKSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiIC0gTW92aW5nIGFueSBjb250ZW50cyBpbiBvbGQgbG9jYXRpb24gJG9sZFVzYWdlTG9nRGlyIHRvICR1c2FnZUxvZ0Rpci4uLiIKICAgICAgICAgICAgICAgIEZvckVhY2ggKCRpdGVtIGluICQoR2V0LUNoaWxkSXRlbSAtUGF0aCAkb2xkVXNhZ2VMb2dEaXIpIHwgV2hlcmUtT2JqZWN0IHskXy5OYW1lIC1saWtlICIqLnVzYWdlIn0pCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTW92ZS1JdGVtIC1QYXRoICRvbGRVc2FnZUxvZ0RpclwkaXRlbSAtRGVzdGluYXRpb24gJHVzYWdlTG9nRGlyIC1Gb3JjZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICMgRmluYWxseSwgZW5hYmxlIE5URlMgY29tcHJlc3Npb24gb24gdGhlIHVzYWdlIGxvZyBsb2NhdGlvbiB0byBzYXZlIGRpc2sgc3BhY2UKICAgICAgICAgICAgSWYgKCR1c2FnZUxvZ0NvbmZpZy5Db21wcmVzcyAtZXEgJHRydWUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIENvbXByZXNzRm9sZGVyICR1c2FnZUxvZ0RpcgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIENhdGNoCiAgICAgICAgewogICAgICAgICAgICBXcml0ZS1PdXRwdXQgJF8KICAgICAgICAgICAgVGhyb3cgIiAtIEVycm9yIGNvbmZpZ3VyaW5nIHVzYWdlIGxvZ2dpbmciCiAgICAgICAgfQogICAgICAgIGxvZyAiIC0gRG9uZSBjb25maWd1cmluZyB1c2FnZSBsb2dnaW5nLiIKICAgIH0KICAgIEVsc2UKICAgIHsKICAgICAgICBsb2cgIiAtIE5vIHVzYWdlIHNlcnZpY2U7IHNraXBwaW5nIHVzYWdlIGxvZ2dpbmcgY29uZmlnLiIKICAgIH0KICAgIFdyaXRlTGluZQp9CgojRW5kUmVnaW9uCgojUmVnaW9uIENyZWF0ZSBXZWIgQW5hbHl0aWNzIFNlcnZpY2UgQXBwbGljYXRpb24KIyBUaGFua3MgYW5kIGNyZWRpdCB0byBKZXNwZXIgTnlnYWFyZCBTY2hpP3R0IChqZXNwZXJAc2NoaW9ldHQuZGspIHBlciBodHRwOi8vYXV0b3NwaW5zdGFsbGVyLmNvZGVwbGV4LmNvbS9UaHJlYWQvVmlldy5hc3B4P1RocmVhZElkPTIzNzU3OCAhCgpGdW5jdGlvbiBDcmVhdGVXZWJBbmFseXRpY3NBcHAoW3htbF0keG1saW5wdXQpCnsKICAgIEdldC1NYWpvclZlcnNpb25OdW1iZXIgJHhtbGlucHV0CiAgICBJZiAoKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuV2ViQW5hbHl0aWNzU2VydmljZSAtZXEgJHRydWUpIC1hbmQgKCRlbnY6c3BWZXIgLWVxICIxNCIpKQogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgIFRyeQogICAgICAgIHsKICAgICAgICAgICAgJGRiU2VydmVyID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuV2ViQW5hbHl0aWNzU2VydmljZS5EYXRhYmFzZS5EQlNlcnZlcgogICAgICAgICAgICAjIElmIHdlIGhhdmVuJ3Qgc3BlY2lmaWVkIGEgREIgU2VydmVyIHRoZW4ganVzdCB1c2UgdGhlIGRlZmF1bHQgdXNlZCBieSB0aGUgRmFybQogICAgICAgICAgICBJZiAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJGRiU2VydmVyKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJGRiU2VydmVyID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5EYXRhYmFzZS5EQlNlcnZlcgogICAgICAgICAgICB9CiAgICAgICAgICAgICRhcHBsaWNhdGlvblBvb2wgPSBHZXQtSG9zdGVkU2VydmljZXNBcHBQb29sICR4bWxpbnB1dAogICAgICAgICAgICAkZGJQcmVmaXggPSBHZXQtREJQcmVmaXggJHhtbGlucHV0CiAgICAgICAgICAgICR3ZWJBbmFseXRpY3NSZXBvcnRpbmdEQiA9ICRkYlByZWZpeCskeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5XZWJBbmFseXRpY3NTZXJ2aWNlLkRhdGFiYXNlLlJlcG9ydGluZ0RCCiAgICAgICAgICAgICR3ZWJBbmFseXRpY3NTdGFnaW5nREIgPSAkZGJQcmVmaXgrJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuV2ViQW5hbHl0aWNzU2VydmljZS5EYXRhYmFzZS5TdGFnaW5nREIKICAgICAgICAgICAgJHdlYkFuYWx5dGljc1NlcnZpY2VOYW1lID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuV2ViQW5hbHl0aWNzU2VydmljZS5OYW1lCiAgICAgICAgICAgICRnZXRXZWJBbmFseXRpY3NTZXJ2aWNlQXBwbGljYXRpb24gPSBHZXQtU1BXZWJBbmFseXRpY3NTZXJ2aWNlQXBwbGljYXRpb24gJHdlYkFuYWx5dGljc1NlcnZpY2VOYW1lIC1lYSBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgIGxvZyAiIC0gUHJvdmlzaW9uaW5nICR3ZWJBbmFseXRpY3NTZXJ2aWNlTmFtZS4uLiIKICAgICAgICAgICAgIyBTdGFydCBBbmFseXRpY3Mgc2VydmljZSBpbnN0YW5jZXMKICAgICAgICAgICAgbG9nICIgLSBDaGVja2luZyBBbmFseXRpY3MgU2VydmljZSBpbnN0YW5jZXMuLi4iCiAgICAgICAgICAgICRhbmFseXRpY3NXZWJTZXJ2aWNlSW5zdGFuY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLlNlcnZlci5XZWJBbmFseXRpY3MuQWRtaW5pc3RyYXRpb24uV2ViQW5hbHl0aWNzV2ViU2VydmljZUluc3RhbmNlIn0KICAgICAgICAgICAgJGFuYWx5dGljc1dlYlNlcnZpY2VJbnN0YW5jZSA9ICRhbmFseXRpY3NXZWJTZXJ2aWNlSW5zdGFuY2VzIHwgPyB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyLkFkZHJlc3MgJGVudjpDT01QVVRFUk5BTUV9CiAgICAgICAgICAgIElmICgtbm90ICQ/KSB7IFRocm93ICIgLSBGYWlsZWQgdG8gZmluZCBBbmFseXRpY3MgV2ViIFNlcnZpY2UgaW5zdGFuY2UiIH0KICAgICAgICAgICAgbG9nICIgLSBTdGFydGluZyBsb2NhbCBBbmFseXRpY3MgV2ViIFNlcnZpY2UgaW5zdGFuY2UuLi4iCiAgICAgICAgICAgICRhbmFseXRpY3NXZWJTZXJ2aWNlSW5zdGFuY2UuUHJvdmlzaW9uKCkKICAgICAgICAgICAgJGFuYWx5dGljc0RhdGFQcm9jZXNzaW5nSW5zdGFuY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLlNlcnZlci5XZWJBbmFseXRpY3MuQWRtaW5pc3RyYXRpb24uV2ViQW5hbHl0aWNzU2VydmljZUluc3RhbmNlIn0KICAgICAgICAgICAgJGFuYWx5dGljc0RhdGFQcm9jZXNzaW5nSW5zdGFuY2UgPSAkYW5hbHl0aWNzRGF0YVByb2Nlc3NpbmdJbnN0YW5jZXMgfCA/IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXIuQWRkcmVzcyAkZW52OkNPTVBVVEVSTkFNRX0KICAgICAgICAgICAgSWYgKC1ub3QgJD8pIHsgVGhyb3cgIiAtIEZhaWxlZCB0byBmaW5kIEFuYWx5dGljcyBEYXRhIFByb2Nlc3NpbmcgU2VydmljZSBpbnN0YW5jZSIgfQogICAgICAgICAgICBVcGRhdGVQcm9jZXNzSWRlbnRpdHkgJGFuYWx5dGljc0RhdGFQcm9jZXNzaW5nSW5zdGFuY2UKICAgICAgICAgICAgJGFuYWx5dGljc0RhdGFQcm9jZXNzaW5nSW5zdGFuY2UuVXBkYXRlKCkKICAgICAgICAgICAgbG9nICIgLSBTdGFydGluZyBsb2NhbCBBbmFseXRpY3MgRGF0YSBQcm9jZXNzaW5nIFNlcnZpY2UgaW5zdGFuY2UuLi4iCiAgICAgICAgICAgICRhbmFseXRpY3NEYXRhUHJvY2Vzc2luZ0luc3RhbmNlLlByb3Zpc2lvbigpCiAgICAgICAgICAgIElmICgkZ2V0V2ViQW5hbHl0aWNzU2VydmljZUFwcGxpY2F0aW9uIC1lcSAkbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJHN0YWdlclN1YnNjcmlwdGlvbiA9ICI8U3RhZ2luZ0RhdGFiYXNlcz48U3RhZ2luZ0RhdGFiYXNlIFNlcnZlck5hbWU9JyRkYlNlcnZlcicgRGF0YWJhc2VOYW1lPSckd2ViQW5hbHl0aWNzU3RhZ2luZ0RCJy8+PC9TdGFnaW5nRGF0YWJhc2VzPiIKICAgICAgICAgICAgICAgICR3YXJlaG91c2VTdWJzY3JpcHRpb24gPSAiPFJlcG9ydGluZ0RhdGFiYXNlcz48UmVwb3J0aW5nRGF0YWJhc2UgU2VydmVyTmFtZT0nJGRiU2VydmVyJyBEYXRhYmFzZU5hbWU9JyR3ZWJBbmFseXRpY3NSZXBvcnRpbmdEQicvPjwvUmVwb3J0aW5nRGF0YWJhc2VzPiIKICAgICAgICAgICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgJHdlYkFuYWx5dGljc1NlcnZpY2VOYW1lLi4uIgogICAgICAgICAgICAgICAgJHNlcnZpY2VBcHBsaWNhdGlvbiA9IE5ldy1TUFdlYkFuYWx5dGljc1NlcnZpY2VBcHBsaWNhdGlvbiAtTmFtZSAkd2ViQW5hbHl0aWNzU2VydmljZU5hbWUgLVJlcG9ydGluZ0RhdGFSZXRlbnRpb24gMjAgLVNhbXBsaW5nUmF0ZSAxMDAgLUxpc3RPZlJlcG9ydGluZ0RhdGFiYXNlcyAkd2FyZWhvdXNlU3Vic2NyaXB0aW9uIC1MaXN0T2ZTdGFnaW5nRGF0YWJhc2VzICRzdGFnZXJTdWJzY3JpcHRpb24gLUFwcGxpY2F0aW9uUG9vbCAkYXBwbGljYXRpb25Qb29sCiAgICAgICAgICAgICAgICAjIENyZWF0ZSBXZWIgQW5hbHl0aWNzIFNlcnZpY2UgQXBwbGljYXRpb24gUHJveHkKICAgICAgICAgICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgJHdlYkFuYWx5dGljc1NlcnZpY2VOYW1lIFByb3h5Li4uIgogICAgICAgICAgICAgICAgJG5ld1dlYkFuYWx5dGljc1NlcnZpY2VBcHBsaWNhdGlvblByb3h5ID0gTmV3LVNQV2ViQW5hbHl0aWNzU2VydmljZUFwcGxpY2F0aW9uUHJveHkgIC1OYW1lICR3ZWJBbmFseXRpY3NTZXJ2aWNlTmFtZSAtU2VydmljZUFwcGxpY2F0aW9uICRzZXJ2aWNlQXBwbGljYXRpb24uTmFtZQogICAgICAgICAgICB9CiAgICAgICAgICAgIEVsc2Uge2xvZyAiIC0gV2ViIEFuYWx5dGljcyBTZXJ2aWNlIEFwcGxpY2F0aW9uIGFscmVhZHkgcHJvdmlzaW9uZWQuIn0KICAgICAgICB9CiAgICAgICAgQ2F0Y2gKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAkXwogICAgICAgICAgICBUaHJvdyAiIC0gRXJyb3IgUHJvdmlzaW9uaW5nIFdlYiBBbmFseXRpY3MgU2VydmljZSBBcHBsaWNhdGlvbiIKICAgICAgICB9CiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBDcmVhdGUgU2VjdXJlIFN0b3JlIFNlcnZpY2UgQXBwbGljYXRpb24KRnVuY3Rpb24gQ3JlYXRlU2VjdXJlU3RvcmVTZXJ2aWNlQXBwCnsKICAgICMgU2VjdXJlIFN0b3JlIFNlcnZpY2UgQXBwbGljYXRpb24gd2lsbCBiZSBwcm92aXNpb25lZCBldmVuIGlmIGl0J3MgYmVlbiBtYXJrZWQgZmFsc2UsIGlmIGFueSBvZiB0aGVzZSBzZXJ2aWNlIGFwcHMgaGF2ZSBiZWVuIHJlcXVlc3RlZCAoYW5kIGZvciB0aGUgY29ycmVjdCB2ZXJzaW9uIG9mIFNoYXJlUG9pbnQpLCBhcyBpdCdzIGEgZGVwZW5kZW5jeS4KICAgIElmICgoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TZWN1cmVTdG9yZVNlcnZpY2UgLWVxICR0cnVlKSAtb3IgYAogICAgICAgICgoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuRXhjZWxTZXJ2aWNlcyAtZXEgJHRydWUpIC1hbmQgKCRlbnY6U1BWZXIgLWxlICIxNSIpKSAtb3IgYAogICAgICAgIChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5WaXNpb1NlcnZpY2UgLWVxICR0cnVlKSAtb3IgYAogICAgICAgIChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5QZXJmb3JtYW5jZVBvaW50U2VydmljZSAtZXEgJHRydWUpIC1vciBgCiAgICAgICAgKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuQnVzaW5lc3NEYXRhQ29ubmVjdGl2aXR5IC1lcSAkdHJ1ZSkgLW9yIGAKICAgICAgICAoKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uT2ZmaWNlV2ViQXBwcy5FeGNlbFNlcnZpY2UgLWVxICR0cnVlKSAtYW5kICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5PZmZpY2VXZWJBcHBzLkluc3RhbGwgLWVxICR0cnVlKSkgYAogICAgICAgKQogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgIFRyeQogICAgICAgIHsKICAgICAgICAgICAgSWYgKCEoJGZhcm1QYXNzcGhyYXNlKSAtb3IgKCRmYXJtUGFzc3BocmFzZSAtZXEgIiIpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkZmFybVBhc3NwaHJhc2UgPSBHZXRGYXJtUGFzc1BocmFzZSAkeG1saW5wdXQKICAgICAgICAgICAgfQogICAgICAgICAgICAkc2VjdXJlU3RvcmVTZXJ2aWNlQXBwTmFtZSA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlNlY3VyZVN0b3JlU2VydmljZS5OYW1lCiAgICAgICAgICAgICRzZWN1cmVTdG9yZVNlcnZpY2VBcHBQcm94eU5hbWUgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TZWN1cmVTdG9yZVNlcnZpY2UuUHJveHlOYW1lCiAgICAgICAgICAgIElmICgkc2VjdXJlU3RvcmVTZXJ2aWNlQXBwTmFtZSAtZXEgJG51bGwpIHskc2VjdXJlU3RvcmVTZXJ2aWNlQXBwTmFtZSA9ICJTZWN1cmUgU3RvcmUgU2VydmljZSJ9CiAgICAgICAgICAgIElmICgkc2VjdXJlU3RvcmVTZXJ2aWNlQXBwUHJveHlOYW1lIC1lcSAkbnVsbCkgeyRzZWN1cmVTdG9yZVNlcnZpY2VBcHBQcm94eU5hbWUgPSAkc2VjdXJlU3RvcmVTZXJ2aWNlQXBwTmFtZX0KICAgICAgICAgICAgJGRiU2VydmVyID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuU2VjdXJlU3RvcmVTZXJ2aWNlLkRhdGFiYXNlLkRCU2VydmVyCiAgICAgICAgICAgICMgSWYgd2UgaGF2ZW4ndCBzcGVjaWZpZWQgYSBEQiBTZXJ2ZXIgdGhlbiBqdXN0IHVzZSB0aGUgZGVmYXVsdCB1c2VkIGJ5IHRoZSBGYXJtCiAgICAgICAgICAgIElmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkZGJTZXJ2ZXIpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkZGJTZXJ2ZXIgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkRhdGFiYXNlLkRCU2VydmVyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGRiUHJlZml4ID0gR2V0LURCUHJlZml4ICR4bWxpbnB1dAogICAgICAgICAgICAkc2VjdXJlU3RvcmVEQiA9ICRkYlByZWZpeCskeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TZWN1cmVTdG9yZVNlcnZpY2UuRGF0YWJhc2UuTmFtZQogICAgICAgICAgICBsb2cgIiAtIFByb3Zpc2lvbmluZyBTZWN1cmUgU3RvcmUgU2VydmljZSBBcHBsaWNhdGlvbi4uLiIKICAgICAgICAgICAgJGFwcGxpY2F0aW9uUG9vbCA9IEdldC1Ib3N0ZWRTZXJ2aWNlc0FwcFBvb2wgJHhtbGlucHV0CiAgICAgICAgICAgICMgR2V0IHRoZSBzZXJ2aWNlIGluc3RhbmNlCiAgICAgICAgICAgICRzZWN1cmVTdG9yZVNlcnZpY2VJbnN0YW5jZXMgPSBHZXQtU1BTZXJ2aWNlSW5zdGFuY2UgfCA/IHskXy5HZXRUeXBlKCkuRXF1YWxzKFtNaWNyb3NvZnQuT2ZmaWNlLlNlY3VyZVN0b3JlU2VydmljZS5TZXJ2ZXIuU2VjdXJlU3RvcmVTZXJ2aWNlSW5zdGFuY2VdKX0KICAgICAgICAgICAgJHNlY3VyZVN0b3JlU2VydmljZUluc3RhbmNlID0gJHNlY3VyZVN0b3JlU2VydmljZUluc3RhbmNlcyB8ID8ge01hdGNoQ29tcHV0ZXJOYW1lICRfLlNlcnZlci5BZGRyZXNzICRlbnY6Q09NUFVURVJOQU1FfQogICAgICAgICAgICBJZiAoLW5vdCAkPykgeyBUaHJvdyAiIC0gRmFpbGVkIHRvIGZpbmQgU2VjdXJlIFN0b3JlIHNlcnZpY2UgaW5zdGFuY2UiIH0KICAgICAgICAgICAgIyBTdGFydCBTZXJ2aWNlIGluc3RhbmNlCiAgICAgICAgICAgIElmICgkc2VjdXJlU3RvcmVTZXJ2aWNlSW5zdGFuY2UuU3RhdHVzIC1lcSAiRGlzYWJsZWQiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAtIFN0YXJ0aW5nIFNlY3VyZSBTdG9yZSBTZXJ2aWNlIEluc3RhbmNlLi4uIgogICAgICAgICAgICAgICAgJHNlY3VyZVN0b3JlU2VydmljZUluc3RhbmNlLlByb3Zpc2lvbigpCiAgICAgICAgICAgICAgICBJZiAoLW5vdCAkPykgeyBUaHJvdyAiIC0gRmFpbGVkIHRvIHN0YXJ0IFNlY3VyZSBTdG9yZSBzZXJ2aWNlIGluc3RhbmNlIiB9CiAgICAgICAgICAgICAgICAjIFdhaXQKICAgICAgICAgICAgICAgIGxvZyAiIC0gV2FpdGluZyBmb3IgU2VjdXJlIFN0b3JlIHNlcnZpY2UuLi4iIAogICAgICAgICAgICAgICAgV2hpbGUgKCRzZWN1cmVTdG9yZVNlcnZpY2VJbnN0YW5jZS5TdGF0dXMgLW5lICJPbmxpbmUiKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiLiIgCiAgICAgICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgMQogICAgICAgICAgICAgICAgICAgICRzZWN1cmVTdG9yZVNlcnZpY2VJbnN0YW5jZXMgPSBHZXQtU1BTZXJ2aWNlSW5zdGFuY2UgfCA/IHskXy5HZXRUeXBlKCkuVG9TdHJpbmcoKSAtZXEgIk1pY3Jvc29mdC5PZmZpY2UuU2VjdXJlU3RvcmVTZXJ2aWNlLlNlcnZlci5TZWN1cmVTdG9yZVNlcnZpY2VJbnN0YW5jZSJ9CiAgICAgICAgICAgICAgICAgICAgJHNlY3VyZVN0b3JlU2VydmljZUluc3RhbmNlID0gJHNlY3VyZVN0b3JlU2VydmljZUluc3RhbmNlcyB8ID8ge01hdGNoQ29tcHV0ZXJOYW1lICRfLlNlcnZlci5BZGRyZXNzICRlbnY6Q09NUFVURVJOQU1FfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbG9nICQoJHNlY3VyZVN0b3JlU2VydmljZUluc3RhbmNlLlN0YXR1cykKICAgICAgICAgICAgfQogICAgICAgICAgICAjIENyZWF0ZSBTZXJ2aWNlIEFwcGxpY2F0aW9uCiAgICAgICAgICAgICRnZXRTUFNlY3VyZVN0b3JlU2VydmljZUFwcGxpY2F0aW9uID0gR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uIHwgPyB7JF8uR2V0VHlwZSgpLkVxdWFscyhbTWljcm9zb2Z0Lk9mZmljZS5TZWN1cmVTdG9yZVNlcnZpY2UuU2VydmVyLlNlY3VyZVN0b3JlU2VydmljZUFwcGxpY2F0aW9uXSl9CiAgICAgICAgICAgIElmICgkZ2V0U1BTZWN1cmVTdG9yZVNlcnZpY2VBcHBsaWNhdGlvbiAtZXEgJG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgU2VjdXJlIFN0b3JlIFNlcnZpY2UgQXBwbGljYXRpb24uLi4iCiAgICAgICAgICAgICAgICBOZXctU1BTZWN1cmVTdG9yZVNlcnZpY2VBcHBsaWNhdGlvbiAtTmFtZSAkc2VjdXJlU3RvcmVTZXJ2aWNlQXBwTmFtZSAtUGFydGl0aW9uTW9kZTokZmFsc2UgLVNoYXJpbmc6JGZhbHNlIC1EYXRhYmFzZVNlcnZlciAkZGJTZXJ2ZXIgLURhdGFiYXNlTmFtZSAkc2VjdXJlU3RvcmVEQiAtQXBwbGljYXRpb25Qb29sICQoJGFwcGxpY2F0aW9uUG9vbC5OYW1lKSAtQXVkaXRpbmdFbmFibGVkOiR0cnVlIC1BdWRpdExvZ01heFNpemUgMzAgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyBTZWN1cmUgU3RvcmUgU2VydmljZSBBcHBsaWNhdGlvbiBQcm94eS4uLiIKICAgICAgICAgICAgICAgIEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8ID8geyRfLkdldFR5cGUoKS5FcXVhbHMoW01pY3Jvc29mdC5PZmZpY2UuU2VjdXJlU3RvcmVTZXJ2aWNlLlNlcnZlci5TZWN1cmVTdG9yZVNlcnZpY2VBcHBsaWNhdGlvbl0pfSB8IE5ldy1TUFNlY3VyZVN0b3JlU2VydmljZUFwcGxpY2F0aW9uUHJveHkgLU5hbWUgJHNlY3VyZVN0b3JlU2VydmljZUFwcFByb3h5TmFtZSAtRGVmYXVsdFByb3h5R3JvdXAgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgbG9nICIgLSBEb25lIGNyZWF0aW5nIFNlY3VyZSBTdG9yZSBTZXJ2aWNlIEFwcGxpY2F0aW9uLiIKICAgICAgICAgICAgfQogICAgICAgICAgICBFbHNlIHtsb2cgIiAtIFNlY3VyZSBTdG9yZSBTZXJ2aWNlIEFwcGxpY2F0aW9uIGFscmVhZHkgcHJvdmlzaW9uZWQuIn0KCiAgICAgICAgICAgICRzZWN1cmVTdG9yZSA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvblByb3h5IHwgV2hlcmUgeyRfLkdldFR5cGUoKS5FcXVhbHMoW01pY3Jvc29mdC5PZmZpY2UuU2VjdXJlU3RvcmVTZXJ2aWNlLlNlcnZlci5TZWN1cmVTdG9yZVNlcnZpY2VBcHBsaWNhdGlvblByb3h5XSl9CiAgICAgICAgICAgIFN0YXJ0LVNsZWVwIDUKICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyB0aGUgTWFzdGVyIEtleS4uLiIKICAgICAgICAgICAgVXBkYXRlLVNQU2VjdXJlU3RvcmVNYXN0ZXJLZXkgLVNlcnZpY2VBcHBsaWNhdGlvblByb3h5ICRzZWN1cmVTdG9yZS5JZCAtUGFzc3BocmFzZSAkZmFybVBhc3NwaHJhc2UKICAgICAgICAgICAgU3RhcnQtU2xlZXAgNQogICAgICAgICAgICBsb2cgIiAtIENyZWF0aW5nIHRoZSBBcHBsaWNhdGlvbiBLZXkuLi4iCiAgICAgICAgICAgIFVwZGF0ZS1TUFNlY3VyZVN0b3JlQXBwbGljYXRpb25TZXJ2ZXJLZXkgLVNlcnZpY2VBcHBsaWNhdGlvblByb3h5ICRzZWN1cmVTdG9yZS5JZCAtUGFzc3BocmFzZSAkZmFybVBhc3NwaHJhc2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgU3RhcnQtU2xlZXAgNQogICAgICAgICAgICBJZiAoISQ/KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIFRyeSBhZ2Fpbi4uLgogICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyB0aGUgQXBwbGljYXRpb24gS2V5ICgybmQgYXR0ZW1wdCkuLi4iCiAgICAgICAgICAgICAgICBVcGRhdGUtU1BTZWN1cmVTdG9yZUFwcGxpY2F0aW9uU2VydmVyS2V5IC1TZXJ2aWNlQXBwbGljYXRpb25Qcm94eSAkc2VjdXJlU3RvcmUuSWQgLVBhc3NwaHJhc2UgJGZhcm1QYXNzcGhyYXNlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQ2F0Y2gKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAkXwogICAgICAgICAgICBUaHJvdyAiIC0gRXJyb3IgcHJvdmlzaW9uaW5nIHNlY3VyZSBzdG9yZSBhcHBsaWNhdGlvbiIKICAgICAgICB9CiAgICAgICAgbG9nICIgLSBEb25lIGNyZWF0aW5nL2NvbmZpZ3VyaW5nIFNlY3VyZSBTdG9yZSBTZXJ2aWNlIEFwcGxpY2F0aW9uLiIKICAgICAgICBXcml0ZUxpbmUKICAgIH0KfQojRW5kUmVnaW9uCgojUmVnaW9uIFN0YXJ0IFNlYXJjaCBRdWVyeSBhbmQgU2l0ZSBTZXR0aW5ncyBTZXJ2aWNlCkZ1bmN0aW9uIFN0YXJ0U2VhcmNoUXVlcnlBbmRTaXRlU2V0dGluZ3NTZXJ2aWNlCnsKICAgIElmIChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuU2VhcmNoUXVlcnlBbmRTaXRlU2V0dGluZ3NTZXJ2aWNlIC1lcSAkdHJ1ZSkKICAgIHsKICAgICAgICBXcml0ZUxpbmUKICAgICAgICBUcnkKICAgICAgICB7CiAgICAgICAgICAgICMgR2V0IHRoZSBzZXJ2aWNlIGluc3RhbmNlCiAgICAgICAgICAgICRzZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc1NlcnZpY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLlNlcnZlci5TZWFyY2guQWRtaW5pc3RyYXRpb24uU2VhcmNoUXVlcnlBbmRTaXRlU2V0dGluZ3NTZXJ2aWNlSW5zdGFuY2UifQogICAgICAgICAgICAkc2VhcmNoUXVlcnlBbmRTaXRlU2V0dGluZ3NTZXJ2aWNlID0gJHNlYXJjaFF1ZXJ5QW5kU2l0ZVNldHRpbmdzU2VydmljZXMgfCA/IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXIuQWRkcmVzcyAkZW52OkNPTVBVVEVSTkFNRX0KICAgICAgICAgICAgSWYgKC1ub3QgJD8pIHsgVGhyb3cgIiAtIEZhaWxlZCB0byBmaW5kIFNlYXJjaCBRdWVyeSBhbmQgU2l0ZSBTZXR0aW5ncyBzZXJ2aWNlIGluc3RhbmNlIiB9CiAgICAgICAgICAgICMgU3RhcnQgU2VydmljZSBpbnN0YW5jZQogICAgICAgICAgICBsb2cgIiAtIFN0YXJ0aW5nIFNlYXJjaCBRdWVyeSBhbmQgU2l0ZSBTZXR0aW5ncyBTZXJ2aWNlIEluc3RhbmNlLi4uIgogICAgICAgICAgICBJZigkc2VhcmNoUXVlcnlBbmRTaXRlU2V0dGluZ3NTZXJ2aWNlLlN0YXR1cyAtZXEgIkRpc2FibGVkIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJHNlYXJjaFF1ZXJ5QW5kU2l0ZVNldHRpbmdzU2VydmljZS5Qcm92aXNpb24oKQogICAgICAgICAgICAgICAgSWYgKC1ub3QgJD8pIHsgVGhyb3cgIiAtIEZhaWxlZCB0byBzdGFydCBTZWFyY2ggUXVlcnkgYW5kIFNpdGUgU2V0dGluZ3Mgc2VydmljZSBpbnN0YW5jZSIgfQogICAgICAgICAgICAgICAgIyBXYWl0CiAgICAgICAgICAgICAgICBsb2cgIiAtIFdhaXRpbmcgZm9yIFNlYXJjaCBRdWVyeSBhbmQgU2l0ZSBTZXR0aW5ncyBzZXJ2aWNlLi4uIiAKICAgICAgICAgICAgICAgIFdoaWxlICgkc2VhcmNoUXVlcnlBbmRTaXRlU2V0dGluZ3NTZXJ2aWNlLlN0YXR1cyAtbmUgIk9ubGluZSIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIuIiAKICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAxCiAgICAgICAgICAgICAgICAgICAgJHNlYXJjaFF1ZXJ5QW5kU2l0ZVNldHRpbmdzU2VydmljZXMgPSBHZXQtU1BTZXJ2aWNlSW5zdGFuY2UgfCA/IHskXy5HZXRUeXBlKCkuVG9TdHJpbmcoKSAtZXEgIk1pY3Jvc29mdC5PZmZpY2UuU2VydmVyLlNlYXJjaC5BZG1pbmlzdHJhdGlvbi5TZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc1NlcnZpY2VJbnN0YW5jZSJ9CiAgICAgICAgICAgICAgICAgICAgJHNlYXJjaFF1ZXJ5QW5kU2l0ZVNldHRpbmdzU2VydmljZSA9ICRzZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc1NlcnZpY2VzIHwgPyB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyLkFkZHJlc3MgJGVudjpDT01QVVRFUk5BTUV9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2cgJCgkc2VhcmNoUXVlcnlBbmRTaXRlU2V0dGluZ3NTZXJ2aWNlLlN0YXR1cykKICAgICAgICAgICAgfQogICAgICAgICAgICBFbHNlIHtsb2cgIiAtIFNlYXJjaCBRdWVyeSBhbmQgU2l0ZSBTZXR0aW5ncyBTZXJ2aWNlIGFscmVhZHkgc3RhcnRlZC4ifQogICAgICAgIH0KICAgICAgICBDYXRjaAogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICRfCiAgICAgICAgICAgIFRocm93ICIgLSBFcnJvciBwcm92aXNpb25pbmcgU2VhcmNoIFF1ZXJ5IGFuZCBTaXRlIFNldHRpbmdzIFNlcnZpY2UiCiAgICAgICAgfQogICAgICAgIFdyaXRlTGluZQogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ29uZmlndXJlIENsYWltcyB0byBXaW5kb3dzIFRva2VuIFNlcnZpY2UKRnVuY3Rpb24gQ29uZmlndXJlQ2xhaW1zVG9XaW5kb3dzVG9rZW5TZXJ2aWNlCnsKICAgICMgQzJXVFMgaXMgcmVxdWlyZWQgYnkgRXhjZWwgU2VydmljZXMsIFZpc2lvIFNlcnZpY2VzIGFuZCBQZXJmb3JtYW5jZVBvaW50IFNlcnZpY2VzOyBpZiBhbnkgb2YgdGhlc2UgYXJlIGJlaW5nIHByb3Zpc2lvbmVkIHdlIHNob3VsZCBzdGFydCBpdC4KICAgIElmICgoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZpY2VzLkNsYWltc1RvV2luZG93c1Rva2VuU2VydmljZSAtZXEgJHRydWUpIC1vciBgCiAgICAgICAgKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLkV4Y2VsU2VydmljZXMgLWVxICR0cnVlKSAtb3IgYAogICAgICAgIChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5WaXNpb1NlcnZpY2UgLWVxICR0cnVlKSAtb3IgYAogICAgICAgIChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5QZXJmb3JtYW5jZVBvaW50U2VydmljZSAtZXEgJHRydWUpIC1vciBgCiAgICAgICAgKChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLk9mZmljZVdlYkFwcHMuRXhjZWxTZXJ2aWNlIC1lcSAkdHJ1ZSkgLWFuZCAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uT2ZmaWNlV2ViQXBwcy5JbnN0YWxsIC1lcSAkdHJ1ZSkpKQogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgICMgRW5zdXJlIENsYWltcyB0byBXaW5kb3dzIFRva2VuIFNlcnZpY2UgaXMgc3RhcnRlZAogICAgICAgICRjbGFpbXNTZXJ2aWNlcyA9IEdldC1TUFNlcnZpY2VJbnN0YW5jZSB8ID8geyRfLkdldFR5cGUoKS5Ub1N0cmluZygpIC1lcSAiTWljcm9zb2Z0LlNoYXJlUG9pbnQuQWRtaW5pc3RyYXRpb24uQ2xhaW1zLlNQV2luZG93c1Rva2VuU2VydmljZUluc3RhbmNlIn0KICAgICAgICAkY2xhaW1zU2VydmljZSA9ICRjbGFpbXNTZXJ2aWNlcyB8ID8ge01hdGNoQ29tcHV0ZXJOYW1lICRfLlNlcnZlci5BZGRyZXNzICRlbnY6Q09NUFVURVJOQU1FfQogICAgICAgIElmICgkY2xhaW1zU2VydmljZS5TdGF0dXMgLW5lICJPbmxpbmUiKQogICAgICAgIHsKICAgICAgICAgICAgVHJ5CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiIC0gU3RhcnRpbmcgJCgkY2xhaW1zU2VydmljZS5EaXNwbGF5TmFtZSkuLi4iCiAgICAgICAgICAgICAgICBpZiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2aWNlcy5DbGFpbXNUb1dpbmRvd3NUb2tlblNlcnZpY2UuVXBkYXRlQWNjb3VudCAtZXEgJHRydWUpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgVXBkYXRlUHJvY2Vzc0lkZW50aXR5ICRjbGFpbXNTZXJ2aWNlCiAgICAgICAgICAgICAgICAgICAgJGNsYWltc1NlcnZpY2UuVXBkYXRlKCkKICAgICAgICAgICAgICAgICAgICAjIEFkZCBDMldUUyBhY2NvdW50IChjdXJyZW50bHkgdGhlIGdlbmVyaWMgc2VydmljZSBhY2NvdW50KSB0byBsb2NhbCBhZG1pbnMKICAgICAgICAgICAgICAgICAgICAkYnVpbHRpbkFkbWluR3JvdXAgPSBHZXQtQWRtaW5pc3RyYXRvcnNHcm91cAogICAgICAgICAgICAgICAgICAgICRhZG1pbkdyb3VwID0gKFtBRFNJXSJXaW5OVDovLyRlbnY6Q09NUFVURVJOQU1FLyRidWlsdGluQWRtaW5Hcm91cCxncm91cCIpCiAgICAgICAgICAgICAgICAgICAgIyBUaGlzIHN5bnRheCBjb21lcyBmcm9tIFlpbmcgTGkgKGh0dHA6Ly9teWl0Zm9ydW0uY29tL2NzMi9ibG9ncy95bGk2MjgvYXJjaGl2ZS8yMDA3LzA4LzMwL3Bvd2Vyc2hlbGwtc2NyaXB0LXRvLWFkZC1yZW1vdmUtYS1kb21haW4tdXNlci10by10aGUtbG9jYWwtYWRtaW5pc3RyYXRvcnMtZ3JvdXAtb24tYS1yZW1vdGUtbWFjaGluZS5hc3B4KQogICAgICAgICAgICAgICAgICAgICRsb2NhbEFkbWlucyA9ICRhZG1pbkdyb3VwLnBzYmFzZS5pbnZva2UoIk1lbWJlcnMiKSB8IEZvckVhY2gtT2JqZWN0IHskXy5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCJOYW1lIiwgJ0dldFByb3BlcnR5JywgJG51bGwsICRfLCAkbnVsbCl9CiAgICAgICAgICAgICAgICAgICAgJHNwc2VydmljZSA9IEdldC1TUE1hbmFnZWRBY2NvdW50WE1MICR4bWxpbnB1dCAtQ29tbW9uTmFtZSAic3BzZXJ2aWNlIgogICAgICAgICAgICAgICAgICAgICRtYW5hZ2VkQWNjb3VudEdlbiA9IEdldC1TUE1hbmFnZWRBY2NvdW50IHwgV2hlcmUtT2JqZWN0IHskXy5Vc2VyTmFtZSAtZXEgJCgkc3BzZXJ2aWNlLnVzZXJuYW1lKX0KICAgICAgICAgICAgICAgICAgICAkbWFuYWdlZEFjY291bnREb21haW4sJG1hbmFnZWRBY2NvdW50VXNlciA9ICRtYW5hZ2VkQWNjb3VudEdlbi5Vc2VyTmFtZSAtc3BsaXQgIlxcIgogICAgICAgICAgICAgICAgICAgIElmICghKCRsb2NhbEFkbWlucyAtY29udGFpbnMgJG1hbmFnZWRBY2NvdW50VXNlcikpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIEFkZGluZyAkKCRtYW5hZ2VkQWNjb3VudEdlbi5Vc2VybmFtZSkgdG8gbG9jYWwgQWRtaW5pc3RyYXRvcnMuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgIChbQURTSV0iV2luTlQ6Ly8kZW52OkNPTVBVVEVSTkFNRS8kYnVpbHRpbkFkbWluR3JvdXAsZ3JvdXAiKS5BZGQoIldpbk5UOi8vJG1hbmFnZWRBY2NvdW50RG9tYWluLyRtYW5hZ2VkQWNjb3VudFVzZXIiKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRjbGFpbXNTZXJ2aWNlLlByb3Zpc2lvbigpCiAgICAgICAgICAgICAgICBJZiAoLW5vdCAkPykge3Rocm93ICIgLSBGYWlsZWQgdG8gc3RhcnQgJCgkY2xhaW1zU2VydmljZS5EaXNwbGF5TmFtZSkifQogICAgICAgICAgICB9CiAgICAgICAgICAgIENhdGNoCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFRocm93ICIgLSBBbiBlcnJvciBvY2N1cnJlZCBzdGFydGluZyAkKCRjbGFpbXNTZXJ2aWNlLkRpc3BsYXlOYW1lKSIKICAgICAgICAgICAgfQogICAgICAgICAgICAjV2FpdAogICAgICAgICAgICBsb2cgIiAtIFdhaXRpbmcgZm9yICQoJGNsYWltc1NlcnZpY2UuRGlzcGxheU5hbWUpLi4uIiAKICAgICAgICAgICAgV2hpbGUgKCRjbGFpbXNTZXJ2aWNlLlN0YXR1cyAtbmUgIk9ubGluZSIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiLiIgCiAgICAgICAgICAgICAgICBzbGVlcCAxCiAgICAgICAgICAgICAgICAkY2xhaW1zU2VydmljZXMgPSBHZXQtU1BTZXJ2aWNlSW5zdGFuY2UgfCA/IHskXy5HZXRUeXBlKCkuVG9TdHJpbmcoKSAtZXEgIk1pY3Jvc29mdC5TaGFyZVBvaW50LkFkbWluaXN0cmF0aW9uLkNsYWltcy5TUFdpbmRvd3NUb2tlblNlcnZpY2VJbnN0YW5jZSJ9CiAgICAgICAgICAgICAgICAkY2xhaW1zU2VydmljZSA9ICRjbGFpbXNTZXJ2aWNlcyB8ID8ge01hdGNoQ29tcHV0ZXJOYW1lICRfLlNlcnZlci5BZGRyZXNzICRlbnY6Q09NUFVURVJOQU1FfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGxvZyAkKCRjbGFpbXNTZXJ2aWNlLlN0YXR1cykKICAgICAgICB9CiAgICAgICAgRWxzZQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSAkKCRjbGFpbXNTZXJ2aWNlLkRpc3BsYXlOYW1lKSBhbHJlYWR5IHN0YXJ0ZWQuIgogICAgICAgIH0KICAgICAgICBsb2cgIiAtIFNldHRpbmcgQzJXVFMgdG8gZGVwZW5kIG9uIENyeXB0b2dyYXBoaWMgU2VydmljZXMuLi4iCiAgICAgICAgU3RhcnQtUHJvY2VzcyAtRmlsZVBhdGggIiRlbnY6d2luZGlyXFN5c3RlbTMyXHNjLmV4ZSIgLUFyZ3VtZW50TGlzdCAiY29uZmlnIGMyd3RzIGRlcGVuZD0gQ3J5cHRTdmMiIC1XYWl0IC1Ob05ld1dpbmRvdyAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIFdyaXRlTGluZQogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gU3RvcCBTcGVjaWZpZWQgU2VydmljZSBJbnN0YW5jZQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogU3RvcFNlcnZpY2VJbnN0YW5jZQojIERlc2M6IERpc2FibGVzIGEgc3BlY2lmaWVkIHNlcnZpY2UgaW5zdGFuY2UgKGUuZy4gb24gZGVkaWNhdGVkIEFwcCBzZXJ2ZXJzIG9yIFdGRXMpCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gU3RvcFNlcnZpY2VJbnN0YW5jZSAoJHNlcnZpY2UpCnsKICAgIFdyaXRlTGluZQogICAgJHNlcnZpY2VJbnN0YW5jZXMgPSBHZXQtU1BTZXJ2aWNlSW5zdGFuY2UgfCA/IHskXy5HZXRUeXBlKCkuVG9TdHJpbmcoKSAtZXEgJHNlcnZpY2UgLWFuZCAkXy5OYW1lIC1uZSAiV1NTX0FkbWluaXN0cmF0aW9uIn0gIyBOZWVkIHRvIGZpbHRlciBvdXQgV1NTX0FkbWluaXN0cmF0aW9uIGJlY2F1c2UgdGhlIENlbnRyYWwgQWRtaW5pc3RyYXRpb24gc2VydmljZSBpbnN0YW5jZSBzaGFyZXMgdGhlIHNhbWUgVHlwZSBhcyB0aGUgRm91bmRhdGlvbiBXZWIgQXBwbGljYXRpb24gU2VydmljZQogICAgJHNlcnZpY2VJbnN0YW5jZSA9ICRzZXJ2aWNlSW5zdGFuY2VzIHwgPyB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyLkFkZHJlc3MgJGVudjpDT01QVVRFUk5BTUV9CiAgICBsb2cgIiAtIFN0b3BwaW5nICQoJHNlcnZpY2VJbnN0YW5jZS5UeXBlTmFtZSkuLi4iCiAgICBpZiAoJHNlcnZpY2VJbnN0YW5jZS5TdGF0dXMgLWVxICJPbmxpbmUiKQogICAgewogICAgICAgICRzZXJ2aWNlSW5zdGFuY2UuVW5wcm92aXNpb24oKQogICAgICAgIElmICgtbm90ICQ/KSB7VGhyb3cgIiAtIEZhaWxlZCB0byBzdG9wICQoJHNlcnZpY2VJbnN0YW5jZS5UeXBlTmFtZSkiIH0KICAgICAgICAjIFdhaXQKICAgICAgICBsb2cgIiAtIFdhaXRpbmcgZm9yICQoJHNlcnZpY2VJbnN0YW5jZS5UeXBlTmFtZSkgdG8gc3RvcC4uLiIgCiAgICAgICAgV2hpbGUgKCRzZXJ2aWNlSW5zdGFuY2UuU3RhdHVzIC1uZSAiRGlzYWJsZWQiKQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIuIiAKICAgICAgICAgICAgU3RhcnQtU2xlZXAgMQogICAgICAgICAgICAkc2VydmljZUluc3RhbmNlcyA9IEdldC1TUFNlcnZpY2VJbnN0YW5jZSB8ID8geyRfLkdldFR5cGUoKS5Ub1N0cmluZygpIC1lcSAkc2VydmljZX0KICAgICAgICAgICAgJHNlcnZpY2VJbnN0YW5jZSA9ICRzZXJ2aWNlSW5zdGFuY2VzIHwgPyB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyLkFkZHJlc3MgJGVudjpDT01QVVRFUk5BTUV9CiAgICAgICAgfQogICAgICAgIGxvZyAkKCRzZXJ2aWNlSW5zdGFuY2UuU3RhdHVzIC1yZXBsYWNlICJEaXNhYmxlZCIsIlN0b3BwZWQiKQogICAgfQogICAgRWxzZSB7bG9nICIgLSBBbHJlYWR5IHN0b3BwZWQuIn0KICAgIFdyaXRlTGluZQp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ29uZmlndXJlIFdvcmtmbG93IFRpbWVyIFNlcnZpY2UKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IENvbmZpZ3VyZVdvcmtmbG93VGltZXJTZXJ2aWNlCiMgRGVzYzogQ29uZmlndXJlcyB0aGUgTWljcm9zb2Z0IFNoYXJlUG9pbnQgRm91bmRhdGlvbiBXb3JrZmxvdyBUaW1lciBTZXJ2aWNlCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gQ29uZmlndXJlV29ya2Zsb3dUaW1lclNlcnZpY2UKewogICAgIyBFbnN1cmUgdGhlIG5vZGUgZXhpc3RzIGluIHRoZSBYTUwgZmlyc3QgYXMgd2UgZG9uJ3Qgd2FudCB0byBpbmFkdmVydGVudGx5IGRpc2FibGUgdGhlIHNlcnZpY2UgaWYgaXQgd2Fzbid0IGV4cGxpY2l0bHkgc3BlY2lmaWVkCiAgICBpZiAoKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuU2VsZWN0U2luZ2xlTm9kZSgiV29ya2Zsb3dUaW1lciIpKSAtYW5kICEoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZpY2VzLldvcmtmbG93VGltZXIgLWVxICR0cnVlKSkKICAgIHsKICAgICAgICBTdG9wU2VydmljZUluc3RhbmNlICJNaWNyb3NvZnQuU2hhcmVQb2ludC5Xb3JrZmxvdy5TUFdvcmtmbG93VGltZXJTZXJ2aWNlSW5zdGFuY2UiCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBDb25maWd1cmUgRm91bmRhdGlvbiBTZWFyY2gKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBDb25maWd1cmVGb3VuZGF0aW9uU2VhcmNoCiMgRGVzYzogVXBkYXRlcyB0aGUgc2VydmljZSBhY2NvdW50IGZvciBTUFNlYXJjaDQgKFNoYXJlUG9pbnQgRm91bmRhdGlvbiAoSGVscCkgU2VhcmNoKQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKRnVuY3Rpb24gQ29uZmlndXJlRm91bmRhdGlvblNlYXJjaCAoW3htbF0keG1saW5wdXQpCiMgRG9lcyBub3QgYWN0dWFsbHkgcHJvdmlzaW9uIEZvdW5kYXRpb24gU2VhcmNoIGFzIG9mIHlldCwganVzdCB1cGRhdGVzIHRoZSBzZXJ2aWNlIGFjY291bnQgaXQgd291bGQgcnVuIHVuZGVyIHRvIG1pdGlnYXRlIEhlYWx0aCBBbmFseXplciB3YXJuaW5ncwp7CiAgICBHZXQtTWFqb3JWZXJzaW9uTnVtYmVyICR4bWxpbnB1dAogICAgIyBNYWtlIHN1cmUgYSBjcmVkZW50aWFsIGRlcGxveW1lbnQgam9iIGRvZXNuJ3QgYWxyZWFkeSBleGlzdCwgYW5kIHRoYXQgd2UgYXJlIHJ1bm5pbmcgU1AyMDEwCiAgICBpZiAoKCEoR2V0LVNQVGltZXJKb2IgLUlkZW50aXR5ICJ3aW5kb3dzLXNlcnZpY2UtY3JlZGVudGlhbHMtU1BTZWFyY2g0IikpIC1hbmQgKCRlbnY6c3BWZXIgLWVxICIxNCIpKQogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgIFRyeQogICAgICAgIHsKICAgICAgICAgICAgJGZvdW5kYXRpb25TZWFyY2hTZXJ2aWNlID0gKEdldC1TUEZhcm0pLlNlcnZpY2VzIHwgd2hlcmUgeyRfLk5hbWUgLWVxICJTUFNlYXJjaDQifQogICAgICAgICAgICAkc3BzZXJ2aWNlID0gR2V0LVNQTWFuYWdlZEFjY291bnRYTUwgJHhtbGlucHV0IC1Db21tb25OYW1lICJzcHNlcnZpY2UiCiAgICAgICAgICAgIFVwZGF0ZVByb2Nlc3NJZGVudGl0eSAkZm91bmRhdGlvblNlYXJjaFNlcnZpY2UKICAgICAgICB9CiAgICAgICAgQ2F0Y2gKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAkXwogICAgICAgICAgICBUaHJvdyAiIC0gQW4gZXJyb3Igb2NjdXJyZWQgdXBkYXRpbmcgdGhlIHNlcnZpY2UgYWNjb3VudCBmb3IgU1BTZWFyY2g0LiIKICAgICAgICB9CiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBDb25maWd1cmUgU1BUcmFjZVY0IChMb2dnaW5nKQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IENvbmZpZ3VyZVRyYWNpbmcKIyBEZXNjOiBVcGRhdGVzIHRoZSBzZXJ2aWNlIGFjY291bnQgZm9yIFNQVHJhY2VWNCAoU2hhcmVQb2ludCBGb3VuZGF0aW9uIChIZWxwKSBTZWFyY2gpCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpGdW5jdGlvbiBDb25maWd1cmVUcmFjaW5nIChbeG1sXSR4bWxpbnB1dCkKewogICAgIyBNYWtlIHN1cmUgYSBjcmVkZW50aWFsIGRlcGxveW1lbnQgam9iIGRvZXNuJ3QgYWxyZWFkeSBleGlzdAogICAgaWYgKCEoR2V0LVNQVGltZXJKb2IgLUlkZW50aXR5ICJ3aW5kb3dzLXNlcnZpY2UtY3JlZGVudGlhbHMtU1BUcmFjZVY0IikpCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgJHNwc2VydmljZSA9IEdldC1TUE1hbmFnZWRBY2NvdW50WE1MICR4bWxpbnB1dCAtQ29tbW9uTmFtZSAic3BzZXJ2aWNlIgogICAgICAgICRzcFRyYWNlVjQgPSAoR2V0LVNQRmFybSkuU2VydmljZXMgfCB3aGVyZSB7JF8uTmFtZSAtZXEgIlNQVHJhY2VWNCJ9CiAgICAgICAgJGFwcFBvb2xBY2N0RG9tYWluLCRhcHBQb29sQWNjdFVzZXIgPSAkc3BzZXJ2aWNlLnVzZXJuYW1lIC1TcGxpdCAiXFwiCiAgICAgICAgbG9nICIgLSBBcHBseWluZyBzZXJ2aWNlIGFjY291bnQgJCgkc3BzZXJ2aWNlLnVzZXJuYW1lKSB0byBzZXJ2aWNlIFNQVHJhY2VWNC4uLiIKICAgICAgICAjQWRkIHRvIFBlcmZvcm1hbmNlIE1vbml0b3IgVXNlcnMgZ3JvdXAKICAgICAgICBsb2cgIiAtIEFkZGluZyAkKCRzcHNlcnZpY2UudXNlcm5hbWUpIHRvIGxvY2FsIFBlcmZvcm1hbmNlIE1vbml0b3IgVXNlcnMgZ3JvdXAuLi4iCiAgICAgICAgVHJ5CiAgICAgICAgewogICAgICAgICAgICAoW0FEU0ldIldpbk5UOi8vJGVudjpDT01QVVRFUk5BTUUvUGVyZm9ybWFuY2UgTW9uaXRvciBVc2Vycyxncm91cCIpLkFkZCgiV2luTlQ6Ly8kYXBwUG9vbEFjY3REb21haW4vJGFwcFBvb2xBY2N0VXNlciIpCiAgICAgICAgICAgIElmICgtbm90ICQ/KSB7VGhyb3d9CiAgICAgICAgfQogICAgICAgIENhdGNoCiAgICAgICAgewogICAgICAgICAgICBsb2cgIiAtICQoJHNwc2VydmljZS51c2VybmFtZSkgaXMgYWxyZWFkeSBhIG1lbWJlciBvZiBQZXJmb3JtYW5jZSBNb25pdG9yIFVzZXJzLiIKICAgICAgICB9CiAgICAgICAgI0FkZCBhbGwgbWFuYWdlZCBhY2NvdW50cyB0byBQZXJmb3JtYW5jZSBMb2cgVXNlcnMgZ3JvdXAKICAgICAgICBmb3JlYWNoICgkbWFuYWdlZEFjY291bnQgaW4gKEdldC1TUE1hbmFnZWRBY2NvdW50KSkKICAgICAgICB7CiAgICAgICAgICAgICRhcHBQb29sQWNjdERvbWFpbiwkYXBwUG9vbEFjY3RVc2VyID0gJG1hbmFnZWRBY2NvdW50LlVzZXJOYW1lIC1TcGxpdCAiXFwiCiAgICAgICAgICAgIGxvZyAiIC0gQWRkaW5nICQoJG1hbmFnZWRBY2NvdW50LlVzZXJOYW1lKSB0byBsb2NhbCBQZXJmb3JtYW5jZSBMb2cgVXNlcnMgZ3JvdXAuLi4iCiAgICAgICAgICAgIFRyeQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAoW0FEU0ldIldpbk5UOi8vJGVudjpDT01QVVRFUk5BTUUvUGVyZm9ybWFuY2UgTG9nIFVzZXJzLGdyb3VwIikuQWRkKCJXaW5OVDovLyRhcHBQb29sQWNjdERvbWFpbi8kYXBwUG9vbEFjY3RVc2VyIikKICAgICAgICAgICAgICAgIElmICgtbm90ICQ/KSB7VGhyb3d9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQ2F0Y2gKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgIC0gJCgkbWFuYWdlZEFjY291bnQuVXNlck5hbWUpIGlzIGFscmVhZHkgYSBtZW1iZXIgb2YgUGVyZm9ybWFuY2UgTG9nIFVzZXJzLiIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBUcnkKICAgICAgICB7CiAgICAgICAgICAgIFVwZGF0ZVByb2Nlc3NJZGVudGl0eSAkc3BUcmFjZVY0CiAgICAgICAgfQogICAgICAgIENhdGNoCiAgICAgICAgewogICAgICAgICAgICBXcml0ZS1PdXRwdXQgJF8KICAgICAgICAgICAgVGhyb3cgIiAtIEFuIGVycm9yIG9jY3VycmVkIHVwZGF0aW5nIHRoZSBzZXJ2aWNlIGFjY291bnQgZm9yIHNlcnZpY2UgU1BUcmFjZVY0LiIKICAgICAgICB9CiAgICAgICAgIyBSZXN0YXJ0IFNQVHJhY2VWNCBzZXJ2aWNlIHNvIGNoYW5nZXMgdG8gZ3JvdXAgbWVtYmVyc2hpcHMgYWJvdmUgY2FuIHRha2UgZWZmZWN0CiAgICAgICAgbG9nICIgLSBSZXN0YXJ0aW5nIHNlcnZpY2UgU1BUcmFjZVY0Li4uIgogICAgICAgIFJlc3RhcnQtU2VydmljZSAtTmFtZSAiU1BUcmFjZVY0IiAtRm9yY2UKICAgICAgICBXcml0ZUxpbmUKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBsb2cgIldBUk5JTkc6VGltZXIgam9iIGAid2luZG93cy1zZXJ2aWNlLWNyZWRlbnRpYWxzLVNQVHJhY2VWNGAiIGFscmVhZHkgZXhpc3RzLiIKICAgICAgICBsb2cgIkNoZWNrIHRoYXQgJCgkc3BzZXJ2aWNlLnVzZXJuYW1lKSBpcyBhIG1lbWJlciBvZiB0aGUgUGVyZm9ybWFuY2UgTG9nIFVzZXJzIGFuZCBQZXJmb3JtYW5jZSBNb25pdG9yIFVzZXJzIGxvY2FsIGdyb3VwcyBvbmNlIGluc3RhbGwgY29tcGxldGVzLiIKICAgIH0KfQojRW5kUmVnaW9uCgojUmVnaW9uIENvbmZpZ3VyZSBEaXN0cmlidXRlZCBDYWNoZSBTZXJ2aWNlCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogQ29uZmlndXJlRGlzdHJpYnV0ZWRDYWNoZVNlcnZpY2UKIyBEZXNjOiBVcGRhdGVzIHRoZSBzZXJ2aWNlIGFjY291bnQgZm9yIEFwcEZhYnJpY0NhY2hpbmdTZXJ2aWNlIEFLQSBEaXN0cmlidXRlZCBDYWNoaW5nIFNlcnZpY2UKIyBJbmZvOiBodHRwOi8vdGVjaG5ldC5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvamoyMTk2MTMuYXNweAojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKRnVuY3Rpb24gQ29uZmlndXJlRGlzdHJpYnV0ZWRDYWNoZVNlcnZpY2UgKFt4bWxdJHhtbGlucHV0KQp7CiAgICBHZXQtTWFqb3JWZXJzaW9uTnVtYmVyICR4bWxpbnB1dAogICAgIyBNYWtlIHN1cmUgYSBjcmVkZW50aWFsIGRlcGxveW1lbnQgam9iIGRvZXNuJ3QgYWxyZWFkeSBleGlzdCwgYW5kIHRoYXQgd2UgYXJlIHJ1bm5pbmcgU1AyMDEzIGF0IG1pbmltdW0KICAgIGlmICgoIShHZXQtU1BUaW1lckpvYiAtSWRlbnRpdHkgIndpbmRvd3Mtc2VydmljZS1jcmVkZW50aWFscy1BcHBGYWJyaWNDYWNoaW5nU2VydmljZSIpKSAtYW5kICgkZW52OnNwVmVyIC1nZSAiMTUiKSkKICAgIHsKICAgICAgICBXcml0ZUxpbmUKICAgICAgICAkc3BzZXJ2aWNlID0gR2V0LVNQTWFuYWdlZEFjY291bnRYTUwgJHhtbGlucHV0IC1Db21tb25OYW1lICJzcHNlcnZpY2UiCiAgICAgICAgJGRpc3RyaWJ1dGVkQ2FjaGluZ1N2YyA9IChHZXQtU1BGYXJtKS5TZXJ2aWNlcyB8IHdoZXJlIHskXy5OYW1lIC1lcSAiQXBwRmFicmljQ2FjaGluZ1NlcnZpY2UifQogICAgICAgICMgQ2hlY2sgaWYgd2Ugc2hvdWxkIGRpc2FibGUgdGhlIERpc3RyaWJ1dGVkIENhY2hlIHNlcnZpY2Ugb24gdGhlIGxvY2FsIHNlcnZlcgogICAgICAgICMgRW5zdXJlIHRoZSBub2RlIGV4aXN0cyBpbiB0aGUgWE1MIGZpcnN0IGFzIHdlIGRvbid0IHdhbnQgdG8gaW5hZHZlcnRlbnRseSBkaXNhYmxlIHRoZSBzZXJ2aWNlIGlmIGl0IHdhc24ndCBleHBsaWNpdGx5IHNwZWNpZmllZAogICAgICAgICRzZXJ2aWNlSW5zdGFuY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuU2hhcmVQb2ludC5EaXN0cmlidXRlZENhY2hpbmcuVXRpbGl0aWVzLlNQRGlzdHJpYnV0ZWRDYWNoZVNlcnZpY2VJbnN0YW5jZSJ9CiAgICAgICAgJHNlcnZpY2VJbnN0YW5jZSA9ICRzZXJ2aWNlSW5zdGFuY2VzIHwgPyB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyLkFkZHJlc3MgJGVudjpDT01QVVRFUk5BTUV9CiAgICAgICAgIyBDaGVjayBpZiB3ZSBhcmUgaW5zdGFsbGluZyBTaGFyZVBvaW50IDIwMTYgYW5kIGhhdmUgcmVxdWVzdGVkIGEgTWluUm9sZSB0aGF0IHJlcXVpcmVzIChvciBjb21wbGllcyB3aXRoKSBEaXN0cmlidXRlZCBDYWNoZQogICAgICAgIGlmICgkZW52OnNwVmVyIC1nZSAiMTYiKQogICAgICAgIHsKICAgICAgICAgICAgIyBEaXN0cmlidXRlZENhY2hlIGFuZCBTaW5nbGVTZXJ2ZXJGYXJtIE1pbnJvbGVzIHJlcXVpcmUgRGlzdHJpYnV0ZWQgQ2FjaGUgdG8gYmUgcHJvdmlzaW9uZWQgbG9jYWxseQogICAgICAgICAgICBpZiAoKFNob3VsZElQcm92aXNpb24gKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmVyUm9sZXMuRGlzdHJpYnV0ZWRDYWNoZSkpIC1vciAoU2hvdWxkSVByb3Zpc2lvbiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2ZXJSb2xlcy5TaW5nbGVTZXJ2ZXJGYXJtKSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRkaXN0cmlidXRlZENhY2hlMjAxNlN0b3AgPSAkZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICAjIENoZWNrIGlmIHdlIGhhdmUgcmVxdWVzdGVkIGJvdGggQ3VzdG9tIE1pbnJvbGUgYW5kIGxvY2FsIERpc3RyaWJ1dGVkIENhY2hlIHByb3Zpc2lvbmluZyBpbiB0aGUgWE1MCiAgICAgICAgICAgIGVsc2VpZiAoKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuU2VsZWN0U2luZ2xlTm9kZSgiRGlzdHJpYnV0ZWRDYWNoZSIpKSAtYW5kIChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuRGlzdHJpYnV0ZWRDYWNoZSAtZXEgJHRydWUpIC1hbmQgKFNob3VsZElQcm92aXNpb24gKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmVyUm9sZXMuQ3VzdG9tKSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRkaXN0cmlidXRlZENhY2hlMjAxNlN0b3AgPSAkZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICAjIE90aGVyd2lzZSB3ZSBzaG91bGQgYmUgc3RvcHBpbmcgdGhlIERpc3RyaWJ1dGVkIENhY2hlCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJGRpc3RyaWJ1dGVkQ2FjaGUyMDE2U3RvcCA9ICR0cnVlCiAgICAgICAgICAgIH0KCiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIGlmICgoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2aWNlcy5TZWxlY3RTaW5nbGVOb2RlKCJEaXN0cmlidXRlZENhY2hlIikpIC1hbmQgIShTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuRGlzdHJpYnV0ZWRDYWNoZSAtZXEgJHRydWUpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkZGlzdHJpYnV0ZWRDYWNoZTIwMTNTdG9wID0gJHRydWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAjIE5ldyBhZGRpdGlvbmFsIGNoZWNrIGZvciAkZGlzdHJpYnV0ZWRDYWNoZTIwMTZTdG9wIGZsYWcgLSBiZWNhdXNlIHdlIHdpbGwgbmVlZCB0byBlbnN1cmUgREMgZG9lc24ndCBnZXQgc3RvcHBlZCBpZiB3ZSBhcmUgcnVubmluZyBjZXJ0YWluIE1pblJvbGVzIGluIFNQMjAxNgogICAgICAgIGlmICgkZGlzdHJpYnV0ZWRDYWNoZTIwMTNTdG9wIC1vciAkZGlzdHJpYnV0ZWRDYWNoZTIwMTZTdG9wKQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSBTdG9wcGluZyB0aGUgRGlzdHJpYnV0ZWQgQ2FjaGUgc2VydmljZS4uLiIgCiAgICAgICAgICAgIGlmICgkc2VydmljZUluc3RhbmNlLlN0YXR1cyAtZXEgIk9ubGluZSIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFN0b3AtU1BEaXN0cmlidXRlZENhY2hlU2VydmljZUluc3RhbmNlIC1HcmFjZWZ1bAogICAgICAgICAgICAgICAgUmVtb3ZlLVNQRGlzdHJpYnV0ZWRDYWNoZVNlcnZpY2VJbnN0YW5jZQogICAgICAgICAgICAgICAgbG9nICJEb25lLiIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHtsb2cgIkFscmVhZHkgc3RvcHBlZC4ifQogICAgICAgIH0KICAgICAgICAjIE90aGVyd2lzZSwgbWFrZSBzdXJlIGl0J3Mgc3RhcnRlZCwgYW5kIHNldCBpdCB0byBydW4gdW5kZXIgYSBkaWZmZXJlbnQgYWNjb3VudAogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgICMgRW5zdXJlIHRoZSBsb2NhbCBEaXN0cmlidXRlZCBDYWNoZSBzZXJ2aWNlcyBpcyBhY3R1YWxseSBydW5uaW5nCiAgICAgICAgICAgIGlmICgkc2VydmljZUluc3RhbmNlLlN0YXR1cyAtbmUgIk9ubGluZSIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiIC0gU3RhcnRpbmcgdGhlIERpc3RyaWJ1dGVkIENhY2hlIHNlcnZpY2UuLi4iIAogICAgICAgICAgICAgICAgQWRkLVNQRGlzdHJpYnV0ZWRDYWNoZVNlcnZpY2VJbnN0YW5jZQogICAgICAgICAgICAgICAgbG9nICJEb25lLiIKICAgICAgICAgICAgfQogICAgICAgICAgICAkYXBwUG9vbEFjY3REb21haW4sJGFwcFBvb2xBY2N0VXNlciA9ICRzcHNlcnZpY2UudXNlcm5hbWUgLVNwbGl0ICJcXCIKICAgICAgICAgICAgbG9nICIgLSBBcHBseWluZyBzZXJ2aWNlIGFjY291bnQgJCgkc3BzZXJ2aWNlLnVzZXJuYW1lKSB0byBzZXJ2aWNlIEFwcEZhYnJpY0NhY2hpbmdTZXJ2aWNlLi4uIgogICAgICAgICAgICAkbWFuYWdlZEFjY291bnRHZW4gPSBHZXQtU1BNYW5hZ2VkQWNjb3VudCB8IFdoZXJlLU9iamVjdCB7JF8uVXNlck5hbWUgLWVxICQoJHNwc2VydmljZS51c2VybmFtZSl9CiAgICAgICAgICAgIFRyeQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBVcGRhdGVQcm9jZXNzSWRlbnRpdHkgJGRpc3RyaWJ1dGVkQ2FjaGluZ1N2YwogICAgICAgICAgICB9CiAgICAgICAgICAgIENhdGNoCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFdyaXRlLU91dHB1dCAkXwogICAgICAgICAgICAgICAgbG9nICJXQVJOSU5HOkFuIGVycm9yIG9jY3VycmVkIHVwZGF0aW5nIHRoZSBzZXJ2aWNlIGFjY291bnQgZm9yIHNlcnZpY2UgQXBwRmFicmljQ2FjaGluZ1NlcnZpY2UuIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFdyaXRlTGluZQogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gUHJvdmlzaW9uIEVudGVycHJpc2UgU2VhcmNoCiMgT3JpZ2luYWwgc2NyaXB0IGZvciBTaGFyZVBvaW50IDIwMTAgYmV0YTIgYnkgR2FyeSBMYXBvaW50ZSAoKQojCiMgTW9kaWZpZWQgYnkgU8ODwrhyZW4gTGF1cml0cyBOaWVsc2VuIChzb2VyZW5uaWVsc2VuLndvcmRwcmVzcy5jb20pOgojCiMgTW9kaWZpZWQgdG8gZml4IHNvbWUgZXJyb3JzIHNpbmNlIHNvbWUgY21kbGV0cyBoYXZlIGNoYW5nZWQgYSBiaXQgc2luY2UgYmV0YSAyIGFuZCBhZGRlZCBzdXBwb3J0IGZvciAiU2hhcmVOYW1lIiBmb3IKIyB0aGUgcXVlcnkgY29tcG9uZW50LiBJdCBpcyByZXF1aXJlZCBmb3Igbm9uIERDIGNvbXB1dGVycy4KIwojIE1vZGlmaWVkIHRvIHN1cHBvcnQgImxvY2FsaG9zdCIgbW9uaWtlciBpbiBjb25maWcgZmlsZS4KIwojIE5vdGU6IEFjY291bnRzLCBTaGFyZXMgYW5kIGRpcmVjdG9yaWVzIHNwZWNpZmllZCBpbiB0aGUgY29uZmlnIGZpbGUgbXVzdCBiZSBzZXR1cCBiZWZvcmVoYW5kLgoKZnVuY3Rpb24gQ3JlYXRlRW50ZXJwcmlzZVNlYXJjaFNlcnZpY2VBcHAoW3htbF0keG1saW5wdXQpCnsKICAgIEdldC1NYWpvclZlcnNpb25OdW1iZXIgJHhtbGlucHV0CiAgICAkc2VhcmNoU2VydmljZUFjY291bnQgPSBHZXQtU1BNYW5hZ2VkQWNjb3VudFhNTCAkeG1saW5wdXQgLUNvbW1vbk5hbWUgIlNlYXJjaFNlcnZpY2UiCiAgICAjIENoZWNrIGlmIHRoZSBTZWFyY2ggU2VydmljZSBhY2NvdW50IHVzZXJuYW1lIGhhcyBiZWVuIHNwZWNpZmllZCBiZWZvcmUgd2UgdHJ5IHRvIGNvbnZlcnQgaXRzIHBhc3N3b3JkIHRvIGEgc2VjdXJlIHN0cmluZwogICAgaWYgKCEoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJHNlYXJjaFNlcnZpY2VBY2NvdW50LlVzZXJuYW1lKSkpCiAgICB7CiAgICAgICAgJHNlY1NlYXJjaFNlcnZpY2VQYXNzd29yZCA9IENvbnZlcnRUby1TZWN1cmVTdHJpbmcgLVN0cmluZyAkc2VhcmNoU2VydmljZUFjY291bnQuUGFzc3dvcmQgLUFzUGxhaW5UZXh0IC1Gb3JjZQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGxvZyAiIC0gTWFuYWdlZCBhY2NvdW50IGNyZWRlbnRpYWxzIGZvciBTZWFyY2ggU2VydmljZSBoYXZlIG5vdCBiZWVuIHNwZWNpZmllZC4iCiAgICB9CiAgICAjIFdlIG5vdyBkbyBhIGNoZWNrIHRoYXQgYm90aCBTZWFyY2ggaXMgYmVpbmcgcmVxdWVzdGVkIGZvciBwcm92aXNpb25pbmcgYW5kIHRoYXQgd2UgYXJlIG5vdCBydW5uaW5nIHRoZSBGb3VuZGF0aW9uIFNLVQogICAgSWYgKChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLkVudGVycHJpc2VTZWFyY2hTZXJ2aWNlIC1lcSAkdHJ1ZSkgLWFuZCAoR2V0LUNvbW1hbmQgLU5hbWUgTmV3LVNQRW50ZXJwcmlzZVNlYXJjaFNlcnZpY2VBcHBsaWNhdGlvbiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkgLWFuZCAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uSW5zdGFsbC5TS1UgLW5lICJGb3VuZGF0aW9uIikpCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgbG9nICIgLSBQcm92aXNpb25pbmcgRW50ZXJwcmlzZSBTZWFyY2guLi4iCiAgICAgICAgIyBTTE46IEFkZGVkIHN1cHBvcnQgZm9yIGxvY2FsIGhvc3QKICAgICAgICAkc3ZjQ29uZmlnID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuRW50ZXJwcmlzZVNlYXJjaFNlcnZpY2UKICAgICAgICAkcG9ydGFsV2ViQXBwID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uV2ViQXBwbGljYXRpb25zLldlYkFwcGxpY2F0aW9uIHwgV2hlcmUgeyRfLlR5cGUgLWVxICJQb3J0YWwifSB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEKICAgICAgICAkcG9ydGFsVVJMID0gJHBvcnRhbFdlYkFwcC5VUkwKICAgICAgICAkcG9ydGFsUG9ydCA9ICRwb3J0YWxXZWJBcHAuUG9ydAogICAgICAgIGlmICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5Vc2VyUHJvZmlsZVNlcnZpY2VBcHAuUHJvdmlzaW9uIC1uZSAkZmFsc2UpICMgV2UgZGlkbid0IHVzZSBTaG91bGRJUHJvdmlzaW9uIGhlcmUgYXMgd2Ugd2FudCB0byBrbm93IGlmIFVQUyBpcyBiZWluZyBwcm92aXNpb25lZCBpbiB0aGlzIGZhcm0sIG5vdCBqdXN0IG9uIHRoaXMgc2VydmVyCiAgICAgICAgewogICAgICAgICAgICAkbXlTaXRlV2ViQXBwID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uV2ViQXBwbGljYXRpb25zLldlYkFwcGxpY2F0aW9uIHwgV2hlcmUgeyRfLlR5cGUgLWVxICJNeVNpdGVIb3N0In0KICAgICAgICAgICAgIyBJZiB3ZSBoYXZlIGFza2VkIHRvIGNyZWF0ZSBhIE15U2l0ZSBIb3N0IHdlYiBhcHAsIHVzZSB0aGF0IGFzIHRoZSBNeVNpdGUgaG9zdCBsb2NhdGlvbgogICAgICAgICAgICBpZiAoJG15U2l0ZVdlYkFwcCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJG15U2l0ZVVSTCA9ICgkbXlTaXRlV2ViQXBwLlVSTCkuVHJpbUVuZCgiLyIpCiAgICAgICAgICAgICAgICAkbXlTaXRlUG9ydCA9ICRteVNpdGVXZWJBcHAuUG9ydAogICAgICAgICAgICAgICAgJG15U2l0ZUhvc3RMb2NhdGlvbiA9ICRteVNpdGVVUkwrIjoiKyRteVNpdGVQb3J0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSAjIFVzZSB0aGUgdmFsdWUgcHJvdmlkZWQgaW4gdGhlICR1c2VyUHJvZmlsZSBub2RlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRteVNpdGVIb3N0TG9jYXRpb24gPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5Vc2VyUHJvZmlsZVNlcnZpY2VBcHAuTXlTaXRlSG9zdExvY2F0aW9uCiAgICAgICAgICAgIH0KICAgICAgICAgICAgIyBTdHJpcCBvdXQgYW55IHByb3RvY29sIHZhbHVlcwogICAgICAgICAgICAkbXlTaXRlSG9zdEhlYWRlckFuZFBvcnQsJG51bGwgPSAkbXlTaXRlSG9zdExvY2F0aW9uIC1yZXBsYWNlICJodHRwOi8vIiwiIiAtcmVwbGFjZSAiaHR0cHM6Ly8iLCIiIC1zcGxpdCAiLyIKICAgICAgICB9CgogICAgICAgICRkYXRhRGlyID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uSW5zdGFsbC5EYXRhRGlyCiAgICAgICAgJGRhdGFEaXIgPSAkZGF0YURpci5UcmltRW5kKCJcIikKICAgICAgICAjIFNldCBpdCB0byB0aGUgZGVmYXVsdCB2YWx1ZSBpZiBpdCdzIG5vdCBzcGVjaWZpZWQgaW4gJHhtbGlucHV0CiAgICAgICAgaWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRkYXRhRGlyKSkgeyRkYXRhRGlyID0gIiRlbnY6UHJvZ3JhbUZpbGVzXE1pY3Jvc29mdCBPZmZpY2UgU2VydmVyc1wkZW52OnNwVmVyLjBcRGF0YSJ9CgogICAgICAgICRzZWFyY2hTdmMgPSBHZXQtU1BFbnRlcnByaXNlU2VhcmNoU2VydmljZUluc3RhbmNlIC1Mb2NhbAogICAgICAgIElmICgkc2VhcmNoU3ZjIC1lcSAkbnVsbCkgewogICAgICAgICAgICBUaHJvdyAiICAtIFVuYWJsZSB0byByZXRyaWV2ZSBzZWFyY2ggc2VydmljZS4iCiAgICAgICAgfQogICAgICAgIGlmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkc3ZjQ29uZmlnLkN1c3RvbUluZGV4TG9jYXRpb24pKQogICAgICAgIHsKICAgICAgICAgICAgIyBVc2UgdGhlIGRlZmF1bHQgbG9jYXRpb24KICAgICAgICAgICAgJGluZGV4TG9jYXRpb24gPSAiJGRhdGFEaXJcT2ZmaWNlIFNlcnZlclxBcHBsaWNhdGlvbnMiCiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgICRpbmRleExvY2F0aW9uID0gJHN2Y0NvbmZpZy5DdXN0b21JbmRleExvY2F0aW9uCiAgICAgICAgICAgICRpbmRleExvY2F0aW9uID0gJGluZGV4TG9jYXRpb24uVHJpbUVuZCgiXCIpCiAgICAgICAgICAgICMgSWYgdGhlIHJlcXVlc3RlZCBpbmRleCBsb2NhdGlvbiBpcyBub3QgdGhlIGRlZmF1bHQsIG1ha2Ugc3VyZSB0aGUgbmV3IGxvY2F0aW9uIGV4aXN0cyBzbyB3ZSBjYW4gdXNlIGl0IGxhdGVyIGluIHRoZSBzY3JpcHQKICAgICAgICAgICAgaWYgKCRpbmRleExvY2F0aW9uIC1uZSAiJGRhdGFEaXJcT2ZmaWNlIFNlcnZlclxBcHBsaWNhdGlvbnMiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAtIENoZWNraW5nIHJlcXVlc3RlZCBJbmRleExvY2F0aW9uIHBhdGguLi4iCiAgICAgICAgICAgICAgICBFbnN1cmVGb2xkZXIgJHN2Y0NvbmZpZy5DdXN0b21JbmRleExvY2F0aW9uCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbG9nICIgIC0gQ29uZmlndXJpbmcgc2VhcmNoIHNlcnZpY2UuLi4iIAogICAgICAgIEdldC1TUEVudGVycHJpc2VTZWFyY2hTZXJ2aWNlIHwgU2V0LVNQRW50ZXJwcmlzZVNlYXJjaFNlcnZpY2UgIGAKICAgICAgICAgIC1Db250YWN0RW1haWwgJHN2Y0NvbmZpZy5Db250YWN0RW1haWwgLUNvbm5lY3Rpb25UaW1lb3V0ICRzdmNDb25maWcuQ29ubmVjdGlvblRpbWVvdXQgYAogICAgICAgICAgLUFja25vd2xlZGdlbWVudFRpbWVvdXQgJHN2Y0NvbmZpZy5BY2tub3dsZWRnZW1lbnRUaW1lb3V0IC1Qcm94eVR5cGUgJHN2Y0NvbmZpZy5Qcm94eVR5cGUgYAogICAgICAgICAgLUlnbm9yZVNTTFdhcm5pbmdzICRzdmNDb25maWcuSWdub3JlU1NMV2FybmluZ3MgLUludGVybmV0SWRlbnRpdHkgJHN2Y0NvbmZpZy5JbnRlcm5ldElkZW50aXR5IC1QZXJmb3JtYW5jZUxldmVsICRzdmNDb25maWcuUGVyZm9ybWFuY2VMZXZlbCBgCiAgICAgICAgICAtU2VydmljZUFjY291bnQgJHNlYXJjaFNlcnZpY2VBY2NvdW50LlVzZXJuYW1lIC1TZXJ2aWNlUGFzc3dvcmQgJHNlY1NlYXJjaFNlcnZpY2VQYXNzd29yZAogICAgICAgIElmICgkPykge2xvZyAiRG9uZS4ifQoKCiAgICAgICAgSWYgKCRlbnY6c3BWZXIgLWVxICIxNCIpICMgU2hhcmVQb2ludCAyMDEwIHN0ZXBzCiAgICAgICAgewogICAgICAgICAgICAkc3ZjQ29uZmlnLkVudGVycHJpc2VTZWFyY2hTZXJ2aWNlQXBwbGljYXRpb25zLkVudGVycHJpc2VTZWFyY2hTZXJ2aWNlQXBwbGljYXRpb24gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAkYXBwQ29uZmlnID0gJF8KICAgICAgICAgICAgICAgICRkYlByZWZpeCA9IEdldC1EQlByZWZpeCAkeG1saW5wdXQKICAgICAgICAgICAgICAgIElmICghKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRhcHBDb25maWcuRGF0YWJhc2UuREJTZXJ2ZXIpKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkZGJTZXJ2ZXIgPSAkYXBwQ29uZmlnLkRhdGFiYXNlLkRCU2VydmVyCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBFbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJGRiU2VydmVyID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5EYXRhYmFzZS5EQlNlcnZlcgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHNlY0NvbnRlbnRBY2Nlc3NBY2N0UFdEID0gQ29udmVydFRvLVNlY3VyZVN0cmluZyAtU3RyaW5nICRhcHBDb25maWcuQ29udGVudEFjY2Vzc0FjY291bnRQYXNzd29yZCAtQXNQbGFpblRleHQgLUZvcmNlCiAgICAgICAgICAgICAgICAjIFRyeSBhbmQgZ2V0IHRoZSBhcHBsaWNhdGlvbiBwb29sIGlmIGl0IGFscmVhZHkgZXhpc3RzCiAgICAgICAgICAgICAgICAkcG9vbCA9IEdldC1BcHBsaWNhdGlvblBvb2wgJGFwcENvbmZpZy5BcHBsaWNhdGlvblBvb2wKICAgICAgICAgICAgICAgICRhZG1pblBvb2wgPSBHZXQtQXBwbGljYXRpb25Qb29sICRhcHBDb25maWcuQWRtaW5Db21wb25lbnQuQXBwbGljYXRpb25Qb29sCiAgICAgICAgICAgICAgICAkc2VhcmNoQXBwID0gR2V0LVNQRW50ZXJwcmlzZVNlYXJjaFNlcnZpY2VBcHBsaWNhdGlvbiAtSWRlbnRpdHkgJGFwcENvbmZpZy5OYW1lIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgICAgICBJZiAoJHNlYXJjaEFwcCAtZXEgJG51bGwpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyAkKCRhcHBDb25maWcuTmFtZSkuLi4iCiAgICAgICAgICAgICAgICAgICAgJHNlYXJjaEFwcCA9IE5ldy1TUEVudGVycHJpc2VTZWFyY2hTZXJ2aWNlQXBwbGljYXRpb24gLU5hbWUgJGFwcENvbmZpZy5OYW1lIGAKICAgICAgICAgICAgICAgICAgICAgICAgLURhdGFiYXNlU2VydmVyICRkYlNlcnZlciBgCiAgICAgICAgICAgICAgICAgICAgICAgIC1EYXRhYmFzZU5hbWUgJCgkZGJQcmVmaXgrJGFwcENvbmZpZy5EYXRhYmFzZS5OYW1lKSBgCiAgICAgICAgICAgICAgICAgICAgICAgIC1GYWlsb3ZlckRhdGFiYXNlU2VydmVyICRhcHBDb25maWcuRmFpbG92ZXJEYXRhYmFzZVNlcnZlciBgCiAgICAgICAgICAgICAgICAgICAgICAgIC1BcHBsaWNhdGlvblBvb2wgJHBvb2wgYAogICAgICAgICAgICAgICAgICAgICAgICAtQWRtaW5BcHBsaWNhdGlvblBvb2wgJGFkbWluUG9vbCBgCiAgICAgICAgICAgICAgICAgICAgICAgIC1QYXJ0aXRpb25lZDooW2Jvb2xdOjpQYXJzZSgkYXBwQ29uZmlnLlBhcnRpdGlvbmVkKSkgYAogICAgICAgICAgICAgICAgICAgICAgICAtU2VhcmNoQXBwbGljYXRpb25UeXBlICRhcHBDb25maWcuU2VhcmNoU2VydmljZUFwcGxpY2F0aW9uVHlwZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgRWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gRW50ZXJwcmlzZSBzZWFyY2ggc2VydmljZSBhcHBsaWNhdGlvbiBhbHJlYWR5IGV4aXN0cywgc2tpcHBpbmcgY3JlYXRpb24uIgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgQWRkIGxpbmsgdG8gcmVzb3VyY2VzIGxpc3QKICAgICAgICAgICAgICAgIEFkZFJlc291cmNlc0xpbmsgIlNlYXJjaCBBZG1pbmlzdHJhdGlvbiIgKCJzZWFyY2hhZG1pbmlzdHJhdGlvbi5hc3B4P2FwcGlkPSIgKyAgJHNlYXJjaEFwcC5JZCkKCiAgICAgICAgICAgICAgICAjIElmIHRoZSBpbmRleCBsb2NhdGlvbiBpc24ndCBhbHJlYWR5IHNldCB0byBlaXRoZXIgdGhlIGRlZmF1bHQgbG9jYXRpb24gb3Igb3VyIGN1c3RvbS1zcGVjaWZpZWQgbG9jYXRpb24sIHNldCB0aGUgZGVmYXVsdCBsb2NhdGlvbiBmb3IgdGhlIHNlYXJjaCBzZXJ2aWNlIGluc3RhbmNlCiAgICAgICAgICAgICAgICBpZiAoJGluZGV4TG9jYXRpb24gLW5lICIkZGF0YURpclxPZmZpY2UgU2VydmVyXEFwcGxpY2F0aW9ucyIgLW9yICRpbmRleExvY2F0aW9uIC1uZSAkc2VhcmNoU3ZjLkRlZmF1bHRJbmRleExvY2F0aW9uKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiICAtIFNldHRpbmcgZGVmYXVsdCBpbmRleCBsb2NhdGlvbiBvbiBzZWFyY2ggc2VydmljZSBpbnN0YW5jZS4uLiIgCiAgICAgICAgICAgICAgICAgICAgJHNlYXJjaFN2YyB8IFNldC1TUEVudGVycHJpc2VTZWFyY2hTZXJ2aWNlSW5zdGFuY2UgLURlZmF1bHRJbmRleExvY2F0aW9uICRpbmRleExvY2F0aW9uIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgaWYgKCQ/KSB7bG9nICJPSy4ifQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgRmluYWxseSB1c2luZyBTaG91bGRJUHJvdmlzaW9uIGhlcmUgbGlrZSBldmVyeXdoZXJlIGVsc2UgaW4gdGhlIHNjcmlwdC4uLgogICAgICAgICAgICAgICAgJGluc3RhbGxDcmF3bFN2YyA9IFNob3VsZElQcm92aXNpb24gJGFwcENvbmZpZy5DcmF3bENvbXBvbmVudAogICAgICAgICAgICAgICAgJGluc3RhbGxRdWVyeVN2YyA9IFNob3VsZElQcm92aXNpb24gJGFwcENvbmZpZy5RdWVyeUNvbXBvbmVudAogICAgICAgICAgICAgICAgJGluc3RhbGxBZG1pbkNvbXBvbmVudCA9IFNob3VsZElQcm92aXNpb24gJGFwcENvbmZpZy5BZG1pbkNvbXBvbmVudAogICAgICAgICAgICAgICAgJGluc3RhbGxTeW5jU3ZjID0gU2hvdWxkSVByb3Zpc2lvbiAkYXBwQ29uZmlnLlNlYXJjaFF1ZXJ5QW5kU2l0ZVNldHRpbmdzQ29tcG9uZW50CgogICAgICAgICAgICAgICAgSWYgKCRzZWFyY2hTdmMuU3RhdHVzIC1uZSAiT25saW5lIiAtYW5kICgkaW5zdGFsbENyYXdsU3ZjIC1vciAkaW5zdGFsbFF1ZXJ5U3ZjKSkgewogICAgICAgICAgICAgICAgICAgICRzZWFyY2hTdmMgfCBTdGFydC1TUEVudGVycHJpc2VTZWFyY2hTZXJ2aWNlSW5zdGFuY2UKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBJZiAoJGluc3RhbGxBZG1pbkNvbXBvbmVudCkgewogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gU2V0dGluZyBhZG1pbmlzdHJhdGlvbiBjb21wb25lbnQuLi4iCiAgICAgICAgICAgICAgICAgICAgU2V0LVNQRW50ZXJwcmlzZVNlYXJjaEFkbWluaXN0cmF0aW9uQ29tcG9uZW50IC1TZWFyY2hBcHBsaWNhdGlvbiAkc2VhcmNoQXBwIC1TZWFyY2hTZXJ2aWNlSW5zdGFuY2UgJHNlYXJjaFN2YwoKICAgICAgICAgICAgICAgICAgICAkYWRtaW5DbXBudCA9ICRzZWFyY2hBcHAgfCBHZXQtU1BFbnRlcnByaXNlU2VhcmNoQWRtaW5pc3RyYXRpb25Db21wb25lbnQKICAgICAgICAgICAgICAgICAgICBJZiAoJGFkbWluQ21wbnQuSW5pdGlhbGl6ZWQgLWVxICRmYWxzZSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gV2FpdGluZyBmb3IgYWRtaW5pc3RyYXRpb24gY29tcG9uZW50IGluaXRpYWxpemF0aW9uLi4uIiAKICAgICAgICAgICAgICAgICAgICAgICAgV2hpbGUgKCRhZG1pbkNtcG50LkluaXRpYWxpemVkIC1uZSAkdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIuIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhZG1pbkNtcG50ID0gJHNlYXJjaEFwcCB8IEdldC1TUEVudGVycHJpc2VTZWFyY2hBZG1pbmlzdHJhdGlvbkNvbXBvbmVudAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAkKCRhZG1pbkNtcG50LkluaXRpYWxpemVkIC1yZXBsYWNlICJUcnVlIiwiRG9uZS4iKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBFbHNlIHtsb2cgIiAtIEFkbWluaXN0cmF0aW9uIGNvbXBvbmVudCBhbHJlYWR5IGluaXRpYWxpemVkLiJ9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAjIFVwZGF0ZSB0aGUgZGVmYXVsdCBDb250ZW50IEFjY2VzcyBBY2NvdW50CiAgICAgICAgICAgICAgICBVcGRhdGUtU2VhcmNoQ29udGVudEFjY2Vzc0FjY291bnQgJCgkYXBwY29uZmlnLk5hbWUpICRzZWFyY2hBcHAgJCgkYXBwQ29uZmlnLkNvbnRlbnRBY2Nlc3NBY2NvdW50KSAkc2VjQ29udGVudEFjY2Vzc0FjY3RQV0QKCgogICAgICAgICAgICAgICAgJGNyYXdsVG9wb2xvZ3kgPSBHZXQtU1BFbnRlcnByaXNlU2VhcmNoQ3Jhd2xUb3BvbG9neSAtU2VhcmNoQXBwbGljYXRpb24gJHNlYXJjaEFwcCB8IHdoZXJlIHskXy5DcmF3bENvbXBvbmVudHMuQ291bnQgLWd0IDAgLW9yICRfLlN0YXRlIC1lcSAiSW5hY3RpdmUifQoKICAgICAgICAgICAgICAgIElmICgkY3Jhd2xUb3BvbG9neSAtZXEgJG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIENyZWF0aW5nIG5ldyBjcmF3bCB0b3BvbG9neS4uLiIKICAgICAgICAgICAgICAgICAgICAkY3Jhd2xUb3BvbG9neSA9ICRzZWFyY2hBcHAgfCBOZXctU1BFbnRlcnByaXNlU2VhcmNoQ3Jhd2xUb3BvbG9neQogICAgICAgICAgICAgICAgfSBFbHNlIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIEEgY3Jhd2wgdG9wb2xvZ3kgd2l0aCBjcmF3bCBjb21wb25lbnRzIGFscmVhZHkgZXhpc3RzLCBza2lwcGluZyBjcmF3bCB0b3BvbG9neSBjcmVhdGlvbi4iCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgSWYgKCRpbnN0YWxsQ3Jhd2xTdmMpIHsKICAgICAgICAgICAgICAgICAgICAkY3Jhd2xDb21wb25lbnQgPSAkY3Jhd2xUb3BvbG9neS5DcmF3bENvbXBvbmVudHMgfCB3aGVyZSB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyTmFtZSAkZW52OkNPTVBVVEVSTkFNRX0KICAgICAgICAgICAgICAgICAgICBJZiAoJGNyYXdsVG9wb2xvZ3kuQ3Jhd2xDb21wb25lbnRzLkNvdW50IC1lcSAwIC1vciAkY3Jhd2xDb21wb25lbnQgLWVxICRudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRjcmF3bFN0b3JlID0gJHNlYXJjaEFwcC5DcmF3bFN0b3JlcyB8IHdoZXJlIHskXy5OYW1lIC1lcSAiJCgkZGJQcmVmaXgrJGFwcENvbmZpZy5EYXRhYmFzZS5OYW1lKV9DcmF3bFN0b3JlIn0KICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyBuZXcgY3Jhd2wgY29tcG9uZW50Li4uIgogICAgICAgICAgICAgICAgICAgICAgICAkY3Jhd2xDb21wb25lbnQgPSBOZXctU1BFbnRlcnByaXNlU2VhcmNoQ3Jhd2xDb21wb25lbnQgLVNlYXJjaFNlcnZpY2VJbnN0YW5jZSAkc2VhcmNoU3ZjIC1TZWFyY2hBcHBsaWNhdGlvbiAkc2VhcmNoQXBwIC1DcmF3bFRvcG9sb2d5ICRjcmF3bFRvcG9sb2d5IC1DcmF3bERhdGFiYXNlICRjcmF3bFN0b3JlLklkLlRvU3RyaW5nKCkgLUluZGV4TG9jYXRpb24gJGluZGV4TG9jYXRpb24KICAgICAgICAgICAgICAgICAgICB9IEVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIENyYXdsIGNvbXBvbmVudCBhbHJlYWR5IGV4aXN0LCBza2lwcGluZyBjcmF3bCBjb21wb25lbnQgY3JlYXRpb24uIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkcXVlcnlUb3BvbG9naWVzID0gR2V0LVNQRW50ZXJwcmlzZVNlYXJjaFF1ZXJ5VG9wb2xvZ3kgLVNlYXJjaEFwcGxpY2F0aW9uICRzZWFyY2hBcHAgfCB3aGVyZSB7JF8uUXVlcnlDb21wb25lbnRzLkNvdW50IC1ndCAwIC1vciAkXy5TdGF0ZSAtZXEgIkluYWN0aXZlIn0KICAgICAgICAgICAgICAgIElmICgkcXVlcnlUb3BvbG9naWVzLkNvdW50IC1sdCAxKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyBuZXcgcXVlcnkgdG9wb2xvZ3kuLi4iCiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5VG9wb2xvZ3kgPSAkc2VhcmNoQXBwIHwgTmV3LVNQRW50ZXJwcmlzZVNlYXJjaFF1ZXJ5VG9wb2xvZ3kgLVBhcnRpdGlvbnMgJGFwcENvbmZpZy5QYXJ0aXRpb25zCiAgICAgICAgICAgICAgICB9IEVsc2UgewogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gQSBxdWVyeSB0b3BvbG9neSBhbHJlYWR5IGV4aXN0cywgc2tpcHBpbmcgcXVlcnkgdG9wb2xvZ3kgY3JlYXRpb24uIgogICAgICAgICAgICAgICAgICAgIElmICgkcXVlcnlUb3BvbG9naWVzLkNvdW50IC1ndCAxKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBUcnkgdG8gc2VsZWN0IHRoZSBxdWVyeSB0b3BvbG9neSB0aGF0IGhhcyBjb21wb25lbnRzCiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeVRvcG9sb2d5ID0gJHF1ZXJ5VG9wb2xvZ2llcyB8IFdoZXJlLU9iamVjdCB7JF8uUXVlcnlDb21wb25lbnRzLkNvdW50IC1ndCAwfSB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkcXVlcnlUb3BvbG9neSkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBKdXN0IHNlbGVjdCB0aGUgZmlyc3QgcXVlcnkgdG9wb2xvZ3kgc2luY2Ugbm9uZSBhcHBlYXIgdG8gaGF2ZSBxdWVyeSBjb21wb25lbnRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnlUb3BvbG9neSA9ICRxdWVyeVRvcG9sb2dpZXMgfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgRWxzZQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBKdXN0IHNldCBpdCB0byAkcXVlcnlUb3BvbG9naWVzIHNpbmNlIHRoZXJlIGlzIG9ubHkgb25lCiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeVRvcG9sb2d5ID0gJHF1ZXJ5VG9wb2xvZ2llcwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBJZiAoJGluc3RhbGxRdWVyeVN2YykgewogICAgICAgICAgICAgICAgICAgICRxdWVyeUNvbXBvbmVudCA9ICRxdWVyeVRvcG9sb2d5LlF1ZXJ5Q29tcG9uZW50cyB8IHdoZXJlIHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXJOYW1lICRlbnY6Q09NUFVURVJOQU1FfQogICAgICAgICAgICAgICAgICAgIElmICgkcXVlcnlDb21wb25lbnQgLWVxICRudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwYXJ0aXRpb24gPSAoJHF1ZXJ5VG9wb2xvZ3kgfCBHZXQtU1BFbnRlcnByaXNlU2VhcmNoSW5kZXhQYXJ0aXRpb24pCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgbmV3IHF1ZXJ5IGNvbXBvbmVudC4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5Q29tcG9uZW50ID0gTmV3LVNQRW50ZXJwcmlzZVNlYXJjaFF1ZXJ5Q29tcG9uZW50IC1JbmRleFBhcnRpdGlvbiAkcGFydGl0aW9uIC1RdWVyeVRvcG9sb2d5ICRxdWVyeVRvcG9sb2d5IC1TZWFyY2hTZXJ2aWNlSW5zdGFuY2UgJHNlYXJjaFN2YyAtU2hhcmVOYW1lICRzdmNDb25maWcuU2hhcmVOYW1lIC1JbmRleExvY2F0aW9uICRpbmRleExvY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gU2V0dGluZyBpbmRleCBwYXJ0aXRpb24gYW5kIHByb3BlcnR5IHN0b3JlIGRhdGFiYXNlLi4uIgogICAgICAgICAgICAgICAgICAgICAgICAkcHJvcGVydHlTdG9yZSA9ICRzZWFyY2hBcHAuUHJvcGVydHlTdG9yZXMgfCB3aGVyZSB7JF8uTmFtZSAtZXEgIiQoJGRiUHJlZml4KyRhcHBDb25maWcuRGF0YWJhc2UuTmFtZSlfUHJvcGVydHlTdG9yZSJ9CiAgICAgICAgICAgICAgICAgICAgICAgICRwYXJ0aXRpb24gfCBTZXQtU1BFbnRlcnByaXNlU2VhcmNoSW5kZXhQYXJ0aXRpb24gLVByb3BlcnR5RGF0YWJhc2UgJHByb3BlcnR5U3RvcmUuSWQuVG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIH0gRWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gUXVlcnkgY29tcG9uZW50IGFscmVhZHkgZXhpc3RzLCBza2lwcGluZyBxdWVyeSBjb21wb25lbnQgY3JlYXRpb24uIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBJZiAoJGluc3RhbGxTeW5jU3ZjKSB7CiAgICAgICAgICAgICAgICAgICAgIyBTTE46IFVwZGF0ZWQgdG8gbmV3IHN5bnRheAogICAgICAgICAgICAgICAgICAgICRzZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc1NlcnZpY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLlNlcnZlci5TZWFyY2guQWRtaW5pc3RyYXRpb24uU2VhcmNoUXVlcnlBbmRTaXRlU2V0dGluZ3NTZXJ2aWNlSW5zdGFuY2UifQogICAgICAgICAgICAgICAgICAgICRzZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc1NlcnZpY2UgPSAkc2VhcmNoUXVlcnlBbmRTaXRlU2V0dGluZ3NTZXJ2aWNlcyB8ID8ge01hdGNoQ29tcHV0ZXJOYW1lICRfLlNlcnZlci5BZGRyZXNzICRlbnY6Q09NUFVURVJOQU1FfQogICAgICAgICAgICAgICAgICAgIElmICgtbm90ICQ/KSB7IFRocm93ICIgLSBGYWlsZWQgdG8gZmluZCBTZWFyY2ggUXVlcnkgYW5kIFNpdGUgU2V0dGluZ3Mgc2VydmljZSBpbnN0YW5jZSIgfQogICAgICAgICAgICAgICAgICAgICMgU3RhcnQgU2VydmljZSBpbnN0YW5jZQogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gU3RhcnRpbmcgU2VhcmNoIFF1ZXJ5IGFuZCBTaXRlIFNldHRpbmdzIFNlcnZpY2UgSW5zdGFuY2UuLi4iCiAgICAgICAgICAgICAgICAgICAgSWYgKCRzZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc1NlcnZpY2UuU3RhdHVzIC1lcSAiRGlzYWJsZWQiKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNlYXJjaFF1ZXJ5QW5kU2l0ZVNldHRpbmdzU2VydmljZS5Qcm92aXNpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBJZiAoLW5vdCAkPykgeyBUaHJvdyAiIC0gRmFpbGVkIHRvIHN0YXJ0IFNlYXJjaCBRdWVyeSBhbmQgU2l0ZSBTZXR0aW5ncyBzZXJ2aWNlIGluc3RhbmNlIiB9CiAgICAgICAgICAgICAgICAgICAgICAgICMgV2FpdAogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFdhaXRpbmcgZm9yIFNlYXJjaCBRdWVyeSBhbmQgU2l0ZSBTZXR0aW5ncyBzZXJ2aWNlLi4uIiAKICAgICAgICAgICAgICAgICAgICAgICAgV2hpbGUgKCRzZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc1NlcnZpY2UuU3RhdHVzIC1uZSAiT25saW5lIikKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIuIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc1NlcnZpY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLlNlcnZlci5TZWFyY2guQWRtaW5pc3RyYXRpb24uU2VhcmNoUXVlcnlBbmRTaXRlU2V0dGluZ3NTZXJ2aWNlSW5zdGFuY2UifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNlYXJjaFF1ZXJ5QW5kU2l0ZVNldHRpbmdzU2VydmljZSA9ICRzZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc1NlcnZpY2VzIHwgPyB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyLkFkZHJlc3MgJGVudjpDT01QVVRFUk5BTUV9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgbG9nICQoJHNlYXJjaFF1ZXJ5QW5kU2l0ZVNldHRpbmdzU2VydmljZS5TdGF0dXMpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIEVsc2Uge2xvZyAiIC0gU2VhcmNoIFF1ZXJ5IGFuZCBTaXRlIFNldHRpbmdzIFNlcnZpY2UgYWxyZWFkeSBzdGFydGVkLiJ9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgRG9uJ3QgYWN0aXZhdGUgdW50aWwgd2UndmUgYWRkZWQgYWxsIGNvbXBvbmVudHMKICAgICAgICAgICAgICAgICRhbGxDcmF3bFNlcnZlcnNEb25lID0gJHRydWUKICAgICAgICAgICAgICAgICMgUHV0IGFueSBjb21tYS0gb3Igc3BhY2UtZGVsaW1pdGVkIHNlcnZlcnMgd2UgZmluZCBpbiB0aGUgIlByb3Zpc2lvbiIgYXR0cmlidXRlIGludG8gYW4gYXJyYXkKICAgICAgICAgICAgICAgIFthcnJheV0kY3Jhd2xTZXJ2ZXJzVG9Qcm92aXNpb24gPSAkYXBwQ29uZmlnLkNyYXdsQ29tcG9uZW50LlByb3Zpc2lvbiAtc3BsaXQgIiwiIC1zcGxpdCAiICIKICAgICAgICAgICAgICAgICRjcmF3bFNlcnZlcnNUb1Byb3Zpc2lvbiB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAkY3Jhd2xTZXJ2ZXIgPSAkXwogICAgICAgICAgICAgICAgICAgICR0b3AgPSAkY3Jhd2xUb3BvbG9neS5DcmF3bENvbXBvbmVudHMgfCB3aGVyZSB7JF8uU2VydmVyTmFtZSAtZXEgJGNyYXdsU2VydmVyfQogICAgICAgICAgICAgICAgICAgIElmICgkdG9wIC1lcSAkbnVsbCkgeyAkYWxsQ3Jhd2xTZXJ2ZXJzRG9uZSA9ICRmYWxzZSB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgSWYgKCRhbGxDcmF3bFNlcnZlcnNEb25lIC1hbmQgJGNyYXdsVG9wb2xvZ3kuU3RhdGUgLW5lICJBY3RpdmUiKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBTZXR0aW5nIG5ldyBjcmF3bCB0b3BvbG9neSB0byBhY3RpdmUuLi4iCiAgICAgICAgICAgICAgICAgICAgJGNyYXdsVG9wb2xvZ3kgfCBTZXQtU1BFbnRlcnByaXNlU2VhcmNoQ3Jhd2xUb3BvbG9neSAtQWN0aXZlIC1Db25maXJtOiRmYWxzZQogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gV2FpdGluZyBmb3IgQ3Jhd2wgQ29tcG9uZW50cy4uLiIgCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCR0cnVlKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGN0ID0gR2V0LVNQRW50ZXJwcmlzZVNlYXJjaENyYXdsVG9wb2xvZ3kgLUlkZW50aXR5ICRjcmF3bFRvcG9sb2d5IC1TZWFyY2hBcHBsaWNhdGlvbiAkc2VhcmNoQXBwCiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZSA9ICRjdC5DcmF3bENvbXBvbmVudHMgfCB3aGVyZSB7JF8uU3RhdGUgLW5lICJSZWFkeSJ9CiAgICAgICAgICAgICAgICAgICAgICAgIElmICgkY3QuU3RhdGUgLWVxICJBY3RpdmUiIC1hbmQgJHN0YXRlIC1lcSAkbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIi4iIAogICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAxCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxvZyAkKCRjcmF3bFRvcG9sb2d5LlN0YXRlKQoKICAgICAgICAgICAgICAgICAgICAjIE5lZWQgdG8gZGVsZXRlIHRoZSBvcmlnaW5hbCBjcmF3bCB0b3BvbG9neSB0aGF0IHdhcyBjcmVhdGVkIGJ5IGRlZmF1bHQKICAgICAgICAgICAgICAgICAgICAkc2VhcmNoQXBwIHwgR2V0LVNQRW50ZXJwcmlzZVNlYXJjaENyYXdsVG9wb2xvZ3kgfCB3aGVyZSB7JF8uU3RhdGUgLWVxICJJbmFjdGl2ZSJ9IHwgUmVtb3ZlLVNQRW50ZXJwcmlzZVNlYXJjaENyYXdsVG9wb2xvZ3kgLUNvbmZpcm06JGZhbHNlCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGFsbFF1ZXJ5U2VydmVyc0RvbmUgPSAkdHJ1ZQogICAgICAgICAgICAgICAgIyBQdXQgYW55IGNvbW1hLSBvciBzcGFjZS1kZWxpbWl0ZWQgc2VydmVycyB3ZSBmaW5kIGluIHRoZSAiUHJvdmlzaW9uIiBhdHRyaWJ1dGUgaW50byBhbiBhcnJheQogICAgICAgICAgICAgICAgW2FycmF5XSRxdWVyeVNlcnZlcnNUb1Byb3Zpc2lvbiA9ICRhcHBDb25maWcuUXVlcnlDb21wb25lbnQuUHJvdmlzaW9uIC1zcGxpdCAiLCIgLXNwbGl0ICIgIgogICAgICAgICAgICAgICAgJHF1ZXJ5U2VydmVyc1RvUHJvdmlzaW9uIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICRxdWVyeVNlcnZlciA9ICRfCiAgICAgICAgICAgICAgICAgICAgJHRvcCA9ICRxdWVyeVRvcG9sb2d5LlF1ZXJ5Q29tcG9uZW50cyB8IHdoZXJlIHskXy5TZXJ2ZXJOYW1lIC1lcSAkcXVlcnlTZXJ2ZXJ9CiAgICAgICAgICAgICAgICAgICAgSWYgKCR0b3AgLWVxICRudWxsKSB7ICRhbGxRdWVyeVNlcnZlcnNEb25lID0gJGZhbHNlIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIE1ha2Ugc3VyZSB3ZSBoYXZlIGEgY3Jhd2wgY29tcG9uZW50IGFkZGVkIGFuZCBzdGFydGVkIGJlZm9yZSB0cnlpbmcgdG8gZW5hYmxlIHRoZSBxdWVyeSBjb21wb25lbnQKICAgICAgICAgICAgICAgIElmICgkYWxsQ3Jhd2xTZXJ2ZXJzRG9uZSAtYW5kICRhbGxRdWVyeVNlcnZlcnNEb25lIC1hbmQgJHF1ZXJ5VG9wb2xvZ3kuU3RhdGUgLW5lICJBY3RpdmUiKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBTZXR0aW5nIHF1ZXJ5IHRvcG9sb2d5IGFzIGFjdGl2ZS4uLiIKICAgICAgICAgICAgICAgICAgICAkcXVlcnlUb3BvbG9neSB8IFNldC1TUEVudGVycHJpc2VTZWFyY2hRdWVyeVRvcG9sb2d5IC1BY3RpdmUgLUNvbmZpcm06JGZhbHNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIC1FcnJvclZhcmlhYmxlIGVycgogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gV2FpdGluZyBmb3IgUXVlcnkgQ29tcG9uZW50cy4uLiIgCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCR0cnVlKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF0ID0gR2V0LVNQRW50ZXJwcmlzZVNlYXJjaFF1ZXJ5VG9wb2xvZ3kgLUlkZW50aXR5ICRxdWVyeVRvcG9sb2d5IC1TZWFyY2hBcHBsaWNhdGlvbiAkc2VhcmNoQXBwCiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZSA9ICRxdC5RdWVyeUNvbXBvbmVudHMgfCB3aGVyZSB7JF8uU3RhdGUgLW5lICJSZWFkeSJ9CiAgICAgICAgICAgICAgICAgICAgICAgIElmICgkcXQuU3RhdGUgLWVxICJBY3RpdmUiIC1hbmQgJHN0YXRlIC1lcSAkbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIi4iIAogICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAxCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxvZyAkKCRxdWVyeVRvcG9sb2d5LlN0YXRlKQoKICAgICAgICAgICAgICAgICAgICAjIE5lZWQgdG8gZGVsZXRlIHRoZSBvcmlnaW5hbCBxdWVyeSB0b3BvbG9neSB0aGF0IHdhcyBjcmVhdGVkIGJ5IGRlZmF1bHQKICAgICAgICAgICAgICAgICAgICAkb3JpZ1F1ZXJ5VG9wb2xvZ3kgPSAkc2VhcmNoQXBwIHwgR2V0LVNQRW50ZXJwcmlzZVNlYXJjaFF1ZXJ5VG9wb2xvZ3kgfCB3aGVyZSB7JF8uUXVlcnlDb21wb25lbnRzLkNvdW50IC1lcSAwfQogICAgICAgICAgICAgICAgICAgIElmICgkb3JpZ1F1ZXJ5VG9wb2xvZ3kuU3RhdGUgLWVxICJJbmFjdGl2ZSIpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFJlbW92aW5nIG9yaWdpbmFsIChkZWZhdWx0KSBxdWVyeSB0b3BvbG9neS4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgJG9yaWdRdWVyeVRvcG9sb2d5IHwgUmVtb3ZlLVNQRW50ZXJwcmlzZVNlYXJjaFF1ZXJ5VG9wb2xvZ3kgLUNvbmZpcm06JGZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRwcm94eSA9IEdldC1TUEVudGVycHJpc2VTZWFyY2hTZXJ2aWNlQXBwbGljYXRpb25Qcm94eSAtSWRlbnRpdHkgJGFwcENvbmZpZy5Qcm94eS5OYW1lIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgICAgICBJZiAoJHByb3h5IC1lcSAkbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgZW50ZXJwcmlzZSBzZWFyY2ggc2VydmljZSBhcHBsaWNhdGlvbiBwcm94eS4uLiIKICAgICAgICAgICAgICAgICAgICAkcHJveHkgPSBOZXctU1BFbnRlcnByaXNlU2VhcmNoU2VydmljZUFwcGxpY2F0aW9uUHJveHkgLU5hbWUgJGFwcENvbmZpZy5Qcm94eS5OYW1lIC1TZWFyY2hBcHBsaWNhdGlvbiAkc2VhcmNoQXBwIC1QYXJ0aXRpb25lZDooW2Jvb2xdOjpQYXJzZSgkYXBwQ29uZmlnLlByb3h5LlBhcnRpdGlvbmVkKSkKICAgICAgICAgICAgICAgIH0gRWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBFbnRlcnByaXNlIHNlYXJjaCBzZXJ2aWNlIGFwcGxpY2F0aW9uIHByb3h5IGFscmVhZHkgZXhpc3RzLCBza2lwcGluZyBjcmVhdGlvbi4iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBJZiAoJHByb3h5LlN0YXR1cyAtbmUgIk9ubGluZSIpIHsKICAgICAgICAgICAgICAgICAgICAkcHJveHkuU3RhdHVzID0gIk9ubGluZSIKICAgICAgICAgICAgICAgICAgICAkcHJveHkuVXBkYXRlKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxvZyAiIC0gU2V0dGluZyBwcm94eSBncm91cCBtZW1iZXJzaGlwLi4uIgogICAgICAgICAgICAgICAgJHByb3h5IHwgU2V0LVByb3h5R3JvdXBzTWVtYmVyc2hpcCAkYXBwQ29uZmlnLlByb3h5CiAgICAgICAgICAgIH0KICAgICAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgfQogICAgICAgIEVsc2VJZiAoJGVudjpzcFZlciAtZ2UgIjE1IikgIyBTaGFyZVBvaW50IDIwMTMrIHN0ZXBzCiAgICAgICAgewogICAgICAgICAgICAkc3ZjQ29uZmlnLkVudGVycHJpc2VTZWFyY2hTZXJ2aWNlQXBwbGljYXRpb25zLkVudGVycHJpc2VTZWFyY2hTZXJ2aWNlQXBwbGljYXRpb24gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAkYXBwQ29uZmlnID0gJF8KICAgICAgICAgICAgICAgICRkYlByZWZpeCA9IEdldC1EQlByZWZpeCAkeG1saW5wdXQKICAgICAgICAgICAgICAgIElmICghKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRhcHBDb25maWcuRGF0YWJhc2UuREJTZXJ2ZXIpKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkZGJTZXJ2ZXIgPSAkYXBwQ29uZmlnLkRhdGFiYXNlLkRCU2VydmVyCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBFbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJGRiU2VydmVyID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5EYXRhYmFzZS5EQlNlcnZlcgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHNlY0NvbnRlbnRBY2Nlc3NBY2N0UFdEID0gQ29udmVydFRvLVNlY3VyZVN0cmluZyAtU3RyaW5nICRhcHBDb25maWcuQ29udGVudEFjY2Vzc0FjY291bnRQYXNzd29yZCAtQXNQbGFpblRleHQgLUZvcmNlCgogICAgICAgICAgICAgICAgIyBGaW5hbGx5IHVzaW5nIFNob3VsZElQcm92aXNpb24gaGVyZSBsaWtlIGV2ZXJ5d2hlcmUgZWxzZSBpbiB0aGUgc2NyaXB0Li4uCiAgICAgICAgICAgICAgICAkaW5zdGFsbENyYXdsQ29tcG9uZW50ID0gU2hvdWxkSVByb3Zpc2lvbiAkYXBwQ29uZmlnLkNyYXdsQ29tcG9uZW50CiAgICAgICAgICAgICAgICAkaW5zdGFsbFF1ZXJ5Q29tcG9uZW50ID0gU2hvdWxkSVByb3Zpc2lvbiAkYXBwQ29uZmlnLlF1ZXJ5Q29tcG9uZW50CiAgICAgICAgICAgICAgICAkaW5zdGFsbEFkbWluQ29tcG9uZW50ID0gU2hvdWxkSVByb3Zpc2lvbiAkYXBwQ29uZmlnLkFkbWluQ29tcG9uZW50CiAgICAgICAgICAgICAgICAkaW5zdGFsbFN5bmNTdmMgPSBTaG91bGRJUHJvdmlzaW9uICRhcHBDb25maWcuU2VhcmNoUXVlcnlBbmRTaXRlU2V0dGluZ3NDb21wb25lbnQKICAgICAgICAgICAgICAgICRpbnN0YWxsQW5hbHl0aWNzUHJvY2Vzc2luZ0NvbXBvbmVudCA9IFNob3VsZElQcm92aXNpb24gJGFwcENvbmZpZy5BbmFseXRpY3NQcm9jZXNzaW5nQ29tcG9uZW50CiAgICAgICAgICAgICAgICAkaW5zdGFsbENvbnRlbnRQcm9jZXNzaW5nQ29tcG9uZW50ID0gU2hvdWxkSVByb3Zpc2lvbiAkYXBwQ29uZmlnLkNvbnRlbnRQcm9jZXNzaW5nQ29tcG9uZW50CiAgICAgICAgICAgICAgICAkaW5zdGFsbEluZGV4Q29tcG9uZW50ID0gU2hvdWxkSVByb3Zpc2lvbiAkYXBwQ29uZmlnLkluZGV4Q29tcG9uZW50CgogICAgICAgICAgICAgICAgJHBvb2wgPSBHZXQtQXBwbGljYXRpb25Qb29sICRhcHBDb25maWcuQXBwbGljYXRpb25Qb29sCiAgICAgICAgICAgICAgICAkYWRtaW5Qb29sID0gR2V0LUFwcGxpY2F0aW9uUG9vbCAkYXBwQ29uZmlnLkFkbWluQ29tcG9uZW50LkFwcGxpY2F0aW9uUG9vbAogICAgICAgICAgICAgICAgJGFwcFBvb2xVc2VyTmFtZSA9ICRzZWFyY2hTZXJ2aWNlQWNjb3VudC5Vc2VybmFtZQoKICAgICAgICAgICAgICAgICRzYUFwcFBvb2wgPSBHZXQtU1BTZXJ2aWNlQXBwbGljYXRpb25Qb29sIC1JZGVudGl0eSAkcG9vbCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgaWYoJHNhQXBwUG9vbCAtZXEgJG51bGwpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgIC0gQ3JlYXRpbmcgU2VydmljZSBBcHBsaWNhdGlvbiBQb29sLi4uIgoKICAgICAgICAgICAgICAgICAgICAkYXBwUG9vbEFjY291bnQgPSBHZXQtU1BNYW5hZ2VkQWNjb3VudCAtSWRlbnRpdHkgJGFwcFBvb2xVc2VyTmFtZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmKCRhcHBQb29sQWNjb3VudCAtZXEgJG51bGwpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSBQbGVhc2Ugc3VwcGx5IHRoZSBwYXNzd29yZCBmb3IgdGhlIFNlcnZpY2UgQWNjb3VudC4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcFBvb2xDcmVkID0gR2V0LUNyZWRlbnRpYWwgJGFwcFBvb2xVc2VyTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkYXBwUG9vbEFjY291bnQgPSBOZXctU1BNYW5hZ2VkQWNjb3VudCAtQ3JlZGVudGlhbCAkYXBwUG9vbENyZWQgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRhcHBQb29sQWNjb3VudCA9IEdldC1TUE1hbmFnZWRBY2NvdW50IC1JZGVudGl0eSAkYXBwUG9vbFVzZXJOYW1lIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCgogICAgICAgICAgICAgICAgICAgIGlmKCRhcHBQb29sQWNjb3VudCAtZXEgJG51bGwpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBUaHJvdyAiICAtIENhbm5vdCBjcmVhdGUgb3IgZmluZCB0aGUgbWFuYWdlZCBhY2NvdW50ICRhcHBQb29sVXNlck5hbWUsIHBsZWFzZSBlbnN1cmUgdGhlIGFjY291bnQgZXhpc3RzLiIKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIE5ldy1TUFNlcnZpY2VBcHBsaWNhdGlvblBvb2wgLU5hbWUgJHBvb2wgLUFjY291bnQgJGFwcFBvb2xBY2NvdW50IC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIEZyb20gaHR0cDovL21tbWFuLml0Z3Jvb3ZlLm5ldC8yMDEyLzEyL3NlYXJjaC1ob3N0LWNvbnRyb2xsZXItc2VydmljZS1pbi1zdGFydGluZy1zdGF0ZS1zaGFyZXBvaW50LTIwMTMtOC8KICAgICAgICAgICAgICAgICMgQW5kIGh0dHA6Ly9ibG9nLnRoZXd1bHBoLmNvbS8/cD0zNzQKICAgICAgICAgICAgICAgIGxvZyAiICAtIEZpeGluZyByZWdpc3RyeSBwZXJtaXNzaW9ucyBmb3IgU2VhcmNoIEhvc3QgQ29udHJvbGxlciBTZXJ2aWNlLi4uIiAKICAgICAgICAgICAgICAgICRhY2wgPSBHZXQtQWNsIEhLTE06XFN5c3RlbVxDdXJyZW50Q29udHJvbFNldFxDb250cm9sXENvbXB1dGVyTmFtZQogICAgICAgICAgICAgICAgJHBlcnNvbiA9IFtTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLk5UQWNjb3VudF0gIldTU19XUEciICMgVHJpbW1lZCBkb3duIGZyb20gdGhlIG9yaWdpbmFsICJVc2VycyIKICAgICAgICAgICAgICAgICRhY2Nlc3MgPSBbU3lzdGVtLlNlY3VyaXR5LkFjY2Vzc0NvbnRyb2wuUmVnaXN0cnlSaWdodHNdOjpGdWxsQ29udHJvbAogICAgICAgICAgICAgICAgJGluaGVyaXRhbmNlID0gW1N5c3RlbS5TZWN1cml0eS5BY2Nlc3NDb250cm9sLkluaGVyaXRhbmNlRmxhZ3NdICJDb250YWluZXJJbmhlcml0LCBPYmplY3RJbmhlcml0IgogICAgICAgICAgICAgICAgJHByb3BhZ2F0aW9uID0gW1N5c3RlbS5TZWN1cml0eS5BY2Nlc3NDb250cm9sLlByb3BhZ2F0aW9uRmxhZ3NdOjpOb25lCiAgICAgICAgICAgICAgICAkdHlwZSA9IFtTeXN0ZW0uU2VjdXJpdHkuQWNjZXNzQ29udHJvbC5BY2Nlc3NDb250cm9sVHlwZV06OkFsbG93CiAgICAgICAgICAgICAgICAkcnVsZSA9IE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LkFjY2Vzc0NvbnRyb2wuUmVnaXN0cnlBY2Nlc3NSdWxlKCRwZXJzb24sICRhY2Nlc3MsICRpbmhlcml0YW5jZSwgJHByb3BhZ2F0aW9uLCAkdHlwZSkKICAgICAgICAgICAgICAgICRhY2wuQWRkQWNjZXNzUnVsZSgkcnVsZSkKICAgICAgICAgICAgICAgIFNldC1BY2wgSEtMTTpcU3lzdGVtXEN1cnJlbnRDb250cm9sU2V0XENvbnRyb2xcQ29tcHV0ZXJOYW1lICRhY2wKICAgICAgICAgICAgICAgIGxvZyAiT0suIgoKICAgICAgICAgICAgICAgIGxvZyAiICAtIENoZWNraW5nIFNlYXJjaCBTZXJ2aWNlIEluc3RhbmNlLi4uIiAKICAgICAgICAgICAgICAgIElmICgkc2VhcmNoU3ZjLlN0YXR1cyAtZXEgIkRpc2FibGVkIikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIlN0YXJ0aW5nLi4uIiAKICAgICAgICAgICAgICAgICAgICAkc2VhcmNoU3ZjIHwgU3RhcnQtU1BFbnRlcnByaXNlU2VhcmNoU2VydmljZUluc3RhbmNlCiAgICAgICAgICAgICAgICAgICAgSWYgKCEkPykge1Rocm93ICIgIC0gQ291bGQgbm90IHN0YXJ0IHRoZSBTZWFyY2ggU2VydmljZSBJbnN0YW5jZS4ifQogICAgICAgICAgICAgICAgICAgICMgV2FpdAogICAgICAgICAgICAgICAgICAgICRzZWFyY2hTdmMgPSBHZXQtU1BFbnRlcnByaXNlU2VhcmNoU2VydmljZUluc3RhbmNlIC1Mb2NhbAogICAgICAgICAgICAgICAgICAgIFdoaWxlICgkc2VhcmNoU3ZjLlN0YXR1cyAtbmUgIk9ubGluZSIpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIi4iIAogICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAxCiAgICAgICAgICAgICAgICAgICAgICAgICRzZWFyY2hTdmMgPSBHZXQtU1BFbnRlcnByaXNlU2VhcmNoU2VydmljZUluc3RhbmNlIC1Mb2NhbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBsb2cgJCgkc2VhcmNoU3ZjLlN0YXR1cykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEVsc2Uge2xvZyAiQWxyZWFkeSAkKCRzZWFyY2hTdmMuU3RhdHVzKS4ifQoKICAgICAgICAgICAgICAgIGlmICgkaW5zdGFsbFN5bmNTdmMpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgIC0gQ2hlY2tpbmcgU2VhcmNoIFF1ZXJ5IGFuZCBTaXRlIFNldHRpbmdzIFNlcnZpY2UgSW5zdGFuY2UuLi4iIAogICAgICAgICAgICAgICAgICAgICRzZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc1NlcnZpY2UgPSBHZXQtU1BFbnRlcnByaXNlU2VhcmNoUXVlcnlBbmRTaXRlU2V0dGluZ3NTZXJ2aWNlSW5zdGFuY2UgLUxvY2FsCiAgICAgICAgICAgICAgICAgICAgSWYgKCRzZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc1NlcnZpY2UuU3RhdHVzIC1lcSAiRGlzYWJsZWQiKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJTdGFydGluZy4uLiIgCiAgICAgICAgICAgICAgICAgICAgICAgICRzZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc1NlcnZpY2UgfCBTdGFydC1TUEVudGVycHJpc2VTZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc1NlcnZpY2VJbnN0YW5jZQogICAgICAgICAgICAgICAgICAgICAgICBJZiAoISQ/KSB7VGhyb3cgIiAgLSBDb3VsZCBub3Qgc3RhcnQgdGhlIFNlYXJjaCBRdWVyeSBhbmQgU2l0ZSBTZXR0aW5ncyBTZXJ2aWNlIEluc3RhbmNlLiJ9CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAkKCRzZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc1NlcnZpY2UuU3RhdHVzKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBFbHNlIHtsb2cgIkFscmVhZHkgJCgkc2VhcmNoUXVlcnlBbmRTaXRlU2V0dGluZ3NTZXJ2aWNlLlN0YXR1cykuIn0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBsb2cgIiAgLSBDaGVja2luZyBTZWFyY2ggU2VydmljZSBBcHBsaWNhdGlvbi4uLiIgCiAgICAgICAgICAgICAgICAkc2VhcmNoQXBwID0gR2V0LVNQRW50ZXJwcmlzZVNlYXJjaFNlcnZpY2VBcHBsaWNhdGlvbiAtSWRlbnRpdHkgJGFwcENvbmZpZy5OYW1lIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgICAgICBJZiAoJHNlYXJjaEFwcCAtZXEgJG51bGwpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICJDcmVhdGluZyAkKCRhcHBDb25maWcuTmFtZSkuLi4iIAogICAgICAgICAgICAgICAgICAgICRzZWFyY2hBcHAgPSBOZXctU1BFbnRlcnByaXNlU2VhcmNoU2VydmljZUFwcGxpY2F0aW9uIC1OYW1lICRhcHBDb25maWcuTmFtZSBgCiAgICAgICAgICAgICAgICAgICAgICAgIC1EYXRhYmFzZVNlcnZlciAkZGJTZXJ2ZXIgYAogICAgICAgICAgICAgICAgICAgICAgICAtRGF0YWJhc2VOYW1lICQoJGRiUHJlZml4KyRhcHBDb25maWcuRGF0YWJhc2UuTmFtZSkgYAogICAgICAgICAgICAgICAgICAgICAgICAtRmFpbG92ZXJEYXRhYmFzZVNlcnZlciAkYXBwQ29uZmlnLkZhaWxvdmVyRGF0YWJhc2VTZXJ2ZXIgYAogICAgICAgICAgICAgICAgICAgICAgICAtQXBwbGljYXRpb25Qb29sICRwb29sIGAKICAgICAgICAgICAgICAgICAgICAgICAgLUFkbWluQXBwbGljYXRpb25Qb29sICRhZG1pblBvb2wgYAogICAgICAgICAgICAgICAgICAgICAgICAtUGFydGl0aW9uZWQ6KFtib29sXTo6UGFyc2UoJGFwcENvbmZpZy5QYXJ0aXRpb25lZCkpCiAgICAgICAgICAgICAgICAgICAgSWYgKCEkPykge1Rocm93ICIgIC0gQW4gZXJyb3Igb2NjdXJyZWQgY3JlYXRpbmcgdGhlICQoJGFwcENvbmZpZy5OYW1lKSBhcHBsaWNhdGlvbi4ifQogICAgICAgICAgICAgICAgICAgIGxvZyAiRG9uZS4iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBFbHNlIHtsb2cgIkFscmVhZHkgZXhpc3RzLiJ9CgogICAgICAgICAgICAgICAgIyBVcGRhdGUgdGhlIGRlZmF1bHQgQ29udGVudCBBY2Nlc3MgQWNjb3VudAogICAgICAgICAgICAgICAgVXBkYXRlLVNlYXJjaENvbnRlbnRBY2Nlc3NBY2NvdW50ICQoJGFwcENvbmZpZy5OYW1lKSAkc2VhcmNoQXBwICQoJGFwcENvbmZpZy5Db250ZW50QWNjZXNzQWNjb3VudCkgJHNlY0NvbnRlbnRBY2Nlc3NBY2N0UFdECgogICAgICAgICAgICAgICAgIyBJZiB0aGUgaW5kZXggbG9jYXRpb24gaXNuJ3QgYWxyZWFkeSBzZXQgdG8gZWl0aGVyIHRoZSBkZWZhdWx0IGxvY2F0aW9uIG9yIG91ciBjdXN0b20tc3BlY2lmaWVkIGxvY2F0aW9uLCBzZXQgdGhlIGRlZmF1bHQgbG9jYXRpb24gZm9yIHRoZSBzZWFyY2ggc2VydmljZSBpbnN0YW5jZQogICAgICAgICAgICAgICAgaWYgKCRpbmRleExvY2F0aW9uIC1uZSAiJGRhdGFEaXJcT2ZmaWNlIFNlcnZlclxBcHBsaWNhdGlvbnMiIC1vciAkaW5kZXhMb2NhdGlvbiAtbmUgJHNlYXJjaFN2Yy5EZWZhdWx0SW5kZXhMb2NhdGlvbikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSBTZXR0aW5nIGRlZmF1bHQgaW5kZXggbG9jYXRpb24gb24gc2VhcmNoIHNlcnZpY2UgaW5zdGFuY2UuLi4iIAogICAgICAgICAgICAgICAgICAgICRzZWFyY2hTdmMgfCBTZXQtU1BFbnRlcnByaXNlU2VhcmNoU2VydmljZUluc3RhbmNlIC1EZWZhdWx0SW5kZXhMb2NhdGlvbiAkaW5kZXhMb2NhdGlvbiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmICgkPykge2xvZyAiT0suIn0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIExvb2sgZm9yIGEgdG9wb2xvZ3kgdGhhdCBoYXMgY29tcG9uZW50cywgb3IgaXMgc3RpbGwgSW5hY3RpdmUsIGJlY2F1c2UgdGhhdCdzIHByb2JhYmx5IG91ciAkY2xvbmUKICAgICAgICAgICAgICAgICRjbG9uZSA9ICRzZWFyY2hBcHAuVG9wb2xvZ2llcyB8IFdoZXJlIHskXy5Db21wb25lbnRDb3VudCAtZ3QgMCAtYW5kICRfLlN0YXRlIC1lcSAiSW5hY3RpdmUifSB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEKICAgICAgICAgICAgICAgIGlmICghJGNsb25lKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICMgQ2xvbmUgdGhlIGFjdGl2ZSB0b3BvbG9neQogICAgICAgICAgICAgICAgICAgIGxvZyAiICAtIENsb25pbmcgdGhlIGFjdGl2ZSBzZWFyY2ggdG9wb2xvZ3kuLi4iIAogICAgICAgICAgICAgICAgICAgICRhY3RpdmVUb3BvbG9neSA9IEdldC1TUEVudGVycHJpc2VTZWFyY2hUb3BvbG9neSAtU2VhcmNoQXBwbGljYXRpb24gJHNlYXJjaEFwcCAtQWN0aXZlCiAgICAgICAgICAgICAgICAgICAgJGNsb25lID0gTmV3LVNQRW50ZXJwcmlzZVNlYXJjaFRvcG9sb2d5IC1TZWFyY2hBcHBsaWNhdGlvbiAkc2VhcmNoQXBwIC1DbG9uZSDDouKCrOKAnFNlYXJjaFRvcG9sb2d5ICRhY3RpdmVUb3BvbG9neQogICAgICAgICAgICAgICAgICAgIGxvZyAiT0suIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiICAtIFVzaW5nIGV4aXN0aW5nIGNsb25lZCBzZWFyY2ggdG9wb2xvZ3kuIgogICAgICAgICAgICAgICAgICAgICMgU2luY2UgdGhpcyBjbG9uZSBwcm9iYWJseSBkb2Vzbid0IGhhdmUgYWxsIGl0cyBjb21wb25lbnRzIGFkZGVkIHlldCwgd2UgcHJvYmFibHkgd2FudCB0byBrZWVwIGl0IGlmIGl0IGlzbid0IGFjdGl2YXRlZCBhZnRlciB0aGlzIHBhc3MKICAgICAgICAgICAgICAgICAgICAka2VlcENsb25lID0gJHRydWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRhY3RpdmF0ZVRvcG9sb2d5ID0gJGZhbHNlCiAgICAgICAgICAgICAgICAjIENoZWNrIGlmIGVhY2ggc2VhcmNoIGNvbXBvbmVudCBpcyBhbHJlYWR5IGFzc2lnbmVkIHRvIHRoZSBjdXJyZW50IHNlcnZlciwgdGhlbiBjaGVjayB0aGF0IGl0J3MgYWN0dWFsbHkgYmVpbmcgcmVxdWVzdGVkIGZvciB0aGUgY3VycmVudCBzZXJ2ZXIsIHRoZW4gY3JlYXRlIGl0IGFzIHJlcXVpcmVkLgogICAgICAgICAgICAgICAgbG9nICIgIC0gQ2hlY2tpbmcgYWRtaW4gY29tcG9uZW50Li4uIiAKICAgICAgICAgICAgICAgICRhZG1pbkNvbXBvbmVudHMgPSAkY2xvbmUuR2V0Q29tcG9uZW50cygpIHwgV2hlcmUtT2JqZWN0IHskXy5OYW1lIC1saWtlICJBZG1pbkNvbXBvbmVudCoifQogICAgICAgICAgICAgICAgSWYgKCRpbnN0YWxsQWRtaW5Db21wb25lbnQpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoJGFkbWluQ29tcG9uZW50cyB8IFdoZXJlLU9iamVjdCB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyTmFtZSAkZW52OkNPTVBVVEVSTkFNRX0pKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJDcmVhdGluZy4uLiIgCiAgICAgICAgICAgICAgICAgICAgICAgIE5ldy1TUEVudGVycHJpc2VTZWFyY2hBZG1pbkNvbXBvbmVudCDDouKCrOKAnFNlYXJjaFRvcG9sb2d5ICRjbG9uZSAtU2VhcmNoU2VydmljZUluc3RhbmNlICRzZWFyY2hTdmMgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgICAgICAgICBJZiAoJD8pCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiT0suIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbXBvbmVudHNNb2RpZmllZCA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7bG9nICJBbHJlYWR5IGV4aXN0cyBvbiB0aGlzIHNlcnZlci4ifQogICAgICAgICAgICAgICAgICAgICRhZG1pbkNvbXBvbmVudFJlYWR5ID0gJHRydWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIk5vdCByZXF1ZXN0ZWQgZm9yIHRoaXMgc2VydmVyLiIKICAgICAgICAgICAgICAgICAgICBbYXJyYXldJGNvbXBvbmVudHNUb1JlbW92ZSA9ICRhZG1pbkNvbXBvbmVudHMgfCBXaGVyZS1PYmplY3Qge01hdGNoQ29tcHV0ZXJOYW1lICRfLlNlcnZlck5hbWUgJGVudjpDT01QVVRFUk5BTUV9CiAgICAgICAgICAgICAgICAgICAgaWYgKCRjb21wb25lbnRzVG9SZW1vdmUpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkY29tcG9uZW50VG9SZW1vdmUgaW4gJGNvbXBvbmVudHNUb1JlbW92ZSkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgICAtIFJlbW92aW5nIGNvbXBvbmVudCAkKCRjb21wb25lbnRUb1JlbW92ZS5Db21wb25lbnRJZCkuLi4iIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbXBvbmVudFRvUmVtb3ZlIHwgUmVtb3ZlLVNQRW50ZXJwcmlzZVNlYXJjaENvbXBvbmVudCAtU2VhcmNoVG9wb2xvZ3kgJGNsb25lIC1Db25maXJtOiRmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgKCQ/KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiT0suIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21wb25lbnRzTW9kaWZpZWQgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRjb21wb25lbnRzVG9SZW1vdmUgPSAkbnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCRhZG1pbkNvbXBvbmVudHMpIHtsb2cgIiAgLSBBZG1pbiBjb21wb25lbnQocykgYWxyZWFkeSBleGlzdChzKSBpbiB0aGUgZmFybS4iOyAkYWRtaW5Db21wb25lbnRSZWFkeSA9ICR0cnVlfQoKICAgICAgICAgICAgICAgIGxvZyAiICAtIENoZWNraW5nIGNvbnRlbnQgcHJvY2Vzc2luZyBjb21wb25lbnQuLi4iIAogICAgICAgICAgICAgICAgJGNvbnRlbnRQcm9jZXNzaW5nQ29tcG9uZW50cyA9ICRjbG9uZS5HZXRDb21wb25lbnRzKCkgfCBXaGVyZS1PYmplY3QgeyRfLk5hbWUgLWxpa2UgIkNvbnRlbnRQcm9jZXNzaW5nQ29tcG9uZW50KiJ9CiAgICAgICAgICAgICAgICBpZiAoJGluc3RhbGxDb250ZW50UHJvY2Vzc2luZ0NvbXBvbmVudCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoISgkY29udGVudFByb2Nlc3NpbmdDb21wb25lbnRzIHwgV2hlcmUtT2JqZWN0IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXJOYW1lICRlbnY6Q09NUFVURVJOQU1FfSkpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIkNyZWF0aW5nLi4uIiAKICAgICAgICAgICAgICAgICAgICAgICAgTmV3LVNQRW50ZXJwcmlzZVNlYXJjaENvbnRlbnRQcm9jZXNzaW5nQ29tcG9uZW50IMOi4oKs4oCcU2VhcmNoVG9wb2xvZ3kgJGNsb25lIC1TZWFyY2hTZXJ2aWNlSW5zdGFuY2UgJHNlYXJjaFN2YyB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICAgICAgICAgIElmICgkPykKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJPSy4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29tcG9uZW50c01vZGlmaWVkID0gJHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHtsb2cgIkFscmVhZHkgZXhpc3RzIG9uIHRoaXMgc2VydmVyLiJ9CiAgICAgICAgICAgICAgICAgICAgJGNvbnRlbnRQcm9jZXNzaW5nQ29tcG9uZW50UmVhZHkgPSAkdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiTm90IHJlcXVlc3RlZCBmb3IgdGhpcyBzZXJ2ZXIuIgogICAgICAgICAgICAgICAgICAgIFthcnJheV0kY29tcG9uZW50c1RvUmVtb3ZlID0gJGNvbnRlbnRQcm9jZXNzaW5nQ29tcG9uZW50cyB8IFdoZXJlLU9iamVjdCB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyTmFtZSAkZW52OkNPTVBVVEVSTkFNRX0KICAgICAgICAgICAgICAgICAgICBpZiAoJGNvbXBvbmVudHNUb1JlbW92ZSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRjb21wb25lbnRUb1JlbW92ZSBpbiAkY29tcG9uZW50c1RvUmVtb3ZlKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAgIC0gUmVtb3ZpbmcgY29tcG9uZW50ICQoJGNvbXBvbmVudFRvUmVtb3ZlLkNvbXBvbmVudElkKS4uLiIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29tcG9uZW50VG9SZW1vdmUgfCBSZW1vdmUtU1BFbnRlcnByaXNlU2VhcmNoQ29tcG9uZW50IC1TZWFyY2hUb3BvbG9neSAkY2xvbmUgLUNvbmZpcm06JGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJZiAoJD8pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJPSy4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbXBvbmVudHNNb2RpZmllZCA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGNvbXBvbmVudHNUb1JlbW92ZSA9ICRudWxsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoJGNvbnRlbnRQcm9jZXNzaW5nQ29tcG9uZW50cykge2xvZyAiICAtIENvbnRlbnQgcHJvY2Vzc2luZyBjb21wb25lbnQocykgYWxyZWFkeSBleGlzdChzKSBpbiB0aGUgZmFybS4iOyAkY29udGVudFByb2Nlc3NpbmdDb21wb25lbnRSZWFkeSA9ICR0cnVlfQoKICAgICAgICAgICAgICAgIGxvZyAiICAtIENoZWNraW5nIGFuYWx5dGljcyBwcm9jZXNzaW5nIGNvbXBvbmVudC4uLiIgCiAgICAgICAgICAgICAgICAkYW5hbHl0aWNzUHJvY2Vzc2luZ0NvbXBvbmVudHMgPSAkY2xvbmUuR2V0Q29tcG9uZW50cygpIHwgV2hlcmUtT2JqZWN0IHskXy5OYW1lIC1saWtlICJBbmFseXRpY3NQcm9jZXNzaW5nQ29tcG9uZW50KiJ9CiAgICAgICAgICAgICAgICBpZiAoJGluc3RhbGxBbmFseXRpY3NQcm9jZXNzaW5nQ29tcG9uZW50KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGlmICghKCRhbmFseXRpY3NQcm9jZXNzaW5nQ29tcG9uZW50cyB8IFdoZXJlLU9iamVjdCB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyTmFtZSAkZW52OkNPTVBVVEVSTkFNRX0pKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJDcmVhdGluZy4uLiIgCiAgICAgICAgICAgICAgICAgICAgICAgIE5ldy1TUEVudGVycHJpc2VTZWFyY2hBbmFseXRpY3NQcm9jZXNzaW5nQ29tcG9uZW50IMOi4oKs4oCcU2VhcmNoVG9wb2xvZ3kgJGNsb25lIC1TZWFyY2hTZXJ2aWNlSW5zdGFuY2UgJHNlYXJjaFN2YyB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICAgICAgICAgIElmICgkPykKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJPSy4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29tcG9uZW50c01vZGlmaWVkID0gJHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHtsb2cgIkFscmVhZHkgZXhpc3RzIG9uIHRoaXMgc2VydmVyLiJ9CiAgICAgICAgICAgICAgICAgICAgJGFuYWx5dGljc1Byb2Nlc3NpbmdDb21wb25lbnRSZWFkeSA9ICR0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICJOb3QgcmVxdWVzdGVkIGZvciB0aGlzIHNlcnZlci4iCiAgICAgICAgICAgICAgICAgICAgW2FycmF5XSRjb21wb25lbnRzVG9SZW1vdmUgPSAkYW5hbHl0aWNzUHJvY2Vzc2luZ0NvbXBvbmVudHMgfCBXaGVyZS1PYmplY3Qge01hdGNoQ29tcHV0ZXJOYW1lICRfLlNlcnZlck5hbWUgJGVudjpDT01QVVRFUk5BTUV9CiAgICAgICAgICAgICAgICAgICAgaWYgKCRjb21wb25lbnRzVG9SZW1vdmUpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkY29tcG9uZW50VG9SZW1vdmUgaW4gJGNvbXBvbmVudHNUb1JlbW92ZSkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgICAtIFJlbW92aW5nIGNvbXBvbmVudCAkKCRjb21wb25lbnRUb1JlbW92ZS5Db21wb25lbnRJZCkuLi4iIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbXBvbmVudFRvUmVtb3ZlIHwgUmVtb3ZlLVNQRW50ZXJwcmlzZVNlYXJjaENvbXBvbmVudCAtU2VhcmNoVG9wb2xvZ3kgJGNsb25lIC1Db25maXJtOiRmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgKCQ/KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiT0suIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21wb25lbnRzTW9kaWZpZWQgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRjb21wb25lbnRzVG9SZW1vdmUgPSAkbnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCRhbmFseXRpY3NQcm9jZXNzaW5nQ29tcG9uZW50cykge2xvZyAiICAtIEFuYWx5dGljcyBwcm9jZXNzaW5nIGNvbXBvbmVudChzKSBhbHJlYWR5IGV4aXN0KHMpIGluIHRoZSBmYXJtLiI7ICRhbmFseXRpY3NQcm9jZXNzaW5nQ29tcG9uZW50UmVhZHkgPSAkdHJ1ZX0KCiAgICAgICAgICAgICAgICBsb2cgIiAgLSBDaGVja2luZyBjcmF3bCBjb21wb25lbnQuLi4iIAogICAgICAgICAgICAgICAgJGNyYXdsQ29tcG9uZW50cyA9ICRjbG9uZS5HZXRDb21wb25lbnRzKCkgfCBXaGVyZS1PYmplY3QgeyRfLk5hbWUgLWxpa2UgIkNyYXdsQ29tcG9uZW50KiJ9CiAgICAgICAgICAgICAgICBpZiAoJGluc3RhbGxDcmF3bENvbXBvbmVudCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoISgkY3Jhd2xDb21wb25lbnRzIHwgV2hlcmUtT2JqZWN0IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXJOYW1lICRlbnY6Q09NUFVURVJOQU1FfSkpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIkNyZWF0aW5nLi4uIiAKICAgICAgICAgICAgICAgICAgICAgICAgTmV3LVNQRW50ZXJwcmlzZVNlYXJjaENyYXdsQ29tcG9uZW50IMOi4oKs4oCcU2VhcmNoVG9wb2xvZ3kgJGNsb25lIC1TZWFyY2hTZXJ2aWNlSW5zdGFuY2UgJHNlYXJjaFN2YyB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICAgICAgICAgIElmICgkPykKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJPSy4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29tcG9uZW50c01vZGlmaWVkID0gJHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHtsb2cgIkFscmVhZHkgZXhpc3RzIG9uIHRoaXMgc2VydmVyLiJ9CiAgICAgICAgICAgICAgICAgICAgJGNyYXdsQ29tcG9uZW50UmVhZHkgPSAkdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiTm90IHJlcXVlc3RlZCBmb3IgdGhpcyBzZXJ2ZXIuIgogICAgICAgICAgICAgICAgICAgIFthcnJheV0kY29tcG9uZW50c1RvUmVtb3ZlID0gJGNyYXdsQ29tcG9uZW50cyB8IFdoZXJlLU9iamVjdCB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyTmFtZSAkZW52OkNPTVBVVEVSTkFNRX0KICAgICAgICAgICAgICAgICAgICBpZiAoJGNvbXBvbmVudHNUb1JlbW92ZSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRjb21wb25lbnRUb1JlbW92ZSBpbiAkY29tcG9uZW50c1RvUmVtb3ZlKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAgIC0gUmVtb3ZpbmcgY29tcG9uZW50ICQoJGNvbXBvbmVudFRvUmVtb3ZlLkNvbXBvbmVudElkKS4uLiIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29tcG9uZW50VG9SZW1vdmUgfCBSZW1vdmUtU1BFbnRlcnByaXNlU2VhcmNoQ29tcG9uZW50IC1TZWFyY2hUb3BvbG9neSAkY2xvbmUgLUNvbmZpcm06JGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJZiAoJD8pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJPSy4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbXBvbmVudHNNb2RpZmllZCA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGNvbXBvbmVudHNUb1JlbW92ZSA9ICRudWxsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoJGNyYXdsQ29tcG9uZW50cykge2xvZyAiICAtIENyYXdsIGNvbXBvbmVudChzKSBhbHJlYWR5IGV4aXN0KHMpIGluIHRoZSBmYXJtLiI7ICRjcmF3bENvbXBvbmVudFJlYWR5ID0gJHRydWV9CgogICAgICAgICAgICAgICAgbG9nICIgIC0gQ2hlY2tpbmcgaW5kZXggY29tcG9uZW50Li4uIiAKICAgICAgICAgICAgICAgICRpbmRleGluZ0NvbXBvbmVudHMgPSAkY2xvbmUuR2V0Q29tcG9uZW50cygpIHwgV2hlcmUtT2JqZWN0IHskXy5OYW1lIC1saWtlICJJbmRleENvbXBvbmVudCoifQogICAgICAgICAgICAgICAgaWYgKCRpbnN0YWxsSW5kZXhDb21wb25lbnQpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoJGluZGV4aW5nQ29tcG9uZW50cyB8IFdoZXJlLU9iamVjdCB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyTmFtZSAkZW52OkNPTVBVVEVSTkFNRX0pKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJDcmVhdGluZy4uLiIgCiAgICAgICAgICAgICAgICAgICAgICAgICMgU3BlY2lmeSB0aGUgUm9vdERpcmVjdG9yeSBwYXJhbWV0ZXIgb25seSBpZiBpdCdzIGRpZmZlcmVudCB0aGFuIHRoZSBkZWZhdWx0IHBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRpbmRleExvY2F0aW9uIC1uZSAiJGRhdGFEaXJcT2ZmaWNlIFNlcnZlclxBcHBsaWNhdGlvbnMiKQogICAgICAgICAgICAgICAgICAgICAgICB7JHJvb3REaXJlY3RvcnlTd2l0Y2ggPSBAe1Jvb3REaXJlY3RvcnkgPSAkaW5kZXhMb2NhdGlvbn19CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyRyb290RGlyZWN0b3J5U3dpdGNoID0gQHt9fQogICAgICAgICAgICAgICAgICAgICAgICBOZXctU1BFbnRlcnByaXNlU2VhcmNoSW5kZXhDb21wb25lbnQgw6LigqzigJxTZWFyY2hUb3BvbG9neSAkY2xvbmUgLVNlYXJjaFNlcnZpY2VJbnN0YW5jZSAkc2VhcmNoU3ZjIEByb290RGlyZWN0b3J5U3dpdGNoIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgICAgICAgICAgSWYgKCQ/KQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIk9LLiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21wb25lbnRzTW9kaWZpZWQgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2Uge2xvZyAiQWxyZWFkeSBleGlzdHMgb24gdGhpcyBzZXJ2ZXIuIn0KICAgICAgICAgICAgICAgICAgICAkaW5kZXhDb21wb25lbnRSZWFkeSA9ICR0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICJOb3QgcmVxdWVzdGVkIGZvciB0aGlzIHNlcnZlci4iCiAgICAgICAgICAgICAgICAgICAgW2FycmF5XSRjb21wb25lbnRzVG9SZW1vdmUgPSAkaW5kZXhpbmdDb21wb25lbnRzIHwgV2hlcmUtT2JqZWN0IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXJOYW1lICRlbnY6Q09NUFVURVJOQU1FfQogICAgICAgICAgICAgICAgICAgIGlmICgkY29tcG9uZW50c1RvUmVtb3ZlKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGNvbXBvbmVudFRvUmVtb3ZlIGluICRjb21wb25lbnRzVG9SZW1vdmUpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiICAgLSBSZW1vdmluZyBjb21wb25lbnQgJCgkY29tcG9uZW50VG9SZW1vdmUuQ29tcG9uZW50SWQpLi4uIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21wb25lbnRUb1JlbW92ZSB8IFJlbW92ZS1TUEVudGVycHJpc2VTZWFyY2hDb21wb25lbnQgLVNlYXJjaFRvcG9sb2d5ICRjbG9uZSAtQ29uZmlybTokZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmICgkPykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIk9LLiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29tcG9uZW50c01vZGlmaWVkID0gJHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkY29tcG9uZW50c1RvUmVtb3ZlID0gJG51bGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgkaW5kZXhpbmdDb21wb25lbnRzKSB7bG9nICIgIC0gSW5kZXggY29tcG9uZW50KHMpIGFscmVhZHkgZXhpc3QocykgaW4gdGhlIGZhcm0uIjsgJGluZGV4Q29tcG9uZW50UmVhZHkgPSAkdHJ1ZX0KCiAgICAgICAgICAgICAgICBsb2cgIiAgLSBDaGVja2luZyBxdWVyeSBwcm9jZXNzaW5nIGNvbXBvbmVudC4uLiIgCiAgICAgICAgICAgICAgICAkcXVlcnlDb21wb25lbnRzID0gJGNsb25lLkdldENvbXBvbmVudHMoKSB8IFdoZXJlLU9iamVjdCB7JF8uTmFtZSAtbGlrZSAiUXVlcnlQcm9jZXNzaW5nQ29tcG9uZW50KiJ9CiAgICAgICAgICAgICAgICBpZiAoJGluc3RhbGxRdWVyeUNvbXBvbmVudCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoISgkcXVlcnlDb21wb25lbnRzIHwgV2hlcmUtT2JqZWN0IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXJOYW1lICRlbnY6Q09NUFVURVJOQU1FfSkpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIkNyZWF0aW5nLi4uIiAKICAgICAgICAgICAgICAgICAgICAgICAgTmV3LVNQRW50ZXJwcmlzZVNlYXJjaFF1ZXJ5UHJvY2Vzc2luZ0NvbXBvbmVudCDDouKCrOKAnFNlYXJjaFRvcG9sb2d5ICRjbG9uZSAtU2VhcmNoU2VydmljZUluc3RhbmNlICRzZWFyY2hTdmMgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgICAgICAgICBJZiAoJD8pCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiT0suIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbXBvbmVudHNNb2RpZmllZCA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7bG9nICJBbHJlYWR5IGV4aXN0cyBvbiB0aGlzIHNlcnZlci4ifQogICAgICAgICAgICAgICAgICAgICRxdWVyeUNvbXBvbmVudFJlYWR5ID0gJHRydWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIk5vdCByZXF1ZXN0ZWQgZm9yIHRoaXMgc2VydmVyLiIKICAgICAgICAgICAgICAgICAgICBbYXJyYXldJGNvbXBvbmVudHNUb1JlbW92ZSA9ICRxdWVyeUNvbXBvbmVudHMgfCBXaGVyZS1PYmplY3Qge01hdGNoQ29tcHV0ZXJOYW1lICRfLlNlcnZlck5hbWUgJGVudjpDT01QVVRFUk5BTUV9CiAgICAgICAgICAgICAgICAgICAgaWYgKCRjb21wb25lbnRzVG9SZW1vdmUpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkY29tcG9uZW50VG9SZW1vdmUgaW4gJGNvbXBvbmVudHNUb1JlbW92ZSkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgICAtIFJlbW92aW5nIGNvbXBvbmVudCAkKCRjb21wb25lbnRUb1JlbW92ZS5Db21wb25lbnRJZCkuLi4iIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbXBvbmVudFRvUmVtb3ZlIHwgUmVtb3ZlLVNQRW50ZXJwcmlzZVNlYXJjaENvbXBvbmVudCAtU2VhcmNoVG9wb2xvZ3kgJGNsb25lIC1Db25maXJtOiRmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgKCQ/KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiT0suIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21wb25lbnRzTW9kaWZpZWQgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRjb21wb25lbnRzVG9SZW1vdmUgPSAkbnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCRxdWVyeUNvbXBvbmVudHMpIHtsb2cgIiAgLSBRdWVyeSBjb21wb25lbnQocykgYWxyZWFkeSBleGlzdChzKSBpbiB0aGUgZmFybS4iOyAkcXVlcnlDb21wb25lbnRSZWFkeSA9ICR0cnVlfQoKICAgICAgICAgICAgICAgICRzZWFyY2hBcHAgfCBHZXQtU1BFbnRlcnByaXNlU2VhcmNoQWRtaW5pc3RyYXRpb25Db21wb25lbnQgfCBTZXQtU1BFbnRlcnByaXNlU2VhcmNoQWRtaW5pc3RyYXRpb25Db21wb25lbnQgLVNlYXJjaFNlcnZpY2VJbnN0YW5jZSAkc2VhcmNoU3ZjCgogICAgICAgICAgICAgICAgaWYgKCRhZG1pbkNvbXBvbmVudFJlYWR5IC1hbmQgJGNvbnRlbnRQcm9jZXNzaW5nQ29tcG9uZW50UmVhZHkgLWFuZCAkYW5hbHl0aWNzUHJvY2Vzc2luZ0NvbXBvbmVudFJlYWR5IC1hbmQgJGluZGV4Q29tcG9uZW50UmVhZHkgLWFuZCAkY3Jhd2xDb21wb25lbnRSZWFkeSAtYW5kICRxdWVyeUNvbXBvbmVudFJlYWR5KSB7JGFjdGl2YXRlVG9wb2xvZ3kgPSAkdHJ1ZX0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgYW55IG5ldyBzZWFyY2ggY29tcG9uZW50cyB3ZXJlIGFkZGVkIChvciBpZiB3ZSBoYXZlIGEgY2xvbmUgd2l0aCBtb3JlIGNvbXBvbmVudHMgdGhhbiB0aGUgY3VycmVudCBhY3RpdmUgdG9wb2xvZ3kpIGFuZCBpZiB3ZSdyZSByZWFkeSB0byBhY3RpdmF0ZSB0aGUgdG9wb2xvZ3kKICAgICAgICAgICAgICAgIGlmICgkY29tcG9uZW50c01vZGlmaWVkIC1vciAoJGNsb25lLkNvbXBvbmVudENvdW50IC1ndCAkc2VhcmNoQXBwLkFjdGl2ZVRvcG9sb2d5LkNvbXBvbmVudENvdW50KSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJGFjdGl2YXRlVG9wb2xvZ3kpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSBBY3RpdmF0aW5nIFNlYXJjaCBUb3BvbG9neS4uLiIgCiAgICAgICAgICAgICAgICAgICAgICAgICRjbG9uZS5BY3RpdmF0ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIElmICgkPykKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJPSy4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIENsZWFuIHVwIG9yaWdpbmFsIG9yIHByZXZpb3VzIHVuc3VjY2Vzc2Z1bGx5LXByb3Zpc2lvbmVkIHNlYXJjaCB0b3BvbG9naWVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW5hY3RpdmVUb3BvbG9naWVzID0gJHNlYXJjaEFwcC5Ub3BvbG9naWVzIHwgV2hlcmUgeyRfLlN0YXRlIC1lcSAiSW5hY3RpdmUifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRpbmFjdGl2ZVRvcG9sb2dpZXMgLW5lICRudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiICAtIFJlbW92aW5nIG9sZCwgaW5hY3RpdmUgc2VhcmNoIHRvcG9sb2dpZXM6IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRpbmFjdGl2ZVRvcG9sb2d5IGluICRpbmFjdGl2ZVRvcG9sb2dpZXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAgIC0iJGluYWN0aXZlVG9wb2xvZ3kuVG9wb2xvZ3lJZC5Ub1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbmFjdGl2ZVRvcG9sb2d5LkRlbGV0ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiICAtIE5vdCBhY3RpdmF0aW5nIHRvcG9sb2d5IHlldCBhcyB0aGVyZSBzZWVtIHRvIGJlIGNvbXBvbmVudHMgc3RpbGwgcGVuZGluZy4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmICgka2VlcENsb25lIC1uZSAkdHJ1ZSkgIyBEZWxldGUgdGhlIG5ld2x5LWNsb25lZCB0b3BvbG9neSBzaW5jZSBub3RoaW5nIHdhcyBkb25lCiAgICAgICAgICAgICAgICAjIFRPRE86IENoZWNrIHRoYXQgdGhlIHNlYXJjaCB0b3BvbG9neSBpcyB0cnVseSBjb21wbGV0ZSBhbmQgdGhlcmUgYXJlIG5vIG1vcmUgc2VydmVycyB0byBpbnN0YWxsCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgIC0gRGVsZXRpbmcgdW5uZWVkZWQgY2xvbmVkIHRvcG9sb2d5Li4uIgogICAgICAgICAgICAgICAgICAgICRjbG9uZS5EZWxldGUoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIyBDbGVhbiB1cCBhbnkgZW1wdHksIGluYWN0aXZlIHRvcG9sb2dpZXMKICAgICAgICAgICAgICAgICRlbXB0eVRvcG9sb2dpZXMgPSAkc2VhcmNoQXBwLlRvcG9sb2dpZXMgfCBXaGVyZSB7JF8uQ29tcG9uZW50Q291bnQgLWVxIDAgLWFuZCAkXy5TdGF0ZSAtZXEgIkluYWN0aXZlIn0KICAgICAgICAgICAgICAgIGlmICgkZW1wdHlUb3BvbG9naWVzIC1uZSAkbnVsbCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSBSZW1vdmluZyBlbXB0eSBhbmQgaW5hY3RpdmUgc2VhcmNoIHRvcG9sb2dpZXM6IgogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRlbXB0eVRvcG9sb2d5IGluICRlbXB0eVRvcG9sb2dpZXMpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSIkZW1wdHlUb3BvbG9neS5Ub3BvbG9neUlkLlRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgJGVtcHR5VG9wb2xvZ3kuRGVsZXRlKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2cgIiAgLSBDaGVja2luZyBzZWFyY2ggc2VydmljZSBhcHBsaWNhdGlvbiBwcm94eS4uLiIgCiAgICAgICAgICAgICAgICBJZiAoIShHZXQtU1BFbnRlcnByaXNlU2VhcmNoU2VydmljZUFwcGxpY2F0aW9uUHJveHkgLUlkZW50aXR5ICRhcHBDb25maWcuUHJveHkuTmFtZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICJDcmVhdGluZy4uLiIgCiAgICAgICAgICAgICAgICAgICAgJHNlYXJjaEFwcFByb3h5ID0gTmV3LVNQRW50ZXJwcmlzZVNlYXJjaFNlcnZpY2VBcHBsaWNhdGlvblByb3h5IC1OYW1lICRhcHBDb25maWcuUHJveHkuTmFtZSAtU2VhcmNoQXBwbGljYXRpb24gJGFwcENvbmZpZy5OYW1lCiAgICAgICAgICAgICAgICAgICAgSWYgKCQ/KSB7bG9nICJPSy4ifQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgRWxzZSB7bG9nICJBbHJlYWR5IGV4aXN0cy4ifQoKICAgICAgICAgICAgICAgICMgQ2hlY2sgdGhlIFNlYXJjaCBIb3N0IENvbnRyb2xsZXIgU2VydmljZSBmb3IgYSBrbm93biBpc3N1ZSAoInN0dWNrIG9uIHN0YXJ0aW5nIikKICAgICAgICAgICAgICAgIGxvZyAiICAtIENoZWNraW5nIGZvciBzdHVjayBTZWFyY2ggSG9zdCBDb250cm9sbGVyIFNlcnZpY2UgKGtub3duIGlzc3VlKS4uLiIKICAgICAgICAgICAgICAgICRzZWFyY2hIb3N0U2VydmljZXMgPSBHZXQtU1BTZXJ2aWNlSW5zdGFuY2UgfCA/IHskXy5UeXBlTmFtZSAtZXEgIlNlYXJjaCBIb3N0IENvbnRyb2xsZXIgU2VydmljZSJ9CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkc2ggaW4gJHNlYXJjaEhvc3RTZXJ2aWNlcykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAgIC0gU2VydmVyOiAkKCRzaC5QYXJlbnQuQWRkcmVzcykuLi4iIAogICAgICAgICAgICAgICAgICAgIGlmICgkc2guU3RhdHVzIC1lcSAiUHJvdmlzaW9uaW5nIikKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiUmUtcHJvdmlzaW9uaW5nLi4uIiAKICAgICAgICAgICAgICAgICAgICAgICAgJHNoLlVucHJvdmlzaW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgJHNoLlByb3Zpc2lvbigkdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJEb25lLiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7bG9nICJPSy4ifQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgQWRkIGxpbmsgdG8gcmVzb3VyY2VzIGxpc3QKICAgICAgICAgICAgICAgIEFkZFJlc291cmNlc0xpbmsgJGFwcENvbmZpZy5OYW1lICgic2VhcmNoYWRtaW5pc3RyYXRpb24uYXNweD9hcHBpZD0iICsgICRzZWFyY2hBcHAuSWQpCgogICAgICAgICAgICAgICAgZnVuY3Rpb24gU2V0U2VhcmNoQ2VudGVyVXJsICgkc2VhcmNoQ2VudGVyVVJMLCAkc2VhcmNoQXBwKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIDEwICMgV2FpdCBmb3Igc3R1ZmYgdG8gY2F0Y2ggdXAgc28gd2UgZG9uJ3QgZ2V0IGEgY29uY3VycmVuY3kgZXJyb3IKICAgICAgICAgICAgICAgICAgICAkc2VhcmNoQXBwLlNlYXJjaENlbnRlclVybCA9ICRzZWFyY2hDZW50ZXJVUkwKICAgICAgICAgICAgICAgICAgICAkc2VhcmNoQXBwLlVwZGF0ZSgpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgSWYgKCEoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJGFwcENvbmZpZy5TZWFyY2hDZW50ZXJVcmwpKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAjIFNldCB0aGUgU1AyMDEzKyBTZWFyY2ggQ2VudGVyIFVSTCBwZXIgaHR0cDovL2Jsb2dzLnRlY2huZXQuY29tL2Ivc3Blc2Noa2EvYXJjaGl2ZS8yMDEyLzEwLzI5L2hvdy10by1jb25maWd1cmUtdGhlLWdsb2JhbC1zZWFyY2gtY2VudGVyLXVybC1mb3Itc2hhcmVwb2ludC0yMDEzLXVzaW5nLXBvd2Vyc2hlbGwuYXNweAogICAgICAgICAgICAgICAgICAgIGxvZyAiICAtIFNldHRpbmcgdGhlIEdsb2JhbCBTZWFyY2ggQ2VudGVyIFVSTCB0byAkKCRhcHBDb25maWcuU2VhcmNoQ2VudGVyVVJMKS4uLiIgCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCRkb25lIC1uZSAkdHJ1ZSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEdldCB0aGUgI3NlYXJjaEFwcCBvYmplY3QgYWdhaW4gdG8gcHJldmVudCBjb25mbGljdHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzZWFyY2hBcHAgPSBHZXQtU1BFbnRlcnByaXNlU2VhcmNoU2VydmljZUFwcGxpY2F0aW9uIC1JZGVudGl0eSAkYXBwQ29uZmlnLk5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldFNlYXJjaENlbnRlclVybCAkYXBwQ29uZmlnLlNlYXJjaENlbnRlclVSTC5UcmltRW5kKCIvIikgJHNlYXJjaEFwcAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQ/KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb25lID0gJHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIk9LLiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjYXRjaAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1PdXRwdXQgJF8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkXyAtbGlrZSAiKnVwZGF0ZSBjb25mbGljdCoiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiICAtIEFuIHVwZGF0ZSBjb25mbGljdCBvY2N1cnJlZCwgcmV0cnlpbmcuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtXcml0ZS1PdXRwdXQgJF87ICRkb25lID0gJHRydWV9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBFbHNlIHtsb2cgIiAgLSBTZWFyY2hDZW50ZXJVcmwgd2FzIG5vdCBzcGVjaWZpZWQsIHNraXBwaW5nLiJ9CiAgICAgICAgICAgICAgICBsb2cgIiAtIFNlYXJjaCBTZXJ2aWNlIEFwcGxpY2F0aW9uIHN1Y2Nlc3NmdWxseSBwcm92aXNpb25lZC4iCgogICAgICAgICAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgU0xOOiBDcmVhdGUgdGhlIG5ldHdvcmsgc2hhcmUgKHdpbGwgcmVwb3J0IGFuIGVycm9yIGlmIGV4aXN0KQogICAgICAgICMgZGVmYXVsdCB0byBwcmltaXRpdmVzCiAgICAgICAgJHBhdGhUb1NoYXJlID0gIiIiIiArICRzdmNDb25maWcuU2hhcmVOYW1lICsgIj0iICsgJGluZGV4TG9jYXRpb24gKyAiIiIiCiAgICAgICAgIyBUaGUgcGF0aCB0byBiZSBzaGFyZWQgc2hvdWxkIGV4aXN0IGlmIHRoZSBFbnRlcnByaXNlIFNlYXJjaCBBcHAgY3JlYXRpb24gc3VjY2VlZGVkIGVhcmxpZXIKICAgICAgICBFbnN1cmVGb2xkZXIgJGluZGV4TG9jYXRpb24KICAgICAgICBsb2cgIiAtIENyZWF0aW5nIG5ldHdvcmsgc2hhcmUgJHBhdGhUb1NoYXJlIgogICAgICAgIFN0YXJ0LVByb2Nlc3MgLUZpbGVQYXRoIG5ldC5leGUgLUFyZ3VtZW50TGlzdCAic2hhcmUgJHBhdGhUb1NoYXJlIGAiL0dSQU5UOldTU19XUEcsQ0hBTkdFYCIiIC1Ob05ld1dpbmRvdyAtV2FpdCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQoKICAgICAgICAjIFNldCB0aGUgY3Jhd2wgc3RhcnQgYWRkcmVzc2VzIChpbmNsdWRpbmcgdGhlIGVsdXNpdmUgc3BzMzovLyBVUkwgcmVxdWlyZWQgZm9yIFBlb3BsZSBTZWFyY2gsIGlmIE15IFNpdGVzIGFyZSBwcm92aXNpb25lZCkKICAgICAgICAjIFVwZGF0ZWQgdG8gaW5jbHVkZSBhbGwgd2ViIGFwcHMgYW5kIGhvc3QtbmFtZWQgc2l0ZSBjb2xsZWN0aW9ucywgbm90IGp1c3QgbWFpbiBQb3J0YWwgYW5kIE15U2l0ZXMgaG9zdAogICAgICAgIEZvckVhY2ggKCR3ZWJBcHBDb25maWcgaW4gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uV2ViQXBwbGljYXRpb25zLldlYkFwcGxpY2F0aW9uKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRjcmF3bFN0YXJ0QWRkcmVzc2VzKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJGNyYXdsU3RhcnRBZGRyZXNzZXMgPSAkKCR3ZWJBcHBDb25maWcudXJsKSsiOiIrJCgkd2ViQXBwQ29uZmlnLlBvcnQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkY3Jhd2xTdGFydEFkZHJlc3NlcyArPSAiLCIrJCgkd2ViQXBwQ29uZmlnLnVybCkrIjoiKyQoJHdlYkFwcENvbmZpZy5Qb3J0KQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBJZiAoJG15U2l0ZUhvc3RIZWFkZXJBbmRQb3J0KQogICAgICAgIHsKICAgICAgICAJIyBOZWVkIHRvIHNldCB0aGUgY29ycmVjdCBzcHMgKFBlb3BsZSBTZWFyY2gpIFVSTCBwcm90b2NvbCBpbiBjYXNlIHRoZSB3ZWIgYXBwIHRoYXQgaG9zdHMgTXkgU2l0ZXMgaXMgU1NMLWJvdW5kCiAgICAgICAgCUlmICgkbXlTaXRlSG9zdExvY2F0aW9uIC1saWtlICJodHRwcyoiKSB7JHBlb3BsZVNlYXJjaFByb3RvY29sID0gInNwczNzOi8vIn0KICAgICAgICAJRWxzZSB7JHBlb3BsZVNlYXJjaFByb3RvY29sID0gInNwczM6Ly8ifQogICAgICAgIAkkY3Jhd2xTdGFydEFkZHJlc3NlcyArPSAiLCIrJHBlb3BsZVNlYXJjaFByb3RvY29sKyRteVNpdGVIb3N0SGVhZGVyQW5kUG9ydAogICAgICAgIH0KICAgICAgICBsb2cgIiAtIFNldHRpbmcgdXAgY3Jhd2wgYWRkcmVzc2VzIGZvciBkZWZhdWx0IGNvbnRlbnQgc291cmNlLi4uIiAKICAgICAgICBHZXQtU1BFbnRlcnByaXNlU2VhcmNoU2VydmljZUFwcGxpY2F0aW9uIHwgR2V0LVNQRW50ZXJwcmlzZVNlYXJjaENyYXdsQ29udGVudFNvdXJjZSB8IFNldC1TUEVudGVycHJpc2VTZWFyY2hDcmF3bENvbnRlbnRTb3VyY2UgLVN0YXJ0QWRkcmVzc2VzICRjcmF3bFN0YXJ0QWRkcmVzc2VzCiAgICAgICAgSWYgKCQ/KSB7bG9nICJPSy4ifQogICAgICAgIGlmICgkZW52OnNwVmVyIC1nZSAiMTUiKSAjIEludm9rZS1XZWJSZXF1ZXN0IHJlcXVpcmVzIFBvd2VyU2hlbGwgMy4wIGJ1dCBpZiB3ZSdyZSBpbnN0YWxsaW5nIFNQMjAxMyBhbmQgd2UndmUgZ290dGVuIHRoaXMgZmFyLCB3ZSBtdXN0IGhhdmUgdjMuMAogICAgICAgIHsKICAgICAgICAgICAgIyBJc3N1ZSBhIHJlcXVlc3QgdG8gdGhlIEZhcm0gU2VhcmNoIEFkbWluaXN0cmF0aW9uIHBhZ2UgdG8gYXZvaWQgYSBIZWFsdGggQW5hbHl6ZXIgd2FybmluZyBhYm91dCAnTWlzc2luZyBTZXJ2ZXIgU2lkZSBEZXBlbmRlbmNpZXMnCiAgICAgICAgICAgICRjYSA9IEdldC1TUFdlYkFwcGxpY2F0aW9uIC1JbmNsdWRlQ2VudHJhbEFkbWluaXN0cmF0aW9uIHwgPyB7JF8uSXNBZG1pbmlzdHJhdGlvbldlYkFwcGxpY2F0aW9ufQogICAgICAgICAgICAkY2VudHJhbEFkbWluVXJsID0gJGNhLlVybAogICAgICAgICAgICBpZiAoJGNhLlVybCAtbGlrZSAiaHR0cDovLyoiIC1vciAkY2EuVXJsIC1saWtlICIqJCgkZW52OkNPTVBVVEVSTkFNRSkqIikgIyBJZiBDZW50cmFsIEFkbWluIHVzZXMgU1NMLCBvbmx5IGF0dGVtcHQgdGhlIHdlYiByZXF1ZXN0IGlmIHdlJ3JlIG9uIHRoZSBzYW1lIHNlcnZlciBhcyBDZW50cmFsIEFkbWluLCBvdGhlcndpc2UgaXQgbWF5IHRocm93IGEgY2VydGlmaWNhdGUgZXJyb3IgZHVlIHRvIG91ciBzZWxmLXNpZ25lZCBjZXJ0CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gUmVxdWVzdGluZyBzZWFyY2hmYXJtZGFzaGJvYXJkLmFzcHggKHJlc29sdmVzIEhlYWx0aCBBbmFseXplciBlcnJvcikuLi4iCiAgICAgICAgICAgICAgICAgICAgJG51bGwgPSBJbnZva2UtV2ViUmVxdWVzdCAtVXJpICRjZW50cmFsQWRtaW5Vcmwic2VhcmNoZmFybWRhc2hib2FyZC5hc3B4IiAtVXNlRGVmYXVsdENyZWRlbnRpYWxzIC1EaXNhYmxlS2VlcEFsaXZlIC1Vc2VCYXNpY1BhcnNpbmcgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIHt9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgV3JpdGVMaW5lCiAgICB9CiAgICBFbHNlCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgIyBTZXQgdGhlIHNlcnZpY2UgYWNjb3VudCB0byBzb21ldGhpbmcgb3RoZXIgdGhhbiBMb2NhbCBTeXN0ZW0gdG8gYXZvaWQgSGVhbHRoIEFuYWx5emVyIHdhcm5pbmdzCiAgICAgICAgSWYgKCEoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJHNlYXJjaFNlcnZpY2VBY2NvdW50LlVzZXJuYW1lKSkgLWFuZCAhKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRzZWNTZWFyY2hTZXJ2aWNlUGFzc3dvcmQpKSkKICAgICAgICB7CiAgICAgICAgICAgICMgVXNlIHRoZSB2YWx1ZXMgZm9yIFNlYXJjaCBTZXJ2aWNlIGFjY291bnQgYW5kIHBhc3N3b3JkLCBpZiB0aGV5J3ZlIGJlZW4gZGVmaW5lZAogICAgICAgICAgICAkdXNlcm5hbWUgPSAkc2VhcmNoU2VydmljZUFjY291bnQuVXNlcm5hbWUKICAgICAgICAgICAgJHBhc3N3b3JkID0gJHNlY1NlYXJjaFNlcnZpY2VQYXNzd29yZAogICAgICAgIH0KICAgICAgICBFbHNlCiAgICAgICAgewogICAgICAgICAgICAkc3BzZXJ2aWNlID0gR2V0LVNQTWFuYWdlZEFjY291bnRYTUwgJHhtbGlucHV0IC1Db21tb25OYW1lICJzcHNlcnZpY2UiCiAgICAgICAgICAgICR1c2VybmFtZSA9ICRzcHNlcnZpY2UudXNlcm5hbWUKICAgICAgICAgICAgJHBhc3N3b3JkID0gQ29udmVydFRvLVNlY3VyZVN0cmluZyAiJCgkc3BzZXJ2aWNlLnBhc3N3b3JkKSIgLUFzUGxhaW50ZXh0IC1Gb3JjZQogICAgICAgIH0KICAgICAgICBsb2cgIiAtIEFwcGx5aW5nIHNlcnZpY2UgYWNjb3VudCAkdXNlcm5hbWUgdG8gU2VhcmNoIFNlcnZpY2UuLi4iCiAgICAgICAgR2V0LVNQRW50ZXJwcmlzZVNlYXJjaFNlcnZpY2UgfCBTZXQtU1BFbnRlcnByaXNlU2VhcmNoU2VydmljZSAtU2VydmljZUFjY291bnQgJHVzZXJuYW1lIC1TZXJ2aWNlUGFzc3dvcmQgJHBhc3N3b3JkCiAgICAgICAgSWYgKCEkPykge1dyaXRlLUVycm9yICIgLSBBbiBlcnJvciBvY2N1cnJlZCBzZXR0aW5nIHRoZSBTZWFyY2ggU2VydmljZSBhY2NvdW50ISJ9CiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cn0KCmZ1bmN0aW9uIFVwZGF0ZS1TZWFyY2hDb250ZW50QWNjZXNzQWNjb3VudCAoJHNhTmFtZSwgJHNhLCAkY2FhLCAkY2FhcHdkKQp7CiAgICB0cnkKICAgIHsKICAgICAgICBsb2cgIiAgLSBTZXR0aW5nIGNvbnRlbnQgYWNjZXNzIGFjY291bnQgZm9yICRzYU5hbWUuLi4iCiAgICAgICAgJHNhIHwgU2V0LVNQRW50ZXJwcmlzZVNlYXJjaFNlcnZpY2VBcHBsaWNhdGlvbiAtRGVmYXVsdENvbnRlbnRBY2Nlc3NBY2NvdW50TmFtZSAkY2FhIC1EZWZhdWx0Q29udGVudEFjY2Vzc0FjY291bnRQYXNzd29yZCAkY2FhcHdkIC1FcnJvclZhcmlhYmxlIGVycgogICAgfQogICAgY2F0Y2gKICAgIHsKICAgICAgICBpZiAoJGVyciAtbGlrZSAiKnVwZGF0ZSBjb25mbGljdCoiKQogICAgICAgIHsKICAgICAgICAgICAgbG9nICJXQVJOSU5HOkFuIHVwZGF0ZSBjb25mbGljdCBlcnJvciBvY2N1cmVkLCB0cnlpbmcgYWdhaW4uIgogICAgICAgICAgICBVcGRhdGUtU2VhcmNoQ29udGVudEFjY2Vzc0FjY291bnQgJHNhTmFtZSwgJHNhLCAkY2FhLCAkY2FhcHdkCiAgICAgICAgICAgICRzYSB8IFNldC1TUEVudGVycHJpc2VTZWFyY2hTZXJ2aWNlQXBwbGljYXRpb24gLURlZmF1bHRDb250ZW50QWNjZXNzQWNjb3VudE5hbWUgJGNhYSAtRGVmYXVsdENvbnRlbnRBY2Nlc3NBY2NvdW50UGFzc3dvcmQgJGNhYXB3ZCAtRXJyb3JWYXJpYWJsZSBlcnIKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdGhyb3cgJF8KICAgICAgICB9CiAgICB9CiAgICBmaW5hbGx5IHtDbGVhci1WYXJpYWJsZSBlcnJ9Cn0KCmZ1bmN0aW9uIFNldC1Qcm94eUdyb3Vwc01lbWJlcnNoaXAoW1N5c3RlbS5YbWwuWG1sRWxlbWVudFtdXSRncm91cHMsIFtNaWNyb3NvZnQuU2hhcmVQb2ludC5BZG1pbmlzdHJhdGlvbi5TUFNlcnZpY2VBcHBsaWNhdGlvblByb3h5W11dJGlucHV0T2JqZWN0KQp7CiAgICBiZWdpbiB7fQogICAgcHJvY2VzcyB7CiAgICAgICAgJHByb3h5ID0gJF8KICAgICAgICAjIENsZWFyIGFueSBleGlzdGluZyBwcm94eSBncm91cCBhc3NpZ25tZW50cwogICAgICAgIEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvblByb3h5R3JvdXAgfCB3aGVyZSB7JF8uUHJveGllcyAtY29udGFpbnMgJHByb3h5fSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgJHByb3h5R3JvdXBOYW1lID0gJF8uTmFtZQogICAgICAgICAgICBJZiAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJHByb3h5R3JvdXBOYW1lKSkgeyAkcHJveHlHcm91cE5hbWUgPSAiRGVmYXVsdCIgfQogICAgICAgICAgICAkZ3JvdXAgPSAkbnVsbAogICAgICAgICAgICBbYm9vbF0kbWF0Y2hGb3VuZCA9ICRmYWxzZQogICAgICAgICAgICBGb3JFYWNoICgkZyBpbiAkZ3JvdXBzKSB7CiAgICAgICAgICAgICAgICAkZ3JvdXAgPSAkZy5Qcm94eUdyb3VwCiAgICAgICAgICAgICAgICBJZiAoJGdyb3VwIC1lcSAkcHJveHlHcm91cE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAkbWF0Y2hGb3VuZCA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBJZiAoISRtYXRjaEZvdW5kKSB7CiAgICAgICAgICAgICAgICBsb2cgIiAtIFJlbW92aW5nICIiJCgkcHJveHkuRGlzcGxheU5hbWUpIiIgZnJvbSAiIiRwcm94eUdyb3VwTmFtZSIiIgogICAgICAgICAgICAgICAgJF8gfCBSZW1vdmUtU1BTZXJ2aWNlQXBwbGljYXRpb25Qcm94eUdyb3VwTWVtYmVyIC1NZW1iZXIgJHByb3h5IC1Db25maXJtOiRmYWxzZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEZvckVhY2ggKCRnIGluICRncm91cHMpIHsKICAgICAgICAgICAgJGdyb3VwID0gJGcuUHJveHlHcm91cAogICAgICAgICAgICAkcGcgPSAkbnVsbAogICAgICAgICAgICBJZiAoJGdyb3VwIC1lcSAiRGVmYXVsdCIgLW9yIFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRncm91cCkpIHsKICAgICAgICAgICAgICAgICRwZyA9IFtNaWNyb3NvZnQuU2hhcmVQb2ludC5BZG1pbmlzdHJhdGlvbi5TUFNlcnZpY2VBcHBsaWNhdGlvblByb3h5R3JvdXBdOjpEZWZhdWx0CiAgICAgICAgICAgIH0gRWxzZSB7CiAgICAgICAgICAgICAgICAkcGcgPSBHZXQtU1BTZXJ2aWNlQXBwbGljYXRpb25Qcm94eUdyb3VwICRncm91cCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSAtRXJyb3JWYXJpYWJsZSBlcnIKICAgICAgICAgICAgICAgIElmICgkcGcgLWVxICRudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgJHBnID0gTmV3LVNQU2VydmljZUFwcGxpY2F0aW9uUHJveHlHcm91cCAtTmFtZSAkbmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICRwZyA9ICRwZyB8IHdoZXJlIHskXy5Qcm94aWVzIC1ub3Rjb250YWlucyAkcHJveHl9CiAgICAgICAgICAgIElmICgkcGcgLW5lICRudWxsKSB7CiAgICAgICAgICAgICAgICBsb2cgIiAtIEFkZGluZyAiIiQoJHByb3h5LkRpc3BsYXlOYW1lKSIiIHRvICIiJCgkcGcuRGlzcGxheU5hbWUpIiIiCiAgICAgICAgICAgICAgICAkcGcgfCBBZGQtU1BTZXJ2aWNlQXBwbGljYXRpb25Qcm94eUdyb3VwTWVtYmVyIC1NZW1iZXIgJHByb3h5IHwgT3V0LU51bGwKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGVuZCB7fQp9CgpGdW5jdGlvbiBHZXQtQXBwbGljYXRpb25Qb29sKFtTeXN0ZW0uWG1sLlhtbEVsZW1lbnRdJGFwcFBvb2xDb25maWcpIHsKICAgICMgVHJ5IGFuZCBnZXQgdGhlIGFwcGxpY2F0aW9uIHBvb2wgaWYgaXQgYWxyZWFkeSBleGlzdHMKICAgICMgU0xOOiBVcGRhdGVkIG5hbWVzCiAgICAkcG9vbCA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvblBvb2wgLUlkZW50aXR5ICRhcHBQb29sQ29uZmlnLk5hbWUgLUVycm9yVmFyaWFibGUgZXJyIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICBJZiAoJGVycikgewogICAgICAgICMgVGhlIGFwcGxpY2F0aW9uIHBvb2wgZG9lcyBub3QgZXhpc3Qgc28gY3JlYXRlLgogICAgICAgIGxvZyAiICAtIEdldHRpbmcgJCgkc2VhcmNoU2VydmljZUFjY291bnQuVXNlcm5hbWUpIGFjY291bnQgZm9yIGFwcGxpY2F0aW9uIHBvb2wuLi4iCiAgICAgICAgJG1hbmFnZWRBY2NvdW50U2VhcmNoID0gKEdldC1TUE1hbmFnZWRBY2NvdW50IC1JZGVudGl0eSAkc2VhcmNoU2VydmljZUFjY291bnQuVXNlcm5hbWUgLUVycm9yVmFyaWFibGUgZXJyIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKQogICAgICAgIElmICgkZXJyKSB7CiAgICAgICAgICAgIElmICghKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRzZWFyY2hTZXJ2aWNlQWNjb3VudC5QYXNzd29yZCkpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkYXBwUG9vbENvbmZpZ1BXRCA9IChDb252ZXJ0VG8tU2VjdXJlU3RyaW5nICRzZWFyY2hTZXJ2aWNlQWNjb3VudC5QYXNzd29yZCAtQXNQbGFpblRleHQgLWZvcmNlKQogICAgICAgICAgICAgICAgJGFjY291bnRDcmVkID0gTmV3LU9iamVjdCBTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBzQ3JlZGVudGlhbCAkc2VhcmNoU2VydmljZUFjY291bnQuVXNlcm5hbWUsJGFwcFBvb2xDb25maWdQV0QKICAgICAgICAgICAgfQogICAgICAgICAgICBFbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRhY2NvdW50Q3JlZCA9IEdldC1DcmVkZW50aWFsICRzZWFyY2hTZXJ2aWNlQWNjb3VudC5Vc2VybmFtZQogICAgICAgICAgICB9CiAgICAgICAgICAgICRtYW5hZ2VkQWNjb3VudFNlYXJjaCA9IE5ldy1TUE1hbmFnZWRBY2NvdW50IC1DcmVkZW50aWFsICRhY2NvdW50Q3JlZAogICAgICAgIH0KICAgICAgICBsb2cgIiAgLSBDcmVhdGluZyAkKCRhcHBQb29sQ29uZmlnLk5hbWUpLi4uIgogICAgICAgICRwb29sID0gTmV3LVNQU2VydmljZUFwcGxpY2F0aW9uUG9vbCAtTmFtZSAkKCRhcHBQb29sQ29uZmlnLk5hbWUpIC1BY2NvdW50ICRtYW5hZ2VkQWNjb3VudFNlYXJjaAogICAgfQogICAgUmV0dXJuICRwb29sCn0KCiNFbmRSZWdpb24KCiNSZWdpb24gQ3JlYXRlIEJ1c2luZXNzIERhdGEgQ2F0YWxvZyBTZXJ2aWNlIEFwcGxpY2F0aW9uCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBDcmVhdGVCdXNpbmVzc0RhdGFDb25uZWN0aXZpdHlTZXJ2aWNlQXBwCiMgRGVzYzogQnVzaW5lc3MgRGF0YSBDYXRhbG9nIFNlcnZpY2UgQXBwbGljYXRpb24KIyBGcm9tOiBodHRwOi8vYXV0b3NwaW5zdGFsbGVyLmNvZGVwbGV4LmNvbS9kaXNjdXNzaW9ucy8yNDY1MzIgKHVzZXIgYnVuYnVuYXopCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gQ3JlYXRlQnVzaW5lc3NEYXRhQ29ubmVjdGl2aXR5U2VydmljZUFwcChbeG1sXSR4bWxpbnB1dCkKewogICAgSWYgKChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLkJ1c2luZXNzRGF0YUNvbm5lY3Rpdml0eSAtZXEgJHRydWUpIC1hbmQgKEdldC1Db21tYW5kIC1OYW1lIE5ldy1TUEJ1c2luZXNzRGF0YUNhdGFsb2dTZXJ2aWNlQXBwbGljYXRpb24gLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpKQogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgIFRyeQogICAgICAgIHsKICAgICAgICAgICAgJGRiU2VydmVyID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuQnVzaW5lc3NEYXRhQ29ubmVjdGl2aXR5LkRhdGFiYXNlLkRCU2VydmVyCiAgICAgICAgICAgICMgSWYgd2UgaGF2ZW4ndCBzcGVjaWZpZWQgYSBEQiBTZXJ2ZXIgdGhlbiBqdXN0IHVzZSB0aGUgZGVmYXVsdCB1c2VkIGJ5IHRoZSBGYXJtCiAgICAgICAgICAgIElmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkZGJTZXJ2ZXIpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkZGJTZXJ2ZXIgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkRhdGFiYXNlLkRCU2VydmVyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGJkY0FwcE5hbWUgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5CdXNpbmVzc0RhdGFDb25uZWN0aXZpdHkuTmFtZQogICAgICAgICAgICAkZGJQcmVmaXggPSBHZXQtREJQcmVmaXggJHhtbGlucHV0CiAgICAgICAgICAgICRiZGNEYXRhREIgPSAkZGJQcmVmaXgrJCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5CdXNpbmVzc0RhdGFDb25uZWN0aXZpdHkuRGF0YWJhc2UuTmFtZSkKICAgICAgICAgICAgJGJkY0FwcFByb3h5TmFtZSA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLkJ1c2luZXNzRGF0YUNvbm5lY3Rpdml0eS5Qcm94eU5hbWUKICAgICAgICAgICAgbG9nICIgLSBQcm92aXNpb25pbmcgJGJkY0FwcE5hbWUiCiAgICAgICAgICAgICRhcHBsaWNhdGlvblBvb2wgPSBHZXQtSG9zdGVkU2VydmljZXNBcHBQb29sICR4bWxpbnB1dAogICAgICAgICAgICBsb2cgIiAtIENoZWNraW5nIGxvY2FsIHNlcnZpY2UgaW5zdGFuY2UuLi4iCiAgICAgICAgICAgICMgR2V0IHRoZSBzZXJ2aWNlIGluc3RhbmNlCiAgICAgICAgICAgICRiZGNTZXJ2aWNlSW5zdGFuY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuU2hhcmVQb2ludC5CdXNpbmVzc0RhdGEuU2hhcmVkU2VydmljZS5CZGNTZXJ2aWNlSW5zdGFuY2UifQogICAgICAgICAgICAkYmRjU2VydmljZUluc3RhbmNlID0gJGJkY1NlcnZpY2VJbnN0YW5jZXMgfCA/IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXIuQWRkcmVzcyAkZW52OkNPTVBVVEVSTkFNRX0KICAgICAgICAgICAgSWYgKC1ub3QgJD8pIHsgVGhyb3cgIiAtIEZhaWxlZCB0byBmaW5kIHRoZSBzZXJ2aWNlIGluc3RhbmNlIiB9CiAgICAgICAgICAgICMgU3RhcnQgU2VydmljZSBpbnN0YW5jZXMKICAgICAgICAgICAgSWYoJGJkY1NlcnZpY2VJbnN0YW5jZS5TdGF0dXMgLWVxICJEaXNhYmxlZCIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiIC0gU3RhcnRpbmcgJCgkYmRjU2VydmljZUluc3RhbmNlLlR5cGVOYW1lKS4uLiIKICAgICAgICAgICAgICAgICRiZGNTZXJ2aWNlSW5zdGFuY2UuUHJvdmlzaW9uKCkKICAgICAgICAgICAgICAgIElmICgtbm90ICQ/KSB7IFRocm93ICIgLSBGYWlsZWQgdG8gc3RhcnQgJCgkYmRjU2VydmljZUluc3RhbmNlLlR5cGVOYW1lKSIgfQogICAgICAgICAgICAgICAgIyBXYWl0CiAgICAgICAgICAgICAgICBsb2cgIiAtIFdhaXRpbmcgZm9yICQoJGJkY1NlcnZpY2VJbnN0YW5jZS5UeXBlTmFtZSkuLi4iIAogICAgICAgICAgICAgICAgV2hpbGUgKCRiZGNTZXJ2aWNlSW5zdGFuY2UuU3RhdHVzIC1uZSAiT25saW5lIikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIi4iIAogICAgICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIDEKICAgICAgICAgICAgICAgICAgICAkYmRjU2VydmljZUluc3RhbmNlcyA9IEdldC1TUFNlcnZpY2VJbnN0YW5jZSB8ID8geyRfLkdldFR5cGUoKS5Ub1N0cmluZygpIC1lcSAiTWljcm9zb2Z0LlNoYXJlUG9pbnQuQnVzaW5lc3NEYXRhLlNoYXJlZFNlcnZpY2UuQmRjU2VydmljZUluc3RhbmNlIn0KICAgICAgICAgICAgICAgICAgICAkYmRjU2VydmljZUluc3RhbmNlID0gJGJkY1NlcnZpY2VJbnN0YW5jZXMgfCA/IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXIuQWRkcmVzcyAkZW52OkNPTVBVVEVSTkFNRX0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxvZyAoJGJkY1NlcnZpY2VJbnN0YW5jZS5TdGF0dXMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgRWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAtICQoJGJkY1NlcnZpY2VJbnN0YW5jZS5UeXBlTmFtZSkgYWxyZWFkeSBzdGFydGVkLiIKICAgICAgICAgICAgfQogICAgICAgICAgICAjIENyZWF0ZSBhIEJ1c2luZXNzIERhdGEgQ2F0YWxvZyBTZXJ2aWNlIEFwcGxpY2F0aW9uCiAgICAgICAgICAgIElmICgoR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuU2hhcmVQb2ludC5CdXNpbmVzc0RhdGEuU2hhcmVkU2VydmljZS5CZGNTZXJ2aWNlQXBwbGljYXRpb24ifSkgLWVxICRudWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIENyZWF0ZSBTZXJ2aWNlIEFwcAogICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyAkYmRjQXBwTmFtZS4uLiIKICAgICAgICAgICAgICAgICRiZGNEYXRhU2VydmljZUFwcCA9IE5ldy1TUEJ1c2luZXNzRGF0YUNhdGFsb2dTZXJ2aWNlQXBwbGljYXRpb24gLU5hbWUgJGJkY0FwcE5hbWUgLUFwcGxpY2F0aW9uUG9vbCAkYXBwbGljYXRpb25Qb29sIC1EYXRhYmFzZVNlcnZlciAkZGJTZXJ2ZXIgLURhdGFiYXNlTmFtZSAkYmRjRGF0YURCCiAgICAgICAgICAgICAgICBJZiAoLW5vdCAkPykgeyBUaHJvdyAiIC0gRmFpbGVkIHRvIGNyZWF0ZSAkYmRjQXBwTmFtZSIgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIEVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgLSAkYmRjQXBwTmFtZSBhbHJlYWR5IHByb3Zpc2lvbmVkLiIKICAgICAgICAgICAgfQogICAgICAgICAgICBsb2cgIiAtIERvbmUgY3JlYXRpbmcgJGJkY0FwcE5hbWUuIgogICAgICAgIH0KICAgICAgICBDYXRjaAogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICRfCiAgICAgICAgICAgIFRocm93ICIgLSBFcnJvciBwcm92aXNpb25pbmcgQnVzaW5lc3MgRGF0YSBDb25uZWN0aXZpdHkgYXBwbGljYXRpb24iCiAgICAgICAgfQogICAgICAgIFdyaXRlTGluZQogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ3JlYXRlIFdvcmQgQXV0b21hdGlvbiBTZXJ2aWNlCkZ1bmN0aW9uIENyZWF0ZVdvcmRBdXRvbWF0aW9uU2VydmljZUFwcCAoW3htbF0keG1saW5wdXQpCnsKICAgICRzZXJ2aWNlQ29uZmlnID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuV29yZEF1dG9tYXRpb25TZXJ2aWNlCiAgICAkZGJTZXJ2ZXIgPSAkc2VydmljZUNvbmZpZy5EYXRhYmFzZS5EQlNlcnZlcgogICAgIyBJZiB3ZSBoYXZlbid0IHNwZWNpZmllZCBhIERCIFNlcnZlciB0aGVuIGp1c3QgdXNlIHRoZSBkZWZhdWx0IHVzZWQgYnkgdGhlIEZhcm0KICAgIElmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkZGJTZXJ2ZXIpKQogICAgewogICAgICAgICRkYlNlcnZlciA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uRGF0YWJhc2UuREJTZXJ2ZXIKICAgIH0KICAgICRkYlByZWZpeCA9IEdldC1EQlByZWZpeCAkeG1saW5wdXQKICAgICRzZXJ2aWNlREIgPSAkZGJQcmVmaXgrJCgkc2VydmljZUNvbmZpZy5EYXRhYmFzZS5OYW1lKQogICAgSWYgKChTaG91bGRJUHJvdmlzaW9uICRzZXJ2aWNlQ29uZmlnIC1lcSAkdHJ1ZSkgLWFuZCAoR2V0LUNvbW1hbmQgLU5hbWUgTmV3LVNQV29yZENvbnZlcnNpb25TZXJ2aWNlQXBwbGljYXRpb24gLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpKQogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgICRzZXJ2aWNlSW5zdGFuY2VUeXBlID0gIk1pY3Jvc29mdC5PZmZpY2UuV29yZC5TZXJ2ZXIuU2VydmljZS5Xb3JkU2VydmljZUluc3RhbmNlIgogICAgICAgIENyZWF0ZUdlbmVyaWNTZXJ2aWNlQXBwbGljYXRpb24gLVNlcnZpY2VDb25maWcgJHNlcnZpY2VDb25maWcgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VJbnN0YW5jZVR5cGUgJHNlcnZpY2VJbnN0YW5jZVR5cGUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VOYW1lICRzZXJ2aWNlQ29uZmlnLk5hbWUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VQcm94eU5hbWUgJHNlcnZpY2VDb25maWcuUHJveHlOYW1lIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlR2V0Q21kbGV0ICJHZXQtU1BTZXJ2aWNlQXBwbGljYXRpb24iIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlHZXRDbWRsZXQgIkdldC1TUFNlcnZpY2VBcHBsaWNhdGlvblByb3h5IiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZU5ld0NtZGxldCAiTmV3LVNQV29yZENvbnZlcnNpb25TZXJ2aWNlQXBwbGljYXRpb24gLURhdGFiYXNlU2VydmVyICRkYlNlcnZlciAtRGF0YWJhc2VOYW1lICRzZXJ2aWNlREIgLURlZmF1bHQiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlOZXdDbWRsZXQgIk5ldy1TUFdvcmRDb252ZXJzaW9uU2VydmljZUFwcGxpY2F0aW9uUHJveHkiICMgRmFrZSBjbWRsZXQsIGJ1dCB0aGUgQ3JlYXRlR2VuZXJpY1NlcnZpY2VBcHBsaWNhdGlvbiBmdW5jdGlvbiBleHBlY3RzIHNvbWV0aGluZwogICAgICAgICMgUnVuIHRoZSBXb3JkIEF1dG9tYXRpb24gVGltZXIgSm9iIGltbWVkaWF0ZWx5OyBvdGhlcndpc2Ugd2Ugd2lsbCBoYXZlIGEgSGVhbHRoIEFuYWx5emVyIGVycm9yIGNvbmRpdGlvbiB1bnRpbCB0aGUgam9iIHJ1bnMgYXMgc2NoZWR1bGVkCiAgICAgICAgSWYgKEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8ID8geyRfLkRpc3BsYXlOYW1lIC1lcSAkKCRzZXJ2aWNlQ29uZmlnLk5hbWUpfSkKICAgICAgICB7CiAgICAgICAgICAgIEdldC1TUFRpbWVySm9iIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLldvcmQuU2VydmVyLlNlcnZpY2UuUXVldWVKb2IifSB8IEZvckVhY2gtT2JqZWN0IHskXy5SdW5Ob3coKX0KICAgICAgICB9CiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBFbnRlcnByaXNlIFNlcnZpY2UgQXBwcwoKI1JlZ2lvbiBDcmVhdGUgRXhjZWwgU2VydmljZQpGdW5jdGlvbiBDcmVhdGVFeGNlbFNlcnZpY2VBcHAgKFt4bWxdJHhtbGlucHV0KQp7CiAgICAkb2ZmaWNlU2VydmVyUHJlbWl1bSA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkluc3RhbGwuU0tVIC1yZXBsYWNlICJFbnRlcnByaXNlIiwiMSIgLXJlcGxhY2UgIlN0YW5kYXJkIiwiMCIKICAgIElmICgoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuRXhjZWxTZXJ2aWNlcyAtZXEgJHRydWUpIC1hbmQgKCRlbnY6U1BWZXIgLWxlICIxNSIpKQogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgIGlmICgkb2ZmaWNlU2VydmVyUHJlbWl1bSAtZXEgIjEiKQogICAgICAgIHsKICAgICAgICAgICAgVHJ5CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRleGNlbEFwcE5hbWUgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuRXhjZWxTZXJ2aWNlcy5OYW1lCiAgICAgICAgICAgICAgICAkcG9ydGFsV2ViQXBwID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uV2ViQXBwbGljYXRpb25zLldlYkFwcGxpY2F0aW9uIHwgV2hlcmUgeyRfLlR5cGUgLWVxICJQb3J0YWwifSB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEKICAgICAgICAgICAgICAgICRwb3J0YWxVUkwgPSAoJHBvcnRhbFdlYkFwcC5VUkwpLlRyaW1FbmQoIi8iKQogICAgICAgICAgICAgICAgJHBvcnRhbFBvcnQgPSAkcG9ydGFsV2ViQXBwLlBvcnQKICAgICAgICAgICAgICAgIGxvZyAiIC0gUHJvdmlzaW9uaW5nICRleGNlbEFwcE5hbWUuLi4iCiAgICAgICAgICAgICAgICAkYXBwbGljYXRpb25Qb29sID0gR2V0LUhvc3RlZFNlcnZpY2VzQXBwUG9vbCAkeG1saW5wdXQKICAgICAgICAgICAgICAgIGxvZyAiIC0gQ2hlY2tpbmcgbG9jYWwgc2VydmljZSBpbnN0YW5jZS4uLiIKICAgICAgICAgICAgICAgICMgR2V0IHRoZSBzZXJ2aWNlIGluc3RhbmNlCiAgICAgICAgICAgICAgICAkZXhjZWxTZXJ2aWNlSW5zdGFuY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLkV4Y2VsLlNlcnZlci5Nb3NzSG9zdC5FeGNlbFNlcnZlcldlYlNlcnZpY2VJbnN0YW5jZSJ9CiAgICAgICAgICAgICAgICAkZXhjZWxTZXJ2aWNlSW5zdGFuY2UgPSAkZXhjZWxTZXJ2aWNlSW5zdGFuY2VzIHwgPyB7TWF0Y2hDb21wdXRlck5hbWUgJF8uU2VydmVyLkFkZHJlc3MgJGVudjpDT01QVVRFUk5BTUV9CiAgICAgICAgICAgICAgICBJZiAoLW5vdCAkPykgeyBUaHJvdyAiIC0gRmFpbGVkIHRvIGZpbmQgdGhlIHNlcnZpY2UgaW5zdGFuY2UiIH0KICAgICAgICAgICAgICAgICMgU3RhcnQgU2VydmljZSBpbnN0YW5jZXMKICAgICAgICAgICAgICAgIElmKCRleGNlbFNlcnZpY2VJbnN0YW5jZS5TdGF0dXMgLWVxICJEaXNhYmxlZCIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBTdGFydGluZyAkKCRleGNlbFNlcnZpY2VJbnN0YW5jZS5UeXBlTmFtZSkuLi4iCiAgICAgICAgICAgICAgICAgICAgJGV4Y2VsU2VydmljZUluc3RhbmNlLlByb3Zpc2lvbigpCiAgICAgICAgICAgICAgICAgICAgSWYgKC1ub3QgJD8pIHsgVGhyb3cgIiAtIEZhaWxlZCB0byBzdGFydCAkKCRleGNlbFNlcnZpY2VJbnN0YW5jZS5UeXBlTmFtZSkgaW5zdGFuY2UiIH0KICAgICAgICAgICAgICAgICAgICAjIFdhaXQKICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFdhaXRpbmcgZm9yICQoJGV4Y2VsU2VydmljZUluc3RhbmNlLlR5cGVOYW1lKS4uLiIgCiAgICAgICAgICAgICAgICAgICAgV2hpbGUgKCRleGNlbFNlcnZpY2VJbnN0YW5jZS5TdGF0dXMgLW5lICJPbmxpbmUiKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIuIiAKICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgMQogICAgICAgICAgICAgICAgICAgICAgICAkZXhjZWxTZXJ2aWNlSW5zdGFuY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLkV4Y2VsLlNlcnZlci5Nb3NzSG9zdC5FeGNlbFNlcnZlcldlYlNlcnZpY2VJbnN0YW5jZSJ9CiAgICAgICAgICAgICAgICAgICAgICAgICRleGNlbFNlcnZpY2VJbnN0YW5jZSA9ICRleGNlbFNlcnZpY2VJbnN0YW5jZXMgfCA/IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXIuQWRkcmVzcyAkZW52OkNPTVBVVEVSTkFNRX0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbG9nICgkZXhjZWxTZXJ2aWNlSW5zdGFuY2UuU3RhdHVzKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgRWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gJCgkZXhjZWxTZXJ2aWNlSW5zdGFuY2UuVHlwZU5hbWUpIGFscmVhZHkgc3RhcnRlZC4iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAjIENyZWF0ZSBhbiBFeGNlbCBTZXJ2aWNlIEFwcGxpY2F0aW9uCiAgICAgICAgICAgICAgICBJZiAoKEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8ID8geyRfLkdldFR5cGUoKS5Ub1N0cmluZygpIC1lcSAiTWljcm9zb2Z0Lk9mZmljZS5FeGNlbC5TZXJ2ZXIuTW9zc0hvc3QuRXhjZWxTZXJ2ZXJXZWJTZXJ2aWNlQXBwbGljYXRpb24ifSkgLWVxICRudWxsKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICMgQ3JlYXRlIFNlcnZpY2UgQXBwCiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyAkZXhjZWxBcHBOYW1lLi4uIgogICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgb3VyIG5ldyBjbWRsZXRzIGFyZSBhdmFpbGFibGUgeWV0LCAgaWYgbm90LCByZS1sb2FkIHRoZSBTaGFyZVBvaW50IFBTIFNuYXBpbgogICAgICAgICAgICAgICAgICAgIElmICghKEdldC1Db21tYW5kIE5ldy1TUEV4Y2VsU2VydmljZUFwcGxpY2F0aW9uIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gUmUtaW1wb3J0aW5nIFNQIFBvd2VyU2hlbGwgU25hcGluIHRvIGVuYWJsZSBuZXcgY21kbGV0cy4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgUmVtb3ZlLVBTU25hcGluIE1pY3Jvc29mdC5TaGFyZVBvaW50LlBvd2VyU2hlbGwKICAgICAgICAgICAgICAgICAgICAgICAgTG9hZC1TaGFyZVBvaW50LVBvd2VyU2hlbGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGV4Y2VsU2VydmljZUFwcCA9IE5ldy1TUEV4Y2VsU2VydmljZUFwcGxpY2F0aW9uIC1uYW1lICRleGNlbEFwcE5hbWUgLUFwcGxpY2F0aW9uUG9vbCAkKCRhcHBsaWNhdGlvblBvb2wuTmFtZSkgLURlZmF1bHQKICAgICAgICAgICAgICAgICAgICBJZiAoLW5vdCAkPykgeyBUaHJvdyAiIC0gRmFpbGVkIHRvIGNyZWF0ZSAkZXhjZWxBcHBOYW1lIiB9CiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBDb25maWd1cmluZyBzZXJ2aWNlIGFwcCBzZXR0aW5ncy4uLiIKICAgICAgICAgICAgICAgICAgICBTZXQtU1BFeGNlbEZpbGVMb2NhdGlvbiAtSWRlbnRpdHkgImh0dHA6Ly8iIC1Mb2NhdGlvblR5cGUgU2hhcmVQb2ludCAtSW5jbHVkZUNoaWxkcmVuIC1BZGRyZXNzICRwb3J0YWxVUkxgOiRwb3J0YWxQb3J0IC1FeGNlbFNlcnZpY2VBcHBsaWNhdGlvbiAkZXhjZWxBcHBOYW1lIC1FeHRlcm5hbERhdGFBbGxvd2VkIDIgLVdvcmtib29rU2l6ZU1heCAxMCB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICAgICAgJGNhVXJsID0gKEdldC1JdGVtIC1QYXRoICJIS0xNOlxTT0ZUV0FSRVxNaWNyb3NvZnRcU2hhcmVkIFRvb2xzXFdlYiBTZXJ2ZXIgRXh0ZW5zaW9uc1wkZW52OnNwVmVyLjBcV1NTIikuR2V0VmFsdWUoIkNlbnRyYWxBZG1pbmlzdHJhdGlvblVSTCIpCiAgICAgICAgICAgICAgICAgICAgTmV3LVNQRXhjZWxGaWxlTG9jYXRpb24gLUxvY2F0aW9uVHlwZSBTaGFyZVBvaW50IC1JbmNsdWRlQ2hpbGRyZW4gLUFkZHJlc3MgJGNhVXJsIC1FeGNlbFNlcnZpY2VBcHBsaWNhdGlvbiAkZXhjZWxBcHBOYW1lIC1FeHRlcm5hbERhdGFBbGxvd2VkIDIgLVdvcmtib29rU2l6ZU1heCAxMCB8IE91dC1OdWxsCgogICAgICAgICAgICAgICAgICAgICMgQ29uZmlndXJlIHVuYXR0ZW5kZWQgYWNjb3VudHMsIGJhc2VkIG9uOgogICAgICAgICAgICAgICAgICAgICMgaHR0cDovL2Jsb2cuZmFsY2hpb25jb25zdWx0aW5nLmNvbS9pbmRleC5waHAvMjAxMC8xMC9zZXJ2aWNlLWFjY291bnRzLWFuZC1tYW5hZ2VkLXNlcnZpY2UtYWNjb3VudHMtaW4tc2hhcmVwb2ludC0yMDEwLwogICAgICAgICAgICAgICAgICAgIElmICgoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLkV4Y2VsU2VydmljZXMuVW5hdHRlbmRlZElEVXNlcikgLWFuZCAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLkV4Y2VsU2VydmljZXMuVW5hdHRlbmRlZElEUGFzc3dvcmQpKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBTZXR0aW5nIHVuYXR0ZW5kZWQgYWNjb3VudCBjcmVkZW50aWFscy4uLiIKCiAgICAgICAgICAgICAgICAgICAgICAgICMgUmVnZXQgYXBwbGljYXRpb24gdG8gcHJldmVudCB1cGRhdGUgY29uZmxpY3QgZXJyb3IgbWVzc2FnZQogICAgICAgICAgICAgICAgICAgICAgICAkZXhjZWxTZXJ2aWNlQXBwID0gR2V0LVNQRXhjZWxTZXJ2aWNlQXBwbGljYXRpb24KCiAgICAgICAgICAgICAgICAgICAgICAgICMgR2V0IGFjY291bnQgY3JlZGVudGlhbHMKICAgICAgICAgICAgICAgICAgICAgICAgJGV4Y2VsQWNjdCA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5FeGNlbFNlcnZpY2VzLlVuYXR0ZW5kZWRJRFVzZXIKICAgICAgICAgICAgICAgICAgICAgICAgJGV4Y2VsQWNjdFBXRCA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5FeGNlbFNlcnZpY2VzLlVuYXR0ZW5kZWRJRFBhc3N3b3JkCiAgICAgICAgICAgICAgICAgICAgICAgIElmICghKCRleGNlbEFjY3QpIC1vciAkZXhjZWxBY2N0IC1lcSAiIiAtb3IgISgkZXhjZWxBY2N0UFdEKSAtb3IgJGV4Y2VsQWNjdFBXRCAtZXEgIiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gUHJvbXB0aW5nIGZvciBFeGNlbCBVbmF0dGVuZGVkIEFjY291bnQ6IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVuYXR0ZW5kZWRBY2NvdW50ID0gJGhvc3QudWkuUHJvbXB0Rm9yQ3JlZGVudGlhbCgiRXhjZWwgU2V0dXAiLCAiRW50ZXIgRXhjZWwgVW5hdHRlbmRlZCBBY2NvdW50IENyZWRlbnRpYWxzOiIsICIkZXhjZWxBY2N0IiwgIk5ldEJpb3NVc2VyTmFtZSIgKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIEVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNlY1Bhc3N3b3JkID0gQ29udmVydFRvLVNlY3VyZVN0cmluZyAiJGV4Y2VsQWNjdFBXRCIgLUFzUGxhaW50ZXh0IC1Gb3JjZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVuYXR0ZW5kZWRBY2NvdW50ID0gTmV3LU9iamVjdCBTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBzQ3JlZGVudGlhbCAkZXhjZWxBY2N0LCRzZWNQYXNzd29yZAogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAjIFNldCB0aGUgZ3JvdXAgY2xhaW0gYW5kIGFkbWluIHByaW5jaXBhbHMKICAgICAgICAgICAgICAgICAgICAgICAgJGdyb3VwQ2xhaW0gPSBOZXctU1BDbGFpbXNQcmluY2lwYWwgLUlkZW50aXR5ICJudCBhdXRob3JpdHlcYXV0aGVudGljYXRlZCB1c2VycyIgLUlkZW50aXR5VHlwZSBXaW5kb3dzU2FtQWNjb3VudE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJGFkbWluUHJpbmNpcGFsID0gTmV3LVNQQ2xhaW1zUHJpbmNpcGFsIC1JZGVudGl0eSAiJCgkZW52OnVzZXJkb21haW4pXCQoJGVudjp1c2VybmFtZSkiIC1JZGVudGl0eVR5cGUgV2luZG93c1NhbUFjY291bnROYW1lCgogICAgICAgICAgICAgICAgICAgICAgICAjIFNldCB0aGUgZmllbGQgdmFsdWVzCiAgICAgICAgICAgICAgICAgICAgICAgICRzZWN1cmVVc2VyTmFtZSA9IENvbnZlcnRUby1TZWN1cmVTdHJpbmcgJHVuYXR0ZW5kZWRBY2NvdW50LlVzZXJOYW1lIC1Bc1BsYWluVGV4dCAtRm9yY2UKICAgICAgICAgICAgICAgICAgICAgICAgJHNlY3VyZVBhc3N3b3JkID0gJHVuYXR0ZW5kZWRBY2NvdW50LlBhc3N3b3JkCiAgICAgICAgICAgICAgICAgICAgICAgICRjcmVkZW50aWFsVmFsdWVzID0gJHNlY3VyZVVzZXJOYW1lLCAkc2VjdXJlUGFzc3dvcmQKCiAgICAgICAgICAgICAgICAgICAgICAgICMgU2V0IHRoZSBUYXJnZXQgQXBwIE5hbWUgYW5kIGNyZWF0ZSB0aGUgVGFyZ2V0IEFwcAogICAgICAgICAgICAgICAgICAgICAgICAkbmFtZSA9ICIkKCRleGNlbFNlcnZpY2VBcHAuSUQpLUV4Y2VsVW5hdHRlbmRlZEFjY291bnQiCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgU2VjdXJlIFN0b3JlIFRhcmdldCBBcHBsaWNhdGlvbiAkbmFtZS4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgJHNlY3VyZVN0b3JlVGFyZ2V0QXBwID0gTmV3LVNQU2VjdXJlU3RvcmVUYXJnZXRBcHBsaWNhdGlvbiAtTmFtZSAkbmFtZSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtRnJpZW5kbHlOYW1lICJFeGNlbCBTZXJ2aWNlcyBVbmF0dGVuZGVkIEFjY291bnQgVGFyZ2V0IEFwcCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLUFwcGxpY2F0aW9uVHlwZSBHcm91cCBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtVGltZW91dEluTWludXRlcyAzCgogICAgICAgICAgICAgICAgICAgICAgICAjIFNldCB0aGUgYWNjb3VudCBmaWVsZHMKICAgICAgICAgICAgICAgICAgICAgICAgJHVzZXJuYW1lRmllbGQgPSBOZXctU1BTZWN1cmVTdG9yZUFwcGxpY2F0aW9uRmllbGQgLU5hbWUgIlVzZXIgTmFtZSIgLVR5cGUgV2luZG93c1VzZXJOYW1lIC1NYXNrZWQ6JGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICRwYXNzd29yZEZpZWxkID0gTmV3LVNQU2VjdXJlU3RvcmVBcHBsaWNhdGlvbkZpZWxkIC1OYW1lICJQYXNzd29yZCIgLVR5cGUgV2luZG93c1Bhc3N3b3JkIC1NYXNrZWQ6JGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICRmaWVsZHMgPSAkdXNlcm5hbWVGaWVsZCwgJHBhc3N3b3JkRmllbGQKCiAgICAgICAgICAgICAgICAgICAgICAgICMgR2V0IHRoZSBzZXJ2aWNlIGNvbnRleHQKICAgICAgICAgICAgICAgICAgICAgICAgJHN1YklkID0gW01pY3Jvc29mdC5TaGFyZVBvaW50LlNQU2l0ZVN1YnNjcmlwdGlvbklkZW50aWZpZXJdOjpEZWZhdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICRjb250ZXh0ID0gW01pY3Jvc29mdC5TaGFyZVBvaW50LlNQU2VydmljZUNvbnRleHRdOjpHZXRDb250ZXh0KCRleGNlbFNlcnZpY2VBcHAuU2VydmljZUFwcGxpY2F0aW9uUHJveHlHcm91cCwgJHN1YklkKQoKICAgICAgICAgICAgICAgICAgICAgICAgIyBDaGVjayB0byBzZWUgaWYgdGhlIFNlY3VyZSBTdG9yZSBBcHAgYWxyZWFkeSBleGlzdHMKICAgICAgICAgICAgICAgICAgICAgICAgJHNlY3VyZVN0b3JlQXBwID0gR2V0LVNQU2VjdXJlU3RvcmVBcHBsaWNhdGlvbiAtU2VydmljZUNvbnRleHQgJGNvbnRleHQgLU5hbWUgJG5hbWUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgSWYgKCRzZWN1cmVTdG9yZUFwcCAtZXEgJG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgRG9lc24ndCBleGlzdCBzbyBjcmVhdGUuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIENyZWF0aW5nIFNlY3VyZSBTdG9yZSBBcHBsaWNhdGlvbi4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzZWN1cmVTdG9yZUFwcCA9IE5ldy1TUFNlY3VyZVN0b3JlQXBwbGljYXRpb24gLVNlcnZpY2VDb250ZXh0ICRjb250ZXh0IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtVGFyZ2V0QXBwbGljYXRpb24gJHNlY3VyZVN0b3JlVGFyZ2V0QXBwIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtQWRtaW5pc3RyYXRvciAkYWRtaW5QcmluY2lwYWwgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1DcmVkZW50aWFsc093bmVyR3JvdXAgJGdyb3VwQ2xhaW0gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1GaWVsZHMgJGZpZWxkcwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICMgVXBkYXRlIHRoZSBmaWVsZCB2YWx1ZXMKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBVcGRhdGluZyBTZWN1cmUgU3RvcmUgR3JvdXAgQ3JlZGVudGlhbCBNYXBwaW5nLi4uIgogICAgICAgICAgICAgICAgICAgICAgICBVcGRhdGUtU1BTZWN1cmVTdG9yZUdyb3VwQ3JlZGVudGlhbE1hcHBpbmcgLUlkZW50aXR5ICRzZWN1cmVTdG9yZUFwcCAtVmFsdWVzICRjcmVkZW50aWFsVmFsdWVzCgogICAgICAgICAgICAgICAgICAgICAgICAjIFNldCB0aGUgdW5hdHRlbmRlZCBzZXJ2aWNlIGFjY291bnQgYXBwbGljYXRpb24gSUQKICAgICAgICAgICAgICAgICAgICAgICAgU2V0LVNQRXhjZWxTZXJ2aWNlQXBwbGljYXRpb24gLUlkZW50aXR5ICRleGNlbFNlcnZpY2VBcHAgLVVuYXR0ZW5kZWRBY2NvdW50QXBwbGljYXRpb25JZCAkbmFtZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBFbHNlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFVuYXR0ZW5kZWQgYWNjb3VudCBjcmVkZW50aWFscyBub3Qgc3VwcGxpZWQgaW4gY29uZmlndXJhdGlvbiBmaWxlIC0gc2tpcHBpbmcuIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAtICRleGNlbEFwcE5hbWUgYWxyZWFkeSBwcm92aXNpb25lZC4iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2cgIiAtIERvbmUgY3JlYXRpbmcgJGV4Y2VsQXBwTmFtZS4iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgQ2F0Y2gKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICRfCiAgICAgICAgICAgICAgICBUaHJvdyAiIC0gRXJyb3IgcHJvdmlzaW9uaW5nIEV4Y2VsIFNlcnZpY2UgQXBwbGljYXRpb24iCiAgICAgICAgICAgIH0KICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBsb2cgIldBUk5JTkc6WW91IGhhdmUgc3BlY2lmaWVkIGEgbm9uLUVudGVycHJpc2UgU0tVIGluIGAiJChTcGxpdC1QYXRoIC1QYXRoICRpbnB1dEZpbGUgLUxlYWYpYCIuIEhvd2V2ZXIsIFNoYXJlUG9pbnQgcmVxdWlyZXMgdGhlIEVudGVycHJpc2UgU0tVIGFuZCBjb3JyZXNwb25kaW5nIFBJREtleSB0byBwcm92aXNpb24gRXhjZWwgU2VydmljZXMuIgogICAgICAgIH0KICAgICAgICBXcml0ZUxpbmUKICAgIH0KfQojRW5kUmVnaW9uCgojUmVnaW9uIENyZWF0ZSBWaXNpbyBHcmFwaGljcyBTZXJ2aWNlCkZ1bmN0aW9uIENyZWF0ZVZpc2lvU2VydmljZUFwcCAoW3htbF0keG1saW5wdXQpCnsKICAgICRvZmZpY2VTZXJ2ZXJQcmVtaXVtID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uSW5zdGFsbC5TS1UgLXJlcGxhY2UgIkVudGVycHJpc2UiLCIxIiAtcmVwbGFjZSAiU3RhbmRhcmQiLCIwIgogICAgJHNlcnZpY2VDb25maWcgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuVmlzaW9TZXJ2aWNlCiAgICBJZiAoU2hvdWxkSVByb3Zpc2lvbiAkc2VydmljZUNvbmZpZyAtZXEgJHRydWUpCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgaWYgKCRvZmZpY2VTZXJ2ZXJQcmVtaXVtIC1lcSAiMSIpCiAgICAgICAgewogICAgICAgICAgICAkc2VydmljZUluc3RhbmNlVHlwZSA9ICJNaWNyb3NvZnQuT2ZmaWNlLlZpc2lvLlNlcnZlci5BZG1pbmlzdHJhdGlvbi5WaXNpb0dyYXBoaWNzU2VydmljZUluc3RhbmNlIgogICAgICAgICAgICBDcmVhdGVHZW5lcmljU2VydmljZUFwcGxpY2F0aW9uIC1TZXJ2aWNlQ29uZmlnICRzZXJ2aWNlQ29uZmlnIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZUluc3RhbmNlVHlwZSAkc2VydmljZUluc3RhbmNlVHlwZSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VOYW1lICRzZXJ2aWNlQ29uZmlnLk5hbWUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlOYW1lICRzZXJ2aWNlQ29uZmlnLlByb3h5TmFtZSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VHZXRDbWRsZXQgIkdldC1TUFZpc2lvU2VydmljZUFwcGxpY2F0aW9uIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VQcm94eUdldENtZGxldCAiR2V0LVNQVmlzaW9TZXJ2aWNlQXBwbGljYXRpb25Qcm94eSIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlTmV3Q21kbGV0ICJOZXctU1BWaXNpb1NlcnZpY2VBcHBsaWNhdGlvbiIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlOZXdDbWRsZXQgIk5ldy1TUFZpc2lvU2VydmljZUFwcGxpY2F0aW9uUHJveHkiCgogICAgICAgICAgICBJZiAoR2V0LUNvbW1hbmQgLU5hbWUgR2V0LVNQVmlzaW9TZXJ2aWNlQXBwbGljYXRpb24gLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICMgaHR0cDovL2Jsb2cuZmFsY2hpb25jb25zdWx0aW5nLmNvbS9pbmRleC5waHAvMjAxMC8xMC9zZXJ2aWNlLWFjY291bnRzLWFuZC1tYW5hZ2VkLXNlcnZpY2UtYWNjb3VudHMtaW4tc2hhcmVwb2ludC0yMDEwLwogICAgICAgICAgICAgICAgSWYgKCRzZXJ2aWNlQ29uZmlnLlVuYXR0ZW5kZWRJRFVzZXIgLWFuZCAkc2VydmljZUNvbmZpZy5VbmF0dGVuZGVkSURQYXNzd29yZCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFNldHRpbmcgdW5hdHRlbmRlZCBhY2NvdW50IGNyZWRlbnRpYWxzLi4uIgoKICAgICAgICAgICAgICAgICAgICAkc2VydmljZUFwcGxpY2F0aW9uID0gR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uIC1uYW1lICRzZXJ2aWNlQ29uZmlnLk5hbWUKCiAgICAgICAgICAgICAgICAgICAgIyBHZXQgYWNjb3VudCBjcmVkZW50aWFscwogICAgICAgICAgICAgICAgICAgICR2aXNpb0FjY3QgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuVmlzaW9TZXJ2aWNlLlVuYXR0ZW5kZWRJRFVzZXIKICAgICAgICAgICAgICAgICAgICAkdmlzaW9BY2N0UFdEID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLlZpc2lvU2VydmljZS5VbmF0dGVuZGVkSURQYXNzd29yZAogICAgICAgICAgICAgICAgICAgIElmICghKCR2aXNpb0FjY3QpIC1vciAkdmlzaW9BY2N0IC1lcSAiIiAtb3IgISgkdmlzaW9BY2N0UFdEKSAtb3IgJHZpc2lvQWNjdFBXRCAtZXEgIiIpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFByb21wdGluZyBmb3IgVmlzaW8gVW5hdHRlbmRlZCBBY2NvdW50OiIKICAgICAgICAgICAgICAgICAgICAgICAgJHVuYXR0ZW5kZWRBY2NvdW50ID0gJGhvc3QudWkuUHJvbXB0Rm9yQ3JlZGVudGlhbCgiVmlzaW8gU2V0dXAiLCAiRW50ZXIgVmlzaW8gVW5hdHRlbmRlZCBBY2NvdW50IENyZWRlbnRpYWxzOiIsICIkdmlzaW9BY2N0IiwgIk5ldEJpb3NVc2VyTmFtZSIgKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBFbHNlCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkc2VjUGFzc3dvcmQgPSBDb252ZXJ0VG8tU2VjdXJlU3RyaW5nICIkdmlzaW9BY2N0UFdEIiAtQXNQbGFpbnRleHQgLUZvcmNlCiAgICAgICAgICAgICAgICAgICAgICAgICR1bmF0dGVuZGVkQWNjb3VudCA9IE5ldy1PYmplY3QgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5Qc0NyZWRlbnRpYWwgJHZpc2lvQWNjdCwkc2VjUGFzc3dvcmQKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICMgU2V0IHRoZSBncm91cCBjbGFpbSBhbmQgYWRtaW4gcHJpbmNpcGFscwogICAgICAgICAgICAgICAgICAgICRncm91cENsYWltID0gTmV3LVNQQ2xhaW1zUHJpbmNpcGFsIC1JZGVudGl0eSAibnQgYXV0aG9yaXR5XGF1dGhlbnRpY2F0ZWQgdXNlcnMiIC1JZGVudGl0eVR5cGUgV2luZG93c1NhbUFjY291bnROYW1lCiAgICAgICAgICAgICAgICAgICAgJGFkbWluUHJpbmNpcGFsID0gTmV3LVNQQ2xhaW1zUHJpbmNpcGFsIC1JZGVudGl0eSAiJCgkZW52OnVzZXJkb21haW4pXCQoJGVudjp1c2VybmFtZSkiIC1JZGVudGl0eVR5cGUgV2luZG93c1NhbUFjY291bnROYW1lCgogICAgICAgICAgICAgICAgICAgICMgU2V0IHRoZSBmaWVsZCB2YWx1ZXMKICAgICAgICAgICAgICAgICAgICAkc2VjdXJlVXNlck5hbWUgPSBDb252ZXJ0VG8tU2VjdXJlU3RyaW5nICR1bmF0dGVuZGVkQWNjb3VudC5Vc2VyTmFtZSAtQXNQbGFpblRleHQgLUZvcmNlCiAgICAgICAgICAgICAgICAgICAgJHNlY3VyZVBhc3N3b3JkID0gJHVuYXR0ZW5kZWRBY2NvdW50LlBhc3N3b3JkCiAgICAgICAgICAgICAgICAgICAgJGNyZWRlbnRpYWxWYWx1ZXMgPSAkc2VjdXJlVXNlck5hbWUsICRzZWN1cmVQYXNzd29yZAoKICAgICAgICAgICAgICAgICAgICAjIFNldCB0aGUgVGFyZ2V0IEFwcCBOYW1lIGFuZCBjcmVhdGUgdGhlIFRhcmdldCBBcHAKICAgICAgICAgICAgICAgICAgICAkbmFtZSA9ICIkKCRzZXJ2aWNlQXBwbGljYXRpb24uSUQpLVZpc2lvVW5hdHRlbmRlZEFjY291bnQiCiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyBTZWN1cmUgU3RvcmUgVGFyZ2V0IEFwcGxpY2F0aW9uICRuYW1lLi4uIgogICAgICAgICAgICAgICAgICAgICRzZWN1cmVTdG9yZVRhcmdldEFwcCA9IE5ldy1TUFNlY3VyZVN0b3JlVGFyZ2V0QXBwbGljYXRpb24gLU5hbWUgJG5hbWUgYAogICAgICAgICAgICAgICAgICAgICAgICAtRnJpZW5kbHlOYW1lICJWaXNpbyBTZXJ2aWNlcyBVbmF0dGVuZGVkIEFjY291bnQgVGFyZ2V0IEFwcCIgYAogICAgICAgICAgICAgICAgICAgICAgICAtQXBwbGljYXRpb25UeXBlIEdyb3VwIGAKICAgICAgICAgICAgICAgICAgICAgICAgLVRpbWVvdXRJbk1pbnV0ZXMgMwoKICAgICAgICAgICAgICAgICAgICAjIFNldCB0aGUgYWNjb3VudCBmaWVsZHMKICAgICAgICAgICAgICAgICAgICAkdXNlcm5hbWVGaWVsZCA9IE5ldy1TUFNlY3VyZVN0b3JlQXBwbGljYXRpb25GaWVsZCAtTmFtZSAiVXNlciBOYW1lIiAtVHlwZSBXaW5kb3dzVXNlck5hbWUgLU1hc2tlZDokZmFsc2UKICAgICAgICAgICAgICAgICAgICAkcGFzc3dvcmRGaWVsZCA9IE5ldy1TUFNlY3VyZVN0b3JlQXBwbGljYXRpb25GaWVsZCAtTmFtZSAiUGFzc3dvcmQiIC1UeXBlIFdpbmRvd3NQYXNzd29yZCAtTWFza2VkOiRmYWxzZQogICAgICAgICAgICAgICAgICAgICRmaWVsZHMgPSAkdXNlcm5hbWVGaWVsZCwgJHBhc3N3b3JkRmllbGQKCiAgICAgICAgICAgICAgICAgICAgIyBHZXQgdGhlIHNlcnZpY2UgY29udGV4dAogICAgICAgICAgICAgICAgICAgICRzdWJJZCA9IFtNaWNyb3NvZnQuU2hhcmVQb2ludC5TUFNpdGVTdWJzY3JpcHRpb25JZGVudGlmaWVyXTo6RGVmYXVsdAogICAgICAgICAgICAgICAgICAgICRjb250ZXh0ID0gW01pY3Jvc29mdC5TaGFyZVBvaW50LlNQU2VydmljZUNvbnRleHRdOjpHZXRDb250ZXh0KCRzZXJ2aWNlQXBwbGljYXRpb24uU2VydmljZUFwcGxpY2F0aW9uUHJveHlHcm91cCwgJHN1YklkKQoKICAgICAgICAgICAgICAgICAgICAjIENoZWNrIHRvIHNlZSBpZiB0aGUgU2VjdXJlIFN0b3JlIEFwcCBhbHJlYWR5IGV4aXN0cwogICAgICAgICAgICAgICAgICAgICRzZWN1cmVTdG9yZUFwcCA9IEdldC1TUFNlY3VyZVN0b3JlQXBwbGljYXRpb24gLVNlcnZpY2VDb250ZXh0ICRjb250ZXh0IC1OYW1lICRuYW1lIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgSWYgKCEoJHNlY3VyZVN0b3JlQXBwKSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgRG9lc24ndCBleGlzdCBzbyBjcmVhdGUuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgU2VjdXJlIFN0b3JlIEFwcGxpY2F0aW9uLi4uIgogICAgICAgICAgICAgICAgICAgICAgICAkc2VjdXJlU3RvcmVBcHAgPSBOZXctU1BTZWN1cmVTdG9yZUFwcGxpY2F0aW9uIC1TZXJ2aWNlQ29udGV4dCAkY29udGV4dCBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtVGFyZ2V0QXBwbGljYXRpb24gJHNlY3VyZVN0b3JlVGFyZ2V0QXBwIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1BZG1pbmlzdHJhdG9yICRhZG1pblByaW5jaXBhbCBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtQ3JlZGVudGlhbHNPd25lckdyb3VwICRncm91cENsYWltIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1GaWVsZHMgJGZpZWxkcwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAjIFVwZGF0ZSB0aGUgZmllbGQgdmFsdWVzCiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBVcGRhdGluZyBTZWN1cmUgU3RvcmUgR3JvdXAgQ3JlZGVudGlhbCBNYXBwaW5nLi4uIgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZS1TUFNlY3VyZVN0b3JlR3JvdXBDcmVkZW50aWFsTWFwcGluZyAtSWRlbnRpdHkgJHNlY3VyZVN0b3JlQXBwIC1WYWx1ZXMgJGNyZWRlbnRpYWxWYWx1ZXMKCiAgICAgICAgICAgICAgICAgICAgIyBTZXQgdGhlIHVuYXR0ZW5kZWQgc2VydmljZSBhY2NvdW50IGFwcGxpY2F0aW9uIElECiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBTZXR0aW5nIEFwcGxpY2F0aW9uIElEIGZvciBWaXNpbyBTZXJ2aWNlLi4uIgogICAgICAgICAgICAgICAgICAgICRzZXJ2aWNlQXBwbGljYXRpb24gfCBTZXQtU1BWaXNpb0V4dGVybmFsRGF0YSAtVW5hdHRlbmRlZFNlcnZpY2VBY2NvdW50QXBwbGljYXRpb25JRCAkbmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgRWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gVW5hdHRlbmRlZCBhY2NvdW50IGNyZWRlbnRpYWxzIG5vdCBzdXBwbGllZCBpbiBjb25maWd1cmF0aW9uIGZpbGUgLSBza2lwcGluZy4iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgbG9nICJXQVJOSU5HOllvdSBoYXZlIHNwZWNpZmllZCBhIG5vbi1FbnRlcnByaXNlIFNLVSBpbiBgIiQoU3BsaXQtUGF0aCAtUGF0aCAkaW5wdXRGaWxlIC1MZWFmKWAiLiBIb3dldmVyLCBTaGFyZVBvaW50IHJlcXVpcmVzIHRoZSBFbnRlcnByaXNlIFNLVSBhbmQgY29ycmVzcG9uZGluZyBQSURLZXkgdG8gcHJvdmlzaW9uIFZpc2lvIFNlcnZpY2VzLiIKICAgICAgICB9CiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cgp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ3JlYXRlIFBlcmZvcm1hbmNlUG9pbnQgU2VydmljZQpGdW5jdGlvbiBDcmVhdGVQZXJmb3JtYW5jZVBvaW50U2VydmljZUFwcCAoW3htbF0keG1saW5wdXQpCnsKICAgICRvZmZpY2VTZXJ2ZXJQcmVtaXVtID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uSW5zdGFsbC5TS1UgLXJlcGxhY2UgIkVudGVycHJpc2UiLCIxIiAtcmVwbGFjZSAiU3RhbmRhcmQiLCIwIgogICAgJHNlcnZpY2VDb25maWcgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuUGVyZm9ybWFuY2VQb2ludFNlcnZpY2UKICAgIElmIChTaG91bGRJUHJvdmlzaW9uICRzZXJ2aWNlQ29uZmlnIC1lcSAkdHJ1ZSkKICAgIHsKICAgICAgICBXcml0ZUxpbmUKICAgICAgICBpZiAoJG9mZmljZVNlcnZlclByZW1pdW0gLWVxICIxIikKICAgICAgICB7CiAgICAgICAgICAgICRkYlNlcnZlciA9ICRzZXJ2aWNlQ29uZmlnLkRhdGFiYXNlLkRCU2VydmVyCiAgICAJICAgICMgSWYgd2UgaGF2ZW4ndCBzcGVjaWZpZWQgYSBEQiBTZXJ2ZXIgdGhlbiBqdXN0IHVzZSB0aGUgZGVmYXVsdCB1c2VkIGJ5IHRoZSBGYXJtCiAgICAJICAgIElmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkZGJTZXJ2ZXIpKQogICAgCSAgICB7CiAgICAJICAgICAgICAkZGJTZXJ2ZXIgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkRhdGFiYXNlLkRCU2VydmVyCiAgICAJICAgIH0KICAgICAgICAgICAgJGRiUHJlZml4ID0gR2V0LURCUHJlZml4ICR4bWxpbnB1dAogICAgCSAgICAkc2VydmljZURCID0gJGRiUHJlZml4KyRzZXJ2aWNlQ29uZmlnLkRhdGFiYXNlLk5hbWUKICAgICAgICAgICAgJHNlcnZpY2VJbnN0YW5jZVR5cGUgPSAiTWljcm9zb2Z0LlBlcmZvcm1hbmNlUG9pbnQuU2NvcmVjYXJkcy5CSU1vbml0b3JpbmdTZXJ2aWNlSW5zdGFuY2UiCiAgICAgICAgICAgIENyZWF0ZUdlbmVyaWNTZXJ2aWNlQXBwbGljYXRpb24gLVNlcnZpY2VDb25maWcgJHNlcnZpY2VDb25maWcgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlSW5zdGFuY2VUeXBlICRzZXJ2aWNlSW5zdGFuY2VUeXBlIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZU5hbWUgJHNlcnZpY2VDb25maWcuTmFtZSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VQcm94eU5hbWUgJHNlcnZpY2VDb25maWcuUHJveHlOYW1lIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZUdldENtZGxldCAiR2V0LVNQUGVyZm9ybWFuY2VQb2ludFNlcnZpY2VBcHBsaWNhdGlvbiIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlHZXRDbWRsZXQgIkdldC1TUFNlcnZpY2VBcHBsaWNhdGlvblByb3h5IiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VOZXdDbWRsZXQgIk5ldy1TUFBlcmZvcm1hbmNlUG9pbnRTZXJ2aWNlQXBwbGljYXRpb24iIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZVByb3h5TmV3Q21kbGV0ICJOZXctU1BQZXJmb3JtYW5jZVBvaW50U2VydmljZUFwcGxpY2F0aW9uUHJveHkiCgogICAgICAgICAgICAkYXBwbGljYXRpb24gPSBHZXQtU1BQZXJmb3JtYW5jZVBvaW50U2VydmljZUFwcGxpY2F0aW9uIHwgPyB7JF8uTmFtZSAtZXEgJHNlcnZpY2VDb25maWcuTmFtZX0KICAgICAgICAgICAgSWYgKCRhcHBsaWNhdGlvbikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJGZhcm1BY2N0ID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5BY2NvdW50LlVzZXJuYW1lCiAgICAgICAgICAgICAgICBsb2cgIiAtIEdyYW50aW5nICRmYXJtQWNjdCByaWdodHMgdG8gZGF0YWJhc2UgJHNlcnZpY2VEQi4uLiIKICAgICAgICAgICAgICAgIEdldC1TUERhdGFiYXNlIHwgV2hlcmUgeyRfLk5hbWUgLWVxICRzZXJ2aWNlREJ9IHwgQWRkLVNQU2hlbGxBZG1pbiAtVXNlck5hbWUgJGZhcm1BY2N0CiAgICAgICAgICAgICAgICBsb2cgIiAtIFNldHRpbmcgUGVyZm9ybWFuY2VQb2ludCBEYXRhIFNvdXJjZSBVbmF0dGVuZGVkIFNlcnZpY2UgQWNjb3VudC4uLiIKICAgICAgICAgICAgICAgICRwZXJmb3JtYW5jZVBvaW50QWNjdCA9ICRzZXJ2aWNlQ29uZmlnLlVuYXR0ZW5kZWRJRFVzZXIKICAgICAgICAgICAgICAgICRwZXJmb3JtYW5jZVBvaW50QWNjdFBXRCA9ICRzZXJ2aWNlQ29uZmlnLlVuYXR0ZW5kZWRJRFBhc3N3b3JkCiAgICAgICAgICAgICAgICBJZiAoISgkcGVyZm9ybWFuY2VQb2ludEFjY3QpIC1vciAkcGVyZm9ybWFuY2VQb2ludEFjY3QgLWVxICIiIC1vciAhKCRwZXJmb3JtYW5jZVBvaW50QWNjdFBXRCkgLW9yICRwZXJmb3JtYW5jZVBvaW50QWNjdFBXRCAtZXEgIiIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBQcm9tcHRpbmcgZm9yIFBlcmZvcm1hbmNlUG9pbnQgVW5hdHRlbmRlZCBTZXJ2aWNlIEFjY291bnQ6IgogICAgICAgICAgICAgICAgICAgICRwZXJmb3JtYW5jZVBvaW50Q3JlZGVudGlhbCA9ICRob3N0LnVpLlByb21wdEZvckNyZWRlbnRpYWwoIlBlcmZvcm1hbmNlUG9pbnQgU2V0dXAiLCAiRW50ZXIgUGVyZm9ybWFuY2VQb2ludCBVbmF0dGVuZGVkIEFjY291bnQgQ3JlZGVudGlhbHM6IiwgIiRwZXJmb3JtYW5jZVBvaW50QWNjdCIsICJOZXRCaW9zVXNlck5hbWUiICkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkc2VjUGFzc3dvcmQgPSBDb252ZXJ0VG8tU2VjdXJlU3RyaW5nICIkcGVyZm9ybWFuY2VQb2ludEFjY3RQV0QiIC1Bc1BsYWludGV4dCAtRm9yY2UKICAgICAgICAgICAgICAgICAgICAkcGVyZm9ybWFuY2VQb2ludENyZWRlbnRpYWwgPSBOZXctT2JqZWN0IFN5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUHNDcmVkZW50aWFsICRwZXJmb3JtYW5jZVBvaW50QWNjdCwkc2VjUGFzc3dvcmQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRhcHBsaWNhdGlvbiB8IFNldC1TUFBlcmZvcm1hbmNlUG9pbnRTZWN1cmVEYXRhVmFsdWVzIC1EYXRhU291cmNlVW5hdHRlbmRlZFNlcnZpY2VBY2NvdW50ICRwZXJmb3JtYW5jZVBvaW50Q3JlZGVudGlhbAoKICAgICAgICAgICAgICAgIElmICghKENoZWNrRm9yMjAxMFNQMSkpICMgT25seSBuZWVkIHRoaXMgaWYgb3VyIGVudmlyb25tZW50IGlzbid0IHVwIHRvIFNlcnZpY2UgUGFjayAxIGZvciBTaGFyZVBvaW50IDIwMTAKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAjIFJlbmFtZSB0aGUgcGVyZm9ybWFuY2UgcG9pbnQgc2VydmljZSBhcHBsaWNhdGlvbiBkYXRhYmFzZQogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gUmVuYW1pbmcgUGVyZm9ybWFuY2UgUG9pbnQgU2VydmljZSBBcHBsaWNhdGlvbiBEYXRhYmFzZSIKICAgICAgICAgICAgICAgICAgICAkc2V0dGluZ3NEQiA9ICRhcHBsaWNhdGlvbi5TZXR0aW5nc0RhdGFiYXNlCiAgICAgICAgICAgICAgICAgICAgJG5ld0RCID0gJHNlcnZpY2VEQgogICAgICAgICAgICAgICAgICAgICRzcWxTZXJ2ZXIgPSAoJHNldHRpbmdzREIgLXNwbGl0ICJcXFxcIilbMF0KICAgICAgICAgICAgICAgICAgICAkb2xkREIgPSAoJHNldHRpbmdzREIgLXNwbGl0ICJcXFxcIilbMV0KICAgICAgICAgICAgICAgICAgICBJZiAoISgkbmV3REIgLWVxICRvbGREQikpICMgQ2hlY2sgaWYgaXQncyBhbHJlYWR5IGJlZW4gcmVuYW1lZCwgaW4gY2FzZSB3ZSdyZSBydW5uaW5nIHRoZSBzY3JpcHQgYWdhaW4KICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gUmVuYW1pbmcgUGVyZm9ybWFuY2UgUG9pbnQgU2VydmljZSBBcHBsaWNhdGlvbiBEYXRhYmFzZSIKICAgICAgICAgICAgICAgICAgICAgICAgUmVuYW1lRGF0YWJhc2UgLXNxbFNlcnZlciAkc3FsU2VydmVyIC1vbGROYW1lICRvbGREQiAtbmV3TmFtZSAkbmV3REIKICAgICAgICAgICAgICAgICAgICAgICAgU2V0LVNQUGVyZm9ybWFuY2VQb2ludFNlcnZpY2VBcHBsaWNhdGlvbiAgLUlkZW50aXR5ICRzZXJ2aWNlQ29uZmlnLk5hbWUgLVNldHRpbmdzRGF0YWJhc2UgJG5ld0RCIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgRWxzZQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIERhdGFiYXNlIGFscmVhZHkgbmFtZWQ6ICRuZXdEQiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgbG9nICJXQVJOSU5HOiBZb3UgaGF2ZSBzcGVjaWZpZWQgYSBub24tRW50ZXJwcmlzZSBTS1UgaW4gYCIkKFNwbGl0LVBhdGggLVBhdGggJGlucHV0RmlsZSAtTGVhZilgIi4gSG93ZXZlciwgU2hhcmVQb2ludCByZXF1aXJlcyB0aGUgRW50ZXJwcmlzZSBTS1UgYW5kIGNvcnJlc3BvbmRpbmcgUElES2V5IHRvIHByb3Zpc2lvbiBQZXJmb3JtYW5jZVBvaW50IFNlcnZpY2VzLiIKICAgICAgICB9CiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBDcmVhdGUgQWNjZXNzIDIwMTAgU2VydmljZQpGdW5jdGlvbiBDcmVhdGVBY2Nlc3MyMDEwU2VydmljZUFwcCAoW3htbF0keG1saW5wdXQpCnsKICAgICRvZmZpY2VTZXJ2ZXJQcmVtaXVtID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uSW5zdGFsbC5TS1UgLXJlcGxhY2UgIkVudGVycHJpc2UiLCIxIiAtcmVwbGFjZSAiU3RhbmRhcmQiLCIwIgogICAgJHNlcnZpY2VDb25maWcgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuQWNjZXNzU2VydmljZQogICAgSWYgKFNob3VsZElQcm92aXNpb24gJHNlcnZpY2VDb25maWcgLWVxICR0cnVlKQogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgIGlmICgkb2ZmaWNlU2VydmVyUHJlbWl1bSAtZXEgIjEiKQogICAgICAgIHsKICAgICAgICAgICAgJHNlcnZpY2VJbnN0YW5jZVR5cGUgPSAiTWljcm9zb2Z0Lk9mZmljZS5BY2Nlc3MuU2VydmVyLk1vc3NIb3N0LkFjY2Vzc1NlcnZlcldlYlNlcnZpY2VJbnN0YW5jZSIKICAgICAgICAgICAgQ3JlYXRlR2VuZXJpY1NlcnZpY2VBcHBsaWNhdGlvbiAtU2VydmljZUNvbmZpZyAkc2VydmljZUNvbmZpZyBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VJbnN0YW5jZVR5cGUgJHNlcnZpY2VJbnN0YW5jZVR5cGUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlTmFtZSAkc2VydmljZUNvbmZpZy5OYW1lIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZVByb3h5TmFtZSAkc2VydmljZUNvbmZpZy5Qcm94eU5hbWUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlR2V0Q21kbGV0ICJHZXQtU1BBY2Nlc3NTZXJ2aWNlQXBwbGljYXRpb24iIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZVByb3h5R2V0Q21kbGV0ICJHZXQtU1BTZXJ2aWNlQXBwbGljYXRpb25Qcm94eSIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlTmV3Q21kbGV0ICJOZXctU1BBY2Nlc3NTZXJ2aWNlQXBwbGljYXRpb24gLURlZmF1bHQiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZVByb3h5TmV3Q21kbGV0ICJOZXctU1BBY2Nlc3NTZXJ2aWNlQXBwbGljYXRpb25Qcm94eSIgIyBGYWtlIGNtZGxldCAoYW5kIG5vdCBuZWVkZWQgZm9yIEFjY2VzcyBTZXJ2aWNlcyksIGJ1dCB0aGUgQ3JlYXRlR2VuZXJpY1NlcnZpY2VBcHBsaWNhdGlvbiBmdW5jdGlvbiBleHBlY3RzIHNvbWV0aGluZwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBsb2cgIldBUk5JTkc6WW91IGhhdmUgc3BlY2lmaWVkIGEgbm9uLUVudGVycHJpc2UgU0tVIGluIGAiJChTcGxpdC1QYXRoIC1QYXRoICRpbnB1dEZpbGUgLUxlYWYpYCIuIEhvd2V2ZXIsIFNoYXJlUG9pbnQgcmVxdWlyZXMgdGhlIEVudGVycHJpc2UgU0tVIGFuZCBjb3JyZXNwb25kaW5nIFBJREtleSB0byBwcm92aXNpb24gQWNjZXNzIFNlcnZpY2VzIDIwMTAuIgogICAgICAgIH0KICAgICAgICBXcml0ZUxpbmUKICAgIH0KfQojRW5kUmVnaW9uCgojRW5kUmVnaW9uCgojUmVnaW9uIENyZWF0ZSBPZmZpY2UgV2ViIEFwcHMKRnVuY3Rpb24gQ3JlYXRlRXhjZWxPV0FTZXJ2aWNlQXBwIChbeG1sXSR4bWxpbnB1dCkKewogICAgR2V0LU1ham9yVmVyc2lvbk51bWJlciAkeG1saW5wdXQKICAgICRzZXJ2aWNlQ29uZmlnID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uT2ZmaWNlV2ViQXBwcy5FeGNlbFNlcnZpY2UKICAgIElmICgoU2hvdWxkSVByb3Zpc2lvbiAkc2VydmljZUNvbmZpZyAtZXEgJHRydWUpIC1hbmQgKFRlc3QtUGF0aCAiJGVudjpDb21tb25Qcm9ncmFtRmlsZXNcTWljcm9zb2Z0IFNoYXJlZFxXZWIgU2VydmVyIEV4dGVuc2lvbnNcJGVudjpzcFZlclxURU1QTEFURVxGRUFUVVJFU1xPZmZpY2VXZWJBcHBzXGZlYXR1cmUueG1sIikpCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgJHBvcnRhbFdlYkFwcCA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLldlYkFwcGxpY2F0aW9ucy5XZWJBcHBsaWNhdGlvbiB8IFdoZXJlIHskXy5UeXBlIC1lcSAiUG9ydGFsIn0gfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxCiAgICAgICAgJHBvcnRhbFVSTCA9ICgkcG9ydGFsV2ViQXBwLlVSTCkuVHJpbUVuZCgiLyIpCiAgICAgICAgJHBvcnRhbFBvcnQgPSAkcG9ydGFsV2ViQXBwLlBvcnQKICAgICAgICAkc2VydmljZUluc3RhbmNlVHlwZSA9ICJNaWNyb3NvZnQuT2ZmaWNlLkV4Y2VsLlNlcnZlci5Nb3NzSG9zdC5FeGNlbFNlcnZlcldlYlNlcnZpY2VJbnN0YW5jZSIKICAgICAgICBDcmVhdGVHZW5lcmljU2VydmljZUFwcGxpY2F0aW9uIC1TZXJ2aWNlQ29uZmlnICRzZXJ2aWNlQ29uZmlnIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlSW5zdGFuY2VUeXBlICRzZXJ2aWNlSW5zdGFuY2VUeXBlIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlTmFtZSAkc2VydmljZUNvbmZpZy5OYW1lIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlOYW1lICRzZXJ2aWNlQ29uZmlnLlByb3h5TmFtZSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZUdldENtZGxldCAiR2V0LVNQRXhjZWxTZXJ2aWNlQXBwbGljYXRpb24iIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlHZXRDbWRsZXQgIkdldC1TUFNlcnZpY2VBcHBsaWNhdGlvblByb3h5IiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZU5ld0NtZGxldCAiTmV3LVNQRXhjZWxTZXJ2aWNlQXBwbGljYXRpb24gLURlZmF1bHQiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlOZXdDbWRsZXQgIk5ldy1TUEV4Y2VsU2VydmljZUFwcGxpY2F0aW9uUHJveHkiICMgRmFrZSBjbWRsZXQgKGFuZCBub3QgbmVlZGVkIGZvciBFeGNlbCBTZXJ2aWNlcyksIGJ1dCB0aGUgQ3JlYXRlR2VuZXJpY1NlcnZpY2VBcHBsaWNhdGlvbiBmdW5jdGlvbiBleHBlY3RzIHNvbWV0aGluZwoKICAgICAgICBJZiAoR2V0LVNQRXhjZWxTZXJ2aWNlQXBwbGljYXRpb24pCiAgICAgICAgewogICAgICAgICAgICBsb2cgIiAtIFNldHRpbmcgRXhjZWwgU2VydmljZXMgVHJ1c3RlZCBGaWxlIExvY2F0aW9uLi4uIgogICAgICAgICAgICBTZXQtU1BFeGNlbEZpbGVMb2NhdGlvbiAtSWRlbnRpdHkgImh0dHA6Ly8iIC1Mb2NhdGlvblR5cGUgU2hhcmVQb2ludCAtSW5jbHVkZUNoaWxkcmVuIC1BZGRyZXNzICRwb3J0YWxVUkxgOiRwb3J0YWxQb3J0IC1FeGNlbFNlcnZpY2VBcHBsaWNhdGlvbiAkKCRzZXJ2aWNlQ29uZmlnLk5hbWUpIC1FeHRlcm5hbERhdGFBbGxvd2VkIDIgLVdvcmtib29rU2l6ZU1heCAxMAogICAgICAgIH0KICAgICAgICBXcml0ZUxpbmUKICAgIH0KfQoKRnVuY3Rpb24gQ3JlYXRlUG93ZXJQb2ludE9XQVNlcnZpY2VBcHAgKFt4bWxdJHhtbGlucHV0KQp7CiAgICBHZXQtTWFqb3JWZXJzaW9uTnVtYmVyICR4bWxpbnB1dAogICAgJHNlcnZpY2VDb25maWcgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5PZmZpY2VXZWJBcHBzLlBvd2VyUG9pbnRTZXJ2aWNlCiAgICBJZiAoKFNob3VsZElQcm92aXNpb24gJHNlcnZpY2VDb25maWcgLWVxICR0cnVlKSAtYW5kIChUZXN0LVBhdGggIiRlbnY6Q29tbW9uUHJvZ3JhbUZpbGVzXE1pY3Jvc29mdCBTaGFyZWRcV2ViIFNlcnZlciBFeHRlbnNpb25zXCRlbnY6c3BWZXJcVEVNUExBVEVcRkVBVFVSRVNcT2ZmaWNlV2ViQXBwc1xmZWF0dXJlLnhtbCIpKQogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgIElmICgkZW52OnNwVmVyIC1lcSAiMTQiKSB7JHNlcnZpY2VJbnN0YW5jZVR5cGUgPSAiTWljcm9zb2Z0Lk9mZmljZS5TZXJ2ZXIuUG93ZXJQb2ludC5TaGFyZVBvaW50LkFkbWluaXN0cmF0aW9uLlBvd2VyUG9pbnRXZWJTZXJ2aWNlSW5zdGFuY2UifQogICAgICAgIENyZWF0ZUdlbmVyaWNTZXJ2aWNlQXBwbGljYXRpb24gLVNlcnZpY2VDb25maWcgJHNlcnZpY2VDb25maWcgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VJbnN0YW5jZVR5cGUgJHNlcnZpY2VJbnN0YW5jZVR5cGUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VOYW1lICRzZXJ2aWNlQ29uZmlnLk5hbWUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VQcm94eU5hbWUgJHNlcnZpY2VDb25maWcuUHJveHlOYW1lIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlR2V0Q21kbGV0ICJHZXQtU1BQb3dlclBvaW50U2VydmljZUFwcGxpY2F0aW9uIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZVByb3h5R2V0Q21kbGV0ICJHZXQtU1BQb3dlclBvaW50U2VydmljZUFwcGxpY2F0aW9uUHJveHkiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlTmV3Q21kbGV0ICJOZXctU1BQb3dlclBvaW50U2VydmljZUFwcGxpY2F0aW9uIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZVByb3h5TmV3Q21kbGV0ICJOZXctU1BQb3dlclBvaW50U2VydmljZUFwcGxpY2F0aW9uUHJveHkiCiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cn0KCkZ1bmN0aW9uIENyZWF0ZVdvcmRWaWV3aW5nT1dBU2VydmljZUFwcCAoW3htbF0keG1saW5wdXQpCnsKICAgIEdldC1NYWpvclZlcnNpb25OdW1iZXIgJHhtbGlucHV0CiAgICAkc2VydmljZUNvbmZpZyA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLk9mZmljZVdlYkFwcHMuV29yZFZpZXdpbmdTZXJ2aWNlCiAgICBJZiAoKFNob3VsZElQcm92aXNpb24gJHNlcnZpY2VDb25maWcgLWVxICR0cnVlKSAtYW5kIChUZXN0LVBhdGggIiRlbnY6Q29tbW9uUHJvZ3JhbUZpbGVzXE1pY3Jvc29mdCBTaGFyZWRcV2ViIFNlcnZlciBFeHRlbnNpb25zXCRlbnY6c3BWZXJcVEVNUExBVEVcRkVBVFVSRVNcT2ZmaWNlV2ViQXBwc1xmZWF0dXJlLnhtbCIpKQogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgICRzZXJ2aWNlSW5zdGFuY2VUeXBlID0gIk1pY3Jvc29mdC5PZmZpY2UuV2ViLkVudmlyb25tZW50LlNoYXJlcG9pbnQuQ29udmVyc2lvblNlcnZpY2VJbnN0YW5jZSIKICAgICAgICBDcmVhdGVHZW5lcmljU2VydmljZUFwcGxpY2F0aW9uIC1TZXJ2aWNlQ29uZmlnICRzZXJ2aWNlQ29uZmlnIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlSW5zdGFuY2VUeXBlICRzZXJ2aWNlSW5zdGFuY2VUeXBlIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlTmFtZSAkc2VydmljZUNvbmZpZy5OYW1lIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlOYW1lICRzZXJ2aWNlQ29uZmlnLlByb3h5TmFtZSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZUdldENtZGxldCAiR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZVByb3h5R2V0Q21kbGV0ICJHZXQtU1BTZXJ2aWNlQXBwbGljYXRpb25Qcm94eSIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VOZXdDbWRsZXQgIk5ldy1TUFdvcmRWaWV3aW5nU2VydmljZUFwcGxpY2F0aW9uIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZVByb3h5TmV3Q21kbGV0ICJOZXctU1BXb3JkVmlld2luZ1NlcnZpY2VBcHBsaWNhdGlvblByb3h5IgogICAgICAgIFdyaXRlTGluZQogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gU2hhcmVQb2ludCAyMDEzIFNlcnZpY2UgQXBwcwojUmVnaW9uIENyZWF0ZSBBcHAgRG9tYWluCkZ1bmN0aW9uIENyZWF0ZUFwcE1hbmFnZW1lbnRTZXJ2aWNlQXBwIChbeG1sXSR4bWxpbnB1dCkKewogICAgJHNlcnZpY2VDb25maWcgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5BcHBNYW5hZ2VtZW50U2VydmljZQogICAgSWYgKChTaG91bGRJUHJvdmlzaW9uICRzZXJ2aWNlQ29uZmlnIC1lcSAkdHJ1ZSkgLWFuZCAoR2V0LUNvbW1hbmQgLU5hbWUgTmV3LVNQQXBwTWFuYWdlbWVudFNlcnZpY2VBcHBsaWNhdGlvbiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkpCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgJGRiUHJlZml4ID0gR2V0LURCUHJlZml4ICR4bWxpbnB1dAoJICAgICRzZXJ2aWNlREIgPSAkZGJQcmVmaXgrJHNlcnZpY2VDb25maWcuRGF0YWJhc2UuTmFtZQoJICAgICRkYlNlcnZlciA9ICRzZXJ2aWNlQ29uZmlnLkRhdGFiYXNlLkRCU2VydmVyCgkgICAgIyBJZiB3ZSBoYXZlbid0IHNwZWNpZmllZCBhIERCIFNlcnZlciB0aGVuIGp1c3QgdXNlIHRoZSBkZWZhdWx0IHVzZWQgYnkgdGhlIEZhcm0KCSAgICBJZiAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJGRiU2VydmVyKSkKCSAgICB7CgkgICAgICAgICRkYlNlcnZlciA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uRGF0YWJhc2UuREJTZXJ2ZXIKCSAgICB9CiAgICAgICAgJHNlcnZpY2VJbnN0YW5jZVR5cGUgPSAiTWljcm9zb2Z0LlNoYXJlUG9pbnQuQXBwTWFuYWdlbWVudC5BcHBNYW5hZ2VtZW50U2VydmljZUluc3RhbmNlIgogICAgICAgIENyZWF0ZUdlbmVyaWNTZXJ2aWNlQXBwbGljYXRpb24gLVNlcnZpY2VDb25maWcgJHNlcnZpY2VDb25maWcgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VJbnN0YW5jZVR5cGUgJHNlcnZpY2VJbnN0YW5jZVR5cGUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VOYW1lICRzZXJ2aWNlQ29uZmlnLk5hbWUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VQcm94eU5hbWUgJHNlcnZpY2VDb25maWcuUHJveHlOYW1lIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlR2V0Q21kbGV0ICJHZXQtU1BTZXJ2aWNlQXBwbGljYXRpb24iIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlHZXRDbWRsZXQgIkdldC1TUFNlcnZpY2VBcHBsaWNhdGlvblByb3h5IiBgCgkJCQkJCQkJCSAgICAtU2VydmljZU5ld0NtZGxldCAiTmV3LVNQQXBwTWFuYWdlbWVudFNlcnZpY2VBcHBsaWNhdGlvbiAtRGF0YWJhc2VTZXJ2ZXIgJGRiU2VydmVyIC1EYXRhYmFzZU5hbWUgJHNlcnZpY2VEQiIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VQcm94eU5ld0NtZGxldCAiTmV3LVNQQXBwTWFuYWdlbWVudFNlcnZpY2VBcHBsaWNhdGlvblByb3h5IgoKCQkjIENvbmZpZ3VyZSB5b3VyIGFwcCBkb21haW4gYW5kIGxvY2F0aW9uCgkJbG9nICIgLSBTZXR0aW5nIEFwcCBEb21haW4gYCIkKCRzZXJ2aWNlQ29uZmlnLkFwcERvbWFpbilgIi4uLiIKCSAgICBTZXQtU1BBcHBEb21haW4gLUFwcERvbWFpbiAkc2VydmljZUNvbmZpZy5BcHBEb21haW4KICAgICAgICBXcml0ZUxpbmUKICAgIH0KfQoKRnVuY3Rpb24gQ3JlYXRlU3Vic2NyaXB0aW9uU2V0dGluZ3NTZXJ2aWNlQXBwIChbeG1sXSR4bWxpbnB1dCkKewogICAgJHNlcnZpY2VDb25maWcgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TdWJzY3JpcHRpb25TZXR0aW5nc1NlcnZpY2UKICAgIElmICgoU2hvdWxkSVByb3Zpc2lvbiAkc2VydmljZUNvbmZpZyAtZXEgJHRydWUpIC1hbmQgKEdldC1Db21tYW5kIC1OYW1lIE5ldy1TUFN1YnNjcmlwdGlvblNldHRpbmdzU2VydmljZUFwcGxpY2F0aW9uIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSkKICAgIHsKICAgICAgICBXcml0ZUxpbmUKICAgICAgICAkZGJQcmVmaXggPSBHZXQtREJQcmVmaXggJHhtbGlucHV0CgkgICAgJHNlcnZpY2VEQiA9ICRkYlByZWZpeCskc2VydmljZUNvbmZpZy5EYXRhYmFzZS5OYW1lCgkgICAgJGRiU2VydmVyID0gJHNlcnZpY2VDb25maWcuRGF0YWJhc2UuREJTZXJ2ZXIKCSAgICAjIElmIHdlIGhhdmVuJ3Qgc3BlY2lmaWVkIGEgREIgU2VydmVyIHRoZW4ganVzdCB1c2UgdGhlIGRlZmF1bHQgdXNlZCBieSB0aGUgRmFybQoJICAgIElmIChbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkZGJTZXJ2ZXIpKQoJICAgIHsKCSAgICAgICAgJGRiU2VydmVyID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5EYXRhYmFzZS5EQlNlcnZlcgoJICAgIH0KICAgICAgICAkc2VydmljZUluc3RhbmNlVHlwZSA9ICJNaWNyb3NvZnQuU2hhcmVQb2ludC5TUFN1YnNjcmlwdGlvblNldHRpbmdzU2VydmljZUluc3RhbmNlIgogICAgICAgIENyZWF0ZUdlbmVyaWNTZXJ2aWNlQXBwbGljYXRpb24gLVNlcnZpY2VDb25maWcgJHNlcnZpY2VDb25maWcgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VJbnN0YW5jZVR5cGUgJHNlcnZpY2VJbnN0YW5jZVR5cGUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VOYW1lICRzZXJ2aWNlQ29uZmlnLk5hbWUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VHZXRDbWRsZXQgIkdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VQcm94eUdldENtZGxldCAiR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uUHJveHkiIGAKCQkJCQkJCQkJICAgIC1TZXJ2aWNlTmV3Q21kbGV0ICJOZXctU1BTdWJzY3JpcHRpb25TZXR0aW5nc1NlcnZpY2VBcHBsaWNhdGlvbiAtRGF0YWJhc2VTZXJ2ZXIgJGRiU2VydmVyIC1EYXRhYmFzZU5hbWUgJHNlcnZpY2VEQiIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VQcm94eU5ld0NtZGxldCAiTmV3LVNQU3Vic2NyaXB0aW9uU2V0dGluZ3NTZXJ2aWNlQXBwbGljYXRpb25Qcm94eSIKCgkJbG9nICIgLSBTZXR0aW5nIFNpdGUgU3Vic2NyaXB0aW9uIG5hbWUgYCIkKCRzZXJ2aWNlQ29uZmlnLkFwcFNpdGVTdWJzY3JpcHRpb25OYW1lKWAiLi4uIgoJICAgIFNldC1TUEFwcFNpdGVTdWJzY3JpcHRpb25OYW1lIC1OYW1lICRzZXJ2aWNlQ29uZmlnLkFwcFNpdGVTdWJzY3JpcHRpb25OYW1lIC1Db25maXJtOiRmYWxzZQogICAgICAgIFdyaXRlTGluZQogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ3JlYXRlIEFjY2VzcyBTZXJ2aWNlcyAoMjAxMykKRnVuY3Rpb24gQ3JlYXRlQWNjZXNzU2VydmljZXNBcHAgKFt4bWxdJHhtbGlucHV0KQp7CiAgICAkb2ZmaWNlU2VydmVyUHJlbWl1bSA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkluc3RhbGwuU0tVIC1yZXBsYWNlICJFbnRlcnByaXNlIiwiMSIgLXJlcGxhY2UgIlN0YW5kYXJkIiwiMCIKICAgICRkYlNlcnZlciA9ICRzZXJ2aWNlQ29uZmlnLkRhdGFiYXNlLkRCU2VydmVyCiAgICAjIElmIHdlIGhhdmVuJ3Qgc3BlY2lmaWVkIGEgREIgU2VydmVyIHRoZW4ganVzdCB1c2UgdGhlIGRlZmF1bHQgdXNlZCBieSB0aGUgRmFybQogICAgSWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRkYlNlcnZlcikpCiAgICB7CiAgICAgICAgJGRiU2VydmVyID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5EYXRhYmFzZS5EQlNlcnZlcgogICAgfQogICAgJGRiUHJlZml4ID0gR2V0LURCUHJlZml4ICR4bWxpbnB1dAogICAgJHNlcnZpY2VEQiA9ICRkYlByZWZpeCskKCRzZXJ2aWNlQ29uZmlnLkRhdGFiYXNlLk5hbWUpCiAgICAkc2VydmljZUNvbmZpZyA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5BY2Nlc3NTZXJ2aWNlcwogICAgSWYgKChTaG91bGRJUHJvdmlzaW9uICRzZXJ2aWNlQ29uZmlnIC1lcSAkdHJ1ZSkgLWFuZCAoR2V0LUNvbW1hbmQgLU5hbWUgTmV3LVNQQWNjZXNzU2VydmljZXNBcHBsaWNhdGlvbiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkpCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgaWYgKCRvZmZpY2VTZXJ2ZXJQcmVtaXVtIC1lcSAiMSIpCiAgICAgICAgewogICAgICAgICAgICAkc2VydmljZUluc3RhbmNlVHlwZSA9ICJNaWNyb3NvZnQuT2ZmaWNlLkFjY2Vzcy5TZXJ2aWNlcy5Nb3NzSG9zdC5BY2Nlc3NTZXJ2aWNlc1dlYlNlcnZpY2VJbnN0YW5jZSIKICAgICAgICAgICAgQ3JlYXRlR2VuZXJpY1NlcnZpY2VBcHBsaWNhdGlvbiAtU2VydmljZUNvbmZpZyAkc2VydmljZUNvbmZpZyBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VJbnN0YW5jZVR5cGUgJHNlcnZpY2VJbnN0YW5jZVR5cGUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlTmFtZSAkc2VydmljZUNvbmZpZy5OYW1lIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZVByb3h5TmFtZSAkc2VydmljZUNvbmZpZy5Qcm94eU5hbWUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlR2V0Q21kbGV0ICJHZXQtU1BBY2Nlc3NTZXJ2aWNlc0FwcGxpY2F0aW9uIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VQcm94eUdldENtZGxldCAiR2V0LVNQU2VydmljZXNBcHBsaWNhdGlvblByb3h5IiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VOZXdDbWRsZXQgIk5ldy1TUEFjY2Vzc1NlcnZpY2VzQXBwbGljYXRpb24gLURhdGFiYXNlU2VydmVyICRkYlNlcnZlciAtRGVmYXVsdCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlOZXdDbWRsZXQgIk5ldy1TUEFjY2Vzc1NlcnZpY2VzQXBwbGljYXRpb25Qcm94eSIKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgbG9nICJXQVJOSU5HOllvdSBoYXZlIHNwZWNpZmllZCBhIG5vbi1FbnRlcnByaXNlIFNLVSBpbiBgIiQoU3BsaXQtUGF0aCAtUGF0aCAkaW5wdXRGaWxlIC1MZWFmKWAiLiBIb3dldmVyLCBTaGFyZVBvaW50IHJlcXVpcmVzIHRoZSBFbnRlcnByaXNlIFNLVSBhbmQgY29ycmVzcG9uZGluZyBQSURLZXkgdG8gcHJvdmlzaW9uIEFjY2VzcyBTZXJ2aWNlcyAyMDEwLiIKICAgICAgICB9CiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cn0KCiNFbmRSZWdpb24KCiNSZWdpb24gUG93ZXJQb2ludCBDb252ZXJzaW9uIFNlcnZpY2UKRnVuY3Rpb24gQ3JlYXRlUG93ZXJQb2ludENvbnZlcnNpb25TZXJ2aWNlQXBwIChbeG1sXSR4bWxpbnB1dCkKewogICAgJHNlcnZpY2VDb25maWcgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5Qb3dlclBvaW50Q29udmVyc2lvblNlcnZpY2UKICAgIElmICgoU2hvdWxkSVByb3Zpc2lvbiAkc2VydmljZUNvbmZpZyAtZXEgJHRydWUpIC1hbmQgKEdldC1Db21tYW5kIC1OYW1lIE5ldy1TUFBvd2VyUG9pbnRDb252ZXJzaW9uU2VydmljZUFwcGxpY2F0aW9uIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSkKICAgIHsKICAgICAgICBXcml0ZUxpbmUKICAgICAgICAkc2VydmljZUluc3RhbmNlVHlwZSA9ICJNaWNyb3NvZnQuT2ZmaWNlLlNlcnZlci5Qb3dlclBvaW50LkFkbWluaXN0cmF0aW9uLlBvd2VyUG9pbnRDb252ZXJzaW9uU2VydmljZUluc3RhbmNlIgogICAgICAgIENyZWF0ZUdlbmVyaWNTZXJ2aWNlQXBwbGljYXRpb24gLVNlcnZpY2VDb25maWcgJHNlcnZpY2VDb25maWcgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VJbnN0YW5jZVR5cGUgJHNlcnZpY2VJbnN0YW5jZVR5cGUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VOYW1lICRzZXJ2aWNlQ29uZmlnLk5hbWUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VQcm94eU5hbWUgJHNlcnZpY2VDb25maWcuUHJveHlOYW1lIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlR2V0Q21kbGV0ICJHZXQtU1BTZXJ2aWNlQXBwbGljYXRpb24iIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlHZXRDbWRsZXQgIkdldC1TUFNlcnZpY2VBcHBsaWNhdGlvblByb3h5IiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZU5ld0NtZGxldCAiTmV3LVNQUG93ZXJQb2ludENvbnZlcnNpb25TZXJ2aWNlQXBwbGljYXRpb24iIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlOZXdDbWRsZXQgIk5ldy1TUFBvd2VyUG9pbnRDb252ZXJzaW9uU2VydmljZUFwcGxpY2F0aW9uUHJveHkiCiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBDcmVhdGUgTWFjaGluZSBUcmFuc2xhdGlvbiBTZXJ2aWNlCkZ1bmN0aW9uIENyZWF0ZU1hY2hpbmVUcmFuc2xhdGlvblNlcnZpY2VBcHAgKFt4bWxdJHhtbGlucHV0KQp7CiAgICAkc2VydmljZUNvbmZpZyA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLk1hY2hpbmVUcmFuc2xhdGlvblNlcnZpY2UKICAgICRkYlNlcnZlciA9ICRzZXJ2aWNlQ29uZmlnLkRhdGFiYXNlLkRCU2VydmVyCiAgICAjIElmIHdlIGhhdmVuJ3Qgc3BlY2lmaWVkIGEgREIgU2VydmVyIHRoZW4ganVzdCB1c2UgdGhlIGRlZmF1bHQgdXNlZCBieSB0aGUgRmFybQogICAgSWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRkYlNlcnZlcikpCiAgICB7CiAgICAgICAgJGRiU2VydmVyID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5EYXRhYmFzZS5EQlNlcnZlcgogICAgfQogICAgJGRiUHJlZml4ID0gR2V0LURCUHJlZml4ICR4bWxpbnB1dAogICAgJHRyYW5zbGF0aW9uRGF0YWJhc2UgPSAkZGJQcmVmaXgrJCgkc2VydmljZUNvbmZpZy5EYXRhYmFzZS5OYW1lKQogICAgSWYgKChTaG91bGRJUHJvdmlzaW9uICRzZXJ2aWNlQ29uZmlnIC1lcSAkdHJ1ZSkgLWFuZCAoR2V0LUNvbW1hbmQgLU5hbWUgTmV3LVNQVHJhbnNsYXRpb25TZXJ2aWNlQXBwbGljYXRpb24gLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpKQogICAgewogICAgICAgIFdyaXRlTGluZQogICAgICAgICRzZXJ2aWNlSW5zdGFuY2VUeXBlID0gIk1pY3Jvc29mdC5PZmZpY2UuVHJhbnNsYXRpb25TZXJ2aWNlcy5UcmFuc2xhdGlvblNlcnZpY2VJbnN0YW5jZSIKICAgICAgICBDcmVhdGVHZW5lcmljU2VydmljZUFwcGxpY2F0aW9uIC1TZXJ2aWNlQ29uZmlnICRzZXJ2aWNlQ29uZmlnIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlSW5zdGFuY2VUeXBlICRzZXJ2aWNlSW5zdGFuY2VUeXBlIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlTmFtZSAkc2VydmljZUNvbmZpZy5OYW1lIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlOYW1lICRzZXJ2aWNlQ29uZmlnLlByb3h5TmFtZSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZUdldENtZGxldCAiR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZVByb3h5R2V0Q21kbGV0ICJHZXQtU1BTZXJ2aWNlQXBwbGljYXRpb25Qcm94eSIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VOZXdDbWRsZXQgIk5ldy1TUFRyYW5zbGF0aW9uU2VydmljZUFwcGxpY2F0aW9uIC1EYXRhYmFzZVNlcnZlciAkZGJTZXJ2ZXIgLURhdGFiYXNlTmFtZSAkdHJhbnNsYXRpb25EYXRhYmFzZSAtRGVmYXVsdCIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VQcm94eU5ld0NtZGxldCAiTmV3LVNQVHJhbnNsYXRpb25TZXJ2aWNlQXBwbGljYXRpb25Qcm94eSIKICAgICAgICBXcml0ZUxpbmUKICAgIH0KfQojRW5kUmVnaW9uCgojUmVnaW9uIENyZWF0ZSBXb3JrIE1hbmFnZW1lbnQgU2VydmljZQpGdW5jdGlvbiBDcmVhdGVXb3JrTWFuYWdlbWVudFNlcnZpY2VBcHAgKFt4bWxdJHhtbGlucHV0KQp7CiAgICAkc2VydmljZUNvbmZpZyA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLldvcmtNYW5hZ2VtZW50U2VydmljZQogICAgSWYgKChTaG91bGRJUHJvdmlzaW9uICRzZXJ2aWNlQ29uZmlnIC1lcSAkdHJ1ZSkgLWFuZCAoR2V0LUNvbW1hbmQgLU5hbWUgTmV3LVNQV29ya01hbmFnZW1lbnRTZXJ2aWNlQXBwbGljYXRpb24gLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpIC1hbmQgKEdldC1TUFNlcnZpY2VJbnN0YW5jZSB8IFdoZXJlLU9iamVjdCB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLlNlcnZlci5Xb3JrTWFuYWdlbWVudC5Xb3JrTWFuYWdlbWVudFNlcnZpY2VJbnN0YW5jZSJ9KSkKICAgIHsKICAgICAgICBXcml0ZUxpbmUKICAgICAgICAkc2VydmljZUluc3RhbmNlVHlwZSA9ICJNaWNyb3NvZnQuT2ZmaWNlLlNlcnZlci5Xb3JrTWFuYWdlbWVudC5Xb3JrTWFuYWdlbWVudFNlcnZpY2VJbnN0YW5jZSIKICAgICAgICBDcmVhdGVHZW5lcmljU2VydmljZUFwcGxpY2F0aW9uIC1TZXJ2aWNlQ29uZmlnICRzZXJ2aWNlQ29uZmlnIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlSW5zdGFuY2VUeXBlICRzZXJ2aWNlSW5zdGFuY2VUeXBlIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlTmFtZSAkc2VydmljZUNvbmZpZy5OYW1lIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlOYW1lICRzZXJ2aWNlQ29uZmlnLlByb3h5TmFtZSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZUdldENtZGxldCAiR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZVByb3h5R2V0Q21kbGV0ICJHZXQtU1BTZXJ2aWNlQXBwbGljYXRpb25Qcm94eSIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VOZXdDbWRsZXQgIk5ldy1TUFdvcmtNYW5hZ2VtZW50U2VydmljZUFwcGxpY2F0aW9uIiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZVByb3h5TmV3Q21kbGV0ICJOZXctU1BXb3JrTWFuYWdlbWVudFNlcnZpY2VBcHBsaWNhdGlvblByb3h5IgogICAgICAgIFdyaXRlTGluZQogICAgfQp9CiNFbmRSZWdpb24KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBDcmVhdGUgUHJvamVjdCBTZXJ2ZXIgU2VydmljZSBBcHBsaWNhdGlvbgpGdW5jdGlvbiBDcmVhdGVQcm9qZWN0U2VydmVyU2VydmljZUFwcCAoW3htbF0keG1saW5wdXQpCnsKICAgICRzZXJ2aWNlQ29uZmlnID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uUHJvamVjdFNlcnZlci5TZXJ2aWNlQXBwCiAgICBJZiAoKFNob3VsZElQcm92aXNpb24gJHNlcnZpY2VDb25maWcgLWVxICR0cnVlKSAtYW5kICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5Qcm9qZWN0U2VydmVyLkluc3RhbGwgLWVxICR0cnVlKSAtYW5kIChHZXQtQ29tbWFuZCAtTmFtZSBOZXctU1BQcm9qZWN0U2VydmljZUFwcGxpY2F0aW9uIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSkgIyBXZSBuZWVkIHRvIGNoZWNrIHRoYXQgUHJvamVjdCBTZXJ2ZXIgaGFzIGJlZW4gcmVxdWVzdGVkIGZvciBpbnN0YWxsLCBub3QganVzdCBpZiB0aGUgc2VydmljZSBhcHAgc2hvdWxkIGJlIHByb3Zpc2lvbmVkCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgJGRiUHJlZml4ID0gR2V0LURCUHJlZml4ICR4bWxpbnB1dAoJICAgICRzZXJ2aWNlREIgPSAkZGJQcmVmaXgrJHNlcnZpY2VDb25maWcuRGF0YWJhc2UuTmFtZQoJICAgICRkYlNlcnZlciA9ICRzZXJ2aWNlQ29uZmlnLkRhdGFiYXNlLkRCU2VydmVyCgkgICAgIyBJZiB3ZSBoYXZlbid0IHNwZWNpZmllZCBhIERCIFNlcnZlciB0aGVuIGp1c3QgdXNlIHRoZSBkZWZhdWx0IHVzZWQgYnkgdGhlIEZhcm0KCSAgICBJZiAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJGRiU2VydmVyKSkKCSAgICB7CgkgICAgICAgICRkYlNlcnZlciA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uRGF0YWJhc2UuREJTZXJ2ZXIKCSAgICB9CiAgICAgICAgJHNlcnZpY2VJbnN0YW5jZVR5cGUgPSAiTWljcm9zb2Z0Lk9mZmljZS5Qcm9qZWN0LlNlcnZlci5BZG1pbmlzdHJhdGlvbi5Qc2lTZXJ2aWNlSW5zdGFuY2UiCiAgICAgICAgQ3JlYXRlR2VuZXJpY1NlcnZpY2VBcHBsaWNhdGlvbiAtU2VydmljZUNvbmZpZyAkc2VydmljZUNvbmZpZyBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZUluc3RhbmNlVHlwZSAkc2VydmljZUluc3RhbmNlVHlwZSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZU5hbWUgJHNlcnZpY2VDb25maWcuTmFtZSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtU2VydmljZVByb3h5TmFtZSAkc2VydmljZUNvbmZpZy5Qcm94eU5hbWUgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VHZXRDbWRsZXQgIkdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiIgYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLVNlcnZpY2VQcm94eUdldENtZGxldCAiR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uUHJveHkiIGAKCQkJCQkJCQkJICAgIC1TZXJ2aWNlTmV3Q21kbGV0ICJOZXctU1BQcm9qZWN0U2VydmljZUFwcGxpY2F0aW9uIC1Qcm94eTpgJHRydWUiIGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1TZXJ2aWNlUHJveHlOZXdDbWRsZXQgIk5ldy1TUFByb2plY3RTZXJ2aWNlQXBwbGljYXRpb25Qcm94eSIgIyBXZSB3b24ndCBiZSB1c2luZyB0aGUgcHJveHkgY21kbGV0IHRob3VnaCBmb3IgUHJvamVjdCBTZXJ2ZXIKCiAgICAgICAgIyBVcGRhdGUgcHJvY2VzcyBhY2NvdW50IGZvciBQcm9qZWN0IHNlcnZpY2VzCiAgICAgICAgJHByb2plY3RTZXJ2aWNlcyA9IEAoIk1pY3Jvc29mdC5PZmZpY2UuUHJvamVjdC5TZXJ2ZXIuQWRtaW5pc3RyYXRpb24uUHJvamVjdEV2ZW50U2VydmljZSIsICJNaWNyb3NvZnQuT2ZmaWNlLlByb2plY3QuU2VydmVyLkFkbWluaXN0cmF0aW9uLlByb2plY3RDYWxjU2VydmljZSIsICJNaWNyb3NvZnQuT2ZmaWNlLlByb2plY3QuU2VydmVyLkFkbWluaXN0cmF0aW9uLlByb2plY3RRdWV1ZVNlcnZpY2UiKQogICAgICAgIGZvcmVhY2ggKCRwcm9qZWN0U2VydmljZSBpbiAkcHJvamVjdFNlcnZpY2VzKQogICAgICAgIHsKICAgICAgICAgICAgJHByb2plY3RTZXJ2aWNlSW5zdGFuY2VzID0gKEdldC1TUEZhcm0pLlNlcnZpY2VzIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICRwcm9qZWN0U2VydmljZX0KICAgICAgICAgICAgZm9yZWFjaCAoJHByb2plY3RTZXJ2aWNlSW5zdGFuY2UgaW4gJHByb2plY3RTZXJ2aWNlSW5zdGFuY2VzKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBVcGRhdGVQcm9jZXNzSWRlbnRpdHkgJHByb2plY3RTZXJ2aWNlSW5zdGFuY2UKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAjIENyZWF0ZSBhIFByb2plY3QgU2VydmVyIERCCiAgICAgICAgJHBvcnRhbFdlYkFwcCA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLldlYkFwcGxpY2F0aW9ucy5XZWJBcHBsaWNhdGlvbiB8IFdoZXJlIHskXy5UeXBlIC1lcSAiUG9ydGFsIn0gfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxCiAgICAgICAgaWYgKCEoR2V0LVNQRGF0YWJhc2UgfCBXaGVyZS1PYmplY3QgeyRfLk5hbWUgLWVxICRzZXJ2aWNlREJ9KSkKICAgICAgICB7CiAgICAgICAgICAgIGlmIChHZXQtQ29tbWFuZCAtTmFtZSBOZXctU1BQcm9qZWN0RGF0YWJhc2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpICMgQ2hlY2sgZm9yIHRoaXMgc2luY2UgaXQgbm8gbG9uZ2VyIGV4aXN0cyBpbiBTUDIwMTYKICAgICAgICAgICAgewogICAgICAgICAgICAgICBsb2cgIiAtIENyZWF0aW5nIFByb2plY3QgU2VydmVyIGRhdGFiYXNlIGAiJHNlcnZpY2VEQmAiLi4uIiAKICAgICAgICAgICAgICAgTmV3LVNQUHJvamVjdERhdGFiYXNlIC1OYW1lICRzZXJ2aWNlREIgLVNlcnZpY2VBcHBsaWNhdGlvbiAoR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uIHwgV2hlcmUtT2JqZWN0IHskXy5OYW1lIC1lcSAkc2VydmljZUNvbmZpZy5OYW1lfSkgLURhdGFiYXNlU2VydmVyICRkYlNlcnZlciB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICBpZiAoJD8pIHtsb2cgIkRvbmUuIn0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIi4iCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgeyJFcnJvciBjcmVhdGluZyB0aGUgUHJvamVjdCBTZXJ2ZXIgZGF0YWJhc2UuIn0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBsb2cgIkFscmVhZHkgZXhpdHMuIgogICAgICAgIH0KICAgICAgICAjIENyZWF0ZSBhIFByb2plY3QgU2VydmVyIFdlYiBJbnN0YW5jZQogICAgICAgICRwcm9qZWN0TWFuYWdlZFBhdGggPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5Qcm9qZWN0U2VydmVyLlNlcnZpY2VBcHAuTWFuYWdlZFBhdGgKICAgICAgICBOZXctU1BNYW5hZ2VkUGF0aCAtUmVsYXRpdmVVUkwgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uUHJvamVjdFNlcnZlci5TZXJ2aWNlQXBwLk1hbmFnZWRQYXRoIC1XZWJBcHBsaWNhdGlvbiAoR2V0LVNQV2ViQXBwbGljYXRpb24gfCBXaGVyZS1PYmplY3QgeyRfLk5hbWUgLWVxICRwb3J0YWxXZWJBcHAuTmFtZX0pIC1FeHBsaWNpdDokdHJ1ZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IE91dC1OdWxsCiAgICAgICAgbG9nICIgLSBDcmVhdGluZyBQcm9qZWN0IFNlcnZlciBzaXRlIGNvbGxlY3Rpb24gYXQgYCIkcHJvamVjdE1hbmFnZWRQYXRoYCIuLi4iIAogICAgICAgICRwcm9qZWN0U2l0ZVVybCA9ICRwb3J0YWxXZWJBcHAuVXJsKyI6IiskcG9ydGFsV2ViQXBwLlBvcnQrIi8iKyRwcm9qZWN0TWFuYWdlZFBhdGgKICAgICAgICBpZiAoIShHZXQtU1BTaXRlIC1JZGVudGl0eSAkcHJvamVjdFNpdGVVcmwgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpKQogICAgICAgIHsKICAgICAgICAgICAgJHByb2plY3RTaXRlID0gTmV3LVNQU2l0ZSAtVXJsICRwcm9qZWN0U2l0ZVVybCAgLU93bmVyQWxpYXMgJGVudjpVU0VSRE9NQUlOXCRlbnY6VVNFUk5BTUUgLVRlbXBsYXRlICJQUk9KRUNUU0lURSMwIgogICAgICAgICAgICBpZiAoJD8pIHtsb2cgIkRvbmUuIn0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIi4iCiAgICAgICAgICAgICAgICB0aHJvdyB7IkVycm9yIGNyZWF0aW5nIHRoZSBQcm9qZWN0IFNlcnZlciBzaXRlIGNvbGxlY3Rpb24uIn0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBsb2cgIkFscmVhZHkgZXhpdHMuIgogICAgICAgIH0KICAgICAgICBsb2cgIiAtIENyZWF0aW5nIFByb2plY3QgU2VydmVyIHdlYiBpbnN0YW5jZSBhdCBgIiRwcm9qZWN0U2l0ZVVybGAiLi4uIiAKICAgICAgICBpZiAoIShHZXQtU1BQcm9qZWN0V2ViSW5zdGFuY2UgLVVybCAkcHJvamVjdFNpdGVVcmwgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKEdldC1Db21tYW5kIC1OYW1lIE1vdW50LVNQUHJvamVjdFdlYkluc3RhbmNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSAjIENoZWNrIGZvciB0aGlzIHNpbmNlIGl0IG5vIGxvbmdlciBleGlzdHMgaW4gU1AyMDE2CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIE1vdW50LVNQUHJvamVjdFdlYkluc3RhbmNlIC1EYXRhYmFzZU5hbWUgJHNlcnZpY2VEQiAtU2l0ZUNvbGxlY3Rpb24gJHByb2plY3RTaXRlCiAgICAgICAgICAgICAgICBpZiAoJD8pIHtsb2cgIkRvbmUuIn0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIi4iCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgeyJFcnJvciBjcmVhdGluZyB0aGUgUHJvamVjdCBTZXJ2ZXIgd2ViIGluc3RhbmNlLiJ9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgbG9nICJBbHJlYWR5IGV4aXRzLiIKICAgICAgICB9CiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBDb25maWd1cmUgT3V0Z29pbmcgRW1haWwKIyBUaGlzIGlzIGZyb20gaHR0cDovL2F1dG9zcGluc3RhbGxlci5jb2RlcGxleC5jb20vZGlzY3Vzc2lvbnMvMjI4NTA3P1Byb2plY3ROYW1lPWF1dG9zcGluc3RhbGxlciBjb3VydGVzeSBvZiByeWJvY2YKRnVuY3Rpb24gQ29uZmlndXJlT3V0Z29pbmdFbWFpbAp7CiAgICBJZiAoJCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZpY2VzLk91dGdvaW5nRW1haWwuQ29uZmlndXJlKSAtZXEgJHRydWUpCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgVHJ5CiAgICAgICAgewogICAgICAgICAgICAkU01UUFNlcnZlciA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuT3V0Z29pbmdFbWFpbC5TTVRQU2VydmVyCiAgICAgICAgICAgICRlbWFpbEFkZHJlc3MgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZpY2VzLk91dGdvaW5nRW1haWwuRW1haWxBZGRyZXNzCiAgICAgICAgICAgICRyZXBseVRvRW1haWwgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZpY2VzLk91dGdvaW5nRW1haWwuUmVwbHlUb0VtYWlsCiAgICAgICAgICAgIGxvZyAiIC0gQ29uZmlndXJpbmcgT3V0Z29pbmcgRW1haWwuLi4iCiAgICAgICAgICAgICRsb2FkYXNtID0gW1N5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5XTo6TG9hZFdpdGhQYXJ0aWFsTmFtZSgiTWljcm9zb2Z0LlNoYXJlUG9pbnQiKQogICAgICAgICAgICAkc3BHbG9iYWxBZG1pbiA9IE5ldy1PYmplY3QgTWljcm9zb2Z0LlNoYXJlUG9pbnQuQWRtaW5pc3RyYXRpb24uU1BHbG9iYWxBZG1pbgogICAgICAgICAgICAkc3BHbG9iYWxBZG1pbi5VcGRhdGVNYWlsU2V0dGluZ3MoJFNNVFBTZXJ2ZXIsICRlbWFpbEFkZHJlc3MsICRyZXBseVRvRW1haWwsIDY1MDAxKQogICAgICAgIH0KICAgICAgICBDYXRjaAogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICRfCiAgICAgICAgfQogICAgICAgIFdyaXRlTGluZQogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ29uZmlndXJlIEluY29taW5nIEVtYWlsCkZ1bmN0aW9uIENvbmZpZ3VyZUluY29taW5nRW1haWwKewogICAgIyBFbnN1cmUgdGhlIG5vZGUgZXhpc3RzIGluIHRoZSBYTUwgZmlyc3QgYXMgd2UgZG9uJ3Qgd2FudCB0byBpbmFkdmVydGVudGx5IGRpc2FibGUgdGhlIHNlcnZpY2UgaWYgaXQgd2Fzbid0IGV4cGxpY2l0bHkgc3BlY2lmaWVkCiAgICBpZiAoKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuU2VsZWN0U2luZ2xlTm9kZSgiSW5jb21pbmdFbWFpbCIpKSAtYW5kICEoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZpY2VzLkluY29taW5nRW1haWwgLWVxICR0cnVlKSkKICAgIHsKICAgICAgICBTdG9wU2VydmljZUluc3RhbmNlICJNaWNyb3NvZnQuU2hhcmVQb2ludC5BZG1pbmlzdHJhdGlvbi5TUEluY29taW5nRW1haWxTZXJ2aWNlSW5zdGFuY2UiCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBDb25maWd1cmUgRm91bmRhdGlvbiBXZWIgQXBwbGljYXRpb24gU2VydmljZQpGdW5jdGlvbiBDb25maWd1cmVGb3VuZGF0aW9uV2ViQXBwbGljYXRpb25TZXJ2aWNlCnsKICAgIFdyaXRlTGluZQogICAgR2V0LU1ham9yVmVyc2lvbk51bWJlciAkeG1saW5wdXQKICAgICRtaW5Sb2xlUmVxdWlyZXNGb3VuZGF0aW9uV2ViQXBwU2VydmljZSA9ICRmYWxzZQogICAgIyBDaGVjayBpZiB3ZSBhcmUgaW5zdGFsbGluZyBTaGFyZVBvaW50IDIwMTYgYW5kIHdlJ3JlIHJlcXVlc3RpbmcgYSBNaW5Sb2xlIHRoYXQgcmVxdWlyZXMgdGhlIEZvdW5kYXRpb24gV2ViIEFwcGxpY2F0aW9uIFNlcnZpY2UKICAgIGlmICgkZW52OlNQVmVyIC1nZSAxNikKICAgIHsKICAgICAgICBpZiAoKFNob3VsZElQcm92aXNpb24gKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmVyUm9sZXMuQXBwbGljYXRpb24pKSAtb3IgKFNob3VsZElQcm92aXNpb24gKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmVyUm9sZXMuRGlzdHJpYnV0ZWRDYWNoZSkpIC1vciAoU2hvdWxkSVByb3Zpc2lvbiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2ZXJSb2xlcy5TaW5nbGVTZXJ2ZXJGYXJtKSkgLW9yIChTaG91bGRJUHJvdmlzaW9uICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZlclJvbGVzLldlYkZyb250RW5kKSkpCiAgICAgICAgewogICAgICAgICAgICAkbWluUm9sZVJlcXVpcmVzRm91bmRhdGlvbldlYkFwcFNlcnZpY2UgPSAkdHJ1ZQogICAgICAgIH0KICAgIH0KICAgICMgRW5zdXJlIHRoZSBub2RlIGV4aXN0cyBpbiB0aGUgWE1MIGZpcnN0IGFzIHdlIGRvbid0IHdhbnQgdG8gaW5hZHZlcnRlbnRseSBzdG9wL2Rpc2FibGUgdGhlIHNlcnZpY2UgaWYgaXQgd2Fzbid0IGV4cGxpY2l0bHkgc3BlY2lmaWVkCiAgICBpZiAoKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuU2VsZWN0U2luZ2xlTm9kZSgiRm91bmRhdGlvbldlYkFwcGxpY2F0aW9uIikpIC1hbmQgIShTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuRm91bmRhdGlvbldlYkFwcGxpY2F0aW9uIC1lcSAkdHJ1ZSkgLWFuZCAhKCRtaW5Sb2xlUmVxdWlyZXNGb3VuZGF0aW9uV2ViQXBwU2VydmljZSkpCiAgICB7CiAgICAgICAgU3RvcFNlcnZpY2VJbnN0YW5jZSAiTWljcm9zb2Z0LlNoYXJlUG9pbnQuQWRtaW5pc3RyYXRpb24uU1BXZWJTZXJ2aWNlSW5zdGFuY2UiCiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgIyBTdGFydCB0aGUgc2VydmljZSwgaWYgaXQgaXNuJ3QgYWxyZWFkeSBydW5uaW5nCiAgICAgICAgJHNlcnZpY2VJbnN0YW5jZVR5cGUgPSAiTWljcm9zb2Z0LlNoYXJlUG9pbnQuQWRtaW5pc3RyYXRpb24uU1BXZWJTZXJ2aWNlSW5zdGFuY2UiCiAgICAgICAgIyBHZXQgYWxsIG9jY3VycmVuY2VzIG9mIHRoZSBGb3VuZGF0aW9uIFdlYiBBcHAgU2VydmljZSBleGNlcHQgdGhvc2Ugd2hpY2ggYXJlIGFjdHVhbGx5IENlbnRyYWwgQWRtaW5pc3RyYXRpb24gaW5zdGFuY2VzCiAgICAgICAgJHNlcnZpY2VJbnN0YW5jZXMgPSBHZXQtU1BTZXJ2aWNlSW5zdGFuY2UgfCA/IHskXy5HZXRUeXBlKCkuVG9TdHJpbmcoKSAtZXEgJHNlcnZpY2VJbnN0YW5jZVR5cGUgLWFuZCAkXy5OYW1lIC1uZSAiV1NTX0FkbWluaXN0cmF0aW9uIn0KICAgICAgICAkc2VydmljZUluc3RhbmNlID0gJHNlcnZpY2VJbnN0YW5jZXMgfCA/IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXIuQWRkcmVzcyAkZW52OkNPTVBVVEVSTkFNRX0KICAgICAgICBJZiAoISRzZXJ2aWNlSW5zdGFuY2UpIHsgVGhyb3cgIiAtIEZhaWxlZCB0byBnZXQgc2VydmljZSBpbnN0YW5jZSAtIGNoZWNrIHByb2R1Y3QgdmVyc2lvbiAoU3RhbmRhcmQgdnMuIEVudGVycHJpc2UpIiB9CiAgICAgICAgbG9nICIgLSBDaGVja2luZyAkKCRzZXJ2aWNlSW5zdGFuY2UuVHlwZU5hbWUpIGluc3RhbmNlLi4uIgogICAgICAgIElmICgoJHNlcnZpY2VJbnN0YW5jZS5TdGF0dXMgLWVxICJEaXNhYmxlZCIpIC1vciAoJHNlcnZpY2VJbnN0YW5jZS5TdGF0dXMgLW5lICJPbmxpbmUiKSkKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAiIC0gU3RhcnRpbmcgJCgkc2VydmljZUluc3RhbmNlLlR5cGVOYW1lKSBpbnN0YW5jZS4uLiIKICAgICAgICAgICAgJHNlcnZpY2VJbnN0YW5jZS5Qcm92aXNpb24oKQogICAgICAgICAgICBJZiAoLW5vdCAkPykgeyBUaHJvdyAiIC0gRmFpbGVkIHRvIHN0YXJ0ICQoJHNlcnZpY2VJbnN0YW5jZS5UeXBlTmFtZSkgaW5zdGFuY2UiIH0KICAgICAgICAgICAgIyBXYWl0CiAgICAgICAgICAgIGxvZyAiIC0gV2FpdGluZyBmb3IgJCgkc2VydmljZUluc3RhbmNlLlR5cGVOYW1lKSBpbnN0YW5jZS4uLiIgCiAgICAgICAgICAgIFdoaWxlICgkc2VydmljZUluc3RhbmNlLlN0YXR1cyAtbmUgIk9ubGluZSIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiLiIgCiAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAxCiAgICAgICAgICAgICAgICAkc2VydmljZUluc3RhbmNlcyA9IEdldC1TUFNlcnZpY2VJbnN0YW5jZSB8ID8geyRfLkdldFR5cGUoKS5Ub1N0cmluZygpIC1lcSAkc2VydmljZUluc3RhbmNlVHlwZX0KICAgICAgICAgICAgICAgICRzZXJ2aWNlSW5zdGFuY2UgPSAkc2VydmljZUluc3RhbmNlcyB8ID8ge01hdGNoQ29tcHV0ZXJOYW1lICRfLlNlcnZlci5BZGRyZXNzICRlbnY6Q09NUFVURVJOQU1FfQogICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2cgJCgkc2VydmljZUluc3RhbmNlLlN0YXR1cykKICAgICAgICB9CiAgICAgICAgRWxzZQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSAkKCRzZXJ2aWNlSW5zdGFuY2UuVHlwZU5hbWUpIGluc3RhbmNlIGFscmVhZHkgc3RhcnRlZC4iCiAgICAgICAgfQogICAgfQogICAgV3JpdGVMaW5lCn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBDb25maWd1cmUgQWRvYmUgUERGIEluZGV4aW5nIGFuZCBEaXNwbGF5CiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogQ29uZmlndXJlLVBERlNlYXJjaEFuZEljb24KIyBEZXNjOiBEb3dubG9hZHMgYW5kIGluc3RhbGxzIHRoZSBQREYgaUZpbHRlciwgcmVnaXN0ZXJzIHRoZSBQREYgc2VhcmNoIGZpbGUgdHlwZSBhbmQgZG9jdW1lbnQgaWNvbiBmb3IgZGlzcGxheSBpbiBTaGFyZVBvaW50CiMgRnJvbTogQWRhcHRlZC9jb21iaW5lZCBmcm9tIEBicmlhbmxhbGEncyBhZGRpdGlvbnMsIEB0b25pZnJhbmtvbGEncyBodHRwOi8vd3d3LnNoYXJlcG9pbnR1c2VjYXNlcy5jb20vaW5kZXgucGhwLzIwMTEvMDIvYXV0b21hdGUtcGRmLWNvbmZpZ3VyYXRpb24tZm9yLXNoYXJlcG9pbnQtMjAxMC12aWEtcG93ZXJzaGVsbC8KIyBBbmQgOiBQYXVsIEhpY2ttYW4ncyBQYXRjaCA5NjA5IGF0IGh0dHA6Ly9hdXRvc3BpbnN0YWxsZXIuY29kZXBsZXguY29tL1NvdXJjZUNvbnRyb2wvbGlzdC9wYXRjaGVzCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpGdW5jdGlvbiBDb25maWd1cmUtUERGU2VhcmNoQW5kSWNvbgp7CiAgICBXcml0ZUxpbmUKICAgIEdldC1NYWpvclZlcnNpb25OdW1iZXIgJHhtbGlucHV0CiAgICBsb2cgIiAtIENvbmZpZ3VyaW5nIFBERiBmaWxlIHNlYXJjaCwgZGlzcGxheSBhbmQgaGFuZGxpbmcuLi4iCiAgICAkc2hhcmVQb2ludFJvb3QgPSAiJGVudjpDb21tb25Qcm9ncmFtRmlsZXNcTWljcm9zb2Z0IFNoYXJlZFxXZWIgU2VydmVyIEV4dGVuc2lvbnNcJGVudjpzcFZlciIKICAgICRzb3VyY2VGaWxlTG9jYXRpb25zID0gQCgiJGJpdHNcJHNwWWVhclxQREZcIiwiJGJpdHNcUERGXCIsIiRiaXRzXEFkb2JlUERGXCIsIiQoKEdldC1JdGVtICRlbnY6VEVNUCkuRnVsbE5hbWUpXCIpCiAgICAjIE9ubHkgaW5zdGFsbC9jb25maWd1cmUgaUZpbHRlciBpZiBzcGVjaWZpZWQsIGFuZCB3ZSBhcmUgcnVubmluZyBTUDIwMTAgKGFzIFNQMjAxMyBpbmNsdWRlcyBvbmUpCiAgICBJZiAoKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uQWRvYmVQREYuaUZpbHRlciAtZXEgJHRydWUpIC1hbmQgKCRlbnY6c3BWZXIgLWVxICIxNCIpKQogICAgewogICAgICAgICRwZGZJZmlsdGVyVXJsID0gImh0dHA6Ly9kb3dubG9hZC5hZG9iZS5jb20vcHViL2Fkb2JlL2Fjcm9iYXQvd2luLzkueC9QREZpRmlsdGVyNjRpbnN0YWxsZXIuemlwIgogICAgICAgIGxvZyAiIC0gQ29uZmlndXJpbmcgUERGIGZpbGUgaUZpbHRlciBhbmQgaW5kZXhpbmcuLi4iCiAgICAgICAgIyBMb29rIGZvciB0aGUgaW5zdGFsbGVyIG9yIHRoZSBpbnN0YWxsZXIgemlwIGluIHRoZSBwb3NzaWJsZSBsb2NhdGlvbnMKICAgICAgICBGb3JFYWNoICgkc291cmNlRmlsZUxvY2F0aW9uIGluICRzb3VyY2VGaWxlTG9jYXRpb25zKQogICAgICAgIHsKICAgICAgICAgICAgSWYgKEdldC1JdGVtICQoJHNvdXJjZUZpbGVMb2NhdGlvbisiUERGRmlsdGVyNjRpbnN0YWxsZXIubXNpIikgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiIC0gUERGIGlGaWx0ZXIgaW5zdGFsbGVyIGZvdW5kIGluICRzb3VyY2VGaWxlTG9jYXRpb24uIgogICAgICAgICAgICAgICAgJGlGaWx0ZXJJbnN0YWxsZXIgPSAkc291cmNlRmlsZUxvY2F0aW9uKyJQREZGaWx0ZXI2NGluc3RhbGxlci5tc2kiCiAgICAgICAgICAgICAgICBCcmVhawogICAgICAgICAgICB9CiAgICAgICAgICAgIEVsc2VJZiAoR2V0LUl0ZW0gJCgkc291cmNlRmlsZUxvY2F0aW9uKyJQREZpRmlsdGVyNjRpbnN0YWxsZXIuemlwIikgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiIC0gUERGIGlGaWx0ZXIgaW5zdGFsbGVyIHppcCBmaWxlIGZvdW5kIGluICRzb3VyY2VGaWxlTG9jYXRpb24uIgogICAgICAgICAgICAgICAgJHppcExvY2F0aW9uID0gJHNvdXJjZUZpbGVMb2NhdGlvbgogICAgICAgICAgICAgICAgJHNvdXJjZUZpbGUgPSAkc291cmNlRmlsZUxvY2F0aW9uKyJQREZpRmlsdGVyNjRpbnN0YWxsZXIuemlwIgogICAgICAgICAgICAgICAgQnJlYWsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAjIElmIHRoZSBNU0kgaGFzbid0IGJlZW4gZXh0cmFjdGVkIGZyb20gdGhlIHppcCB5ZXQgdGhlbiBleHRyYWN0IGl0CiAgICAgICAgSWYgKCEoJGlGaWx0ZXJJbnN0YWxsZXIpKQogICAgICAgIHsKICAgICAgICAgICAgIyBJZiB0aGUgemlwIGZpbGUgaXNuJ3QgcHJlc2VudCB0aGVuIGRvd25sb2FkIGl0IGZpcnN0CiAgICAgICAgICAgIElmICghKCRzb3VyY2VGaWxlKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgLSBQREYgaUZpbHRlciBpbnN0YWxsZXIgb3IgemlwIG5vdCBmb3VuZCwgZG93bmxvYWRpbmcuLi4iCiAgICAgICAgICAgICAgICBJZiAoQ29uZmlybS1Mb2NhbFNlc3Npb24pCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJHppcExvY2F0aW9uID0gKEdldC1JdGVtICRlbnY6VEVNUCkuRnVsbE5hbWUKICAgICAgICAgICAgICAgICAgICAkZGVzdGluYXRpb25GaWxlID0gJHppcExvY2F0aW9uKyJcUERGaUZpbHRlcjY0aW5zdGFsbGVyLnppcCIKICAgICAgICAgICAgICAgICAgICBJbXBvcnQtTW9kdWxlIEJpdHNUcmFuc2ZlciB8IE91dC1OdWxsCiAgICAgICAgICAgICAgICAgICAgU3RhcnQtQml0c1RyYW5zZmVyIC1Tb3VyY2UgJHBkZklmaWx0ZXJVcmwgLURlc3RpbmF0aW9uICRkZXN0aW5hdGlvbkZpbGUgLURpc3BsYXlOYW1lICJEb3dubG9hZGluZyBBZG9iZSBQREYgaUZpbHRlci4uLiIgLVByaW9yaXR5IEZvcmVncm91bmQgLURlc2NyaXB0aW9uICJGcm9tICRwZGZJZmlsdGVyVXJsLi4uIiAtRXJyb3JWYXJpYWJsZSBlcnIKICAgICAgICAgICAgICAgICAgICAjIE1LOiByZW1vdmVkIG9hdXNlCiAgICAgICAgICAgICAgICAgICAgSWYgKCRlcnIpIHtsb2cgIldBUk5JTkc6Q291bGQgbm90IGRvd25sb2FkIEFkb2JlIFBERiBpRmlsdGVyISI7IFBhdXNlICJleGl0IjsgYnJlYWt9CgogICAgICAgICAgICAgICAgICAgICRzb3VyY2VGaWxlID0gJGRlc3RpbmF0aW9uRmlsZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgRWxzZSB7bG9nICJXQVJOSU5HOlRoZSByZW1vdGUgdXNlIG9mIEJJVFMgaXMgbm90IHN1cHBvcnRlZC4gUGxlYXNlIHByZS1kb3dubG9hZCB0aGUgUERGIGluc3RhbGwgZmlsZXMgYW5kIHRyeSBhZ2Fpbi4ifQogICAgICAgICAgICB9CiAgICAgICAgICAgIGxvZyAiIC0gRXh0cmFjdGluZyBBZG9iZSBQREYgaUZpbHRlciBpbnN0YWxsZXIuLi4iCiAgICAgICAgICAgICRzaGVsbCA9IE5ldy1PYmplY3QgLUNvbU9iamVjdCBTaGVsbC5BcHBsaWNhdGlvbgogICAgICAgICAgICAkaUZpbHRlclppcCA9ICRzaGVsbC5OYW1lc3BhY2UoJHNvdXJjZUZpbGUpCiAgICAgICAgICAgICRsb2NhdGlvbiA9ICRzaGVsbC5OYW1lc3BhY2UoJHppcExvY2F0aW9uKQogICAgICAgICAgICAkbG9jYXRpb24uQ29weWhlcmUoJGlGaWx0ZXJaaXAuaXRlbXMoKSkKICAgICAgICAgICAgJGlGaWx0ZXJJbnN0YWxsZXIgPSAkemlwTG9jYXRpb24rIlxQREZGaWx0ZXI2NGluc3RhbGxlci5tc2kiCiAgICAgICAgfQogICAgICAgIFRyeQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSBJbnN0YWxsaW5nIEFkb2JlIFBERiBpRmlsdGVyLi4uIgogICAgICAgICAgICBTdGFydC1Qcm9jZXNzIC1GaWxlUGF0aCAibXNpZXhlYy5leGUiIC1Bcmd1bWVudExpc3QgIi9pIGAiJGlGaWx0ZXJJbnN0YWxsZXJgIiAvcGFzc2l2ZSAvbm9yZXN0YXJ0IiAtTm9OZXdXaW5kb3cgLVdhaXQKICAgICAgICB9CiAgICAgICAgQ2F0Y2ggeyRffQogICAgICAgIElmICgoR2V0LVBzU25hcGluIHw/eyRfLk5hbWUgLWVxICJNaWNyb3NvZnQuU2hhcmVQb2ludC5Qb3dlclNoZWxsIn0pLWVxICRudWxsKQogICAgICAgIHsKICAgICAgICAgICAgbG9nICIgLSBMb2FkaW5nIFNoYXJlUG9pbnQgUG93ZXJTaGVsbCBTbmFwaW4uLi4iCiAgICAgICAgICAgIEFkZC1Qc1NuYXBpbiBNaWNyb3NvZnQuU2hhcmVQb2ludC5Qb3dlclNoZWxsIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgT3V0LU51bGwKICAgICAgICB9CiAgICAgICAgbG9nICIgLSBTZXR0aW5nIFBERiBzZWFyY2ggY3Jhd2wgZXh0ZW5zaW9uLi4uIgogICAgICAgICRzZWFyY2hBcHBsaWNhdGlvbnMgPSBHZXQtU1BFbnRlcnByaXNlU2VhcmNoU2VydmljZUFwcGxpY2F0aW9uCiAgICAgICAgSWYgKCRzZWFyY2hBcHBsaWNhdGlvbnMpCiAgICAgICAgewogICAgICAgICAgICBGb3JFYWNoICgkc2VhcmNoQXBwbGljYXRpb24gaW4gJHNlYXJjaEFwcGxpY2F0aW9ucykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgVHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgR2V0LVNQRW50ZXJwcmlzZVNlYXJjaENyYXdsRXh0ZW5zaW9uIC1TZWFyY2hBcHBsaWNhdGlvbiAkc2VhcmNoQXBwbGljYXRpb24gLUlkZW50aXR5ICJwZGYiIC1FcnJvckFjdGlvbiBTdG9wIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFBERiBmaWxlIGV4dGVuc2lvbiBhbHJlYWR5IHNldCBmb3IgJCgkc2VhcmNoQXBwbGljYXRpb24uRGlzcGxheU5hbWUpLiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIENhdGNoCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmV3LVNQRW50ZXJwcmlzZVNlYXJjaENyYXdsRXh0ZW5zaW9uIC1TZWFyY2hBcHBsaWNhdGlvbiAkc2VhcmNoQXBwbGljYXRpb24gLU5hbWUgInBkZiIgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gUERGIGV4dGVuc2lvbiBmb3IgJCgkc2VhcmNoQXBwbGljYXRpb24uRGlzcGxheU5hbWUpIG5vdyBzZXQuIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEVsc2Uge2xvZyAiV0FSTklORzpObyBzZWFyY2ggYXBwbGljYXRpb25zIGZvdW5kLiJ9CiAgICAgICAgbG9nICIgLSBVcGRhdGluZyByZWdpc3RyeS4uLiIKICAgICAgICBJZiAoKEdldC1JdGVtIC1QYXRoIFJlZ2lzdHJ5OjoiSEtMTVxTT0ZUV0FSRVxNaWNyb3NvZnRcT2ZmaWNlIFNlcnZlclwkZW52OnNwVmVyLjBcU2VhcmNoXFNldHVwXEZpbHRlcnNcLnBkZiIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpIC1lcSAkbnVsbCkKICAgICAgICB7CiAgICAgICAgICAgICRpdGVtID0gTmV3LUl0ZW0gLVBhdGggUmVnaXN0cnk6OiJIS0xNXFNPRlRXQVJFXE1pY3Jvc29mdFxPZmZpY2UgU2VydmVyXCRlbnY6c3BWZXIuMFxTZWFyY2hcU2V0dXBcRmlsdGVyc1wucGRmIgogICAgICAgICAgICAkaXRlbSB8IE5ldy1JdGVtUHJvcGVydHkgLU5hbWUgRXh0ZW5zaW9uIC1Qcm9wZXJ0eVR5cGUgU3RyaW5nIC1WYWx1ZSAicGRmIiB8IE91dC1OdWxsCiAgICAgICAgICAgICRpdGVtIHwgTmV3LUl0ZW1Qcm9wZXJ0eSAtTmFtZSBGaWxlVHlwZUJ1Y2tldCAtUHJvcGVydHlUeXBlIERXb3JkIC1WYWx1ZSAxIHwgT3V0LU51bGwKICAgICAgICAgICAgJGl0ZW0gfCBOZXctSXRlbVByb3BlcnR5IC1OYW1lIE1pbWVUeXBlcyAtUHJvcGVydHlUeXBlIFN0cmluZyAtVmFsdWUgImFwcGxpY2F0aW9uL3BkZiIgfCBPdXQtTnVsbAogICAgICAgIH0KICAgICAgICBJZiAoKEdldC1JdGVtIC1QYXRoIFJlZ2lzdHJ5OjoiSEtMTVxTT0ZUV0FSRVxNaWNyb3NvZnRcT2ZmaWNlIFNlcnZlclwkZW52OnNwVmVyLjBcU2VhcmNoXFNldHVwXENvbnRlbnRJbmRleENvbW1vblxGaWx0ZXJzXEV4dGVuc2lvblwucGRmIiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkgLWVxICRudWxsKQogICAgICAgIHsKICAgICAgICAgICAgJHJlZ2lzdHJ5SXRlbSA9IE5ldy1JdGVtIC1QYXRoIFJlZ2lzdHJ5OjoiSEtMTVxTT0ZUV0FSRVxNaWNyb3NvZnRcT2ZmaWNlIFNlcnZlclwkZW52OnNwVmVyLjBcU2VhcmNoXFNldHVwXENvbnRlbnRJbmRleENvbW1vblxGaWx0ZXJzXEV4dGVuc2lvblwucGRmIgogICAgICAgICAgICAkcmVnaXN0cnlJdGVtIHwgTmV3LUl0ZW1Qcm9wZXJ0eSAtTmFtZSAiKGRlZmF1bHQpIiAtUHJvcGVydHlUeXBlIFN0cmluZyAtVmFsdWUgIntFODk3OERBNi0wNDdGLTRFM0QtOUM3OC1DREJFNDYwNDE2MDN9IiB8IE91dC1OdWxsCiAgICAgICAgfQogICAgICAgICRzcFNlYXJjaFNlcnZpY2UgPSAiT1NlYXJjaCIrJGVudjpzcFZlciAjIFN1YnN0aXR1dGUgdGhlIGNvcnJlY3QgU2hhcmVQb2ludCB2ZXJzaW9uIGludG8gdGhlIHNlcnZpY2UgbmFtZSBzbyB3ZSBjYW4gaGFuZGxlIFNQMjAxMyBhcyB3ZWxsIGFzIFNQMjAxMAogICAgICAgIElmICgoR2V0LVNlcnZpY2UgJHNwU2VhcmNoU2VydmljZSkuU3RhdHVzIC1lcSAiUnVubmluZyIpCiAgICAgICAgewogICAgICAgICAgICBsb2cgIiAtIFJlc3RhcnRpbmcgU2hhcmVQb2ludCBTZWFyY2ggU2VydmljZS4uLiIKICAgICAgICAgICAgUmVzdGFydC1TZXJ2aWNlICRzcFNlYXJjaFNlcnZpY2UKICAgICAgICB9CiAgICAgICAgbG9nICIgLSBEb25lIGNvbmZpZ3VyaW5nIFBERiBpRmlsdGVyIGFuZCBpbmRleGluZy4iCiAgICB9CiAgICBJZiAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uQWRvYmVQREYuSWNvbi5Db25maWd1cmUgLWVxICR0cnVlKQogICAgewogICAgICAgICRkb2NJY29uRm9sZGVyUGF0aCA9ICIkc2hhcmVQb2ludFJvb3RcVEVNUExBVEVcWE1MIgogICAgICAgICRkb2NJY29uRmlsZVBhdGggPSAiJGRvY0ljb25Gb2xkZXJQYXRoXERPQ0lDT04uWE1MIgogICAgICAgICR4bWwgPSBOZXctT2JqZWN0IFhNTAogICAgICAgICR4bWwuTG9hZCgkZG9jSWNvbkZpbGVQYXRoKQogICAgICAgICMgT25seSBjb25maWd1cmUgUERGIGljb24gaWYgd2UgYXJlIHJ1bm5pbmcgU1AyMDEwIChhcyBTUDIwMTMgaW5jbHVkZXMgb25lKQogICAgICAgIGlmICgkZW52OnNwVmVyIC1lcSAiMTQiKQogICAgICAgIHsKICAgICAgICAgICAgJHBkZkljb25VcmwgPSAiaHR0cDovL3d3dy5hZG9iZS5jb20vaW1hZ2VzL3BkZmljb25fc21hbGwucG5nIgogICAgICAgICAgICBsb2cgIiAtIENvbmZpZ3VyaW5nIFBERiBJY29uLi4uIgogICAgICAgICAgICAkcGRmSWNvbiA9ICJwZGZpY29uX3NtYWxsLnBuZyIKICAgICAgICAgICAgSWYgKCEoR2V0LUl0ZW0gJHNoYXJlUG9pbnRSb290XFRlbXBsYXRlXEltYWdlc1wkcGRmSWNvbiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIEZvckVhY2ggKCRzb3VyY2VGaWxlTG9jYXRpb24gaW4gJHNvdXJjZUZpbGVMb2NhdGlvbnMpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBlYWNoIHBvc3NpYmxlIHNvdXJjZSBmaWxlIGxvY2F0aW9uIGZvciB0aGUgUERGIGljb24KICAgICAgICAgICAgICAgICAgICAkY29weUljb24gPSBDb3B5LUl0ZW0gLVBhdGggJHNvdXJjZUZpbGVMb2NhdGlvblwkcGRmSWNvbiAtRGVzdGluYXRpb24gJHNoYXJlUG9pbnRSb290XFRlbXBsYXRlXEltYWdlc1wkcGRmSWNvbiAtUGFzc1RocnUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgICAgICBJZiAoJGNvcHlJY29uKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBQREYgaWNvbiBmb3VuZCBhdCAkc291cmNlRmlsZUxvY2F0aW9uXCRwZGZJY29uIgogICAgICAgICAgICAgICAgICAgICAgICBCcmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIElmICghKCRjb3B5SWNvbikpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBgIiRwZGZJY29uYCIgbm90IGZvdW5kOyBkb3dubG9hZGluZyBpdCBub3cuLi4iCiAgICAgICAgICAgICAgICAgICAgSWYgKENvbmZpcm0tTG9jYWxTZXNzaW9uKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgSW1wb3J0LU1vZHVsZSBCaXRzVHJhbnNmZXIgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1CaXRzVHJhbnNmZXIgLVNvdXJjZSAkcGRmSWNvblVybCAtRGVzdGluYXRpb24gIiRzaGFyZVBvaW50Um9vdFxUZW1wbGF0ZVxJbWFnZXNcJHBkZkljb24iIC1EaXNwbGF5TmFtZSAiRG93bmxvYWRpbmcgUERGIEljb24uLi4iIC1Qcmlvcml0eSBGb3JlZ3JvdW5kIC1EZXNjcmlwdGlvbiAiRnJvbSAkcGRmSWNvblVybC4uLiIgLUVycm9yVmFyaWFibGUgZXJyCiAgICAgICAgICAgICAgICAgICAgICAgIElmICgkZXJyKSB7bG9nICJXQVJOSU5HOkNvdWxkIG5vdCBkb3dubG9hZCBQREYgSWNvbiEiOyBQYXVzZSAiZXhpdCI7IGJyZWFrfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBFbHNlIHtsb2cgIldBUk5JTkc6VGhlIHJlbW90ZSB1c2Ugb2YgQklUUyBpcyBub3Qgc3VwcG9ydGVkLiBQbGVhc2UgcHJlLWRvd25sb2FkIHRoZSBQREYgaWNvbiBhbmQgdHJ5IGFnYWluLiJ9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBJZiAoR2V0LUl0ZW0gJHNoYXJlUG9pbnRSb290XFRlbXBsYXRlXEltYWdlc1wkcGRmSWNvbikge2xvZyAiIC0gUERGIGljb24gY29waWVkIHN1Y2Nlc3NmdWxseS4ifQogICAgICAgICAgICAgICAgRWxzZSB7VGhyb3d9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgSWYgKCR4bWwuU2VsZWN0U2luZ2xlTm9kZSgiLy9NYXBwaW5nW0BLZXk9J3BkZiddIikgLWVxICRudWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBUcnkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkcGRmID0gJHhtbC5DcmVhdGVFbGVtZW50KCJNYXBwaW5nIikKICAgICAgICAgICAgICAgICAgICAkcGRmLlNldEF0dHJpYnV0ZSgiS2V5IiwicGRmIikKICAgICAgICAgICAgICAgICAgICAkcGRmLlNldEF0dHJpYnV0ZSgiVmFsdWUiLCRwZGZJY29uKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgQ2F0Y2ggeyRfOyBQYXVzZSAiZXhpdCI7IEJyZWFrfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICMgUGVyZm9ybSB0aGUgcmVzdCBvZiB0aGUgRE9DSUNPTi5YTUwgbW9kaWZpY2F0aW9ucyB0byBhbGxvdyBQREYgZWRpdCBldGMuLCBhbmQgd3JpdGUgb3V0IHRoZSBuZXcgRE9DSUNPTi5YTUwgZmlsZQogICAgICAgIFRyeQogICAgICAgIHsKICAgICAgICAgICAgJGRhdGUgPSBHZXQtRGF0ZSAtVUZvcm1hdCAiJXklbSVkJUglTSVTIgogICAgICAgICAgICBsb2cgIiAtIENyZWF0aW5nIGJhY2t1cCBvZiBET0NJQ09OLlhNTCBmaWxlLi4uIgogICAgICAgICAgICAkYmFja3VwRmlsZSA9ICIkZG9jSWNvbkZvbGRlclBhdGhcRE9DSUNPTl9CYWNrdXBfJGRhdGUueG1sIgogICAgICAgICAgICBDb3B5LUl0ZW0gJGRvY0ljb25GaWxlUGF0aCAkYmFja3VwRmlsZQogICAgICAgICAgICBsb2cgIiAtIFdyaXRpbmcgbmV3IERPQ0lDT04uWE1MLi4uIgogICAgICAgICAgICBpZiAoISRwZGYpIHskcGRmID0gJHhtbC5TZWxlY3RTaW5nbGVOb2RlKCIvL01hcHBpbmdbQEtleT0ncGRmJ10iKX0KICAgICAgICAgICAgaWYgKCEkcGRmKSB7JHBkZiA9ICR4bWwuQ3JlYXRlRWxlbWVudCgiTWFwcGluZyIpfQogICAgICAgICAgICAkcGRmLlNldEF0dHJpYnV0ZSgiRWRpdFRleHQiLCJBZG9iZSBBY3JvYmF0IG9yIFJlYWRlciBYIikKICAgICAgICAgICAgJHBkZi5TZXRBdHRyaWJ1dGUoIk9wZW5Db250cm9sIiwiQWRvYmVBY3JvYmF0Lk9wZW5Eb2N1bWVudHMiKQogICAgICAgICAgICAkeG1sLkRvY0ljb25zLkJ5RXh0ZW5zaW9uLkFwcGVuZENoaWxkKCRwZGYpIHwgT3V0LU51bGwKICAgICAgICAgICAgJHhtbC5TYXZlKCRkb2NJY29uRmlsZVBhdGgpCiAgICAgICAgICAgIGxvZyAiIC0gUmVzdGFydGluZyBJSVMuLi4iCiAgICAgICAgICAgIGlpc3Jlc2V0CiAgICAgICAgfQogICAgICAgIENhdGNoIHskXzsgUGF1c2UgImV4aXQiOyBCcmVha30KICAgIH0KICAgIElmICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5BZG9iZVBERi5NSU1FVHlwZS5Db25maWd1cmUgLWVxICR0cnVlKQogICAgewogICAgICAgICMgQWRkIHRoZSBQREYgTUlNRSB0eXBlIHRvIGVhY2ggd2ViIGFwcCBzbyBQREZzIGNhbiBiZSBkaXJlY3RseSB2aWV3ZWQvb3BlbmVkIHdpdGhvdXQgc2F2aW5nIGxvY2FsbHkgZmlyc3QKICAgICAgICAjIE1vcmUgZ3JhbnVsYXIgYW5kIGdlbmVyYWxseSBwcmVmZXJhYmxlIHRvIHNldHRpbmcgdGhlIHdob2xlIHdlYiBhcHAgdG8gIlBlcm1pc3NpdmUiIGZpbGUgaGFuZGxpbmcKICAgICAgICAkbWltZVR5cGUgPSAiYXBwbGljYXRpb24vcGRmIgogICAgICAgIGxvZyAiIC0gQWRkaW5nIFBERiBNSU1FIHR5cGUgYCIkbWltZVR5cGVgIiB3ZWIgYXBwcy4uLiIKICAgICAgICBMb2FkLVNoYXJlUG9pbnQtUG93ZXJTaGVsbAogICAgICAgIEZvckVhY2ggKCR3ZWJBcHBDb25maWcgaW4gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uV2ViQXBwbGljYXRpb25zLldlYkFwcGxpY2F0aW9uKQogICAgICAgIHsKICAgICAgICAgICAgJHdlYkFwcFVybCA9ICQoJHdlYkFwcENvbmZpZy51cmwpKyI6IiskKCR3ZWJBcHBDb25maWcuUG9ydCkKICAgICAgICAgICAgJHdlYkFwcCA9IEdldC1TUFdlYkFwcGxpY2F0aW9uIC1JZGVudGl0eSAkd2ViQXBwVXJsCiAgICAgICAgICAgIElmICgkd2ViQXBwLkFsbG93ZWRJbmxpbmVEb3dubG9hZGVkTWltZVR5cGVzIC1ub3Rjb250YWlucyAkbWltZVR5cGUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiICAtICIkd2ViQXBwVXJsIjogQWRkaW5nICJgIiRtaW1lVHlwZSJgIi4uLiIgCiAgICAgICAgICAgICAgICAkd2ViQXBwLkFsbG93ZWRJbmxpbmVEb3dubG9hZGVkTWltZVR5cGVzLkFkZCgkbWltZVR5cGUpCiAgICAgICAgICAgICAgICAkd2ViQXBwLlVwZGF0ZSgpCiAgICAgICAgICAgICAgICBsb2cgIk9LLiIKICAgICAgICAgICAgfQogICAgICAgICAgICBFbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAiICAtICIkd2ViQXBwVXJsIjogImAiJG1pbWVUeXBlImAiIGFscmVhZHkgYWRkZWQuIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgbG9nICIgLSBEb25lIGNvbmZpZ3VyaW5nIFBERiBpbmRleGluZyBhbmQgaWNvbiBkaXNwbGF5LiIKICAgIFdyaXRlTGluZQp9CiNFbmRSZWdpb24KCiNSZWdpb24gSW5zdGFsbCBGb3JlZnJvbnQKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBJbnN0YWxsRm9yZUZyb250CiMgRGVzYzogSW5zdGFsbHMgRm9yZUZyb250IFByb3RlY3Rpb24gMjAxMCBmb3IgU2hhcmVQb2ludCBTaXRlcwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBJbnN0YWxsRm9yZUZyb250CnsKICAgIElmIChTaG91bGRJUHJvdmlzaW9uICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZvcmVGcm9udCAtZXEgJHRydWUpCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgSWYgKFRlc3QtUGF0aCAiJGVudjpQUk9HUkFNRklMRVNcTWljcm9zb2Z0IEZvcmVGcm9udCBQcm90ZWN0aW9uIGZvciBTaGFyZVBvaW50XExhdW5jaGVyLmV4ZSIpCiAgICAgICAgewogICAgICAgICAgICBsb2cgIiAtIEZvcmVGcm9udCBiaW5hcmllcyBhcHBlYXIgdG8gYmUgYWxyZWFkeSBpbnN0YWxsZWQgLSBza2lwcGluZyBpbnN0YWxsLiIKICAgICAgICB9CiAgICAgICAgRWxzZQogICAgICAgIHsKICAgICAgICAgICAgIyBJbnN0YWxsIEZvcmVGcm9udAogICAgICAgICAgICBJZiAoVGVzdC1QYXRoICIkYml0c1wkc3BZZWFyXEZvcmVmcm9udFxzZXR1cC5leGUiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAtIEluc3RhbGxpbmcgRm9yZUZyb250IGJpbmFyaWVzLi4uIgogICAgICAgICAgICAgICAgVHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgU3RhcnQtUHJvY2VzcyAiJGJpdHNcJHNwWWVhclxGb3JlZnJvbnRcc2V0dXAuZXhlIiAtQXJndW1lbnRMaXN0ICIvYSBgIiRjb25maWdGaWxlRm9yZUZyb250YCIgL3AiIC1XYWl0CiAgICAgICAgICAgICAgICAgICAgSWYgKC1ub3QgJD8pIHtUaHJvd30KICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIERvbmUgaW5zdGFsbGluZyBGb3JlRnJvbnQuIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgQ2F0Y2gKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBUaHJvdyAiIC0gRXJyb3IgJExBU1RFWElUQ09ERSBvY2N1cnJlZCBydW5uaW5nICRiaXRzXCRzcFllYXJcRm9yZUZyb250XHNldHVwLmV4ZSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBFbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFRocm93ICIgLSBGb3JlRnJvbnQgaW5zdGFsbGVyIG5vdCBmb3VuZCBpbiAkYml0c1wkc3BZZWFyXEZvcmVGcm9udCBmb2xkZXIiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBSZW1vdGUgRnVuY3Rpb25zCkZ1bmN0aW9uIEdldC1GYXJtU2VydmVycyAoW3htbF0keG1saW5wdXQpCnsKICAgICRzZXJ2ZXJzID0gJG51bGwKICAgICRmYXJtU2VydmVycyA9IEAoKQogICAgIyBMb29rIGZvciBzZXJ2ZXIgbmFtZSByZWZlcmVuY2VzIGluIHRoZSBYTUwKICAgIEZvckVhY2ggKCRub2RlIGluICR4bWxpbnB1dC5TZWxlY3ROb2RlcygiLy8qW0BQcm92aXNpb25dfC8vKltASW5zdGFsbF18Ly8qW0NyYXdsQ29tcG9uZW50XXwvLypbUXVlcnlDb21wb25lbnRdfC8vKltTZWFyY2hRdWVyeUFuZFNpdGVTZXR0aW5nc0NvbXBvbmVudF18Ly8qW0FkbWluQ29tcG9uZW50XXwvLypbSW5kZXhDb21wb25lbnRdfC8vKltDb250ZW50UHJvY2Vzc2luZ0NvbXBvbmVudF18Ly8qW0FuYWx5dGljc1Byb2Nlc3NpbmdDb21wb25lbnRdfC8vKltAU3RhcnRdIikpCiAgICB7CiAgICAgICAgIyBUcnkgdG8gc2V0IHRoZSBzZXJ2ZXIgbmFtZSBmcm9tIHRoZSB2YXJpb3VzIGVsZW1lbnRzL2F0dHJpYnV0ZXMKICAgICAgICAkc2VydmVycyA9IEAoR2V0RnJvbU5vZGUgJG5vZGUgIlByb3Zpc2lvbiIpCiAgICAgICAgSWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRzZXJ2ZXJzKSkgeyAkc2VydmVycyA9IEAoR2V0RnJvbU5vZGUgJG5vZGUgIkluc3RhbGwiKSB9CiAgICAgICAgSWYgKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRzZXJ2ZXJzKSkgeyAkc2VydmVycyA9IEAoR2V0RnJvbU5vZGUgJG5vZGUgIlN0YXJ0IikgfQogICAgICAgICMgQWNjb21vZGF0ZSBhbmQgY2xlYW4gdXAgY29tbWEgYW5kL29yIHNwYWNlLXNlcGFyYXRlZCBzZXJ2ZXIgbmFtZXMKICAgICAgICAjIEZpcnN0IGdldCByaWQgb2YgYW55IHJlY3VycmluZyBzcGFjZXMgb3IgY29tbWFzCiAgICAgICAgV2hpbGUgKCRzZXJ2ZXJzIC1tYXRjaCAiICAiKQogICAgICAgIHsKICAgICAgICAgICAgJHNlcnZlcnMgPSAkc2VydmVycyAtcmVwbGFjZSAiICAiLCAiICIKICAgICAgICB9CiAgICAgICAgV2hpbGUgKCRzZXJ2ZXJzIC1tYXRjaCAiLCwiKQogICAgICAgIHsKICAgICAgICAgICAgJHNlcnZlcnMgPSAkc2VydmVycyAtcmVwbGFjZSAiLCwiLCAiLCIKICAgICAgICB9CiAgICAgICAgJHNlcnZlcnMgPSAkc2VydmVycyAtc3BsaXQgIiwiIC1zcGxpdCAiICIKICAgICAgICAjIFJlbW92ZSBhbnkgInRydWUiLCAiZmFsc2UiIG9yIHplcm8tbGVuZ3RoIHZhbHVlcyBhcyB3ZSBvbmx5IHdhbnQgc2VydmVyIG5hbWVzCiAgICAgICAgSWYgKCRzZXJ2ZXJzIC1lcSAidHJ1ZSIgLW9yICRzZXJ2ZXJzIC1lcSAiZmFsc2UiIC1vciBbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkc2VydmVycykpCiAgICAgICAgewogICAgICAgICAgICAkc2VydmVycyA9ICRudWxsCiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgICMgQWRkIGFueSBzZXJ2ZXIocykgd2UgZm91bmQgdG8gb3VyICRmYXJtU2VydmVycyBhcnJheQogICAgICAgICAgICAkZmFybVNlcnZlcnMgPSBAKCRmYXJtU2VydmVycyskc2VydmVycykKICAgICAgICB9CiAgICB9CgogICAgIyBSZW1vdmUgYW55IGJsYW5rcyBhbmQgZHVwbGljYXRlcwogICAgJGZhcm1TZXJ2ZXJzID0gJGZhcm1TZXJ2ZXJzIHwgV2hlcmUtT2JqZWN0IHskXyAtbmUgIiJ9IHwgU2VsZWN0LU9iamVjdCAtVW5pcXVlCiAgICBSZXR1cm4gJGZhcm1TZXJ2ZXJzCn0KCkZ1bmN0aW9uIEVuYWJsZS1DcmVkU1NQICgkcmVtb3RlRmFybVNlcnZlcnMpCnsKICAgIEZvckVhY2ggKCRzZXJ2ZXIgaW4gJHJlbW90ZUZhcm1TZXJ2ZXJzKSB7bG9nICIgLSBFbmFibGluZyBXU01hbkNyZWRTU1AgZm9yIGAiJHNlcnZlcmAiIn0KICAgIEVuYWJsZS1XU01hbkNyZWRTU1AgLVJvbGUgQ2xpZW50IC1Gb3JjZSAtRGVsZWdhdGVDb21wdXRlciAkcmVtb3RlRmFybVNlcnZlcnMgfCBPdXQtTnVsbAogICAgSWYgKCEkPykgCiAgICB7CiAgICAgICAgUGF1c2UgImV4aXQiOyAKICAgICAgICB0aHJvdyAkXwogICAgfQp9CgpGdW5jdGlvbiBUZXN0LVNlcnZlckNvbm5lY3Rpb24gKCRzZXJ2ZXIpCnsKICAgIGxvZyAiIC0gVGVzdGluZyBjb25uZWN0aW9uICh2aWEgUGluZykgdG8gYCIkc2VydmVyYCIuLi4iIAogICAgJGNhbkNvbm5lY3QgPSBUZXN0LUNvbm5lY3Rpb24gLUNvbXB1dGVyTmFtZSAkc2VydmVyIC1Db3VudCAxIC1RdWlldAogICAgSWYgKCRjYW5Db25uZWN0KSB7bG9nIC1CYWNrZ3JvdW5kQ29sb3IgQmxhY2sgJCgkY2FuQ29ubmVjdC5Ub1N0cmluZygpIC1yZXBsYWNlICJUcnVlIiwiU3VjY2Vzcy4iKX0KICAgIElmICghJGNhbkNvbm5lY3QpCiAgICB7CiAgICAgICAgbG9nIC1CYWNrZ3JvdW5kQ29sb3IgQmxhY2sgJCgkY2FuQ29ubmVjdC5Ub1N0cmluZygpIC1yZXBsYWNlICJGYWxzZSIsIkZhaWxlZC4iKQogICAgICAgIGxvZyAiIC0gQ2hlY2sgdGhhdCBgIiRzZXJ2ZXJgIjoiCiAgICAgICAgbG9nICIgIC0gSXMgb25saW5lIgogICAgICAgIGxvZyAiICAtIEhhcyB0aGUgcmVxdWlyZWQgV2luZG93cyBGaXJld2FsbCBleGNlcHRpb25zIHNldCAob3IgdHVybmVkIG9mZikiCiAgICAgICAgbG9nICIgIC0gSGFzIGEgdmFsaWQgRE5TIGVudHJ5IGZvciAkc2VydmVyLiQoJGVudjpVU0VSRE5TRE9NQUlOKSIKICAgIH0KfQoKRnVuY3Rpb24gRW5hYmxlLVJlbW90ZVNlc3Npb24gKCRzZXJ2ZXIsICRwYXNzd29yZCkKewogICAgSWYgKCRwYXNzd29yZCkgeyRjcmVkZW50aWFsID0gTmV3LU9iamVjdCBTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBzQ3JlZGVudGlhbCAkZW52OlVTRVJET01BSU5cJGVudjpVU0VSTkFNRSwkKENvbnZlcnRUby1TZWN1cmVTdHJpbmcgJHBhc3N3b3JkKX0KICAgIElmICghJGNyZWRlbnRpYWwpIHskY3JlZGVudGlhbCA9ICRob3N0LnVpLlByb21wdEZvckNyZWRlbnRpYWwoIkF1dG9TUEluc3RhbGxlciAtIFJlbW90ZSBJbnN0YWxsIiwgIlJlLUVudGVyIENyZWRlbnRpYWxzIGZvciBSZW1vdGUgQXV0aGVudGljYXRpb246IiwgIiRlbnY6VVNFUkRPTUFJTlwkZW52OlVTRVJOQU1FIiwgIk5ldEJpb3NVc2VyTmFtZSIpfQogICAgJHVzZXJuYW1lID0gJGNyZWRlbnRpYWwuVXNlcm5hbWUKICAgICRwYXNzd29yZCA9IENvbnZlcnRUby1QbGFpblRleHQgJGNyZWRlbnRpYWwuUGFzc3dvcmQKICAgICRjb25maWd1cmVUYXJnZXRTY3JpcHQgPSAiJGVudjpkcDBcQXV0b1NQSW5zdGFsbGVyQ29uZmlndXJlUmVtb3RlVGFyZ2V0LnBzMSIKICAgICRwc0V4ZWMgPSAkZW52OmRwMCsiXFBzRXhlYy5leGUiCiAgICBJZiAoIShHZXQtSXRlbSAoJHBzRXhlYykgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpKQogICAgewogICAgICAgIGxvZyAiIC0gUHNFeGVjLmV4ZSBub3QgZm91bmQ7IGRvd25sb2FkaW5nLi4uIgogICAgICAgICRwc0V4ZWNVcmwgPSAiaHR0cDovL2xpdmUuc3lzaW50ZXJuYWxzLmNvbS9Qc0V4ZWMuZXhlIgogICAgICAgIEltcG9ydC1Nb2R1bGUgQml0c1RyYW5zZmVyIHwgT3V0LU51bGwKICAgICAgICBTdGFydC1CaXRzVHJhbnNmZXIgLVNvdXJjZSAkcHNFeGVjVXJsIC1EZXN0aW5hdGlvbiAkcHNFeGVjIC1EaXNwbGF5TmFtZSAiRG93bmxvYWRpbmcgU3lzaW50ZXJuYWxzIFBzRXhlYy4uLiIgLVByaW9yaXR5IEZvcmVncm91bmQgLURlc2NyaXB0aW9uICJGcm9tICRwc0V4ZWNVcmwuLi4iIC1FcnJvclZhcmlhYmxlIGVycgogICAgICAgIElmICgkZXJyKSAKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAiV0FSTklORzpDb3VsZCBub3QgZG93bmxvYWQgUHNFeGVjISI7IAogICAgICAgICAgICBQYXVzZSAiZXhpdCI7IAogICAgICAgICAgICBicmVhawogICAgICAgIH0KICAgICAgICAkc291cmNlRmlsZSA9ICRkZXN0aW5hdGlvbkZpbGUKICAgIH0KICAgIGxvZyAiIC0gVXBkYXRpbmcgUG93ZXJTaGVsbCBleGVjdXRpb24gcG9saWN5IG9uIGAiJHNlcnZlcmAiIHZpYSBQc0V4ZWMuLi4iCiAgICBTdGFydC1Qcm9jZXNzIC1GaWxlUGF0aCAiJHBzRXhlYyIgYAogICAgICAgICAgICAgICAgICAtQXJndW1lbnRMaXN0ICIvYWNjZXB0RXVsYSBcXCRzZXJ2ZXIgLWggcG93ZXJzaGVsbC5leGUgLUNvbW1hbmQgYCJTZXQtRXhlY3V0aW9uUG9saWN5IEJ5cGFzcyAtRm9yY2UgOyBTdG9wLVByb2Nlc3MgLUlkIGAkUElEYCIiIGAKICAgICAgICAgICAgICAgICAgLVdhaXQgLU5vTmV3V2luZG93CiAgICAjIEFub3RoZXIgd2F5IHRvIGV4aXQgcG93ZXJzaGVsbCB3aGVuIHJ1bm5pbmcgb3ZlciBQc0V4ZWMgZnJvbSBodHRwOi8vd3d3LmxlZWhvbG1lcy5jb20vYmxvZy8yMDA3LzEwLzAyL3VzaW5nLXBvd2Vyc2hlbGwtYW5kLVBzRXhlYy10by1pbnZva2UtZXhwcmVzc2lvbnMtb24tcmVtb3RlLWNvbXB1dGVycy8KICAgICMgUHNFeGVjIFxcc2VydmVyIGNtZCAvYyAiZWNobyAuIHwgcG93ZXJzaGVsbCB7Y29tbWFuZH0iCiAgICBsb2cgIiAtIEVuYWJsaW5nIFBvd2VyU2hlbGwgcmVtb3Rpbmcgb24gYCIkc2VydmVyYCIgdmlhIFBzRXhlYy4uLiIKICAgIFN0YXJ0LVByb2Nlc3MgLUZpbGVQYXRoICIkcHNFeGVjIiBgCiAgICAgICAgICAgICAgICAgIC1Bcmd1bWVudExpc3QgIi9hY2NlcHRFdWxhIFxcJHNlcnZlciAtdSAkdXNlcm5hbWUgLXAgJHBhc3N3b3JkIC1oIHBvd2Vyc2hlbGwuZXhlIC1Db21tYW5kIGAiJGNvbmZpZ3VyZVRhcmdldFNjcmlwdGAiIiBgCiAgICAgICAgICAgICAgICAgIC1XYWl0IC1Ob05ld1dpbmRvdwp9CgpGdW5jdGlvbiBJbnN0YWxsLU5ldEZyYW1ld29yayAoJHNlcnZlciwgJHBhc3N3b3JkKQp7CglJZiAoJHBhc3N3b3JkKSB7JGNyZWRlbnRpYWwgPSBOZXctT2JqZWN0IFN5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUHNDcmVkZW50aWFsICRlbnY6VVNFUkRPTUFJTlwkZW52OlVTRVJOQU1FLCQoQ29udmVydFRvLVNlY3VyZVN0cmluZyAkcGFzc3dvcmQpfQogICAgSWYgKCEkY3JlZGVudGlhbCkgeyRjcmVkZW50aWFsID0gJGhvc3QudWkuUHJvbXB0Rm9yQ3JlZGVudGlhbCgiQXV0b1NQSW5zdGFsbGVyIC0gUmVtb3RlIEluc3RhbGwiLCAiUmUtRW50ZXIgQ3JlZGVudGlhbHMgZm9yIFJlbW90ZSBBdXRoZW50aWNhdGlvbjoiLCAiJGVudjpVU0VSRE9NQUlOXCRlbnY6VVNFUk5BTUUiLCAiTmV0Qmlvc1VzZXJOYW1lIil9CiAgICBJZiAoJHNlc3Npb24uTmFtZSAtbmUgIkF1dG9TUEluc3RhbGxlclNlc3Npb24tJHNlcnZlciIpCiAgICB7CiAgICAgICAgbG9nICIgLSBTdGFydGluZyByZW1vdGUgc2Vzc2lvbiB0byAkc2VydmVyLi4uIgogICAgICAgICRzZXNzaW9uID0gTmV3LVBTU2Vzc2lvbiAtTmFtZSAiQXV0b1NQSW5zdGFsbGVyU2Vzc2lvbi0kc2VydmVyIiAtQXV0aGVudGljYXRpb24gQ3JlZHNzcCAtQ3JlZGVudGlhbCAkY3JlZGVudGlhbCAtQ29tcHV0ZXJOYW1lICRzZXJ2ZXIKICAgIH0KICAgICRyZW1vdGVRdWVyeU9TID0gSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrIHtHZXQtV21pT2JqZWN0IFdpbjMyX09wZXJhdGluZ1N5c3RlbX0gLVNlc3Npb24gJHNlc3Npb24KCUlmICghKCRyZW1vdGVRdWVyeU9TLlZlcnNpb24uQ29udGFpbnMoIjYuMiIpKSAtYW5kICEoJHJlbW90ZVF1ZXJ5T1MuVmVyc2lvbi5Db250YWlucygiNi4zIikpKSAjIE9ubHkgcGVyZm9ybSB0aGUgc3R1ZmYgYmVsb3cgaWYgd2UgYXJlbid0IG9uIFdpbmRvd3MgMjAxMiBvciAyMDEyIFIyCgl7CiAgICAgICAgIyBNSzogcmVtb3ZlZCBjb2RlIHJlbGF0ZWQgdG8gV2luZG93cyAyMDA4IGFuZCBlYXJsaWVyCgl9Cn0KCkZ1bmN0aW9uIEluc3RhbGwtV2luZG93c0lkZW50aXR5Rm91bmRhdGlvbiAoJHNlcnZlciwgJHBhc3N3b3JkKQp7CiAgICAjIFRoaXMgc3RlcCBpcyByZXF1aXJlZCBkdWUgdG8gYSBrbm93biBpc3N1ZSB3aXRoIHRoZSBQcmVyZXF1aXNpdGVJbnN0YWxsZXIuZXhlIG92ZXIgYSByZW1vdGUgc2Vzc2lvbjsKICAgICMgU3BlY2lmaWNhbGx5LCBiZWNhdXNlIFdpbmRvd3MgVXBkYXRlIFN0YW5kYWxvbmUgSW5zdGFsbGVyICh3dXNhLmV4ZSkgYmxvd3MgdXAgd2l0aCBlcnJvciBjb2RlIDUKICAgICMgV2l0aCBhIGZ1bGx5LXBhdGNoZWQgV2luZG93cyAyMDA4IFIyIHNlcnZlciB0aG91Z2gsIHRoZSByZXN0IG9mIHRoZSBwcmVyZXF1aXNpdGVzIHNlZW0gT0s7IHNvIHRoaXMgZnVuY3Rpb24gb25seSBkZWFscyB3aXRoIEtCOTc0NDA1IChXaW5kb3dzIElkZW50aXR5IEZvdW5kYXRpb24pLgogICAgIyBUaGFua3MgdG8gUmF2aWthbnRoIENoYWdhbnRpIChAcmF2aWthbnRoKSBmb3IgZGVzY3JpYmluZyB0aGUgaXNzdWUsIGFuZCB3b3JraW5nIGFyb3VuZCBpdCBzbyBlZmZlY3RpdmVseTogaHR0cDovL3d3dy5yYXZpY2hhZ2FudGkuY29tL2Jsb2cvP3A9MTg4OAogICAgSWYgKCRwYXNzd29yZCkgeyRjcmVkZW50aWFsID0gTmV3LU9iamVjdCBTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBzQ3JlZGVudGlhbCAkZW52OlVTRVJET01BSU5cJGVudjpVU0VSTkFNRSwkKENvbnZlcnRUby1TZWN1cmVTdHJpbmcgJHBhc3N3b3JkKX0KICAgIElmICghJGNyZWRlbnRpYWwpIHskY3JlZGVudGlhbCA9ICRob3N0LnVpLlByb21wdEZvckNyZWRlbnRpYWwoIkF1dG9TUEluc3RhbGxlciAtIFJlbW90ZSBJbnN0YWxsIiwgIlJlLUVudGVyIENyZWRlbnRpYWxzIGZvciBSZW1vdGUgQXV0aGVudGljYXRpb246IiwgIiRlbnY6VVNFUkRPTUFJTlwkZW52OlVTRVJOQU1FIiwgIk5ldEJpb3NVc2VyTmFtZSIpfQogICAgSWYgKCRzZXNzaW9uLk5hbWUgLW5lICJBdXRvU1BJbnN0YWxsZXJTZXNzaW9uLSRzZXJ2ZXIiKQogICAgewogICAgICAgIGxvZyAiIC0gU3RhcnRpbmcgcmVtb3RlIHNlc3Npb24gdG8gJHNlcnZlci4uLiIKICAgICAgICAkc2Vzc2lvbiA9IE5ldy1QU1Nlc3Npb24gLU5hbWUgIkF1dG9TUEluc3RhbGxlclNlc3Npb24tJHNlcnZlciIgLUF1dGhlbnRpY2F0aW9uIENyZWRzc3AgLUNyZWRlbnRpYWwgJGNyZWRlbnRpYWwgLUNvbXB1dGVyTmFtZSAkc2VydmVyCiAgICB9CiAgICAkcmVtb3RlUXVlcnlPUyA9IEludm9rZS1Db21tYW5kIC1TY3JpcHRCbG9jayB7R2V0LVdtaU9iamVjdCBXaW4zMl9PcGVyYXRpbmdTeXN0ZW19IC1TZXNzaW9uICRzZXNzaW9uCglJZiAoISgkcmVtb3RlUXVlcnlPUy5WZXJzaW9uLkNvbnRhaW5zKCI2LjIiKSkgLWFuZCAhKCRyZW1vdGVRdWVyeU9TLlZlcnNpb24uQ29udGFpbnMoIjYuMyIpKSkgIyBPbmx5IHBlcmZvcm0gdGhlIHN0dWZmIGJlbG93IGlmIHdlIGFyZW4ndCBvbiBXaW5kb3dzIDIwMTIgb3IgMjAxMiBSMgoJewogICAgICAgICMgTUs6IHJlbW92ZWQgY29kZSByZWxhdGVkIHRvIFdpbmRvd3MgMjAwOCBhbmQgZWFybGllciAgICAKCX0KfQoKRnVuY3Rpb24gU3RhcnQtUmVtb3RlSW5zdGFsbGVyICgkc2VydmVyLCAkcGFzc3dvcmQsICRpbnB1dEZpbGUpCnsKICAgIElmICgkcGFzc3dvcmQpIHskY3JlZGVudGlhbCA9IE5ldy1PYmplY3QgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5Qc0NyZWRlbnRpYWwgJGVudjpVU0VSRE9NQUlOXCRlbnY6VVNFUk5BTUUsJChDb252ZXJ0VG8tU2VjdXJlU3RyaW5nICRwYXNzd29yZCl9CiAgICBJZiAoISRjcmVkZW50aWFsKSB7JGNyZWRlbnRpYWwgPSAkaG9zdC51aS5Qcm9tcHRGb3JDcmVkZW50aWFsKCJBdXRvU1BJbnN0YWxsZXIgLSBSZW1vdGUgSW5zdGFsbCIsICJSZS1FbnRlciBDcmVkZW50aWFscyBmb3IgUmVtb3RlIEF1dGhlbnRpY2F0aW9uOiIsICIkZW52OlVTRVJET01BSU5cJGVudjpVU0VSTkFNRSIsICJOZXRCaW9zVXNlck5hbWUiKX0KICAgIElmICgkc2Vzc2lvbi5OYW1lIC1uZSAiQXV0b1NQSW5zdGFsbGVyU2Vzc2lvbi0kc2VydmVyIikKICAgIHsKICAgICAgICBsb2cgIiAtIFN0YXJ0aW5nIHJlbW90ZSBzZXNzaW9uIHRvICRzZXJ2ZXIuLi4iCiAgICAgICAgJHNlc3Npb24gPSBOZXctUFNTZXNzaW9uIC1OYW1lICJBdXRvU1BJbnN0YWxsZXJTZXNzaW9uLSRzZXJ2ZXIiIC1BdXRoZW50aWNhdGlvbiBDcmVkc3NwIC1DcmVkZW50aWFsICRjcmVkZW50aWFsIC1Db21wdXRlck5hbWUgJHNlcnZlcgogICAgfQogICAgR2V0LU1ham9yVmVyc2lvbk51bWJlciAkeG1saW5wdXQKICAgICMgQ3JlYXRlIGEgaGFzaCB0YWJsZSB3aXRoIG1ham9yIHZlcnNpb24gdG8gcHJvZHVjdCB5ZWFyIG1hcHBpbmdzCiAgICAkc3BZZWFycyA9IEB7IjE0IiA9ICIyMDEwIjsgIjE1IiA9ICIyMDEzIjsgIjE2IiA9ICIyMDE2In0KICAgICRzcFllYXIgPSAkc3BZZWFycy4kZW52OnNwVmVyCiAgICAjIFNldCBzb21lIHJlbW90ZSB2YXJpYWJsZXMgdGhhdCB3ZSB3aWxsIG5lZWQuLi4KICAgIEludm9rZS1Db21tYW5kIC1TY3JpcHRCbG9jayB7cGFyYW0gKCR2YWx1ZSkgU2V0LVZhcmlhYmxlIC1OYW1lIGRwMCAtVmFsdWUgJHZhbHVlfSAtQXJndW1lbnRMaXN0ICRlbnY6ZHAwIC1TZXNzaW9uICRzZXNzaW9uCiAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sge3BhcmFtICgkdmFsdWUpIFNldC1WYXJpYWJsZSAtTmFtZSBJbnB1dEZpbGUgLVZhbHVlICR2YWx1ZX0gLUFyZ3VtZW50TGlzdCAkaW5wdXRGaWxlIC1TZXNzaW9uICRzZXNzaW9uCiAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sge3BhcmFtICgkdmFsdWUpIFNldC1WYXJpYWJsZSAtTmFtZSBzcFZlciAtVmFsdWUgJHZhbHVlfSAtQXJndW1lbnRMaXN0ICRlbnY6c3BWZXIgLVNlc3Npb24gJHNlc3Npb24KICAgICMgQ2hlY2sgaWYgU2hhcmVQb2ludCBpcyBhbHJlYWR5IGluc3RhbGxlZAogICAgJHNwSW5zdGFsbGVkT25SZW1vdGUgPSBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sge0dldC1DaW1JbnN0YW5jZSAtQ2xhc3NOYW1lIFdpbjMyX1Byb2R1Y3QgLUZpbHRlciAiTmFtZSBsaWtlICdNaWNyb3NvZnQgU2hhcmVQb2ludCBTZXJ2ZXIlJyJ9IC1TZXNzaW9uICRzZXNzaW9uCiAgICBsb2cgIiAtIFNoYXJlUG9pbnQgJHNwWWVhciBiaW5hcmllcyBhcmUiKCRzcEluc3RhbGxlZE9uUmVtb3RlIC1yZXBsYWNlICJUcnVlIiwiYWxyZWFkeSIgLXJlcGxhY2UgIkZhbHNlIiwibm90IHlldCIpICJpbnN0YWxsZWQgb24gJHNlcnZlci4iCiAgICBsb2cgIiAtIExhdW5jaGluZyBBdXRvU1BJbnN0YWxsZXIuLi4iCiAgICBJbnZva2UtQ29tbWFuZCAtU2NyaXB0QmxvY2sgeyYgIiRkcDBcQXV0b1NQSW5zdGFsbGVyTWFpbi5wczEiICIkaW5wdXRGaWxlIn0gLVNlc3Npb24gJHNlc3Npb24KICAgIGxvZyAiIC0gUmVtb3Zpbmcgc2Vzc2lvbiBgIiQoJHNlc3Npb24uTmFtZSkuLi5gIiIKICAgIFJlbW92ZS1QU1Nlc3Npb24gJHNlc3Npb24KfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBDb25maXJtLUxvY2FsU2Vzc2lvbgojIERlc2M6IFJldHVybnMgJGZhbHNlIGlmIHdlIGFyZSBydW5uaW5nIG92ZXIgYSBQUyByZW1vdGUgc2Vzc2lvbiwgJHRydWUgb3RoZXJ3aXNlCiMgRnJvbTogQnJpYW4gTGFsYW5jZXR0ZSwgMjAxMgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKRnVuY3Rpb24gQ29uZmlybS1Mb2NhbFNlc3Npb24KewogICAgIyBBbm90aGVyIHdheQogICAgIyBJZiAoKEdldC1Qcm9jZXNzIC1JZCAkUElEKS5Qcm9jZXNzTmFtZSAtZXEgIndzbXByb3Zob3N0Iikge1JldHVybiAkZmFsc2V9CiAgICBJZiAoJEhvc3QuTmFtZSAtZXEgIlNlcnZlclJlbW90ZUhvc3QiKSB7UmV0dXJuICRmYWxzZX0KICAgIEVsc2Uge1JldHVybiAkdHJ1ZX0KfQoKI0VuZFJlZ2lvbgoKI1JlZ2lvbiBNaXNjZWxsYW5lb3VzL1V0aWxpdHkgRnVuY3Rpb25zCiNSZWdpb24gTG9hZCBTbmFwaW5zCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBMb2FkIFNoYXJlUG9pbnQgUG93ZXJTaGVsbCBTbmFwaW4KIyBEZXNjOiBMb2FkIFNoYXJlUG9pbnQgUG93ZXJTaGVsbCBTbmFwaW4KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBMb2FkLVNoYXJlUG9pbnQtUG93ZXJTaGVsbAp7CiAgICBJZiAoKEdldC1Qc1NuYXBpbiB8P3skXy5OYW1lIC1lcSAiTWljcm9zb2Z0LlNoYXJlUG9pbnQuUG93ZXJTaGVsbCJ9KS1lcSAkbnVsbCkKICAgIHsKICAgICAgICBXcml0ZUxpbmUKICAgICAgICBsb2cgIiAtIExvYWRpbmcgU2hhcmVQb2ludCBQb3dlclNoZWxsIFNuYXBpbi4uLiIKICAgICAgICAjIEFkZGVkIHRoZSBsaW5lIGJlbG93IHRvIG1hdGNoIHdoYXQgdGhlIFNoYXJlUG9pbnQucHMxIGZpbGUgaW1wbGVtZW50cyAobm9ybWFsbHkgY2FsbGVkIHZpYSB0aGUgU2hhcmVQb2ludCBNYW5hZ2VtZW50IFNoZWxsIFN0YXJ0IE1lbnUgc2hvcnRjdXQpCiAgICAgICAgSWYgKENvbmZpcm0tTG9jYWxTZXNzaW9uKSB7JEhvc3QuUnVuc3BhY2UuVGhyZWFkT3B0aW9ucyA9ICJSZXVzZVRocmVhZCJ9CiAgICAgICAgQWRkLVBzU25hcGluIE1pY3Jvc29mdC5TaGFyZVBvaW50LlBvd2VyU2hlbGwgLUVycm9yQWN0aW9uIFN0b3AgfCBPdXQtTnVsbAogICAgICAgIFdyaXRlTGluZQogICAgfQp9CiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogSW1wb3J0V2ViQWRtaW5pc3RyYXRpb24KIyBEZXNjOiBMb2FkIElJUyBXZWJBZG1pbmlzdHJhdGlvbiBTbmFwaW4vTW9kdWxlCiMgRnJvbTogSW5zcGlyZWQgYnkgaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xOTI0MjE3L3Bvd2Vyc2hlbGwtbG9hZC13ZWJhZG1pbmlzdHJhdGlvbi1pbi1wczEtc2NyaXB0LW9uLWJvdGgtaWlzLTctYW5kLWlpcy03LTUKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gSW1wb3J0V2ViQWRtaW5pc3RyYXRpb24KewogICAgJHF1ZXJ5T1MgPSBHd21pIFdpbjMyX09wZXJhdGluZ1N5c3RlbQogICAgJHF1ZXJ5T1MgPSAkcXVlcnlPUy5WZXJzaW9uCiAgICBUcnkKICAgIHsKICAgICAgICBJZiAoJHF1ZXJ5T1MuQ29udGFpbnMoIjYuMCIpKSAjIFdpbjIwMDgKICAgICAgICB7CiAgICAgICAgICAgIElmICghKEdldC1QU1NuYXBpbiBXZWJBZG1pbmlzdHJhdGlvbiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIElmICghKFRlc3QtUGF0aCAkZW52OlByb2dyYW1GaWxlc1xJSVNcUG93ZXJTaGVsbFNuYXBpblxJSXNDb25zb2xlLnBzYzEpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFN0YXJ0LVByb2Nlc3MgLVdhaXQgLU5vTmV3V2luZG93IC1GaWxlUGF0aCBtc2lleGVjLmV4ZSAtQXJndW1lbnRMaXN0ICIvaSBgIiRlbnY6U1BiaXRzXFByZXJlcXVpc2l0ZUluc3RhbGxlckZpbGVzXGlpczdwc3Byb3ZfeDY0Lm1zaWAiIC9wYXNzaXZlIC9wcm9tcHRyZXN0YXJ0IgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgQWRkLVBTU25hcGluIFdlYkFkbWluaXN0cmF0aW9uCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgRWxzZSAjIFdpbjIwMDhSMiBvciBXaW4yMDEyCiAgICAgICAgewogICAgICAgICAgICBJbXBvcnQtTW9kdWxlIFdlYkFkbWluaXN0cmF0aW9uCiAgICAgICAgfQogICAgfQogICAgQ2F0Y2gKICAgIHsKICAgICAgICBUaHJvdyAiIC0gQ291bGQgbm90IGxvYWQgSUlTIEFkbWluaXN0cmF0aW9uIG1vZHVsZS4iCgogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gQ29udmVydFRvLVBsYWluVGV4dAojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogQ29udmVydFRvLVBsYWluVGV4dAojIERlc2M6IENvbnZlcnQgc3RyaW5nIHRvIHNlY3VyZSBwaHJhc2UKIyAgICAgICBVc2VkIChmb3IgZXhhbXBsZSkgdG8gZ2V0IHRoZSBGYXJtIEFjY291bnQgcGFzc3dvcmQgaW50byBwbGFpbiB0ZXh0IGFzIGlucHV0IHRvIHByb3Zpc2lvbiB0aGUgVXNlciBQcm9maWxlIFN5bmMgU2VydmljZQojICAgICAgIEZyb20gaHR0cDovL3d3dy52aXN0YXg2NC5jb20vcG93ZXJzaGVsbC8xNTkxOTAtcmVhZC1ob3N0LWFzc2VjdXJlc3RyaW5nLXByb2JsZW0uaHRtbAojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIENvbnZlcnRUby1QbGFpblRleHQoIFtzZWN1cml0eS5zZWN1cmVzdHJpbmddJHNlY3VyZSApCnsKICAgICRtYXJzaGFsID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdCiAgICAkbWFyc2hhbDo6UHRyVG9TdHJpbmdBdXRvKCAkbWFyc2hhbDo6U2VjdXJlU3RyaW5nVG9CU1RSKCRzZWN1cmUpICkKfQojRW5kUmVnaW9uCgojUmVnaW9uIFNob3VsZElQcm92aXNpb24KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IFNob3VsZElQcm92aXNpb24KIyBEZXNjOiBSZXR1cm5zIFRSVUUgaWYgdGhlIGl0ZW0gd2hvc2UgY29uZmlndXJhdGlvbiBub2RlIGlzIHBhc3NlZCBpbiBzaG91bGQgYmUgcHJvdmlzaW9uZWQuCiMgICAgICAgb24gdGhpcyBtYWNoaW5lLgojICAgICAgIFRoaXMgZnVuY3Rpb24gc3VwcG9ydHMgd2lsZGNhcmQgY29tcHV0ZXJuYW1lcy4gICBDb21wdXRlcm5hbWVzIHNwZWNpZmllZCBpbiB0aGUKIyAgICAgICBBdXRvU3BJbnN0YWxsZXJJbnB1dC54bWwgbWF5IGNvbnRhaW4gZWl0aGVyIGEgc2luZ2xlICogY2hhcmFjdGVyCiMJICAgIHRvIGRvIGEgd2lsZGNhcmQgbWF0Y2ggb3IgbWF5IGNvbnRhaW4gb25lIG9yIG1vcmUgIyBjaGFyYWN0ZXJzIHRvIG1hdGNoIGFuIGludGVnZXIuCiMgICAgICAgVXNpbmcgd2lsZGNhcmQgY29tcHV0ZXIgbmFtZXMgaXMgbm90IGNvbXBhdGlibGUgd2l0aCByZW1vdGUgaW5zdGFsbGF0aW9uLgojCiMJRXhhbXBsZXM6ICAgV0ZFKiB3b3VsZCBtYXRjaCBjb21wdXRlcnMgbmFtZWQgV0ZFLWZvbywgV0ZFYmFyLCBldGMuCiMJCQkJV0ZFIyMgd291bGQgbWF0Y2ggV0ZFMDEsIFdGRTAyLCBidXQgbm90IFdGRTEKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBTaG91bGRJUHJvdmlzaW9uKFtTeXN0ZW0uWG1sLlhtbE5vZGVdICRub2RlKQp7CiAgICBJZiAoISRub2RlKSB7UmV0dXJuICRmYWxzZX0gIyBJbiBjYXNlIHRoZSBub2RlIGRvZXNuJ3QgZXhpc3QgaW4gdGhlIFhNTCBmaWxlCiAgICAjIEFsbG93IGZvciBjb21tYS0gb3Igc3BhY2UtZGVsaW1pdGVkIGxpc3Qgb2Ygc2VydmVyIG5hbWVzIGluIFByb3Zpc2lvbiBvciBTdGFydCBhdHRyaWJ1dGUKICAgIElmICgkbm9kZS5HZXRBdHRyaWJ1dGUoIlByb3Zpc2lvbiIpKSB7JHYgPSAkbm9kZS5HZXRBdHRyaWJ1dGUoIlByb3Zpc2lvbiIpLlJlcGxhY2UoIiwiLCIgIil9CiAgICBFbHNlSWYgKCRub2RlLkdldEF0dHJpYnV0ZSgiU3RhcnQiKSkgeyR2ID0gJG5vZGUuR2V0QXR0cmlidXRlKCJTdGFydCIpLlJlcGxhY2UoIiwiLCIgIil9CiAgICBFbHNlSWYgKCRub2RlLkdldEF0dHJpYnV0ZSgiSW5zdGFsbCIpKSB7JHYgPSAkbm9kZS5HZXRBdHRyaWJ1dGUoIkluc3RhbGwiKS5SZXBsYWNlKCIsIiwiICIpfQogICAgSWYgKCR2IC1lcSAkdHJ1ZSkgeyBSZXR1cm4gJHRydWU7IH0KICAgIFJldHVybiBNYXRjaENvbXB1dGVyTmFtZSAkdiAkZW52OkNPTVBVVEVSTkFNRQp9CiNFbmRSZWdpb24KCiNSZWdpb24gU1FMIFN0dWZmCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogQWRkLVNRTEFsaWFzCiMgRGVzYzogQ3JlYXRlcyBhIGxvY2FsIFNRTCBhbGlhcyAobGlrZSB1c2luZyBjbGljb25mZy5leGUpIHNvIHRoZSByZWFsIFNRTCBzZXJ2ZXIvbmFtZSBkb2Vzbid0IGdldCBoYXJkLWNvZGVkIGluIFNoYXJlUG9pbnQKIyAgICAgICBpZiBsb2NhbCBkYXRhYmFzZSBzZXJ2ZXIgaXMgYmVpbmcgdXNlZCwgdGhlbiB1c2UgU2hhcmVkIE1lbW9yeSBwcm90b2NvbAojIEZyb206IEJpbGwgQnJvY2tiYW5rLCBTaGFyZVBvaW50IE1WUCAoYmlsbGJAbmF2YW50aXMuY29tKQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKRnVuY3Rpb24gQWRkLVNRTEFsaWFzKCkKewogICAgPCMKICAgIC5TeW5vcHNpcwogICAgICAgIEFkZCBhIG5ldyBTUUwgc2VydmVyIEFsaWFzCiAgICAuRGVzY3JpcHRpb24KICAgICAgICBBZGRzIGEgbmV3IFNRTCBzZXJ2ZXIgQWxpYXMgd2l0aCB0aGUgcHJvdmlkZWQgcGFyYW1ldGVycy4KICAgIC5FeGFtcGxlCiAgICAgICAgICAgICAgICBBZGQtU1FMQWxpYXMgLUFsaWFzTmFtZSAiU2hhcmVQb2ludERCIiAtU1FMSW5zdGFuY2UgJGVudjpDT01QVVRFUk5BTUUKICAgIC5FeGFtcGxlCiAgICAgICAgICAgICAgICBBZGQtU1FMQWxpYXMgLUFsaWFzTmFtZSAiU2hhcmVQb2ludERCIiAtU1FMSW5zdGFuY2UgJGVudjpDT01QVVRFUk5BTUUgLVBvcnQgJzE0MzMnCiAgICAuUGFyYW1ldGVyIEFsaWFzTmFtZQogICAgICAgIFRoZSBuZXcgYWxpYXMgTmFtZS4KICAgIC5QYXJhbWV0ZXIgU1FMSW5zdGFuY2UKICAgICAgICAgICAgICAgIFRoZSBTUUwgc2VydmVyIE5hbWUgb3MgSW5zdGFuY2UgTmFtZQogICAgLlBhcmFtZXRlciBQb3J0CiAgICAgICAgUG9ydCBudW1iZXIgb2YgU1FMIHNlcnZlciBpbnN0YW5jZS4gVGhpcyBpcyBhbiBvcHRpb25hbCBwYXJhbWV0ZXIuCiAgICAjPgogICAgW0NtZGxldEJpbmRpbmcoRGVmYXVsdFBhcmFtZXRlclNldE5hbWU9IkJ1aWxkUGF0aCtTZXR1cEluZm8iKV0KICAgIHBhcmFtCiAgICAoCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JGZhbHNlLCBQYXJhbWV0ZXJTZXROYW1lPSJCdWlsZFBhdGgrU2V0dXBJbmZvIildW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXSRhbGlhc05hbWUgPSAiU2hhcmVQb2ludERCIiwKCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JGZhbHNlLCBQYXJhbWV0ZXJTZXROYW1lPSJCdWlsZFBhdGgrU2V0dXBJbmZvIildW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXSRTUUxJbnN0YW5jZSA9ICRlbnY6Q09NUFVURVJOQU1FLAoKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kZmFsc2UsIFBhcmFtZXRlclNldE5hbWU9IkJ1aWxkUGF0aCtTZXR1cEluZm8iKV1bVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddJHBvcnQgPSAiIgogICAgKQoKCUlmICgoTWF0Y2hDb21wdXRlck5hbWUgJFNRTEluc3RhbmNlICRlbnY6Q09NUFVURVJOQU1FKSAtb3IgKCRTUUxJbnN0YW5jZS5TdGFydHNXaXRoKCRlbnY6Q29tcHV0ZXJOYW1lICsiXCIpKSkgewoJCSRwcm90b2NvbCA9ICJkYm1zbHBjbiIgIyBTaGFyZWQgTWVtb3J5CiAgICAgICAgfQoJZWxzZSB7CgkJJHByb3RvY29sID0gIkRCTVNTT0NOIiAjIFRDUC9JUAoJfQoKICAgICRzZXJ2ZXJBbGlhc0Nvbm5lY3Rpb249IiRwcm90b2NvbCwkU1FMSW5zdGFuY2UiCiAgICBJZiAoJHBvcnQgLW5lICIiKQogICAgewogICAgICAgICAkc2VydmVyQWxpYXNDb25uZWN0aW9uICs9ICIsJHBvcnQiCiAgICB9CiAgICAkbm90RXhpc3QgPSAkdHJ1ZQogICAgJGNsaWVudCA9IEdldC1JdGVtICdIS0xNOlxTT0ZUV0FSRVxNaWNyb3NvZnRcTVNTUUxTZXJ2ZXJcQ2xpZW50JyAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgIyBDcmVhdGUgdGhlIGtleSBpbiBjYXNlIGl0IGRvZXNuJ3QgeWV0IGV4aXN0CiAgICBJZiAoISRjbGllbnQpIHskY2xpZW50ID0gTmV3LUl0ZW0gJ0hLTE06XFNPRlRXQVJFXE1pY3Jvc29mdFxNU1NRTFNlcnZlclxDbGllbnQnIC1Gb3JjZX0KICAgICRjbGllbnQuR2V0U3ViS2V5TmFtZXMoKSB8IEZvckVhY2gtT2JqZWN0IC1Qcm9jZXNzIHsgSWYgKCAkXyAtZXEgJ0Nvbm5lY3RUbycpIHsgJG5vdEV4aXN0PSRmYWxzZSB9fQogICAgSWYgKCRub3RFeGlzdCkKICAgIHsKICAgICAgICAkZGF0YSA9IE5ldy1JdGVtICdIS0xNOlxTT0ZUV0FSRVxNaWNyb3NvZnRcTVNTUUxTZXJ2ZXJcQ2xpZW50XENvbm5lY3RUbycKICAgIH0KICAgICMgQWRkIEFsaWFzCiAgICAkZGF0YSA9IE5ldy1JdGVtUHJvcGVydHkgSEtMTTpcU09GVFdBUkVcTWljcm9zb2Z0XE1TU1FMU2VydmVyXENsaWVudFxDb25uZWN0VG8gLU5hbWUgJGFsaWFzTmFtZSAtVmFsdWUgJHNlcnZlckFsaWFzQ29ubmVjdGlvbiAtUHJvcGVydHlUeXBlICJTdHJpbmciIC1Gb3JjZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IENoZWNrU1FMQWNjZXNzCiMgRGVzYzogQ2hlY2tzIGlmIHRoZSBpbnN0YWxsIGFjY291bnQgaGFzIHRoZSBjb3JyZWN0IFNRTCBkYXRhYmFzZSBhY2Nlc3MgYW5kIHBlcm1pc3Npb25zCiMgQnk6ICAgU2FtZWVyIERob290IChodHRwOi8vc2hhcmVteXBvaW50LmluL2Fib3V0L3NhbWVlcmRob290LykKIyBGcm9tOiBodHRwOi8vc2hhcmVteXBvaW50LmluLzIwMTEvMDQvMTgvcG93ZXJzaGVsbC1zY3JpcHQtdG8tY2hlY2stc3FsLXNlcnZlci1jb25uZWN0aXZpdHktdmVyc2lvbi1jdXN0ZXJpbmctc3RhdHVzLXVzZXItcGVybWlzc2lvbnMvCiMgQWRhcHRlZCBmb3IgdXNlIGluIEF1dG9TUEluc3RhbGxlciBieSBAYnJpYW5sYWxhCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIENoZWNrU1FMQWNjZXNzCnsKICAgIFdyaXRlTGluZQogICAgIyBMb29rIGZvciByZWZlcmVuY2VzIHRvIERCIFNlcnZlcnMsIEFsaWFzZXMsIGV0Yy4gaW4gdGhlIFhNTAogICAgRm9yRWFjaCAoJG5vZGUgaW4gJHhtbGlucHV0LlNlbGVjdE5vZGVzKCIvLypbREJTZXJ2ZXJdfC8vKltARGF0YWJhc2VTZXJ2ZXJdfC8vKltARmFpbG92ZXJEYXRhYmFzZVNlcnZlcl0iKSkKICAgIHsKICAgICAgICAkZGJTZXJ2ZXIgPSAoR2V0RnJvbU5vZGUgJG5vZGUgIkRCU2VydmVyIikKICAgICAgICBJZiAoJG5vZGUuRGF0YWJhc2VTZXJ2ZXIpIHskZGJTZXJ2ZXIgPSBHZXRGcm9tTm9kZSAkbm9kZSAiRGF0YWJhc2VTZXJ2ZXIifQogICAgICAgICMgSWYgdGhlIERCU2VydmVyIGhhcyBiZWVuIHNwZWNpZmllZCwgYW5kIHdlJ3ZlIGFza2VkIHRvIHNldCB1cCBhbiBhbGlhcywgY3JlYXRlIG9uZQogICAgICAgIElmICghKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRkYlNlcnZlcikpIC1hbmQgKCRub2RlLkRCQWxpYXMuQ3JlYXRlIC1lcSAkdHJ1ZSkpCiAgICAgICAgewogICAgICAgICAgICAkZGJJbnN0YW5jZSA9IEdldEZyb21Ob2RlICRub2RlLkRCQWxpYXMgIkRCSW5zdGFuY2UiCiAgICAgICAgICAgICRkYlBvcnQgPSBHZXRGcm9tTm9kZSAkbm9kZS5EQkFsaWFzICJEQlBvcnQiCiAgICAgICAgICAgICMgSWYgbm8gREJJbnN0YW5jZSBoYXMgYmVlbiBzcGVjaWZpZWQsIGJ1dCBDcmVhdGU9IiR0cnVlIiwgc2V0IHRoZSBBbGlhcyB0byB0aGUgc2VydmVyIHZhbHVlCiAgICAgICAgICAgIElmICgoJGRiSW5zdGFuY2UgLWVxICRudWxsKSAtYW5kICgkZGJJbnN0YW5jZSAtbmUgIiIpKSB7JGRiSW5zdGFuY2UgPSAkZGJTZXJ2ZXJ9CiAgICAgICAgICAgIElmICgoJGRiUG9ydCAtbmUgJG51bGwpIC1hbmQgKCRkYlBvcnQgLW5lICIiKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyBTUUwgYWxpYXMgYCIkZGJTZXJ2ZXIsJGRiUG9ydGAiLi4uIgogICAgICAgICAgICAgICAgQWRkLVNRTEFsaWFzIC1BbGlhc05hbWUgJGRiU2VydmVyIC1TUUxJbnN0YW5jZSAkZGJJbnN0YW5jZSAtUG9ydCAkZGJQb3J0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgRWxzZSAjIENyZWF0ZSB0aGUgYWxpYXMgd2l0aG91dCBzcGVjaWZ5aW5nIHRoZSBwb3J0ICh1c2UgZGVmYXVsdCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyBTUUwgYWxpYXMgYCIkZGJTZXJ2ZXJgIi4uLiIKICAgICAgICAgICAgICAgIEFkZC1TUUxBbGlhcyAtQWxpYXNOYW1lICRkYlNlcnZlciAtU1FMSW5zdGFuY2UgJGRiSW5zdGFuY2UKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkZGJTZXJ2ZXJzICs9IEAoJGRiU2VydmVyKQogICAgfQoKICAgICRjdXJyZW50VXNlciA9ICIkZW52OlVTRVJET01BSU5cJGVudjpVU0VSTkFNRSIKICAgICRzZXJ2ZXJSb2xlc1RvQ2hlY2sgPSAiZGJjcmVhdG9yIiwic2VjdXJpdHlhZG1pbiIKICAgICMgSWYgd2UgYXJlIHByb3Zpc2lvbmluZyBQZXJmb3JtYW5jZVBvaW50IGJ1dCBhcmVuJ3QgcnVubmluZyBTaGFyZVBvaW50IDIwMTAgU2VydmljZSBQYWNrIDEgeWV0LCB3ZSBuZWVkIHN5c2FkbWluIGluIG9yZGVyIHRvIHJ1biB0aGUgUmVuYW1lRGF0YWJhc2UgZnVuY3Rpb24KICAgICMgV2UgYWxzbyBldmlkZW50bHkgbmVlZCBzeXNhZG1pbiBpbiBvcmRlciB0byBjb25maWd1cmUgTWF4RE9QIG9uIHRoZSBTUUwgaW5zdGFuY2UgaWYgd2UgYXJlIGluc3RhbGxpbmcgU2hhcmVQb2ludCAyMDEzCiAgICBJZiAoKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5QZXJmb3JtYW5jZVBvaW50U2VydmljZSkgLWFuZCAoU2hvdWxkSVByb3Zpc2lvbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuUGVyZm9ybWFuY2VQb2ludFNlcnZpY2UgLWVxICR0cnVlKSAtYW5kICghKENoZWNrRm9yMjAxMFNQMSkpKQogICAgewogICAgICAgICRzZXJ2ZXJSb2xlc1RvQ2hlY2sgKz0gInN5c2FkbWluIgogICAgfQoKICAgIEZvckVhY2ggKCRzcWxTZXJ2ZXIgaW4gKCRkYlNlcnZlcnMgfCBTZWxlY3QtT2JqZWN0IC1VbmlxdWUpKQogICAgewogICAgICAgIElmICgkc3FsU2VydmVyKSAjIE9ubHkgY2hlY2sgdGhlIFNRTCBpbnN0YW5jZSBpZiBpdCBoYXMgYSB2YWx1ZQogICAgICAgIHsKICAgICAgICAgICAgJG9ialNRTENvbm5lY3Rpb24gPSBOZXctT2JqZWN0IFN5c3RlbS5EYXRhLlNxbENsaWVudC5TcWxDb25uZWN0aW9uCiAgICAgICAgICAgICRvYmpTUUxDb21tYW5kID0gTmV3LU9iamVjdCBTeXN0ZW0uRGF0YS5TcWxDbGllbnQuU3FsQ29tbWFuZAogICAgICAgICAgICBUcnkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJG9ialNRTENvbm5lY3Rpb24uQ29ubmVjdGlvblN0cmluZyA9ICJTZXJ2ZXI9JHNxbFNlcnZlcjtJbnRlZ3JhdGVkIFNlY3VyaXR5PVNTUEk7IgogICAgICAgICAgICAgICAgbG9nICIgLSBUZXN0aW5nIGFjY2VzcyB0byBTUUwgc2VydmVyL2luc3RhbmNlL2FsaWFzOiIgJHNxbFNlcnZlcgogICAgICAgICAgICAgICAgbG9nICIgLSBUcnlpbmcgdG8gY29ubmVjdCB0byBgIiRzcWxTZXJ2ZXJgIi4uLiIgCiAgICAgICAgICAgICAgICAkb2JqU1FMQ29ubmVjdGlvbi5PcGVuKCkgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgbG9nICJTdWNjZXNzIgogICAgICAgICAgICAgICAgJHN0ckNtZFN2ckRldGFpbHMgPSAiU0VMRUNUIFNFUlZFUlBST1BFUlRZKCdwcm9kdWN0dmVyc2lvbicpIGFzIFZlcnNpb24iCiAgICAgICAgICAgICAgICAkc3RyQ21kU3ZyRGV0YWlscyArPSAiLFNFUlZFUlBST1BFUlRZKCdJc0NsdXN0ZXJlZCcpIGFzIENsdXN0ZXJpbmciCiAgICAgICAgICAgICAgICAkb2JqU1FMQ29tbWFuZC5Db21tYW5kVGV4dCA9ICRzdHJDbWRTdnJEZXRhaWxzCiAgICAgICAgICAgICAgICAkb2JqU1FMQ29tbWFuZC5Db25uZWN0aW9uID0gJG9ialNRTENvbm5lY3Rpb24KICAgICAgICAgICAgICAgICRvYmpTUUxEYXRhUmVhZGVyID0gJG9ialNRTENvbW1hbmQuRXhlY3V0ZVJlYWRlcigpCiAgICAgICAgICAgICAgICBJZiAoJG9ialNRTERhdGFSZWFkZXIuUmVhZCgpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAoIiAtIFNRTCBTZXJ2ZXIgdmVyc2lvbiBpczogezB9IiAtZiAkb2JqU1FMRGF0YVJlYWRlci5HZXRWYWx1ZSgwKSkKICAgICAgICAgICAgICAgICAgICAkU1FMVmVyc2lvbiA9ICRvYmpTUUxEYXRhUmVhZGVyLkdldFZhbHVlKDApCiAgICAgICAgICAgICAgICAgICAgW2ludF0kU1FMTWFqb3JWZXJzaW9uLFtpbnRdJFNRTE1pbm9yVmVyc2lvbixbaW50XSRTUUxCdWlsZCwkbnVsbCA9ICRTUUxWZXJzaW9uIC1zcGxpdCAiXC4iCiAgICAgICAgICAgICAgICAgICAgIyBTaGFyZVBvaW50IG5lZWRzIG1pbmltdW0gU1FMIDIwMDggMTAuMC4yNzE0LjAgb3IgU1FMIDIwMDUgOS4wLjQyMjAuMCBwZXIgaHR0cDovL3N1cHBvcnQubWljcm9zb2Z0LmNvbS9rYi85NzYyMTUKICAgICAgICAgICAgICAgICAgICBJZiAoKCgkU1FMTWFqb3JWZXJzaW9uIC1lcSAxMCkgLWFuZCAoJFNRTE1pbm9yVmVyc2lvbiAtbHQgNSkgLWFuZCAoJFNRTEJ1aWxkIC1sdCAyNzE0KSkgLW9yICgoJFNRTE1ham9yVmVyc2lvbiAtZXEgOSkgLWFuZCAoJFNRTEJ1aWxkIC1sdCA0MjIwKSkpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBUaHJvdyAiIC0gVW5zdXBwb3J0ZWQgU1FMIHZlcnNpb24hIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBJZiAoJG9ialNRTERhdGFSZWFkZXIuR2V0VmFsdWUoMSkgLWVxIDEpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFRoaXMgaW5zdGFuY2Ugb2YgU1FMIFNlcnZlciBpcyBjbHVzdGVyZWQiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIEVsc2UKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gVGhpcyBpbnN0YW5jZSBvZiBTUUwgU2VydmVyIGlzIG5vdCBjbHVzdGVyZWQiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJG9ialNRTERhdGFSZWFkZXIuQ2xvc2UoKQogICAgICAgICAgICAgICAgRm9yRWFjaCgkc2VydmVyUm9sZSBpbiAkc2VydmVyUm9sZXNUb0NoZWNrKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRvYmpTUUxDb21tYW5kLkNvbW1hbmRUZXh0ID0gIlNFTEVDVCBJU19TUlZST0xFTUVNQkVSKCckc2VydmVyUm9sZScpIgogICAgICAgICAgICAgICAgICAgICRvYmpTUUxDb21tYW5kLkNvbm5lY3Rpb24gPSAkb2JqU1FMQ29ubmVjdGlvbgogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gQ2hlY2sgaWYgJGN1cnJlbnRVc2VyIGhhcyAkc2VydmVyUm9sZSBzZXJ2ZXIgcm9sZS4uLiIgCiAgICAgICAgICAgICAgICAgICAgJG9ialNRTERhdGFSZWFkZXIgPSAkb2JqU1FMQ29tbWFuZC5FeGVjdXRlUmVhZGVyKCkKICAgICAgICAgICAgICAgICAgICBJZiAoJG9ialNRTERhdGFSZWFkZXIuUmVhZCgpIC1hbmQgJG9ialNRTERhdGFSZWFkZXIuR2V0VmFsdWUoMCkgLWVxIDEpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIlBhc3MiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIEVsc2VJZigkb2JqU1FMRGF0YVJlYWRlci5HZXRWYWx1ZSgwKSAtZXEgMCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIFRocm93ICIgLSAkY3VycmVudFVzZXIgZG9lcyBub3QgaGF2ZSBgJyRzZXJ2ZXJSb2xlYCcgcm9sZSEiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIEVsc2UKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiSW52YWxpZCBSb2xlIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkb2JqU1FMRGF0YVJlYWRlci5DbG9zZSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkb2JqU1FMQ29ubmVjdGlvbi5DbG9zZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgQ2F0Y2gKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICIgLSBGYWlsIgogICAgICAgICAgICAgICAgJGVyclRleHQgPSAkZXJyb3JbMF0uVG9TdHJpbmcoKQogICAgICAgICAgICAgICAgSWYgKCRlcnJUZXh0LkNvbnRhaW5zKCJuZXR3b3JrLXJlbGF0ZWQiKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIldBUk5JTkc6Q29ubmVjdGlvbiBFcnJvci4gQ2hlY2sgc2VydmVyIG5hbWUsIHBvcnQsIGZpcmV3YWxsLiIKICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFRoaXMgbWF5IGJlIGV4cGVjdGVkIGlmIGUuZy4gU1FMIHNlcnZlciBpc24ndCBpbnN0YWxsZWQgeWV0LCBhbmQgeW91IGFyZSBqdXN0IGluc3RhbGxpbmcgU2hhcmVQb2ludCBiaW5hcmllcyBmb3Igbm93LiIKICAgICAgICAgICAgICAgICAgICBQYXVzZSAiY29udGludWUgd2l0aG91dCBjaGVja2luZyBTUUwgU2VydmVyIGNvbm5lY3Rpb24sIG9yIEN0cmwtQyB0byBleGl0IiAieSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEVsc2VJZiAoJGVyclRleHQuQ29udGFpbnMoIkxvZ2luIGZhaWxlZCIpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFRocm93ICIgLSBOb3QgYWJsZSB0byBsb2dpbi4gU1FMIFNlcnZlciBsb2dpbiBub3QgY3JlYXRlZC4iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBFbHNlSWYgKCRlcnJUZXh0LkNvbnRhaW5zKCJVbnN1cHBvcnRlZCBTUUwgdmVyc2lvbiIpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFRocm93ICIgLSBTaGFyZVBvaW50IDIwMTAgcmVxdWlyZXMgU1FMIDIwMDUgU1AzK0NVMywgU1FMIDIwMDggU1AxK0NVMiwgb3IgU1FMIDIwMDggUjIuIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgRWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIElmICghKFtzdHJpbmddOjpJc051bGxPckVtcHR5KCRzZXJ2ZXJSb2xlKSkpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBUaHJvdyAiIC0gJGN1cnJlbnRVc2VyIGRvZXMgbm90IGhhdmUgYCckc2VydmVyUm9sZWAnIHJvbGUhIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBFbHNlIHtUaHJvdyAiIC0gJGVyclRleHQifQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgV3JpdGVMaW5lCn0KCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogUmVuYW1lRGF0YWJhc2UoKQojIERlc2M6IFJlbmFtZXMgYSBTUUwgZGF0YWJhc2UgYW5kIHRoZSBkYXRhYmFzZSBmaWxlcwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBSZW5hbWVEYXRhYmFzZShbc3RyaW5nXSRzcWxTZXJ2ZXIsW3N0cmluZ10kb2xkTmFtZSxbc3RyaW5nXSRuZXdOYW1lKQp7CiAgICAkb2JqU1FMQ29ubmVjdGlvbiA9IE5ldy1PYmplY3QgU3lzdGVtLkRhdGEuU3FsQ2xpZW50LlNxbENvbm5lY3Rpb24KICAgICRvYmpTUUxDb21tYW5kID0gTmV3LU9iamVjdCBTeXN0ZW0uRGF0YS5TcWxDbGllbnQuU3FsQ29tbWFuZAogICAgJG9ialNRTENvbm5lY3Rpb24uQ29ubmVjdGlvblN0cmluZyA9ICJTZXJ2ZXI9JHNxbFNlcnZlcjtJbnRlZ3JhdGVkIFNlY3VyaXR5PVNTUEk7IgogICAgJG9ialNRTENvbm5lY3Rpb24uT3BlbigpIHwgT3V0LU51bGwKICAgICRzdHJDbWRTdnJEZXRhaWxzID0gQCIKRVhFQyAoJwpkZWNsYXJlIEBvbGRuYW1lIG52YXJjaGFyKDQwMDApCmRlY2xhcmUgQG5ld25hbWUgbnZhcmNoYXIoNDAwMCkKc2V0IEBvbGRuYW1lPScnJG9sZE5hbWUnJwpzZXQgQG5ld25hbWU9JyckbmV3TmFtZScnCkVYRUMgc3BfY29uZmlndXJlICcnc2hvdyBhZHZhbmNlZCBvcHRpb25zJycsIDEKUkVDT05GSUdVUkUKY3JlYXRlIHRhYmxlICNvcHQgKCBuYW1lIHN5c25hbWUsIG1pbmltdW0gaW50LCBtYXhpbXVtIGludCxjb25maWdfdmFsdWUgaW50LCBydW5fdmFsdWUgaW50KQppbnNlcnQgaW50byAjb3B0IGV4ZWMgc3BfY29uZmlndXJlICcneHBfY21kc2hlbGwnJwpERUNMQVJFIEBvbGRjbWRzaGVsbCBpbnQKU0VMRUNUIEBvbGRjbWRzaGVsbCA9IGNvbmZpZ192YWx1ZSBGUk9NICNvcHQKRVhFQyBzcF9jb25maWd1cmUgJyd4cF9jbWRzaGVsbCcnLCAxClJFQ09ORklHVVJFCmRlY2xhcmUgQGRhdGFwYXRoIG52YXJjaGFyKDQwMDApCmRlY2xhcmUgQGxvZ3BhdGggbnZhcmNoYXIoNDAwMCkKZGVjbGFyZSBAZGF0YW5hbWUgbnZhcmNoYXIoNDAwMCkKZGVjbGFyZSBAbG9nbmFtZSBudmFyY2hhcig0MDAwKQpzZWxlY3QgQGRhdGFwYXRoID0gcmVwbGFjZShwaHlzaWNhbF9uYW1lLEBvbGRuYW1lICsgJycubWRmJycsJycnJyksIEBkYXRhbmFtZT1OYW1lIGZyb20gbWFzdGVyLnN5cy5tYXN0ZXJfZmlsZXMgd2hlcmUgdHlwZT0wIGFuZCBkYXRhYmFzZV9pZCA9IERCX0lEKEBvbGRuYW1lKQpzZWxlY3QgQGxvZ3BhdGggPSByZXBsYWNlKHBoeXNpY2FsX25hbWUsQG9sZG5hbWUgKyAnJ19sb2cubGRmJycsJycnJyksIEBsb2duYW1lPU5hbWUgZnJvbSBtYXN0ZXIuc3lzLm1hc3Rlcl9maWxlcyB3aGVyZSB0eXBlPTEgYW5kIGRhdGFiYXNlX2lkID0gREJfSUQoQG9sZG5hbWUpCkVYRUMgKCcnQUxURVIgREFUQUJBU0UgWycnICsgQG9sZG5hbWUgKyAnJ10gU0VUIFNJTkdMRV9VU0VSIFdJVEggUk9MTEJBQ0sgSU1NRURJQVRFJycpCkVYRUMgKCcnQUxURVIgREFUQUJBU0UgWycnICsgQG9sZG5hbWUgKyAnJ10gTU9ESUZZIE5BTUUgPSBbJycgKyBAbmV3bmFtZSArICcnXScnKQpFWEVDICgnJ0FMVEVSIERBVEFCQVNFIFsnJyArIEBuZXduYW1lICsgJyddIE1PRElGWSBGSUxFICgKICAgIE5BTUU9TicnJycnJyArIEBkYXRhbmFtZSArICcnJycnJywKICAgIE5FV05BTUU9TicnJycnJyArIEBuZXduYW1lICsgJycnJycnLAogICAgRklMRU5BTUU9TicnJycnJyArIEBkYXRhcGF0aCArIEBuZXduYW1lICsgJycubWRmJycnJyknJykKRVhFQyAoJydBTFRFUiBEQVRBQkFTRSBbJycgKyBAbmV3bmFtZSArICcnXSBNT0RJRlkgRklMRSAoCiAgICBOQU1FPU4nJycnJycgKyBAbG9nbmFtZSArICcnJycnJywKICAgIE5FV05BTUU9TicnJycnJyArIEBuZXduYW1lICsgJydfbG9nJycnJywKICAgIEZJTEVOQU1FPU4nJycnJycgKyBAbG9ncGF0aCArIEBuZXduYW1lICsgJydfbG9nLmxkZicnJycpJycpCkVYRUMgKCcnQUxURVIgREFUQUJBU0UgWycnICsgQG5ld25hbWUgKyAnJ10gU0VUIE9GRkxJTkUnJykKRVhFQyAoJydFWEVDIHhwX2NtZHNoZWxsICcnJydSRU5BTUUgIicnICsgQGRhdGFwYXRoICsgQGRhdGFuYW1lICsgJycubWRmIiwgIicnICsgQG5ld25hbWUgKyAnJy5tZGYiJycnJycnKQpFWEVDICgnJ0VYRUMgeHBfY21kc2hlbGwgJycnJ1JFTkFNRSAiJycgKyBAbG9ncGF0aCArIEBsb2duYW1lICsgJycubGRmIiwgIicnICsgQG5ld25hbWUgKyAnJ19sb2cubGRmIicnJycnJykKRVhFQyAoJydBTFRFUiBEQVRBQkFTRSBbJycgKyBAbmV3bmFtZSArICcnXSBTRVQgT05MSU5FJycpCkVYRUMgKCcnQUxURVIgREFUQUJBU0UgWycnICsgQG5ld25hbWUgKyAnJ10gU0VUIE1VTFRJX1VTRVIgV0lUSCBST0xMQkFDSyBJTU1FRElBVEUnJykKRVhFQyBzcF9jb25maWd1cmUgJyd4cF9jbWRzaGVsbCcnLEBvbGRjbWRzaGVsbApSRUNPTkZJR1VSRQpkcm9wIHRhYmxlICNvcHQKJykKIkAKCiAgICAkb2JqU1FMQ29tbWFuZC5Db21tYW5kVGV4dCA9ICRzdHJDbWRTdnJEZXRhaWxzCiAgICAkb2JqU1FMQ29tbWFuZC5Db25uZWN0aW9uID0gJG9ialNRTENvbm5lY3Rpb24KICAgICRvYmpTUUxDb21tYW5kLkV4ZWN1dGVOb25RdWVyeSgpCiAgICAkb2JqU1FMQ29ubmVjdGlvbi5DbG9zZSgpCn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBSdW4tSGVhbHRoQW5hbHl6ZXJKb2JzCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogUnVuLUhlYWx0aEFuYWx5emVySm9icwojIERlc2M6IFJ1bnMgYWxsIEhlYWx0aCBBbmFseXplciBUaW1lciBKb2JzIEltbWVkaWF0ZWx5CiMgRnJvbTogaHR0cDovL3d3dy5zaGFyZXBvaW50Y29uZmlnLmNvbS8yMDExLzAxL2luc3RhbnQtc2hhcmVwb2ludC1oZWFsdGgtYW5hbHlzaXMvCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIFJ1bi1IZWFsdGhBbmFseXplckpvYnMKewogICAgJGhlYWx0aEpvYnMgPSBHZXQtU1BUaW1lckpvYiB8IFdoZXJlIHskXy5OYW1lIC1tYXRjaCAiaGVhbHRoLWFuYWx5c2lzLWpvYiJ9CiAgICBsb2cgIiAtIFJ1bm5pbmcgYWxsIEhlYWx0aCBBbmFseXplciBqb2JzLi4uIgogICAgRm9yRWFjaCAoJGpvYiBpbiAkaGVhbHRoSm9icykKICAgIHsKICAgICAgICAkam9iLlJ1bk5vdygpCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBJbnN0YWxsU01UUAojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IEluc3RhbGxTTVRQCiMgRGVzYzogSW5zdGFsbHMgdGhlIFNNVFAgU2VydmVyIFdpbmRvd3MgZmVhdHVyZQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBJbnN0YWxsU01UUChbeG1sXSR4bWxpbnB1dCkKewogICAgSWYgKFNob3VsZElQcm92aXNpb24gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2aWNlcy5TTVRQIC1lcSAkdHJ1ZSkKICAgIHsKICAgICAgICBXcml0ZUxpbmUKICAgICAgICBsb2cgIiAtIEluc3RhbGxpbmcgU01UUCBTZXJ2ZXIgZmVhdHVyZS4uLiIKICAgICAgICAkcXVlcnlPUyA9IEd3bWkgV2luMzJfT3BlcmF0aW5nU3lzdGVtCiAgICAgICAgJHF1ZXJ5T1MgPSAkcXVlcnlPUy5WZXJzaW9uCiAgICAgICAgSWYgKCRxdWVyeU9TLkNvbnRhaW5zKCI2LjAiKSkgIyBXaW4yMDA4CiAgICAgICAgewogICAgICAgICAgICBTdGFydC1Qcm9jZXNzIC1GaWxlUGF0aCBzZXJ2ZXJtYW5hZ2VyY21kLmV4ZSAtQXJndW1lbnRMaXN0ICItaW5zdGFsbCBzbXRwLXNlcnZlciIgLVdhaXQgLU5vTmV3V2luZG93CiAgICAgICAgfQogICAgICAgIEVsc2UgIyBXaW4yMDA4IG9yIFdpbjIwMTIKICAgICAgICB7CiAgICAgICAgICAgICMgR2V0IHRoZSBjdXJyZW50IHByb2dyZXNzIHByZWZlcmVuY2UKICAgICAgICAgICAgJHByZWYgPSAkUHJvZ3Jlc3NQcmVmZXJlbmNlCiAgICAgICAgICAgICMgSGlkZSB0aGUgcHJvZ3Jlc3MgYmFyIHNpbmNlIGl0IHRlbmRzIHRvIG5vdCBkaXNhcHBlYXIKICAgICAgICAgICAgJFByb2dyZXNzUHJlZmVyZW5jZSA9ICJTaWxlbnRseUNvbnRpbnVlIgogICAgICAgICAgICBJbXBvcnQtTW9kdWxlIFNlcnZlck1hbmFnZXIKICAgICAgICAgICAgQWRkLVdpbmRvd3NGZWF0dXJlIC1OYW1lIFNNVFAtU2VydmVyIHwgT3V0LU51bGwKICAgICAgICAgICAgIyBSZXN0b3JlIHByb2dyZXNzIHByZWZlcmVuY2UKICAgICAgICAgICAgJFByb2dyZXNzUHJlZmVyZW5jZSA9ICRwcmVmCiAgICAgICAgICAgIElmICghJD8pIHtUaHJvdyAiIC0gRmFpbGVkIHRvIGluc3RhbGwgU01UUCBTZXJ2ZXIhIn0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIE5lZWQgdG8gc2V0IHRoZSBuZXdseS1pbnN0YWxsZWQgc2VydmljZSB0byBBdXRvbWF0aWMgc2luY2UgaXQgaXMgc2V0IHRvIE1hbnVhbCBieSBkZWZhdWx0IChwZXIgaHR0cHM6Ly9hdXRvc3BpbnN0YWxsZXIuY29kZXBsZXguY29tL3dvcmtpdGVtLzE5NzQ0KQogICAgICAgICAgICAgICAgbG9nICIgIC0gU2V0dGluZyBTTVRQIHNlcnZpY2Ugc3RhcnR1cCB0eXBlIHRvIEF1dG9tYXRpYy4uLiIKICAgICAgICAgICAgICAgIFNldC1TZXJ2aWNlIFNNVFBTVkMgLVN0YXJ0dXBUeXBlIEF1dG9tYXRpYyAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxvZyAiIC0gRG9uZS4iCiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBGaXhUYXhvbm9teVBpY2tlckJ1ZwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IEZpeFRheG9ub215UGlja2VyQnVnCiMgRGVzYzogUmVuYW1lcyB0aGUgVGF4b25vbXlQaWNrZXIuYXNjeCBmaWxlIHdoaWNoIGRvZXNuJ3Qgc2VlbSB0byBiZSB1c2VkIGFueWhvdwojIERlc2M6IEdvZXMgb25lIHN0ZXAgZnVydGhlciB0aGFuIHRoZSBmaXggc3VnZ2VzdGVkIGluIGh0dHA6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20va2IvMjQ4MTg0NCAod2hpY2ggZG9lc24ndCB3b3JrIGF0IGFsbCkKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gRml4VGF4b25vbXlQaWNrZXJCdWcKewogICAgJHRheG9ub215UGlja2VyID0gIiRlbnY6Q29tbW9uUHJvZ3JhbUZpbGVzXE1pY3Jvc29mdCBTaGFyZWRcV2ViIFNlcnZlciBFeHRlbnNpb25zXCRlbnY6c3BWZXJcVEVNUExBVEVcQ09OVFJPTFRFTVBMQVRFU1xUYXhvbm9teVBpY2tlci5hc2N4IgogICAgSWYgKFRlc3QtUGF0aCAkdGF4b25vbXlQaWNrZXIpCiAgICB7CiAgICAgICAgV3JpdGVMaW5lCiAgICAgICAgbG9nICIgLSBSZW5hbWluZyBUYXhvbm9teVBpY2tlci5hc2N4Li4uIgogICAgICAgIE1vdmUtSXRlbSAtUGF0aCAkdGF4b25vbXlQaWNrZXIgLURlc3RpbmF0aW9uICR0YXhvbm9teVBpY2tlciIuYnVnZ3kiIC1Gb3JjZQogICAgICAgIGxvZyAiIC0gRG9uZS4iCiAgICAgICAgV3JpdGVMaW5lCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBNaXNjZWxsYW5lb3VzIENoZWNrcwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IENoZWNrRm9yMjAxMFNQMQojIERlc2M6IFJldHVybnMgJHRydWUgaWYgdGhlIFNoYXJlUG9pbnQgMjAxMCBmYXJtIGJ1aWxkIG51bWJlciBvciBTaGFyZVBvaW50IERMTCBpcyBhdCBTZXJ2aWNlIFBhY2sgMSAoNjAyOSkgb3IgZ3JlYXRlciAob3IgaWYgc2xpcHN0cmVhbWVkIFNQMSBpcyBkZXRlY3RlZCk7IG90aGVyd2lzZSByZXR1cm5zICRmYWxzZQojIERlc2M6IEhlbHBzIHRvIGRldGVybWluZSB3aGV0aGVyIGNlcnRhaW4gbmV3L3VwZGF0ZWQgY21kbGV0cyBhcmUgYXZhaWxhYmxlCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIENoZWNrRm9yMjAxMFNQMQp7CiAgICAjIEZpcnN0IG9mZiwgaWYgdGhpcyBpcyBTUDIwMTMgb3IgaGlnaGVyLCB3ZSdyZSBnb29kCiAgICBpZiAoJGVudjpzcFZlciAtZ2UgIjE1IikKICAgIHsKICAgICAgICByZXR1cm4gJHRydWUKICAgIH0KICAgICMgT3RoZXJ3aXNlLCBpZiBpdCdzIDIwMTAsIHJ1biBzb21lIGFkZGl0aW9uYWwgY2hlY2tzCiAgICBlbHNlaWYgKEdldC1Db21tYW5kIEdldC1TUEZhcm0gLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpCiAgICB7CiAgICAgICAgIyBUcnkgdG8gZ2V0IHRoZSB2ZXJzaW9uIG9mIHRoZSBmYXJtIGZpcnN0CiAgICAgICAgJGJ1aWxkID0gKEdldC1TUEZhcm0pLkJ1aWxkVmVyc2lvbi5CdWlsZAogICAgICAgIElmICghKCRidWlsZCkpICMgR2V0IHRoZSBQcm9kdWN0VmVyc2lvbiBvZiBhIFNoYXJlUG9pbnQgRExMIGluc3RlYWQsIHNpbmNlIHRoZSBmYXJtIGRvZXNuJ3Qgc2VlbSB0byBleGlzdCB5ZXQKICAgICAgICB7CiAgICAgICAgICAgICRzcFByb2RWZXIgPSAoR2V0LUNvbW1hbmQgJGVudjpDb21tb25Qcm9ncmFtRmlsZXMiXE1pY3Jvc29mdCBTaGFyZWRcV2ViIFNlcnZlciBFeHRlbnNpb25zXCRlbnY6c3BWZXJcaXNhcGlcbWljcm9zb2Z0LnNoYXJlcG9pbnQucG9ydGFsLmRsbCIpLkZpbGVWZXJzaW9uSW5mby5Qcm9kdWN0VmVyc2lvbgogICAgICAgICAgICAkbnVsbCwkbnVsbCxbaW50XSRidWlsZCwkbnVsbCA9ICRzcFByb2RWZXIgLXNwbGl0ICJcLiIKICAgICAgICB9CiAgICAgICAgSWYgKCRidWlsZCAtZ2UgNjAyOSkgIyBTUDIwMTAgU1AxCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gJHRydWUKICAgICAgICB9CiAgICB9CiAgICAjIFNoYXJlUG9pbnQgcHJvYmFibHkgaXNuJ3QgaW5zdGFsbGVkIHlldCwgc28gdHJ5IHRvIHNlZSBpZiB3ZSBoYXZlIHNsaXBzdHJlYW1lZCBTUDEgaW4gdGhlIFxVcGRhdGVzIGZvbGRlciBhdCBsZWFzdC4uLgogICAgZWxzZUlmIChHZXQtSXRlbSAiJGVudjpTUGJpdHNcVXBkYXRlc1xvc2VydmVyc3AxLXgtbm9uZS5tc3AiIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKQogICAgewogICAgICAgIHJldHVybiAkdHJ1ZQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHJldHVybiAkZmFsc2UKICAgIH0KfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBDaGVja0ZvcjIwMTNTUDEKIyBEZXNjOiBSZXR1cm5zICR0cnVlIGlmIHRoZSBTaGFyZVBvaW50IDIwMTMgZmFybSBidWlsZCBudW1iZXIgb3IgU2hhcmVQb2ludCBwcmVyZXF1aXNpdGVpbnN0YWxsZXIuZXhlIGlzIGF0IFNlcnZpY2UgUGFjayAxICg0NTY5IG9yIDQ1NjcsIHJlc3BlY3RpdmVseSkgb3IgZ3JlYXRlcjsgb3RoZXJ3aXNlIHJldHVybnMgJGZhbHNlCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIENoZWNrRm9yMjAxM1NQMQp7CiAgICBpZiAoJGVudjpzcFZlciAtZXEgIjE1IikKICAgIHsKICAgICAgICBJZiAoR2V0LUNvbW1hbmQgR2V0LVNQRmFybSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkKICAgICAgICB7CiAgICAgICAgICAgICMgVHJ5IHRvIGdldCB0aGUgdmVyc2lvbiBvZiB0aGUgZmFybSBmaXJzdAogICAgICAgICAgICAkYnVpbGQgPSAoR2V0LVNQRmFybSkuQnVpbGRWZXJzaW9uLkJ1aWxkCiAgICAgICAgICAgIElmICghKCRidWlsZCkpICMgR2V0IHRoZSBQcm9kdWN0VmVyc2lvbiBvZiBhIFNoYXJlUG9pbnQgRExMIGluc3RlYWQsIHNpbmNlIHRoZSBmYXJtIGRvZXNuJ3Qgc2VlbSB0byBleGlzdCB5ZXQKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJHNwUHJvZFZlciA9IChHZXQtQ29tbWFuZCAkZW52OkNvbW1vblByb2dyYW1GaWxlcyJcTWljcm9zb2Z0IFNoYXJlZFxXZWIgU2VydmVyIEV4dGVuc2lvbnNcJGVudjpzcFZlclxpc2FwaVxtaWNyb3NvZnQuc2hhcmVwb2ludC5wb3J0YWwuZGxsIikuRmlsZVZlcnNpb25JbmZvLlByb2R1Y3RWZXJzaW9uCiAgICAgICAgICAgICAgICAkbnVsbCwkbnVsbCxbaW50XSRidWlsZCwkbnVsbCA9ICRzcFByb2RWZXIgLXNwbGl0ICJcLiIKICAgICAgICAgICAgfQogICAgICAgICAgICBJZiAoJGJ1aWxkIC1nZSA0NTY5KSAjIFNQMjAxMyBTUDEKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgUmV0dXJuICR0cnVlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgIyBTaGFyZVBvaW50IHByb2JhYmx5IGlzbid0IGluc3RhbGxlZCB5ZXQsIHNvIHRyeSB0byBkZXRlcm1pbmUgdmVyc2lvbiBvZiBwcmVyZXF1aXNpdGVpbnN0YWxsZXIuZXhlLi4uCiAgICAgICAgRWxzZUlmIChHZXQtSXRlbSAiJGVudjpTUGJpdHNccHJlcmVxdWlzaXRlaW5zdGFsbGVyLmV4ZSIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpCiAgICAgICAgewogICAgICAgICAgICAkcHJlUmVxSW5zdGFsbGVyVmVyID0gKEdldC1Db21tYW5kICIkZW52OlNQYml0c1xwcmVyZXF1aXNpdGVpbnN0YWxsZXIuZXhlIikuRmlsZVZlcnNpb25JbmZvLlByb2R1Y3RWZXJzaW9uCiAgICAgICAgICAgICRudWxsLCRudWxsLFtpbnRdJGJ1aWxkLCRudWxsID0gJHByZVJlcUluc3RhbGxlclZlciAtc3BsaXQgIlwuIgogICAgICAgICAgICBJZiAoJGJ1aWxkIC1nZSA0NTY3KSAjIFNQMjAxMyBTUDEKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgUmV0dXJuICR0cnVlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgRWxzZQogICAgICAgIHsKICAgICAgICAgICAgUmV0dXJuICRmYWxzZQogICAgICAgIH0KICAgIH0KICAgIGVsc2VpZiAoJGVudjpzcFZlciAtZ2UgIjE2IikKICAgICAgICB7CiAgICAgICAgICAgIFJldHVybiAkdHJ1ZQogICAgICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBSZXR1cm4gJGZhbHNlCiAgICB9Cn0KCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogQ2hlY2tJZlVwZ3JhZGVOZWVkZWQKIyBEZXNjOiBSZXR1cm5zICR0cnVlIGlmIHRoZSBzZXJ2ZXIgb3IgZmFybSByZXF1aXJlcyBhbiB1cGdyYWRlIChpLmUuIHJlcXVpcmVzIFBTQ29uZmlnIG9yIHRoZSBjb3JyZXNwb25kaW5nIFBvd2VyU2hlbGwgY29tbWFuZHMgdG8gYmUgcnVuKQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBDaGVja0lmVXBncmFkZU5lZWRlZAp7CiAgICAkc2V0dXBUeXBlID0gKEdldC1JdGVtIC1QYXRoICJIS0xNOlxTT0ZUV0FSRVxNaWNyb3NvZnRcU2hhcmVkIFRvb2xzXFdlYiBTZXJ2ZXIgRXh0ZW5zaW9uc1wkZW52OnNwVmVyLjBcV1NTXCIpLkdldFZhbHVlKCJTZXR1cFR5cGUiKQogICAgSWYgKCRzZXR1cFR5cGUgLW5lICJDTEVBTl9JTlNUQUxMIikgIyBGb3IgZXhhbXBsZSwgaWYgdGhlIHZhbHVlIGlzICJCMkJfVVBHUkFERSIKICAgIHsKICAgICAgICBSZXR1cm4gJHRydWUKICAgIH0KICAgIEVsc2UKICAgIHsKICAgICAgICBSZXR1cm4gJGZhbHNlCiAgICB9Cn0KCkZ1bmN0aW9uIEdldC1TaGFyZVBvaW50SW5zdGFsbAp7CiAgICAjIE5ldyhlciksIGZhc3RlciB3YXkgY291cnRlc3kgb2YgU1BSYW1ibGVyIChodHRwczovL3d3dy5jb2RlcGxleC5jb20vc2l0ZS91c2Vycy92aWV3L1NwUmFtYmxlcikKICAgIGlmICgoR2V0LUl0ZW1Qcm9wZXJ0eSBIS0xNOlxTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxVbmluc3RhbGxcKikgfCBXaGVyZS1PYmplY3QgeyRfLkRpc3BsYXlOYW1lIC1saWtlICJNaWNyb3NvZnQgU2hhcmVQb2ludCBTZXJ2ZXIqIn0pCiAgICB7CiAgICAgICAgcmV0dXJuICR0cnVlCiAgICB9CiAgICBlbHNlIHtyZXR1cm4gJGZhbHNlfQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogTWF0Y2hDb21wdXRlck5hbWUKIyBEZXNjOiBSZXR1cm5zIFRSVUUgaWYgdGhlICRjb21wdXRlck5hbWUgc3BlY2lmaWVkIG1hdGNoZXMgb25lIG9mIHRoZSBpdGVtcyBpbiAkY29tcHV0ZXJzTGlzdC4KIwkJU3VwcG9ydHMgd2lsZGNhcmQgbWF0Y2hpbmcgKCMgZm9yIGEgYSBudW1iZXIsICogZm9yIGFueSBub24gd2hpdGVwYWNlIGNoYXJhY3RlcikKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBNYXRjaENvbXB1dGVyTmFtZSgkY29tcHV0ZXJzTGlzdCwgJGNvbXB1dGVyTmFtZSkKewoJSWYgKCRjb21wdXRlcnNMaXN0IC1saWtlICIqJGNvbXB1dGVyTmFtZSoiKSB7IFJldHVybiAkdHJ1ZTsgfQogICAgZm9yZWFjaCAoJHYgaW4gJGNvbXB1dGVyc0xpc3QpIHsKICAgICAgSWYgKCR2LkNvbnRhaW5zKCIqIikgLW9yICR2LkNvbnRhaW5zKCIjIikpIHsKICAgICAgICAgICAgIyB3aWxkY2FyZCBwcm9jZXNzaW5nCiAgICAgICAgICAgIGZvcmVhY2ggKCRpdGVtIGluIC1zcGxpdCAkdikgewogICAgICAgICAgICAgICAgJGl0ZW0gPSAkaXRlbSAtcmVwbGFjZSAiIyIsICJbXGRdIgogICAgICAgICAgICAgICAgJGl0ZW0gPSAkaXRlbSAtcmVwbGFjZSAiXCoiLCAiW1xTXSoiCiAgICAgICAgICAgICAgICBpZiAoJGNvbXB1dGVyTmFtZSAtbWF0Y2ggJGl0ZW0pIHtyZXR1cm4gJHRydWU7fQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CkZ1bmN0aW9uIEdldEZyb21Ob2RlKFtTeXN0ZW0uWG1sLlhtbEVsZW1lbnRdJG5vZGUsIFtzdHJpbmddICRpdGVtKQp7CiAgICAkdmFsdWUgPSAkbm9kZS5HZXRBdHRyaWJ1dGUoJGl0ZW0pCiAgICBJZiAoJHZhbHVlIC1lcSAiIikKICAgIHsKICAgICAgICAkY2hpbGQgPSAkbm9kZS5TZWxlY3RTaW5nbGVOb2RlKCRpdGVtKTsKICAgICAgICBJZiAoJGNoaWxkIC1uZSAkbnVsbCkKICAgICAgICB7CiAgICAgICAgICAgIFJldHVybiAkY2hpbGQuSW5uZXJUZXh0OwogICAgICAgIH0KICAgIH0KICAgIFJldHVybiAkdmFsdWU7Cn0KCiNFbmRSZWdpb24KCiNSZWdpb24gTWFuYWdlIEhPU1RTICYgVVJMcwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IEFkZFRvSE9TVFMKIyBEZXNjOiBUaGlzIHdyaXRlcyBVUkxzIHRvIHRoZSBzZXJ2ZXIncyBsb2NhbCBob3N0cyBmaWxlIGFuZCBwb2ludHMgdGhlbSB0byB0aGUgc2VydmVyIGl0c2VsZgojIEZyb206IENoZWNrIGh0dHA6Ly90b2Rka2xpbmR0LmNvbS9sb29wYmFjayBmb3IgbW9yZSBpbmZvcm1hdGlvbgojIENvcHlyaWdodCBUb2RkIEtsaW5kdCAyMDExCiMgT3JpZ2luYWxseSBwdWJsaXNoZWQgdG8gaHR0cDovL3d3dy50b2Rka2xpbmR0LmNvbS9ibG9nCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIEFkZFRvSE9TVFMgKCRob3N0cykKewogICAgbG9nICIgLSBBZGRpbmcgSE9TVFMgZmlsZSBlbnRyaWVzIGZvciBsb2NhbCByZXNvbHV0aW9uLi4uIgogICAgIyBNYWtlIGJhY2t1cCBjb3B5IG9mIHRoZSBIb3N0cyBmaWxlIHdpdGggdG9kYXkncyBkYXRlCiAgICAkaG9zdHNmaWxlID0gIiRlbnY6d2luZGlyXFN5c3RlbTMyXGRyaXZlcnNcZXRjXEhPU1RTIgogICAgJGRhdGUgPSBHZXQtRGF0ZSAtVUZvcm1hdCAiJXklbSVkJUglTSVTIgogICAgJGZpbGVjb3B5ID0gJGhvc3RzZmlsZSArICcuJyArICRkYXRlICsgJy5jb3B5JwogICAgbG9nICIgIC0gQmFja2luZyB1cCBIT1NUUyBmaWxlIHRvOiIKICAgIGxvZyAiICAtICRmaWxlY29weSIKICAgIENvcHktSXRlbSAkaG9zdHNmaWxlIC1EZXN0aW5hdGlvbiAkZmlsZWNvcHkKCiAgICBpZiAoISRob3N0cykgIyBObyBob3N0cyB3ZXJlIHBhc3NlZCBhcyBhcmd1bWVudHMsIHNvIGxvb2sgYXQgdGhlIEFBTXMgaW4gdGhlIGZhcm0KICAgIHsKICAgICAgICAjIEdldCBhIGxpc3Qgb2YgdGhlIEFBTXMgYW5kIHdlZWQgb3V0IHRoZSBkdXBsaWNhdGVzCiAgICAgICAgJGhvc3RzID0gR2V0LVNQQWx0ZXJuYXRlVVJMIHwgRm9yRWFjaC1PYmplY3QgeyRfLmluY29taW5ndXJsLnJlcGxhY2UoImh0dHBzOi8vIiwiIikucmVwbGFjZSgiaHR0cDovLyIsIiIpfSB8IHdoZXJlLU9iamVjdCB7ICRfLnRvc3RyaW5nKCkgLW5vdGxpa2UgIio6KiIgfSB8IFNlbGVjdC1PYmplY3QgLVVuaXF1ZQogICAgfQoKICAgICMgR2V0IHRoZSBjb250ZW50cyBvZiB0aGUgSG9zdHMgZmlsZQogICAgJGZpbGUgPSBHZXQtQ29udGVudCAkaG9zdHNmaWxlCiAgICAkZmlsZSA9ICRmaWxlIHwgT3V0LVN0cmluZwoKICAgICMgV3JpdGUgdGhlIEFBTXMgdG8gdGhlIGhvc3RzIGZpbGUsIFVOTEVTUyB0aGV5IGFscmVhZHkgZXhpc3QsIGFyZSAibG9jYWxob3N0IiBvciBoYXBwZW4gdG8gbWF0Y2ggdGhlIGxvY2FsIGNvbXB1dGVyIG5hbWUuCiAgICBGb3JFYWNoICgkaG9zdG5hbWUgaW4gJGhvc3RzKQogICAgewogICAgICAgICMgR2V0IHJpZCBvZiBhbnkgcGF0aCBpbmZvcm1hdGlvbiB0aGF0IG1heSBoYXZlIHNudWNrIGluIGhlcmUKICAgICAgICAkaG9zdG5hbWUsJG51bGwgPSAkaG9zdG5hbWUgLXNwbGl0ICIvIiAtcmVwbGFjZSAoImxvY2FsaG9zdCIsICRlbnY6Q09NUFVURVJOQU1FKQogICAgICAgIGlmICgoJGZpbGUgLW1hdGNoICIgJGhvc3RuYW1lIikgLW9yICgkZmlsZSAtbWF0Y2ggImB0JGhvc3RuYW1lIikpICMgQWRkZWQgY2hlY2sgZm9yIGEgc3BhY2Ugb3IgdGFiIGNoYXJhY3RlciBiZWZvcmUgdGhlIGhvc3RuYW1lIGZvciBiZXR0ZXIgZXhhY3QgbWF0Y2hpbmcsIGFsc28gdXNlZCAtbWF0Y2ggZm9yIGNhc2UtaW5zZW5zaXRpdml0eQogICAgICAgIHtsb2cgIiAgLSBIT1NUUyBmaWxlIGVudHJ5IGZvciBgIiRob3N0bmFtZWAiIGFscmVhZHkgZXhpc3RzIC0gc2tpcHBpbmcuIn0KICAgICAgICBlbHNlaWYgKCRob3N0bmFtZSAtZXEgIiRlbnY6Q29tcHV0ZXJuYW1lIiAtb3IgJGhvc3RuYW1lIC1lcSAiJGVudjpDb21wdXRlcm5hbWUuJGVudjpVU0VSRE5TRE9NQUlOIikKICAgICAgICB7bG9nICIgIC0gSE9TVFMgZmlsZSBlbnRyeSBmb3IgYCIkaG9zdG5hbWVgIiBtYXRjaGVzIGxvY2FsIGNvbXB1dGVyIG5hbWUgLSBza2lwcGluZy4ifQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAiICAtIEFkZGluZyBIT1NUUyBmaWxlIGVudHJ5IGZvciBgIiRob3N0bmFtZWAiLi4uIgogICAgICAgICAgICBBZGQtQ29udGVudCAtUGF0aCAkaG9zdHNmaWxlIC1WYWx1ZSAiYHIiCiAgICAgICAgICAgIEFkZC1Db250ZW50IC1QYXRoICRob3N0c2ZpbGUgLXZhbHVlICIxMjcuMC4wLjEgYHQgJGhvc3RuYW1lYHQjIEFkZGVkIGJ5IEF1dG9TUEluc3RhbGxlciB0byBsb2NhbGx5IHJlc29sdmUgU2hhcmVQb2ludCBVUkxzIGJhY2sgdG8gdGhpcyBzZXJ2ZXIiCiAgICAgICAgICAgICRrZWVwSE9TVFNDb3B5ID0gJHRydWUKICAgICAgICB9CiAgICB9CiAgICBJZiAoISRrZWVwSE9TVFNDb3B5KQogICAgewogICAgICAgIGxvZyAiICAtIERlbGV0aW5nIEhPU1RTIGJhY2t1cCBmaWxlIHNpbmNlIG5vIGNoYW5nZXMgd2VyZSBtYWRlLi4uIgogICAgICAgIFJlbW92ZS1JdGVtICRmaWxlY29weQogICAgfQogICAgbG9nICIgLSBEb25lIHdpdGggSE9TVFMgZmlsZS4iCn0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBBZGQtTG9jYWxJbnRyYW5ldFVSTAojIERlc2M6IEFkZHMgYSBVUkwgdG8gdGhlIGxvY2FsIEludHJhbmV0IHpvbmUgKEludGVybmV0IENvbnRyb2wgUGFuZWwpIHRvIGFsbG93IHBhc3MtdGhyb3VnaCBhdXRoZW50aWNhdGlvbiBpbiBJbnRlcm5ldCBFeHBsb3JlciAoYXZvaWQgcHJvbXB0cykKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gQWRkLUxvY2FsSW50cmFuZXRVUkwgKCR1cmwpCnsKICAgIElmICgoJHVybCAtbGlrZSAiKi4qIikgLWFuZCAoKCR3ZWJBcHAuQWRkVVJMVG9Mb2NhbEludHJhbmV0Wm9uZSkgLWVxICR0cnVlKSkKICAgIHsKICAgICAgICAjIFN0cmlwIG91dCBhbnkgcHJvdG9jb2wgdmFsdWUKICAgICAgICAkdXJsID0gJHVybCAtcmVwbGFjZSAiaHR0cDovLyIsIiIgLXJlcGxhY2UgImh0dHBzOi8vIiwiIgogICAgICAgICRzcGxpdFVSTCA9ICR1cmwgLXNwbGl0ICJcLiIKICAgICAgICAjIFRoYW5rcyB0byBDb2RlUGxleCB1c2VyIEV1bGVuc3BpZWdlbCBmb3IgdGhlIHVwZGF0ZXMgJHVybERvbWFpbiBzeW50YXggKGh0dHBzOi8vYXV0b3NwaW5zdGFsbGVyLmNvZGVwbGV4LmNvbS93b3JraXRlbS8yMDQ4NikKICAgICAgICAkdXJsRG9tYWluID0gJHVybC5TdWJzdHJpbmcoJHNwbGl0VVJMWzBdLkxlbmd0aCArIDEpCiAgICAgICAgbG9nICIgLSBBZGRpbmcgKi4kdXJsRG9tYWluIHRvIGxvY2FsIEludHJhbmV0IHNlY3VyaXR5IHpvbmUuLi4iCiAgICAgICAgTmV3LUl0ZW0gLVBhdGggIkhLQ1U6XFNvZnR3YXJlXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXEludGVybmV0IFNldHRpbmdzXFpvbmVNYXBcRG9tYWlucyIgLU5hbWUgJHVybERvbWFpbiAtSXRlbVR5cGUgTGVhZiAtRm9yY2UgfCBPdXQtTnVsbAogICAgICAgIE5ldy1JdGVtUHJvcGVydHkgLVBhdGggIkhLQ1U6XFNvZnR3YXJlXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXEludGVybmV0IFNldHRpbmdzXFpvbmVNYXBcRG9tYWluc1wkdXJsRG9tYWluIiAtTmFtZSAnKicgLXZhbHVlICIxIiAtUHJvcGVydHlUeXBlIGR3b3JkIC1Gb3JjZSB8IE91dC1OdWxsCiAgICB9Cn0KI0VuZFJlZ2lvbgoKI1JlZ2lvbiBGaWxlIFN5c3RlbSBGdW5jdGlvbnMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBDb21wcmVzc0ZvbGRlcgojIERlc2M6IEVuYWJsZXMgTlRGUyBjb21wcmVzc2lvbiBmb3IgYSBnaXZlbiBmb2xkZXIKIyBGcm9tOiBCYXNlZCBvbiBjb25jZXB0cyAmIGNvZGUgZm91bmQgYXQgaHR0cDovL3d3dy5odW1hbnN0dWZmLmNvbS8yMDEwLzYvMjQvaG93LXRvLWNvbXByZXNzLWEtZmlsZS11c2luZy1wb3dlcnNoZWxsCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIENvbXByZXNzRm9sZGVyICgkZm9sZGVyKQp7CiAgICAjIFJlcGxhY2UgXCB3aXRoIFxcIGZvciBXTUkKICAgICR3bWlQYXRoID0gJGZvbGRlci5SZXBsYWNlKCJcIiwiXFwiKQogICAgJHdtaURpcmVjdG9yeSA9IEdldC1XbWlPYmplY3QgLUNsYXNzICJXaW4zMl9EaXJlY3RvcnkiIC1OYW1lc3BhY2UgInJvb3RcY2ltdjIiIC1Db21wdXRlck5hbWUgJGVudjpDT01QVVRFUk5BTUUgLUZpbHRlciAiTmFtZT0nJHdtaVBhdGgnIgogICAgIyBDaGVjayBpZiBmb2xkZXIgaXMgYWxyZWFkeSBjb21wcmVzc2VkCiAgICBJZiAoISgkd21pRGlyZWN0b3J5LkNvbXByZXNzZWQpKQogICAgewogICAgICAgIGxvZyAiIC0gQ29tcHJlc3NpbmcgJGZvbGRlciBhbmQgc3ViZm9sZGVycy4uLiIKICAgICAgICAkY29tcHJlc3MgPSAkd21pRGlyZWN0b3J5LkNvbXByZXNzRXgoIiIsIlRydWUiKQogICAgfQogICAgRWxzZSB7bG9nICIgLSAkZm9sZGVyIGlzIGFscmVhZHkgY29tcHJlc3NlZC4ifQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IEVuc3VyZUZvbGRlcgojIERlc2M6IENoZWNrcyBmb3IgdGhlIGV4aXN0ZW5jZSBhbmQgdmFsaWRpdHkgb2YgYSBnaXZlbiBwYXRoLCBhbmQgYXR0ZW1wdHMgdG8gY3JlYXRlIGlmIGl0IGRvZXNuJ3QgZXhpc3QuCiMgRnJvbTogTW9kaWZpZWQgZnJvbSBwYXRjaCA5ODMzIGF0IGh0dHA6Ly9hdXRvc3BpbnN0YWxsZXIuY29kZXBsZXguY29tL1NvdXJjZUNvbnRyb2wvbGlzdC9wYXRjaGVzIGJ5IHVzZXIgdGltaXVuCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIEVuc3VyZUZvbGRlciAoJHBhdGgpCnsKICAgICAgICBJZiAoIShUZXN0LVBhdGggLVBhdGggJHBhdGggLVBhdGhUeXBlIENvbnRhaW5lcikpCiAgICAgICAgewogICAgICAgICAgICBsb2cgIiAtICRwYXRoIGRvZXNuJ3QgZXhpc3Q7IGNyZWF0aW5nLi4uIgogICAgICAgICAgICBUcnkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgTmV3LUl0ZW0gLVBhdGggJHBhdGggLUl0ZW1UeXBlIERpcmVjdG9yeSB8IE91dC1OdWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgQ2F0Y2gKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nICJXQVJOSU5HOiQoJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIgogICAgICAgICAgICAgICAgVGhyb3cgIiAtIENvdWxkIG5vdCBjcmVhdGUgZm9sZGVyICRwYXRoISIKICAgICAgICAgICAgfQogICAgICAgIH0KfQojRW5kUmVnaW9uCgojUmVnaW9uIFRyaXZpYWwgRnVuY3Rpb25zCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBQYXVzZQojIERlc2M6IFdhaXQgZm9yIHVzZXIgdG8gcHJlc3MgYSBrZXkgLSBub3JtYWxseSB1c2VkIGFmdGVyIGFuIGVycm9yIGhhcyBvY2N1cmVkIG9yIGlucHV0IGlzIHJlcXVpcmVkCiMgTUs6IEFMV0FZUyB1bmF0dGVuZGVkCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gUGF1c2UoJGFjdGlvbiwgJGtleSkKewogICAgbG9nICJTa2lwcGluZyBwYXVzZSIKCiAgICAjIEZyb20gaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL3RlY2huZXQvc2NyaXB0Y2VudGVyL3Jlc291cmNlcy9wc3RpcHMvamFuMDgvcHN0aXAwMTE4Lm1zcHgKICAgICMgaWYgKCRrZXkgLWVxICJhbnkiIC1vciAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJGtleSkpKQogICAgIyB7CiAgICAjICAgICAkYWN0aW9uU3RyaW5nID0gIlByZXNzIGFueSBrZXkgdG8gJGFjdGlvbi4uLiIKICAgICMgICAgIGlmICgtbm90ICR1bmF0dGVuZGVkKQogICAgIyAgICAgewogICAgIyAgICAgICAgIFdyaXRlLUhvc3QgJGFjdGlvblN0cmluZwogICAgIyAgICAgICAgICRudWxsID0gJGhvc3QuVUkuUmF3VUkuUmVhZEtleSgiTm9FY2hvLEluY2x1ZGVLZXlEb3duIikKICAgICMgICAgIH0KICAgICMgICAgIGVsc2UKICAgICMgICAgIHsKICAgICMgICAgICAgICBsb2cgIlNraXBwaW5nIHBhdXNlIGR1ZSB0byAtdW5hdHRlbmRlZCBzd2l0Y2g6ICRhY3Rpb25TdHJpbmciCiAgICAjICAgICB9CiAgICAjIH0KICAgICMgZWxzZQogICAgIyB7CiAgICAjICAgICAkYWN0aW9uU3RyaW5nID0gIkVudGVyIGAiJGtleWAiIHRvICRhY3Rpb24iCiAgICAjICAgICAkY29udGludWUgPSBSZWFkLUhvc3QgLVByb21wdCAkYWN0aW9uU3RyaW5nCiAgICAjICAgICBpZiAoJGNvbnRpbnVlIC1uZSAka2V5KSB7cGF1c2UgJGFjdGlvbiAka2V5fQogICAgIyAKICAgICMgfQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IFdyaXRlTGluZQojIERlc2M6IFdyaXRlcyBhIG5pY2UgbGluZSBvZiBkYXNoZXMgYWNyb3NzIHRoZSBzY3JlZW4KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gV3JpdGVMaW5lCnsKICAgIGxvZyAiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0iCn0KCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogU2hvdy1Qcm9ncmVzcwojIERlc2M6IFNob3dzIGEgcm93IG9mIGRvdHMgdG8gbGV0IHVzIGtub3cgdGhhdCAkcHJvY2VzcyBpcyBzdGlsbCBydW5uaW5nCiMgRnJvbTogQnJpYW4gTGFsYW5jZXR0ZSwgMjAxMgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBTaG93LVByb2dyZXNzICgkcHJvY2VzcywgJGNvbG9yLCAkaW50ZXJ2YWwpCnsKICAgIFdoaWxlIChHZXQtUHJvY2VzcyAtTmFtZSAkcHJvY2VzcyAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkKICAgIHsKICAgICAgICBsb2cgIi4iIAogICAgICAgIFN0YXJ0LVNsZWVwICRpbnRlcnZhbAogICAgfQogICAgbG9nICJEb25lLiIKfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBHZXQtREJQcmVmaXgKIyBEZXNjOiBSZXR1cm5zIHRoZSBkYXRhYmFzZSBwcmVmaXggZm9yIHRoZSBmYXJtCiMgRnJvbTogQnJpYW4gTGFsYW5jZXR0ZSwgMjAxNAojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBHZXQtREJQcmVmaXggKFt4bWxdJHhtbGlucHV0KQp7CiAgICAkZGJQcmVmaXggPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkRhdGFiYXNlLkRCUHJlZml4CiAgICBJZiAoKCRkYlByZWZpeCAtbmUgIiIpIC1hbmQgKCRkYlByZWZpeCAtbmUgJG51bGwpKSB7JGRiUHJlZml4ICs9ICJfIn0KICAgIElmICgkZGJQcmVmaXggLWxpa2UgIipsb2NhbGhvc3QqIikgeyRkYlByZWZpeCA9ICRkYlByZWZpeCAtcmVwbGFjZSAibG9jYWxob3N0IiwiJGVudjpDT01QVVRFUk5BTUUifQogICAgcmV0dXJuICRkYlByZWZpeAp9CiNFbmRSZWdpb24KCiNSZWdpb24gU2VjdXJpdHktUmVsYXRlZAojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IEdldC1BZG1pbmlzdHJhdG9yc0dyb3VwCiMgRGVzYzogUmV0dXJucyB0aGUgYWN0dWFsIChsb2NhbGl6ZWQpIG5hbWUgb2YgdGhlIGJ1aWx0LWluIEFkbWluaXN0cmF0b3JzIGdyb3VwCiMgRnJvbTogUHJvcG9zZWQgYnkgQ29kZXBsZXggdXNlciBTaGVwcG91bmV0IGF0IGh0dHA6Ly9hdXRvc3BpbnN0YWxsZXIuY29kZXBsZXguY29tL2Rpc2N1c3Npb25zLzI2NTc0OQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpGdW5jdGlvbiBHZXQtQWRtaW5pc3RyYXRvcnNHcm91cAp7CiAgICBJZighJGJ1aWx0aW5BZG1pbkdyb3VwKQogICAgewogICAgICAgICRidWlsdGluQWRtaW5Hcm91cCA9IChHZXQtV21pT2JqZWN0IC1DbGFzcyBXaW4zMl9Hcm91cCAtY29tcHV0ZXJuYW1lICRlbnY6Q09NUFVURVJOQU1FIC1GaWx0ZXIgIlNJRD0nUy0xLTUtMzItNTQ0JyBBTkQgTG9jYWxBY2NvdW50PSdUcnVlJyIgLWVycm9yQWN0aW9uICJTdG9wIikuTmFtZQogICAgfQogICAgUmV0dXJuICRidWlsdGluQWRtaW5Hcm91cAp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IFNldC1Vc2VyQWNjb3VudENvbnRyb2wKIyBEZXNjOiBFbmFibGVzIG9yIGRpc2FibGVzIFVzZXIgQWNjb3VudCBDb250cm9sIChVQUMpLCB1c2luZyBhIDEgb3IgYSAwIChyZXNwZWN0aXZlbHkpIHBhc3NlZCBhcyBhIHBhcmFtZXRlcgojIEZyb206IEJyaWFuIExhbGFuY2V0dGUsIDIwMTIKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gU2V0LVVzZXJBY2NvdW50Q29udHJvbCAoJGZsYWcpCnsKICAgICRyZWdVQUMgPSAoR2V0LUl0ZW0gLVBhdGggIkhLTE06XFNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXHBvbGljaWVzXHN5c3RlbSIpLkdldFZhbHVlKCJFbmFibGVMVUEiKQogICAgaWYgKCRmbGFnIC1lcSAkcmVnVUFDKQogICAgewogICAgICAgIGxvZyAiIC0gVXNlciBBY2NvdW50IENvbnRyb2wgaXMgYWxyZWFkeSIgJCgkcmVnVUFDIC1yZXBsYWNlICIxIiwiZW5hYmxlZC4iIC1yZXBsYWNlICIwIiwiZGlzYWJsZWQuIikKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBpZiAoJHJlZ1VBQyAtZXEgMSkKICAgICAgICB7CiAgICAgICAgICAgIE5ldy1JdGVtIC1QYXRoICJIS0xNOlxTT0ZUV0FSRVxBdXRvU1BJbnN0YWxsZXJcIiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IE91dC1OdWxsCgkJCSRyZWdLZXkgPSBHZXQtSXRlbSAtUGF0aCAiSEtMTTpcU09GVFdBUkVcQXV0b1NQSW5zdGFsbGVyXCIKICAgICAgICAgICAgJHJlZ0tleSB8IE5ldy1JdGVtUHJvcGVydHkgLU5hbWUgIlVBQ1dhc0VuYWJsZWQiIC1Qcm9wZXJ0eVR5cGUgU3RyaW5nIC1WYWx1ZSAiMSIgLUZvcmNlIHwgT3V0LU51bGwKICAgICAgICB9CiAgICAgICAgbG9nICIgLSAkKCRmbGFnIC1yZXBsYWNlICIxIiwiUmUtZW5hYmxpbmciIC1yZXBsYWNlICIwIiwiRGlzYWJsaW5nIikgVXNlciBBY2NvdW50IENvbnRyb2wgKGVmZmVjdGl2ZSB1cG9uIHJlc3RhcnQpLi4uIgogICAgICAgIFNldC1JdGVtUHJvcGVydHkgLVBhdGggIkhLTE06XFNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXHBvbGljaWVzXHN5c3RlbSIgLU5hbWUgRW5hYmxlTFVBIC1WYWx1ZSAkZmxhZwogICAgfQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIEZ1bmM6IHVzZXJFeGlzdHMKIyBEZXNjOiAiSGVyZSBpcyBhIGxpdHRsZSBwb3dlcnNoZWxsIGZ1bmN0aW9uIEkgbWFkZSB0byBzZWUgY2hlY2sgaWYgc3BlY2lmaWMgYWN0aXZlIGRpcmVjdG9yeSB1c2VycyBleGlzdHMgb3Igbm90LiIKIyBGcm9tOiBodHRwOi8vb3l2aW5kbmlsc2VuLmNvbS9wb3dlcnNoZWxsLWZ1bmN0aW9uLXRvLWNoZWNrLWlmLWFjdGl2ZS1kaXJlY3RvcnktdXNlcnMtZXhpc3RzLwojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpmdW5jdGlvbiB1c2VyRXhpc3RzIChbc3RyaW5nXSRuYW1lKQp7CiAgICAjd3JpdHRlbiBieTogw4PLnHl2aW5kIE5pbHNlbiAob3l2aW5kbmlsc2VuLmNvbSkKICAgIFtib29sXSRyZXQgPSAkZmFsc2UgI3JldHVybiB2YXJpYWJsZQogICAgJGRvbWFpblJvb3QgPSBbQURTSV0nJwogICAgJGRpclNlYXJjaGVyID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuRGlyZWN0b3J5U2VhcmNoZXIoJGRvbWFpblJvb3QpCiAgICAkZGlyU2VhcmNoZXIuZmlsdGVyID0gIigmKG9iamVjdENsYXNzPXVzZXIpKHNBTUFjY291bnROYW1lPSRuYW1lKSkiCiAgICAkcmVzdWx0cyA9ICRkaXJTZWFyY2hlci5maW5kYWxsKCkKICAgIGlmICgkcmVzdWx0cy5Db3VudCAtZ3QgMCkgI2lmIGEgdXNlciBvYmplY3QgaXMgZm91bmQsIHRoYXQgbWVhbnMgdGhlIHVzZXIgZXhpc3RzLgogICAgewogICAgICAgICRyZXQgPSAkdHJ1ZQogICAgfQogICAgcmV0dXJuICRyZXQKfQoKI0VuZFJlZ2lvbgoKI1JlZ2lvbiBTaG9ydGN1dHMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBBZGRSZXNvdXJjZXNMaW5rCiMgRGVzYzogQWRkcyBhbiBpdGVtIHRvIHRoZSBSZXNvdXJjZXMgbGlzdCBzaG93biBvbiB0aGUgQ2VudHJhbCBBZG1pbiBob21lcGFnZQojICAgICAgICR1cmwgc2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBjZW50cmFsIGFkbWluIGhvbWUgcGFnZSBhbmQgc2hvdWxkIG5vdCBpbmNsdWRlIHRoZSBsZWFkaW5nIC8KIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KRnVuY3Rpb24gQWRkUmVzb3VyY2VzTGluayhbc3RyaW5nXSR0aXRsZSxbc3RyaW5nXSR1cmwpCnsKICAgICRjZW50cmFsYWRtaW5hcHAgPSBHZXQtU1BXZWJBcHBsaWNhdGlvbiAtSW5jbHVkZUNlbnRyYWxBZG1pbmlzdHJhdGlvbiB8ID8geyRfLklzQWRtaW5pc3RyYXRpb25XZWJBcHBsaWNhdGlvbn0KICAgICRjZW50cmFsYWRtaW51cmwgPSAkY2VudHJhbGFkbWluYXBwLlVybAogICAgJGNlbnRyYWxhZG1pbiA9IChHZXQtU1BTaXRlICRjZW50cmFsYWRtaW51cmwpCgogICAgJGl0ZW0gPSAkY2VudHJhbGFkbWluLlJvb3RXZWIuTGlzdHNbIlJlc291cmNlcyJdLkl0ZW1zIHwgV2hlcmUgeyAkX1siVVJMIl0gLW1hdGNoICIuKiwgJHRpdGxlIiB9CiAgICBJZiAoJGl0ZW0gLWVxICRudWxsICkKICAgIHsKICAgICAgICAkaXRlbSA9ICRjZW50cmFsYWRtaW4uUm9vdFdlYi5MaXN0c1siUmVzb3VyY2VzIl0uSXRlbXMuQWRkKCk7CiAgICB9CgogICAgJHVybCA9ICRjZW50cmFsYWRtaW51cmwgKyAkdXJsICsgIiwgJHRpdGxlIjsKICAgICRpdGVtWyJVUkwiXSA9ICR1cmw7CiAgICAkaXRlbS5VcGRhdGUoKTsKfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBGdW5jOiBQaW5Ub1Rhc2tiYXIKIyBEZXNjOiBQaW5zIGEgcHJvZ3JhbSB0byB0aGUgdGFza2JhcgojIEZyb206IGh0dHA6Ly90ZWNoaWJlZS5jb20vcG93ZXJzaGVsbC9waW4tYXBwbGljYXRpb25zLXRvLXRhc2stYmFyLXVzaW5nLXBvd2Vyc2hlbGwvNjg1CiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkZ1bmN0aW9uIFBpblRvVGFza2Jhcihbc3RyaW5nXSRhcHBsaWNhdGlvbikKewogICAgJHNoZWxsID0gTmV3LU9iamVjdCAtQ29tT2JqZWN0ICJTaGVsbC5BcHBsaWNhdGlvbiIKICAgICRmb2xkZXIgPSAkc2hlbGwuTmFtZXNwYWNlKFtTeXN0ZW0uSU8uUGF0aF06OkdldERpcmVjdG9yeU5hbWUoJGFwcGxpY2F0aW9uKSkKCiAgICBGb3JlYWNoICgkdmVyYiBpbiAkZm9sZGVyLlBhcnNlTmFtZShbU3lzdGVtLklPLlBhdGhdOjpHZXRGaWxlTmFtZSgkYXBwbGljYXRpb24pKS52ZXJicygpKQogICAgewogICAgICAgIElmKCR2ZXJiLm5hbWUucmVwbGFjZSgiJiIsIiIpIC1tYXRjaCAiUGluIHRvIFRhc2tiYXIiKQogICAgICAgIHsKICAgICAgICAgICAgJHZlcmIuRG9JdCgpCiAgICAgICAgfQogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gU3RvcCBEZWZhdWx0IFdlYiBTaXRlCkZ1bmN0aW9uIFN0b3AtRGVmYXVsdFdlYnNpdGUgKCkKewogICAgIyBBZGRlZCB0byBhdm9pZCBjb25mbGljdHMgd2l0aCB3ZWIgYXBwcyB0aGF0IGRvIG5vdCB1c2UgYSBob3N0IGhlYWRlcgogICAgIyBUaGFua3MgdG8gUGF1bCBTdG9yayBwZXIgaHR0cDovL2F1dG9zcGluc3RhbGxlci5jb2RlcGxleC5jb20vd29ya2l0ZW0vMTkzMTggZm9yIGNvbmZpcm1pbmcgdGhlIFN0b3AtV2Vic2l0ZSBjbWRsZXQKICAgIEltcG9ydFdlYkFkbWluaXN0cmF0aW9uCiAgICAkZGVmYXVsdFdlYnNpdGUgPSBHZXQtV2Vic2l0ZSB8IFdoZXJlLU9iamVjdCB7JF8uTmFtZSAtZXEgIkRlZmF1bHQgV2ViIFNpdGUiIC1vciAkXy5JRCAtZXEgMSAtb3IgJF8ucGh5c2ljYWxQYXRoIC1lcSAiJVN5c3RlbURyaXZlJVxpbmV0cHViXHd3d3Jvb3QifSAjIFRyeSBkaWZmZXJlbnQgd2F5cyBvZiBpZGVudGlmeWluZyB0aGUgRGVmYXVsdCBXZWIgU2l0ZSwgaW4gY2FzZSBpdCBoYXMgYSBkaWZmZXJlbnQgbmFtZSAoZS5nLiBsb2NhbGl6ZWQgaW5zdGFsbHMpCiAgICBsb2cgIiAtIENoZWNraW5nICQoJGRlZmF1bHRXZWJzaXRlLk5hbWUpLi4uIiAKICAgIGlmICgkZGVmYXVsdFdlYnNpdGUuU3RhdGUgLW5lICJTdG9wcGVkIikKICAgIHsKICAgICAgICBsb2cgIlN0b3BwaW5nLi4uIiAKICAgICAgICAkZGVmYXVsdFdlYnNpdGUgfCBTdG9wLVdlYnNpdGUKICAgICAgICBpZiAoJD8pIHtsb2cgIk9LLiJ9CiAgICB9CiAgICBlbHNlIHtsb2cgIkFscmVhZHkgc3RvcHBlZC4ifQp9CiNFbmRSZWdpb24KCiNSZWdpb24gR2V0IFNQIE1ham9yIFZlcnNpb24gTnVtYmVyCmZ1bmN0aW9uIEdldC1NYWpvclZlcnNpb25OdW1iZXIgKFt4bWxdJHhtbGlucHV0KQp7CiAgICAjIENyZWF0ZSBoYXNoIHRhYmxlcyB3aXRoIG1ham9yIHZlcnNpb24gdG8gcHJvZHVjdCB5ZWFyIG1hcHBpbmdzICYgdmljZS12ZXJzYQogICAgJHNwWWVhcnMgPSBAeyIxNCIgPSAiMjAxMCI7ICIxNSIgPSAiMjAxMyI7ICIxNiIgPSAiMjAxNiJ9CiAgICAkc3BWZXJzaW9ucyA9IEB7IjIwMTAiID0gIjE0IjsgIjIwMTMiID0gIjE1IjsgIjIwMTYiID0gIjE2In0KICAgICRlbnY6c3BWZXIgPSAkc3BWZXJzaW9ucy4oJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uSW5zdGFsbC5TUFZlcnNpb24pCn0KI0VuZFJlZ2lvbgoKI0VuZFJlZ2lvbgoKI3JlZ2lvbiBDVVNUT00gRlVOQ1RJT05TIChDU0MpCiMgQXV0aG9yOiBNYXJpbmEga3J5bmluYSwgQ1NDCkZ1bmN0aW9uIFVwZGF0ZVByb2Nlc3NJZGVudGl0eVRvUnVuQXMgKCRzZXJ2aWNlVG9VcGRhdGUsIFtzdHJpbmddICRuZXdTZXJ2aWNlSWRlbnRpdHkpCnsKICAgICMgTWFuYWdlZCBBY2NvdW50CiAgICAkbWFuYWdlZEFjY291bnRHZW4gPSBHZXQtU1BNYW5hZ2VkQWNjb3VudCB8IFdoZXJlLU9iamVjdCB7JF8uVXNlck5hbWUgLWVxICQoJG5ld1NlcnZpY2VJZGVudGl0eSl9CiAgICBpZiAoJG1hbmFnZWRBY2NvdW50R2VuIC1lcSAkbnVsbCkgeyBUaHJvdyAiIC0gTWFuYWdlZCBBY2NvdW50ICQoJG5ld1NlcnZpY2VJZGVudGl0eSkgbm90IGZvdW5kIiB9CiAgICBpZiAoJHNlcnZpY2VUb1VwZGF0ZS5TZXJ2aWNlKSB7JHNlcnZpY2VUb1VwZGF0ZSA9ICRzZXJ2aWNlVG9VcGRhdGUuU2VydmljZX0KICAgIGlmICgkc2VydmljZVRvVXBkYXRlLlByb2Nlc3NJZGVudGl0eS5Vc2VybmFtZSAtbmUgJG1hbmFnZWRBY2NvdW50R2VuLlVzZXJOYW1lKQogICAgewogICAgICAgIGxvZyAiIC0gVXBkYXRpbmcgJCgkc2VydmljZVRvVXBkYXRlLlR5cGVOYW1lKSB0byBydW4gYXMgJCgkbWFuYWdlZEFjY291bnRHZW4uVXNlck5hbWUpLi4uIiAKICAgICAgICAjIFNldCB0aGUgUHJvY2VzcyBJZGVudGl0eSB0byBvdXIgZ2VuZXJhbCBBcHAgUG9vbCBBY2NvdW50OyBvdGhlcndpc2UgaXQncyBzZXQgYnkgZGVmYXVsdCB0byB0aGUgRmFybSBBY2NvdW50IGFuZCBnaXZlcyB3YXJuaW5ncyBpbiB0aGUgSGVhbHRoIEFuYWx5emVyCiAgICAgICAgJHNlcnZpY2VUb1VwZGF0ZS5Qcm9jZXNzSWRlbnRpdHkuQ3VycmVudElkZW50aXR5VHlwZSA9ICJTcGVjaWZpY1VzZXIiCiAgICAgICAgJHNlcnZpY2VUb1VwZGF0ZS5Qcm9jZXNzSWRlbnRpdHkuTWFuYWdlZEFjY291bnQgPSAkbWFuYWdlZEFjY291bnRHZW4KICAgICAgICAkc2VydmljZVRvVXBkYXRlLlByb2Nlc3NJZGVudGl0eS5VcGRhdGUoKQogICAgICAgICRzZXJ2aWNlVG9VcGRhdGUuUHJvY2Vzc0lkZW50aXR5LkRlcGxveSgpCiAgICAgICAgbG9nICJEb25lLiIKICAgIH0KICAgIGVsc2Uge2xvZyAiIC0gJCgkc2VydmljZVRvVXBkYXRlLlR5cGVOYW1lKSBpcyBhbHJlYWR5IGNvbmZpZ3VyZWQgdG8gcnVuIGFzICQoJG1hbmFnZWRBY2NvdW50R2VuLlVzZXJOYW1lKS4ifQp9CgojIE1LIC0gY3VzdG9tIGZ1bmN0aW9uCmZ1bmN0aW9uIENvcHlTaGFyZVBvaW50Um9vdENlcnRUb0xvY2FsVHJ1c3RlZENlcnRTdG9yZSAKewogICAgIyBBZGQgdGhlIFNoYXJlUG9pbnQgUG93ZXJTaGVsbCBzbmFwLWluCiAgICBpZiAoLW5vdCAoR2V0LVBTU25hcGluIE1pY3Jvc29mdC5TaGFyZVBvaW50LlBvd2VyU2hlbGwgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpKSB7CiAgICAgICAgQWRkLVBTU25hcGluIE1pY3Jvc29mdC5TaGFyZVBvaW50LlBvd2VyU2hlbGwgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgIH0KIAogICAgIyBHZXQgdGhlIFNoYXJlUG9pbnQgcm9vdCBjZXJ0aWZpY2F0ZQogICAgJHJvb3RDZXJ0ID0gKEdldC1TUENlcnRpZmljYXRlQXV0aG9yaXR5KS5Sb290Q2VydGlmaWNhdGUKIAogICAgIyBDaGVjayBpZiB0aGUgY2VydGlmaWNhdGUgYWxyZWFkeSBleGlzdHMKICAgICMgSWYgaXQgZG9lcywgcmVwb3J0IGFuZCBlbmQKICAgIGlmICgoZGlyICJDZXJ0OlxMb2NhbE1hY2hpbmVcUm9vdCIgfCA/IHsgJF8uVGh1bWJwcmludCAtZXEgJHJvb3RDZXJ0LlRodW1icHJpbnQgfSkpIHsKICAgICAgICBsb2cgIklORk86IFNoYXJlUG9pbnQgUm9vdCBBdXRob3JpdHkgYWxyZWFkeSBleGlzdHMgaW4gbG9jYWwgbWFjaGluZSB0cnVzdGVkIHJvb3QgY2VydGlmaWNhdGUgc3RvcmUuIgogICAgICAgIHJldHVybgogICAgfQogCiAgICAjIEdldCB0aGUgY2VydGlmaWNhdGUgc3RvcmUgZm9yICJUcnVzdGVkIFJvb3QgQ2VydGlmaWNhdGlvbiBBdXRob3JpdGllcyIgKENlcnQ6XExvY2FsTWFjaGluZVxSb290KQogICAgJGNlcnRTdG9yZSA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuWDUwOUNlcnRpZmljYXRlcy5YNTA5U3RvcmUgUm9vdCwgTG9jYWxNYWNoaW5lCiAKICAgICMgT3BlbiB0aGUgc3RvcmUgd2l0aCBtYXhpbXVtIGFsbG93ZWQgcHJpdmlsZWdlcwogICAgJGNlcnRTdG9yZS5PcGVuKCJNYXhBbGxvd2VkIikKIAogICAgIyBBZGQgdGhlIGNlcnRpZmljYXRlIHRvIHRoZSBzdG9yZQogICAgJGNlcnRTdG9yZS5BZGQoJHJvb3RDZXJ0KQogCiAgICAjIENsb3NlIHRoZSBzdG9yZQogICAgJGNlcnRTdG9yZS5DbG9zZSgpCiAKICAgICMgR2V0IHRoZSBjZXJ0aWZpY2F0ZSBpZiBpdCBleGlzdHMKICAgIGlmICgoZGlyICJDZXJ0OlxMb2NhbE1hY2hpbmVcUm9vdCIgfCA/IHsgJF8uVGh1bWJwcmludCAtZXEgJHJvb3RDZXJ0LlRodW1icHJpbnQgfSkpIHsKICAgICAgICBsb2cgIklORk86IENlcnRpZmljYXRlIHdhcyBzdWNjZXNzZnVsbHkgYWRkZWQgdG8gdGhlIFRydXN0ZWQgUm9vdCBzdG9yZS4iCiAgICB9CiAgICBlbHNlIHsKICAgICAgICBsb2cgIldBUk5JTkc6IFRoZSBjZXJ0aWZpY2F0ZSBjb3VsZCBub3QgYmUgYWRkZWQgdG8gdGhlIFRydXN0ZWQgUm9vdCBzdG9yZS4iCiAgICB9Cn0KCmZ1bmN0aW9uIEFkZEZhcm1BY2NvdW50VG9Mb2dvbkxvY2FsbHkgKFtzdHJpbmddICRmYXJtQWNjb3VudCkKewogICAgIyBNb2RpZmllZCBieSBNYXJpbmEgS3J5bmluYSwgQ1NDCiAgICAjIHdyaXR0ZW4gYnkgSW5nbyBLYXJzdGVpbiwgaHR0cDovL2lrYXJzdGVpbi53b3JkcHJlc3MuY29tCiAgICAjICB2MS4wLCAxMC8xMi8yMDEyCgogICAgJGFjY291bnRUb0FkZCA9ICRmYXJtQWNjb3VudAoKICAgICRzaWRzdHIgPSAkbnVsbAogICAgdHJ5IHsKCSAgICAkbnRwcmluY2lwYWwgPSBuZXctb2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuTlRBY2NvdW50ICIkYWNjb3VudFRvQWRkIgoJICAgICRzaWQgPSAkbnRwcmluY2lwYWwuVHJhbnNsYXRlKFtTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcl0pCgkgICAgJHNpZHN0ciA9ICRzaWQuVmFsdWUuVG9TdHJpbmcoKQogICAgfSBjYXRjaCB7CgkgICAgJHNpZHN0ciA9ICRudWxsCiAgICB9CgogICAgbG9nICJJTkZPOiBBY2NvdW50OiAkKCRhY2NvdW50VG9BZGQpIgoKICAgIGlmKCBbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkc2lkc3RyKSApIHsKCSAgICBsb2cgIkVSUk9SOiBBY2NvdW50IG5vdCBmb3VuZCEiCgkgICAgZXhpdCAtMQogICAgfQoKICAgIGxvZyAiSU5GTzogQWNjb3VudCBTSUQ6ICQoJHNpZHN0cikiCgogICAgJHRtcCA9IFtTeXN0ZW0uSU8uUGF0aF06OkdldFRlbXBGaWxlTmFtZSgpCgogICAgbG9nICJJTkZPOiBFeHBvcnQgY3VycmVudCBMb2NhbCBTZWN1cml0eSBQb2xpY3kiCiAgICBzZWNlZGl0LmV4ZSAvZXhwb3J0IC9jZmcgIiQoJHRtcCkiIAoKICAgICRjID0gR2V0LUNvbnRlbnQgLVBhdGggJHRtcCAKCiAgICAkY3VycmVudFNldHRpbmcgPSAiIgoKICAgIGZvcmVhY2goJHMgaW4gJGMpIHsKCSAgICBpZiggJHMgLWxpa2UgIlNlSW50ZXJhY3RpdmVMb2dvblJpZ2h0KiIpIHsKCQkgICAgJHggPSAkcy5zcGxpdCgiPSIsW1N5c3RlbS5TdHJpbmdTcGxpdE9wdGlvbnNdOjpSZW1vdmVFbXB0eUVudHJpZXMpCgkJICAgICRjdXJyZW50U2V0dGluZyA9ICR4WzFdLlRyaW0oKQoJICAgIH0KICAgIH0KCiAgICBpZiggJGN1cnJlbnRTZXR0aW5nIC1ub3RsaWtlICIqJCgkc2lkc3RyKSoiICkgewoJICAgIGxvZyAiSU5GTzogTW9kaWZ5IFNldHRpbmcgIiJBbGxvdyBMb2dvbiBMb2NhbGx5IiIiCgkKCSAgICBpZiggW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJGN1cnJlbnRTZXR0aW5nKSApIHsKCQkgICAgJGN1cnJlbnRTZXR0aW5nID0gIiokKCRzaWRzdHIpIgoJICAgIH0gZWxzZSB7CgkJICAgICRjdXJyZW50U2V0dGluZyA9ICIqJCgkc2lkc3RyKSwkKCRjdXJyZW50U2V0dGluZykiCgkgICAgfQoJCgkgICAgbG9nICJJTkZPOiAkY3VycmVudFNldHRpbmciCgkKCSAgICAkb3V0ZmlsZSA9IEAiCiAgICBbVW5pY29kZV0KICAgIFVuaWNvZGU9eWVzCiAgICBbVmVyc2lvbl0KICAgIHNpZ25hdHVyZT0iYCRDSElDQUdPYCQiCiAgICBSZXZpc2lvbj0xCiAgICBbUHJpdmlsZWdlIFJpZ2h0c10KICAgIFNlSW50ZXJhY3RpdmVMb2dvblJpZ2h0ID0gJCgkY3VycmVudFNldHRpbmcpCiJACgoJICAgICR0bXAyID0gW1N5c3RlbS5JTy5QYXRoXTo6R2V0VGVtcEZpbGVOYW1lKCkKCQoJCgkgICAgbG9nICJJTkZPOiBJbXBvcnQgbmV3IHNldHRpbmdzIHRvIExvY2FsIFNlY3VyaXR5IFBvbGljeSIgCgkgICAgJG91dGZpbGUgfCBTZXQtQ29udGVudCAtUGF0aCAkdG1wMiAtRW5jb2RpbmcgVW5pY29kZSAtRm9yY2UKCgkgICAgI25vdGVwYWQuZXhlICR0bXAyCgkgICAgUHVzaC1Mb2NhdGlvbiAoU3BsaXQtUGF0aCAkdG1wMikKCQoJICAgIHRyeSB7CgkJICAgIHNlY2VkaXQuZXhlIC9jb25maWd1cmUgL2RiICJzZWNlZGl0LnNkYiIgL2NmZyAiJCgkdG1wMikiIC9hcmVhcyBVU0VSX1JJR0hUUyAKCQkgICAgI3dyaXRlLWhvc3QgInNlY2VkaXQuZXhlIC9jb25maWd1cmUgL2RiICIic2VjZWRpdC5zZGIiIiAvY2ZnICIiJCgkdG1wMikiIiAvYXJlYXMgVVNFUl9SSUdIVFMgIgoJICAgIH0gZmluYWxseSB7CQoJCSAgICBQb3AtTG9jYXRpb24KCSAgICB9CiAgICB9IGVsc2UgewoJICAgIGxvZyAiSU5GTzogTk8gQUNUSU9OUyBSRVFVSVJFRCEgQWNjb3VudCBhbHJlYWR5IGluICIiQWxsb3cgTG9nb24gTG9jYWxseSIiIgogICAgfQoKICAgIGxvZyAiSU5GTzogRG9uZS4iCn0KCmZ1bmN0aW9uIFJlc2V0RklNU2VydmljZXMKewogICAgJGZpbVNlcnZpY2VzID0gQCgiRklNU2VydmljZSIsICJGSU1TeW5jaHJvbml6YXRpb25TZXJ2aWNlIikKICAgIAogICAgZm9yZWFjaCgkZmltU3ZjIGluICRmaW1TZXJ2aWNlcykKICAgIHsKICAgICAgICBsb2cgIklORk86IFNlcnZpY2UgPSAkZmltU3ZjIgogICAgICAgICRMb2NhbFNydiA9IEdldC1XbWlPYmplY3Qgd2luMzJfc2VydmljZSB8IFdoZXJlLU9iamVjdCB7JF8ubmFtZSAtZXEgJGZpbVN2Y30KCiAgICAgICAgbG9nICgiSU5GTzogU2VydmljZS5TdGFydE5hbWUgYmVmb3JlID0gIiArICRMb2NhbFNydi5TdGFydE5hbWUpCiAgICAgICAgaWYgKCEoW3N0cmluZ10kTG9jYWxTcnYuU3RhcnROYW1lKS5Db250YWlucygiTG9jYWxTeXN0ZW0iKSkKICAgICAgICB7CiAgICAgICAgICAgICRMb2NhbFNydi5DaGFuZ2UoJG51bGwsJG51bGwsJG51bGwsJG51bGwsJG51bGwsJGZhbHNlLCIuXExvY2FsU3lzdGVtIiwiIikKICAgICAgICB9CgogICAgICAgIGxvZyAoIklORk86IFNlcnZpY2UuU3RhdGUgYmVmb3JlID0gIiArICRMb2NhbFNydi5TdGF0ZSkKICAgICAgICBsb2cgKCJJTkZPOiBTZXJ2aWNlLlN0YXJ0TW9kZSBiZWZvcmUgPSAiICsgJExvY2FsU3J2LlN0YXJ0TW9kZSkKICAgICAgICBpZiAoJExvY2FsU3J2LlN0YXRlIC1uZSAiRGlzYWJsZWQiKQogICAgICAgIHsKICAgICAgICAgICAgJExvY2FsU3J2LkNoYW5nZVN0YXJ0TW9kZSgiRGlzYWJsZWQiKQogICAgICAgIH0KCiAgICAgICAgJExvY2FsU3J2ID0gR2V0LVdtaU9iamVjdCB3aW4zMl9zZXJ2aWNlIHwgV2hlcmUtT2JqZWN0IHskXy5uYW1lIC1lcSAkZmltU3ZjfQogICAgICAgIGxvZyAoIklORk86IFNlcnZpY2UuU3RhcnROYW1lIGFmdGVyID0gIiArICRMb2NhbFNydi5TdGFydE5hbWUpCiAgICAgICAgbG9nICgiSU5GTzogU2VydmljZS5TdGF0ZSBhZnRlciA9ICIgKyAkTG9jYWxTcnYuU3RhdGUpCiAgICAgICAgbG9nICgiSU5GTzogU2VydmljZS5TdGFydE1vZGUgYWZ0ZXIgPSAiICsgJExvY2FsU3J2LlN0YXJ0TW9kZSkKICAgIH0gICAgICAKfQoKZnVuY3Rpb24gSW1wb3J0V2ViQXBwc1htbFRvRmFybUNvbmZpZ1htbChbc3RyaW5nXSAkaW5wdXRGaWxlLCBbc3RyaW5nXSAkd2ViQXBwc0lucHV0RmlsZSkKewogICAgaWYgKChpZkZpbGVFeGlzdHMoICR3ZWJBcHBzSW5wdXRGaWxlKSkgLW5lICR0cnVlKQogICAgewogICAgICAgIHRocm93ICJFUlJPUjogJHdlYkFwcHNJbnB1dEZpbGUgaXMgbWlzc2luZyIKICAgIH0KCiAgICBDcmVhdGVCYWNrdXBDb3B5ICR3ZWJBcHBzSW5wdXRGaWxlCgogICAgW3htbF0keG1sV2ViQXBwc0lucHV0ID0gW3htbF0oR2V0LUNvbnRlbnQgJHdlYkFwcHNJbnB1dEZpbGUpCgogICAgaWYgKChpZkZpbGVFeGlzdHMoICRpbnB1dEZpbGUpKSAtbmUgJHRydWUpCiAgICB7CiAgICAgICAgdGhyb3cgIkVSUk9SOiAkaW5wdXRGaWxlIGlzIG1pc3NpbmciCiAgICB9CgogICAgQ3JlYXRlQmFja3VwQ29weSAkaW5wdXRGaWxlCgogICAgW3htbF0keG1saW5wdXQgPSBbeG1sXShHZXQtQ29udGVudCAkaW5wdXRGaWxlKQoKICAgICMgSWYgdGhlIEZhcm0gQ29uZmlnIFhNTCBoYXMgd2ViIGFwcHMgYWRkZWQsIHJlbW92ZSB0aGVtIGFuZCBnZXQgdGhlIHdlYiBhcHBzIGluZm8gZnJvbSB0aGUgV2ViIEFwcHMgQ29uZmlnIFhNTAogICAgaWYgKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLldlYkFwcGxpY2F0aW9ucy5IYXNDaGlsZE5vZGVzIC1lcSAkdHJ1ZSkKICAgIHsKICAgICAgICBmb3JlYWNoICgkd2EgaW4gJCgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5XZWJBcHBsaWNhdGlvbnMuV2ViQXBwbGljYXRpb24pKQogICAgICAgIHsgICAKICAgICAgICAgICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uV2ViQXBwbGljYXRpb25zLlJlbW92ZUNoaWxkKCR3YSkKICAgICAgICB9CiAgICB9CgogICAgIyBhcHBlbmQgdGhlIHdlYiBhcHBzIGluZm8gdG8gdGhlIEZhcm0gQ29uZmlnIFhNTAogICAgJHhtbFdlYkFwcHMgPSAkeG1sV2ViQXBwc0lucHV0LkNvbmZpZ3VyYXRpb24uV2ViQXBwbGljYXRpb25zCiAgIAogICAgaWYgKCR4bWxXZWJBcHBzSW5wdXQuQ29uZmlndXJhdGlvbi5XZWJBcHBsaWNhdGlvbnMpCiAgICB7CiAgICAgICAgZm9yZWFjaCAoJHdlYkFwcCBpbiAkKCR4bWxXZWJBcHBzSW5wdXQuQ29uZmlndXJhdGlvbi5XZWJBcHBsaWNhdGlvbnMuV2ViQXBwbGljYXRpb24pKQogICAgICAgIHsKICAgICAgICAgICAgJHBvcnRhbFdlYkFwcERCX3NlcnZlciA9IChbc3RyaW5nXShHZXQtU2VydmVyTmFtZSAkQ09OVEVOVF9EQl9TRVJWRVIpKS5Ub1VwcGVyKCkKICAgICAgICAgICAgJHdlYkFwcC5EYXRhYmFzZS5EQkFsaWFzLkRCSW5zdGFuY2UgPSAkcG9ydGFsV2ViQXBwREJfc2VydmVyICsgIlwiICsgJENPTlRFTlRfREJfSU5TVEFOQ0UKICAgICAgICAgICAgJHdlYkFwcC5EYXRhYmFzZS5EQkFsaWFzLkRCUG9ydCA9ICRDT05URU5UX0RCX1BPUlQKCiAgICAgICAgICAgICR3ZWJBcHAuRGF0YWJhc2UuREJTZXJ2ZXIgPSAkQ09OVEVOVERCX0FMSUFTCiAgICAgICAgICAgICR3ZWJBcHAuRGF0YWJhc2UuREJBbGlhcy5DcmVhdGUgPSAkQ09OVEVOVERCX0FMSUFTX0NSRUFURQoKICAgICAgICAgICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uV2ViQXBwbGljYXRpb25zLkFwcGVuZENoaWxkKCR4bWxpbnB1dC5JbXBvcnROb2RlKCR3ZWJBcHAsICR0cnVlKSkKCiAgICAgICAgICAgICMgZm9yZWFjaCAoJHNpdGVDb2xsZWN0aW9uIGluICQoJHdlYkFwcC5TaXRlQ29sbGVjdGlvbnMuU2l0ZUNvbGxlY3Rpb24pKQogICAgICAgICAgICAjIHsKICAgICAgICAgICAgIyB9CiAgICAgICAgfQogICAgfQoKICAgICR4bWxpbnB1dC5TYXZlKCRpbnB1dEZpbGUpCn0KCmZ1bmN0aW9uIFVwZGF0ZUlucHV0RmlsZSAoW3N0cmluZ10gJGlucHV0RmlsZSkKewogICAgIyB0aGlzIGlzIGEgdmFyaWFibGUgdG8gZm9yY2UgaGFyZGNvZGVkIGRlZmF1bHRzLiBJdCBpcyB1c2VmdWwgZm9yIHRlc3Rpbmcgb3V0c2lkZSBvZiBBZ2lsaXR5CiAgICAkdXNlSGFyZGNvZGVkRGVmYXVsdHMgPSAkZmFsc2UKCiAgICAjIGlmICgoaWZGaWxlRXhpc3RzKCAkaW5wdXRGaWxlKSkgLW5lICR0cnVlKQogICAgaWYgKChDaGVja0ZpbGVFeGlzdHMoICRpbnB1dEZpbGUpKSAtbmUgJHRydWUpCiAgICB7CiAgICAgICAgdGhyb3cgIkVSUk9SOiAkaW5wdXRGaWxlIGlzIG1pc3NpbmciCiAgICB9CgogICAgQ3JlYXRlQmFja3VwQ29weSAkaW5wdXRGaWxlCiAgICBbeG1sXSR4bWxpbnB1dCA9IFt4bWxdKEdldC1Db250ZW50ICRpbnB1dEZpbGUpCgogICAgIyBJTlNUQUxMICAKICAgICMgVGhpcyBpbmZvcm1hdGlvbiB3YXMgdXBkYXRlZCBkdXJpbmcgYmluYXJpZXMgaW5zdGFsbCBhbmQgdGFrZW4gZnJvbSBTaWxlbnRDb25maWcueG1sCiAgICAjIEluc3RhbGxEaXIKICAgICMgRGF0YURpcgogICAgIyBwaWRLZXkKCiAgICAjIFRoaXMgdmFyaWFibGUgaXMgdXNlZCBpbiBERUJVRyBtb2RlIG9ubHkhCiAgICAkc3BfZGJfc2VydmVyID0gIkRCUy0wMDMiCgogICAgaWYgKCR2ZXIgLWVxICIyMDEzIikKICAgIHsKICAgICAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5JbnN0YWxsLlNQVmVyc2lvbiA9ICIyMDEzIgogICAgfQogICAgZWxzZWlmICgkdmVyIC1lcSAiMjAxNiIpCiAgICB7CiAgICAgICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uSW5zdGFsbC5TUFZlcnNpb24gPSAiMjAxNiIKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICB0aHJvdyAiRVJST1I6IEludmFsaWQgcHJvZHVjdCBWZXJzaW9uLiBTaG91bGUgYmUgMjAxMyBvciAyMDE2IgogICAgfQoKICAgICRkb21haW4gPSBnZXQtZG9tYWluc2hvcnRuYW1lCgogICAgIyBhbGwgdXJscyBleGNlcHQgc2VydmVycyBmcWRuIHNob3VsZCB1c2UgZm9yd2FyZCBsb29rdXAgem9uZQogICAgJEZPUldBUkRfTE9PS1VQX1pPTkUgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJEZPUldBUkRfTE9PS1VQX1pPTkUgIm13c2F1c3QubmV0IiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCgogICAgI3JlZ2lvbiBGQVJNCiAgICBsb2cgIklORk86IFNldHRpbmcgRmFybSBhY2NvdW50IGFuZCBwYXNzcGhyYXNlIgogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5QYXNzcGhyYXNlID0gKEdldC1WYXJpYWJsZVZhbHVlICRQQVNTUEhSQVNFICJwQHNzdzByZCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKSAKCiAgICAjIEZBUk0uQUNDT1VOVAogICAgJGZhcm1BY2NvdW50ID0gKEdldC1WYXJpYWJsZVZhbHVlICRGQVJNX0FDQ09VTlQgInN2Y19zcF9mYXJtIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkFjY291bnQuUGFzc3dvcmQgPSAoZ2V0LXNlcnZpY2VBY2NvdW50UGFzc3dvcmQgLXVzZXJuYW1lICRmYXJtQWNjb3VudCkgICAgICAKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uQWNjb3VudC5Vc2VybmFtZSA9ICIkZG9tYWluXCRmYXJtQWNjb3VudCIKCiAgICAjIEZBUk0uREFUQUJBU0UKICAgICMgQ29tcG9uZW50SUQtSW5zdGFuY2VJRAogICAgJGNvbmZpZ0RCID0gKEdldC1WYXJpYWJsZVZhbHVlICRDT05GSUdfREJfU0VSVkVSICRzcF9kYl9zZXJ2ZXIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJGNvbmZpZ0RCX3NlcnZlciA9IChbc3RyaW5nXShHZXQtU2VydmVyTmFtZSAkY29uZmlnREIpKS5Ub1VwcGVyKCkKCiAgICBsb2cgIklORk86IFNldHRpbmcgRmFybSBEYXRhYmFzZSB2YXJpYWJsZXMiCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkRhdGFiYXNlLkRCUHJlZml4ID0gKEdldC1WYXJpYWJsZVZhbHVlICREQl9QUkVGSVggIk1XUzIiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICREQl9QUkVGSVggPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkRhdGFiYXNlLkRCUHJlZml4CgogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5EYXRhYmFzZS5EQlNlcnZlciA9ICRDT05GSUdEQl9BTElBUwogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5EYXRhYmFzZS5EQkFsaWFzLkNyZWF0ZSA9ICRDT05GSUdEQl9BTElBU19DUkVBVEUKCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkRhdGFiYXNlLkRCQWxpYXMuREJJbnN0YW5jZSA9ICRjb25maWdEQl9zZXJ2ZXIgKyAiXCIgKyAoR2V0LVZhcmlhYmxlVmFsdWUgJENPTkZJR19EQl9JTlNUQU5DRV9OQU1FICJzcF9jb25maWciICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uRGF0YWJhc2UuREJBbGlhcy5EQlBvcnQgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJENPTkZJR19EQl9JTlNUQU5DRV9QT1JUICI0OTAwOCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgI2VuZHJlZ2lvbgoKICAgICNyZWdpb24gQ0VOVFJBTCBBRE1JTiAtIGluc3RhbGwgb24gYSBXRkUgKHJlY29tbWVuZGVkIGJ5IE1TRlQpIG9yIEJhY2tFbmQKICAgICMgQ0FfUFJPVklTSU9OIHN1cHBvcnRlZCB2YWx1ZXM6IHRydWUsIGZhbHNlLCBsb2NhbGhvc3QKICAgIGxvZyAiSU5GTzogU2V0dGluZyBDRU5UUkFMX0FETUlOIHZhcmlhYmxlcyIKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uQ2VudHJhbEFkbWluLlByb3Zpc2lvbiA9IChHZXQtVmFyaWFibGVWYWx1ZSAkQ0FfUFJPVklTSU9OICJsb2NhbGhvc3QiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uQ2VudHJhbEFkbWluLlBvcnQgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJENBX1BPUlQgIjIwMTMiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICNlbmRyZWdpb24KCiAgICAjcmVnaW9uIFNFUlZJQ0VTCiAgICAjIHN1cHBvcnRlZCB2YWx1ZXM6IHRydWUsIGZhbHNlLCBsb2NhbGhvc3QKICAgIGxvZyAiSU5GTzogU2V0dGluZyBGYXJtIFNlcnZpY2VzIHZhcmlhYmxlcyIKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuU2FuZGJveGVkQ29kZVNlcnZpY2UuU3RhcnQgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFNBTkRCT1hFRENPREVTRVJWSUNFICJsb2NhbGhvc3QiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuQ2xhaW1zVG9XaW5kb3dzVG9rZW5TZXJ2aWNlLlN0YXJ0ID0gKEdldC1WYXJpYWJsZVZhbHVlICRDTEFJTVNfVE9fV0lORE9XU19UT0tFTlNFUlZJQ0UgImxvY2FsaG9zdCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2aWNlcy5EaXN0cmlidXRlZENhY2hlLlN0YXJ0ID0gKEdldC1WYXJpYWJsZVZhbHVlICRESVNUUklCVVRFRF9DQUNIRSAibG9jYWxob3N0IiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZpY2VzLldvcmtmbG93VGltZXIuU3RhcnQgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFdPUktGTE9XX1RJTUVSICJsb2NhbGhvc3QiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuRm91bmRhdGlvbldlYkFwcGxpY2F0aW9uLlN0YXJ0ID0gKEdldC1WYXJpYWJsZVZhbHVlICRGT1VOREFUSU9OX1dFQl9BUFAgImxvY2FsaG9zdCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgICAgIAogICAgbG9nICJJTkZPOiBTZXR0aW5nIE91dGdvaW5nL0luY29taW5nIEVtYWlsIHZhcmlhYmxlcyIKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuU01UUC5JbnN0YWxsID0gKEdldC1WYXJpYWJsZVZhbHVlICRTTVRQX1NFUlZJQ0UgImxvY2FsaG9zdCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2aWNlcy5PdXRnb2luZ0VtYWlsLkNvbmZpZ3VyZSA9IChHZXQtVmFyaWFibGVWYWx1ZSAkT1VUR09JTkdfRU1BSUwgInRydWUiICR1c2VIYXJkY29kZWREZWZhdWx0cykKCiAgICBbc3RyaW5nXSRzbXRwQml0ID0gKEdldC1WYXJpYWJsZVZhbHVlICRTTVRQX1NFUlZFUiAic210cCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgaWYgKCRzbXRwQml0LlRvVXBwZXIoKSAtbmUgImZhbHNlIikKICAgIHsKICAgICAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZpY2VzLk91dGdvaW5nRW1haWwuU01UUFNlcnZlciA9IChHZXQtVmFyaWFibGVWYWx1ZSAkU01UUF9TRVJWRVIgIm1haWwubXdzYXVzdC5uZXQiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgIH0KCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZpY2VzLk91dGdvaW5nRW1haWwuRW1haWxBZGRyZXNzID0gKEdldC1WYXJpYWJsZVZhbHVlICRFTUFJTF9BRERSRVNTICJhZG1pbkBtd3NhdXN0Lm5ldCIpCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZpY2VzLk91dGdvaW5nRW1haWwuUmVwbHlUb0VtYWlsID0gKEdldC1WYXJpYWJsZVZhbHVlICRSRVBMWV9UT19FTUFJTCAiSGVscERlc2tAbXdzYXVzdC5uZXQiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmljZXMuSW5jb21pbmdFbWFpbC5TdGFydCA9IChHZXQtVmFyaWFibGVWYWx1ZSAkSU5DT01JTkdfRU1BSUwgImxvY2FsaG9zdCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgI2VuZHJlZ2lvbgoKICAgICNyZWdpb24gU0VSVkVSIFJPTEVTIC0gMjAxNgogICAgaWYgKCR2ZXIgLWVxICIyMDE2IikKICAgIHsKICAgICAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZlclJvbGVzLldlYkZyb250RW5kLlByb3Zpc2lvbiA9IChHZXQtU2VydmVyc0xpc3QgJFdFQkZST05URU5EKQogICAgICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmVyUm9sZXMuQXBwbGljYXRpb24uUHJvdmlzaW9uID0gKEdldC1TZXJ2ZXJzTGlzdCAkQVBQTElDQVRJT04pCiAgICAgICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2ZXJSb2xlcy5EaXN0cmlidXRlZENhY2hlLlByb3Zpc2lvbiA9IChHZXQtU2VydmVyc0xpc3QgJERJU1RSSUJVVEVEQ0FDSEUpCiAgICAgICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5TZXJ2ZXJSb2xlcy5TZWFyY2guUHJvdmlzaW9uID0gKEdldC1TZXJ2ZXJzTGlzdCAkU0VBUkNIKQogICAgICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uU2VydmVyUm9sZXMuQ3VzdG9tLlByb3Zpc2lvbiA9IChHZXQtU2VydmVyc0xpc3QgJENVU1RPTSkKICAgICAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLlNlcnZlclJvbGVzLlNpbmdsZVNlcnZlckZhcm0uUHJvdmlzaW9uID0gKEdldC1WYXJpYWJsZVZhbHVlICRTSU5HTEVTRVJWRVJGQVJNICJmYWxzZSIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgfQogICAgI2VuZHJlZ2lvbgoKICAgICNyZWdpb24gTUFOQUdFRCBBQ0NPVU5UUwogICAgICAgICMgQ29tbW9uTmFtZXMgbXVzdCBtYXRjaCB0aG9zZSBpbiB0aGUgY29uZmlndXJhdGlvbiBmaWxlLiBUaGV5IGFyZSB1c2VkIGluIHRoZSBzY3JpcHQgYXMgd2VsbC4KICAgIGxvZyAiSU5GTzogU2V0dGluZyBNYW5hZ2VkIEFjY291bnRzIHZhcmlhYmxlcyIKICAgIGxvZyAiSU5GTzogc3BzZXJ2aWNlIgogICAgJG1hbmFnZWRBY2NvdW50WE1MID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5NYW5hZ2VkQWNjb3VudHMuTWFuYWdlZEFjY291bnQgfCBXaGVyZS1PYmplY3QgeyAkXy5Db21tb25OYW1lIC1lcSAic3BzZXJ2aWNlIiB9CiAgICAkdXNlcm5hbWUgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFNQU0VSVklDRV9BQ0NPVU5UICJzdmNfc3BfU2VydmljZXMiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICRtYW5hZ2VkQWNjb3VudFhNTC5Vc2VybmFtZSA9ICIkZG9tYWluXCR1c2VybmFtZSIKICAgICRtYW5hZ2VkQWNjb3VudFhNTC5QYXNzd29yZCA9IGdldC1zZXJ2aWNlQWNjb3VudFBhc3N3b3JkIC11c2VybmFtZSAkdXNlcm5hbWUKCiAgICBsb2cgIklORk86IHBvcnRhbGFwcHBvb2wiCiAgICAkbWFuYWdlZEFjY291bnRYTUwgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLk1hbmFnZWRBY2NvdW50cy5NYW5hZ2VkQWNjb3VudCB8IFdoZXJlLU9iamVjdCB7ICRfLkNvbW1vbk5hbWUgLWVxICJwb3J0YWxhcHBwb29sIiB9CiAgICAkdXNlcm5hbWUgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFBPUlRBTF9BUFBQT09MX0FDQ09VTlQgInN2Y19zcF9XZWJBcHBQb29sIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkbWFuYWdlZEFjY291bnRYTUwuVXNlcm5hbWUgPSAiJGRvbWFpblwkdXNlcm5hbWUiCiAgICAkbWFuYWdlZEFjY291bnRYTUwuUGFzc3dvcmQgPSBnZXQtc2VydmljZUFjY291bnRQYXNzd29yZCAtdXNlcm5hbWUgJHVzZXJuYW1lCgogICAgbG9nICJJTkZPOiBteXNpdGVhcHBwb29sIgogICAgJG1hbmFnZWRBY2NvdW50WE1MID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5NYW5hZ2VkQWNjb3VudHMuTWFuYWdlZEFjY291bnQgfCBXaGVyZS1PYmplY3QgeyAkXy5Db21tb25OYW1lIC1lcSAibXlzaXRlYXBwcG9vbCIgfQogICAgJHVzZXJuYW1lID0gKEdldC1WYXJpYWJsZVZhbHVlICRNWVNJVEVTX0FQUFBPT0xfQUNDT1VOVCAic3ZjX215c2l0ZXNhcHBwb29sIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkbWFuYWdlZEFjY291bnRYTUwuVXNlcm5hbWUgPSAiJGRvbWFpblwkdXNlcm5hbWUiCiAgICAkbWFuYWdlZEFjY291bnRYTUwuUGFzc3dvcmQgPSBnZXQtc2VydmljZUFjY291bnRQYXNzd29yZCAtdXNlcm5hbWUgJHVzZXJuYW1lCgogICAgbG9nICJJTkZPOiBzZWFyY2hzZXJ2aWNlIgogICAgJG1hbmFnZWRBY2NvdW50WE1MID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5NYW5hZ2VkQWNjb3VudHMuTWFuYWdlZEFjY291bnQgfCBXaGVyZS1PYmplY3QgeyAkXy5Db21tb25OYW1lIC1lcSAic2VhcmNoc2VydmljZSIgfQogICAgJHVzZXJuYW1lID0gKEdldC1WYXJpYWJsZVZhbHVlICRTRUFSQ0hfU0VSVklDRV9BQ0NPVU5UICJzdmNfc3Bfc2VhcmNoIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkbWFuYWdlZEFjY291bnRYTUwuVXNlcm5hbWUgPSAiJGRvbWFpblwkdXNlcm5hbWUiCiAgICAkbWFuYWdlZEFjY291bnRYTUwuUGFzc3dvcmQgPSBnZXQtc2VydmljZUFjY291bnRQYXNzd29yZCAtdXNlcm5hbWUgJHVzZXJuYW1lCgogICAgbG9nICJJTkZPOiBQb3J0YWwiCiAgICAkbWFuYWdlZEFjY291bnRYTUwgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLk1hbmFnZWRBY2NvdW50cy5NYW5hZ2VkQWNjb3VudCB8IFdoZXJlLU9iamVjdCB7ICRfLkNvbW1vbk5hbWUgLWVxICJQb3J0YWwiIH0KICAgICR1c2VybmFtZSA9IChHZXQtVmFyaWFibGVWYWx1ZSAkUE9SVEFMX0FDQ09VTlQgInN2Y19zcF9mYXJtIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkbWFuYWdlZEFjY291bnRYTUwuVXNlcm5hbWUgPSAiJGRvbWFpblwkdXNlcm5hbWUiCiAgICAkbWFuYWdlZEFjY291bnRYTUwuUGFzc3dvcmQgPSBnZXQtc2VydmljZUFjY291bnRQYXNzd29yZCAtdXNlcm5hbWUgJHVzZXJuYW1lCgogICAgbG9nICJJTkZPOiBNeVNpdGVIb3N0IgogICAgJG1hbmFnZWRBY2NvdW50WE1MID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5NYW5hZ2VkQWNjb3VudHMuTWFuYWdlZEFjY291bnQgfCBXaGVyZS1PYmplY3QgeyAkXy5Db21tb25OYW1lIC1lcSAiTXlTaXRlSG9zdCIgfQogICAgJHVzZXJuYW1lID0gKEdldC1WYXJpYWJsZVZhbHVlICRNWVNJVEVTX0FDQ09VTlQgInN2Y19zcF9mYXJtIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkbWFuYWdlZEFjY291bnRYTUwuVXNlcm5hbWUgPSAiJGRvbWFpblwkdXNlcm5hbWUiCiAgICAkbWFuYWdlZEFjY291bnRYTUwuUGFzc3dvcmQgPSBnZXQtc2VydmljZUFjY291bnRQYXNzd29yZCAtdXNlcm5hbWUgJHVzZXJuYW1lCgogICAgIyBPQkpFQ1QgQ0FDSEUgQUNPVU5UUwogICAgbG9nICJJTkZPOiBTZXR0aW5nIE9iamVjdCBDYWNoZSBBY2NvdW50cyB2YXJpYWJsZXMiCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLk9iamVjdENhY2hlQWNjb3VudHMuU3VwZXJVc2VyID0gJGRvbWFpbiArICJcIiArIChHZXQtVmFyaWFibGVWYWx1ZSAkU1VQRVJfVVNFUiAic3ZjX3NwX1N1cGVyVXNlciIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5PYmplY3RDYWNoZUFjY291bnRzLlN1cGVyUmVhZGVyID0gJGRvbWFpbiArICJcIiArIChHZXQtVmFyaWFibGVWYWx1ZSAkU1VQRVJfUkVBREVSICJzdmNfc3BfU3VwZXJSZWFkZXIiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICNlbmRyZWdpb24KCiAgICAjcmVnaW9uIExPR0dJTkcKICAgIGxvZyAiSU5GTzogU2V0dGluZyBMb2dnaW5nIHZhcmlhYmxlcyIKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uTG9nZ2luZy5JSVNMb2dzLlBhdGggPSAoR2V0LVZhcmlhYmxlVmFsdWUgJElJU0xPR1NfTE9DQVRJT04gImw6XGxvZ2ZpbGVzXGlpcyIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5Mb2dnaW5nLlVMU0xvZ3MuTG9nTG9jYXRpb24gPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFVMU0xPR1NfTE9DQVRJT04gImw6XGxvZ2ZpbGVzXHVscyIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5Mb2dnaW5nLlVzYWdlTG9ncy5Vc2FnZUxvZ0RpciA9IChHZXQtVmFyaWFibGVWYWx1ZSAkVVNBR0VMT0dTX0xPQ0FUSU9OICJsOlxsb2dmaWxlc1x1c2FnZSIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgI2VuZHJlZ2lvbgoKICAgICNyZWdpb24gU0VBUkNIIC0gRW50ZXJwcmlzZSBTZWFyY2ggSW5zdGFuY2UKICAgICMgc3VwcG9ydGVkIHZhbHVlczogZmFsc2UsIGxvY2FsaG9zdAogICAgbG9nICJJTkZPOiBTZXR0aW5nIEVudGVycHJpc2VTZWFyY2hTZXJ2aWNlIEluc3RhbmNlIHZhcmlhYmxlcyIKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLkVudGVycHJpc2VTZWFyY2hTZXJ2aWNlLlByb3Zpc2lvbiA9IChHZXQtVmFyaWFibGVWYWx1ZSAkRU5UU0VBUkNIX1BST1ZJU0lPTiAibG9jYWxob3N0IiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5FbnRlcnByaXNlU2VhcmNoU2VydmljZS5Db250YWN0RW1haWwgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJEVOVFNFQVJDSF9DT05UQUNURU1BSUwgImFkbWluQG13c2F1c3QubmV0IiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5FbnRlcnByaXNlU2VhcmNoU2VydmljZS5DdXN0b21JbmRleExvY2F0aW9uID0gKEdldC1WYXJpYWJsZVZhbHVlICRFTlRTRUFSQ0hfQ1VTVE9NSU5ERVhMT0NBVElPTiAiRzpcU1BfSW5kZXgiICR1c2VIYXJkY29kZWREZWZhdWx0cykKCiAgICAjIFNFQVJDSCAtIEVudGVycHJpc2UgU2VhcmNoIFNlcnZpY2UgQXBwbGljYXRpb24KICAgICMgSU1QT1JUQU5UOiB4bWwgaXMgY2F0ZXJpbmcgZm9yIG11bHRpcGxlIHNlYXJjaCBzZXJ2aWNlIGFwcGxpY2F0aW9ucy4gVGhpcyBjYW5ub3QgYmUgYWNoaXZlZCBieSB1c2luZyBBZ2lsaXR5IHZhcmlhYmxlcy4KICAgICMgc3VwcG9ydGVkIHZhbHVlczogc2VydmVyIG5hbWUgb3IgYmxhbmsKICAgICMgY29uZmlndXJhdGlvbiBmaWxlIGNhdGVycyBmb3IgbXVsdGlwbCBzZWFyY2ggc2VydmljZSBhcHBsaWNhdGlvbi4gSG93ZXZlciwgaXQgaGFzbid0IGJlZW4gdGVzdGVkIGFuZCBBZ2lsaXR5IGRvZXNuJ3Qgc3VwcG9ydCBpdC4KICAgIGxvZyAiSU5GTzogU2V0dGluZyBFbnRlcnByaXNlU2VhcmNoIFNlcnZpY2UgQXBwbGljYXRpb24gdmFyaWFibGVzIgogICAgJHNlYXJjaFNlcnZpY2VBcHAgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5FbnRlcnByaXNlU2VhcmNoU2VydmljZS5FbnRlcnByaXNlU2VhcmNoU2VydmljZUFwcGxpY2F0aW9ucy5FbnRlcnByaXNlU2VhcmNoU2VydmljZUFwcGxpY2F0aW9uIHwgU2VsZWN0LU9iamVjdCAtZmlyc3QgMQogICAgJHNlYXJjaFNlcnZpY2VBcHAuRmFpbG92ZXJEYXRhYmFzZVNlcnZlciA9IChHZXQtVmFyaWFibGVWYWx1ZSAkRU5UU0VBUkNIX1NWQ0FQUF9GQUlMT1ZFUl9EQk5BTUUgIiIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQoKICAgICMgU0VBUkNIIC0gRW50ZXJwcmlzZSBTZWFyY2ggU2VydmljZSBBcHBsaWNhdGlvbiAtIENvbnRlbnQgYWNjZXNzIGFjY291bnQKICAgICR1c2VybmFtZSA9IChHZXQtVmFyaWFibGVWYWx1ZSAkRU5UU0VBUkNIX1NWQ0FQUF9DT05URU5UX0FDQ0VTU19BQ0NPVU5UICJzdmNfc3BfQ29udGVudCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJHNlYXJjaFNlcnZpY2VBcHAuQ29udGVudEFjY2Vzc0FjY291bnQgPSAiJGRvbWFpblwkdXNlcm5hbWUiCiAgICAkc2VhcmNoU2VydmljZUFwcC5Db250ZW50QWNjZXNzQWNjb3VudFBhc3N3b3JkID0gZ2V0LXNlcnZpY2VBY2NvdW50UGFzc3dvcmQgLXVzZXJuYW1lICR1c2VybmFtZQoKICAgICMgU0VBUkNIIC0gRW50ZXJwcmlzZSBTZWFyY2ggU2VydmljZSBBcHBsaWNhdGlvbiAtIFNlYXJjaCBDZW50ZXIKICAgICMgVE9ETyBDb25zdHJ1Y3RVcmwgc2hvdWxkIGJlIGNoYW5nZWQgdG8gY2F0ZXIgZm9yIHBhdGgtYmFzZWQgVVJMcyBhcyB3ZWxsCiAgICAkc2VhcmNoU2VydmljZUFwcC5TZWFyY2hDZW50ZXJVcmwgPSAoQ29uc3RydWN0VVJMICRzZWFyY2hTZXJ2aWNlQXBwLlNlYXJjaENlbnRlclVybCAiJEZPUldBUkRfTE9PS1VQX1pPTkUvcGFnZXMiICR1c2VTU0wpCgogICAgIyBTRUFSQ0ggLSBFbnRlcnByaXNlIFNlYXJjaCBTZXJ2aWNlIEFwcGxpY2F0aW9uIC0gZGF0YWJhc2UKICAgICRzZWFyY2hEQiA9IChHZXQtVmFyaWFibGVWYWx1ZSAkRU5UU0VBUkNIX0RCX1NFUlZFUiAkc3BfZGJfc2VydmVyICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICRzZWFyY2hEQl9zZXJ2ZXIgPSAoW3N0cmluZ10oR2V0LVNlcnZlck5hbWUgJHNlYXJjaERCKSkuVG9VcHBlcigpCiAgICAkc2VhcmNoU2VydmljZUFwcC5EYXRhYmFzZS5EQkFsaWFzLkRCSW5zdGFuY2UgPSAkc2VhcmNoREJfc2VydmVyICsgIlwiICsgKEdldC1WYXJpYWJsZVZhbHVlICRFTlRTRUFSQ0hfREJfSU5TVEFOQ0VfTkFNRSAgInNwX3NlYXJjaCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJHNlYXJjaFNlcnZpY2VBcHAuRGF0YWJhc2UuREJBbGlhcy5EQlBvcnQgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJEVOVFNFQVJDSF9EQl9JTlNUQU5DRV9QT1JUICI0OTAxMiIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQoKICAgICRzZWFyY2hTZXJ2aWNlQXBwLk5hbWUgPSAkRU5UU0VBUkNIX1NWQ0FQUF9OQU1FCiAgICAkc2VhcmNoU2VydmljZUFwcC5Qcm94eS5OYW1lID0gJEVOVFNFQVJDSF9TVkNBUFBfUFJPWFkKICAgICRzZWFyY2hTZXJ2aWNlQXBwLkRhdGFiYXNlLk5hbWUgPSAkRU5UU0VBUkNIX0RCX05BTUUKICAgICRzZWFyY2hTZXJ2aWNlQXBwLkRhdGFiYXNlLkRCU2VydmVyID0gJENPTkZJR0RCX0FMSUFTCiAgICAkc2VhcmNoU2VydmljZUFwcC5EYXRhYmFzZS5EQkFsaWFzLkNyZWF0ZSA9ICRDT05GSUdEQl9BTElBU19DUkVBVEUKICAgIAogICAgIyBTRUFSQ0ggLSBUb3BvbG9neQogICAgIyBzdXBwb3J0ZWQgdmFsdWVzOiBmYWxzZSwgbG9jYWxob3N0CiAgICAkc2VhcmNoU2VydmljZUFwcC5DcmF3bENvbXBvbmVudC5Qcm92aXNpb24gPSAoR2V0LVZhcmlhYmxlVmFsdWUgJEVOVFNFQVJDSF9TVkNBUFBfQ1JBV0xTRVJWRVIgImxvY2FsaG9zdCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJHNlYXJjaFNlcnZpY2VBcHAuUXVlcnlDb21wb25lbnQuUHJvdmlzaW9uID0gKEdldC1WYXJpYWJsZVZhbHVlICRFTlRTRUFSQ0hfU1ZDQVBQX1FVRVJZU0VSVkVSICJsb2NhbGhvc3QiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICRzZWFyY2hTZXJ2aWNlQXBwLlNlYXJjaFF1ZXJ5QW5kU2l0ZVNldHRpbmdzQ29tcG9uZW50LlByb3Zpc2lvbiA9IChHZXQtVmFyaWFibGVWYWx1ZSAkRU5UU0VBUkNIX1NWQ0FQUF9TRUFSQ0hRVUVSWVNFVFRJTkdTU0VSVkVSICJsb2NhbGhvc3QiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICRzZWFyY2hTZXJ2aWNlQXBwLkFkbWluQ29tcG9uZW50LlByb3Zpc2lvbiA9IChHZXQtVmFyaWFibGVWYWx1ZSAkRU5UU0VBUkNIX1NWQ0FQUF9BRE1JTlNFUlZFUiAibG9jYWxob3N0IiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkc2VhcmNoU2VydmljZUFwcC5JbmRleENvbXBvbmVudC5Qcm92aXNpb24gPSAoR2V0LVZhcmlhYmxlVmFsdWUgJEVOVFNFQVJDSF9TVkNBUFBfSU5ERVhTRVJWRVIgImxvY2FsaG9zdCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJHNlYXJjaFNlcnZpY2VBcHAuQ29udGVudFByb2Nlc3NpbmdDb21wb25lbnQuUHJvdmlzaW9uID0gKEdldC1WYXJpYWJsZVZhbHVlICRFTlRTRUFSQ0hfU1ZDQVBQX0NPTlRFTlRTRVJWRVIgImxvY2FsaG9zdCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJHNlYXJjaFNlcnZpY2VBcHAuQW5hbHl0aWNzUHJvY2Vzc2luZ0NvbXBvbmVudC5Qcm92aXNpb24gPSAoR2V0LVZhcmlhYmxlVmFsdWUgJEVOVFNFQVJDSF9TVkNBUFBfQU5BTFlUSUNTU0VSVkVSICJsb2NhbGhvc3QiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICNlbmRyZWdpb24KCiAgICAjcmVnaW9uIE1BTkFHRUQgTUVUQURBVEEgU0VSVklDRSBBUFAgLSBpbnN0YWxsIG9uIGEgV0ZFIChyZWNvbW1lbmRlZCBieSBNU0ZUKQogICAgIyBzdXBwb3J0ZWQgdmFsdWVzOiBmYWxzZSwgbG9jYWxob3N0CiAgICBsb2cgIklORk86IFNldHRpbmcgTWFuYWdlZCBNZXRhZGF0YSB2YXJpYWJsZXMiCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5NYW5hZ2VkTWV0YWRhdGFTZXJ2aWNlQXBwLlByb3Zpc2lvbiAgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJE1NX1BST1ZJU0lPTiAibG9jYWxob3N0IiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkbW1EQiA9IChHZXQtVmFyaWFibGVWYWx1ZSAkTU1fREJfU0VSVkVSICRzcF9kYl9zZXJ2ZXIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJG1tREJfc2VydmVyID0gKFtzdHJpbmddKEdldC1TZXJ2ZXJOYW1lICRtbURCKSkuVG9VcHBlcigpCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5NYW5hZ2VkTWV0YWRhdGFTZXJ2aWNlQXBwLkRhdGFiYXNlLkRCQWxpYXMuREJJbnN0YW5jZSA9ICRtbURCX3NlcnZlciArICJcIiArIChHZXQtVmFyaWFibGVWYWx1ZSAkTU1fREJfSU5TVEFOQ0VfTkFNRSAgInNwX3N2Y2FwcHMiICR1c2VIYXJkY29kZWREZWZhdWx0cykgIyBUT0RPOiBzLmIuIHNwX3N2Y2FwcF9zZXJ2ZXIKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLk1hbmFnZWRNZXRhZGF0YVNlcnZpY2VBcHAuRGF0YWJhc2UuREJBbGlhcy5EQlBvcnQgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJE1NX0RCX0lOU1RBTkNFX1BPUlQgIjQ5MDEzIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCgogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuTWFuYWdlZE1ldGFkYXRhU2VydmljZUFwcC5OYW1lID0gJE1NX1NWQ0FQUF9OQU1FCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5NYW5hZ2VkTWV0YWRhdGFTZXJ2aWNlQXBwLlByb3h5TmFtZSA9ICRNTV9TVkNBUFBfUFJPWFkKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLk1hbmFnZWRNZXRhZGF0YVNlcnZpY2VBcHAuRGF0YWJhc2UuTmFtZSA9ICRNTV9EQl9OQU1FCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5NYW5hZ2VkTWV0YWRhdGFTZXJ2aWNlQXBwLkRhdGFiYXNlLkRCU2VydmVyID0gJENPTkZJR0RCX0FMSUFTCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5NYW5hZ2VkTWV0YWRhdGFTZXJ2aWNlQXBwLkRhdGFiYXNlLkRCQWxpYXMuQ3JlYXRlID0gJENPTkZJR0RCX0FMSUFTX0NSRUFURQoKICAgICNlbmRyZWdpb24KCiAKICAgICNyZWdpb24gVVNFUiBQUk9GSUxFIFNFUlZJQ0UgQVBQIGlzIGNvbmZpZ3VyZWQgdXNpbmcgZGVkaWNhdGVkIHNjcmlwdAogICAgIyBVU0VSIFBST0ZJTEUgU0VSVklDRSBBUFAKICAgIGxvZyAiSU5GTzogU2V0dGluZyBVc2VyIFByb2ZpbGUgU2VydmljZSBBcHBsaWNhdGlvbiB2YXJpYWJsZXMiCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5Vc2VyUHJvZmlsZVNlcnZpY2VBcHAuUHJvdmlzaW9uID0gKEdldC1WYXJpYWJsZVZhbHVlICRVUF9QUk9WSVNJT04gImxvY2FsaG9zdCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgCiAgICAjIFNlcnZpdmUgYXBwcyBOYW1lICsgUHJveHkgTmFtZQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuVXNlclByb2ZpbGVTZXJ2aWNlQXBwLk5hbWUgPSAkVVBfU1ZDQVBQX05BTUUKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlVzZXJQcm9maWxlU2VydmljZUFwcC5Qcm94eU5hbWUgPSAkVVBfU1ZDQVBQX1BST1hZCgogICAgIyBTeW5jaCBzZXJ2ZXIKICAgICRzeW5jaFNlcnZlciA9ICAoW3N0cmluZ10oR2V0LVNlcnZlck5hbWUgKEdldC1WYXJpYWJsZVZhbHVlICRVUF9TWU5DSF9TRVJWRVIgIkFQUC0wMDEiICR1c2VIYXJkY29kZWREZWZhdWx0cykpKQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuVXNlclByb2ZpbGVTZXJ2aWNlQXBwLlN5bmNoU2VydmVyID0gJHN5bmNoU2VydmVyCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5Vc2VyUHJvZmlsZVNlcnZpY2VBcHAuU3RhcnRQcm9maWxlU3luYyA9IChHZXQtVmFyaWFibGVWYWx1ZSAkVVBfU1RBUlRQUk9GSUxFU1lOQ0ggImZhbHNlIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpIAoKICAgICRzeW5jQ29ubkFjY3QgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFVQX1NZTkNDT05OQUNDT1VOVCAic3ZjX3NwX2Zhcm0iICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlVzZXJQcm9maWxlU2VydmljZUFwcC5TeW5jQ29ubmVjdGlvbkFjY291bnQgPSAkZG9tYWluICsgIlwiICsgJHN5bmNDb25uQWNjdAogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuVXNlclByb2ZpbGVTZXJ2aWNlQXBwLlN5bmNDb25uZWN0aW9uQWNjb3VudFBhc3N3b3JkID0gKGdldC1zZXJ2aWNlQWNjb3VudFBhc3N3b3JkIC11c2VybmFtZSAkc3luY0Nvbm5BY2N0KQoKICAgICMgRGF0YWJhc2UgaW5mbwogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuVXNlclByb2ZpbGVTZXJ2aWNlQXBwLkRhdGFiYXNlLlByb2ZpbGVEQiA9ICRVUF9QUk9GSUxFX0RCX05BTUUKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlVzZXJQcm9maWxlU2VydmljZUFwcC5EYXRhYmFzZS5TeW5jREIgPSAkVVBfU1lOQ0hfREJfTkFNRQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuVXNlclByb2ZpbGVTZXJ2aWNlQXBwLkRhdGFiYXNlLlNvY2lhbERCID0gJFVQX1NPQ0lBTF9EQl9OQU1FCgogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuVXNlclByb2ZpbGVTZXJ2aWNlQXBwLkRhdGFiYXNlLkRCU2VydmVyID0gJENPTkZJR0RCX0FMSUFTCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5Vc2VyUHJvZmlsZVNlcnZpY2VBcHAuRGF0YWJhc2UuREJBbGlhcy5DcmVhdGUgPSAkQ09ORklHREJfQUxJQVNfQ1JFQVRFCgogICAgJHVwREIgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFVQX0RCX1NFUlZFUiAkc3BfZGJfc2VydmVyICR1c2VIYXJkY29kZWREZWZhdWx0cykgICAgCiAgICAkdXBEQl9zZXJ2ZXIgPSAoW3N0cmluZ10oR2V0LVNlcnZlck5hbWUgJHVwREIpKS5Ub1VwcGVyKCkKCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5Vc2VyUHJvZmlsZVNlcnZpY2VBcHAuRGF0YWJhc2UuREJBbGlhcy5EQkluc3RhbmNlID0gJHVwREJfc2VydmVyICsgIlwiICsgKEdldC1WYXJpYWJsZVZhbHVlICRVUF9EQl9JTlNUQU5DRV9OQU1FICAic3ZjX3NwX3VzZXJwcm9maWxlcyIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuVXNlclByb2ZpbGVTZXJ2aWNlQXBwLkRhdGFiYXNlLkRCQWxpYXMuREJQb3J0ID0gKEdldC1WYXJpYWJsZVZhbHVlICRVUF9EQl9JTlNUQU5DRV9QT1JUICI0OTAxMyIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQoKCiAgICAkbXlTaXRlc0NvbCA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlVzZXJQcm9maWxlU2VydmljZUFwcC5NeVNpdGVIb3N0TG9jYXRpb24KICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlVzZXJQcm9maWxlU2VydmljZUFwcC5NeVNpdGVIb3N0TG9jYXRpb24gPSAoQ29uc3RydWN0VVJMICRteVNpdGVzQ29sICRGT1JXQVJEX0xPT0tVUF9aT05FICAkdXNlU1NMKQogICAgI2VuZHJlZ2lvbgogICAgICAgIAogICAgI3JlZ2lvbiBTVEFURSBTRVJWSUNFCiAgICBsb2cgIklORk86IFNldHRpbmcgU3RhdGUgU2VydmljZSBTZXJ2aWNlIEFwcGxpY2F0aW9uIHZhcmlhYmxlcyIKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlN0YXRlU2VydmljZS5Qcm92aXNpb24gPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFNUQVRFU1ZDX1BST1ZJU0lPTiAibG9jYWxob3N0IiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkZGIgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFNUQVRFU1ZDX0RCX1NFUlZFUiAkc3BfZGJfc2VydmVyICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICRkYl9zZXJ2ZXIgPSAoW3N0cmluZ10oR2V0LVNlcnZlck5hbWUgJGRiKSkuVG9VcHBlcigpCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TdGF0ZVNlcnZpY2UuRGF0YWJhc2UuREJBbGlhcy5EQkluc3RhbmNlID0gJGRiX3NlcnZlciArICJcIiArIChHZXQtVmFyaWFibGVWYWx1ZSAkU1RBVEVTVkNfREJfSU5TVEFOQ0VfTkFNRSAgInNwX3N2Y2FwcHMiICR1c2VIYXJkY29kZWREZWZhdWx0cykgIyBUT0RPOiBzLmIuIHNwX3N2Y2FwcF9zZXJ2ZXIKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlN0YXRlU2VydmljZS5EYXRhYmFzZS5EQkFsaWFzLkRCUG9ydCA9IChHZXQtVmFyaWFibGVWYWx1ZSAkU1RBVEVTVkNfREJfSU5TVEFOQ0VfUE9SVCAiNDkwMTMiICR1c2VIYXJkY29kZWREZWZhdWx0cykKCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TdGF0ZVNlcnZpY2UuTmFtZSA9ICRTVEFURVNFUlZJQ0VfU1ZDQVBQX05BTUUKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlN0YXRlU2VydmljZS5Qcm94eU5hbWUgPSAkU1RBVEVTRVJWSUNFX1NWQ0FQUF9QUk9YWQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuU3RhdGVTZXJ2aWNlLkRhdGFiYXNlLk5hbWUgPSAkU1RBVEVTRVJWSUNFRV9EQl9OQU1FCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TdGF0ZVNlcnZpY2UuRGF0YWJhc2UuREJTZXJ2ZXIgPSAkQ09ORklHREJfQUxJQVMKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlN0YXRlU2VydmljZS5EYXRhYmFzZS5EQkFsaWFzLkNyZWF0ZSA9ICRDT05GSUdEQl9BTElBU19DUkVBVEUKICAgICNlbmRyZWdpb24KCiAgICAjcmVnaW9uIFNQIFVTQUdFIFNFUlZJQ0UKICAgIGxvZyAiSU5GTzogU2V0dGluZyBTUFVzYWdlU2VydmljZSBTZXJ2aWNlIEFwcGxpY2F0aW9uIHZhcmlhYmxlcyIKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlNQVXNhZ2VTZXJ2aWNlLlByb3Zpc2lvbiA9IChHZXQtVmFyaWFibGVWYWx1ZSAkU1BVU0FHRV9QUk9WSVNJT04gImxvY2FsaG9zdCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJGRiID0gKEdldC1WYXJpYWJsZVZhbHVlICRTUFVTQUdFX0RCX1NFUlZFUiAkc3BfZGJfc2VydmVyICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICRkYl9zZXJ2ZXIgPSAoW3N0cmluZ10oR2V0LVNlcnZlck5hbWUgJGRiKSkuVG9VcHBlcigpCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TUFVzYWdlU2VydmljZS5EYXRhYmFzZS5EQkFsaWFzLkRCSW5zdGFuY2UgPSAkZGJfc2VydmVyICsgIlwiICsgKEdldC1WYXJpYWJsZVZhbHVlICRTUFVTQUdFX0RCX0lOU1RBTkNFX05BTUUgICJzcF9zdmNhcHBzIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpICMgVE9ETzogcy5iLiBzcF9zdmNhcHBfY29tbW9uCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TUFVzYWdlU2VydmljZS5EYXRhYmFzZS5EQkFsaWFzLkRCUG9ydCA9IChHZXQtVmFyaWFibGVWYWx1ZSAkU1BVU0FHRV9EQl9JTlNUQU5DRV9QT1JUICI0OTAxMyIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgI2VuZHJlZ2lvbgoKICAgICNyZWdpb24gU0VDVVJFIFNUT1JFIFNFUlZJQ0UKICAgIGxvZyAiSU5GTzogU2V0dGluZyBTZWN1cmVTdG9yZVNlcnZpY2UgU2VydmljZSBBcHBsaWNhdGlvbiB2YXJpYWJsZXMiCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TZWN1cmVTdG9yZVNlcnZpY2UuUHJvdmlzaW9uID0gKEdldC1WYXJpYWJsZVZhbHVlICRTRUNTVE9SRV9QUk9WSVNJT04gImxvY2FsaG9zdCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJGRiID0gKEdldC1WYXJpYWJsZVZhbHVlICRTRUNTVE9SRV9EQl9TRVJWRVIgJHNwX2RiX3NlcnZlciAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkZGJfc2VydmVyID0gKFtzdHJpbmddKEdldC1TZXJ2ZXJOYW1lICRkYikpLlRvVXBwZXIoKQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuU2VjdXJlU3RvcmVTZXJ2aWNlLkRhdGFiYXNlLkRCQWxpYXMuREJJbnN0YW5jZSA9ICRkYl9zZXJ2ZXIgKyAiXCIgKyAoR2V0LVZhcmlhYmxlVmFsdWUgJFNFQ1NUT1JFX0RCX0lOU1RBTkNFX05BTUUgICJzcF9zdmNhcHBzIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpICMgVE9ETzogcy5iLiBzcF9zZWN1cmVzdG9yZQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuU2VjdXJlU3RvcmVTZXJ2aWNlLkRhdGFiYXNlLkRCQWxpYXMuREJQb3J0ID0gKEdldC1WYXJpYWJsZVZhbHVlICRTRUNTVE9SRV9EQl9JTlNUQU5DRV9QT1JUICI0OTAxMyIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQoKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlNlY3VyZVN0b3JlU2VydmljZS5OYW1lID0gJFNFQ1NUT1JFX1NWQ0FQUF9OQU1FCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TZWN1cmVTdG9yZVNlcnZpY2UuUHJveHlOYW1lID0gJFNFQ1NUT1JFX1NWQ0FQUF9QUk9YWQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuU2VjdXJlU3RvcmVTZXJ2aWNlLkRhdGFiYXNlLk5hbWUgPSAkU0VDU1RPUkVfREJfTkFNRQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuU2VjdXJlU3RvcmVTZXJ2aWNlLkRhdGFiYXNlLkRCU2VydmVyID0gJENPTkZJR0RCX0FMSUFTCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TZWN1cmVTdG9yZVNlcnZpY2UuRGF0YWJhc2UuREJBbGlhcy5DcmVhdGUgPSAkQ09ORklHREJfQUxJQVNfQ1JFQVRFCiAgICAjZW5kcmVnaW9uCgogICAgI3JlZ2lvbiBCVVNJTkVTUyBEQVRBIENPTk5FQ1RJVklUWQogICAgbG9nICJJTkZPOiBTZXR0aW5nIEJ1c2luZXNzRGF0YUNvbm5lY3Rpdml0eSBTZXJ2aWNlIEFwcGxpY2F0aW9uIHZhcmlhYmxlcyIKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLkJ1c2luZXNzRGF0YUNvbm5lY3Rpdml0eS5Qcm92aXNpb24gPSAoR2V0LVZhcmlhYmxlVmFsdWUgJEJEQ19QUk9WSVNJT04gImxvY2FsaG9zdCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJGRiID0gKEdldC1WYXJpYWJsZVZhbHVlICRCRENfREJfU0VSVkVSICRzcF9kYl9zZXJ2ZXIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJGRiX3NlcnZlciA9IChbc3RyaW5nXShHZXQtU2VydmVyTmFtZSAkZGIpKS5Ub1VwcGVyKCkKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLkJ1c2luZXNzRGF0YUNvbm5lY3Rpdml0eS5EYXRhYmFzZS5EQkFsaWFzLkRCSW5zdGFuY2UgPSAkZGJfc2VydmVyICsgIlwiICsgKEdldC1WYXJpYWJsZVZhbHVlICRCRENfREJfSU5TVEFOQ0VfTkFNRSAgInNwX3N2Y2FwcHMiICR1c2VIYXJkY29kZWREZWZhdWx0cykgIyBUT0RPOiBzLmIuIHNwX3N2Y2FwcF9jb21tb24KICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLkJ1c2luZXNzRGF0YUNvbm5lY3Rpdml0eS5EYXRhYmFzZS5EQkFsaWFzLkRCUG9ydCA9IChHZXQtVmFyaWFibGVWYWx1ZSAkQkRDX0RCX0lOU1RBTkNFX1BPUlQgIjQ5MDEzIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCgogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuQnVzaW5lc3NEYXRhQ29ubmVjdGl2aXR5Lk5hbWUgPSAkQkRDX1NWQ0FQUF9OQU1FCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5CdXNpbmVzc0RhdGFDb25uZWN0aXZpdHkuUHJveHlOYW1lID0gJEJEQ19TVkNBUFBfUFJPWFkKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLkJ1c2luZXNzRGF0YUNvbm5lY3Rpdml0eS5EYXRhYmFzZS5OYW1lID0gJEJEQ19EQl9OQU1FCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5CdXNpbmVzc0RhdGFDb25uZWN0aXZpdHkuRGF0YWJhc2UuREJTZXJ2ZXIgPSAkQ09ORklHREJfQUxJQVMKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLkJ1c2luZXNzRGF0YUNvbm5lY3Rpdml0eS5EYXRhYmFzZS5EQkFsaWFzLkNyZWF0ZSA9ICRDT05GSUdEQl9BTElBU19DUkVBVEUKICAgICNlbmRyZWdpb24KCiAgICAjcmVnaW9uIFdPUkQgQVVUT01BVElPTiBTRVJWSUNFCiAgICBsb2cgIklORk86IFNldHRpbmcgV29yZEF1dG9tYXRpb25TZXJ2aWNlIFNlcnZpY2UgQXBwbGljYXRpb24gdmFyaWFibGVzIgogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuV29yZEF1dG9tYXRpb25TZXJ2aWNlLlByb3Zpc2lvbiA9IChHZXQtVmFyaWFibGVWYWx1ZSAkV09SREFVVE9fUFJPVklTSU9OICJsb2NhbGhvc3QiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICRkYiA9IChHZXQtVmFyaWFibGVWYWx1ZSAkV09SREFVVE9fREJfU0VSVkVSICRzcF9kYl9zZXJ2ZXIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJGRiX3NlcnZlciA9IChbc3RyaW5nXShHZXQtU2VydmVyTmFtZSAkZGIpKS5Ub1VwcGVyKCkKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLldvcmRBdXRvbWF0aW9uU2VydmljZS5EYXRhYmFzZS5EQkFsaWFzLkRCSW5zdGFuY2UgPSAkZGJfc2VydmVyICsgIlwiICsgKEdldC1WYXJpYWJsZVZhbHVlICRXT1JEQVVUT19EQl9JTlNUQU5DRV9OQU1FICAic3Bfc3ZjYXBwcyIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKSAjIFRPRE86IHMuYi4gc3Bfc3ZjYXBwX3NlcnZlcgogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuV29yZEF1dG9tYXRpb25TZXJ2aWNlLkRhdGFiYXNlLkRCQWxpYXMuREJQb3J0ID0gKEdldC1WYXJpYWJsZVZhbHVlICRXT1JEQVVUT19EQl9JTlNUQU5DRV9QT1JUICI0OTAxMyIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQoKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLldvcmRBdXRvbWF0aW9uU2VydmljZS5OYW1lID0gJFdPUkRBVVRPTV9TVkNBUFBfTkFNRQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuV29yZEF1dG9tYXRpb25TZXJ2aWNlLlByb3h5TmFtZSA9ICRXT1JEQVVUT01fU1ZDQVBQX1BST1hZCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5Xb3JkQXV0b21hdGlvblNlcnZpY2UuRGF0YWJhc2UuTmFtZSA9ICRXT1JEQVVUT01fREJfTkFNRQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuV29yZEF1dG9tYXRpb25TZXJ2aWNlLkRhdGFiYXNlLkRCU2VydmVyID0gJENPTkZJR0RCX0FMSUFTCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5Xb3JkQXV0b21hdGlvblNlcnZpY2UuRGF0YWJhc2UuREJBbGlhcy5DcmVhdGUgPSAkQ09ORklHREJfQUxJQVNfQ1JFQVRFCiAgICAjZW5kcmVnaW9uCgogICAgI3JlZ2lvbiBBUFAgTUFOQUdFTUVOVCBTRVJWSUNFCiAgICBsb2cgIklORk86IFNldHRpbmcgQXBwTWFuYWdlbWVudFNlcnZpY2UgU2VydmljZSBBcHBsaWNhdGlvbiB2YXJpYWJsZXMiCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5BcHBNYW5hZ2VtZW50U2VydmljZS5Qcm92aXNpb24gPSAoR2V0LVZhcmlhYmxlVmFsdWUgJEFQUE1HTVRfUFJPVklTSU9OICJsb2NhbGhvc3QiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLkFwcE1hbmFnZW1lbnRTZXJ2aWNlLkFwcERvbWFpbiA9IChHZXQtVmFyaWFibGVWYWx1ZSAkQVBQTUdNVF9ET01BSU4gImFwcHMubXdzYXVzdC5uZXQiICR1c2VIYXJkY29kZWREZWZhdWx0cykKCiAgICAkZGIgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJEFQUE1HTVRfREJfU0VSVkVSICRzcF9kYl9zZXJ2ZXIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJGRiX3NlcnZlciA9IChbc3RyaW5nXShHZXQtU2VydmVyTmFtZSAkZGIpKS5Ub1VwcGVyKCkKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLkFwcE1hbmFnZW1lbnRTZXJ2aWNlLkRhdGFiYXNlLkRCQWxpYXMuREJJbnN0YW5jZSA9ICRkYl9zZXJ2ZXIgKyAiXCIgKyAoR2V0LVZhcmlhYmxlVmFsdWUgJEFQUE1HTVRfREJfSU5TVEFOQ0VfTkFNRSAgInNwX3N2Y2FwcHMiICR1c2VIYXJkY29kZWREZWZhdWx0cykgIyBUT0RPOiBzLmIuIHNwX3N2Y2FwcF9jb21tb24KICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLkFwcE1hbmFnZW1lbnRTZXJ2aWNlLkRhdGFiYXNlLkRCQWxpYXMuREJQb3J0ID0gKEdldC1WYXJpYWJsZVZhbHVlICRBUFBNR01UX0RCX0lOU1RBTkNFX1BPUlQgIjQ5MDEzIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCgogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuQXBwTWFuYWdlbWVudFNlcnZpY2UuTmFtZSA9ICRBUFBNR01UX1NWQ0FQUF9OQU1FCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5BcHBNYW5hZ2VtZW50U2VydmljZS5Qcm94eU5hbWUgPSAkQVBQTUdNVF9TVkNBUFBfUFJPWFkKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLkFwcE1hbmFnZW1lbnRTZXJ2aWNlLkRhdGFiYXNlLk5hbWUgPSAkQVBQTUdNVF9EQl9OQU1FCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5BcHBNYW5hZ2VtZW50U2VydmljZS5EYXRhYmFzZS5EQlNlcnZlciA9ICRDT05GSUdEQl9BTElBUwogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuQXBwTWFuYWdlbWVudFNlcnZpY2UuRGF0YWJhc2UuREJBbGlhcy5DcmVhdGUgPSAkQ09ORklHREJfQUxJQVNfQ1JFQVRFCiAgICAjZW5kcmVnaW9uCgogICAgI3JlZ2lvbiBTVUJTQ1JJUFRJT04gU0VUVElOR1MgU0VSVklDRQogICAgbG9nICJJTkZPOiBTZXR0aW5nIFN1YnNjcmlwdGlvblNldHRpbmdzU2VydmljZSBTZXJ2aWNlIEFwcGxpY2F0aW9uIHZhcmlhYmxlcyIKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlN1YnNjcmlwdGlvblNldHRpbmdzU2VydmljZS5Qcm92aXNpb24gPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFNVQlNDUl9QUk9WSVNJT04gImxvY2FsaG9zdCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuU3Vic2NyaXB0aW9uU2V0dGluZ3NTZXJ2aWNlLkFwcFNpdGVTdWJzY3JpcHRpb25OYW1lID0gKEdldC1WYXJpYWJsZVZhbHVlICRTVUJTQ1JfUFJPVklTSU9OICJhcHAiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICRkYiA9IChHZXQtVmFyaWFibGVWYWx1ZSAkU1VCU0NSX0RCX1NFUlZFUiAkc3BfZGJfc2VydmVyICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICRkYl9zZXJ2ZXIgPSAoW3N0cmluZ10oR2V0LVNlcnZlck5hbWUgJGRiKSkuVG9VcHBlcigpCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TdWJzY3JpcHRpb25TZXR0aW5nc1NlcnZpY2UuRGF0YWJhc2UuREJBbGlhcy5EQkluc3RhbmNlID0gJGRiX3NlcnZlciArICJcIiArIChHZXQtVmFyaWFibGVWYWx1ZSAkU1VCU0NSX0RCX0lOU1RBTkNFX05BTUUgICJzcF9zdmNhcHBzIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpICMgVE9ETzogcy5iLiBzcF9zdmNhcHBfY29tbW9uCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TdWJzY3JpcHRpb25TZXR0aW5nc1NlcnZpY2UuRGF0YWJhc2UuREJBbGlhcy5EQlBvcnQgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFNVQlNDUl9EQl9JTlNUQU5DRV9QT1JUICI0OTAxMyIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQoKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlN1YnNjcmlwdGlvblNldHRpbmdzU2VydmljZS5OYW1lID0gJFNVQlNDUlNFUlZJQ0VfU1ZDQVBQX05BTUUKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlN1YnNjcmlwdGlvblNldHRpbmdzU2VydmljZS5EYXRhYmFzZS5OYW1lID0gJFNVQlNDUlNFUlZJQ0VfREJfTkFNRQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuU3Vic2NyaXB0aW9uU2V0dGluZ3NTZXJ2aWNlLkRhdGFiYXNlLkRCU2VydmVyID0gJENPTkZJR0RCX0FMSUFTCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5TdWJzY3JpcHRpb25TZXR0aW5nc1NlcnZpY2UuRGF0YWJhc2UuREJBbGlhcy5DcmVhdGUgPSAkQ09ORklHREJfQUxJQVNfQ1JFQVRFCiAgICAjZW5kcmVnaW9uCgogICAgI3JlZ2lvbiBXT1JLIE1BTkFHRU1FTlQgU0VSVklDRQogICAgbG9nICJJTkZPOiBTZXR0aW5nIFdvcmtNYW5hZ2VtZW50U2VydmljZSBTZXJ2aWNlIEFwcGxpY2F0aW9uIHZhcmlhYmxlcyIKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLldvcmtNYW5hZ2VtZW50U2VydmljZS5Qcm92aXNpb24gPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFdPUktNR01UX1BST1ZJU0lPTiAibG9jYWxob3N0IiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5Xb3JrTWFuYWdlbWVudFNlcnZpY2UuTmFtZSA9ICRXT1JLTUdNVF9TVkNBUFBfTkFNRQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuV29ya01hbmFnZW1lbnRTZXJ2aWNlLlByb3h5TmFtZSA9ICRXT1JLTUdNVF9TVkNBUFBfUFJPWFkKCiAgICAjZW5kcmVnaW9uCgogICAgI3JlZ2lvbiBNQUNISU5FIFRSQU5TTEFUSU9OIFNFUlZJQ0UKICAgIGxvZyAiSU5GTzogU2V0dGluZyBNYWNoaW5lVHJhbnNsYXRpb25TZXJ2aWNlIFNlcnZpY2UgQXBwbGljYXRpb24gdmFyaWFibGVzIgogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuTWFjaGluZVRyYW5zbGF0aW9uU2VydmljZS5Qcm92aXNpb24gPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFRSQU5TTF9QUk9WSVNJT04gImxvY2FsaG9zdCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJGRiID0gKEdldC1WYXJpYWJsZVZhbHVlICRUUkFOU0xfREJfU0VSVkVSICRzcF9kYl9zZXJ2ZXIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJGRiX3NlcnZlciA9IChbc3RyaW5nXShHZXQtU2VydmVyTmFtZSAkZGIpKS5Ub1VwcGVyKCkKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLk1hY2hpbmVUcmFuc2xhdGlvblNlcnZpY2UuRGF0YWJhc2UuREJBbGlhcy5EQkluc3RhbmNlID0gJGRiX3NlcnZlciArICJcIiArIChHZXQtVmFyaWFibGVWYWx1ZSAkVFJBTlNMX0RCX0lOU1RBTkNFX05BTUUgICJzcF9zdmNhcHBzIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpICMgVE9ETzogcy5iLiBzcF9zdmNhcHBfc2VydmVyCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5NYWNoaW5lVHJhbnNsYXRpb25TZXJ2aWNlLkRhdGFiYXNlLkRCQWxpYXMuREJQb3J0ID0gKEdldC1WYXJpYWJsZVZhbHVlICRUUkFOU0xfREJfSU5TVEFOQ0VfUE9SVCAiNDkwMTMiICR1c2VIYXJkY29kZWREZWZhdWx0cykKCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5NYWNoaW5lVHJhbnNsYXRpb25TZXJ2aWNlLk5hbWUgPSAkTUFDSElORVRSQU5TTF9TVkNBUFBfTkFNRQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuTWFjaGluZVRyYW5zbGF0aW9uU2VydmljZS5Qcm94eU5hbWUgPSAkTUFDSElORVRSQU5TTF9TVkNBUFBfUFJPWFkKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLk1hY2hpbmVUcmFuc2xhdGlvblNlcnZpY2UuRGF0YWJhc2UuTmFtZSA9ICRNQUNISU5FVFJBTlNMX0RCX05BTUUKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLk1hY2hpbmVUcmFuc2xhdGlvblNlcnZpY2UuRGF0YWJhc2UuREJTZXJ2ZXIgPSAkQ09ORklHREJfQUxJQVMKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLk1hY2hpbmVUcmFuc2xhdGlvblNlcnZpY2UuRGF0YWJhc2UuREJBbGlhcy5DcmVhdGUgPSAkQ09ORklHREJfQUxJQVNfQ1JFQVRFCiAgICAjZW5kcmVnaW9uCgogICAgI3JlZ2lvbiBQT1dFUlBPSU5UIENPTlZFUlNJT04gU0VSVklDRQogICAgbG9nICJJTkZPOiBTZXR0aW5nIFBvd2VyUG9pbnRDb252ZXJzaW9uU2VydmljZSBTZXJ2aWNlIEFwcGxpY2F0aW9uIHZhcmlhYmxlcyIKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlBvd2VyUG9pbnRDb252ZXJzaW9uU2VydmljZS5Qcm92aXNpb24gPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFBQVENPTlZfUFJPVklTSU9OICJsb2NhbGhvc3QiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLlNlcnZpY2VBcHBzLlBvd2VyUG9pbnRDb252ZXJzaW9uU2VydmljZS5OYW1lID0gJFBQVF9TVkNBUFBfTkFNRQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuUG93ZXJQb2ludENvbnZlcnNpb25TZXJ2aWNlLlByb3h5TmFtZSA9ICRQUFRfU1ZDQVBQX1BST1hZCiAgICAjZW5kcmVnaW9uCgogICAgI3JlZ2lvbiBFWENFTCBTRVJWSUNFUwogICAgbG9nICJJTkZPOiBTZXR0aW5nIEV4Y2VsU2VydmljZXMgU2VydmljZSBBcHBsaWNhdGlvbiB2YXJpYWJsZXMiCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuRXhjZWxTZXJ2aWNlcy5Qcm92aXNpb24gPSAoR2V0LVZhcmlhYmxlVmFsdWUgJEVYQ0VMX1BST1ZJU0lPTiAibG9jYWxob3N0IiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkdW5hdHRlbmRlZEFjY3QgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJEVYQ0VMX0FDQ1QgInN2Y19zcF9FeGNlbCIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLkV4Y2VsU2VydmljZXMuVW5hdHRlbmRlZElEVXNlciA9ICRkb21haW4gKyAiXCIgKyAkdW5hdHRlbmRlZEFjY3QKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5FeGNlbFNlcnZpY2VzLlVuYXR0ZW5kZWRJRFBhc3N3b3JkID0gZ2V0LXNlcnZpY2VBY2NvdW50UGFzc3dvcmQgLXVzZXJuYW1lICR1bmF0dGVuZGVkQWNjdAogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLkV4Y2VsU2VydmljZXMuTmFtZSA9ICRFWENFTF9TVkNBUFBfTkFNRQogICAgI2VuZHJlZ2lvbgoKICAgICNyZWdpb24gVklTSU8KICAgIGxvZyAiSU5GTzogU2V0dGluZyBWaXNpb1NlcnZpY2UgU2VydmljZSBBcHBsaWNhdGlvbiB2YXJpYWJsZXMiCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuVmlzaW9TZXJ2aWNlLlByb3Zpc2lvbiA9IChHZXQtVmFyaWFibGVWYWx1ZSAkVklTSU9fUFJPVklTSU9OICJsb2NhbGhvc3QiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICR1bmF0dGVuZGVkQWNjdCA9IChHZXQtVmFyaWFibGVWYWx1ZSAkVklTSU9fQUNDVCAic3ZjX3NwX2Zhcm0iICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5WaXNpb1NlcnZpY2UuVW5hdHRlbmRlZElEVXNlciA9ICRkb21haW4gKyAiXCIgKyAkdW5hdHRlbmRlZEFjY3QKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5WaXNpb1NlcnZpY2UuVW5hdHRlbmRlZElEUGFzc3dvcmQgPSBnZXQtc2VydmljZUFjY291bnRQYXNzd29yZCAtdXNlcm5hbWUgJHVuYXR0ZW5kZWRBY2N0CiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuVmlzaW9TZXJ2aWNlLk5hbWUgPSAkVklTSU9fU1ZDQVBQX05BTUUKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5WaXNpb1NlcnZpY2UuUHJveHlOYW1lID0gJFZJU0lPX1NWQ0FQUF9QUk9YWQogICAgI2VuZHJlZ2lvbgoKICAgICNyZWdpb24gQUNDRVNTIDIwMTAKICAgIGxvZyAiSU5GTzogU2V0dGluZyBBY2Nlc3NTZXJ2aWNlIFNlcnZpY2UgQXBwbGljYXRpb24gdmFyaWFibGVzIgogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLkFjY2Vzc1NlcnZpY2UuUHJvdmlzaW9uID0gKEdldC1WYXJpYWJsZVZhbHVlICRBQ0NFU1MyMDEwX1BST1ZJU0lPTiAibG9jYWxob3N0IiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuQWNjZXNzU2VydmljZS5OYW1lID0gJEFDQ0VTUzIwMTBfU1ZDQVBQX05BTUUKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5BY2Nlc3NTZXJ2aWNlLlByb3h5TmFtZSA9ICRBQ0NFU1MyMDEwX1NWQ0FQUF9QUk9YWQogICAgI2VuZHJlZ2lvbgoKICAgICNyZWdpb24gQUNDRVNTIFNFUlZJQ0VTCiAgICBsb2cgIklORk86IFNldHRpbmcgQWNjZXNzU2VydmljZXMgU2VydmljZSBBcHBsaWNhdGlvbiB2YXJpYWJsZXMiCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuQWNjZXNzU2VydmljZXMuUHJvdmlzaW9uID0gKEdldC1WYXJpYWJsZVZhbHVlICRBQ0NFU1NfUFJPVklTSU9OICJsb2NhbGhvc3QiICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICRkYiA9IChHZXQtVmFyaWFibGVWYWx1ZSAkQUNDRVNTX0RCX1NFUlZFUiAkc3BfZGJfc2VydmVyICR1c2VIYXJkY29kZWREZWZhdWx0cykKICAgICRkYl9zZXJ2ZXIgPSAoW3N0cmluZ10oR2V0LVNlcnZlck5hbWUgJGRiKSkuVG9VcHBlcigpCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuQWNjZXNzU2VydmljZXMuRGF0YWJhc2UuREJBbGlhcy5EQkluc3RhbmNlID0gJGRiX3NlcnZlciArICJcIiArIChHZXQtVmFyaWFibGVWYWx1ZSAkQUNDRVNTX0RCX0lOU1RBTkNFX05BTUUgICJzcF9zdmNhcHBzIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpICMgVE9ETzogcy5iLiBzcF9zdmNhcHBfc2VydmVyCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuQWNjZXNzU2VydmljZXMuRGF0YWJhc2UuREJBbGlhcy5EQlBvcnQgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJEFDQ0VTU19EQl9JTlNUQU5DRV9QT1JUICI0OTAxMyIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQoKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5BY2Nlc3NTZXJ2aWNlcy5OYW1lID0gJEFDQ0VTU19TVkNBUFBfTkFNRQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLkFjY2Vzc1NlcnZpY2VzLlByb3h5TmFtZSA9ICRBQ0NFU1NfU1ZDQVBQX1BST1hZCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuQWNjZXNzU2VydmljZXMuRGF0YWJhc2UuTmFtZSA9ICRBQ0NFU1NfREJfTkFNRQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLkFjY2Vzc1NlcnZpY2VzLkRhdGFiYXNlLkRCU2VydmVyID0gJENPTkZJR0RCX0FMSUFTCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuQWNjZXNzU2VydmljZXMuRGF0YWJhc2UuREJBbGlhcy5DcmVhdGUgPSAkQ09ORklHREJfQUxJQVNfQ1JFQVRFCiAgICAjZW5kcmVnaW9uCgogICAgI3JlZ2lvbiBQRVJGT1JNQU5DRSBQT0lOVAogICAgbG9nICJJTkZPOiBTZXR0aW5nIFBlcmZvcm1hbmNlUG9pbnRTZXJ2aWNlIFNlcnZpY2UgQXBwbGljYXRpb24gdmFyaWFibGVzIgogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLlBlcmZvcm1hbmNlUG9pbnRTZXJ2aWNlLlByb3Zpc2lvbiA9IChHZXQtVmFyaWFibGVWYWx1ZSAkUEVSRlBPSU5UX1BST1ZJU0lPTiAibG9jYWxob3N0IiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCiAgICAkdW5hdHRlbmRlZEFjY3QgPSAoR2V0LVZhcmlhYmxlVmFsdWUgJFBFUkZQT0lOVF9BQ0NUICJzdmNfc3BfZmFybSIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLlBlcmZvcm1hbmNlUG9pbnRTZXJ2aWNlLlVuYXR0ZW5kZWRJRFVzZXIgPSAkZG9tYWluICsgIlwiICsgJHVuYXR0ZW5kZWRBY2N0CiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuUGVyZm9ybWFuY2VQb2ludFNlcnZpY2UuVW5hdHRlbmRlZElEUGFzc3dvcmQgPSBnZXQtc2VydmljZUFjY291bnRQYXNzd29yZCAtdXNlcm5hbWUgJHVuYXR0ZW5kZWRBY2N0CgogICAgJGRiID0gKEdldC1WYXJpYWJsZVZhbHVlICRQRVJGUE9JTlRfREJfU0VSVkVSICRzcF9kYl9zZXJ2ZXIgJHVzZUhhcmRjb2RlZERlZmF1bHRzKQogICAgJGRiX3NlcnZlciA9IChbc3RyaW5nXShHZXQtU2VydmVyTmFtZSAkZGIpKS5Ub1VwcGVyKCkKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5QZXJmb3JtYW5jZVBvaW50U2VydmljZS5EYXRhYmFzZS5EQkFsaWFzLkRCSW5zdGFuY2UgPSAkZGJfc2VydmVyICsgIlwiICsgKEdldC1WYXJpYWJsZVZhbHVlICRQRVJGUE9JTlRfREJfSU5TVEFOQ0VfTkFNRSAgInNwX3N2Y2FwcHMiICR1c2VIYXJkY29kZWREZWZhdWx0cykgIyBUT0RPOiBzLmIuIHNwX3N2Y2FwcF9zZXJ2ZXIKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5QZXJmb3JtYW5jZVBvaW50U2VydmljZS5EYXRhYmFzZS5EQkFsaWFzLkRCUG9ydCA9IChHZXQtVmFyaWFibGVWYWx1ZSAkUEVSRlBPSU5UX0RCX0lOU1RBTkNFX1BPUlQgIjQ5MDEzIiAkdXNlSGFyZGNvZGVkRGVmYXVsdHMpCgogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLlBlcmZvcm1hbmNlUG9pbnRTZXJ2aWNlLk5hbWUgPSAkUEVSRlBPSU5UX1NWQ0FQUF9OQU1FCiAgICAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5FbnRlcnByaXNlU2VydmljZUFwcHMuUGVyZm9ybWFuY2VQb2ludFNlcnZpY2UuUHJveHlOYW1lID0gJEFDQ0VTU19TVkNBUFBfUFJPWFkKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5QZXJmb3JtYW5jZVBvaW50U2VydmljZS5EYXRhYmFzZS5OYW1lID0gJFBFUkZQT0lOVF9TVkNBUFBfUFJPWFkKICAgICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkVudGVycHJpc2VTZXJ2aWNlQXBwcy5QZXJmb3JtYW5jZVBvaW50U2VydmljZS5EYXRhYmFzZS5EQlNlcnZlciA9ICRDT05GSUdEQl9BTElBUwogICAgJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRW50ZXJwcmlzZVNlcnZpY2VBcHBzLlBlcmZvcm1hbmNlUG9pbnRTZXJ2aWNlLkRhdGFiYXNlLkRCQWxpYXMuQ3JlYXRlID0gJENPTkZJR0RCX0FMSUFTX0NSRUFURSAgICAKICAgICNlbmRyZWdpb24KCiAgICAjICoqKiB1cGRhdGUgSU5QVVQgeG1sIHdpdGggdGhlIHZhbHVlcyBmcm9tIHZhcmlhYmxlcywgbGlrZSBzZXJ2ZXIgbmFtZSwgZG9tYWluLCBldGMKICAgICR4bWxpbnB1dC5TYXZlKCRpbnB1dEZpbGUpCn0KCmZ1bmN0aW9uIEV4ZWN1dGUtUFNDb25maWdVSQp7CiAgICAgICAgTG9hZC1TaGFyZVBvaW50LVBvd2VyU2hlbGwgICAgCgogICAgICAgICRyZXRyeU51bSA9IDEKICAgICAgICBsb2cgKCJJTkZPOiBhYm91dCB0byBSdW4tUFNDb25maWcgIiArICRyZXRyeU51bSkKICAgICAgICBSdW4tUFNDb25maWcKICAgICAgICBsb2cgIklORk86IGRvbmUiCiAgICAgICAgJFBTQ29uZmlnTGFzdEVycm9yID0gQ2hlY2stUFNDb25maWcKICAgICAgICBsb2cgIklORk86IFBTQ29uZmlnTGFzdEVycm9yID0gJFBTQ29uZmlnTGFzdEVycm9yIgoKICAgICAgICB3aGlsZSAoIShbc3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkUFNDb25maWdMYXN0RXJyb3IpKSAtYW5kICRyZXRyeU51bSAtbGUgNCkKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAoIklORk86IFJ1bi1QU0NvbmZpZyAiICsgJHJldHJ5TnVtKQogICAgICAgICAgICBsb2cgJFBTQ29uZmlnTGFzdEVycm9yLkxpbmUKICAgICAgICAgICAgbG9nICIgLSBBbiBlcnJvciBvY2N1cnJlZCBydW5uaW5nIFBTQ29uZmlnLCB0cnlpbmcgYWdhaW4gKCRyZXRyeU51bSkuLi4iCiAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzIDUKICAgICAgICAgICAgJHJldHJ5TnVtICs9IDEKICAgICAgICAgICAgUnVuLVBTQ29uZmlnCiAgICAgICAgICAgICRQU0NvbmZpZ0xhc3RFcnJvciA9IENoZWNrLVBTQ29uZmlnCiAgICAgICAgfQogICAgICAgIElmICgkcmV0cnlOdW0gLWdlIDUpCiAgICAgICAgewogICAgICAgICAgICB0aHJvdyAiV0FSTklORzogLSBBZnRlciAkcmV0cnlOdW0gcmV0cmllcyB0byBydW4gUFNDb25maWcsIFBsZWFzZSBydW4gR1VJLWJhc2VkIG9PbmZpZ3VyYXRpb24gV2l6YXJkIE1hbnVhbGx5IgogICAgICAgIH0KICAgICAgICBDbGVhci1WYXJpYWJsZSAtTmFtZSBQU0NvbmZpZ0xhc3RFcnJvciAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIENsZWFyLVZhcmlhYmxlIC1OYW1lIFBTQ29uZmlnTG9nIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgQ2xlYXItVmFyaWFibGUgLU5hbWUgcmV0cnlOdW0gLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKfQoKZnVuY3Rpb24gVXBncmFkZS1Db250ZW50RGF0YWJhc2VzCnsKICAgICAgICBMb2FkLVNoYXJlUG9pbnQtUG93ZXJTaGVsbCAgICAKCiAgICAgICAgbG9nICJJTkZPOiBHZXR0aW5nIGFsbCBDb250ZW50IERCcyBmb3IgdXBnYXJkZSIKCiAgICAgICAgJGNvbnRlbnREQnMgPSBHZXQtU1BDb250ZW50RGF0YWJhc2UgfCBzZWxlY3QgTmFtZQogICAgICAgIGlmICgoJGNvbnRlbnREQnMgLW5lICRudWxsKSAtYW5kICgkY29udGVudERCcy5Db3VudCAtbmUgMCkpCiAgICAgICAgewogICAgICAgICAgICBmb3JlYWNoICgkZGIgaW4gJGNvbnRlbnREQnMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGxvZyAoIklORk86IHN0YXJ0aW5nIHVwZ3JhZGUgIiArICRkYi5OYW1lKQogICAgICAgICAgICAgICAgVXBncmFkZS1TUENvbnRlbnREYXRhYmFzZSAkZGIuTmFtZSAtQ29uZmlybTokZmFsc2UKICAgICAgICAgICAgICAgIGxvZyAoIklORk86IGZpbmlzaGVkIHVwZ3JhZGUgIiArICRkYi5OYW1lKQogICAgICAgICAgICB9CiAgICAgICAgfQp9CgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMgRnVuYzogQ3JlYXRlVXNlclByb2ZpbGVTZXJ2aWNlQXBwbGljYXRpb25fTVdTQVVTCiMgRGVzYzogQ3JlYXRlIHRoZSBVc2VyIFByb2ZpbGUgU2VydmljZSBBcHBsaWNhdGlvbiAtIE1XUyBBdXN0cmFsaWEKIyBNb2RpZmllZCBieTogTWFyaW5hIEtyeW5pbmEKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKRnVuY3Rpb24gQ3JlYXRlVXNlclByb2ZpbGVTZXJ2aWNlQXBwbGljYXRpb25fTVdTQVVTKFt4bWxdJHhtbGlucHV0KQp7CiAgICAjIEJhc2VkIG9uIGh0dHA6Ly9zaGFyZXBvaW50Lm1pY3Jvc29mdC5jb20vYmxvZ3MvemFjaC9MaXN0cy9Qb3N0cy9Qb3N0LmFzcHg/SUQ9NTAKICAgIFRyeQogICAgewogICAgICAgIEdldC1NYWpvclZlcnNpb25OdW1iZXIgJHhtbGlucHV0CiAgICAgICAgJHVzZXJQcm9maWxlID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uU2VydmljZUFwcHMuVXNlclByb2ZpbGVTZXJ2aWNlQXBwCiAgICAgICAgJG15U2l0ZVdlYkFwcCA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLldlYkFwcGxpY2F0aW9ucy5XZWJBcHBsaWNhdGlvbiB8IFdoZXJlIHskXy5UeXBlIC1lcSAiTXlTaXRlSG9zdCJ9CiAgICAgICAgJGRiUHJlZml4ID0gR2V0LURCUHJlZml4ICR4bWxpbnB1dAogICAgICAKICAgICAgICAkcG9ydGFsV2ViQXBwID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uV2ViQXBwbGljYXRpb25zLldlYkFwcGxpY2F0aW9uIHwgV2hlcmUgeyRfLlR5cGUgLWVxICJQb3J0YWwifSB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEKICAgICAgICAkcG9ydGFsQXBwUG9vbEFjY3QgPSBHZXQtU1BNYW5hZ2VkQWNjb3VudFhNTCAkeG1saW5wdXQgLUNvbW1vbk5hbWUgIlBvcnRhbCIKICAgICAgICBpZiAoW3N0cmluZ106OklzTnVsbE9yRW1wdHkoJHBvcnRhbEFwcFBvb2xBY2N0LnVzZXJuYW1lKSkge3Rocm93ICIgLSBgIlBvcnRhbGAiIG1hbmFnZWQgYWNjb3VudCBub3QgZm91bmQhIENoZWNrIHlvdXIgWE1MLiJ9CiAgICAgICAgCiAgICAgICAgJGZhcm1BY2N0ID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5BY2NvdW50LlVzZXJuYW1lCiAgICAgICAgJGZhcm1BY2N0UFdEID0gJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5BY2NvdW50LlBhc3N3b3JkCiAgICAgICAgIyBHZXQgdGhlIGNvbnRlbnQgYWNjZXNzIGFjY291bnRzIG9mIGVhY2ggU2VhcmNoIFNlcnZpY2UgQXBwbGljYXRpb24gaW4gdGhlIFhNTCAoaW4gY2FzZSB0aGVyZSBhcmUgbXVsdGlwbGUpCiAgICAgICAgZm9yZWFjaCAoJHNlYXJjaFNlcnZpY2VBcHBsaWNhdGlvbiBpbiAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5TZXJ2aWNlQXBwcy5FbnRlcnByaXNlU2VhcmNoU2VydmljZS5FbnRlcnByaXNlU2VhcmNoU2VydmljZUFwcGxpY2F0aW9ucy5FbnRlcnByaXNlU2VhcmNoU2VydmljZUFwcGxpY2F0aW9uKQogICAgICAgIHsKICAgICAgICAgICAgW2FycmF5XSRjb250ZW50QWNjZXNzQWNjb3VudHMgKz0gJHNlYXJjaFNlcnZpY2VBcHBsaWNhdGlvbi5Db250ZW50QWNjZXNzQWNjb3VudAogICAgICAgIH0KICAgICAgICBJZiAoKCRmYXJtQWNjdFBXRCAtbmUgIiIpIC1hbmQgKCRmYXJtQWNjdFBXRCAtbmUgJG51bGwpKSB7JGZhcm1BY2N0UFdEID0gKENvbnZlcnRUby1TZWN1cmVTdHJpbmcgJGZhcm1BY2N0UFdEIC1Bc1BsYWluVGV4dCAtZm9yY2UpfQoKICAgICAgICAkdXNlclByb2ZpbGVTZXJ2aWNlTmFtZSA9ICR1c2VyUHJvZmlsZS5OYW1lCiAgICAgICAgJHVzZXJQcm9maWxlU2VydmljZVByb3h5TmFtZSA9ICR1c2VyUHJvZmlsZS5Qcm94eU5hbWUKICAgICAgICAkc3BzZXJ2aWNlID0gR2V0LVNQTWFuYWdlZEFjY291bnRYTUwgJHhtbGlucHV0IC1Db21tb25OYW1lICJzcHNlcnZpY2UiCiAgICAgICAgSWYoJHVzZXJQcm9maWxlU2VydmljZU5hbWUgLWVxICRudWxsKSB7JHVzZXJQcm9maWxlU2VydmljZU5hbWUgPSAiVXNlciBQcm9maWxlIFNlcnZpY2UgQXBwbGljYXRpb24ifQogICAgICAgIElmKCR1c2VyUHJvZmlsZVNlcnZpY2VQcm94eU5hbWUgLWVxICRudWxsKSB7JHVzZXJQcm9maWxlU2VydmljZVByb3h5TmFtZSA9ICR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lfQogICAgICAgIElmICghJGZhcm1DcmVkZW50aWFsKSB7W1N5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUHNDcmVkZW50aWFsXSRmYXJtQ3JlZGVudGlhbCA9IEdldEZhcm1DcmVkZW50aWFscyAkeG1saW5wdXR9CgogICAgICAgIElmICgoU2hvdWxkSVByb3Zpc2lvbiAkdXNlclByb2ZpbGUgLWVxICR0cnVlKSAtYW5kIChHZXQtQ29tbWFuZCAtTmFtZSBOZXctU1BQcm9maWxlU2VydmljZUFwcGxpY2F0aW9uIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSkKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlTGluZQogICAgICAgICAgICBsb2cgIiAtIFByb3Zpc2lvbmluZyAkKCR1c2VyUHJvZmlsZS5OYW1lKSIKICAgICAgICAgICAgJGFwcGxpY2F0aW9uUG9vbCA9IEdldC1Ib3N0ZWRTZXJ2aWNlc0FwcFBvb2wgJHhtbGlucHV0CgogICAgICAgICAgICAjIENyZWF0ZSBhIFByb2ZpbGUgU2VydmljZSBBcHBsaWNhdGlvbgogICAgICAgICAgICBJZiAoKEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8ID8geyRfLkdldFR5cGUoKS5Ub1N0cmluZygpIC1lcSAiTWljcm9zb2Z0Lk9mZmljZS5TZXJ2ZXIuQWRtaW5pc3RyYXRpb24uVXNlclByb2ZpbGVBcHBsaWNhdGlvbiJ9KSAtZXEgJG51bGwpCiAgICAgICAgICAgIHsKCiAgICAgICAgICAgICAgICAjIENyZWF0ZSBTZXJ2aWNlIEFwcAogICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyAkdXNlclByb2ZpbGVTZXJ2aWNlTmFtZS4uLiIKICAgICAgICAgICAgICAgIENyZWF0ZVVQU0FzQWRtaW4gJHhtbGlucHV0CiAgICAgICAgICAgICAgICBsb2cgIiAtIFdhaXRpbmcgZm9yICR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lLi4uIiAKICAgICAgICAgICAgICAgICRwcm9maWxlU2VydmljZUFwcCA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8P3skXy5EaXNwbGF5TmFtZSAtZXEgJHVzZXJQcm9maWxlU2VydmljZU5hbWV9CiAgICAgICAgICAgICAgICBXaGlsZSAoJHByb2ZpbGVTZXJ2aWNlQXBwLlN0YXR1cyAtbmUgIk9ubGluZSIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgW2ludF0kVVBTV2FpdFRpbWUgPSAwCiAgICAgICAgICAgICAgICAgICAgIyBXYWl0IDIgbWludXRlcyBmb3IgZWl0aGVyIHRoZSBVUFMgdG8gYmUgY3JlYXRlZCwgb3IgdGhlIFVBQyBwcm9tcHQgdG8gdGltZSBvdXQKICAgICAgICAgICAgICAgICAgICBXaGlsZSAoKCRVUFNXYWl0VGltZSAtbHQgMTIwKSAtYW5kICgkcHJvZmlsZVNlcnZpY2VBcHAuU3RhdHVzIC1uZSAiT25saW5lIikpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIi4iIAogICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAxCiAgICAgICAgICAgICAgICAgICAgICAgICRwcm9maWxlU2VydmljZUFwcCA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8P3skXy5EaXNwbGF5TmFtZSAtZXEgJHVzZXJQcm9maWxlU2VydmljZU5hbWV9CiAgICAgICAgICAgICAgICAgICAgICAgIFtpbnRdJFVQU1dhaXRUaW1lICs9IDEKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgIyBJZiBpdCBzdGlsbCBpc24ndCBPbmxpbmUgYWZ0ZXIgMiBtaW51dGVzLCBwcm9tcHQgdG8gdHJ5IGFnYWluCiAgICAgICAgICAgICAgICAgICAgSWYgKCEoJHByb2ZpbGVTZXJ2aWNlQXBwKSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiLiIKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJUaW1lZCBvdXQgd2FpdGluZyBmb3Igc2VydmljZSBjcmVhdGlvbiAobWF5YmUgYSBVQUMgcHJvbXB0PykuIFRyeSBhZ2FpbiBpbiAzMCBzZWMiCgogICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAzMAogICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgICAgICAgICAgQ3JlYXRlVVBTQXNBZG1pbiAkeG1saW5wdXQKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBXYWl0aW5nIGZvciAkdXNlclByb2ZpbGVTZXJ2aWNlTmFtZS4uLiIgCiAgICAgICAgICAgICAgICAgICAgICAgICRwcm9maWxlU2VydmljZUFwcCA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8P3skXy5EaXNwbGF5TmFtZSAtZXEgJHVzZXJQcm9maWxlU2VydmljZU5hbWV9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIEVsc2Uge2JyZWFrfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbG9nICQoJHByb2ZpbGVTZXJ2aWNlQXBwLlN0YXR1cykKICAgICAgICAgICAgICAgICMgV2FpdCBhIGZldyBzZWNvbmRzIGZvciB0aGUgQ3JlYXRlVVBTQXNBZG1pbiBmdW5jdGlvbiB0byBjb21wbGV0ZQogICAgICAgICAgICAgICAgU3RhcnQtU2xlZXAgMzAKCiAgICAgICAgICAgICAgICAjIEdldCBvdXIgbmV3IFByb2ZpbGUgU2VydmljZSBBcHAKICAgICAgICAgICAgICAgICRwcm9maWxlU2VydmljZUFwcCA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8P3skXy5EaXNwbGF5TmFtZSAtZXEgJHVzZXJQcm9maWxlU2VydmljZU5hbWV9CiAgICAgICAgICAgICAgICBJZiAoISgkcHJvZmlsZVNlcnZpY2VBcHApKSB7VGhyb3cgIiAtIENvdWxkIG5vdCBnZXQgJHVzZXJQcm9maWxlU2VydmljZU5hbWUhIjt9CgogICAgICAgICAgICAgICAgIyBDcmVhdGUgUHJveHkKICAgICAgICAgICAgICAgIGxvZyAiIC0gQ3JlYXRpbmcgJHVzZXJQcm9maWxlU2VydmljZU5hbWUgUHJveHkuLi4iCiAgICAgICAgICAgICAgICAkcHJvZmlsZVNlcnZpY2VBcHBQcm94eSAgPSBOZXctU1BQcm9maWxlU2VydmljZUFwcGxpY2F0aW9uUHJveHkgLU5hbWUgIiR1c2VyUHJvZmlsZVNlcnZpY2VQcm94eU5hbWUiIC1TZXJ2aWNlQXBwbGljYXRpb24gJHByb2ZpbGVTZXJ2aWNlQXBwIC1EZWZhdWx0UHJveHlHcm91cAogICAgICAgICAgICAgICAgSWYgKC1ub3QgJD8pIHsgVGhyb3cgIiAtIEZhaWxlZCB0byBjcmVhdGUgJHVzZXJQcm9maWxlU2VydmljZU5hbWUgUHJveHkiIH0KCiAgICAgICAgICAgICAgICBsb2cgIiAtIEdyYW50aW5nIHJpZ2h0cyB0byAoJHVzZXJQcm9maWxlU2VydmljZU5hbWUpOiIKICAgICAgICAgICAgICAgICMgQ3JlYXRlIGEgdmFyaWFibGUgdGhhdCBjb250YWlucyB0aGUgZ3VpZCBmb3IgdGhlIFVzZXIgUHJvZmlsZSBzZXJ2aWNlIGZvciB3aGljaCB5b3Ugd2FudCB0byBkZWxlZ2F0ZSBwZXJtaXNzaW9ucwogICAgICAgICAgICAgICAgJHNlcnZpY2VBcHBJRFRvU2VjdXJlID0gR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uICQoJHByb2ZpbGVTZXJ2aWNlQXBwLklkKQoKICAgICAgICAgICAgICAgICMgQ3JlYXRlIGEgdmFyaWFibGUgdGhhdCBjb250YWlucyB0aGUgbGlzdCBvZiBhZG1pbmlzdHJhdG9ycyBmb3IgdGhlIHNlcnZpY2UgYXBwbGljYXRpb24KICAgICAgICAgICAgICAgICRwcm9maWxlU2VydmljZUFwcFNlY3VyaXR5ID0gR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uU2VjdXJpdHkgJHNlcnZpY2VBcHBJRFRvU2VjdXJlIC1BZG1pbgogICAgICAgICAgICAgICAgIyBDcmVhdGUgYSB2YXJpYWJsZSB0aGF0IGNvbnRhaW5zIHRoZSBwZXJtaXNzaW9ucyBmb3IgdGhlIHNlcnZpY2UgYXBwbGljYXRpb24KICAgICAgICAgICAgICAgICRwcm9maWxlU2VydmljZUFwcFBlcm1pc3Npb25zID0gR2V0LVNQU2VydmljZUFwcGxpY2F0aW9uU2VjdXJpdHkgJHNlcnZpY2VBcHBJRFRvU2VjdXJlCgogICAgICAgICAgICAgICAgIyBDcmVhdGUgdmFyaWFibGVzIHRoYXQgY29udGFpbnMgdGhlIGNsYWltcyBwcmluY2lwYWxzIGZvciBjdXJyZW50IChTZXR1cCkgdXNlciwgZ2VucmFsIHNlcnZpY2UgYWNjb3VudCwgTXlTaXRlIEFwcCBQb29sLCBQb3J0YWwgQXBwIFBvb2wgYW5kIENvbnRlbnQgQWNjZXNzIGFjY291bnRzCiAgICAgICAgICAgICAgICAjIFRoZW4gZ2l2ZSAnRnVsbCBDb250cm9sJyBwZXJtaXNzaW9ucyB0byB0aGUgY3VycmVudCAoU2V0dXApIHVzZXIsIGdlbmVyYWwgc2VydmljZSBhY2NvdW50LCBNeVNpdGUgQXBwIFBvb2wsIFBvcnRhbCBBcHAgUG9vbCBhY2NvdW50IGFuZCBjb250ZW50IGFjY2VzcyBhY2NvdW50IGNsYWltcyBwcmluY2lwYWxzCiAgICAgICAgICAgICAgICAkY3VycmVudFVzZXJBY2N0UHJpbmNpcGFsID0gTmV3LVNQQ2xhaW1zUHJpbmNpcGFsIC1JZGVudGl0eSAkZW52OlVTRVJET01BSU5cJGVudjpVU0VSTkFNRSAtSWRlbnRpdHlUeXBlIFdpbmRvd3NTYW1BY2NvdW50TmFtZQogICAgICAgICAgICAgICAgJHNwU2VydmljZUFjY3RQcmluY2lwYWwgPSBOZXctU1BDbGFpbXNQcmluY2lwYWwgLUlkZW50aXR5ICQoJHNwc2VydmljZS51c2VybmFtZSkgLUlkZW50aXR5VHlwZSBXaW5kb3dzU2FtQWNjb3VudE5hbWUKICAgICAgICAgICAgICAgIEdyYW50LVNQT2JqZWN0U2VjdXJpdHkgJHByb2ZpbGVTZXJ2aWNlQXBwU2VjdXJpdHkgLVByaW5jaXBhbCAkY3VycmVudFVzZXJBY2N0UHJpbmNpcGFsIC1SaWdodHMgIkZ1bGwgQ29udHJvbCIKICAgICAgICAgICAgICAgIEdyYW50LVNQT2JqZWN0U2VjdXJpdHkgJHByb2ZpbGVTZXJ2aWNlQXBwUGVybWlzc2lvbnMgLVByaW5jaXBhbCAkY3VycmVudFVzZXJBY2N0UHJpbmNpcGFsIC1SaWdodHMgIkZ1bGwgQ29udHJvbCIKICAgICAgICAgICAgICAgIEdyYW50LVNQT2JqZWN0U2VjdXJpdHkgJHByb2ZpbGVTZXJ2aWNlQXBwUGVybWlzc2lvbnMgLVByaW5jaXBhbCAkc3BTZXJ2aWNlQWNjdFByaW5jaXBhbCAtUmlnaHRzICJGdWxsIENvbnRyb2wiCiAgICAgICAgICAgICAgICBJZiAoJG15U2l0ZUFwcFBvb2xBY2N0KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGxvZyAiICAtICQoJG15U2l0ZUFwcFBvb2xBY2N0LnVzZXJuYW1lKS4uLiIKICAgICAgICAgICAgICAgICAgICAkbXlTaXRlQXBwUG9vbEFjY3RQcmluY2lwYWwgPSBOZXctU1BDbGFpbXNQcmluY2lwYWwgLUlkZW50aXR5ICQoJG15U2l0ZUFwcFBvb2xBY2N0LnVzZXJuYW1lKSAtSWRlbnRpdHlUeXBlIFdpbmRvd3NTYW1BY2NvdW50TmFtZQogICAgICAgICAgICAgICAgICAgIEdyYW50LVNQT2JqZWN0U2VjdXJpdHkgJHByb2ZpbGVTZXJ2aWNlQXBwU2VjdXJpdHkgLVByaW5jaXBhbCAkbXlTaXRlQXBwUG9vbEFjY3RQcmluY2lwYWwgLVJpZ2h0cyAiRnVsbCBDb250cm9sIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgSWYgKCRwb3J0YWxBcHBQb29sQWNjdCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSAkKCRwb3J0YWxBcHBQb29sQWNjdC51c2VybmFtZSkuLi4iCiAgICAgICAgICAgICAgICAgICAgJHBvcnRhbEFwcFBvb2xBY2N0UHJpbmNpcGFsID0gTmV3LVNQQ2xhaW1zUHJpbmNpcGFsIC1JZGVudGl0eSAkKCRwb3J0YWxBcHBQb29sQWNjdC51c2VybmFtZSkgLUlkZW50aXR5VHlwZSBXaW5kb3dzU2FtQWNjb3VudE5hbWUKICAgICAgICAgICAgICAgICAgICBHcmFudC1TUE9iamVjdFNlY3VyaXR5ICRwcm9maWxlU2VydmljZUFwcFNlY3VyaXR5IC1QcmluY2lwYWwgJHBvcnRhbEFwcFBvb2xBY2N0UHJpbmNpcGFsIC1SaWdodHMgIkZ1bGwgQ29udHJvbCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIElmICgkY29udGVudEFjY2Vzc0FjY291bnRzKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRjb250ZW50QWNjZXNzQWNjdCBpbiAkY29udGVudEFjY2Vzc0FjY291bnRzKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBHaXZlICdSZXRyaWV2ZSBQZW9wbGUgRGF0YSBmb3IgU2VhcmNoIENyYXdsZXJzJyBwZXJtaXNzaW9ucyB0byB0aGUgQ29udGVudCBBY2Nlc3MgY2xhaW1zIHByaW5jaXBhbAogICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAgLSAkY29udGVudEFjY2Vzc0FjY3QuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50QWNjZXNzQWNjdFByaW5jaXBhbCA9IE5ldy1TUENsYWltc1ByaW5jaXBhbCAtSWRlbnRpdHkgJGNvbnRlbnRBY2Nlc3NBY2N0IC1JZGVudGl0eVR5cGUgV2luZG93c1NhbUFjY291bnROYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIEdyYW50LVNQT2JqZWN0U2VjdXJpdHkgJHByb2ZpbGVTZXJ2aWNlQXBwU2VjdXJpdHkgLVByaW5jaXBhbCAkY29udGVudEFjY2Vzc0FjY3RQcmluY2lwYWwgLVJpZ2h0cyAiUmV0cmlldmUgUGVvcGxlIERhdGEgZm9yIFNlYXJjaCBDcmF3bGVycyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBBcHBseSB0aGUgY2hhbmdlcyB0byB0aGUgVXNlciBQcm9maWxlIHNlcnZpY2UgYXBwbGljYXRpb24KICAgICAgICAgICAgICAgIFNldC1TUFNlcnZpY2VBcHBsaWNhdGlvblNlY3VyaXR5ICRzZXJ2aWNlQXBwSURUb1NlY3VyZSAtb2JqZWN0U2VjdXJpdHkgJHByb2ZpbGVTZXJ2aWNlQXBwU2VjdXJpdHkgLUFkbWluCiAgICAgICAgICAgICAgICBTZXQtU1BTZXJ2aWNlQXBwbGljYXRpb25TZWN1cml0eSAkc2VydmljZUFwcElEVG9TZWN1cmUgLW9iamVjdFNlY3VyaXR5ICRwcm9maWxlU2VydmljZUFwcFBlcm1pc3Npb25zCiAgICAgICAgICAgICAgICBsb2cgIiAtIERvbmUgZ3JhbnRpbmcgcmlnaHRzLiIKCiAgICAgICAgICAgICAgICAjIEFkZCBsaW5rIHRvIHJlc291cmNlcyBsaXN0CiAgICAgICAgICAgICAgICBBZGRSZXNvdXJjZXNMaW5rICJVc2VyIFByb2ZpbGUgQWRtaW5pc3RyYXRpb24iICgiX2xheW91dHMvTWFuYWdlVXNlclByb2ZpbGVTZXJ2aWNlQXBwbGljYXRpb24uYXNweD9BcHBsaWNhdGlvbklEPSIgKyAgJHByb2ZpbGVTZXJ2aWNlQXBwLklkKQoKICAgICAgICAgICAgICAgIElmICgkcG9ydGFsQXBwUG9vbEFjY3QpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIyBHcmFudCB0aGUgUG9ydGFsIEFwcCBQb29sIGFjY291bnQgcmlnaHRzIHRvIHRoZSBQcm9maWxlIGFuZCBTb2NpYWwgREJzCiAgICAgICAgICAgICAgICAgICAgJHByb2ZpbGVEQiA9ICRkYlByZWZpeCskdXNlclByb2ZpbGUuRGF0YWJhc2UuUHJvZmlsZURCCiAgICAgICAgICAgICAgICAgICAgJHNvY2lhbERCID0gJGRiUHJlZml4KyR1c2VyUHJvZmlsZS5EYXRhYmFzZS5Tb2NpYWxEQgogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gR3JhbnRpbmcgJCgkcG9ydGFsQXBwUG9vbEFjY3QudXNlcm5hbWUpIHJpZ2h0cyB0byAkbXlTaXRlREIuLi4iCiAgICAgICAgICAgICAgICAgICAgR2V0LVNQRGF0YWJhc2UgfCA/IHskXy5OYW1lIC1lcSAkbXlTaXRlREJ9IHwgQWRkLVNQU2hlbGxBZG1pbiAtVXNlck5hbWUgJCgkcG9ydGFsQXBwUG9vbEFjY3QudXNlcm5hbWUpCiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBHcmFudGluZyAkKCRwb3J0YWxBcHBQb29sQWNjdC51c2VybmFtZSkgcmlnaHRzIHRvICRwcm9maWxlREIuLi4iCiAgICAgICAgICAgICAgICAgICAgR2V0LVNQRGF0YWJhc2UgfCA/IHskXy5OYW1lIC1lcSAkcHJvZmlsZURCfSB8IEFkZC1TUFNoZWxsQWRtaW4gLVVzZXJOYW1lICQoJHBvcnRhbEFwcFBvb2xBY2N0LnVzZXJuYW1lKQogICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gR3JhbnRpbmcgJCgkcG9ydGFsQXBwUG9vbEFjY3QudXNlcm5hbWUpIHJpZ2h0cyB0byAkc29jaWFsREIuLi4iCiAgICAgICAgICAgICAgICAgICAgR2V0LVNQRGF0YWJhc2UgfCA/IHskXy5OYW1lIC1lcSAkc29jaWFsREJ9IHwgQWRkLVNQU2hlbGxBZG1pbiAtVXNlck5hbWUgJCgkcG9ydGFsQXBwUG9vbEFjY3QudXNlcm5hbWUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2cgIiAtIEVuYWJsaW5nIHRoZSBBY3Rpdml0eSBGZWVkIFRpbWVyIEpvYi4uIgogICAgICAgICAgICAgICAgSWYgKCRwcm9maWxlU2VydmljZUFwcCkge0dldC1TUFRpbWVySm9iIHwgPyB7JF8uVHlwZU5hbWUgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLlNlcnZlci5BY3Rpdml0eUZlZWQuQWN0aXZpdHlGZWVkVVBBSm9iIn0gfCBFbmFibGUtU1BUaW1lckpvYn0KCiAgICAgICAgICAgICAgICBsb2cgIiAtIERvbmUgY3JlYXRpbmcgJHVzZXJQcm9maWxlU2VydmljZU5hbWUuIgogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGdldCB0aGUgc2VydmljZSBpbnN0YW5jZQogICAgICAgICAgICAkcHJvZmlsZVNlcnZpY2VJbnN0YW5jZXMgPSBHZXQtU1BTZXJ2aWNlSW5zdGFuY2UgfCA/IHskXy5HZXRUeXBlKCkuVG9TdHJpbmcoKSAtZXEgIk1pY3Jvc29mdC5PZmZpY2UuU2VydmVyLkFkbWluaXN0cmF0aW9uLlVzZXJQcm9maWxlU2VydmljZUluc3RhbmNlIn0KICAgICAgICAgICAgJHByb2ZpbGVTZXJ2aWNlSW5zdGFuY2UgPSAkcHJvZmlsZVNlcnZpY2VJbnN0YW5jZXMgfCA/IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXIuQWRkcmVzcyAkZW52OkNPTVBVVEVSTkFNRX0KICAgICAgICAgICAgSWYgKC1ub3QgJD8pIHsgVGhyb3cgIiAtIEZhaWxlZCB0byBmaW5kIFVzZXIgUHJvZmlsZSBTZXJ2aWNlIGluc3RhbmNlIiB9CgogICAgICAgICAgICAjIFN0YXJ0IFNlcnZpY2UgaW5zdGFuY2UKICAgICAgICAgICAgbG9nICIgLSBTdGFydGluZyBVc2VyIFByb2ZpbGUgU2VydmljZSBpbnN0YW5jZS4uLiIKICAgICAgICAgICAgSWYgKCgkcHJvZmlsZVNlcnZpY2VJbnN0YW5jZS5TdGF0dXMgLWVxICJEaXNhYmxlZCIpIC1vciAoJHByb2ZpbGVTZXJ2aWNlSW5zdGFuY2UuU3RhdHVzIC1uZSAiT25saW5lIikpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRwcm9maWxlU2VydmljZUluc3RhbmNlLlByb3Zpc2lvbigpCiAgICAgICAgICAgICAgICBJZiAoLW5vdCAkPykgeyBUaHJvdyAiIC0gRmFpbGVkIHRvIHN0YXJ0IFVzZXIgUHJvZmlsZSBTZXJ2aWNlIGluc3RhbmNlIiB9CiAgICAgICAgICAgICAgICAjIFdhaXQKICAgICAgICAgICAgICAgIGxvZyAiIC0gV2FpdGluZyBmb3IgVXNlciBQcm9maWxlIFNlcnZpY2UuLi4iIAogICAgICAgICAgICAgICAgV2hpbGUgKCRwcm9maWxlU2VydmljZUluc3RhbmNlLlN0YXR1cyAtbmUgIk9ubGluZSIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIuIiAKICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAxCiAgICAgICAgICAgICAgICAgICAgJHByb2ZpbGVTZXJ2aWNlSW5zdGFuY2VzID0gR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLlNlcnZlci5BZG1pbmlzdHJhdGlvbi5Vc2VyUHJvZmlsZVNlcnZpY2VJbnN0YW5jZSJ9CiAgICAgICAgICAgICAgICAgICAgJHByb2ZpbGVTZXJ2aWNlSW5zdGFuY2UgPSAkcHJvZmlsZVNlcnZpY2VJbnN0YW5jZXMgfCA/IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5TZXJ2ZXIuQWRkcmVzcyAkZW52OkNPTVBVVEVSTkFNRX0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxvZyAkKCRwcm9maWxlU2VydmljZUluc3RhbmNlLlN0YXR1cykKICAgICAgICAgICAgfQoKCgogICAgICAgICAgICAjIFN0YXJ0IFVzZXIgUHJvZmlsZSBTeW5jaHJvbml6YXRpb24gU2VydmljZQogICAgICAgICAgICAjIEdldCBVc2VyIFByb2ZpbGUgU2VydmljZQogICAgICAgICAgICAkcHJvZmlsZVNlcnZpY2VBcHAgPSBHZXQtU1BTZXJ2aWNlQXBwbGljYXRpb24gfD97JF8uRGlzcGxheU5hbWUgLWVxICR1c2VyUHJvZmlsZVNlcnZpY2VOYW1lfQoKICAgICAgICAgICAgSWYgKCRwcm9maWxlU2VydmljZUFwcCAtYW5kICgkdXNlclByb2ZpbGUuU3RhcnRQcm9maWxlU3luYyAtZXEgJHRydWUpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBJZiAoJHVzZXJQcm9maWxlLkVuYWJsZU5ldEJJT1NEb21haW5OYW1lcyAtZXEgJHRydWUpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBFbmFibGluZyBOZXRCSU9TIGRvbWFpbiBuYW1lcyBmb3IgJHVzZXJQcm9maWxlU2VydmljZU5hbWUuLi4iCiAgICAgICAgICAgICAgICAgICAgJHByb2ZpbGVTZXJ2aWNlQXBwLk5ldEJJT1NEb21haW5OYW1lc0VuYWJsZWQgPSAxCiAgICAgICAgICAgICAgICAgICAgJHByb2ZpbGVTZXJ2aWNlQXBwLlVwZGF0ZSgpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBHZXQgVXNlciBQcm9maWxlIFN5bmNocm9uaXphdGlvbiBTZXJ2aWNlCiAgICAgICAgICAgICAgICBsb2cgIiAtIENoZWNraW5nIFVzZXIgUHJvZmlsZSBTeW5jaHJvbml6YXRpb24gU2VydmljZS4uLiIgCiAgICAgICAgICAgICAgICAkcHJvZmlsZVN5bmNTZXJ2aWNlcyA9IEAoR2V0LVNQU2VydmljZUluc3RhbmNlIHwgPyB7JF8uR2V0VHlwZSgpLlRvU3RyaW5nKCkgLWVxICJNaWNyb3NvZnQuT2ZmaWNlLlNlcnZlci5BZG1pbmlzdHJhdGlvbi5Qcm9maWxlU3luY2hyb25pemF0aW9uU2VydmljZUluc3RhbmNlIn0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRzeW5jaFNlcnZlciA9ICR1c2VyUHJvZmlsZS5TeW5jaFNlcnZlcgoKICAgICAgICAgICAgICAgICRwcm9maWxlU3luY1NlcnZpY2UgPSAkcHJvZmlsZVN5bmNTZXJ2aWNlcyB8ID8ge01hdGNoQ29tcHV0ZXJOYW1lICRfLlBhcmVudC5BZGRyZXNzICRzeW5jaFNlcnZlcn0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBBdHRlbXB0IHRvIHN0YXJ0IG9ubHkgaWYgdGhlcmUgYXJlIG5vIG9ubGluZSBQcm9maWxlIFN5bmMgU2VydmljZSBpbnN0YW5jZXMgaW4gdGhlIGZhcm0gYXMgd2UgZG9uJ3Qgd2FudCB0byBzdGFydCBtdWx0aXBsZSBTeW5jIGluc3RhbmNlcyAocnVubmluZyBhZ2FpbnN0IHRoZSBzYW1lIFByb2ZpbGUgU2VydmljZSBhdCBsZWFzdCkKICAgICAgICAgICAgICAgIElmICghKCRwcm9maWxlU3luY1NlcnZpY2VzIHwgPyB7JF8uU3RhdHVzIC1lcSAiT25saW5lIn0pKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICMgSW5zcGlyZWQgYnkgaHR0cDovL3RlY2huZXQubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2VlNzIxMDQ5LmFzcHgKICAgICAgICAgICAgICAgICAgICBJZiAoISgkZmFybUFjY3QpKSB7JGZhcm1BY2N0ID0gKEdldC1TUEZhcm0pLkRlZmF1bHRTZXJ2aWNlQWNjb3VudH0KICAgICAgICAgICAgICAgICAgICBJZiAoISgkZmFybUFjY3RQV0QpKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJgbiIKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgIkVSUk9SOiBNaXNzaW5nIEZhcm0gQWNjb3VudCBQYXNzd29yZCIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbG9nICJgbiIKCiAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBmb3IgYW4gZXhpc3RpbmcgVVBTIGNyZWRlbnRpYWxzIHRpbWVyIGpvYiAoZS5nLiBmcm9tIGEgcHJpb3IgcHJvdmlzaW9uaW5nIGF0dGVtcHQpLCBhbmQgZGVsZXRlIGl0CiAgICAgICAgICAgICAgICAgICAgJFVQU0NyZWRlbnRpYWxzSm9iID0gR2V0LVNQVGltZXJKb2IgfCA/IHskXy5OYW1lIC1lcSAid2luZG93cy1zZXJ2aWNlLWNyZWRlbnRpYWxzLUZJTVN5bmNocm9uaXphdGlvblNlcnZpY2UifQogICAgICAgICAgICAgICAgICAgIElmICgkVVBTQ3JlZGVudGlhbHNKb2IuU3RhdHVzIC1lcSAiT25saW5lIikKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gRGVsZXRpbmcgZXhpc3Rpbmcgc3luYyBjcmVkZW50aWFscyB0aW1lciBqb2IuLi4iCiAgICAgICAgICAgICAgICAgICAgICAgICRVUFNDcmVkZW50aWFsc0pvYi5EZWxldGUoKQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgIyBNSzogc3RhcnQgc3luY2ggc2VydmljZSBtdXN0IHJ1biB1bmRlciBmYXJtIGFjY291bnQgaWRlbnRpdHkKICAgICAgICAgICAgICAgICAgICAkZmFybUFjY3QgPSAkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkFjY291bnQuVXNlcm5hbWUKICAgICAgICAgICAgICAgICAgICAjIFVwZGF0ZVByb2Nlc3NJZGVudGl0eSAkcHJvZmlsZVN5bmNTZXJ2aWNlCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlUHJvY2Vzc0lkZW50aXR5VG9SdW5BcyAgJHByb2ZpbGVTeW5jU2VydmljZSAkZmFybUFjY3QKICAgICAgICAgICAgICAgICAgICAjIE1LOiBlbmQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAkcHJvZmlsZVN5bmNTZXJ2aWNlLlVwZGF0ZSgpCiAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBXYWl0aW5nIGZvciBVc2VyIFByb2ZpbGUgU3luY2hyb25pemF0aW9uIFNlcnZpY2UuLi4iIAogICAgICAgICAgICAgICAgICAgICMgUHJvdmlzaW9uIHRoZSBVc2VyIFByb2ZpbGUgU3luYyBTZXJ2aWNlCiAgICAgICAgICAgICAgICAgICAgJHByb2ZpbGVTZXJ2aWNlQXBwLlNldFN5bmNocm9uaXphdGlvbk1hY2hpbmUoJHN5bmNoU2VydmVyLCAkcHJvZmlsZVN5bmNTZXJ2aWNlLklkLCAkZmFybUFjY3QsIChDb252ZXJ0VG8tUGxhaW5UZXh0ICRmYXJtQWNjdFBXRCkpCiAgICAgICAgICAgICAgICAgICAgSWYgKCgkcHJvZmlsZVN5bmNTZXJ2aWNlLlN0YXR1cyAtbmUgIlByb3Zpc2lvbmluZyIpIC1hbmQgKCRwcm9maWxlU3luY1NlcnZpY2UuU3RhdHVzIC1uZSAiT25saW5lIikpIHtsb2cgImBuIC0gV2FpdGluZyBmb3IgVXNlciBQcm9maWxlIFN5bmNocm9uaXphdGlvbiBTZXJ2aWNlIHRvIHN0YXJ0Li4uIiB9CiAgICAgICAgICAgICAgICAgICAgIyBNb25pdG9yIFVzZXIgUHJvZmlsZSBTeW5jIHNlcnZpY2Ugc3RhdHVzCiAgICAgICAgICAgICAgICAgICAgV2hpbGUgKCRwcm9maWxlU3luY1NlcnZpY2UuU3RhdHVzIC1uZSAiT25saW5lIikKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdoaWxlICgkcHJvZmlsZVN5bmNTZXJ2aWNlLlN0YXR1cyAtbmUgIlByb3Zpc2lvbmluZyIpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiLiIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJvZmlsZVN5bmNTZXJ2aWNlID0gQChHZXQtU1BTZXJ2aWNlSW5zdGFuY2UgfCA/IHskXy5HZXRUeXBlKCkuVG9TdHJpbmcoKSAtZXEgIk1pY3Jvc29mdC5PZmZpY2UuU2VydmVyLkFkbWluaXN0cmF0aW9uLlByb2ZpbGVTeW5jaHJvbml6YXRpb25TZXJ2aWNlSW5zdGFuY2UifSkgfCA/IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5QYXJlbnQuQWRkcmVzcyAkc3luY2hTZXJ2ZXJ9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgSWYgKCRwcm9maWxlU3luY1NlcnZpY2UuU3RhdHVzIC1lcSAiUHJvdmlzaW9uaW5nIikKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICQoJHByb2ZpbGVTeW5jU2VydmljZS5TdGF0dXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgIiAtIFByb3Zpc2lvbmluZyBVc2VyIFByb2ZpbGUgU3luYyBTZXJ2aWNlLCBwbGVhc2Ugd2FpdC4uLiIgCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgV2hpbGUoJHByb2ZpbGVTeW5jU2VydmljZS5TdGF0dXMgLWVxICJQcm92aXNpb25pbmciIC1hbmQgJHByb2ZpbGVTeW5jU2VydmljZS5TdGF0dXMgLW5lICJEaXNhYmxlZCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiLiIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJvZmlsZVN5bmNTZXJ2aWNlID0gQChHZXQtU1BTZXJ2aWNlSW5zdGFuY2UgfCA/IHskXy5HZXRUeXBlKCkuVG9TdHJpbmcoKSAtZXEgIk1pY3Jvc29mdC5PZmZpY2UuU2VydmVyLkFkbWluaXN0cmF0aW9uLlByb2ZpbGVTeW5jaHJvbml6YXRpb25TZXJ2aWNlSW5zdGFuY2UifSkgfCA/IHtNYXRjaENvbXB1dGVyTmFtZSAkXy5QYXJlbnQuQWRkcmVzcyAkc3luY2hTZXJ2ZXJ9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgSWYgKCRwcm9maWxlU3luY1NlcnZpY2UuU3RhdHVzIC1uZSAiT25saW5lIikKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIuYGFgYSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyAiIC0gVXNlciBQcm9maWxlIFN5bmNocm9uaXphdGlvbiBTZXJ2aWNlIGNvdWxkIG5vdCBiZSBzdGFydGVkISIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgRWxzZQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cgJCgkcHJvZmlsZVN5bmNTZXJ2aWNlLlN0YXR1cykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTmVlZCB0byByZWN5Y2xlIHRoZSBDZW50cmFsIEFkbWluIGFwcCBwb29sIGJlZm9yZSB3ZSBjYW4gZG8gYW55dGhpbmcgd2l0aCB0aGUgVXNlciBQcm9maWxlIFN5bmMgU2VydmljZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBSZWN5Y2xpbmcgQ2VudHJhbCBBZG1pbiBhcHAgcG9vbC4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgRnJvbSBodHRwOi8vc2hhcmVwb2ludC5uYXVwbGl1cy5uZXQvMjAxMS8wOS9paXNyZXNldC1ub3QtcmVxdWlyZWQtYWZ0ZXItc3RhcnRpbmcuaHRtbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcFBvb2wgPSBnd21pIC1OYW1lc3BhY2UgInJvb3RcTWljcm9zb2Z0SUlTdjIiIC1jbGFzcyAiSUlzQXBwbGljYXRpb25Qb29sIiB8IHdoZXJlIHskXy5OYW1lIC1lcSAiVzNTVkMvQVBQUE9PTFMvU2hhcmVQb2ludCBDZW50cmFsIEFkbWluaXN0cmF0aW9uIHY0In0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmICgkYXBwUG9vbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwUG9vbC5SZWN5Y2xlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuZXdseVByb3Zpc2lvbmVkU3luYyA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICMgQXR0ZW1wdCB0byBjcmVhdGUgYSBzeW5jIGNvbm5lY3Rpb24gb25seSBvbiBhIHN1Y2Nlc3NmdWwsIG5ld2x5LXByb3Zpc2lvbmVkIFVzZXIgUHJvZmlsZSBTeW5jIHNlcnZpY2UKICAgICAgICAgICAgICAgICAgICAjIFdlIGRvbid0IGhhdmUgdGhlIGFiaWxpdHkgdG8gY2hlY2sgZm9yIGV4aXN0aW5nIGNvbm5lY3Rpb25zIGFuZCB3ZSBkb24ndCB3YW50IHRvIG92ZXJ3cml0ZS9kdXBsaWNhdGUgYW55IGV4aXN0aW5nIHN5bmMgY29ubmVjdGlvbnMKICAgICAgICAgICAgICAgICAgICAjIE5vdGUgdGhhdCB0aGlzIGlzbid0IHJlYWxseSBzdXBwb3J0ZWQgYW55aG93LCBhbmQgdGhhdCBvbmx5IFNoYXJlUG9pbnQgMjAxMCBTZXJ2aWNlIFBhY2sgMSBhbmQgYWJvdmUgaW5jbHVkZXMgdGhlIEFkZC1TUFByb2ZpbGVTeW5jQ29ubmVjdGlvbiBjbWRsZXQKICAgICAgICAgICAgICAgICAgICBJZiAoKENoZWNrRm9yMjAxMFNQMSkgLWFuZCAoJHVzZXJQcm9maWxlLkNyZWF0ZURlZmF1bHRTeW5jQ29ubmVjdGlvbiAtZXEgJHRydWUpIC1hbmQgKCRuZXdseVByb3Zpc2lvbmVkU3luYyAtZXEgJHRydWUpKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICIgLSBDcmVhdGluZyBhIGRlZmF1bHQgUHJvZmlsZSBTeW5jIGNvbm5lY3Rpb24uLi4iCiAgICAgICAgICAgICAgICAgICAgICAgICRwcm9maWxlU2VydmljZUFwcCA9IEdldC1TUFNlcnZpY2VBcHBsaWNhdGlvbiB8P3skXy5EaXNwbGF5TmFtZSAtZXEgJHVzZXJQcm9maWxlU2VydmljZU5hbWV9CiAgICAgICAgICAgICAgICAgICAgICAgICMgVGhhbmtzIHRvIENvZGVwbGV4IHVzZXIgUmVzaGV0a292IGZvciB0aGlzIGluZ2VuaW91cyBvbmUtbGluZXIgdG8gYnVpbGQgdGhlIGRlZmF1bHQgZG9tYWluIE9VCiAgICAgICAgICAgICAgICAgICAgICAgICRjb25uZWN0aW9uU3luY09VID0gIkRDPSIrJGVudjpVU0VSRE5TRE9NQUlOIC1yZXBsYWNlICJcLiIsIixEQz0iCiAgICAgICAgICAgICAgICAgICAgICAgICRzeW5jQ29ubmVjdGlvbkRvbWFpbiwkc3luY0Nvbm5lY3Rpb25BY2N0ID0gKCR1c2VyUHJvZmlsZS5TeW5jQ29ubmVjdGlvbkFjY291bnQpIC1zcGxpdCAiXFwiCiAgICAgICAgICAgICAgICAgICAgICAgICRhZGRQcm9maWxlU3luY0NtZCA9IEAiCkFkZC1Qc1NuYXBpbiBNaWNyb3NvZnQuU2hhcmVQb2ludC5Qb3dlclNoZWxsCldyaXRlLUhvc3QgIiAtIENyZWF0aW5nIGRlZmF1bHQgU3luYyBjb25uZWN0aW9uLi4uIgpgJHN5bmNDb25uZWN0aW9uQWNjdFBXRCA9IChDb252ZXJ0VG8tU2VjdXJlU3RyaW5nIC1TdHJpbmcgYCckKCR1c2VyUHJvZmlsZS5TeW5jQ29ubmVjdGlvbkFjY291bnRQYXNzd29yZClgJyAtQXNQbGFpblRleHQgLUZvcmNlKQpBZGQtU1BQcm9maWxlU3luY0Nvbm5lY3Rpb24gLVByb2ZpbGVTZXJ2aWNlQXBwbGljYXRpb24gJCgkcHJvZmlsZVNlcnZpY2VBcHAuSWQpIC1Db25uZWN0aW9uRm9yZXN0TmFtZSAkZW52OlVTRVJETlNET01BSU4gLUNvbm5lY3Rpb25Eb21haW4gJHN5bmNDb25uZWN0aW9uRG9tYWluIC1Db25uZWN0aW9uVXNlck5hbWUgIiRzeW5jQ29ubmVjdGlvbkFjY3QiIC1Db25uZWN0aW9uU3luY2hyb25pemF0aW9uT1UgIiRjb25uZWN0aW9uU3luY09VIiAtQ29ubmVjdGlvblBhc3N3b3JkIGAkc3luY0Nvbm5lY3Rpb25BY2N0UFdECklmICghYCQ/KQp7CldyaXRlLUhvc3QgIlByZXNzIGFueSBrZXkgdG8gZXhpdC4uLiIKYCRudWxsID0gYCRob3N0LlVJLlJhd1VJLlJlYWRLZXkoYCJOb0VjaG8sSW5jbHVkZUtleURvd25gIikKfQpFbHNlIHtXcml0ZS1Ib3N0ICIgLSBEb25lLiI7U3RhcnQtU2xlZXAgMTV9CiJACiAgICAgICAgICAgICAgICAgICAgICAgICRhZGRQcm9maWxlU2NyaXB0RmlsZSA9ICIkKChHZXQtSXRlbSAkZW52OlRFTVApLkZ1bGxOYW1lKVxBdXRvU1BJbnN0YWxsZXItQWRkUHJvZmlsZVN5bmNDbWQucHMxIgogICAgICAgICAgICAgICAgICAgICAgICAkYWRkUHJvZmlsZVN5bmNDbWQgfCBPdXQtRmlsZSAkYWRkUHJvZmlsZVNjcmlwdEZpbGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCgoR2V0LVdtaU9iamVjdCBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0pLlZlcnNpb24gLWxpa2UgIjYuMioiIC1vciAoR2V0LVdtaU9iamVjdCBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0pLlZlcnNpb24gLWxpa2UgIjYuMyoiKSAtYW5kICgkZW52OnNwVmVyIC1lcSAiMTQiKSkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZlcnNpb25Td2l0Y2ggPSAiLVZlcnNpb24gMiIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHskdmVyc2lvblN3aXRjaCA9ICIifQogICAgICAgICAgICAgICAgICAgICAgICAjIFJ1biBvdXIgQWRkLVNQUHJvZmlsZVN5bmNDb25uZWN0aW9uIHNjcmlwdCBhcyB0aGUgRmFybSBBY2NvdW50IC0gZG9lc24ndCBzZWVtIHRvIHdvcmsgb3RoZXJ3aXNlCiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXJ0LVByb2Nlc3MgLVdvcmtpbmdEaXJlY3RvcnkgJFBTSE9NRSAtRmlsZVBhdGggInBvd2Vyc2hlbGwuZXhlIiAtQ3JlZGVudGlhbCAkZmFybUNyZWRlbnRpYWwgLUFyZ3VtZW50TGlzdCAiLUV4ZWN1dGlvblBvbGljeSBCeXBhc3MgLUNvbW1hbmQgU3RhcnQtUHJvY2VzcyAtV29ya2luZ0RpcmVjdG9yeSBgIickUFNIT01FJ2AiIC1GaWxlUGF0aCBgIidwb3dlcnNoZWxsLmV4ZSdgIiAtQXJndW1lbnRMaXN0IGAiJyR2ZXJzaW9uU3dpdGNoIC1FeGVjdXRpb25Qb2xpY3kgQnlwYXNzICRhZGRQcm9maWxlU2NyaXB0RmlsZSdgIiAtVmVyYiBSdW5hcyIgLVdhaXQKICAgICAgICAgICAgICAgICAgICAgICAgIyBHaXZlIEFkZC1TUFByb2ZpbGVTeW5jQ29ubmVjdGlvbiB0aW1lIHRvIGNvbXBsZXRlIGJlZm9yZSBjb250aW51aW5nCiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIDEyMAogICAgICAgICAgICAgICAgICAgICAgICBSZW1vdmUtSXRlbSAtTGl0ZXJhbFBhdGggJGFkZFByb2ZpbGVTY3JpcHRGaWxlIC1Gb3JjZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEVsc2Uge2xvZyAiQWxyZWFkeSBzdGFydGVkLiJ9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgRWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2cgIiAtIENvdWxkIG5vdCBnZXQgVXNlciBQcm9maWxlIFNlcnZpY2UsIG9yIFN0YXJ0UHJvZmlsZVN5bmMgaXMgRmFsc2UuIgogICAgICAgICAgICB9CiAgICAgICAgICAgIFdyaXRlTGluZQogICAgICAgIH0KICAgIH0KICAgIENhdGNoCiAgICB7CiAgICAgICAgVGhyb3cgIiAtIEVycm9yIFByb3Zpc2lvbmluZyB0aGUgVXNlciBQcm9maWxlIFNlcnZpY2UgQXBwbGljYXRpb24uICQoJF8uRXhjZXB0aW9uLk1lc3NhZ2UpIgogICAgfQp9CgojIE1LOiBlbmQKI2VuZHJlZ2lvbgoKI0VuZFJlZ2lvbiBDdXN0b20gZnVuY3Rpb25zCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiNSZWdpb24gUHJlcGFyZSBGb3IgRmFybSBjb25maWd1cmF0aW9uCkZ1bmN0aW9uIFByZXBGb3JDb25maWcgCnsKICAgIENoZWNrWE1MVmVyc2lvbiAkeG1saW5wdXQKICAgIENoZWNrSW5wdXQKICAgIGxvZyAiSU5GTzogLSBJbnN0YWxsIGJhc2VkIG9uOiBgbiAgLSAkaW5wdXRGaWxlIGBuICAtIEVudmlyb25tZW50OiAkKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLmdldEF0dHJpYnV0ZShgIkVudmlyb25tZW50YCIpKSBgbiAgLSBWZXJzaW9uOiAkKCR4bWxpbnB1dC5Db25maWd1cmF0aW9uLmdldEF0dHJpYnV0ZShgIlZlcnNpb25gIikpIgogICAgJHNwSW5zdGFsbGVkID0gKEdldC1TaGFyZVBvaW50SW5zdGFsbCkKICAgIFZhbGlkYXRlQ3JlZGVudGlhbHMgJHhtbGlucHV0CiAgICBWYWxpZGF0ZVBhc3NwaHJhc2UgJHhtbGlucHV0CiAgICAjIENoZWNrQ29uZmlnRmlsZXMgJHhtbGlucHV0IC0gSW5zdGFsbCBhbmQgVXBkYXRlcyBhcmUgaGFuZGxlcyBzZXBhcmF0ZWx5CiAgICBDaGVja1NRTEFjY2VzcwoKICAgIERpc2FibGVMb29wYmFja0NoZWNrICR4bWxpbnB1dAogICAgUmVtb3ZlSUVFbmhhbmNlZFNlY3VyaXR5ICR4bWxpbnB1dCAgIAogICAgVW5ibG9ja0ZpbGVzIC1wYXRoICIkYml0c1wkc3B5ZWFyIgoKICAgIERpc2FibGVTZXJ2aWNlcyAkeG1saW5wdXQKICAgIERpc2FibGVDUkxDaGVjayAkeG1saW5wdXQKICAgIENvbmZpZ3VyZUlJU0xvZ2dpbmcgJHhtbGlucHV0CiAgICBGaXhUYXhvbm9teVBpY2tlckJ1Zwp9CiNFbmRSZWdpb24KCiNSZWdpb24gU2V0dXAgRmFybQpGdW5jdGlvbiBTZXR1cC1GYXJtCnsKICAgIFtTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBzQ3JlZGVudGlhbF0kZmFybUNyZWRlbnRpYWwgPSBHZXRGYXJtQ3JlZGVudGlhbHMgJHhtbGlucHV0CiAgICBbc2VjdXJpdHkuc2VjdXJlc3RyaW5nXSRzZWNQaHJhc2UgPSBHZXRTZWN1cmVGYXJtUGFzc3BocmFzZSAkeG1saW5wdXQKICAgIENvbmZpZ3VyZUZhcm1BZG1pbiAkeG1saW5wdXQKICAgIExvYWQtU2hhcmVQb2ludC1Qb3dlclNoZWxsICAgIAogICAgQ3JlYXRlT3JKb2luRmFybSAkeG1saW5wdXQgKFtzZWN1cml0eS5zZWN1cmVzdHJpbmddJHNlY1BocmFzZSkgKFtTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBzQ3JlZGVudGlhbF0kZmFybUNyZWRlbnRpYWwpICAgIAogICAgQ2hlY2tGYXJtVG9wb2xvZ3kgJHhtbGlucHV0CiAgICBDb25maWd1cmVGYXJtICR4bWxpbnB1dCAgICAKICAgIENvbmZpZ3VyZURpYWdub3N0aWNMb2dnaW5nICR4bWxpbnB1dAogICAgQ29uZmlndXJlTGFuZ3VhZ2VQYWNrcyAkeG1saW5wdXQKICAgIEFkZE1hbmFnZWRBY2NvdW50cyAkeG1saW5wdXQKCiAgICBpZiAoJFBST1ZJU0lPTl9XRUJfQVBQUyAtZXEgJHRydWUpCiAgICB7CiAgICAgICAgQ3JlYXRlV2ViQXBwbGljYXRpb25zICR4bWxpbnB1dAogICAgfQp9CiNFbmRSZWdpb24KCiNSZWdpb24gU2V0dXAgU2VydmljZXMKRnVuY3Rpb24gU2V0dXAtU2VydmljZXMKewogICAgTG9hZC1TaGFyZVBvaW50LVBvd2VyU2hlbGwgICAgCgogICAgQ3JlYXRlU3RhdGVTZXJ2aWNlQXBwICR4bWxpbnB1dAogICAgQ3JlYXRlU2VjdXJlU3RvcmVTZXJ2aWNlQXBwICR4bWxpbnB1dAoKICAgIENyZWF0ZUFjY2Vzc1NlcnZpY2VzQXBwICR4bWxpbnB1dAogICAgQ3JlYXRlQWNjZXNzMjAxMFNlcnZpY2VBcHAgJHhtbGlucHV0CiAgICBDcmVhdGVBcHBNYW5hZ2VtZW50U2VydmljZUFwcCAkeG1saW5wdXQKICAgIENyZWF0ZUJ1c2luZXNzRGF0YUNvbm5lY3Rpdml0eVNlcnZpY2VBcHAgJHhtbGlucHV0ICAgCiAgICBDcmVhdGVNYWNoaW5lVHJhbnNsYXRpb25TZXJ2aWNlQXBwICR4bWxpbnB1dAogICAgQ3JlYXRlTWV0YWRhdGFTZXJ2aWNlQXBwICR4bWxpbnB1dAogICAgQ3JlYXRlUGVyZm9ybWFuY2VQb2ludFNlcnZpY2VBcHAgJHhtbGlucHV0CiAgICBDcmVhdGVFbnRlcnByaXNlU2VhcmNoU2VydmljZUFwcCAkeG1saW5wdXQKCiAgICBDcmVhdGVVc2VyUHJvZmlsZVNlcnZpY2VBcHBsaWNhdGlvbl9NV1NBVVMgJHhtbGlucHV0CiAgICBDcmVhdGVWaXNpb1NlcnZpY2VBcHAgJHhtbGlucHV0CiAgICBDcmVhdGVXb3JkQXV0b21hdGlvblNlcnZpY2VBcHAgJHhtbGlucHV0CgogICAgQ3JlYXRlU3Vic2NyaXB0aW9uU2V0dGluZ3NTZXJ2aWNlQXBwICR4bWxpbnB1dCAgIAogICAgQ3JlYXRlUG93ZXJQb2ludENvbnZlcnNpb25TZXJ2aWNlQXBwICR4bWxpbnB1dAoKICAgIENyZWF0ZVNQVXNhZ2VBcHAgJHhtbGlucHV0CiAgICBDb25maWd1cmVVc2FnZUxvZ2dpbmcgJHhtbGlucHV0CiAgICBDcmVhdGVXZWJBbmFseXRpY3NBcHAgJHhtbGlucHV0CiAgICBDb25maWd1cmVUcmFjaW5nICR4bWxpbnB1dAogICAgQ29uZmlndXJlT3V0Z29pbmdFbWFpbCAkeG1saW5wdXQgIAoKICAgICMgTWluUm9sZXMgdGFrZXMgY2FyZSBvZiB0aGUgc2VydmljZXMKICAgICMgQ3JlYXRlV29ya01hbmFnZW1lbnRTZXJ2aWNlQXBwICR4bWxpbnB1dAogICAgIyBDb25maWd1cmVXb3JrZmxvd1RpbWVyU2VydmljZSAkeG1saW5wdXQKICAgICMgQ3JlYXRlRXhjZWxTZXJ2aWNlQXBwICR4bWxpbnB1dAogICAgIyBDb25maWd1cmVTYW5kYm94ZWRDb2RlU2VydmljZSAkeG1saW5wdXQKICAgICMgQ29uZmlndXJlQ2xhaW1zVG9XaW5kb3dzVG9rZW5TZXJ2aWNlICR4bWxpbnB1dAogICAgIyBDb25maWd1cmVGb3VuZGF0aW9uU2VhcmNoICR4bWxpbnB1dAoJIyBDb25maWd1cmVEaXN0cmlidXRlZENhY2hlU2VydmljZSAkeG1saW5wdXQKICAgICMgSW5zdGFsbFNNVFAgJHhtbGlucHV0CiAgICAjIENvbmZpZ3VyZUluY29taW5nRW1haWwgJHhtbGlucHV0CiAgICAjIENvbmZpZ3VyZUZvdW5kYXRpb25XZWJBcHBsaWNhdGlvblNlcnZpY2UgJHhtbGlucHV0CgogICAgIyBOT1QgVEVTVEVELCBOT1QgU1VQUE9SVEVECiAgICAjIENvbmZpZ3VyZS1QREZTZWFyY2hBbmRJY29uICR4bWxpbnB1dAogICAgIyBJbnN0YWxsRm9yZUZyb250ICR4bWxpbnB1dAogICAgIyBDcmVhdGVQcm9qZWN0U2VydmVyU2VydmljZUFwcCAkeG1saW5wdXQKICB9CiNFbmRSZWdpb24KCiNSZWdpb24gRmluYWxpemUgSW5zdGFsbCAocGVyZm9ybSBhbnkgY2xlYW51cCBvcGVyYXRpb25zKQojIFJ1biBsYXN0CkZ1bmN0aW9uIEZpbmFsaXplLUluc3RhbGwKewogICAgIyBQZXJmb3JtIHRoZXNlIHN0ZXBzIG9ubHkgaWYgdGhlIGxvY2FsIHNlcnZlciBpcyBhIFNoYXJlUG9pbnQgZmFybSBzZXJ2ZXIKICAgIElmIChNYXRjaENvbXB1dGVyTmFtZSAkZmFybVNlcnZlcnMgJGVudjpDT01QVVRFUk5BTUUpCiAgICB7CiAgICAgICAgIyBSZW1vdmUgRmFybSBBY2NvdW50IGZyb20gbG9jYWwgQWRtaW5pc3RyYXRvcnMgZ3JvdXAgdG8gYXZvaWQgYmlnIHNjYXJ5IHdhcm5pbmdzIGluIENlbnRyYWwgQWRtaW4KICAgICAgICAjIEJ1dCBvbmx5IGlmIHRoZSBzY3JpcHQgYWN0dWFsbHkgcHV0IGl0IHRoZXJlLCBhbmQgd2Ugd2FudCB0byBsZWF2ZSBpdCB0aGVyZQogICAgICAgICMgKGUuZy4gdG8gd29yayBhcm91bmQgdGhlIGlzc3VlIHdpdGggbmF0aXZlIFNoYXJlUG9pbnQgYmFja3VwcyBkZXByb3Zpc2lvbmluZyBVUFMgcGVyIGh0dHA6Ly93d3cudG9kZGtsaW5kdC5jb20vYmxvZy9MaXN0cy9Qb3N0cy9Qb3N0LmFzcHg/SUQ9Mjc1KQogICAgICAgICRmYXJtQWNjdCA9ICR4bWxpbnB1dC5Db25maWd1cmF0aW9uLkZhcm0uQWNjb3VudC5Vc2VybmFtZQogICAgICAgIElmICghKCRydW5uaW5nQXNGYXJtQWNjdCkgLWFuZCAoJHhtbGlucHV0LkNvbmZpZ3VyYXRpb24uRmFybS5BY2NvdW50LmdldEF0dHJpYnV0ZSgiQWRkVG9Mb2NhbEFkbWluc0R1cmluZ1NldHVwIikgLWVxICR0cnVlKSAtYW5kICgkeG1saW5wdXQuQ29uZmlndXJhdGlvbi5GYXJtLkFjY291bnQuTGVhdmVJbkxvY2FsQWRtaW5zIC1lcSAkZmFsc2UpKQogICAgICAgIHsKICAgICAgICAgICAgJGJ1aWx0aW5BZG1pbkdyb3VwID0gR2V0LUFkbWluaXN0cmF0b3JzR3JvdXAKICAgICAgICAgICAgbG9nICIgLSBSZW1vdmluZyAkZmFybUFjY3QgZnJvbSBsb2NhbCBncm91cCBgIiRidWlsdGluQWRtaW5Hcm91cGAiLi4uIgogICAgICAgICAgICAkZmFybUFjY3REb21haW4sJGZhcm1BY2N0VXNlciA9ICRmYXJtQWNjdCAtU3BsaXQgIlxcIgogICAgICAgICAgICB0cnkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgKFtBRFNJXSJXaW5OVDovLyRlbnY6Q09NUFVURVJOQU1FLyRidWlsdGluQWRtaW5Hcm91cCxncm91cCIpLlJlbW92ZSgiV2luTlQ6Ly8kZmFybUFjY3REb21haW4vJGZhcm1BY2N0VXNlciIpCiAgICAgICAgICAgICAgICBJZiAoLW5vdCAkPykge3Rocm93fQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHtsb2cgIiAtICRmYXJtQWNjdCBhbHJlYWR5IHJlbW92ZWQgZnJvbSBgIiRidWlsdGluQWRtaW5Hcm91cC5gIiJ9CgogICAgICAgICAgICAjIFJlc3RhcnQgU1BUaW1lclY0IHNvIGl0IGNhbiBub3cgcnVuIHVuZGVyIG5vbi1sb2NhbCBBZG1pbiBwcml2aWxlZ2VzIGFuZCBhdm9pZCBIZWFsdGggQW5hbHl6ZXIgd2FybmluZwogICAgICAgICAgICBsb2cgIiAtIFJlc3RhcnRpbmcgU2hhcmVQb2ludCBUaW1lciBTZXJ2aWNlLi4uIgogICAgICAgICAgICBSZXN0YXJ0LVNlcnZpY2UgU1BUaW1lclY0CiAgICAgICAgfQogICAgICAgIEVsc2UKICAgICAgICB7CiAgICAgICAgICAgIGxvZyAiIC0gTm90IGNoYW5naW5nIGxvY2FsIEFkbWluIG1lbWJlcnNoaXAgb2YgJGZhcm1BY2N0LiIKICAgICAgICB9CgogICAgICAgIGxvZyAiIC0gQWRkaW5nIE5ldHdvcmsgU2VydmljZSB0byBsb2NhbCBXU1NfV1BHIGdyb3VwIChmaXhlcyBldmVudCBsb2cgd2FybmluZ3MpLi4uIgogICAgICAgIFRyeQogICAgICAgIHsKICAgICAgICAgICAgKFtBRFNJXSJXaW5OVDovLyRlbnY6Q09NUFVURVJOQU1FL1dTU19XUEcsZ3JvdXAiKS5BZGQoIldpbk5UOi8vTkVUV09SSyBTRVJWSUNFIikKICAgICAgICAgICAgSWYgKC1ub3QgJD8pIHtUaHJvd30KICAgICAgICB9CiAgICAgICAgQ2F0Y2gge2xvZyAiIC0gTmV0d29yayBTZXJ2aWNlIGlzIGFscmVhZHkgYSBtZW1iZXIuIn0KICAgICAgICBSdW4tSGVhbHRoQW5hbHl6ZXJKb2JzCiAgICB9CgogICAgbG9nICIgLSBDb21wbGV0ZWQhYGEiCiAgICAkSG9zdC5VSS5SYXdVSS5XaW5kb3dUaXRsZSA9ICIgLS0gQ29tcGxldGVkIC0tICRlbnY6Q09NUFVURVJOQU1FIC0tIgogICAgJGVudjpFbmREYXRlID0gR2V0LURhdGUKfQojRW5kUmVnaW9uCg==
