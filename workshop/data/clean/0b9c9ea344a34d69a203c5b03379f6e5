MicrosoftAzure_xSqlServer.psm1,3dbb69274304a83988890466e46c641a,Scan result is 1. IsMalware: 0,IwojIHhTUUxTZXJ2ZXI6IERTQyByZXNvdXJjZSB0byBjb25maWd1cmUgYSBTUUwgU2VydmVyLiBUaGlzIHJlc291cmNlIHN1cHBvcnRzCiMgICBjb25maWd1cmF0aW9uIG9mIHRoZSBTUUwgU2VydmVyIHNlcnZpY2UgYWNjb3VudCwgZGF0YWJhc2UgYW5kIGxvZyBmb2xkZXJzLAojICAgYW5kIE1BWERPUC4gVGhpcyByZXNvdXJjZSBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIHRvIGNvbmZpZ3VyZSBhIFNRTCBTZXJ2ZXIKIyAgIGluc3RhbmNlIGZvciB1c2Ugd2l0aCBTaGFyZVBvaW50LgojCgpmdW5jdGlvbiBHZXQtVGFyZ2V0UmVzb3VyY2UKewogICAgcGFyYW0KICAgICgKICAgICAgICBbcGFyYW1ldGVyKE1hbmRhdG9yeSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbc3RyaW5nXSAkSW5zdGFuY2VOYW1lLAoKICAgICAgICBbcGFyYW1ldGVyKE1hbmRhdG9yeSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbUFNDcmVkZW50aWFsXSAkU3FsQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1BTQ3JlZGVudGlhbF0gJFNlcnZpY2VDcmVkZW50aWFsLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddICRMb2dpbk1vZGUsCgogICAgICAgIFtWYWxpZGF0ZVNldCgiRW5hYmxlZCIsICJEaXNhYmxlZCIpXQogICAgICAgIFtTdHJpbmddICRIYWRyLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgwLCAzMjc2NyldCiAgICAgICAgW3VpbnQzMl0gJE1heERlZ3JlZU9mUGFyYWxsZWxpc20sCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10gJEZpbGVQYXRoLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddICRMb2dQYXRoLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtQU0NyZWRlbnRpYWxdICREb21haW5BZG1pbmlzdHJhdG9yQ3JlZGVudGlhbCwKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbQm9vbF0gJEVuYWJsZVRjcElwID0gJGZhbHNlCiAgICApCgogICAgJHMgPSBHZXQtU3FsU2VydmVyIC1JbnN0YW5jZU5hbWUgJEluc3RhbmNlTmFtZSAtQ3JlZGVudGlhbCAkU3FsQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwKCiAgICAkc2VydmljZUFjY291bnQgPSBHZXQtU2VydmljZUFjY291bnQgLUluc3RhbmNlTmFtZSAkSW5zdGFuY2VOYW1lIC1TZXJ2ZXIgJHMKCiAgICAkcmV0dmFsID0gQHsKICAgICAgICBJbnN0YW5jZU5hbWUgPSAkSW5zdGFuY2VOYW1lCiAgICAgICAgU3FsQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwgPSAkU3FsQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwuVXNlck5hbWUKICAgICAgICBTZXJ2aWNlQ3JlZGVudGlhbCA9IE5ldy1PYmplY3QgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWwgKCRzZXJ2aWNlQWNjb3VudCwgKE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlNlY3VyZVN0cmluZykpCiAgICAgICAgTG9naW5Nb2RlID0gJHMuU2V0dGluZ3MuTG9naW5Nb2RlCiAgICAgICAgSGFkciA9IGlmICgkcy5Jc0hhZHJFbmFibGVkKSB7ICJFbmFibGVkIiB9IGVsc2UgeyAiRGlzYWJsZWQiIH0KICAgICAgICBNYXhEZWdyZWVPZlBhcmFsbGVsaXNtID0gJHMuQ29uZmlndXJhdGlvbi5NYXhEZWdyZWVPZlBhcmFsbGVsaXNtLkNvbmZpZ1ZhbHVlCiAgICAgICAgRmlsZVBhdGggPSAkcy5EZWZhdWx0RmlsZQogICAgICAgIExvZ1BhdGggPSAkcy5EZWZhdWx0TG9nCiAgICAgICAgRG9tYWluQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwgPSAkRG9tYWluQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwuVXNlck5hbWUKICAgICAgICBFbmFibGVUY3BJcCA9ICRFbmFibGVUY3BJcAogICAgfQoKICAgICRyZXR2YWwKfQoKZnVuY3Rpb24gU2V0LVRhcmdldFJlc291cmNlCnsKICAgIHBhcmFtCiAgICAoCiAgICAgICAgW3BhcmFtZXRlcihNYW5kYXRvcnkpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW3N0cmluZ10gJEluc3RhbmNlTmFtZSwKCiAgICAgICAgW3BhcmFtZXRlcihNYW5kYXRvcnkpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1BTQ3JlZGVudGlhbF0gJFNxbEFkbWluaXN0cmF0b3JDcmVkZW50aWFsLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtQU0NyZWRlbnRpYWxdICRTZXJ2aWNlQ3JlZGVudGlhbCwKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXSAkTG9naW5Nb2RlLAoKICAgICAgICBbVmFsaWRhdGVTZXQoIkVuYWJsZWQiLCAiRGlzYWJsZWQiKV0KICAgICAgICBbU3RyaW5nXSAkSGFkciwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMCwgMzI3NjcpXQogICAgICAgIFtpbnRdICRNYXhEZWdyZWVPZlBhcmFsbGVsaXNtLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddICRGaWxlUGF0aCwKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXSAkTG9nUGF0aCwKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbUFNDcmVkZW50aWFsXSAkRG9tYWluQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW0Jvb2xdICRFbmFibGVUY3BJcCA9ICRmYWxzZQogICAgKQoKICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIkNvbmZpZ3VyaW5nIFNRTCBTZXJ2ZXIgaW5zdGFuY2UgJyQoJEluc3RhbmNlTmFtZSknIC4uLiIKCiAgICBTdGFydC1TcWxTZXJ2ZXIgLUluc3RhbmNlTmFtZSAkSW5zdGFuY2VOYW1lCgogICAgJHMgPSBHZXQtU3FsU2VydmVyIC1JbnN0YW5jZU5hbWUgJEluc3RhbmNlTmFtZSAtQ3JlZGVudGlhbCAkU3FsQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwKCiAgICBpZiAoJEVuYWJsZVRjcElwKXsKICAgICAgICAjRW5hYmxlLVRjcElQCiAgICAgICAgRW5hYmxlLVRjcElQIC1TZXJ2ZXIgJHMKICAgIH0KCiAgICBpZiAoJFNlcnZpY2VDcmVkZW50aWFsKQogICAgewogICAgICAgICRiQ2hlY2sgPSBJc1NRTExvZ2luIC1Mb2dpbiAkU2VydmljZUNyZWRlbnRpYWwgLVNlcnZlciAkcwogICAgICAgIGlmICghJGJDaGVjaykKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIkNyZWF0aW5nIGxvZ2luIGZvciAnJCgkU2VydmljZUNyZWRlbnRpYWwuVXNlck5hbWUpJyAuLi4iCiAgICAgICAgICAgICRsb2dpbiA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIE1pY3Jvc29mdC5TcWxTZXJ2ZXIuTWFuYWdlbWVudC5TbW8uTG9naW4gLUFyZ3VtZW50TGlzdCAkcywgJFNlcnZpY2VDcmVkZW50aWFsLlVzZXJOYW1lCiAgICAgICAgICAgICRsb2dpbi5Mb2dpblR5cGUgPSBbTWljcm9zb2Z0LlNxbFNlcnZlci5NYW5hZ2VtZW50LlNtby5Mb2dpblR5cGVdOjpXaW5kb3dzVXNlcgogICAgICAgICAgICAkbG9naW4uUGFzc3dvcmRFeHBpcmF0aW9uRW5hYmxlZCA9ICRmYWxzZQogICAgICAgICAgICAkbG9naW4uQ3JlYXRlKCRTZXJ2aWNlQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLlNlY3VyZVBhc3N3b3JkKQogICAgICAgIH0KCiAgICAgICAgJGJDaGVjayA9IElzU3lzQWRtaW4gLUxvZ2luICRTZXJ2aWNlQ3JlZGVudGlhbCAtU2VydmVyICRzCiAgICAgICAgaWYgKCEkYkNoZWNrKQogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAiQWRkaW5nIGxvZ2luICckKCRTZXJ2aWNlQ3JlZGVudGlhbC5Vc2VyTmFtZSknIHRvICdzeXNhZG1pbicgc2VydmVyIHJvbGUgLi4uIgogICAgICAgICAgICAkcm9sZSA9ICRzLlJvbGVzIHwgd2hlcmUgeyAkXy5OYW1lIC1lcSAic3lzYWRtaW4iIH0KICAgICAgICAgICAgJHJvbGUuQWRkTWVtYmVyKCRTZXJ2aWNlQ3JlZGVudGlhbC5Vc2VyTmFtZSkKICAgICAgICB9CgogICAgICAgIFVwZGF0ZS1TcG5QZXJtaXNzaW9ucyAtU2VydmljZUNyZWRlbnRpYWwgJFNlcnZpY2VDcmVkZW50aWFsIC1Eb21haW5BZG1pbmlzdHJhdG9yQ3JlZGVudGlhbCAkRG9tYWluQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwKCiAgICAgICAgR3JhbnQtTG9nb25Bc0FTZXJ2aWNlUmlnaHQgLVNlcnZpY2VDcmVkZW50aWFsICRTZXJ2aWNlQ3JlZGVudGlhbCAtRG9tYWluQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwgJERvbWFpbkFkbWluaXN0cmF0b3JDcmVkZW50aWFsCgogICAgICAgIFNldC1TZXJ2aWNlQWNjb3VudCAtQ3JlZGVudGlhbCAkU2VydmljZUNyZWRlbnRpYWwgLUluc3RhbmNlTmFtZSAkSW5zdGFuY2VOYW1lIC1TZXJ2ZXIgJHMKICAgIH0KCiAgICAkc3lzdGVtQ3JlZGVudGlhbCA9IE5ldy1PYmplY3QgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWwgKCJOVCBBVVRIT1JJVFlcU1lTVEVNIiwgKE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlNlY3VyZVN0cmluZykpCiAgICAkYkNoZWNrID0gSXNTUUxMb2dpbiAtTG9naW4gJHN5c3RlbUNyZWRlbnRpYWwgLVNlcnZlciAkcwogICAgaWYgKCEkYkNoZWNrKQogICAgewogICAgICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIkNyZWF0aW5nIGxvZ2luIGZvciAnJCgkc3lzdGVtQ3JlZGVudGlhbC5Vc2VyTmFtZSknIC4uLiIKICAgICAgICAkbG9naW4gPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBNaWNyb3NvZnQuU3FsU2VydmVyLk1hbmFnZW1lbnQuU21vLkxvZ2luIC1Bcmd1bWVudExpc3QgJHMsICRzeXN0ZW1DcmVkZW50aWFsLlVzZXJOYW1lCiAgICAgICAgJGxvZ2luLkxvZ2luVHlwZSA9IFtNaWNyb3NvZnQuU3FsU2VydmVyLk1hbmFnZW1lbnQuU21vLkxvZ2luVHlwZV06OldpbmRvd3NVc2VyCiAgICAgICAgJGxvZ2luLlBhc3N3b3JkRXhwaXJhdGlvbkVuYWJsZWQgPSAkZmFsc2UKICAgICAgICAkbG9naW4uQ3JlYXRlKCRzeXN0ZW1DcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuU2VjdXJlUGFzc3dvcmQpCiAgICB9CgogICAgJGJDaGVjayA9IElzU3lzQWRtaW4gLUxvZ2luICRzeXN0ZW1DcmVkZW50aWFsIC1TZXJ2ZXIgJHMKICAgIGlmICghJGJDaGVjaykKICAgIHsKICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICJBZGRpbmcgbG9naW4gJyQoJHN5c3RlbUNyZWRlbnRpYWwuVXNlck5hbWUpJyB0byAnc3lzYWRtaW4nIHNlcnZlciByb2xlIC4uLiIKICAgICAgICAkcm9sZSA9ICRzLlJvbGVzIHwgd2hlcmUgeyAkXy5OYW1lIC1lcSAic3lzYWRtaW4iIH0KICAgICAgICAkcm9sZS5BZGRNZW1iZXIoJHN5c3RlbUNyZWRlbnRpYWwuVXNlck5hbWUpCiAgICB9CgogICAgJHNwcyA9IE5ldy1PYmplY3QgTWljcm9zb2Z0LlNxbFNlcnZlci5NYW5hZ2VtZW50LlNtby5TZXJ2ZXJQZXJtaXNzaW9uU2V0CiAgICAkc3BzLkFkZChbTWljcm9zb2Z0LlNxbFNlcnZlci5NYW5hZ2VtZW50LlNtby5TZXJ2ZXJQZXJtaXNzaW9uXTo6QWx0ZXJBbnlBdmFpbGFiaWxpdHlHcm91cCkgfCBPdXQtTnVsbAogICAgJHNwcy5BZGQoW01pY3Jvc29mdC5TcWxTZXJ2ZXIuTWFuYWdlbWVudC5TbW8uU2VydmVyUGVybWlzc2lvbl06OkNvbm5lY3RTcWwpIHwgT3V0LU51bGwKICAgICRzcHMuQWRkKFtNaWNyb3NvZnQuU3FsU2VydmVyLk1hbmFnZW1lbnQuU21vLlNlcnZlclBlcm1pc3Npb25dOjpWaWV3U2VydmVyU3RhdGUpIHwgT3V0LU51bGwKICAgICRzcGlzID0gJHMuRW51bVNlcnZlclBlcm1pc3Npb25zKCRzeXN0ZW1DcmVkZW50aWFsLlVzZXJOYW1lLCAkc3BzKQogICAgaWYgKCRzcGlzLkNvdW50IC1uZSAzKQogICAgewogICAgICAgICMgVGhlc2UgcGVybWlzc2lvbnMgYXJlIHJlcXVpcmVkIHBlciBodHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2xpYnJhcnkvamo4NzA5NjMuYXNweC4KICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICJHcmFudGluZyBwZXJtaXNzaW9ucyB0byAnJCgkc3lzdGVtQ3JlZGVudGlhbC5Vc2VyTmFtZSknIC4uLiIKICAgICAgICAkcGVybXMgPSBOZXctT2JqZWN0IE1pY3Jvc29mdC5TcWxTZXJ2ZXIuTWFuYWdlbWVudC5TbW8uU2VydmVyUGVybWlzc2lvblNldAogICAgICAgICRwZXJtcy5BbHRlckFueUF2YWlsYWJpbGl0eUdyb3VwID0gJHRydWUKICAgICAgICAkcGVybXMuQ29ubmVjdFNxbCA9ICR0cnVlCiAgICAgICAgJHBlcm1zLlZpZXdTZXJ2ZXJTdGF0ZSA9ICR0cnVlCiAgICAgICAgJHMuR3JhbnQoJHBlcm1zLCAkc3lzdGVtQ3JlZGVudGlhbC5Vc2VyTmFtZSkKICAgIH0KCiAgICAkYkNoZWNrID0gJHMuTG9naW5Nb2RlIC1lcSAkTG9naW5Nb2RlCiAgICBpZiAoJExvZ2luTW9kZSAtYW5kICEkYkNoZWNrKQogICAgewogICAgICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIlNldHRpbmcgbG9naW4gbW9kZSB0byAnJCgkTG9naW5Nb2RlKScgLi4uIgogICAgICAgICRzLlNldHRpbmdzLkxvZ2luTW9kZSA9ICRMb2dpbk1vZGUKICAgICAgICAkcy5TZXR0aW5ncy5BbHRlcigpCiAgICAgICAgJGJSZXN0YXJ0UmVxdWlyZWQgPSAkdHJ1ZQogICAgfQoKICAgICRiQ2hlY2sgPSAkcy5Db25maWd1cmF0aW9uLk1heERlZ3JlZU9mUGFyYWxsZWxpc20uQ29uZmlnVmFsdWUgLWVxICRNYXhEZWdyZWVPZlBhcmFsbGVsaXNtCiAgICBpZiAoJE1heERlZ3JlZU9mUGFyYWxsZWxpc20gLWFuZCAhJGJDaGVjaykKICAgIHsKICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICJTZXR0aW5nICdtYXggZGVncmVlIG9mIHBhcmFsbGVsaXNtJyB0byAnJCgkTWF4RGVncmVlT2ZQYXJhbGxlbGlzbSknIC4uLiIKICAgICAgICAkcy5Db25maWd1cmF0aW9uLk1heERlZ3JlZU9mUGFyYWxsZWxpc20uQ29uZmlnVmFsdWUgPSAkTWF4RGVncmVlT2ZQYXJhbGxlbGlzbQogICAgICAgICRzLkNvbmZpZ3VyYXRpb24uQWx0ZXIoKQogICAgICAgICRiUmVzdGFydFJlcXVpcmVkID0gJHRydWUKICAgIH0KCiAgICBpZiAoJEhhZHIpCiAgICB7CiAgICAgICAgIyBOb3JtYWxpemUgdGhlIGluc3RhbmNlIG5hbWUuCiAgICAgICAgaWYgKCRJbnN0YW5jZU5hbWUuY29udGFpbnMoIlwiKSkKCXsKCSAgICAkbGlzdCA9ICRJbnN0YW5jZU5hbWUuU3BsaXQoIlwiKQoJfSBlbHNlaWYgKCRJbnN0YW5jZU5hbWUuY29udGFpbnMoIiwiKSkKCXsKCSAgICAkbGlzdCA9ICRJbnN0YW5jZU5hbWUuU3BsaXQoIiwiKQoJfSBlbHNlCgl7CgkgICAgJGxpc3QgPSAkSW5zdGFuY2VOYW1lCgl9CgogICAgICAgIGlmICgkbGlzdC5Db3VudCAtZ3QgMSAtYW5kICRsaXN0WzFdIC1lcSAiTVNTUUxTRVJWRVIiKQogICAgICAgIHsKICAgICAgICAgICAgJHNlcnZlckluc3RhbmNlID0gJGxpc3RbMF0KICAgICAgICAgICAgJGNvbXB1dGVyTmFtZT0gJGxpc3RbMF0KICAgICAgICAgICAgJGluc3RhbmNlTmFtZT0iTVNTUUxTRVJWRVIiCiAgICAgICAgfSBlbHNlCiAgICAgICAgewogICAgICAgICAgICAkc2VydmVySW5zdGFuY2UgPSAkSW5zdGFuY2VOYW1lCiAgICAgICAgICAgIGlmICgkbGlzdC5Db3VudCAtZ3QgMSApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRjb21wdXRlck5hbWU9ICRsaXN0WzBdCiAgICAgICAgICAgICAgICAkaW5zdGFuY2VOYW1lPSJNU1NRTFNFUlZFUiIKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRjb21wdXRlck5hbWU9ICRsaXN0CiAgICAgICAgICAgICAgICAkaW5zdGFuY2VOYW1lPSJNU1NRTFNFUlZFUiIKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCRpbnN0YW5jZU5hbWUgLWVxICJNU1NRTFNFUlZFUiIpCiAgICAgICAgewogICAgICAgICAgICAkcGF0aD0iU1FMU0VSVkVSOlxTUUxcJHtjb21wdXRlck5hbWV9XERlZmF1bHQiCiAgICAgICAgfSBlbHNlCiAgICAgICAgewogICAgICAgICAgICAkcGF0aD0iU1FMU0VSVkVSOlxTUUxcJHtjb21wdXRlck5hbWV9XCR7aW5zdGFuY2VOYW1lfSIKICAgICAgICB9CgogICAgICAgIGlmICgkY29tcHV0ZXJOYW1lIC1lcSAkZW52OkNPTVBVVEVSTkFNRSkKICAgICAgICB7CiAgICAgICAgICAgIFNldC1IQURSIC1QYXRoICRwYXRoIC1IYWRyICRIYWRyCiAgICAgICAgfSAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgSW52b2tlLUNvbW1hbmQgLVNjcmlwdEJsb2NrICR7RnVuY3Rpb246U2V0LUhBRFJ9IC1Db21wdXRlck5hbWUgJGNvbXB1dGVyTmFtZSAtQ3JlZGVudGlhbCAkRG9tYWluQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwgLUFyZ3VtZW50TGlzdCAkcGF0aCwkSGFkcgogICAgICAgIH0KCiAgICB9CgoKICAgIGlmICgkRmlsZVBhdGgpCiAgICB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAiQ2hhbmdpbmcgdGhlIFNRTCBkZWZhdWx0IGZpbGUgcGF0aCB0byAnJCgkRmlsZVBhdGgpJyAuLi4iCiAgICAgICAgI05ldy1JdGVtIC1JdGVtVHlwZSBEaXJlY3RvcnkgLVBhdGggJEZpbGVQYXRoIC1Gb3JjZQogICAgICAgIFtTeXN0ZW0uSU8uRGlyZWN0b3J5XTo6Q3JlYXRlRGlyZWN0b3J5KCRGaWxlUGF0aCkgfCBPdXQtTnVsbAogICAgICAgICRzLlNldHRpbmdzLkRlZmF1bHRGaWxlID0gJEZpbGVQYXRoCiAgICAgICAgJHMuU2V0dGluZ3MuQWx0ZXIoKQogICAgICAgICRiUmVzdGFydFJlcXVpcmVkID0gJHRydWUKICAgIH0KCgogICAgaWYgKCRMb2dQYXRoKQogICAgewogICAgICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIkNoYW5naW5nIHRoZSBTUUwgZGVmYXVsdCBsb2cgcGF0aCB0byAnJCgkTG9nUGF0aCknIC4uLiIKICAgICAgICAjTmV3LUl0ZW0gLUl0ZW1UeXBlIERpcmVjdG9yeSAtUGF0aCAkTG9nUGF0aCAtRm9yY2UKICAgICAgICBbU3lzdGVtLklPLkRpcmVjdG9yeV06OkNyZWF0ZURpcmVjdG9yeSgkTG9nUGF0aCkgfCBPdXQtTnVsbAogICAgICAgICRzLlNldHRpbmdzLkRlZmF1bHRMb2cgPSAkTG9nUGF0aAogICAgICAgICRzLlNldHRpbmdzLkFsdGVyKCkKICAgICAgICAkYlJlc3RhcnRSZXF1aXJlZCA9ICR0cnVlCiAgICB9CgogICAgaWYgKCRMb2dQYXRoIC1hbmQgJEZpbGVQYXRoKQogICAgewoKICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICJBbHRlcmluZyBtYXN0ZXIgc3lzdGVtIGRhdGFiYXNlIGxvY2F0aW9uIHNldHRpbmcgdG8gJEZpbGVQYXRoXG1hc3Rlci5tZGYgLCAkTG9nUGF0aFxFUlJPUkxPRyBhbmQgJExvZ1BhdGhcbWFzdGxvZy5sZGYiCgkKCWlmICghW1N5c3RlbS5JTy5GaWxlXTo6RXhpc3RzKCIkKCRGaWxlUGF0aClcbWFzdGVyLm1kZiIpKSAKCXsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICAoW1N5c3RlbS5JTy5EaXJlY3RvcnldOjpFeGlzdHMoIkM6XFByb2dyYW0gRmlsZXNcTWljcm9zb2Z0IFNRTCBTZXJ2ZXJcTVNTUUwxMi5NU1NRTFNFUlZFUlxNU1NRTFxEQVRBXCIpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBTZXQtSXRlbVByb3BlcnR5IC1QYXRoICJIS0xNOlxTT0ZUV0FSRVxNaWNyb3NvZnRcTWljcm9zb2Z0IFNRTCBTZXJ2ZXJcTVNTUUwxMi5NU1NRTFNFUlZFUlxNU1NRTFNlcnZlclxQYXJhbWV0ZXJzIiAtTmFtZSBTUUxBcmcwIC1WYWx1ZSAiLWRGOlxEQVRBXG1hc3Rlci5tZGYiCiAgICAgICAgICAgICAgICBTZXQtSXRlbVByb3BlcnR5IC1QYXRoICJIS0xNOlxTT0ZUV0FSRVxNaWNyb3NvZnRcTWljcm9zb2Z0IFNRTCBTZXJ2ZXJcTVNTUUwxMi5NU1NRTFNFUlZFUlxNU1NRTFNlcnZlclxQYXJhbWV0ZXJzIiAtTmFtZSBTUUxBcmcxIC1WYWx1ZSAiLWVGOlxMT0dcRVJST1JMT0ciCiAgICAgICAgICAgICAgICBTZXQtSXRlbVByb3BlcnR5IC1QYXRoICJIS0xNOlxTT0ZUV0FSRVxNaWNyb3NvZnRcTWljcm9zb2Z0IFNRTCBTZXJ2ZXJcTVNTUUwxMi5NU1NRTFNFUlZFUlxNU1NRTFNlcnZlclxQYXJhbWV0ZXJzIiAtTmFtZSBTUUxBcmcyIC1WYWx1ZSAiLWxGOlxMT0dcbWFzdGxvZy5sZGYiCiAgICAgICAgICAgIH0gZWxzZWlmIChbU3lzdGVtLklPLkRpcmVjdG9yeV06OkV4aXN0cygiQzpcUHJvZ3JhbSBGaWxlc1xNaWNyb3NvZnQgU1FMIFNlcnZlclxNU1NRTDEzLk1TU1FMU0VSVkVSXE1TU1FMXERBVEFcIikpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFNldC1JdGVtUHJvcGVydHkgLVBhdGggIkhLTE06XFNPRlRXQVJFXE1pY3Jvc29mdFxNaWNyb3NvZnQgU1FMIFNlcnZlclxNU1NRTDEzLk1TU1FMU0VSVkVSXE1TU1FMU2VydmVyXFBhcmFtZXRlcnMiIC1OYW1lIFNRTEFyZzAgLVZhbHVlICItZEY6XERBVEFcbWFzdGVyLm1kZiIKICAgICAgICAgICAgICAgIFNldC1JdGVtUHJvcGVydHkgLVBhdGggIkhLTE06XFNPRlRXQVJFXE1pY3Jvc29mdFxNaWNyb3NvZnQgU1FMIFNlcnZlclxNU1NRTDEzLk1TU1FMU0VSVkVSXE1TU1FMU2VydmVyXFBhcmFtZXRlcnMiIC1OYW1lIFNRTEFyZzEgLVZhbHVlICItZUY6XExPR1xFUlJPUkxPRyIKICAgICAgICAgICAgICAgIFNldC1JdGVtUHJvcGVydHkgLVBhdGggIkhLTE06XFNPRlRXQVJFXE1pY3Jvc29mdFxNaWNyb3NvZnQgU1FMIFNlcnZlclxNU1NRTDEzLk1TU1FMU0VSVkVSXE1TU1FMU2VydmVyXFBhcmFtZXRlcnMiIC1OYW1lIFNRTEFyZzIgLVZhbHVlICItbEY6XExPR1xtYXN0bG9nLmxkZiIKICAgICAgICAgICAgfSBlbHNlaWYgKFtTeXN0ZW0uSU8uRGlyZWN0b3J5XTo6RXhpc3RzKCJDOlxQcm9ncmFtIEZpbGVzXE1pY3Jvc29mdCBTUUwgU2VydmVyXE1TU1FMMTEuTVNTUUxTRVJWRVJcTVNTUUxcREFUQVwiKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiSEtMTTpcU09GVFdBUkVcTWljcm9zb2Z0XE1pY3Jvc29mdCBTUUwgU2VydmVyXE1TU1FMMTEuTVNTUUxTRVJWRVJcTVNTUUxTZXJ2ZXJcUGFyYW1ldGVycyIgLU5hbWUgU1FMQXJnMCAtVmFsdWUgIi1kRjpcREFUQVxtYXN0ZXIubWRmIgogICAgICAgICAgICAgICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiSEtMTTpcU09GVFdBUkVcTWljcm9zb2Z0XE1pY3Jvc29mdCBTUUwgU2VydmVyXE1TU1FMMTEuTVNTUUxTRVJWRVJcTVNTUUxTZXJ2ZXJcUGFyYW1ldGVycyIgLU5hbWUgU1FMQXJnMSAtVmFsdWUgIi1lRjpcTE9HXEVSUk9STE9HIgogICAgICAgICAgICAgICAgU2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiSEtMTTpcU09GVFdBUkVcTWljcm9zb2Z0XE1pY3Jvc29mdCBTUUwgU2VydmVyXE1TU1FMMTEuTVNTUUxTRVJWRVJcTVNTUUxTZXJ2ZXJcUGFyYW1ldGVycyIgLU5hbWUgU1FMQXJnMiAtVmFsdWUgIi1sRjpcTE9HXG1hc3Rsb2cubGRmIgogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGhyb3cgICJObyBzeXN0ZW0gZGF0YWJhc2UgZm9sZGVyIGRldGVjdGVkLGV4aXRpbmcgLi4uLiIKICAgICAgICAgICAgfQoKCX0KCiAgICAgICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAiQ2hhbmdpbmcgdGhlIFNRTCBzeXN0ZW0gZGF0YWJhc2UgZGVmYXVsdCBsb2cgcGF0aCB0byAnJCgkTG9nUGF0aCknIC4uLiIKICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICJDaGFuZ2luZyB0aGUgU1FMIHN5c3RlbSBkYXRhYmFzZSBkZWZhdWx0IGZpbGUgcGF0aCB0byAnJCgkRmlsZVBhdGgpJyAuLi4iCgogICAgICAgIEFsdGVyLVN5c3RlbURhdGFiYXNlTG9jYXRpb24gLUZpbGVQYXRoICRGaWxlUGF0aCAtTG9nUGF0aCAkTG9nUGF0aCAtU2VydmljZUNyZWRlbnRpYWwgJFNlcnZpY2VDcmVkZW50aWFsCiAgICAgICAgU3RvcC1TcWxTZXJ2ZXIgLUluc3RhbmNlTmFtZSAkSW5zdGFuY2VOYW1lIC1TZXJ2ZXIgJHMKICAgICAgICBNb3ZlLVN5c3RlbURhdGFiYXNlRmlsZSAtRmlsZVBhdGggJEZpbGVQYXRoIC1Mb2dQYXRoICRMb2dQYXRoCgogICAgICAgIFN0YXJ0LVNxbFNlcnZlciAtSW5zdGFuY2VOYW1lICRJbnN0YW5jZU5hbWUgLVNlcnZlciAkcwogICAgICAgICRiUmVzdGFydFJlcXVpcmVkPSAkZmFsc2UKICAgICAKICAgIH0KCiAgICBpZiAoJGJSZXN0YXJ0UmVxdWlyZWQpCiAgICB7CiAgICAgICAgUmVzdGFydC1TcWxTZXJ2ZXIgLUluc3RhbmNlTmFtZSAkSW5zdGFuY2VOYW1lIC1TZXJ2ZXIgJHMKICAgIH0KfQpmdW5jdGlvbiBUZXN0LVRhcmdldFJlc291cmNlCnsKICAgIHBhcmFtCiAgICAoCiAgICAgICAgW3BhcmFtZXRlcihNYW5kYXRvcnkpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW3N0cmluZ10gJEluc3RhbmNlTmFtZSwKCiAgICAgICAgW3BhcmFtZXRlcihNYW5kYXRvcnkpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1BTQ3JlZGVudGlhbF0gJFNxbEFkbWluaXN0cmF0b3JDcmVkZW50aWFsLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtQU0NyZWRlbnRpYWxdICRTZXJ2aWNlQ3JlZGVudGlhbCwKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXSAkTG9naW5Nb2RlLAoKICAgICAgICBbVmFsaWRhdGVTZXQoIkVuYWJsZWQiLCAiRGlzYWJsZWQiKV0KICAgICAgICBbU3RyaW5nXSAkSGFkciwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMCwgMzI3NjcpXQogICAgICAgIFtpbnRdICRNYXhEZWdyZWVPZlBhcmFsbGVsaXNtLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddICRGaWxlUGF0aCwKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXSAkTG9nUGF0aCwKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbUFNDcmVkZW50aWFsXSAkRG9tYWluQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW0Jvb2xdICRFbmFibGVUY3BJcCA9ICRmYWxzZQogICAgKQoKICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIlRlc3RpbmcgdGhlIFNRTCBTZXJ2ZXIgaW5zdGFuY2UgJyQoJEluc3RhbmNlTmFtZSknIC4uLiIKCiAgICBpZiAoLW5vdCAoU3RhcnQtU3FsU2VydmVyIC1JbnN0YW5jZU5hbWUgJEluc3RhbmNlTmFtZSkpIHsKICAgICAgICByZXR1cm4gJGZhbHNlCiAgICB9CgogICAgJHMgPSBHZXQtU3FsU2VydmVyIC1JbnN0YW5jZU5hbWUgJEluc3RhbmNlTmFtZSAtQ3JlZGVudGlhbCAkU3FsQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwKCgoKICAgIGlmICgkU2VydmljZUNyZWRlbnRpYWwpCiAgICB7CiAgICAgICAgJGJDaGVjayA9IElzU1FMTG9naW4gLUxvZ2luICRTZXJ2aWNlQ3JlZGVudGlhbCAtU2VydmVyICRzCiAgICAgICAgaWYgKCEkYkNoZWNrKQogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAiTG9naW4gZm9yICckKCRTZXJ2aWNlQ3JlZGVudGlhbC5Vc2VyTmFtZSknIGRvZXMgTk9UIGV4aXN0LiIKICAgICAgICAgICAgcmV0dXJuICRmYWxzZQogICAgICAgIH0KCiAgICAgICAgJGJDaGVjayA9IElzU3lzQWRtaW4gLUxvZ2luICRTZXJ2aWNlQ3JlZGVudGlhbCAtU2VydmVyICRzCiAgICAgICAgaWYgKCEkYkNoZWNrKQogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAiTG9naW4gJyQoJFNlcnZpY2VDcmVkZW50aWFsLlVzZXJOYW1lKScgaXMgTk9UIGluICdzeXNhZG1pbicgc2VydmVyIHJvbGUuIgogICAgICAgICAgICByZXR1cm4gJGZhbHNlCiAgICAgICAgfQoKICAgICAgICAkc2VydmljZUFjY291bnQgPSBHZXQtU2VydmljZUFjY291bnQgLUluc3RhbmNlTmFtZSAkSW5zdGFuY2VOYW1lIC1TZXJ2ZXIgJHMKICAgICAgICBpZiAoJHNlcnZpY2VBY2NvdW50IC1uZSAkU2VydmljZUNyZWRlbnRpYWwuVXNlck5hbWUpCiAgICAgICAgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICJTZXJ2aWNlIGFjY291bnQgaXMgTk9UICckKCRTZXJ2aWNlQ3JlZGVudGlhbC5Vc2VyTmFtZSknLiIKICAgICAgICAgICAgcmV0dXJuICRmYWxzZQogICAgICAgIH0KICAgIH0KCiAgICAkc3lzdGVtQ3JlZGVudGlhbCA9IE5ldy1PYmplY3QgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWwgKCJOVCBBVVRIT1JJVFlcU1lTVEVNIiwgKE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlNlY3VyZVN0cmluZykpCiAgICAkYkNoZWNrID0gSXNTUUxMb2dpbiAtTG9naW4gJHN5c3RlbUNyZWRlbnRpYWwgLVNlcnZlciAkcwogICAgaWYgKCEkYkNoZWNrKQogICAgewogICAgICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIkxvZ2luIGZvciAnJCgkc3lzdGVtQ3JlZGVudGlhbC5Vc2VyTmFtZSknIGRvZXMgTk9UIGV4aXN0LiIKICAgICAgICByZXR1cm4gJGZhbHNlCiAgICB9CgogICAgJGJDaGVjayA9IElzU3lzQWRtaW4gLUxvZ2luICRzeXN0ZW1DcmVkZW50aWFsIC1TZXJ2ZXIgJHMKICAgIGlmICghJGJDaGVjaykKICAgIHsKICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICJMb2dpbiAnJCgkc3lzdGVtQ3JlZGVudGlhbC5Vc2VyTmFtZSknIGlzIE5PVCBpbiAnc3lzYWRtaW4nIHNlcnZlciByb2xlLiIKICAgICAgICByZXR1cm4gJGZhbHNlCiAgICB9CgogICAgJHNwcyA9IE5ldy1PYmplY3QgTWljcm9zb2Z0LlNxbFNlcnZlci5NYW5hZ2VtZW50LlNtby5TZXJ2ZXJQZXJtaXNzaW9uU2V0CiAgICAkc3BzLkFkZChbTWljcm9zb2Z0LlNxbFNlcnZlci5NYW5hZ2VtZW50LlNtby5TZXJ2ZXJQZXJtaXNzaW9uXTo6QWx0ZXJBbnlBdmFpbGFiaWxpdHlHcm91cCkgfCBPdXQtTnVsbAogICAgJHNwcy5BZGQoW01pY3Jvc29mdC5TcWxTZXJ2ZXIuTWFuYWdlbWVudC5TbW8uU2VydmVyUGVybWlzc2lvbl06OkNvbm5lY3RTcWwpIHwgT3V0LU51bGwKICAgICRzcHMuQWRkKFtNaWNyb3NvZnQuU3FsU2VydmVyLk1hbmFnZW1lbnQuU21vLlNlcnZlclBlcm1pc3Npb25dOjpWaWV3U2VydmVyU3RhdGUpIHwgT3V0LU51bGwKICAgICRzcGlzID0gJHMuRW51bVNlcnZlclBlcm1pc3Npb25zKCRzeXN0ZW1DcmVkZW50aWFsLlVzZXJOYW1lLCAkc3BzKQogICAgaWYgKCRzcGlzLkNvdW50IC1sdCAzKQogICAgewogICAgICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIkxvZ2luICckKCRzeXN0ZW1DcmVkZW50aWFsLlVzZXJOYW1lKScgZG9lcyBOT1QgaGF2ZSB0aGUgY29ycmVjdCBwZXJtaXNzaW9ucy4iCiAgICAgICAgcmV0dXJuICRmYWxzZQogICAgfQoKICAgICRiQ2hlY2sgPSAkcy5Mb2dpbk1vZGUgLWVxICRMb2dpbk1vZGUKICAgIGlmICgkTG9naW5Nb2RlIC1hbmQgISRiQ2hlY2spCiAgICB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAiU2VydmVyIGxvZ2luIG1vZGUgaXMgTk9UICckKCRMb2dpbk1vZGUpJy4iCiAgICAgICAgcmV0dXJuICRmYWxzZQogICAgfQoKICAgICRiQ2hlY2sgPSAkcy5Db25maWd1cmF0aW9uLk1heERlZ3JlZU9mUGFyYWxsZWxpc20uQ29uZmlnVmFsdWUgLWVxICRNYXhEZWdyZWVPZlBhcmFsbGVsaXNtCiAgICBpZiAoJE1heERlZ3JlZU9mUGFyYWxsZWxpc20gLWFuZCAhJGJDaGVjaykKICAgIHsKICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICJTZXJ2ZXIgc2V0dGluZyAnbWF4IGRlZ3JlZSBvZiBwYXJhbGxlbGlzbScgaXMgTk9UICckKCRNYXhEZWdyZWVPZlBhcmFsbGVsaXNtKScuIgogICAgICAgIHJldHVybiAkZmFsc2UKICAgIH0KCiAgICBpZiAoJEhhZHIpCiAgICB7CiAgICAgICAgaWYgKCRIYWRyIC1lcSAiRW5hYmxlZCIgLWFuZCAhJHMuSXNIYWRyRW5hYmxlZCkKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIlNRTCBBbHdheXMgT24gc2hvdWxkIE5PVCBiZSBkaXNhYmxlZC4iCiAgICAgICAgICAgIHJldHVybiAkZmFsc2UKICAgICAgICB9CiAgICAgICAgaWYgKCRIYWRyIC1lcSAiRGlzYWJsZWQiIC1hbmQgJHMuSXNIYWRyRW5hYmxlZCkKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIlNRTCBBbHdheXMgT24gc2hvdWxkIE5PVCBiZSBlbmFibGVkLiIKICAgICAgICAgICAgcmV0dXJuICRmYWxzZQogICAgICAgIH0KICAgIH0KCiAgICAkYkNoZWNrID0gJHMuRGVmYXVsdEZpbGUuVHJpbUVuZCgiXCIpIC1lcSAkRmlsZVBhdGguVHJpbUVuZCgiXCIpCiAgICBpZiAoJEZpbGVQYXRoIC1hbmQgISRiQ2hlY2spCiAgICB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAiVGhlIHNlcnZlciBkZWZhdWx0IGZpbGUgcGF0aCBpcyBOT1QgJyQoJEZpbGVQYXRoKScgLi4uIgogICAgICAgIHJldHVybiAkZmFsc2UKICAgIH0KCiAgICAkYkNoZWNrID0gJHMuRGVmYXVsdExvZy5UcmltRW5kKCJcIikgLWVxICRMb2dQYXRoLlRyaW1FbmQoIlwiKQogICAgaWYgKCRMb2dQYXRoIC1hbmQgISRiQ2hlY2spCiAgICB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAiVGhlIHNlcnZlciBkZWZhdWx0IGxvZyBwYXRoIGlzIE5PVCAnJCgkTG9nUGF0aCknIC4uLiIKICAgICAgICByZXR1cm4gJGZhbHNlCiAgICB9CgogICAgJHRydWUKfQoKZnVuY3Rpb24gU2V0LUhBRFIoKQp7CiAgICBwYXJhbSgKICAgICAgICBbc3RyaW5nXSRQYXRoLAogICAgICAgIFtzdHJpbmddJEhhZHIKICAgICkKCgogICAgaW1wb3J0LW1vZHVsZSBzcWxwcyAtRGlzYWJsZU5hbWVDaGVja2luZ3xPdXQtTnVsbAoKICAgICRWZXJib3NlUHJlZmVyZW5jZT0nQ29udGludWUnCgogICAgJGxvb3BudW1iZXI9MQogICAgJGxvb3B1bnRpbD01CgogICAgZG8KICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoJEhhZHIgLWVxICJFbmFibGVkIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAiRW5hYmxpbmcgU1FMIEFsd2F5c09uIGF0IFBhdGggJHBhdGggQXR0ZW1wdCAkbG9vcG51bWJlciIKICAgICAgICAgICAgICAgIEVuYWJsZS1TcWxBbHdheXNPbiAtUGF0aCAkUGF0aCAtRm9yY2UKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICJEaXNhYmxpbmcgU1FMIEFsd2F5c09uIGF0IFBhdGggJHBhdGggQXR0ZW1wdCAkbG9vcG51bWJlciIKICAgICAgICAgICAgICAgIERpc2FibGUtU3FsQWx3YXlzT24gLVBhdGggICRQYXRoIC1Gb3JjZQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIGlmICgkbG9vcG51bWJlciAtbHQgJGxvb3B1bnRpbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJGxvb3BudW1iZXIrKwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGhyb3cKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gd2hpbGUgKCRsb29wbnVtYmVyIC1sdCAkbG9vcHVudGlsKQp9CmZ1bmN0aW9uIFVwZGF0ZS1TcG5QZXJtaXNzaW9ucyhbUFNDcmVkZW50aWFsXSRTZXJ2aWNlQ3JlZGVudGlhbCwgW1BTQ3JlZGVudGlhbF0kRG9tYWluQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwpCnsKICAgIGlmICgkRG9tYWluQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwpCiAgICB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAiR3JhbnRpbmcgJyQoJFNlcnZpY2VDcmVkZW50aWFsLlVzZXJOYW1lKScgUmVhZC9Xcml0ZSBzZXJ2aWNlUHJpbmNpcGFsTmFtZSBwZXJtaXNzaW9ucyAuLi4iCiAgICAgICAgdHJ5CiAgICAgICAgewogICAgICAgICAgICAoJG9sZFRva2VuLCAkY29udGV4dCwgJG5ld1Rva2VuKSA9IEltcGVyc29uYXRlQXMgLWNyZWQgJERvbWFpbkFkbWluaXN0cmF0b3JDcmVkZW50aWFsCgogICAgICAgICAgICAkZG9tYWluID0gJFNlcnZpY2VDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuRG9tYWluCiAgICAgICAgICAgICR1c2VyTmFtZSA9ICRTZXJ2aWNlQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLlVzZXJOYW1lCiAgICAgICAgICAgICRpZGVudGl0eSA9IE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5OVEFjY291bnQoJGRvbWFpbiwgJHVzZXJOYW1lKQogICAgICAgICAgICAkc2VhcmNoZXIgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5EaXJlY3RvcnlTZWFyY2hlcihbYWRzaV0nJykKICAgICAgICAgICAgJHNlYXJjaGVyLmZpbHRlciA9ICIoJihvYmplY3RDYXRlZ29yeT1wZXJzb24pKHNBTUFjY291bnROYW1lPSR1c2VyTmFtZSkpIgogICAgICAgICAgICAkdGFyZ2V0T2JqZWN0ID0gJHNlYXJjaGVyLkZpbmRPbmUoKS5HZXREaXJlY3RvcnlFbnRyeSgpCgogICAgICAgICAgICAkcm9vdERTRSA9IFthZHNpXSJMREFQOi8vUm9vdERTRSIKICAgICAgICAgICAgJHNjaGVtYUROID0gJHJvb3REU0UucHNiYXNlLnByb3BlcnRpZXNbInNjaGVtYU5hbWluZ0NvbnRleHQiXVswXQogICAgICAgICAgICAkc3BuRW50cnkgPSBbYWRzaV0iTERBUDovL0NOPVNlcnZpY2UtUHJpbmNpcGFsLU5hbWUsJHNjaGVtYUROIgogICAgICAgICAgICAkZ3VpZEFyZz1AKCIiKQogICAgICAgICAgICAkZ3VpZEFyZ1swXT0kc3BuRW50cnkucHNiYXNlLlByb3BlcnRpZXNbInNjaGVtYUlER1VJRCJdWzBdCiAgICAgICAgICAgICRzcG5TZWNHdWlkID0gTmV3LU9iamVjdCBHVUlEICRndWlkQXJnCiAgICAgICAgICAgICRhZFJpZ2h0PVtEaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnlSaWdodHNdInJlYWRwcm9wZXJ0eSx3cml0ZXByb3BlcnR5IgogICAgICAgICAgICAkc3BuQWNlID0gTmV3LU9iamVjdCBEaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnlBY2Nlc3NSdWxlICRpZGVudGl0eSwkYWRSaWdodCwiQWxsb3ciLCRzcG5TZWNHdWlkLCJOb25lIgogICAgICAgICAgICAkdGFyZ2V0T2JqZWN0LnBzYmFzZS5PYmplY3RTZWN1cml0eS5BZGRBY2Nlc3NSdWxlKCRzcG5BY2UpCiAgICAgICAgICAgICR0YXJnZXRPYmplY3QucHNiYXNlLkNvbW1pdENoYW5nZXMoKQogICAgICAgIH0KICAgICAgICBjYXRjaAogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAtTWVzc2FnZSAiRXJyb3IgZ3JhbnRpbmcgJyQoJFNlcnZpY2VDcmVkZW50aWFsLlVzZXJOYW1lKScgUmVhZC9Xcml0ZSBzZXJ2aWNlUHJpbmNpcGFsTmFtZSBwZXJtaXNzaW9ucy4iCiAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgLU1lc3NhZ2UgJF8KICAgICAgICB9CiAgICAgICAgZmluYWxseQogICAgICAgIHsKICAgICAgICAgICAgaWYgKCRjb250ZXh0KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkY29udGV4dC5VbmRvKCkKICAgICAgICAgICAgICAgICRjb250ZXh0LkRpc3Bvc2UoKQogICAgICAgICAgICAgICAgQ2xvc2VVc2VyVG9rZW4oJG5ld1Rva2VuKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIFdyaXRlLVdhcm5pbmcgLU1lc3NhZ2UgIkRvbWFpbkFkbWluaXN0cmF0b3JDcmVkZW50aWFsIHdhcyBub3Qgc3BlY2lmaWVkLiBZb3UgbXVzdCBjb25maWd1cmVkIHRoZSBTUE5zIGZvciAnJCgkU2VydmljZUNyZWRlbnRpYWwuVXNlck5hbWUpJyBtYW51YWxseS4iCiAgICB9Cn0KCmZ1bmN0aW9uIEdyYW50LUxvZ29uQXNBU2VydmljZVJpZ2h0KFtQU0NyZWRlbnRpYWxdJFNlcnZpY2VDcmVkZW50aWFsLCBbUFNDcmVkZW50aWFsXSREb21haW5BZG1pbmlzdHJhdG9yQ3JlZGVudGlhbCkKewogICAgaWYgKCREb21haW5BZG1pbmlzdHJhdG9yQ3JlZGVudGlhbCkKICAgIHsKICAgICAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICJHcmFudGluZyAnJCgkU2VydmljZUNyZWRlbnRpYWwuVXNlck5hbWUpJyAnTG9nIG9uIGFzIGEgc2VydmljZScgcmlnaHRzIC4uLiIKICAgICAgICB0cnkKICAgICAgICB7CiAgICAgICAgICAgICgkb2xkVG9rZW4sICRjb250ZXh0LCAkbmV3VG9rZW4pID0gSW1wZXJzb25hdGVBcyAtY3JlZCAkRG9tYWluQWRtaW5pc3RyYXRvckNyZWRlbnRpYWwKICAgICAgICAgICAgQWRkQWNjb3VudFJpZ2h0cyAtYWNjb3VudCAkU2VydmljZUNyZWRlbnRpYWwgLXJpZ2h0cyAiU2VTZXJ2aWNlTG9nb25SaWdodCIKICAgICAgICB9CiAgICAgICAgY2F0Y2gKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgLU1lc3NhZ2UgIkVycm9yIGdyYW50aW5nICckKCRTZXJ2aWNlQ3JlZGVudGlhbC5Vc2VyTmFtZSknICdMb2cgb24gYXMgYSBzZXJ2aWNlJyByaWdodHMuIgogICAgICAgICAgICBXcml0ZS1XYXJuaW5nIC1NZXNzYWdlICRfCiAgICAgICAgfQogICAgICAgIGZpbmFsbHkKICAgICAgICB7CiAgICAgICAgICAgIGlmICgkY29udGV4dCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJGNvbnRleHQuVW5kbygpCiAgICAgICAgICAgICAgICAkY29udGV4dC5EaXNwb3NlKCkKICAgICAgICAgICAgICAgIENsb3NlVXNlclRva2VuKCRuZXdUb2tlbikKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBXcml0ZS1XYXJuaW5nIC1NZXNzYWdlICJEb21haW5BZG1pbmlzdHJhdG9yQ3JlZGVudGlhbCB3YXMgbm90IHNwZWNpZmllZC4gWW91IG11c3QgZ3JhbnQgJyQoJFNlcnZpY2VBY2NvdW50KScgJ0xvZyBvbiBhcyBhIHNlcnZpY2UnIHJpZ2h0cyBtYW51YWxseS4iCiAgICB9Cgp9CgoKZnVuY3Rpb24gQWx0ZXItU3lzdGVtRGF0YWJhc2VMb2NhdGlvbihbc3RyaW5nXSRGaWxlUGF0aCwgW3N0cmluZ10kTG9nUGF0aCxbUFNDcmVkZW50aWFsXSRTZXJ2aWNlQ3JlZGVudGlhbCApCnsKICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIkdyYW50aW5nICRTZXJ2aWNlQ3JlZGVudGlhbC5Vc2VyTmFtZSBmdWxsIGFjY2VzcyBwZXJtaXNzaW9uIHRvICRGaWxlUGF0aCBhbmQgJExvZ1BhdGgiCgogICAgJHBlcm1pc3Npb25TdHJpbmcgPSAkU2VydmljZUNyZWRlbnRpYWwuVXNlck5hbWUrIjooT0kpKENJKShGKSIKICAgIGljYWNscyAkRmlsZVBhdGggL2dyYW50ICRwZXJtaXNzaW9uU3RyaW5nCiAgICBpY2FjbHMgJExvZ1BhdGggL2dyYW50ICRwZXJtaXNzaW9uU3RyaW5nCgogICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAiQWx0ZXJpbmcgdGVtcGRiIHN5c3RlbSBkYXRhYmFzZSBsb2NhdGlvbiBzZXR0aW5nIHRvICRGaWxlUGF0aFx0ZW1wZGIubWRmIGFuZCAkTG9nUGF0aFx0ZW1wbG9nLmxkZiIKCiAgICBJbnZva2UtU3FsY21kICJVc2UgbWFzdGVyIgogICAgSW52b2tlLXNxbENtZCAiQUxURVIgREFUQUJBU0UgdGVtcGRiIE1PRElGWSBGSUxFIChOQU1FID0gdGVtcGRldiwgRklMRU5BTUUgPSAnJEZpbGVQYXRoXHRlbXBkYi5tZGYnKTsiCiAgICBJbnZva2Utc3FsQ21kICJBTFRFUiBEQVRBQkFTRSB0ZW1wZGIgTU9ESUZZIEZJTEUgKE5BTUUgPSB0ZW1wbG9nLCBGSUxFTkFNRSA9ICckTG9nUGF0aFx0ZW1wbG9nLmxkZicpOyIKCiAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICJBbHRlcmluZyBtb2RlbCBzeXN0ZW0gZGF0YWJhc2UgbG9jYXRpb24gc2V0dGluZyB0byAkRmlsZVBhdGhcbW9kZWwubWRmIGFuZCAkTG9nUGF0aFxtb2RlbGxvZy5sZGYiCgogICAgSW52b2tlLXNxbENtZCAiQUxURVIgREFUQUJBU0UgbW9kZWwgTU9ESUZZIEZJTEUgKE5BTUUgPSBtb2RlbGRldiwgRklMRU5BTUUgPSAnJEZpbGVQYXRoXG1vZGVsLm1kZicpOyIKICAgIEludm9rZS1zcWxDbWQgIkFMVEVSIERBVEFCQVNFIG1vZGVsIE1PRElGWSBGSUxFIChOQU1FID0gbW9kZWxsb2csIEZJTEVOQU1FID0gJyRMb2dQYXRoXG1vZGVsbG9nLmxkZicpOyIKCiAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICJBbHRlcmluZyBtc2RiIHN5c3RlbSBkYXRhYmFzZSBsb2NhdGlvbiBzZXR0aW5nIHRvICRGaWxlUGF0aFxtc2RiZGF0YS5tZGYgYW5kICRMb2dQYXRoXG1zZGJsb2cubGRmIgoKICAgIEludm9rZS1zcWxDbWQgIkFMVEVSIERBVEFCQVNFIG1zZGIgTU9ESUZZIEZJTEUgKE5BTUUgPSBNU0RCRGF0YSwgRklMRU5BTUUgPSAnJEZpbGVQYXRoXG1zZGJkYXRhLm1kZicpOyIKICAgIEludm9rZS1zcWxDbWQgIkFMVEVSIERBVEFCQVNFIG1zZGIgTU9ESUZZIEZJTEUgKE5BTUUgPSBNU0RCTG9nLCBGSUxFTkFNRSA9ICckTG9nUGF0aFxtc2RibG9nLmxkZicpOyIKCiAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICJBbHRlcmluZyBtYXN0ZXIgc3lzdGVtIGRhdGFiYXNlIGxvY2F0aW9uIHNldHRpbmcgdG8gJEZpbGVQYXRoXG1hc3Rlci5tZGYgLCAkTG9nUGF0aFxFUlJPUkxPRyBhbmQgJExvZ1BhdGhcbWFzdGxvZy5sZGYiCn0KCgojVGhpcyBmdW5jdGlvbiB3aWxsIGNvcHkgdGhlIFNvdXJjZSBmaWxlIHRvIHRhcmdldCBwYXRoLCBkdXBsaWNhdGUgaXRzIHBlcm1pc3Npb24gdG8gdGhlIG5ldyBmaWxlIGFuZCBkZWxldGUgdGhlIG9sZCBmaWxlCmZ1bmN0aW9uIFJlbG9jYXRlLUZpbGVzKFtzdHJpbmddJFNvdXJjZUZpbGVQYXRoLCBbc3RyaW5nXSRUYXJnZXRGaWxlUGF0aCkKewogICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAiTW92aW5nIEZpbGUgJFNvdXJjZUZpbGVQYXRoIHRvICRUYXJnZXRGaWxlUGF0aCIKCiAgICBbU3lzdGVtLklPLkZpbGVdOjpDb3B5KCRTb3VyY2VGaWxlUGF0aCwgJFRhcmdldEZpbGVQYXRoLCAkdHJ1ZSkKCiAgICBXcml0ZS1WZXJib3NlIC1NZXNzYWdlICJEdXBsaWNhdGluZyBmaWxlIHBlcm1pc3Npb24gb2YgJFNvdXJjZUZpbGVQYXRoIHRvICRUYXJnZXRGaWxlUGF0aCIKCiAgICBEdXBsaWNhdGVGaWxlUGVybWlzc2lvbiAtU291cmNlRmlsZVBhdGggICRTb3VyY2VGaWxlUGF0aCAgLVRhcmdldEZpbGVQYXRoICRUYXJnZXRGaWxlUGF0aAoKICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIkRlbGV0aW5nICRTb3VyY2VGaWxlUGF0aCIKCiAgICBbU3lzdGVtLklPLkZpbGVdOjpEZWxldGUoJFNvdXJjZUZpbGVQYXRoKQp9CgojRHVwbGljYXRlIHRoZSBBY2Nlc3MgcHJvcGVydGllcyBvZiBhIHNvdXJjZSBmaWxlIHRvIGEgdGFyZ2V0IGZpbGUKZnVuY3Rpb24gRHVwbGljYXRlRmlsZVBlcm1pc3Npb24gKFtzdHJpbmddJFNvdXJjZUZpbGVQYXRoLCBbc3RyaW5nXSRUYXJnZXRGaWxlUGF0aCkKewogICAgJFNvdXJjZUZpbGUgPSBbU3lzdGVtLklPLkZpbGVJbmZvXSRTb3VyY2VGaWxlUGF0aAogICAgJFRhcmdldEZpbGUgPSBbU3lzdGVtLklPLkZpbGVJbmZvXSRUYXJnZXRGaWxlUGF0aAogICAgJFNvdXJjZUZpbGVBY2Nlc3MgPSAkU291cmNlRmlsZS5HZXRBY2Nlc3NDb250cm9sKCkKICAgICRTb3VyY2VGaWxlQWNjZXNzLlNldEFjY2Vzc1J1bGVQcm90ZWN0aW9uKCR0cnVlLCR0cnVlKQogICAgJFRhcmdldEZpbGUuU2V0QWNjZXNzQ29udHJvbCgkU291cmNlRmlsZUFjY2VzcykKfQoKCiNNb3ZlIHN5c3RlbSBkYXRhYmFzZXMgdG8gbmV3IEZpbGUvTG9nIExvY2F0aW9uCmZ1bmN0aW9uIE1vdmUtU3lzdGVtRGF0YWJhc2VGaWxlKFtzdHJpbmddJEZpbGVQYXRoLCBbc3RyaW5nXSRMb2dQYXRoKQp7CgogICAgaWYgIChbU3lzdGVtLklPLkRpcmVjdG9yeV06OkV4aXN0cygiQzpcUHJvZ3JhbSBGaWxlc1xNaWNyb3NvZnQgU1FMIFNlcnZlclxNU1NRTDEyLk1TU1FMU0VSVkVSXE1TU1FMXERBVEFcIikpCiAgICB7CiAgICAgICAgJFNvdXJjZURhdGFGaWxlUGF0aCA9ICJDOlxQcm9ncmFtIEZpbGVzXE1pY3Jvc29mdCBTUUwgU2VydmVyXE1TU1FMMTIuTVNTUUxTRVJWRVJcTVNTUUxcREFUQVwiCiAgICAgICAgJFNvdXJjZUxvZ0ZpbGVQYXRoID0gIkM6XFByb2dyYW0gRmlsZXNcTWljcm9zb2Z0IFNRTCBTZXJ2ZXJcTVNTUUwxMi5NU1NRTFNFUlZFUlxNU1NRTFxMT0dcIgogICAgfQogICAgZWxzZWlmIChbU3lzdGVtLklPLkRpcmVjdG9yeV06OkV4aXN0cygiQzpcUHJvZ3JhbSBGaWxlc1xNaWNyb3NvZnQgU1FMIFNlcnZlclxNU1NRTDEzLk1TU1FMU0VSVkVSXE1TU1FMXERBVEFcIikpCiAgICB7CiAgICAgICAgJFNvdXJjZURhdGFGaWxlUGF0aCA9ICJDOlxQcm9ncmFtIEZpbGVzXE1pY3Jvc29mdCBTUUwgU2VydmVyXE1TU1FMMTMuTVNTUUxTRVJWRVJcTVNTUUxcREFUQVwiCiAgICAgICAgJFNvdXJjZUxvZ0ZpbGVQYXRoID0gIkM6XFByb2dyYW0gRmlsZXNcTWljcm9zb2Z0IFNRTCBTZXJ2ZXJcTVNTUUwxMy5NU1NRTFNFUlZFUlxNU1NRTFxMT0dcIgogICAgfQogICAgZWxzZWlmIChbU3lzdGVtLklPLkRpcmVjdG9yeV06OkV4aXN0cygiQzpcUHJvZ3JhbSBGaWxlc1xNaWNyb3NvZnQgU1FMIFNlcnZlclxNU1NRTDExLk1TU1FMU0VSVkVSXE1TU1FMXERBVEFcIikpCiAgICB7CiAgICAgICAgJFNvdXJjZURhdGFGaWxlUGF0aCA9ICJDOlxQcm9ncmFtIEZpbGVzXE1pY3Jvc29mdCBTUUwgU2VydmVyXE1TU1FMMTEuTVNTUUxTRVJWRVJcTVNTUUxcREFUQVwiCiAgICAgICAgJFNvdXJjZUxvZ0ZpbGVQYXRoID0gIkM6XFByb2dyYW0gRmlsZXNcTWljcm9zb2Z0IFNRTCBTZXJ2ZXJcTVNTUUwxMS5NU1NRTFNFUlZFUlxNU1NRTFxMT0dcIgogICAgfWVsc2UKICAgIHsKICAgICAgICAgICAgdGhyb3cgICJObyBzeXN0ZW0gZGF0YWJhc2UgZm9sZGVyIGRldGVjdGVkLGV4aXRpbmcgLi4uLiIKICAgIH0KCiAgICAjUmVsb2NhdGUgbXNkYiBkYXRhYmFzZXMgZmlsZXMKICAgIFJlbG9jYXRlLUZpbGVzIC1Tb3VyY2VGaWxlUGF0aCAoJFNvdXJjZURhdGFGaWxlUGF0aCsibXNkYmRhdGEubWRmIikgLVRhcmdldEZpbGVQYXRoICgkRmlsZVBhdGgrIlxtc2RiZGF0YS5tZGYiKQogICAgUmVsb2NhdGUtRmlsZXMgLVNvdXJjZUZpbGVQYXRoICgkU291cmNlRGF0YUZpbGVQYXRoKyJtc2RibG9nLmxkZiIpIC1UYXJnZXRGaWxlUGF0aCAoJExvZ1BhdGggKyAiXG1zZGJsb2cubGRmIikKCiAgICAjUmVsb2NhdGUgbW9kbGUgZGF0YWJhc2VzIGZpbGVzCiAgICBSZWxvY2F0ZS1GaWxlcyAtU291cmNlRmlsZVBhdGggKCRTb3VyY2VEYXRhRmlsZVBhdGgrIm1vZGVsLm1kZiIpIC1UYXJnZXRGaWxlUGF0aCAoJEZpbGVQYXRoICsgIlxtb2RlbC5tZGYiKQogICAgUmVsb2NhdGUtRmlsZXMgLVNvdXJjZUZpbGVQYXRoICgkU291cmNlRGF0YUZpbGVQYXRoKyJtb2RlbGxvZy5sZGYiKSAtVGFyZ2V0RmlsZVBhdGggKCRMb2dQYXRoICsgIlxtb2RlbGxvZy5sZGYiKQoKICAgICNSZWxvY2F0ZSB0ZW1wIGRhdGFiYXNlcyBmaWxlcwogICAgUmVsb2NhdGUtRmlsZXMgLVNvdXJjZUZpbGVQYXRoICgkU291cmNlRGF0YUZpbGVQYXRoKyJ0ZW1wZGIubWRmIikgLVRhcmdldEZpbGVQYXRoICgkRmlsZVBhdGggKyAiXHRlbXBkYi5tZGYiKQogICAgUmVsb2NhdGUtRmlsZXMgLVNvdXJjZUZpbGVQYXRoICgkU291cmNlRGF0YUZpbGVQYXRoKyJ0ZW1wbG9nLmxkZiIpIC1UYXJnZXRGaWxlUGF0aCAoJExvZ1BhdGggKyAiXHRlbXBsb2cubGRmIikKCiAgICAjUmVsb2NhdGUgbWFzdGVyIGRhdGFiYXNlIGZpbGVzCiAgICBSZWxvY2F0ZS1GaWxlcyAtU291cmNlRmlsZVBhdGggKCRTb3VyY2VEYXRhRmlsZVBhdGgrIm1hc3Rlci5tZGYiKSAtVGFyZ2V0RmlsZVBhdGggKCRGaWxlUGF0aCArICJcbWFzdGVyLm1kZiIpCiAgICBSZWxvY2F0ZS1GaWxlcyAtU291cmNlRmlsZVBhdGggKCRTb3VyY2VEYXRhRmlsZVBhdGgrIm1hc3Rsb2cubGRmIikgLVRhcmdldEZpbGVQYXRoICgkTG9nUGF0aCArICJcbWFzdGxvZy5sZGYiKQogICAgUmVsb2NhdGUtRmlsZXMgLVNvdXJjZUZpbGVQYXRoICgkU291cmNlTG9nRmlsZVBhdGggKyAiRVJST1JMT0ciKSAtVGFyZ2V0RmlsZVBhdGggKCRMb2dQYXRoICsgIlxFUlJPUkxPRyIpCgp9CgoKZnVuY3Rpb24gRW5hYmxlLVRjcElQKFtNaWNyb3NvZnQuU3FsU2VydmVyLk1hbmFnZW1lbnQuU21vLlNlcnZlcl0kU2VydmVyKQp7CiAgICBbU3lzdGVtLlJlZmxlY3Rpb24uQXNzZW1ibHldOjpMb2FkV2l0aFBhcnRpYWxOYW1lKCJNaWNyb3NvZnQuU3FsU2VydmVyLlNxbFdtaU1hbmFnZW1lbnQiKSB8IE91dC1OdWxsCiAgICAkbWMgPSBOZXctT2JqZWN0IE1pY3Jvc29mdC5TcWxTZXJ2ZXIuTWFuYWdlbWVudC5TbW8uV21pLk1hbmFnZWRDb21wdXRlciAkU2VydmVyLk5hbWUKICAgICRJbnN0YW5jZU5hbWUgPSAkU2VydmVyLk5hbWUKICAgICR1cmkgPSAiTWFuYWdlZENvbXB1dGVyW0BOYW1lPSckZW52OkNPTVBVVEVSTkFNRSddLyBTZXJ2ZXJJbnN0YW5jZVtATmFtZT0nTVNTUUxTRVJWRVInXS9TZXJ2ZXJQcm90b2NvbFtATmFtZT0nVGNwJ10iCiAgICAkVGNwID0gJG1jLkdldFNtb09iamVjdCgkdXJpKQogICAgaWYgKCEkVGNwLklzRW5hYmxlZCkKICAgIHsKICAgICAgICAkVGNwLklzRW5hYmxlZCA9ICR0cnVlCiAgICAgICAgJFRjcC5BbHRlcigpCiAgICB9Cn0KCmZ1bmN0aW9uIEdldC1TZXJ2aWNlQWNjb3VudChbc3RyaW5nXSRJbnN0YW5jZU5hbWUsIFtNaWNyb3NvZnQuU3FsU2VydmVyLk1hbmFnZW1lbnQuU21vLlNlcnZlcl0kU2VydmVyKQp7CiAgICBbU3lzdGVtLlJlZmxlY3Rpb24uQXNzZW1ibHldOjpMb2FkV2l0aFBhcnRpYWxOYW1lKCJNaWNyb3NvZnQuU3FsU2VydmVyLlNxbFdtaU1hbmFnZW1lbnQiKSB8IE91dC1OdWxsCiAgICAkbWMgPSBOZXctT2JqZWN0IE1pY3Jvc29mdC5TcWxTZXJ2ZXIuTWFuYWdlbWVudC5TbW8uV21pLk1hbmFnZWRDb21wdXRlciAkU2VydmVyLk5hbWUKICAgICMgTm9ybWFsaXplIHRoZSBpbnN0YW5jZSBuYW1lLgogICAgJGxpc3QgPSAkSW5zdGFuY2VOYW1lLlNwbGl0KCJcIikKICAgIGlmICgkbGlzdC5Db3VudCAtZ3QgMSkKICAgIHsKICAgICAgICAkSW5zdGFuY2VOYW1lID0gJGxpc3RbMV0KICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICAkSW5zdGFuY2VOYW1lID0gIk1TU1FMU0VSVkVSIgogICAgfQogICAgJHN2YyA9ICRtYy5TZXJ2aWNlc1skSW5zdGFuY2VOYW1lXQoKICAgICRzdmMuU2VydmljZUFjY291bnQKfQoKZnVuY3Rpb24gU2V0LVNlcnZpY2VBY2NvdW50KFtQU0NyZWRlbnRpYWxdJENyZWRlbnRpYWwsIFtzdHJpbmddJEluc3RhbmNlTmFtZSwgW01pY3Jvc29mdC5TcWxTZXJ2ZXIuTWFuYWdlbWVudC5TbW8uU2VydmVyXSRTZXJ2ZXIpCnsKICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIlNldHRpbmcgdGhlIHNlcnZpY2UgYWNjb3VudCB0byAnJCgkQ3JlZGVudGlhbC5Vc2VyTmFtZSknIC4uLiIKICAgIFtTeXN0ZW0uUmVmbGVjdGlvbi5Bc3NlbWJseV06OkxvYWRXaXRoUGFydGlhbE5hbWUoIk1pY3Jvc29mdC5TcWxTZXJ2ZXIuU3FsV21pTWFuYWdlbWVudCIpIHwgT3V0LU51bGwKICAgICRtYyA9IE5ldy1PYmplY3QgTWljcm9zb2Z0LlNxbFNlcnZlci5NYW5hZ2VtZW50LlNtby5XbWkuTWFuYWdlZENvbXB1dGVyICRTZXJ2ZXIuTmFtZQogICAgIyBOb3JtYWxpemUgdGhlIGluc3RhbmNlIG5hbWUuCiAgICAkbGlzdCA9ICRJbnN0YW5jZU5hbWUuU3BsaXQoIlwiKQogICAgaWYgKCRsaXN0LkNvdW50IC1ndCAxKQogICAgewogICAgICAgICRJbnN0YW5jZU5hbWUgPSAkbGlzdFsxXQogICAgfQogICAgZWxzZQogICAgewogICAgICAgICRJbnN0YW5jZU5hbWUgPSAiTVNTUUxTRVJWRVIiCiAgICB9CiAgICAkc3ZjID0gJG1jLlNlcnZpY2VzWyRJbnN0YW5jZU5hbWVdCgogICAgJHRjcFBvcnQgPSAkbWMuU2VydmVySW5zdGFuY2VzWyRJbnN0YW5jZU5hbWVdLlNlcnZlclByb3RvY29sc1siVGNwIl0uSVBBZGRyZXNzZXNbIklQQWxsIl0uSVBBZGRyZXNzUHJvcGVydGllc1siVGNwUG9ydCJdLlZhbHVlCgogICAgIyBSZW1vdmUgYW55IGxlZnRvdmVyIFNQTnMuCiAgICAkc3BucyA9IHNldHNwbiAtTCAkbWMuTmFtZQogICAgZm9yZWFjaCAoJHNwbiBpbiAkc3BucykKICAgIHsKICAgICAgICAkc3BuID0gJHNwbi5UcmltKCkKICAgICAgICBpZiAoJHNwbiAtbGlrZSAiTVNTUUxTdmMvKjokdGNwUG9ydCIpCiAgICAgICAgewogICAgICAgICAgICAjIFJlbW92ZSB0aGUgU1BOIHRoYXQgbWF0Y2hlcyB0aGUgVENQL0lQIHBvcnQgb2YgdGhpcyBpbnN0YW5jZS4KICAgICAgICAgICAgc2V0c3BuIC1EICRzcG4gJG1jLk5hbWUgfCBPdXQtTnVsbAogICAgICAgICAgICBjb250aW51ZQogICAgICAgIH0KCiAgICAgICAgaWYgKCRzcG4gLWxpa2UgIk1TU1FMU3ZjLyo6JEluc3RhbmNlTmFtZSIpCiAgICAgICAgewogICAgICAgICAgICAjIFJlbW92ZSB0aGUgU1BOIHRoYXQgbWF0Y2hlcyB0aGlzIG5hbWVkIGluc3RhbmNlLgogICAgICAgICAgICBzZXRzcG4gLUQgJHNwbiAkbWMuTmFtZSB8IE91dC1OdWxsCiAgICAgICAgfQogICAgICAgIGVsc2VpZiAoJHNwbiAtbGlrZSAiTVNTUUxTdmMvKjoqIikKICAgICAgICB7CiAgICAgICAgICAgICMgU2tpcCBhbiBTUE4gdGhhdCBtYXRjaGVzIGEgZGlmZmVyZW50IG5hbWVkIGluc3RhbmNlLgogICAgICAgICAgICBjb250aW51ZQogICAgICAgIH0KICAgICAgICBlbHNlaWYgKCRzcG4gLWxpa2UgIk1TU1FMU3ZjLyoiKQogICAgICAgIHsKICAgICAgICAgICAgIyBSZW1vdmUgdGhlIFNQTiB0aGF0IG1hdGNoZXMgdGhlIGRlZmF1bHQgaW5zdGFuY2UuCiAgICAgICAgICAgIHNldHNwbiAtRCAkc3BuICRtYy5OYW1lIHwgT3V0LU51bGwKICAgICAgICB9CiAgICB9CgogICAgJHN2Yy5TZXRTZXJ2aWNlQWNjb3VudCgkQ3JlZGVudGlhbC5Vc2VyTmFtZSwgJENyZWRlbnRpYWwuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5QYXNzd29yZCkKfQoKZnVuY3Rpb24gU3RhcnQtU3FsU2VydmVyKFtzdHJpbmddJEluc3RhbmNlTmFtZSwgW01pY3Jvc29mdC5TcWxTZXJ2ZXIuTWFuYWdlbWVudC5TbW8uU2VydmVyXSRTZXJ2ZXIpCnsKICAgIFtTeXN0ZW0uUmVmbGVjdGlvbi5Bc3NlbWJseV06OkxvYWRXaXRoUGFydGlhbE5hbWUoIk1pY3Jvc29mdC5TcWxTZXJ2ZXIuU3FsV21pTWFuYWdlbWVudCIpIHwgT3V0LU51bGwKICAgICRtYyA9IE5ldy1PYmplY3QgTWljcm9zb2Z0LlNxbFNlcnZlci5NYW5hZ2VtZW50LlNtby5XbWkuTWFuYWdlZENvbXB1dGVyICRTZXJ2ZXIuTmFtZQogICAgJGxpc3QgPSAkSW5zdGFuY2VOYW1lLlNwbGl0KCJcIikKICAgIGlmICgkbGlzdC5Db3VudCAtZ3QgMSkKICAgIHsKICAgICAgICAkSW5zdGFuY2VOYW1lID0gJGxpc3RbMV0KICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICAkSW5zdGFuY2VOYW1lID0gIk1TU1FMU0VSVkVSIgogICAgfQogICAgJHN2YyA9ICRtYy5TZXJ2aWNlc1skSW5zdGFuY2VOYW1lXQoKICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIlN0YXJ0aW5nIFNRTCBzZXJ2ZXIgaW5zdGFuY2UgJyQoJEluc3RhbmNlTmFtZSknIC4uLiIKICAgIFtTeXN0ZW0uUmVmbGVjdGlvbi5Bc3NlbWJseV06OkxvYWRXaXRoUGFydGlhbE5hbWUoIk1pY3Jvc29mdC5TcWxTZXJ2ZXIuV21pRW51bSIpIHwgT3V0LU51bGwKCiAgICBpZiAoJHN2Yy5TZXJ2aWNlU3RhdGUgLWVxIFtNaWNyb3NvZnQuU3FsU2VydmVyLk1hbmFnZW1lbnQuU21vLldtaS5TZXJ2aWNlU3RhdGVdOjpTdG9wcGVkKQogICAgewogICAgICAgICRzdmMuU3RhcnQoKQoKICAgICAgICBzdGFydC1zbGVlcCAtc2Vjb25kcyA1CgoJCXdoaWxlICgkc3ZjLlNlcnZpY2VTdGF0ZSAtbmUgW01pY3Jvc29mdC5TcWxTZXJ2ZXIuTWFuYWdlbWVudC5TbW8uV21pLlNlcnZpY2VTdGF0ZV06OlJ1bm5pbmcpCgkJewoJCQkkc3ZjLlJlZnJlc2goKQoJCX0KICAgIH0KfQoKZnVuY3Rpb24gU3RvcC1TcWxTZXJ2ZXIoW3N0cmluZ10kSW5zdGFuY2VOYW1lLCBbTWljcm9zb2Z0LlNxbFNlcnZlci5NYW5hZ2VtZW50LlNtby5TZXJ2ZXJdJFNlcnZlcikKewoJW1N5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5XTo6TG9hZFdpdGhQYXJ0aWFsTmFtZSgiTWljcm9zb2Z0LlNxbFNlcnZlci5TcWxXbWlNYW5hZ2VtZW50IikgfCBPdXQtTnVsbAogICAgJG1jID0gTmV3LU9iamVjdCBNaWNyb3NvZnQuU3FsU2VydmVyLk1hbmFnZW1lbnQuU21vLldtaS5NYW5hZ2VkQ29tcHV0ZXIgJFNlcnZlci5OYW1lCiAgICAkbGlzdCA9ICRJbnN0YW5jZU5hbWUuU3BsaXQoIlwiKQogICAgaWYgKCRsaXN0LkNvdW50IC1ndCAxKQogICAgewogICAgICAgICRJbnN0YW5jZU5hbWUgPSAkbGlzdFsxXQogICAgfQogICAgZWxzZQogICAgewogICAgICAgICRJbnN0YW5jZU5hbWUgPSAiTVNTUUxTRVJWRVIiCiAgICB9CiAgICAkc3ZjID0gJG1jLlNlcnZpY2VzWyRJbnN0YW5jZU5hbWVdCgogICAgV3JpdGUtVmVyYm9zZSAtTWVzc2FnZSAiU3RvcHBpbmcgU1FMIHNlcnZlciBpbnN0YW5jZSAnJCgkSW5zdGFuY2VOYW1lKScgLi4uIgogICAgW1N5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5XTo6TG9hZFdpdGhQYXJ0aWFsTmFtZSgiTWljcm9zb2Z0LlNxbFNlcnZlci5XbWlFbnVtIikgfCBPdXQtTnVsbAoKICAgICRzdmMuU3RvcCgpCgogICAgc3RhcnQtc2xlZXAgLXNlY29uZHMgNQoKICAgICRzdmMuUmVmcmVzaCgpCgogICAgd2hpbGUgKCRzdmMuU2VydmljZVN0YXRlIC1uZSBbTWljcm9zb2Z0LlNxbFNlcnZlci5NYW5hZ2VtZW50LlNtby5XbWkuU2VydmljZVN0YXRlXTo6U3RvcHBlZCkKICAgIHsKICAgICAgICAkc3ZjLlJlZnJlc2goKQogICAgfQp9CgoKCmZ1bmN0aW9uIFJlc3RhcnQtU3FsU2VydmVyKFtzdHJpbmddJEluc3RhbmNlTmFtZSwgW01pY3Jvc29mdC5TcWxTZXJ2ZXIuTWFuYWdlbWVudC5TbW8uU2VydmVyXSRTZXJ2ZXIpCnsKICAgICBTdG9wLVNxbFNlcnZlciAtSW5zdGFuY2VOYW1lICRJbnN0YW5jZU5hbWUgLVNlcnZlciAkcwoKICAgICBTdGFydC1TcWxTZXJ2ZXIgLUluc3RhbmNlTmFtZSAkSW5zdGFuY2VOYW1lIC1TZXJ2ZXIgJHMKfQoKZnVuY3Rpb24gR2V0LVNxbFNlcnZlcgp7CiAgICBwYXJhbQogICAgKAogICAgICAgIFtwYXJhbWV0ZXIoTWFuZGF0b3J5KV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtQU0NyZWRlbnRpYWxdJENyZWRlbnRpYWwsCgogICAgICAgIFtwYXJhbWV0ZXIoTWFuZGF0b3J5KV0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtzdHJpbmddJEluc3RhbmNlTmFtZQogICAgKQogICAgW1N5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5XTo6TG9hZFdpdGhQYXJ0aWFsTmFtZSgiTWljcm9zb2Z0LlNxbFNlcnZlci5Db25uZWN0aW9uSW5mbyIpIHwgT3V0LU51bGwKCiAgICAkTG9naW5DcmVhdGFpb25SZXRyeSA9IDAKCiAgICBXaGlsZSAoJHRydWUpIHsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgI1NldHRpbmcgVXAgU2VydmVyIENvbm5lY3Rpb24gT2JqZWN0CiAgICAgICAgICAgICRzYyA9IE5ldy1PYmplY3QgTWljcm9zb2Z0LlNxbFNlcnZlci5NYW5hZ2VtZW50LkNvbW1vbi5TZXJ2ZXJDb25uZWN0aW9uCgogICAgICAgICAgICBpZiAoJENyZWRlbnRpYWwpCiAgICAgICAgICAgIHsKCiAgICAgICAgICAgICAgICAkbGlzdCA9ICRJbnN0YW5jZU5hbWUuU3BsaXQoIlwiKQogICAgICAgICAgICAgICAgaWYgKCRsaXN0LkNvdW50IC1ndCAxIC1hbmQgJGxpc3RbMV0gLWVxICJNU1NRTFNFUlZFUiIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJHNjLlNlcnZlckluc3RhbmNlID0gJGxpc3RbMF0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkc2MuU2VydmVySW5zdGFuY2UgPSAkSW5zdGFuY2VOYW1lCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJHNjLkNvbm5lY3RBc1VzZXIgPSAkdHJ1ZQoKICAgICAgICAgICAgICAgICNDYW4gbm90IGZpbmQgYSBwcm9wZXIgZG9jdW1lbnRhdGlvbiBmb3Igc2V0dGluZyBDb25uZWN0VGltZW91dCB0byBiZSBmb3JldmVyIHNvIHdlIHVzZSAzMDAgc2Vjb25kcyBoZXJlIHdoaWNoIGlzIHRoZSBtYXggdGltZSBvZiB0aGUgZ3Vlc3QgYWdlbnQgdG8gZGV0ZXJtaW5lIHRpbWVvdXQKICAgICAgICAgICAgICAgICRzYy5Db25uZWN0VGltZW91dCA9IDMwMAoKICAgICAgICAgICAgICAgIGlmICgkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLkRvbWFpbiAtYW5kICgkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLkRvbWFpbiAtbmUgJGVudjpDT01QVVRFUk5BTUUpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRkb21haW5DcmVkZW50aWFsID0gIiQoJENyZWRlbnRpYWwuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5Vc2VyTmFtZSlAJCgkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLkRvbWFpbikiCgogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkNvbm5lY3RpbmcgU2VydmVyIHdpdGggRG9tYWluIENyZWRlbnRpYWwgJCgkZG9tYWluQ3JlZGVudGlhKSAiCgogICAgICAgICAgICAgICAgICAgICRzYy5Db25uZWN0QXNVc2VyTmFtZSA9ICIkKCRDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuVXNlck5hbWUpQCQoJENyZWRlbnRpYWwuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5Eb21haW4pIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkNvbm5lY3RpbmcgU2VydmVyIHdpdGggbG9jYWwgQWRtaW4gQ3JlZGVudGlhbCAkKCRDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuVXNlck5hbWUpIgoKICAgICAgICAgICAgICAgICAgICAkc2MuQ29ubmVjdEFzVXNlck5hbWUgPSAkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLlVzZXJOYW1lCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJHNjLkNvbm5lY3RBc1VzZXJQYXNzd29yZCA9ICRDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuUGFzc3dvcmQKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgVGhyb3cgIlNlcnZlciBDb25uZWN0aW9uIENyZWRlbnRpYWwgb2JqZWN0IGlzIG51bGwsIGV4aXRpbmcgLi4uIgogICAgICAgICAgICB9CgogICAgICAgICAgICBbU3lzdGVtLlJlZmxlY3Rpb24uQXNzZW1ibHldOjpMb2FkV2l0aFBhcnRpYWxOYW1lKCJNaWNyb3NvZnQuU3FsU2VydmVyLlNtbyIpIHwgT3V0LU51bGwKCiAgICAgICAgICAgICRzID0gTmV3LU9iamVjdCBNaWNyb3NvZnQuU3FsU2VydmVyLk1hbmFnZW1lbnQuU21vLlNlcnZlciAkc2MKCiAgICAgICAgICAgIGlmICgkcy5JbmZvcm1hdGlvbi5WZXJzaW9uKSB7CgogICAgICAgICAgICAgICAgJHMuUmVmcmVzaCgpCgogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiU1FMIE1hbmFnZW1lbnQgT2JqZWN0IENyZWF0ZWQgU3VjY2Vzc2Z1bGx5LCBWZXJzaW9uIDogJyQoJHMuSW5mb3JtYXRpb24uVmVyc2lvbiknICIKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0aHJvdyAiU1FMIE1hbmFnZW1lbnQgT2JqZWN0IENyZWF0aW9uIEZhaWxlZCIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuICRzCgogICAgICAgIH0KICAgICAgICBjYXRjaCBbU3lzdGVtLkV4Y2VwdGlvbl0KICAgICAgICB7CiAgICAgICAgICAgICRMb2dpbkNyZWF0aW9uUmV0cnkgPSAkTG9naW5DcmVhdGlvblJldHJ5ICsgMQoKICAgICAgICAgICAgaWYgKCRfLkV4Y2VwdGlvbi5Jbm5lckV4Y2VwdGlvbikgewogICAgICAgICAgICAgJEVycm9yTVNHID0gIkVycm9yIG9jY3VyZWQ6ICckKCRfLkV4Y2VwdGlvbi5NZXNzYWdlKScsSW5uZXJFeGNlcHRpb246ICckKCRfLkV4Y2VwdGlvbi5Jbm5lckV4Y2VwdGlvbi5NZXNzYWdlKScsICBmYWlsZWQgYWZ0ZXIgJyQoJExvZ2luQ3JlYXRpb25SZXRyeSknIHRpbWVzIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgJEVycm9yTVNHID0gIkVycm9yIG9jY3VyZWQ6ICckKCRfLkV4Y2VwdGlvbi5NZXNzYWdlKScsIGZhaWxlZCBhZnRlciAnJCgkTG9naW5DcmVhdGlvblJldHJ5KScgdGltZXMiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgkTG9naW5DcmVhdGlvblJldHJ5IC1lcSAzMCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRXJyb3Igb2NjdXJlZDogJEVycm9yTVNHLCByZWFjaCB0aGUgbWF4aW11bSByZS10cnk6ICckKCRMb2dpbkNyZWF0aW9uUmV0cnkpJyB0aW1lcywgZXhpdGluZy4uLi4iCgogICAgICAgICAgICAgICAgVGhyb3cgJEVycm9yTVNHCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN0YXJ0LXNsZWVwIC1zZWNvbmRzIDYwCgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciBvY2N1cmVkOiAkRXJyb3JNU0csIHJldHJ5IGZvciAnJCgkTG9naW5DcmVhdGlvblJldHJ5KScgdGltZXMiCiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBJc1NRTExvZ2luKFtQU0NyZWRlbnRpYWxdJExvZ2luLCBbTWljcm9zb2Z0LlNxbFNlcnZlci5NYW5hZ2VtZW50LlNtby5TZXJ2ZXJdJFNlcnZlcikKewogICAgJGRvbWFpbiA9ICRMb2dpbi5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLkRvbWFpbgogICAgJHVzZXJOYW1lID0gJExvZ2luLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuVXNlck5hbWUKICAgIGlmICgkc2VydmVyLkxvZ2lucyB8IHdoZXJlIHsgJF8uTmFtZSAtZXEgIiRkb21haW5cJHVzZXJuYW1lIiB9KQogICAgewogICAgICAgIHJldHVybiAkdHJ1ZQogICAgfQoKICAgICRmYWxzZQp9CgpmdW5jdGlvbiBJc1N5c0FkbWluKFtQU0NyZWRlbnRpYWxdJExvZ2luLCBbTWljcm9zb2Z0LlNxbFNlcnZlci5NYW5hZ2VtZW50LlNtby5TZXJ2ZXJdJFNlcnZlcikKewogICAgJGRvbWFpbiA9ICRMb2dpbi5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLkRvbWFpbgogICAgJHVzZXJOYW1lID0gJExvZ2luLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuVXNlck5hbWUKICAgICRyb2xlID0gJHNlcnZlci5Sb2xlcyB8IHdoZXJlIHsgJF8uTmFtZSAtZXEgInN5c2FkbWluIiB9CiAgICBpZiAoJHJvbGUuRW51bU1lbWJlck5hbWVzKCkuQ29udGFpbnMoIiRkb21haW5cJHVzZXJuYW1lIikpCiAgICB7CiAgICAgICAgcmV0dXJuICR0cnVlCiAgICB9CgogICAgJGZhbHNlCn0KCmZ1bmN0aW9uIEdldC1Mc2FMaWIKewogICAgaWYgKCRzY3JpcHQ6THNhTGliKQogICAgewogICAgICAgIHJldHVybiAkc2NyaXB0OkxzYUxpYgogICAgfQoKICAgICRsc2FfdHlwZSA9IEAnCnVzaW5nIFN5c3RlbTsKdXNpbmcgU3lzdGVtLkNvbXBvbmVudE1vZGVsOwp1c2luZyBTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXM7CnVzaW5nIFN5c3RlbS5TZWN1cml0eTsKdXNpbmcgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbDsKdXNpbmcgTFNBX0hBTkRMRSA9IFN5c3RlbS5JbnRQdHI7CgpwdWJsaWMgc2VhbGVkIGNsYXNzIExzYVNlY3VyaXR5V3JhcHBlcgp7CiAgICBbU3RydWN0TGF5b3V0KExheW91dEtpbmQuU2VxdWVudGlhbCldCiAgICBpbnRlcm5hbCBzdHJ1Y3QgTFNBX09CSkVDVF9BVFRSSUJVVEVTCiAgICB7CiAgICAgICAgaW50ZXJuYWwgdWxvbmcgTGVuZ3RoOwogICAgICAgIGludGVybmFsIEludFB0ciBSb290RGlyZWN0b3J5OwogICAgICAgIGludGVybmFsIEludFB0ciBPYmplY3ROYW1lOwogICAgICAgIGludGVybmFsIHVsb25nIEF0dHJpYnV0ZXM7CiAgICAgICAgaW50ZXJuYWwgSW50UHRyIFNlY3VyaXR5RGVzY3JpcHRvcjsKICAgICAgICBpbnRlcm5hbCBJbnRQdHIgU2VjdXJpdHlRdWFsaXR5T2ZTZXJ2aWNlOwogICAgfQoKICAgIFtTdHJ1Y3RMYXlvdXQoTGF5b3V0S2luZC5TZXF1ZW50aWFsLCBDaGFyU2V0ID0gQ2hhclNldC5Vbmljb2RlKV0KICAgIGludGVybmFsIHN0cnVjdCBMU0FfVU5JQ09ERV9TVFJJTkcKICAgIHsKICAgICAgICBpbnRlcm5hbCB1c2hvcnQgTGVuZ3RoOwogICAgICAgIGludGVybmFsIHVzaG9ydCBNYXhpbXVtTGVuZ3RoOwogICAgICAgIFtNYXJzaGFsQXMoVW5tYW5hZ2VkVHlwZS5MUFdTdHIpXQogICAgICAgIGludGVybmFsIHN0cmluZyBCdWZmZXI7CiAgICB9CgogICAgW0RsbEltcG9ydCgiYWR2YXBpMzIuZGxsIiwgQ2hhclNldCA9IENoYXJTZXQuVW5pY29kZSwgU2V0TGFzdEVycm9yID0gdHJ1ZSksIFN1cHByZXNzVW5tYW5hZ2VkQ29kZVNlY3VyaXR5QXR0cmlidXRlXQogICAgaW50ZXJuYWwgc3RhdGljIGV4dGVybiB1aW50IExzYU9wZW5Qb2xpY3koCiAgICAgICAgTFNBX1VOSUNPREVfU1RSSU5HW10gU3lzdGVtTmFtZSwKICAgICAgICByZWYgTFNBX09CSkVDVF9BVFRSSUJVVEVTIE9iamVjdEF0dHJpYnV0ZXMsCiAgICAgICAgdWludCBEZXNpcmVkQWNjZXNzLAogICAgICAgIG91dCBJbnRQdHIgUG9saWN5SGFuZGxlCiAgICAgICAgKTsKCiAgICBbRGxsSW1wb3J0KCJhZHZhcGkzMi5kbGwiLCBDaGFyU2V0ID0gQ2hhclNldC5Vbmljb2RlLCBTZXRMYXN0RXJyb3IgPSB0cnVlKSwgU3VwcHJlc3NVbm1hbmFnZWRDb2RlU2VjdXJpdHlBdHRyaWJ1dGVdCiAgICBpbnRlcm5hbCBzdGF0aWMgZXh0ZXJuIHVpbnQgTHNhQWRkQWNjb3VudFJpZ2h0cygKICAgICAgICBMU0FfSEFORExFIFBvbGljeUhhbmRsZSwKICAgICAgICBJbnRQdHIgQWNjb3VudFNpZCwKICAgICAgICBMU0FfVU5JQ09ERV9TVFJJTkdbXSBVc2VyUmlnaHRzLAogICAgICAgIHVsb25nIENvdW50T2ZSaWdodHMKICAgICAgICApOwoKICAgIFtEbGxJbXBvcnQoImFkdmFwaTMyLmRsbCIsIENoYXJTZXQgPSBDaGFyU2V0LlVuaWNvZGUsIFNldExhc3RFcnJvciA9IHRydWUpLCBTdXBwcmVzc1VubWFuYWdlZENvZGVTZWN1cml0eUF0dHJpYnV0ZV0KICAgIGludGVybmFsIHN0YXRpYyBleHRlcm4gdWludCBMc2FSZW1vdmVBY2NvdW50UmlnaHRzKAogICAgICAgIExTQV9IQU5ETEUgUG9saWN5SGFuZGxlLAogICAgICAgIEludFB0ciBBY2NvdW50U2lkLAogICAgICAgIGJvb2wgQWxsUmlnaHRzLAogICAgICAgIHJlZiBMU0FfVU5JQ09ERV9TVFJJTkcgVXNlclJpZ2h0cywKICAgICAgICB1bG9uZyBDb3VudE9mUmlnaHRzCiAgICAgICAgKTsKCiAgICBbRGxsSW1wb3J0KCJhZHZhcGkzMi5kbGwiLCBTZXRMYXN0RXJyb3IgPSB0cnVlKV0KICAgIGludGVybmFsIHN0YXRpYyBleHRlcm4gaW50IExzYUNsb3NlKExTQV9IQU5ETEUgUG9saWN5SGFuZGxlKTsKCiAgICBwcml2YXRlIGVudW0gQWNjZXNzIDogdWludAogICAgewogICAgICAgIFBPTElDWV9SRUFEID0gMHgyMDAwNiwKICAgICAgICBQT0xJQ1lfQUxMX0FDQ0VTUyA9IDB4MDBGMEZGRiwKICAgICAgICBQT0xJQ1lfRVhFQ1VURSA9IDBYMjA4MDEsCiAgICAgICAgUE9MSUNZX1dSSVRFID0gMFgyMDdGOAogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBBZGRBY2NvdW50UmlnaHRzKFNlY3VyaXR5SWRlbnRpZmllciBzaWQsIHN0cmluZyByaWdodHMpCiAgICB7CiAgICAgICAgTFNBX0hBTkRMRSBsc2FIYW5kbGUgPSBJbnRQdHIuWmVybzsKICAgICAgICBMU0FfVU5JQ09ERV9TVFJJTkdbXSBzeXN0ZW0gPSBudWxsOwogICAgICAgIExTQV9PQkpFQ1RfQVRUUklCVVRFUyBsc2FBdHRyOwogICAgICAgIGxzYUF0dHIuUm9vdERpcmVjdG9yeSA9IEludFB0ci5aZXJvOwogICAgICAgIGxzYUF0dHIuT2JqZWN0TmFtZSA9IEludFB0ci5aZXJvOwogICAgICAgIGxzYUF0dHIuQXR0cmlidXRlcyA9IDA7CiAgICAgICAgbHNhQXR0ci5TZWN1cml0eURlc2NyaXB0b3IgPSBJbnRQdHIuWmVybzsKICAgICAgICBsc2FBdHRyLlNlY3VyaXR5UXVhbGl0eU9mU2VydmljZSA9IEludFB0ci5aZXJvOwogICAgICAgIGxzYUF0dHIuTGVuZ3RoID0gKHVsb25nKU1hcnNoYWwuU2l6ZU9mKHR5cGVvZihMU0FfT0JKRUNUX0FUVFJJQlVURVMpKTsKCiAgICAgICAgdWludCByZXQgPSBMc2FPcGVuUG9saWN5KHN5c3RlbSwgcmVmIGxzYUF0dHIsIChpbnQpQWNjZXNzLlBPTElDWV9BTExfQUNDRVNTLCBvdXQgbHNhSGFuZGxlKTsKICAgICAgICBpZiAocmV0ID09IDApCiAgICAgICAgewogICAgICAgICAgICBCeXRlW10gYnVmZmVyID0gbmV3IEJ5dGVbc2lkLkJpbmFyeUxlbmd0aF07CiAgICAgICAgICAgIHNpZC5HZXRCaW5hcnlGb3JtKGJ1ZmZlciwgMCk7CgogICAgICAgICAgICBJbnRQdHIgcFNpZCA9IE1hcnNoYWwuQWxsb2NIR2xvYmFsKHNpZC5CaW5hcnlMZW5ndGgpOwogICAgICAgICAgICBNYXJzaGFsLkNvcHkoYnVmZmVyLCAwLCBwU2lkLCBzaWQuQmluYXJ5TGVuZ3RoKTsKCiAgICAgICAgICAgIExTQV9VTklDT0RFX1NUUklOR1tdIHByaXZpbGVnZXMgPSBuZXcgTFNBX1VOSUNPREVfU1RSSU5HWzFdOwoKICAgICAgICAgICAgTFNBX1VOSUNPREVfU1RSSU5HIGxzYVJpZ2h0cyA9IG5ldyBMU0FfVU5JQ09ERV9TVFJJTkcoKTsKICAgICAgICAgICAgbHNhUmlnaHRzLkJ1ZmZlciA9IHJpZ2h0czsKICAgICAgICAgICAgbHNhUmlnaHRzLkxlbmd0aCA9ICh1c2hvcnQpKHJpZ2h0cy5MZW5ndGggKiBzaXplb2YoY2hhcikpOwogICAgICAgICAgICBsc2FSaWdodHMuTWF4aW11bUxlbmd0aCA9ICh1c2hvcnQpKGxzYVJpZ2h0cy5MZW5ndGggKyBzaXplb2YoY2hhcikpOwoKICAgICAgICAgICAgcHJpdmlsZWdlc1swXSA9IGxzYVJpZ2h0czsKCiAgICAgICAgICAgIHJldCA9IExzYUFkZEFjY291bnRSaWdodHMobHNhSGFuZGxlLCBwU2lkLCBwcml2aWxlZ2VzLCAxKTsKCiAgICAgICAgICAgIExzYUNsb3NlKGxzYUhhbmRsZSk7CgogICAgICAgICAgICBNYXJzaGFsLkZyZWVIR2xvYmFsKHBTaWQpOwoKICAgICAgICAgICAgaWYgKHJldCAhPSAwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgV2luMzJFeGNlcHRpb24oIkxzYUFkZEFjY291bnRSaWdodHMgZmFpbGVkIHdpdGggZXJyb3IgY29kZTogIiArIHJldCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFdpbjMyRXhjZXB0aW9uKCJMc2FPcGVuUG9saWN5IGZhaWxlZCB3aXRoIGVycm9yIGNvZGU6ICIgKyByZXQpOwogICAgICAgIH0KICAgIH0KfQonQAogICAgJHNjcmlwdDpMc2FMaWIgPSBBZGQtVHlwZSAtUGFzc1RocnUgLVR5cGVEZWZpbml0aW9uICRsc2FfdHlwZQogICAgcmV0dXJuICRzY3JpcHQ6THNhTGliCn0KCmZ1bmN0aW9uIEFkZEFjY291bnRSaWdodHMoW1BTQ3JlZGVudGlhbF0kYWNjb3VudCwgW1N0cmluZ1tdXSRyaWdodHMpCnsKICAgICRMc2FMaWIgPSBHZXQtTHNhTGliCiAgICAkZG9tYWluID0gJGFjY291bnQuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5Eb21haW4KICAgICR1c2VyTmFtZSA9ICRhY2NvdW50LkdldE5ldHdvcmtDcmVkZW50aWFsKCkuVXNlck5hbWUKICAgICRpZGVudGl0eSA9IChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuTlRBY2NvdW50KCRkb21haW4sICR1c2VyTmFtZSkpLlRyYW5zbGF0ZShbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXJdKQoKICAgIGZvcmVhY2ggKCRyaWdodCBpbiAkcmlnaHRzKQogICAgewogICAgICAgIFtMc2FTZWN1cml0eVdyYXBwZXJdOjpBZGRBY2NvdW50UmlnaHRzKCRpZGVudGl0eSwgJHJpZ2h0KQogICAgfQp9CgpmdW5jdGlvbiBHZXQtSW1wZXJzb25hdGVMaWIKewogICAgaWYgKCRzY3JpcHQ6SW1wZXJzb25hdGVMaWIpCiAgICB7CiAgICAgICAgcmV0dXJuICRzY3JpcHQ6SW1wZXJzb25hdGVMaWIKICAgIH0KCiAgICAkc2lnID0gQCcKW0RsbEltcG9ydCgiYWR2YXBpMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldCnB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgTG9nb25Vc2VyKHN0cmluZyBscHN6VXNlcm5hbWUsIHN0cmluZyBscHN6RG9tYWluLCBzdHJpbmcgbHBzelBhc3N3b3JkLCBpbnQgZHdMb2dvblR5cGUsIGludCBkd0xvZ29uUHJvdmlkZXIsIHJlZiBJbnRQdHIgcGhUb2tlbik7CgpbRGxsSW1wb3J0KCJrZXJuZWwzMi5kbGwiKV0KcHVibGljIHN0YXRpYyBleHRlcm4gQm9vbGVhbiBDbG9zZUhhbmRsZShJbnRQdHIgaE9iamVjdCk7CidACiAgICRzY3JpcHQ6SW1wZXJzb25hdGVMaWIgPSBBZGQtVHlwZSAtUGFzc1RocnUgLU5hbWVzcGFjZSAnTGliLkltcGVyc29uYXRpb24nIC1OYW1lIEltcGVyc29uYXRpb25MaWIgLU1lbWJlckRlZmluaXRpb24gJHNpZwoKICAgcmV0dXJuICRzY3JpcHQ6SW1wZXJzb25hdGVMaWIKfQoKZnVuY3Rpb24gSW1wZXJzb25hdGVBcyhbUFNDcmVkZW50aWFsXSAkY3JlZCkKewogICAgW0ludFB0cl0gJHVzZXJUb2tlbiA9IFtTZWN1cml0eS5QcmluY2lwYWwuV2luZG93c0lkZW50aXR5XTo6R2V0Q3VycmVudCgpLlRva2VuCiAgICAkdXNlclRva2VuCiAgICAkSW1wZXJzb25hdGVMaWIgPSBHZXQtSW1wZXJzb25hdGVMaWIKCiAgICAkYkxvZ2luID0gJEltcGVyc29uYXRlTGliOjpMb2dvblVzZXIoJGNyZWQuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5Vc2VyTmFtZSwgJGNyZWQuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5Eb21haW4sICRjcmVkLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuUGFzc3dvcmQsCiAgICA5LCAwLCBbcmVmXSR1c2VyVG9rZW4pCgogICAgaWYgKCRiTG9naW4pCiAgICB7CiAgICAgICAgJElkZW50aXR5ID0gTmV3LU9iamVjdCBTZWN1cml0eS5QcmluY2lwYWwuV2luZG93c0lkZW50aXR5ICR1c2VyVG9rZW4KICAgICAgICAkY29udGV4dCA9ICRJZGVudGl0eS5JbXBlcnNvbmF0ZSgpCiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgdGhyb3cgIkNhbid0IGxvZyBvbiBhcyB1c2VyICckKCRjcmVkLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuVXNlck5hbWUpJy4iCiAgICB9CiAgICAkY29udGV4dCwgJHVzZXJUb2tlbgp9CgpmdW5jdGlvbiBDbG9zZVVzZXJUb2tlbihbSW50UHRyXSAkdG9rZW4pCnsKICAgICRJbXBlcnNvbmF0ZUxpYiA9IEdldC1JbXBlcnNvbmF0ZUxpYgoKICAgICRiTG9naW4gPSAkSW1wZXJzb25hdGVMaWI6OkNsb3NlSGFuZGxlKCR0b2tlbikKICAgIGlmICghJGJMb2dpbikKICAgIHsKICAgICAgICB0aHJvdyAiQ2FuJ3QgY2xvc2UgdG9rZW4uIgogICAgfQp9CgoKRXhwb3J0LU1vZHVsZU1lbWJlciAtRnVuY3Rpb24gKi1UYXJnZXRSZXNvdXJjZQo=
