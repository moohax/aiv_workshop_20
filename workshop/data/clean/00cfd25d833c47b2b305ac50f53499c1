SP2013GetSPSearchServiceTopologyState.ps1,3e19fda097ef5881276f1cc2f7f24ed8,Scan result is 1. IsMalware: 0,IyMgU2hhcmVQb2ludCBTZXJ2ZXI6IFBvd2VyU2hlbGwgU2NyaXB0IFRvIENoZWNrIERldGFpbHMgT24gQSBGYXJtcyBTZWFyY2ggU2VydmljZSBBcHBsaWNhdGlvbiBUb3BvbG9neSAjIwoKPCMgCi5TWU5PUFNJUyAKICAgICAgIFRoZSBwdXJwb3NlIG9mIHRoaXMgU2hhcmVQb2ludCAyMDEzIHNjcmlwdCBpcyB0byBwcmVzZW50IHRoZSBzdGF0dXMgb2YgdGhlIFNlYXJjaCAgCiAgICAgICBTZXJ2aWNlIEFwcGxpY2F0aW9uLCB3aXRoIG1haW4gZm9jdXMgb24gdGhlIHN0YXRlIG9mIHRoZSBzZWFyY2ggdG9wb2xvZ3kuICAKLkRFU0NSSVBUSU9OIAogICAgICAgVGhlIHNjcmlwdCBjb25zb2xpZGF0ZXMgZGF0YSBmcm9tIG11bHRpcGxlIGNtZGxldHMgYW5kIHNvdXJjZXM6CiAgICAgICAtIEtleSB0b3BvbG9neSBzdGF0dXMgZGF0YSBmcm9tIEdldC1TUEVudGVycHJpc2VTZWFyY2hTdGF0dXMKICAgICAgICAgICAgIEdldC1TUEVudGVycHJpc2VTZWFyY2hTdGF0dXMgLVNlYXJjaEFwcGxpY2F0aW9uICRzc2EKICAgICAgICAgICAgIEdldC1TUEVudGVycHJpc2VTZWFyY2hTdGF0dXMgLVNlYXJjaEFwcGxpY2F0aW9uICRzc2EgLVByaW1hcnkgLTxBZG1pbiBDb21wb25lbnQ+CiAgICAgICAgICAgICBHZXQtU1BFbnRlcnByaXNlU2VhcmNoU3RhdHVzIC1TZWFyY2hBcHBsaWNhdGlvbiAkc3NhIC1Kb2JTdGF0dXMKICAgICAgICAgICAgIEdldC1TUEVudGVycHJpc2VTZWFyY2hTdGF0dXMgLVNlYXJjaEFwcGxpY2F0aW9uICRzc2EgLUhlYWx0aFJlcG9ydCAtQ29tcG9uZW50IDxTZWFyY2ggQ29tcG9uZW50PgogICAgICAgICAgICAgICAgIFByaW50aW5nIHNlbGVjdGVkIGluZm8gcmVsZXZhbnQgZm9yIGRlZ3JhZGVkIHN0YXRlcwogICAgICAgLSBDcmF3bCBzdGF0dXMgKGNyYXdsaW5nL2lkbGUvcGF1c2VkKQogICAgICAgICAgICAgJHNzYS5Jc3BhdXNlZCgpCiAgICAgICAgICAgICAkY29udGVudFNvdXJjZS5DcmF3bFN0YXRlCiAgICAgICAtIE51bWJlciBvZiBpbmRleGVkIGRvY3VtZW50cyBpbmNsdWRpbmcgaW5kZXggc2l6ZSBhbGVydCAoY3VycmVudGx5IDEwIG1pbGwuIGl0ZW1zIHBlciBwYXJ0aXRpb24pCiAgICAgICAgICAgICBVc2luZyBHZXQtU1BFbnRlcnByaXNlU2VhcmNoU3RhdHVzIC1TZWFyY2hBcHBsaWNhdGlvbiAkc3NhIC1IZWFsdGhSZXBvcnQgLUNvbXBvbmVudCA8U2VhcmNoIENvbXBvbmVudD4KICAgICAgIC0gSEEgc3RhdHVzIGZvciB0b3BvbG9neSwgaW5kaWNhdGluZyB3aGljaCByb2xlcyB0aGF0IG1heSBub3QgaGF2ZSBoaWdoIGF2YWlsYWJpbGl0eQogICAgICAgICAgICAgQWdncmVnYXRlZCBzdGF0dXMgaW5mbyBmcm9tIEdldC1TUEVudGVycHJpc2VTZWFyY2hTdGF0dXMKICAgICAgIC0gSG9zdCBjb250cm9sbGVyIHJlcG9zaXRvcnkgc3RhdHVzIChmb3Igc2VhcmNoIGRpY3Rpb25hcmllcykKICAgICAgICAgICAgIEdldC1TUEVudGVycHJpc2VTZWFyY2hIb3N0Q29udHJvbGxlcgoKICAgICAgIExpbWl0YXRpb25zOgogICAgICAgLSBUaGUgc2NyaXB0IG9ubHkgc3VwcG9ydHMgb25lIFNTQSBpbiB0aGUgZmFybS4gCiAgICAgICAgIElmIG11bHRpcGxlIFNTQXMgZm91bmQsIHRoZSBzY3JpcHQgcHJpbnRzIHN0YXR1cyBmb3IgdGhlIGZpcnN0IFNTQSBmb3VuZC4KLk5PVEVTIAogIEZpbGUgTmFtZSA6IEdldC1TUFNlYXJjaFRvcG9sb2d5U3RhdGUucHMxIAogIFRhZ3MgICAgICA6IFNoYXJlUG9pbnQgMjAxMywgRW50ZXJwcmlzZSBTZWFyY2gsIFNQMjAxM0VTLCBTZWFyY2ggU2VydmljZSBBcHBsaWNhdGlvbgoKLlJFU09VUkNFCiBodHRwOi8vYmxvZ3MubXNkbi5jb20vYi9rbnV0YnJhbi9hcmNoaXZlLzIwMTIvMTEvMzAvaG93LXRvLXZpZXctdGhlLXN0YXR1cy1vZi10aGUtc2hhcmVwb2ludC0yMDEzLXNlYXJjaC1zZXJ2aWNlLmFzcHgKCiM+IAoKQWRkLVBTU25hcGluICJNaWNyb3NvZnQuU2hhcmVQb2ludC5Qb3dlclNoZWxsIiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBHZXQgc3RhdHVzIGZvciBzZWFyY2ggdG9wb2xvZ3kKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyAgV3JpdGVzIGVycm9yIG1lc3NhZ2UgdG8gdGhlIHVzZXIgaW4gcmVkIGNvbG9yIGFuZCBleGl0cyB0aGUgc2NyaXB0LgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCkZ1bmN0aW9uIFdyaXRlRXJyb3JBbmRFeGl0KCRlcnJvclRleHQpCnsKICAgIFdyaXRlLUhvc3QgLUJhY2tncm91bmRDb2xvciBSZWQgLUZvcmVncm91bmRDb2xvciBCbGFjayAkZXJyb3JUZXh0CiAgICBXcml0ZS1Ib3N0IC1CYWNrZ3JvdW5kQ29sb3IgUmVkIC1Gb3JlZ3JvdW5kQ29sb3IgQmxhY2sgIkFib3J0aW5nIHNjcmlwdCIKICAgIGV4aXQKfQoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBHZXRTU0E6IEdldCBTU0EgcmVmZXJlbmNlIAojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpGdW5jdGlvbiBHZXRTU0EKewogICAgJHNzYXMgPSBAKEdldC1TUEVudGVycHJpc2VTZWFyY2hTZXJ2aWNlQXBwbGljYXRpb24pCiAgICBpZiAoJHNzYXMuQ291bnQgLW5lIDEpCiAgICB7CiAgICAgICAgV3JpdGVFcnJvckFuZEV4aXQoIlRoaXMgc2NyaXB0IG9ubHkgc3VwcG9ydHMgYSBzaW5nbGUgU1NBIGNvbmZpZ3VyYXRpb24iKQogICAgfQoKICAgICRnbG9iYWw6c3NhID0gJHNzYXNbMF0KICAgIGlmICgkZ2xvYmFsOnNzYS5TdGF0dXMgLW5lICJPbmxpbmUiKQogICAgewogICAgICAgICRzc2FTdGF0ID0gJGdsb2JhbDpzc2EuU3RhdHVzCiAgICAgICAgV3JpdGVFcnJvckFuZEV4aXQoIkV4cGVjdGVkIFNTQSB0byBoYXZlIHN0YXR1cyAnT25saW5lJywgZm91bmQgc3RhdHVzOiAkc3NhU3RhdCIpCiAgICB9CgogICAgV3JpdGUtT3V0cHV0ICJTU0E6ICQoJGdsb2JhbDpzc2EuTmFtZSkiCiAgICBXcml0ZS1PdXRwdXQgIiIKfQoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBHZXRDcmF3bFN0YXR1czogR2V0IGNyYXdsIHN0YXR1cwojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpGdW5jdGlvbiBHZXRDcmF3bFN0YXR1cwp7CiAgICBpZiAoJGdsb2JhbDpzc2EuSXNwYXVzZWQoKSkKICAgIHsKICAgICAgICBzd2l0Y2ggKCRnbG9iYWw6c3NhLklzcGF1c2VkKCkpIAogICAgICAgIHsgCiAgICAgICAgICAgIDEgICAgICAgeyAkcGF1c2VSZWFzb24gPSAib25nb2luZyBzZWFyY2ggdG9wb2xvZ3kgb3BlcmF0aW9uIiB9IAogICAgICAgICAgICAyICAgICAgIHsgJHBhdXNlUmVhc29uID0gImJhY2t1cC9yZXN0b3JlIiB9IAogICAgICAgICAgICA0ICAgICAgIHsgJHBhdXNlUmVhc29uID0gImJhY2t1cC9yZXN0b3JlIiB9IAogICAgICAgICAgICAzMiAgICAgIHsgJHBhdXNlUmVhc29uID0gImNyYXdsIERCIHJlLWZhY3RvcmluZyIgfSAKICAgICAgICAgICAgNjQgICAgICB7ICRwYXVzZVJlYXNvbiA9ICJsaW5rIERCIHJlLWZhY3RvcmluZyIgfSAKICAgICAgICAgICAgMTI4ICAgICB7ICRwYXVzZVJlYXNvbiA9ICJleHRlcm5hbCByZWFzb24gKHVzZXIgaW5pdGlhdGVkKSIgfSAKICAgICAgICAgICAgMjU2ICAgICB7ICRwYXVzZVJlYXNvbiA9ICJpbmRleCByZXNldCIgfSAKICAgICAgICAgICAgNTEyICAgICB7ICRwYXVzZVJlYXNvbiA9ICJpbmRleCByZS1wYXJ0aXRpb25pbmcgKHF1ZXJ5IGlzIGFsc28gcGF1c2VkKSIgfSAKICAgICAgICAgICAgZGVmYXVsdCB7ICRwYXVzZVJlYXNvbiA9ICJtdWx0aXBsZSByZWFzb25zICgkKCRnbG9iYWw6c3NhLklzcGF1c2VkKCkpKSIgfSAKICAgICAgICB9CiAgICAgICAgV3JpdGUtT3V0cHV0ICIkKCRnbG9iYWw6c3NhLk5hbWUpOiBQYXVzZWQgZm9yICRwYXVzZVJlYXNvbiIKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICAkY3Jhd2xpbmcgPSAkZmFsc2UKICAgICAgICAkY29udGVudFNvdXJjZXMgPSBHZXQtU1BFbnRlcnByaXNlU2VhcmNoQ3Jhd2xDb250ZW50U291cmNlIC1TZWFyY2hBcHBsaWNhdGlvbiAkZ2xvYmFsOnNzYQogICAgICAgIGlmICgkY29udGVudFNvdXJjZXMpIAogICAgICAgIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHNvdXJjZSBpbiAkY29udGVudFNvdXJjZXMpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICgkc291cmNlLkNyYXdsU3RhdGUgLW5lICJJZGxlIikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1PdXRwdXQgIkNyYXdsaW5nICQoJHNvdXJjZS5OYW1lKSA6ICQoJHNvdXJjZS5DcmF3bFN0YXRlKSIKICAgICAgICAgICAgICAgICAgICAkY3Jhd2xpbmcgPSAkdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghICRjcmF3bGluZykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICJDcmF3bGVyIGlzIGlkbGUiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICJDcmF3bGVyOiBObyBjb250ZW50IHNvdXJjZXMgZm91bmQiCiAgICAgICAgfQogICAgfQp9CgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojIEdldFRvcG9sb2d5SW5mbzogR2V0IGJhc2ljIHRvcG9sb2d5IGluZm8gYW5kIGNvbXBvbmVudCBoZWFsdGggc3RhdHVzCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCkZ1bmN0aW9uIEdldFRvcG9sb2d5SW5mbwp7CiAgICAkYXQgPSBHZXQtU1BFbnRlcnByaXNlU2VhcmNoVG9wb2xvZ3kgLVNlYXJjaEFwcGxpY2F0aW9uICRnbG9iYWw6c3NhIC1BY3RpdmUKICAgICRnbG9iYWw6dG9wb2xvZ3lDb21wTGlzdCA9IEdldC1TUEVudGVycHJpc2VTZWFyY2hDb21wb25lbnQgLVNlYXJjaFRvcG9sb2d5ICRhdAoKICAgICMgQ2hlY2sgaWYgdG9wb2xvZ3kgaXMgcHJlcGFyZWQgZm9yIEhBCiAgICAkYWRtaW5Gb3VuZCA9ICRmYWxzZQogICAgZm9yZWFjaCAoJHNlYXJjaENvbXAgaW4gKCRnbG9iYWw6dG9wb2xvZ3lDb21wTGlzdCkpCiAgICB7CiAgICAgICAgaWYgKCRzZWFyY2hDb21wLk5hbWUgLW1hdGNoICJBZG1pbiIpCiAgICAgICAgeyAKICAgICAgICAgICAgaWYgKCRhZG1pbkZvdW5kKSAKICAgICAgICAgICAgeyAKICAgICAgICAgICAgICAgICRnbG9iYWw6aGFUb3BvbG9neSA9ICR0cnVlIAogICAgICAgICAgICB9IAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRhZG1pbkZvdW5kID0gJHRydWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gICAgCgogICAgIwogICAgIyBHZXQgdG9wb2xvZ3kgY29tcG9uZW50IHN0YXRlOgogICAgIwogICAgJGdsb2JhbDpjb21wb25lbnRTdGF0ZUxpc3Q9R2V0LVNQRW50ZXJwcmlzZVNlYXJjaFN0YXR1cyAtU2VhcmNoQXBwbGljYXRpb24gJGdsb2JhbDpzc2EKCiAgICAjIEZpbmQgdGhlIHByaW1hcnkgYWRtaW4gY29tcG9uZW50OgogICAgZm9yZWFjaCAoJGNvbXBvbmVudCBpbiAoJGdsb2JhbDpjb21wb25lbnRTdGF0ZUxpc3QpKQogICAgewogICAgICAgIGlmICggKCRjb21wb25lbnQuTmFtZSAtbWF0Y2ggIkFkbWluIikgLWFuZCAoJGNvbXBvbmVudC5TdGF0ZSAtbmUgIlVua25vd24iKSApCiAgICAgICAgewogICAgICAgICAgICBpZiAoR2V0LVNQRW50ZXJwcmlzZVNlYXJjaFN0YXR1cyAtU2VhcmNoQXBwbGljYXRpb24gJGdsb2JhbDpzc2EgLVByaW1hcnkgLUNvbXBvbmVudCAkKCRjb21wb25lbnQuTmFtZSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRnbG9iYWw6cHJpbWFyeUFkbWluID0gJGNvbXBvbmVudC5OYW1lCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9ICAgIAogICAgaWYgKCEgJGdsb2JhbDpwcmltYXJ5QWRtaW4pCiAgICB7CiAgICAgICAgV3JpdGUtT3V0cHV0ICIiCiAgICAgICAgV3JpdGUtT3V0cHV0ICItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSIKICAgICAgICBXcml0ZS1PdXRwdXQgIkVycm9yOiBOb3QgYWJsZSB0byBvYnRhaW4gaGVhbHRoIHN0YXRlIGluZm9ybWF0aW9uLiIKICAgICAgICBXcml0ZS1PdXRwdXQgIlJlY29tbWVuZGVkIGFjdGlvbjogRW5zdXJlIHRoYXQgYXQgbGVhc3Qgb25lIGFkbWluIGNvbXBvbmVudCBpcyBvcGVyYXRpb25hbC4iCiAgICAgICAgV3JpdGUtT3V0cHV0ICJUaGlzIHN0YXRlIG1heSBhbHNvIGluZGljYXRlIHRoYXQgYW4gYWRtaW4gY29tcG9uZW50IGZhaWxvdmVyIGlzIGluIHByb2dyZXNzLiIKICAgICAgICBXcml0ZS1PdXRwdXQgIi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIgogICAgICAgIFdyaXRlLU91dHB1dCAiIgogICAgICAgIHRocm93ICJTZWFyY2ggY29tcG9uZW50IGhlYWx0aCBzdGF0ZSBjaGVjayBmYWlsZWQiCiAgICB9Cn0KCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgUG9wdWxhdGVIb3N0SGFMaXN0OiBGb3IgZWFjaCBjb21wb25lbnQsIGRldGVybWluZSBwcm9wZXJ0aWVzIGFuZCB1cGRhdGUgJGdsb2JhbDpob3N0QXJyYXkgLyAkZ2xvYmFsOmhhQXJyYXkKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KRnVuY3Rpb24gUG9wdWxhdGVIb3N0SGFMaXN0KCRzZWFyY2hDb21wKQp7CiAgICAgICAgaWYgKCRzZWFyY2hDb21wLlNlcnZlck5hbWUpCiAgICAgICAgewogICAgICAgICAgICAkaG9zdE5hbWUgPSAkc2VhcmNoQ29tcC5TZXJ2ZXJOYW1lCiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgICRob3N0TmFtZSA9ICJVbmtub3duIHNlcnZlciIKICAgICAgICB9CiAgICAgICAgJHBhcnRpdGlvbiA9ICRzZWFyY2hDb21wLkluZGV4UGFydGl0aW9uT3JkaW5hbAogICAgICAgICRuZXdIb3N0Rm91bmQgPSAkdHJ1ZQogICAgICAgICRuZXdIYUZvdW5kID0gJHRydWUKICAgICAgICAkZW50aXR5ID0gJG51bGwKCiAgICAgICAgZm9yZWFjaCAoJHNlYXJjaEhvc3QgaW4gKCRnbG9iYWw6aG9zdEFycmF5KSkKICAgICAgICB7CiAgICAgICAgICAgIGlmICgkc2VhcmNoSG9zdC5ob3N0TmFtZSAtZXEgJGhvc3ROYW1lKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkbmV3SG9zdEZvdW5kID0gJGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCRuZXdIb3N0Rm91bmQpCiAgICAgICAgewogICAgICAgICAgICAjIEFkZCB0aGUgaG9zdCB0byAkZ2xvYmFsOmhvc3RBcnJheQogICAgICAgICAgICAkaG9zdFRlbXAgPSAkZ2xvYmFsOmhvc3RUZW1wbGF0ZSB8IFNlbGVjdC1PYmplY3QgKgogICAgICAgICAgICAkaG9zdFRlbXAuaG9zdE5hbWUgPSAkaG9zdE5hbWUKICAgICAgICAgICAgJGdsb2JhbDpob3N0QXJyYXkgKz0gJGhvc3RUZW1wCiAgICAgICAgICAgICRnbG9iYWw6c2VhcmNoSG9zdHMgKz0gMQogICAgICAgIH0KCiAgICAgICAgIyBGaWxsIGluIGNvbXBvbmVudCBzcGVjaWZpYyBkYXRhIGluICRnbG9iYWw6aG9zdEFycmF5CiAgICAgICAgZm9yZWFjaCAoJHNlYXJjaEhvc3QgaW4gKCRnbG9iYWw6aG9zdEFycmF5KSkKICAgICAgICB7CiAgICAgICAgICAgIGlmICgkc2VhcmNoSG9zdC5ob3N0TmFtZSAtZXEgJGhvc3ROYW1lKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkcGFydGl0aW9uID0gLTEKICAgICAgICAgICAgICAgIGlmICgkc2VhcmNoQ29tcC5OYW1lIC1tYXRjaCAiUXVlcnkiKSAKICAgICAgICAgICAgICAgIHsgCiAgICAgICAgICAgICAgICAgICAgJGVudGl0eSA9ICJRdWVyeVByb2Nlc3NpbmdDb21wb25lbnQiIAogICAgICAgICAgICAgICAgICAgICRzZWFyY2hIb3N0LnFwYyA9ICJRdWVyeVByb2Nlc3NpbmcgIgogICAgICAgICAgICAgICAgICAgICRzZWFyY2hIb3N0LmNvbXBvbmVudHMgKz0gMQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmICgkc2VhcmNoQ29tcC5OYW1lIC1tYXRjaCAiQ29udGVudCIpIAogICAgICAgICAgICAgICAgeyAKICAgICAgICAgICAgICAgICAgICAkZW50aXR5ID0gIkNvbnRlbnRQcm9jZXNzaW5nQ29tcG9uZW50IiAKICAgICAgICAgICAgICAgICAgICAkc2VhcmNoSG9zdC5jcGMgPSAiQ29udGVudFByb2Nlc3NpbmcgIgogICAgICAgICAgICAgICAgICAgICRzZWFyY2hIb3N0LmNvbXBvbmVudHMgKz0gMQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmICgkc2VhcmNoQ29tcC5OYW1lIC1tYXRjaCAiQW5hbHl0aWNzIikgCiAgICAgICAgICAgICAgICB7IAogICAgICAgICAgICAgICAgICAgICRlbnRpdHkgPSAiQW5hbHl0aWNzUHJvY2Vzc2luZ0NvbXBvbmVudCIgCiAgICAgICAgICAgICAgICAgICAgJHNlYXJjaEhvc3QuYXBjID0gIkFuYWx5dGljc1Byb2Nlc3NpbmcgIgogICAgICAgICAgICAgICAgICAgICRzZWFyY2hIb3N0LmNvbXBvbmVudHMgKz0gMQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmICgkc2VhcmNoQ29tcC5OYW1lIC1tYXRjaCAiQWRtaW4iKSAKICAgICAgICAgICAgICAgIHsgCiAgICAgICAgICAgICAgICAgICAgJGVudGl0eSA9ICJBZG1pbkNvbXBvbmVudCIgCiAgICAgICAgICAgICAgICAgICAgaWYgKCRzZWFyY2hDb21wLk5hbWUgLWVxICRnbG9iYWw6cHJpbWFyeUFkbWluKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNlYXJjaEhvc3QucEFkbWluID0gIkFkbWluKFByaW1hcnkpICIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNlYXJjaEhvc3Quc0FkbWluID0gIkFkbWluICIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHNlYXJjaEhvc3QuY29tcG9uZW50cyArPSAxCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYgKCRzZWFyY2hDb21wLk5hbWUgLW1hdGNoICJDcmF3bCIpIAogICAgICAgICAgICAgICAgeyAKICAgICAgICAgICAgICAgICAgICAkZW50aXR5ID0gIkNyYXdsQ29tcG9uZW50IiAKICAgICAgICAgICAgICAgICAgICAkc2VhcmNoSG9zdC5jcmF3bGVyID0gIkNyYXdsZXIgIgogICAgICAgICAgICAgICAgICAgICRzZWFyY2hIb3N0LmNvbXBvbmVudHMgKz0gMQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmICgkc2VhcmNoQ29tcC5OYW1lIC1tYXRjaCAiSW5kZXgiKSAKICAgICAgICAgICAgICAgIHsgCiAgICAgICAgICAgICAgICAgICAgJGVudGl0eSA9ICJJbmRleENvbXBvbmVudCIKICAgICAgICAgICAgICAgICAgICAkcGFydGl0aW9uID0gJHNlYXJjaENvbXAuSW5kZXhQYXJ0aXRpb25PcmRpbmFsCiAgICAgICAgICAgICAgICAgICAgJHNlYXJjaEhvc3QuaW5kZXggPSAiSW5kZXhQYXJ0aXRpb24oJHBhcnRpdGlvbikgIgogICAgICAgICAgICAgICAgICAgICRzZWFyY2hIb3N0LmNvbXBvbmVudHMgKz0gMQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgCiAgICAgICAgIyBGaWxsIGluIGNvbXBvbmVudCBzcGVjaWZpYyBkYXRhIGluICRnbG9iYWw6aGFBcnJheQogICAgICAgIGZvcmVhY2ggKCRoYUVudGl0eSBpbiAoJGdsb2JhbDpoYUFycmF5KSkKICAgICAgICB7CiAgICAgICAgICAgIGlmICgkaGFFbnRpdHkuZW50aXR5IC1lcSAkZW50aXR5KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoJGVudGl0eSAtZXEgIkluZGV4Q29tcG9uZW50IikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJGhhRW50aXR5LnBhcnRpdGlvbiAtZXEgJHBhcnRpdGlvbikKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICRuZXdIYUZvdW5kID0gJGZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgICAgIHsgCiAgICAgICAgICAgICAgICAgICAgJG5ld0hhRm91bmQgPSAkZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoJG5ld0hhRm91bmQpCiAgICAgICAgewogICAgICAgICAgICAjIEFkZCB0aGUgSEEgZW50aXRpZXMgdG8gJGdsb2JhbDpoYUFycmF5CiAgICAgICAgICAgICRoYVRlbXAgPSAkZ2xvYmFsOmhhVGVtcGxhdGUgfCBTZWxlY3QtT2JqZWN0ICoKICAgICAgICAgICAgJGhhVGVtcC5lbnRpdHkgPSAkZW50aXR5CiAgICAgICAgICAgICRoYVRlbXAuY29tcG9uZW50cyA9IDEKICAgICAgICAgICAgaWYgKCRwYXJ0aXRpb24gLW5lIC0xKSAKICAgICAgICAgICAgeyAKICAgICAgICAgICAgICAgICRoYVRlbXAucGFydGl0aW9uID0gJHBhcnRpdGlvbiAKICAgICAgICAgICAgfQogICAgICAgICAgICAkZ2xvYmFsOmhhQXJyYXkgKz0gJGhhVGVtcAogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBmb3JlYWNoICgkaGFFbnRpdHkgaW4gKCRnbG9iYWw6aGFBcnJheSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICgkaGFFbnRpdHkuZW50aXR5IC1lcSAkZW50aXR5KSAKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKCRlbnRpdHkgLWVxICJJbmRleENvbXBvbmVudCIpICkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkaGFFbnRpdHkucGFydGl0aW9uIC1lcSAkcGFydGl0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaGFFbnRpdHkuY29tcG9uZW50cyArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGhhRW50aXR5LmNvbXBvbmVudHMgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCRoYUVudGl0eS5lbnRpdHkgLWVxICJBZG1pbkNvbXBvbmVudCIpIC1hbmQgKCRzZWFyY2hDb21wLk5hbWUgLWVxICRnbG9iYWw6cHJpbWFyeUFkbWluKSkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGhhRW50aXR5LnByaW1hcnkgPSAkZ2xvYmFsOnByaW1hcnlBZG1pbgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQp9CgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojIEFuYWx5dGljc1N0YXR1czogT3V0cHV0IHN0YXR1cyBvZiBhbmFseXRpY3Mgam9icwojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpGdW5jdGlvbiBBbmFseXRpY3NTdGF0dXMKewogICAgV3JpdGUtT3V0cHV0ICJBbmFseXRpY3MgUHJvY2Vzc2luZyBKb2IgU3RhdHVzOiIKICAgICRhbmFseXRpY3NTdGF0dXMgPSBHZXQtU1BFbnRlcnByaXNlU2VhcmNoU3RhdHVzIC1TZWFyY2hBcHBsaWNhdGlvbiAkZ2xvYmFsOnNzYSAtSm9iU3RhdHVzCgogICAgZm9yZWFjaCAoJGFuYWx5dGljc0VudHJ5IGluICRhbmFseXRpY3NTdGF0dXMpCiAgICB7CiAgICAgICAgaWYgKCRhbmFseXRpY3NFbnRyeS5OYW1lIC1uZSAiTm90IGF2YWlsYWJsZSIpICAgICAKICAgICAgICB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRkZSBpbiAoJGFuYWx5dGljc0VudHJ5LkRldGFpbHMpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoJGRlLktleSAtZXEgIlN0YXR1cyIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyA9ICRkZS5WYWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAiICAgICQoJGFuYWx5dGljc0VudHJ5Lk5hbWUpIDogJHN0YXR1cyIKICAgICAgICB9CiAgICAgICAgIyBPdXRwdXQgYWRkaXRpb25hbCBkaWFnbm9zdGljcyBmcm9tIHRoZSBkaWN0aW9uYXJ5CiAgICAgICAgZm9yZWFjaCAoJGRlIGluICgkYW5hbHl0aWNzRW50cnkuRGV0YWlscykpCiAgICAgICAgewogICAgICAgICAgICAjIFNraXAgZW50cmllcyB0aGF0IGlzIGxpc3RlZCBhcyBOb3QgQXZhaWxhYmxlCiAgICAgICAgICAgIGlmICggKCRkZS5WYWx1ZSAtbmUgIk5vdCBhdmFpbGFibGUiKSAtYW5kICgkZGUuS2V5IC1uZSAiQWN0aXZpdHkiKSAtYW5kICgkZGUuS2V5IC1uZSAiU3RhdHVzIikgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBXcml0ZS1PdXRwdXQgIiAgICAgICAgJCgkZGUuS2V5KTogJCgkZGUuVmFsdWUpIgogICAgICAgICAgICAgICAgaWYgKCRkZS5LZXkgLW1hdGNoICJMYXN0IHN1Y2Nlc3NmdWwgc3RhcnQgdGltZSIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJGRMYXN0ID0gR2V0LURhdGUgJGRlLlZhbHVlCiAgICAgICAgICAgICAgICAgICAgJGROb3cgPSBHZXQtRGF0ZQogICAgICAgICAgICAgICAgICAgICRkYXlzU2luY2VMYXN0U3VjY2VzcyA9ICRkTm93LkRheU9mWWVhciAtICRkTGFzdC5EYXlPZlllYXIKICAgICAgICAgICAgICAgICAgICBpZiAoJGRheXNTaW5jZUxhc3RTdWNjZXNzIC1ndCAzKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICIgICAgICAgIFdhcm5pbmc6IE1vcmUgdGhhbiB0aHJlZSBkYXlzIHNpbmNlIGxhc3Qgc3VjY2Vzc2Z1bCBydW4iCiAgICAgICAgICAgICAgICAgICAgICAgICRnbG9iYWw6c2VydmljZURlZ3JhZGVkID0gJHRydWUgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBXcml0ZS1PdXRwdXQgIiIKfQoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBTZWFyY2hDb21wb25lbnRTdGF0dXM6IEFuYWx5emUgdGhlIGNvbXBvbmVudCBzdGF0dXMgZm9yIG9uZSBjb21wb25lbnQKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KRnVuY3Rpb24gU2VhcmNoQ29tcG9uZW50U3RhdHVzKCRjb21wb25lbnQpCnsKICAgICMgRmluZCBob3N0IG5hbWUKICAgIGZvcmVhY2goJHNlYXJjaENvbXAgaW4gKCRnbG9iYWw6dG9wb2xvZ3lDb21wTGlzdCkpCiAgICB7CiAgICAgICAgaWYgKCRzZWFyY2hDb21wLk5hbWUgLWVxICRjb21wb25lbnQuTmFtZSkKICAgICAgICB7CiAgICAgICAgICAgIGlmICgkc2VhcmNoQ29tcC5TZXJ2ZXJOYW1lKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkaG9zdE5hbWUgPSAkc2VhcmNoQ29tcC5TZXJ2ZXJOYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkaG9zdE5hbWUgPSAiTm8gc2VydmVyIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGNvbXBvbmVudC4gVGhlIHNlcnZlciBtYXkgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGUgZmFybS4iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBpZiAoJGNvbXBvbmVudC5TdGF0ZSAtbmUgIkFjdGl2ZSIpCiAgICB7CiAgICAgICAgIyBTdHJpbmcgd2l0aCBhbGwgY29tcG9uZW50cyB0aGF0IGlzIG5vdCBhY3RpdmU6CiAgICAgICAgaWYgKCRjb21wb25lbnQuU3RhdGUgLWVxICJVbmtub3duIikKICAgICAgICB7CiAgICAgICAgICAgICRnbG9iYWw6dW5rbm93bkNvbXBvbmVudHMgKz0gIiQoJGNvbXBvbmVudC5OYW1lKTokKCRjb21wb25lbnQuU3RhdGUpIgogICAgICAgIH0KICAgICAgICBlbHNlaWYgKCRjb21wb25lbnQuU3RhdGUgLWVxICJEZWdyYWRlZCIpCiAgICAgICAgewogICAgICAgICAgICAkZ2xvYmFsOmRlZ3JhZGVkQ29tcG9uZW50cyArPSAiJCgkY29tcG9uZW50Lk5hbWUpOiQoJGNvbXBvbmVudC5TdGF0ZSkiCiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgICRnbG9iYWw6ZmFpbGVkQ29tcG9uZW50cyArPSAiJCgkY29tcG9uZW50Lk5hbWUpOiQoJGNvbXBvbmVudC5TdGF0ZSkiCiAgICAgICAgfQogICAgICAgICRnbG9iYWw6c2VydmljZURlZ3JhZGVkID0gJHRydWUKICAgIH0KICAgIAogICAgIyBTa2lwIHVubmVjZXNzYXJ5IGluZm8gYWJvdXQgY2VsbHMgYW5kIHBhcnRpdGlvbnMgaWYgZXZlcnl0aGluZyBpcyBmaW5lCiAgICAkb3V0cHV0RW50cnkgPSAkdHJ1ZQogICAgCiAgICAjIEluZGVudCB0aGUgY2VsbCBpbmZvLCBsb2dpY2FsbHkgYmVsb25ncyB0byB0aGUgY29tcG9uZW50LiAKICAgIGlmICgkY29tcG9uZW50Lk5hbWUgLW1hdGNoICJDZWxsIikKICAgIHsKICAgICAgICBpZiAoJGNvbXBvbmVudC5TdGF0ZSAtZXEgIkFjdGl2ZSIpCiAgICAgICAgewogICAgICAgICAgICAkb3V0cHV0RW50cnkgPSAkZmFsc2UKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICIgICAgJCgkY29tcG9uZW50Lk5hbWUpIgogICAgICAgIH0KICAgIH0KICAgIGVsc2VpZiAoJGNvbXBvbmVudC5OYW1lIC1tYXRjaCAiUGFydGl0aW9uIikKICAgIHsKICAgICAgICBpZiAoJGNvbXBvbmVudC5TdGF0ZSAtZXEgIkFjdGl2ZSIpCiAgICAgICAgewogICAgICAgICAgICAkb3V0cHV0RW50cnkgPSAkZmFsc2UKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICJJbmRleCAkKCRjb21wb25lbnQuTmFtZSkiCiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgICMgU3RhdGUgZm9yIHNlYXJjaCBjb21wb25lbnRzCiAgICAgICAgJHByaW1hcnlTdHJpbmcgPSAiIgogICAgICAgIGlmICgkY29tcG9uZW50Lk5hbWUgLW1hdGNoICJRdWVyeSIpIHsgJGVudGl0eSA9ICJRdWVyeVByb2Nlc3NpbmdDb21wb25lbnQiIH0KICAgICAgICBlbHNlaWYgKCRjb21wb25lbnQuTmFtZSAtbWF0Y2ggIkNvbnRlbnQiKSB7ICRlbnRpdHkgPSAiQ29udGVudFByb2Nlc3NpbmdDb21wb25lbnQiIH0KICAgICAgICBlbHNlaWYgKCRjb21wb25lbnQuTmFtZSAtbWF0Y2ggIkFuYWx5dGljcyIpIHsgJGVudGl0eSA9ICJBbmFseXRpY3NQcm9jZXNzaW5nQ29tcG9uZW50IiB9CiAgICAgICAgZWxzZWlmICgkY29tcG9uZW50Lk5hbWUgLW1hdGNoICJDcmF3bCIpIHsgJGVudGl0eSA9ICJDcmF3bENvbXBvbmVudCIgfQogICAgICAgIGVsc2VpZiAoJGNvbXBvbmVudC5OYW1lIC1tYXRjaCAiQWRtaW4iKSAKICAgICAgICB7IAogICAgICAgICAgICAkZW50aXR5ID0gIkFkbWluQ29tcG9uZW50IiAKICAgICAgICAgICAgaWYgKCRnbG9iYWw6aGFUb3BvbG9neSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKCRjb21wb25lbnQuTmFtZSAtZXEgJGdsb2JhbDpwcmltYXJ5QWRtaW4pCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJHByaW1hcnlTdHJpbmcgPSAiIChQcmltYXJ5KSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYgKCRjb21wb25lbnQuTmFtZSAtbWF0Y2ggIkluZGV4IikgCiAgICAgICAgeyAKICAgICAgICAgICAgJGVudGl0eSA9ICJJbmRleENvbXBvbmVudCIKICAgICAgICAgICAgZm9yZWFjaCAoJHNlYXJjaENvbXAgaW4gKCRnbG9iYWw6dG9wb2xvZ3lDb21wTGlzdCkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICgkc2VhcmNoQ29tcC5OYW1lIC1lcSAkY29tcG9uZW50Lk5hbWUpIAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRwYXJ0aXRpb24gPSAkc2VhcmNoQ29tcC5JbmRleFBhcnRpdGlvbk9yZGluYWwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAjIGZpbmQgaW5mbyBhYm91dCBwcmltYXJ5IHJvbGUKICAgICAgICAgICAgZm9yZWFjaCAoJGRlIGluICgkY29tcG9uZW50LkRldGFpbHMpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoJGRlLktleSAtZXEgIlByaW1hcnkiKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGlmICgkZGUuVmFsdWUgLWVxICJUcnVlIikKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwcmltYXJ5U3RyaW5nID0gIiAoUHJpbWFyeSkiCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRoYUVudGl0eSBpbiAoJGdsb2JhbDpoYUFycmF5KSkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCgkaGFFbnRpdHkuZW50aXR5IC1lcSAkZW50aXR5KSAtYW5kICgkaGFFbnRpdHkucGFydGl0aW9uIC1lcSAkcGFydGl0aW9uKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaGFFbnRpdHkucHJpbWFyeSA9ICRjb21wb25lbnQuTmFtZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3JlYWNoICgkaGFFbnRpdHkgaW4gKCRnbG9iYWw6aGFBcnJheSkpCiAgICAgICAgewogICAgICAgICAgICBpZiAoICgkaGFFbnRpdHkuZW50aXR5IC1lcSAkZW50aXR5KSAtYW5kICgkY29tcG9uZW50LlN0YXRlIC1lcSAiQWN0aXZlIikgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoJGVudGl0eSAtZXEgIkluZGV4Q29tcG9uZW50IikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJGhhRW50aXR5LnBhcnRpdGlvbiAtZXEgJHBhcnRpdGlvbikKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICRoYUVudGl0eS5jb21wb25lbnRzT2sgKz0gMQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgICAgICB7IAogICAgICAgICAgICAgICAgICAgICRoYUVudGl0eS5jb21wb25lbnRzT2sgKz0gMQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICMgQWRkIHRoZSBjb21wb25lbnQgZW50aXRpZXMgdG8gJGdsb2JhbDpjb21wQXJyYXkgZm9yIG91dHB1dCBmb3JtYXR0aW5nCiAgICAgICAgJGNvbXBUZW1wID0gJGdsb2JhbDpjb21wVGVtcGxhdGUgfCBTZWxlY3QtT2JqZWN0ICoKICAgICAgICAkY29tcFRlbXAuQ29tcG9uZW50ID0gIiQoJGNvbXBvbmVudC5OYW1lKSRwcmltYXJ5U3RyaW5nIgogICAgICAgICRjb21wVGVtcC5TZXJ2ZXIgPSAkaG9zdE5hbWUKICAgICAgICAkY29tcFRlbXAuU3RhdGUgPSAkY29tcG9uZW50LlN0YXRlCiAgICAgICAgaWYgKCRwYXJ0aXRpb24gLW5lIC0xKSAKICAgICAgICB7IAogICAgICAgICAgICAkY29tcFRlbXAuUGFydGl0aW9uID0gJHBhcnRpdGlvbiAKICAgICAgICB9CiAgICAgICAgJGdsb2JhbDpjb21wQXJyYXkgKz0gJGNvbXBUZW1wCgogICAgICAgIGlmICgkY29tcG9uZW50LlN0YXRlIC1lcSAiQWN0aXZlIikKICAgICAgICB7CiAgICAgICAgICAgICRvdXRwdXRFbnRyeSA9ICRmYWxzZQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBXcml0ZS1PdXRwdXQgIiQoJGNvbXBvbmVudC5OYW1lKSIKICAgICAgICB9CiAgICB9CiAgICBpZiAoJG91dHB1dEVudHJ5KQogICAgewogICAgICAgIGlmICgkY29tcG9uZW50LlN0YXRlKQogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICIgICAgU3RhdGU6ICQoJGNvbXBvbmVudC5TdGF0ZSkiCiAgICAgICAgfQogICAgICAgIGlmICgkaG9zdE5hbWUpCiAgICAgICAgewogICAgICAgICAgICBXcml0ZS1PdXRwdXQgIiAgICBTZXJ2ZXI6ICRob3N0TmFtZSIKICAgICAgICB9CiAgICAgICAgaWYgKCRjb21wb25lbnQuTWVzc2FnZSkKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAiICAgIERldGFpbHM6ICQoJGNvbXBvbmVudC5NZXNzYWdlKSIKICAgICAgICB9CiAgICAKICAgICAgICAjIE91dHB1dCBhZGRpdGlvbmFsIGRpYWdub3N0aWNzIGZyb20gdGhlIGRpY3Rpb25hcnkKICAgICAgICBmb3JlYWNoICgkZGUgaW4gKCRjb21wb25lbnQuRGV0YWlscykpCiAgICAgICAgewogICAgICAgICAgICBpZiAoJGRlLktleSAtbmUgIkhvc3QiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBXcml0ZS1PdXRwdXQgIiAgICAkKCRkZS5LZXkpOiAkKCRkZS5WYWx1ZSkiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCRnbG9iYWw6aGFUb3BvbG9neSkKICAgICAgICB7CiAgICAgICAgICAgIGlmICgkY29tcG9uZW50Lk5hbWUgLWVxICRnbG9iYWw6cHJpbWFyeUFkbWluKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBXcml0ZS1PdXRwdXQgIiAgICBQcmltYXJ5OiBUcnVlIiAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZiAoJGNvbXBvbmVudC5OYW1lIC1tYXRjaCAiQWRtaW4iKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBXcml0ZS1PdXRwdXQgIiAgICBQcmltYXJ5OiBGYWxzZSIgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBEZXRhaWxlZEluZGV4ZXJEaWFnOiBPdXRwdXQgc2VsZWN0ZWQgaW5mbyBmcm9tIGRldGFpbGVkIGNvbXBvbmVudCBkaWFnCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCkZ1bmN0aW9uIERldGFpbGVkSW5kZXhlckRpYWcKewogICAgJGluZGV4ZXJJbmZvID0gQCgpCiAgICAkZ2VuZXJhdGlvbkluZm8gPSBAKCkKICAgICRnZW5lcmF0aW9uID0gMAoKICAgIGZvcmVhY2ggKCRzZWFyY2hDb21wIGluICgkZ2xvYmFsOmNvbXBvbmVudFN0YXRlTGlzdCkpCiAgICB7CiAgICAgICAgJGNvbXBvbmVudCA9ICRzZWFyY2hDb21wLk5hbWUKICAgICAgICBpZiAoICgoJGNvbXBvbmVudCAtbWF0Y2ggIkluZGV4IikgLW9yICgkY29tcG9uZW50IC1tYXRjaCAiQ29udGVudCIpIC1vciAoJGNvbXBvbmVudCAtbWF0Y2ggIkFkbWluIikpIC1hbmQgKCRjb21wb25lbnQgLW5vdG1hdGNoICJDZWxsIikgLWFuZCAoJHNlYXJjaENvbXAuU3RhdGUgLW5vdG1hdGNoICJVbmtub3duIikgLWFuZCAoJHNlYXJjaENvbXAuU3RhdGUgLW5vdG1hdGNoICJSZWdpc3RlcmluZyIpKQogICAgICAgIHsKICAgICAgICAgICAgJHBsPUdldC1TUEVudGVycHJpc2VTZWFyY2hTdGF0dXMgLVNlYXJjaEFwcGxpY2F0aW9uICRnbG9iYWw6c3NhIC1IZWFsdGhSZXBvcnQgLUNvbXBvbmVudCAkY29tcG9uZW50CiAgICAgICAgICAgIGZvcmVhY2ggKCRlbnRyeSBpbiAoJHBsKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKCRlbnRyeS5OYW1lIC1tYXRjaCAicGx1Z2luOiBudW1iZXIgb2YgZG9jdW1lbnRzIikgCiAgICAgICAgICAgICAgICB7IAogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRoYUVudGl0eSBpbiAoJGdsb2JhbDpoYUFycmF5KSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJGhhRW50aXR5LmVudGl0eSAtZXEgIkluZGV4Q29tcG9uZW50IikgLWFuZCAoJGhhRW50aXR5LnByaW1hcnkgLWVxICRjb21wb25lbnQpKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIENvdW50IGluZGV4ZWQgZG9jdW1lbnRzIGZyb20gYWxsIGluZGV4IHBhcnRpdGlvbnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZ2xvYmFsOmluZGV4ZWREb2NzICs9ICRlbnRyeS5NZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaGFFbnRpdHkuZG9jcyA9ICRlbnRyeS5NZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoJGVudHJ5Lk5hbWUgLW1hdGNoICJyZXBhcnRpdGlvbiIpCiAgICAgICAgICAgICAgICAgICAgeyAkaW5kZXhlckluZm8gKz0gIkluZGV4IHJlLXBhcnRpdGlvbmluZyBzdGF0ZTogJCgkZW50cnkuTWVzc2FnZSkiIH0KICAgICAgICAgICAgICAgIGVsc2VpZiAoKCRlbnRyeS5OYW1lIC1tYXRjaCAic3BsaXR0aW5nIikgLWFuZCAoJGVudHJ5Lk5hbWUgLW1hdGNoICJmdXNpb24iKSkgCiAgICAgICAgICAgICAgICAgICAgeyAkaW5kZXhlckluZm8gKz0gIiRjb21wb25lbnQgOiBTcGxpdHRpbmcgaW5kZXggcGFydGl0aW9uIChhcHByLiAkKCRlbnRyeS5NZXNzYWdlKSAlIGZpbmlzaGVkKSIgfQogICAgICAgICAgICAgICAgZWxzZWlmICgoJGVudHJ5Lk5hbWUgLW1hdGNoICJtYXN0ZXIgbWVyZ2UgcnVubmluZyIpIC1hbmQgKCRlbnRyeS5NZXNzYWdlIC1tYXRjaCAidHJ1ZSIpKSAKICAgICAgICAgICAgICAgIHsgCiAgICAgICAgICAgICAgICAgICAgJGluZGV4ZXJJbmZvICs9ICIkY29tcG9uZW50IDogSW5kZXggTWFzdGVyIE1lcmdlIChkZS1mcmFnbWVudCBpbmRleCBmaWxlcykgaW4gcHJvZ3Jlc3MiIAogICAgICAgICAgICAgICAgICAgICRnbG9iYWw6bWFzdGVyTWVyZ2UgPSAkdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmICgkZ2xvYmFsOmRlZ3JhZGVkQ29tcG9uZW50cyAtYW5kICgkZW50cnkuTmFtZSAtbWF0Y2ggInBsdWdpbjogbmV3ZXN0IGdlbmVyYXRpb24gaWQiKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAjIElmIGF0IGxlYXN0IG9uZSBpbmRleCBjb21wb25lbnQgaXMgbGVmdCBiZWhpbmQsIHdlIHdhbnQgdG8gb3V0cHV0IHRoZSBnZW5lcmF0aW9uIG51bWJlci4gIAogICAgICAgICAgICAgICAgICAgICRnZW5lcmF0aW9uSW5mbyArPSAiJGNvbXBvbmVudCA6IEluZGV4IGdlbmVyYXRpb246ICQoJGVudHJ5Lk1lc3NhZ2UpIiAKICAgICAgICAgICAgICAgICAgICAkZ2VuID0gW2ludF0gJGVudHJ5Lk1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICBpZiAoJGdlbmVyYXRpb24gLWFuZCAoJGdlbmVyYXRpb24gLW5lICRnZW4pKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBWZXJpZnkgaWYgdGhlcmUgYXJlIGRpZmZlcmVudCBnZW5lcmF0aW9uIElEcyBmb3IgdGhlIGluZGV4ZXJzCiAgICAgICAgICAgICAgICAgICAgICAgICRnbG9iYWw6Z2VuZXJhdGlvbkRpZmZlcmVuY2UgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkZ2VuZXJhdGlvbiA9ICRnZW4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2VpZiAoKCRlbnRyeS5MZXZlbCAtZXEgIkVycm9yIikgLW9yICgkZW50cnkuTGV2ZWwgLWVxICJXYXJuaW5nIikpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJGdsb2JhbDpzZXJ2aWNlRGVncmFkZWQgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgIGlmICgkZW50cnkuTmFtZSAtbWF0Y2ggImZhc3RzZXJ2ZXIiKQogICAgICAgICAgICAgICAgICAgICAgICB7ICRpbmRleGVySW5mbyArPSAiJGNvbXBvbmVudCAoJCgkZW50cnkuTGV2ZWwpKSA6IEluZGV4ZXIgcGx1Z2luIGVycm9yICgkKCRlbnRyeS5OYW1lKTokKCRlbnRyeS5NZXNzYWdlKSkiIH0KICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKCRlbnRyeS5NZXNzYWdlIC1tYXRjaCAiZnJhZ21lbnRzIikKICAgICAgICAgICAgICAgICAgICAgICAgeyAkaW5kZXhlckluZm8gKz0gIiRjb21wb25lbnQgKCQoJGVudHJ5LkxldmVsKSkgOiBNaXNzaW5nIGluZGV4IHBhcnRpdGlvbiIgfQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoKCRlbnRyeS5OYW1lIC1tYXRjaCAiYWN0aXZlIikgLWFuZCAoJGVudHJ5Lk1lc3NhZ2UgLW1hdGNoICJub3QgYWN0aXZlIikpCiAgICAgICAgICAgICAgICAgICAgICAgIHsgJGluZGV4ZXJJbmZvICs9ICIkY29tcG9uZW50ICgkKCRlbnRyeS5MZXZlbCkpIDogSW5kZXhlciBnZW5lcmF0aW9uIGNvbnRyb2xsZXIgaXMgbm90IHJ1bm5pbmcuIFBvdGVudGlhbCByZWFzb246IEFsbCBpbmRleCBwYXJ0aXRpb25zIGFyZSBub3QgYXZhaWxhYmxlIiB9CiAgICAgICAgICAgICAgICAgICAgZWxzZWlmICggKCRlbnRyeS5OYW1lIC1tYXRjaCAiaW5fc3luYyIpIC1vciAoJGVudHJ5Lk5hbWUgLW1hdGNoICJsZWZ0X2JlaGluZCIpICkKICAgICAgICAgICAgICAgICAgICB7IAogICAgICAgICAgICAgICAgICAgICAgICAjIEluZGljYXRlcyByZXBsaWNhcyBhcmUgb3V0IG9mIHN5bmMsIGNhdGNoaW5nIHVwLiBSZWR1bmRhbnQgaW5mbyBpbiB0aGlzIHNjcmlwdAogICAgICAgICAgICAgICAgICAgICAgICAkZ2xvYmFsOmluZGV4TGVmdEJlaGluZCA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKCRlbnRyeS5OYW1lIC1tYXRjaCAiZnVsbF9xdWV1ZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHsgJGluZGV4ZXJJbmZvICs9ICIkY29tcG9uZW50IDogSXRlbXMgcXVldWluZyB1cCBpbiBmZWVkaW5nICgkKCRlbnRyeS5NZXNzYWdlKSkiIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoJGVudHJ5Lk1lc3NhZ2UgLW5vdG1hdGNoICJObyBwcmltYXJ5IikKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICRpbmRleGVySW5mbyArPSAiJGNvbXBvbmVudCAoJCgkZW50cnkuTGV2ZWwpKSA6ICQoJGVudHJ5Lk5hbWUpOiQoJGVudHJ5Lk1lc3NhZ2UpIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gCgogICAgaWYgKCRpbmRleGVySW5mbykKICAgIHsKICAgICAgICBXcml0ZS1PdXRwdXQgIiIKICAgICAgICBXcml0ZS1PdXRwdXQgIkluZGV4ZXIgcmVsYXRlZCBhZGRpdGlvbmFsIHN0YXR1cyBpbmZvcm1hdGlvbjoiCiAgICAgICAgZm9yZWFjaCAoJGluZGV4ZXJJbmZvRW50cnkgaW4gKCRpbmRleGVySW5mbykpCiAgICAgICAgeyAgICAgICAgCiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAiICAgICRpbmRleGVySW5mb0VudHJ5IgogICAgICAgIH0KICAgICAgICBpZiAoJGdsb2JhbDppbmRleExlZnRCZWhpbmQgLWFuZCAkZ2xvYmFsOmdlbmVyYXRpb25EaWZmZXJlbmNlKQogICAgICAgIHsKICAgICAgICAgICAgIyBPdXRwdXQgZ2VuZXJhdGlvbiBudW1iZXIgZm9yIGluZGV4ZXJzIGluIGNhc2UgYW55IG9mIHRoZW0gaGF2ZSBiZWVuIHJlcG9ydGVkIGFzIGxlZnQgYmVoaW5kLCBhbmQgcmVwb3J0ZWQgZ2VuZXJhdGlvbiBJRHMgYXJlIGRpZmZlcmVudC4KICAgICAgICAgICAgZm9yZWFjaCAoJGdlbmVyYXRpb25JbmZvRW50cnkgaW4gKCRnZW5lcmF0aW9uSW5mbykpCiAgICAgICAgICAgIHsgICAgICAgIAogICAgICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICIgICAgJGdlbmVyYXRpb25JbmZvRW50cnkiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgV3JpdGUtT3V0cHV0ICIiCiAgICB9Cn0KCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgVmVyaWZ5SGFMaW1pdHM6IFZlcmlmeSBIQSBzdGF0dXMgZm9yIHRvcG9sb2d5IGFuZCBpbmRleCBzaXplIGxpbWl0cwojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpGdW5jdGlvbiBWZXJpZnlIYUxpbWl0cwp7CiAgICAkaGFjbCA9IEAoKQogICAgJGhhTm90T2sgPSAkZmFsc2UKICAgICRpeGN3bCA9IEAoKQogICAgJGl4Y2VsID0gQCgpCiAgICAkZG9jc0V4Y2VlZGVkID0gJGZhbHNlCiAgICAkZG9jc0hpZ2ggPSAkZmFsc2UKICAgIGZvcmVhY2ggKCRoYWMgaW4gJGdsb2JhbDpoYUFycmF5KQogICAgewogICAgICAgIGlmIChbaW50XSAkaGFjLmNvbXBvbmVudHNPayAtbHQgMikKICAgICAgICB7CiAgICAgICAgICAgIGlmIChbaW50XSAkaGFjLmNvbXBvbmVudHNPayAtZXEgMCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIyBTZXJ2aWNlIGlzIGRvd24KICAgICAgICAgICAgICAgICRnbG9iYWw6c2VydmljZUZhaWxlZCA9ICR0cnVlCiAgICAgICAgICAgICAgICAkaGFOb3RPayA9ICR0cnVlICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmICgkZ2xvYmFsOmhhVG9wb2xvZ3kpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICMgT25seSByZWxldmFudCB0byBvdXRwdXQgaWYgd2UgaGF2ZSBhIEhBIHRvcG9sb2d5IGluIHRoZSBmaXJzdCBwbGFjZQogICAgICAgICAgICAgICAgJGhhTm90T2sgPSAkdHJ1ZSAgIAogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJGhhYy5wYXJ0aXRpb24gLW5lIC0xKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkaGFjbCArPSAiJCgkaGFjLmNvbXBvbmVudHNPaykoJCgkaGFjLmNvbXBvbmVudHMpKSA6IEluZGV4IHBhcnRpdGlvbiAkKCRoYWMucGFydGl0aW9uKSIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRoYWNsICs9ICIkKCRoYWMuY29tcG9uZW50c09rKSgkKCRoYWMuY29tcG9uZW50cykpIDogJCgkaGFjLmVudGl0eSkiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKFtpbnRdICRoYWMuZG9jcyAtZ3QgMTAwMDAwMDApCiAgICAgICAgewogICAgICAgICAgICAkZG9jc0V4Y2VlZGVkID0gJHRydWUgCiAgICAgICAgICAgICRpeGNlbCArPSAiJCgkaGFjLmVudGl0eSkgKHBhcnRpdGlvbiAkKCRoYWMucGFydGl0aW9uKSk6ICQoJGhhYy5kb2NzKSIKICAgICAgICB9CiAgICAgICAgZWxzZWlmIChbaW50XSAkaGFjLmRvY3MgLWd0IDkwMDAwMDApCiAgICAgICAgewogICAgICAgICAgICAkZG9jc0hpZ2ggPSAkdHJ1ZSAgIAogICAgICAgICAgICAkaXhjd2wgKz0gIiQoJGhhYy5lbnRpdHkpIChwYXJ0aXRpb24gJCgkaGFjLnBhcnRpdGlvbikpOiAkKCRoYWMuZG9jcykiCiAgICAgICAgfQogICAgfQogICAgaWYgKCRoYU5vdE9rKQogICAgewogICAgICAgICRoYWNsID0gJGhhY2wgfCBzb3J0CiAgICAgICAgaWYgKCRnbG9iYWw6c2VydmljZUZhaWxlZCkKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAiQ3JpdGljYWw6IFNlcnZpY2UgZG93biBkdWUgdG8gY29tcG9uZW50cyBub3QgYWN0aXZlOiIKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICJXYXJuaW5nOiBObyBIaWdoIEF2YWlsYWJpbGl0eSBmb3Igb25lIG9yIG1vcmUgY29tcG9uZW50czoiCiAgICAgICAgfQogICAgICAgIGZvcmVhY2ggKCRoYyBpbiAkaGFjbCkKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAiICAgICRoYyIKICAgICAgICB9CiAgICAgICAgV3JpdGUtT3V0cHV0ICIiCiAgICB9CiAgICBpZiAoJGRvY3NFeGNlZWRlZCkKICAgIHsKICAgICAgICAkZ2xvYmFsOnNlcnZpY2VEZWdyYWRlZCA9ICR0cnVlCiAgICAgICAgV3JpdGUtT3V0cHV0ICJXYXJuaW5nOiBPbmUgb3IgbW9yZSBpbmRleCBjb21wb25lbnQgZXhjZWVkcyBkb2N1bWVudCBsaW1pdDoiCiAgICAgICAgZm9yZWFjaCAoJGhjIGluICRpeGNlbCkKICAgICAgICB7CiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAiICAgICRoYyIKICAgICAgICB9CiAgICAgICAgV3JpdGUtT3V0cHV0ICIiCiAgICB9CiAgICBpZiAoJGRvY3NIaWdoKQogICAgewogICAgICAgIFdyaXRlLU91dHB1dCAiV2FybmluZzogT25lIG9yIG1vcmUgaW5kZXggY29tcG9uZW50IGlzIGNsb3NlIHRvIGRvY3VtZW50IGxpbWl0OiIKICAgICAgICBmb3JlYWNoICgkaGMgaW4gJGl4Y3dsKQogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICIgICAgJGhjIgogICAgICAgIH0KICAgICAgICBXcml0ZS1PdXRwdXQgIiIKICAgIH0KfQoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBWZXJpZnlIb3N0Q29udHJvbGxlclJlcG9zaXRvcnk6IFZlcmlmeSB0aGF0IEhvc3QgQ29udHJvbGxlciBIQSAoZm9yIGRpY3Rpb25hcnkgcmVwb3NpdG9yeSkgaXMgT0sKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KRnVuY3Rpb24gVmVyaWZ5SG9zdENvbnRyb2xsZXJSZXBvc2l0b3J5CnsKICAgICRoaWdoZXN0UmVwVmVyID0gMAogICAgJGhvc3RDb250cm9sbGVycyA9IDAKICAgICRwcmltYXJ5UmVwVmVyID0gLTEKICAgICRoY1N0YXQgPSBAKCkKICAgICRoY3MgPSBHZXQtU1BFbnRlcnByaXNlU2VhcmNoSG9zdENvbnRyb2xsZXIKICAgIGZvcmVhY2ggKCRoYyBpbiAkaGNzKQogICAgewogICAgICAgICRob3N0Q29udHJvbGxlcnMgKz0gMQogICAgICAgICRyZXBWZXIgPSAkaGMuUmVwb3NpdG9yeVZlcnNpb24KICAgICAgICAkc2VydmVyTmFtZSA9ICRoYy5TZXJ2ZXIuTmFtZQogICAgICAgIGlmICgkcmVwVmVyIC1ndCAkaGlnaGVzdFJlcFZlcikKICAgICAgICB7CiAgICAgICAgICAgICRoaWdoZXN0UmVwVmVyID0gJHJlcFZlcgogICAgICAgIH0KICAgICAgICBpZiAoJGhjLlByaW1hcnlIb3N0Q29udHJvbGxlcikKICAgICAgICB7CiAgICAgICAgICAgICRwcmltYXJ5SEMgPSAkc2VydmVyTmFtZQogICAgICAgICAgICAkcHJpbWFyeVJlcFZlciA9ICRyZXBWZXIKICAgICAgICB9CiAgICAgICAgaWYgKCRyZXBWZXIgLW5lIC0xKQogICAgICAgIHsKICAgICAgICAgICAgJGhjU3RhdCArPSAiICAgICAgICAkc2VydmVyTmFtZSA6ICRyZXBWZXIiCiAgICAgICAgfQogICAgfQogICAgaWYgKCRob3N0Q29udHJvbGxlcnMgLWd0IDEpCiAgICB7CiAgICAgICAgV3JpdGUtT3V0cHV0ICJQcmltYXJ5IHNlYXJjaCBob3N0IGNvbnRyb2xsZXIgKGZvciBkaWN0aW9uYXJ5IHJlcG9zaXRvcnkpOiAkcHJpbWFyeUhDIgogICAgICAgIGlmICgkcHJpbWFyeVJlcFZlciAtZXEgLTEpCiAgICAgICAgewogICAgICAgICAgICAkZ2xvYmFsOnNlcnZpY2VEZWdyYWRlZCA9ICR0cnVlCiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAiV2FybmluZzogUHJpbWFyeSBob3N0IGNvbnRyb2xsZXIgaXMgbm90IGF2YWlsYWJsZS4iCiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAiICAgIFJlY29tbWVuZGVkIGFjdGlvbjogUmVzdGFydCBzZXJ2ZXIgb3Igc2V0IG5ldyBwcmltYXJ5IGhvc3QgY29udHJvbGxlciB1c2luZyBTZXQtU1BFbnRlcnByaXNlU2VhcmNoUHJpbWFyeUhvc3RDb250cm9sbGVyLiIKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICIgICAgUmVwb3NpdG9yeSB2ZXJzaW9uIGZvciBleGlzdGluZyBob3N0IGNvbnRyb2xsZXJzOiIKICAgICAgICAgICAgZm9yZWFjaCAoJGhjcyBpbiAkaGNTdGF0KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBXcml0ZS1PdXRwdXQgJGhjcwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2VpZiAoJHByaW1hcnlSZXBWZXIgLWx0ICRoaWdoZXN0UmVwVmVyKQogICAgICAgIHsKICAgICAgICAgICAgJGdsb2JhbDpzZXJ2aWNlRGVncmFkZWQgPSAkdHJ1ZQogICAgICAgICAgICBXcml0ZS1PdXRwdXQgIldhcm5pbmc6IFByaW1hcnkgaG9zdCBjb250cm9sbGVyIGRvZXMgbm90IGhhdmUgdGhlIGxhdGVzdCByZXBvc2l0b3J5IHZlcnNpb24uIgogICAgICAgICAgICBXcml0ZS1PdXRwdXQgIiAgICBQcmltYXJ5IGhvc3QgY29udHJvbGxlciByZXBvc2l0b3J5IHZlcnNpb246ICRwcmltYXJ5UmVwVmVyIgogICAgICAgICAgICBXcml0ZS1PdXRwdXQgIiAgICBMYXRlc3QgcmVwb3NpdG9yeSB2ZXJzaW9uOiAkaGlnaGVzdFJlcFZlciIKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICIgICAgUmVjb21tZW5kZWQgYWN0aW9uOiBTZXQgbmV3IHByaW1hcnkgaG9zdCBjb250cm9sbGVyIHVzaW5nIFNldC1TUEVudGVycHJpc2VTZWFyY2hQcmltYXJ5SG9zdENvbnRyb2xsZXIuIgogICAgICAgICAgICBXcml0ZS1PdXRwdXQgIiAgICBSZXBvc2l0b3J5IHZlcnNpb24gZm9yIGV4aXN0aW5nIGhvc3QgY29udHJvbGxlcnM6IgogICAgICAgICAgICBmb3JlYWNoICgkaGNzIGluICRoY1N0YXQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFdyaXRlLU91dHB1dCAkaGNzCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgV3JpdGUtT3V0cHV0ICIiCiAgICB9Cn0KCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgTWFpbgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKV3JpdGUtT3V0cHV0ICIiCldyaXRlLU91dHB1dCAiU2VhcmNoIFRvcG9sb2d5IGhlYWx0aCBjaGVjayIKV3JpdGUtT3V0cHV0ICI9PT09PT09PT09PT09PT09PT09PT09PT09PT09IgpXcml0ZS1PdXRwdXQgIiIKR2V0LURhdGUKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBHbG9iYWwgdmFyaWFibGVzOgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKJGdsb2JhbDpzZXJ2aWNlRGVncmFkZWQgPSAkZmFsc2UKJGdsb2JhbDpzZXJ2aWNlRmFpbGVkID0gJGZhbHNlCiRnbG9iYWw6dW5rbm93bkNvbXBvbmVudHMgPSBAKCkKJGdsb2JhbDpkZWdyYWRlZENvbXBvbmVudHMgPSBAKCkKJGdsb2JhbDpmYWlsZWRDb21wb25lbnRzID0gQCgpCiRnbG9iYWw6Z2VuZXJhdGlvbkRpZmZlcmVuY2UgPSAkZmFsc2UKJGdsb2JhbDppbmRleExlZnRCZWhpbmQgPSAkZmFsc2UKJGdsb2JhbDpzZWFyY2hIb3N0cyA9IDAKJGdsb2JhbDpzc2EgPSAkbnVsbAokZ2xvYmFsOmNvbXBvbmVudFN0YXRlTGlzdCA9ICRudWxsCiRnbG9iYWw6dG9wb2xvZ3lDb21wTGlzdCA9ICRudWxsCiRnbG9iYWw6aGFUb3BvbG9neSA9ICRmYWxzZQokZ2xvYmFsOnByaW1hcnlBZG1pbiA9ICRudWxsCiRnbG9iYWw6aW5kZXhlZERvY3MgPSAwCiRnbG9iYWw6bWFzdGVyTWVyZ2UgPSAkZmFsc2UKCiMgVGVtcGxhdGUgb2JqZWN0IGZvciB0aGUgaG9zdCBhcnJheToKJGdsb2JhbDpob3N0VGVtcGxhdGUgPSBOZXctT2JqZWN0IHBzb2JqZWN0CiRnbG9iYWw6aG9zdFRlbXBsYXRlIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgaG9zdE5hbWUgLVZhbHVlICRudWxsCiRnbG9iYWw6aG9zdFRlbXBsYXRlIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgY29tcG9uZW50cyAtVmFsdWUgMAokZ2xvYmFsOmhvc3RUZW1wbGF0ZSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lIGNwYyAtVmFsdWUgJG51bGwKJGdsb2JhbDpob3N0VGVtcGxhdGUgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSBxcGMgLVZhbHVlICRudWxsCiRnbG9iYWw6aG9zdFRlbXBsYXRlIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgcEFkbWluIC1WYWx1ZSAkbnVsbAokZ2xvYmFsOmhvc3RUZW1wbGF0ZSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lIHNBZG1pbiAtVmFsdWUgJG51bGwKJGdsb2JhbDpob3N0VGVtcGxhdGUgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSBhcGMgLVZhbHVlICRudWxsCiRnbG9iYWw6aG9zdFRlbXBsYXRlIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgY3Jhd2xlciAtVmFsdWUgJG51bGwKJGdsb2JhbDpob3N0VGVtcGxhdGUgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSBpbmRleCAtVmFsdWUgJG51bGwKCiMgQ3JlYXRlIHRoZSBlbXB0eSBob3N0IGFycmF5OgokZ2xvYmFsOmhvc3RBcnJheSA9IEAoKQoKIyBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSBIQSBncm91cCBhcnJheToKJGdsb2JhbDpoYVRlbXBsYXRlID0gTmV3LU9iamVjdCBwc29iamVjdAokZ2xvYmFsOmhhVGVtcGxhdGUgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSBlbnRpdHkgLVZhbHVlICRudWxsCiRnbG9iYWw6aGFUZW1wbGF0ZSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lIHBhcnRpdGlvbiAtVmFsdWUgLTEKJGdsb2JhbDpoYVRlbXBsYXRlIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgcHJpbWFyeSAtVmFsdWUgJG51bGwKJGdsb2JhbDpoYVRlbXBsYXRlIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgZG9jcyAtVmFsdWUgMAokZ2xvYmFsOmhhVGVtcGxhdGUgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSBjb21wb25lbnRzIC1WYWx1ZSAwCiRnbG9iYWw6aGFUZW1wbGF0ZSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lIGNvbXBvbmVudHNPayAtVmFsdWUgMAoKIyBDcmVhdGUgdGhlIGVtcHR5IEhBIGdyb3VwIGFycmF5OgokZ2xvYmFsOmhhQXJyYXkgPSBAKCkKCiMgVGVtcGxhdGUgb2JqZWN0IGZvciB0aGUgY29tcG9uZW50L3NlcnZlciB0YWJsZToKJGdsb2JhbDpjb21wVGVtcGxhdGUgPSBOZXctT2JqZWN0IHBzb2JqZWN0CiRnbG9iYWw6Y29tcFRlbXBsYXRlIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgQ29tcG9uZW50IC1WYWx1ZSAkbnVsbAokZ2xvYmFsOmNvbXBUZW1wbGF0ZSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgTm90ZVByb3BlcnR5IC1OYW1lIFNlcnZlciAtVmFsdWUgJG51bGwKJGdsb2JhbDpjb21wVGVtcGxhdGUgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSBQYXJ0aXRpb24gLVZhbHVlICRudWxsCiRnbG9iYWw6Y29tcFRlbXBsYXRlIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgU3RhdGUgLVZhbHVlICRudWxsCgojIENyZWF0ZSB0aGUgZW1wdHkgY29tcG9uZW50L3NlcnZlciB0YWJsZToKJGdsb2JhbDpjb21wQXJyYXkgPSBAKCkKCiMgR2V0IHRoZSBTU0Egb2JqZWN0IGFuZCBwcmludCBTU0EgbmFtZToKR2V0U1NBCgojIEdldCBiYXNpYyB0b3BvbG9neSBpbmZvIGFuZCBjb21wb25lbnQgaGVhbHRoIHN0YXR1cwpHZXRUb3BvbG9neUluZm8KCiMgVHJhdmVyc2UgbGlzdCBvZiBjb21wb25lbnRzLCBkZXRlcm1pbmUgcHJvcGVydGllcyBhbmQgdXBkYXRlICRnbG9iYWw6aG9zdEFycmF5IC8gJGdsb2JhbDpoYUFycmF5CmZvcmVhY2ggKCRzZWFyY2hDb21wIGluICgkZ2xvYmFsOnRvcG9sb2d5Q29tcExpc3QpKQp7CiAgICBQb3B1bGF0ZUhvc3RIYUxpc3QoJHNlYXJjaENvbXApCn0KCiMgQW5hbHl6ZSB0aGUgY29tcG9uZW50IHN0YXR1czoKZm9yZWFjaCAoJGNvbXBvbmVudCBpbiAoJGdsb2JhbDpjb21wb25lbnRTdGF0ZUxpc3QpKQp7CiAgICBTZWFyY2hDb21wb25lbnRTdGF0dXMoJGNvbXBvbmVudCkKfQoKIyBMb29rIGZvciBzZWxlY3RlZCBpbmZvIGZyb20gZGV0YWlsZWQgaW5kZXhlciBkaWFnbm9zdGljczoKRGV0YWlsZWRJbmRleGVyRGlhZwoKIyBPdXRwdXQgbGlzdCBvZiBjb21wb25lbnRzIHdpdGggc3RhdGUgT0s6CmlmICgkZ2xvYmFsOmNvbXBBcnJheSkKewogICAgJGdsb2JhbDpjb21wQXJyYXkgfCBTb3J0LU9iamVjdCAtUHJvcGVydHkgQ29tcG9uZW50IHwgRm9ybWF0LVRhYmxlIC1BdXRvU2l6ZQp9CldyaXRlLU91dHB1dCAiIgoKIyBWZXJpZnkgSEEgc3RhdHVzIGZvciB0b3BvbG9neSBhbmQgaW5kZXggc2l6ZSBsaW1pdHM6ClZlcmlmeUhhTGltaXRzCgojIFZlcmlmeSB0aGF0IEhvc3QgQ29udHJvbGxlciBIQSAoZm9yIGRpY3Rpb25hcnkgcmVwb3NpdG9yeSkgaXMgT0s6ClZlcmlmeUhvc3RDb250cm9sbGVyUmVwb3NpdG9yeQoKIyBPdXRwdXQgY29tcG9uZW50cyBieSBzZXJ2ZXIgKGZvciBzZXJ2ZXJzIHdpdGggbXVsdGlwbGUgc2VhcmNoIGNvbXBvbmVudHMpOgppZiAoJGdsb2JhbDpoYVRvcG9sb2d5IC1hbmQgKCRnbG9iYWw6c2VhcmNoSG9zdHMgLWd0IDIpKQp7CiAgICAkY29tcG9uZW50c0J5U2VydmVyID0gJGZhbHNlCiAgICBmb3JlYWNoICgkaG9zdEluZm8gaW4gJGdsb2JhbDpob3N0QXJyYXkpCiAgICB7CiAgICAgICAgaWYgKFtpbnRdICRob3N0SW5mby5jb21wb25lbnRzIC1ndCAxKQogICAgICAgIHsKICAgICAgICAgICAgJGNvbXBvbmVudHNCeVNlcnZlciA9ICR0cnVlCiAgICAgICAgfQogICAgfQogICAgaWYgKCRjb21wb25lbnRzQnlTZXJ2ZXIpCiAgICB7CiAgICAgICAgV3JpdGUtT3V0cHV0ICJTZXJ2ZXJzIHdpdGggbXVsdGlwbGUgc2VhcmNoIGNvbXBvbmVudHM6IgogICAgICAgIGZvcmVhY2ggKCRob3N0SW5mbyBpbiAkZ2xvYmFsOmhvc3RBcnJheSkKICAgICAgICB7CiAgICAgICAgICAgIGlmIChbaW50XSAkaG9zdEluZm8uY29tcG9uZW50cyAtZ3QgMSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICIgICAgJCgkaG9zdEluZm8uaG9zdE5hbWUpOiAkKCRob3N0SW5mby5wQWRtaW4pJCgkaG9zdEluZm8uc0FkbWluKSQoJGhvc3RJbmZvLmluZGV4KSQoJGhvc3RJbmZvLnFwYykkKCRob3N0SW5mby5jcGMpJCgkaG9zdEluZm8uYXBjKSQoJGhvc3RJbmZvLmNyYXdsZXIpIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFdyaXRlLU91dHB1dCAiIgogICAgfQp9CgojIEFuYWx5dGljcyBQcm9jZXNzaW5nIEpvYiBTdGF0dXM6CkFuYWx5dGljc1N0YXR1cwoKaWYgKCRnbG9iYWw6bWFzdGVyTWVyZ2UpCnsKICAgIFdyaXRlLU91dHB1dCAiSW5kZXggTWFzdGVyIE1lcmdlIChkZS1mcmFnbWVudCBpbmRleCBmaWxlcykgaW4gcHJvZ3Jlc3Mgb24gb25lIG9yIG1vcmUgaW5kZXggY29tcG9uZW50cy4iCn0KCmlmICgkZ2xvYmFsOnNlcnZpY2VGYWlsZWQgLWVxICRmYWxzZSkKewogICAgV3JpdGUtT3V0cHV0ICJTZWFyY2hhYmxlIGl0ZW1zOiAkZ2xvYmFsOmluZGV4ZWREb2NzIgp9CgpHZXRDcmF3bFN0YXR1cwpXcml0ZS1PdXRwdXQgIiIKICAgIAppZiAoJGdsb2JhbDp1bmtub3duQ29tcG9uZW50cykKewogICAgV3JpdGUtT3V0cHV0ICJUaGUgZm9sbG93aW5nIGNvbXBvbmVudHMgYXJlIG5vdCByZWFjaGFibGU6IgogICAgZm9yZWFjaCAoJHVjIGluICgkZ2xvYmFsOnVua25vd25Db21wb25lbnRzKSkKICAgIHsKICAgICAgICBXcml0ZS1PdXRwdXQgIiAgICAkdWMiCiAgICB9CiAgICBXcml0ZS1PdXRwdXQgIlJlY29tbWVuZGVkIGFjdGlvbjogUmVzdGFydCBvciByZXBsYWNlIHRoZSBhc3NvY2lhdGVkIHNlcnZlcihzKSIKICAgIFdyaXRlLU91dHB1dCAiIgp9CgppZiAoJGdsb2JhbDpkZWdyYWRlZENvbXBvbmVudHMpCnsKICAgIFdyaXRlLU91dHB1dCAiVGhlIGZvbGxvd2luZyBjb21wb25lbnRzIGFyZSBkZWdyYWRlZDoiCiAgICBmb3JlYWNoICgkZGMgaW4gKCRnbG9iYWw6ZGVncmFkZWRDb21wb25lbnRzKSkKICAgIHsKICAgICAgICBXcml0ZS1PdXRwdXQgIiAgICAkZGMiCiAgICB9CiAgICBXcml0ZS1PdXRwdXQgIlJlY29tbWVuZGVkIGFjdGlvbiBmb3IgZGVncmFkZWQgY29tcG9uZW50czoiCiAgICBXcml0ZS1PdXRwdXQgIiAgICBDb21wb25lbnQgcmVnaXN0ZXJpbmcgb3IgcmVzb2x2aW5nOiIKICAgIFdyaXRlLU91dHB1dCAiICAgICAgICBUaGlzIGlzIG5vcm1hbGx5IGEgdHJhbnNpZW50IHN0YXRlIGR1cmluZyBjb21wb25lbnQgcmVzdGFydCBvciByZS1jb25maWd1cmF0aW9uLiBSZS1ydW4gdGhlIHNjcmlwdC4iCgogICAgaWYgKCRnbG9iYWw6aW5kZXhMZWZ0QmVoaW5kKQogICAgewogICAgICAgIFdyaXRlLU91dHB1dCAiICAgIEluZGV4IGNvbXBvbmVudCBsZWZ0IGJlaGluZDoiCiAgICAgICAgaWYgKCRnbG9iYWw6Z2VuZXJhdGlvbkRpZmZlcmVuY2UpCiAgICAgICAgewogICAgICAgICAgICBXcml0ZS1PdXRwdXQgIiAgICAgICAgVGhpcyBpcyBub3JtYWwgYWZ0ZXIgYWRkaW5nIGFuIGluZGV4IGNvbXBvbmVudCBvciBpbmRleCBjb21wb25lbnQvc2VydmVyIHJlY292ZXJ5LiIKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICIgICAgICAgIEluZGljYXRlcyB0aGF0IHRoZSByZXBsaWNhIGlzIGJlaW5nIHVwZGF0ZWQgZnJvbSB0aGUgcHJpbWFyeSByZXBsaWNhLiIKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICIgICAgICAgIEluZGV4IHJlcGxpY2FzIGxpc3RlZCBhcyBkZWdyYWRlZCBidXQgaW5kZXggZ2VuZXJhdGlvbiBpcyBPSy4iCiAgICAgICAgICAgIFdyaXRlLU91dHB1dCAiICAgICAgICBXaWxsIGdldCBvdXQgb2YgZGVncmFkZWQgc3RhdGUgYXMgc29vbiBhcyBuZXcvY2hhbmdlZCBpdGVtcyBhcmUgYmVpbmcgaWRleGVkLiIKICAgICAgICB9CiAgICB9CiAgICBXcml0ZS1PdXRwdXQgIiIKfQoKaWYgKCRnbG9iYWw6ZmFpbGVkQ29tcG9uZW50cykKewogICAgV3JpdGUtT3V0cHV0ICJUaGUgZm9sbG93aW5nIGNvbXBvbmVudHMgYXJlIHJlcG9ydGVkIGluIGVycm9yOiIKICAgIGZvcmVhY2ggKCRmYyBpbiAoJGdsb2JhbDpmYWlsZWRDb21wb25lbnRzKSkKICAgIHsKICAgICAgICBXcml0ZS1PdXRwdXQgIiAgICAkZmMiCiAgICB9CiAgICBXcml0ZS1PdXRwdXQgIlJlY29tbWVuZGVkIGFjdGlvbjogUmVzdGFydCB0aGUgYXNzb2NpYXRlZCBzZXJ2ZXIocykiCiAgICBXcml0ZS1PdXRwdXQgIiIKfQoKaWYgKCRnbG9iYWw6c2VydmljZUZhaWxlZCkKewogICAgV3JpdGUtSG9zdCAtQmFja2dyb3VuZENvbG9yIFJlZCAtRm9yZWdyb3VuZENvbG9yIEJsYWNrICJTZWFyY2ggc2VydmljZSBvdmVyYWxsIHN0YXRlOiBGYWlsZWQgKG5vIHF1ZXJpZXMgc2VydmVkKSIKfQplbHNlaWYgKCRnbG9iYWw6c2VydmljZURlZ3JhZGVkKQp7CiAgICBXcml0ZS1Ib3N0IC1CYWNrZ3JvdW5kQ29sb3IgWWVsbG93IC1Gb3JlZ3JvdW5kQ29sb3IgQmxhY2sgIlNlYXJjaCBzZXJ2aWNlIG92ZXJhbGwgc3RhdGU6IERlZ3JhZGVkIgp9CmVsc2UKewogICAgV3JpdGUtSG9zdCAtQmFja2dyb3VuZENvbG9yIEdyZWVuIC1Gb3JlZ3JvdW5kQ29sb3IgQmxhY2sgIlNlYXJjaCBzZXJ2aWNlIG92ZXJhbGwgc3RhdGU6IE9LIgp9CldyaXRlLU91dHB1dCAiIg==
